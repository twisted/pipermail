<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20v21.2.0%20breaks%20Crossbar.io&In-Reply-To=%3CEE4254F1-6892-45AF-9D47-00F048BED3FE%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065511.html">
   <LINK REL="Next"  HREF="065513.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20v21.2.0%20breaks%20Crossbar.io&In-Reply-To=%3CEE4254F1-6892-45AF-9D47-00F048BED3FE%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Mar  3 11:59:12 MST 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065511.html">[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
</A></li>
        <LI>Next message (by thread): <A HREF="065513.html">[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65515">[ date ]</a>
              <a href="thread.html#65515">[ thread ]</a>
              <a href="subject.html#65515">[ subject ]</a>
              <a href="author.html#65515">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Mar 3, 2021, at 4:58 AM, Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Broadly, I agree.  But not with this part.  It seems like there is clearly a trade-off that is better for everyone.  The trade-off represented by #1298:
</I>&gt;<i> Breaks application code without providing any new functionality or fixing any bugs
</I>&gt;<i> Captures a long list of TODOs as an arbitrarily complex collection of sources spread across the entire codebase
</I>&gt;<i> All the work of addressing the problems still remains to be done 
</I>&gt;<i> Contrast this with any basic ratchet-style approach (for example, capture the list of mypy errors, then allow any PR that either removes some or doesn't add any new ones):
</I>
In principle, I agree.  And some coarse-grained ratchets are absolutely worth doing, when they're supported by the tools - for example, we have one of these with the way we're handling `disallow_untyped_defs` right now.  I wish tools like Mypy would build in ratcheting infrastructure that was easy to use and convenient to deploy.

But in practice this type of ratchet involves a &quot;# type: ignore&quot; at every single call site, as well as delaying shipping stubs or maintaining separate stubs.  As well as building the maladaptive habit that #type:ignore or cast()ing your way out of type errors is the right way to address them in individual features and getting every code reviewer used to that.
&gt;<i> At the outset, no application code breaks because nothing has actually changed
</I>&gt;<i> As work towards fixing the TODOs progresses, if it does break application code then at least applications have a chance at some benefit
</I>&gt;<i> As the work towards fixing the TODOs progresses, maintainers can easily look up what issues remain by consulting the list of errors that feeds the ratchet-style job.
</I>&gt;<i> The exact mechanism for the ratchet isn't the point here.  Maybe Mypy plays more nicely with inline comments telling it to ignore something, I don't know.  The point is:
</I>
The &quot;exact mechanism for the ratchet&quot; introduces enough hard problems that it inevitably delays tooling adoption for months or years, reduces the benefits of the tooling adoption (what Twisted users really want are comprehensive stubs, less than Twisted to type-check internally, I think, and this lets us ship them sooner in at least a mostly-usable state).
&gt;<i> A centralized list of stuff left to do is better than a mess smeared across the whole codebase
</I>&gt;<i> If we're going to risk breaking applications we should at least try to offer some value to them
</I>&gt;<i> We shouldn't make applications deal with every change twice when we could just disturb them once
</I>
Overall I very much appreciate your criticism and I wish that I could provide clear and concrete steps towards a functioning ratchet for all of these types of tools, but in practice the minor issues caused by the boil-the-ocean approach are an order of magnitude easier to address (and cheaper to leave un-addressed) than the effort required to build ratchets for our contributors that aren't a total nightmare to maintain and interact with.

Case in point: running `black` was a giant earthquake in the codebase but the pain associated with that was a drop in the bucket compared to the lingering, years-long nightmare of our attempt to build a style ratchet with twistedchecker.  In principle what we were trying to do with twistedchecker was very simple, but the practicalities ate us alive.

You could of course quite rightly argue that there were multiple conflated issues at play there!  But that's also the point: there's always a lot of complexity that comes along with trying to do codemod migrations &quot;the right way&quot; when that's going against the grain of the rest of the ecosystem.

I don't love that we've foisted this off onto our users, but I suspect Tobias spent a lot less time fixing the bug here than we've spent writing emails about it at this point ;-).

I look forward to the day where I'm wrong about all of this and every new code quality tool comes with a super easy-to-deploy ratchet, though.

-g

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20210303/3c71ecab/attachment-0001.htm&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065511.html">[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
</A></li>
	<LI>Next message (by thread): <A HREF="065513.html">[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65515">[ date ]</a>
              <a href="thread.html#65515">[ thread ]</a>
              <a href="subject.html#65515">[ subject ]</a>
              <a href="author.html#65515">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
