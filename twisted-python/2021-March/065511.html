<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20v21.2.0%20breaks%20Crossbar.io&In-Reply-To=%3CCAEeXt4MPb7dESfXLo%3DVFc6G6yu%2B5rd9ENSD3Oe0OJMC_DyPHLA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065510.html">
   <LINK REL="Next"  HREF="065515.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20v21.2.0%20breaks%20Crossbar.io&In-Reply-To=%3CCAEeXt4MPb7dESfXLo%3DVFc6G6yu%2B5rd9ENSD3Oe0OJMC_DyPHLA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io">exarkun at twistedmatrix.com
       </A><BR>
    <I>Wed Mar  3 05:58:23 MST 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065510.html">[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
</A></li>
        <LI>Next message (by thread): <A HREF="065515.html">[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65511">[ date ]</a>
              <a href="thread.html#65511">[ thread ]</a>
              <a href="subject.html#65511">[ subject ]</a>
              <a href="author.html#65511">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Mar 3, 2021 at 3:08 AM Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On Mar 2, 2021, at 6:10 PM, Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> Policy aside, this change doesn't seem like much of an improvement to me.
</I>&gt;<i> If I were to guess, I would guess the change was made to satisfy some check
</I>&gt;<i> Mypy is now being asked to make about Twisted.  If that's the case, it
</I>&gt;<i> seems unfortunate that real-world software is suffering so that a synthetic
</I>&gt;<i> goal can be achieved.  I do recognize there is a perception that practical
</I>&gt;<i> value can come from attending to the errors Mypy reports.  It would
</I>&gt;<i> probably benefit everyone if more care were taken to consider the
</I>&gt;<i> real-world consequences of changes that are made to satisfy the
</I>&gt;<i> non-real-world goalposts set by tools like Mypy.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I do think that Mypy was likely highlighting a real issue here, and it
</I>&gt;<i> should have been fixed.  We had documented interfaces already, and we were
</I>&gt;<i> failing to adhere to them properly, and Mypy was complaining about that.
</I>&gt;<i>
</I>&gt;<i> For easy reference, the change that made these fixes is here
</I>&gt;<i> <A HREF="https://github.com/twisted/twisted/pull/1298">https://github.com/twisted/twisted/pull/1298</A>
</I>&gt;<i>
</I>&gt;<i> This genre of fix is definitely something we should unwind over time,
</I>&gt;<i> although it does make it easier to start mypy-clean rather than have
</I>&gt;<i> hundreds of exclusion lines that need to be manually adjusted, so on
</I>&gt;<i> balance I agree with this tradeoff at the point it was made.
</I>&gt;<i>
</I>
Broadly, I agree.  But not with this part.  It seems like there is clearly
a trade-off that is better for everyone.  The trade-off represented by
#1298:

   - Breaks application code without providing any new functionality or
   fixing any bugs
   - Captures a long list of TODOs as an arbitrarily complex collection of
   sources spread across the entire codebase
   - All the work of addressing the problems still remains to be done

 Contrast this with any basic ratchet-style approach (for example, capture
the list of mypy errors, then allow any PR that either removes some or
doesn't add any new ones):

   - At the outset, no application code breaks because nothing has actually
   changed
   - As work towards *fixing* the TODOs progresses, if it *does* break
   application code then at least applications have a chance at some benefit
   - As the work towards fixing the TODOs progresses, maintainers can
   easily look up what issues remain by consulting the list of errors that
   feeds the ratchet-style job.

The exact mechanism for the ratchet isn't the point here.  Maybe Mypy plays
more nicely with inline comments telling it to ignore something, I don't
know.  The point is:

   - A centralized list of stuff left to do is better than a mess smeared
   across the whole codebase
   - If we're going to risk breaking applications we should at least try to
   offer some value to them
   - We shouldn't make applications deal with every change twice when we
   could just disturb them once

Jean-Paul


&gt;<i> Specifically what I mean by &quot;this genre of fix&quot; is that you can always
</I>&gt;<i> make mypy happy by transforming code like this:
</I>&gt;<i>
</I>&gt;<i> class Thing:
</I>&gt;<i>     pass
</I>&gt;<i>
</I>&gt;<i> Thing().stuff()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> into code like this:
</I>&gt;<i>
</I>&gt;<i> class Thing:
</I>&gt;<i>     @property
</I>&gt;<i>     def stuff(self):
</I>&gt;<i>         raise AttributeError(&quot;no such thing as `stuff`&quot;)
</I>&gt;<i>
</I>&gt;<i> Thing().stuff()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The runtime behavior is the same, but now Mypy can't tell you about this
</I>&gt;<i> class of bug any more.
</I>&gt;<i>
</I>&gt;<i> So, at some point, we should slowly unwind all `NotImplementedError`
</I>&gt;<i> methods and find ways to either implement them for real or make their
</I>&gt;<i> required use raise at import time.
</I>&gt;<i>
</I>&gt;<i> Finally: let's not develop an aversion to new tooling and change because
</I>&gt;<i> it might create problems; experience over the last few years has shown me
</I>&gt;<i> that Mypy can catch *tons* of real bugs and it's well worth getting the
</I>&gt;<i> codebase to type check.  If we want to prevent breakages like this in the
</I>&gt;<i> future, the answer is not to stop trying to get linters and typecheckers to
</I>&gt;<i> run cleanly with arbitrary changes, but to figure out some kind of *continuous
</I>&gt;<i> integration *solution that's actually continuous with our downstream
</I>&gt;<i> dependencies
</I>&gt;<i>
</I>&gt;<i> If dependencies could start testing against Twisted trunk in some
</I>&gt;<i> capacity, we could get notified close to when unintentionally breaking
</I>&gt;<i> changes occur, and dependencies can let us know well before the release
</I>&gt;<i> happens, and we can either revert or they can fix things if the error is on
</I>&gt;<i> their end.  If initially, say, crossbar and matrix would like to work with
</I>&gt;<i> us to set up some kind of repeatable pattern we can suggest to others, that
</I>&gt;<i> would be great.
</I>&gt;<i>
</I>&gt;<i> -g
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20210303/54796472/attachment-0001.htm&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065510.html">[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
</A></li>
	<LI>Next message (by thread): <A HREF="065515.html">[Twisted-Python] Twisted v21.2.0 breaks Crossbar.io
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65511">[ date ]</a>
              <a href="thread.html#65511">[ thread ]</a>
              <a href="subject.html#65511">[ subject ]</a>
              <a href="author.html#65511">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
