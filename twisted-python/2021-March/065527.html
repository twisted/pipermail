<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Klein?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Klein%3F&In-Reply-To=%3CCAAXGW-xzdJyEjZZXtXAP9v_gXh4sp4waXfmp7NepzyWrzHt7wg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065521.html">
   <LINK REL="Next"  HREF="065528.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Klein?</H1>
    <B>Robert DiFalco</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Klein%3F&In-Reply-To=%3CCAAXGW-xzdJyEjZZXtXAP9v_gXh4sp4waXfmp7NepzyWrzHt7wg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Klein?">robert.difalco at gmail.com
       </A><BR>
    <I>Thu Mar  4 22:01:35 MST 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065521.html">[Twisted-Python] Klein?
</A></li>
        <LI>Next message (by thread): <A HREF="065528.html">[Twisted-Python] Klein?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65527">[ date ]</a>
              <a href="thread.html#65527">[ thread ]</a>
              <a href="subject.html#65527">[ subject ]</a>
              <a href="author.html#65527">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks! The trick will be figuring out how to handle Python exception
vs werkzeug exception, and the branched, error handling routes etc.
Currently this is the sort of data structure I'm posting to Data Dog. But I
can make it a pluggable observer-type idiom so anything can receive these
metrics.

tags=[
    &quot;path:{}.{}.{}&quot;.format(module, className, method),
    &quot;blocking:{}&quot;.format(isBlocking),
    &quot;module:{}&quot;.format(module),
    &quot;class:{}&quot;.format(className),
    &quot;method:{}&quot;.format(method),
    &quot;status_code:{}&quot;.format(request_code),
    &quot;status_code_class:{}xx&quot;.format(status_code_class),
]
metrics.timing(&quot;my.rest.endpoint&quot;, elapsed, tags=tags)

I don't have it quite right yet. It's hard to get the status code, deal
with unhandled exceptions, etc. But I'll post questions here when I'm
closer.

On Wed, Mar 3, 2021 at 11:13 PM Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mar 1, 2021, at 12:51 PM, Robert DiFalco &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">robert.difalco at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> Is this the right place to ask klein questions?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Absolutely, it's a Twisted org project.
</I>&gt;<i>
</I>&gt;<i> I'm writing a metrics plugin for Klein and I can't figure out how to
</I>&gt;<i> inject a metrics handler so that I can get route, path, duration, and
</I>&gt;<i> status code. What I'm doing now sucks because Klein and twisted interact in
</I>&gt;<i> complex ways on Failure and status codes.
</I>&gt;<i>
</I>&gt;<i> # Replace the klein _call with the metrics generating call
</I>&gt;<i> _app._call = _callWithMetrics
</I>&gt;<i>
</I>&gt;<i> Rather than replace _call with my version of _call I was hoping there was
</I>&gt;<i> a cleaner way to get the start and stop with the result code of a route
</I>&gt;<i> invocation. Thoughts?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It sounds like you should contribute a patch that makes this an
</I>&gt;<i> explicitly-supported pluggable entrypoint, rather than relying on a hack.
</I>&gt;<i> No need to figure out a way to make it work with existing versions, the
</I>&gt;<i> magic of open source is that you can change it :).
</I>&gt;<i>
</I>&gt;<i> Feel free to ping here when it's done to remind folks to do a review.
</I>&gt;<i>
</I>&gt;<i> -g
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20210304/82a7d84c/attachment.htm&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065521.html">[Twisted-Python] Klein?
</A></li>
	<LI>Next message (by thread): <A HREF="065528.html">[Twisted-Python] Klein?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65527">[ date ]</a>
              <a href="thread.html#65527">[ thread ]</a>
              <a href="subject.html#65527">[ subject ]</a>
              <a href="author.html#65527">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
