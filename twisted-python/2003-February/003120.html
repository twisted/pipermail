<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Serving files, again
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Serving%20files%2C%20again&In-Reply-To=20030226210657.GB23608%40doublegemini.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003088.html">
   <LINK REL="Next"  HREF="003089.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Serving files, again</H1>
    <B>Tommi Virtanen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Serving%20files%2C%20again&In-Reply-To=20030226210657.GB23608%40doublegemini.com"
       TITLE="[Twisted-Python] Serving files, again">tv at twistedmatrix.com
       </A><BR>
    <I>Fri Feb 28 13:03:32 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003088.html">[Twisted-Python] Serving files, again
</A></li>
        <LI>Next message: <A HREF="003089.html">[Twisted-Python] Serving files, again
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3120">[ date ]</a>
              <a href="thread.html#3120">[ thread ]</a>
              <a href="subject.html#3120">[ subject ]</a>
              <a href="author.html#3120">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Feb 26, 2003 at 09:06:57PM +0000, Clark C. Evans wrote:
&gt;<i> The files that I need to serve up are quite big (some are a meg or more),
</I>&gt;<i> and it would be bad to block other resources while the file loads into
</I>&gt;<i> memory via file.read() or for the time it takes for the client to 
</I>&gt;<i> completely consume the file.
</I>
	If file loading is too slow, buy some more memory. Keeping
	hundreds of megs of files in RAM is standard procedure for
	any sane operating system these days. Let it worry about
	keeping the file access fast.

	It should (and AIUI will) be served to the client
	chunk-by-chunk, processing other tasks between the reads.

&gt;<i> |   BTW, deferring to a thread would not be the way to go.  Something similar
</I>&gt;<i> | to twisted.spread.util.Pager would probably be appropriate, or maybe
</I>&gt;<i> | something that implements IProducer.  Or maybe just a chain of Deferreds :)
</I>&gt;<i> | No need to go into threads for this, though.
</I>
	(sorry for responding to doublequoted text)

	Oh, python threads may not the low-level enough to actually
	help with disk IO (on Linux, atleast). Don't know if they are
	or are not.. Avoiding blocking on disk IO needs a separate
	process context in the kernel, userspace threading will not
	help.


&gt;<i> Is this the Jist of it?  It still has the problem that file.read 
</I>&gt;<i> is a blocking call; I suppose for unix platforms you could use
</I>&gt;<i> &quot;poll()&quot; to not block.  This is probably resonable; on the server
</I>&gt;<i> side you don't block, while for desktop windows clients it blocks.
</I>
	poll() or select() won't work in file access, files block always
	unless you use AIO or something like that. Sorry.

	If you are that worried about performance, type &quot;c10k&quot; into
	google and start writing C. Nothing else will really help;
	file access only becomes a bottleneck _after_ you've done all
	the other things suggested at c10k.

-- 
:<i>(){ :|:&amp;};:
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003088.html">[Twisted-Python] Serving files, again
</A></li>
	<LI>Next message: <A HREF="003089.html">[Twisted-Python] Serving files, again
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3120">[ date ]</a>
              <a href="thread.html#3120">[ thread ]</a>
              <a href="subject.html#3120">[ subject ]</a>
              <a href="author.html#3120">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
