<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Fixes for windows installer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Fixes%20for%20windows%20installer&In-Reply-To=%3C7kbkb3d1.fsf%40python.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="035620.html">
   <LINK REL="Next"  HREF="035618.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Fixes for windows installer</H1>
    <B>Thomas Heller</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Fixes%20for%20windows%20installer&In-Reply-To=%3C7kbkb3d1.fsf%40python.net%3E"
       TITLE="[Twisted-Python] Re: Fixes for windows installer">theller at python.net
       </A><BR>
    <I>Fri Feb 28 12:40:42 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="035620.html">[Twisted-Python] Re: Fixes for windows installer
</A></li>
        <LI>Next message (by thread): <A HREF="035618.html">[Twisted-Python] introductory questions for twisted.web.woven
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35621">[ date ]</a>
              <a href="thread.html#35621">[ thread ]</a>
              <a href="subject.html#35621">[ subject ]</a>
              <a href="author.html#35621">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Cory Dodt &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">corydodt at yahoo.com</A>&gt; writes:

&gt;<i> I like where this is going, and I certainly have no complaints about
</I>&gt;<i> dumping shortcut.py, but could you please review a few things before I
</I>&gt;<i> commit this:
</I>&gt;<i> 
</I>&gt;<i> * Putting install-script into setup.cfg makes your change visible to
</I>&gt;<i> everyone who's building a distribution of Twisted.  As you pointed out
</I>&gt;<i> yourself, you can't use install-script without distutils 1.0.3, and
</I>&gt;<i> Twisted has to support pythons 2.1 and 2.2.  Will this config parameter be
</I>&gt;<i> ignored by setup.py when building a Twisted install on distutils &lt;1.0.3 or
</I>&gt;<i> will it cause an error?
</I>
I think it will raise an error. Feel free to remove it again. 

(Another approach would be to handle it programatically in the setup.py
script, you can somehow find out whether it is supported or not, and in
the former case pass it through the options parameter).

&gt;<i> 
</I>&gt;<i> * You made this change to the test I use for isWinNT:
</I>&gt;<i> -    if platform.isWinNT():
</I>&gt;<i> -        return os.path.join(os.getenv(&quot;SYSTEMROOT&quot;), 
</I>&gt;<i> -                            &quot;system32&quot;, &quot;shell32.dll&quot;)
</I>&gt;<i> +    # If SYSTEMROOT is not found (on Win98), guess the name
</I>&gt;<i> +    # of the windows directory
</I>&gt;<i> +    isNT = 0
</I>&gt;<i> +    try:
</I>&gt;<i> +        get_special_folder_path(&quot;CSIDL_COMMON_PROGRAMS&quot;)
</I>&gt;<i> +        isNT = 1
</I>&gt;<i> +    except OSError: # probably Win98
</I>&gt;<i> +        pass
</I>&gt;<i> 
</I>&gt;<i> Is the implementation of platform.isWinNT() broken?  If so, I'd rather you
</I>&gt;<i> patched it there.  If not, I'd rather keep using it.
</I>
I don't think it is broken. But we're not interested if this is NT or
not, we only try to find shell32.dll.  And I wanted to remove the
requirement that win32all be installed for full functionality if the
installer only (actually that's the reason I integrated them in
bdist_wininst).

&gt;<i> 
</I>&gt;<i> * Most important thing: test_postinstall doesn't work with this patch,
</I>&gt;<i> because create_shortcut and get_special_folder_path appear to be magical
</I>&gt;<i> builtins installed by distutils.  I'll be happy to rewrite the test if you
</I>&gt;<i> can point me to the right place to import this code when it's not
</I>&gt;<i> available as a builtin.
</I>
These are builtin commands in the bdist_wininst stub used to create the
installer. AFAIK, there's no way to access them from somewhere else ;-(
You could, of course, simulate them for the test stuff in Python with
win32all, you could even look up the C sources in
<A HREF="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/python/python/dist/src/PC/bdist_wininst/install.c">http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/python/python/dist/src/PC/bdist_wininst/install.c</A>
look for the CreateShortcut function.

Thomas



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="035620.html">[Twisted-Python] Re: Fixes for windows installer
</A></li>
	<LI>Next message (by thread): <A HREF="035618.html">[Twisted-Python] introductory questions for twisted.web.woven
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35621">[ date ]</a>
              <a href="thread.html#35621">[ thread ]</a>
              <a href="subject.html#35621">[ subject ]</a>
              <a href="author.html#35621">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
