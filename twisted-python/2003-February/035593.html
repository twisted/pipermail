<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Serving files, again
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Serving%20files%2C%20again&In-Reply-To=%3C20030226194852.GB22857%40doublegemini.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="035601.html">
   <LINK REL="Next"  HREF="035610.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Serving files, again</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Serving%20files%2C%20again&In-Reply-To=%3C20030226194852.GB22857%40doublegemini.com%3E"
       TITLE="[Twisted-Python] Serving files, again">cce at clarkevans.com
       </A><BR>
    <I>Wed Feb 26 12:48:52 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="035601.html">[Twisted-Python] Serving files, again
</A></li>
        <LI>Next message (by thread): <A HREF="035610.html">[Twisted-Python] Serving files, again
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35593">[ date ]</a>
              <a href="thread.html#35593">[ thread ]</a>
              <a href="subject.html#35593">[ subject ]</a>
              <a href="author.html#35593">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Feb 26, 2003 at 12:48:31AM +0100, Mario Ruggier wrote:
|<i> 
</I>|<i> Oh, and in general, how does one turn off directory browsing
</I>|<i> for a twisted.web server?
</I>
You could do this in the constructor,

    path = RestrictedResource('/my/path',directoryBrowsing=false)

But, this really should be done on a per-request mechanism.  Perhaps
request needs a &quot;options&quot; collection where a top-level Resource 
can set processing options for lower-level resources in the path
chain (see the FilterResource post previously).

Anyway, I wanted to respond to your code below...

|<i> class RestrictedResource(resource.Resource):
</I>|<i>     def isLeaf(self):
</I>|<i>         return 1
</I>|<i>     def render(self, request):
</I>...
|<i>         fullPath = docsBase +'/'+ subPath
</I>|<i>         try:
</I>|<i>             if not os.path.exists(fullPath):
</I>|<i>                 raise Exception # of type...
</I>|<i>             elif os.path.isdir(fullPath):
</I>|<i>                 dirlist = processDirlist(os.listdir(fullPath))
</I>|<i>             elif os.path.isfile(fullPath):
</I>|<i>                 import mimetypes
</I>
This is interesting.  I would have probably done it a less
efficient way (but perhaps more flexible)?  I would have 
used two resources, a DirectoryResource and a FileResource.  

The DirectoryResource would override getChild(path,request) and 
dynamically look for a child in the current path, leveraging the
descent operation in getChildForRequest.  This object would then
either return the subordinate NotFoundResource, DirectoryResource 
or a FileResource object depending on what the path matched. 
The constructor for these child resources would have a fullpath,
constructed by concatinating the fullpath of the current Directory
with the given path.

The FileResource would serve up the given file, by overriding
the render(request) method as you have specified above.  In this
way one could provide a replacement FileResource or override a
DirectoryResource, etc.  

If you wanted to get tricky, you could &quot;stuff&quot; the path state
into the request object and the DirectoryResource could 
'return self' instead of creating intermediary Directories.
This leads to the following more general questions:

  1.  There should be a general way to attach &quot;resource specific&quot;
      data to a given request, for DirectoryResource it'd be the
      current path, for PathArgs, it'd be the mapping of path
      arguments to variables.

  2.  This mechanism could thus be used for inter-resource 
      communication, say where a UserSession(FilterResource)
      would attach a directive to &quot;compress_files&quot; or not
      to subordinate FileResources.

As I said in a previous post, I'm quite impressed with the
whole &quot;Resource&quot; concept and the &quot;tail recursive&quot; descent
mechanism provided via getChildForRequest.

Hope this helps...

Clark


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="035601.html">[Twisted-Python] Serving files, again
</A></li>
	<LI>Next message (by thread): <A HREF="035610.html">[Twisted-Python] Serving files, again
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35593">[ date ]</a>
              <a href="thread.html#35593">[ thread ]</a>
              <a href="subject.html#35593">[ subject ]</a>
              <a href="author.html#35593">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
