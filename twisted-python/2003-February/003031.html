<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SMTP client patch 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20SMTP%20client%20patch%20&In-Reply-To=200302210029.h1L0TZ511318%40haddock.cd.chalmers.se">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003029.html">
   <LINK REL="Next"  HREF="003100.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SMTP client patch </H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20SMTP%20client%20patch%20&In-Reply-To=200302210029.h1L0TZ511318%40haddock.cd.chalmers.se"
       TITLE="[Twisted-Python] SMTP client patch ">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Feb 20 23:37:08 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003029.html">[Twisted-Python] SMTP client patch 
</A></li>
        <LI>Next message: <A HREF="003100.html">[Twisted-Python] SMTP client patch 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3031">[ date ]</a>
              <a href="thread.html#3031">[ thread ]</a>
              <a href="subject.html#3031">[ subject ]</a>
              <a href="author.html#3031">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Thursday, February 20, 2003, at 06:29 PM, Anders Hammarquist wrote:

&gt;<i> In a message of Thu, 20 Feb 2003 16:14:31 CST, Glyph Lefkowitz writes:
</I>&gt;&gt;<i> I had a look at this patch with Itamar today.  We like where you're
</I>&gt;&gt;<i> going, but here are a few issues:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. it's not backwards compatible.  DocmaServer uses its own sendEmail,
</I>&gt;&gt;<i> which depends on the sentEmail callback's signature.
</I>&gt;<i>
</I>&gt;<i> Yes, I know. The changes were needed to be able to get complete
</I>&gt;<i> status for the message delivery. With the old code there was no
</I>&gt;<i> way to find out what happend to failed recipient addresses. I
</I>&gt;<i> suppose I could add logic to try and detect an old-style sentEmail.
</I>
Hmm... if you do that (with inspect or somesuch) please make sure to 
spit out an ugly warning so that people will know to fix their code.  
We shouldn't be supporting that long-term.

&gt;&gt;<i> I personally would like to see Twisted's sendEmail deprecated and
</I>&gt;&gt;<i> replaced with an admonishment to use the 'email' module ;), so it 
</I>&gt;&gt;<i> would
</I>&gt;&gt;<i> be nice if you could re-implement sendEmail in terms of your  
</I>&gt;&gt;<i> MIME-less
</I>&gt;&gt;<i> 'sendmail' function.
</I>&gt;<i>
</I>&gt;<i> As in using sendmail plus the email module? Sure, will do.
</I>
Actually I'd prefer the existing code not to be changed, but to spit 
out a warning, since the interface ought to be &quot;just pass a Message&quot;, 
not &quot;pass a bunch of crap that gets turned into a Message&quot;.  
Considering how easy it is to turn a Message object into a long string, 
I don't think a separate method is required for this...

As long as it's still maintained, though, the existing code should 
remain in place rather than dragging a new dependency in for use with 
2.1 (since 'email' is only in the stdlib since 2.2)

&gt;&gt;<i> 2. Those change to LineReceiver made no sense to us.  Care to explain?
</I>&gt;<i>
</I>&gt;<i> Somewhere in the docs I read that returning (as opposed to raising)
</I>&gt;<i> an exception will land you in Factory.clientConnectionFailed with
</I>&gt;<i> that exception (wrapped in a failure). However, LineReceiver didn't
</I>&gt;<i> propagate the returned exceptions up to Protocol, so it didn't work
</I>&gt;<i> without those changes. smtpConnectionFailed and smtpTransferFailed
</I>&gt;<i> uses this.
</I>
Hmm.  Well, in any event I guess this is a more useful return value in 
general, and doesn't break anything.

&gt;&gt;<i> 3. What's up with the SMTP logger?  and logging every line in the
</I>&gt;&gt;<i> client?  This is duplicated generic code, and should probably be
</I>&gt;&gt;<i> refactored into someplace more appropriate, like twisted.python.log.
</I>&gt;<i>
</I>&gt;<i> I agree that it may be useful elsewhere (though expect it's use
</I>&gt;<i> will be rather limited). The purpose keeping the log is for
</I>&gt;<i> generating bounce messages (i.e. as sendmail says:
</I>
aah, this makes a little more sense.

&gt;<i> ). My first look at t.p.log suggested not using it, since it dealt
</I>&gt;<i> mostly with syslog()-like logging.
</I>
You're right.  Given this use-case though, it sounds like you need 
little more beyond cStringIO...?

&gt;<i> I'll have another look to see if it fits with those logging functions, 
</I>&gt;<i> else I'll just rename it to something more generic and let it live in 
</I>&gt;<i> t.p.log.
</I>
t.p.log might not be the best place to put it, come to think of it, 
since your impression of 'something like syslog' is correct.  But 
somewhere in t.p in general.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (Darwin)

iD8DBQE+Vaz4vVGR4uSOE2wRAjGmAJ9ZWl6vptshdNeVcvd5NIeeob5gtACfSALt
h+xh9bV6ERYUDfGsatBqIrE=
=jzDr
-----END PGP SIGNATURE-----



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003029.html">[Twisted-Python] SMTP client patch 
</A></li>
	<LI>Next message: <A HREF="003100.html">[Twisted-Python] SMTP client patch 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3031">[ date ]</a>
              <a href="thread.html#3031">[ thread ]</a>
              <a href="subject.html#3031">[ subject ]</a>
              <a href="author.html#3031">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
