<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Serving files, again
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Serving%20files%2C%20again&In-Reply-To=20030226194852.GB22857%40doublegemini.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003085.html">
   <LINK REL="Next"  HREF="003111.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Serving files, again</H1>
    <B>Mario Ruggier</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Serving%20files%2C%20again&In-Reply-To=20030226194852.GB22857%40doublegemini.com"
       TITLE="[Twisted-Python] Serving files, again">mario at ruggier.org
       </A><BR>
    <I>Thu Feb 27 11:51:02 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003085.html">[Twisted-Python] Serving files, again
</A></li>
        <LI>Next message: <A HREF="003111.html">[Twisted-Python] Refactoring GetChildWithDefault (removal is ideal)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3102">[ date ]</a>
              <a href="thread.html#3102">[ thread ]</a>
              <a href="subject.html#3102">[ subject ]</a>
              <a href="author.html#3102">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks, I have played with your suggestions somewhat.
But, I want to avoid doing things such as overriding File's
render() as I had initially (File.render() does too many nice things
to throw away so easily, as pointed out in the other posts).

A source of confusion for me is knowing which,
and when, specific methods are called automatically.
Particularly, it would be nice to have a clarification (in the
API docs) of when the methods getChildForRequest() and
getChildWithDefault() are called -- they seem not be called in
a non-siteroot resource. Things worked well with PathArgs, it
being set as root resource, but for an arbitrary resource,
like the example I previoulsy included, the game seems to
change .

But, indeed, as Clark, I do find this model of cascading requests
very intriguing, and tantalizingly powerful...

Cheers, mario


&gt;<i> Anyway, I wanted to respond to your code below...
</I>&gt;<i>
</I>&gt;<i> | class RestrictedResource(resource.Resource):
</I>&gt;<i> |     def isLeaf(self):
</I>&gt;<i> |         return 1
</I>&gt;<i> |     def render(self, request):
</I>&gt;<i> ...
</I>&gt;<i> |         fullPath = docsBase +'/'+ subPath
</I>&gt;<i> |         try:
</I>&gt;<i> |             if not os.path.exists(fullPath):
</I>&gt;<i> |                 raise Exception # of type...
</I>&gt;<i> |             elif os.path.isdir(fullPath):
</I>&gt;<i> |                 dirlist = processDirlist(os.listdir(fullPath))
</I>&gt;<i> |             elif os.path.isfile(fullPath):
</I>&gt;<i> |                 import mimetypes
</I>&gt;<i>
</I>&gt;<i> This is interesting.  I would have probably done it a less
</I>&gt;<i> efficient way (but perhaps more flexible)?  I would have
</I>&gt;<i> used two resources, a DirectoryResource and a FileResource.
</I>&gt;<i>
</I>&gt;<i> The DirectoryResource would override getChild(path,request) and
</I>&gt;<i> dynamically look for a child in the current path, leveraging the
</I>&gt;<i> descent operation in getChildForRequest.  This object would then
</I>&gt;<i> either return the subordinate NotFoundResource, DirectoryResource
</I>&gt;<i> or a FileResource object depending on what the path matched.
</I>&gt;<i> The constructor for these child resources would have a fullpath,
</I>&gt;<i> constructed by concatinating the fullpath of the current Directory
</I>&gt;<i> with the given path.
</I>&gt;<i>
</I>&gt;<i> The FileResource would serve up the given file, by overriding
</I>&gt;<i> the render(request) method as you have specified above.  In this
</I>&gt;<i> way one could provide a replacement FileResource or override a
</I>&gt;<i> DirectoryResource, etc.
</I>&gt;<i>
</I>&gt;<i> If you wanted to get tricky, you could &quot;stuff&quot; the path state
</I>&gt;<i> into the request object and the DirectoryResource could
</I>&gt;<i> 'return self' instead of creating intermediary Directories.
</I>&gt;<i> This leads to the following more general questions:
</I>&gt;<i>
</I>&gt;<i>   1.  There should be a general way to attach &quot;resource specific&quot;
</I>&gt;<i>       data to a given request, for DirectoryResource it'd be the
</I>&gt;<i>       current path, for PathArgs, it'd be the mapping of path
</I>&gt;<i>       arguments to variables.
</I>&gt;<i>
</I>&gt;<i>   2.  This mechanism could thus be used for inter-resource
</I>&gt;<i>       communication, say where a UserSession(FilterResource)
</I>&gt;<i>       would attach a directive to &quot;compress_files&quot; or not
</I>&gt;<i>       to subordinate FileResources.
</I>&gt;<i>
</I>&gt;<i> As I said in a previous post, I'm quite impressed with the
</I>&gt;<i> whole &quot;Resource&quot; concept and the &quot;tail recursive&quot; descent
</I>&gt;<i> mechanism provided via getChildForRequest.
</I>&gt;<i>
</I>&gt;<i> Hope this helps...
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003085.html">[Twisted-Python] Serving files, again
</A></li>
	<LI>Next message: <A HREF="003111.html">[Twisted-Python] Refactoring GetChildWithDefault (removal is ideal)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3102">[ date ]</a>
              <a href="thread.html#3102">[ thread ]</a>
              <a href="subject.html#3102">[ subject ]</a>
              <a href="author.html#3102">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
