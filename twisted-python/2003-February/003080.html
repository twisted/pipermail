<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted Resources / PathArgs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Resources%20/%20PathArgs&In-Reply-To=1046200834.1542.73.camel%40lothlorien">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003079.html">
   <LINK REL="Next"  HREF="003081.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted Resources / PathArgs</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Resources%20/%20PathArgs&In-Reply-To=1046200834.1542.73.camel%40lothlorien"
       TITLE="[Twisted-Python] Twisted Resources / PathArgs">cce at clarkevans.com
       </A><BR>
    <I>Wed Feb 26 04:38:59 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003079.html">[Twisted-Python] how to get those pretty tracebacks
</A></li>
        <LI>Next message: <A HREF="003081.html">[Twisted-Python] Twisted Resources / PathArgs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3080">[ date ]</a>
              <a href="thread.html#3080">[ thread ]</a>
              <a href="subject.html#3080">[ subject ]</a>
              <a href="author.html#3080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Feb 25, 2003 at 01:20:34PM -0600, Ian Bicking wrote:
|<i> &gt; flexible.  I say this beacuse I was able to do path variables 
</I>|<i> &gt; out-of-the-box (2 hours) with this tool; in Webware I've been 
</I>|<i> &gt; maintaining a patch for over a year, and this patch isn't ideal.
</I>|<i> 
</I>|<i> Can you give a pointer to that?  I'm interesting in changing how paths
</I>|<i> are parsed in Webware, but I've never felt confident 
</I>
The Twisted model has the notion of a resource.   Let's start with
a simple working example:

    from twisted.web.resource import Resource
    from twisted.internet import reactor
    from twisted.web.server import Site
    from twisted.web.static import File
    
    class DynamicRequest(Resource):
        def isLeaf(self): return true
        def render(self, req):
            req.content_type = 'text/plain'
            return &quot;uri: %s&quot; % req.uri
    
    def run():
        root = Resource()
        root.putChild(&quot;dynamic&quot;, DynamicRequest())
        root.putChild(&quot;static&quot;,File(&quot;.&quot;))
        site = Site(root)
        reactor.listenTCP(8081,site)
        reactor.run()

The interface of resource is a collection, and has a
   getChild( pathsegment )
method is called for every segment in the path.  So,
   /foo/bar/baz
is somewhat equivalent to the following:
  site.resource.getChild('foo').getChild('bar').getChild('baz')

Twisted accomplishes this magic in a &quot;private&quot; function called
getChildForRequest which iterates over each path segment.  For
the current resource it first checks a mapping to see if any
static configured children (putChild) exist, and if a static
child isn't found, it calls getChild() to find the next child
in order.   Of course, the iteration stops when isLeaf() is true.

Twisted comes with many built in Resources, including a 
really nice one for doing redirects (Redirect) and dynamically
serving up a file system (File).  It also seems to have ones
for handling virtual hosts, and sessions.   Very cool.

For more detail...

<A HREF="http://www.twistedmatrix.com/documents/TwistedDocs/current/api/">http://www.twistedmatrix.com/documents/TwistedDocs/current/api/</A>
       public/twisted.web.resource.Resource.html

On Tue, Feb 25, 2003 at 08:18:25PM +0100, Paul Jongsma wrote:
|<i> Last night I was playing with Twisted to get some insight into it,
</I>|<i> one of the things which I tried to figure out was how to do
</I>|<i> path variables.
</I>|<i>
</I>|<i> Would you mind sharing your solution with me? The docs on
</I>|<i> Twisted are sparse and I haven't been able to figure it out
</I>|<i> yet..
</I>
Assume that your path is something like...

      /key:val/another:val/&lt;servlet&gt;

At any point in the tree, you should be able to add
the following &quot;resource&quot; which will eat all items
in the path having a colon.

class PathArgs(Resource):
    def getChild(self,path,request):
        if not(hasattr(request,'pathargs')):
            request.pathargs = {}
        pair = path.split(':')
        if 2 == len(pair):
            request.pathargs[pair[0]] = pair[1]
            return self
        return Resource.getChild(self,path,request)

To try it out, replace &quot;root = Resource()&quot; with &quot;root = PathArgs()&quot;
in the code above.   Note, you should be able to use this resource
anywhere in the tree...

I'm completely astonished with the power/simplicity of this
mechanism.  Serious Kudos to the brain who discovered it... that
such a small amount of code can add a &quot;pathargs&quot; attribute to
each request in a way that is completely pluggable is just
spectacular!  Clark


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003079.html">[Twisted-Python] how to get those pretty tracebacks
</A></li>
	<LI>Next message: <A HREF="003081.html">[Twisted-Python] Twisted Resources / PathArgs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3080">[ date ]</a>
              <a href="thread.html#3080">[ thread ]</a>
              <a href="subject.html#3080">[ subject ]</a>
              <a href="author.html#3080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
