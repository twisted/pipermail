<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SMTP: Authenticating on Outbound emails only
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SMTP%3A%20Authenticating%20on%20Outbound%20emails%20only&In-Reply-To=%3CCAMcYFALvhzAq67iNCe_rJjZwvA3_VKA%3DUvaeuztY8w_4PHVi%3Dg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063609.html">
   <LINK REL="Next"  HREF="031149.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SMTP: Authenticating on Outbound emails only</H1>
    <B>Anthony Lukach</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SMTP%3A%20Authenticating%20on%20Outbound%20emails%20only&In-Reply-To=%3CCAMcYFALvhzAq67iNCe_rJjZwvA3_VKA%3DUvaeuztY8w_4PHVi%3Dg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] SMTP: Authenticating on Outbound emails only">anthonylukach at gmail.com
       </A><BR>
    <I>Sun Feb 12 09:50:32 MST 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063609.html">[Twisted-Python] SMTP: Authenticating on Outbound emails only
</A></li>
        <LI>Next message (by thread): <A HREF="031149.html">[Twisted-Python] Twisted 17.1 Release Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63620">[ date ]</a>
              <a href="thread.html#63620">[ thread ]</a>
              <a href="subject.html#63620">[ subject ]</a>
              <a href="author.html#63620">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Jean-Paul, that indeed did help!  To restate what you said, we're
now allowing both authenticated and unauthenticated (anonymous)
connections, each returning a different type of Avatar.  We then take a
look at what the connection is trying to do (handle outbound email vs.
handle inbound email) and either permit/deny the action based on what
avatar is being used.

I appreciate the help!

Anthony

On Thu, Feb 9, 2017 at 11:39 AM Jean-Paul Calderone &lt;
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:

&gt;<i> On Thu, Feb 9, 2017 at 12:29 PM, Anthony Lukach &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">anthonylukach at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> I am working on putting together an SMTP server implemented within
</I>&gt;<i> Twisted.  This will act as a conduit to my API, where there are two basic
</I>&gt;<i> flows:
</I>&gt;<i>
</I>&gt;<i> 1) A device that supports sending email can &quot;send&quot; an email through the
</I>&gt;<i> SMTP server. This is, in effect, the SMTP server handling the message as an
</I>&gt;<i> outbound request.  The device would authenticate with the server and then
</I>&gt;<i> provide it the message to be sent (which in reality will be uploaded to my
</I>&gt;<i> API).
</I>&gt;<i>
</I>&gt;<i> 2) A device can send an email to my SMTP server via their own SMTP server.
</I>&gt;<i> My server would receive the incoming message, parse its contents, and then
</I>&gt;<i> upload the data to my API. Naturally, these incoming messages would not be
</I>&gt;<i> required to authenticate with the server.
</I>&gt;<i>
</I>&gt;<i> I'm having trouble constructing the server in a way that outbound messages
</I>&gt;<i> require authentication but incoming messages do not.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> twisted.mail and cred support anonymous access.  I think that what you
</I>&gt;<i> want is to implement an avatar that can only accept messages for local
</I>&gt;<i> delivery and use that for anonymous users.  If an anonymous user tries to
</I>&gt;<i> send mail to a non-local user, they get back an error.  Either they made a
</I>&gt;<i> mistake and they should try again after authenticating or they're trying to
</I>&gt;<i> abuse the service and that's what you want.  That's case (2).  Then
</I>&gt;<i> implement the relay logic in another avatar and use that for authenticated
</I>&gt;<i> users.  That's case (1).
</I>&gt;<i>
</I>&gt;<i> This relies on the fact that the realm you supply is responsible for
</I>&gt;<i> creating avatars and the realm gets told the avatarId for which it should
</I>&gt;<i> create an avatar - and the anonymous user can be differentiated from other
</I>&gt;<i> users by the avatarId.
</I>&gt;<i>
</I>&gt;<i> Does that help?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Can anyone direct me to an example of an SMTP server that is both
</I>&gt;<i> accepting inbound and outbound emails and authenticates only on outbound
</I>&gt;<i> emails?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> As it happens, yes...
</I>&gt;<i>
</I>&gt;<i> This avatar supports local-only delivery:
</I>&gt;<i> <A HREF="https://github.com/twisted/quotient/blob/master/xquotient/mail.py#L51">https://github.com/twisted/quotient/blob/master/xquotient/mail.py#L51</A>
</I>&gt;<i> This one supports relaying:
</I>&gt;<i> <A HREF="https://github.com/twisted/quotient/blob/master/xquotient/mail.py#L528">https://github.com/twisted/quotient/blob/master/xquotient/mail.py#L528</A>
</I>&gt;<i> Here's the factory and portal setup code:
</I>&gt;<i> <A HREF="https://github.com/twisted/quotient/blob/master/xquotient/mail.py#L302">https://github.com/twisted/quotient/blob/master/xquotient/mail.py#L302</A>
</I>&gt;<i>
</I>&gt;<i> The realm is a bit spread out and involves some Axiom-specific concepts
</I>&gt;<i> that you probably don't need to know... But let me know if the above three
</I>&gt;<i> links don't make things clear.
</I>&gt;<i>
</I>&gt;<i>  Jean-Paul
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20170212/db9b92c2/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063609.html">[Twisted-Python] SMTP: Authenticating on Outbound emails only
</A></li>
	<LI>Next message (by thread): <A HREF="031149.html">[Twisted-Python] Twisted 17.1 Release Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63620">[ date ]</a>
              <a href="thread.html#63620">[ thread ]</a>
              <a href="subject.html#63620">[ subject ]</a>
              <a href="author.html#63620">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
