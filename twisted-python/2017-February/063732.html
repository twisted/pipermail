<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Test coverage requirements
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Test%20coverage%20requirements&In-Reply-To=%3CDDD3859F-7AD0-4F35-9044-786A009DD308%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063729.html">
   <LINK REL="Next"  HREF="031261.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Test coverage requirements</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Test%20coverage%20requirements&In-Reply-To=%3CDDD3859F-7AD0-4F35-9044-786A009DD308%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Test coverage requirements">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Feb 27 17:46:11 MST 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063729.html">[Twisted-Python] Test coverage requirements
</A></li>
        <LI>Next message (by thread): <A HREF="031261.html">[Twisted-Python] trac spam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63732">[ date ]</a>
              <a href="thread.html#63732">[ thread ]</a>
              <a href="subject.html#63732">[ subject ]</a>
              <a href="author.html#63732">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Feb 27, 2017, at 3:33 PM, Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Mon, Feb 27, 2017 at 6:00 PM, Tristan Seligmann &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mithrandi at mithrandi.net</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mithrandi at mithrandi.net</A>&gt;&gt; wrote:
</I>&gt;<i> On Mon, 27 Feb 2017 at 21:54 Glyph Lefkowitz &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;&gt; wrote:
</I>&gt;<i> That said, it has been improving and if it keeps improving at the rate it has been, I expect that we'd be able to put that coverage blocker back in in another 3-4 months.  Perhaps something to talk about at PyCon.
</I>&gt;<i> 
</I>&gt;<i> I think at least one problem that we're suffering from here is our fault, rather than Codecov's: the coverage of the test suite is not stable due to non-determinism in the test suite. That is, the lines executed during a test run are not the same every time due to things like ordering / timing races / etc. This means that &quot;changes&quot; to coverage may show up for a particular PReven though nothing in that PR is actually responsible.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Changes to Twisted code which are only sometimes covered by the test suite sound like they would violate a 100% coverage rule.  But I guess the experience of looking at a codecov report is so bad/confusing that it's not surprising authors/reviewers might fail to see what's going on and fix the non-deterministic.
</I>&gt;<i> 
</I>&gt;<i> Particularly for code that requires coverage measurements on multiple platforms (ie, you basically can't do it locally), it seems like it would be easier (though, to be clear, bad) to just forget about it and hope everything is covered...
</I>&gt;<i> 
</I>&gt;<i> A tool that pointed out coverage differences between multiple runs of the same version of the code would be a useful thing to start pointing out where these flaws in the Twisted test suite lie, right?  And then each area could be given deterministic test coverage instead...
</I>
While this is certainly an issue, I don't think it's the issue we're discussing here.  Unreliability of coverage is largely mitigated by the fact that the main thing we pay attention to is &quot;patch coverage&quot;, which can be seen to fluctuate from commit to commit on a branch if the new test coverage is non-deterministic (and rarely is a PR an individual commit).  This is opposed to &quot;coverage delta&quot;, which only looks at coverage before / coverage after and is indeed somewhat unpredictable due to old / bad tests.

So I can say when I've had to overrule codecov, it's almost never been because of flapping coverage lines outside of the patch under consideration (and the patches in consideration either have deterministic tests, or I ask the author to add them).

General improvements to build reliability often reduce coverage unreliability as well, so as we've been using Github more, which surfaces status visibility / mergeability to reviewers more, we've been fixing lots of little build-reliability issues and this problem continues to get smaller.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20170227/2236d86e/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063729.html">[Twisted-Python] Test coverage requirements
</A></li>
	<LI>Next message (by thread): <A HREF="031261.html">[Twisted-Python] trac spam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63732">[ date ]</a>
              <a href="thread.html#63732">[ thread ]</a>
              <a href="subject.html#63732">[ subject ]</a>
              <a href="author.html#63732">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
