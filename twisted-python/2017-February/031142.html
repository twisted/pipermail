<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Hanging SFTP client operations on server	disconnection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Hanging%20SFTP%20client%20operations%20on%20server%0A%09disconnection&In-Reply-To=%3CCAFycZ9c%3DkN0YEjNTJs5N8ZVa-GU%3D52ZN5H5qTzE29gL%3DoaFGVw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063632.html">
   <LINK REL="Next"  HREF="063633.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Hanging SFTP client operations on server	disconnection</H1>
    <B>Adi Roiban</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Hanging%20SFTP%20client%20operations%20on%20server%0A%09disconnection&In-Reply-To=%3CCAFycZ9c%3DkN0YEjNTJs5N8ZVa-GU%3D52ZN5H5qTzE29gL%3DoaFGVw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Hanging SFTP client operations on server	disconnection">adi at roiban.ro
       </A><BR>
    <I>Thu Feb  2 03:43:12 MST 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063632.html">[Twisted-Python] conch.ssh.SSHFactory publicKeys and getPublicKeys
</A></li>
        <LI>Next message (by thread): <A HREF="063633.html">[Twisted-Python] Hanging SFTP client operations on server disconnection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31142">[ date ]</a>
              <a href="thread.html#31142">[ thread ]</a>
              <a href="subject.html#31142">[ subject ]</a>
              <a href="author.html#31142">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

t.conch.ssh.filetransfer.FileTransferClient._sendRequest keeps a
mapping with active SFTP requests in self.openRequests

The self.openRequests is only updated when the server is responding
for that request.

They are not cleared/cancelled on connection lost.

In the case in which the client send a request in the exact same time
in which the server closes the connect , the client will send the
request as there is no way to know that the server is gone... but
since the server is gone it will not reply to the response... and the
deferred is never called.

To solve this issue, I went for cancelling the open requests when the
connection is close.

I assume that this is also an issue with bad behaved servers which
will just ignore a request... so instead of a simple deferred, there
is the need to use a timeout deferred.

Is this a bug?
I am wondering if I am doing something wrong and these type of errors
should be handled in a different way.

Thanks!

PS: There is a stray release notes fragment in conch
<A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/8791.feature">https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/8791.feature</A>

-- 
Adi Roiban

</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063632.html">[Twisted-Python] conch.ssh.SSHFactory publicKeys and getPublicKeys
</A></li>
	<LI>Next message (by thread): <A HREF="063633.html">[Twisted-Python] Hanging SFTP client operations on server disconnection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31142">[ date ]</a>
              <a href="thread.html#31142">[ thread ]</a>
              <a href="subject.html#31142">[ subject ]</a>
              <a href="author.html#31142">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
