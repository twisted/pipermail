From ivan at llaisdy.com  Fri Jun  1 09:29:16 2007
From: ivan at llaisdy.com (Ivan Uemlianin)
Date: Fri, 01 Jun 2007 14:29:16 +0100
Subject: [Twisted-Python] Divmod Sine will now install
In-Reply-To: <4656A37F.1050700@llaisdy.com>
References: <20070520151513.30678.599672052.divmod.quotient.2801@ohm>
	<4656A37F.1050700@llaisdy.com>
Message-ID: <46601F2C.4090401@llaisdy.com>

Dear All

On divmod-dev, Jean-Paul Calderone advised me to use the latest tagged 
releases from http://divmod.org/trac/browser/tags/releases/ (i.e., svn 
co http://divmod.org:81/svn/Divmod/tags/releases/etc).  I have now been 
able to install Sine and Mantissa. nb: I had to install Sine first - 
Mantissa would not install before Sine.

Still heading otwards a look at sip as a basis for mrcp;)

Best wishes

Ivan

Ivan Uemlianin wrote:
> Jean-Paul Calderone wrote:
>> The Divmod Sine SIP implementation has numerous bug fixes not present in
>> twisted.protocols.sip.  Once #2444 is resolved, the protocol support in
>> Twisted will be as good as the protocol support in Divmod Sine.  What 
>> Sine
>> will still offer above the code in Twisted is the higher level APIs 
>> which
>> make call setup easy enough so that novel applications can focus on 
>> their
>> novelty instead of on SIP details.
> I have attempted and failed to install Divmod Sine.  I posted the 
> message below to divmod-dev a few days ago but have yet to receive a 
> reply (it's a quiet list).  I am re-posting the message here in good 
> faith and in the belief that it is not entirely off-topic or plain 
> stupid.
> I'd really like to start writing an MRCP server, and if it's good 
> enough to contribute it to Twisted, so any help would be much 
> appreciated.
>
> Best wishes
>
> Ivan
>
>
> Dear All
>
> I am installing the Divmod frameworks, with the intention of
> experimenting with Sine and Shtoom.  I have installed everything except
> Sine with no problems (using python setup.py install).
>
> With Sine I get the following error:
>
> File "/usr/lib/python2.4/site-packages/xmantissa/plugins/sineoff.py",
> line 3, in ?
>   from xmantissa import website, offering, provisioning
> exceptions.ImportError: cannot import name provisioning
>
> I have tried this with both the stable (0.6.1) and svn versions of 
> Mantissa.
>
> I have grepped through all of Divmod's frameworks (inc. Shtoom) and not
> found provisioning except in import statements.  The only class used
> from provisioning is BenefactorFactory.
>
> Please could someone let me know either:
> - Where I can get a version of xmantissa with provisioning and
> BenefactorFactory, or
> - Whether and how I can comment out the offending lines from Sine.
>
> Thanks
>
> Best wishes
>
> Ivan
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From ivan at llaisdy.com  Fri Jun  1 09:38:47 2007
From: ivan at llaisdy.com (Ivan Uemlianin)
Date: Fri, 01 Jun 2007 14:38:47 +0100
Subject: [Twisted-Python] Re: Divmod Sine Broken?
In-Reply-To: <1180521159.7009.5.camel@antoine-ubuntu>
References: <20070520151513.30678.599672052.divmod.quotient.2801@ohm>	<4656A37F.1050700@llaisdy.com>
	<1180521159.7009.5.camel@antoine-ubuntu>
Message-ID: <46602167.90103@llaisdy.com>

Antoine Pitrou wrote:
> After playing around with the SIP support in Twisted, finding a few bugs
> whose correction (*) was refused on the grounds that the author had
> forked his own code as a separate project, we at Wengo have written our
> own SIP stack on top of a patched twisted.protocols.sip.
>
> (*) http://twistedmatrix.com/trac/ticket/2220
Thank for the lead.  I'll  check out http://www.openwengo.com/

Ivan






From alex.lang at mail.mcgill.ca  Sat Jun  2 11:11:41 2007
From: alex.lang at mail.mcgill.ca (Alex Lang)
Date: Sat, 2 Jun 2007 11:11:41 -0400
Subject: [Twisted-Python] Distributed Trial Test Runner
Message-ID: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>

Hello,

For my Summer of Code project, I am implementing a distributed trial
test runner (http://code.google.com/soc/psf/appinfo.html?csaid=770D0FCD95DAFF9E).
The following is basically what needs to be done to get distributed
trial working, given a master machine and slaves:

1. Transfer the relevant code to all slave machines. (with conch)
2. Do test loading at least on the master (possibly on each of the
slaves as well)
3. Find a good test-to-unique-id mapping (probably using FQPNs +
something else for test_suite-generated tests?)
4. Implement a visitor which will run through the tests on the master
and split them among the slaves.
5. Figure out how to get SSH command shells open to the slaves and get
individual tests to run
6. Gather results from slaves and give them to a reporter.

I think that is all. Any thoughts? Comments?

Thanks,
Alex



From ldanielburr at mac.com  Sat Jun  2 11:27:10 2007
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Sat, 02 Jun 2007 10:27:10 -0500
Subject: [Twisted-Python] Distributed Trial Test Runner
In-Reply-To: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>
References: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>
Message-ID: <op.ttavvkg93oj628@l-daniel-burrs-powerbook-g4-17.local>

Hi Alex,

On Sat, 02 Jun 2007 10:11:41 -0500, Alex Lang <alex.lang at mail.mcgill.ca>  
wrote:

> Hello,
>
> For my Summer of Code project, I am implementing a distributed trial
> test runner  
> (http://code.google.com/soc/psf/appinfo.html?csaid=770D0FCD95DAFF9E).
> The following is basically what needs to be done to get distributed
> trial working, given a master machine and slaves:
>
> 1. Transfer the relevant code to all slave machines. (with conch)
> 2. Do test loading at least on the master (possibly on each of the
> slaves as well)
> 3. Find a good test-to-unique-id mapping (probably using FQPNs +
> something else for test_suite-generated tests?)
> 4. Implement a visitor which will run through the tests on the master
> and split them among the slaves.
> 5. Figure out how to get SSH command shells open to the slaves and get
> individual tests to run
> 6. Gather results from slaves and give them to a reporter.
>
> I think that is all. Any thoughts? Comments?
>

My only thought is that this sounds a lot like BuildBot, or at least
so similar as to represent some prior art for you to consider.

Daniel



From andrew-twisted at puzzling.org  Sat Jun  2 13:54:15 2007
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Sun, 3 Jun 2007 03:54:15 +1000
Subject: [Twisted-Python] Distributed Trial Test Runner
In-Reply-To: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>
References: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>
Message-ID: <20070602175415.GE594@steerpike.home.puzzling.org>

Alex Lang wrote:
> Hello,
> 
> For my Summer of Code project, I am implementing a distributed trial
> test runner 
> (http://code.google.com/soc/psf/appinfo.html?csaid=770D0FCD95DAFF9E).
> The following is basically what needs to be done to get distributed
> trial working, given a master machine and slaves:
> 
> 1. Transfer the relevant code to all slave machines. (with conch)

This part is a bit short on detail.  "relevant code" isn't possible to determine
automatically, in general.  You never know what dependencies code might have.
Probably this user needs to be given some control over this, e.g. a setting for
the directory to copy (or rsync?).

I guess the trick will be that once a slave is set up to make sure that giving
it the current code for testing with is quick (copying the whole source for a
large project every time would suck, especially if you want to use a slave
that's on a relatively slow link).  rsync is definitely tempting here!

Another possible way to transfer the changes is as a branch URL, revision ID,
and diff.  i.e. the output of "svn info | grep ^URL:", "svn info | grep
^Revision:" and "svn diff" for SVN checkouts (but keep in mind not all projects
use SVN, so if you go this route you'd want to make part extensible).

> 3. Find a good test-to-unique-id mapping (probably using FQPNs +
> something else for test_suite-generated tests?)

The scheme discussed on #twisted along these lines sounded ok to me.

> I think that is all. Any thoughts? Comments?

Make sure that trial options that don't work when distributed give graceful
errors, rather than tracebacks or wrong results.  Options like "--debug" and
"--coverage" spring to mind, but there may be others.  Similarly, you should
also make sure that "--until-failure" does something sensible.  Basically,
look at each of the options described by "trial --help" and figure out what
distributed trial should do with it.  This is a relatively small thing, but this
sort of polish makes a big difference to the end user experience.

I also agree with L. Daniel Burr that there could be some overlap with Buildbot
in this project.  I guess you probably weren't thinking of running a master
daemon perpetually for slaves to connect to, but maybe that's not a crazy idea.
Also Buildbot has already deals with reporting results (in a minimal way),
updating source trees according to instructions from a master, and running
commands on those trees.  It also deals with managing slaves.

Because running tests requires a much more elaborately and carefully configured
environment than compiling a pre-processed C file, thinking about disttrial as
being more like buildbot than distcc might make good sense.

-Andrew.




From exarkun at twistedmatrix.com  Sun Jun  3 09:57:38 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 03 Jun 2007 13:57:38 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1180879058.02.648463468@twistedmatrix.com

Bug summary
______________________
Summary for 2007-05-27 through 2007-06-03
Bugs opened: 9    Bugs closed: 0  Total open bugs: 969 (+9)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       +7  |Highest:  +2          |Conch:  +2             
|Enhancement:  +3  |High:     +2          |Core:   +4             
                   |Normal:   +6          |Mail:   +2             
                                          |Web:    +2             


New / Reopened Bugs
______________________
                    ===== Highest =====
[#2682] twisted.conch.ssh.userauth is poorly tested. (opened by z3p)
    defect          conch      http://twistedmatrix.com/trac/ticket/2682

[#2685] factor secure random implementation (opened by antoine)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2685

                    ===== High =====
[#1105] IMAP Client does not seem to handle unsolicited server responses (opened by cablehead)
    defect          mail       http://twistedmatrix.com/trac/ticket/1105

                    ===== Normal =====
[#2680] abdapi ConnectionPool doesn't allow for synchronous close (opened by jml)
    defect          core       http://twistedmatrix.com/trac/ticket/2680

[#2681] twisted.web.distrib non-functional (opened by exarkun)
    defect          web        http://twistedmatrix.com/trac/ticket/2681

[#2683] twisted/web/http.py has self._header instead of self.__header (opened by jvtm)
    defect          web        http://twistedmatrix.com/trac/ticket/2683

[#2684] t.p.t.ThreadPool.dispatch should be deprecated (opened by indigo)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2684

[#2686] AMP implementation: elisp (opened by glyph)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2686

[#2687] Conch blows up when processes end due to signals (opened by jml)
    defect          conch      http://twistedmatrix.com/trac/ticket/2687



Closed Bugs
______________________





From abierbaum at gmail.com  Mon Jun  4 19:01:00 2007
From: abierbaum at gmail.com (Allen Bierbaum)
Date: Mon, 4 Jun 2007 18:01:00 -0500
Subject: [Twisted-Python] Taking a look at pending deferToThread actions
Message-ID: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>

I am using deferToThread in my application to put a number of web
service queries into the background and then respond to them when they
are complete.  This is all working very well, but once in a while I
seem to overload the web service with queries and I would like to
track this down by checking to see how many queries are in flight and
how many are still waiting to be processed.

One I have put an action into the background using deferToThread, is
there a way to check to see how many functions are currently
processing and similarly how many functions are waiting to be
processed?

Thanks,
Allen



From abierbaum at gmail.com  Tue Jun  5 12:02:16 2007
From: abierbaum at gmail.com (Allen Bierbaum)
Date: Tue, 5 Jun 2007 11:02:16 -0500
Subject: [Twisted-Python] Re: Taking a look at pending deferToThread actions
In-Reply-To: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
Message-ID: <bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>

Sorry for answering my own question, but I found a way to get this
information and I thought it may be helpful for other users.

threadpool = reactor.threadpool
num_threads = threadpool.workers
q_size  = threadpool.q.qsize()

num_threads is a good approximation of how many functions are
currently active, and q_size is the number still pending.

Now for another question:

- Has anyone extended threadpool to allow code to remove queued
functions from the pending queue?

I need this capability so I can cull off pending queries that are not
still needed.

-Allen

On 6/4/07, Allen Bierbaum <abierbaum at gmail.com> wrote:
> I am using deferToThread in my application to put a number of web
> service queries into the background and then respond to them when they
> are complete.  This is all working very well, but once in a while I
> seem to overload the web service with queries and I would like to
> track this down by checking to see how many queries are in flight and
> how many are still waiting to be processed.
>
> One I have put an action into the background using deferToThread, is
> there a way to check to see how many functions are currently
> processing and similarly how many functions are waiting to be
> processed?
>
> Thanks,
> Allen
>



From Sven-Erik.Tiberg at ltu.se  Tue Jun  5 17:07:46 2007
From: Sven-Erik.Tiberg at ltu.se (Sven-Erik Tiberg)
Date: Tue, 5 Jun 2007 23:07:46 +0200
Subject: [Twisted-Python] A longshot, UML and twisted.
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
Message-ID: <668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>

Hi.
 
A longshot, anyone modelled a system with twisted components in uml using f.ex. a stateschart.
 
/BG
Sven-Erik Tiberg
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/ms-tnef
Size: 3065 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070605/86b969a4/attachment.bin 

From maarten at treewalker.org  Tue Jun  5 17:41:05 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Tue, 5 Jun 2007 23:41:05 +0200
Subject: [Twisted-Python] A longshot, UML and twisted.
In-Reply-To: <668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
	<668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
Message-ID: <200706052341.11402.maarten@treewalker.org>

On Tuesday 05 June 2007, Sven-Erik Tiberg wrote:

> A longshot, anyone modelled a system with twisted components in uml using
> f.ex. a stateschart.

PyReverse can analyze Python code and produce UML. I never used it myself, but 
PyLint is written by the same people and that's a very useful tool. However, 
PyReverse is not actively maintained, while PyLint is.

http://www.logilab.org/2560

Probably PyReverse will only analyze the static structure, so you'll get class 
diagrams. For analyzing dynamic behaviour, PyPy might be able to gather a lot 
of useful data, but as far as I know there is not yet a tool that makes nice 
graphs of it. Also, I'm not sure how useful PyPy will be if your program uses 
Python features that are not in the RPython subset.

http://codespeak.net/pypy/

Bye,
		Maarten
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070605/33e383e0/attachment.pgp 

From glyph at divmod.com  Tue Jun  5 17:54:30 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 05 Jun 2007 21:54:30 -0000
Subject: [Twisted-Python] A longshot, UML and twisted.
In-Reply-To: <668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
	<668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
Message-ID: <20070605215430.24950.294053860.divmod.xquotient.190@joule.divmod.com>

On 09:07 pm, sven-erik.tiberg at ltu.se wrote:
>Hi.

Hi Sven,
>A longshot, anyone modelled a system with twisted components in uml 
>using f.ex. a stateschart.

Not that I'm aware of; it would be a massive task, with no obvious 
benefits.

Why do you want such a thing?  Perhaps we can suggest an alternative 
means of extracting the information you want without UML diagrams.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070605/9c186697/attachment.htm 

From adelagon at gmail.com  Tue Jun  5 21:15:10 2007
From: adelagon at gmail.com (Alvin Delagon)
Date: Tue, 5 Jun 2007 21:15:10 -0400
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous Connections
Message-ID: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>

First of all, I want to send my gratitude to the people who developed
Twisted. ^_^

We have this XMPP server that is implemented using twisted (using the epoll
reactor). I was tasked to know how many simultaneous connections it can
handle. So I wrote an XMPP benchmark tool using twisted that spawns multiple
clients. When we used the benchmark tool on two PCs (each spawning 20,000
XMPP clients), the number of successful connect/authorize varies between
37,000~39,000. Adding more clients we get the, "Connection Closed cleanly"
error on the XMPP server. Spawning two XMPP servers didn't help to increase
the simultaneous connections.

Did we hit the ceiling? Or is there anyway we can increase this further? We
already configured the ulimit parameters and tinkered with some kernel
configurations.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070605/fcf10864/attachment.htm 

From itamar at itamarst.org  Wed Jun  6 01:20:54 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 06 Jun 2007 01:20:54 -0400
Subject: [Twisted-Python] Re: Taking a look at pending deferToThread
	actions
In-Reply-To: <bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
Message-ID: <1181107254.10081.1.camel@localhost.localdomain>

On Tue, 2007-06-05 at 11:02 -0500, Allen Bierbaum wrote:

> - Has anyone extended threadpool to allow code to remove queued
> functions from the pending queue?

How about just having the functions themselves check to see if they
really should run their intended task? (Being careful about
thread-safety, of course).

Why are you using threads, btw?




From nico at tekNico.net  Wed Jun  6 02:23:08 2007
From: nico at tekNico.net (Nicola Larosa)
Date: Wed, 06 Jun 2007 08:23:08 +0200
Subject: [Twisted-Python] Re: A longshot, UML and twisted.
In-Reply-To: <668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
	<668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
Message-ID: <466652CC.20802@tekNico.net>

Sven-Erik Tiberg wrote:
> A longshot, anyone modelled a system with twisted components in uml
> using f.ex. a stateschart.

In addition to PyReverse, you may try these other two:

PyNSource
http://www.atug.com/andypatterns/pynsource.htm

snakefood
http://furius.ca/snakefood/

and let us know the results. :-)


-- 
Nicola Larosa - http://www.tekNico.net/

Jerub:    someone motivate me to write a real http client.
lifeless: Jerub: write a real http client
spiv:     Jerub: write a real http client
oubiwann: Jerub: write a real client and 1000 virgins
          are yours for the taking
dash:     oubiwann: all of #gentoo?!
 -- doc/fun/Twisted.Quotes, May 2006





From itamar at itamarst.org  Wed Jun  6 10:01:33 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 06 Jun 2007 10:01:33 -0400
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous
	Connections
In-Reply-To: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
References: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
Message-ID: <1181138493.10081.6.camel@localhost.localdomain>

On Tue, 2007-06-05 at 21:15 -0400, Alvin Delagon wrote:

> When we used the benchmark tool on two PCs (each spawning 20,000 XMPP
> clients), the number of successful connect/authorize varies between
> 37,000~39,000.

> Did we hit the ceiling? Or is there anyway we can increase this
> further? We already configured the ulimit parameters and tinkered with
> some kernel configurations.

There's no limits in Twisted itself that would cause that, so it's
likely in the kernel. For example -

You may have the free TCP port limit range, since you are doing so many
connections from only two IP addresses. This is not a limit that would
affect you during production, of course; you could see if you can get
higher numbers of connections with more client machines.

-- 
Itamar Shtull-Trauring
http://itamarst.org





From konrads.smelkovs at gmail.com  Wed Jun  6 11:31:37 2007
From: konrads.smelkovs at gmail.com (Konrads Smelkovs)
Date: Wed, 06 Jun 2007 18:31:37 +0300
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous
	Connections
In-Reply-To: <1181138493.10081.6.camel@localhost.localdomain>
References: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
	<1181138493.10081.6.camel@localhost.localdomain>
Message-ID: <1181143897.12287.19.camel@localhost.localdomain>

Hello,
To chip in my two cents - try testing with more machines, as Itamar had
suggested earlier. It is very easy to max out the limits of the testing
machines before the server is maxed out. I think there is a kernel
parameter that specifies low and high ports of outgoing connections.
Try with more machines.

On Wed, 2007-06-06 at 10:01 -0400, Itamar Shtull-Trauring wrote:
> On Tue, 2007-06-05 at 21:15 -0400, Alvin Delagon wrote:
> 
> > When we used the benchmark tool on two PCs (each spawning 20,000 XMPP
> > clients), the number of successful connect/authorize varies between
> > 37,000~39,000.
> 
> > Did we hit the ceiling? Or is there anyway we can increase this
> > further? We already configured the ulimit parameters and tinkered with
> > some kernel configurations.
> 
> There's no limits in Twisted itself that would cause that, so it's
> likely in the kernel. For example -
> 
> You may have the free TCP port limit range, since you are doing so many
> connections from only two IP addresses. This is not a limit that would
> affect you during production, of course; you could see if you can get
> higher numbers of connections with more client machines.
> 




From twisted at ralphm.ik.nu  Wed Jun  6 11:57:21 2007
From: twisted at ralphm.ik.nu (Ralph Meijer)
Date: Wed, 06 Jun 2007 17:57:21 +0200
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous
	Connections
In-Reply-To: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
References: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
Message-ID: <1181145441.8949.6.camel@zwerf>

On Tue, 2007-06-05 at 21:15 -0400, Alvin Delagon wrote:
> First of all, I want to send my gratitude to the people who developed
> Twisted. ^_^
> 
> We have this XMPP server that is implemented using twisted [..]

Oh, that is very interesting as I am working on this in my sandbox for a
while now. Could you expand on that and is the code available?

-- 
Groetjes,

ralphm




From Sven-Erik.Tiberg at ltu.se  Wed Jun  6 13:40:21 2007
From: Sven-Erik.Tiberg at ltu.se (Sven-Erik Tiberg)
Date: Wed, 6 Jun 2007 19:40:21 +0200
Subject: [Twisted-Python] A longshot, UML and twisted.
In-Reply-To: <20070605215430.24950.294053860.divmod.xquotient.190@joule.divmod.com>
Message-ID: <668D1B8AD729C94DB91D17EC19B8BB910565C01F@EMMA.personal.adp.ltu.se>

Hi 
 
Would like to visuliaze the signal ( state ) flow between a Interactive
VR-World ( using X3D ) and a Mathworks / Simulink model using twisted
and UDP.
It's the realtime system that we are planning to make for development
and training of vehicle drivers and process plant controllers.
Have tried to draw by hand and figures but would prefere to use a more
formal way to describe it.
Been there before made the software for a motionplatform for offroad and
marine vehicles back in -79 and had to modify the JSP model with Real
time functions, but it was worth it. Had to add symbol for priority,
sceeduling, process start / termination and semaphores. 
PS. downloaded RhapsodyModeler today from telelogic ( FOC) beacuse it
had UML-extensions for RT compared to MS Visio. 
Con: Lacking code handling like reverse engineering, so it's onky to
visulaize a event driven system like the one described above.
PS, it still my sparetime project but there are some thoughts about
making a course out of it for design-, HMI-, system developer and
mashine enginners.
Wouldn't that be fun. 
 
/BG
Sven-Erik
 
 
________________________________

From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of
glyph at divmod.com
Sent: den 5 juni 2007 23:55
To: Twisted general discussion
Subject: Re: [Twisted-Python] A longshot, UML and twisted.


On 09:07 pm, sven-erik.tiberg at ltu.se wrote:
>Hi.

Hi Sven,

>A longshot, anyone modelled a system with twisted components in uml
using f.ex. a stateschart.

Not that I'm aware of; it would be a massive task, with no obvious
benefits.

Why do you want such a thing?  Perhaps we can suggest an alternative
means of extracting the information you want without UML diagrams.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070606/2a5cb4f1/attachment.htm 

From Sven-Erik.Tiberg at ltu.se  Wed Jun  6 13:45:15 2007
From: Sven-Erik.Tiberg at ltu.se (Sven-Erik Tiberg)
Date: Wed, 6 Jun 2007 19:45:15 +0200
Subject: [Twisted-Python] Re: A longshot, UML and twisted.
In-Reply-To: <466652CC.20802@tekNico.net>
Message-ID: <668D1B8AD729C94DB91D17EC19B8BB910565C020@EMMA.personal.adp.ltu.se>

Thanks, 
Looks usefull.
I will put them on my project site http://tellus.arb.ltu.se/moodle >
WBSP_Public, and try them during the summer.
 
/BG
Sven-Erik

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Nicola
Larosa
Sent: den 6 juni 2007 08:23
To: twisted-python at twistedmatrix.com
Subject: [Twisted-Python] Re: A longshot, UML and twisted.

Sven-Erik Tiberg wrote:
> A longshot, anyone modelled a system with twisted components in uml 
> using f.ex. a stateschart.

In addition to PyReverse, you may try these other two:

PyNSource
http://www.atug.com/andypatterns/pynsource.htm

snakefood
http://furius.ca/snakefood/

and let us know the results. :-)


--
Nicola Larosa - http://www.tekNico.net/

Jerub:    someone motivate me to write a real http client.
lifeless: Jerub: write a real http client
spiv:     Jerub: write a real http client
oubiwann: Jerub: write a real client and 1000 virgins
          are yours for the taking
dash:     oubiwann: all of #gentoo?!
 -- doc/fun/Twisted.Quotes, May 2006



_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From brucecoram at clara.co.uk  Wed Jun  6 15:42:42 2007
From: brucecoram at clara.co.uk (Bruce Coram)
Date: Wed, 06 Jun 2007 20:42:42 +0100
Subject: [Twisted-Python] udp
Message-ID: <46670E32.1010002@clara.co.uk>

I know the answer to this will be soo simple but is it necessary to use 
makeConnection when using udp.  I understood that udp is a 
connectionless protocol.  I have used TCP and factories to pass data 
between a server and clients and I wanted to use udp to send 
'management' data on an ad hoc basis.  Here is the code for a very 
simple client but I'm clearly missing the point.

'from twisted.internet.protocol import DatagramProtocol

from twisted.internet import reactor


host = '127.0.0.1'

class testcomms(DatagramProtocol):

    def datagramReceived(self, data, (host, port)):
        print 'Received ', data, 'from ', host
   
    def makeconnection(self, transport):
        self.transport.write('this is a test', (host, 8000))
   

t = testcomms()
t.makeconnect(host, 8000)
reactor.listenUDP(8000, testcomms())
reactor.run()'

Thanks in anticipation

Bruce Coram






From python at blackslens.com  Wed Jun  6 17:54:01 2007
From: python at blackslens.com (Black)
Date: Wed, 6 Jun 2007 17:54:01 -0400
Subject: [Twisted-Python] udp
In-Reply-To: <46670E32.1010002@clara.co.uk>
References: <46670E32.1010002@clara.co.uk>
Message-ID: <49D7C9CA-2D93-499C-BADA-AB39E0F8F304@blackslens.com>

You shouldn't need the makeconnect stuff. Try this:

from twisted.internet.protocol import DatagramProtocol
from twisted.internet import reactor


class testcomms(DatagramProtocol):

    def datagramReceived(self, data, (host, port)):
        print 'Received ', data, 'from ', host
        self.transport.write('this is a test', (host, port))

reactor.listenUDP(8000, testcomms())
reactor.run()



-Black


On Jun 6, 2007, at 3:42 PM, Bruce Coram wrote:

> I know the answer to this will be soo simple but is it necessary to  
> use makeConnection when using udp.  I understood that udp is a  
> connectionless protocol.  I have used TCP and factories to pass  
> data between a server and clients and I wanted to use udp to send  
> 'management' data on an ad hoc basis.  Here is the code for a very  
> simple client but I'm clearly missing the point.
>
> 'from twisted.internet.protocol import DatagramProtocol
>
> from twisted.internet import reactor
>
>
> host = '127.0.0.1'
>
> class testcomms(DatagramProtocol):
>
>    def datagramReceived(self, data, (host, port)):
>        print 'Received ', data, 'from ', host
>      def makeconnection(self, transport):
>        self.transport.write('this is a test', (host, 8000))
>
> t = testcomms()
> t.makeconnect(host, 8000)
> reactor.listenUDP(8000, testcomms())
> reactor.run()'
>
> Thanks in anticipation
>
> Bruce Coram
>
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From adelagon at gmail.com  Wed Jun  6 20:44:05 2007
From: adelagon at gmail.com (Alvin Delagon)
Date: Wed, 6 Jun 2007 20:44:05 -0400
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous
	Connections
In-Reply-To: <1181145441.8949.6.camel@zwerf>
References: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
	<1181145441.8949.6.camel@zwerf>
Message-ID: <7a01f6c00706061744w6a91c768g44efd9c8fd34212e@mail.gmail.com>

Thanks for the suggestions. I'll test the benchmark script on four PC's and
update this thread for the results.

@ Ralph
Sorry, I don't know if I have the right to provide the source for the
twisted XMPP server since it's not written by me.


On 6/6/07, Ralph Meijer <twisted at ralphm.ik.nu> wrote:
>
> On Tue, 2007-06-05 at 21:15 -0400, Alvin Delagon wrote:
> > First of all, I want to send my gratitude to the people who developed
> > Twisted. ^_^
> >
> > We have this XMPP server that is implemented using twisted [..]
>
> Oh, that is very interesting as I am working on this in my sandbox for a
> while now. Could you expand on that and is the code available?
>
> --
> Groetjes,
>
> ralphm
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070606/6dce1a91/attachment.htm 

From alex.lang at mail.mcgill.ca  Wed Jun  6 23:59:41 2007
From: alex.lang at mail.mcgill.ca (Alex Lang)
Date: Wed, 6 Jun 2007 23:59:41 -0400
Subject: [Twisted-Python] Problem with trial using the reactor
Message-ID: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>

Hello,

Here is a problem regarding the distributed trial test runner. The
slave instances receive data from the master, telling them which tests
to run. This requires use of the reactor on the slave-side.
Unfortunately, when the testCase does the cleanup of the reactor, it
cleans up everything including the trial slave.

Any ideas on what should be done about this?

Thank you,
Alex



From jml at mumak.net  Thu Jun  7 00:58:28 2007
From: jml at mumak.net (Jonathan Lange)
Date: Thu, 7 Jun 2007 14:58:28 +1000
Subject: [Twisted-Python] Problem with trial using the reactor
In-Reply-To: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
References: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
Message-ID: <d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>

On 6/7/07, Alex Lang <alex.lang at mail.mcgill.ca> wrote:
> Hello,
>
> Here is a problem regarding the distributed trial test runner. The
> slave instances receive data from the master, telling them which tests
> to run. This requires use of the reactor on the slave-side.
> Unfortunately, when the testCase does the cleanup of the reactor, it
> cleans up everything including the trial slave.
>
> Any ideas on what should be done about this?
>

This is a roundabout way of answering your question, but it's helpful
for me to write it down, and I think it will inform the discussion.

In terms of Trial's requirements:
* We want to write and run tests that perform asynchronous operations,
which essentially means tests that return Deferreds.
* We want to be able to run these tests in non-Trial test runners.
* We want tests to be isolated as much as possible.
* We want to be able to use Trial to test the reactor itself.

Some awkward facts:
* There is exactly one reactor per Twisted process. This reactor
cannot be cleanly restarted in a cross-platform way.
* The current Twisted test suite (i.e. what is loaded when you do
'trial twisted') does not play nicely with the reactor. Changing this
will take a significant amount of work.[1]

So, in response to all of these things:
* Trial presents a blocking interface for running any given test:
TestCase.run(). This allows Deferred-returning tests to be used in
non-Twisted test runners.
* By design, Trial totally obliterates the reactor in each call to
TestCase.run(). This helps ensure test isolation
 * Trial's design operates on the assumption that the caller of
TestCase.run() will not be doing anything with the reactor.

However, all of this presents problems:
* The vast bulk of Twisted's code base cannot be used to implement a
Trial runner. This is what Alex is discovering now.
* Trial's cleanup code is buggy and fragile. Changing anything is
likely to break hundreds of tests.
* Tests that use twisted.trial.unittest.TestCase run in a
highly-specialized, somewhat unrealistic environment.

Various solutions have been proposed:
* Using a customized reactor wrapper in trial that tracks resources
created by tests and cleans up only those resources.
* Making reactors restartable.
* Allowing for multiple running reactors. i.e. A reactor that could be
started within another running reactor.

I believe that only the third of these solutions would actually help
solve Alex's problem. However, as I understand it, the solution would
require extensive API changes across most of Twisted, as things which
once assumed a global reactor must now take 'reactor' as a parameter.

I'd rather not offer any recommendations in this email. It's difficult
enough figuring out what the problem is and what the options are.

jml

[1] For example, Trial does two calls to 'reactor.iterate()' in its
cleanup. If these calls are removed, tests fail and there are a
significant number of cleanup errors. I discussed some of the issues
here in an email last year.



From ben at artins.org  Thu Jun  7 01:23:24 2007
From: ben at artins.org (Ben Artin)
Date: Thu, 7 Jun 2007 01:23:24 -0400
Subject: [Twisted-Python] Problem with trial using the reactor
In-Reply-To: <d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>
References: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
	<d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>
Message-ID: <F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>

I just spent some time tearing my hair out getting trial and  
ThreadedSelectReactor to cooperate.

Another possible solution to the trial/reactor impedance mismatch you  
commented on would be for trial spawn off a process for each test. By  
definition, that process would get its own reactor and could not  
taint any other tests. The test rig process could happily use  
Deferred semantics, while presenting a synchronous interface to trial.

This would also be easier to distribute IMO, because if IPC is  
already involved in communication between trial runner and tests,  
making that IPC go to another machine is easier.

I realize the cost of spawning processes, but I honestly think that  
it's easier to change unittest to fork, run a test on a separate  
reactor, and IPC the test results back to the parent, than it is to  
take one of the other three approaches, because of the API changes  
they would require. (Not that said API changes would be bad, but I  
don't think that the distributed runner should have to wait for them.)

Ben

--

<http://artins.org/ben>

"Computers! All they ever think of is hex!"





From jml at mumak.net  Thu Jun  7 02:43:06 2007
From: jml at mumak.net (Jonathan Lange)
Date: Thu, 7 Jun 2007 16:43:06 +1000
Subject: [Twisted-Python] Problem with trial using the reactor
In-Reply-To: <F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>
References: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
	<d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>
	<F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>
Message-ID: <d06a5cd30706062343h18a9f85cu431085b3ed61136c@mail.gmail.com>

On 6/7/07, Ben Artin <ben at artins.org> wrote:
> I just spent some time tearing my hair out getting trial and
> ThreadedSelectReactor to cooperate.
>

Sorry. If it doesn't have a buildslave, I can't support it. And IIRC,
we have decided not to support TSR.

> Another possible solution to the trial/reactor impedance mismatch you
> commented on would be for trial spawn off a process for each test. By
> definition, that process would get its own reactor and could not
> taint any other tests. The test rig process could happily use
> Deferred semantics, while presenting a synchronous interface to trial.
>

Right. I should have included this in my list, as it is both valid and
has been suggested before.

Thanks,
jml



From konrads.smelkovs at gmail.com  Thu Jun  7 04:21:11 2007
From: konrads.smelkovs at gmail.com (Konrads Smelkovs)
Date: Thu, 07 Jun 2007 11:21:11 +0300
Subject: [Twisted-Python] Problem with trial using the reactor
In-Reply-To: <F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>
References: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
	<d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>
	<F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>
Message-ID: <1181204471.5809.3.camel@localhost.localdomain>

On Thu, 2007-06-07 at 01:23 -0400, Ben Artin wrote:

> Another possible solution to the trial/reactor impedance mismatch you  
> commented on would be for trial spawn off a process for each test. By  
> definition, that process would get its own reactor and could not  
> taint any other tests. The test rig process could happily use  
> Deferred semantics, while presenting a synchronous interface to trial.
> 
This is a I-think-so-too post. Letting the OS clean up things is a sane
approach. I also see a few more benefits, such as running tests in
parallel on SMP machines. Also, I don't think that the overhead of
forking/spawning is big enough to pay attention - at worst, 50ms per
test and 10 more megabytes of memory. As the saying goes, "We all have
pentiums now..."




From alexey.maksimov at gmail.com  Thu Jun  7 08:23:25 2007
From: alexey.maksimov at gmail.com (Alexey Maksimov)
Date: Thu, 7 Jun 2007 16:23:25 +0400
Subject: [Twisted-Python] Please help me with process spawning
Message-ID: <20070607162325.32a4a0d7@lesha-laptop>

Hi,

Please help me with the following:

I want to write a simple app that should remotely control
long running shell process. I have a C++ program that does some network
capturing I need. I want to create a simple web interface that can
start and stop this program via shell on linux.

I already wrote a web part of this but failed to spawn my process.
I think my problem is that I want to use myserver.tac and don't want
directly call reactor.run() as shown in documentation.
How can I spawn my long-running process without using reactor.run()?

Thanks in advance,
Alexey.



From Sven-Erik.Tiberg at ltu.se  Thu Jun  7 09:14:05 2007
From: Sven-Erik.Tiberg at ltu.se (Sven-Erik Tiberg)
Date: Thu, 7 Jun 2007 15:14:05 +0200
Subject: [Twisted-Python] Re: A longshot, UML and twisted.
In-Reply-To: <668D1B8AD729C94DB91D17EC19B8BB910565C020@EMMA.personal.adp.ltu.se>
Message-ID: <668D1B8AD729C94DB91D17EC19B8BB910565C024@EMMA.personal.adp.ltu.se>

 
An example of UML StateChart:
http://tellus.arb.ltu.se/distr_3d/Distr_3D.jpg .

Original MagicDraw project report:
http://tellus.arb.ltu.se/distr_3d/Distr_3D.html will add descriptions
and docs.

This is about what I needed,,, so far.

/Sven-Erik Tiberg




From christian.simms at gmail.com  Thu Jun  7 09:53:13 2007
From: christian.simms at gmail.com (christian simms)
Date: Thu, 7 Jun 2007 09:53:13 -0400
Subject: [Twisted-Python] Please help me with process spawning
In-Reply-To: <20070607162325.32a4a0d7@lesha-laptop>
References: <20070607162325.32a4a0d7@lesha-laptop>
Message-ID: <cd8fa6f90706070653g7d73c29bqa6dbe43497142193@mail.gmail.com>

On 6/7/07, Alexey Maksimov <alexey.maksimov at gmail.com> wrote:
> Hi,
>
> Please help me with the following:
>
> I want to write a simple app that should remotely control
> long running shell process. I have a C++ program that does some network
> capturing I need. I want to create a simple web interface that can
> start and stop this program via shell on linux.
>
> I already wrote a web part of this but failed to spawn my process.
> I think my problem is that I want to use myserver.tac and don't want
> directly call reactor.run() as shown in documentation.
> How can I spawn my long-running process without using reactor.run()?
>
> Thanks in advance,
> Alexey.
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

I'm not sure I understand your problem, but here's what I think you should
do:

Write a twisted application (maybe this is your myserver.tac?) which is a
simple web server.  An easy way to write a twisted web app is with
nevow.  Since this is a twisted application, assuming your myserver.tac file
defines an object named "application", just run it with:

   twistd -noy myserver.tac

The twistd program will automatically call reactor.run() for you, you
normally do not need to call it explicitly.

Now, to launch another process from twisted there are several API's you can
use.  This page<http://twistedmatrix.com/projects/core/documentation/howto/process.html>in
the docs explains the most general way, where you have complete
control
over the inputs and outputs to the spawned program.  There's also a
simplified API for launching programs, but it just grabs your process's
output:  twisted.internet.utils.getProcessOutput().

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070607/4fa34cce/attachment.htm 

From mgeisler at mgeisler.net  Thu Jun  7 11:18:12 2007
From: mgeisler at mgeisler.net (Martin Geisler)
Date: Thu, 07 Jun 2007 17:18:12 +0200
Subject: [Twisted-Python] Deterministic "program counter" for asynchronious
	events
Message-ID: <87y7iv4wuj.fsf@hbox.dyndns.org>

Hello,

I'm writing a runtime system for doing secure multiparty computation,
and here I have used deferreds with great success.

All players run the same program (but with different input) and each
player communicate with other players as needed to share intermediate
results. These results need to be associated with the right operation
and for this I use a program counter.

This minimal example shows my solution without network traffic:


import sys
From twisted.internet.defer import Deferred, DeferredList, gatherResults

pc = (0,)

def inc_pc(pc):
    pc = pc[:-1] + (pc[-1]+1,)
    return pc
 
def sub_pc(pc):
    pc = pc + (1,)
    return pc

def finish_mul(arg, pc):
    print "finish_mul(%s): pc = %s" % (arg, pc)
    return arg

def mul(a, b):
    global pc
    pc = inc_pc(pc)

    results = gatherResults([a,b])
    results.addCallback(finish_mul, sub_pc(pc))
    return results

x = Deferred() # Declare variables
y = Deferred()
z = Deferred()
w = Deferred()

mul(x,y) # Schedule multiplications
mul(z,w)

x.callback(2) # The value for x arrives over the network
z.callback(4)

if len(sys.argv) > 1:
    y.callback(3) # y gets a value, enabling mul(x,y) to proceed.
    w.callback(5)
else:
    w.callback(5) # z and w are ready and mul(z,w) can proceed.
    y.callback(3)


Here mul() schedules calls to finish_mul(), and it is this call which
I would like to have a deterministic labelling of. I have solved it by
having a "two-dimensional" program counter: the calls to mul() get
labels (1,) and (2,). Their calls to the sub-operation finish_mul()
get labels (1,1) and (2,1) respectively.


This works, invoking the example with and without a command line
argument gives the same labels for finish_mul(). But it is cumbersome
to drag this program counter around all the code, and (what is worse)
it is easy to forget to increment it and to create sub program
counters at the right times.

So have anybody done something similar where you wanted to start a
bunch of operations which might start sub-operations themselves and
where everything needed to be deterministically labelled?

-- 
Martin Geisler  ---  <mgeisler at mgeisler.net>  ---  http://mgeisler.net

Read, write, create Exif data in PHP with PEL:       http://pel.sf.net
Take control of your webserver with PHP Shell:  http://phpshell.sf.net
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 188 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070607/a934f9a3/attachment.pgp 

From elicriffield at gmail.com  Thu Jun  7 17:14:38 2007
From: elicriffield at gmail.com (Eli Criffield)
Date: Thu, 7 Jun 2007 16:14:38 -0500
Subject: [Twisted-Python] where to getPeerCertificate()
Message-ID: <18e3f33d0706071414x4196f67ch73c80afe8bb28b78@mail.gmail.com>

I'd like to check the CN of incoming certs for a xmlrpc server. I
can't seen to find where to get the clients cert information.

In the protocol.Protocol (in my case the http.HTTPCHannel) in the
connectionMade() i put in a
print self.transport.getPeerCertificate()
but it returns a None.
print self.transport.socket.get_peer_certificate()
Does the same. I'm sure the client is connecting with a cert because
its verifying it fine.

I also have no idea where to check on client program to get the cert
info of the server I'm connecting to.

Eli Criffield

--example--
#!/usr/bin/env python

from twisted.web import xmlrpc, server, http, resource
from twisted.internet import reactor, ssl
from twisted.python.log import startLogging
from sys import stdout
import OpenSSL

class Example(xmlrpc.XMLRPC):
    """An example object to be published."""
    def xmlrpc_add(self, a, b):
        """Return sum of arguments."""
        return a + b

class myHTTPChannel(http.HTTPChannel):
    def connectionMade(self):
        print "connection from %s"%(self.transport.getHost().host,)
        # HERE i get no cert
        print self.transport.socket.get_peer_certificate()
        print self.transport.getPeerCertificate()
        self.setTimeout(self.timeOut)

class mySite(server.Site):
       protocol = myHTTPChannel

def makeSSLContext(myKey,trustedCA):
    '''Returns an ssl Context Object
   @param myKey a pem formated key and certifcate with for my current host
          the other end of this connection must have the cert from the CA
          that signed this key
   @param iTrustCA a pem formated certificat from a CA you trust
          you will only allow connections from clients signed by this CA
          and you will only allow connections to a server signed by this CA
    '''
    fd = open(myKey,'r')
    theCert = ssl.PrivateCertificate.loadPEM(fd.read())
    fd.close()
    fd = open(trustedCA,'r')
    theCA = ssl.Certificate.loadPEM(fd.read())
    fd.close()
    ctx = theCert.options(theCA)
    # The SSL protocol to use, one of SSLv23_METHOD, SSLv2_METHOD,
    # SSLv3_METHOD, TLSv1_METHOD. Defaults to TLSv1_METHOD.
    ctx.method = ssl.SSL.TLSv1_METHOD

    # If True, verify certificates received from the peer and fail
    # the handshake if verification fails. Otherwise, allow anonymous
    # sessions and sessions with certificates which fail validation.
    ctx.verify = True

    # Depth in certificate chain down to which to verify.
    ctx.verifyDepth = 1

    # If True, do not allow anonymous sessions.
    ctx.requireCertification = True

    # If True, do not re-verify the certificate on session resumption.
    ctx.verifyOnce = True

    # If True, generate a new key whenever ephemeral DH parameters are used
    # to prevent small subgroup attacks.
    ctx.enableSingleUseKeys = True

    # If True, set a session ID on each context. This allows a shortened
    # handshake to be used when a known client reconnects.
    ctx.enableSessions = True

    # If True, enable various non-spec protocol fixes for broken
    # SSL implementations.
    ctx.fixBrokenPeers = False

    return ctx

if __name__ == '__main__':
    r = Example()
    ctx = makeSSLContext('server.pem','cacert.pem')
    reactor.listenSSL(7080,mySite(r),ctx)
    startLogging(stdout)
    reactor.run()



From abierbaum at gmail.com  Thu Jun  7 22:25:30 2007
From: abierbaum at gmail.com (Allen Bierbaum)
Date: Thu, 7 Jun 2007 21:25:30 -0500
Subject: [Twisted-Python] Re: Taking a look at pending deferToThread
	actions
In-Reply-To: <1181107254.10081.1.camel@localhost.localdomain>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
	<1181107254.10081.1.camel@localhost.localdomain>
Message-ID: <bea9869d0706071925l23f39e9bha519962fb60659f6@mail.gmail.com>

On 6/6/07, Itamar Shtull-Trauring <itamar at itamarst.org> wrote:
> On Tue, 2007-06-05 at 11:02 -0500, Allen Bierbaum wrote:
>
> > - Has anyone extended threadpool to allow code to remove queued
> > functions from the pending queue?
>
> How about just having the functions themselves check to see if they
> really should run their intended task? (Being careful about
> thread-safety, of course).

Thanks for the idea.  I will give it a try.

>
> Why are you using threads, btw?

I am using threads because the calls I am making are into a
non-blocking library.  I may see about rewriting it in the future to
be more twisted-friendly, but for now I have to live with it.

-Allen

>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From sipickles at hotmail.com  Fri Jun  8 09:33:57 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Fri, 08 Jun 2007 14:33:57 +0100
Subject: [Twisted-Python] Have I installed twisted correctly?
Message-ID: <BAY114-F3188B14522018CC0A7E908BE250@phx.gbl>


Hi,

I have just been recommended twisted from the python mailing lists. I 
thought I'd installed it, but I get an error with the first line!

from twisted.internet import reactor

error:
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
types

Can an expert help me?

Simon


http://www.simonpickles.com  --- http://www.squirtualreality.com

_________________________________________________________________
Play your part in making history - Email Britain! 
http://www.emailbritain.co.uk/




From exarkun at divmod.com  Fri Jun  8 10:04:18 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 8 Jun 2007 10:04:18 -0400
Subject: [Twisted-Python] Have I installed twisted correctly?
In-Reply-To: <BAY114-F3188B14522018CC0A7E908BE250@phx.gbl>
Message-ID: <20070608140418.30678.1553467141.divmod.quotient.12679@ohm>


On Fri, 08 Jun 2007 14:33:57 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>
>Hi,
>
>I have just been recommended twisted from the python mailing lists. I 
>thought I'd installed it, but I get an error with the first line!
>
>from twisted.internet import reactor
>
>error:
>TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
>types
>
>Can an expert help me?
>

Can you provide more context?  The complete traceback would be useful, for
example.

Jean-Paul



From radix at twistedmatrix.com  Fri Jun  8 10:05:00 2007
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 8 Jun 2007 10:05:00 -0400
Subject: [Twisted-Python] Have I installed twisted correctly?
In-Reply-To: <BAY114-F3188B14522018CC0A7E908BE250@phx.gbl>
References: <BAY114-F3188B14522018CC0A7E908BE250@phx.gbl>
Message-ID: <60ed19d40706080705i27ea2c6dode35884e19bf6053@mail.gmail.com>

On 6/8/07, Simon Pickles <sipickles at hotmail.com> wrote:
>
> Hi,
>
> I have just been recommended twisted from the python mailing lists. I
> thought I'd installed it, but I get an error with the first line!
>
> from twisted.internet import reactor
>
> error:
> TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and
> types

Is that the entire traceback? If there's more, can you please post it?


-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From sipickles at hotmail.com  Fri Jun  8 11:15:16 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Fri, 08 Jun 2007 16:15:16 +0100
Subject: [Twisted-Python] Have I installed twisted correctly - part II
Message-ID: <BAY114-F69F8E3F052F679636C45EBE250@phx.gbl>

Sorry, how lazy of me!

*** Python 2.5.1 (r251:54863, Apr 18 2007, 08:51:08) [MSC v.1310 32 bit 
(Intel)] on win32. ***
>>>

>>>
Traceback (most recent call last):
  File "<string>", line 74, in run_nodebug
  File "F:\_Dev\twisted server 20070608\twistedServer.py", line 5, in 
<module>
    from twisted.internet import reactor
  File "C:\Python25\lib\site-packages\twisted\__init__.py", line 19, in 
<module>
    from zope.interface import Interface
  File "C:\Python25\lib\site-packages\zope\interface\__init__.py", line 58, 
in <module>
    _wire()
  File "C:\Python25\lib\site-packages\zope\interface\interface.py", line 
936, in _wire
    classImplements(Attribute, IAttribute)
  File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
464, in classImplements
    spec = implementedBy(cls)
  File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
330, in implementedByFallback
    if isinstance(spec, Implements):
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
types

>>>


btw, the line

from twisted.internet import reactor

is the ONLY line in the module currently!

Thanks

Simon

_________________________________________________________________
Could you be the guest MSN Movies presenter? Click Here to Audition 
http://www.lightscameraaudition.co.uk




From general at eepatents.com  Fri Jun  8 12:26:24 2007
From: general at eepatents.com (Ed Suominen)
Date: Fri, 08 Jun 2007 09:26:24 -0700
Subject: [Twisted-Python] Re: Taking a look at pending deferToThread
	actions
In-Reply-To: <bea9869d0706071925l23f39e9bha519962fb60659f6@mail.gmail.com>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>	<1181107254.10081.1.camel@localhost.localdomain>
	<bea9869d0706071925l23f39e9bha519962fb60659f6@mail.gmail.com>
Message-ID: <46698330.9010006@eepatents.com>

Allen Bierbaum wrote:
>> > - Has anyone extended threadpool to allow code to remove queued
>> > functions from the pending queue?
>>
>> How about just having the functions themselves check to see if they
>> really should run their intended task? (Being careful about
>> thread-safety, of course).
> 
> Thanks for the idea.  I will give it a try.

You also might want to take a look at my taskqueue sub-package in
Twisted-Goodies, http://foss.eepatents.com/Twisted-Goodies. One feature
that might come in handy is the IWorker implementors' ability to resign
when they feel that they are no longer able to run jobs. Any jobs that
the resigning worker has queued up individually at that point are
returned to the main queue for dispatching to other workers, current or
future.

The whole thing revolves around a priority queue, which might be useful
to you, too. Also, a ProcessWorker implementation of IWorker is pending
that spawns a separate Python interpreter to run tasks. If the
ProcessWorker hangs, you'll be able to just kill it and move right
along, without hanging your main Python interpreter.

> I am using threads because the calls I am making are into a
> non-blocking library.  I may see about rewriting it in the future to
> be more twisted-friendly, but for now I have to live with it.

That was my original motivation for writing taskqueue, with its
ThreadWorker implementation of IWorker. It's used in sAsync, which makes
a wonderful but totally synchronous database API (SQLAlchemy) play very
nicely (IMHO) with Twisted.

Debian packages are in the works for both, by the way.

Best regards,
Ed Suominen




From exarkun at divmod.com  Fri Jun  8 12:50:05 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 8 Jun 2007 12:50:05 -0400
Subject: [Twisted-Python] Have I installed twisted correctly - part II
In-Reply-To: <BAY114-F69F8E3F052F679636C45EBE250@phx.gbl>
Message-ID: <20070608165005.30678.147983492.divmod.quotient.12723@ohm>

On Fri, 08 Jun 2007 16:15:16 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Sorry, how lazy of me!
>
>*** Python 2.5.1 (r251:54863, Apr 18 2007, 08:51:08) [MSC v.1310 32 bit 
>(Intel)] on win32. ***
>>>>
>
>>>>
>Traceback (most recent call last):
>  File "<string>", line 74, in run_nodebug
>  File "F:\_Dev\twisted server 20070608\twistedServer.py", line 5, in 
><module>
>    from twisted.internet import reactor
>  File "C:\Python25\lib\site-packages\twisted\__init__.py", line 19, in 
><module>
>    from zope.interface import Interface
>  File "C:\Python25\lib\site-packages\zope\interface\__init__.py", line 58, 
>in <module>
>    _wire()
>  File "C:\Python25\lib\site-packages\zope\interface\interface.py", line 936, 
>in _wire
>    classImplements(Attribute, IAttribute)
>  File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
>464, in classImplements
>    spec = implementedBy(cls)
>  File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
>330, in implementedByFallback
>    if isinstance(spec, Implements):
>TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
>types
>>>>
>
>
>btw, the line
>
>from twisted.internet import reactor
>
>is the ONLY line in the module currently!
>
>Thanks

It looks like your version of ZopeInterface doesn't want to play nicely
with your version of Twisted.  Try getting the latest release of each.

Jean-Paul



From sipickles at hotmail.com  Fri Jun  8 17:49:47 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Fri, 08 Jun 2007 22:49:47 +0100
Subject: [Twisted-Python] Have I installed twisted correctly - part II
Message-ID: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>

"It looks like your version of ZopeInterface doesn't want to play nicely
with your version of Twisted.  Try getting the latest release of each."
Jean-Paul

Well, I just installed python 2.5 and latest twisted... I don't even know 
what zope is! I downloaded zope but that doesn't look like it will help 
me......

Any more ideas?

Here's my error again:
Traceback (most recent call last):
File "<string>", line 74, in run_nodebug
File "F:\_Dev\twisted server 20070608\twistedServer.py", line 5, in <module>
   from twisted.internet import reactor
File "C:\Python25\lib\site-packages\twisted\__init__.py", line 19, in 
<module>
   from zope.interface import Interface
File "C:\Python25\lib\site-packages\zope\interface\__init__.py", line 58, in 
<module>
   _wire()
File "C:\Python25\lib\site-packages\zope\interface\interface.py", line 936, 
in _wire
   classImplements(Attribute, IAttribute)
File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
464, in classImplements
   spec = implementedBy(cls)
File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
330, in implementedByFallback
   if isinstance(spec, Implements):
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
types
>>>



Si

_________________________________________________________________
Txt a lot? Get Messenger FREE on your mobile.  
https://livemessenger.mobile.uk.msn.com/




From glyph at divmod.com  Fri Jun  8 17:54:31 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Fri, 08 Jun 2007 21:54:31 -0000
Subject: [Twisted-Python] Have I installed twisted correctly - part II
In-Reply-To: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>
References: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>
Message-ID: <20070608215431.5916.44606212.divmod.xquotient.1@joule.divmod.com>

On 09:49 pm, sipickles at hotmail.com wrote:
>"It looks like your version of ZopeInterface doesn't want to play 
>nicely
>with your version of Twisted.  Try getting the latest release of each."
>Jean-Paul
>
>Well, I just installed python 2.5 and latest twisted... I don't even 
>know what zope is! I downloaded zope but that doesn't look like it will 
>help me......
>
>Any more ideas?

This doesn't look like a conflict between ZopeInterface (not Zope) and 
Twisted, per se, it looks like ZopeInterface itself has some problem on 
your machine.

Does the script "from zope.interface import Interface" work, by itself?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070608/e0ef581e/attachment.htm 

From ldanielburr at mac.com  Fri Jun  8 18:05:42 2007
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Fri, 08 Jun 2007 17:05:42 -0500
Subject: [Twisted-Python] Have I installed twisted correctly - part II
In-Reply-To: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>
References: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>
Message-ID: <op.ttmibsuh3oj628@l-daniel-burrs-powerbook-g4-17.local>

On Fri, 08 Jun 2007 16:49:47 -0500, Simon Pickles <sipickles at hotmail.com>  
wrote:

> "It looks like your version of ZopeInterface doesn't want to play nicely
> with your version of Twisted.  Try getting the latest release of each."
> Jean-Paul
>
> Well, I just installed python 2.5 and latest twisted... I don't even  
> know what zope is! I downloaded zope but that doesn't look like it will  
> help me......
>
> Any more ideas?
>

Yes, you *have* to download and install the correct version of
zope.interface.  Seriously, there's no other solution; twisted
needs zope.interface.

http://cheeseshop.python.org/pypi/zope.interface/3.3.0.1

The link above should get you a working version of zope.interface.

Hope this helps,

L. Daniel Burr






From monch1962 at gmail.com  Fri Jun  8 22:46:23 2007
From: monch1962 at gmail.com (David Mitchell)
Date: Sat, 9 Jun 2007 12:46:23 +1000
Subject: [Twisted-Python] Using Twisted with MQ
Message-ID: <f6508a860706081946p72765e2n363280ed4011de14@mail.gmail.com>

Hello all,

I've got what I think is a potential application for Twisted, but I'm
having trouble figuring out whether Twisted is going to be the best
path or not.  I've worked through the Twisted Finger tutorial and read
through the "Ball of snakes" O'Reilly book, but I'm not sure I've got
my head around Twisted sufficiently.

I have to simulate a server that reads messages off IBM's MQ queues,
and posts responses back to different MQ queues.  I've used both pymqi
and Python/COM (on Windows only) to perform this sort of task in the
past, but now I need something that's going to be able to respond to
incoming MQ messages at a very high rate.

I suspect I'm going to have to use reactor.callInThread to spawn off
threads within Twisted in order to handle IO with the MQ queues, as
I'm not aware of any event-based interface to MQ and therefore any
reads/writes from queues are potentially going to block for a while.

Is Twisted suited for this sort of application?  Better yet, is anyone
aware of info I can access regarding this sort of application with
Twisted? - Google hasn't been much help...

Thanks in advance

Dave Mitchell



From arkanes at gmail.com  Sat Jun  9 04:20:06 2007
From: arkanes at gmail.com (Chris Mellon)
Date: Sat, 9 Jun 2007 03:20:06 -0500
Subject: [Twisted-Python] Using Twisted with MQ
In-Reply-To: <f6508a860706081946p72765e2n363280ed4011de14@mail.gmail.com>
References: <f6508a860706081946p72765e2n363280ed4011de14@mail.gmail.com>
Message-ID: <4866bea60706090120n5777fa42wc29e2748238f082c@mail.gmail.com>

On 6/8/07, David Mitchell <monch1962 at gmail.com> wrote:
> Hello all,
>
> I've got what I think is a potential application for Twisted, but I'm
> having trouble figuring out whether Twisted is going to be the best
> path or not.  I've worked through the Twisted Finger tutorial and read
> through the "Ball of snakes" O'Reilly book, but I'm not sure I've got
> my head around Twisted sufficiently.
>
> I have to simulate a server that reads messages off IBM's MQ queues,
> and posts responses back to different MQ queues.  I've used both pymqi
> and Python/COM (on Windows only) to perform this sort of task in the
> past, but now I need something that's going to be able to respond to
> incoming MQ messages at a very high rate.
>
> I suspect I'm going to have to use reactor.callInThread to spawn off
> threads within Twisted in order to handle IO with the MQ queues, as
> I'm not aware of any event-based interface to MQ and therefore any
> reads/writes from queues are potentially going to block for a while.
>
> Is Twisted suited for this sort of application?  Better yet, is anyone
> aware of info I can access regarding this sort of application with
> Twisted? - Google hasn't been much help...
>
> Thanks in advance
>
> Dave Mitchell
>

I haven't written any real code that does this, but I was just
investigating it for feasability myself a couple days ago. I wrote a
thread that looked basically like this:
(pseudocode, as I don't have any of the code in front of me)

while True:
    try:
        res = mq.get() #blocking call, with a fairly long timeout - 5-10 seconds
        reactor.callFromThead(someCallbackFunc, res)
    except Timeout: #pymqi will translate the timeout to an exception
        pass
    if self.exit.is_set(): #threading.Event to check for termination.
        self.terminate()


This just spins happily along, and dispatches processing into the
Twisted event loop. I didn't really test it for performance or
latency. Used reactor.callInThread to dispatch the writes.



From monch1962 at gmail.com  Sat Jun  9 05:53:30 2007
From: monch1962 at gmail.com (David Mitchell)
Date: Sat, 9 Jun 2007 19:53:30 +1000
Subject: [Twisted-Python] Using Twisted with MQ
In-Reply-To: <4866bea60706090120n5777fa42wc29e2748238f082c@mail.gmail.com>
References: <f6508a860706081946p72765e2n363280ed4011de14@mail.gmail.com>
	<4866bea60706090120n5777fa42wc29e2748238f082c@mail.gmail.com>
Message-ID: <f6508a860706090253h58540996x87f5ca6ab78f27af@mail.gmail.com>

Thanks Chris,

That's pretty much along the lines of what I was planning to do - I'm
just wondering how much load I'll be able to throw at it.

Oh well, guess there's one very good way to find out ;->

Regards

Dave Mitchell

On 09/06/07, Chris Mellon <arkanes at gmail.com> wrote:
> On 6/8/07, David Mitchell <monch1962 at gmail.com> wrote:
> > Hello all,
> >
> > I've got what I think is a potential application for Twisted, but I'm
> > having trouble figuring out whether Twisted is going to be the best
> > path or not.  I've worked through the Twisted Finger tutorial and read
> > through the "Ball of snakes" O'Reilly book, but I'm not sure I've got
> > my head around Twisted sufficiently.
> >
> > I have to simulate a server that reads messages off IBM's MQ queues,
> > and posts responses back to different MQ queues.  I've used both pymqi
> > and Python/COM (on Windows only) to perform this sort of task in the
> > past, but now I need something that's going to be able to respond to
> > incoming MQ messages at a very high rate.
> >
> > I suspect I'm going to have to use reactor.callInThread to spawn off
> > threads within Twisted in order to handle IO with the MQ queues, as
> > I'm not aware of any event-based interface to MQ and therefore any
> > reads/writes from queues are potentially going to block for a while.
> >
> > Is Twisted suited for this sort of application?  Better yet, is anyone
> > aware of info I can access regarding this sort of application with
> > Twisted? - Google hasn't been much help...
> >
> > Thanks in advance
> >
> > Dave Mitchell
> >
>
> I haven't written any real code that does this, but I was just
> investigating it for feasability myself a couple days ago. I wrote a
> thread that looked basically like this:
> (pseudocode, as I don't have any of the code in front of me)
>
> while True:
>     try:
>         res = mq.get() #blocking call, with a fairly long timeout - 5-10 seconds
>         reactor.callFromThead(someCallbackFunc, res)
>     except Timeout: #pymqi will translate the timeout to an exception
>         pass
>     if self.exit.is_set(): #threading.Event to check for termination.
>         self.terminate()
>
>
> This just spins happily along, and dispatches processing into the
> Twisted event loop. I didn't really test it for performance or
> latency. Used reactor.callInThread to dispatch the writes.
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From sipickles at hotmail.com  Sat Jun  9 11:09:29 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sat, 09 Jun 2007 16:09:29 +0100
Subject: [Twisted-Python] Asynchronicity
Message-ID: <BAY114-F32856C75840A54E7165C5EBE240@phx.gbl>

Hi,

I have managed to get a simple server going. It seems to accept multiple
connections correctly.

I am a little puzzled as to how to achieve an asynchonous application
using twisted. Twisted itself seems asynchronous, but my code is blocked
by the call:

reactor.run()

Is there anyway I can return from the reactor to run other code, like
GUI stuff, or other processing?

My code:

import GUI
from zope.interface import Interface
from twisted.internet import reactor
from twisted.protocols import basic
from twisted.internet.protocol import Protocol, Factory

class CNetwork(basic.LineReceiver):
    def connectionMade(self):
        GUI.Print("New Client: %s" % self.transport.getPeer().host)
        self.send = lambda x: self.transport.write(x+"\r\n")
##        if self.factory.server_data:
##            self.send("\r\n".join(self.factory.server_data))
##        else:
##            self.send("You are logged in")
        GUI.Print("Entering loop for client %s" %
self.transport.getPeer().host)

    def connectionLost(self, reason):
        GUI.Print( "%s has closed the connection" %
self.transport.getPeer().host )

    def dataReceived(self, data):
        data = data.strip()
        if not data:
            self.transport.loseConnection()
            return
        GUI.Print("%s says %r" % (self.transport.getPeer().host,data))
        self.transport.write("You said: %r\r\n" % data )
       ## self.factory.server_data.append(data + "~~")
        GUI.Print("Ready to receive more data")

class CNetworkFactory(Protocol):
    factory = Factory()
    factory.protocol = CNetwork
    def __init__(self, max_clients):
        self.max_clients = max_clients
        self.connected_clients = 0
        self.server_data = []

    def doStart(self):
        GUI.Print("Factory started -- server is waiting for a connection")
    def doStop(self):
        GUI.Print("Factory stopped -- server is now closed")

    def buildProtocol(self, addr):
        GUI.Print("Connection attempt....")
        return CNetwork()

def main():

    reactor.listenTCP(14500, CNetworkFactory(max_clients = 2))
    reactor.run()

if __name__ == "__main__":
    main()

##DO SOMETHING ELSE HERE!


###################################

Thanks for your help

_________________________________________________________________
The next generation of Hotmail is here! http://www.newhotmail.co.uk




From exarkun at divmod.com  Sat Jun  9 11:33:44 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sat, 9 Jun 2007 11:33:44 -0400
Subject: [Twisted-Python] Asynchronicity
In-Reply-To: <BAY114-F32856C75840A54E7165C5EBE240@phx.gbl>
Message-ID: <20070609153344.30678.910956207.divmod.quotient.13138@ohm>

On Sat, 09 Jun 2007 16:09:29 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Hi,
>
>I have managed to get a simple server going. It seems to accept multiple
>connections correctly.
>
>I am a little puzzled as to how to achieve an asynchonous application
>using twisted. Twisted itself seems asynchronous, but my code is blocked
>by the call:
>
>reactor.run()
>

Quite so.  reactor.run enters the Twisted mainloop and does not return
until the mainloop is stopped (via reactor.stop).

>Is there anyway I can return from the reactor to run other code, like
>GUI stuff, or other processing?

No, but you can call into your other code from Twisted event handlers or
you can write a custom reactor which integrates an existing mainloop with
Twisted's.  As far as GUIs go, Twisted already includes reactors which
integrate glib, gtk, gtk2, various kinds of Windows loops, wxPython, and
a few others.

Precisely how you integrate two mainloops depends on various details
about the loops in question.  Which GUI library are you trying to
integrate with?

Jean-Paul



From sipickles at hotmail.com  Sat Jun  9 15:51:39 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sat, 09 Jun 2007 20:51:39 +0100
Subject: [Twisted-Python] Asynchronicity
Message-ID: <BAY114-F26CCA93C2ED01482B58091BE240@phx.gbl>

Integrating into a GUI is just one example. In my case, I am using
Tkinter on win32. The GUI will be switched off when the server is
running, its simply a debug controller...

I'm more interested in how a twisted server manages to perform any other
logic. For a game server, a fair amount of time needs to be devoted to
object and memory management, AI, database access etc

My first server, in C++ could do this simply, with a winSock thread
listening and storing incoming network comms in a message queue. Easily
integrated into a game loop.

I was tempted to move to python due to the ease of modification.

So... with twisted, how can I manage to spend any time doing AI, for
instance?

I thought twisted.interface.reactor.iterate() might be my answer. API
docs say about iterate:

"Run the main loop's I/O polling function for a period of time. This is
most useful in applications where the UI is being drawn "as fast as
possible", such as games."

Unfortunately, the next sentence seems a little contradictory....

" The reactor must have been started (via the run() method) prior to any
invocations of this method. It must also be stopped manually after the
last call to this method (via the stop() method). "

Now, I am only a beginner at twisted, but it looks to me if I called
run(), I won't have a chance to call iterate() cos twisted will have
gone into its mainloop and stolen all control!

Am i making sense?

Regards

Simon


Jean-Paul Calderone wrote:
>On Sat, 09 Jun 2007 16:09:29 +0100, Simon Pickles <sipickles at hotmail.com> 
>wrote:
>>Hi,
>>
>>I have managed to get a simple server going. It seems to accept multiple
>>connections correctly.
>>
>>I am a little puzzled as to how to achieve an asynchonous application
>>using twisted. Twisted itself seems asynchronous, but my code is blocked
>>by the call:
>>
>>reactor.run()
>>
>
>Quite so.  reactor.run enters the Twisted mainloop and does not return
>until the mainloop is stopped (via reactor.stop).
>
>>Is there anyway I can return from the reactor to run other code, like
>>GUI stuff, or other processing?
>
>No, but you can call into your other code from Twisted event handlers or
>you can write a custom reactor which integrates an existing mainloop with
>Twisted's.  As far as GUIs go, Twisted already includes reactors which
>integrate glib, gtk, gtk2, various kinds of Windows loops, wxPython, and
>a few others.
>
>Precisely how you integrate two mainloops depends on various details
>about the loops in question.  Which GUI library are you trying to
>integrate with?
>
>Jean-Paul
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>

_________________________________________________________________
The next generation of Hotmail is here! http://www.newhotmail.co.uk




From exarkun at divmod.com  Sat Jun  9 16:07:13 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sat, 9 Jun 2007 16:07:13 -0400
Subject: [Twisted-Python] Asynchronicity
In-Reply-To: <BAY114-F26CCA93C2ED01482B58091BE240@phx.gbl>
Message-ID: <20070609200713.30678.1561594262.divmod.quotient.13234@ohm>

On Sat, 09 Jun 2007 20:51:39 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Integrating into a GUI is just one example. In my case, I am using
>Tkinter on win32. The GUI will be switched off when the server is
>running, its simply a debug controller...

There's Tkinter support. ;)

>
>I'm more interested in how a twisted server manages to perform any other
>logic. For a game server, a fair amount of time needs to be devoted to
>object and memory management, AI, database access etc

Sure (though I'm going to disregard "object and memory management" ;).  If
you have code for an NPC in the game, there are two possibilities for when
it runs:

It might run in response to events in the game world (possibly timing
events).  In this case, you simply implement the appropriate event handlers
and it will have a chance to run at the appropriate times.

It might need to run "as much as possible" - for example, to incrementally
refine some behavior, to the limit imposed by available system resources.
In this case, you might want to use a separate process and do IPC, or a
thread might be appropriate, or you could implement something based on
cooperative threading (for example, by implementing the logic as an iterator
and using twisted.internet.task.Cooperator to run it as frequently as there
is CPU time to do so).

> [snip]
>
>I thought twisted.interface.reactor.iterate() might be my answer. API
>docs say about iterate:

iterate is most likely a dead end, I wouldn't spend much time there.

Jean-Paul



From sipickles at hotmail.com  Sat Jun  9 16:07:12 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sat, 09 Jun 2007 21:07:12 +0100
Subject: [Twisted-Python] Asynchronicity
Message-ID: <BAY114-F407266C61E3A9E9BA9915FBE240@phx.gbl>

Wow! it works... iterate does indeed return. Must've had a small mistake
before!

I am amazed I solved my own problem for a change!

Thanks for the advice, Jean

Simon Pickles wrote:
>Integrating into a GUI is just one example. In my case, I am using
>Tkinter on win32. The GUI will be switched off when the server is
>running, its simply a debug controller...
>
>I'm more interested in how a twisted server manages to perform any other
>logic. For a game server, a fair amount of time needs to be devoted to
>object and memory management, AI, database access etc
>
>My first server, in C++ could do this simply, with a winSock thread
>listening and storing incoming network comms in a message queue. Easily
>integrated into a game loop.
>
>I was tempted to move to python due to the ease of modification.
>
>So... with twisted, how can I manage to spend any time doing AI, for
>instance?
>
>I thought twisted.interface.reactor.iterate() might be my answer. API
>docs say about iterate:
>
>"Run the main loop's I/O polling function for a period of time. This is
>most useful in applications where the UI is being drawn "as fast as
>possible", such as games."
>
>Unfortunately, the next sentence seems a little contradictory....
>
>" The reactor must have been started (via the run() method) prior to any
>invocations of this method. It must also be stopped manually after the
>last call to this method (via the stop() method). "
>
>Now, I am only a beginner at twisted, but it looks to me if I called
>run(), I won't have a chance to call iterate() cos twisted will have
>gone into its mainloop and stolen all control!
>
>Am i making sense?
>
>Regards
>
>Simon
>
>
>Jean-Paul Calderone wrote:
>>On Sat, 09 Jun 2007 16:09:29 +0100, Simon Pickles <sipickles at hotmail.com> 
>>wrote:
>>>Hi,
>>>
>>>I have managed to get a simple server going. It seems to accept multiple
>>>connections correctly.
>>>
>>>I am a little puzzled as to how to achieve an asynchonous application
>>>using twisted. Twisted itself seems asynchronous, but my code is blocked
>>>by the call:
>>>
>>>reactor.run()
>>>
>>
>>Quite so.  reactor.run enters the Twisted mainloop and does not return
>>until the mainloop is stopped (via reactor.stop).
>>
>>>Is there anyway I can return from the reactor to run other code, like
>>>GUI stuff, or other processing?
>>
>>No, but you can call into your other code from Twisted event handlers or
>>you can write a custom reactor which integrates an existing mainloop with
>>Twisted's.  As far as GUIs go, Twisted already includes reactors which
>>integrate glib, gtk, gtk2, various kinds of Windows loops, wxPython, and
>>a few others.
>>
>>Precisely how you integrate two mainloops depends on various details
>>about the loops in question.  Which GUI library are you trying to
>>integrate with?
>>
>>Jean-Paul
>>
>>_______________________________________________
>>Twisted-Python mailing list
>>Twisted-Python at twistedmatrix.com
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>>
>>
>
>_________________________________________________________________
>The next generation of Hotmail is here! http://www.newhotmail.co.uk
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>

_________________________________________________________________
Play your part in making history - Email Britain! 
http://www.emailbritain.co.uk/




From maarten at treewalker.org  Sat Jun  9 16:18:43 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Sat, 9 Jun 2007 22:18:43 +0200
Subject: [Twisted-Python] Asynchronicity
In-Reply-To: <BAY114-F26CCA93C2ED01482B58091BE240@phx.gbl>
References: <BAY114-F26CCA93C2ED01482B58091BE240@phx.gbl>
Message-ID: <200706092218.49156.maarten@treewalker.org>

On Saturday 09 June 2007, Simon Pickles wrote:

> Now, I am only a beginner at twisted, but it looks to me if I called
> run(), I won't have a chance to call iterate() cos twisted will have
> gone into its mainloop and stolen all control!

You should make your code run inside of (under control of) the reactor. I 
think what you're looking for is the callLater method:

reactor.callLater(delay_in_seconds, function, arg1, arg2, ...)

In the function, do a little bit of work, then schedule another callLater and 
let the function return. That way, the reactor can handle the network traffic 
before going back to processing for example AI.

If it's not easy to divide the AI code in fast-executing chunks, you could 
consider running it on a separate thread, but then you have to be careful to 
properly guard all concurrent access to shared data. Another option is to run 
in the AI in a different process, if there is not too much communication 
between the network part and the AI.

Bye,
		Maarten
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070609/200293e3/attachment.pgp 

From exarkun at twistedmatrix.com  Sun Jun 10 00:05:02 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 10 Jun 2007 04:05:02 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1181448302.27.562389900@twistedmatrix.com

Bug summary
______________________
Summary for 2007-06-03 through 2007-06-10
Bugs opened: 15    Bugs closed: 10  Total open bugs: 974 (+5)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       +6  |Highest:  -4          |Conch:   +1            
|Enhancement:  +0  |High:     +1          |Core:    +3            
|Task:         -1  |Normal:   +7          |Mail:    +2            
                   |Low:      +2          |Runner:  +1            
                   |Lowest:   -1          |Trial:   +1            
                                          |Web2:    -1            
                                          |Words:   -2            


New / Reopened Bugs
______________________
                    ===== Highest =====
[#2688] isIPAddress has no unit tests (opened by exarkun) (CLOSED, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2688

[#2691] internet.task.Clock.callLater does not fulfill IReactorTime.callLater contract (opened by washort) (CLOSED, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2691

[#2700] IMAP4Client.lineReceived() fails to parse literals (opened by jenner)
    defect          mail       http://twistedmatrix.com/trac/ticket/2700

[#2701] twisted.words.xish.yappsrt.Scanner.__init__ is  not proper epytext (opened by therve)
    defect          core       http://twistedmatrix.com/trac/ticket/2701

[#2702] twisted.words.xish.yappsrt.Scanner.__init__ is  not proper epytext (opened by therve)
    defect          core       http://twistedmatrix.com/trac/ticket/2702

                    ===== High =====
[#2698] Build Bug on Cygwin (opened by donfanning)
    defect          core       http://twistedmatrix.com/trac/ticket/2698

                    ===== Normal =====
[#2689] twisted.test.test_assertions is lonely (opened by exarkun)
    defect          trial      http://twistedmatrix.com/trac/ticket/2689

[#2690] assertRaises can accept a sequence of exceptions as first parameter, but errors if assertion fails (opened by jml)
    defect          trial      http://twistedmatrix.com/trac/ticket/2690

[#2692] before-shutdown triggers are fired multiple times (opened by yaubi)
    defect          core       http://twistedmatrix.com/trac/ticket/2692

[#2693] procmon.DummyTransport doesn't implement ITransport and is pretty much completely bogus. (opened by dreid)
    defect          runner     http://twistedmatrix.com/trac/ticket/2693

[#2695] IMAP4Client breaks if server uses CONDSTORE (opened by slamb)
    defect          mail       http://twistedmatrix.com/trac/ticket/2695

[#2696] amp.AmpList cannot serialize [] (opened by Lacrymology)
    defect          core       http://twistedmatrix.com/trac/ticket/2696

[#2697] web2's access log should include the username for requests authenticated with twisted.web2.auth.wrapper (opened by dreid)
    enhancement     web2       http://twistedmatrix.com/trac/ticket/2697

                    ===== Low =====
[#2694] ITerminalProtocol.terminalSize should take a winsize object (opened by exarkun)
    enhancement     conch      http://twistedmatrix.com/trac/ticket/2694

[#2699] UDP DatagramProtocol reconnecting (opened by Vazde)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2699



Closed Bugs
______________________
                    ===== Highest =====
[#2654] twisted.internet.abstract.isIPAddress rejects valid IPv4 strings (opened by exarkun, closed by exarkun, wontfix)
    defect          core       http://twistedmatrix.com/trac/ticket/2654

[#2691] internet.task.Clock.callLater does not fulfill IReactorTime.callLater contract (opened by washort, closed by washort, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2691

[#2612] Deferreds not returned in web2 test_wsgi (opened by karlb, closed by therve, fixed)
    defect          web2       http://twistedmatrix.com/trac/ticket/2612

[#2626] trial needs something to check DeprecationWarning (opened by therve, closed by therve, fixed)
    enhancement     trial      http://twistedmatrix.com/trac/ticket/2626

[#2688] isIPAddress has no unit tests (opened by exarkun, closed by exarkun, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2688

[#2502] 'and' and 'or' operator suport for xpath (opened by jack, closed by ralphm, fixed)
    enhancement     words      http://twistedmatrix.com/trac/ticket/2502

[#2630] XMPP stream error conditions incorrectly qualified. (opened by njoyce, closed by ralphm, fixed)
    defect          words      http://twistedmatrix.com/trac/ticket/2630

[#1042] Add blockingCallFromThread to twisted.internet.threads (opened by spiv, closed by therve, fixed)
    enhancement     core       http://twistedmatrix.com/trac/ticket/1042

[#2536] Deprecated TimeoutQueue so we can remove it (opened by exarkun, closed by therve, fixed)
    task            core       http://twistedmatrix.com/trac/ticket/2536

                    ===== Lowest =====
[#1724] twisted.web2.auth doesn't address multi-step authentication (opened by dreid, closed by dreid, invalid)
    defect          web2       http://twistedmatrix.com/trac/ticket/1724





From sipickles at hotmail.com  Sun Jun 10 05:43:48 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sun, 10 Jun 2007 10:43:48 +0100
Subject: [Twisted-Python] Asynchronicity
Message-ID: <BAY114-F2404A454C18EED33BB3E58BE1B0@phx.gbl>

Just to point out, iterate() does seem to run a loop of reactor, before
returning. No call to run() is required.

This is contrary to the API docs.

Why would iterate() be a dead end, jean?

Simon Pickles wrote:
>Wow! it works... iterate does indeed return. Must've had a small mistake
>before!
>
>I am amazed I solved my own problem for a change!
>
>Thanks for the advice, Jean
>
>Simon Pickles wrote:
>>Integrating into a GUI is just one example. In my case, I am using
>>Tkinter on win32. The GUI will be switched off when the server is
>>running, its simply a debug controller...
>>
>>I'm more interested in how a twisted server manages to perform any other
>>logic. For a game server, a fair amount of time needs to be devoted to
>>object and memory management, AI, database access etc
>>
>>My first server, in C++ could do this simply, with a winSock thread
>>listening and storing incoming network comms in a message queue. Easily
>>integrated into a game loop.
>>
>>I was tempted to move to python due to the ease of modification.
>>
>>So... with twisted, how can I manage to spend any time doing AI, for
>>instance?
>>
>>I thought twisted.interface.reactor.iterate() might be my answer. API
>>docs say about iterate:
>>
>>"Run the main loop's I/O polling function for a period of time. This is
>>most useful in applications where the UI is being drawn "as fast as
>>possible", such as games."
>>
>>Unfortunately, the next sentence seems a little contradictory....
>>
>>" The reactor must have been started (via the run() method) prior to any
>>invocations of this method. It must also be stopped manually after the
>>last call to this method (via the stop() method). "
>>
>>Now, I am only a beginner at twisted, but it looks to me if I called
>>run(), I won't have a chance to call iterate() cos twisted will have
>>gone into its mainloop and stolen all control!
>>
>>Am i making sense?
>>
>>Regards
>>
>>Simon
>>
>>
>>Jean-Paul Calderone wrote:
>>>On Sat, 09 Jun 2007 16:09:29 +0100, Simon Pickles <sipickles at hotmail.com> 
>>>wrote:
>>>>Hi,
>>>>
>>>>I have managed to get a simple server going. It seems to accept multiple
>>>>connections correctly.
>>>>
>>>>I am a little puzzled as to how to achieve an asynchonous application
>>>>using twisted. Twisted itself seems asynchronous, but my code is blocked
>>>>by the call:
>>>>
>>>>reactor.run()
>>>>
>>>
>>>Quite so.  reactor.run enters the Twisted mainloop and does not return
>>>until the mainloop is stopped (via reactor.stop).
>>>
>>>>Is there anyway I can return from the reactor to run other code, like
>>>>GUI stuff, or other processing?
>>>
>>>No, but you can call into your other code from Twisted event handlers or
>>>you can write a custom reactor which integrates an existing mainloop with
>>>Twisted's.  As far as GUIs go, Twisted already includes reactors which
>>>integrate glib, gtk, gtk2, various kinds of Windows loops, wxPython, and
>>>a few others.
>>>
>>>Precisely how you integrate two mainloops depends on various details
>>>about the loops in question.  Which GUI library are you trying to
>>>integrate with?
>>>
>>>Jean-Paul
>>>
>>>_______________________________________________
>>>Twisted-Python mailing list
>>>Twisted-Python at twistedmatrix.com
>>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>>
>>>
>>>
>>
>>_________________________________________________________________
>>The next generation of Hotmail is here! http://www.newhotmail.co.uk
>>
>>
>>_______________________________________________
>>Twisted-Python mailing list
>>Twisted-Python at twistedmatrix.com
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>>
>>
>
>_________________________________________________________________
>Play your part in making history - Email Britain! 
>http://www.emailbritain.co.uk/
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>

_________________________________________________________________
The next generation of Hotmail is here! http://www.newhotmail.co.uk




From sipickles at hotmail.com  Sun Jun 10 06:26:19 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sun, 10 Jun 2007 11:26:19 +0100
Subject: [Twisted-Python] Socket number
Message-ID: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>

Hello,

In my C++ game server, I used the socket number as the temporary ID of
the connected player. Is there anyway to retrieve the socket number of a
new player?

Atm, I am just using self.transport.getPeer().host, but this is only the
IP address, not socket.

Thanks

Simon

_________________________________________________________________
The next generation of Hotmail is here! http://www.newhotmail.co.uk/




From p.mayers at imperial.ac.uk  Sun Jun 10 08:04:58 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sun, 10 Jun 2007 13:04:58 +0100
Subject: [Twisted-Python] implementing an adbapi connectionpool idle timer
Message-ID: <466BE8EA.9040305@imperial.ac.uk>

All,

I'm using t.e.adbapi with psycopg against a Postgres 8 database. This 
database is replicated using Slony-I and I'm hitting this problem:

http://linuxfinances.info/info/faq.html#AEN45927

Basically, holding open SQL connections for a long time causes postgres 
to cache query plans; these cached plans need to be freed for Slony to 
rollover its internal SQL replication log table.

So I'd like to add something to ConnectionPool to disconnect unused 
connections after a certain time. Any suggestions how to start?

Also - looking at the ConnectionPool/Transaction code, it appears a 
ConnectionPool's "connections" dictionary is modified from multiple 
threads without locking. Is this safe?



From exarkun at divmod.com  Sun Jun 10 08:09:09 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 10 Jun 2007 08:09:09 -0400
Subject: [Twisted-Python] Asynchronicity
In-Reply-To: <BAY114-F2404A454C18EED33BB3E58BE1B0@phx.gbl>
Message-ID: <20070610120909.30678.479903900.divmod.quotient.13540@ohm>

On Sun, 10 Jun 2007 10:43:48 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Just to point out, iterate() does seem to run a loop of reactor, before
>returning. No call to run() is required.
>
>This is contrary to the API docs.

The API docs describe the supported behavior.  Implementation details may
allow other behavior to appear to work accidentally.

>
>Why would iterate() be a dead end, jean?
>

Generally speaking, none of the reactors are reentrant and driving them
stepwise with iterate() is not a feature which is seeing any interest by
maintainers these days.  This means that it may or may not work with each
reactor and there is little test coverage for it.

Jean-Paul



From exarkun at divmod.com  Sun Jun 10 08:10:36 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 10 Jun 2007 08:10:36 -0400
Subject: [Twisted-Python] Socket number
In-Reply-To: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
Message-ID: <20070610121036.30678.2039443683.divmod.quotient.13541@ohm>

On Sun, 10 Jun 2007 11:26:19 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Hello,
>
>In my C++ game server, I used the socket number as the temporary ID of
>the connected player. Is there anyway to retrieve the socket number of a
>new player?
>
>Atm, I am just using self.transport.getPeer().host, but this is only the
>IP address, not socket.
>

Sockets may not have a file descriptor associated with them on all platforms.
It's trivial maintain a counter yourself and assign a small unique integer
to each client who connects.  Why not do that, instead?

Jean-Paul



From exarkun at divmod.com  Sun Jun 10 08:16:31 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 10 Jun 2007 08:16:31 -0400
Subject: [Twisted-Python] implementing an adbapi connectionpool idle timer
In-Reply-To: <466BE8EA.9040305@imperial.ac.uk>
Message-ID: <20070610121631.30678.477719577.divmod.quotient.13544@ohm>

On Sun, 10 Jun 2007 13:04:58 +0100, Phil Mayers <p.mayers at imperial.ac.uk> wrote:
>All,
>
>I'm using t.e.adbapi with psycopg against a Postgres 8 database. This 
>database is replicated using Slony-I and I'm hitting this problem:
>
>http://linuxfinances.info/info/faq.html#AEN45927
>
>Basically, holding open SQL connections for a long time causes postgres to 
>cache query plans; these cached plans need to be freed for Slony to rollover 
>its internal SQL replication log table.
>
>So I'd like to add something to ConnectionPool to disconnect unused 
>connections after a certain time. Any suggestions how to start?

Be prepared to spend a lot of time in the test suite.  adbapi's test coverage
isn't very unit-like and relies on being able to connect to a real SQL server
in most cases.

You can take a look at twisted.internet.task.Clock for a mechanism to write
a test which doesn't rely on system time.  You might want to create a fake
DB-API 2.0 module in order to test the code without relying on a real SQL
server.  With those things in place, you might be able to get some reasonable
test coverage, at which point it sounds like a straightforward enough feature
to add.

>
>Also - looking at the ConnectionPool/Transaction code, it appears a 
>ConnectionPool's "connections" dictionary is modified from multiple threads 
>without locking. Is this safe?
>

Python builtins are threadsafe.  So, maybe. ;)  As usual, it is always
possible there is a bug hiding there.  Feel free to point it out if you
notice anything in particular.

Jean-Paul



From derfel at alessandria.linux.it  Sun Jun 10 08:20:32 2007
From: derfel at alessandria.linux.it (Federico 'Derfel' Stella)
Date: Sun, 10 Jun 2007 14:20:32 +0200
Subject: [Twisted-Python] Socket number
In-Reply-To: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
References: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
Message-ID: <20070610122031.GA29863@lorien.arda>

* Sunday 10 June 2007, alle 11:26, Simon Pickles scrive:

> In my C++ game server, I used the socket number as the temporary ID of
> the connected player. Is there anyway to retrieve the socket number of a
> new player?

> Atm, I am just using self.transport.getPeer().host, but this is only the
> IP address, not socket.
self.transport.getHandle().fileno()

.getHandle() returns a normal socket object from which you could get socket
number.

Just for curiosity, are your players anonymous (e.g. not registered)?




From p.mayers at imperial.ac.uk  Sun Jun 10 08:32:41 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sun, 10 Jun 2007 13:32:41 +0100
Subject: [Twisted-Python] implementing an adbapi connectionpool idle timer
In-Reply-To: <20070610121631.30678.477719577.divmod.quotient.13544@ohm>
References: <20070610121631.30678.477719577.divmod.quotient.13544@ohm>
Message-ID: <466BEF69.3090109@imperial.ac.uk>

> Be prepared to spend a lot of time in the test suite.  adbapi's test 
> coverage
> isn't very unit-like and relies on being able to connect to a real SQL 
> server
> in most cases.

Oh. Joy.

>> Also - looking at the ConnectionPool/Transaction code, it appears a 
>> ConnectionPool's "connections" dictionary is modified from multiple 
>> threads without locking. Is this safe?
>>
> 
> Python builtins are threadsafe.  So, maybe. ;)  As usual, it is always

Ah. I was under the impression they were not, hence the disconnect.



From radix at twistedmatrix.com  Sun Jun 10 11:51:06 2007
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sun, 10 Jun 2007 11:51:06 -0400
Subject: [Twisted-Python] Socket number
In-Reply-To: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
References: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
Message-ID: <60ed19d40706100851h3f42239dvb21100139d974e92@mail.gmail.com>

On 6/10/07, Simon Pickles <sipickles at hotmail.com> wrote:
> Hello,
>
> In my C++ game server, I used the socket number as the temporary ID of
> the connected player. Is there anyway to retrieve the socket number of a
> new player?
>
> Atm, I am just using self.transport.getPeer().host, but this is only the
> IP address, not socket.

If you only need this identifier for use in the implementation of the
server, a much better way to identify players is by their Protocol
object. On the other hand, if you do need to pass this identifier over
the wire, then I agree with Jean-Paul that a small incremental or
random number would be good.

-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From brendoncolby at gmail.com  Sun Jun 10 13:10:50 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Sun, 10 Jun 2007 12:10:50 -0500
Subject: [Twisted-Python] Socket number
In-Reply-To: <60ed19d40706100851h3f42239dvb21100139d974e92@mail.gmail.com>
References: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
	<60ed19d40706100851h3f42239dvb21100139d974e92@mail.gmail.com>
Message-ID: <e64b001e0706101010h36033caep6a7c5dbedffd9d7f@mail.gmail.com>

On 6/10/07, Christopher Armstrong <radix at twistedmatrix.com> wrote:
>
> If you only need this identifier for use in the implementation of the
> server, a much better way to identify players is by their Protocol
> object. On the other hand, if you do need to pass this identifier over
> the wire, then I agree with Jean-Paul that a small incremental or
> random number would be good.

This is what I do:

usersByID = {} # userID:user object
idRange = range(1,1001) # Arbitrary limit...

def getNextUserID():
    return list(set(idRange) - set(usersByID))[0]

When a user connects, I get the next available ID. If usersByID looks like:

{1:User1, 2:User2, 5:User5}

The next ID returned will be 3. I do this so I can keep reusing my IDs
instead of infinitely incrementing them.



From sipickles at hotmail.com  Sun Jun 10 14:25:30 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sun, 10 Jun 2007 19:25:30 +0100
Subject: [Twisted-Python] Still problems debugging with twisted...
Message-ID: <BAY114-F1138B2B3DB5E49D23938E3BE1B0@phx.gbl>

Hi,

I've still got my problem with zope and twisted:

[Dbg]>>>
Traceback (most recent call last):
  File "<string>", line 97, in run
  File "C:\Python25\lib\bdb.py", line 366, in run
    exec cmd in globals, locals
  File "F:\_Dev\twisted server 20070608\SERVER.py", line 7, in <module>
    import twistedServer
  File "F:\_Dev\twisted server 20070608\twistedServer.py", line 4, in
<module>
    from zope.interface import Interface
  File "C:\Python25\lib\site-packages\zope\interface\__init__.py", line
58, in <module>
    _wire()
  File "C:\Python25\lib\site-packages\zope\interface\interface.py", line
936, in _wire
    classImplements(Attribute, IAttribute)
  File "C:\Python25\lib\site-packages\zope\interface\declarations.py",
line 464, in classImplements
    spec = implementedBy(cls)
  File "C:\Python25\lib\site-packages\zope\interface\declarations.py",
line 330, in implementedByFallback
    if isinstance(spec, Implements):
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes
and types


Strangely, if I run the python module from file or python command window
it runs perfectly fine, no tracebacks. It only crashes like this when
run within PyScripter. Very annoying since thats my favourite IDE.

I've installed zope.interface-3.3.0.1-win32.egg from the python
cheeseshop using easy_install. No Change. Still can't debug.

Thanks for your help.

Simon

_________________________________________________________________
Play your part in making history - Email Britain! 
http://www.emailbritain.co.uk/




From p.mayers at imperial.ac.uk  Sun Jun 10 17:59:58 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sun, 10 Jun 2007 22:59:58 +0100
Subject: [Twisted-Python] Still problems debugging with twisted...
In-Reply-To: <BAY114-F1138B2B3DB5E49D23938E3BE1B0@phx.gbl>
References: <BAY114-F1138B2B3DB5E49D23938E3BE1B0@phx.gbl>
Message-ID: <466C745E.4020604@imperial.ac.uk>

> 
> Strangely, if I run the python module from file or python command window
> it runs perfectly fine, no tracebacks. It only crashes like this when
> run within PyScripter. Very annoying since thats my favourite IDE.

Well then logically it's a PyScripter issue. You should ask on that 
mailing list.



From jml at mumak.net  Mon Jun 11 20:04:01 2007
From: jml at mumak.net (Jonathan Lange)
Date: Tue, 12 Jun 2007 10:04:01 +1000
Subject: [Twisted-Python] Mailing list or RSS feed of trunk commits?
Message-ID: <d06a5cd30706111704k32daeccftb496e9fb09397d5c@mail.gmail.com>

Hello all,

Is there a mailing list or RSS feed of commits to trunk? If so, how do
I get at it?

Thanks,
jml



From andrew-twisted at puzzling.org  Mon Jun 11 21:20:46 2007
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue, 12 Jun 2007 11:20:46 +1000
Subject: [Twisted-Python] Mailing list or RSS feed of trunk commits?
In-Reply-To: <d06a5cd30706111704k32daeccftb496e9fb09397d5c@mail.gmail.com>
References: <d06a5cd30706111704k32daeccftb496e9fb09397d5c@mail.gmail.com>
Message-ID: <20070612012046.GA10087@steerpike.home.puzzling.org>

Jonathan Lange wrote:
> Hello all,
> 
> Is there a mailing list or RSS feed of commits to trunk? If so, how do
> I get at it?

Both ;)

  * http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-commits
  * http://twistedmatrix.com/trac/timeline?changeset=on&max=50&daysback=90&format=rss

There's even:

  * https://code.launchpad.net/~vcs-imports/twisted/main/+subscribe

Personally, I use the mailing list.  Probably that's because it was there first.
(You also get non-trunk commits, but it wouldn't be too hard to ignore them with
procmail if you wished).

-Andrew.




From amauryfa at gmail.com  Tue Jun 12 03:47:51 2007
From: amauryfa at gmail.com (Amaury Forgeot d'Arc)
Date: Tue, 12 Jun 2007 09:47:51 +0200
Subject: [Twisted-Python] C++ port of Twisted
Message-ID: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>

Hello,

I love python and I find twisted fantastic, but here I have to write a
C++ application, for performance pseudo-reasons :-(

I was looking for a Twisted-like framework in C++.
Do you know if such a library exists?

ACE seems to provide powerful tools for networking, but I could not
find something like Protocols and Deferred.

Or is the twisted approach not recommended for C++?

-- 
Amaury Forgeot d'Arc



From maarten at treewalker.org  Tue Jun 12 04:33:23 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Tue, 12 Jun 2007 10:33:23 +0200
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
Message-ID: <200706121033.28874.maarten@treewalker.org>

On Tuesday 12 June 2007, Amaury Forgeot d'Arc wrote:

> I love python and I find twisted fantastic, but here I have to write a
> C++ application, for performance pseudo-reasons :-(

It's not an option to write part of the application in C++ and part in Python?

> I was looking for a Twisted-like framework in C++.
> Do you know if such a library exists?

Qt is the closest thing I've seen, in the sense that it offers an asynchronous 
API for networking. In the signal-slot mechanism for callbacks, you connect 
two objects semi-permanently, unlike a Deferred which is used just once. If 
the way you handle events is mostly static, it is not a problem.

Qt is modular since 4.0, so you could use the network part without the GUI 
part. But unlike Twisted, it doesn't come with implementations for all 
popular network protocols. For the client side, KIO from KDE supports many 
protocols, for the server side you'd probably have to write it yourself.

Bye,
		Maarten
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070612/f0c7702b/attachment.pgp 

From littlesweetmelon at gmail.com  Tue Jun 12 05:43:20 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Tue, 12 Jun 2007 17:43:20 +0800
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <200706121033.28874.maarten@treewalker.org>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
Message-ID: <cdb837ea0706120243r607a6001p88a9dec957844b62@mail.gmail.com>

> > I love python and I find twisted fantastic, but here I have to write a
> > C++ application, for performance pseudo-reasons :-(
>
> It's not an option to write part of the application in C++ and part in Python?

Well, I don't think performance is the issue to rewrite twisted into
C/C++ code. The burden given by python/twisted is very low, because
twisted is much like a framework rather than computational-intensive
library. For high performance, you'd better write most of your code in
C++, and compiled into pyd extension module. Then you can use twisted
to "glue" the good framework and your high performance code.

---
ShenLei



From amauryfa at gmail.com  Tue Jun 12 05:58:12 2007
From: amauryfa at gmail.com (Amaury Forgeot d'Arc)
Date: Tue, 12 Jun 2007 11:58:12 +0200
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <200706121033.28874.maarten@treewalker.org>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
Message-ID: <e27efe130706120258w6b815f53w5e8b02c44527ae0f@mail.gmail.com>

Hello Maarten,

2007/6/12, Maarten ter Huurne wrote:
> On Tuesday 12 June 2007, Amaury Forgeot d'Arc wrote:
>
> > I love python and I find twisted fantastic, but here I have to write a
> > C++ application, for performance pseudo-reasons :-(
>
> It's not an option to write part of the application in C++ and part in Python?

Not yet. Maybe in a few years...

> > I was looking for a Twisted-like framework in C++.
> > Do you know if such a library exists?
>
> Qt is the closest thing I've seen, in the sense that it offers an asynchronous
> API for networking. In the signal-slot mechanism for callbacks, you connect
> two objects semi-permanently, unlike a Deferred which is used just once.

Interesting, a bit like event binding in wxWidgets.

> If the way you handle events is mostly static, it is not a problem.

But it's not really the case. Events may have the same type, but are
needed in different places when the protocol state changes. Deferreds
fit well in this case.

> Qt is modular since 4.0, so you could use the network part without the GUI
> part. But unlike Twisted, it doesn't come with implementations for all
> popular network protocols. For the client side, KIO from KDE supports many
> protocols, for the server side you'd probably have to write it yourself.

Well, both Qt and kio provide basic socket wrappers, but their
protocol frameworks seem completely geared toward filesystems or URLs.

I will use the financial FIX protocol. I am looking for a way to
implement new protocols.

Actually I already developed a bunch of classes that mimic part of the
twisted framework:
Deferreds, Protocols, Connectors, and a Reactor which provides
TcpTransport and callLater().
The reactor implementation is based on Windows MFC classes (and a
reactor based on select is under development)
It's far from complete, but it seems to work.

If someone is interested, I can try to clean up the code and share it...

-- 
Amaury Forgeot d'Arc



From amauryfa at gmail.com  Tue Jun 12 07:38:02 2007
From: amauryfa at gmail.com (Amaury Forgeot d'Arc)
Date: Tue, 12 Jun 2007 13:38:02 +0200
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <cdb837ea0706120243r607a6001p88a9dec957844b62@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
	<cdb837ea0706120243r607a6001p88a9dec957844b62@mail.gmail.com>
Message-ID: <e27efe130706120438o6f8d6fbakded55a51f97e34d8@mail.gmail.com>

Hello,

2007/6/12, ?? wrote:
> > > I love python and I find twisted fantastic, but here I have to write a
> > > C++ application, for performance pseudo-reasons :-(
> >
> > It's not an option to write part of the application in C++ and part in Python?
>
> Well, I don't think performance is the issue to rewrite twisted into
> C/C++ code. The burden given by python/twisted is very low, because
> twisted is much like a framework rather than computational-intensive
> library. For high performance, you'd better write most of your code in
> C++, and compiled into pyd extension module. Then you can use twisted
> to "glue" the good framework and your high performance code.

The problem is that I cannot use python yet:
The application already exists, and is a big Windows MFC project in C++.

I am trying to use the Twisted approach in a C++ application.
And so far it works... I just would like to know whether I am
reinventing the wheel.

-- 
Amaury Forgeot d'Arc



From arnarbi at gmail.com  Tue Jun 12 08:06:40 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Tue, 12 Jun 2007 12:06:40 +0000
Subject: [Twisted-Python] Flash AMF and Twisted
Message-ID: <28012bc60706120506t44ef5e0dx4697b5863b2c746a@mail.gmail.com>

Hi all,

Re. this message:
http://twistedmatrix.com/pipermail/twisted-python/2007-May/015373.html

Has any work been done here? I'm facing a project that requires
two-way communication between a Flex/Apollo app and a Twisted server.
In my initial tests I used http and comet-like techniques but I'm not
sure they are the most efficient way.

I'm willing to help with the project - I've already dabbled a little
in the DjangoAMF stuff.

Arnar



From glyph at divmod.com  Tue Jun 12 09:04:34 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 12 Jun 2007 13:04:34 -0000
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <e27efe130706120438o6f8d6fbakded55a51f97e34d8@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
	<cdb837ea0706120243r607a6001p88a9dec957844b62@mail.gmail.com>
	<e27efe130706120438o6f8d6fbakded55a51f97e34d8@mail.gmail.com>
Message-ID: <20070612130434.20416.1994396054.divmod.xquotient.28@joule.divmod.com>

On 11:38 am, amauryfa at gmail.com wrote:
>The problem is that I cannot use python yet:
>The application already exists, and is a big Windows MFC project in 
>C++.
>
>I am trying to use the Twisted approach in a C++ application.
>And so far it works... I just would like to know whether I am
>reinventing the wheel.

One of the original inspirations for Twisted was a C++ library, the 
ADAPTIVE Communication Environment: 
http://www.cs.wustl.edu/~schmidt/ACE.html - I believe it has been ported 
to Windows, among other platforms.

Good luck.  I do not envy you having to write C++ at this level :).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070612/8beb7c66/attachment.htm 

From rodrigo at 1bit.com.br  Tue Jun 12 09:22:37 2007
From: rodrigo at 1bit.com.br (Rodrigo Strauss)
Date: Tue, 12 Jun 2007 10:22:37 -0300
Subject: [Twisted-Python] C++ port of Twisted
Message-ID: <a684d0100706120622w3d1da826vd91bb931ce0f86e7@mail.gmail.com>

Have tou tried Boost Asio?

http://asio.sourceforge.net/

Rodrigo Strauss



From johann.borck at densedata.com  Tue Jun 12 11:36:32 2007
From: johann.borck at densedata.com (Johann Borck)
Date: Tue, 12 Jun 2007 15:36:32 +0000
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
Message-ID: <466EBD80.9020602@densedata.com>

Amaury Forgeot d'Arc wrote:
> Hello,
>
> I love python and I find twisted fantastic, but here I have to write a
> C++ application, for performance pseudo-reasons :-(
>
> I was looking for a Twisted-like framework in C++.
> Do you know if such a library exists?
>
> ACE seems to provide powerful tools for networking, but I could not
> find something like Protocols and Deferred.
>
> Or is the twisted approach not recommended for C++?
>
If C++ is required, take a look at TProactor (terabit.com.au), which is
an improved implementation of the Proactor-pattern for the ACE-framework
(you need ACE and TProactor). the version of proactor that comes with
ACE is not recommended for production by ACE-people themselves
(according to the mailing list). In the tests TProactor has some code
that shows how you can get very close to what's called Protocol in
Twisted. But even the basic Proactor-framework gives you the
'ACE/TRB_ServiceHandler' class, which does basically the same as
'Protocol'. The ACE-pendant to Deferreds are called Futures in ACE.

>2007/6/12, Maarten ter Huurne wrote:
>>It's not an option to write part of the application in C++ and part in
Python?

>Not yet. Maybe in a few years...

I'd recommend to think about that a bit, if the decision is upon you ;)

Johann



From bv at bnl.gov  Tue Jun 12 13:31:32 2007
From: bv at bnl.gov (Brett Viren)
Date: Tue, 12 Jun 2007 13:31:32 -0400
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <200706121033.28874.maarten@treewalker.org> (Maarten ter Huurne's
	message of "Tue, 12 Jun 2007 10:33:23 +0200")
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
Message-ID: <ir4ejkhf5aj.fsf@lycastus.phy.bnl.gov>

Maarten ter Huurne <maarten at treewalker.org> writes:

> Qt is the closest thing I've seen, in the sense that it offers an asynchronous 
> API for networking. In the signal-slot mechanism for callbacks, you connect 
> two objects semi-permanently, unlike a Deferred which is used just once. If 
> the way you handle events is mostly static, it is not a problem.

For signal-slot idiom, also compare to libsigc++ as well as Boost.

-Brett.



From michele.petrazzo at unipex.it  Wed Jun 13 14:21:10 2007
From: michele.petrazzo at unipex.it (Michele Petrazzo - Unipex srl)
Date: Wed, 13 Jun 2007 20:21:10 +0200
Subject: [Twisted-Python] reactor and thread
Message-ID: <46703596.8000305@unipex.it>

Hi all,
I have a project where I writing the "server" (on win xp) and I want to
communicate with a client, so twisted it's all I need.
Into the "server" I have also a python bind to a dll (with ctypes) and I
see strange problems (windows crashes) when I call a dll function inside
a thread. My thread it's a twisted "Protocol".
My question is: it is possible to call the function from/to a specific
thread? So somethink like:

class MyDll:
  def funct(self, callBack):
    #do the work
    reactor.call_in_main_thrad(callBack)


tid = create_a_thread_and_load_MyDll() # where I make the dll instance
and all the work need into a thread

#into a someone function into the main thread

def callBack():
  # a simple callback

reactor.callIntoThread(tid, funct, callBack)

Is this possible with twisted? (Does I'm dreaming?)

P.s. If I try with the wx "reactor" (so wx.MainLoop), I see no problem!
In that case, I instance the dll into the class __init__ (inherit from
wx.Frame) and into a someone event (i.e. Button click) I call a dll
funct and all work without crash...

Thanks,
Michele
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3273 bytes
Desc: S/MIME Cryptographic Signature
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070613/cc93ce9c/attachment.bin 

From gabor.bernath at gmail.com  Wed Jun 13 15:01:37 2007
From: gabor.bernath at gmail.com (=?ISO-8859-1?Q?G=E1bor_Bern=E1th?=)
Date: Wed, 13 Jun 2007 20:01:37 +0100
Subject: [Twisted-Python] reactor and thread
In-Reply-To: <46703596.8000305@unipex.it>
References: <46703596.8000305@unipex.it>
Message-ID: <ff49a2640706131201m2ea0118fk57382de5fe70d5f5@mail.gmail.com>

Hi Michele,

> My question is: it is possible to call the function from/to a specific
> thread?

you could use deferToThread() to run a task in a separate thread and
get the results in the main thread.

here are the docs:
http://twistedmatrix.com/documents/current/api/twisted.internet.threads.html#deferToThread

here is a small example which asks for user input in a separate thread:

--------
from twisted.internet import reactor, defer, threads

def input():
    return threads.deferToThread(blocking_task)

def blocking_task():
    print "working... enter something to end task"
    return raw_input()

def got_result(data):
    print "the long-running task results in:", data
    reactor.stop()

input().addCallback(got_result)
reactor.run()
--------

is this what you want to do?



On 6/13/07, Michele Petrazzo - Unipex srl <michele.petrazzo at unipex.it> wrote:
> Hi all,
> I have a project where I writing the "server" (on win xp) and I want to
> communicate with a client, so twisted it's all I need.
> Into the "server" I have also a python bind to a dll (with ctypes) and I
> see strange problems (windows crashes) when I call a dll function inside
> a thread. My thread it's a twisted "Protocol".
> My question is: it is possible to call the function from/to a specific
> thread? So somethink like:
>
> class MyDll:
>   def funct(self, callBack):
>     #do the work
>     reactor.call_in_main_thrad(callBack)
>
>
> tid = create_a_thread_and_load_MyDll() # where I make the dll instance
> and all the work need into a thread
>
> #into a someone function into the main thread
>
> def callBack():
>   # a simple callback
>
> reactor.callIntoThread(tid, funct, callBack)
>
> Is this possible with twisted? (Does I'm dreaming?)
>
> P.s. If I try with the wx "reactor" (so wx.MainLoop), I see no problem!
> In that case, I instance the dll into the class __init__ (inherit from
> wx.Frame) and into a someone event (i.e. Button click) I call a dll
> funct and all work without crash...
>
> Thanks,
> Michele
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>



From glyph at divmod.com  Wed Jun 13 22:05:06 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 14 Jun 2007 02:05:06 -0000
Subject: [Twisted-Python] reactor and thread
In-Reply-To: <46703596.8000305@unipex.it>
References: <46703596.8000305@unipex.it>
Message-ID: <20070614020506.20416.154231059.divmod.xquotient.169@joule.divmod.com>


G?bor Bern?th already answered your question, but I'd like to answer as 
specifically as possible for future readers who may discover this 
message.

On 13 Jun, 06:21 pm, michele.petrazzo at unipex.it wrote:
>    reactor.call_in_main_thrad(callBack)

This is spelled:

    reactor.callFromThread(callBack)
>reactor.callIntoThread(tid, funct, callBack)

This is spelled:

    from twisted.internet.threads import deferToThread
    deferToThread(funct).addCallback(callBack)
>Is this possible with twisted? (Does I'm dreaming?)

This, and many other fun features of the reactor, can be discovered by 
reading the twisted.internet interface documentation, available here:

http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.html

You can read more specifically about threads here:

http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorThreads.html

I hope this proves useful to you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070614/f58f6599/attachment.htm 

From waterinfire at hotmail.com  Wed Jun 13 22:11:54 2007
From: waterinfire at hotmail.com (weiwei weiwei)
Date: Thu, 14 Jun 2007 10:11:54 +0800
Subject: [Twisted-Python] twisted and performance
Message-ID: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>

Hi,all!



         Thanks for the python twisted,it is a great software.



         I am from china. This days we use twisted to develop a middleware.



         Requirement is:

1)       Receive:  receive 100~200 different client??s message(they all 
connect to our listen socket) and insert it into database(oracle)

2)       Send: application insert message into db,then our middleware select 
message from database and send this message to its destination through 
socket.



Our design is : reactor + adbapi.ConnectionPool

1)       reactor is used in receiveing and sending message from and to 
socket.

2)       when we received a message,we use adbapi to insert it to db

3)       we use adbapi to select message from db,and use a Deferred to 
notify us when we got a message from db,and send it to peer,after receiving 
the peer??s acknowledge message ,we update the databse.



After testing many times,we found when the connection number is less than 
20,its performance is very good.But if the connection number is more than 30 
or 50, it is performance is worse and worse.



DO you give me some advice about the design?





Thanks in advance.





Wei wei

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/




From littlesweetmelon at gmail.com  Thu Jun 14 05:03:32 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Thu, 14 Jun 2007 17:03:32 +0800
Subject: [Twisted-Python] What is the best way to implement "need more data"
	semantics?
Message-ID: <cdb837ea0706140203g1c8a5995h7256d376746e3c7@mail.gmail.com>

My goal is writing a specific protocol. The data transfered between
client and server are mixed with text and binary. I override the
method dataReceived. When it get some new data, it will call a certain
parseFunc according to the current state of the protocol, such as:
Step 1: dataReceived will call parseGreetingMessage(), and then call
ReplyGreetingMessage()
Step 2: dataReceived will call parseHandShaking(), and then call
ReplyHandShaking()
Step 3: dataReceived will call parseSecurity(), and then call ReplySecurity()
....

However, in some cases, the data received from the server is not
completely fetched by the client, so the data passed to parseFunc will
be treated as incomplete, and parseFunc will try to return and wait
for more data. Currently, my code for doing this seems very ulgy ^_^.
Could you please give me some suggestions to make the implementation
of the "need more data" semantics more clearly and more easily?

The problem is that the message boundary in my protocol is not as
simple as LineReceiver. Each step, I should use different parse to
determine whether I get the whole data. For example:
parseErrorString: The data compose an leading 4byte integer size plus
following string characters. If the length of collected data is
shorter than (4 + size of string), it will be treated as incomplete.
parseBitmap: The data compose a bitmap header and following bitmap
data. If the length of collected data is shorter than (sizeof(header)
+ headerwidth*header.height*bits_per_pixel), it will be treated as
incomplete.

My method is:
parseFunc parses the data while testing the completeness. If
incomplete occrred, parseFunct return. When new data arrived, the
dataReceived method will call parseFunc again, and "re-parse" the
previous data as well as new data. However, sometimes, re-parse is
time consuming. I want to find a way to hold the result for
already-parsed data. Maybe it will be similar to "generator":

# In class MyProtocol(protocol.Protocol):  pseudo-code
def parseFunc(...):
    # parse header ...
    if not completeness:
        yield   # need more data, go into data waiting state.
    # If new data arrived, dataReceived will be called, and then
    # call parseFunc again to continue parsing.
    # parse following data...
    if not completeness:
        yield   # need more data
    ....

def dataReceived(s):
    self.data += s
    self.parseFunc()

---
ShenLei



From adelagon at gmail.com  Thu Jun 14 06:21:02 2007
From: adelagon at gmail.com (Alvin Delagon)
Date: Thu, 14 Jun 2007 06:21:02 -0400
Subject: [Twisted-Python] twisted and performance
In-Reply-To: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
References: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
Message-ID: <7a01f6c00706140321w72e9023esf89a28e1c9363b6@mail.gmail.com>

Hi! This is my first advice for twisted-python list I hope I get this right.

I don't know much about adbapi but you might to check if your database is
causing the bottleneck. Also, what reactor are you using? You might want to
configure your twisted application to use the epoll reactor. We have a
server here using epoll and believe me this thing is wonderful. ^_^


On 6/13/07, weiwei weiwei <waterinfire at hotmail.com> wrote:
>
> Hi,all!
>
>
>
>          Thanks for the python twisted,it is a great software.
>
>
>
>          I am from china. This days we use twisted to develop a
> middleware.
>
>
>
>          Requirement is:
>
> 1)       Receive:  receive 100~200 different client??s message(they all
> connect to our listen socket) and insert it into database(oracle)
>
> 2)       Send: application insert message into db,then our middleware
> select
> message from database and send this message to its destination through
> socket.
>
>
>
> Our design is : reactor + adbapi.ConnectionPool
>
> 1)       reactor is used in receiveing and sending message from and to
> socket.
>
> 2)       when we received a message,we use adbapi to insert it to db
>
> 3)       we use adbapi to select message from db,and use a Deferred to
> notify us when we got a message from db,and send it to peer,after
> receiving
> the peer??s acknowledge message ,we update the databse.
>
>
>
> After testing many times,we found when the connection number is less than
> 20,its performance is very good.But if the connection number is more than
> 30
> or 50, it is performance is worse and worse.
>
>
>
> DO you give me some advice about the design?
>
>
>
>
>
> Thanks in advance.
>
>
>
>
>
> Wei wei
>
> _________________________________________________________________
> Express yourself instantly with MSN Messenger! Download today it's FREE!
> http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070614/a71e73d5/attachment.htm 

From vovic at nfi.kiae.ru  Thu Jun 14 12:51:05 2007
From: vovic at nfi.kiae.ru (Voznesensky Vladimir)
Date: Thu, 14 Jun 2007 20:51:05 +0400
Subject: [Twisted-Python] SSL: wrong version number
Message-ID: <web-2617171@newmail.nfi.kiae.ru>

Hello.

I'm trying to write a twisted client for MyProxy server.
This grid service uses TLS.
When using blocking calls, everything is ok.
When trying to estabilish a twisted connection
using reactor.connectSSL(host, port, f, contextFactory)
with _the_same_ context in contextFactory, the error 
occures:

[Failure instance: Traceback (failure with no frames): 
<class 'OpenSSL.SSL.Error'>: [('SSL routines', 
'SSL3_GET_RECORD', 'wrong version number')]

You can do it yourself by simply connecting to 
myproxy.cern.ch:7512

Is there anybody aware of such problem?

Thanks,
VV



From exarkun at divmod.com  Thu Jun 14 15:08:06 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 14 Jun 2007 15:08:06 -0400
Subject: [Twisted-Python] SSL: wrong version number
In-Reply-To: <web-2617171@newmail.nfi.kiae.ru>
Message-ID: <20070614190806.4947.693433960.divmod.quotient.1672@ohm>

On Thu, 14 Jun 2007 20:51:05 +0400, Voznesensky Vladimir <vovic at nfi.kiae.ru> wrote:
>Hello.
>
>I'm trying to write a twisted client for MyProxy server.
>This grid service uses TLS.
>When using blocking calls, everything is ok.
>When trying to estabilish a twisted connection
>using reactor.connectSSL(host, port, f, contextFactory)
>with _the_same_ context in contextFactory, the error occures:
>
>[Failure instance: Traceback (failure with no frames): <class 
>'OpenSSL.SSL.Error'>: [('SSL routines', 'SSL3_GET_RECORD', 'wrong version 
>number')]
>
>You can do it yourself by simply connecting to myproxy.cern.ch:7512
>
>Is there anybody aware of such problem?

The server is using SSLv2.  The traceback seems to indicate the context is
set up for SSLv3.  I can't tell how you created that context object, nor am
I certain why one version of your code can establish a connection while the
other cannot, but I would check the context object and make sure it is using
either SSLv2 or SSLv23.

Jean-Paul



From exarkun at divmod.com  Thu Jun 14 15:22:20 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 14 Jun 2007 15:22:20 -0400
Subject: [Twisted-Python] SSL: wrong version number
In-Reply-To: <20070614190806.4947.693433960.divmod.quotient.1672@ohm>
Message-ID: <20070614192220.4947.817733265.divmod.quotient.1679@ohm>

On Thu, 14 Jun 2007 15:08:06 -0400, Jean-Paul Calderone <exarkun at divmod.com> wrote:
>On Thu, 14 Jun 2007 20:51:05 +0400, Voznesensky Vladimir <vovic at nfi.kiae.ru> 
>wrote:
>>Hello.
>>
>>I'm trying to write a twisted client for MyProxy server.
>>This grid service uses TLS.
>>When using blocking calls, everything is ok.
>>When trying to estabilish a twisted connection
>>using reactor.connectSSL(host, port, f, contextFactory)
>>with _the_same_ context in contextFactory, the error occures:
>>
>>[Failure instance: Traceback (failure with no frames): <class 
>>'OpenSSL.SSL.Error'>: [('SSL routines', 'SSL3_GET_RECORD', 'wrong version 
>>number')]
>>
>>You can do it yourself by simply connecting to myproxy.cern.ch:7512
>>
>>Is there anybody aware of such problem?
>
>The server is using SSLv2.  The traceback seems to indicate the context is
>set up for SSLv3.  I can't tell how you created that context object, nor am
>I certain why one version of your code can establish a connection while the
>other cannot, but I would check the context object and make sure it is using
>either SSLv2 or SSLv23.
>

Oh, I should also say that SSLv2 is insecure and, if you can, you should
really change that server to use at least SSLv3.

Jean-Paul



From twisted-python at 2xlp.com  Thu Jun 14 15:29:08 2007
From: twisted-python at 2xlp.com (Jonathan Vanasco)
Date: Thu, 14 Jun 2007 15:29:08 -0400
Subject: [Twisted-Python] caching suggestions
Message-ID: <BB643192-5115-4E2E-BB8D-C2D602B8E466@2xlp.com>

note: this is less about twisted than a project i've built on twisted  
that is having some issues.  everyone here is smart, so i thought  
this would be a good list to ask on.

i've got a small twisted daemon that is working as a proxy for  
hosting content that we store on amazon-s3
long story short: archive to s3 (redundancy, cheap storage), twisted  
daemon on our network fetches to cache & serve.  we have cheaper  
bandwidth, plus do a lot of file monitoring / name abstraction that  
amazon's network won't support.  currently there are 10k documents on  
s3, which are accessible via 150k+ 'keys'.   the cache basiscally  
proxies the right doc for each key

I'm running into 2 issues with it:
	short term- keys are mapped to s3 files via a ton of 'hints' that i  
store in bdb after fetching from postgresql.  the hints need to be  
refreshed every 1-5 minutes or so.  does anyone have a good  
suggestion on how to do that?  i could do this really easily with  
sqlite, but i need to use bdb -- as sqlite isn't nearly fast enough;  
while bdb is.

	long term-    everything is fine for now -- we only have about 3gb  
of data.  but thats going to be growing to about 20gb soon, and we  
want to limit the cache to an active 10gb using an Adaptive  
Replacement Cache algorithm with a bdb datastore.  has anyone done  
something similar in twisted or python in general?

any input would be appreciated.  thanks!

// Jonathan Vanasco

| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|   CEO/Founder SyndiClick Networks
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|      FindMeOn.com - The cure for Multiple Web Personality Disorder
|      Web Identity Management and 3D Social Networking
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|      RoadSound.com - Tools For Bands, Stuff For Fans
|      Collaborative Online Management And Syndication Tools
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -





From christian.simms at gmail.com  Thu Jun 14 15:33:11 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Thu, 14 Jun 2007 15:33:11 -0400
Subject: [Twisted-Python] twisted and performance
In-Reply-To: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
References: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
Message-ID: <cd8fa6f90706141233r409dd47bnf765d722403af518@mail.gmail.com>

On 6/13/07, weiwei weiwei <waterinfire at hotmail.com> wrote:
>
> Hi,all!
>
>
>
>          Thanks for the python twisted,it is a great software.
>
>
>
>          I am from china. This days we use twisted to develop a
> middleware.
>
>
>
>          Requirement is:
>
> 1)       Receive:  receive 100~200 different client??s message(they all
> connect to our listen socket) and insert it into database(oracle)
>
> 2)       Send: application insert message into db,then our middleware
> select
> message from database and send this message to its destination through
> socket.
>
>
>
> Our design is : reactor + adbapi.ConnectionPool
>
> 1)       reactor is used in receiveing and sending message from and to
> socket.
>
> 2)       when we received a message,we use adbapi to insert it to db
>
> 3)       we use adbapi to select message from db,and use a Deferred to
> notify us when we got a message from db,and send it to peer,after
> receiving
> the peer??s acknowledge message ,we update the databse.
>
>
>
> After testing many times,we found when the connection number is less than
> 20,its performance is very good.But if the connection number is more than
> 30
> or 50, it is performance is worse and worse.
>
>
>
> DO you give me some advice about the design?
>
>
>
>
>
> Thanks in advance.
>
>
>
>
>
> Wei wei
>
> _________________________________________________________________
> Express yourself instantly with MSN Messenger! Download today it's FREE!
> http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>


If I had to guess, I would guess you're having database performance issues.
The overhead of TCP/IP networking of 50, or even 500 simultaneous
connections is nothing compared to the overhead of that many simultaneous
interactions with a database.  You can figure this out by doing some
experiments, like:

- run your test with a fake database which just uses an in-memory database
-- if still slow then problem is in your networking, if fast then problem is
in database

- if that's too difficult, another experiment would be to write some test
code to run a number of simultaneous database interactions without any
networking

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070614/738ee607/attachment.htm 

From brucecoram at clara.co.uk  Thu Jun 14 15:42:47 2007
From: brucecoram at clara.co.uk (Bruce Coram)
Date: Thu, 14 Jun 2007 20:42:47 +0100
Subject: [Twisted-Python] udp
Message-ID: <46719A37.1060504@clara.co.uk>

How do you send data using udp?

I want to use udp to send messages from clients to a server.  I don't
want to use connected udp.

Can anyone supply some specimen code for me

Thanks

Bruce Coram





From exarkun at divmod.com  Thu Jun 14 15:43:57 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 14 Jun 2007 15:43:57 -0400
Subject: [Twisted-Python] caching suggestions
In-Reply-To: <BB643192-5115-4E2E-BB8D-C2D602B8E466@2xlp.com>
Message-ID: <20070614194357.4947.13735448.divmod.quotient.1692@ohm>

On Thu, 14 Jun 2007 15:29:08 -0400, Jonathan Vanasco <twisted-python at 2xlp.com> wrote:
>note: this is less about twisted than a project i've built on twisted  that 
>is having some issues.  everyone here is smart, so i thought  this would be 
>a good list to ask on.
>
>i've got a small twisted daemon that is working as a proxy for  hosting 
>content that we store on amazon-s3
>long story short: archive to s3 (redundancy, cheap storage), twisted  daemon 
>on our network fetches to cache & serve.  we have cheaper  bandwidth, plus 
>do a lot of file monitoring / name abstraction that  amazon's network won't 
>support.  currently there are 10k documents on  s3, which are accessible via 
>150k+ 'keys'.   the cache basiscally  proxies the right doc for each key
>
>I'm running into 2 issues with it:
>         short term- keys are mapped to s3 files via a ton of 'hints' that i 
>store in bdb after fetching from postgresql.  the hints need to be 
>refreshed every 1-5 minutes or so.  does anyone have a good  suggestion on 
>how to do that?  i could do this really easily with  sqlite, but i need to 
>use bdb -- as sqlite isn't nearly fast enough;  while bdb is.
>
>         long term-    everything is fine for now -- we only have about 3gb 
>of data.  but thats going to be growing to about 20gb soon, and we  want to 
>limit the cache to an active 10gb using an Adaptive  Replacement Cache 
>algorithm with a bdb datastore.  has anyone done  something similar in 
>twisted or python in general?
>
>any input would be appreciated.  thanks!

Sounds like an interesting project.  With regards to bdb, in my experience
the Python bindings are very flaky, and the bdb API isn't very friendly in
the first place.  It is probably possible to write something that works on
bdb with Python, but it's pretty hard.  bdb does handle that scale well enough
though - I have a Twisted-based server running against a 21GB bdb database
at the moment (although we're trying to phase it out in favor of something
based on SQLite ;P).

Jean-Paul



From francisco.herrero at gmail.com  Thu Jun 14 15:51:34 2007
From: francisco.herrero at gmail.com (Francisco Herrero)
Date: Thu, 14 Jun 2007 16:51:34 -0300
Subject: [Twisted-Python] About transport.
Message-ID: <ccac7d280706141251p132bc6a3j7219d927fa5414af@mail.gmail.com>

Hello community. At first excuse me for my poor english, I'm from Argentina.


I am building a abstraction layer for different protocols of communication
for microcontrolled components simulation on a PC. That is CAN, Mil-1553 and
RS422.
First I m building a model width serial port. The idea is to connect via tcp
to this channel. I choose as a model the class internet.serialport. This
works fine but I do not know how to redirect the protocol of serialport to
the protocol of TCP port:

-----------------------
from rs232 import RS232Connector
from twisted.internet import reactor, protocol
from twisted.application import service, internet

class RS232Channel(protocol.Protocol):
    def dataReceived(self, data):
        print "CHAN:" + data
        self.factory.port.transport.write(data)

class RS232Port(protocol.Protocol):
    def dataReceived(self, data):
        print "PORT:" + data
        self.factory.channel.protocol.transport.write(data)

class RS232Factory(protocol.Factory):
    protocol = RS232Port

    def __init__(self):
        conf = {}
        self.port = RS232Port()
        self.channel = RS232Connector(self.port, conf, reactor)

if __name__ == '__main__':
    factory = RS232Factory()
    reactor.listenTCP(5001, factory)
    reactor.run()
--------------
this works fine when data is received from the tcp port, but when come data
from the serial port the program can't find the factory for RS232Channel
protocol instance. That is logical. I try to switch the transport but I
can't go so far...
Anyone can tell me how to connect this 2 protocols

Thanks

Francisco

-- 
"El hombre se descubre cuando se mide con un obst?culo"
(Saint Exup?ry)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070614/b01589ae/attachment.htm 

From zmola at acm.org  Thu Jun 14 15:54:26 2007
From: zmola at acm.org (Carl Zmola)
Date: Thu, 14 Jun 2007 15:54:26 -0400
Subject: [Twisted-Python] udp
In-Reply-To: <46719A37.1060504@clara.co.uk>
References: <46719A37.1060504@clara.co.uk>
Message-ID: <46719CF2.9000103@acm.org>

If you are not receiving datagrams on the client side, is there any 
reason to use twisted for the client side?  You could just pump 
datagrams out when you need to send something.


Bruce Coram wrote:
> How do you send data using udp?
>
> I want to use udp to send messages from clients to a server.  I don't
> want to use connected udp.
>
> Can anyone supply some specimen code for me
>
> Thanks
>
> Bruce Coram
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Thu Jun 14 15:59:02 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 14 Jun 2007 15:59:02 -0400
Subject: [Twisted-Python] udp
In-Reply-To: <46719A37.1060504@clara.co.uk>
Message-ID: <20070614195902.4947.33728736.divmod.quotient.1698@ohm>

On Thu, 14 Jun 2007 20:42:47 +0100, Bruce Coram <brucecoram at clara.co.uk> wrote:
>How do you send data using udp?
>
>I want to use udp to send messages from clients to a server.  I don't
>want to use connected udp.
>
>Can anyone supply some specimen code for me
>

Consider using TCP instead:

http://twistedmatrix.com/projects/core/documentation/howto/servers.html
http://twistedmatrix.com/projects/core/documentation/howto/clients.html

It's probably much better suited to your application than UDP.  However,
there is UDP documentation on the website as well:

http://twistedmatrix.com/projects/core/documentation/howto/udp.html

Jean-Paul



From wthie at thiengineering.ch  Thu Jun 14 16:27:00 2007
From: wthie at thiengineering.ch (Werner Thie)
Date: Thu, 14 Jun 2007 22:27:00 +0200
Subject: [Twisted-Python] Athena transport duplicate message
In-Reply-To: <7a01f6c00706140321w72e9023esf89a28e1c9363b6@mail.gmail.com>
References: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
	<7a01f6c00706140321w72e9023esf89a28e1c9363b6@mail.gmail.com>
Message-ID: <4671A494.80204@thiengineering.ch>

Calling client side methods results in the log message

'Athena transport duplicate message, discarding:'

I am aware that this is a nevow question, but maybe somebody knows an 
the answer on this list.

Thank you, Werner



From python at blackslens.com  Thu Jun 14 19:32:37 2007
From: python at blackslens.com (Black)
Date: Thu, 14 Jun 2007 19:32:37 -0400
Subject: [Twisted-Python] udp
In-Reply-To: <46719CF2.9000103@acm.org>
References: <46719A37.1060504@clara.co.uk> <46719CF2.9000103@acm.org>
Message-ID: <F7C41A5C-4E1D-4CA8-9713-EDE87A57FD25@blackslens.com>

Like Carl suggested, I just eschewed Twisted on the client side when  
I did something similar. Here is a simple client that can be used  
with the server I sent earlier.


import socket

s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
data = "Data from client"
s.sendto(data, ('localhost', 8000))
data,address = s.recvfrom(1024)
print "received %r from %r" % (data, address)



If you don't want the server to send anything back, you can skip the  
recvfrom() on the client side and the self.transport.write() on the  
server side. Of course, this doesn't include any error handling for  
when the UDP data doesn't actually make it (which, of course, isn't  
guaranteed) - but this is just to illustrate how simple it is.


-Black

On Jun 14, 2007, at 3:54 PM, Carl Zmola wrote:

> If you are not receiving datagrams on the client side, is there any  
> reason to use twisted for the client side?  You could just pump  
> datagrams out when you need to send something.
>
>
> Bruce Coram wrote:
>> How do you send data using udp?
>>
>> I want to use udp to send messages from clients to a server.  I don't
>> want to use connected udp.
>>
>> Can anyone supply some specimen code for me
>>
>> Thanks
>>
>> Bruce Coram
>>
>>
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From vovic at nfi.kiae.ru  Fri Jun 15 02:35:02 2007
From: vovic at nfi.kiae.ru (Voznesensky Vladimir)
Date: Fri, 15 Jun 2007 10:35:02 +0400
Subject: [Twisted-Python] caching suggestions
In-Reply-To: <BB643192-5115-4E2E-BB8D-C2D602B8E466@2xlp.com>
References: <BB643192-5115-4E2E-BB8D-C2D602B8E466@2xlp.com>
Message-ID: <web-2620192@newmail.nfi.kiae.ru>

Well, if you need a fast database, you can use in-memory
database like
http://www.ispras.ru/~knizhnik/fastdb.html
(it's written in C++ for C++, so you will need to develop 
a glue
layer from C to Python)
But note, that all of your data should fit in RAM in such 
case.
Also note, that embedded databases delivers some delays
during commits in calling threads, so you should handle 
that
issues too.

On Thu, 14 Jun 2007 15:29:08 -0400
  Jonathan Vanasco <twisted-python at 2xlp.com> wrote:
> note: this is less about twisted than a project i've 
>built on twisted  that is having some issues.  everyone 
>here is smart, so i thought  this would be a good list to 
>ask on.
> 
> i've got a small twisted daemon that is working as a 
>proxy for  hosting content that we store on amazon-s3
> long story short: archive to s3 (redundancy, cheap 
>storage), twisted  daemon on our network fetches to cache 
>& serve.  we have cheaper  bandwidth, plus do a lot of 
>file monitoring / name abstraction that  amazon's network 
>won't support.  currently there are 10k documents on  s3, 
>which are accessible via 150k+ 'keys'.   the cache 
>basiscally  proxies the right doc for each key
> 
> I'm running into 2 issues with it:
> 	short term- keys are mapped to s3 files via a ton of 
>'hints' that i  store in bdb after fetching from 
>postgresql.  the hints need to be  refreshed every 1-5 
>minutes or so.  does anyone have a good  suggestion on 
>how to do that?  i could do this really easily with 
> sqlite, but i need to use bdb -- as sqlite isn't nearly 
>fast enough;  while bdb is.
> 
> 	long term-    everything is fine for now -- we only 
>have about 3gb  of data.  but thats going to be growing 
>to about 20gb soon, and we  want to limit the cache to an 
>active 10gb using an Adaptive  Replacement Cache 
>algorithm with a bdb datastore.  has anyone done 
> something similar in twisted or python in general?
> 
> any input would be appreciated.  thanks!
> 
> // Jonathan Vanasco
> 
> | - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>- - - - - - -  - - - - - - - - - - - - - - - - - - -
> |   CEO/Founder SyndiClick Networks
> | - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>- - - - - - -  - - - - - - - - - - - - - - - - - - -
> |      FindMeOn.com - The cure for Multiple Web 
>Personality Disorder
> |      Web Identity Management and 3D Social Networking
> | - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>- - - - - - -  - - - - - - - - - - - - - - - - - - -
> |      RoadSound.com - Tools For Bands, Stuff For Fans
> |      Collaborative Online Management And Syndication 
>Tools
> | - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>- - - - - - -  - - - - - - - - - - - - - - - - - - -
> 
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From vovic at nfi.kiae.ru  Fri Jun 15 03:28:09 2007
From: vovic at nfi.kiae.ru (Voznesensky Vladimir)
Date: Fri, 15 Jun 2007 11:28:09 +0400
Subject: [Twisted-Python] SSL: wrong version number
In-Reply-To: <20070614192220.4947.817733265.divmod.quotient.1679@ohm>
References: <20070614192220.4947.817733265.divmod.quotient.1679@ohm>
Message-ID: <web-2620443@newmail.nfi.kiae.ru>

Dear Jean-Paul,

Here is a bug/feature demonstrating example:

---8<---
from twisted.python.util import println

from twisted.protocols.basic import LineReceiver
from twisted.internet import protocol, reactor, defer, ssl
from twisted.python.failure import Failure
from OpenSSL import crypto, SSL

_CMD="""VERSION=MYPROXYv2
COMMAND=%d
USERNAME=%s
PASSPHRASE=%s
LIFETIME=%d\0""" % (0, "LOGIN", 'PASSPHRASE', 100)
WHERETO = ("myproxy.cern.ch",7512)

## Myproxy client protocol.
class MyproxyClient(protocol.Protocol):

   def connectionMade(self):
     self.transport.write('0')   # GT compat. stuff.
     self.transport.write(_CMD)

   def dataReceived(self, data):
     self.transport.loseConnection()

   def connectionLost(self, 
reason=protocol.connectionDone):
     d = self.factory.deferred
     if reason != protocol.connectionDone:
       d.errback(reason)
     else:
       d.callback(data)

## Myproxy client factory.
class MyproxyClientFactory(protocol.ClientFactory):
   protocol = MyproxyClient

   def __init__(self):
     self.deferred = defer.Deferred()

   def clientConnectionFailed(self, connector, reason):
     self.deferred.errback(reason)

## Context factory suitable for local needs.
class CF:
   def getContext(self):
     ctx = SSL.Context(SSL.SSLv3_METHOD)
     # disable for compatibility with myproxy server (er, 
globus)
     # globus doesn't handle this case, apparently, and 
instead
     # chokes in proxy delegation code
     ctx.set_options(0x00000800L)

     return ctx

ctx = CF().getContext()
import socket
conn = SSL.Connection(ctx,socket.socket())
conn.connect(WHERETO)
conn.write('0')
conn.write(_CMD)
dat = conn.recv(8192)
print 'data received by blocking call\n', dat
conn.close()
del ctx

f = MyproxyClientFactory()
contextFactory = CF()
reactor.connectSSL(WHERETO[0], WHERETO[1], f, 
contextFactory)
f.deferred.addCallbacks(
       callback=lambda data:(println("data received", 
data),reactor.stop()),
       errback=lambda error:(println("an error occurred", 
error),reactor.stop()))
reactor.run()
---8<---

Yours,
VV

On Thu, 14 Jun 2007 15:22:20 -0400
  Jean-Paul Calderone <exarkun at divmod.com> wrote:
> On Thu, 14 Jun 2007 15:08:06 -0400, Jean-Paul Calderone 
><exarkun at divmod.com> wrote:
>>
>>The server is using SSLv2.  The traceback seems to 
>>indicate the context is
>>set up for SSLv3.  I can't tell how you created that 
>>context object, nor am
>>I certain why one version of your code can establish a 
>>connection while the
>>other cannot, but I would check the context object and 
>>make sure it is using
>>either SSLv2 or SSLv23.
>>
> 
> Oh, I should also say that SSLv2 is insecure and, if you 
>can, you should
> really change that server to use at least SSLv3.
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From wgwigw at gmail.com  Sat Jun 16 06:21:56 2007
From: wgwigw at gmail.com (wang wei)
Date: Sat, 16 Jun 2007 18:21:56 +0800
Subject: [Twisted-Python] twisted and performance
In-Reply-To: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
References: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
Message-ID: <dbeb95830706160321h7b6e0574iaad79bf7412d4b41@mail.gmail.com>

I come from China too:)
I think u need a way to monitor your application, which parts costs how much
time. then u get the idea. if we have to guess, I think there're may be
database performance issues too. we build a appliction a year ago, after
change the database indexes the appliction become acceptable.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070616/3f3f0f14/attachment.htm 

From exarkun at twistedmatrix.com  Sun Jun 17 00:05:02 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 17 Jun 2007 04:05:02 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1182053102.09.330778678@twistedmatrix.com

Bug summary
______________________
Summary for 2007-06-10 through 2007-06-17
Bugs opened: 4    Bugs closed: 6  Total open bugs: 972 (-2)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       -4  |Highest:  -1          |Core:     +1           
|Enhancement:  +3  |High:     -1          |Mail:     -2           
                   |Normal:   +1          |Web2:     -1           
                                          |Website:  +0           
                                          |Words:    +1           


New / Reopened Bugs
______________________
                    ===== Highest =====
[#2703] assertWarns has some restrictions (opened by therve)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2703

[#2502] 'and' and 'or' operator suport for xpath (opened by jack)
    enhancement     words      http://twistedmatrix.com/trac/ticket/2502

                    ===== Normal =====
[#2704] Link to Twisted coding standard is broken (opened by mesozoic) (CLOSED, fixed)
    defect          website    http://twistedmatrix.com/trac/ticket/2704

[#2705] t.web2.http Request.writeResponse should set content-length to 0 on NO_CONTENT responses (opened by terrycojones)
    defect          web2       http://twistedmatrix.com/trac/ticket/2705



Closed Bugs
______________________
                    ===== Highest =====
[#2702] twisted.words.xish.yappsrt.Scanner.__init__ is  not proper epytext (opened by therve, closed by ralphm, duplicate)
    defect          words      http://twistedmatrix.com/trac/ticket/2702

[#2700] IMAP4Client.lineReceived() fails to parse literals (opened by jenner, closed by exarkun, fixed)
    defect          mail       http://twistedmatrix.com/trac/ticket/2700

[#2695] IMAP4Client breaks if server uses CONDSTORE (opened by slamb, closed by exarkun, fixed)
    defect          mail       http://twistedmatrix.com/trac/ticket/2695

[#2075] set SCRIPT_NAME (properly?) in CGI environment (opened by martinpaljak, closed by dialtone, fixed)
    defect          web2       http://twistedmatrix.com/trac/ticket/2075

                    ===== High =====
[#1979] FileSaver replaces LF with CRLF (opened by agreif, closed by dialtone, fixed)
    defect          web2       http://twistedmatrix.com/trac/ticket/1979

                    ===== Normal =====
[#2704] Link to Twisted coding standard is broken (opened by mesozoic, closed by glyph, fixed)
    defect          website    http://twistedmatrix.com/trac/ticket/2704





From tom.cocagne at gmail.com  Sun Jun 17 00:12:09 2007
From: tom.cocagne at gmail.com (Tom Cocagne)
Date: Sun, 17 Jun 2007 00:12:09 -0400
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
Message-ID: <198edda90706162112p453d00d4j2b6b11dcd2a7ef32@mail.gmail.com>

    I'm not sure if it's sufficient for your needs since it doesn't have any
direct Protocol or Reactor support but a C++ implementation of the Deferred
pattern does exist. I've just recently cleaned up the code & documentation
to the point where I would no longer be embarassed to release it.
Unfortunately though, actually getting it released it is going to be a bit
more complicated than simply attaching the zip file to an e-mail. Apparently
the process for releasing software developed by the US Department of Defense
is poorly understood and no-one I work with has ever tried to do it. In the
end, I'll get it released but it'll probably take several weeks to navigate
the bureaucracy.

    I'll make a post on this list announcing it's availability once I get
through all the red tape. Even if it arrives too late for use in your
project, as I suspect it probably will, I'm sure there will be plenty of
future requests similar to yours. And, I'm sure that there are plenty of
people in the Twisted community that do C++ development and would love to
have that particularly handy tool in their back pocket ;-)

    Cheers,

    Tom

On 6/12/07, Amaury Forgeot d'Arc <amauryfa at gmail.com> wrote:
>
> Hello,
>
> I love python and I find twisted fantastic, but here I have to write a
> C++ application, for performance pseudo-reasons :-(
>
> I was looking for a Twisted-like framework in C++.
> Do you know if such a library exists?
>
> ACE seems to provide powerful tools for networking, but I could not
> find something like Protocols and Deferred.
>
> Or is the twisted approach not recommended for C++?
>
> --
> Amaury Forgeot d'Arc
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070617/7fd5c62d/attachment.htm 

From itamar at itamarst.org  Sun Jun 17 13:28:20 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 17 Jun 2007 13:28:20 -0400
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <198edda90706162112p453d00d4j2b6b11dcd2a7ef32@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<198edda90706162112p453d00d4j2b6b11dcd2a7ef32@mail.gmail.com>
Message-ID: <1182101300.22443.22.camel@localhost.localdomain>

You can use Fusion (http://itamarst.org/software/) to *extend* Twisted
in C++ (Linux only currently, with a little patching should work on Mac
OS X.) But it still requires Twisted, of course.




From lists at collab.nl  Sun Jun 17 18:59:33 2007
From: lists at collab.nl (Thijs Triemstra | Collab)
Date: Mon, 18 Jun 2007 00:59:33 +0200
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <28012bc60706120506t44ef5e0dx4697b5863b2c746a@mail.gmail.com>
References: <28012bc60706120506t44ef5e0dx4697b5863b2c746a@mail.gmail.com>
Message-ID: <C5FFEE14-F708-4C30-B259-45EDF4F02A96@collab.nl>

FYI, we started coding, check out http://dev.collab.com/twisted-rtmp/  
for more info.

Thijs

On Jun 12, 2007, at 2:06 PM, Arnar Birgisson wrote:

> Hi all,
>
> Re. this message:
> http://twistedmatrix.com/pipermail/twisted-python/2007-May/015373.html
>
> Has any work been done here? I'm facing a project that requires
> two-way communication between a Flex/Apollo app and a Twisted server.
> In my initial tests I used http and comet-like techniques but I'm not
> sure they are the most efficient way.
>
> I'm willing to help with the project - I've already dabbled a little
> in the DjangoAMF stuff.
>
> Arnar
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Sun Jun 17 19:36:56 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 17 Jun 2007 19:36:56 -0400
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <C5FFEE14-F708-4C30-B259-45EDF4F02A96@collab.nl>
Message-ID: <20070617233656.4947.1244192357.divmod.quotient.2279@ohm>

On Mon, 18 Jun 2007 00:59:33 +0200, Thijs Triemstra | Collab <lists at collab.nl> wrote:
>FYI, we started coding, check out http://dev.collab.com/twisted-rtmp/  for 
>more info.
>
>Thijs
>

Looks cool.  It's nice you've got examples up already :)

I hate to have to ask, but could you change the name of the project to
not include "twisted" and take the Twisted logo down?  These are marks
of the Twisted Matrix Labs team.  They aren't for general use by projects
which make use of or otherwise depend on Twisted.

Thanks,

Jean-Paul



From lists at collab.nl  Sun Jun 17 20:41:15 2007
From: lists at collab.nl (Thijs Triemstra | Collab)
Date: Mon, 18 Jun 2007 02:41:15 +0200
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <20070617233656.4947.1244192357.divmod.quotient.2279@ohm>
References: <20070617233656.4947.1244192357.divmod.quotient.2279@ohm>
Message-ID: <A3F520F1-B083-4DA9-A581-2234752CFE44@collab.nl>

Hi Jean-Paul,

> I hate to have to ask, but could you change the name of the project to
> not include "twisted" and take the Twisted logo down?  These are marks
> of the Twisted Matrix Labs team.  They aren't for general use by  
> projects
> which make use of or otherwise depend on Twisted.

Ah ok, sorry about that. The name changed and the project can now be  
found on http://dev.collab.com/rtmpy

Thijs



From exarkun at divmod.com  Sun Jun 17 22:23:44 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 17 Jun 2007 22:23:44 -0400
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <A3F520F1-B083-4DA9-A581-2234752CFE44@collab.nl>
Message-ID: <20070618022344.4947.170473162.divmod.quotient.2321@ohm>

On Mon, 18 Jun 2007 02:41:15 +0200, Thijs Triemstra | Collab <lists at collab.nl> wrote:
>Hi Jean-Paul,
>>I hate to have to ask, but could you change the name of the project to
>>not include "twisted" and take the Twisted logo down?  These are marks
>>of the Twisted Matrix Labs team.  They aren't for general use by  projects
>>which make use of or otherwise depend on Twisted.
>
>Ah ok, sorry about that. The name changed and the project can now be  found 
>on http://dev.collab.com/rtmpy
>

Thanks :)




From littlesweetmelon at gmail.com  Mon Jun 18 02:37:34 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Mon, 18 Jun 2007 14:37:34 +0800
Subject: [twisted-python] Communication between GUI thread and twisted thread.
Message-ID: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>

Hi, my program has two parts running in two threads. One is a GUI
layer, the other is a twisted layer for communication with a remote
server. Sometimes, a button is clicked in GUI to notice the twisted
thread to send out some data. (reactor.callFromThread should be used,
right?)

In twisted part, I use reactor.connectTCP('x.x.x.x', port,
MyFactory()) to connect with remote server. MyFactory will create an
instance of MyProtocol, and MyProtocol has a method 'sendSpecialMsg'
for doing real jobs.

However, in GUI part, how can I invoke 'sendSpecialMsg' function? Even
I cannot get the MyProtocol instance! Because connectTCP and MyFactory
hide the protocol object. I'm sure it is a common problem for
beginners, Could you give me some advice?

Thank you.
---
ShenLei



From andrew-twisted at puzzling.org  Mon Jun 18 02:58:25 2007
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 18 Jun 2007 16:58:25 +1000
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
Message-ID: <20070618065825.GS7691@steerpike.home.puzzling.org>

?? wrote:
> Hi, my program has two parts running in two threads. One is a GUI
> layer, the other is a twisted layer for communication with a remote
> server. Sometimes, a button is clicked in GUI to notice the twisted
> thread to send out some data. (reactor.callFromThread should be used,
> right?)
> 
> In twisted part, I use reactor.connectTCP('x.x.x.x', port,
> MyFactory()) to connect with remote server. MyFactory will create an
> instance of MyProtocol, and MyProtocol has a method 'sendSpecialMsg'
> for doing real jobs.
> 
> However, in GUI part, how can I invoke 'sendSpecialMsg' function? Even
> I cannot get the MyProtocol instance! Because connectTCP and MyFactory
> hide the protocol object. I'm sure it is a common problem for
> beginners, Could you give me some advice?

Something like ClientCreator (a convenient way to connect and get a protocol
instance when it is connected) with blockingCallFromThread (in SVN Twisted, so
the calling thread can get access to the result of the deferred from
ClientCreator) would probably do the trick.

If these aren't directly usable, you may find inspiration from looking at their
implementations.

-Andrew.




From littlesweetmelon at gmail.com  Mon Jun 18 03:22:41 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Mon, 18 Jun 2007 15:22:41 +0800
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <20070618065825.GS7691@steerpike.home.puzzling.org>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<20070618065825.GS7691@steerpike.home.puzzling.org>
Message-ID: <cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>

Thank you for your kind reply.

> Something like ClientCreator (a convenient way to connect and get a protocol
> instance when it is connected) with blockingCallFromThread (in SVN Twisted, so
> the calling thread can get access to the result of the deferred from
> ClientCreator) would probably do the trick.
>

ClientCreator is not proper for my case, because I need the re-connect ability.

Well, actually, my project is based on this article:
http://solipsis.netofpeers.com/wiki2/index.php/WxPython_And_Twisted_Example
a VERY GOOD implementation for cooperation between wx and twisted.
The hard nut is how to make DaemonLoop know the protocol instance
which is connecting to the remote server.  ^_^

---
ShenLei



From arkanes at gmail.com  Mon Jun 18 09:31:06 2007
From: arkanes at gmail.com (Chris Mellon)
Date: Mon, 18 Jun 2007 08:31:06 -0500
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<20070618065825.GS7691@steerpike.home.puzzling.org>
	<cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>
Message-ID: <4866bea60706180631ja325ea1n125f4182440ee3aa@mail.gmail.com>

On 6/18/07, ?? <littlesweetmelon at gmail.com> wrote:
> Thank you for your kind reply.
>
> > Something like ClientCreator (a convenient way to connect and get a protocol
> > instance when it is connected) with blockingCallFromThread (in SVN Twisted, so
> > the calling thread can get access to the result of the deferred from
> > ClientCreator) would probably do the trick.
> >
>
> ClientCreator is not proper for my case, because I need the re-connect ability.
>
> Well, actually, my project is based on this article:
> http://solipsis.netofpeers.com/wiki2/index.php/WxPython_And_Twisted_Example
> a VERY GOOD implementation for cooperation between wx and twisted.
> The hard nut is how to make DaemonLoop know the protocol instance
> which is connecting to the remote server.  ^_^
>
> ---

This is a terrible implementation for cooperation between wx and
twisted. At the time it was written, it was acceptable, but you really
should be using the wxreactor now.



From itamar at itamarst.org  Mon Jun 18 10:00:03 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 18 Jun 2007 10:00:03 -0400
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
Message-ID: <1182175203.22443.33.camel@localhost.localdomain>

On Mon, 2007-06-18 at 14:37 +0800, ?? wrote:
> Hi, my program has two parts running in two threads. One is a GUI
> layer, the other is a twisted layer for communication with a remote
> server. 

If you're using a GUI supported by Twisted (Qt3, GTK, wxPython, tkinter)
you don't need two threads:
http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html




From francisco.herrero at gmail.com  Mon Jun 18 10:47:19 2007
From: francisco.herrero at gmail.com (Francisco Herrero)
Date: Mon, 18 Jun 2007 11:47:19 -0300
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<20070618065825.GS7691@steerpike.home.puzzling.org>
	<cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>
Message-ID: <ccac7d280706180747n58aae29ei4a666faadee49f33@mail.gmail.com>

>
>
>
> ClientCreator is not proper for my case, because I need the re-connect
> ability.
>
>
>
I made a tricky for access to the protocol instance created, but I don't
know if this is sane for the structure of twisted. Is something like this:
----------
class P(Protocol):
    def connectionMade(self):
        self.factory.instance = self
        return
    ...

    def connectionLost(self):
        self.factory.instance = None

class F(Factory):
    protocol = P
    instance = None
    ...
----------
then you can access to protocol instance inside the factory, if it's not
None.
If somebody see an inconsistency or a better sugestion please let me know.

Francisco
-- 
"El hombre se descubre cuando se mide con un obst?culo"
(Saint Exup?ry)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070618/9907c8c8/attachment.htm 

From general at eepatents.com  Mon Jun 18 10:48:23 2007
From: general at eepatents.com (Ed Suominen)
Date: Mon, 18 Jun 2007 07:48:23 -0700
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <1182175203.22443.33.camel@localhost.localdomain>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<1182175203.22443.33.camel@localhost.localdomain>
Message-ID: <46769B37.6080708@eepatents.com>

Itamar Shtull-Trauring wrote:
> On Mon, 2007-06-18 at 14:37 +0800, ?? wrote:
>> Hi, my program has two parts running in two threads. One is a GUI
>> layer, the other is a twisted layer for communication with a remote
>> server. 
> 
> If you're using a GUI supported by Twisted (Qt3, GTK, wxPython, tkinter)
> you don't need two threads:
> http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html

Indeed, I have found Twisted's asynchronous processing to make GUI
programming much more intuitive and powerful. (I use PyQt, personally.)
To a computer, a user is as much a deferrable input source as is a
network connection.

Best regards, Ed



From littlesweetmelon at gmail.com  Mon Jun 18 11:10:54 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Mon, 18 Jun 2007 23:10:54 +0800
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <46769B37.6080708@eepatents.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<1182175203.22443.33.camel@localhost.localdomain>
	<46769B37.6080708@eepatents.com>
Message-ID: <cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>

> This is a terrible implementation for cooperation between wx and
> twisted. At the time it was written, it was acceptable, but you really
> should be using the wxreactor now.
Really? Oh! Maybe my knowledge is out of date. My opinion comes from
"The Twisted Documentation - Jan 9, 2007". It says:
"Twisted currently supports two methods of integrating wxPython.
Unfortunately, neither method will work on all wxPython platforms
(such as GTK2 or Windows). It seems that the only portable way to
integrate with wxPython is to run it in a separate thread."  ^_^
Therefore I followed that terrible implementation. Does wxreactor get
improvement? I will read 'choosing-reactor.html' throughly. Thank you.

> class P(Protocol):
>     def connectionMade(self):
>         self.factory.instance = self
>         return
Actually, I use the same trick now for workaround.  ^_^

---
ShenLei



From stephen.c.waterbury at nasa.gov  Mon Jun 18 11:21:58 2007
From: stephen.c.waterbury at nasa.gov (Stephen Waterbury)
Date: Mon, 18 Jun 2007 11:21:58 -0400
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>	<1182175203.22443.33.camel@localhost.localdomain>	<46769B37.6080708@eepatents.com>
	<cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>
Message-ID: <4676A316.9020308@nasa.gov>

?? wrote:
>> This is a terrible implementation for cooperation between wx and
>> twisted. At the time it was written, it was acceptable, but you really
>> should be using the wxreactor now.
> Really? Oh! Maybe my knowledge is out of date. My opinion comes from
> "The Twisted Documentation - Jan 9, 2007". It says:
> "Twisted currently supports two methods of integrating wxPython.
> Unfortunately, neither method will work on all wxPython platforms
> (such as GTK2 or Windows). It seems that the only portable way to
> integrate with wxPython is to run it in a separate thread."  ^_^
> Therefore I followed that terrible implementation. Does wxreactor get
> improvement? I will read 'choosing-reactor.html' throughly. Thank you.

That section of the docs has not changed (current svn), and I
agree it's rather confusing to determine what the actual
recommendation is.  My impression was that the most recent
implementation of the wxreactor is supposed to work on all
platforms.  Is that not so?  If it is, this section of the
docs should probably be revised to recommend it more clearly.

Steve
-- 
"The opinions expressed above do not reflect official NASA policies
  or positions, and have not been reviewed by any Government authority."




From arkanes at gmail.com  Mon Jun 18 11:32:50 2007
From: arkanes at gmail.com (Chris Mellon)
Date: Mon, 18 Jun 2007 10:32:50 -0500
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<1182175203.22443.33.camel@localhost.localdomain>
	<46769B37.6080708@eepatents.com>
	<cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>
Message-ID: <4866bea60706180832t58acfcbfp2f4834dc74307ae2@mail.gmail.com>

On 6/18/07, ?? <littlesweetmelon at gmail.com> wrote:
> > This is a terrible implementation for cooperation between wx and
> > twisted. At the time it was written, it was acceptable, but you really
> > should be using the wxreactor now.
> Really? Oh! Maybe my knowledge is out of date. My opinion comes from
> "The Twisted Documentation - Jan 9, 2007". It says:
> "Twisted currently supports two methods of integrating wxPython.
> Unfortunately, neither method will work on all wxPython platforms
> (such as GTK2 or Windows). It seems that the only portable way to
> integrate with wxPython is to run it in a separate thread."  ^_^
> Therefore I followed that terrible implementation. Does wxreactor get
> improvement? I will read 'choosing-reactor.html' throughly. Thank you.
>

The docs are out of date in this case. Or rather, they are correct,
but incomplete - Twisted now has support for a threaded reactor, and
wxreactor has been updated to use this support, so the integration is
now (mostly) seamless.



From exarkun at divmod.com  Mon Jun 18 11:34:26 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 18 Jun 2007 11:34:26 -0400
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <4676A316.9020308@nasa.gov>
Message-ID: <20070618153426.4947.1825384414.divmod.quotient.2433@ohm>

On Mon, 18 Jun 2007 11:21:58 -0400, Stephen Waterbury <stephen.c.waterbury at nasa.gov> wrote:
>?? wrote:
>>>This is a terrible implementation for cooperation between wx and
>>>twisted. At the time it was written, it was acceptable, but you really
>>>should be using the wxreactor now.
>>Really? Oh! Maybe my knowledge is out of date. My opinion comes from
>>"The Twisted Documentation - Jan 9, 2007". It says:
>>"Twisted currently supports two methods of integrating wxPython.
>>Unfortunately, neither method will work on all wxPython platforms
>>(such as GTK2 or Windows). It seems that the only portable way to
>>integrate with wxPython is to run it in a separate thread."  ^_^
>>Therefore I followed that terrible implementation. Does wxreactor get
>>improvement? I will read 'choosing-reactor.html' throughly. Thank you.
>
>That section of the docs has not changed (current svn), and I
>agree it's rather confusing to determine what the actual
>recommendation is.  My impression was that the most recent
>implementation of the wxreactor is supposed to work on all
>platforms.  Is that not so?  If it is, this section of the
>docs should probably be revised to recommend it more clearly.
>

It's so that wxreactor has been improved somewhat and that section
of the documentation should be updated.  However, for anyone seeking
a recommendation, I will happily suggest PyGtk. ;)

Jean-Paul



From exarkun at divmod.com  Mon Jun 18 11:38:10 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 18 Jun 2007 11:38:10 -0400
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <4866bea60706180832t58acfcbfp2f4834dc74307ae2@mail.gmail.com>
Message-ID: <20070618153810.4947.98288963.divmod.quotient.2434@ohm>

On Mon, 18 Jun 2007 10:32:50 -0500, Chris Mellon <arkanes at gmail.com> wrote:
>On 6/18/07, ?? <littlesweetmelon at gmail.com> wrote:
>> > This is a terrible implementation for cooperation between wx and
>> > twisted. At the time it was written, it was acceptable, but you really
>> > should be using the wxreactor now.
>>Really? Oh! Maybe my knowledge is out of date. My opinion comes from
>>"The Twisted Documentation - Jan 9, 2007". It says:
>>"Twisted currently supports two methods of integrating wxPython.
>>Unfortunately, neither method will work on all wxPython platforms
>>(such as GTK2 or Windows). It seems that the only portable way to
>>integrate with wxPython is to run it in a separate thread."  ^_^
>>Therefore I followed that terrible implementation. Does wxreactor get
>>improvement? I will read 'choosing-reactor.html' throughly. Thank you.
>
>The docs are out of date in this case. Or rather, they are correct,
>but incomplete - Twisted now has support for a threaded reactor, and
>wxreactor has been updated to use this support, so the integration is
>now (mostly) seamless.
>

To nit pick, http://twistedmatrix.com/buildbot-supported/ shows what
Twisted has support for.  What Twisted has for wx is "code".  If you're
lucky, it might even behave in a useful manner for your particular
application. ;)

For anyone interested in something that might be called "support", please
get involved in Twisted development and contribute effort to finishing
wxreactor.

Jean-Paul



From vovic at nfi.kiae.ru  Mon Jun 18 10:49:26 2007
From: vovic at nfi.kiae.ru (Voznesensky Vladimir)
Date: Mon, 18 Jun 2007 18:49:26 +0400
Subject: [Twisted-Python] Strange SSL behaviour.
Message-ID: <web-2635366@newmail.nfi.kiae.ru>

Dear all!

I have a bug demonstration code.
Blocking SSL works where Twisted one does not.
It is below.
How should I handle this case?
Can anybody tell me what to do with this bug?
I can dig into twisted sources, but I'm not a
twisted specialist, so it could take weeks to
boil them to get the dirt.
Help me, please.

Thank you.
VV

---8<---
from twisted.python.util import println

from twisted.protocols.basic import LineReceiver
from twisted.internet import protocol, reactor, defer, ssl
from twisted.python.failure import Failure
from OpenSSL import crypto, SSL

_CMD="""VERSION=MYPROXYv2
COMMAND=%d
USERNAME=%s
PASSPHRASE=%s
LIFETIME=%d\0""" % (0, "LOGIN", 'PASSPHRASE', 100)
WHERETO = ("myproxy.cern.ch",7512)

## Myproxy client protocol.
class MyproxyClient(protocol.Protocol):

   def connectionMade(self):
     self.transport.write('0') # GT compat. stuff.
     self.transport.write(_CMD)

   def dataReceived(self, data):
     self.transport.loseConnection()

   def connectionLost(self, 
reason=protocol.connectionDone):
     d = self.factory.deferred
     if reason != protocol.connectionDone:
       d.errback(reason)
     else:
       d.callback(data)

## Myproxy client factory.
class MyproxyClientFactory(protocol.ClientFactory):
   protocol = MyproxyClient

   def __init__(self):
     self.deferred = defer.Deferred()

   def clientConnectionFailed(self, connector, reason):
     self.deferred.errback(reason)

## Context factory suitable for local needs.
class CF:
   def getContext(self):
     ctx = SSL.Context(SSL.SSLv3_METHOD)
     # disable for compatibility with myproxy server (er, 
globus)
     # globus doesn't handle this case, apparently, and 
instead
     # chokes in proxy delegation code
     ctx.set_options(0x00000800L)

     return ctx

ctx = CF().getContext()
import socket
conn = SSL.Connection(ctx,socket.socket())
conn.connect(WHERETO)
conn.write('0')
conn.write(_CMD)
dat = conn.recv(8192)
print 'data received by blocking call\n', dat
conn.close()
del ctx

f = MyproxyClientFactory()
contextFactory = CF()
reactor.connectSSL(WHERETO[0], WHERETO[1], f, 
contextFactory)
f.deferred.addCallbacks(
       callback=lambda data:(println("data received", 
data),reactor.stop()),
       errback=lambda error:(println("an error occurred", 
error),reactor.stop()))
reactor.run()
---8<---

Yours,
VV



From glyph at divmod.com  Mon Jun 18 13:05:34 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Mon, 18 Jun 2007 17:05:34 -0000
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <20070618022344.4947.170473162.divmod.quotient.2321@ohm>
References: <A3F520F1-B083-4DA9-A581-2234752CFE44@collab.nl>
	<20070618022344.4947.170473162.divmod.quotient.2321@ohm>
Message-ID: <20070618170534.31981.1808740575.divmod.xquotient.17@joule.divmod.com>

On 02:23 am, exarkun at divmod.com wrote:
>On Mon, 18 Jun 2007 02:41:15 +0200, Thijs Triemstra | Collab 
><lists at collab.nl> wrote:
>>Hi Jean-Paul,
>>>I hate to have to ask, but could you change the name of the project 
>>>to
>>>not include "twisted" and take the Twisted logo down?  These are 
>>>marks
>>>of the Twisted Matrix Labs team.  They aren't for general use by 
>>>projects
>>>which make use of or otherwise depend on Twisted.
>>
>>Ah ok, sorry about that. The name changed and the project can now be 
>>found on http://dev.collab.com/rtmpy
>
>Thanks :)

Thanks, too, for changing this so readily :).

It makes me think, though, that maybe we should have a suggested prefix 
for things-which-use-Twisted, since "py" is a little confusing there. 
Python has PyXXX, maybe Twisted should have TwiXXX or similar?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070618/cfdf4182/attachment.htm 

From exarkun at divmod.com  Mon Jun 18 13:33:29 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 18 Jun 2007 13:33:29 -0400
Subject: [Twisted-Python] Strange SSL behaviour.
In-Reply-To: <web-2635366@newmail.nfi.kiae.ru>
Message-ID: <20070618173329.4947.2055261392.divmod.quotient.2448@ohm>

On Mon, 18 Jun 2007 18:49:26 +0400, Voznesensky Vladimir <vovic at nfi.kiae.ru> wrote:
>Dear all!
>
>I have a bug demonstration code.
>Blocking SSL works where Twisted one does not.
>It is below.
>How should I handle this case?
>Can anybody tell me what to do with this bug?
>I can dig into twisted sources, but I'm not a
>twisted specialist, so it could take weeks to
>boil them to get the dirt.
>Help me, please.
>

Hey,

I took a look at your sample code a few days ago and
nothing struck me as being the cause of this behavior.
I just took another look and it still seems like this
shouldn't be happening, although I noticed a few other
miscellaneous problems with the Twisted client (none
would manifest until it managed to get further than it
does, though).

Next I did a capture with ethereal and I noticed that
the server is actually sending back unencrypted bytes
in response to 0 + _CMD.  It's not clear why it would
reliably do this for the Twisted client and not for the
version which directly uses OpenSSL, unless it is somehow
timing related.

I suppose at this point I'd check into the server's
behavior to verify this observation and try to determine
why it is behaving this way.

Jean-Paul



From vovic at nfi.kiae.ru  Mon Jun 18 14:29:34 2007
From: vovic at nfi.kiae.ru (Vladimir Voznesensky)
Date: Mon, 18 Jun 2007 22:29:34 +0400
Subject: [Twisted-Python] Strange SSL behaviour.
In-Reply-To: <20070618173329.4947.2055261392.divmod.quotient.2448@ohm>
References: <20070618173329.4947.2055261392.divmod.quotient.2448@ohm>
Message-ID: <4676CF0E.2020605@nfi.kiae.ru>

Hi,

Is it possible that Twisted changes some flags in the security context?

VV

Jean-Paul Calderone wrote:
>
> Next I did a capture with ethereal and I noticed that
> the server is actually sending back unencrypted bytes
> in response to 0 + _CMD.  It's not clear why it would
> reliably do this for the Twisted client and not for the
> version which directly uses OpenSSL, unless it is somehow
> timing related.
>
> I suppose at this point I'd check into the server's
> behavior to verify this observation and try to determine
> why it is behaving this way.
>
> Jean-Paul
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Mon Jun 18 15:11:45 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 18 Jun 2007 15:11:45 -0400
Subject: [Twisted-Python] Strange SSL behaviour.
In-Reply-To: <4676CF0E.2020605@nfi.kiae.ru>
Message-ID: <20070618191145.4947.513785742.divmod.quotient.2477@ohm>

On Mon, 18 Jun 2007 22:29:34 +0400, Vladimir Voznesensky <vovic at nfi.kiae.ru> wrote:
>Hi,
>
>Is it possible that Twisted changes some flags in the security context?
>

Nope.  The context returned by getContext is passed directly to
SSL.Connection without modification.

Jean-Paul



From brucecoram at clara.co.uk  Wed Jun 20 05:29:20 2007
From: brucecoram at clara.co.uk (Bruce Coram)
Date: Wed, 20 Jun 2007 10:29:20 +0100
Subject: [Twisted-Python] udp
In-Reply-To: <F7C41A5C-4E1D-4CA8-9713-EDE87A57FD25@blackslens.com>
References: <46719A37.1060504@clara.co.uk> <46719CF2.9000103@acm.org>
	<F7C41A5C-4E1D-4CA8-9713-EDE87A57FD25@blackslens.com>
Message-ID: <4678F370.7020406@clara.co.uk>

Many thanks for the help.  I had hoped to be able to use Twisted's udp 
but it makes no real difference.

Thanks

Bruce
> Like Carl suggested, I just eschewed Twisted on the client side when I 
> did something similar. Here is a simple client that can be used with 
> the server I sent earlier.
>
>
> import socket
>
> s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
> data = "Data from client"
> s.sendto(data, ('localhost', 8000))
> data,address = s.recvfrom(1024)
> print "received %r from %r" % (data, address)
>
>
>
> If you don't want the server to send anything back, you can skip the 
> recvfrom() on the client side and the self.transport.write() on the 
> server side. Of course, this doesn't include any error handling for 
> when the UDP data doesn't actually make it (which, of course, isn't 
> guaranteed) - but this is just to illustrate how simple it is.
>
>
> -Black
>
> On Jun 14, 2007, at 3:54 PM, Carl Zmola wrote:
>
>> If you are not receiving datagrams on the client side, is there any 
>> reason to use twisted for the client side?  You could just pump 
>> datagrams out when you need to send something.
>>
>>
>> Bruce Coram wrote:
>>> How do you send data using udp?
>>>
>>> I want to use udp to send messages from clients to a server.  I don't
>>> want to use connected udp.
>>>
>>> Can anyone supply some specimen code for me
>>>
>>> Thanks
>>>
>>> Bruce Coram
>>>
>>>
>>>
>>> _______________________________________________
>>> Twisted-Python mailing list
>>> Twisted-Python at twistedmatrix.com
>>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>
>





From slowtech.chen at yahoo.com  Wed Jun 20 06:35:37 2007
From: slowtech.chen at yahoo.com (slowtech chen)
Date: Wed, 20 Jun 2007 03:35:37 -0700 (PDT)
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
Message-ID: <981709.63531.qm@web59107.mail.re1.yahoo.com>

I have 2 clients, one gets a message from a server, once I get the message, I want to send it with the other client to another server. how can i do this?  can I add some customized events and notice the other client? Thanks.

       
---------------------------------
Get the free Yahoo! toolbar and rest assured with the added security of spyware protection. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070620/dbdf881c/attachment.htm 

From exarkun at divmod.com  Wed Jun 20 07:38:51 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 20 Jun 2007 07:38:51 -0400
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
In-Reply-To: <981709.63531.qm@web59107.mail.re1.yahoo.com>
Message-ID: <20070620113851.4947.1355240853.divmod.quotient.3016@ohm>

On Wed, 20 Jun 2007 03:35:37 -0700 (PDT), slowtech chen <slowtech.chen at yahoo.com> wrote:
>I have 2 clients, one gets a message from a server, once I get the message, I want to send it with the other client to another server. how can i do this?  can I add some customized events and notice the other client? Thanks.

You need to build this system yourself.  Any protocol instance which needs to
be able to interact with another protocol instance needs a reference to that
other protocol instance, either directly (for example, as an attribute on
itself) or indirectly (for example, as an attribute on its factory).  With
this, methods on the other protocol instance can be invoked to send messages.
Here's a trivial example:

    from twisted.internet.protocol import Protocol, ServerFactory
    from twisted.trial.unittest import TestCase


    class BroadcastProtocol(Protocol):
        """
        Protocol which echos received bytes back to all connected
        BroadcastProtocols.
        """
        def dataReceived(self, bytes):
            """
            Handle received bytes by dispatching them to my factory for
            broadcast to all clients.
            """
            self.factory.sendMessage(bytes)


        def sendMessage(self, bytes):
            """
            Write the given bytes to my transport.
            """
            self.transport.write(bytes)



    class BroadcastFactory(ServerFactory):
        """
        Serve and track BroadcastProtocol instances.

        @ivar connectedProtocols: A list of all protocol instances which have
            been returned by buildProtocol.
        """
        protocol = BroadcastProtocol

        def __init__(self):
            self.connectedProtocols = []


        def buildProtocol(self, addr):
            """
            Instantiate my protocol class, append it to my tracking list, and
            return it.
            """
            protocol = ServerFactory.buildProtocol(self, addr)
            self.connectedProtocols.append(protocol)
            return protocol


        def sendMessage(self, bytes):
            """
            Send the given bytes to all tracked protocols.
            """
            for proto in self.connectedProtocols:
                proto.sendMessage(bytes)


    class BroadcastProtocolTests(TestCase):
        """
        BroadcastProtocol should send all bytes it receives to all other
        connected BroadcastProtocol instances.
        """
        def test_buildProtocol(self):
            """
            BroadcastFactory.buildProtocol should return an instance of
            BroadcastProtocol and add that instance to its tracking list.
            """
            factory = BroadcastFactory()
            protocol = factory.buildProtocol(None)
            self.assertEqual(factory.connectedProtocols, [protocol])


        def test_factorySendMessage(self):
            """
            BroadcastFactory.sendMessage should call sendMessage on each
            of the protocols in its tracking list.
            """
            class StubProtocol(object):
                """
                Mimick the message-sending interface of BroadcastProtocol.
                """
                def __init__(self):
                    self.messages = []
                def sendMessage(self, message):
                    self.messages.append(message)

            factory = BroadcastFactory()
            protocol = StubProtocol()
            factory.connectedProtocols = [protocol]
            message = object()
            factory.sendMessage(message)
            self.assertEqual(protocol.messages, [message])


        def test_dataReceived(self):
            """
            BroadcastProtocol.dataReceived should pass whatever bytes it is
            called with to the factory's sendMessage method.
            """
            class StubFactory(object):
                """
                Mimick the message-sending interface of BroadcastFactory.
                """
                def __init__(self):
                    self.messages = []
                def sendMessage(self, message):
                    self.messages.append(message)
            factory = StubFactory()
            protocol = BroadcastProtocol()
            protocol.factory = factory
            message = object()
            protocol.dataReceived(message)
            self.assertEqual(factory.messages, [message])


        def test_protocolSendMessage(self):
            """
            BroadcastProtocol.sendMessage should write the bytes it is called
            with to its transport.
            """
            class StubTransport(object):
                """
                Mimick a transport sufficiently for the purposes of simple
                writes.
                """
                def __init__(self):
                    self.messages = []
                def write(self, bytes):
                    self.messages.append(bytes)
            protocol = BroadcastProtocol()
            transport = StubTransport()
            protocol.makeConnection(transport)
            message = object()
            protocol.sendMessage(message)
            self.assertEqual(transport.messages, [message])

Jean-Paul



From arnarbi at gmail.com  Wed Jun 20 07:52:06 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Wed, 20 Jun 2007 11:52:06 +0000
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
In-Reply-To: <981709.63531.qm@web59107.mail.re1.yahoo.com>
References: <981709.63531.qm@web59107.mail.re1.yahoo.com>
Message-ID: <28012bc60706200452v60e2f54eke730e25def15203e@mail.gmail.com>

On 6/20/07, slowtech chen <slowtech.chen at yahoo.com> wrote:
> I have 2 clients, one gets a message from a server, once I get
> the message, I want to send it with the other client to another
> server. how can i do this?  can I add some customized events
> and notice the other client? Thanks.

Are they both running in the same process?

This is my first non-question post on this list, so please forgive me
if I'm giving bad advice - hopefully someone will correct me if I am.

If they're both in the same process you can just make calls between
them normally.

from twisted.internet.protocol import Protocol
from twisted.internet import reactor, protocol

class YourProtocol(Protocol):

    def connectionMade(self):
        self.factory.connections.append(self)
        print "connected"

    def connectionLost(self, reason):
        self.factory.connections.remove(self)
        print "disconnected"

    def dataReceived(self, data):
        # repeat the data to all other connections
        print "relaying data"
        for conn in self.factory.connections:
            if conn != self:
                conn.transport.write(data)

class YourClientFactory(protocol.ClientFactory):
    protocol = YourProtocol

    def __init__(self):
        self.connections = []


if __name__ == '__main__':

    f = YourClientFactory()
    reactor.connectTCP("hostname1", 10001, f)
    reactor.connectTCP("hostname2", 10002, f)
    reactor.run()



From edgardo.delgado at navy.mil  Wed Jun 20 10:15:54 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Wed, 20 Jun 2007 10:15:54 -0400
Subject: [Twisted-Python] Server/Client
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>

I would like to build a server that when it gets a message on a specific
port it will "forward" that message to another port.
I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
will forward the data to "Server2" listening on port 15000.

Edgar




From christian.simms at gmail.com  Wed Jun 20 11:01:03 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Wed, 20 Jun 2007 11:01:03 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com>

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3 <edgardo.delgado at navy.mil>
wrote:
>
> I would like to build a server that when it gets a message on a specific
> port it will "forward" that message to another port.
> I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
> will forward the data to "Server2" listening on port 15000.


Assuming you're using TCP, you could just create a server listening on a
port using reactor.listenTCP(port, factory) as detailed
here<http://twistedmatrix.com/projects/core/documentation/howto/servers.html>and
when you receive a message you would create a client using
reactor.connectTCP(host, port, factory) as detailed
here<http://twistedmatrix.com/projects/core/documentation/howto/clients.html>to
then send the message.

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070620/5a47ad5e/attachment.htm 

From amauryfa at gmail.com  Wed Jun 20 11:08:12 2007
From: amauryfa at gmail.com (Amaury Forgeot d'Arc)
Date: Wed, 20 Jun 2007 17:08:12 +0200
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <a684d0100706120622w3d1da826vd91bb931ce0f86e7@mail.gmail.com>
References: <a684d0100706120622w3d1da826vd91bb931ce0f86e7@mail.gmail.com>
Message-ID: <e27efe130706200808o2173448fs717a7e0ced5ed4f1@mail.gmail.com>

Hello,

2007/6/12, Rodrigo Strauss wrote:
> Have you tried Boost Asio?
>
> http://asio.sourceforge.net/

Sorry for the late answer... Thanks to everybody who answered!
Asio is indeed the kind of stuff I was looking for.
It shares some concepts with Twisted.
And the boost library makes C++ a bit more usable (but less readable).

One missing piece is the Deferred object (multiple callbacks to the
same event). It seems easy to add.
My problem now is that it seems difficult to install my own reactor.

I think I will stick with my own approximation of Twisted rewritten
for C++, and switch to python once I have convinced everybody.

Thanks again for your help,
-- 
Amaury Forgeot d'Arc



From arnarbi at gmail.com  Wed Jun 20 11:34:46 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Wed, 20 Jun 2007 15:34:46 +0000
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <28012bc60706200834q56ae5618ie6002be8ea02b94d@mail.gmail.com>

On 6/20/07, Delgado, Edgardo  CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:
> I would like to build a server that when it gets a message on a specific
> port it will "forward" that message to another port.
> I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
> will forward the data to "Server2" listening on port 15000.

This is not Twisted, but it may be helpful:
http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/483732

Arnar



From edgardo.delgado at navy.mil  Wed Jun 20 15:42:17 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Wed, 20 Jun 2007 15:42:17 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
	<cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com>
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED592233D7EA5@naeapaxrez05.nadsusea.nads.navy.mil>

Here's the code:

from twisted.internet.protocol import ServerFactory, ClientFactory,
Protocol, ClientCreator
from twisted.protocols.basic import LineReceiver
from twisted.application.service import Service, Application,
IServiceCollection
from twisted.application.internet import TCPServer, TCPClient
from twisted.internet.stdio import StandardIO
from twisted.internet import reactor
import re

class DnLinkProtocol(LineReceiver):
    
    def connectionMade(self):
        self.sendLine("Connected from: " + "host " +
                             str(self.transport.getPeer().host) + " " +
                             "port " +
                             str(self.transport.getPeer().port) + '\n')
        
    def lineReceived(self, line):
        self.sendLine("DnLink echo: " + line + '\n')

class DSPEProtocol(LineReceiver):
    
    def connectionMade(self):
        self.sendLine("Connected from: " + "host " +
                             str(self.transport.getPeer().host) + " " +
                             "port " +
                             str(self.transport.getPeer().port) + '\n')
    
    def lineReceived(self, line):
        self.sendLine("DSPE echo: " + line + '\n')

class PAPSExecService(Service):
    
    def getDnLinkInFactory(self):
        f = ServerFactory()
        f.protocol = DnLinkProtocol
        f.startService = self.startService
        return f
    
    def getDSPEInFactory(self):
        f = ServerFactory()
        f.protocol = DSPEProtocol
        f.startService = self.startService
        return f
    
application = Application('PAPSExec')
f = PAPSExecService()
serviceCollection = IServiceCollection(application)
TCPServer(9595,
f.getDnLinkInFactory()).setServiceParent(serviceCollection)
TCPServer(8585,
f.getDSPEInFactory()).setServiceParent(serviceCollection) 


I would like that, for example, when data is received in port 9595 it
will forward the data to another server in port xxxx.
Where would I create a TPC Client connection?
Where would I send the message?

Edgar

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Christian
Simms
Sent: Wednesday, June 20, 2007 11:01 AM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Server/Client

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:

	I would like to build a server that when it gets a message on a
specific
	port it will "forward" that message to another port. 
	I.e. "Server1" listens on port 10000. When it gets data on port
10000 it
	will forward the data to "Server2" listening on port 15000.


Assuming you're using TCP, you could just create a server listening on a
port using reactor.listenTCP(port, factory) as detailed here
<http://twistedmatrix.com/projects/core/documentation/howto/servers.html
>  and when you receive a message you would create a client using
reactor.connectTCP(host, port, factory) as detailed here
<http://twistedmatrix.com/projects/core/documentation/howto/clients.html
>  to then send the message.

Cheers,
Christian




From slowtech.chen at yahoo.com  Thu Jun 21 03:49:04 2007
From: slowtech.chen at yahoo.com (slowtech chen)
Date: Thu, 21 Jun 2007 00:49:04 -0700 (PDT)
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
In-Reply-To: <981709.63531.qm@web59107.mail.re1.yahoo.com>
Message-ID: <174306.19745.qm@web59108.mail.re1.yahoo.com>

Thanks guys, It helped a lot, but still something I haven't figured out,
what I do is like:

reactor.connectTCP(host1, port1, factory1)
reactor.connectTCP(host2, port2, factory2)

using different protocols, so I can't do it the way Arnar does. 
my confusion is how to get the *valid* protocol instance to refer, I tried factory2.buildProtocol(None) in protocol1's callback, but the instance I get has a None transport attribute.
I guess the instance is not the same with the one reactor.connectTCP(host2, port2, factory2) is actually using.

thanks for any help.



       
---------------------------------
Fussy? Opinionated? Impossible to please? Perfect.  Join Yahoo!'s user panel and lay it on us.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070621/58fb911d/attachment.htm 

From arnarbi at gmail.com  Thu Jun 21 05:06:47 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Thu, 21 Jun 2007 09:06:47 +0000
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
In-Reply-To: <174306.19745.qm@web59108.mail.re1.yahoo.com>
References: <981709.63531.qm@web59107.mail.re1.yahoo.com>
	<174306.19745.qm@web59108.mail.re1.yahoo.com>
Message-ID: <28012bc60706210206u483e8976r7aca8aed97d228be@mail.gmail.com>

On 6/21/07, slowtech chen <slowtech.chen at yahoo.com> wrote:
> Thanks guys, It helped a lot, but still something I haven't figured out,
> what I do is like:
>
> reactor.connectTCP(host1, port1, factory1)
> reactor.connectTCP(host2, port2, factory2)
>
> using different protocols, so I can't do it the way Arnar does.

Assuming you pass data from host1 to host2, you can store a reference
to factory2 in factory1.

from twisted.internet.protocol import Protocol
from twisted.internet import reactor, protocol

class InputProtocol(Protocol):

   def connectionMade(self):
       print "Input connected"

   def connectionLost(self, reason):
       print "Input disconnected"

   def dataReceived(self, data):
       # repeat the data to all output connections
       print "relaying data"
       for conn in self.factory.output_factory.connections:
           conn.transport.write(data)

class OutputProtocol(Protocol):

    def connectionMade(self):
        print "Output connected"
        self.factory.connections.append(self)

    def connectionLost(self, reason):
        print "Output disconnected"
        self.factory.connections.remove(self)

class InputFactory(protocol.ClientFactory):
    protocol = InputProtocol

    def __init__(self, output_factory):
        self.output_factory = output_factory

class OutputFactory(protocol.ClientFactory):
   protocol = OutputProtocol

   def __init__(self):
       self.connections = []


if __name__ == '__main__':

   of = OutputFactory()
   if = InputFactory(of)
   reactor.connectTCP("sourcehost", 10001, if)
   reactor.connectTCP("destinationhost", 10002, of)
   reactor.run()


(totally untested)

Arnar



From christian.simms at gmail.com  Thu Jun 21 11:19:32 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Thu, 21 Jun 2007 11:19:32 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7EA5@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
	<cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com>
	<0C8FBA9C0F70E1479497B4DD7ED592233D7EA5@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <cd8fa6f90706210819m13724cc8h91b0057422ca6330@mail.gmail.com>

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3 <edgardo.delgado at navy.mil>
wrote:
>
> Here's the code:
>
> from twisted.internet.protocol import ServerFactory, ClientFactory,
> Protocol, ClientCreator
> from twisted.protocols.basic import LineReceiver
> from twisted.application.service import Service, Application,
> IServiceCollection
> from twisted.application.internet import TCPServer, TCPClient
> from twisted.internet.stdio import StandardIO
> from twisted.internet import reactor
> import re
>
> class DnLinkProtocol(LineReceiver):
>
>     def connectionMade(self):
>         self.sendLine("Connected from: " + "host " +
>                              str(self.transport.getPeer().host) + " " +
>                              "port " +
>                              str(self.transport.getPeer().port) + '\n')
>
>     def lineReceived(self, line):
>         self.sendLine("DnLink echo: " + line + '\n')
>
> class DSPEProtocol(LineReceiver):
>
>     def connectionMade(self):
>         self.sendLine("Connected from: " + "host " +
>                              str(self.transport.getPeer().host) + " " +
>                              "port " +
>                              str(self.transport.getPeer().port) + '\n')
>
>     def lineReceived(self, line):
>         self.sendLine("DSPE echo: " + line + '\n')
>
> class PAPSExecService(Service):
>
>     def getDnLinkInFactory(self):
>         f = ServerFactory()
>         f.protocol = DnLinkProtocol
>         f.startService = self.startService
>         return f
>
>     def getDSPEInFactory(self):
>         f = ServerFactory()
>         f.protocol = DSPEProtocol
>         f.startService = self.startService
>         return f
>
> application = Application('PAPSExec')
> f = PAPSExecService()
> serviceCollection = IServiceCollection(application)
> TCPServer(9595,
> f.getDnLinkInFactory()).setServiceParent(serviceCollection)
> TCPServer(8585,
> f.getDSPEInFactory()).setServiceParent(serviceCollection)
>
>
> I would like that, for example, when data is received in port 9595 it
> will forward the data to another server in port xxxx.
> Where would I create a TPC Client connection?
> Where would I send the message?
>
> Edgar
>
> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com
> [mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Christian
> Simms
> Sent: Wednesday, June 20, 2007 11:01 AM
> To: Twisted general discussion
> Subject: Re: [Twisted-Python] Server/Client
>
> On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
> <edgardo.delgado at navy.mil> wrote:
>
>         I would like to build a server that when it gets a message on a
> specific
>         port it will "forward" that message to another port.
>         I.e. "Server1" listens on port 10000. When it gets data on port
> 10000 it
>         will forward the data to "Server2" listening on port 15000.
>
>
> Assuming you're using TCP, you could just create a server listening on a
> port using reactor.listenTCP(port, factory) as detailed here
> <http://twistedmatrix.com/projects/core/documentation/howto/servers.html
> >  and when you receive a message you would create a client using
> reactor.connectTCP(host, port, factory) as detailed here
> <http://twistedmatrix.com/projects/core/documentation/howto/clients.html
> >  to then send the message.
>
> Cheers,
> Christian


Assuming you want to create a new connection every time a client connects to
your port 9595, it's slightly tricky because you can't just forward the data
as soon as you get it, since the connection to the other server may not be
created yet.  A relatively complex way is explained in the Python Cookbook
in article "Hex-dump port-forwarding network proxy
server"<http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293>,
where it queues up the data until the outgoing connection is made.  A
simpler way is used in twisted.protocols.portforward.ProxyFactory/ProxyServer,
where it just pauses receiving data until the outgoing connection is made.
I found a Python mailing list
entry<http://mail.python.org/pipermail/python-list/2003-June/212102.html>which
explains how to override the portforward's methods.

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070621/78927286/attachment.htm 

From edgardo.delgado at navy.mil  Thu Jun 21 12:36:50 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Thu, 21 Jun 2007 12:36:50 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <cd8fa6f90706210819m13724cc8h91b0057422ca6330@mail.gmail.com>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil><cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com><0C8FBA9C0F70E1479497B4DD7ED592233D7EA5@naeapaxrez05.nadsusea.nads.navy.mil>
	<cd8fa6f90706210819m13724cc8h91b0057422ca6330@mail.gmail.com>
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED5922343F9E7@naeapaxrez05.nadsusea.nads.navy.mil>

Thanks Christian (and everybody else) for your help,

Edgar

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Christian
Simms
Sent: Thursday, June 21, 2007 11:20 AM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Server/Client

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:

	Here's the code:
	
	from twisted.internet.protocol import ServerFactory,
ClientFactory, 
	Protocol, ClientCreator
	from twisted.protocols.basic import LineReceiver
	from twisted.application.service import Service, Application,
	IServiceCollection
	from twisted.application.internet import TCPServer, TCPClient 
	from twisted.internet.stdio import StandardIO
	from twisted.internet import reactor
	import re
	
	class DnLinkProtocol(LineReceiver):
	
	    def connectionMade(self):
	        self.sendLine("Connected from: " + "host " + 
	                             str(self.transport.getPeer().host)
+ " " +
	                             "port " +
	                             str(self.transport.getPeer().port)
+ '\n')
	
	    def lineReceived(self, line):
	        self.sendLine("DnLink echo: " + line + '\n')
	
	class DSPEProtocol(LineReceiver):
	
	    def connectionMade(self):
	        self.sendLine("Connected from: " + "host " + 
	                             str(self.transport.getPeer().host)
+ " " +
	                             "port " +
	                             str(self.transport.getPeer().port)
+ '\n')
	
	    def lineReceived(self, line):
	        self.sendLine("DSPE echo: " + line + '\n')
	
	class PAPSExecService(Service):
	
	    def getDnLinkInFactory(self):
	        f = ServerFactory()
	        f.protocol = DnLinkProtocol
	        f.startService = self.startService
	        return f
	
	    def getDSPEInFactory(self):
	        f = ServerFactory()
	        f.protocol = DSPEProtocol
	        f.startService = self.startService
	        return f
	
	application = Application('PAPSExec')
	f = PAPSExecService()
	serviceCollection = IServiceCollection(application)
	TCPServer(9595,
	f.getDnLinkInFactory()).setServiceParent(serviceCollection) 
	TCPServer(8585,
	f.getDSPEInFactory()).setServiceParent(serviceCollection)
	
	
	I would like that, for example, when data is received in port
9595 it
	will forward the data to another server in port xxxx.
	Where would I create a TPC Client connection?
	Where would I send the message?
	
	Edgar
	
	-----Original Message-----
	From: twisted-python-bounces at twistedmatrix.com 
	[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of
Christian
	Simms
	Sent: Wednesday, June 20, 2007 11:01 AM
	To: Twisted general discussion 
	Subject: Re: [Twisted-Python] Server/Client
	
	On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
	<edgardo.delgado at navy.mil> wrote:
	
	        I would like to build a server that when it gets a
message on a
	specific
	        port it will "forward" that message to another port.
	        I.e. "Server1" listens on port 10000. When it gets data
on port 
	10000 it
	        will forward the data to "Server2" listening on port
15000.
	
	
	Assuming you're using TCP, you could just create a server
listening on a
	port using reactor.listenTCP(port, factory) as detailed here 
	
<http://twistedmatrix.com/projects/core/documentation/howto/servers.html
	>  and when you receive a message you would create a client
using 
	reactor.connectTCP(host, port, factory) as detailed here
	
<http://twistedmatrix.com/projects/core/documentation/howto/clients.html

	>  to then send the message.
	
	Cheers,
	Christian


Assuming you want to create a new connection every time a client
connects to your port 9595, it's slightly tricky because you can't just
forward the data as soon as you get it, since the connection to the
other server may not be created yet.  A relatively complex way is
explained in the Python Cookbook in article "Hex-dump port-forwarding
network proxy server"
<http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293> , where
it queues up the data until the outgoing connection is made.  A simpler
way is used in twisted.protocols.portforward.ProxyFactory/ProxyServer,
where it just pauses receiving data until the outgoing connection is
made.  I found a Python mailing list entry
<http://mail.python.org/pipermail/python-list/2003-June/212102.html>
which explains how to override the portforward's methods.

Cheers,
Christian






From sc at linux.it  Thu Jun 21 18:02:14 2007
From: sc at linux.it (Stefano Canepa)
Date: Fri, 22 Jun 2007 00:02:14 +0200
Subject: Tell us how you're using Twisted (was Re: [Twisted-Python]
	Win32 IOCPReactor?)
In-Reply-To: <1179750893.7838.10.camel@localhost.localdomain>
References: <AB1BB4CF81B9214682079EB55A7125ED01D6994C@mapibe05.exchange.xchg>
	<4629.71.42.153.50.1179511117.squirrel@www.world-net.net>
	<001b01c79a58$94921670$0400000a@spooge>
	<1179611703.26686.4.camel@localhost.localdomain>
	<a0624087ec2773c5d92f0@[192.168.24.210]>
	<1179750893.7838.10.camel@localhost.localdomain>
Message-ID: <1182463334.2844.21.camel@localhost>

Il giorno lun, 21/05/2007 alle 08.34 -0400, Itamar Shtull-Trauring ha
scritto:

> Oh, I certainly understand running on Windows when clients pay you to do
> so. I was just surprised people do so on internal servers when they do
> have a choice.
> 
> Anyway, since this is bringing users out into the open - I'm sure we'd
> all like to hear what Twisted is being used for in different companies,
> and under which platforms. Do tell!
> 
> My company uses Twisted for a variety of uses, including reliable
> multicast data distribution, messaging, monitoring and managing complex
> processes, in the airline industry. (http://itasoftware.com)
> 
> How about you all?

I used twisted to code HL7 message transport protocol. I'm in the
process to improve the protocol to be more secure.

Bye
sc

-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt? di un programmatore: pigrizia, impazienza e
arroganza. (Larry Wall)

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa =?ISO-8859-1?Q?=E8?= una parte del messaggio
	firmata digitalmente
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070622/255ab572/attachment.pgp 

From monch1962 at gmail.com  Thu Jun 21 23:43:12 2007
From: monch1962 at gmail.com (David Mitchell)
Date: Fri, 22 Jun 2007 13:43:12 +1000
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <f6508a860706212043i64c7b6b5o65849bcae73dee3d@mail.gmail.com>

It's neither Twisted or Python, but if you're on Linux the socat tool
does exactly what you're asking and a lot more.  Google for more info

I use it all the time, and under heavy workloads it's never failed on me yet.

Regards

Dave M.

On 21/06/07, Delgado, Edgardo  CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:
> I would like to build a server that when it gets a message on a specific
> port it will "forward" that message to another port.
> I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
> will forward the data to "Server2" listening on port 15000.
>
> Edgar
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From arnarbi at gmail.com  Fri Jun 22 04:58:12 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Fri, 22 Jun 2007 08:58:12 +0000
Subject: Tell us how you're using Twisted (was Re: [Twisted-Python] Win32
	IOCPReactor?)
In-Reply-To: <1182463334.2844.21.camel@localhost>
References: <AB1BB4CF81B9214682079EB55A7125ED01D6994C@mapibe05.exchange.xchg>
	<4629.71.42.153.50.1179511117.squirrel@www.world-net.net>
	<001b01c79a58$94921670$0400000a@spooge>
	<1179611703.26686.4.camel@localhost.localdomain>
	<a0624087ec2773c5d92f0@192.168.24.210>
	<1179750893.7838.10.camel@localhost.localdomain>
	<1182463334.2844.21.camel@localhost>
Message-ID: <28012bc60706220158h2ee2ddd1n7d48dbfa2fc671c@mail.gmail.com>

On 6/21/07, Stefano Canepa <sc at linux.it> wrote:
>> Anyway, since this is bringing users out into the open - I'm sure we'd
>> all like to hear what Twisted is being used for in different companies,
>> and under which platforms. Do tell!

I'm planning to use Twisted to monitor events from an Asterisk PBX and
feed multiple Flex/AIR clients on extension status, voicemail, etc.
etc.

I'll probably use Linux 2.6 - but whatever works best.

Arnar



From luca at unipex.it  Fri Jun 22 05:08:07 2007
From: luca at unipex.it (Luca Politti)
Date: Fri, 22 Jun 2007 11:08:07 +0200
Subject: [Twisted-Python] protocol-factory question
Message-ID: <467B9177.7060907@unipex.it>

Hi group, I'm new in this mailing list and in twisted...
I want to ask you a question about twisted factory and protocols:
I'm building a server that have to receive commands from some clients 
via TCP.

So I wrote my Protocol class, and my Factory class. If I understood the 
behavior of
this system, every time a client connects to my server, factory build a 
protocol instance and
"attach" it to the client. So the client comunicates with that protocol 
instance, right?
Now, when from protocol I call self.transport.loseConnection(in way to 
disconnnect itself),
the client will be disconnected,but its protocol instance still lives 
on. What can I do
to destroy protocol instance after its client disconnection? Because if 
I have a thousand of
connection attempts, I'll have a thousand of protocol instances, with a 
lot of allocated resources

I hope I've been clear enough, even if my english is far to be perfect :)

Thanks a lot

Luca



From therve at free.fr  Fri Jun 22 05:44:22 2007
From: therve at free.fr (Thomas =?utf-8?b?SGVydsOp?=)
Date: Fri, 22 Jun 2007 11:44:22 +0200
Subject: [Twisted-Python] protocol-factory question
In-Reply-To: <467B9177.7060907@unipex.it>
References: <467B9177.7060907@unipex.it>
Message-ID: <20070622114422.ezr3narsgowoc84c@wasabox.wasabout.net>


> So I wrote my Protocol class, and my Factory class. If I understood the
> behavior of
> this system, every time a client connects to my server, factory build a
> protocol instance and
> "attach" it to the client. So the client comunicates with that protocol
> instance, right?
> Now, when from protocol I call self.transport.loseConnection(in way to
> disconnnect itself),
> the client will be disconnected,but its protocol instance still lives
> on. What can I do
> to destroy protocol instance after its client disconnection? Because if
> I have a thousand of
> connection attempts, I'll have a thousand of protocol instances, with a
> lot of allocated resources

Protocol instance will remain alive in your program if you keep a  
reference to it. By default it's not done within Twisted, so when the  
connection is closed, the protocol instance must be destroyed at the  
next garbage collect turn, without doing anything in your application.

If you keep a reference to it (to have a list of connected clients for  
example), just remove your instance from this list in connectionLost.

-- 
Thomas




From exarkun at twistedmatrix.com  Sun Jun 24 00:05:01 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 24 Jun 2007 04:05:01 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1182657901.64.1744041517@twistedmatrix.com

Bug summary
______________________
Summary for 2007-06-17 through 2007-06-24
Bugs opened: 10    Bugs closed: 2  Total open bugs: 980 (+8)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       +3  |Highest:  +1          |Conch:  +3             
|Enhancement:  +6  |High:     +0          |Core:   +4             
                   |Normal:   +8          |Lore:   -1             
                                          |Trial:  +1             
                                          |Web:    +1             
                                          |Web2:   +2             
                                          |Words:  -1             


New / Reopened Bugs
______________________
                    ===== Highest =====
[#2707] twisted.conch.ssh.connection has poor tests (opened by z3p)
    defect          conch      http://twistedmatrix.com/trac/ticket/2707

[#2709] twisted.conch.ssh.channel has poor tests (opened by z3p)
    defect          conch      http://twistedmatrix.com/trac/ticket/2709

                    ===== High =====
[#2710] twisted.conch.ssh.session has poor tests (opened by z3p)
    defect          conch      http://twistedmatrix.com/trac/ticket/2710

                    ===== Normal =====
[#2706] Add GNUTLS support in twisted (opened by yqiang)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2706

[#2708] twisted.python.log.msg isn't documented in the api documentation (opened by exarkun)
    defect          core       http://twistedmatrix.com/trac/ticket/2708

[#2711] ConnectionRefusedError doesn't provide any information about the connection that was refused (opened by jml)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2711

[#2712] cooperator should provide an API to pause, resume, and cancel individual tasks within the cooperator instead of the entire thing. (opened by glyph)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2712

[#2713] trial -u can fail doctests on second pass (opened by mgeisler)
    defect          trial      http://twistedmatrix.com/trac/ticket/2713

[#2714] Add http_proxy and https_proxy support to web/client.py (opened by fsteinel)
    enhancement     web        http://twistedmatrix.com/trac/ticket/2714

[#1436] add getCookie/setCookie to web2.http_headers.Headers (opened by andrea)
    enhancement     web2       http://twistedmatrix.com/trac/ticket/1436



Closed Bugs
______________________
                    ===== Highest =====
[#2701] twisted.words.xish.yappsrt.Scanner.__init__ is  not proper epytext (opened by therve, closed by exarkun, duplicate)
    defect          words      http://twistedmatrix.com/trac/ticket/2701

                    ===== High =====
[#812 ] Lore always generates "Index" links even when meaningless, and even on index pages themselves. (opened by tirkal, closed by exarkun, fixed)
    defect          lore       http://twistedmatrix.com/trac/ticket/812





From andrew at ellerton.net  Sun Jun 24 18:45:40 2007
From: andrew at ellerton.net (Andrew E)
Date: Sun, 24 Jun 2007 18:45:40 -0400
Subject: [Twisted-Python] Utility program to hex-dump network traffic
Message-ID: <467EF414.8020605@ellerton.net>

Dear Twisted Experts,

About 2 years ago I needed a simple way to hexdump network traffic. I
threw together a Twisted application, and have improved it little by
little whenever I needed to.

I didn't want to use an existing network sniffer tool. Instead, I
borrowed the idea of a tunnel from ssh:
Normally application A connects directly to application B; instead, A
connects to the tunnel which connets to B.

I posted the program to the ASPN site:

    http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293

Though it works well for my purposes, I'm sure I've got some aspects
wrong -- any/all comments/feedback/advice would be warmly appreciated :)

Regards
Andrew



From arnarbi at gmail.com  Sun Jun 24 19:09:14 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Sun, 24 Jun 2007 23:09:14 +0000
Subject: [Twisted-Python] Utility program to hex-dump network traffic
In-Reply-To: <467EF414.8020605@ellerton.net>
References: <467EF414.8020605@ellerton.net>
Message-ID: <28012bc60706241609u34fdff6bx74388ca7c91db8b0@mail.gmail.com>

Hi Andrew,

On 6/24/07, Andrew E <andrew at ellerton.net> wrote:
> I posted the program to the ASPN site:
>
>     http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293

Just wanted to say thanks. Someone blogged about this recipe and I've
used alot and saved a great amount of time with it. Especially handy
since ethereal/wireshark can't capture traffic on the localhost
interface on Windows.

So, thanks again!

Arnar



From andrew at ellerton.net  Sun Jun 24 23:12:56 2007
From: andrew at ellerton.net (Andrew E)
Date: Sun, 24 Jun 2007 23:12:56 -0400
Subject: [Twisted-Python] Utility program to hex-dump network traffic
In-Reply-To: <28012bc60706241609u34fdff6bx74388ca7c91db8b0@mail.gmail.com>
References: <467EF414.8020605@ellerton.net>
	<28012bc60706241609u34fdff6bx74388ca7c91db8b0@mail.gmail.com>
Message-ID: <467F32B8.4040601@ellerton.net>

Arnar Birgisson wrote:
>> I posted the program to the ASPN site:
>>
>>     http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293
>
> Just wanted to say thanks. Someone blogged about this recipe and I've
> used alot and saved a great amount of time with it. Especially handy
> since ethereal/wireshark can't capture traffic on the localhost
> interface on Windows.
Thanks for letting me know Arnar!

It sure is nice to hear people liking/using my work.

There are a few other free/open source software tidbits (non twisted)
here: http://software.ellerton.net

Andrew




From daniel.cuesta at iavante.es  Mon Jun 25 06:02:49 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Mon, 25 Jun 2007 12:02:49 +0200
Subject: [Twisted-Python] Call to ffmpeg using getProcessOutput
Message-ID: <467F92C9.2000303@iavante.es>

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070625/b3071014/attachment.htm 

From D.Kirby at tideway.com  Mon Jun 25 07:03:46 2007
From: D.Kirby at tideway.com (Dave Kirby)
Date: Mon, 25 Jun 2007 12:03:46 +0100
Subject: [Twisted-Python] Beginner question: integrating with CORBA 
Message-ID: <B81183566FF73947875C3A207CD60AA6056612CC@LONEX01.tideway.com>

I have just started looking at Twisted, and it looks really cool and
useful.  I have read through much of the docs and the O'Reilly book, but
I still have a head full of questions.

 

First some background.  I am considering using Twisted to replace a
component in a network management suite.  All the components communicate
through CORBA (omniORB).  The component I want to replace gets CORBA
calls that requests data from servers on the network, and the component
retrieves the data using ssh.  Currently it spawns /usr/bin/ssh and uses
pexpect to control the interaction.  Typically we will have 20-40
simultaneous calls in progress to different IP addresses, each on a
separate thread and each spawning a separate ssh client.

 

I want to replace this with a component that uses Twisted instead.  From
what I have read Twisted should be ideal for this - I can use the conch
library to do the ssh calls and eliminate the need for spawning dozens
of separate processes (something that has been a major cause of bugs).

 

The first problem I have is how to integrate the omniORB event loop with
the reactor event loop.  My initial thoughts are to have the omniORB
event loop in one thread and run the reactor loop in another thread.
When a CORBA call comes in it will use callFromThread()  to post a
request to the Twisted thread that will create the connection and handle
the ssh session.  Is this feasible?  Any gotchas to watch out for?

 

However I have also seen reference to using threadedselectreactor for
mixing Twisted and foreign even loops
(http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign-event-
loops/), but I have no idea how to use this with omniORB.  Is this worth
investigating further, or should I stick with my original idea?

 

Replacing CORBA with the Twisted PerspectiveBroker is not an option,
since it would require extensively rewriting a dozen or so components.

 

I have plenty of other questions, but will save them for another time.

 

Dave Kirby

This email and any attachment may contain confidential, privileged information for the sole use of the intended recipient. If you are not the intended recipient, do not disclose, reproduce, disseminate or otherwise use this communication. If you received this communication in error, please immediately notify the sender via email and delete the communication from your system. Company information : Tideway Systems Ltd, Registered Office: Anchor House, 15-19 Britten Street, London, SW3 3TY. Registered in England & Wales Reg. Reg. No: 4598072  VAT No: 805 5153 50 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070625/129504d5/attachment.htm 

From exarkun at divmod.com  Mon Jun 25 07:46:36 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 25 Jun 2007 07:46:36 -0400
Subject: [Twisted-Python] Beginner question: integrating with CORBA 
In-Reply-To: <B81183566FF73947875C3A207CD60AA6056612CC@LONEX01.tideway.com>
Message-ID: <20070625114636.4947.728200051.divmod.quotient.4208@ohm>

On Mon, 25 Jun 2007 12:03:46 +0100, Dave Kirby <d.kirby at tideway.com> wrote:
>I have just started looking at Twisted, and it looks really cool and
>useful.  I have read through much of the docs and the O'Reilly book, but
>I still have a head full of questions.
>
>First some background.  I am considering using Twisted to replace a
>component in a network management suite.  All the components communicate
>through CORBA (omniORB).  The component I want to replace gets CORBA
>calls that requests data from servers on the network, and the component
>retrieves the data using ssh.  Currently it spawns /usr/bin/ssh and uses
>pexpect to control the interaction.  Typically we will have 20-40
>simultaneous calls in progress to different IP addresses, each on a
>separate thread and each spawning a separate ssh client.
>
>I want to replace this with a component that uses Twisted instead.  From
>what I have read Twisted should be ideal for this - I can use the conch
>library to do the ssh calls and eliminate the need for spawning dozens
>of separate processes (something that has been a major cause of bugs).
>
>The first problem I have is how to integrate the omniORB event loop with
>the reactor event loop.  My initial thoughts are to have the omniORB
>event loop in one thread and run the reactor loop in another thread.
>When a CORBA call comes in it will use callFromThread()  to post a
>request to the Twisted thread that will create the connection and handle
>the ssh session.  Is this feasible?  Any gotchas to watch out for?
>

This is probably the most straightforward approach.  It's not as desirable
as one that doesn't involve threads at all, but it gives you the integration
you're after with the least development overhead, and it leaves a pretty
straightforward path for ultimately switching away from threads entirely,
should the opportunity to do that work arise (by incrementally replacing
code in the omniORB thread with code that performs an equivalent task in
the Twisted reactor thread).

>
>However I have also seen reference to using threadedselectreactor for
>mixing Twisted and foreign even loops
>(http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign-event-
>loops/), but I have no idea how to use this with omniORB.  Is this worth
>investigating further, or should I stick with my original idea?
>

I consider threadedselectreactor a non-starter due to the state of its
test coverage and the general mystery surrounding how application-level
tests are written for code which requires it.

>
>Replacing CORBA with the Twisted PerspectiveBroker is not an option,
>since it would require extensively rewriting a dozen or so components.
>

How about doing a Twisted implementation of CORBA? ;)

Jean-Paul



From andrew-twisted at puzzling.org  Mon Jun 25 07:49:11 2007
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 25 Jun 2007 21:49:11 +1000
Subject: [Twisted-Python] Call to ffmpeg using getProcessOutput
In-Reply-To: <467F92C9.2000303@iavante.es>
References: <467F92C9.2000303@iavante.es>
Message-ID: <20070625114911.GD20429@steerpike.home.puzzling.org>

Daniel de la Cuesta wrote:
> Hi everybody, I am trying to call ffmpeg using getProcessOutput method.
> 
> My code is as follows:
> 
> #Tuple of strings
> arguments = ('-i imput_file', '-ar 8000', '-ac 1', '-acodec amr_nb', '-vcodec
> h263', '-s qcif', '-r 12', '-b 32', '-ab 8', output_file)

This almost certainly needs to be:

arguments = ('-i', 'imput_file', '-ar', '8000', '-ac', '1', '-acodec', 'amr_nb',
	     '-vcodec', 'h263', '-s', 'qcif', '-r', '12', '-b', '32', '-ab',
             '8', output_file)

The error you are seeing is because ffmpeg cannot understand the arguments you
are passing it, so it writes a basic help message to stderr.

-Andrew.




From daniel.cuesta at iavante.es  Mon Jun 25 08:00:11 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Mon, 25 Jun 2007 14:00:11 +0200
Subject: [Twisted-Python] Call to ffmpeg using getProcessOutput
In-Reply-To: <467F92C9.2000303@iavante.es>
References: <467F92C9.2000303@iavante.es>
Message-ID: <467FAE4B.9030207@iavante.es>

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070625/59386381/attachment.htm 

From clawsicus at gmail.com  Mon Jun 25 09:04:31 2007
From: clawsicus at gmail.com (Chris Laws)
Date: Mon, 25 Jun 2007 22:34:31 +0930
Subject: [Twisted-Python] Beginner question: integrating with CORBA
Message-ID: <3ff1f41d0706250604g680faac3tca55a13ec19d2284@mail.gmail.com>

>
> ---------- Forwarded message ----------
> From: "Dave Kirby" <D.Kirby at tideway.com>
> To: <twisted-python at twistedmatrix.com>
> Date: Mon, 25 Jun 2007 12:03:46 +0100
> Subject: [Twisted-Python] Beginner question: integrating with CORBA
>
> I have just started looking at Twisted, and it looks really cool and
> useful.  I have read through much of the docs and the O'Reilly book, but I
> still have a head full of questions.
>
>
>
> First some background.  I am considering using Twisted to replace a
> component in a network management suite.  All the components communicate
> through CORBA (omniORB).  The component I want to replace gets CORBA calls
> that requests data from servers on the network, and the component retrieves
> the data using ssh.  Currently it spawns /usr/bin/ssh and uses pexpect to
> control the interaction.  Typically we will have 20-40 simultaneous calls in
> progress to different IP addresses, each on a separate thread and each
> spawning a separate ssh client.
>
>
>
> I want to replace this with a component that uses Twisted instead.  From
> what I have read Twisted should be ideal for this ? I can use the conch
> library to do the ssh calls and eliminate the need for spawning dozens of
> separate processes (something that has been a major cause of bugs).
>
>
>
> The first problem I have is how to integrate the omniORB event loop with
> the reactor event loop.  My initial thoughts are to have the omniORB event
> loop in one thread and run the reactor loop in another thread.  When a CORBA
> call comes in it will use callFromThread()  to post a request to the Twisted
> thread that will create the connection and handle the ssh session.  Is this
> feasible?  Any gotchas to watch out for?
>
>
>
> However I have also seen reference to using threadedselectreactor for
> mixing Twisted and foreign even loops (
> http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign-event-loops/),
> but I have no idea how to use this with omniORB.  Is this worth
> investigating further, or should I stick with my original idea?
>
>
>
> Replacing CORBA with the Twisted PerspectiveBroker is not an option, since
> it would require extensively rewriting a dozen or so components.
>
>
>
> I have plenty of other questions, but will save them for another time.
>
>
>
> Dave Kirby
>
>
I just got back into a similar thing today after about a month of inactivity
on the issue. I posted about it here a while back but got no responses.
I'm trying to convert a simple Python/Omniorb CORBA Event Channel client
script so that it can robustly handle a separate federated Name Service
disappearing. I'm planning on running it using twisted for various reasons
(common code, available functionality, etc). So I need to work out if I can
use Twisted and CORBA (Omniorb to be specific) together, ideally within the
same thread.

Currently the simple script has a Tkinter UI which also registers a callback
method with the Event Channel client wrapper to handle Event Messages. A
self-rescheduling callback is also configured to drive the Orb, at some
variable rate, and then the script is handled by the Tkiner mainloop. At
regular intervals the Orb is run then rescheduled and then control is
returned back to the Tk mainloop. I'm at home and can't remember the exact
code but something along the lines of:

def runOrb(self):
    if self.orb.work_pending():
        self.orb.perform_work()

This all seems to work well. However the script is fairly simple in that
it's only monitoring and reacting to Event Channel messages, so slightly
different from your use. However, I think that it demonstrates that the orb
can be run from within another event processing loop within the same single
thread - in this case the Tk mainloop.
Now the Tk event processing can be handled by the tksupport package so I
thought why not use that model for a CORBA support package?
I've totally copied the tksupport file (it's very small) and converted it to
perform the running and re-scheduling of the CORBA orb.

Sorry I can't provide you more info but as mentioned above I only got back
into this today (no testing yet) plus I finish work at that company in a few
days. If I get anywhere I'll post back some info. Hopefully it gives you
something to look into.

Regards,
Chris Laws
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070625/1fca5411/attachment.htm 

From brendoncolby at gmail.com  Mon Jun 25 11:17:24 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 10:17:24 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
Message-ID: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>

Greetings,

I've begun moving an application I wrote from asynchat to twisted.
I've got basic functionality, I've converted my DB stuff to adbapi and
have begun writing unit tests. I have a few questions that I haven't
been able to get answered through the API docs, twisted.words protocol
code, mailing list posts etc. I'd be very grateful for some
assistance!

1. Right now I'm defining my dbPool in my factory init, and running a
method to load some data from the DB. I've copied the IRC
BasicServerFunctionalityTestCase and modified it for my use:

class BasicServerFunctionalityTestCase(unittest.TestCase):
    def setUp(self):
        self.f = StringIOWithoutClosing()
        self.t = FileWrapperThatWorks(self.f) # I need this to return
an IPv4Address!
        self.p = sserverd.SServerProtocol()
        self.p.factory = sserverd.SServerFactory(self.p)
        self.p.makeConnection(self.t)
        self.p.factory.dbPool.start()

    def tearDown(self):
        self.p.factory.dbPool.close()

    def check(self, s):
        self.assertEquals(self.f.getvalue(), s)

    def testSendDeveloperID(self):
        self.p.lineReceived('{%s:"PG"}\0' % sserverson.base10toN(104))
        self.check("test\0")

I've gotten past the database threads hanging open by running start()
and close() manually. Now, my database callbacks that load necessary
data appear to be getting called AFTER my test runs. I know they're
getting called, but when the above test runs, the required data
structure is empty. What am I missing here?

2. I'm having a bit of trouble wrapping my head around adbapi. Prior
to it, one thing I would do is gather data and return a row, as in,
the method "developerExists()" would check the DB and return row[0][0]
or something (a bool). Now it seems as though I have to preload this
data and check against that. Can I replicate this behavior with
adbapi? Is there a better way than having to preload ALL my data up
front? How can I get any data from the DB like this:

data = getSomethingFromDB()

I'm suspicious that I need to adopt a new paradigm here, but am having
difficulty seeing past the old way of doing things!

3. I have some methods (as I pointed out in #1) that load data. With
adbapi, it appears that I have to do this:

  def _loadDevelopers(self,results):
    for result in results:
      developerID = result[2]
      ...
      self.addDeveloper(Developer(authHost,authUrl,developerID,self,rc4key,
        postHost,postUrl))

  def loadDevelopers(self):
    self.dbPool.runQuery("select * from developers where active=1").addCallback(
    self._loadDevelopers).addErrback(printError)
    # Before, I would just load my data here!

Is this correct? i.e. a DB method that gets called, each having a
corresponding callback method that does the real work? (This seems
sort of a pain to me...) I feel as though I'm close to "getting it"
(twisted in general, adbapi) but feel that I have yet to connect some
key pieces of information.

4. I was digging through the adbapi code, and it appears that the only
type of result set I can get is a tuple (because only cursors are
used...). Is there a way I can get a dictionary returned, keys are
column names? i.e. a MySqlDB.fetch_row(how=1). I'm just not seeing how
I can do this with adbapi or, rather, how I can pass through to the
MySqlDB module to get this type of result set.

5. I've always run my application using DJB's daemontools
(http://cr.yp.to/daemontools.html). Is there an incredibly compelling
reason to switch to using twistd? It seems to have some pretty neat
features, but I'm just not 100% sure I want to give up daemontools
yet.


Thanks!

Brendon Colby



From karlb at gmx.net  Mon Jun 25 11:35:06 2007
From: karlb at gmx.net (Karl Bartel)
Date: Mon, 25 Jun 2007 17:35:06 +0200
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
Message-ID: <467FE0AA.1000403@gmx.net>

Brendon Colby wrote:

> 4. I was digging through the adbapi code, and it appears that the only
> type of result set I can get is a tuple (because only cursors are
> used...). Is there a way I can get a dictionary returned, keys are
> column names? i.e. a MySqlDB.fetch_row(how=1). I'm just not seeing how
> I can do this with adbapi or, rather, how I can pass through to the
> MySqlDB module to get this type of result set.

This depends on your DBAPI implementation. psycopg2 and pysqlite have
optional support for this. I don't know about you mysql, though. Using
any of these is not DBAPI2 compliant, but it's extremely useful.

Bye,
Karl



From mithrandi-twisted-python at mithrandi.za.net  Mon Jun 25 12:19:03 2007
From: mithrandi-twisted-python at mithrandi.za.net (Tristan Seligmann)
Date: Mon, 25 Jun 2007 18:19:03 +0200
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
Message-ID: <20070625161903.GC3900@mithrandi.za.net>

* Brendon Colby <brendoncolby at gmail.com> [2007-06-25 10:17:24 -0500]:

> 5. I've always run my application using DJB's daemontools
> (http://cr.yp.to/daemontools.html). Is there an incredibly compelling
> reason to switch to using twistd? It seems to have some pretty neat
> features, but I'm just not 100% sure I want to give up daemontools
> yet.

I'd suggest doing both; just run twistd with the -n flag (--nodaemon) to
stop it from doing the daemonization itself.
-- 
mithrandi, i Ainil en-Balandor, a faer Ambar
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070625/27706a6c/attachment.pgp 

From christian.simms at gmail.com  Mon Jun 25 12:28:23 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Mon, 25 Jun 2007 12:28:23 -0400
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
Message-ID: <cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>

I think your biggest hurdle is that you need to get used to using Deferred's
in adbapi and any functions/methods that call adbapi indirectly.  Unless you
use a fast embedded database like Sqlite, you have to use Deferred's because
there's network traffic under the covers to the database server. I'll try to
include a little advice below for each item:


On 6/25/07, Brendon Colby <brendoncolby at gmail.com> wrote:
>
> Greetings,
>
> I've begun moving an application I wrote from asynchat to twisted.
> I've got basic functionality, I've converted my DB stuff to adbapi and
> have begun writing unit tests. I have a few questions that I haven't
> been able to get answered through the API docs, twisted.words protocol
> code, mailing list posts etc. I'd be very grateful for some
> assistance!
>
> 1. Right now I'm defining my dbPool in my factory init, and running a
> method to load some data from the DB. I've copied the IRC
> BasicServerFunctionalityTestCase and modified it for my use:
>
> class BasicServerFunctionalityTestCase(unittest.TestCase):
>     def setUp(self):
>         self.f = StringIOWithoutClosing()
>         self.t = FileWrapperThatWorks(self.f) # I need this to return
> an IPv4Address!
>         self.p = sserverd.SServerProtocol()
>         self.p.factory = sserverd.SServerFactory(self.p)
>         self.p.makeConnection(self.t)
>         self.p.factory.dbPool.start()
>
>     def tearDown(self):
>         self.p.factory.dbPool.close()
>
>     def check(self, s):
>         self.assertEquals(self.f.getvalue(), s)
>
>     def testSendDeveloperID(self):
>         self.p.lineReceived('{%s:"PG"}\0' % sserverson.base10toN(104))
>         self.check("test\0")
>
> I've gotten past the database threads hanging open by running start()
> and close() manually. Now, my database callbacks that load necessary
> data appear to be getting called AFTER my test runs. I know they're
> getting called, but when the above test runs, the required data
> structure is empty. What am I missing here?


I think you have a race condition because (I assume)
self.p.lineReceivedindirectly did a database insert, and then the
self.check did a database select.  If that's true, you should make your test
use Deferred's like this:

  d = defer.succeed(None)
  d.addCallback(lambda out: self.p.lineReceived('{%s:"PG"}\0' %
sserverson.base10toN(104))
  d.addCallback(lambda out: self.check("test\0"))
  return d

You could also write this code using the new defer.inlineCallbacks (needs
python 2.5) or the older defer.deferredGenerator, but you might as well get
used to using callbacks/errbacks and Deferred's.


2. I'm having a bit of trouble wrapping my head around adbapi. Prior
> to it, one thing I would do is gather data and return a row, as in,
> the method "developerExists()" would check the DB and return row[0][0]
> or something (a bool). Now it seems as though I have to preload this
> data and check against that. Can I replicate this behavior with
> adbapi? Is there a better way than having to preload ALL my data up
> front? How can I get any data from the DB like this:
>
> data = getSomethingFromDB()
>
> I'm suspicious that I need to adopt a new paradigm here, but am having
> difficulty seeing past the old way of doing things!


You're right that you need a new paradigm, like this:

  def cb(data):
       # use the data here, in the callback function
  return getSomethingFromDB().addCallback(cb)

This assumes getSomethingFromDB() returns a Deferred which fires with the
result you wanted.

3. I have some methods (as I pointed out in #1) that load data. With
> adbapi, it appears that I have to do this:
>
>   def _loadDevelopers(self,results):
>     for result in results:
>       developerID = result[2]
>       ...
>       self.addDeveloper
> (Developer(authHost,authUrl,developerID,self,rc4key,
>         postHost,postUrl))
>
>   def loadDevelopers(self):
>     self.dbPool.runQuery("select * from developers where
> active=1").addCallback(
>     self._loadDevelopers).addErrback(printError)
>     # Before, I would just load my data here!
>
> Is this correct? i.e. a DB method that gets called, each having a
> corresponding callback method that does the real work? (This seems
> sort of a pain to me...) I feel as though I'm close to "getting it"
> (twisted in general, adbapi) but feel that I have yet to connect some
> key pieces of information.



This is basically correct, though loadDevelopers should probably return the
result of the runQuery() call.


4. I was digging through the adbapi code, and it appears that the only
> type of result set I can get is a tuple (because only cursors are
> used...). Is there a way I can get a dictionary returned, keys are
> column names? i.e. a MySqlDB.fetch_row(how=1). I'm just not seeing how
> I can do this with adbapi or, rather, how I can pass through to the
> MySqlDB module to get this type of result set.



If you can't find a MySQL-specific way to get a dictionary, you can always
write a generic python function which does so, and then always call that in
your code.  adbapi doesn't do this for you.

5. I've always run my application using DJB's daemontools
> (http://cr.yp.to/daemontools.html). Is there an incredibly compelling
> reason to switch to using twistd? It seems to have some pretty neat
> features, but I'm just not 100% sure I want to give up daemontools
> yet.


You really need to run your twisted app with twistd.  That's the abstraction
for launching twisted programs -- i.e., you define a variable named
"application" in your .tac file and then use twistd to start your app.  Of
course, there's nothing stopping you from using daemontools on top of it.

Thanks!
>
> Brendon Colby
>

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070625/63d0a358/attachment.htm 

From exarkun at divmod.com  Mon Jun 25 12:49:00 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 25 Jun 2007 12:49:00 -0400
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
Message-ID: <20070625164900.4947.876038890.divmod.quotient.4267@ohm>

On Mon, 25 Jun 2007 12:28:23 -0400, Christian Simms <christian.simms at gmail.com> wrote:
> [snip]
>
>I think you have a race condition because (I assume)
>self.p.lineReceivedindirectly did a database insert, and then the
>self.check did a database select.  If that's true, you should make your test
>use Deferred's like this:
>
>  d = defer.succeed(None)
>  d.addCallback(lambda out: self.p.lineReceived('{%s:"PG"}\0' %
>sserverson.base10toN(104))
>  d.addCallback(lambda out: self.check("test\0"))
>  return d
>
>You could also write this code using the new defer.inlineCallbacks (needs
>python 2.5) or the older defer.deferredGenerator, but you might as well get
>used to using callbacks/errbacks and Deferred's.
>

Note that the above requires lineReceived to return a Deferred which only
fires after the insert has completed and check to return a Deferred which
represents the result of the select (if those are indeed the underlying
operations).

Jean-Paul



From brendoncolby at gmail.com  Mon Jun 25 15:35:23 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 14:35:23 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <467FE0AA.1000403@gmx.net>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<467FE0AA.1000403@gmx.net>
Message-ID: <e64b001e0706251235i4df9d263md04a856d03504417@mail.gmail.com>

On 6/25/07, Karl Bartel <karlb at gmx.net> wrote:
> Brendon Colby wrote:
>
> > 4. I was digging through the adbapi code, and it appears that the only
> > type of result set I can get is a tuple (because only cursors are
> > used...). Is there a way I can get a dictionary returned, keys are
> > column names? i.e. a MySqlDB.fetch_row(how=1). I'm just not seeing how
> > I can do this with adbapi or, rather, how I can pass through to the
> > MySqlDB module to get this type of result set.
>
> This depends on your DBAPI implementation. psycopg2 and pysqlite have
> optional support for this. I don't know about you mysql, though. Using
> any of these is not DBAPI2 compliant, but it's extremely useful.

Aha! This got me thinking...so I dug into the MySQLdb README file
(again). To be able to get a tuple of dictionaries returned while
using adbabi/MySQLdb, you simply have to do:

    self.dbPool = adbapi.ConnectionPool("MySQLdb",host=host,port=port,
                                        user=username,passwd=password,
                                        db=database,
                                        cursorclass=DictCursor) #<-----

Since MySQLdb implements cursors in Python, one can subclass the base
cursor class or use one of the several others provided - in this case
DictCursor. This just wasn't obvious to me (never was) in the README!

Brendon



From brendoncolby at gmail.com  Mon Jun 25 15:57:50 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 14:57:50 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
Message-ID: <e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>

On 6/25/07, Christian Simms <christian.simms at gmail.com> wrote:
> I think your biggest hurdle is that you need to get used to using Deferred's
> in adbapi and any functions/methods that call adbapi indirectly.  Unless you
> use a fast embedded database like Sqlite, you have to use Deferred's because
> there's network traffic under the covers to the database server. I'll try to
> include a little advice below for each item:

Yep this is precisely what I am attempting to do - get used to using
deferreds (properly).

> I think you have a race condition because (I assume) self.p.lineReceived
> indirectly did a database insert, and then the self.check did a database
> select.  If that's true, you should make your test use Deferred's like this:

No - I'm just doing a series of runQuerys() when the server starts,
the callbacks of which populate dictionaries with objects. The test
sends a string identifier to the server which checks whether or not it
exists in one of these dictionaries. When the test runs, the dict is
empty. However, the load method IS running, just (seemingly) after the
test is run. I guess I'm not sure how to code a test for this, as in,
"after the database connection has been made and the data loaded, THEN
start running tests."

>   d = defer.succeed(None)
>   d.addCallback(lambda out: self.p.lineReceived('{%s:"PG"}\0' %
> sserverson.base10toN(104))
>   d.addCallback(lambda out: self.check("test\0"))
>   return d
>
> You could also write this code using the new defer.inlineCallbacks (needs
> python 2.5) or the older defer.deferredGenerator, but you might as well get
> used to using callbacks/errbacks and Deferred's.

Hrm yes, I'm using Debian stock 2.4, but wouldn't be opposed to hand
installing a few things (like twisted). I've done it many times. A
quick check of deferredGenerator and inlineCallbacks...these look
_exactly_ like what I'm asking for. I might just stick with 2.4 and
deferredGenerator.

> You're right that you need a new paradigm, like this:
>
>   def cb(data):
>        # use the data here, in the callback function
>   return getSomethingFromDB().addCallback(cb)
>
> This assumes getSomethingFromDB() returns a Deferred which fires with the
> result you wanted.

Yep, that's basically exactly what I'm doing now.

> You really need to run your twisted app with twistd.  That's the abstraction
> for launching twisted programs -- i.e., you define a variable named
> "application" in your .tac file and then use twistd to start your app.  Of
> course, there's nothing stopping you from using daemontools on top of it.

Yep, that's exactly what I had considered doing. It doesn't appear to
difficult to convert to using twistd run out of daemontools.

Thanks!

Brendon



From exarkun at divmod.com  Mon Jun 25 16:12:11 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 25 Jun 2007 16:12:11 -0400
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
Message-ID: <20070625201211.4947.1635239258.divmod.quotient.4321@ohm>

On Mon, 25 Jun 2007 14:57:50 -0500, Brendon Colby <brendoncolby at gmail.com> wrote:
> [snip]
>
>Hrm yes, I'm using Debian stock 2.4, but wouldn't be opposed to hand
>installing a few things (like twisted). I've done it many times. A
>quick check of deferredGenerator and inlineCallbacks...these look
>_exactly_ like what I'm asking for. I might just stick with 2.4 and
>deferredGenerator.

I just want to point out that neither deferredGenerator nor inlineCallbacks
does anything _new_ - they only provide an alternate API for defining
callbacks and errbacks (an API that lets you use code inline within a
single function without defining new functions).  If your code doesn't
execute in the right order without deferredGenerator, it won't execute
in the right order with deferredGenerator either.

Jean-Paul



From brendoncolby at gmail.com  Mon Jun 25 16:40:00 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 15:40:00 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <20070625201211.4947.1635239258.divmod.quotient.4321@ohm>
References: <e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
	<20070625201211.4947.1635239258.divmod.quotient.4321@ohm>
Message-ID: <e64b001e0706251340m7e06fb52nc81f040193cf8c68@mail.gmail.com>

On 6/25/07, Jean-Paul Calderone <exarkun at divmod.com> wrote:
> I just want to point out that neither deferredGenerator nor inlineCallbacks
> does anything _new_ - they only provide an alternate API for defining
> callbacks and errbacks (an API that lets you use code inline within a
> single function without defining new functions).  If your code doesn't
> execute in the right order without deferredGenerator, it won't execute
> in the right order with deferredGenerator either.

Yep - I meant that I could definitely use this in my code, but not
specifically to fix my unittest issues, which I haven't corrected yet.

Brendon



From nico at tekNico.net  Mon Jun 25 17:02:42 2007
From: nico at tekNico.net (Nicola Larosa)
Date: Mon, 25 Jun 2007 23:02:42 +0200
Subject: [Twisted-Python] Re: Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706251235i4df9d263md04a856d03504417@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>	<467FE0AA.1000403@gmx.net>
	<e64b001e0706251235i4df9d263md04a856d03504417@mail.gmail.com>
Message-ID: <46802D72.2060109@tekNico.net>

Brendon Colby wrote:
> Aha! This got me thinking...so I dug into the MySQLdb README file
> (again).

Friends don't let friends use MySQL.

Sure, you're not my friend yet, but if this doesn't make you one, I don't
know what will: ;-)

MySQL-PostgreSQL comparison
http://www.teknico.net/devel/myvspg/index.en.html


-- 
Nicola Larosa - http://www.tekNico.net/

We're seeing a realization that 20 years into the experiment, strict OO
design is not the be-all and end-all of complexity management. Functional
programming probably isn't either. The hybrids (Python, Ruby, JavaScript,
etc.) seem to have real legs these days. -- Alex Russell, August 2006





From brendoncolby at gmail.com  Mon Jun 25 17:47:38 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 16:47:38 -0500
Subject: [Twisted-Python] Re: Testing with trial, adbapi questions
In-Reply-To: <46802D72.2060109@tekNico.net>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<467FE0AA.1000403@gmx.net>
	<e64b001e0706251235i4df9d263md04a856d03504417@mail.gmail.com>
	<46802D72.2060109@tekNico.net>
Message-ID: <e64b001e0706251447r3ce7b976xc4a18209dc4cc253@mail.gmail.com>

On 6/25/07, Nicola Larosa <nico at teknico.net> wrote:
> Friends don't let friends use MySQL.

Interesting comparison. I've always used MySQL and for what I'm doing
it probably wouldn't matter either way. The most compelling reason for
me to switch would be because I've always wanted to learn how to use
Postgres. :)

Brendon



From matt at zgroupplc.com  Tue Jun 26 07:02:48 2007
From: matt at zgroupplc.com (Matthew Glubb)
Date: Tue, 26 Jun 2007 12:02:48 +0100
Subject: [Twisted-Python] Thank You Twisted!
Message-ID: <8AD10718-5F16-4788-95C1-36F123A9F1C5@zgroupplc.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi All,

I just wanted to say thanks for all of the good work with twisted. I  
have just finished testing my server application on a 1GB box for 1  
hour with 10,000 simultaneous connections and it ran like a dream :)  
Granted, trying anything other than the epoll reactor brought the  
server to its knees very quickly.

By the way, for any of you using memcache, don't be tempted by  
cmemcache if you are deferring those operations to a thread. Seems  
like cmemcache is not thread safe. I was getting lots of seg faults  
until I switched back to the pure python memcache module.

Thanks again :)


Matt


m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: <http://www.zgroupplc.com/>

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify <service at zgroupplc.com>



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGgPJbyI6MkdKPngkRAlX5AJ9VsThIgIiT9FoEyPlYOtS5O8T9wwCeM9LN
DLTVdulqFZ3pPS4TnHRvIX0=
=PCMS
-----END PGP SIGNATURE-----



From christian.simms at gmail.com  Tue Jun 26 10:27:28 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Tue, 26 Jun 2007 10:27:28 -0400
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
	<e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
Message-ID: <cd8fa6f90706260727l667f3e72we349e32ac40260cf@mail.gmail.com>

On 6/25/07, Brendon Colby <brendoncolby at gmail.com> wrote:
>
> On 6/25/07, Christian Simms <christian.simms at gmail.com> wrote:
>
> [snip]
> > I think you have a race condition because (I assume) self.p.lineReceived
> > indirectly did a database insert, and then the self.check did a database
> > select.  If that's true, you should make your test use Deferred's like
> this:
>
> No - I'm just doing a series of runQuerys() when the server starts,
> the callbacks of which populate dictionaries with objects. The test
> sends a string identifier to the server which checks whether or not it
> exists in one of these dictionaries. When the test runs, the dict is
> empty. However, the load method IS running, just (seemingly) after the
> test is run. I guess I'm not sure how to code a test for this, as in,
> "after the database connection has been made and the data loaded, THEN
> start running tests."
>
[snip]
>


Looks like I mis-assumed your problem, sorry.  In the setUp method in your
tests, you should return a Deferred which fires when all your data is
loaded.  This can be a pain if you already organized your code into classes
inheriting from twisted.application.service.Service which have
startService/stopService calls. It's a pain because trial doesn't create an
application object like running inside twistd does.  So, in the case of
writing unit tests for applications, you can abstract out your
initialization code into a method, and then call that method directly in
your setUp method.

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070626/73fa62b6/attachment.htm 

From matt at zgroupplc.com  Tue Jun 26 12:00:33 2007
From: matt at zgroupplc.com (Matthew Glubb)
Date: Tue, 26 Jun 2007 17:00:33 +0100
Subject: [Twisted-Python] Pydoc and Zope Interfaces
Message-ID: <EBB32E03-4DDB-417F-9C94-F70FD94B0AE6@zgroupplc.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi All,

Sorry if this is slightly off-topic but Zope doesn't use pydoc so its  
not an issue for their users. Has anyone found an easy to apply patch  
for pydoc that will list the documentation for classes that use  
implements(). At the moment, it throws an AttributeError and reverts  
to what looks like __repr__.

I found a patch here:

<http://simpleparse.sourceforge.net/pydoc/pydoc2.py>

Which purports to be able to cope with implements() in classes but  
its beyond my simple python brain to implement right now.

Thanks,


Matt


m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: <http://www.zgroupplc.com/>

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify <service at zgroupplc.com>



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGgTgjyI6MkdKPngkRAmMaAJ9TPzxTmYutAjAPkvef4YPb38N2JACfc9TE
WvwBqTRzhgBdE+p2oG4A6YU=
=rfAX
-----END PGP SIGNATURE-----



From radix at twistedmatrix.com  Tue Jun 26 12:13:45 2007
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Tue, 26 Jun 2007 12:13:45 -0400
Subject: [Twisted-Python] Pydoc and Zope Interfaces
In-Reply-To: <EBB32E03-4DDB-417F-9C94-F70FD94B0AE6@zgroupplc.com>
References: <EBB32E03-4DDB-417F-9C94-F70FD94B0AE6@zgroupplc.com>
Message-ID: <60ed19d40706260913v132fab14j377d06daad87d2a3@mail.gmail.com>

On 6/26/07, Matthew Glubb <matt at zgroupplc.com> wrote:
> Hi All,
>
> Sorry if this is slightly off-topic but Zope doesn't use pydoc so its
> not an issue for their users. Has anyone found an easy to apply patch
> for pydoc that will list the documentation for classes that use
> implements(). At the moment, it throws an AttributeError and reverts
> to what looks like __repr__.

Twisted also doesn't use pydoc. We use pydoctor, which supports
zope.interface pretty well.

http://codespeak.net/~mwh/pydoctor/

-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From matt at zgroupplc.com  Tue Jun 26 12:27:10 2007
From: matt at zgroupplc.com (Matthew Glubb)
Date: Tue, 26 Jun 2007 17:27:10 +0100
Subject: [Twisted-Python] Pydoc and Zope Interfaces
In-Reply-To: <60ed19d40706260913v132fab14j377d06daad87d2a3@mail.gmail.com>
References: <EBB32E03-4DDB-417F-9C94-F70FD94B0AE6@zgroupplc.com>
	<60ed19d40706260913v132fab14j377d06daad87d2a3@mail.gmail.com>
Message-ID: <2DD3DA13-61CF-47E8-80C9-B4A92914C676@zgroupplc.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Aha! Thanks you very much Christopher :)

On 26 Jun 2007, at 17:13, Christopher Armstrong wrote:

> On 6/26/07, Matthew Glubb <matt at zgroupplc.com> wrote:
>> Hi All,
>>
>> Sorry if this is slightly off-topic but Zope doesn't use pydoc so its
>> not an issue for their users. Has anyone found an easy to apply patch
>> for pydoc that will list the documentation for classes that use
>> implements(). At the moment, it throws an AttributeError and reverts
>> to what looks like __repr__.
>
> Twisted also doesn't use pydoc. We use pydoctor, which supports
> zope.interface pretty well.
>
> http://codespeak.net/~mwh/pydoctor/
>
> -- 
> Christopher Armstrong
> International Man of Twistery
> http://radix.twistedmatrix.com/
> http://twistedmatrix.com/
> http://canonical.com/
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: <http://www.zgroupplc.com/>

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify <service at zgroupplc.com>



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGgT5eyI6MkdKPngkRAkysAKCImSro59ai4r3JSjwiKyI7xuwdcgCeMLcN
rLtqiwYAEtI/YU0zj+PG2vE=
=QLqm
-----END PGP SIGNATURE-----



From apt.shansen at gmail.com  Tue Jun 26 13:03:26 2007
From: apt.shansen at gmail.com (Stephen Hansen)
Date: Tue, 26 Jun 2007 10:03:26 -0700
Subject: [Twisted-Python] twisted.conch.telnet example?
Message-ID: <7a9c25c20706261003h4fcf6543xdece09644999b339@mail.gmail.com>

Hello all. :)

I'm trying to learn Twisted, and to replace irritating telnetlib code for a
simple telnet client application to do so. The problem is I'm slightly lost
as to where to start with the twisted.conch.telnet library, so was wondering
if anyone could point me to a simple example.

So far, I understand the whole client factory thing-- but where I start
getting lost is where we get to the "protocol" point (I know I know-- so
early to get confused!).

Specifically, in the buildProtocol method of a ReconnectingClientFactory
instance.. what should I be returning a subclass of?

There's a telnet.Telnet, which /looks/ like it would be handling all of the
telnet negotiation nicely, but it has methods like "def enableRemote" that
call "self.protocol.enableRemote".. and I'm not sure what should be put
there, or how that should have been handled.

My best success so far was to have it return a subclass of
telnet.StatefulTelnetProtocol. It does the "basis" of what I want: a
line-oriented output from the telnet protocol connection. However, it also
returns all the negotiation characters, so it seems like it's not actually
implementing the telnet negotiation part itself.

Then there's telnet.TelnetBootstrapProtocol which looks very interesting but
looks like its mostly handling telnet features I'm not interested in
(various line modes, screen size negotiation, etc) yet... and a
telnet.TelnetProtocol that I'm very confused by.. it's inheriting from
ITelnetProtocol which appears to define the basic negotiation methods, but
it doesn't appear to -do- anything. (And telnet.Telnet, which does
notinherit from that interface, does appear to support -doing- the
negotiation)

This might all be a lot of babbling, and if so-- sorry! I'm just not sure
where to get started on understanding what's going on in this module to make
use of it. :) I tried googling around to see if I could find a simple
display of gluing the conch modules together to produce a line-oriented
telnet client connection that appeared to handle the negotiation ... just to
get started-- and I can't find one. Does anyone know of one? (Or, if I give
you $0.25, could you throw one together? :))

Thanks in advance.

--S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070626/b5cb5091/attachment.htm 

From exarkun at divmod.com  Tue Jun 26 15:08:01 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 26 Jun 2007 15:08:01 -0400
Subject: [Twisted-Python] twisted.conch.telnet example?
In-Reply-To: <7a9c25c20706261003h4fcf6543xdece09644999b339@mail.gmail.com>
Message-ID: <20070626190801.4947.677787221.divmod.quotient.4523@ohm>

On Tue, 26 Jun 2007 10:03:26 -0700, Stephen Hansen <apt.shansen at gmail.com> wrote:
>Hello all. :)

Hey!

>
>I'm trying to learn Twisted, and to replace irritating telnetlib code for a
>simple telnet client application to do so. The problem is I'm slightly lost
>as to where to start with the twisted.conch.telnet library, so was wondering
>if anyone could point me to a simple example.

Cool.  :)

>
>So far, I understand the whole client factory thing-- but where I start
>getting lost is where we get to the "protocol" point (I know I know-- so
>early to get confused!).
>
>Specifically, in the buildProtocol method of a ReconnectingClientFactory
>instance.. what should I be returning a subclass of?

The documentation for this part of Twisted is basically completely
missing.  That'd be my fault, I really should have written some, either
when telnet was implemented or some time in the two years since. ;)

So, to start, I'll try to give a high-level overview.


Then there's t.c.telnet.

>
>There's a telnet.Telnet, which /looks/ like it would be handling all of the
>telnet negotiation nicely, but it has methods like "def enableRemote" that
>call "self.protocol.enableRemote".. and I'm not sure what should be put
>there, or how that should have been handled.

Yep.  t.c.telnet.Telnet is a Protocol subclass and so implements
IProtocol: it is the class which actually implements the telnet
protocol.  It goes right on top of an ITCPTransport and its dataReceived
knows about telnet escapes and the other features of the telnet
protocol.  When it gets bytes which represent some telnet protocol
action, a Telnet instance calls either negotiate or commandReceived on
itself.  The default implementation of these methods dispatches the
event to handlers defined by negotiationMap and
enableLocal/disableLocal/enableRemote/disableRemote, respectively.  In
turn, {enable,disable}{Local,Remote} dispatch to another object,
self.protocol, as you noticed.

There's also a subclass of Telnet, TelnetTransport.  TelnetTransport
takes a protocol class and some arguments to its initializer.  When
TelnetTransport is connected to an ITCPTransport, it instantiates the
class it was given and saves the instance as self.protocol.  As a Telnet
subclass, this means that the protocol class passed to TelnetTransport's
initializer can now control how negotiations happen and how to respond
to commands.

>
>My best success so far was to have it return a subclass of
>telnet.StatefulTelnetProtocol. It does the "basis" of what I want: a
>line-oriented output from the telnet protocol connection. However, it also
>returns all the negotiation characters, so it seems like it's not actually
>implementing the telnet negotiation part itself.
>

StatefulTelnetProtocol is a TelnetProtocol.  TelnetProtocol is the
intended base class for anything which is passed to TelnetTransport.
TelnetProtocol is an ITelnetProtocol, so actually anywhere a
TelnetProtocol class will work, so will any other class which implements
ITelnetProtocol.

TelnetProtocol doesn't know anything about the actual telnet protocol -
its name attempts to convey that it /is/ a protocol /for/ telnet: it can
receive application level bytes (dataReceived, inherited from
IProtocol/Protocol), but it can also handle events which can only happen
when you're using telnet: those four enable/disable methods, plus some
catch-alls for negotiation about options which aren't recognized.  Since
TelnetProtocol doesn't know the telnet protocol, if you hook it directly
up to an ITCPTransport, it'll just think everything it gets is
application data, even telnet negotiation sequences.

>Then there's telnet.TelnetBootstrapProtocol which looks very
>interesting but looks like its mostly handling telnet features I'm not
>interested in (various line modes, screen size negotiation, etc)
>yet... and a telnet.TelnetProtocol that I'm very confused by.. it's
>inheriting from ITelnetProtocol which appears to define the basic
>negotiation methods, but it doesn't appear to -do- anything. (And
>telnet.Telnet, which does notinherit from that interface, does appear
>to support -doing- the negotiation)

TelnetBootstrapProtocol is another one like StatefulTelnetProtocol - it
adds some features which may or may not be interesting, but it won't
work by itself, it needs TelnetTransport to actually parse the protocol.

>
>This might all be a lot of babbling, and if so-- sorry! I'm just not sure
>where to get started on understanding what's going on in this module to make
>use of it. :) I tried googling around to see if I could find a simple
>display of gluing the conch modules together to produce a line-oriented
>telnet client connection that appeared to handle the negotiation ... just to
>get started-- and I can't find one. Does anyone know of one? (Or, if I give
>you $0.25, could you throw one together? :))

Hopefully the above has given you a better idea of what all the pieces
are supposed to be doing.  Here's an example of how you might hook them
up to each other, by way of a client which prints all application data
it receives:

  from twisted.internet import reactor
  from twisted.internet.protocol import ClientFactory
  from twisted.conch.telnet import TelnetTransport, TelnetProtocol

  class TelnetPrinter(TelnetProtocol):
      def dataReceived(self, bytes):
          print 'Received:', repr(bytes)

  class TelnetFactory(ClientFactory):
      def buildProtocol(self, addr):
          return TelnetTransport(TelnetPrinter)

  reactor.connectTCP(host, port, TelnetFactory())

For something line oriented, you might mix in LineReceiver (as
StatefulTelnetProtocol does) or instantiate one directly yourself in a
TelnetProtocol subclass and feed it bytes in your dataReceived
implementation.

Hope this helps,

Jean-Paul



From brendoncolby at gmail.com  Tue Jun 26 17:50:45 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Tue, 26 Jun 2007 16:50:45 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <cd8fa6f90706260727l667f3e72we349e32ac40260cf@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
	<e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
	<cd8fa6f90706260727l667f3e72we349e32ac40260cf@mail.gmail.com>
Message-ID: <e64b001e0706261450s4e01a8c6hc8afed78345d2e74@mail.gmail.com>

On 6/26/07, Christian Simms <christian.simms at gmail.com> wrote:
> Looks like I mis-assumed your problem, sorry.  In the setUp method in your
> tests, you should return a Deferred which fires when all your data is
> loaded.  This can be a pain if you already organized your code into classes
> inheriting from twisted.application.service.Service which
> have startService/stopService calls. It's a pain because trial doesn't
> create an application object like running inside twistd does.  So, in the
> case of writing unit tests for applications, you can abstract out your
> initialization code into a method, and then call that method directly in
> your setUp method.

OK - I will work on this and see if I can figure it out. Thanks for the tip.

Brendon



From apt.shansen at gmail.com  Tue Jun 26 19:32:54 2007
From: apt.shansen at gmail.com (Stephen Hansen)
Date: Tue, 26 Jun 2007 16:32:54 -0700
Subject: [Twisted-Python] twisted.conch.telnet example?
In-Reply-To: <20070626190801.4947.677787221.divmod.quotient.4523@ohm>
References: <7a9c25c20706261003h4fcf6543xdece09644999b339@mail.gmail.com>
	<20070626190801.4947.677787221.divmod.quotient.4523@ohm>
Message-ID: <7a9c25c20706261632w47fc7897paab2f5dc70fa0605@mail.gmail.com>

>   class TelnetFactory(ClientFactory):
>       def buildProtocol(self, addr):
>           return TelnetTransport(TelnetPrinter)
>
>   reactor.connectTCP(host, port, TelnetFactory())
>
> For something line oriented, you might mix in LineReceiver (as
> StatefulTelnetProtocol does) or instantiate one directly yourself in a
> TelnetProtocol subclass and feed it bytes in your dataReceived
> implementation.
>
> Hope this helps,


Oh, perfect. That was very useful, thanks. I had a feeling the problem was
in  plugging the objects together properly in buildProtocol, but  just
couldn't see quite how to do it right.

Merci!

--S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070626/86bd856f/attachment.htm 

From steven.zdwang at gmail.com  Tue Jun 26 22:02:15 2007
From: steven.zdwang at gmail.com (steven wang)
Date: Wed, 27 Jun 2007 10:02:15 +0800
Subject: [Twisted-Python] How to receive a big stream data?
Message-ID: <5c6c8710706261902u347d25e0lc7375d23ef760dd5@mail.gmail.com>

Dear all,

I'm using the Twisted to write a socket server. I has a problem in the
socket server. I could not receive a big size data when the data size is
bigger then the connection buffersize.

The protocol description:

First, Client send data head to Server.  Head Format:
ABC,123456,XXX,XXX,XXX^
Second, Client send big data to Server, the big data is stream data.
After Server received the big data and then save it to database.

My problem source code :
================================================================================================
class MyProtocol(protocol.Protocol):

        is_big_data = False
        big_data = ''
        big_data_size = 0

    def connectionMade(self):
            self.big_data = ''
            self.big_data_size = 0
            self.is_big_data = False
                pass

    def dataReceived(self, data):

         if check_head_ok(data):
            # To receive the big size data
            if self.is_big_data:
                return

        # The big data will overflow the Twisted receive buffer size, so
loop to receive data
        if is_big_size_data:
                big_data += data

                if big_data_size == len(big_data):
                        # To save data to database
                        ....
                        pass

    def connectionLost(self, reason):
          self.big_data = ''
          self.big_data_size = 0
          self.is_big_data = False
          pass

    def check_head_ok(self, head):
          if data.startswith('ABC'):
                  values = data.split(',')
                  self.big_data_size = int(values[1])
                  self.is_big_data = self.big_data_size > 0
                  return True
          else:
                  return False
================================================================================================

If you know it, Please tell me. Thank you very much! :)


Beat Regards,
Steven. Wang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070627/8d3e9bbc/attachment.htm 

From arnarbi at gmail.com  Wed Jun 27 04:21:15 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Wed, 27 Jun 2007 08:21:15 +0000
Subject: [Twisted-Python] How to receive a big stream data?
In-Reply-To: <5c6c8710706261902u347d25e0lc7375d23ef760dd5@mail.gmail.com>
References: <5c6c8710706261902u347d25e0lc7375d23ef760dd5@mail.gmail.com>
Message-ID: <28012bc60706270121k2bae8c8ey60f591e003cf8006@mail.gmail.com>

You're missing "self." in several places..

On 6/27/07, steven wang <steven.zdwang at gmail.com> wrote:
================================================================================================
> class MyProtocol(protocol.Protocol):
>
>          is_big_data = False
>         big_data = ''
>          big_data_size = 0
>
>      def connectionMade(self):
>             self.big_data = ''
>              self.big_data_size = 0
>             self.is_big_data = False
>                  pass
>
>     def dataReceived(self, data):
>
>          if check_head_ok(data):
should be self.check_head_ok(data)

>             # To receive the big size data
>             if self.is_big_data:
>                 return
>
>         # The big data will overflow the Twisted receive buffer size, so
> loop to receive data
>         if is_big_size_data:

self.is_big_size_data

>                 big_data += data

self.big_data

>
>                 if big_data_size == len(big_data):

self.big_data_size == len(self.big_data)

>                         # To save data to database
>                         ....
>                         pass
>
>     def connectionLost(self, reason):
>            self.big_data = ''
>           self.big_data_size = 0
>            self.is_big_data = False
>           pass
>
>     def check_head_ok(self, head):
>            if data.startswith('ABC'):
>                   values = data.split(',')
>                    self.big_data_size = int(values[1])
>                   self.is_big_data = self.big_data_size > 0
>                   return True
>           else:
>                   return False
> ================================================================================================

The check_head_ok also won't work like that. First off you need to
change head to values there - and since dataReceived is called
multiple times, you need to make sure check_head_ok is only called at
the beginning.

Arnar



From steven.zdwang at gmail.com  Wed Jun 27 05:21:17 2007
From: steven.zdwang at gmail.com (steven wang)
Date: Wed, 27 Jun 2007 17:21:17 +0800
Subject: [Twisted-Python] How to receive a big stream data?
In-Reply-To: <28012bc60706270121k2bae8c8ey60f591e003cf8006@mail.gmail.com>
References: <5c6c8710706261902u347d25e0lc7375d23ef760dd5@mail.gmail.com>
	<28012bc60706270121k2bae8c8ey60f591e003cf8006@mail.gmail.com>
Message-ID: <5c6c8710706270221u4f7571dbq511d9fe1ef746da8@mail.gmail.com>

hi!,  This is a clerical error. I rewrite it.

>     def check_head_ok(self, data):
>            if data.startswith('ABC'):
>                   values = data.split(',')
>                    self.big_data_size = int(values[1])
>                   self.is_big_data = self.big_data_size > 0
>                   return True
>           else:
>                   return False
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070627/150b6268/attachment.htm 

From rampeters at gmail.com  Wed Jun 27 08:11:04 2007
From: rampeters at gmail.com (Ram Peters)
Date: Wed, 27 Jun 2007 08:11:04 -0400
Subject: [Twisted-Python] Open Source Twisted Email Server
Message-ID: <81b45360706270511v70ee423fj4142585292b81f81@mail.gmail.com>

Is there a Open Source Twisted Email Server that have been implemented?

thnx.



From exarkun at divmod.com  Wed Jun 27 08:17:29 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 27 Jun 2007 08:17:29 -0400
Subject: [Twisted-Python] Open Source Twisted Email Server
In-Reply-To: <81b45360706270511v70ee423fj4142585292b81f81@mail.gmail.com>
Message-ID: <20070627121729.4947.52789419.divmod.quotient.4664@ohm>

On Wed, 27 Jun 2007 08:11:04 -0400, Ram Peters <rampeters at gmail.com> wrote:
>Is there a Open Source Twisted Email Server that have been implemented?

There are several, including one in Twisted itself.  Whether any of them are
appropriate for any particular purpose may be up for discussion (a good
beginning to which might be specifying what particular purpose you have in
mind ;).

Jean-Paul



From markus at bluegap.ch  Wed Jun 27 08:46:47 2007
From: markus at bluegap.ch (Markus Schiltknecht)
Date: Wed, 27 Jun 2007 14:46:47 +0200
Subject: [Twisted-Python] profiling twisted
Message-ID: <46825C37.7060100@bluegap.ch>

Hi,

first of all, thank you very much for this great peace of software, I'm 
using twisted for many different projects and really enjoy it's clean 
and simple design.

Now, I'm wondering if there's a profiling tool, which can quickly tell 
me what events are blocking my server. I have even deferred the file I/O 
to separate threads, as I've suspected them to make the server behave 
poorly when under load. But there still seems to be something 
blocking...  What do you use to find the callbacks which block (for too 
long)?

Regards

Markus



From mcfletch at vrplumber.com  Wed Jun 27 09:23:44 2007
From: mcfletch at vrplumber.com (Mike C. Fletcher)
Date: Wed, 27 Jun 2007 09:23:44 -0400
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <46825C37.7060100@bluegap.ch>
References: <46825C37.7060100@bluegap.ch>
Message-ID: <468264E0.3030507@vrplumber.com>

Markus Schiltknecht wrote:
...
> Now, I'm wondering if there's a profiling tool, which can quickly tell 
> me what events are blocking my server. I have even deferred the file 
> I/O to separate threads, as I've suspected them to make the server 
> behave poorly when under load. But there still seems to be something 
> blocking...  What do you use to find the callbacks which block (for 
> too long)?
http://blog.vrplumber.com/1353

HTH,
Mike

-- 
________________________________________________
  Mike C. Fletcher
  Designer, VR Plumber, Coder
  http://www.vrplumber.com
  http://blog.vrplumber.com




From markus at bluegap.ch  Wed Jun 27 10:32:07 2007
From: markus at bluegap.ch (Markus Schiltknecht)
Date: Wed, 27 Jun 2007 16:32:07 +0200
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <468264E0.3030507@vrplumber.com>
References: <46825C37.7060100@bluegap.ch> <468264E0.3030507@vrplumber.com>
Message-ID: <468274E7.4070301@bluegap.ch>

Hi,

Mike C. Fletcher wrote:
> http://blog.vrplumber.com/1353

Thanks, nice article. And I've tried that code snipped, but it didn't 
help much in my case, as response times are below 1 second.

Please see these measurements, taken with apache bench. I'm testing 
response times on a simple status resource, which doesn't take long to 
calculate (i.e. doesn't even throw a deferred, but returns a response 
immediately):

Document Path:          /status
Document Length:        202 bytes

Concurrency Level:      10
Time taken for tests:   0.202266 seconds
Complete requests:      100
Failed requests:        0
Write errors:           0
Total transferred:      38400 bytes
HTML transferred:       20200 bytes
Requests per second:    494.40 [#/sec] (mean)
Time per request:       20.227 [ms] (mean)
Time per request:       2.023 [ms] (mean, across all concurrent requests)
Transfer rate:          182.93 [Kbytes/sec] received


Now, measured while the server is under very small load:

Document Path:          /status
Document Length:        202 bytes

Concurrency Level:      10
Time taken for tests:   4.103465 seconds
Complete requests:      100
Failed requests:        0
Write errors:           0
Total transferred:      38400 bytes
HTML transferred:       20200 bytes
Requests per second:    24.37 [#/sec] (mean)
Time per request:       410.347 [ms] (mean)
Time per request:       41.035 [ms] (mean, across all concurrent requests)
Transfer rate:          9.02 [Kbytes/sec] received


When putting the server under real load, those response times climb up 
to two seconds, so there must be something wrong.

Can I somehow get the reactor's state, i.e. how many deferreds are 
waiting in the queue, how many threads are running concurrently, etc?

How good is the idea of deferring File I/O to threads, i.e. 
threads.deferToThread(self.filehandle.write, data)? Another possibly 
blocking module might be the database api, but I'm using twisted's 
enterprise adbapi, which should be async, AFAICT.

Maybe copying data around takes time. I'm sending around chunks of 64k 
size (streaming from the database to an external programm). Reducing 
chunk size to 1k helps somewhat (i.e. response time is seldom over 
150ms, but can still climb up to > 0.5 seconds).

Hum... external program.... maybe it's the self.transport.write() call 
which blocks several 100ms? Is it safe to write:

   d = threads.deferToThread(self.transport.write, dataChunk)

(i.e. call transport.write from a thread?)

How much resources do these deferToThread() deferreds eat? AFAICT, the 
reactor prepares a thread pool, which leads me to think that it's a well 
optimized implementation...

Regards

Markus





From exarkun at divmod.com  Wed Jun 27 11:08:45 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 27 Jun 2007 11:08:45 -0400
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <468274E7.4070301@bluegap.ch>
Message-ID: <20070627150845.4947.1679165983.divmod.quotient.4689@ohm>

On Wed, 27 Jun 2007 16:32:07 +0200, Markus Schiltknecht <markus at bluegap.ch> wrote:
>Hi,
>
>Mike C. Fletcher wrote:
>>http://blog.vrplumber.com/1353
>
>Thanks, nice article. And I've tried that code snipped, but it didn't help 
>much in my case, as response times are below 1 second.

You could try twistd --profile or one of the other Python profilers.

Jean-Paul



From jj.peeters at gmail.com  Wed Jun 27 11:19:34 2007
From: jj.peeters at gmail.com (Julien Peeters)
Date: Wed, 27 Jun 2007 17:19:34 +0200
Subject: [Twisted-Python] How work ldaptor and twisted
Message-ID: <1182957574.3798.7.camel@troll>

Hi everybody,

I'm new to ldaptor and twisted. I don't really understand how twisted
work and how can I build a little application with them.

I would like to make a mini app which offers me the possibility to
administrate very simply my ldap server.
Then, the app have to wait for orders, and when it receive one, treat it
by sending the appropriate request via ldaptor.

My problem is with twisted, and more precisely with the "reactor". I
don't really understand how I can manipulate it and what is the place of
defered's in all that?

Thanks,
Julien.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070627/61f5a702/attachment.pgp 

From matt at zgroupplc.com  Wed Jun 27 11:40:02 2007
From: matt at zgroupplc.com (Matthew Glubb)
Date: Wed, 27 Jun 2007 16:40:02 +0100
Subject: [Twisted-Python] How work ldaptor and twisted
In-Reply-To: <1182957574.3798.7.camel@troll>
References: <1182957574.3798.7.camel@troll>
Message-ID: <52AD267A-1BE9-417F-9B24-3EE65DAE6CC4@zgroupplc.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Julien,

Have a look at the documentation on the twisted website:

<http://twistedmatrix.com/projects/core/documentation/howto/index.html>

Its pretty good at giving you an overview of how twisted works. You  
might want to have a general read about the difference between  
asynchronous event programming and programming with threads.

Hope that helps,


Matt

On 27 Jun 2007, at 16:19, Julien Peeters wrote:

> Hi everybody,
>
> I'm new to ldaptor and twisted. I don't really understand how twisted
> work and how can I build a little application with them.
>
> I would like to make a mini app which offers me the possibility to
> administrate very simply my ldap server.
> Then, the app have to wait for orders, and when it receive one,  
> treat it
> by sending the appropriate request via ldaptor.
>
> My problem is with twisted, and more precisely with the "reactor". I
> don't really understand how I can manipulate it and what is the  
> place of
> defered's in all that?
>
> Thanks,
> Julien.
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: <http://www.zgroupplc.com/>

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify <service at zgroupplc.com>



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGgoTVyI6MkdKPngkRAnGkAJwJJEdvR0pIrxWdfBWdCRWaBfR7TwCfRzsz
LZb2FVJ5+LuAttTd5cMldqY=
=Sj7a
-----END PGP SIGNATURE-----



From glyph at divmod.com  Wed Jun 27 12:32:12 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Wed, 27 Jun 2007 16:32:12 -0000
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <468274E7.4070301@bluegap.ch>
References: <46825C37.7060100@bluegap.ch> <468264E0.3030507@vrplumber.com>
	<468274E7.4070301@bluegap.ch>
Message-ID: <20070627163212.8429.1578659222.divmod.xquotient.137@joule.divmod.com>

On 02:32 pm, markus at bluegap.ch wrote:
>Requests per second:    494.40 [#/sec] (mean)

>Now, measured while the server is under very small load:

>Requests per second:    24.37 [#/sec] (mean)

>When putting the server under real load, those response times climb up 
>to

What is 'real load'?  Are you talking about things in process with, but 
not related to, the web server?
>two seconds, so there must be something wrong.

Maybe your server is slow? :)
>Can I somehow get the reactor's state, i.e. how many deferreds are 
>waiting in the queue, how many threads are running concurrently, etc?

There is no queue of Deferreds.  They don't actually have anything to do 
with the reactor.
>How good is the idea of deferring File I/O to threads, i.e. 
>threads.deferToThread(self.filehandle.write, data)?

If you do indeed discover that you are waiting a long time to write your 
particular stuff to files, then that might help.  It might also randomly 
interleave the data and corrupt your files, if 'data' is big enough.
>Another possibly blocking module might be the database api, but I'm 
>using twisted's enterprise adbapi, which should be async, AFAICT.

It does the operations in threads, yes.  However, the threadpool will 
eventually fill up; the concurrency is fairly limited.  (The default is 
10 or so workers, I think).
>Maybe copying data around takes time. I'm sending around chunks of 64k 
>size (streaming from the database to an external programm). Reducing 
>chunk size to 1k helps somewhat (i.e. response time is seldom over 
>150ms, but can still climb up to > 0.5 seconds).

That's a possibility that the "--profile" option to twistd which JP 
suggested might help you with.  You'll see the functions copying data 
taking a lot of CPU time in that case.
>Hum... external program.... maybe it's the self.transport.write() call 
>which blocks several 100ms? Is it safe to write:
>
>   d = threads.deferToThread(self.transport.write, dataChunk)
>
>(i.e. call transport.write from a thread?)

No.  _All_ Twisted APIs are not thread safe.  This call does not block 
though, and it is extremely, vanishingly unlikely that it is causing 
your problems.  It just sticks some data into the outgoing queue and 
returns immediately.
>How much resources do these deferToThread() deferreds eat? AFAICT, the 
>reactor prepares a thread pool, which leads me to think that it's a 
>well optimized implementation...

It's not particularly "optimized", in the sense that we haven't measured 
the performance or improved it much, but it's also not doing very much; 
put a value into a queue, get it out in a thread, do it: that's about 
all.  It would certainly surprise me if that operation were taking 
100ms.

One quick measurement you can do to determine what might be causing this 
performance loss is to examine the server in 'top' while it is allegedly 
under load.  Is it taking up 100% CPU?  If not, then it's probably 
blocked on some kind of I/O in your application, or perhaps writing the 
log.  If so, then there's some inefficient application code (or Twisted 
code) that you need to profile and optimize.  The output of "strace -T" 
on your Twisted server *might* be useful if you discover that you're 
blocking on some kind of I/O.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070627/52ac8e14/attachment.htm 

From maarten at treewalker.org  Wed Jun 27 13:04:18 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Wed, 27 Jun 2007 19:04:18 +0200
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <46825C37.7060100@bluegap.ch>
References: <46825C37.7060100@bluegap.ch>
Message-ID: <200706271904.18667.maarten@treewalker.org>

On Wednesday 27 June 2007, Markus Schiltknecht wrote:

> Now, I'm wondering if there's a profiling tool, which can quickly tell
> me what events are blocking my server. I have even deferred the file I/O
> to separate threads, as I've suspected them to make the server behave
> poorly when under load. But there still seems to be something
> blocking...  What do you use to find the callbacks which block (for too
> long)?

Does your server process use a lot of memory?

I had problems with a random simple request taking a long time every now and 
then and it turned out to be the Python garbage collector. The collection 
itself can take some time if you have a lot of objects. If some of the Python 
process ends up in the swap instead of main memory, garbage collection will 
block until it is swapped back in, which can slow it down dramatically.

Using multiple threads does not give you any performance advantage in this 
case: during garbage collection the entire Python VM is frozen.

One thing you could try is:
  import gc
  gc.disable()
in the startup code of your server.

Note that this does not turn off all memory recycling; it only turns off the 
mark-and-sweep part of the garbage collector. Objects which have a zero 
reference count are still collected.

Bye,
		Maarten



From edgardo.delgado at navy.mil  Wed Jun 27 14:16:17 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Wed, 27 Jun 2007 14:16:17 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED592234A176C@naeapaxrez05.nadsusea.nads.navy.mil>

OK, I got the portforwarding stuff done using protocols.portforward.
But this is good for 1:1 relationship, i.e. listen on one port and
forwarding to another.
What I need is a 1:many relationship, i.e. listen on one port and
forwarding to many ports.

Edgar 

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Delgado,
Edgardo CIV NAVAIR 4.1.4.3
Sent: Wednesday, June 20, 2007 10:16 AM
To: twisted-python at twistedmatrix.com
Subject: [Twisted-Python] Server/Client

I would like to build a server that when it gets a message on a specific
port it will "forward" that message to another port.
I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
will forward the data to "Server2" listening on port 15000.

Edgar


_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From adam at atlas.st  Wed Jun 27 14:33:16 2007
From: adam at atlas.st (Adam Atlas)
Date: Wed, 27 Jun 2007 14:33:16 -0400
Subject: [Twisted-Python] Implementing streaming (broadcast) TCP servers
Message-ID: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>

I'm working on a server that will be streaming the same data from a  
source to many clients. It has to be invoked from an HTTP server, so  
I'm using twisted.web2 (not twisted.web because it also needs to host  
a WSGI application). In other words, calling GET on a certain path  
results in the stream as the response, at which point I don't really  
need any more HTTP functionality. I have it working... currently, the  
basic process is: I have a class implementing IByteStream, an  
instance of which is created for each client; it simply keeps a queue  
of data to be sent, sending one piece with each call to read(), or a  
sending a Deferred if the queue is empty. Meanwhile, the part of the  
application that provides the data (a different server, receiving  
data from a broadcaster) adds the data to all the clients' byte  
stream queues, whenever it receives a piece of data.

Since efficiency is obviously important for a streaming server, I was  
just wondering if anyone had any efficiency tips. I've tested it with  
at most 64 concurrent clients. There doesn't seem to be any slowdown  
from the clients' perspective (the data is coming in at the rate it  
should), but server-side, CPU and memory usage start increasing  
pretty quickly. Especially CPU -- with 64 clients, CPU usage peaked  
at 26.8%, which is not acceptable. Any thoughts? Is there a better  
way to handle the streaming process as I previously described?

- Adam




From jj.peeters at gmail.com  Wed Jun 27 14:37:22 2007
From: jj.peeters at gmail.com (Julien Peeters)
Date: Wed, 27 Jun 2007 20:37:22 +0200
Subject: [Twisted-Python] How work ldaptor and twisted
In-Reply-To: <52AD267A-1BE9-417F-9B24-3EE65DAE6CC4@zgroupplc.com>
References: <1182957574.3798.7.camel@troll>
	<52AD267A-1BE9-417F-9B24-3EE65DAE6CC4@zgroupplc.com>
Message-ID: <1182969442.3798.19.camel@troll>

I read all these but I don't understand how do I have to use the
deferred return by the connect method from the LDAPClient

c = ldapconnector.LDAPClientCreator(reactor, pureldap.LDAPClient)
d = c.connect('...')

I don't understand why I have to add all my callback's to this deferred.
If I understand the meaning of a deferred, it represent a result that
will be return. And then, once connected, the deferred have no sense
anymore for me...

For example this code:
	def fun(proto):
		d = proto.send(request)
		d.addCallback(responseHandler)
		return d

I don't understand why I have to return the deferred and how it interact
with something else.

Globally, I understand what is the reactor, what is a deferred, how can
I make a client, a server. My problem state in the interaction of these
concepts. The link between them from a technical and implementational
point of view.

There is some detailed sequence diagrams some where I can found?

I suppose I miss an important part of the concepts, but I don't know
what.

Julien.

On Wed, 2007-06-27 at 16:40 +0100, Matthew Glubb wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hi Julien,
> 
> Have a look at the documentation on the twisted website:
> 
> <http://twistedmatrix.com/projects/core/documentation/howto/index.html>
> 
> Its pretty good at giving you an overview of how twisted works. You  
> might want to have a general read about the difference between  
> asynchronous event programming and programming with threads.
> 
> Hope that helps,
> 
> 
> Matt
> 
> On 27 Jun 2007, at 16:19, Julien Peeters wrote:
> 
> > Hi everybody,
> >
> > I'm new to ldaptor and twisted. I don't really understand how twisted
> > work and how can I build a little application with them.
> >
> > I would like to make a mini app which offers me the possibility to
> > administrate very simply my ldap server.
> > Then, the app have to wait for orders, and when it receive one,  
> > treat it
> > by sending the appropriate request via ldaptor.
> >
> > My problem is with twisted, and more precisely with the "reactor". I
> > don't really understand how I can manipulate it and what is the  
> > place of
> > defered's in all that?
> >
> > Thanks,
> > Julien.
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
> 
> 
> m a t t h e w   g l u b b
> 
> ________________________________________________________________________
> Z Group PLC
> 
> Tel: +44 (0) 8700 111 173
> Fax: +44 (0) 8707 051 393
> Txt: +44 (0) 7800 140 877
> Web: <http://www.zgroupplc.com/>
> 
> This  email  and  any  files  transmitted  with it are  confidential and
> intended solely for the use of the individual or entity to whom they are
> addressed.  The opinions  expressed in this mail are those of the author
> and do not necessarily  represent the views of the company.  If you have
> received this email in error please notify <service at zgroupplc.com>
> 
> 
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.1 (Darwin)
> 
> iD8DBQFGgoTVyI6MkdKPngkRAnGkAJwJJEdvR0pIrxWdfBWdCRWaBfR7TwCfRzsz
> LZb2FVJ5+LuAttTd5cMldqY=
> =Sj7a
> -----END PGP SIGNATURE-----
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070627/9a804af7/attachment.pgp 

From adelagon at gmail.com  Wed Jun 27 21:55:25 2007
From: adelagon at gmail.com (Alvin Delagon)
Date: Thu, 28 Jun 2007 09:55:25 +0800
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592234A176C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
	<0C8FBA9C0F70E1479497B4DD7ED592234A176C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <7a01f6c00706271855j4ac6e83l8a06078fbd0b200f@mail.gmail.com>

Suggestion:

If data reliability is not an issue, it's pretty much easier to do it using
UDP (twisted.internet.protocol.DatagramProtocol). You won't need to deal
with connections.

"What I need is a 1:many relationship, i.e. listen on one port and
forwarding to many ports."

A UDP MulticastServer is what you need. ^_^

On 6/28/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3 <edgardo.delgado at navy.mil>
wrote:
>
> OK, I got the portforwarding stuff done using protocols.portforward.
> But this is good for 1:1 relationship, i.e. listen on one port and
> forwarding to another.
> What I need is a 1:many relationship, i.e. listen on one port and
> forwarding to many ports.
>
> Edgar
>
> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com
> [mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Delgado,
> Edgardo CIV NAVAIR 4.1.4.3
> Sent: Wednesday, June 20, 2007 10:16 AM
> To: twisted-python at twistedmatrix.com
> Subject: [Twisted-Python] Server/Client
>
> I would like to build a server that when it gets a message on a specific
> port it will "forward" that message to another port.
> I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
> will forward the data to "Server2" listening on port 15000.
>
> Edgar
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070628/daf2b711/attachment.htm 

From nico at tekNico.net  Thu Jun 28 04:11:55 2007
From: nico at tekNico.net (Nicola Larosa)
Date: Thu, 28 Jun 2007 10:11:55 +0200
Subject: [Twisted-Python] Google used Twisted...
Message-ID: <46836D4B.7010702@tekNico.net>

...but nobody should know: ;-)

http://twistedmatrix.com/trac/wiki/WikiStart?action=diff&version=42&old_version=38

(And apparently they still use it: )

http://www.oreillynet.com/onlamp/blog/2007/06/python_web_application_framewo.html

oubiwann: what's up?


-- 
Nicola Larosa - http://www.tekNico.net/

Q: Aside from Dojo, what is your favorite Ajax framework? A: MochiKit.
YUI is great code too, but MochiKit has it beat for clarity of vision
and implementation quality. Bob Ippolito gets the constraints of the
web. That, and I'm a Python guy at heart. -- Alex Russell, August 2006





From edgardo.delgado at navy.mil  Thu Jun 28 09:00:49 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Thu, 28 Jun 2007 09:00:49 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <7a01f6c00706271855j4ac6e83l8a06078fbd0b200f@mail.gmail.com>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil><0C8FBA9C0F70E1479497B4DD7ED592234A176C@naeapaxrez05.nadsusea.nads.navy.mil>
	<7a01f6c00706271855j4ac6e83l8a06078fbd0b200f@mail.gmail.com>
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED592234A19D1@naeapaxrez05.nadsusea.nads.navy.mil>

I already took a look at UDP, but we need data reliability so can't use
UDP. :-(

Thx,
Edgar

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Alvin
Delagon
Sent: Wednesday, June 27, 2007 9:55 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Server/Client

Suggestion:

If data reliability is not an issue, it's pretty much easier to do it
using UDP (twisted.internet.protocol.DatagramProtocol). You won't need
to deal with connections. 

"What I need is a 1:many relationship, i.e. listen on one port and
forwarding to many ports."

A UDP MulticastServer is what you need. ^_^


On 6/28/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:

	OK, I got the portforwarding stuff done using
protocols.portforward.
	But this is good for 1:1 relationship, i.e. listen on one port
and
	forwarding to another.
	What I need is a 1:many relationship, i.e. listen on one port
and 
	forwarding to many ports.
	
	Edgar
	
	-----Original Message-----
	From: twisted-python-bounces at twistedmatrix.com
	[mailto: twisted-python-bounces at twistedmatrix.com
<mailto:twisted-python-bounces at twistedmatrix.com> ] On Behalf Of
Delgado,
	Edgardo CIV NAVAIR 4.1.4.3
	Sent: Wednesday, June 20, 2007 10:16 AM
	To: twisted-python at twistedmatrix.com
<mailto:twisted-python at twistedmatrix.com> 
	Subject: [Twisted-Python] Server/Client
	
	I would like to build a server that when it gets a message on a
specific
	port it will "forward" that message to another port. 
	I.e. "Server1" listens on port 10000. When it gets data on port
10000 it
	will forward the data to "Server2" listening on port 15000.
	
	Edgar
	
	
	_______________________________________________ 
	Twisted-Python mailing list
	Twisted-Python at twistedmatrix.com
	http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

	
	_______________________________________________
	Twisted-Python mailing list
	Twisted-Python at twistedmatrix.com
	http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
<http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python> 
	





From zmola at acm.org  Thu Jun 28 09:32:03 2007
From: zmola at acm.org (Carl Zmola)
Date: Thu, 28 Jun 2007 09:32:03 -0400
Subject: [Twisted-Python] Implementing streaming (broadcast) TCP servers
In-Reply-To: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>
Message-ID: <4683B853.7080700@acm.org>

Adam,

In general, if you are streaming different data to each client, it is
going to be expensive.  There really are only 3 areas to optimize

1) disk IO  --  Read in bigger chunks and make sure you flush your
buffer.  You might want to drop into C and write your buffering or find
a good "ring buffer"  (big array that you reuse for the stream) so you
don't have to allocate and  deallocate memory all the time.
2) Network IO  -- check what protocol you can use.  If you can get away
with lossy streaming, UDP or RTCP might be wins.
3) CPU -- Profile your application and see where the time is being
spent.  You need to be careful about memory copying and allocation.
Python normally handles this well, so this probably isn't the problem.

OOPS,  I just realized that you said the same data to multiple clients.
Is the data the same at the same time, meaning the clients are all
getting the same data simultaneously?  If so, if you have any control
over the network, then UDP Multicast can be a big win.  You would only
be sending out one stream of data and everyone would hear it.

Also, I would look at making sure that you are not copying data around much.

I must admit that my Knowledge of all the twisted classes that are
available is limited, so I don't know what class to use but I would
suggest dropping in to the low level classes below web2 since you will
need a little more control for this than normal web applications.

Carl
zmola at acm.org



Adam Atlas wrote:
> I'm working on a server that will be streaming the same data from a 
> source to many clients. It has to be invoked from an HTTP server, so 
> I'm using twisted.web2 (not twisted.web because it also needs to host 
> a WSGI application). In other words, calling GET on a certain path 
> results in the stream as the response, at which point I don't really 
> need any more HTTP functionality. I have it working... currently, the 
> basic process is: I have a class implementing IByteStream, an instance 
> of which is created for each client; it simply keeps a queue of data 
> to be sent, sending one piece with each call to read(), or a sending a 
> Deferred if the queue is empty. Meanwhile, the part of the application 
> that provides the data (a different server, receiving data from a 
> broadcaster) adds the data to all the clients' byte stream queues, 
> whenever it receives a piece of data.
>
> Since efficiency is obviously important for a streaming server, I was 
> just wondering if anyone had any efficiency tips. I've tested it with 
> at most 64 concurrent clients. There doesn't seem to be any slowdown 
> from the clients' perspective (the data is coming in at the rate it 
> should), but server-side, CPU and memory usage start increasing pretty 
> quickly. Especially CPU -- with 64 clients, CPU usage peaked at 26.8%, 
> which is not acceptable. Any thoughts? Is there a better way to handle 
> the streaming process as I previously described?
>
> - Adam
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python





From adam at atlas.st  Thu Jun 28 11:44:27 2007
From: adam at atlas.st (Adam Atlas)
Date: Thu, 28 Jun 2007 11:44:27 -0400
Subject: [Twisted-Python] Implementing streaming (broadcast) TCP servers
In-Reply-To: <4683B853.7080700@acm.org>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>
	<4683B853.7080700@acm.org>
Message-ID: <2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>


On 28 Jun 2007, at 09.32, Carl Zmola wrote:
> 3) CPU -- Profile your application and see where the time is being
> spent.  You need to be careful about memory copying and allocation.
> Python normally handles this well, so this probably isn't the problem.

Ah, good point. I'll try that.

> OOPS,  I just realized that you said the same data to multiple  
> clients.
> Is the data the same at the same time, meaning the clients are all
> getting the same data simultaneously?  If so, if you have any control
> over the network, then UDP Multicast can be a big win.  You would only
> be sending out one stream of data and everyone would hear it.

It is indeed being sent at the same time, but unfortunately I'm not  
designing the protocol. I'm implementing an existing one that only  
runs over HTTP.

> Also, I would look at making sure that you are not copying data  
> around much.

I was definitely paying attention to that. I'm using Python's  
`buffer` type when possible to prevent any duplication of data;  
ideally, there's only one real copy of it in memory, and a bunch of  
buffers pointing to it... then it can be garbage collected once it's  
been sent to all clients.

> I must admit that my Knowledge of all the twisted classes that are
> available is limited, so I don't know what class to use but I would
> suggest dropping in to the low level classes below web2 since you will
> need a little more control for this than normal web applications.

I had similar thoughts... I was thinking, once I had the connection  
established, I could try to bypass web2's IByteStream stuff and try  
to use transport.write directly. Do you think that would help? It's  
less runloopy overhead, at least.



From glyph at divmod.com  Thu Jun 28 14:12:32 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 28 Jun 2007 18:12:32 -0000
Subject: [Twisted-Python] Google used Twisted...
In-Reply-To: <46836D4B.7010702@tekNico.net>
References: <46836D4B.7010702@tekNico.net>
Message-ID: <20070628181232.8429.218263044.divmod.xquotient.169@joule.divmod.com>

On 08:11 am, nico at teknico.net wrote:
>...but nobody should know: ;-)
>(And apparently they still use it: )

Much as I'd love to brag about this, I think it's slightly jumping the 
gun :).  To my knowledge, Jot Live was the part of Jotspot that used 
Twisted, and it was discontinued or something.  The second link was just 
some guy at Google who read about Twisted and then presented something 
about it.

Google seems to be pretty good to the open source projects that they 
really use.  If they do start using it in earnest, I'm sure we'll hear 
about it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070628/e51346bf/attachment.htm 

From glyph at divmod.com  Thu Jun 28 14:32:41 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 28 Jun 2007 18:32:41 -0000
Subject: [Twisted-Python] take my tickets, please
Message-ID: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>

According to the Twisted tracker, I currently have 142 tickets.

Many of these are simply because I'm the default assignee of the default 
"core" component, so almost all new tickets end up in my list.

It's getting to the point where I don't even have time to triage all the 
tickets assigned to me, let alone work on them.

If anyone is looking for stuff to do to help out Twisted, triaging all 
of the 'normal', 'core' tickets assigned to me would be a big help.  Not 
only would it circulate tickets to more appropriate people to be working 
on them than me, it will also generally make me feel less discouraged 
when I look at the apparently infinite amount of work I have to do.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070628/5de68aea/attachment.htm 

From eprparadocs at gmail.com  Thu Jun 28 14:44:41 2007
From: eprparadocs at gmail.com (Chas.)
Date: Thu, 28 Jun 2007 14:44:41 -0400
Subject: [Twisted-Python] take my tickets, please
In-Reply-To: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>
References: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>
Message-ID: <2f66cbb30706281144s4875ad51qe4769c9fba5db299@mail.gmail.com>

Let me know if I can help out...either triaging the tickets or fixing the
'easier' things right now.

C.

On 6/28/07, glyph at divmod.com <glyph at divmod.com> wrote:
>
> According to the Twisted tracker, I currently have 142 tickets.
>
> Many of these are simply because I'm the default assignee of the default
> "core" component, so almost all new tickets end up in my list.
>
> It's getting to the point where I don't even have time to triage all the
> tickets assigned to me, let alone work on them.
>
> If anyone is looking for stuff to do to help out Twisted, triaging all of
> the 'normal', 'core' tickets assigned to me would be a big help.  Not only
> would it circulate tickets to more appropriate people to be working on them
> than me, it will also generally make me feel less discouraged when I look at
> the apparently infinite amount of work I have to do.
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070628/d6b8c561/attachment.htm 

From adam at atlas.st  Thu Jun 28 16:27:32 2007
From: adam at atlas.st (Adam Atlas)
Date: Thu, 28 Jun 2007 16:27:32 -0400
Subject: [Twisted-Python] Implementing streaming (broadcast) TCP servers
In-Reply-To: <2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>
	<4683B853.7080700@acm.org>
	<2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>
Message-ID: <A023DDB6-8B23-4749-B80C-B2B379DD78B8@atlas.st>


On 28 Jun 2007, at 11.44, Adam Atlas wrote:
> I had similar thoughts... I was thinking, once I had the connection  
> established, I could try to bypass web2's IByteStream stuff and try  
> to use transport.write directly. Do you think that would help? It's  
> less runloopy overhead, at least.

For the record, this seems to be working. I rewrote it to work like  
this, and I was able to pump it up to 64 clients again (me  
broadcasting to the remote server from my own computer, and then  
starting 64 clients on my own computer) but CPU and memory usage were  
much better. CPU was standing around 1.5% and memory around 3.6%. (I  
know these could still be considered SORT OF high, but this is  
actually a vserver where both of these resources are quite limited --  
only 480 MB of the real server's memory.)

However, once all the clients disconnect, the memory doesn't seem to  
go back down to the expected level. Any ideas on where I should start  
looking to solve this?



From glyph at divmod.com  Thu Jun 28 19:44:18 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 28 Jun 2007 23:44:18 -0000
Subject: [Twisted-Python] take my tickets, please
In-Reply-To: <2f66cbb30706281144s4875ad51qe4769c9fba5db299@mail.gmail.com>
References: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>
	<2f66cbb30706281144s4875ad51qe4769c9fba5db299@mail.gmail.com>
Message-ID: <20070628234418.8429.1522579992.divmod.xquotient.218@joule.divmod.com>


On 06:44 pm, eprparadocs at gmail.com wrote:
>Let me know if I can help out...either triaging the tickets or fixing 
>the
>'easier' things right now.

I thought that's what I was doing :).

Don't worry about trying to triage controversial or confusing stuff, or 
reprioritize too much; just closing the obvious duplicates and 
reassigning things that have their component set blatantly wrong would 
be a lot of help.

And of course, *any* ticket that you want to steal and fix would be 
fine.
>On 6/28/07, glyph at divmod.com <glyph at divmod.com> wrote:
>>
>>According to the Twisted tracker, I currently have 142 tickets.
>>
>>Many of these are simply because I'm the default assignee of the 
>>default
>>"core" component, so almost all new tickets end up in my list.
>>
>>It's getting to the point where I don't even have time to triage all 
>>the
>>tickets assigned to me, let alone work on them.
>>
>>If anyone is looking for stuff to do to help out Twisted, triaging all 
>>of
>>the 'normal', 'core' tickets assigned to me would be a big help.  Not 
>>only
>>would it circulate tickets to more appropriate people to be working on 
>>them
>>than me, it will also generally make me feel less discouraged when I 
>>look at
>>the apparently infinite amount of work I have to do.
>>
>>_______________________________________________
>>Twisted-Python mailing list
>>Twisted-Python at twistedmatrix.com
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070628/77dae2fe/attachment.htm 

From eprparadocs at gmail.com  Thu Jun 28 19:58:33 2007
From: eprparadocs at gmail.com (Chas.)
Date: Thu, 28 Jun 2007 19:58:33 -0400
Subject: [Twisted-Python] take my tickets, please
In-Reply-To: <20070628234418.8429.1522579992.divmod.xquotient.218@joule.divmod.com>
References: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>
	<2f66cbb30706281144s4875ad51qe4769c9fba5db299@mail.gmail.com>
	<20070628234418.8429.1522579992.divmod.xquotient.218@joule.divmod.com>
Message-ID: <2f66cbb30706281658x5a4b72eq461bbc6e1c80df2d@mail.gmail.com>

How does one get started?

C.

On 6/28/07, glyph at divmod.com <glyph at divmod.com> wrote:
>
>
> On 06:44 pm, eprparadocs at gmail.com wrote:
> >Let me know if I can help out...either triaging the tickets or fixing the
> >'easier' things right now.
>
> I thought that's what I was doing :).
>
> Don't worry about trying to triage controversial or confusing stuff, or
> reprioritize too much; just closing the obvious duplicates and reassigning
> things that have their component set blatantly wrong would be a lot of help.
>
> And of course, *any* ticket that you want to steal and fix would be fine.
>
>
> >On 6/28/07, glyph at divmod.com <glyph at divmod.com> wrote:
> >>
> >>According to the Twisted tracker, I currently have 142 tickets.
> >>
> >>Many of these are simply because I'm the default assignee of the default
> >>"core" component, so almost all new tickets end up in my list.
> >>
> >>It's getting to the point where I don't even have time to triage all the
> >>tickets assigned to me, let alone work on them.
> >>
> >>If anyone is looking for stuff to do to help out Twisted, triaging all
> of
> >>the 'normal', 'core' tickets assigned to me would be a big help.  Not
> only
> >>would it circulate tickets to more appropriate people to be working on
> them
> >>than me, it will also generally make me feel less discouraged when I
> look
> >>at
> >>the apparently infinite amount of work I have to do.
> >>
> >>_______________________________________________
> >>Twisted-Python mailing list
> >>Twisted-Python at twistedmatrix.com
> >>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070628/015940de/attachment.htm 

From exarkun at divmod.com  Thu Jun 28 20:16:37 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 28 Jun 2007 20:16:37 -0400
Subject: [Twisted-Python] take my tickets, please
In-Reply-To: <2f66cbb30706281658x5a4b72eq461bbc6e1c80df2d@mail.gmail.com>
Message-ID: <20070629001637.4947.349358007.divmod.quotient.4974@ohm>

On Thu, 28 Jun 2007 19:58:33 -0400, "Chas." <eprparadocs at gmail.com> wrote:
>How does one get started?
>

Here's the list of open tickets:

  http://twistedmatrix.com/trac/report/1

You can also create a custom ticket view.  For example, open tickets assigned
to glyph are shown here:

http://twistedmatrix.com/trac/query?status=new&status=assigned&status=reopened&owner=glyph&order=priority

If you find a ticket you think you can resolve, attach the patch to the
ticket, change its priority to highest, and add "review" to its keywords.

You can also look at existing tickets with the review keyword:

http://twistedmatrix.com/trac/report/11

and provide feedback for them.  The review process is documented on the
wiki:

http://twistedmatrix.com/trac/wiki/ReviewProcess

You can look at the changes proposed on a ticket which has been marked for
review and comment about whether the changes are correct or if there is a
problem with them.

And if you don't know how to fix a ticket, you still may be able to help.  If
the ticket is related to a domain with which you are familiar and there is
an open question as to how to resolve it, you can add a comment making a
suggestion.  If a ticket is for a bug but does not include a unit test, you
can write a unit test and attach it; this is often even more useful than
just attaching a patch with a fix.

When writing code to contribute to Twisted, note that it must be MIT licenced.
Also, take a look at the coding standard here:

http://twistedmatrix.com/trac/browser/trunk/doc/development/policy/coding-standard.xhtml?format=raw

You can find other suggestions for ways to contribute on the wiki:

http://twistedmatrix.com/trac/wiki/ContributingToTwistedLabs

Jean-Paul



From nico at tekNico.net  Fri Jun 29 00:41:00 2007
From: nico at tekNico.net (Nicola Larosa)
Date: Fri, 29 Jun 2007 06:41:00 +0200
Subject: [Twisted-Python] Re: Implementing streaming (broadcast) TCP servers
In-Reply-To: <A023DDB6-8B23-4749-B80C-B2B379DD78B8@atlas.st>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>	<4683B853.7080700@acm.org>	<2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>
	<A023DDB6-8B23-4749-B80C-B2B379DD78B8@atlas.st>
Message-ID: <46848D5C.6040606@tekNico.net>

Adam Atlas wrote:
> However, once all the clients disconnect, the memory doesn't seem to go
> back down to the expected level. Any ideas on where I should start
> looking to solve this?

Are you using Python 2.5? It made great progress in giving the memory back
to the operating system.


-- 
Nicola Larosa - http://www.tekNico.net/

Se pensavate che Windows Vista vi avrebbe permesso di risparmiarvi
l'acquisto di un antivirus, vi sbagliavate. Se pensavate che fosse
pi? sicuro dei vecchi Windows, vi sbagliavate. Se pensate che possa
essere pi? sicuro di Linux o di MacOS X vi sbagliate di grosso.
 -- Alessandro Bottoni, Febbraio 2007





From adam at atlas.st  Fri Jun 29 01:05:21 2007
From: adam at atlas.st (Adam Atlas)
Date: Fri, 29 Jun 2007 01:05:21 -0400
Subject: [Twisted-Python] Re: Implementing streaming (broadcast) TCP
	servers
In-Reply-To: <46848D5C.6040606@tekNico.net>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>	<4683B853.7080700@acm.org>	<2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>
	<A023DDB6-8B23-4749-B80C-B2B379DD78B8@atlas.st>
	<46848D5C.6040606@tekNico.net>
Message-ID: <F9C6FF07-47E6-42AE-A4FB-8E2E1C3C454C@atlas.st>



On 29 Jun 2007, at 00.41, Nicola Larosa wrote:
> Adam Atlas wrote:
>> However, once all the clients disconnect, the memory doesn't seem  
>> to go
>> back down to the expected level. Any ideas on where I should start
>> looking to solve this?
>
> Are you using Python 2.5? It made great progress in giving the  
> memory back
> to the operating system.

So I've heard.

I have 2.5, though I've been testing with 2.4, because this is a  
program I'm intending to distribute, not just for private use. So I  
want to keep it backwards-compatible with at least 2.4.



From roland.hedberg at adm.umu.se  Fri Jun 29 07:11:32 2007
From: roland.hedberg at adm.umu.se (Roland Hedberg)
Date: Fri, 29 Jun 2007 13:11:32 +0200
Subject: [Twisted-Python] What does soap.Proxy.callRemote() do that simple
 client.getPage() doesn't ?
Message-ID: <4684E8E4.7030008@adm.umu.se>

Hi!

I have two similar implementation of senders, one using HTTP "PUT" and
the other SOAP (and a put operation).

The core of the soap sender are the lines:

 proxy = soap.Proxy(recv)
 return proxy.callRemote('put',data)

While the HTTP one uses:

 return client.getPage(recv, method="PUT", postdata=data, headers=headers)

Basically soap.Proxy.callRemote() uses client.getPage() though with the
method POST instead of PUT. So there are some clear similarities here.

Now, I also have a dispatcher which uses either of these senders
depending on various reasons.
The crux is that when there is a continuous flow of data leaving by HTTP
"PUT" I see no problems, while when the same happens for SOAP, after a
while I see complains about "twisted.internet.error.ConnectBindError:
Couldn't bind: 24: Too many open files.".

I guess files in this instance equates to internet connections.
If so, is that because soap.Proxy.callRemote() doesn't close down the
connections in the same way as a direct call to client.getPage() does ?

There is obviously something I don't understand here.
Anyone that can enlighten me ?
And tell me how to get rid of the connections.

Running Twisted 2.5.0

-- Roland



From paulswartz at gmail.com  Fri Jun 29 11:38:20 2007
From: paulswartz at gmail.com (Paul Swartz)
Date: Fri, 29 Jun 2007 11:38:20 -0400
Subject: [Twisted-Python] [Conch] anyone using
	twisted.conch.ssh.session.SSHSession directly?
Message-ID: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>

I'm working on tests for t.c.s.session.SSHSession, and it's difficult
because of the terrible API SSHSession currently has.  I've tried a
rewrite in branches/session-2710, but I wanted to know if anyone was
actually using that class directly?  The typical use case is writing
an Avatar->ISession adapter, and if you're doing it that way nothing
should change for you even with this update.

In short, let me know if you're using
twisted.conch.ssh.session.SSHSession directly and I need to keep it
backwards compatible.  Thanks!

-p
-- 
Paul Swartz
paulswartz at gmail dot com
http://z3p.livejournal.com/
AIM: z3penguin



From itamar at itamarst.org  Fri Jun 29 15:25:10 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 29 Jun 2007 15:25:10 -0400 (EDT)
Subject: [Twisted-Python] [Conch] anyone using 
	twisted.conch.ssh.session.SSHSession directly?
In-Reply-To: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>
References: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>
Message-ID: <60603.63.107.91.99.1183145110.squirrel@webmail.zoteca.com>

> I'm working on tests for t.c.s.session.SSHSession, and it's difficult
> because of the terrible API SSHSession currently has.  I've tried a
> rewrite in branches/session-2710, but I wanted to know if anyone was
> actually using that class directly?  The typical use case is writing
> an Avatar->ISession adapter, and if you're doing it that way nothing
> should change for you even with this update.

Rather than removing it, you could e.g. deprecate the old class and then
write a new one (using test-driven development) to ensure a decent API and
good test coverage.




From glyph at divmod.com  Fri Jun 29 16:46:07 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Fri, 29 Jun 2007 20:46:07 -0000
Subject: [Twisted-Python] [Conch] anyone using
	twisted.conch.ssh.session.SSHSession directly?
In-Reply-To: <60603.63.107.91.99.1183145110.squirrel@webmail.zoteca.com>
References: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>
	<60603.63.107.91.99.1183145110.squirrel@webmail.zoteca.com>
Message-ID: <20070629204607.8429.1198924326.divmod.xquotient.380@joule.divmod.com>


On 07:25 pm, itamar at itamarst.org wrote:
>>I'm working on tests for t.c.s.session.SSHSession, and it's difficult
>>because of the terrible API SSHSession currently has.  I've tried a
>>rewrite in branches/session-2710, but I wanted to know if anyone was
>>actually using that class directly?  The typical use case is writing
>>an Avatar->ISession adapter, and if you're doing it that way nothing
>>should change for you even with this update.
>
>Rather than removing it, you could e.g. deprecate the old class and 
>then
>write a new one (using test-driven development) to ensure a decent API 
>and
>good test coverage.

I tried a while ago to document some parts of the unspoken idioms around 
compatibility:

    http://twistedmatrix.com/trac/wiki/CompatibilityPolicy

It's still not done, but hey, as long as we're talking about it, Paul, 
have a look at the number of entries Conch has in that list near the 
bottom. ;-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20070629/c702c6f0/attachment.htm 

From paulswartz at gmail.com  Fri Jun 29 16:59:53 2007
From: paulswartz at gmail.com (Paul Swartz)
Date: Fri, 29 Jun 2007 16:59:53 -0400
Subject: [Twisted-Python] [Conch] anyone using
	twisted.conch.ssh.session.SSHSession directly?
In-Reply-To: <20070629204607.8429.1198924326.divmod.xquotient.380@joule.divmod.com>
References: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>
	<60603.63.107.91.99.1183145110.squirrel@webmail.zoteca.com>
	<20070629204607.8429.1198924326.divmod.xquotient.380@joule.divmod.com>
Message-ID: <324cfb540706291359j4a220091t806517515035712a@mail.gmail.com>

On 6/29/07, glyph at divmod.com <glyph at divmod.com> wrote:
>
> On 07:25 pm, itamar at itamarst.org wrote:
> >> I'm working on tests for t.c.s.session.SSHSession, and it's difficult
> >> because of the terrible API SSHSession currently has.  I've tried a
> >> rewrite in branches/session-2710, but I wanted to know if anyone was
> >> actually using that class directly?  The typical use case is writing
> >> an Avatar->ISession adapter, and if you're doing it that way nothing
> >> should change for you even with this update.
> >
> >Rather than removing it, you could e.g. deprecate the old class and then
> >write a new one (using test-driven development) to ensure a decent API and
> >good test coverage.
>
> I tried a while ago to document some parts of the unspoken idioms around
> compatibility:
>
>     http://twistedmatrix.com/trac/wiki/CompatibilityPolicy
>
> It's still not done, but hey, as long as we're talking about it, Paul, have
> a look at the number of entries Conch has in that list near the bottom. ;-)

Oh, I know.  My goal is to have the SoC branches take over testing for
Conch, so I can just scrub those old deprecated ones.

-p
-- 
Paul Swartz
paulswartz at gmail dot com
http://z3p.livejournal.com/
AIM: z3penguin



From twisted-python at 2xlp.com  Sat Jun 30 18:00:04 2007
From: twisted-python at 2xlp.com (Jonathan Vanasco)
Date: Sat, 30 Jun 2007 18:00:04 -0400
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <20070618170534.31981.1808740575.divmod.xquotient.17@joule.divmod.com>
References: <A3F520F1-B083-4DA9-A581-2234752CFE44@collab.nl>
	<20070618022344.4947.170473162.divmod.quotient.2321@ohm>
	<20070618170534.31981.1808740575.divmod.xquotient.17@joule.divmod.com>
Message-ID: <BD75E5F9-66F3-4B3F-ADC4-36642E57C692@2xlp.com>


On Jun 18, 2007, at 1:05 PM, glyph at divmod.com wrote:

> Thanks, too, for changing this so readily :).
>
> It makes me think, though, that maybe we should have a suggested  
> prefix for things-which-use-Twisted, since "py" is a little  
> confusing there.  Python has PyXXX, maybe Twisted should have  
> TwiXXX or similar?

Personally speaking ,  It would be nice if Twisted
	a) had a suggested prefix
	b) had 2 logos put into the public domain
		i. a form of the logo for people who want to show support on their  
sites that run twisted
		ii. a "powerd by" logo for applicaitons built on twisted.

This would be similar to what Mozilla did with the firefox logos.



// Jonathan Vanasco

| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|   CEO/Founder SyndiClick Networks
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|     Founder/CTO/CVO
|      FindMeOn.com - The cure for Multiple Web Personality Disorder
|      Web Identity Management and 3D Social Networking
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|      RoadSound.com - Tools For Bands, Stuff For Fans
|      Collaborative Online Management And Syndication Tools
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -





From thisaddressisnotmine at td.selfip.net  Sat Jun 30 18:50:50 2007
From: thisaddressisnotmine at td.selfip.net (Oleg Deribas)
Date: Sun, 01 Jul 2007 01:50:50 +0300
Subject: [Twisted-Python] web2 DAV client
Message-ID: <ua3jl4-6c5.ln1@td.selfip.net>

Hello,

Is it possible to use current web2 dav implementation as webdav client 
with support for digest auth?

-- 
Oleg




From phil at bubblehouse.org  Sat Jun 30 20:27:19 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Sat, 30 Jun 2007 20:27:19 -0400
Subject: [Twisted-Python] twisted.plugin issues
Message-ID: <55484996-4051-48EC-9D16-4656597ADE7D@bubblehouse.org>

Hello all,

I'm trying to implement a plugin system in a project using the  
twisted plugin framework. I've read through the docs pretty  
thoroughly, but I can't seem to figure out what I'm doing wrong.

Attached is a sample case that should illustrate the problem. The  
layout is as follows:

     plugin_dir/
     plugin_dir/test/
     plugin_dir/test/plugins/
     plugin_dir/test/plugins/myplugin.py
     test/
     test/__init__.py
     test/plugins/
     test/plugins/__init__.py
     test/sample.py
     test_plugin.py

First I created the test.plugins package, and included the following  
in test/plugins/__init__.py:

     import os, sys

     __path__ = [os.path.abspath(os.path.join(x, 'test', 'plugins'))
                     for x in sys.path]

     __all__ = []

Then I created my interfaces in the test.sample module:

     from zope import interface

     class ISamplePlugin(interface.Interface):
         '''My Sample Plugin Class'''

Next, I created the plugin in an arbitrary directory, under  
plugin_dir/test/plugins/myplugin.py:

     from zope.interface import implements
     from twisted import plugin
     from test.sample import ISamplePlugin

     class MyPlugin(object):
         implements(plugin.IPlugin, ISamplePlugin)

Finally, here's the sample script that tries to load the plugins in  
the arbitrary directory:

     from twisted import plugin

     import sys
     sys.path.append('.')
     sys.path.append('./plugin_dir')

     from test import sample, plugins
     from twisted import plugin
     plugin_result = plugin.getPlugins(sample.ISamplePlugin, plugins)

     for plugin in plugin_result:
         print repr(plugin) + ' was found.'

Which gives no output.

Here are the things I've checked for:

     * './plugin_dir' is definitely on the pythonpath when
       getPlugins is called. I've also tried using an absolute path.

     * once the path is modified, I can import manually with:
         import test.plugins.myplugins

I'm using the latest Twisted-SVN, under the pythonmac.org Python  
2.4.4 distribution on Mac OS X 10.4.10.

Any help would be greatly appreciated.

Thanks in advance,

-phil



-------------- next part --------------
A non-text attachment was scrubbed...
Name: plugin_test.tgz
Type: application/octet-stream
Size: 675 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20070630/3af90d99/attachment.obj 

From exarkun at divmod.com  Sat Jun 30 21:32:32 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sat, 30 Jun 2007 21:32:32 -0400
Subject: [Twisted-Python] twisted.plugin issues
In-Reply-To: <55484996-4051-48EC-9D16-4656597ADE7D@bubblehouse.org>
Message-ID: <20070701013232.4947.1136742145.divmod.quotient.5400@ohm>

On Sat, 30 Jun 2007 20:27:19 -0400, Phil Christensen <phil at bubblehouse.org> wrote:
>Hello all,
>
>I'm trying to implement a plugin system in a project using the  twisted 
>plugin framework. I've read through the docs pretty  thoroughly, but I can't 
>seem to figure out what I'm doing wrong.
>
>Attached is a sample case that should illustrate the problem. The  layout is 
>as follows:
>
>     plugin_dir/
>     plugin_dir/test/
>     plugin_dir/test/plugins/
>     plugin_dir/test/plugins/myplugin.py
>     test/
>     test/__init__.py
>     test/plugins/
>     test/plugins/__init__.py
>     test/sample.py
>     test_plugin.py
>
>First I created the test.plugins package, and included the following  in 
>test/plugins/__init__.py:
>
>     import os, sys
>
>     __path__ = [os.path.abspath(os.path.join(x, 'test', 'plugins'))
>                     for x in sys.path]
>
>     __all__ = []
>
>Then I created my interfaces in the test.sample module:
>
>     from zope import interface
>
>     class ISamplePlugin(interface.Interface):
>         '''My Sample Plugin Class'''
>
>Next, I created the plugin in an arbitrary directory, under 
>plugin_dir/test/plugins/myplugin.py:
>
>     from zope.interface import implements
>     from twisted import plugin
>     from test.sample import ISamplePlugin
>
>     class MyPlugin(object):
>         implements(plugin.IPlugin, ISamplePlugin)

The problem may be here.  What happens if you use classProvides instead of
implements or bind an instance of MyPlugin to an attribute of this module?

>
>Finally, here's the sample script that tries to load the plugins in  the 
>arbitrary directory:
>
>     from twisted import plugin
>
>     import sys
>     sys.path.append('.')
>     sys.path.append('./plugin_dir')
>
>     from test import sample, plugins
>     from twisted import plugin
>     plugin_result = plugin.getPlugins(sample.ISamplePlugin, plugins)
>
>     for plugin in plugin_result:
>         print repr(plugin) + ' was found.'
>
>Which gives no output.
>
>Here are the things I've checked for:
>
>     * './plugin_dir' is definitely on the pythonpath when
>       getPlugins is called. I've also tried using an absolute path.
>
>     * once the path is modified, I can import manually with:
>         import test.plugins.myplugins
>
>I'm using the latest Twisted-SVN, under the pythonmac.org Python  2.4.4 
>distribution on Mac OS X 10.4.10.
>
>Any help would be greatly appreciated.
>
>Thanks in advance,
>

Jean-Paul



From phil at bubblehouse.org  Sat Jun 30 23:57:13 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Sat, 30 Jun 2007 23:57:13 -0400
Subject: [Twisted-Python] twisted.plugin issues
In-Reply-To: <20070701013232.4947.1136742145.divmod.quotient.5400@ohm>
References: <20070701013232.4947.1136742145.divmod.quotient.5400@ohm>
Message-ID: <8B4ADE5B-1CCA-42E9-9AD4-1923EBE616AA@bubblehouse.org>


On Jun 30, 2007, at 9:32 PM, Jean-Paul Calderone wrote:

> On Sat, 30 Jun 2007 20:27:19 -0400, Phil Christensen  
> <phil at bubblehouse.org> wrote:
>> Hello all,
>>
>> I'm trying to implement a plugin system in a project using the   
>> twisted plugin framework. I've read through the docs pretty   
>> thoroughly, but I can't seem to figure out what I'm doing wrong.
>>
>> Attached is a sample case that should illustrate the problem. The   
>> layout is as follows:
>>
>>     plugin_dir/
>>     plugin_dir/test/
>>     plugin_dir/test/plugins/
>>     plugin_dir/test/plugins/myplugin.py
>>     test/
>>     test/__init__.py
>>     test/plugins/
>>     test/plugins/__init__.py
>>     test/sample.py
>>     test_plugin.py
>>
>> First I created the test.plugins package, and included the  
>> following  in test/plugins/__init__.py:
>>
>>     import os, sys
>>
>>     __path__ = [os.path.abspath(os.path.join(x, 'test', 'plugins'))
>>                     for x in sys.path]
>>
>>     __all__ = []
>>
>> Then I created my interfaces in the test.sample module:
>>
>>     from zope import interface
>>
>>     class ISamplePlugin(interface.Interface):
>>         '''My Sample Plugin Class'''
>>
>> Next, I created the plugin in an arbitrary directory, under  
>> plugin_dir/test/plugins/myplugin.py:
>>
>>     from zope.interface import implements
>>     from twisted import plugin
>>     from test.sample import ISamplePlugin
>>
>>     class MyPlugin(object):
>>         implements(plugin.IPlugin, ISamplePlugin)
>
> The problem may be here.  What happens if you use classProvides  
> instead of
> implements or bind an instance of MyPlugin to an attribute of this  
> module?

Aha, this looks promising. Doing either of those things results in:


Traceback (most recent call last):
   File "test_plugin.py", line 11, in ?
     for plugin in plugin_result:
   File "/Users/phil/Workspace/Twisted/twisted/plugin.py", line 186,  
in getPlugins
     allDropins = getCache(package)
--- <exception caught here> ---
   File "/Users/phil/Workspace/Twisted/twisted/plugin.py", line 165,  
in getCache
     dropinPath.setContent(pickle.dumps(dropinDotCache))
cPickle.PicklingError: Can't pickle <InterfaceClass  
test.sample.ISamplePlugin>: import of module test.sample failed
<class 'test.plugins.myplugin.MyPlugin'> was found.


So this must be pretty close. I tried deleting the dropin.cache, but  
I'm still getting this exception.


>>
>> Finally, here's the sample script that tries to load the plugins  
>> in  the arbitrary directory:
>>
>>     from twisted import plugin
>>
>>     import sys
>>     sys.path.append('.')
>>     sys.path.append('./plugin_dir')
>>
>>     from test import sample, plugins
>>     from twisted import plugin
>>     plugin_result = plugin.getPlugins(sample.ISamplePlugin, plugins)
>>
>>     for plugin in plugin_result:
>>         print repr(plugin) + ' was found.'
>>



From ivan at llaisdy.com  Fri Jun  1 07:29:16 2007
From: ivan at llaisdy.com (Ivan Uemlianin)
Date: Fri, 01 Jun 2007 14:29:16 +0100
Subject: [Twisted-Python] Divmod Sine will now install
In-Reply-To: <4656A37F.1050700@llaisdy.com>
References: <20070520151513.30678.599672052.divmod.quotient.2801@ohm>
	<4656A37F.1050700@llaisdy.com>
Message-ID: <46601F2C.4090401@llaisdy.com>

Dear All

On divmod-dev, Jean-Paul Calderone advised me to use the latest tagged 
releases from http://divmod.org/trac/browser/tags/releases/ (i.e., svn 
co http://divmod.org:81/svn/Divmod/tags/releases/etc).  I have now been 
able to install Sine and Mantissa. nb: I had to install Sine first - 
Mantissa would not install before Sine.

Still heading otwards a look at sip as a basis for mrcp;)

Best wishes

Ivan

Ivan Uemlianin wrote:
> Jean-Paul Calderone wrote:
>> The Divmod Sine SIP implementation has numerous bug fixes not present in
>> twisted.protocols.sip.  Once #2444 is resolved, the protocol support in
>> Twisted will be as good as the protocol support in Divmod Sine.  What 
>> Sine
>> will still offer above the code in Twisted is the higher level APIs 
>> which
>> make call setup easy enough so that novel applications can focus on 
>> their
>> novelty instead of on SIP details.
> I have attempted and failed to install Divmod Sine.  I posted the 
> message below to divmod-dev a few days ago but have yet to receive a 
> reply (it's a quiet list).  I am re-posting the message here in good 
> faith and in the belief that it is not entirely off-topic or plain 
> stupid.
> I'd really like to start writing an MRCP server, and if it's good 
> enough to contribute it to Twisted, so any help would be much 
> appreciated.
>
> Best wishes
>
> Ivan
>
>
> Dear All
>
> I am installing the Divmod frameworks, with the intention of
> experimenting with Sine and Shtoom.  I have installed everything except
> Sine with no problems (using python setup.py install).
>
> With Sine I get the following error:
>
> File "/usr/lib/python2.4/site-packages/xmantissa/plugins/sineoff.py",
> line 3, in ?
>   from xmantissa import website, offering, provisioning
> exceptions.ImportError: cannot import name provisioning
>
> I have tried this with both the stable (0.6.1) and svn versions of 
> Mantissa.
>
> I have grepped through all of Divmod's frameworks (inc. Shtoom) and not
> found provisioning except in import statements.  The only class used
> from provisioning is BenefactorFactory.
>
> Please could someone let me know either:
> - Where I can get a version of xmantissa with provisioning and
> BenefactorFactory, or
> - Whether and how I can comment out the offending lines from Sine.
>
> Thanks
>
> Best wishes
>
> Ivan
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From ivan at llaisdy.com  Fri Jun  1 07:38:47 2007
From: ivan at llaisdy.com (Ivan Uemlianin)
Date: Fri, 01 Jun 2007 14:38:47 +0100
Subject: [Twisted-Python] Re: Divmod Sine Broken?
In-Reply-To: <1180521159.7009.5.camel@antoine-ubuntu>
References: <20070520151513.30678.599672052.divmod.quotient.2801@ohm>	<4656A37F.1050700@llaisdy.com>
	<1180521159.7009.5.camel@antoine-ubuntu>
Message-ID: <46602167.90103@llaisdy.com>

Antoine Pitrou wrote:
> After playing around with the SIP support in Twisted, finding a few bugs
> whose correction (*) was refused on the grounds that the author had
> forked his own code as a separate project, we at Wengo have written our
> own SIP stack on top of a patched twisted.protocols.sip.
>
> (*) http://twistedmatrix.com/trac/ticket/2220
Thank for the lead.  I'll  check out http://www.openwengo.com/

Ivan






From alex.lang at mail.mcgill.ca  Sat Jun  2 09:11:41 2007
From: alex.lang at mail.mcgill.ca (Alex Lang)
Date: Sat, 2 Jun 2007 11:11:41 -0400
Subject: [Twisted-Python] Distributed Trial Test Runner
Message-ID: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>

Hello,

For my Summer of Code project, I am implementing a distributed trial
test runner (http://code.google.com/soc/psf/appinfo.html?csaid=770D0FCD95DAFF9E).
The following is basically what needs to be done to get distributed
trial working, given a master machine and slaves:

1. Transfer the relevant code to all slave machines. (with conch)
2. Do test loading at least on the master (possibly on each of the
slaves as well)
3. Find a good test-to-unique-id mapping (probably using FQPNs +
something else for test_suite-generated tests?)
4. Implement a visitor which will run through the tests on the master
and split them among the slaves.
5. Figure out how to get SSH command shells open to the slaves and get
individual tests to run
6. Gather results from slaves and give them to a reporter.

I think that is all. Any thoughts? Comments?

Thanks,
Alex



From ldanielburr at mac.com  Sat Jun  2 09:27:10 2007
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Sat, 02 Jun 2007 10:27:10 -0500
Subject: [Twisted-Python] Distributed Trial Test Runner
In-Reply-To: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>
References: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>
Message-ID: <op.ttavvkg93oj628@l-daniel-burrs-powerbook-g4-17.local>

Hi Alex,

On Sat, 02 Jun 2007 10:11:41 -0500, Alex Lang <alex.lang at mail.mcgill.ca>  
wrote:

> Hello,
>
> For my Summer of Code project, I am implementing a distributed trial
> test runner  
> (http://code.google.com/soc/psf/appinfo.html?csaid=770D0FCD95DAFF9E).
> The following is basically what needs to be done to get distributed
> trial working, given a master machine and slaves:
>
> 1. Transfer the relevant code to all slave machines. (with conch)
> 2. Do test loading at least on the master (possibly on each of the
> slaves as well)
> 3. Find a good test-to-unique-id mapping (probably using FQPNs +
> something else for test_suite-generated tests?)
> 4. Implement a visitor which will run through the tests on the master
> and split them among the slaves.
> 5. Figure out how to get SSH command shells open to the slaves and get
> individual tests to run
> 6. Gather results from slaves and give them to a reporter.
>
> I think that is all. Any thoughts? Comments?
>

My only thought is that this sounds a lot like BuildBot, or at least
so similar as to represent some prior art for you to consider.

Daniel



From andrew-twisted at puzzling.org  Sat Jun  2 11:54:15 2007
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Sun, 3 Jun 2007 03:54:15 +1000
Subject: [Twisted-Python] Distributed Trial Test Runner
In-Reply-To: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>
References: <6b7b52ef0706020811y6154567as5a2ae5fb122ff336@mail.gmail.com>
Message-ID: <20070602175415.GE594@steerpike.home.puzzling.org>

Alex Lang wrote:
> Hello,
> 
> For my Summer of Code project, I am implementing a distributed trial
> test runner 
> (http://code.google.com/soc/psf/appinfo.html?csaid=770D0FCD95DAFF9E).
> The following is basically what needs to be done to get distributed
> trial working, given a master machine and slaves:
> 
> 1. Transfer the relevant code to all slave machines. (with conch)

This part is a bit short on detail.  "relevant code" isn't possible to determine
automatically, in general.  You never know what dependencies code might have.
Probably this user needs to be given some control over this, e.g. a setting for
the directory to copy (or rsync?).

I guess the trick will be that once a slave is set up to make sure that giving
it the current code for testing with is quick (copying the whole source for a
large project every time would suck, especially if you want to use a slave
that's on a relatively slow link).  rsync is definitely tempting here!

Another possible way to transfer the changes is as a branch URL, revision ID,
and diff.  i.e. the output of "svn info | grep ^URL:", "svn info | grep
^Revision:" and "svn diff" for SVN checkouts (but keep in mind not all projects
use SVN, so if you go this route you'd want to make part extensible).

> 3. Find a good test-to-unique-id mapping (probably using FQPNs +
> something else for test_suite-generated tests?)

The scheme discussed on #twisted along these lines sounded ok to me.

> I think that is all. Any thoughts? Comments?

Make sure that trial options that don't work when distributed give graceful
errors, rather than tracebacks or wrong results.  Options like "--debug" and
"--coverage" spring to mind, but there may be others.  Similarly, you should
also make sure that "--until-failure" does something sensible.  Basically,
look at each of the options described by "trial --help" and figure out what
distributed trial should do with it.  This is a relatively small thing, but this
sort of polish makes a big difference to the end user experience.

I also agree with L. Daniel Burr that there could be some overlap with Buildbot
in this project.  I guess you probably weren't thinking of running a master
daemon perpetually for slaves to connect to, but maybe that's not a crazy idea.
Also Buildbot has already deals with reporting results (in a minimal way),
updating source trees according to instructions from a master, and running
commands on those trees.  It also deals with managing slaves.

Because running tests requires a much more elaborately and carefully configured
environment than compiling a pre-processed C file, thinking about disttrial as
being more like buildbot than distcc might make good sense.

-Andrew.




From exarkun at twistedmatrix.com  Sun Jun  3 07:57:38 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 03 Jun 2007 13:57:38 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1180879058.02.648463468@twistedmatrix.com

Bug summary
______________________
Summary for 2007-05-27 through 2007-06-03
Bugs opened: 9    Bugs closed: 0  Total open bugs: 969 (+9)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       +7  |Highest:  +2          |Conch:  +2             
|Enhancement:  +3  |High:     +2          |Core:   +4             
                   |Normal:   +6          |Mail:   +2             
                                          |Web:    +2             


New / Reopened Bugs
______________________
                    ===== Highest =====
[#2682] twisted.conch.ssh.userauth is poorly tested. (opened by z3p)
    defect          conch      http://twistedmatrix.com/trac/ticket/2682

[#2685] factor secure random implementation (opened by antoine)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2685

                    ===== High =====
[#1105] IMAP Client does not seem to handle unsolicited server responses (opened by cablehead)
    defect          mail       http://twistedmatrix.com/trac/ticket/1105

                    ===== Normal =====
[#2680] abdapi ConnectionPool doesn't allow for synchronous close (opened by jml)
    defect          core       http://twistedmatrix.com/trac/ticket/2680

[#2681] twisted.web.distrib non-functional (opened by exarkun)
    defect          web        http://twistedmatrix.com/trac/ticket/2681

[#2683] twisted/web/http.py has self._header instead of self.__header (opened by jvtm)
    defect          web        http://twistedmatrix.com/trac/ticket/2683

[#2684] t.p.t.ThreadPool.dispatch should be deprecated (opened by indigo)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2684

[#2686] AMP implementation: elisp (opened by glyph)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2686

[#2687] Conch blows up when processes end due to signals (opened by jml)
    defect          conch      http://twistedmatrix.com/trac/ticket/2687



Closed Bugs
______________________





From abierbaum at gmail.com  Mon Jun  4 17:01:00 2007
From: abierbaum at gmail.com (Allen Bierbaum)
Date: Mon, 4 Jun 2007 18:01:00 -0500
Subject: [Twisted-Python] Taking a look at pending deferToThread actions
Message-ID: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>

I am using deferToThread in my application to put a number of web
service queries into the background and then respond to them when they
are complete.  This is all working very well, but once in a while I
seem to overload the web service with queries and I would like to
track this down by checking to see how many queries are in flight and
how many are still waiting to be processed.

One I have put an action into the background using deferToThread, is
there a way to check to see how many functions are currently
processing and similarly how many functions are waiting to be
processed?

Thanks,
Allen



From abierbaum at gmail.com  Tue Jun  5 10:02:16 2007
From: abierbaum at gmail.com (Allen Bierbaum)
Date: Tue, 5 Jun 2007 11:02:16 -0500
Subject: [Twisted-Python] Re: Taking a look at pending deferToThread actions
In-Reply-To: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
Message-ID: <bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>

Sorry for answering my own question, but I found a way to get this
information and I thought it may be helpful for other users.

threadpool = reactor.threadpool
num_threads = threadpool.workers
q_size  = threadpool.q.qsize()

num_threads is a good approximation of how many functions are
currently active, and q_size is the number still pending.

Now for another question:

- Has anyone extended threadpool to allow code to remove queued
functions from the pending queue?

I need this capability so I can cull off pending queries that are not
still needed.

-Allen

On 6/4/07, Allen Bierbaum <abierbaum at gmail.com> wrote:
> I am using deferToThread in my application to put a number of web
> service queries into the background and then respond to them when they
> are complete.  This is all working very well, but once in a while I
> seem to overload the web service with queries and I would like to
> track this down by checking to see how many queries are in flight and
> how many are still waiting to be processed.
>
> One I have put an action into the background using deferToThread, is
> there a way to check to see how many functions are currently
> processing and similarly how many functions are waiting to be
> processed?
>
> Thanks,
> Allen
>



From Sven-Erik.Tiberg at ltu.se  Tue Jun  5 15:07:46 2007
From: Sven-Erik.Tiberg at ltu.se (Sven-Erik Tiberg)
Date: Tue, 5 Jun 2007 23:07:46 +0200
Subject: [Twisted-Python] A longshot, UML and twisted.
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
Message-ID: <668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>

Hi.
 
A longshot, anyone modelled a system with twisted components in uml using f.ex. a stateschart.
 
/BG
Sven-Erik Tiberg
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winmail.dat
Type: application/ms-tnef
Size: 3065 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20070605/86b969a4/attachment-0002.bin>

From maarten at treewalker.org  Tue Jun  5 15:41:05 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Tue, 5 Jun 2007 23:41:05 +0200
Subject: [Twisted-Python] A longshot, UML and twisted.
In-Reply-To: <668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
	<668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
Message-ID: <200706052341.11402.maarten@treewalker.org>

On Tuesday 05 June 2007, Sven-Erik Tiberg wrote:

> A longshot, anyone modelled a system with twisted components in uml using
> f.ex. a stateschart.

PyReverse can analyze Python code and produce UML. I never used it myself, but 
PyLint is written by the same people and that's a very useful tool. However, 
PyReverse is not actively maintained, while PyLint is.

http://www.logilab.org/2560

Probably PyReverse will only analyze the static structure, so you'll get class 
diagrams. For analyzing dynamic behaviour, PyPy might be able to gather a lot 
of useful data, but as far as I know there is not yet a tool that makes nice 
graphs of it. Also, I'm not sure how useful PyPy will be if your program uses 
Python features that are not in the RPython subset.

http://codespeak.net/pypy/

Bye,
		Maarten
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20070605/33e383e0/attachment.sig>

From glyph at divmod.com  Tue Jun  5 15:54:30 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 05 Jun 2007 21:54:30 -0000
Subject: [Twisted-Python] A longshot, UML and twisted.
In-Reply-To: <668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
	<668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
Message-ID: <20070605215430.24950.294053860.divmod.xquotient.190@joule.divmod.com>

On 09:07 pm, sven-erik.tiberg at ltu.se wrote:
>Hi.

Hi Sven,
>A longshot, anyone modelled a system with twisted components in uml 
>using f.ex. a stateschart.

Not that I'm aware of; it would be a massive task, with no obvious 
benefits.

Why do you want such a thing?  Perhaps we can suggest an alternative 
means of extracting the information you want without UML diagrams.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070605/9c186697/attachment.html>

From adelagon at gmail.com  Tue Jun  5 19:15:10 2007
From: adelagon at gmail.com (Alvin Delagon)
Date: Tue, 5 Jun 2007 21:15:10 -0400
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous Connections
Message-ID: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>

First of all, I want to send my gratitude to the people who developed
Twisted. ^_^

We have this XMPP server that is implemented using twisted (using the epoll
reactor). I was tasked to know how many simultaneous connections it can
handle. So I wrote an XMPP benchmark tool using twisted that spawns multiple
clients. When we used the benchmark tool on two PCs (each spawning 20,000
XMPP clients), the number of successful connect/authorize varies between
37,000~39,000. Adding more clients we get the, "Connection Closed cleanly"
error on the XMPP server. Spawning two XMPP servers didn't help to increase
the simultaneous connections.

Did we hit the ceiling? Or is there anyway we can increase this further? We
already configured the ulimit parameters and tinkered with some kernel
configurations.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070605/fcf10864/attachment.html>

From itamar at itamarst.org  Tue Jun  5 23:20:54 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 06 Jun 2007 01:20:54 -0400
Subject: [Twisted-Python] Re: Taking a look at pending deferToThread
	actions
In-Reply-To: <bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
Message-ID: <1181107254.10081.1.camel@localhost.localdomain>

On Tue, 2007-06-05 at 11:02 -0500, Allen Bierbaum wrote:

> - Has anyone extended threadpool to allow code to remove queued
> functions from the pending queue?

How about just having the functions themselves check to see if they
really should run their intended task? (Being careful about
thread-safety, of course).

Why are you using threads, btw?




From nico at tekNico.net  Wed Jun  6 00:23:08 2007
From: nico at tekNico.net (Nicola Larosa)
Date: Wed, 06 Jun 2007 08:23:08 +0200
Subject: [Twisted-Python] Re: A longshot, UML and twisted.
In-Reply-To: <668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
	<668D1B8AD729C94DB91D17EC19B8BB9104E84C0A@EMMA.personal.adp.ltu.se>
Message-ID: <466652CC.20802@tekNico.net>

Sven-Erik Tiberg wrote:
> A longshot, anyone modelled a system with twisted components in uml
> using f.ex. a stateschart.

In addition to PyReverse, you may try these other two:

PyNSource
http://www.atug.com/andypatterns/pynsource.htm

snakefood
http://furius.ca/snakefood/

and let us know the results. :-)


-- 
Nicola Larosa - http://www.tekNico.net/

Jerub:    someone motivate me to write a real http client.
lifeless: Jerub: write a real http client
spiv:     Jerub: write a real http client
oubiwann: Jerub: write a real client and 1000 virgins
          are yours for the taking
dash:     oubiwann: all of #gentoo?!
 -- doc/fun/Twisted.Quotes, May 2006





From itamar at itamarst.org  Wed Jun  6 08:01:33 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 06 Jun 2007 10:01:33 -0400
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous
	Connections
In-Reply-To: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
References: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
Message-ID: <1181138493.10081.6.camel@localhost.localdomain>

On Tue, 2007-06-05 at 21:15 -0400, Alvin Delagon wrote:

> When we used the benchmark tool on two PCs (each spawning 20,000 XMPP
> clients), the number of successful connect/authorize varies between
> 37,000~39,000.

> Did we hit the ceiling? Or is there anyway we can increase this
> further? We already configured the ulimit parameters and tinkered with
> some kernel configurations.

There's no limits in Twisted itself that would cause that, so it's
likely in the kernel. For example -

You may have the free TCP port limit range, since you are doing so many
connections from only two IP addresses. This is not a limit that would
affect you during production, of course; you could see if you can get
higher numbers of connections with more client machines.

-- 
Itamar Shtull-Trauring
http://itamarst.org





From konrads.smelkovs at gmail.com  Wed Jun  6 09:31:37 2007
From: konrads.smelkovs at gmail.com (Konrads Smelkovs)
Date: Wed, 06 Jun 2007 18:31:37 +0300
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous
	Connections
In-Reply-To: <1181138493.10081.6.camel@localhost.localdomain>
References: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
	<1181138493.10081.6.camel@localhost.localdomain>
Message-ID: <1181143897.12287.19.camel@localhost.localdomain>

Hello,
To chip in my two cents - try testing with more machines, as Itamar had
suggested earlier. It is very easy to max out the limits of the testing
machines before the server is maxed out. I think there is a kernel
parameter that specifies low and high ports of outgoing connections.
Try with more machines.

On Wed, 2007-06-06 at 10:01 -0400, Itamar Shtull-Trauring wrote:
> On Tue, 2007-06-05 at 21:15 -0400, Alvin Delagon wrote:
> 
> > When we used the benchmark tool on two PCs (each spawning 20,000 XMPP
> > clients), the number of successful connect/authorize varies between
> > 37,000~39,000.
> 
> > Did we hit the ceiling? Or is there anyway we can increase this
> > further? We already configured the ulimit parameters and tinkered with
> > some kernel configurations.
> 
> There's no limits in Twisted itself that would cause that, so it's
> likely in the kernel. For example -
> 
> You may have the free TCP port limit range, since you are doing so many
> connections from only two IP addresses. This is not a limit that would
> affect you during production, of course; you could see if you can get
> higher numbers of connections with more client machines.
> 




From twisted at ralphm.ik.nu  Wed Jun  6 09:57:21 2007
From: twisted at ralphm.ik.nu (Ralph Meijer)
Date: Wed, 06 Jun 2007 17:57:21 +0200
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous
	Connections
In-Reply-To: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
References: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
Message-ID: <1181145441.8949.6.camel@zwerf>

On Tue, 2007-06-05 at 21:15 -0400, Alvin Delagon wrote:
> First of all, I want to send my gratitude to the people who developed
> Twisted. ^_^
> 
> We have this XMPP server that is implemented using twisted [..]

Oh, that is very interesting as I am working on this in my sandbox for a
while now. Could you expand on that and is the code available?

-- 
Groetjes,

ralphm




From Sven-Erik.Tiberg at ltu.se  Wed Jun  6 11:40:21 2007
From: Sven-Erik.Tiberg at ltu.se (Sven-Erik Tiberg)
Date: Wed, 6 Jun 2007 19:40:21 +0200
Subject: [Twisted-Python] A longshot, UML and twisted.
In-Reply-To: <20070605215430.24950.294053860.divmod.xquotient.190@joule.divmod.com>
Message-ID: <668D1B8AD729C94DB91D17EC19B8BB910565C01F@EMMA.personal.adp.ltu.se>

Hi 
 
Would like to visuliaze the signal ( state ) flow between a Interactive
VR-World ( using X3D ) and a Mathworks / Simulink model using twisted
and UDP.
It's the realtime system that we are planning to make for development
and training of vehicle drivers and process plant controllers.
Have tried to draw by hand and figures but would prefere to use a more
formal way to describe it.
Been there before made the software for a motionplatform for offroad and
marine vehicles back in -79 and had to modify the JSP model with Real
time functions, but it was worth it. Had to add symbol for priority,
sceeduling, process start / termination and semaphores. 
PS. downloaded RhapsodyModeler today from telelogic ( FOC) beacuse it
had UML-extensions for RT compared to MS Visio. 
Con: Lacking code handling like reverse engineering, so it's onky to
visulaize a event driven system like the one described above.
PS, it still my sparetime project but there are some thoughts about
making a course out of it for design-, HMI-, system developer and
mashine enginners.
Wouldn't that be fun. 
 
/BG
Sven-Erik
 
 
________________________________

From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of
glyph at divmod.com
Sent: den 5 juni 2007 23:55
To: Twisted general discussion
Subject: Re: [Twisted-Python] A longshot, UML and twisted.


On 09:07 pm, sven-erik.tiberg at ltu.se wrote:
>Hi.

Hi Sven,

>A longshot, anyone modelled a system with twisted components in uml
using f.ex. a stateschart.

Not that I'm aware of; it would be a massive task, with no obvious
benefits.

Why do you want such a thing?  Perhaps we can suggest an alternative
means of extracting the information you want without UML diagrams.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070606/2a5cb4f1/attachment.html>

From Sven-Erik.Tiberg at ltu.se  Wed Jun  6 11:45:15 2007
From: Sven-Erik.Tiberg at ltu.se (Sven-Erik Tiberg)
Date: Wed, 6 Jun 2007 19:45:15 +0200
Subject: [Twisted-Python] Re: A longshot, UML and twisted.
In-Reply-To: <466652CC.20802@tekNico.net>
Message-ID: <668D1B8AD729C94DB91D17EC19B8BB910565C020@EMMA.personal.adp.ltu.se>

Thanks, 
Looks usefull.
I will put them on my project site http://tellus.arb.ltu.se/moodle >
WBSP_Public, and try them during the summer.
 
/BG
Sven-Erik

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Nicola
Larosa
Sent: den 6 juni 2007 08:23
To: twisted-python at twistedmatrix.com
Subject: [Twisted-Python] Re: A longshot, UML and twisted.

Sven-Erik Tiberg wrote:
> A longshot, anyone modelled a system with twisted components in uml 
> using f.ex. a stateschart.

In addition to PyReverse, you may try these other two:

PyNSource
http://www.atug.com/andypatterns/pynsource.htm

snakefood
http://furius.ca/snakefood/

and let us know the results. :-)


--
Nicola Larosa - http://www.tekNico.net/

Jerub:    someone motivate me to write a real http client.
lifeless: Jerub: write a real http client
spiv:     Jerub: write a real http client
oubiwann: Jerub: write a real client and 1000 virgins
          are yours for the taking
dash:     oubiwann: all of #gentoo?!
 -- doc/fun/Twisted.Quotes, May 2006



_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From brucecoram at clara.co.uk  Wed Jun  6 13:42:42 2007
From: brucecoram at clara.co.uk (Bruce Coram)
Date: Wed, 06 Jun 2007 20:42:42 +0100
Subject: [Twisted-Python] udp
Message-ID: <46670E32.1010002@clara.co.uk>

I know the answer to this will be soo simple but is it necessary to use 
makeConnection when using udp.  I understood that udp is a 
connectionless protocol.  I have used TCP and factories to pass data 
between a server and clients and I wanted to use udp to send 
'management' data on an ad hoc basis.  Here is the code for a very 
simple client but I'm clearly missing the point.

'from twisted.internet.protocol import DatagramProtocol

from twisted.internet import reactor


host = '127.0.0.1'

class testcomms(DatagramProtocol):

    def datagramReceived(self, data, (host, port)):
        print 'Received ', data, 'from ', host
   
    def makeconnection(self, transport):
        self.transport.write('this is a test', (host, 8000))
   

t = testcomms()
t.makeconnect(host, 8000)
reactor.listenUDP(8000, testcomms())
reactor.run()'

Thanks in anticipation

Bruce Coram






From python at blackslens.com  Wed Jun  6 15:54:01 2007
From: python at blackslens.com (Black)
Date: Wed, 6 Jun 2007 17:54:01 -0400
Subject: [Twisted-Python] udp
In-Reply-To: <46670E32.1010002@clara.co.uk>
References: <46670E32.1010002@clara.co.uk>
Message-ID: <49D7C9CA-2D93-499C-BADA-AB39E0F8F304@blackslens.com>

You shouldn't need the makeconnect stuff. Try this:

from twisted.internet.protocol import DatagramProtocol
from twisted.internet import reactor


class testcomms(DatagramProtocol):

    def datagramReceived(self, data, (host, port)):
        print 'Received ', data, 'from ', host
        self.transport.write('this is a test', (host, port))

reactor.listenUDP(8000, testcomms())
reactor.run()



-Black


On Jun 6, 2007, at 3:42 PM, Bruce Coram wrote:

> I know the answer to this will be soo simple but is it necessary to  
> use makeConnection when using udp.  I understood that udp is a  
> connectionless protocol.  I have used TCP and factories to pass  
> data between a server and clients and I wanted to use udp to send  
> 'management' data on an ad hoc basis.  Here is the code for a very  
> simple client but I'm clearly missing the point.
>
> 'from twisted.internet.protocol import DatagramProtocol
>
> from twisted.internet import reactor
>
>
> host = '127.0.0.1'
>
> class testcomms(DatagramProtocol):
>
>    def datagramReceived(self, data, (host, port)):
>        print 'Received ', data, 'from ', host
>      def makeconnection(self, transport):
>        self.transport.write('this is a test', (host, 8000))
>
> t = testcomms()
> t.makeconnect(host, 8000)
> reactor.listenUDP(8000, testcomms())
> reactor.run()'
>
> Thanks in anticipation
>
> Bruce Coram
>
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From adelagon at gmail.com  Wed Jun  6 18:44:05 2007
From: adelagon at gmail.com (Alvin Delagon)
Date: Wed, 6 Jun 2007 20:44:05 -0400
Subject: [Twisted-Python] Twisted TCP Server Maximum Simultaneous
	Connections
In-Reply-To: <1181145441.8949.6.camel@zwerf>
References: <7a01f6c00706051815o292bbd72n451d33b0f72af0ff@mail.gmail.com>
	<1181145441.8949.6.camel@zwerf>
Message-ID: <7a01f6c00706061744w6a91c768g44efd9c8fd34212e@mail.gmail.com>

Thanks for the suggestions. I'll test the benchmark script on four PC's and
update this thread for the results.

@ Ralph
Sorry, I don't know if I have the right to provide the source for the
twisted XMPP server since it's not written by me.


On 6/6/07, Ralph Meijer <twisted at ralphm.ik.nu> wrote:
>
> On Tue, 2007-06-05 at 21:15 -0400, Alvin Delagon wrote:
> > First of all, I want to send my gratitude to the people who developed
> > Twisted. ^_^
> >
> > We have this XMPP server that is implemented using twisted [..]
>
> Oh, that is very interesting as I am working on this in my sandbox for a
> while now. Could you expand on that and is the code available?
>
> --
> Groetjes,
>
> ralphm
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070606/6dce1a91/attachment.html>

From alex.lang at mail.mcgill.ca  Wed Jun  6 21:59:41 2007
From: alex.lang at mail.mcgill.ca (Alex Lang)
Date: Wed, 6 Jun 2007 23:59:41 -0400
Subject: [Twisted-Python] Problem with trial using the reactor
Message-ID: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>

Hello,

Here is a problem regarding the distributed trial test runner. The
slave instances receive data from the master, telling them which tests
to run. This requires use of the reactor on the slave-side.
Unfortunately, when the testCase does the cleanup of the reactor, it
cleans up everything including the trial slave.

Any ideas on what should be done about this?

Thank you,
Alex



From jml at mumak.net  Wed Jun  6 22:58:28 2007
From: jml at mumak.net (Jonathan Lange)
Date: Thu, 7 Jun 2007 14:58:28 +1000
Subject: [Twisted-Python] Problem with trial using the reactor
In-Reply-To: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
References: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
Message-ID: <d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>

On 6/7/07, Alex Lang <alex.lang at mail.mcgill.ca> wrote:
> Hello,
>
> Here is a problem regarding the distributed trial test runner. The
> slave instances receive data from the master, telling them which tests
> to run. This requires use of the reactor on the slave-side.
> Unfortunately, when the testCase does the cleanup of the reactor, it
> cleans up everything including the trial slave.
>
> Any ideas on what should be done about this?
>

This is a roundabout way of answering your question, but it's helpful
for me to write it down, and I think it will inform the discussion.

In terms of Trial's requirements:
* We want to write and run tests that perform asynchronous operations,
which essentially means tests that return Deferreds.
* We want to be able to run these tests in non-Trial test runners.
* We want tests to be isolated as much as possible.
* We want to be able to use Trial to test the reactor itself.

Some awkward facts:
* There is exactly one reactor per Twisted process. This reactor
cannot be cleanly restarted in a cross-platform way.
* The current Twisted test suite (i.e. what is loaded when you do
'trial twisted') does not play nicely with the reactor. Changing this
will take a significant amount of work.[1]

So, in response to all of these things:
* Trial presents a blocking interface for running any given test:
TestCase.run(). This allows Deferred-returning tests to be used in
non-Twisted test runners.
* By design, Trial totally obliterates the reactor in each call to
TestCase.run(). This helps ensure test isolation
 * Trial's design operates on the assumption that the caller of
TestCase.run() will not be doing anything with the reactor.

However, all of this presents problems:
* The vast bulk of Twisted's code base cannot be used to implement a
Trial runner. This is what Alex is discovering now.
* Trial's cleanup code is buggy and fragile. Changing anything is
likely to break hundreds of tests.
* Tests that use twisted.trial.unittest.TestCase run in a
highly-specialized, somewhat unrealistic environment.

Various solutions have been proposed:
* Using a customized reactor wrapper in trial that tracks resources
created by tests and cleans up only those resources.
* Making reactors restartable.
* Allowing for multiple running reactors. i.e. A reactor that could be
started within another running reactor.

I believe that only the third of these solutions would actually help
solve Alex's problem. However, as I understand it, the solution would
require extensive API changes across most of Twisted, as things which
once assumed a global reactor must now take 'reactor' as a parameter.

I'd rather not offer any recommendations in this email. It's difficult
enough figuring out what the problem is and what the options are.

jml

[1] For example, Trial does two calls to 'reactor.iterate()' in its
cleanup. If these calls are removed, tests fail and there are a
significant number of cleanup errors. I discussed some of the issues
here in an email last year.



From ben at artins.org  Wed Jun  6 23:23:24 2007
From: ben at artins.org (Ben Artin)
Date: Thu, 7 Jun 2007 01:23:24 -0400
Subject: [Twisted-Python] Problem with trial using the reactor
In-Reply-To: <d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>
References: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
	<d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>
Message-ID: <F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>

I just spent some time tearing my hair out getting trial and  
ThreadedSelectReactor to cooperate.

Another possible solution to the trial/reactor impedance mismatch you  
commented on would be for trial spawn off a process for each test. By  
definition, that process would get its own reactor and could not  
taint any other tests. The test rig process could happily use  
Deferred semantics, while presenting a synchronous interface to trial.

This would also be easier to distribute IMO, because if IPC is  
already involved in communication between trial runner and tests,  
making that IPC go to another machine is easier.

I realize the cost of spawning processes, but I honestly think that  
it's easier to change unittest to fork, run a test on a separate  
reactor, and IPC the test results back to the parent, than it is to  
take one of the other three approaches, because of the API changes  
they would require. (Not that said API changes would be bad, but I  
don't think that the distributed runner should have to wait for them.)

Ben

--

<http://artins.org/ben>

"Computers! All they ever think of is hex!"





From jml at mumak.net  Thu Jun  7 00:43:06 2007
From: jml at mumak.net (Jonathan Lange)
Date: Thu, 7 Jun 2007 16:43:06 +1000
Subject: [Twisted-Python] Problem with trial using the reactor
In-Reply-To: <F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>
References: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
	<d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>
	<F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>
Message-ID: <d06a5cd30706062343h18a9f85cu431085b3ed61136c@mail.gmail.com>

On 6/7/07, Ben Artin <ben at artins.org> wrote:
> I just spent some time tearing my hair out getting trial and
> ThreadedSelectReactor to cooperate.
>

Sorry. If it doesn't have a buildslave, I can't support it. And IIRC,
we have decided not to support TSR.

> Another possible solution to the trial/reactor impedance mismatch you
> commented on would be for trial spawn off a process for each test. By
> definition, that process would get its own reactor and could not
> taint any other tests. The test rig process could happily use
> Deferred semantics, while presenting a synchronous interface to trial.
>

Right. I should have included this in my list, as it is both valid and
has been suggested before.

Thanks,
jml



From konrads.smelkovs at gmail.com  Thu Jun  7 02:21:11 2007
From: konrads.smelkovs at gmail.com (Konrads Smelkovs)
Date: Thu, 07 Jun 2007 11:21:11 +0300
Subject: [Twisted-Python] Problem with trial using the reactor
In-Reply-To: <F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>
References: <6b7b52ef0706062059r19aa4f99g6ff9941682eecc4d@mail.gmail.com>
	<d06a5cd30706062158v546a811g7a077d4cf565d4a6@mail.gmail.com>
	<F38C86EB-55C9-4EDC-8A50-6A0C4F3978CB@artins.org>
Message-ID: <1181204471.5809.3.camel@localhost.localdomain>

On Thu, 2007-06-07 at 01:23 -0400, Ben Artin wrote:

> Another possible solution to the trial/reactor impedance mismatch you  
> commented on would be for trial spawn off a process for each test. By  
> definition, that process would get its own reactor and could not  
> taint any other tests. The test rig process could happily use  
> Deferred semantics, while presenting a synchronous interface to trial.
> 
This is a I-think-so-too post. Letting the OS clean up things is a sane
approach. I also see a few more benefits, such as running tests in
parallel on SMP machines. Also, I don't think that the overhead of
forking/spawning is big enough to pay attention - at worst, 50ms per
test and 10 more megabytes of memory. As the saying goes, "We all have
pentiums now..."




From alexey.maksimov at gmail.com  Thu Jun  7 06:23:25 2007
From: alexey.maksimov at gmail.com (Alexey Maksimov)
Date: Thu, 7 Jun 2007 16:23:25 +0400
Subject: [Twisted-Python] Please help me with process spawning
Message-ID: <20070607162325.32a4a0d7@lesha-laptop>

Hi,

Please help me with the following:

I want to write a simple app that should remotely control
long running shell process. I have a C++ program that does some network
capturing I need. I want to create a simple web interface that can
start and stop this program via shell on linux.

I already wrote a web part of this but failed to spawn my process.
I think my problem is that I want to use myserver.tac and don't want
directly call reactor.run() as shown in documentation.
How can I spawn my long-running process without using reactor.run()?

Thanks in advance,
Alexey.



From Sven-Erik.Tiberg at ltu.se  Thu Jun  7 07:14:05 2007
From: Sven-Erik.Tiberg at ltu.se (Sven-Erik Tiberg)
Date: Thu, 7 Jun 2007 15:14:05 +0200
Subject: [Twisted-Python] Re: A longshot, UML and twisted.
In-Reply-To: <668D1B8AD729C94DB91D17EC19B8BB910565C020@EMMA.personal.adp.ltu.se>
Message-ID: <668D1B8AD729C94DB91D17EC19B8BB910565C024@EMMA.personal.adp.ltu.se>

 
An example of UML StateChart:
http://tellus.arb.ltu.se/distr_3d/Distr_3D.jpg .

Original MagicDraw project report:
http://tellus.arb.ltu.se/distr_3d/Distr_3D.html will add descriptions
and docs.

This is about what I needed,,, so far.

/Sven-Erik Tiberg




From christian.simms at gmail.com  Thu Jun  7 07:53:13 2007
From: christian.simms at gmail.com (christian simms)
Date: Thu, 7 Jun 2007 09:53:13 -0400
Subject: [Twisted-Python] Please help me with process spawning
In-Reply-To: <20070607162325.32a4a0d7@lesha-laptop>
References: <20070607162325.32a4a0d7@lesha-laptop>
Message-ID: <cd8fa6f90706070653g7d73c29bqa6dbe43497142193@mail.gmail.com>

On 6/7/07, Alexey Maksimov <alexey.maksimov at gmail.com> wrote:
> Hi,
>
> Please help me with the following:
>
> I want to write a simple app that should remotely control
> long running shell process. I have a C++ program that does some network
> capturing I need. I want to create a simple web interface that can
> start and stop this program via shell on linux.
>
> I already wrote a web part of this but failed to spawn my process.
> I think my problem is that I want to use myserver.tac and don't want
> directly call reactor.run() as shown in documentation.
> How can I spawn my long-running process without using reactor.run()?
>
> Thanks in advance,
> Alexey.
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

I'm not sure I understand your problem, but here's what I think you should
do:

Write a twisted application (maybe this is your myserver.tac?) which is a
simple web server.  An easy way to write a twisted web app is with
nevow.  Since this is a twisted application, assuming your myserver.tac file
defines an object named "application", just run it with:

   twistd -noy myserver.tac

The twistd program will automatically call reactor.run() for you, you
normally do not need to call it explicitly.

Now, to launch another process from twisted there are several API's you can
use.  This page<http://twistedmatrix.com/projects/core/documentation/howto/process.html>in
the docs explains the most general way, where you have complete
control
over the inputs and outputs to the spawned program.  There's also a
simplified API for launching programs, but it just grabs your process's
output:  twisted.internet.utils.getProcessOutput().

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070607/4fa34cce/attachment.html>

From mgeisler at mgeisler.net  Thu Jun  7 09:18:12 2007
From: mgeisler at mgeisler.net (Martin Geisler)
Date: Thu, 07 Jun 2007 17:18:12 +0200
Subject: [Twisted-Python] Deterministic "program counter" for asynchronious
	events
Message-ID: <87y7iv4wuj.fsf@hbox.dyndns.org>

Hello,

I'm writing a runtime system for doing secure multiparty computation,
and here I have used deferreds with great success.

All players run the same program (but with different input) and each
player communicate with other players as needed to share intermediate
results. These results need to be associated with the right operation
and for this I use a program counter.

This minimal example shows my solution without network traffic:


import sys
From twisted.internet.defer import Deferred, DeferredList, gatherResults

pc = (0,)

def inc_pc(pc):
    pc = pc[:-1] + (pc[-1]+1,)
    return pc
 
def sub_pc(pc):
    pc = pc + (1,)
    return pc

def finish_mul(arg, pc):
    print "finish_mul(%s): pc = %s" % (arg, pc)
    return arg

def mul(a, b):
    global pc
    pc = inc_pc(pc)

    results = gatherResults([a,b])
    results.addCallback(finish_mul, sub_pc(pc))
    return results

x = Deferred() # Declare variables
y = Deferred()
z = Deferred()
w = Deferred()

mul(x,y) # Schedule multiplications
mul(z,w)

x.callback(2) # The value for x arrives over the network
z.callback(4)

if len(sys.argv) > 1:
    y.callback(3) # y gets a value, enabling mul(x,y) to proceed.
    w.callback(5)
else:
    w.callback(5) # z and w are ready and mul(z,w) can proceed.
    y.callback(3)


Here mul() schedules calls to finish_mul(), and it is this call which
I would like to have a deterministic labelling of. I have solved it by
having a "two-dimensional" program counter: the calls to mul() get
labels (1,) and (2,). Their calls to the sub-operation finish_mul()
get labels (1,1) and (2,1) respectively.


This works, invoking the example with and without a command line
argument gives the same labels for finish_mul(). But it is cumbersome
to drag this program counter around all the code, and (what is worse)
it is easy to forget to increment it and to create sub program
counters at the right times.

So have anybody done something similar where you wanted to start a
bunch of operations which might start sub-operations themselves and
where everything needed to be deterministically labelled?

-- 
Martin Geisler  ---  <mgeisler at mgeisler.net>  ---  http://mgeisler.net

Read, write, create Exif data in PHP with PEL:       http://pel.sf.net
Take control of your webserver with PHP Shell:  http://phpshell.sf.net
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 188 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20070607/a934f9a3/attachment.sig>

From elicriffield at gmail.com  Thu Jun  7 15:14:38 2007
From: elicriffield at gmail.com (Eli Criffield)
Date: Thu, 7 Jun 2007 16:14:38 -0500
Subject: [Twisted-Python] where to getPeerCertificate()
Message-ID: <18e3f33d0706071414x4196f67ch73c80afe8bb28b78@mail.gmail.com>

I'd like to check the CN of incoming certs for a xmlrpc server. I
can't seen to find where to get the clients cert information.

In the protocol.Protocol (in my case the http.HTTPCHannel) in the
connectionMade() i put in a
print self.transport.getPeerCertificate()
but it returns a None.
print self.transport.socket.get_peer_certificate()
Does the same. I'm sure the client is connecting with a cert because
its verifying it fine.

I also have no idea where to check on client program to get the cert
info of the server I'm connecting to.

Eli Criffield

--example--
#!/usr/bin/env python

from twisted.web import xmlrpc, server, http, resource
from twisted.internet import reactor, ssl
from twisted.python.log import startLogging
from sys import stdout
import OpenSSL

class Example(xmlrpc.XMLRPC):
    """An example object to be published."""
    def xmlrpc_add(self, a, b):
        """Return sum of arguments."""
        return a + b

class myHTTPChannel(http.HTTPChannel):
    def connectionMade(self):
        print "connection from %s"%(self.transport.getHost().host,)
        # HERE i get no cert
        print self.transport.socket.get_peer_certificate()
        print self.transport.getPeerCertificate()
        self.setTimeout(self.timeOut)

class mySite(server.Site):
       protocol = myHTTPChannel

def makeSSLContext(myKey,trustedCA):
    '''Returns an ssl Context Object
   @param myKey a pem formated key and certifcate with for my current host
          the other end of this connection must have the cert from the CA
          that signed this key
   @param iTrustCA a pem formated certificat from a CA you trust
          you will only allow connections from clients signed by this CA
          and you will only allow connections to a server signed by this CA
    '''
    fd = open(myKey,'r')
    theCert = ssl.PrivateCertificate.loadPEM(fd.read())
    fd.close()
    fd = open(trustedCA,'r')
    theCA = ssl.Certificate.loadPEM(fd.read())
    fd.close()
    ctx = theCert.options(theCA)
    # The SSL protocol to use, one of SSLv23_METHOD, SSLv2_METHOD,
    # SSLv3_METHOD, TLSv1_METHOD. Defaults to TLSv1_METHOD.
    ctx.method = ssl.SSL.TLSv1_METHOD

    # If True, verify certificates received from the peer and fail
    # the handshake if verification fails. Otherwise, allow anonymous
    # sessions and sessions with certificates which fail validation.
    ctx.verify = True

    # Depth in certificate chain down to which to verify.
    ctx.verifyDepth = 1

    # If True, do not allow anonymous sessions.
    ctx.requireCertification = True

    # If True, do not re-verify the certificate on session resumption.
    ctx.verifyOnce = True

    # If True, generate a new key whenever ephemeral DH parameters are used
    # to prevent small subgroup attacks.
    ctx.enableSingleUseKeys = True

    # If True, set a session ID on each context. This allows a shortened
    # handshake to be used when a known client reconnects.
    ctx.enableSessions = True

    # If True, enable various non-spec protocol fixes for broken
    # SSL implementations.
    ctx.fixBrokenPeers = False

    return ctx

if __name__ == '__main__':
    r = Example()
    ctx = makeSSLContext('server.pem','cacert.pem')
    reactor.listenSSL(7080,mySite(r),ctx)
    startLogging(stdout)
    reactor.run()



From abierbaum at gmail.com  Thu Jun  7 20:25:30 2007
From: abierbaum at gmail.com (Allen Bierbaum)
Date: Thu, 7 Jun 2007 21:25:30 -0500
Subject: [Twisted-Python] Re: Taking a look at pending deferToThread
	actions
In-Reply-To: <1181107254.10081.1.camel@localhost.localdomain>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>
	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>
	<1181107254.10081.1.camel@localhost.localdomain>
Message-ID: <bea9869d0706071925l23f39e9bha519962fb60659f6@mail.gmail.com>

On 6/6/07, Itamar Shtull-Trauring <itamar at itamarst.org> wrote:
> On Tue, 2007-06-05 at 11:02 -0500, Allen Bierbaum wrote:
>
> > - Has anyone extended threadpool to allow code to remove queued
> > functions from the pending queue?
>
> How about just having the functions themselves check to see if they
> really should run their intended task? (Being careful about
> thread-safety, of course).

Thanks for the idea.  I will give it a try.

>
> Why are you using threads, btw?

I am using threads because the calls I am making are into a
non-blocking library.  I may see about rewriting it in the future to
be more twisted-friendly, but for now I have to live with it.

-Allen

>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From sipickles at hotmail.com  Fri Jun  8 07:33:57 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Fri, 08 Jun 2007 14:33:57 +0100
Subject: [Twisted-Python] Have I installed twisted correctly?
Message-ID: <BAY114-F3188B14522018CC0A7E908BE250@phx.gbl>


Hi,

I have just been recommended twisted from the python mailing lists. I 
thought I'd installed it, but I get an error with the first line!

from twisted.internet import reactor

error:
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
types

Can an expert help me?

Simon


http://www.simonpickles.com  --- http://www.squirtualreality.com

_________________________________________________________________
Play your part in making history - Email Britain! 
http://www.emailbritain.co.uk/




From exarkun at divmod.com  Fri Jun  8 08:04:18 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 8 Jun 2007 10:04:18 -0400
Subject: [Twisted-Python] Have I installed twisted correctly?
In-Reply-To: <BAY114-F3188B14522018CC0A7E908BE250@phx.gbl>
Message-ID: <20070608140418.30678.1553467141.divmod.quotient.12679@ohm>


On Fri, 08 Jun 2007 14:33:57 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>
>Hi,
>
>I have just been recommended twisted from the python mailing lists. I 
>thought I'd installed it, but I get an error with the first line!
>
>from twisted.internet import reactor
>
>error:
>TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
>types
>
>Can an expert help me?
>

Can you provide more context?  The complete traceback would be useful, for
example.

Jean-Paul



From radix at twistedmatrix.com  Fri Jun  8 08:05:00 2007
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 8 Jun 2007 10:05:00 -0400
Subject: [Twisted-Python] Have I installed twisted correctly?
In-Reply-To: <BAY114-F3188B14522018CC0A7E908BE250@phx.gbl>
References: <BAY114-F3188B14522018CC0A7E908BE250@phx.gbl>
Message-ID: <60ed19d40706080705i27ea2c6dode35884e19bf6053@mail.gmail.com>

On 6/8/07, Simon Pickles <sipickles at hotmail.com> wrote:
>
> Hi,
>
> I have just been recommended twisted from the python mailing lists. I
> thought I'd installed it, but I get an error with the first line!
>
> from twisted.internet import reactor
>
> error:
> TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and
> types

Is that the entire traceback? If there's more, can you please post it?


-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From sipickles at hotmail.com  Fri Jun  8 09:15:16 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Fri, 08 Jun 2007 16:15:16 +0100
Subject: [Twisted-Python] Have I installed twisted correctly - part II
Message-ID: <BAY114-F69F8E3F052F679636C45EBE250@phx.gbl>

Sorry, how lazy of me!

*** Python 2.5.1 (r251:54863, Apr 18 2007, 08:51:08) [MSC v.1310 32 bit 
(Intel)] on win32. ***
>>>

>>>
Traceback (most recent call last):
  File "<string>", line 74, in run_nodebug
  File "F:\_Dev\twisted server 20070608\twistedServer.py", line 5, in 
<module>
    from twisted.internet import reactor
  File "C:\Python25\lib\site-packages\twisted\__init__.py", line 19, in 
<module>
    from zope.interface import Interface
  File "C:\Python25\lib\site-packages\zope\interface\__init__.py", line 58, 
in <module>
    _wire()
  File "C:\Python25\lib\site-packages\zope\interface\interface.py", line 
936, in _wire
    classImplements(Attribute, IAttribute)
  File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
464, in classImplements
    spec = implementedBy(cls)
  File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
330, in implementedByFallback
    if isinstance(spec, Implements):
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
types

>>>


btw, the line

from twisted.internet import reactor

is the ONLY line in the module currently!

Thanks

Simon

_________________________________________________________________
Could you be the guest MSN Movies presenter? Click Here to Audition 
http://www.lightscameraaudition.co.uk




From general at eepatents.com  Fri Jun  8 10:26:24 2007
From: general at eepatents.com (Ed Suominen)
Date: Fri, 08 Jun 2007 09:26:24 -0700
Subject: [Twisted-Python] Re: Taking a look at pending deferToThread
	actions
In-Reply-To: <bea9869d0706071925l23f39e9bha519962fb60659f6@mail.gmail.com>
References: <bea9869d0706041601w38d1cb8fj6d0b7582f85a228f@mail.gmail.com>	<bea9869d0706050902u43396673ke8661e64ec065840@mail.gmail.com>	<1181107254.10081.1.camel@localhost.localdomain>
	<bea9869d0706071925l23f39e9bha519962fb60659f6@mail.gmail.com>
Message-ID: <46698330.9010006@eepatents.com>

Allen Bierbaum wrote:
>> > - Has anyone extended threadpool to allow code to remove queued
>> > functions from the pending queue?
>>
>> How about just having the functions themselves check to see if they
>> really should run their intended task? (Being careful about
>> thread-safety, of course).
> 
> Thanks for the idea.  I will give it a try.

You also might want to take a look at my taskqueue sub-package in
Twisted-Goodies, http://foss.eepatents.com/Twisted-Goodies. One feature
that might come in handy is the IWorker implementors' ability to resign
when they feel that they are no longer able to run jobs. Any jobs that
the resigning worker has queued up individually at that point are
returned to the main queue for dispatching to other workers, current or
future.

The whole thing revolves around a priority queue, which might be useful
to you, too. Also, a ProcessWorker implementation of IWorker is pending
that spawns a separate Python interpreter to run tasks. If the
ProcessWorker hangs, you'll be able to just kill it and move right
along, without hanging your main Python interpreter.

> I am using threads because the calls I am making are into a
> non-blocking library.  I may see about rewriting it in the future to
> be more twisted-friendly, but for now I have to live with it.

That was my original motivation for writing taskqueue, with its
ThreadWorker implementation of IWorker. It's used in sAsync, which makes
a wonderful but totally synchronous database API (SQLAlchemy) play very
nicely (IMHO) with Twisted.

Debian packages are in the works for both, by the way.

Best regards,
Ed Suominen




From exarkun at divmod.com  Fri Jun  8 10:50:05 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 8 Jun 2007 12:50:05 -0400
Subject: [Twisted-Python] Have I installed twisted correctly - part II
In-Reply-To: <BAY114-F69F8E3F052F679636C45EBE250@phx.gbl>
Message-ID: <20070608165005.30678.147983492.divmod.quotient.12723@ohm>

On Fri, 08 Jun 2007 16:15:16 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Sorry, how lazy of me!
>
>*** Python 2.5.1 (r251:54863, Apr 18 2007, 08:51:08) [MSC v.1310 32 bit 
>(Intel)] on win32. ***
>>>>
>
>>>>
>Traceback (most recent call last):
>  File "<string>", line 74, in run_nodebug
>  File "F:\_Dev\twisted server 20070608\twistedServer.py", line 5, in 
><module>
>    from twisted.internet import reactor
>  File "C:\Python25\lib\site-packages\twisted\__init__.py", line 19, in 
><module>
>    from zope.interface import Interface
>  File "C:\Python25\lib\site-packages\zope\interface\__init__.py", line 58, 
>in <module>
>    _wire()
>  File "C:\Python25\lib\site-packages\zope\interface\interface.py", line 936, 
>in _wire
>    classImplements(Attribute, IAttribute)
>  File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
>464, in classImplements
>    spec = implementedBy(cls)
>  File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
>330, in implementedByFallback
>    if isinstance(spec, Implements):
>TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
>types
>>>>
>
>
>btw, the line
>
>from twisted.internet import reactor
>
>is the ONLY line in the module currently!
>
>Thanks

It looks like your version of ZopeInterface doesn't want to play nicely
with your version of Twisted.  Try getting the latest release of each.

Jean-Paul



From sipickles at hotmail.com  Fri Jun  8 15:49:47 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Fri, 08 Jun 2007 22:49:47 +0100
Subject: [Twisted-Python] Have I installed twisted correctly - part II
Message-ID: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>

"It looks like your version of ZopeInterface doesn't want to play nicely
with your version of Twisted.  Try getting the latest release of each."
Jean-Paul

Well, I just installed python 2.5 and latest twisted... I don't even know 
what zope is! I downloaded zope but that doesn't look like it will help 
me......

Any more ideas?

Here's my error again:
Traceback (most recent call last):
File "<string>", line 74, in run_nodebug
File "F:\_Dev\twisted server 20070608\twistedServer.py", line 5, in <module>
   from twisted.internet import reactor
File "C:\Python25\lib\site-packages\twisted\__init__.py", line 19, in 
<module>
   from zope.interface import Interface
File "C:\Python25\lib\site-packages\zope\interface\__init__.py", line 58, in 
<module>
   _wire()
File "C:\Python25\lib\site-packages\zope\interface\interface.py", line 936, 
in _wire
   classImplements(Attribute, IAttribute)
File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
464, in classImplements
   spec = implementedBy(cls)
File "C:\Python25\lib\site-packages\zope\interface\declarations.py", line 
330, in implementedByFallback
   if isinstance(spec, Implements):
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and 
types
>>>



Si

_________________________________________________________________
Txt a lot? Get Messenger FREE on your mobile.  
https://livemessenger.mobile.uk.msn.com/




From glyph at divmod.com  Fri Jun  8 15:54:31 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Fri, 08 Jun 2007 21:54:31 -0000
Subject: [Twisted-Python] Have I installed twisted correctly - part II
In-Reply-To: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>
References: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>
Message-ID: <20070608215431.5916.44606212.divmod.xquotient.1@joule.divmod.com>

On 09:49 pm, sipickles at hotmail.com wrote:
>"It looks like your version of ZopeInterface doesn't want to play 
>nicely
>with your version of Twisted.  Try getting the latest release of each."
>Jean-Paul
>
>Well, I just installed python 2.5 and latest twisted... I don't even 
>know what zope is! I downloaded zope but that doesn't look like it will 
>help me......
>
>Any more ideas?

This doesn't look like a conflict between ZopeInterface (not Zope) and 
Twisted, per se, it looks like ZopeInterface itself has some problem on 
your machine.

Does the script "from zope.interface import Interface" work, by itself?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070608/e0ef581e/attachment.html>

From ldanielburr at mac.com  Fri Jun  8 16:05:42 2007
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Fri, 08 Jun 2007 17:05:42 -0500
Subject: [Twisted-Python] Have I installed twisted correctly - part II
In-Reply-To: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>
References: <BAY114-F66DC73A804C84303F5D1BBE250@phx.gbl>
Message-ID: <op.ttmibsuh3oj628@l-daniel-burrs-powerbook-g4-17.local>

On Fri, 08 Jun 2007 16:49:47 -0500, Simon Pickles <sipickles at hotmail.com>  
wrote:

> "It looks like your version of ZopeInterface doesn't want to play nicely
> with your version of Twisted.  Try getting the latest release of each."
> Jean-Paul
>
> Well, I just installed python 2.5 and latest twisted... I don't even  
> know what zope is! I downloaded zope but that doesn't look like it will  
> help me......
>
> Any more ideas?
>

Yes, you *have* to download and install the correct version of
zope.interface.  Seriously, there's no other solution; twisted
needs zope.interface.

http://cheeseshop.python.org/pypi/zope.interface/3.3.0.1

The link above should get you a working version of zope.interface.

Hope this helps,

L. Daniel Burr






From monch1962 at gmail.com  Fri Jun  8 20:46:23 2007
From: monch1962 at gmail.com (David Mitchell)
Date: Sat, 9 Jun 2007 12:46:23 +1000
Subject: [Twisted-Python] Using Twisted with MQ
Message-ID: <f6508a860706081946p72765e2n363280ed4011de14@mail.gmail.com>

Hello all,

I've got what I think is a potential application for Twisted, but I'm
having trouble figuring out whether Twisted is going to be the best
path or not.  I've worked through the Twisted Finger tutorial and read
through the "Ball of snakes" O'Reilly book, but I'm not sure I've got
my head around Twisted sufficiently.

I have to simulate a server that reads messages off IBM's MQ queues,
and posts responses back to different MQ queues.  I've used both pymqi
and Python/COM (on Windows only) to perform this sort of task in the
past, but now I need something that's going to be able to respond to
incoming MQ messages at a very high rate.

I suspect I'm going to have to use reactor.callInThread to spawn off
threads within Twisted in order to handle IO with the MQ queues, as
I'm not aware of any event-based interface to MQ and therefore any
reads/writes from queues are potentially going to block for a while.

Is Twisted suited for this sort of application?  Better yet, is anyone
aware of info I can access regarding this sort of application with
Twisted? - Google hasn't been much help...

Thanks in advance

Dave Mitchell



From arkanes at gmail.com  Sat Jun  9 02:20:06 2007
From: arkanes at gmail.com (Chris Mellon)
Date: Sat, 9 Jun 2007 03:20:06 -0500
Subject: [Twisted-Python] Using Twisted with MQ
In-Reply-To: <f6508a860706081946p72765e2n363280ed4011de14@mail.gmail.com>
References: <f6508a860706081946p72765e2n363280ed4011de14@mail.gmail.com>
Message-ID: <4866bea60706090120n5777fa42wc29e2748238f082c@mail.gmail.com>

On 6/8/07, David Mitchell <monch1962 at gmail.com> wrote:
> Hello all,
>
> I've got what I think is a potential application for Twisted, but I'm
> having trouble figuring out whether Twisted is going to be the best
> path or not.  I've worked through the Twisted Finger tutorial and read
> through the "Ball of snakes" O'Reilly book, but I'm not sure I've got
> my head around Twisted sufficiently.
>
> I have to simulate a server that reads messages off IBM's MQ queues,
> and posts responses back to different MQ queues.  I've used both pymqi
> and Python/COM (on Windows only) to perform this sort of task in the
> past, but now I need something that's going to be able to respond to
> incoming MQ messages at a very high rate.
>
> I suspect I'm going to have to use reactor.callInThread to spawn off
> threads within Twisted in order to handle IO with the MQ queues, as
> I'm not aware of any event-based interface to MQ and therefore any
> reads/writes from queues are potentially going to block for a while.
>
> Is Twisted suited for this sort of application?  Better yet, is anyone
> aware of info I can access regarding this sort of application with
> Twisted? - Google hasn't been much help...
>
> Thanks in advance
>
> Dave Mitchell
>

I haven't written any real code that does this, but I was just
investigating it for feasability myself a couple days ago. I wrote a
thread that looked basically like this:
(pseudocode, as I don't have any of the code in front of me)

while True:
    try:
        res = mq.get() #blocking call, with a fairly long timeout - 5-10 seconds
        reactor.callFromThead(someCallbackFunc, res)
    except Timeout: #pymqi will translate the timeout to an exception
        pass
    if self.exit.is_set(): #threading.Event to check for termination.
        self.terminate()


This just spins happily along, and dispatches processing into the
Twisted event loop. I didn't really test it for performance or
latency. Used reactor.callInThread to dispatch the writes.



From monch1962 at gmail.com  Sat Jun  9 03:53:30 2007
From: monch1962 at gmail.com (David Mitchell)
Date: Sat, 9 Jun 2007 19:53:30 +1000
Subject: [Twisted-Python] Using Twisted with MQ
In-Reply-To: <4866bea60706090120n5777fa42wc29e2748238f082c@mail.gmail.com>
References: <f6508a860706081946p72765e2n363280ed4011de14@mail.gmail.com>
	<4866bea60706090120n5777fa42wc29e2748238f082c@mail.gmail.com>
Message-ID: <f6508a860706090253h58540996x87f5ca6ab78f27af@mail.gmail.com>

Thanks Chris,

That's pretty much along the lines of what I was planning to do - I'm
just wondering how much load I'll be able to throw at it.

Oh well, guess there's one very good way to find out ;->

Regards

Dave Mitchell

On 09/06/07, Chris Mellon <arkanes at gmail.com> wrote:
> On 6/8/07, David Mitchell <monch1962 at gmail.com> wrote:
> > Hello all,
> >
> > I've got what I think is a potential application for Twisted, but I'm
> > having trouble figuring out whether Twisted is going to be the best
> > path or not.  I've worked through the Twisted Finger tutorial and read
> > through the "Ball of snakes" O'Reilly book, but I'm not sure I've got
> > my head around Twisted sufficiently.
> >
> > I have to simulate a server that reads messages off IBM's MQ queues,
> > and posts responses back to different MQ queues.  I've used both pymqi
> > and Python/COM (on Windows only) to perform this sort of task in the
> > past, but now I need something that's going to be able to respond to
> > incoming MQ messages at a very high rate.
> >
> > I suspect I'm going to have to use reactor.callInThread to spawn off
> > threads within Twisted in order to handle IO with the MQ queues, as
> > I'm not aware of any event-based interface to MQ and therefore any
> > reads/writes from queues are potentially going to block for a while.
> >
> > Is Twisted suited for this sort of application?  Better yet, is anyone
> > aware of info I can access regarding this sort of application with
> > Twisted? - Google hasn't been much help...
> >
> > Thanks in advance
> >
> > Dave Mitchell
> >
>
> I haven't written any real code that does this, but I was just
> investigating it for feasability myself a couple days ago. I wrote a
> thread that looked basically like this:
> (pseudocode, as I don't have any of the code in front of me)
>
> while True:
>     try:
>         res = mq.get() #blocking call, with a fairly long timeout - 5-10 seconds
>         reactor.callFromThead(someCallbackFunc, res)
>     except Timeout: #pymqi will translate the timeout to an exception
>         pass
>     if self.exit.is_set(): #threading.Event to check for termination.
>         self.terminate()
>
>
> This just spins happily along, and dispatches processing into the
> Twisted event loop. I didn't really test it for performance or
> latency. Used reactor.callInThread to dispatch the writes.
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From sipickles at hotmail.com  Sat Jun  9 09:09:29 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sat, 09 Jun 2007 16:09:29 +0100
Subject: [Twisted-Python] Asynchronicity
Message-ID: <BAY114-F32856C75840A54E7165C5EBE240@phx.gbl>

Hi,

I have managed to get a simple server going. It seems to accept multiple
connections correctly.

I am a little puzzled as to how to achieve an asynchonous application
using twisted. Twisted itself seems asynchronous, but my code is blocked
by the call:

reactor.run()

Is there anyway I can return from the reactor to run other code, like
GUI stuff, or other processing?

My code:

import GUI
from zope.interface import Interface
from twisted.internet import reactor
from twisted.protocols import basic
from twisted.internet.protocol import Protocol, Factory

class CNetwork(basic.LineReceiver):
    def connectionMade(self):
        GUI.Print("New Client: %s" % self.transport.getPeer().host)
        self.send = lambda x: self.transport.write(x+"\r\n")
##        if self.factory.server_data:
##            self.send("\r\n".join(self.factory.server_data))
##        else:
##            self.send("You are logged in")
        GUI.Print("Entering loop for client %s" %
self.transport.getPeer().host)

    def connectionLost(self, reason):
        GUI.Print( "%s has closed the connection" %
self.transport.getPeer().host )

    def dataReceived(self, data):
        data = data.strip()
        if not data:
            self.transport.loseConnection()
            return
        GUI.Print("%s says %r" % (self.transport.getPeer().host,data))
        self.transport.write("You said: %r\r\n" % data )
       ## self.factory.server_data.append(data + "~~")
        GUI.Print("Ready to receive more data")

class CNetworkFactory(Protocol):
    factory = Factory()
    factory.protocol = CNetwork
    def __init__(self, max_clients):
        self.max_clients = max_clients
        self.connected_clients = 0
        self.server_data = []

    def doStart(self):
        GUI.Print("Factory started -- server is waiting for a connection")
    def doStop(self):
        GUI.Print("Factory stopped -- server is now closed")

    def buildProtocol(self, addr):
        GUI.Print("Connection attempt....")
        return CNetwork()

def main():

    reactor.listenTCP(14500, CNetworkFactory(max_clients = 2))
    reactor.run()

if __name__ == "__main__":
    main()

##DO SOMETHING ELSE HERE!


###################################

Thanks for your help

_________________________________________________________________
The next generation of Hotmail is here! http://www.newhotmail.co.uk




From exarkun at divmod.com  Sat Jun  9 09:33:44 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sat, 9 Jun 2007 11:33:44 -0400
Subject: [Twisted-Python] Asynchronicity
In-Reply-To: <BAY114-F32856C75840A54E7165C5EBE240@phx.gbl>
Message-ID: <20070609153344.30678.910956207.divmod.quotient.13138@ohm>

On Sat, 09 Jun 2007 16:09:29 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Hi,
>
>I have managed to get a simple server going. It seems to accept multiple
>connections correctly.
>
>I am a little puzzled as to how to achieve an asynchonous application
>using twisted. Twisted itself seems asynchronous, but my code is blocked
>by the call:
>
>reactor.run()
>

Quite so.  reactor.run enters the Twisted mainloop and does not return
until the mainloop is stopped (via reactor.stop).

>Is there anyway I can return from the reactor to run other code, like
>GUI stuff, or other processing?

No, but you can call into your other code from Twisted event handlers or
you can write a custom reactor which integrates an existing mainloop with
Twisted's.  As far as GUIs go, Twisted already includes reactors which
integrate glib, gtk, gtk2, various kinds of Windows loops, wxPython, and
a few others.

Precisely how you integrate two mainloops depends on various details
about the loops in question.  Which GUI library are you trying to
integrate with?

Jean-Paul



From sipickles at hotmail.com  Sat Jun  9 13:51:39 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sat, 09 Jun 2007 20:51:39 +0100
Subject: [Twisted-Python] Asynchronicity
Message-ID: <BAY114-F26CCA93C2ED01482B58091BE240@phx.gbl>

Integrating into a GUI is just one example. In my case, I am using
Tkinter on win32. The GUI will be switched off when the server is
running, its simply a debug controller...

I'm more interested in how a twisted server manages to perform any other
logic. For a game server, a fair amount of time needs to be devoted to
object and memory management, AI, database access etc

My first server, in C++ could do this simply, with a winSock thread
listening and storing incoming network comms in a message queue. Easily
integrated into a game loop.

I was tempted to move to python due to the ease of modification.

So... with twisted, how can I manage to spend any time doing AI, for
instance?

I thought twisted.interface.reactor.iterate() might be my answer. API
docs say about iterate:

"Run the main loop's I/O polling function for a period of time. This is
most useful in applications where the UI is being drawn "as fast as
possible", such as games."

Unfortunately, the next sentence seems a little contradictory....

" The reactor must have been started (via the run() method) prior to any
invocations of this method. It must also be stopped manually after the
last call to this method (via the stop() method). "

Now, I am only a beginner at twisted, but it looks to me if I called
run(), I won't have a chance to call iterate() cos twisted will have
gone into its mainloop and stolen all control!

Am i making sense?

Regards

Simon


Jean-Paul Calderone wrote:
>On Sat, 09 Jun 2007 16:09:29 +0100, Simon Pickles <sipickles at hotmail.com> 
>wrote:
>>Hi,
>>
>>I have managed to get a simple server going. It seems to accept multiple
>>connections correctly.
>>
>>I am a little puzzled as to how to achieve an asynchonous application
>>using twisted. Twisted itself seems asynchronous, but my code is blocked
>>by the call:
>>
>>reactor.run()
>>
>
>Quite so.  reactor.run enters the Twisted mainloop and does not return
>until the mainloop is stopped (via reactor.stop).
>
>>Is there anyway I can return from the reactor to run other code, like
>>GUI stuff, or other processing?
>
>No, but you can call into your other code from Twisted event handlers or
>you can write a custom reactor which integrates an existing mainloop with
>Twisted's.  As far as GUIs go, Twisted already includes reactors which
>integrate glib, gtk, gtk2, various kinds of Windows loops, wxPython, and
>a few others.
>
>Precisely how you integrate two mainloops depends on various details
>about the loops in question.  Which GUI library are you trying to
>integrate with?
>
>Jean-Paul
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>

_________________________________________________________________
The next generation of Hotmail is here! http://www.newhotmail.co.uk




From exarkun at divmod.com  Sat Jun  9 14:07:13 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sat, 9 Jun 2007 16:07:13 -0400
Subject: [Twisted-Python] Asynchronicity
In-Reply-To: <BAY114-F26CCA93C2ED01482B58091BE240@phx.gbl>
Message-ID: <20070609200713.30678.1561594262.divmod.quotient.13234@ohm>

On Sat, 09 Jun 2007 20:51:39 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Integrating into a GUI is just one example. In my case, I am using
>Tkinter on win32. The GUI will be switched off when the server is
>running, its simply a debug controller...

There's Tkinter support. ;)

>
>I'm more interested in how a twisted server manages to perform any other
>logic. For a game server, a fair amount of time needs to be devoted to
>object and memory management, AI, database access etc

Sure (though I'm going to disregard "object and memory management" ;).  If
you have code for an NPC in the game, there are two possibilities for when
it runs:

It might run in response to events in the game world (possibly timing
events).  In this case, you simply implement the appropriate event handlers
and it will have a chance to run at the appropriate times.

It might need to run "as much as possible" - for example, to incrementally
refine some behavior, to the limit imposed by available system resources.
In this case, you might want to use a separate process and do IPC, or a
thread might be appropriate, or you could implement something based on
cooperative threading (for example, by implementing the logic as an iterator
and using twisted.internet.task.Cooperator to run it as frequently as there
is CPU time to do so).

> [snip]
>
>I thought twisted.interface.reactor.iterate() might be my answer. API
>docs say about iterate:

iterate is most likely a dead end, I wouldn't spend much time there.

Jean-Paul



From sipickles at hotmail.com  Sat Jun  9 14:07:12 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sat, 09 Jun 2007 21:07:12 +0100
Subject: [Twisted-Python] Asynchronicity
Message-ID: <BAY114-F407266C61E3A9E9BA9915FBE240@phx.gbl>

Wow! it works... iterate does indeed return. Must've had a small mistake
before!

I am amazed I solved my own problem for a change!

Thanks for the advice, Jean

Simon Pickles wrote:
>Integrating into a GUI is just one example. In my case, I am using
>Tkinter on win32. The GUI will be switched off when the server is
>running, its simply a debug controller...
>
>I'm more interested in how a twisted server manages to perform any other
>logic. For a game server, a fair amount of time needs to be devoted to
>object and memory management, AI, database access etc
>
>My first server, in C++ could do this simply, with a winSock thread
>listening and storing incoming network comms in a message queue. Easily
>integrated into a game loop.
>
>I was tempted to move to python due to the ease of modification.
>
>So... with twisted, how can I manage to spend any time doing AI, for
>instance?
>
>I thought twisted.interface.reactor.iterate() might be my answer. API
>docs say about iterate:
>
>"Run the main loop's I/O polling function for a period of time. This is
>most useful in applications where the UI is being drawn "as fast as
>possible", such as games."
>
>Unfortunately, the next sentence seems a little contradictory....
>
>" The reactor must have been started (via the run() method) prior to any
>invocations of this method. It must also be stopped manually after the
>last call to this method (via the stop() method). "
>
>Now, I am only a beginner at twisted, but it looks to me if I called
>run(), I won't have a chance to call iterate() cos twisted will have
>gone into its mainloop and stolen all control!
>
>Am i making sense?
>
>Regards
>
>Simon
>
>
>Jean-Paul Calderone wrote:
>>On Sat, 09 Jun 2007 16:09:29 +0100, Simon Pickles <sipickles at hotmail.com> 
>>wrote:
>>>Hi,
>>>
>>>I have managed to get a simple server going. It seems to accept multiple
>>>connections correctly.
>>>
>>>I am a little puzzled as to how to achieve an asynchonous application
>>>using twisted. Twisted itself seems asynchronous, but my code is blocked
>>>by the call:
>>>
>>>reactor.run()
>>>
>>
>>Quite so.  reactor.run enters the Twisted mainloop and does not return
>>until the mainloop is stopped (via reactor.stop).
>>
>>>Is there anyway I can return from the reactor to run other code, like
>>>GUI stuff, or other processing?
>>
>>No, but you can call into your other code from Twisted event handlers or
>>you can write a custom reactor which integrates an existing mainloop with
>>Twisted's.  As far as GUIs go, Twisted already includes reactors which
>>integrate glib, gtk, gtk2, various kinds of Windows loops, wxPython, and
>>a few others.
>>
>>Precisely how you integrate two mainloops depends on various details
>>about the loops in question.  Which GUI library are you trying to
>>integrate with?
>>
>>Jean-Paul
>>
>>_______________________________________________
>>Twisted-Python mailing list
>>Twisted-Python at twistedmatrix.com
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>>
>>
>
>_________________________________________________________________
>The next generation of Hotmail is here! http://www.newhotmail.co.uk
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>

_________________________________________________________________
Play your part in making history - Email Britain! 
http://www.emailbritain.co.uk/




From maarten at treewalker.org  Sat Jun  9 14:18:43 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Sat, 9 Jun 2007 22:18:43 +0200
Subject: [Twisted-Python] Asynchronicity
In-Reply-To: <BAY114-F26CCA93C2ED01482B58091BE240@phx.gbl>
References: <BAY114-F26CCA93C2ED01482B58091BE240@phx.gbl>
Message-ID: <200706092218.49156.maarten@treewalker.org>

On Saturday 09 June 2007, Simon Pickles wrote:

> Now, I am only a beginner at twisted, but it looks to me if I called
> run(), I won't have a chance to call iterate() cos twisted will have
> gone into its mainloop and stolen all control!

You should make your code run inside of (under control of) the reactor. I 
think what you're looking for is the callLater method:

reactor.callLater(delay_in_seconds, function, arg1, arg2, ...)

In the function, do a little bit of work, then schedule another callLater and 
let the function return. That way, the reactor can handle the network traffic 
before going back to processing for example AI.

If it's not easy to divide the AI code in fast-executing chunks, you could 
consider running it on a separate thread, but then you have to be careful to 
properly guard all concurrent access to shared data. Another option is to run 
in the AI in a different process, if there is not too much communication 
between the network part and the AI.

Bye,
		Maarten
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20070609/200293e3/attachment.sig>

From exarkun at twistedmatrix.com  Sat Jun  9 22:05:02 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 10 Jun 2007 04:05:02 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1181448302.27.562389900@twistedmatrix.com

Bug summary
______________________
Summary for 2007-06-03 through 2007-06-10
Bugs opened: 15    Bugs closed: 10  Total open bugs: 974 (+5)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       +6  |Highest:  -4          |Conch:   +1            
|Enhancement:  +0  |High:     +1          |Core:    +3            
|Task:         -1  |Normal:   +7          |Mail:    +2            
                   |Low:      +2          |Runner:  +1            
                   |Lowest:   -1          |Trial:   +1            
                                          |Web2:    -1            
                                          |Words:   -2            


New / Reopened Bugs
______________________
                    ===== Highest =====
[#2688] isIPAddress has no unit tests (opened by exarkun) (CLOSED, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2688

[#2691] internet.task.Clock.callLater does not fulfill IReactorTime.callLater contract (opened by washort) (CLOSED, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2691

[#2700] IMAP4Client.lineReceived() fails to parse literals (opened by jenner)
    defect          mail       http://twistedmatrix.com/trac/ticket/2700

[#2701] twisted.words.xish.yappsrt.Scanner.__init__ is  not proper epytext (opened by therve)
    defect          core       http://twistedmatrix.com/trac/ticket/2701

[#2702] twisted.words.xish.yappsrt.Scanner.__init__ is  not proper epytext (opened by therve)
    defect          core       http://twistedmatrix.com/trac/ticket/2702

                    ===== High =====
[#2698] Build Bug on Cygwin (opened by donfanning)
    defect          core       http://twistedmatrix.com/trac/ticket/2698

                    ===== Normal =====
[#2689] twisted.test.test_assertions is lonely (opened by exarkun)
    defect          trial      http://twistedmatrix.com/trac/ticket/2689

[#2690] assertRaises can accept a sequence of exceptions as first parameter, but errors if assertion fails (opened by jml)
    defect          trial      http://twistedmatrix.com/trac/ticket/2690

[#2692] before-shutdown triggers are fired multiple times (opened by yaubi)
    defect          core       http://twistedmatrix.com/trac/ticket/2692

[#2693] procmon.DummyTransport doesn't implement ITransport and is pretty much completely bogus. (opened by dreid)
    defect          runner     http://twistedmatrix.com/trac/ticket/2693

[#2695] IMAP4Client breaks if server uses CONDSTORE (opened by slamb)
    defect          mail       http://twistedmatrix.com/trac/ticket/2695

[#2696] amp.AmpList cannot serialize [] (opened by Lacrymology)
    defect          core       http://twistedmatrix.com/trac/ticket/2696

[#2697] web2's access log should include the username for requests authenticated with twisted.web2.auth.wrapper (opened by dreid)
    enhancement     web2       http://twistedmatrix.com/trac/ticket/2697

                    ===== Low =====
[#2694] ITerminalProtocol.terminalSize should take a winsize object (opened by exarkun)
    enhancement     conch      http://twistedmatrix.com/trac/ticket/2694

[#2699] UDP DatagramProtocol reconnecting (opened by Vazde)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2699



Closed Bugs
______________________
                    ===== Highest =====
[#2654] twisted.internet.abstract.isIPAddress rejects valid IPv4 strings (opened by exarkun, closed by exarkun, wontfix)
    defect          core       http://twistedmatrix.com/trac/ticket/2654

[#2691] internet.task.Clock.callLater does not fulfill IReactorTime.callLater contract (opened by washort, closed by washort, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2691

[#2612] Deferreds not returned in web2 test_wsgi (opened by karlb, closed by therve, fixed)
    defect          web2       http://twistedmatrix.com/trac/ticket/2612

[#2626] trial needs something to check DeprecationWarning (opened by therve, closed by therve, fixed)
    enhancement     trial      http://twistedmatrix.com/trac/ticket/2626

[#2688] isIPAddress has no unit tests (opened by exarkun, closed by exarkun, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2688

[#2502] 'and' and 'or' operator suport for xpath (opened by jack, closed by ralphm, fixed)
    enhancement     words      http://twistedmatrix.com/trac/ticket/2502

[#2630] XMPP stream error conditions incorrectly qualified. (opened by njoyce, closed by ralphm, fixed)
    defect          words      http://twistedmatrix.com/trac/ticket/2630

[#1042] Add blockingCallFromThread to twisted.internet.threads (opened by spiv, closed by therve, fixed)
    enhancement     core       http://twistedmatrix.com/trac/ticket/1042

[#2536] Deprecated TimeoutQueue so we can remove it (opened by exarkun, closed by therve, fixed)
    task            core       http://twistedmatrix.com/trac/ticket/2536

                    ===== Lowest =====
[#1724] twisted.web2.auth doesn't address multi-step authentication (opened by dreid, closed by dreid, invalid)
    defect          web2       http://twistedmatrix.com/trac/ticket/1724





From sipickles at hotmail.com  Sun Jun 10 03:43:48 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sun, 10 Jun 2007 10:43:48 +0100
Subject: [Twisted-Python] Asynchronicity
Message-ID: <BAY114-F2404A454C18EED33BB3E58BE1B0@phx.gbl>

Just to point out, iterate() does seem to run a loop of reactor, before
returning. No call to run() is required.

This is contrary to the API docs.

Why would iterate() be a dead end, jean?

Simon Pickles wrote:
>Wow! it works... iterate does indeed return. Must've had a small mistake
>before!
>
>I am amazed I solved my own problem for a change!
>
>Thanks for the advice, Jean
>
>Simon Pickles wrote:
>>Integrating into a GUI is just one example. In my case, I am using
>>Tkinter on win32. The GUI will be switched off when the server is
>>running, its simply a debug controller...
>>
>>I'm more interested in how a twisted server manages to perform any other
>>logic. For a game server, a fair amount of time needs to be devoted to
>>object and memory management, AI, database access etc
>>
>>My first server, in C++ could do this simply, with a winSock thread
>>listening and storing incoming network comms in a message queue. Easily
>>integrated into a game loop.
>>
>>I was tempted to move to python due to the ease of modification.
>>
>>So... with twisted, how can I manage to spend any time doing AI, for
>>instance?
>>
>>I thought twisted.interface.reactor.iterate() might be my answer. API
>>docs say about iterate:
>>
>>"Run the main loop's I/O polling function for a period of time. This is
>>most useful in applications where the UI is being drawn "as fast as
>>possible", such as games."
>>
>>Unfortunately, the next sentence seems a little contradictory....
>>
>>" The reactor must have been started (via the run() method) prior to any
>>invocations of this method. It must also be stopped manually after the
>>last call to this method (via the stop() method). "
>>
>>Now, I am only a beginner at twisted, but it looks to me if I called
>>run(), I won't have a chance to call iterate() cos twisted will have
>>gone into its mainloop and stolen all control!
>>
>>Am i making sense?
>>
>>Regards
>>
>>Simon
>>
>>
>>Jean-Paul Calderone wrote:
>>>On Sat, 09 Jun 2007 16:09:29 +0100, Simon Pickles <sipickles at hotmail.com> 
>>>wrote:
>>>>Hi,
>>>>
>>>>I have managed to get a simple server going. It seems to accept multiple
>>>>connections correctly.
>>>>
>>>>I am a little puzzled as to how to achieve an asynchonous application
>>>>using twisted. Twisted itself seems asynchronous, but my code is blocked
>>>>by the call:
>>>>
>>>>reactor.run()
>>>>
>>>
>>>Quite so.  reactor.run enters the Twisted mainloop and does not return
>>>until the mainloop is stopped (via reactor.stop).
>>>
>>>>Is there anyway I can return from the reactor to run other code, like
>>>>GUI stuff, or other processing?
>>>
>>>No, but you can call into your other code from Twisted event handlers or
>>>you can write a custom reactor which integrates an existing mainloop with
>>>Twisted's.  As far as GUIs go, Twisted already includes reactors which
>>>integrate glib, gtk, gtk2, various kinds of Windows loops, wxPython, and
>>>a few others.
>>>
>>>Precisely how you integrate two mainloops depends on various details
>>>about the loops in question.  Which GUI library are you trying to
>>>integrate with?
>>>
>>>Jean-Paul
>>>
>>>_______________________________________________
>>>Twisted-Python mailing list
>>>Twisted-Python at twistedmatrix.com
>>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>>
>>>
>>>
>>
>>_________________________________________________________________
>>The next generation of Hotmail is here! http://www.newhotmail.co.uk
>>
>>
>>_______________________________________________
>>Twisted-Python mailing list
>>Twisted-Python at twistedmatrix.com
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>>
>>
>
>_________________________________________________________________
>Play your part in making history - Email Britain! 
>http://www.emailbritain.co.uk/
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>

_________________________________________________________________
The next generation of Hotmail is here! http://www.newhotmail.co.uk




From sipickles at hotmail.com  Sun Jun 10 04:26:19 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sun, 10 Jun 2007 11:26:19 +0100
Subject: [Twisted-Python] Socket number
Message-ID: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>

Hello,

In my C++ game server, I used the socket number as the temporary ID of
the connected player. Is there anyway to retrieve the socket number of a
new player?

Atm, I am just using self.transport.getPeer().host, but this is only the
IP address, not socket.

Thanks

Simon

_________________________________________________________________
The next generation of Hotmail is here! http://www.newhotmail.co.uk/




From p.mayers at imperial.ac.uk  Sun Jun 10 06:04:58 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sun, 10 Jun 2007 13:04:58 +0100
Subject: [Twisted-Python] implementing an adbapi connectionpool idle timer
Message-ID: <466BE8EA.9040305@imperial.ac.uk>

All,

I'm using t.e.adbapi with psycopg against a Postgres 8 database. This 
database is replicated using Slony-I and I'm hitting this problem:

http://linuxfinances.info/info/faq.html#AEN45927

Basically, holding open SQL connections for a long time causes postgres 
to cache query plans; these cached plans need to be freed for Slony to 
rollover its internal SQL replication log table.

So I'd like to add something to ConnectionPool to disconnect unused 
connections after a certain time. Any suggestions how to start?

Also - looking at the ConnectionPool/Transaction code, it appears a 
ConnectionPool's "connections" dictionary is modified from multiple 
threads without locking. Is this safe?



From exarkun at divmod.com  Sun Jun 10 06:09:09 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 10 Jun 2007 08:09:09 -0400
Subject: [Twisted-Python] Asynchronicity
In-Reply-To: <BAY114-F2404A454C18EED33BB3E58BE1B0@phx.gbl>
Message-ID: <20070610120909.30678.479903900.divmod.quotient.13540@ohm>

On Sun, 10 Jun 2007 10:43:48 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Just to point out, iterate() does seem to run a loop of reactor, before
>returning. No call to run() is required.
>
>This is contrary to the API docs.

The API docs describe the supported behavior.  Implementation details may
allow other behavior to appear to work accidentally.

>
>Why would iterate() be a dead end, jean?
>

Generally speaking, none of the reactors are reentrant and driving them
stepwise with iterate() is not a feature which is seeing any interest by
maintainers these days.  This means that it may or may not work with each
reactor and there is little test coverage for it.

Jean-Paul



From exarkun at divmod.com  Sun Jun 10 06:10:36 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 10 Jun 2007 08:10:36 -0400
Subject: [Twisted-Python] Socket number
In-Reply-To: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
Message-ID: <20070610121036.30678.2039443683.divmod.quotient.13541@ohm>

On Sun, 10 Jun 2007 11:26:19 +0100, Simon Pickles <sipickles at hotmail.com> wrote:
>Hello,
>
>In my C++ game server, I used the socket number as the temporary ID of
>the connected player. Is there anyway to retrieve the socket number of a
>new player?
>
>Atm, I am just using self.transport.getPeer().host, but this is only the
>IP address, not socket.
>

Sockets may not have a file descriptor associated with them on all platforms.
It's trivial maintain a counter yourself and assign a small unique integer
to each client who connects.  Why not do that, instead?

Jean-Paul



From exarkun at divmod.com  Sun Jun 10 06:16:31 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 10 Jun 2007 08:16:31 -0400
Subject: [Twisted-Python] implementing an adbapi connectionpool idle timer
In-Reply-To: <466BE8EA.9040305@imperial.ac.uk>
Message-ID: <20070610121631.30678.477719577.divmod.quotient.13544@ohm>

On Sun, 10 Jun 2007 13:04:58 +0100, Phil Mayers <p.mayers at imperial.ac.uk> wrote:
>All,
>
>I'm using t.e.adbapi with psycopg against a Postgres 8 database. This 
>database is replicated using Slony-I and I'm hitting this problem:
>
>http://linuxfinances.info/info/faq.html#AEN45927
>
>Basically, holding open SQL connections for a long time causes postgres to 
>cache query plans; these cached plans need to be freed for Slony to rollover 
>its internal SQL replication log table.
>
>So I'd like to add something to ConnectionPool to disconnect unused 
>connections after a certain time. Any suggestions how to start?

Be prepared to spend a lot of time in the test suite.  adbapi's test coverage
isn't very unit-like and relies on being able to connect to a real SQL server
in most cases.

You can take a look at twisted.internet.task.Clock for a mechanism to write
a test which doesn't rely on system time.  You might want to create a fake
DB-API 2.0 module in order to test the code without relying on a real SQL
server.  With those things in place, you might be able to get some reasonable
test coverage, at which point it sounds like a straightforward enough feature
to add.

>
>Also - looking at the ConnectionPool/Transaction code, it appears a 
>ConnectionPool's "connections" dictionary is modified from multiple threads 
>without locking. Is this safe?
>

Python builtins are threadsafe.  So, maybe. ;)  As usual, it is always
possible there is a bug hiding there.  Feel free to point it out if you
notice anything in particular.

Jean-Paul



From derfel at alessandria.linux.it  Sun Jun 10 06:20:32 2007
From: derfel at alessandria.linux.it (Federico 'Derfel' Stella)
Date: Sun, 10 Jun 2007 14:20:32 +0200
Subject: [Twisted-Python] Socket number
In-Reply-To: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
References: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
Message-ID: <20070610122031.GA29863@lorien.arda>

* Sunday 10 June 2007, alle 11:26, Simon Pickles scrive:

> In my C++ game server, I used the socket number as the temporary ID of
> the connected player. Is there anyway to retrieve the socket number of a
> new player?

> Atm, I am just using self.transport.getPeer().host, but this is only the
> IP address, not socket.
self.transport.getHandle().fileno()

.getHandle() returns a normal socket object from which you could get socket
number.

Just for curiosity, are your players anonymous (e.g. not registered)?




From p.mayers at imperial.ac.uk  Sun Jun 10 06:32:41 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sun, 10 Jun 2007 13:32:41 +0100
Subject: [Twisted-Python] implementing an adbapi connectionpool idle timer
In-Reply-To: <20070610121631.30678.477719577.divmod.quotient.13544@ohm>
References: <20070610121631.30678.477719577.divmod.quotient.13544@ohm>
Message-ID: <466BEF69.3090109@imperial.ac.uk>

> Be prepared to spend a lot of time in the test suite.  adbapi's test 
> coverage
> isn't very unit-like and relies on being able to connect to a real SQL 
> server
> in most cases.

Oh. Joy.

>> Also - looking at the ConnectionPool/Transaction code, it appears a 
>> ConnectionPool's "connections" dictionary is modified from multiple 
>> threads without locking. Is this safe?
>>
> 
> Python builtins are threadsafe.  So, maybe. ;)  As usual, it is always

Ah. I was under the impression they were not, hence the disconnect.



From radix at twistedmatrix.com  Sun Jun 10 09:51:06 2007
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sun, 10 Jun 2007 11:51:06 -0400
Subject: [Twisted-Python] Socket number
In-Reply-To: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
References: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
Message-ID: <60ed19d40706100851h3f42239dvb21100139d974e92@mail.gmail.com>

On 6/10/07, Simon Pickles <sipickles at hotmail.com> wrote:
> Hello,
>
> In my C++ game server, I used the socket number as the temporary ID of
> the connected player. Is there anyway to retrieve the socket number of a
> new player?
>
> Atm, I am just using self.transport.getPeer().host, but this is only the
> IP address, not socket.

If you only need this identifier for use in the implementation of the
server, a much better way to identify players is by their Protocol
object. On the other hand, if you do need to pass this identifier over
the wire, then I agree with Jean-Paul that a small incremental or
random number would be good.

-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From brendoncolby at gmail.com  Sun Jun 10 11:10:50 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Sun, 10 Jun 2007 12:10:50 -0500
Subject: [Twisted-Python] Socket number
In-Reply-To: <60ed19d40706100851h3f42239dvb21100139d974e92@mail.gmail.com>
References: <BAY114-F3045C5AA37C99BF0D00907BE1B0@phx.gbl>
	<60ed19d40706100851h3f42239dvb21100139d974e92@mail.gmail.com>
Message-ID: <e64b001e0706101010h36033caep6a7c5dbedffd9d7f@mail.gmail.com>

On 6/10/07, Christopher Armstrong <radix at twistedmatrix.com> wrote:
>
> If you only need this identifier for use in the implementation of the
> server, a much better way to identify players is by their Protocol
> object. On the other hand, if you do need to pass this identifier over
> the wire, then I agree with Jean-Paul that a small incremental or
> random number would be good.

This is what I do:

usersByID = {} # userID:user object
idRange = range(1,1001) # Arbitrary limit...

def getNextUserID():
    return list(set(idRange) - set(usersByID))[0]

When a user connects, I get the next available ID. If usersByID looks like:

{1:User1, 2:User2, 5:User5}

The next ID returned will be 3. I do this so I can keep reusing my IDs
instead of infinitely incrementing them.



From sipickles at hotmail.com  Sun Jun 10 12:25:30 2007
From: sipickles at hotmail.com (Simon Pickles)
Date: Sun, 10 Jun 2007 19:25:30 +0100
Subject: [Twisted-Python] Still problems debugging with twisted...
Message-ID: <BAY114-F1138B2B3DB5E49D23938E3BE1B0@phx.gbl>

Hi,

I've still got my problem with zope and twisted:

[Dbg]>>>
Traceback (most recent call last):
  File "<string>", line 97, in run
  File "C:\Python25\lib\bdb.py", line 366, in run
    exec cmd in globals, locals
  File "F:\_Dev\twisted server 20070608\SERVER.py", line 7, in <module>
    import twistedServer
  File "F:\_Dev\twisted server 20070608\twistedServer.py", line 4, in
<module>
    from zope.interface import Interface
  File "C:\Python25\lib\site-packages\zope\interface\__init__.py", line
58, in <module>
    _wire()
  File "C:\Python25\lib\site-packages\zope\interface\interface.py", line
936, in _wire
    classImplements(Attribute, IAttribute)
  File "C:\Python25\lib\site-packages\zope\interface\declarations.py",
line 464, in classImplements
    spec = implementedBy(cls)
  File "C:\Python25\lib\site-packages\zope\interface\declarations.py",
line 330, in implementedByFallback
    if isinstance(spec, Implements):
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes
and types


Strangely, if I run the python module from file or python command window
it runs perfectly fine, no tracebacks. It only crashes like this when
run within PyScripter. Very annoying since thats my favourite IDE.

I've installed zope.interface-3.3.0.1-win32.egg from the python
cheeseshop using easy_install. No Change. Still can't debug.

Thanks for your help.

Simon

_________________________________________________________________
Play your part in making history - Email Britain! 
http://www.emailbritain.co.uk/




From p.mayers at imperial.ac.uk  Sun Jun 10 15:59:58 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sun, 10 Jun 2007 22:59:58 +0100
Subject: [Twisted-Python] Still problems debugging with twisted...
In-Reply-To: <BAY114-F1138B2B3DB5E49D23938E3BE1B0@phx.gbl>
References: <BAY114-F1138B2B3DB5E49D23938E3BE1B0@phx.gbl>
Message-ID: <466C745E.4020604@imperial.ac.uk>

> 
> Strangely, if I run the python module from file or python command window
> it runs perfectly fine, no tracebacks. It only crashes like this when
> run within PyScripter. Very annoying since thats my favourite IDE.

Well then logically it's a PyScripter issue. You should ask on that 
mailing list.



From jml at mumak.net  Mon Jun 11 18:04:01 2007
From: jml at mumak.net (Jonathan Lange)
Date: Tue, 12 Jun 2007 10:04:01 +1000
Subject: [Twisted-Python] Mailing list or RSS feed of trunk commits?
Message-ID: <d06a5cd30706111704k32daeccftb496e9fb09397d5c@mail.gmail.com>

Hello all,

Is there a mailing list or RSS feed of commits to trunk? If so, how do
I get at it?

Thanks,
jml



From andrew-twisted at puzzling.org  Mon Jun 11 19:20:46 2007
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue, 12 Jun 2007 11:20:46 +1000
Subject: [Twisted-Python] Mailing list or RSS feed of trunk commits?
In-Reply-To: <d06a5cd30706111704k32daeccftb496e9fb09397d5c@mail.gmail.com>
References: <d06a5cd30706111704k32daeccftb496e9fb09397d5c@mail.gmail.com>
Message-ID: <20070612012046.GA10087@steerpike.home.puzzling.org>

Jonathan Lange wrote:
> Hello all,
> 
> Is there a mailing list or RSS feed of commits to trunk? If so, how do
> I get at it?

Both ;)

  * http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-commits
  * http://twistedmatrix.com/trac/timeline?changeset=on&max=50&daysback=90&format=rss

There's even:

  * https://code.launchpad.net/~vcs-imports/twisted/main/+subscribe

Personally, I use the mailing list.  Probably that's because it was there first.
(You also get non-trunk commits, but it wouldn't be too hard to ignore them with
procmail if you wished).

-Andrew.




From amauryfa at gmail.com  Tue Jun 12 01:47:51 2007
From: amauryfa at gmail.com (Amaury Forgeot d'Arc)
Date: Tue, 12 Jun 2007 09:47:51 +0200
Subject: [Twisted-Python] C++ port of Twisted
Message-ID: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>

Hello,

I love python and I find twisted fantastic, but here I have to write a
C++ application, for performance pseudo-reasons :-(

I was looking for a Twisted-like framework in C++.
Do you know if such a library exists?

ACE seems to provide powerful tools for networking, but I could not
find something like Protocols and Deferred.

Or is the twisted approach not recommended for C++?

-- 
Amaury Forgeot d'Arc



From maarten at treewalker.org  Tue Jun 12 02:33:23 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Tue, 12 Jun 2007 10:33:23 +0200
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
Message-ID: <200706121033.28874.maarten@treewalker.org>

On Tuesday 12 June 2007, Amaury Forgeot d'Arc wrote:

> I love python and I find twisted fantastic, but here I have to write a
> C++ application, for performance pseudo-reasons :-(

It's not an option to write part of the application in C++ and part in Python?

> I was looking for a Twisted-like framework in C++.
> Do you know if such a library exists?

Qt is the closest thing I've seen, in the sense that it offers an asynchronous 
API for networking. In the signal-slot mechanism for callbacks, you connect 
two objects semi-permanently, unlike a Deferred which is used just once. If 
the way you handle events is mostly static, it is not a problem.

Qt is modular since 4.0, so you could use the network part without the GUI 
part. But unlike Twisted, it doesn't come with implementations for all 
popular network protocols. For the client side, KIO from KDE supports many 
protocols, for the server side you'd probably have to write it yourself.

Bye,
		Maarten
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20070612/f0c7702b/attachment.sig>

From littlesweetmelon at gmail.com  Tue Jun 12 03:43:20 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Tue, 12 Jun 2007 17:43:20 +0800
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <200706121033.28874.maarten@treewalker.org>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
Message-ID: <cdb837ea0706120243r607a6001p88a9dec957844b62@mail.gmail.com>

> > I love python and I find twisted fantastic, but here I have to write a
> > C++ application, for performance pseudo-reasons :-(
>
> It's not an option to write part of the application in C++ and part in Python?

Well, I don't think performance is the issue to rewrite twisted into
C/C++ code. The burden given by python/twisted is very low, because
twisted is much like a framework rather than computational-intensive
library. For high performance, you'd better write most of your code in
C++, and compiled into pyd extension module. Then you can use twisted
to "glue" the good framework and your high performance code.

---
ShenLei



From amauryfa at gmail.com  Tue Jun 12 03:58:12 2007
From: amauryfa at gmail.com (Amaury Forgeot d'Arc)
Date: Tue, 12 Jun 2007 11:58:12 +0200
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <200706121033.28874.maarten@treewalker.org>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
Message-ID: <e27efe130706120258w6b815f53w5e8b02c44527ae0f@mail.gmail.com>

Hello Maarten,

2007/6/12, Maarten ter Huurne wrote:
> On Tuesday 12 June 2007, Amaury Forgeot d'Arc wrote:
>
> > I love python and I find twisted fantastic, but here I have to write a
> > C++ application, for performance pseudo-reasons :-(
>
> It's not an option to write part of the application in C++ and part in Python?

Not yet. Maybe in a few years...

> > I was looking for a Twisted-like framework in C++.
> > Do you know if such a library exists?
>
> Qt is the closest thing I've seen, in the sense that it offers an asynchronous
> API for networking. In the signal-slot mechanism for callbacks, you connect
> two objects semi-permanently, unlike a Deferred which is used just once.

Interesting, a bit like event binding in wxWidgets.

> If the way you handle events is mostly static, it is not a problem.

But it's not really the case. Events may have the same type, but are
needed in different places when the protocol state changes. Deferreds
fit well in this case.

> Qt is modular since 4.0, so you could use the network part without the GUI
> part. But unlike Twisted, it doesn't come with implementations for all
> popular network protocols. For the client side, KIO from KDE supports many
> protocols, for the server side you'd probably have to write it yourself.

Well, both Qt and kio provide basic socket wrappers, but their
protocol frameworks seem completely geared toward filesystems or URLs.

I will use the financial FIX protocol. I am looking for a way to
implement new protocols.

Actually I already developed a bunch of classes that mimic part of the
twisted framework:
Deferreds, Protocols, Connectors, and a Reactor which provides
TcpTransport and callLater().
The reactor implementation is based on Windows MFC classes (and a
reactor based on select is under development)
It's far from complete, but it seems to work.

If someone is interested, I can try to clean up the code and share it...

-- 
Amaury Forgeot d'Arc



From amauryfa at gmail.com  Tue Jun 12 05:38:02 2007
From: amauryfa at gmail.com (Amaury Forgeot d'Arc)
Date: Tue, 12 Jun 2007 13:38:02 +0200
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <cdb837ea0706120243r607a6001p88a9dec957844b62@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
	<cdb837ea0706120243r607a6001p88a9dec957844b62@mail.gmail.com>
Message-ID: <e27efe130706120438o6f8d6fbakded55a51f97e34d8@mail.gmail.com>

Hello,

2007/6/12, 甜瓜 wrote:
> > > I love python and I find twisted fantastic, but here I have to write a
> > > C++ application, for performance pseudo-reasons :-(
> >
> > It's not an option to write part of the application in C++ and part in Python?
>
> Well, I don't think performance is the issue to rewrite twisted into
> C/C++ code. The burden given by python/twisted is very low, because
> twisted is much like a framework rather than computational-intensive
> library. For high performance, you'd better write most of your code in
> C++, and compiled into pyd extension module. Then you can use twisted
> to "glue" the good framework and your high performance code.

The problem is that I cannot use python yet:
The application already exists, and is a big Windows MFC project in C++.

I am trying to use the Twisted approach in a C++ application.
And so far it works... I just would like to know whether I am
reinventing the wheel.

-- 
Amaury Forgeot d'Arc



From arnarbi at gmail.com  Tue Jun 12 06:06:40 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Tue, 12 Jun 2007 12:06:40 +0000
Subject: [Twisted-Python] Flash AMF and Twisted
Message-ID: <28012bc60706120506t44ef5e0dx4697b5863b2c746a@mail.gmail.com>

Hi all,

Re. this message:
http://twistedmatrix.com/pipermail/twisted-python/2007-May/015373.html

Has any work been done here? I'm facing a project that requires
two-way communication between a Flex/Apollo app and a Twisted server.
In my initial tests I used http and comet-like techniques but I'm not
sure they are the most efficient way.

I'm willing to help with the project - I've already dabbled a little
in the DjangoAMF stuff.

Arnar



From glyph at divmod.com  Tue Jun 12 07:04:34 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 12 Jun 2007 13:04:34 -0000
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <e27efe130706120438o6f8d6fbakded55a51f97e34d8@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
	<cdb837ea0706120243r607a6001p88a9dec957844b62@mail.gmail.com>
	<e27efe130706120438o6f8d6fbakded55a51f97e34d8@mail.gmail.com>
Message-ID: <20070612130434.20416.1994396054.divmod.xquotient.28@joule.divmod.com>

On 11:38 am, amauryfa at gmail.com wrote:
>The problem is that I cannot use python yet:
>The application already exists, and is a big Windows MFC project in 
>C++.
>
>I am trying to use the Twisted approach in a C++ application.
>And so far it works... I just would like to know whether I am
>reinventing the wheel.

One of the original inspirations for Twisted was a C++ library, the 
ADAPTIVE Communication Environment: 
http://www.cs.wustl.edu/~schmidt/ACE.html - I believe it has been ported 
to Windows, among other platforms.

Good luck.  I do not envy you having to write C++ at this level :).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070612/8beb7c66/attachment.html>

From rodrigo at 1bit.com.br  Tue Jun 12 07:22:37 2007
From: rodrigo at 1bit.com.br (Rodrigo Strauss)
Date: Tue, 12 Jun 2007 10:22:37 -0300
Subject: [Twisted-Python] C++ port of Twisted
Message-ID: <a684d0100706120622w3d1da826vd91bb931ce0f86e7@mail.gmail.com>

Have tou tried Boost Asio?

http://asio.sourceforge.net/

Rodrigo Strauss



From johann.borck at densedata.com  Tue Jun 12 09:36:32 2007
From: johann.borck at densedata.com (Johann Borck)
Date: Tue, 12 Jun 2007 15:36:32 +0000
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
Message-ID: <466EBD80.9020602@densedata.com>

Amaury Forgeot d'Arc wrote:
> Hello,
>
> I love python and I find twisted fantastic, but here I have to write a
> C++ application, for performance pseudo-reasons :-(
>
> I was looking for a Twisted-like framework in C++.
> Do you know if such a library exists?
>
> ACE seems to provide powerful tools for networking, but I could not
> find something like Protocols and Deferred.
>
> Or is the twisted approach not recommended for C++?
>
If C++ is required, take a look at TProactor (terabit.com.au), which is
an improved implementation of the Proactor-pattern for the ACE-framework
(you need ACE and TProactor). the version of proactor that comes with
ACE is not recommended for production by ACE-people themselves
(according to the mailing list). In the tests TProactor has some code
that shows how you can get very close to what's called Protocol in
Twisted. But even the basic Proactor-framework gives you the
'ACE/TRB_ServiceHandler' class, which does basically the same as
'Protocol'. The ACE-pendant to Deferreds are called Futures in ACE.

>2007/6/12, Maarten ter Huurne wrote:
>>It's not an option to write part of the application in C++ and part in
Python?

>Not yet. Maybe in a few years...

I'd recommend to think about that a bit, if the decision is upon you ;)

Johann



From bv at bnl.gov  Tue Jun 12 11:31:32 2007
From: bv at bnl.gov (Brett Viren)
Date: Tue, 12 Jun 2007 13:31:32 -0400
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <200706121033.28874.maarten@treewalker.org> (Maarten ter Huurne's
	message of "Tue, 12 Jun 2007 10:33:23 +0200")
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<200706121033.28874.maarten@treewalker.org>
Message-ID: <ir4ejkhf5aj.fsf@lycastus.phy.bnl.gov>

Maarten ter Huurne <maarten at treewalker.org> writes:

> Qt is the closest thing I've seen, in the sense that it offers an asynchronous 
> API for networking. In the signal-slot mechanism for callbacks, you connect 
> two objects semi-permanently, unlike a Deferred which is used just once. If 
> the way you handle events is mostly static, it is not a problem.

For signal-slot idiom, also compare to libsigc++ as well as Boost.

-Brett.



From michele.petrazzo at unipex.it  Wed Jun 13 12:21:10 2007
From: michele.petrazzo at unipex.it (Michele Petrazzo - Unipex srl)
Date: Wed, 13 Jun 2007 20:21:10 +0200
Subject: [Twisted-Python] reactor and thread
Message-ID: <46703596.8000305@unipex.it>

Hi all,
I have a project where I writing the "server" (on win xp) and I want to
communicate with a client, so twisted it's all I need.
Into the "server" I have also a python bind to a dll (with ctypes) and I
see strange problems (windows crashes) when I call a dll function inside
a thread. My thread it's a twisted "Protocol".
My question is: it is possible to call the function from/to a specific
thread? So somethink like:

class MyDll:
  def funct(self, callBack):
    #do the work
    reactor.call_in_main_thrad(callBack)


tid = create_a_thread_and_load_MyDll() # where I make the dll instance
and all the work need into a thread

#into a someone function into the main thread

def callBack():
  # a simple callback

reactor.callIntoThread(tid, funct, callBack)

Is this possible with twisted? (Does I'm dreaming?)

P.s. If I try with the wx "reactor" (so wx.MainLoop), I see no problem!
In that case, I instance the dll into the class __init__ (inherit from
wx.Frame) and into a someone event (i.e. Button click) I call a dll
funct and all work without crash...

Thanks,
Michele
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3273 bytes
Desc: S/MIME Cryptographic Signature
URL: </pipermail/twisted-python/attachments/20070613/cc93ce9c/attachment-0002.bin>

From gabor.bernath at gmail.com  Wed Jun 13 13:01:37 2007
From: gabor.bernath at gmail.com (=?ISO-8859-1?Q?G=E1bor_Bern=E1th?=)
Date: Wed, 13 Jun 2007 20:01:37 +0100
Subject: [Twisted-Python] reactor and thread
In-Reply-To: <46703596.8000305@unipex.it>
References: <46703596.8000305@unipex.it>
Message-ID: <ff49a2640706131201m2ea0118fk57382de5fe70d5f5@mail.gmail.com>

Hi Michele,

> My question is: it is possible to call the function from/to a specific
> thread?

you could use deferToThread() to run a task in a separate thread and
get the results in the main thread.

here are the docs:
http://twistedmatrix.com/documents/current/api/twisted.internet.threads.html#deferToThread

here is a small example which asks for user input in a separate thread:

--------
from twisted.internet import reactor, defer, threads

def input():
    return threads.deferToThread(blocking_task)

def blocking_task():
    print "working... enter something to end task"
    return raw_input()

def got_result(data):
    print "the long-running task results in:", data
    reactor.stop()

input().addCallback(got_result)
reactor.run()
--------

is this what you want to do?



On 6/13/07, Michele Petrazzo - Unipex srl <michele.petrazzo at unipex.it> wrote:
> Hi all,
> I have a project where I writing the "server" (on win xp) and I want to
> communicate with a client, so twisted it's all I need.
> Into the "server" I have also a python bind to a dll (with ctypes) and I
> see strange problems (windows crashes) when I call a dll function inside
> a thread. My thread it's a twisted "Protocol".
> My question is: it is possible to call the function from/to a specific
> thread? So somethink like:
>
> class MyDll:
>   def funct(self, callBack):
>     #do the work
>     reactor.call_in_main_thrad(callBack)
>
>
> tid = create_a_thread_and_load_MyDll() # where I make the dll instance
> and all the work need into a thread
>
> #into a someone function into the main thread
>
> def callBack():
>   # a simple callback
>
> reactor.callIntoThread(tid, funct, callBack)
>
> Is this possible with twisted? (Does I'm dreaming?)
>
> P.s. If I try with the wx "reactor" (so wx.MainLoop), I see no problem!
> In that case, I instance the dll into the class __init__ (inherit from
> wx.Frame) and into a someone event (i.e. Button click) I call a dll
> funct and all work without crash...
>
> Thanks,
> Michele
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>



From glyph at divmod.com  Wed Jun 13 20:05:06 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 14 Jun 2007 02:05:06 -0000
Subject: [Twisted-Python] reactor and thread
In-Reply-To: <46703596.8000305@unipex.it>
References: <46703596.8000305@unipex.it>
Message-ID: <20070614020506.20416.154231059.divmod.xquotient.169@joule.divmod.com>


G�bor Bern�th already answered your question, but I'd like to answer as 
specifically as possible for future readers who may discover this 
message.

On 13 Jun, 06:21 pm, michele.petrazzo at unipex.it wrote:
>    reactor.call_in_main_thrad(callBack)

This is spelled:

    reactor.callFromThread(callBack)
>reactor.callIntoThread(tid, funct, callBack)

This is spelled:

    from twisted.internet.threads import deferToThread
    deferToThread(funct).addCallback(callBack)
>Is this possible with twisted? (Does I'm dreaming?)

This, and many other fun features of the reactor, can be discovered by 
reading the twisted.internet interface documentation, available here:

http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.html

You can read more specifically about threads here:

http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorThreads.html

I hope this proves useful to you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070614/f58f6599/attachment.html>

From waterinfire at hotmail.com  Wed Jun 13 20:11:54 2007
From: waterinfire at hotmail.com (weiwei weiwei)
Date: Thu, 14 Jun 2007 10:11:54 +0800
Subject: [Twisted-Python] twisted and performance
Message-ID: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>

Hi,all!



         Thanks for the python twisted,it is a great software.



         I am from china. This days we use twisted to develop a middleware.



         Requirement is:

1)       Receive:  receive 100~200 different client��s message(they all 
connect to our listen socket) and insert it into database(oracle)

2)       Send: application insert message into db,then our middleware select 
message from database and send this message to its destination through 
socket.



Our design is : reactor + adbapi.ConnectionPool

1)       reactor is used in receiveing and sending message from and to 
socket.

2)       when we received a message,we use adbapi to insert it to db

3)       we use adbapi to select message from db,and use a Deferred to 
notify us when we got a message from db,and send it to peer,after receiving 
the peer��s acknowledge message ,we update the databse.



After testing many times,we found when the connection number is less than 
20,its performance is very good.But if the connection number is more than 30 
or 50, it is performance is worse and worse.



DO you give me some advice about the design?





Thanks in advance.





Wei wei

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/




From littlesweetmelon at gmail.com  Thu Jun 14 03:03:32 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Thu, 14 Jun 2007 17:03:32 +0800
Subject: [Twisted-Python] What is the best way to implement "need more data"
	semantics?
Message-ID: <cdb837ea0706140203g1c8a5995h7256d376746e3c7@mail.gmail.com>

My goal is writing a specific protocol. The data transfered between
client and server are mixed with text and binary. I override the
method dataReceived. When it get some new data, it will call a certain
parseFunc according to the current state of the protocol, such as:
Step 1: dataReceived will call parseGreetingMessage(), and then call
ReplyGreetingMessage()
Step 2: dataReceived will call parseHandShaking(), and then call
ReplyHandShaking()
Step 3: dataReceived will call parseSecurity(), and then call ReplySecurity()
....

However, in some cases, the data received from the server is not
completely fetched by the client, so the data passed to parseFunc will
be treated as incomplete, and parseFunc will try to return and wait
for more data. Currently, my code for doing this seems very ulgy ^_^.
Could you please give me some suggestions to make the implementation
of the "need more data" semantics more clearly and more easily?

The problem is that the message boundary in my protocol is not as
simple as LineReceiver. Each step, I should use different parse to
determine whether I get the whole data. For example:
parseErrorString: The data compose an leading 4byte integer size plus
following string characters. If the length of collected data is
shorter than (4 + size of string), it will be treated as incomplete.
parseBitmap: The data compose a bitmap header and following bitmap
data. If the length of collected data is shorter than (sizeof(header)
+ headerwidth*header.height*bits_per_pixel), it will be treated as
incomplete.

My method is:
parseFunc parses the data while testing the completeness. If
incomplete occrred, parseFunct return. When new data arrived, the
dataReceived method will call parseFunc again, and "re-parse" the
previous data as well as new data. However, sometimes, re-parse is
time consuming. I want to find a way to hold the result for
already-parsed data. Maybe it will be similar to "generator":

# In class MyProtocol(protocol.Protocol):  pseudo-code
def parseFunc(...):
    # parse header ...
    if not completeness:
        yield   # need more data, go into data waiting state.
    # If new data arrived, dataReceived will be called, and then
    # call parseFunc again to continue parsing.
    # parse following data...
    if not completeness:
        yield   # need more data
    ....

def dataReceived(s):
    self.data += s
    self.parseFunc()

---
ShenLei



From adelagon at gmail.com  Thu Jun 14 04:21:02 2007
From: adelagon at gmail.com (Alvin Delagon)
Date: Thu, 14 Jun 2007 06:21:02 -0400
Subject: [Twisted-Python] twisted and performance
In-Reply-To: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
References: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
Message-ID: <7a01f6c00706140321w72e9023esf89a28e1c9363b6@mail.gmail.com>

Hi! This is my first advice for twisted-python list I hope I get this right.

I don't know much about adbapi but you might to check if your database is
causing the bottleneck. Also, what reactor are you using? You might want to
configure your twisted application to use the epoll reactor. We have a
server here using epoll and believe me this thing is wonderful. ^_^


On 6/13/07, weiwei weiwei <waterinfire at hotmail.com> wrote:
>
> Hi,all!
>
>
>
>          Thanks for the python twisted,it is a great software.
>
>
>
>          I am from china. This days we use twisted to develop a
> middleware.
>
>
>
>          Requirement is:
>
> 1)       Receive:  receive 100~200 different client¡¯s message(they all
> connect to our listen socket) and insert it into database(oracle)
>
> 2)       Send: application insert message into db,then our middleware
> select
> message from database and send this message to its destination through
> socket.
>
>
>
> Our design is : reactor + adbapi.ConnectionPool
>
> 1)       reactor is used in receiveing and sending message from and to
> socket.
>
> 2)       when we received a message,we use adbapi to insert it to db
>
> 3)       we use adbapi to select message from db,and use a Deferred to
> notify us when we got a message from db,and send it to peer,after
> receiving
> the peer¡¯s acknowledge message ,we update the databse.
>
>
>
> After testing many times,we found when the connection number is less than
> 20,its performance is very good.But if the connection number is more than
> 30
> or 50, it is performance is worse and worse.
>
>
>
> DO you give me some advice about the design?
>
>
>
>
>
> Thanks in advance.
>
>
>
>
>
> Wei wei
>
> _________________________________________________________________
> Express yourself instantly with MSN Messenger! Download today it's FREE!
> http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070614/a71e73d5/attachment.html>

From vovic at nfi.kiae.ru  Thu Jun 14 10:51:05 2007
From: vovic at nfi.kiae.ru (Voznesensky Vladimir)
Date: Thu, 14 Jun 2007 20:51:05 +0400
Subject: [Twisted-Python] SSL: wrong version number
Message-ID: <web-2617171@newmail.nfi.kiae.ru>

Hello.

I'm trying to write a twisted client for MyProxy server.
This grid service uses TLS.
When using blocking calls, everything is ok.
When trying to estabilish a twisted connection
using reactor.connectSSL(host, port, f, contextFactory)
with _the_same_ context in contextFactory, the error 
occures:

[Failure instance: Traceback (failure with no frames): 
<class 'OpenSSL.SSL.Error'>: [('SSL routines', 
'SSL3_GET_RECORD', 'wrong version number')]

You can do it yourself by simply connecting to 
myproxy.cern.ch:7512

Is there anybody aware of such problem?

Thanks,
VV



From exarkun at divmod.com  Thu Jun 14 13:08:06 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 14 Jun 2007 15:08:06 -0400
Subject: [Twisted-Python] SSL: wrong version number
In-Reply-To: <web-2617171@newmail.nfi.kiae.ru>
Message-ID: <20070614190806.4947.693433960.divmod.quotient.1672@ohm>

On Thu, 14 Jun 2007 20:51:05 +0400, Voznesensky Vladimir <vovic at nfi.kiae.ru> wrote:
>Hello.
>
>I'm trying to write a twisted client for MyProxy server.
>This grid service uses TLS.
>When using blocking calls, everything is ok.
>When trying to estabilish a twisted connection
>using reactor.connectSSL(host, port, f, contextFactory)
>with _the_same_ context in contextFactory, the error occures:
>
>[Failure instance: Traceback (failure with no frames): <class 
>'OpenSSL.SSL.Error'>: [('SSL routines', 'SSL3_GET_RECORD', 'wrong version 
>number')]
>
>You can do it yourself by simply connecting to myproxy.cern.ch:7512
>
>Is there anybody aware of such problem?

The server is using SSLv2.  The traceback seems to indicate the context is
set up for SSLv3.  I can't tell how you created that context object, nor am
I certain why one version of your code can establish a connection while the
other cannot, but I would check the context object and make sure it is using
either SSLv2 or SSLv23.

Jean-Paul



From exarkun at divmod.com  Thu Jun 14 13:22:20 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 14 Jun 2007 15:22:20 -0400
Subject: [Twisted-Python] SSL: wrong version number
In-Reply-To: <20070614190806.4947.693433960.divmod.quotient.1672@ohm>
Message-ID: <20070614192220.4947.817733265.divmod.quotient.1679@ohm>

On Thu, 14 Jun 2007 15:08:06 -0400, Jean-Paul Calderone <exarkun at divmod.com> wrote:
>On Thu, 14 Jun 2007 20:51:05 +0400, Voznesensky Vladimir <vovic at nfi.kiae.ru> 
>wrote:
>>Hello.
>>
>>I'm trying to write a twisted client for MyProxy server.
>>This grid service uses TLS.
>>When using blocking calls, everything is ok.
>>When trying to estabilish a twisted connection
>>using reactor.connectSSL(host, port, f, contextFactory)
>>with _the_same_ context in contextFactory, the error occures:
>>
>>[Failure instance: Traceback (failure with no frames): <class 
>>'OpenSSL.SSL.Error'>: [('SSL routines', 'SSL3_GET_RECORD', 'wrong version 
>>number')]
>>
>>You can do it yourself by simply connecting to myproxy.cern.ch:7512
>>
>>Is there anybody aware of such problem?
>
>The server is using SSLv2.  The traceback seems to indicate the context is
>set up for SSLv3.  I can't tell how you created that context object, nor am
>I certain why one version of your code can establish a connection while the
>other cannot, but I would check the context object and make sure it is using
>either SSLv2 or SSLv23.
>

Oh, I should also say that SSLv2 is insecure and, if you can, you should
really change that server to use at least SSLv3.

Jean-Paul



From twisted-python at 2xlp.com  Thu Jun 14 13:29:08 2007
From: twisted-python at 2xlp.com (Jonathan Vanasco)
Date: Thu, 14 Jun 2007 15:29:08 -0400
Subject: [Twisted-Python] caching suggestions
Message-ID: <BB643192-5115-4E2E-BB8D-C2D602B8E466@2xlp.com>

note: this is less about twisted than a project i've built on twisted  
that is having some issues.  everyone here is smart, so i thought  
this would be a good list to ask on.

i've got a small twisted daemon that is working as a proxy for  
hosting content that we store on amazon-s3
long story short: archive to s3 (redundancy, cheap storage), twisted  
daemon on our network fetches to cache & serve.  we have cheaper  
bandwidth, plus do a lot of file monitoring / name abstraction that  
amazon's network won't support.  currently there are 10k documents on  
s3, which are accessible via 150k+ 'keys'.   the cache basiscally  
proxies the right doc for each key

I'm running into 2 issues with it:
	short term- keys are mapped to s3 files via a ton of 'hints' that i  
store in bdb after fetching from postgresql.  the hints need to be  
refreshed every 1-5 minutes or so.  does anyone have a good  
suggestion on how to do that?  i could do this really easily with  
sqlite, but i need to use bdb -- as sqlite isn't nearly fast enough;  
while bdb is.

	long term-    everything is fine for now -- we only have about 3gb  
of data.  but thats going to be growing to about 20gb soon, and we  
want to limit the cache to an active 10gb using an Adaptive  
Replacement Cache algorithm with a bdb datastore.  has anyone done  
something similar in twisted or python in general?

any input would be appreciated.  thanks!

// Jonathan Vanasco

| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|   CEO/Founder SyndiClick Networks
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|      FindMeOn.com - The cure for Multiple Web Personality Disorder
|      Web Identity Management and 3D Social Networking
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|      RoadSound.com - Tools For Bands, Stuff For Fans
|      Collaborative Online Management And Syndication Tools
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -





From christian.simms at gmail.com  Thu Jun 14 13:33:11 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Thu, 14 Jun 2007 15:33:11 -0400
Subject: [Twisted-Python] twisted and performance
In-Reply-To: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
References: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
Message-ID: <cd8fa6f90706141233r409dd47bnf765d722403af518@mail.gmail.com>

On 6/13/07, weiwei weiwei <waterinfire at hotmail.com> wrote:
>
> Hi,all!
>
>
>
>          Thanks for the python twisted,it is a great software.
>
>
>
>          I am from china. This days we use twisted to develop a
> middleware.
>
>
>
>          Requirement is:
>
> 1)       Receive:  receive 100~200 different client¡¯s message(they all
> connect to our listen socket) and insert it into database(oracle)
>
> 2)       Send: application insert message into db,then our middleware
> select
> message from database and send this message to its destination through
> socket.
>
>
>
> Our design is : reactor + adbapi.ConnectionPool
>
> 1)       reactor is used in receiveing and sending message from and to
> socket.
>
> 2)       when we received a message,we use adbapi to insert it to db
>
> 3)       we use adbapi to select message from db,and use a Deferred to
> notify us when we got a message from db,and send it to peer,after
> receiving
> the peer¡¯s acknowledge message ,we update the databse.
>
>
>
> After testing many times,we found when the connection number is less than
> 20,its performance is very good.But if the connection number is more than
> 30
> or 50, it is performance is worse and worse.
>
>
>
> DO you give me some advice about the design?
>
>
>
>
>
> Thanks in advance.
>
>
>
>
>
> Wei wei
>
> _________________________________________________________________
> Express yourself instantly with MSN Messenger! Download today it's FREE!
> http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>


If I had to guess, I would guess you're having database performance issues.
The overhead of TCP/IP networking of 50, or even 500 simultaneous
connections is nothing compared to the overhead of that many simultaneous
interactions with a database.  You can figure this out by doing some
experiments, like:

- run your test with a fake database which just uses an in-memory database
-- if still slow then problem is in your networking, if fast then problem is
in database

- if that's too difficult, another experiment would be to write some test
code to run a number of simultaneous database interactions without any
networking

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070614/738ee607/attachment.html>

From brucecoram at clara.co.uk  Thu Jun 14 13:42:47 2007
From: brucecoram at clara.co.uk (Bruce Coram)
Date: Thu, 14 Jun 2007 20:42:47 +0100
Subject: [Twisted-Python] udp
Message-ID: <46719A37.1060504@clara.co.uk>

How do you send data using udp?

I want to use udp to send messages from clients to a server.  I don't
want to use connected udp.

Can anyone supply some specimen code for me

Thanks

Bruce Coram





From exarkun at divmod.com  Thu Jun 14 13:43:57 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 14 Jun 2007 15:43:57 -0400
Subject: [Twisted-Python] caching suggestions
In-Reply-To: <BB643192-5115-4E2E-BB8D-C2D602B8E466@2xlp.com>
Message-ID: <20070614194357.4947.13735448.divmod.quotient.1692@ohm>

On Thu, 14 Jun 2007 15:29:08 -0400, Jonathan Vanasco <twisted-python at 2xlp.com> wrote:
>note: this is less about twisted than a project i've built on twisted  that 
>is having some issues.  everyone here is smart, so i thought  this would be 
>a good list to ask on.
>
>i've got a small twisted daemon that is working as a proxy for  hosting 
>content that we store on amazon-s3
>long story short: archive to s3 (redundancy, cheap storage), twisted  daemon 
>on our network fetches to cache & serve.  we have cheaper  bandwidth, plus 
>do a lot of file monitoring / name abstraction that  amazon's network won't 
>support.  currently there are 10k documents on  s3, which are accessible via 
>150k+ 'keys'.   the cache basiscally  proxies the right doc for each key
>
>I'm running into 2 issues with it:
>         short term- keys are mapped to s3 files via a ton of 'hints' that i 
>store in bdb after fetching from postgresql.  the hints need to be 
>refreshed every 1-5 minutes or so.  does anyone have a good  suggestion on 
>how to do that?  i could do this really easily with  sqlite, but i need to 
>use bdb -- as sqlite isn't nearly fast enough;  while bdb is.
>
>         long term-    everything is fine for now -- we only have about 3gb 
>of data.  but thats going to be growing to about 20gb soon, and we  want to 
>limit the cache to an active 10gb using an Adaptive  Replacement Cache 
>algorithm with a bdb datastore.  has anyone done  something similar in 
>twisted or python in general?
>
>any input would be appreciated.  thanks!

Sounds like an interesting project.  With regards to bdb, in my experience
the Python bindings are very flaky, and the bdb API isn't very friendly in
the first place.  It is probably possible to write something that works on
bdb with Python, but it's pretty hard.  bdb does handle that scale well enough
though - I have a Twisted-based server running against a 21GB bdb database
at the moment (although we're trying to phase it out in favor of something
based on SQLite ;P).

Jean-Paul



From francisco.herrero at gmail.com  Thu Jun 14 13:51:34 2007
From: francisco.herrero at gmail.com (Francisco Herrero)
Date: Thu, 14 Jun 2007 16:51:34 -0300
Subject: [Twisted-Python] About transport.
Message-ID: <ccac7d280706141251p132bc6a3j7219d927fa5414af@mail.gmail.com>

Hello community. At first excuse me for my poor english, I'm from Argentina.


I am building a abstraction layer for different protocols of communication
for microcontrolled components simulation on a PC. That is CAN, Mil-1553 and
RS422.
First I m building a model width serial port. The idea is to connect via tcp
to this channel. I choose as a model the class internet.serialport. This
works fine but I do not know how to redirect the protocol of serialport to
the protocol of TCP port:

-----------------------
from rs232 import RS232Connector
from twisted.internet import reactor, protocol
from twisted.application import service, internet

class RS232Channel(protocol.Protocol):
    def dataReceived(self, data):
        print "CHAN:" + data
        self.factory.port.transport.write(data)

class RS232Port(protocol.Protocol):
    def dataReceived(self, data):
        print "PORT:" + data
        self.factory.channel.protocol.transport.write(data)

class RS232Factory(protocol.Factory):
    protocol = RS232Port

    def __init__(self):
        conf = {}
        self.port = RS232Port()
        self.channel = RS232Connector(self.port, conf, reactor)

if __name__ == '__main__':
    factory = RS232Factory()
    reactor.listenTCP(5001, factory)
    reactor.run()
--------------
this works fine when data is received from the tcp port, but when come data
from the serial port the program can't find the factory for RS232Channel
protocol instance. That is logical. I try to switch the transport but I
can't go so far...
Anyone can tell me how to connect this 2 protocols

Thanks

Francisco

-- 
"El hombre se descubre cuando se mide con un obstáculo"
(Saint Exupéry)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070614/b01589ae/attachment.html>

From zmola at acm.org  Thu Jun 14 13:54:26 2007
From: zmola at acm.org (Carl Zmola)
Date: Thu, 14 Jun 2007 15:54:26 -0400
Subject: [Twisted-Python] udp
In-Reply-To: <46719A37.1060504@clara.co.uk>
References: <46719A37.1060504@clara.co.uk>
Message-ID: <46719CF2.9000103@acm.org>

If you are not receiving datagrams on the client side, is there any 
reason to use twisted for the client side?  You could just pump 
datagrams out when you need to send something.


Bruce Coram wrote:
> How do you send data using udp?
>
> I want to use udp to send messages from clients to a server.  I don't
> want to use connected udp.
>
> Can anyone supply some specimen code for me
>
> Thanks
>
> Bruce Coram
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Thu Jun 14 13:59:02 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 14 Jun 2007 15:59:02 -0400
Subject: [Twisted-Python] udp
In-Reply-To: <46719A37.1060504@clara.co.uk>
Message-ID: <20070614195902.4947.33728736.divmod.quotient.1698@ohm>

On Thu, 14 Jun 2007 20:42:47 +0100, Bruce Coram <brucecoram at clara.co.uk> wrote:
>How do you send data using udp?
>
>I want to use udp to send messages from clients to a server.  I don't
>want to use connected udp.
>
>Can anyone supply some specimen code for me
>

Consider using TCP instead:

http://twistedmatrix.com/projects/core/documentation/howto/servers.html
http://twistedmatrix.com/projects/core/documentation/howto/clients.html

It's probably much better suited to your application than UDP.  However,
there is UDP documentation on the website as well:

http://twistedmatrix.com/projects/core/documentation/howto/udp.html

Jean-Paul



From wthie at thiengineering.ch  Thu Jun 14 14:27:00 2007
From: wthie at thiengineering.ch (Werner Thie)
Date: Thu, 14 Jun 2007 22:27:00 +0200
Subject: [Twisted-Python] Athena transport duplicate message
In-Reply-To: <7a01f6c00706140321w72e9023esf89a28e1c9363b6@mail.gmail.com>
References: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
	<7a01f6c00706140321w72e9023esf89a28e1c9363b6@mail.gmail.com>
Message-ID: <4671A494.80204@thiengineering.ch>

Calling client side methods results in the log message

'Athena transport duplicate message, discarding:'

I am aware that this is a nevow question, but maybe somebody knows an 
the answer on this list.

Thank you, Werner



From python at blackslens.com  Thu Jun 14 17:32:37 2007
From: python at blackslens.com (Black)
Date: Thu, 14 Jun 2007 19:32:37 -0400
Subject: [Twisted-Python] udp
In-Reply-To: <46719CF2.9000103@acm.org>
References: <46719A37.1060504@clara.co.uk> <46719CF2.9000103@acm.org>
Message-ID: <F7C41A5C-4E1D-4CA8-9713-EDE87A57FD25@blackslens.com>

Like Carl suggested, I just eschewed Twisted on the client side when  
I did something similar. Here is a simple client that can be used  
with the server I sent earlier.


import socket

s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
data = "Data from client"
s.sendto(data, ('localhost', 8000))
data,address = s.recvfrom(1024)
print "received %r from %r" % (data, address)



If you don't want the server to send anything back, you can skip the  
recvfrom() on the client side and the self.transport.write() on the  
server side. Of course, this doesn't include any error handling for  
when the UDP data doesn't actually make it (which, of course, isn't  
guaranteed) - but this is just to illustrate how simple it is.


-Black

On Jun 14, 2007, at 3:54 PM, Carl Zmola wrote:

> If you are not receiving datagrams on the client side, is there any  
> reason to use twisted for the client side?  You could just pump  
> datagrams out when you need to send something.
>
>
> Bruce Coram wrote:
>> How do you send data using udp?
>>
>> I want to use udp to send messages from clients to a server.  I don't
>> want to use connected udp.
>>
>> Can anyone supply some specimen code for me
>>
>> Thanks
>>
>> Bruce Coram
>>
>>
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From vovic at nfi.kiae.ru  Fri Jun 15 00:35:02 2007
From: vovic at nfi.kiae.ru (Voznesensky Vladimir)
Date: Fri, 15 Jun 2007 10:35:02 +0400
Subject: [Twisted-Python] caching suggestions
In-Reply-To: <BB643192-5115-4E2E-BB8D-C2D602B8E466@2xlp.com>
References: <BB643192-5115-4E2E-BB8D-C2D602B8E466@2xlp.com>
Message-ID: <web-2620192@newmail.nfi.kiae.ru>

Well, if you need a fast database, you can use in-memory
database like
http://www.ispras.ru/~knizhnik/fastdb.html
(it's written in C++ for C++, so you will need to develop 
a glue
layer from C to Python)
But note, that all of your data should fit in RAM in such 
case.
Also note, that embedded databases delivers some delays
during commits in calling threads, so you should handle 
that
issues too.

On Thu, 14 Jun 2007 15:29:08 -0400
  Jonathan Vanasco <twisted-python at 2xlp.com> wrote:
> note: this is less about twisted than a project i've 
>built on twisted  that is having some issues.  everyone 
>here is smart, so i thought  this would be a good list to 
>ask on.
> 
> i've got a small twisted daemon that is working as a 
>proxy for  hosting content that we store on amazon-s3
> long story short: archive to s3 (redundancy, cheap 
>storage), twisted  daemon on our network fetches to cache 
>& serve.  we have cheaper  bandwidth, plus do a lot of 
>file monitoring / name abstraction that  amazon's network 
>won't support.  currently there are 10k documents on  s3, 
>which are accessible via 150k+ 'keys'.   the cache 
>basiscally  proxies the right doc for each key
> 
> I'm running into 2 issues with it:
> 	short term- keys are mapped to s3 files via a ton of 
>'hints' that i  store in bdb after fetching from 
>postgresql.  the hints need to be  refreshed every 1-5 
>minutes or so.  does anyone have a good  suggestion on 
>how to do that?  i could do this really easily with 
> sqlite, but i need to use bdb -- as sqlite isn't nearly 
>fast enough;  while bdb is.
> 
> 	long term-    everything is fine for now -- we only 
>have about 3gb  of data.  but thats going to be growing 
>to about 20gb soon, and we  want to limit the cache to an 
>active 10gb using an Adaptive  Replacement Cache 
>algorithm with a bdb datastore.  has anyone done 
> something similar in twisted or python in general?
> 
> any input would be appreciated.  thanks!
> 
> // Jonathan Vanasco
> 
> | - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>- - - - - - -  - - - - - - - - - - - - - - - - - - -
> |   CEO/Founder SyndiClick Networks
> | - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>- - - - - - -  - - - - - - - - - - - - - - - - - - -
> |      FindMeOn.com - The cure for Multiple Web 
>Personality Disorder
> |      Web Identity Management and 3D Social Networking
> | - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>- - - - - - -  - - - - - - - - - - - - - - - - - - -
> |      RoadSound.com - Tools For Bands, Stuff For Fans
> |      Collaborative Online Management And Syndication 
>Tools
> | - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>- - - - - - -  - - - - - - - - - - - - - - - - - - -
> 
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From vovic at nfi.kiae.ru  Fri Jun 15 01:28:09 2007
From: vovic at nfi.kiae.ru (Voznesensky Vladimir)
Date: Fri, 15 Jun 2007 11:28:09 +0400
Subject: [Twisted-Python] SSL: wrong version number
In-Reply-To: <20070614192220.4947.817733265.divmod.quotient.1679@ohm>
References: <20070614192220.4947.817733265.divmod.quotient.1679@ohm>
Message-ID: <web-2620443@newmail.nfi.kiae.ru>

Dear Jean-Paul,

Here is a bug/feature demonstrating example:

---8<---
from twisted.python.util import println

from twisted.protocols.basic import LineReceiver
from twisted.internet import protocol, reactor, defer, ssl
from twisted.python.failure import Failure
from OpenSSL import crypto, SSL

_CMD="""VERSION=MYPROXYv2
COMMAND=%d
USERNAME=%s
PASSPHRASE=%s
LIFETIME=%d\0""" % (0, "LOGIN", 'PASSPHRASE', 100)
WHERETO = ("myproxy.cern.ch",7512)

## Myproxy client protocol.
class MyproxyClient(protocol.Protocol):

   def connectionMade(self):
     self.transport.write('0')   # GT compat. stuff.
     self.transport.write(_CMD)

   def dataReceived(self, data):
     self.transport.loseConnection()

   def connectionLost(self, 
reason=protocol.connectionDone):
     d = self.factory.deferred
     if reason != protocol.connectionDone:
       d.errback(reason)
     else:
       d.callback(data)

## Myproxy client factory.
class MyproxyClientFactory(protocol.ClientFactory):
   protocol = MyproxyClient

   def __init__(self):
     self.deferred = defer.Deferred()

   def clientConnectionFailed(self, connector, reason):
     self.deferred.errback(reason)

## Context factory suitable for local needs.
class CF:
   def getContext(self):
     ctx = SSL.Context(SSL.SSLv3_METHOD)
     # disable for compatibility with myproxy server (er, 
globus)
     # globus doesn't handle this case, apparently, and 
instead
     # chokes in proxy delegation code
     ctx.set_options(0x00000800L)

     return ctx

ctx = CF().getContext()
import socket
conn = SSL.Connection(ctx,socket.socket())
conn.connect(WHERETO)
conn.write('0')
conn.write(_CMD)
dat = conn.recv(8192)
print 'data received by blocking call\n', dat
conn.close()
del ctx

f = MyproxyClientFactory()
contextFactory = CF()
reactor.connectSSL(WHERETO[0], WHERETO[1], f, 
contextFactory)
f.deferred.addCallbacks(
       callback=lambda data:(println("data received", 
data),reactor.stop()),
       errback=lambda error:(println("an error occurred", 
error),reactor.stop()))
reactor.run()
---8<---

Yours,
VV

On Thu, 14 Jun 2007 15:22:20 -0400
  Jean-Paul Calderone <exarkun at divmod.com> wrote:
> On Thu, 14 Jun 2007 15:08:06 -0400, Jean-Paul Calderone 
><exarkun at divmod.com> wrote:
>>
>>The server is using SSLv2.  The traceback seems to 
>>indicate the context is
>>set up for SSLv3.  I can't tell how you created that 
>>context object, nor am
>>I certain why one version of your code can establish a 
>>connection while the
>>other cannot, but I would check the context object and 
>>make sure it is using
>>either SSLv2 or SSLv23.
>>
> 
> Oh, I should also say that SSLv2 is insecure and, if you 
>can, you should
> really change that server to use at least SSLv3.
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From wgwigw at gmail.com  Sat Jun 16 04:21:56 2007
From: wgwigw at gmail.com (wang wei)
Date: Sat, 16 Jun 2007 18:21:56 +0800
Subject: [Twisted-Python] twisted and performance
In-Reply-To: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
References: <BAY129-F3525DBC4156E5FBF51571AA51F0@phx.gbl>
Message-ID: <dbeb95830706160321h7b6e0574iaad79bf7412d4b41@mail.gmail.com>

I come from China too:)
I think u need a way to monitor your application, which parts costs how much
time. then u get the idea. if we have to guess, I think there're may be
database performance issues too. we build a appliction a year ago, after
change the database indexes the appliction become acceptable.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070616/3f3f0f14/attachment.html>

From exarkun at twistedmatrix.com  Sat Jun 16 22:05:02 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 17 Jun 2007 04:05:02 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1182053102.09.330778678@twistedmatrix.com

Bug summary
______________________
Summary for 2007-06-10 through 2007-06-17
Bugs opened: 4    Bugs closed: 6  Total open bugs: 972 (-2)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       -4  |Highest:  -1          |Core:     +1           
|Enhancement:  +3  |High:     -1          |Mail:     -2           
                   |Normal:   +1          |Web2:     -1           
                                          |Website:  +0           
                                          |Words:    +1           


New / Reopened Bugs
______________________
                    ===== Highest =====
[#2703] assertWarns has some restrictions (opened by therve)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2703

[#2502] 'and' and 'or' operator suport for xpath (opened by jack)
    enhancement     words      http://twistedmatrix.com/trac/ticket/2502

                    ===== Normal =====
[#2704] Link to Twisted coding standard is broken (opened by mesozoic) (CLOSED, fixed)
    defect          website    http://twistedmatrix.com/trac/ticket/2704

[#2705] t.web2.http Request.writeResponse should set content-length to 0 on NO_CONTENT responses (opened by terrycojones)
    defect          web2       http://twistedmatrix.com/trac/ticket/2705



Closed Bugs
______________________
                    ===== Highest =====
[#2702] twisted.words.xish.yappsrt.Scanner.__init__ is  not proper epytext (opened by therve, closed by ralphm, duplicate)
    defect          words      http://twistedmatrix.com/trac/ticket/2702

[#2700] IMAP4Client.lineReceived() fails to parse literals (opened by jenner, closed by exarkun, fixed)
    defect          mail       http://twistedmatrix.com/trac/ticket/2700

[#2695] IMAP4Client breaks if server uses CONDSTORE (opened by slamb, closed by exarkun, fixed)
    defect          mail       http://twistedmatrix.com/trac/ticket/2695

[#2075] set SCRIPT_NAME (properly?) in CGI environment (opened by martinpaljak, closed by dialtone, fixed)
    defect          web2       http://twistedmatrix.com/trac/ticket/2075

                    ===== High =====
[#1979] FileSaver replaces LF with CRLF (opened by agreif, closed by dialtone, fixed)
    defect          web2       http://twistedmatrix.com/trac/ticket/1979

                    ===== Normal =====
[#2704] Link to Twisted coding standard is broken (opened by mesozoic, closed by glyph, fixed)
    defect          website    http://twistedmatrix.com/trac/ticket/2704





From tom.cocagne at gmail.com  Sat Jun 16 22:12:09 2007
From: tom.cocagne at gmail.com (Tom Cocagne)
Date: Sun, 17 Jun 2007 00:12:09 -0400
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
Message-ID: <198edda90706162112p453d00d4j2b6b11dcd2a7ef32@mail.gmail.com>

    I'm not sure if it's sufficient for your needs since it doesn't have any
direct Protocol or Reactor support but a C++ implementation of the Deferred
pattern does exist. I've just recently cleaned up the code & documentation
to the point where I would no longer be embarassed to release it.
Unfortunately though, actually getting it released it is going to be a bit
more complicated than simply attaching the zip file to an e-mail. Apparently
the process for releasing software developed by the US Department of Defense
is poorly understood and no-one I work with has ever tried to do it. In the
end, I'll get it released but it'll probably take several weeks to navigate
the bureaucracy.

    I'll make a post on this list announcing it's availability once I get
through all the red tape. Even if it arrives too late for use in your
project, as I suspect it probably will, I'm sure there will be plenty of
future requests similar to yours. And, I'm sure that there are plenty of
people in the Twisted community that do C++ development and would love to
have that particularly handy tool in their back pocket ;-)

    Cheers,

    Tom

On 6/12/07, Amaury Forgeot d'Arc <amauryfa at gmail.com> wrote:
>
> Hello,
>
> I love python and I find twisted fantastic, but here I have to write a
> C++ application, for performance pseudo-reasons :-(
>
> I was looking for a Twisted-like framework in C++.
> Do you know if such a library exists?
>
> ACE seems to provide powerful tools for networking, but I could not
> find something like Protocols and Deferred.
>
> Or is the twisted approach not recommended for C++?
>
> --
> Amaury Forgeot d'Arc
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070617/7fd5c62d/attachment.html>

From itamar at itamarst.org  Sun Jun 17 11:28:20 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 17 Jun 2007 13:28:20 -0400
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <198edda90706162112p453d00d4j2b6b11dcd2a7ef32@mail.gmail.com>
References: <e27efe130706120047p2ac9e465q5dfbf3fbb5fab61a@mail.gmail.com>
	<198edda90706162112p453d00d4j2b6b11dcd2a7ef32@mail.gmail.com>
Message-ID: <1182101300.22443.22.camel@localhost.localdomain>

You can use Fusion (http://itamarst.org/software/) to *extend* Twisted
in C++ (Linux only currently, with a little patching should work on Mac
OS X.) But it still requires Twisted, of course.




From lists at collab.nl  Sun Jun 17 16:59:33 2007
From: lists at collab.nl (Thijs Triemstra | Collab)
Date: Mon, 18 Jun 2007 00:59:33 +0200
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <28012bc60706120506t44ef5e0dx4697b5863b2c746a@mail.gmail.com>
References: <28012bc60706120506t44ef5e0dx4697b5863b2c746a@mail.gmail.com>
Message-ID: <C5FFEE14-F708-4C30-B259-45EDF4F02A96@collab.nl>

FYI, we started coding, check out http://dev.collab.com/twisted-rtmp/  
for more info.

Thijs

On Jun 12, 2007, at 2:06 PM, Arnar Birgisson wrote:

> Hi all,
>
> Re. this message:
> http://twistedmatrix.com/pipermail/twisted-python/2007-May/015373.html
>
> Has any work been done here? I'm facing a project that requires
> two-way communication between a Flex/Apollo app and a Twisted server.
> In my initial tests I used http and comet-like techniques but I'm not
> sure they are the most efficient way.
>
> I'm willing to help with the project - I've already dabbled a little
> in the DjangoAMF stuff.
>
> Arnar
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Sun Jun 17 17:36:56 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 17 Jun 2007 19:36:56 -0400
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <C5FFEE14-F708-4C30-B259-45EDF4F02A96@collab.nl>
Message-ID: <20070617233656.4947.1244192357.divmod.quotient.2279@ohm>

On Mon, 18 Jun 2007 00:59:33 +0200, Thijs Triemstra | Collab <lists at collab.nl> wrote:
>FYI, we started coding, check out http://dev.collab.com/twisted-rtmp/  for 
>more info.
>
>Thijs
>

Looks cool.  It's nice you've got examples up already :)

I hate to have to ask, but could you change the name of the project to
not include "twisted" and take the Twisted logo down?  These are marks
of the Twisted Matrix Labs team.  They aren't for general use by projects
which make use of or otherwise depend on Twisted.

Thanks,

Jean-Paul



From lists at collab.nl  Sun Jun 17 18:41:15 2007
From: lists at collab.nl (Thijs Triemstra | Collab)
Date: Mon, 18 Jun 2007 02:41:15 +0200
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <20070617233656.4947.1244192357.divmod.quotient.2279@ohm>
References: <20070617233656.4947.1244192357.divmod.quotient.2279@ohm>
Message-ID: <A3F520F1-B083-4DA9-A581-2234752CFE44@collab.nl>

Hi Jean-Paul,

> I hate to have to ask, but could you change the name of the project to
> not include "twisted" and take the Twisted logo down?  These are marks
> of the Twisted Matrix Labs team.  They aren't for general use by  
> projects
> which make use of or otherwise depend on Twisted.

Ah ok, sorry about that. The name changed and the project can now be  
found on http://dev.collab.com/rtmpy

Thijs



From exarkun at divmod.com  Sun Jun 17 20:23:44 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 17 Jun 2007 22:23:44 -0400
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <A3F520F1-B083-4DA9-A581-2234752CFE44@collab.nl>
Message-ID: <20070618022344.4947.170473162.divmod.quotient.2321@ohm>

On Mon, 18 Jun 2007 02:41:15 +0200, Thijs Triemstra | Collab <lists at collab.nl> wrote:
>Hi Jean-Paul,
>>I hate to have to ask, but could you change the name of the project to
>>not include "twisted" and take the Twisted logo down?  These are marks
>>of the Twisted Matrix Labs team.  They aren't for general use by  projects
>>which make use of or otherwise depend on Twisted.
>
>Ah ok, sorry about that. The name changed and the project can now be  found 
>on http://dev.collab.com/rtmpy
>

Thanks :)




From littlesweetmelon at gmail.com  Mon Jun 18 00:37:34 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Mon, 18 Jun 2007 14:37:34 +0800
Subject: [twisted-python] Communication between GUI thread and twisted thread.
Message-ID: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>

Hi, my program has two parts running in two threads. One is a GUI
layer, the other is a twisted layer for communication with a remote
server. Sometimes, a button is clicked in GUI to notice the twisted
thread to send out some data. (reactor.callFromThread should be used,
right?)

In twisted part, I use reactor.connectTCP('x.x.x.x', port,
MyFactory()) to connect with remote server. MyFactory will create an
instance of MyProtocol, and MyProtocol has a method 'sendSpecialMsg'
for doing real jobs.

However, in GUI part, how can I invoke 'sendSpecialMsg' function? Even
I cannot get the MyProtocol instance! Because connectTCP and MyFactory
hide the protocol object. I'm sure it is a common problem for
beginners, Could you give me some advice?

Thank you.
---
ShenLei



From andrew-twisted at puzzling.org  Mon Jun 18 00:58:25 2007
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 18 Jun 2007 16:58:25 +1000
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
Message-ID: <20070618065825.GS7691@steerpike.home.puzzling.org>

甜瓜 wrote:
> Hi, my program has two parts running in two threads. One is a GUI
> layer, the other is a twisted layer for communication with a remote
> server. Sometimes, a button is clicked in GUI to notice the twisted
> thread to send out some data. (reactor.callFromThread should be used,
> right?)
> 
> In twisted part, I use reactor.connectTCP('x.x.x.x', port,
> MyFactory()) to connect with remote server. MyFactory will create an
> instance of MyProtocol, and MyProtocol has a method 'sendSpecialMsg'
> for doing real jobs.
> 
> However, in GUI part, how can I invoke 'sendSpecialMsg' function? Even
> I cannot get the MyProtocol instance! Because connectTCP and MyFactory
> hide the protocol object. I'm sure it is a common problem for
> beginners, Could you give me some advice?

Something like ClientCreator (a convenient way to connect and get a protocol
instance when it is connected) with blockingCallFromThread (in SVN Twisted, so
the calling thread can get access to the result of the deferred from
ClientCreator) would probably do the trick.

If these aren't directly usable, you may find inspiration from looking at their
implementations.

-Andrew.




From littlesweetmelon at gmail.com  Mon Jun 18 01:22:41 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Mon, 18 Jun 2007 15:22:41 +0800
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <20070618065825.GS7691@steerpike.home.puzzling.org>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<20070618065825.GS7691@steerpike.home.puzzling.org>
Message-ID: <cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>

Thank you for your kind reply.

> Something like ClientCreator (a convenient way to connect and get a protocol
> instance when it is connected) with blockingCallFromThread (in SVN Twisted, so
> the calling thread can get access to the result of the deferred from
> ClientCreator) would probably do the trick.
>

ClientCreator is not proper for my case, because I need the re-connect ability.

Well, actually, my project is based on this article:
http://solipsis.netofpeers.com/wiki2/index.php/WxPython_And_Twisted_Example
a VERY GOOD implementation for cooperation between wx and twisted.
The hard nut is how to make DaemonLoop know the protocol instance
which is connecting to the remote server.  ^_^

---
ShenLei



From arkanes at gmail.com  Mon Jun 18 07:31:06 2007
From: arkanes at gmail.com (Chris Mellon)
Date: Mon, 18 Jun 2007 08:31:06 -0500
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<20070618065825.GS7691@steerpike.home.puzzling.org>
	<cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>
Message-ID: <4866bea60706180631ja325ea1n125f4182440ee3aa@mail.gmail.com>

On 6/18/07, 甜瓜 <littlesweetmelon at gmail.com> wrote:
> Thank you for your kind reply.
>
> > Something like ClientCreator (a convenient way to connect and get a protocol
> > instance when it is connected) with blockingCallFromThread (in SVN Twisted, so
> > the calling thread can get access to the result of the deferred from
> > ClientCreator) would probably do the trick.
> >
>
> ClientCreator is not proper for my case, because I need the re-connect ability.
>
> Well, actually, my project is based on this article:
> http://solipsis.netofpeers.com/wiki2/index.php/WxPython_And_Twisted_Example
> a VERY GOOD implementation for cooperation between wx and twisted.
> The hard nut is how to make DaemonLoop know the protocol instance
> which is connecting to the remote server.  ^_^
>
> ---

This is a terrible implementation for cooperation between wx and
twisted. At the time it was written, it was acceptable, but you really
should be using the wxreactor now.



From itamar at itamarst.org  Mon Jun 18 08:00:03 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 18 Jun 2007 10:00:03 -0400
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
Message-ID: <1182175203.22443.33.camel@localhost.localdomain>

On Mon, 2007-06-18 at 14:37 +0800, 甜瓜 wrote:
> Hi, my program has two parts running in two threads. One is a GUI
> layer, the other is a twisted layer for communication with a remote
> server. 

If you're using a GUI supported by Twisted (Qt3, GTK, wxPython, tkinter)
you don't need two threads:
http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html




From francisco.herrero at gmail.com  Mon Jun 18 08:47:19 2007
From: francisco.herrero at gmail.com (Francisco Herrero)
Date: Mon, 18 Jun 2007 11:47:19 -0300
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<20070618065825.GS7691@steerpike.home.puzzling.org>
	<cdb837ea0706180022p446e75c6k4f6fa5e8ed2f8919@mail.gmail.com>
Message-ID: <ccac7d280706180747n58aae29ei4a666faadee49f33@mail.gmail.com>

>
>
>
> ClientCreator is not proper for my case, because I need the re-connect
> ability.
>
>
>
I made a tricky for access to the protocol instance created, but I don't
know if this is sane for the structure of twisted. Is something like this:
----------
class P(Protocol):
    def connectionMade(self):
        self.factory.instance = self
        return
    ...

    def connectionLost(self):
        self.factory.instance = None

class F(Factory):
    protocol = P
    instance = None
    ...
----------
then you can access to protocol instance inside the factory, if it's not
None.
If somebody see an inconsistency or a better sugestion please let me know.

Francisco
-- 
"El hombre se descubre cuando se mide con un obstáculo"
(Saint Exupéry)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070618/9907c8c8/attachment.html>

From general at eepatents.com  Mon Jun 18 08:48:23 2007
From: general at eepatents.com (Ed Suominen)
Date: Mon, 18 Jun 2007 07:48:23 -0700
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <1182175203.22443.33.camel@localhost.localdomain>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<1182175203.22443.33.camel@localhost.localdomain>
Message-ID: <46769B37.6080708@eepatents.com>

Itamar Shtull-Trauring wrote:
> On Mon, 2007-06-18 at 14:37 +0800, 甜瓜 wrote:
>> Hi, my program has two parts running in two threads. One is a GUI
>> layer, the other is a twisted layer for communication with a remote
>> server. 
> 
> If you're using a GUI supported by Twisted (Qt3, GTK, wxPython, tkinter)
> you don't need two threads:
> http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html

Indeed, I have found Twisted's asynchronous processing to make GUI
programming much more intuitive and powerful. (I use PyQt, personally.)
To a computer, a user is as much a deferrable input source as is a
network connection.

Best regards, Ed



From littlesweetmelon at gmail.com  Mon Jun 18 09:10:54 2007
From: littlesweetmelon at gmail.com (=?GB2312?B?zPC5zw==?=)
Date: Mon, 18 Jun 2007 23:10:54 +0800
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <46769B37.6080708@eepatents.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<1182175203.22443.33.camel@localhost.localdomain>
	<46769B37.6080708@eepatents.com>
Message-ID: <cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>

> This is a terrible implementation for cooperation between wx and
> twisted. At the time it was written, it was acceptable, but you really
> should be using the wxreactor now.
Really? Oh! Maybe my knowledge is out of date. My opinion comes from
"The Twisted Documentation - Jan 9, 2007". It says:
"Twisted currently supports two methods of integrating wxPython.
Unfortunately, neither method will work on all wxPython platforms
(such as GTK2 or Windows). It seems that the only portable way to
integrate with wxPython is to run it in a separate thread."  ^_^
Therefore I followed that terrible implementation. Does wxreactor get
improvement? I will read 'choosing-reactor.html' throughly. Thank you.

> class P(Protocol):
>     def connectionMade(self):
>         self.factory.instance = self
>         return
Actually, I use the same trick now for workaround.  ^_^

---
ShenLei



From stephen.c.waterbury at nasa.gov  Mon Jun 18 09:21:58 2007
From: stephen.c.waterbury at nasa.gov (Stephen Waterbury)
Date: Mon, 18 Jun 2007 11:21:58 -0400
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>	<1182175203.22443.33.camel@localhost.localdomain>	<46769B37.6080708@eepatents.com>
	<cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>
Message-ID: <4676A316.9020308@nasa.gov>

甜瓜 wrote:
>> This is a terrible implementation for cooperation between wx and
>> twisted. At the time it was written, it was acceptable, but you really
>> should be using the wxreactor now.
> Really? Oh! Maybe my knowledge is out of date. My opinion comes from
> "The Twisted Documentation - Jan 9, 2007". It says:
> "Twisted currently supports two methods of integrating wxPython.
> Unfortunately, neither method will work on all wxPython platforms
> (such as GTK2 or Windows). It seems that the only portable way to
> integrate with wxPython is to run it in a separate thread."  ^_^
> Therefore I followed that terrible implementation. Does wxreactor get
> improvement? I will read 'choosing-reactor.html' throughly. Thank you.

That section of the docs has not changed (current svn), and I
agree it's rather confusing to determine what the actual
recommendation is.  My impression was that the most recent
implementation of the wxreactor is supposed to work on all
platforms.  Is that not so?  If it is, this section of the
docs should probably be revised to recommend it more clearly.

Steve
-- 
"The opinions expressed above do not reflect official NASA policies
  or positions, and have not been reviewed by any Government authority."




From arkanes at gmail.com  Mon Jun 18 09:32:50 2007
From: arkanes at gmail.com (Chris Mellon)
Date: Mon, 18 Jun 2007 10:32:50 -0500
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>
References: <cdb837ea0706172337t49c25eaehf9d5e8c31611f130@mail.gmail.com>
	<1182175203.22443.33.camel@localhost.localdomain>
	<46769B37.6080708@eepatents.com>
	<cdb837ea0706180810g1bd90c96td998955705fa3911@mail.gmail.com>
Message-ID: <4866bea60706180832t58acfcbfp2f4834dc74307ae2@mail.gmail.com>

On 6/18/07, 甜瓜 <littlesweetmelon at gmail.com> wrote:
> > This is a terrible implementation for cooperation between wx and
> > twisted. At the time it was written, it was acceptable, but you really
> > should be using the wxreactor now.
> Really? Oh! Maybe my knowledge is out of date. My opinion comes from
> "The Twisted Documentation - Jan 9, 2007". It says:
> "Twisted currently supports two methods of integrating wxPython.
> Unfortunately, neither method will work on all wxPython platforms
> (such as GTK2 or Windows). It seems that the only portable way to
> integrate with wxPython is to run it in a separate thread."  ^_^
> Therefore I followed that terrible implementation. Does wxreactor get
> improvement? I will read 'choosing-reactor.html' throughly. Thank you.
>

The docs are out of date in this case. Or rather, they are correct,
but incomplete - Twisted now has support for a threaded reactor, and
wxreactor has been updated to use this support, so the integration is
now (mostly) seamless.



From exarkun at divmod.com  Mon Jun 18 09:34:26 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 18 Jun 2007 11:34:26 -0400
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <4676A316.9020308@nasa.gov>
Message-ID: <20070618153426.4947.1825384414.divmod.quotient.2433@ohm>

On Mon, 18 Jun 2007 11:21:58 -0400, Stephen Waterbury <stephen.c.waterbury at nasa.gov> wrote:
>甜瓜 wrote:
>>>This is a terrible implementation for cooperation between wx and
>>>twisted. At the time it was written, it was acceptable, but you really
>>>should be using the wxreactor now.
>>Really? Oh! Maybe my knowledge is out of date. My opinion comes from
>>"The Twisted Documentation - Jan 9, 2007". It says:
>>"Twisted currently supports two methods of integrating wxPython.
>>Unfortunately, neither method will work on all wxPython platforms
>>(such as GTK2 or Windows). It seems that the only portable way to
>>integrate with wxPython is to run it in a separate thread."  ^_^
>>Therefore I followed that terrible implementation. Does wxreactor get
>>improvement? I will read 'choosing-reactor.html' throughly. Thank you.
>
>That section of the docs has not changed (current svn), and I
>agree it's rather confusing to determine what the actual
>recommendation is.  My impression was that the most recent
>implementation of the wxreactor is supposed to work on all
>platforms.  Is that not so?  If it is, this section of the
>docs should probably be revised to recommend it more clearly.
>

It's so that wxreactor has been improved somewhat and that section
of the documentation should be updated.  However, for anyone seeking
a recommendation, I will happily suggest PyGtk. ;)

Jean-Paul



From exarkun at divmod.com  Mon Jun 18 09:38:10 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 18 Jun 2007 11:38:10 -0400
Subject: [twisted-python] Communication between GUI thread and twisted
	thread.
In-Reply-To: <4866bea60706180832t58acfcbfp2f4834dc74307ae2@mail.gmail.com>
Message-ID: <20070618153810.4947.98288963.divmod.quotient.2434@ohm>

On Mon, 18 Jun 2007 10:32:50 -0500, Chris Mellon <arkanes at gmail.com> wrote:
>On 6/18/07, 甜瓜 <littlesweetmelon at gmail.com> wrote:
>> > This is a terrible implementation for cooperation between wx and
>> > twisted. At the time it was written, it was acceptable, but you really
>> > should be using the wxreactor now.
>>Really? Oh! Maybe my knowledge is out of date. My opinion comes from
>>"The Twisted Documentation - Jan 9, 2007". It says:
>>"Twisted currently supports two methods of integrating wxPython.
>>Unfortunately, neither method will work on all wxPython platforms
>>(such as GTK2 or Windows). It seems that the only portable way to
>>integrate with wxPython is to run it in a separate thread."  ^_^
>>Therefore I followed that terrible implementation. Does wxreactor get
>>improvement? I will read 'choosing-reactor.html' throughly. Thank you.
>
>The docs are out of date in this case. Or rather, they are correct,
>but incomplete - Twisted now has support for a threaded reactor, and
>wxreactor has been updated to use this support, so the integration is
>now (mostly) seamless.
>

To nit pick, http://twistedmatrix.com/buildbot-supported/ shows what
Twisted has support for.  What Twisted has for wx is "code".  If you're
lucky, it might even behave in a useful manner for your particular
application. ;)

For anyone interested in something that might be called "support", please
get involved in Twisted development and contribute effort to finishing
wxreactor.

Jean-Paul



From vovic at nfi.kiae.ru  Mon Jun 18 08:49:26 2007
From: vovic at nfi.kiae.ru (Voznesensky Vladimir)
Date: Mon, 18 Jun 2007 18:49:26 +0400
Subject: [Twisted-Python] Strange SSL behaviour.
Message-ID: <web-2635366@newmail.nfi.kiae.ru>

Dear all!

I have a bug demonstration code.
Blocking SSL works where Twisted one does not.
It is below.
How should I handle this case?
Can anybody tell me what to do with this bug?
I can dig into twisted sources, but I'm not a
twisted specialist, so it could take weeks to
boil them to get the dirt.
Help me, please.

Thank you.
VV

---8<---
from twisted.python.util import println

from twisted.protocols.basic import LineReceiver
from twisted.internet import protocol, reactor, defer, ssl
from twisted.python.failure import Failure
from OpenSSL import crypto, SSL

_CMD="""VERSION=MYPROXYv2
COMMAND=%d
USERNAME=%s
PASSPHRASE=%s
LIFETIME=%d\0""" % (0, "LOGIN", 'PASSPHRASE', 100)
WHERETO = ("myproxy.cern.ch",7512)

## Myproxy client protocol.
class MyproxyClient(protocol.Protocol):

   def connectionMade(self):
     self.transport.write('0') # GT compat. stuff.
     self.transport.write(_CMD)

   def dataReceived(self, data):
     self.transport.loseConnection()

   def connectionLost(self, 
reason=protocol.connectionDone):
     d = self.factory.deferred
     if reason != protocol.connectionDone:
       d.errback(reason)
     else:
       d.callback(data)

## Myproxy client factory.
class MyproxyClientFactory(protocol.ClientFactory):
   protocol = MyproxyClient

   def __init__(self):
     self.deferred = defer.Deferred()

   def clientConnectionFailed(self, connector, reason):
     self.deferred.errback(reason)

## Context factory suitable for local needs.
class CF:
   def getContext(self):
     ctx = SSL.Context(SSL.SSLv3_METHOD)
     # disable for compatibility with myproxy server (er, 
globus)
     # globus doesn't handle this case, apparently, and 
instead
     # chokes in proxy delegation code
     ctx.set_options(0x00000800L)

     return ctx

ctx = CF().getContext()
import socket
conn = SSL.Connection(ctx,socket.socket())
conn.connect(WHERETO)
conn.write('0')
conn.write(_CMD)
dat = conn.recv(8192)
print 'data received by blocking call\n', dat
conn.close()
del ctx

f = MyproxyClientFactory()
contextFactory = CF()
reactor.connectSSL(WHERETO[0], WHERETO[1], f, 
contextFactory)
f.deferred.addCallbacks(
       callback=lambda data:(println("data received", 
data),reactor.stop()),
       errback=lambda error:(println("an error occurred", 
error),reactor.stop()))
reactor.run()
---8<---

Yours,
VV



From glyph at divmod.com  Mon Jun 18 11:05:34 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Mon, 18 Jun 2007 17:05:34 -0000
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <20070618022344.4947.170473162.divmod.quotient.2321@ohm>
References: <A3F520F1-B083-4DA9-A581-2234752CFE44@collab.nl>
	<20070618022344.4947.170473162.divmod.quotient.2321@ohm>
Message-ID: <20070618170534.31981.1808740575.divmod.xquotient.17@joule.divmod.com>

On 02:23 am, exarkun at divmod.com wrote:
>On Mon, 18 Jun 2007 02:41:15 +0200, Thijs Triemstra | Collab 
><lists at collab.nl> wrote:
>>Hi Jean-Paul,
>>>I hate to have to ask, but could you change the name of the project 
>>>to
>>>not include "twisted" and take the Twisted logo down?  These are 
>>>marks
>>>of the Twisted Matrix Labs team.  They aren't for general use by 
>>>projects
>>>which make use of or otherwise depend on Twisted.
>>
>>Ah ok, sorry about that. The name changed and the project can now be 
>>found on http://dev.collab.com/rtmpy
>
>Thanks :)

Thanks, too, for changing this so readily :).

It makes me think, though, that maybe we should have a suggested prefix 
for things-which-use-Twisted, since "py" is a little confusing there. 
Python has PyXXX, maybe Twisted should have TwiXXX or similar?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070618/cfdf4182/attachment.html>

From exarkun at divmod.com  Mon Jun 18 11:33:29 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 18 Jun 2007 13:33:29 -0400
Subject: [Twisted-Python] Strange SSL behaviour.
In-Reply-To: <web-2635366@newmail.nfi.kiae.ru>
Message-ID: <20070618173329.4947.2055261392.divmod.quotient.2448@ohm>

On Mon, 18 Jun 2007 18:49:26 +0400, Voznesensky Vladimir <vovic at nfi.kiae.ru> wrote:
>Dear all!
>
>I have a bug demonstration code.
>Blocking SSL works where Twisted one does not.
>It is below.
>How should I handle this case?
>Can anybody tell me what to do with this bug?
>I can dig into twisted sources, but I'm not a
>twisted specialist, so it could take weeks to
>boil them to get the dirt.
>Help me, please.
>

Hey,

I took a look at your sample code a few days ago and
nothing struck me as being the cause of this behavior.
I just took another look and it still seems like this
shouldn't be happening, although I noticed a few other
miscellaneous problems with the Twisted client (none
would manifest until it managed to get further than it
does, though).

Next I did a capture with ethereal and I noticed that
the server is actually sending back unencrypted bytes
in response to 0 + _CMD.  It's not clear why it would
reliably do this for the Twisted client and not for the
version which directly uses OpenSSL, unless it is somehow
timing related.

I suppose at this point I'd check into the server's
behavior to verify this observation and try to determine
why it is behaving this way.

Jean-Paul



From vovic at nfi.kiae.ru  Mon Jun 18 12:29:34 2007
From: vovic at nfi.kiae.ru (Vladimir Voznesensky)
Date: Mon, 18 Jun 2007 22:29:34 +0400
Subject: [Twisted-Python] Strange SSL behaviour.
In-Reply-To: <20070618173329.4947.2055261392.divmod.quotient.2448@ohm>
References: <20070618173329.4947.2055261392.divmod.quotient.2448@ohm>
Message-ID: <4676CF0E.2020605@nfi.kiae.ru>

Hi,

Is it possible that Twisted changes some flags in the security context?

VV

Jean-Paul Calderone wrote:
>
> Next I did a capture with ethereal and I noticed that
> the server is actually sending back unencrypted bytes
> in response to 0 + _CMD.  It's not clear why it would
> reliably do this for the Twisted client and not for the
> version which directly uses OpenSSL, unless it is somehow
> timing related.
>
> I suppose at this point I'd check into the server's
> behavior to verify this observation and try to determine
> why it is behaving this way.
>
> Jean-Paul
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Mon Jun 18 13:11:45 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 18 Jun 2007 15:11:45 -0400
Subject: [Twisted-Python] Strange SSL behaviour.
In-Reply-To: <4676CF0E.2020605@nfi.kiae.ru>
Message-ID: <20070618191145.4947.513785742.divmod.quotient.2477@ohm>

On Mon, 18 Jun 2007 22:29:34 +0400, Vladimir Voznesensky <vovic at nfi.kiae.ru> wrote:
>Hi,
>
>Is it possible that Twisted changes some flags in the security context?
>

Nope.  The context returned by getContext is passed directly to
SSL.Connection without modification.

Jean-Paul



From brucecoram at clara.co.uk  Wed Jun 20 03:29:20 2007
From: brucecoram at clara.co.uk (Bruce Coram)
Date: Wed, 20 Jun 2007 10:29:20 +0100
Subject: [Twisted-Python] udp
In-Reply-To: <F7C41A5C-4E1D-4CA8-9713-EDE87A57FD25@blackslens.com>
References: <46719A37.1060504@clara.co.uk> <46719CF2.9000103@acm.org>
	<F7C41A5C-4E1D-4CA8-9713-EDE87A57FD25@blackslens.com>
Message-ID: <4678F370.7020406@clara.co.uk>

Many thanks for the help.  I had hoped to be able to use Twisted's udp 
but it makes no real difference.

Thanks

Bruce
> Like Carl suggested, I just eschewed Twisted on the client side when I 
> did something similar. Here is a simple client that can be used with 
> the server I sent earlier.
>
>
> import socket
>
> s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
> data = "Data from client"
> s.sendto(data, ('localhost', 8000))
> data,address = s.recvfrom(1024)
> print "received %r from %r" % (data, address)
>
>
>
> If you don't want the server to send anything back, you can skip the 
> recvfrom() on the client side and the self.transport.write() on the 
> server side. Of course, this doesn't include any error handling for 
> when the UDP data doesn't actually make it (which, of course, isn't 
> guaranteed) - but this is just to illustrate how simple it is.
>
>
> -Black
>
> On Jun 14, 2007, at 3:54 PM, Carl Zmola wrote:
>
>> If you are not receiving datagrams on the client side, is there any 
>> reason to use twisted for the client side?  You could just pump 
>> datagrams out when you need to send something.
>>
>>
>> Bruce Coram wrote:
>>> How do you send data using udp?
>>>
>>> I want to use udp to send messages from clients to a server.  I don't
>>> want to use connected udp.
>>>
>>> Can anyone supply some specimen code for me
>>>
>>> Thanks
>>>
>>> Bruce Coram
>>>
>>>
>>>
>>> _______________________________________________
>>> Twisted-Python mailing list
>>> Twisted-Python at twistedmatrix.com
>>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>
>





From slowtech.chen at yahoo.com  Wed Jun 20 04:35:37 2007
From: slowtech.chen at yahoo.com (slowtech chen)
Date: Wed, 20 Jun 2007 03:35:37 -0700 (PDT)
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
Message-ID: <981709.63531.qm@web59107.mail.re1.yahoo.com>

I have 2 clients, one gets a message from a server, once I get the message, I want to send it with the other client to another server. how can i do this?  can I add some customized events and notice the other client? Thanks.

       
---------------------------------
Get the free Yahoo! toolbar and rest assured with the added security of spyware protection. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070620/dbdf881c/attachment.html>

From exarkun at divmod.com  Wed Jun 20 05:38:51 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 20 Jun 2007 07:38:51 -0400
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
In-Reply-To: <981709.63531.qm@web59107.mail.re1.yahoo.com>
Message-ID: <20070620113851.4947.1355240853.divmod.quotient.3016@ohm>

On Wed, 20 Jun 2007 03:35:37 -0700 (PDT), slowtech chen <slowtech.chen at yahoo.com> wrote:
>I have 2 clients, one gets a message from a server, once I get the message, I want to send it with the other client to another server. how can i do this?  can I add some customized events and notice the other client? Thanks.

You need to build this system yourself.  Any protocol instance which needs to
be able to interact with another protocol instance needs a reference to that
other protocol instance, either directly (for example, as an attribute on
itself) or indirectly (for example, as an attribute on its factory).  With
this, methods on the other protocol instance can be invoked to send messages.
Here's a trivial example:

    from twisted.internet.protocol import Protocol, ServerFactory
    from twisted.trial.unittest import TestCase


    class BroadcastProtocol(Protocol):
        """
        Protocol which echos received bytes back to all connected
        BroadcastProtocols.
        """
        def dataReceived(self, bytes):
            """
            Handle received bytes by dispatching them to my factory for
            broadcast to all clients.
            """
            self.factory.sendMessage(bytes)


        def sendMessage(self, bytes):
            """
            Write the given bytes to my transport.
            """
            self.transport.write(bytes)



    class BroadcastFactory(ServerFactory):
        """
        Serve and track BroadcastProtocol instances.

        @ivar connectedProtocols: A list of all protocol instances which have
            been returned by buildProtocol.
        """
        protocol = BroadcastProtocol

        def __init__(self):
            self.connectedProtocols = []


        def buildProtocol(self, addr):
            """
            Instantiate my protocol class, append it to my tracking list, and
            return it.
            """
            protocol = ServerFactory.buildProtocol(self, addr)
            self.connectedProtocols.append(protocol)
            return protocol


        def sendMessage(self, bytes):
            """
            Send the given bytes to all tracked protocols.
            """
            for proto in self.connectedProtocols:
                proto.sendMessage(bytes)


    class BroadcastProtocolTests(TestCase):
        """
        BroadcastProtocol should send all bytes it receives to all other
        connected BroadcastProtocol instances.
        """
        def test_buildProtocol(self):
            """
            BroadcastFactory.buildProtocol should return an instance of
            BroadcastProtocol and add that instance to its tracking list.
            """
            factory = BroadcastFactory()
            protocol = factory.buildProtocol(None)
            self.assertEqual(factory.connectedProtocols, [protocol])


        def test_factorySendMessage(self):
            """
            BroadcastFactory.sendMessage should call sendMessage on each
            of the protocols in its tracking list.
            """
            class StubProtocol(object):
                """
                Mimick the message-sending interface of BroadcastProtocol.
                """
                def __init__(self):
                    self.messages = []
                def sendMessage(self, message):
                    self.messages.append(message)

            factory = BroadcastFactory()
            protocol = StubProtocol()
            factory.connectedProtocols = [protocol]
            message = object()
            factory.sendMessage(message)
            self.assertEqual(protocol.messages, [message])


        def test_dataReceived(self):
            """
            BroadcastProtocol.dataReceived should pass whatever bytes it is
            called with to the factory's sendMessage method.
            """
            class StubFactory(object):
                """
                Mimick the message-sending interface of BroadcastFactory.
                """
                def __init__(self):
                    self.messages = []
                def sendMessage(self, message):
                    self.messages.append(message)
            factory = StubFactory()
            protocol = BroadcastProtocol()
            protocol.factory = factory
            message = object()
            protocol.dataReceived(message)
            self.assertEqual(factory.messages, [message])


        def test_protocolSendMessage(self):
            """
            BroadcastProtocol.sendMessage should write the bytes it is called
            with to its transport.
            """
            class StubTransport(object):
                """
                Mimick a transport sufficiently for the purposes of simple
                writes.
                """
                def __init__(self):
                    self.messages = []
                def write(self, bytes):
                    self.messages.append(bytes)
            protocol = BroadcastProtocol()
            transport = StubTransport()
            protocol.makeConnection(transport)
            message = object()
            protocol.sendMessage(message)
            self.assertEqual(transport.messages, [message])

Jean-Paul



From arnarbi at gmail.com  Wed Jun 20 05:52:06 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Wed, 20 Jun 2007 11:52:06 +0000
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
In-Reply-To: <981709.63531.qm@web59107.mail.re1.yahoo.com>
References: <981709.63531.qm@web59107.mail.re1.yahoo.com>
Message-ID: <28012bc60706200452v60e2f54eke730e25def15203e@mail.gmail.com>

On 6/20/07, slowtech chen <slowtech.chen at yahoo.com> wrote:
> I have 2 clients, one gets a message from a server, once I get
> the message, I want to send it with the other client to another
> server. how can i do this?  can I add some customized events
> and notice the other client? Thanks.

Are they both running in the same process?

This is my first non-question post on this list, so please forgive me
if I'm giving bad advice - hopefully someone will correct me if I am.

If they're both in the same process you can just make calls between
them normally.

from twisted.internet.protocol import Protocol
from twisted.internet import reactor, protocol

class YourProtocol(Protocol):

    def connectionMade(self):
        self.factory.connections.append(self)
        print "connected"

    def connectionLost(self, reason):
        self.factory.connections.remove(self)
        print "disconnected"

    def dataReceived(self, data):
        # repeat the data to all other connections
        print "relaying data"
        for conn in self.factory.connections:
            if conn != self:
                conn.transport.write(data)

class YourClientFactory(protocol.ClientFactory):
    protocol = YourProtocol

    def __init__(self):
        self.connections = []


if __name__ == '__main__':

    f = YourClientFactory()
    reactor.connectTCP("hostname1", 10001, f)
    reactor.connectTCP("hostname2", 10002, f)
    reactor.run()



From edgardo.delgado at navy.mil  Wed Jun 20 08:15:54 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Wed, 20 Jun 2007 10:15:54 -0400
Subject: [Twisted-Python] Server/Client
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>

I would like to build a server that when it gets a message on a specific
port it will "forward" that message to another port.
I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
will forward the data to "Server2" listening on port 15000.

Edgar




From christian.simms at gmail.com  Wed Jun 20 09:01:03 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Wed, 20 Jun 2007 11:01:03 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com>

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3 <edgardo.delgado at navy.mil>
wrote:
>
> I would like to build a server that when it gets a message on a specific
> port it will "forward" that message to another port.
> I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
> will forward the data to "Server2" listening on port 15000.


Assuming you're using TCP, you could just create a server listening on a
port using reactor.listenTCP(port, factory) as detailed
here<http://twistedmatrix.com/projects/core/documentation/howto/servers.html>and
when you receive a message you would create a client using
reactor.connectTCP(host, port, factory) as detailed
here<http://twistedmatrix.com/projects/core/documentation/howto/clients.html>to
then send the message.

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070620/5a47ad5e/attachment.html>

From amauryfa at gmail.com  Wed Jun 20 09:08:12 2007
From: amauryfa at gmail.com (Amaury Forgeot d'Arc)
Date: Wed, 20 Jun 2007 17:08:12 +0200
Subject: [Twisted-Python] C++ port of Twisted
In-Reply-To: <a684d0100706120622w3d1da826vd91bb931ce0f86e7@mail.gmail.com>
References: <a684d0100706120622w3d1da826vd91bb931ce0f86e7@mail.gmail.com>
Message-ID: <e27efe130706200808o2173448fs717a7e0ced5ed4f1@mail.gmail.com>

Hello,

2007/6/12, Rodrigo Strauss wrote:
> Have you tried Boost Asio?
>
> http://asio.sourceforge.net/

Sorry for the late answer... Thanks to everybody who answered!
Asio is indeed the kind of stuff I was looking for.
It shares some concepts with Twisted.
And the boost library makes C++ a bit more usable (but less readable).

One missing piece is the Deferred object (multiple callbacks to the
same event). It seems easy to add.
My problem now is that it seems difficult to install my own reactor.

I think I will stick with my own approximation of Twisted rewritten
for C++, and switch to python once I have convinced everybody.

Thanks again for your help,
-- 
Amaury Forgeot d'Arc



From arnarbi at gmail.com  Wed Jun 20 09:34:46 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Wed, 20 Jun 2007 15:34:46 +0000
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <28012bc60706200834q56ae5618ie6002be8ea02b94d@mail.gmail.com>

On 6/20/07, Delgado, Edgardo  CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:
> I would like to build a server that when it gets a message on a specific
> port it will "forward" that message to another port.
> I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
> will forward the data to "Server2" listening on port 15000.

This is not Twisted, but it may be helpful:
http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/483732

Arnar



From edgardo.delgado at navy.mil  Wed Jun 20 13:42:17 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Wed, 20 Jun 2007 15:42:17 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
	<cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com>
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED592233D7EA5@naeapaxrez05.nadsusea.nads.navy.mil>

Here's the code:

from twisted.internet.protocol import ServerFactory, ClientFactory,
Protocol, ClientCreator
from twisted.protocols.basic import LineReceiver
from twisted.application.service import Service, Application,
IServiceCollection
from twisted.application.internet import TCPServer, TCPClient
from twisted.internet.stdio import StandardIO
from twisted.internet import reactor
import re

class DnLinkProtocol(LineReceiver):
    
    def connectionMade(self):
        self.sendLine("Connected from: " + "host " +
                             str(self.transport.getPeer().host) + " " +
                             "port " +
                             str(self.transport.getPeer().port) + '\n')
        
    def lineReceived(self, line):
        self.sendLine("DnLink echo: " + line + '\n')

class DSPEProtocol(LineReceiver):
    
    def connectionMade(self):
        self.sendLine("Connected from: " + "host " +
                             str(self.transport.getPeer().host) + " " +
                             "port " +
                             str(self.transport.getPeer().port) + '\n')
    
    def lineReceived(self, line):
        self.sendLine("DSPE echo: " + line + '\n')

class PAPSExecService(Service):
    
    def getDnLinkInFactory(self):
        f = ServerFactory()
        f.protocol = DnLinkProtocol
        f.startService = self.startService
        return f
    
    def getDSPEInFactory(self):
        f = ServerFactory()
        f.protocol = DSPEProtocol
        f.startService = self.startService
        return f
    
application = Application('PAPSExec')
f = PAPSExecService()
serviceCollection = IServiceCollection(application)
TCPServer(9595,
f.getDnLinkInFactory()).setServiceParent(serviceCollection)
TCPServer(8585,
f.getDSPEInFactory()).setServiceParent(serviceCollection) 


I would like that, for example, when data is received in port 9595 it
will forward the data to another server in port xxxx.
Where would I create a TPC Client connection?
Where would I send the message?

Edgar

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Christian
Simms
Sent: Wednesday, June 20, 2007 11:01 AM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Server/Client

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:

	I would like to build a server that when it gets a message on a
specific
	port it will "forward" that message to another port. 
	I.e. "Server1" listens on port 10000. When it gets data on port
10000 it
	will forward the data to "Server2" listening on port 15000.


Assuming you're using TCP, you could just create a server listening on a
port using reactor.listenTCP(port, factory) as detailed here
<http://twistedmatrix.com/projects/core/documentation/howto/servers.html
>  and when you receive a message you would create a client using
reactor.connectTCP(host, port, factory) as detailed here
<http://twistedmatrix.com/projects/core/documentation/howto/clients.html
>  to then send the message.

Cheers,
Christian




From slowtech.chen at yahoo.com  Thu Jun 21 01:49:04 2007
From: slowtech.chen at yahoo.com (slowtech chen)
Date: Thu, 21 Jun 2007 00:49:04 -0700 (PDT)
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
In-Reply-To: <981709.63531.qm@web59107.mail.re1.yahoo.com>
Message-ID: <174306.19745.qm@web59108.mail.re1.yahoo.com>

Thanks guys, It helped a lot, but still something I haven't figured out,
what I do is like:

reactor.connectTCP(host1, port1, factory1)
reactor.connectTCP(host2, port2, factory2)

using different protocols, so I can't do it the way Arnar does. 
my confusion is how to get the *valid* protocol instance to refer, I tried factory2.buildProtocol(None) in protocol1's callback, but the instance I get has a None transport attribute.
I guess the instance is not the same with the one reactor.connectTCP(host2, port2, factory2) is actually using.

thanks for any help.



       
---------------------------------
Fussy? Opinionated? Impossible to please? Perfect.  Join Yahoo!'s user panel and lay it on us.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070621/58fb911d/attachment.html>

From arnarbi at gmail.com  Thu Jun 21 03:06:47 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Thu, 21 Jun 2007 09:06:47 +0000
Subject: [Twisted-Python] two twisted clients,
	how can I trigger the other one's callback in one's callback?
In-Reply-To: <174306.19745.qm@web59108.mail.re1.yahoo.com>
References: <981709.63531.qm@web59107.mail.re1.yahoo.com>
	<174306.19745.qm@web59108.mail.re1.yahoo.com>
Message-ID: <28012bc60706210206u483e8976r7aca8aed97d228be@mail.gmail.com>

On 6/21/07, slowtech chen <slowtech.chen at yahoo.com> wrote:
> Thanks guys, It helped a lot, but still something I haven't figured out,
> what I do is like:
>
> reactor.connectTCP(host1, port1, factory1)
> reactor.connectTCP(host2, port2, factory2)
>
> using different protocols, so I can't do it the way Arnar does.

Assuming you pass data from host1 to host2, you can store a reference
to factory2 in factory1.

from twisted.internet.protocol import Protocol
from twisted.internet import reactor, protocol

class InputProtocol(Protocol):

   def connectionMade(self):
       print "Input connected"

   def connectionLost(self, reason):
       print "Input disconnected"

   def dataReceived(self, data):
       # repeat the data to all output connections
       print "relaying data"
       for conn in self.factory.output_factory.connections:
           conn.transport.write(data)

class OutputProtocol(Protocol):

    def connectionMade(self):
        print "Output connected"
        self.factory.connections.append(self)

    def connectionLost(self, reason):
        print "Output disconnected"
        self.factory.connections.remove(self)

class InputFactory(protocol.ClientFactory):
    protocol = InputProtocol

    def __init__(self, output_factory):
        self.output_factory = output_factory

class OutputFactory(protocol.ClientFactory):
   protocol = OutputProtocol

   def __init__(self):
       self.connections = []


if __name__ == '__main__':

   of = OutputFactory()
   if = InputFactory(of)
   reactor.connectTCP("sourcehost", 10001, if)
   reactor.connectTCP("destinationhost", 10002, of)
   reactor.run()


(totally untested)

Arnar



From christian.simms at gmail.com  Thu Jun 21 09:19:32 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Thu, 21 Jun 2007 11:19:32 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7EA5@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
	<cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com>
	<0C8FBA9C0F70E1479497B4DD7ED592233D7EA5@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <cd8fa6f90706210819m13724cc8h91b0057422ca6330@mail.gmail.com>

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3 <edgardo.delgado at navy.mil>
wrote:
>
> Here's the code:
>
> from twisted.internet.protocol import ServerFactory, ClientFactory,
> Protocol, ClientCreator
> from twisted.protocols.basic import LineReceiver
> from twisted.application.service import Service, Application,
> IServiceCollection
> from twisted.application.internet import TCPServer, TCPClient
> from twisted.internet.stdio import StandardIO
> from twisted.internet import reactor
> import re
>
> class DnLinkProtocol(LineReceiver):
>
>     def connectionMade(self):
>         self.sendLine("Connected from: " + "host " +
>                              str(self.transport.getPeer().host) + " " +
>                              "port " +
>                              str(self.transport.getPeer().port) + '\n')
>
>     def lineReceived(self, line):
>         self.sendLine("DnLink echo: " + line + '\n')
>
> class DSPEProtocol(LineReceiver):
>
>     def connectionMade(self):
>         self.sendLine("Connected from: " + "host " +
>                              str(self.transport.getPeer().host) + " " +
>                              "port " +
>                              str(self.transport.getPeer().port) + '\n')
>
>     def lineReceived(self, line):
>         self.sendLine("DSPE echo: " + line + '\n')
>
> class PAPSExecService(Service):
>
>     def getDnLinkInFactory(self):
>         f = ServerFactory()
>         f.protocol = DnLinkProtocol
>         f.startService = self.startService
>         return f
>
>     def getDSPEInFactory(self):
>         f = ServerFactory()
>         f.protocol = DSPEProtocol
>         f.startService = self.startService
>         return f
>
> application = Application('PAPSExec')
> f = PAPSExecService()
> serviceCollection = IServiceCollection(application)
> TCPServer(9595,
> f.getDnLinkInFactory()).setServiceParent(serviceCollection)
> TCPServer(8585,
> f.getDSPEInFactory()).setServiceParent(serviceCollection)
>
>
> I would like that, for example, when data is received in port 9595 it
> will forward the data to another server in port xxxx.
> Where would I create a TPC Client connection?
> Where would I send the message?
>
> Edgar
>
> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com
> [mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Christian
> Simms
> Sent: Wednesday, June 20, 2007 11:01 AM
> To: Twisted general discussion
> Subject: Re: [Twisted-Python] Server/Client
>
> On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
> <edgardo.delgado at navy.mil> wrote:
>
>         I would like to build a server that when it gets a message on a
> specific
>         port it will "forward" that message to another port.
>         I.e. "Server1" listens on port 10000. When it gets data on port
> 10000 it
>         will forward the data to "Server2" listening on port 15000.
>
>
> Assuming you're using TCP, you could just create a server listening on a
> port using reactor.listenTCP(port, factory) as detailed here
> <http://twistedmatrix.com/projects/core/documentation/howto/servers.html
> >  and when you receive a message you would create a client using
> reactor.connectTCP(host, port, factory) as detailed here
> <http://twistedmatrix.com/projects/core/documentation/howto/clients.html
> >  to then send the message.
>
> Cheers,
> Christian


Assuming you want to create a new connection every time a client connects to
your port 9595, it's slightly tricky because you can't just forward the data
as soon as you get it, since the connection to the other server may not be
created yet.  A relatively complex way is explained in the Python Cookbook
in article "Hex-dump port-forwarding network proxy
server"<http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293>,
where it queues up the data until the outgoing connection is made.  A
simpler way is used in twisted.protocols.portforward.ProxyFactory/ProxyServer,
where it just pauses receiving data until the outgoing connection is made.
I found a Python mailing list
entry<http://mail.python.org/pipermail/python-list/2003-June/212102.html>which
explains how to override the portforward's methods.

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070621/78927286/attachment.html>

From edgardo.delgado at navy.mil  Thu Jun 21 10:36:50 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Thu, 21 Jun 2007 12:36:50 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <cd8fa6f90706210819m13724cc8h91b0057422ca6330@mail.gmail.com>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil><cd8fa6f90706200801r4b6af91bhc688df7983766a83@mail.gmail.com><0C8FBA9C0F70E1479497B4DD7ED592233D7EA5@naeapaxrez05.nadsusea.nads.navy.mil>
	<cd8fa6f90706210819m13724cc8h91b0057422ca6330@mail.gmail.com>
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED5922343F9E7@naeapaxrez05.nadsusea.nads.navy.mil>

Thanks Christian (and everybody else) for your help,

Edgar

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Christian
Simms
Sent: Thursday, June 21, 2007 11:20 AM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Server/Client

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:

	Here's the code:
	
	from twisted.internet.protocol import ServerFactory,
ClientFactory, 
	Protocol, ClientCreator
	from twisted.protocols.basic import LineReceiver
	from twisted.application.service import Service, Application,
	IServiceCollection
	from twisted.application.internet import TCPServer, TCPClient 
	from twisted.internet.stdio import StandardIO
	from twisted.internet import reactor
	import re
	
	class DnLinkProtocol(LineReceiver):
	
	    def connectionMade(self):
	        self.sendLine("Connected from: " + "host " + 
	                             str(self.transport.getPeer().host)
+ " " +
	                             "port " +
	                             str(self.transport.getPeer().port)
+ '\n')
	
	    def lineReceived(self, line):
	        self.sendLine("DnLink echo: " + line + '\n')
	
	class DSPEProtocol(LineReceiver):
	
	    def connectionMade(self):
	        self.sendLine("Connected from: " + "host " + 
	                             str(self.transport.getPeer().host)
+ " " +
	                             "port " +
	                             str(self.transport.getPeer().port)
+ '\n')
	
	    def lineReceived(self, line):
	        self.sendLine("DSPE echo: " + line + '\n')
	
	class PAPSExecService(Service):
	
	    def getDnLinkInFactory(self):
	        f = ServerFactory()
	        f.protocol = DnLinkProtocol
	        f.startService = self.startService
	        return f
	
	    def getDSPEInFactory(self):
	        f = ServerFactory()
	        f.protocol = DSPEProtocol
	        f.startService = self.startService
	        return f
	
	application = Application('PAPSExec')
	f = PAPSExecService()
	serviceCollection = IServiceCollection(application)
	TCPServer(9595,
	f.getDnLinkInFactory()).setServiceParent(serviceCollection) 
	TCPServer(8585,
	f.getDSPEInFactory()).setServiceParent(serviceCollection)
	
	
	I would like that, for example, when data is received in port
9595 it
	will forward the data to another server in port xxxx.
	Where would I create a TPC Client connection?
	Where would I send the message?
	
	Edgar
	
	-----Original Message-----
	From: twisted-python-bounces at twistedmatrix.com 
	[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of
Christian
	Simms
	Sent: Wednesday, June 20, 2007 11:01 AM
	To: Twisted general discussion 
	Subject: Re: [Twisted-Python] Server/Client
	
	On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
	<edgardo.delgado at navy.mil> wrote:
	
	        I would like to build a server that when it gets a
message on a
	specific
	        port it will "forward" that message to another port.
	        I.e. "Server1" listens on port 10000. When it gets data
on port 
	10000 it
	        will forward the data to "Server2" listening on port
15000.
	
	
	Assuming you're using TCP, you could just create a server
listening on a
	port using reactor.listenTCP(port, factory) as detailed here 
	
<http://twistedmatrix.com/projects/core/documentation/howto/servers.html
	>  and when you receive a message you would create a client
using 
	reactor.connectTCP(host, port, factory) as detailed here
	
<http://twistedmatrix.com/projects/core/documentation/howto/clients.html

	>  to then send the message.
	
	Cheers,
	Christian


Assuming you want to create a new connection every time a client
connects to your port 9595, it's slightly tricky because you can't just
forward the data as soon as you get it, since the connection to the
other server may not be created yet.  A relatively complex way is
explained in the Python Cookbook in article "Hex-dump port-forwarding
network proxy server"
<http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293> , where
it queues up the data until the outgoing connection is made.  A simpler
way is used in twisted.protocols.portforward.ProxyFactory/ProxyServer,
where it just pauses receiving data until the outgoing connection is
made.  I found a Python mailing list entry
<http://mail.python.org/pipermail/python-list/2003-June/212102.html>
which explains how to override the portforward's methods.

Cheers,
Christian






From sc at linux.it  Thu Jun 21 16:02:14 2007
From: sc at linux.it (Stefano Canepa)
Date: Fri, 22 Jun 2007 00:02:14 +0200
Subject: Tell us how you're using Twisted (was Re: [Twisted-Python]
	Win32 IOCPReactor?)
In-Reply-To: <1179750893.7838.10.camel@localhost.localdomain>
References: <AB1BB4CF81B9214682079EB55A7125ED01D6994C@mapibe05.exchange.xchg>
	<4629.71.42.153.50.1179511117.squirrel@www.world-net.net>
	<001b01c79a58$94921670$0400000a@spooge>
	<1179611703.26686.4.camel@localhost.localdomain>
	<a0624087ec2773c5d92f0@[192.168.24.210]>
	<1179750893.7838.10.camel@localhost.localdomain>
Message-ID: <1182463334.2844.21.camel@localhost>

Il giorno lun, 21/05/2007 alle 08.34 -0400, Itamar Shtull-Trauring ha
scritto:

> Oh, I certainly understand running on Windows when clients pay you to do
> so. I was just surprised people do so on internal servers when they do
> have a choice.
> 
> Anyway, since this is bringing users out into the open - I'm sure we'd
> all like to hear what Twisted is being used for in different companies,
> and under which platforms. Do tell!
> 
> My company uses Twisted for a variety of uses, including reliable
> multicast data distribution, messaging, monitoring and managing complex
> processes, in the airline industry. (http://itasoftware.com)
> 
> How about you all?

I used twisted to code HL7 message transport protocol. I'm in the
process to improve the protocol to be more secure.

Bye
sc

-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virtù di un programmatore: pigrizia, impazienza e
arroganza. (Larry Wall)

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa è una parte del messaggio	firmata digitalmente
URL: </pipermail/twisted-python/attachments/20070622/255ab572/attachment.sig>

From monch1962 at gmail.com  Thu Jun 21 21:43:12 2007
From: monch1962 at gmail.com (David Mitchell)
Date: Fri, 22 Jun 2007 13:43:12 +1000
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <f6508a860706212043i64c7b6b5o65849bcae73dee3d@mail.gmail.com>

It's neither Twisted or Python, but if you're on Linux the socat tool
does exactly what you're asking and a lot more.  Google for more info

I use it all the time, and under heavy workloads it's never failed on me yet.

Regards

Dave M.

On 21/06/07, Delgado, Edgardo  CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:
> I would like to build a server that when it gets a message on a specific
> port it will "forward" that message to another port.
> I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
> will forward the data to "Server2" listening on port 15000.
>
> Edgar
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From arnarbi at gmail.com  Fri Jun 22 02:58:12 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Fri, 22 Jun 2007 08:58:12 +0000
Subject: Tell us how you're using Twisted (was Re: [Twisted-Python] Win32
	IOCPReactor?)
In-Reply-To: <1182463334.2844.21.camel@localhost>
References: <AB1BB4CF81B9214682079EB55A7125ED01D6994C@mapibe05.exchange.xchg>
	<4629.71.42.153.50.1179511117.squirrel@www.world-net.net>
	<001b01c79a58$94921670$0400000a@spooge>
	<1179611703.26686.4.camel@localhost.localdomain>
	<a0624087ec2773c5d92f0@192.168.24.210>
	<1179750893.7838.10.camel@localhost.localdomain>
	<1182463334.2844.21.camel@localhost>
Message-ID: <28012bc60706220158h2ee2ddd1n7d48dbfa2fc671c@mail.gmail.com>

On 6/21/07, Stefano Canepa <sc at linux.it> wrote:
>> Anyway, since this is bringing users out into the open - I'm sure we'd
>> all like to hear what Twisted is being used for in different companies,
>> and under which platforms. Do tell!

I'm planning to use Twisted to monitor events from an Asterisk PBX and
feed multiple Flex/AIR clients on extension status, voicemail, etc.
etc.

I'll probably use Linux 2.6 - but whatever works best.

Arnar



From luca at unipex.it  Fri Jun 22 03:08:07 2007
From: luca at unipex.it (Luca Politti)
Date: Fri, 22 Jun 2007 11:08:07 +0200
Subject: [Twisted-Python] protocol-factory question
Message-ID: <467B9177.7060907@unipex.it>

Hi group, I'm new in this mailing list and in twisted...
I want to ask you a question about twisted factory and protocols:
I'm building a server that have to receive commands from some clients 
via TCP.

So I wrote my Protocol class, and my Factory class. If I understood the 
behavior of
this system, every time a client connects to my server, factory build a 
protocol instance and
"attach" it to the client. So the client comunicates with that protocol 
instance, right?
Now, when from protocol I call self.transport.loseConnection(in way to 
disconnnect itself),
the client will be disconnected,but its protocol instance still lives 
on. What can I do
to destroy protocol instance after its client disconnection? Because if 
I have a thousand of
connection attempts, I'll have a thousand of protocol instances, with a 
lot of allocated resources

I hope I've been clear enough, even if my english is far to be perfect :)

Thanks a lot

Luca



From therve at free.fr  Fri Jun 22 03:44:22 2007
From: therve at free.fr (Thomas =?utf-8?b?SGVydsOp?=)
Date: Fri, 22 Jun 2007 11:44:22 +0200
Subject: [Twisted-Python] protocol-factory question
In-Reply-To: <467B9177.7060907@unipex.it>
References: <467B9177.7060907@unipex.it>
Message-ID: <20070622114422.ezr3narsgowoc84c@wasabox.wasabout.net>


> So I wrote my Protocol class, and my Factory class. If I understood the
> behavior of
> this system, every time a client connects to my server, factory build a
> protocol instance and
> "attach" it to the client. So the client comunicates with that protocol
> instance, right?
> Now, when from protocol I call self.transport.loseConnection(in way to
> disconnnect itself),
> the client will be disconnected,but its protocol instance still lives
> on. What can I do
> to destroy protocol instance after its client disconnection? Because if
> I have a thousand of
> connection attempts, I'll have a thousand of protocol instances, with a
> lot of allocated resources

Protocol instance will remain alive in your program if you keep a  
reference to it. By default it's not done within Twisted, so when the  
connection is closed, the protocol instance must be destroyed at the  
next garbage collect turn, without doing anything in your application.

If you keep a reference to it (to have a list of connected clients for  
example), just remove your instance from this list in connectionLost.

-- 
Thomas




From exarkun at twistedmatrix.com  Sat Jun 23 22:05:01 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 24 Jun 2007 04:05:01 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1182657901.64.1744041517@twistedmatrix.com

Bug summary
______________________
Summary for 2007-06-17 through 2007-06-24
Bugs opened: 10    Bugs closed: 2  Total open bugs: 980 (+8)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       +3  |Highest:  +1          |Conch:  +3             
|Enhancement:  +6  |High:     +0          |Core:   +4             
                   |Normal:   +8          |Lore:   -1             
                                          |Trial:  +1             
                                          |Web:    +1             
                                          |Web2:   +2             
                                          |Words:  -1             


New / Reopened Bugs
______________________
                    ===== Highest =====
[#2707] twisted.conch.ssh.connection has poor tests (opened by z3p)
    defect          conch      http://twistedmatrix.com/trac/ticket/2707

[#2709] twisted.conch.ssh.channel has poor tests (opened by z3p)
    defect          conch      http://twistedmatrix.com/trac/ticket/2709

                    ===== High =====
[#2710] twisted.conch.ssh.session has poor tests (opened by z3p)
    defect          conch      http://twistedmatrix.com/trac/ticket/2710

                    ===== Normal =====
[#2706] Add GNUTLS support in twisted (opened by yqiang)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2706

[#2708] twisted.python.log.msg isn't documented in the api documentation (opened by exarkun)
    defect          core       http://twistedmatrix.com/trac/ticket/2708

[#2711] ConnectionRefusedError doesn't provide any information about the connection that was refused (opened by jml)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2711

[#2712] cooperator should provide an API to pause, resume, and cancel individual tasks within the cooperator instead of the entire thing. (opened by glyph)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2712

[#2713] trial -u can fail doctests on second pass (opened by mgeisler)
    defect          trial      http://twistedmatrix.com/trac/ticket/2713

[#2714] Add http_proxy and https_proxy support to web/client.py (opened by fsteinel)
    enhancement     web        http://twistedmatrix.com/trac/ticket/2714

[#1436] add getCookie/setCookie to web2.http_headers.Headers (opened by andrea)
    enhancement     web2       http://twistedmatrix.com/trac/ticket/1436



Closed Bugs
______________________
                    ===== Highest =====
[#2701] twisted.words.xish.yappsrt.Scanner.__init__ is  not proper epytext (opened by therve, closed by exarkun, duplicate)
    defect          words      http://twistedmatrix.com/trac/ticket/2701

                    ===== High =====
[#812 ] Lore always generates "Index" links even when meaningless, and even on index pages themselves. (opened by tirkal, closed by exarkun, fixed)
    defect          lore       http://twistedmatrix.com/trac/ticket/812





From andrew at ellerton.net  Sun Jun 24 16:45:40 2007
From: andrew at ellerton.net (Andrew E)
Date: Sun, 24 Jun 2007 18:45:40 -0400
Subject: [Twisted-Python] Utility program to hex-dump network traffic
Message-ID: <467EF414.8020605@ellerton.net>

Dear Twisted Experts,

About 2 years ago I needed a simple way to hexdump network traffic. I
threw together a Twisted application, and have improved it little by
little whenever I needed to.

I didn't want to use an existing network sniffer tool. Instead, I
borrowed the idea of a tunnel from ssh:
Normally application A connects directly to application B; instead, A
connects to the tunnel which connets to B.

I posted the program to the ASPN site:

    http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293

Though it works well for my purposes, I'm sure I've got some aspects
wrong -- any/all comments/feedback/advice would be warmly appreciated :)

Regards
Andrew



From arnarbi at gmail.com  Sun Jun 24 17:09:14 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Sun, 24 Jun 2007 23:09:14 +0000
Subject: [Twisted-Python] Utility program to hex-dump network traffic
In-Reply-To: <467EF414.8020605@ellerton.net>
References: <467EF414.8020605@ellerton.net>
Message-ID: <28012bc60706241609u34fdff6bx74388ca7c91db8b0@mail.gmail.com>

Hi Andrew,

On 6/24/07, Andrew E <andrew at ellerton.net> wrote:
> I posted the program to the ASPN site:
>
>     http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293

Just wanted to say thanks. Someone blogged about this recipe and I've
used alot and saved a great amount of time with it. Especially handy
since ethereal/wireshark can't capture traffic on the localhost
interface on Windows.

So, thanks again!

Arnar



From andrew at ellerton.net  Sun Jun 24 21:12:56 2007
From: andrew at ellerton.net (Andrew E)
Date: Sun, 24 Jun 2007 23:12:56 -0400
Subject: [Twisted-Python] Utility program to hex-dump network traffic
In-Reply-To: <28012bc60706241609u34fdff6bx74388ca7c91db8b0@mail.gmail.com>
References: <467EF414.8020605@ellerton.net>
	<28012bc60706241609u34fdff6bx74388ca7c91db8b0@mail.gmail.com>
Message-ID: <467F32B8.4040601@ellerton.net>

Arnar Birgisson wrote:
>> I posted the program to the ASPN site:
>>
>>     http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293
>
> Just wanted to say thanks. Someone blogged about this recipe and I've
> used alot and saved a great amount of time with it. Especially handy
> since ethereal/wireshark can't capture traffic on the localhost
> interface on Windows.
Thanks for letting me know Arnar!

It sure is nice to hear people liking/using my work.

There are a few other free/open source software tidbits (non twisted)
here: http://software.ellerton.net

Andrew




From daniel.cuesta at iavante.es  Mon Jun 25 04:02:49 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Mon, 25 Jun 2007 12:02:49 +0200
Subject: [Twisted-Python] Call to ffmpeg using getProcessOutput
Message-ID: <467F92C9.2000303@iavante.es>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070625/b3071014/attachment.html>

From D.Kirby at tideway.com  Mon Jun 25 05:03:46 2007
From: D.Kirby at tideway.com (Dave Kirby)
Date: Mon, 25 Jun 2007 12:03:46 +0100
Subject: [Twisted-Python] Beginner question: integrating with CORBA 
Message-ID: <B81183566FF73947875C3A207CD60AA6056612CC@LONEX01.tideway.com>

I have just started looking at Twisted, and it looks really cool and
useful.  I have read through much of the docs and the O'Reilly book, but
I still have a head full of questions.

 

First some background.  I am considering using Twisted to replace a
component in a network management suite.  All the components communicate
through CORBA (omniORB).  The component I want to replace gets CORBA
calls that requests data from servers on the network, and the component
retrieves the data using ssh.  Currently it spawns /usr/bin/ssh and uses
pexpect to control the interaction.  Typically we will have 20-40
simultaneous calls in progress to different IP addresses, each on a
separate thread and each spawning a separate ssh client.

 

I want to replace this with a component that uses Twisted instead.  From
what I have read Twisted should be ideal for this - I can use the conch
library to do the ssh calls and eliminate the need for spawning dozens
of separate processes (something that has been a major cause of bugs).

 

The first problem I have is how to integrate the omniORB event loop with
the reactor event loop.  My initial thoughts are to have the omniORB
event loop in one thread and run the reactor loop in another thread.
When a CORBA call comes in it will use callFromThread()  to post a
request to the Twisted thread that will create the connection and handle
the ssh session.  Is this feasible?  Any gotchas to watch out for?

 

However I have also seen reference to using threadedselectreactor for
mixing Twisted and foreign even loops
(http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign-event-
loops/), but I have no idea how to use this with omniORB.  Is this worth
investigating further, or should I stick with my original idea?

 

Replacing CORBA with the Twisted PerspectiveBroker is not an option,
since it would require extensively rewriting a dozen or so components.

 

I have plenty of other questions, but will save them for another time.

 

Dave Kirby

This email and any attachment may contain confidential, privileged information for the sole use of the intended recipient. If you are not the intended recipient, do not disclose, reproduce, disseminate or otherwise use this communication. If you received this communication in error, please immediately notify the sender via email and delete the communication from your system. Company information : Tideway Systems Ltd, Registered Office: Anchor House, 15-19 Britten Street, London, SW3 3TY. Registered in England & Wales Reg. Reg. No: 4598072  VAT No: 805 5153 50 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070625/129504d5/attachment.html>

From exarkun at divmod.com  Mon Jun 25 05:46:36 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 25 Jun 2007 07:46:36 -0400
Subject: [Twisted-Python] Beginner question: integrating with CORBA 
In-Reply-To: <B81183566FF73947875C3A207CD60AA6056612CC@LONEX01.tideway.com>
Message-ID: <20070625114636.4947.728200051.divmod.quotient.4208@ohm>

On Mon, 25 Jun 2007 12:03:46 +0100, Dave Kirby <d.kirby at tideway.com> wrote:
>I have just started looking at Twisted, and it looks really cool and
>useful.  I have read through much of the docs and the O'Reilly book, but
>I still have a head full of questions.
>
>First some background.  I am considering using Twisted to replace a
>component in a network management suite.  All the components communicate
>through CORBA (omniORB).  The component I want to replace gets CORBA
>calls that requests data from servers on the network, and the component
>retrieves the data using ssh.  Currently it spawns /usr/bin/ssh and uses
>pexpect to control the interaction.  Typically we will have 20-40
>simultaneous calls in progress to different IP addresses, each on a
>separate thread and each spawning a separate ssh client.
>
>I want to replace this with a component that uses Twisted instead.  From
>what I have read Twisted should be ideal for this - I can use the conch
>library to do the ssh calls and eliminate the need for spawning dozens
>of separate processes (something that has been a major cause of bugs).
>
>The first problem I have is how to integrate the omniORB event loop with
>the reactor event loop.  My initial thoughts are to have the omniORB
>event loop in one thread and run the reactor loop in another thread.
>When a CORBA call comes in it will use callFromThread()  to post a
>request to the Twisted thread that will create the connection and handle
>the ssh session.  Is this feasible?  Any gotchas to watch out for?
>

This is probably the most straightforward approach.  It's not as desirable
as one that doesn't involve threads at all, but it gives you the integration
you're after with the least development overhead, and it leaves a pretty
straightforward path for ultimately switching away from threads entirely,
should the opportunity to do that work arise (by incrementally replacing
code in the omniORB thread with code that performs an equivalent task in
the Twisted reactor thread).

>
>However I have also seen reference to using threadedselectreactor for
>mixing Twisted and foreign even loops
>(http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign-event-
>loops/), but I have no idea how to use this with omniORB.  Is this worth
>investigating further, or should I stick with my original idea?
>

I consider threadedselectreactor a non-starter due to the state of its
test coverage and the general mystery surrounding how application-level
tests are written for code which requires it.

>
>Replacing CORBA with the Twisted PerspectiveBroker is not an option,
>since it would require extensively rewriting a dozen or so components.
>

How about doing a Twisted implementation of CORBA? ;)

Jean-Paul



From andrew-twisted at puzzling.org  Mon Jun 25 05:49:11 2007
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 25 Jun 2007 21:49:11 +1000
Subject: [Twisted-Python] Call to ffmpeg using getProcessOutput
In-Reply-To: <467F92C9.2000303@iavante.es>
References: <467F92C9.2000303@iavante.es>
Message-ID: <20070625114911.GD20429@steerpike.home.puzzling.org>

Daniel de la Cuesta wrote:
> Hi everybody, I am trying to call ffmpeg using getProcessOutput method.
> 
> My code is as follows:
> 
> #Tuple of strings
> arguments = ('-i imput_file', '-ar 8000', '-ac 1', '-acodec amr_nb', '-vcodec
> h263', '-s qcif', '-r 12', '-b 32', '-ab 8', output_file)

This almost certainly needs to be:

arguments = ('-i', 'imput_file', '-ar', '8000', '-ac', '1', '-acodec', 'amr_nb',
	     '-vcodec', 'h263', '-s', 'qcif', '-r', '12', '-b', '32', '-ab',
             '8', output_file)

The error you are seeing is because ffmpeg cannot understand the arguments you
are passing it, so it writes a basic help message to stderr.

-Andrew.




From daniel.cuesta at iavante.es  Mon Jun 25 06:00:11 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Mon, 25 Jun 2007 14:00:11 +0200
Subject: [Twisted-Python] Call to ffmpeg using getProcessOutput
In-Reply-To: <467F92C9.2000303@iavante.es>
References: <467F92C9.2000303@iavante.es>
Message-ID: <467FAE4B.9030207@iavante.es>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070625/59386381/attachment.html>

From clawsicus at gmail.com  Mon Jun 25 07:04:31 2007
From: clawsicus at gmail.com (Chris Laws)
Date: Mon, 25 Jun 2007 22:34:31 +0930
Subject: [Twisted-Python] Beginner question: integrating with CORBA
Message-ID: <3ff1f41d0706250604g680faac3tca55a13ec19d2284@mail.gmail.com>

>
> ---------- Forwarded message ----------
> From: "Dave Kirby" <D.Kirby at tideway.com>
> To: <twisted-python at twistedmatrix.com>
> Date: Mon, 25 Jun 2007 12:03:46 +0100
> Subject: [Twisted-Python] Beginner question: integrating with CORBA
>
> I have just started looking at Twisted, and it looks really cool and
> useful.  I have read through much of the docs and the O'Reilly book, but I
> still have a head full of questions.
>
>
>
> First some background.  I am considering using Twisted to replace a
> component in a network management suite.  All the components communicate
> through CORBA (omniORB).  The component I want to replace gets CORBA calls
> that requests data from servers on the network, and the component retrieves
> the data using ssh.  Currently it spawns /usr/bin/ssh and uses pexpect to
> control the interaction.  Typically we will have 20-40 simultaneous calls in
> progress to different IP addresses, each on a separate thread and each
> spawning a separate ssh client.
>
>
>
> I want to replace this with a component that uses Twisted instead.  From
> what I have read Twisted should be ideal for this – I can use the conch
> library to do the ssh calls and eliminate the need for spawning dozens of
> separate processes (something that has been a major cause of bugs).
>
>
>
> The first problem I have is how to integrate the omniORB event loop with
> the reactor event loop.  My initial thoughts are to have the omniORB event
> loop in one thread and run the reactor loop in another thread.  When a CORBA
> call comes in it will use callFromThread()  to post a request to the Twisted
> thread that will create the connection and handle the ssh session.  Is this
> feasible?  Any gotchas to watch out for?
>
>
>
> However I have also seen reference to using threadedselectreactor for
> mixing Twisted and foreign even loops (
> http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign-event-loops/),
> but I have no idea how to use this with omniORB.  Is this worth
> investigating further, or should I stick with my original idea?
>
>
>
> Replacing CORBA with the Twisted PerspectiveBroker is not an option, since
> it would require extensively rewriting a dozen or so components.
>
>
>
> I have plenty of other questions, but will save them for another time.
>
>
>
> Dave Kirby
>
>
I just got back into a similar thing today after about a month of inactivity
on the issue. I posted about it here a while back but got no responses.
I'm trying to convert a simple Python/Omniorb CORBA Event Channel client
script so that it can robustly handle a separate federated Name Service
disappearing. I'm planning on running it using twisted for various reasons
(common code, available functionality, etc). So I need to work out if I can
use Twisted and CORBA (Omniorb to be specific) together, ideally within the
same thread.

Currently the simple script has a Tkinter UI which also registers a callback
method with the Event Channel client wrapper to handle Event Messages. A
self-rescheduling callback is also configured to drive the Orb, at some
variable rate, and then the script is handled by the Tkiner mainloop. At
regular intervals the Orb is run then rescheduled and then control is
returned back to the Tk mainloop. I'm at home and can't remember the exact
code but something along the lines of:

def runOrb(self):
    if self.orb.work_pending():
        self.orb.perform_work()

This all seems to work well. However the script is fairly simple in that
it's only monitoring and reacting to Event Channel messages, so slightly
different from your use. However, I think that it demonstrates that the orb
can be run from within another event processing loop within the same single
thread - in this case the Tk mainloop.
Now the Tk event processing can be handled by the tksupport package so I
thought why not use that model for a CORBA support package?
I've totally copied the tksupport file (it's very small) and converted it to
perform the running and re-scheduling of the CORBA orb.

Sorry I can't provide you more info but as mentioned above I only got back
into this today (no testing yet) plus I finish work at that company in a few
days. If I get anywhere I'll post back some info. Hopefully it gives you
something to look into.

Regards,
Chris Laws
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070625/1fca5411/attachment.html>

From brendoncolby at gmail.com  Mon Jun 25 09:17:24 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 10:17:24 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
Message-ID: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>

Greetings,

I've begun moving an application I wrote from asynchat to twisted.
I've got basic functionality, I've converted my DB stuff to adbapi and
have begun writing unit tests. I have a few questions that I haven't
been able to get answered through the API docs, twisted.words protocol
code, mailing list posts etc. I'd be very grateful for some
assistance!

1. Right now I'm defining my dbPool in my factory init, and running a
method to load some data from the DB. I've copied the IRC
BasicServerFunctionalityTestCase and modified it for my use:

class BasicServerFunctionalityTestCase(unittest.TestCase):
    def setUp(self):
        self.f = StringIOWithoutClosing()
        self.t = FileWrapperThatWorks(self.f) # I need this to return
an IPv4Address!
        self.p = sserverd.SServerProtocol()
        self.p.factory = sserverd.SServerFactory(self.p)
        self.p.makeConnection(self.t)
        self.p.factory.dbPool.start()

    def tearDown(self):
        self.p.factory.dbPool.close()

    def check(self, s):
        self.assertEquals(self.f.getvalue(), s)

    def testSendDeveloperID(self):
        self.p.lineReceived('{%s:"PG"}\0' % sserverson.base10toN(104))
        self.check("test\0")

I've gotten past the database threads hanging open by running start()
and close() manually. Now, my database callbacks that load necessary
data appear to be getting called AFTER my test runs. I know they're
getting called, but when the above test runs, the required data
structure is empty. What am I missing here?

2. I'm having a bit of trouble wrapping my head around adbapi. Prior
to it, one thing I would do is gather data and return a row, as in,
the method "developerExists()" would check the DB and return row[0][0]
or something (a bool). Now it seems as though I have to preload this
data and check against that. Can I replicate this behavior with
adbapi? Is there a better way than having to preload ALL my data up
front? How can I get any data from the DB like this:

data = getSomethingFromDB()

I'm suspicious that I need to adopt a new paradigm here, but am having
difficulty seeing past the old way of doing things!

3. I have some methods (as I pointed out in #1) that load data. With
adbapi, it appears that I have to do this:

  def _loadDevelopers(self,results):
    for result in results:
      developerID = result[2]
      ...
      self.addDeveloper(Developer(authHost,authUrl,developerID,self,rc4key,
        postHost,postUrl))

  def loadDevelopers(self):
    self.dbPool.runQuery("select * from developers where active=1").addCallback(
    self._loadDevelopers).addErrback(printError)
    # Before, I would just load my data here!

Is this correct? i.e. a DB method that gets called, each having a
corresponding callback method that does the real work? (This seems
sort of a pain to me...) I feel as though I'm close to "getting it"
(twisted in general, adbapi) but feel that I have yet to connect some
key pieces of information.

4. I was digging through the adbapi code, and it appears that the only
type of result set I can get is a tuple (because only cursors are
used...). Is there a way I can get a dictionary returned, keys are
column names? i.e. a MySqlDB.fetch_row(how=1). I'm just not seeing how
I can do this with adbapi or, rather, how I can pass through to the
MySqlDB module to get this type of result set.

5. I've always run my application using DJB's daemontools
(http://cr.yp.to/daemontools.html). Is there an incredibly compelling
reason to switch to using twistd? It seems to have some pretty neat
features, but I'm just not 100% sure I want to give up daemontools
yet.


Thanks!

Brendon Colby



From karlb at gmx.net  Mon Jun 25 09:35:06 2007
From: karlb at gmx.net (Karl Bartel)
Date: Mon, 25 Jun 2007 17:35:06 +0200
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
Message-ID: <467FE0AA.1000403@gmx.net>

Brendon Colby wrote:

> 4. I was digging through the adbapi code, and it appears that the only
> type of result set I can get is a tuple (because only cursors are
> used...). Is there a way I can get a dictionary returned, keys are
> column names? i.e. a MySqlDB.fetch_row(how=1). I'm just not seeing how
> I can do this with adbapi or, rather, how I can pass through to the
> MySqlDB module to get this type of result set.

This depends on your DBAPI implementation. psycopg2 and pysqlite have
optional support for this. I don't know about you mysql, though. Using
any of these is not DBAPI2 compliant, but it's extremely useful.

Bye,
Karl



From mithrandi-twisted-python at mithrandi.za.net  Mon Jun 25 10:19:03 2007
From: mithrandi-twisted-python at mithrandi.za.net (Tristan Seligmann)
Date: Mon, 25 Jun 2007 18:19:03 +0200
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
Message-ID: <20070625161903.GC3900@mithrandi.za.net>

* Brendon Colby <brendoncolby at gmail.com> [2007-06-25 10:17:24 -0500]:

> 5. I've always run my application using DJB's daemontools
> (http://cr.yp.to/daemontools.html). Is there an incredibly compelling
> reason to switch to using twistd? It seems to have some pretty neat
> features, but I'm just not 100% sure I want to give up daemontools
> yet.

I'd suggest doing both; just run twistd with the -n flag (--nodaemon) to
stop it from doing the daemonization itself.
-- 
mithrandi, i Ainil en-Balandor, a faer Ambar
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 197 bytes
Desc: Digital signature
URL: </pipermail/twisted-python/attachments/20070625/27706a6c/attachment.sig>

From christian.simms at gmail.com  Mon Jun 25 10:28:23 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Mon, 25 Jun 2007 12:28:23 -0400
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
Message-ID: <cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>

I think your biggest hurdle is that you need to get used to using Deferred's
in adbapi and any functions/methods that call adbapi indirectly.  Unless you
use a fast embedded database like Sqlite, you have to use Deferred's because
there's network traffic under the covers to the database server. I'll try to
include a little advice below for each item:


On 6/25/07, Brendon Colby <brendoncolby at gmail.com> wrote:
>
> Greetings,
>
> I've begun moving an application I wrote from asynchat to twisted.
> I've got basic functionality, I've converted my DB stuff to adbapi and
> have begun writing unit tests. I have a few questions that I haven't
> been able to get answered through the API docs, twisted.words protocol
> code, mailing list posts etc. I'd be very grateful for some
> assistance!
>
> 1. Right now I'm defining my dbPool in my factory init, and running a
> method to load some data from the DB. I've copied the IRC
> BasicServerFunctionalityTestCase and modified it for my use:
>
> class BasicServerFunctionalityTestCase(unittest.TestCase):
>     def setUp(self):
>         self.f = StringIOWithoutClosing()
>         self.t = FileWrapperThatWorks(self.f) # I need this to return
> an IPv4Address!
>         self.p = sserverd.SServerProtocol()
>         self.p.factory = sserverd.SServerFactory(self.p)
>         self.p.makeConnection(self.t)
>         self.p.factory.dbPool.start()
>
>     def tearDown(self):
>         self.p.factory.dbPool.close()
>
>     def check(self, s):
>         self.assertEquals(self.f.getvalue(), s)
>
>     def testSendDeveloperID(self):
>         self.p.lineReceived('{%s:"PG"}\0' % sserverson.base10toN(104))
>         self.check("test\0")
>
> I've gotten past the database threads hanging open by running start()
> and close() manually. Now, my database callbacks that load necessary
> data appear to be getting called AFTER my test runs. I know they're
> getting called, but when the above test runs, the required data
> structure is empty. What am I missing here?


I think you have a race condition because (I assume)
self.p.lineReceivedindirectly did a database insert, and then the
self.check did a database select.  If that's true, you should make your test
use Deferred's like this:

  d = defer.succeed(None)
  d.addCallback(lambda out: self.p.lineReceived('{%s:"PG"}\0' %
sserverson.base10toN(104))
  d.addCallback(lambda out: self.check("test\0"))
  return d

You could also write this code using the new defer.inlineCallbacks (needs
python 2.5) or the older defer.deferredGenerator, but you might as well get
used to using callbacks/errbacks and Deferred's.


2. I'm having a bit of trouble wrapping my head around adbapi. Prior
> to it, one thing I would do is gather data and return a row, as in,
> the method "developerExists()" would check the DB and return row[0][0]
> or something (a bool). Now it seems as though I have to preload this
> data and check against that. Can I replicate this behavior with
> adbapi? Is there a better way than having to preload ALL my data up
> front? How can I get any data from the DB like this:
>
> data = getSomethingFromDB()
>
> I'm suspicious that I need to adopt a new paradigm here, but am having
> difficulty seeing past the old way of doing things!


You're right that you need a new paradigm, like this:

  def cb(data):
       # use the data here, in the callback function
  return getSomethingFromDB().addCallback(cb)

This assumes getSomethingFromDB() returns a Deferred which fires with the
result you wanted.

3. I have some methods (as I pointed out in #1) that load data. With
> adbapi, it appears that I have to do this:
>
>   def _loadDevelopers(self,results):
>     for result in results:
>       developerID = result[2]
>       ...
>       self.addDeveloper
> (Developer(authHost,authUrl,developerID,self,rc4key,
>         postHost,postUrl))
>
>   def loadDevelopers(self):
>     self.dbPool.runQuery("select * from developers where
> active=1").addCallback(
>     self._loadDevelopers).addErrback(printError)
>     # Before, I would just load my data here!
>
> Is this correct? i.e. a DB method that gets called, each having a
> corresponding callback method that does the real work? (This seems
> sort of a pain to me...) I feel as though I'm close to "getting it"
> (twisted in general, adbapi) but feel that I have yet to connect some
> key pieces of information.



This is basically correct, though loadDevelopers should probably return the
result of the runQuery() call.


4. I was digging through the adbapi code, and it appears that the only
> type of result set I can get is a tuple (because only cursors are
> used...). Is there a way I can get a dictionary returned, keys are
> column names? i.e. a MySqlDB.fetch_row(how=1). I'm just not seeing how
> I can do this with adbapi or, rather, how I can pass through to the
> MySqlDB module to get this type of result set.



If you can't find a MySQL-specific way to get a dictionary, you can always
write a generic python function which does so, and then always call that in
your code.  adbapi doesn't do this for you.

5. I've always run my application using DJB's daemontools
> (http://cr.yp.to/daemontools.html). Is there an incredibly compelling
> reason to switch to using twistd? It seems to have some pretty neat
> features, but I'm just not 100% sure I want to give up daemontools
> yet.


You really need to run your twisted app with twistd.  That's the abstraction
for launching twisted programs -- i.e., you define a variable named
"application" in your .tac file and then use twistd to start your app.  Of
course, there's nothing stopping you from using daemontools on top of it.

Thanks!
>
> Brendon Colby
>

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070625/63d0a358/attachment.html>

From exarkun at divmod.com  Mon Jun 25 10:49:00 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 25 Jun 2007 12:49:00 -0400
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
Message-ID: <20070625164900.4947.876038890.divmod.quotient.4267@ohm>

On Mon, 25 Jun 2007 12:28:23 -0400, Christian Simms <christian.simms at gmail.com> wrote:
> [snip]
>
>I think you have a race condition because (I assume)
>self.p.lineReceivedindirectly did a database insert, and then the
>self.check did a database select.  If that's true, you should make your test
>use Deferred's like this:
>
>  d = defer.succeed(None)
>  d.addCallback(lambda out: self.p.lineReceived('{%s:"PG"}\0' %
>sserverson.base10toN(104))
>  d.addCallback(lambda out: self.check("test\0"))
>  return d
>
>You could also write this code using the new defer.inlineCallbacks (needs
>python 2.5) or the older defer.deferredGenerator, but you might as well get
>used to using callbacks/errbacks and Deferred's.
>

Note that the above requires lineReceived to return a Deferred which only
fires after the insert has completed and check to return a Deferred which
represents the result of the select (if those are indeed the underlying
operations).

Jean-Paul



From brendoncolby at gmail.com  Mon Jun 25 13:35:23 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 14:35:23 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <467FE0AA.1000403@gmx.net>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<467FE0AA.1000403@gmx.net>
Message-ID: <e64b001e0706251235i4df9d263md04a856d03504417@mail.gmail.com>

On 6/25/07, Karl Bartel <karlb at gmx.net> wrote:
> Brendon Colby wrote:
>
> > 4. I was digging through the adbapi code, and it appears that the only
> > type of result set I can get is a tuple (because only cursors are
> > used...). Is there a way I can get a dictionary returned, keys are
> > column names? i.e. a MySqlDB.fetch_row(how=1). I'm just not seeing how
> > I can do this with adbapi or, rather, how I can pass through to the
> > MySqlDB module to get this type of result set.
>
> This depends on your DBAPI implementation. psycopg2 and pysqlite have
> optional support for this. I don't know about you mysql, though. Using
> any of these is not DBAPI2 compliant, but it's extremely useful.

Aha! This got me thinking...so I dug into the MySQLdb README file
(again). To be able to get a tuple of dictionaries returned while
using adbabi/MySQLdb, you simply have to do:

    self.dbPool = adbapi.ConnectionPool("MySQLdb",host=host,port=port,
                                        user=username,passwd=password,
                                        db=database,
                                        cursorclass=DictCursor) #<-----

Since MySQLdb implements cursors in Python, one can subclass the base
cursor class or use one of the several others provided - in this case
DictCursor. This just wasn't obvious to me (never was) in the README!

Brendon



From brendoncolby at gmail.com  Mon Jun 25 13:57:50 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 14:57:50 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
Message-ID: <e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>

On 6/25/07, Christian Simms <christian.simms at gmail.com> wrote:
> I think your biggest hurdle is that you need to get used to using Deferred's
> in adbapi and any functions/methods that call adbapi indirectly.  Unless you
> use a fast embedded database like Sqlite, you have to use Deferred's because
> there's network traffic under the covers to the database server. I'll try to
> include a little advice below for each item:

Yep this is precisely what I am attempting to do - get used to using
deferreds (properly).

> I think you have a race condition because (I assume) self.p.lineReceived
> indirectly did a database insert, and then the self.check did a database
> select.  If that's true, you should make your test use Deferred's like this:

No - I'm just doing a series of runQuerys() when the server starts,
the callbacks of which populate dictionaries with objects. The test
sends a string identifier to the server which checks whether or not it
exists in one of these dictionaries. When the test runs, the dict is
empty. However, the load method IS running, just (seemingly) after the
test is run. I guess I'm not sure how to code a test for this, as in,
"after the database connection has been made and the data loaded, THEN
start running tests."

>   d = defer.succeed(None)
>   d.addCallback(lambda out: self.p.lineReceived('{%s:"PG"}\0' %
> sserverson.base10toN(104))
>   d.addCallback(lambda out: self.check("test\0"))
>   return d
>
> You could also write this code using the new defer.inlineCallbacks (needs
> python 2.5) or the older defer.deferredGenerator, but you might as well get
> used to using callbacks/errbacks and Deferred's.

Hrm yes, I'm using Debian stock 2.4, but wouldn't be opposed to hand
installing a few things (like twisted). I've done it many times. A
quick check of deferredGenerator and inlineCallbacks...these look
_exactly_ like what I'm asking for. I might just stick with 2.4 and
deferredGenerator.

> You're right that you need a new paradigm, like this:
>
>   def cb(data):
>        # use the data here, in the callback function
>   return getSomethingFromDB().addCallback(cb)
>
> This assumes getSomethingFromDB() returns a Deferred which fires with the
> result you wanted.

Yep, that's basically exactly what I'm doing now.

> You really need to run your twisted app with twistd.  That's the abstraction
> for launching twisted programs -- i.e., you define a variable named
> "application" in your .tac file and then use twistd to start your app.  Of
> course, there's nothing stopping you from using daemontools on top of it.

Yep, that's exactly what I had considered doing. It doesn't appear to
difficult to convert to using twistd run out of daemontools.

Thanks!

Brendon



From exarkun at divmod.com  Mon Jun 25 14:12:11 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 25 Jun 2007 16:12:11 -0400
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
Message-ID: <20070625201211.4947.1635239258.divmod.quotient.4321@ohm>

On Mon, 25 Jun 2007 14:57:50 -0500, Brendon Colby <brendoncolby at gmail.com> wrote:
> [snip]
>
>Hrm yes, I'm using Debian stock 2.4, but wouldn't be opposed to hand
>installing a few things (like twisted). I've done it many times. A
>quick check of deferredGenerator and inlineCallbacks...these look
>_exactly_ like what I'm asking for. I might just stick with 2.4 and
>deferredGenerator.

I just want to point out that neither deferredGenerator nor inlineCallbacks
does anything _new_ - they only provide an alternate API for defining
callbacks and errbacks (an API that lets you use code inline within a
single function without defining new functions).  If your code doesn't
execute in the right order without deferredGenerator, it won't execute
in the right order with deferredGenerator either.

Jean-Paul



From brendoncolby at gmail.com  Mon Jun 25 14:40:00 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 15:40:00 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <20070625201211.4947.1635239258.divmod.quotient.4321@ohm>
References: <e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
	<20070625201211.4947.1635239258.divmod.quotient.4321@ohm>
Message-ID: <e64b001e0706251340m7e06fb52nc81f040193cf8c68@mail.gmail.com>

On 6/25/07, Jean-Paul Calderone <exarkun at divmod.com> wrote:
> I just want to point out that neither deferredGenerator nor inlineCallbacks
> does anything _new_ - they only provide an alternate API for defining
> callbacks and errbacks (an API that lets you use code inline within a
> single function without defining new functions).  If your code doesn't
> execute in the right order without deferredGenerator, it won't execute
> in the right order with deferredGenerator either.

Yep - I meant that I could definitely use this in my code, but not
specifically to fix my unittest issues, which I haven't corrected yet.

Brendon



From nico at tekNico.net  Mon Jun 25 15:02:42 2007
From: nico at tekNico.net (Nicola Larosa)
Date: Mon, 25 Jun 2007 23:02:42 +0200
Subject: [Twisted-Python] Re: Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706251235i4df9d263md04a856d03504417@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>	<467FE0AA.1000403@gmx.net>
	<e64b001e0706251235i4df9d263md04a856d03504417@mail.gmail.com>
Message-ID: <46802D72.2060109@tekNico.net>

Brendon Colby wrote:
> Aha! This got me thinking...so I dug into the MySQLdb README file
> (again).

Friends don't let friends use MySQL.

Sure, you're not my friend yet, but if this doesn't make you one, I don't
know what will: ;-)

MySQL-PostgreSQL comparison
http://www.teknico.net/devel/myvspg/index.en.html


-- 
Nicola Larosa - http://www.tekNico.net/

We're seeing a realization that 20 years into the experiment, strict OO
design is not the be-all and end-all of complexity management. Functional
programming probably isn't either. The hybrids (Python, Ruby, JavaScript,
etc.) seem to have real legs these days. -- Alex Russell, August 2006





From brendoncolby at gmail.com  Mon Jun 25 15:47:38 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Mon, 25 Jun 2007 16:47:38 -0500
Subject: [Twisted-Python] Re: Testing with trial, adbapi questions
In-Reply-To: <46802D72.2060109@tekNico.net>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<467FE0AA.1000403@gmx.net>
	<e64b001e0706251235i4df9d263md04a856d03504417@mail.gmail.com>
	<46802D72.2060109@tekNico.net>
Message-ID: <e64b001e0706251447r3ce7b976xc4a18209dc4cc253@mail.gmail.com>

On 6/25/07, Nicola Larosa <nico at teknico.net> wrote:
> Friends don't let friends use MySQL.

Interesting comparison. I've always used MySQL and for what I'm doing
it probably wouldn't matter either way. The most compelling reason for
me to switch would be because I've always wanted to learn how to use
Postgres. :)

Brendon



From matt at zgroupplc.com  Tue Jun 26 05:02:48 2007
From: matt at zgroupplc.com (Matthew Glubb)
Date: Tue, 26 Jun 2007 12:02:48 +0100
Subject: [Twisted-Python] Thank You Twisted!
Message-ID: <8AD10718-5F16-4788-95C1-36F123A9F1C5@zgroupplc.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi All,

I just wanted to say thanks for all of the good work with twisted. I  
have just finished testing my server application on a 1GB box for 1  
hour with 10,000 simultaneous connections and it ran like a dream :)  
Granted, trying anything other than the epoll reactor brought the  
server to its knees very quickly.

By the way, for any of you using memcache, don't be tempted by  
cmemcache if you are deferring those operations to a thread. Seems  
like cmemcache is not thread safe. I was getting lots of seg faults  
until I switched back to the pure python memcache module.

Thanks again :)


Matt


m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: <http://www.zgroupplc.com/>

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify <service at zgroupplc.com>



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGgPJbyI6MkdKPngkRAlX5AJ9VsThIgIiT9FoEyPlYOtS5O8T9wwCeM9LN
DLTVdulqFZ3pPS4TnHRvIX0=
=PCMS
-----END PGP SIGNATURE-----



From christian.simms at gmail.com  Tue Jun 26 08:27:28 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Tue, 26 Jun 2007 10:27:28 -0400
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
	<e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
Message-ID: <cd8fa6f90706260727l667f3e72we349e32ac40260cf@mail.gmail.com>

On 6/25/07, Brendon Colby <brendoncolby at gmail.com> wrote:
>
> On 6/25/07, Christian Simms <christian.simms at gmail.com> wrote:
>
> [snip]
> > I think you have a race condition because (I assume) self.p.lineReceived
> > indirectly did a database insert, and then the self.check did a database
> > select.  If that's true, you should make your test use Deferred's like
> this:
>
> No - I'm just doing a series of runQuerys() when the server starts,
> the callbacks of which populate dictionaries with objects. The test
> sends a string identifier to the server which checks whether or not it
> exists in one of these dictionaries. When the test runs, the dict is
> empty. However, the load method IS running, just (seemingly) after the
> test is run. I guess I'm not sure how to code a test for this, as in,
> "after the database connection has been made and the data loaded, THEN
> start running tests."
>
[snip]
>


Looks like I mis-assumed your problem, sorry.  In the setUp method in your
tests, you should return a Deferred which fires when all your data is
loaded.  This can be a pain if you already organized your code into classes
inheriting from twisted.application.service.Service which have
startService/stopService calls. It's a pain because trial doesn't create an
application object like running inside twistd does.  So, in the case of
writing unit tests for applications, you can abstract out your
initialization code into a method, and then call that method directly in
your setUp method.

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070626/73fa62b6/attachment.html>

From matt at zgroupplc.com  Tue Jun 26 10:00:33 2007
From: matt at zgroupplc.com (Matthew Glubb)
Date: Tue, 26 Jun 2007 17:00:33 +0100
Subject: [Twisted-Python] Pydoc and Zope Interfaces
Message-ID: <EBB32E03-4DDB-417F-9C94-F70FD94B0AE6@zgroupplc.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi All,

Sorry if this is slightly off-topic but Zope doesn't use pydoc so its  
not an issue for their users. Has anyone found an easy to apply patch  
for pydoc that will list the documentation for classes that use  
implements(). At the moment, it throws an AttributeError and reverts  
to what looks like __repr__.

I found a patch here:

<http://simpleparse.sourceforge.net/pydoc/pydoc2.py>

Which purports to be able to cope with implements() in classes but  
its beyond my simple python brain to implement right now.

Thanks,


Matt


m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: <http://www.zgroupplc.com/>

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify <service at zgroupplc.com>



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGgTgjyI6MkdKPngkRAmMaAJ9TPzxTmYutAjAPkvef4YPb38N2JACfc9TE
WvwBqTRzhgBdE+p2oG4A6YU=
=rfAX
-----END PGP SIGNATURE-----



From radix at twistedmatrix.com  Tue Jun 26 10:13:45 2007
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Tue, 26 Jun 2007 12:13:45 -0400
Subject: [Twisted-Python] Pydoc and Zope Interfaces
In-Reply-To: <EBB32E03-4DDB-417F-9C94-F70FD94B0AE6@zgroupplc.com>
References: <EBB32E03-4DDB-417F-9C94-F70FD94B0AE6@zgroupplc.com>
Message-ID: <60ed19d40706260913v132fab14j377d06daad87d2a3@mail.gmail.com>

On 6/26/07, Matthew Glubb <matt at zgroupplc.com> wrote:
> Hi All,
>
> Sorry if this is slightly off-topic but Zope doesn't use pydoc so its
> not an issue for their users. Has anyone found an easy to apply patch
> for pydoc that will list the documentation for classes that use
> implements(). At the moment, it throws an AttributeError and reverts
> to what looks like __repr__.

Twisted also doesn't use pydoc. We use pydoctor, which supports
zope.interface pretty well.

http://codespeak.net/~mwh/pydoctor/

-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From matt at zgroupplc.com  Tue Jun 26 10:27:10 2007
From: matt at zgroupplc.com (Matthew Glubb)
Date: Tue, 26 Jun 2007 17:27:10 +0100
Subject: [Twisted-Python] Pydoc and Zope Interfaces
In-Reply-To: <60ed19d40706260913v132fab14j377d06daad87d2a3@mail.gmail.com>
References: <EBB32E03-4DDB-417F-9C94-F70FD94B0AE6@zgroupplc.com>
	<60ed19d40706260913v132fab14j377d06daad87d2a3@mail.gmail.com>
Message-ID: <2DD3DA13-61CF-47E8-80C9-B4A92914C676@zgroupplc.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Aha! Thanks you very much Christopher :)

On 26 Jun 2007, at 17:13, Christopher Armstrong wrote:

> On 6/26/07, Matthew Glubb <matt at zgroupplc.com> wrote:
>> Hi All,
>>
>> Sorry if this is slightly off-topic but Zope doesn't use pydoc so its
>> not an issue for their users. Has anyone found an easy to apply patch
>> for pydoc that will list the documentation for classes that use
>> implements(). At the moment, it throws an AttributeError and reverts
>> to what looks like __repr__.
>
> Twisted also doesn't use pydoc. We use pydoctor, which supports
> zope.interface pretty well.
>
> http://codespeak.net/~mwh/pydoctor/
>
> -- 
> Christopher Armstrong
> International Man of Twistery
> http://radix.twistedmatrix.com/
> http://twistedmatrix.com/
> http://canonical.com/
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: <http://www.zgroupplc.com/>

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify <service at zgroupplc.com>



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGgT5eyI6MkdKPngkRAkysAKCImSro59ai4r3JSjwiKyI7xuwdcgCeMLcN
rLtqiwYAEtI/YU0zj+PG2vE=
=QLqm
-----END PGP SIGNATURE-----



From apt.shansen at gmail.com  Tue Jun 26 11:03:26 2007
From: apt.shansen at gmail.com (Stephen Hansen)
Date: Tue, 26 Jun 2007 10:03:26 -0700
Subject: [Twisted-Python] twisted.conch.telnet example?
Message-ID: <7a9c25c20706261003h4fcf6543xdece09644999b339@mail.gmail.com>

Hello all. :)

I'm trying to learn Twisted, and to replace irritating telnetlib code for a
simple telnet client application to do so. The problem is I'm slightly lost
as to where to start with the twisted.conch.telnet library, so was wondering
if anyone could point me to a simple example.

So far, I understand the whole client factory thing-- but where I start
getting lost is where we get to the "protocol" point (I know I know-- so
early to get confused!).

Specifically, in the buildProtocol method of a ReconnectingClientFactory
instance.. what should I be returning a subclass of?

There's a telnet.Telnet, which /looks/ like it would be handling all of the
telnet negotiation nicely, but it has methods like "def enableRemote" that
call "self.protocol.enableRemote".. and I'm not sure what should be put
there, or how that should have been handled.

My best success so far was to have it return a subclass of
telnet.StatefulTelnetProtocol. It does the "basis" of what I want: a
line-oriented output from the telnet protocol connection. However, it also
returns all the negotiation characters, so it seems like it's not actually
implementing the telnet negotiation part itself.

Then there's telnet.TelnetBootstrapProtocol which looks very interesting but
looks like its mostly handling telnet features I'm not interested in
(various line modes, screen size negotiation, etc) yet... and a
telnet.TelnetProtocol that I'm very confused by.. it's inheriting from
ITelnetProtocol which appears to define the basic negotiation methods, but
it doesn't appear to -do- anything. (And telnet.Telnet, which does
notinherit from that interface, does appear to support -doing- the
negotiation)

This might all be a lot of babbling, and if so-- sorry! I'm just not sure
where to get started on understanding what's going on in this module to make
use of it. :) I tried googling around to see if I could find a simple
display of gluing the conch modules together to produce a line-oriented
telnet client connection that appeared to handle the negotiation ... just to
get started-- and I can't find one. Does anyone know of one? (Or, if I give
you $0.25, could you throw one together? :))

Thanks in advance.

--S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070626/b5cb5091/attachment.html>

From exarkun at divmod.com  Tue Jun 26 13:08:01 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 26 Jun 2007 15:08:01 -0400
Subject: [Twisted-Python] twisted.conch.telnet example?
In-Reply-To: <7a9c25c20706261003h4fcf6543xdece09644999b339@mail.gmail.com>
Message-ID: <20070626190801.4947.677787221.divmod.quotient.4523@ohm>

On Tue, 26 Jun 2007 10:03:26 -0700, Stephen Hansen <apt.shansen at gmail.com> wrote:
>Hello all. :)

Hey!

>
>I'm trying to learn Twisted, and to replace irritating telnetlib code for a
>simple telnet client application to do so. The problem is I'm slightly lost
>as to where to start with the twisted.conch.telnet library, so was wondering
>if anyone could point me to a simple example.

Cool.  :)

>
>So far, I understand the whole client factory thing-- but where I start
>getting lost is where we get to the "protocol" point (I know I know-- so
>early to get confused!).
>
>Specifically, in the buildProtocol method of a ReconnectingClientFactory
>instance.. what should I be returning a subclass of?

The documentation for this part of Twisted is basically completely
missing.  That'd be my fault, I really should have written some, either
when telnet was implemented or some time in the two years since. ;)

So, to start, I'll try to give a high-level overview.


Then there's t.c.telnet.

>
>There's a telnet.Telnet, which /looks/ like it would be handling all of the
>telnet negotiation nicely, but it has methods like "def enableRemote" that
>call "self.protocol.enableRemote".. and I'm not sure what should be put
>there, or how that should have been handled.

Yep.  t.c.telnet.Telnet is a Protocol subclass and so implements
IProtocol: it is the class which actually implements the telnet
protocol.  It goes right on top of an ITCPTransport and its dataReceived
knows about telnet escapes and the other features of the telnet
protocol.  When it gets bytes which represent some telnet protocol
action, a Telnet instance calls either negotiate or commandReceived on
itself.  The default implementation of these methods dispatches the
event to handlers defined by negotiationMap and
enableLocal/disableLocal/enableRemote/disableRemote, respectively.  In
turn, {enable,disable}{Local,Remote} dispatch to another object,
self.protocol, as you noticed.

There's also a subclass of Telnet, TelnetTransport.  TelnetTransport
takes a protocol class and some arguments to its initializer.  When
TelnetTransport is connected to an ITCPTransport, it instantiates the
class it was given and saves the instance as self.protocol.  As a Telnet
subclass, this means that the protocol class passed to TelnetTransport's
initializer can now control how negotiations happen and how to respond
to commands.

>
>My best success so far was to have it return a subclass of
>telnet.StatefulTelnetProtocol. It does the "basis" of what I want: a
>line-oriented output from the telnet protocol connection. However, it also
>returns all the negotiation characters, so it seems like it's not actually
>implementing the telnet negotiation part itself.
>

StatefulTelnetProtocol is a TelnetProtocol.  TelnetProtocol is the
intended base class for anything which is passed to TelnetTransport.
TelnetProtocol is an ITelnetProtocol, so actually anywhere a
TelnetProtocol class will work, so will any other class which implements
ITelnetProtocol.

TelnetProtocol doesn't know anything about the actual telnet protocol -
its name attempts to convey that it /is/ a protocol /for/ telnet: it can
receive application level bytes (dataReceived, inherited from
IProtocol/Protocol), but it can also handle events which can only happen
when you're using telnet: those four enable/disable methods, plus some
catch-alls for negotiation about options which aren't recognized.  Since
TelnetProtocol doesn't know the telnet protocol, if you hook it directly
up to an ITCPTransport, it'll just think everything it gets is
application data, even telnet negotiation sequences.

>Then there's telnet.TelnetBootstrapProtocol which looks very
>interesting but looks like its mostly handling telnet features I'm not
>interested in (various line modes, screen size negotiation, etc)
>yet... and a telnet.TelnetProtocol that I'm very confused by.. it's
>inheriting from ITelnetProtocol which appears to define the basic
>negotiation methods, but it doesn't appear to -do- anything. (And
>telnet.Telnet, which does notinherit from that interface, does appear
>to support -doing- the negotiation)

TelnetBootstrapProtocol is another one like StatefulTelnetProtocol - it
adds some features which may or may not be interesting, but it won't
work by itself, it needs TelnetTransport to actually parse the protocol.

>
>This might all be a lot of babbling, and if so-- sorry! I'm just not sure
>where to get started on understanding what's going on in this module to make
>use of it. :) I tried googling around to see if I could find a simple
>display of gluing the conch modules together to produce a line-oriented
>telnet client connection that appeared to handle the negotiation ... just to
>get started-- and I can't find one. Does anyone know of one? (Or, if I give
>you $0.25, could you throw one together? :))

Hopefully the above has given you a better idea of what all the pieces
are supposed to be doing.  Here's an example of how you might hook them
up to each other, by way of a client which prints all application data
it receives:

  from twisted.internet import reactor
  from twisted.internet.protocol import ClientFactory
  from twisted.conch.telnet import TelnetTransport, TelnetProtocol

  class TelnetPrinter(TelnetProtocol):
      def dataReceived(self, bytes):
          print 'Received:', repr(bytes)

  class TelnetFactory(ClientFactory):
      def buildProtocol(self, addr):
          return TelnetTransport(TelnetPrinter)

  reactor.connectTCP(host, port, TelnetFactory())

For something line oriented, you might mix in LineReceiver (as
StatefulTelnetProtocol does) or instantiate one directly yourself in a
TelnetProtocol subclass and feed it bytes in your dataReceived
implementation.

Hope this helps,

Jean-Paul



From brendoncolby at gmail.com  Tue Jun 26 15:50:45 2007
From: brendoncolby at gmail.com (Brendon Colby)
Date: Tue, 26 Jun 2007 16:50:45 -0500
Subject: [Twisted-Python] Testing with trial, adbapi questions
In-Reply-To: <cd8fa6f90706260727l667f3e72we349e32ac40260cf@mail.gmail.com>
References: <e64b001e0706250817s223f9833med051053bfa355c5@mail.gmail.com>
	<cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c@mail.gmail.com>
	<e64b001e0706251257p22843735y680c8c64b120e1c5@mail.gmail.com>
	<cd8fa6f90706260727l667f3e72we349e32ac40260cf@mail.gmail.com>
Message-ID: <e64b001e0706261450s4e01a8c6hc8afed78345d2e74@mail.gmail.com>

On 6/26/07, Christian Simms <christian.simms at gmail.com> wrote:
> Looks like I mis-assumed your problem, sorry.  In the setUp method in your
> tests, you should return a Deferred which fires when all your data is
> loaded.  This can be a pain if you already organized your code into classes
> inheriting from twisted.application.service.Service which
> have startService/stopService calls. It's a pain because trial doesn't
> create an application object like running inside twistd does.  So, in the
> case of writing unit tests for applications, you can abstract out your
> initialization code into a method, and then call that method directly in
> your setUp method.

OK - I will work on this and see if I can figure it out. Thanks for the tip.

Brendon



From apt.shansen at gmail.com  Tue Jun 26 17:32:54 2007
From: apt.shansen at gmail.com (Stephen Hansen)
Date: Tue, 26 Jun 2007 16:32:54 -0700
Subject: [Twisted-Python] twisted.conch.telnet example?
In-Reply-To: <20070626190801.4947.677787221.divmod.quotient.4523@ohm>
References: <7a9c25c20706261003h4fcf6543xdece09644999b339@mail.gmail.com>
	<20070626190801.4947.677787221.divmod.quotient.4523@ohm>
Message-ID: <7a9c25c20706261632w47fc7897paab2f5dc70fa0605@mail.gmail.com>

>   class TelnetFactory(ClientFactory):
>       def buildProtocol(self, addr):
>           return TelnetTransport(TelnetPrinter)
>
>   reactor.connectTCP(host, port, TelnetFactory())
>
> For something line oriented, you might mix in LineReceiver (as
> StatefulTelnetProtocol does) or instantiate one directly yourself in a
> TelnetProtocol subclass and feed it bytes in your dataReceived
> implementation.
>
> Hope this helps,


Oh, perfect. That was very useful, thanks. I had a feeling the problem was
in  plugging the objects together properly in buildProtocol, but  just
couldn't see quite how to do it right.

Merci!

--S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070626/86bd856f/attachment.html>

From steven.zdwang at gmail.com  Tue Jun 26 20:02:15 2007
From: steven.zdwang at gmail.com (steven wang)
Date: Wed, 27 Jun 2007 10:02:15 +0800
Subject: [Twisted-Python] How to receive a big stream data?
Message-ID: <5c6c8710706261902u347d25e0lc7375d23ef760dd5@mail.gmail.com>

Dear all,

I'm using the Twisted to write a socket server. I has a problem in the
socket server. I could not receive a big size data when the data size is
bigger then the connection buffersize.

The protocol description:

First, Client send data head to Server.  Head Format:
ABC,123456,XXX,XXX,XXX^
Second, Client send big data to Server, the big data is stream data.
After Server received the big data and then save it to database.

My problem source code :
================================================================================================
class MyProtocol(protocol.Protocol):

        is_big_data = False
        big_data = ''
        big_data_size = 0

    def connectionMade(self):
            self.big_data = ''
            self.big_data_size = 0
            self.is_big_data = False
                pass

    def dataReceived(self, data):

         if check_head_ok(data):
            # To receive the big size data
            if self.is_big_data:
                return

        # The big data will overflow the Twisted receive buffer size, so
loop to receive data
        if is_big_size_data:
                big_data += data

                if big_data_size == len(big_data):
                        # To save data to database
                        ....
                        pass

    def connectionLost(self, reason):
          self.big_data = ''
          self.big_data_size = 0
          self.is_big_data = False
          pass

    def check_head_ok(self, head):
          if data.startswith('ABC'):
                  values = data.split(',')
                  self.big_data_size = int(values[1])
                  self.is_big_data = self.big_data_size > 0
                  return True
          else:
                  return False
================================================================================================

If you know it, Please tell me. Thank you very much! :)


Beat Regards,
Steven. Wang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070627/8d3e9bbc/attachment.html>

From arnarbi at gmail.com  Wed Jun 27 02:21:15 2007
From: arnarbi at gmail.com (Arnar Birgisson)
Date: Wed, 27 Jun 2007 08:21:15 +0000
Subject: [Twisted-Python] How to receive a big stream data?
In-Reply-To: <5c6c8710706261902u347d25e0lc7375d23ef760dd5@mail.gmail.com>
References: <5c6c8710706261902u347d25e0lc7375d23ef760dd5@mail.gmail.com>
Message-ID: <28012bc60706270121k2bae8c8ey60f591e003cf8006@mail.gmail.com>

You're missing "self." in several places..

On 6/27/07, steven wang <steven.zdwang at gmail.com> wrote:
================================================================================================
> class MyProtocol(protocol.Protocol):
>
>          is_big_data = False
>         big_data = ''
>          big_data_size = 0
>
>      def connectionMade(self):
>             self.big_data = ''
>              self.big_data_size = 0
>             self.is_big_data = False
>                  pass
>
>     def dataReceived(self, data):
>
>          if check_head_ok(data):
should be self.check_head_ok(data)

>             # To receive the big size data
>             if self.is_big_data:
>                 return
>
>         # The big data will overflow the Twisted receive buffer size, so
> loop to receive data
>         if is_big_size_data:

self.is_big_size_data

>                 big_data += data

self.big_data

>
>                 if big_data_size == len(big_data):

self.big_data_size == len(self.big_data)

>                         # To save data to database
>                         ....
>                         pass
>
>     def connectionLost(self, reason):
>            self.big_data = ''
>           self.big_data_size = 0
>            self.is_big_data = False
>           pass
>
>     def check_head_ok(self, head):
>            if data.startswith('ABC'):
>                   values = data.split(',')
>                    self.big_data_size = int(values[1])
>                   self.is_big_data = self.big_data_size > 0
>                   return True
>           else:
>                   return False
> ================================================================================================

The check_head_ok also won't work like that. First off you need to
change head to values there - and since dataReceived is called
multiple times, you need to make sure check_head_ok is only called at
the beginning.

Arnar



From steven.zdwang at gmail.com  Wed Jun 27 03:21:17 2007
From: steven.zdwang at gmail.com (steven wang)
Date: Wed, 27 Jun 2007 17:21:17 +0800
Subject: [Twisted-Python] How to receive a big stream data?
In-Reply-To: <28012bc60706270121k2bae8c8ey60f591e003cf8006@mail.gmail.com>
References: <5c6c8710706261902u347d25e0lc7375d23ef760dd5@mail.gmail.com>
	<28012bc60706270121k2bae8c8ey60f591e003cf8006@mail.gmail.com>
Message-ID: <5c6c8710706270221u4f7571dbq511d9fe1ef746da8@mail.gmail.com>

hi!,  This is a clerical error. I rewrite it.

>     def check_head_ok(self, data):
>            if data.startswith('ABC'):
>                   values = data.split(',')
>                    self.big_data_size = int(values[1])
>                   self.is_big_data = self.big_data_size > 0
>                   return True
>           else:
>                   return False
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070627/150b6268/attachment.html>

From rampeters at gmail.com  Wed Jun 27 06:11:04 2007
From: rampeters at gmail.com (Ram Peters)
Date: Wed, 27 Jun 2007 08:11:04 -0400
Subject: [Twisted-Python] Open Source Twisted Email Server
Message-ID: <81b45360706270511v70ee423fj4142585292b81f81@mail.gmail.com>

Is there a Open Source Twisted Email Server that have been implemented?

thnx.



From exarkun at divmod.com  Wed Jun 27 06:17:29 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 27 Jun 2007 08:17:29 -0400
Subject: [Twisted-Python] Open Source Twisted Email Server
In-Reply-To: <81b45360706270511v70ee423fj4142585292b81f81@mail.gmail.com>
Message-ID: <20070627121729.4947.52789419.divmod.quotient.4664@ohm>

On Wed, 27 Jun 2007 08:11:04 -0400, Ram Peters <rampeters at gmail.com> wrote:
>Is there a Open Source Twisted Email Server that have been implemented?

There are several, including one in Twisted itself.  Whether any of them are
appropriate for any particular purpose may be up for discussion (a good
beginning to which might be specifying what particular purpose you have in
mind ;).

Jean-Paul



From markus at bluegap.ch  Wed Jun 27 06:46:47 2007
From: markus at bluegap.ch (Markus Schiltknecht)
Date: Wed, 27 Jun 2007 14:46:47 +0200
Subject: [Twisted-Python] profiling twisted
Message-ID: <46825C37.7060100@bluegap.ch>

Hi,

first of all, thank you very much for this great peace of software, I'm 
using twisted for many different projects and really enjoy it's clean 
and simple design.

Now, I'm wondering if there's a profiling tool, which can quickly tell 
me what events are blocking my server. I have even deferred the file I/O 
to separate threads, as I've suspected them to make the server behave 
poorly when under load. But there still seems to be something 
blocking...  What do you use to find the callbacks which block (for too 
long)?

Regards

Markus



From mcfletch at vrplumber.com  Wed Jun 27 07:23:44 2007
From: mcfletch at vrplumber.com (Mike C. Fletcher)
Date: Wed, 27 Jun 2007 09:23:44 -0400
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <46825C37.7060100@bluegap.ch>
References: <46825C37.7060100@bluegap.ch>
Message-ID: <468264E0.3030507@vrplumber.com>

Markus Schiltknecht wrote:
...
> Now, I'm wondering if there's a profiling tool, which can quickly tell 
> me what events are blocking my server. I have even deferred the file 
> I/O to separate threads, as I've suspected them to make the server 
> behave poorly when under load. But there still seems to be something 
> blocking...  What do you use to find the callbacks which block (for 
> too long)?
http://blog.vrplumber.com/1353

HTH,
Mike

-- 
________________________________________________
  Mike C. Fletcher
  Designer, VR Plumber, Coder
  http://www.vrplumber.com
  http://blog.vrplumber.com




From markus at bluegap.ch  Wed Jun 27 08:32:07 2007
From: markus at bluegap.ch (Markus Schiltknecht)
Date: Wed, 27 Jun 2007 16:32:07 +0200
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <468264E0.3030507@vrplumber.com>
References: <46825C37.7060100@bluegap.ch> <468264E0.3030507@vrplumber.com>
Message-ID: <468274E7.4070301@bluegap.ch>

Hi,

Mike C. Fletcher wrote:
> http://blog.vrplumber.com/1353

Thanks, nice article. And I've tried that code snipped, but it didn't 
help much in my case, as response times are below 1 second.

Please see these measurements, taken with apache bench. I'm testing 
response times on a simple status resource, which doesn't take long to 
calculate (i.e. doesn't even throw a deferred, but returns a response 
immediately):

Document Path:          /status
Document Length:        202 bytes

Concurrency Level:      10
Time taken for tests:   0.202266 seconds
Complete requests:      100
Failed requests:        0
Write errors:           0
Total transferred:      38400 bytes
HTML transferred:       20200 bytes
Requests per second:    494.40 [#/sec] (mean)
Time per request:       20.227 [ms] (mean)
Time per request:       2.023 [ms] (mean, across all concurrent requests)
Transfer rate:          182.93 [Kbytes/sec] received


Now, measured while the server is under very small load:

Document Path:          /status
Document Length:        202 bytes

Concurrency Level:      10
Time taken for tests:   4.103465 seconds
Complete requests:      100
Failed requests:        0
Write errors:           0
Total transferred:      38400 bytes
HTML transferred:       20200 bytes
Requests per second:    24.37 [#/sec] (mean)
Time per request:       410.347 [ms] (mean)
Time per request:       41.035 [ms] (mean, across all concurrent requests)
Transfer rate:          9.02 [Kbytes/sec] received


When putting the server under real load, those response times climb up 
to two seconds, so there must be something wrong.

Can I somehow get the reactor's state, i.e. how many deferreds are 
waiting in the queue, how many threads are running concurrently, etc?

How good is the idea of deferring File I/O to threads, i.e. 
threads.deferToThread(self.filehandle.write, data)? Another possibly 
blocking module might be the database api, but I'm using twisted's 
enterprise adbapi, which should be async, AFAICT.

Maybe copying data around takes time. I'm sending around chunks of 64k 
size (streaming from the database to an external programm). Reducing 
chunk size to 1k helps somewhat (i.e. response time is seldom over 
150ms, but can still climb up to > 0.5 seconds).

Hum... external program.... maybe it's the self.transport.write() call 
which blocks several 100ms? Is it safe to write:

   d = threads.deferToThread(self.transport.write, dataChunk)

(i.e. call transport.write from a thread?)

How much resources do these deferToThread() deferreds eat? AFAICT, the 
reactor prepares a thread pool, which leads me to think that it's a well 
optimized implementation...

Regards

Markus





From exarkun at divmod.com  Wed Jun 27 09:08:45 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 27 Jun 2007 11:08:45 -0400
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <468274E7.4070301@bluegap.ch>
Message-ID: <20070627150845.4947.1679165983.divmod.quotient.4689@ohm>

On Wed, 27 Jun 2007 16:32:07 +0200, Markus Schiltknecht <markus at bluegap.ch> wrote:
>Hi,
>
>Mike C. Fletcher wrote:
>>http://blog.vrplumber.com/1353
>
>Thanks, nice article. And I've tried that code snipped, but it didn't help 
>much in my case, as response times are below 1 second.

You could try twistd --profile or one of the other Python profilers.

Jean-Paul



From jj.peeters at gmail.com  Wed Jun 27 09:19:34 2007
From: jj.peeters at gmail.com (Julien Peeters)
Date: Wed, 27 Jun 2007 17:19:34 +0200
Subject: [Twisted-Python] How work ldaptor and twisted
Message-ID: <1182957574.3798.7.camel@troll>

Hi everybody,

I'm new to ldaptor and twisted. I don't really understand how twisted
work and how can I build a little application with them.

I would like to make a mini app which offers me the possibility to
administrate very simply my ldap server.
Then, the app have to wait for orders, and when it receive one, treat it
by sending the appropriate request via ldaptor.

My problem is with twisted, and more precisely with the "reactor". I
don't really understand how I can manipulate it and what is the place of
defered's in all that?

Thanks,
Julien.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20070627/61f5a702/attachment.sig>

From matt at zgroupplc.com  Wed Jun 27 09:40:02 2007
From: matt at zgroupplc.com (Matthew Glubb)
Date: Wed, 27 Jun 2007 16:40:02 +0100
Subject: [Twisted-Python] How work ldaptor and twisted
In-Reply-To: <1182957574.3798.7.camel@troll>
References: <1182957574.3798.7.camel@troll>
Message-ID: <52AD267A-1BE9-417F-9B24-3EE65DAE6CC4@zgroupplc.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Julien,

Have a look at the documentation on the twisted website:

<http://twistedmatrix.com/projects/core/documentation/howto/index.html>

Its pretty good at giving you an overview of how twisted works. You  
might want to have a general read about the difference between  
asynchronous event programming and programming with threads.

Hope that helps,


Matt

On 27 Jun 2007, at 16:19, Julien Peeters wrote:

> Hi everybody,
>
> I'm new to ldaptor and twisted. I don't really understand how twisted
> work and how can I build a little application with them.
>
> I would like to make a mini app which offers me the possibility to
> administrate very simply my ldap server.
> Then, the app have to wait for orders, and when it receive one,  
> treat it
> by sending the appropriate request via ldaptor.
>
> My problem is with twisted, and more precisely with the "reactor". I
> don't really understand how I can manipulate it and what is the  
> place of
> defered's in all that?
>
> Thanks,
> Julien.
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: <http://www.zgroupplc.com/>

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify <service at zgroupplc.com>



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGgoTVyI6MkdKPngkRAnGkAJwJJEdvR0pIrxWdfBWdCRWaBfR7TwCfRzsz
LZb2FVJ5+LuAttTd5cMldqY=
=Sj7a
-----END PGP SIGNATURE-----



From glyph at divmod.com  Wed Jun 27 10:32:12 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Wed, 27 Jun 2007 16:32:12 -0000
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <468274E7.4070301@bluegap.ch>
References: <46825C37.7060100@bluegap.ch> <468264E0.3030507@vrplumber.com>
	<468274E7.4070301@bluegap.ch>
Message-ID: <20070627163212.8429.1578659222.divmod.xquotient.137@joule.divmod.com>

On 02:32 pm, markus at bluegap.ch wrote:
>Requests per second:    494.40 [#/sec] (mean)

>Now, measured while the server is under very small load:

>Requests per second:    24.37 [#/sec] (mean)

>When putting the server under real load, those response times climb up 
>to

What is 'real load'?  Are you talking about things in process with, but 
not related to, the web server?
>two seconds, so there must be something wrong.

Maybe your server is slow? :)
>Can I somehow get the reactor's state, i.e. how many deferreds are 
>waiting in the queue, how many threads are running concurrently, etc?

There is no queue of Deferreds.  They don't actually have anything to do 
with the reactor.
>How good is the idea of deferring File I/O to threads, i.e. 
>threads.deferToThread(self.filehandle.write, data)?

If you do indeed discover that you are waiting a long time to write your 
particular stuff to files, then that might help.  It might also randomly 
interleave the data and corrupt your files, if 'data' is big enough.
>Another possibly blocking module might be the database api, but I'm 
>using twisted's enterprise adbapi, which should be async, AFAICT.

It does the operations in threads, yes.  However, the threadpool will 
eventually fill up; the concurrency is fairly limited.  (The default is 
10 or so workers, I think).
>Maybe copying data around takes time. I'm sending around chunks of 64k 
>size (streaming from the database to an external programm). Reducing 
>chunk size to 1k helps somewhat (i.e. response time is seldom over 
>150ms, but can still climb up to > 0.5 seconds).

That's a possibility that the "--profile" option to twistd which JP 
suggested might help you with.  You'll see the functions copying data 
taking a lot of CPU time in that case.
>Hum... external program.... maybe it's the self.transport.write() call 
>which blocks several 100ms? Is it safe to write:
>
>   d = threads.deferToThread(self.transport.write, dataChunk)
>
>(i.e. call transport.write from a thread?)

No.  _All_ Twisted APIs are not thread safe.  This call does not block 
though, and it is extremely, vanishingly unlikely that it is causing 
your problems.  It just sticks some data into the outgoing queue and 
returns immediately.
>How much resources do these deferToThread() deferreds eat? AFAICT, the 
>reactor prepares a thread pool, which leads me to think that it's a 
>well optimized implementation...

It's not particularly "optimized", in the sense that we haven't measured 
the performance or improved it much, but it's also not doing very much; 
put a value into a queue, get it out in a thread, do it: that's about 
all.  It would certainly surprise me if that operation were taking 
100ms.

One quick measurement you can do to determine what might be causing this 
performance loss is to examine the server in 'top' while it is allegedly 
under load.  Is it taking up 100% CPU?  If not, then it's probably 
blocked on some kind of I/O in your application, or perhaps writing the 
log.  If so, then there's some inefficient application code (or Twisted 
code) that you need to profile and optimize.  The output of "strace -T" 
on your Twisted server *might* be useful if you discover that you're 
blocking on some kind of I/O.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070627/52ac8e14/attachment.html>

From maarten at treewalker.org  Wed Jun 27 11:04:18 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Wed, 27 Jun 2007 19:04:18 +0200
Subject: [Twisted-Python] profiling twisted
In-Reply-To: <46825C37.7060100@bluegap.ch>
References: <46825C37.7060100@bluegap.ch>
Message-ID: <200706271904.18667.maarten@treewalker.org>

On Wednesday 27 June 2007, Markus Schiltknecht wrote:

> Now, I'm wondering if there's a profiling tool, which can quickly tell
> me what events are blocking my server. I have even deferred the file I/O
> to separate threads, as I've suspected them to make the server behave
> poorly when under load. But there still seems to be something
> blocking...  What do you use to find the callbacks which block (for too
> long)?

Does your server process use a lot of memory?

I had problems with a random simple request taking a long time every now and 
then and it turned out to be the Python garbage collector. The collection 
itself can take some time if you have a lot of objects. If some of the Python 
process ends up in the swap instead of main memory, garbage collection will 
block until it is swapped back in, which can slow it down dramatically.

Using multiple threads does not give you any performance advantage in this 
case: during garbage collection the entire Python VM is frozen.

One thing you could try is:
  import gc
  gc.disable()
in the startup code of your server.

Note that this does not turn off all memory recycling; it only turns off the 
mark-and-sweep part of the garbage collector. Objects which have a zero 
reference count are still collected.

Bye,
		Maarten



From edgardo.delgado at navy.mil  Wed Jun 27 12:16:17 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Wed, 27 Jun 2007 14:16:17 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED592234A176C@naeapaxrez05.nadsusea.nads.navy.mil>

OK, I got the portforwarding stuff done using protocols.portforward.
But this is good for 1:1 relationship, i.e. listen on one port and
forwarding to another.
What I need is a 1:many relationship, i.e. listen on one port and
forwarding to many ports.

Edgar 

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Delgado,
Edgardo CIV NAVAIR 4.1.4.3
Sent: Wednesday, June 20, 2007 10:16 AM
To: twisted-python at twistedmatrix.com
Subject: [Twisted-Python] Server/Client

I would like to build a server that when it gets a message on a specific
port it will "forward" that message to another port.
I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
will forward the data to "Server2" listening on port 15000.

Edgar


_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From adam at atlas.st  Wed Jun 27 12:33:16 2007
From: adam at atlas.st (Adam Atlas)
Date: Wed, 27 Jun 2007 14:33:16 -0400
Subject: [Twisted-Python] Implementing streaming (broadcast) TCP servers
Message-ID: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>

I'm working on a server that will be streaming the same data from a  
source to many clients. It has to be invoked from an HTTP server, so  
I'm using twisted.web2 (not twisted.web because it also needs to host  
a WSGI application). In other words, calling GET on a certain path  
results in the stream as the response, at which point I don't really  
need any more HTTP functionality. I have it working... currently, the  
basic process is: I have a class implementing IByteStream, an  
instance of which is created for each client; it simply keeps a queue  
of data to be sent, sending one piece with each call to read(), or a  
sending a Deferred if the queue is empty. Meanwhile, the part of the  
application that provides the data (a different server, receiving  
data from a broadcaster) adds the data to all the clients' byte  
stream queues, whenever it receives a piece of data.

Since efficiency is obviously important for a streaming server, I was  
just wondering if anyone had any efficiency tips. I've tested it with  
at most 64 concurrent clients. There doesn't seem to be any slowdown  
from the clients' perspective (the data is coming in at the rate it  
should), but server-side, CPU and memory usage start increasing  
pretty quickly. Especially CPU -- with 64 clients, CPU usage peaked  
at 26.8%, which is not acceptable. Any thoughts? Is there a better  
way to handle the streaming process as I previously described?

- Adam




From jj.peeters at gmail.com  Wed Jun 27 12:37:22 2007
From: jj.peeters at gmail.com (Julien Peeters)
Date: Wed, 27 Jun 2007 20:37:22 +0200
Subject: [Twisted-Python] How work ldaptor and twisted
In-Reply-To: <52AD267A-1BE9-417F-9B24-3EE65DAE6CC4@zgroupplc.com>
References: <1182957574.3798.7.camel@troll>
	<52AD267A-1BE9-417F-9B24-3EE65DAE6CC4@zgroupplc.com>
Message-ID: <1182969442.3798.19.camel@troll>

I read all these but I don't understand how do I have to use the
deferred return by the connect method from the LDAPClient

c = ldapconnector.LDAPClientCreator(reactor, pureldap.LDAPClient)
d = c.connect('...')

I don't understand why I have to add all my callback's to this deferred.
If I understand the meaning of a deferred, it represent a result that
will be return. And then, once connected, the deferred have no sense
anymore for me...

For example this code:
	def fun(proto):
		d = proto.send(request)
		d.addCallback(responseHandler)
		return d

I don't understand why I have to return the deferred and how it interact
with something else.

Globally, I understand what is the reactor, what is a deferred, how can
I make a client, a server. My problem state in the interaction of these
concepts. The link between them from a technical and implementational
point of view.

There is some detailed sequence diagrams some where I can found?

I suppose I miss an important part of the concepts, but I don't know
what.

Julien.

On Wed, 2007-06-27 at 16:40 +0100, Matthew Glubb wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hi Julien,
> 
> Have a look at the documentation on the twisted website:
> 
> <http://twistedmatrix.com/projects/core/documentation/howto/index.html>
> 
> Its pretty good at giving you an overview of how twisted works. You  
> might want to have a general read about the difference between  
> asynchronous event programming and programming with threads.
> 
> Hope that helps,
> 
> 
> Matt
> 
> On 27 Jun 2007, at 16:19, Julien Peeters wrote:
> 
> > Hi everybody,
> >
> > I'm new to ldaptor and twisted. I don't really understand how twisted
> > work and how can I build a little application with them.
> >
> > I would like to make a mini app which offers me the possibility to
> > administrate very simply my ldap server.
> > Then, the app have to wait for orders, and when it receive one,  
> > treat it
> > by sending the appropriate request via ldaptor.
> >
> > My problem is with twisted, and more precisely with the "reactor". I
> > don't really understand how I can manipulate it and what is the  
> > place of
> > defered's in all that?
> >
> > Thanks,
> > Julien.
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
> 
> 
> m a t t h e w   g l u b b
> 
> ________________________________________________________________________
> Z Group PLC
> 
> Tel: +44 (0) 8700 111 173
> Fax: +44 (0) 8707 051 393
> Txt: +44 (0) 7800 140 877
> Web: <http://www.zgroupplc.com/>
> 
> This  email  and  any  files  transmitted  with it are  confidential and
> intended solely for the use of the individual or entity to whom they are
> addressed.  The opinions  expressed in this mail are those of the author
> and do not necessarily  represent the views of the company.  If you have
> received this email in error please notify <service at zgroupplc.com>
> 
> 
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.1 (Darwin)
> 
> iD8DBQFGgoTVyI6MkdKPngkRAnGkAJwJJEdvR0pIrxWdfBWdCRWaBfR7TwCfRzsz
> LZb2FVJ5+LuAttTd5cMldqY=
> =Sj7a
> -----END PGP SIGNATURE-----
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20070627/9a804af7/attachment.sig>

From adelagon at gmail.com  Wed Jun 27 19:55:25 2007
From: adelagon at gmail.com (Alvin Delagon)
Date: Thu, 28 Jun 2007 09:55:25 +0800
Subject: [Twisted-Python] Server/Client
In-Reply-To: <0C8FBA9C0F70E1479497B4DD7ED592234A176C@naeapaxrez05.nadsusea.nads.navy.mil>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil>
	<0C8FBA9C0F70E1479497B4DD7ED592234A176C@naeapaxrez05.nadsusea.nads.navy.mil>
Message-ID: <7a01f6c00706271855j4ac6e83l8a06078fbd0b200f@mail.gmail.com>

Suggestion:

If data reliability is not an issue, it's pretty much easier to do it using
UDP (twisted.internet.protocol.DatagramProtocol). You won't need to deal
with connections.

"What I need is a 1:many relationship, i.e. listen on one port and
forwarding to many ports."

A UDP MulticastServer is what you need. ^_^

On 6/28/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3 <edgardo.delgado at navy.mil>
wrote:
>
> OK, I got the portforwarding stuff done using protocols.portforward.
> But this is good for 1:1 relationship, i.e. listen on one port and
> forwarding to another.
> What I need is a 1:many relationship, i.e. listen on one port and
> forwarding to many ports.
>
> Edgar
>
> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com
> [mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Delgado,
> Edgardo CIV NAVAIR 4.1.4.3
> Sent: Wednesday, June 20, 2007 10:16 AM
> To: twisted-python at twistedmatrix.com
> Subject: [Twisted-Python] Server/Client
>
> I would like to build a server that when it gets a message on a specific
> port it will "forward" that message to another port.
> I.e. "Server1" listens on port 10000. When it gets data on port 10000 it
> will forward the data to "Server2" listening on port 15000.
>
> Edgar
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070628/daf2b711/attachment.html>

From nico at tekNico.net  Thu Jun 28 02:11:55 2007
From: nico at tekNico.net (Nicola Larosa)
Date: Thu, 28 Jun 2007 10:11:55 +0200
Subject: [Twisted-Python] Google used Twisted...
Message-ID: <46836D4B.7010702@tekNico.net>

...but nobody should know: ;-)

http://twistedmatrix.com/trac/wiki/WikiStart?action=diff&version=42&old_version=38

(And apparently they still use it: )

http://www.oreillynet.com/onlamp/blog/2007/06/python_web_application_framewo.html

oubiwann: what's up?


-- 
Nicola Larosa - http://www.tekNico.net/

Q: Aside from Dojo, what is your favorite Ajax framework? A: MochiKit.
YUI is great code too, but MochiKit has it beat for clarity of vision
and implementation quality. Bob Ippolito gets the constraints of the
web. That, and I'm a Python guy at heart. -- Alex Russell, August 2006





From edgardo.delgado at navy.mil  Thu Jun 28 07:00:49 2007
From: edgardo.delgado at navy.mil (Delgado, Edgardo  CIV NAVAIR 4.1.4.3)
Date: Thu, 28 Jun 2007 09:00:49 -0400
Subject: [Twisted-Python] Server/Client
In-Reply-To: <7a01f6c00706271855j4ac6e83l8a06078fbd0b200f@mail.gmail.com>
References: <0C8FBA9C0F70E1479497B4DD7ED592233D7C7C@naeapaxrez05.nadsusea.nads.navy.mil><0C8FBA9C0F70E1479497B4DD7ED592234A176C@naeapaxrez05.nadsusea.nads.navy.mil>
	<7a01f6c00706271855j4ac6e83l8a06078fbd0b200f@mail.gmail.com>
Message-ID: <0C8FBA9C0F70E1479497B4DD7ED592234A19D1@naeapaxrez05.nadsusea.nads.navy.mil>

I already took a look at UDP, but we need data reliability so can't use
UDP. :-(

Thx,
Edgar

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Alvin
Delagon
Sent: Wednesday, June 27, 2007 9:55 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Server/Client

Suggestion:

If data reliability is not an issue, it's pretty much easier to do it
using UDP (twisted.internet.protocol.DatagramProtocol). You won't need
to deal with connections. 

"What I need is a 1:many relationship, i.e. listen on one port and
forwarding to many ports."

A UDP MulticastServer is what you need. ^_^


On 6/28/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
<edgardo.delgado at navy.mil> wrote:

	OK, I got the portforwarding stuff done using
protocols.portforward.
	But this is good for 1:1 relationship, i.e. listen on one port
and
	forwarding to another.
	What I need is a 1:many relationship, i.e. listen on one port
and 
	forwarding to many ports.
	
	Edgar
	
	-----Original Message-----
	From: twisted-python-bounces at twistedmatrix.com
	[mailto: twisted-python-bounces at twistedmatrix.com
<mailto:twisted-python-bounces at twistedmatrix.com> ] On Behalf Of
Delgado,
	Edgardo CIV NAVAIR 4.1.4.3
	Sent: Wednesday, June 20, 2007 10:16 AM
	To: twisted-python at twistedmatrix.com
<mailto:twisted-python at twistedmatrix.com> 
	Subject: [Twisted-Python] Server/Client
	
	I would like to build a server that when it gets a message on a
specific
	port it will "forward" that message to another port. 
	I.e. "Server1" listens on port 10000. When it gets data on port
10000 it
	will forward the data to "Server2" listening on port 15000.
	
	Edgar
	
	
	_______________________________________________ 
	Twisted-Python mailing list
	Twisted-Python at twistedmatrix.com
	http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

	
	_______________________________________________
	Twisted-Python mailing list
	Twisted-Python at twistedmatrix.com
	http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
<http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python> 
	





From zmola at acm.org  Thu Jun 28 07:32:03 2007
From: zmola at acm.org (Carl Zmola)
Date: Thu, 28 Jun 2007 09:32:03 -0400
Subject: [Twisted-Python] Implementing streaming (broadcast) TCP servers
In-Reply-To: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>
Message-ID: <4683B853.7080700@acm.org>

Adam,

In general, if you are streaming different data to each client, it is
going to be expensive.  There really are only 3 areas to optimize

1) disk IO  --  Read in bigger chunks and make sure you flush your
buffer.  You might want to drop into C and write your buffering or find
a good "ring buffer"  (big array that you reuse for the stream) so you
don't have to allocate and  deallocate memory all the time.
2) Network IO  -- check what protocol you can use.  If you can get away
with lossy streaming, UDP or RTCP might be wins.
3) CPU -- Profile your application and see where the time is being
spent.  You need to be careful about memory copying and allocation.
Python normally handles this well, so this probably isn't the problem.

OOPS,  I just realized that you said the same data to multiple clients.
Is the data the same at the same time, meaning the clients are all
getting the same data simultaneously?  If so, if you have any control
over the network, then UDP Multicast can be a big win.  You would only
be sending out one stream of data and everyone would hear it.

Also, I would look at making sure that you are not copying data around much.

I must admit that my Knowledge of all the twisted classes that are
available is limited, so I don't know what class to use but I would
suggest dropping in to the low level classes below web2 since you will
need a little more control for this than normal web applications.

Carl
zmola at acm.org



Adam Atlas wrote:
> I'm working on a server that will be streaming the same data from a 
> source to many clients. It has to be invoked from an HTTP server, so 
> I'm using twisted.web2 (not twisted.web because it also needs to host 
> a WSGI application). In other words, calling GET on a certain path 
> results in the stream as the response, at which point I don't really 
> need any more HTTP functionality. I have it working... currently, the 
> basic process is: I have a class implementing IByteStream, an instance 
> of which is created for each client; it simply keeps a queue of data 
> to be sent, sending one piece with each call to read(), or a sending a 
> Deferred if the queue is empty. Meanwhile, the part of the application 
> that provides the data (a different server, receiving data from a 
> broadcaster) adds the data to all the clients' byte stream queues, 
> whenever it receives a piece of data.
>
> Since efficiency is obviously important for a streaming server, I was 
> just wondering if anyone had any efficiency tips. I've tested it with 
> at most 64 concurrent clients. There doesn't seem to be any slowdown 
> from the clients' perspective (the data is coming in at the rate it 
> should), but server-side, CPU and memory usage start increasing pretty 
> quickly. Especially CPU -- with 64 clients, CPU usage peaked at 26.8%, 
> which is not acceptable. Any thoughts? Is there a better way to handle 
> the streaming process as I previously described?
>
> - Adam
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python





From adam at atlas.st  Thu Jun 28 09:44:27 2007
From: adam at atlas.st (Adam Atlas)
Date: Thu, 28 Jun 2007 11:44:27 -0400
Subject: [Twisted-Python] Implementing streaming (broadcast) TCP servers
In-Reply-To: <4683B853.7080700@acm.org>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>
	<4683B853.7080700@acm.org>
Message-ID: <2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>


On 28 Jun 2007, at 09.32, Carl Zmola wrote:
> 3) CPU -- Profile your application and see where the time is being
> spent.  You need to be careful about memory copying and allocation.
> Python normally handles this well, so this probably isn't the problem.

Ah, good point. I'll try that.

> OOPS,  I just realized that you said the same data to multiple  
> clients.
> Is the data the same at the same time, meaning the clients are all
> getting the same data simultaneously?  If so, if you have any control
> over the network, then UDP Multicast can be a big win.  You would only
> be sending out one stream of data and everyone would hear it.

It is indeed being sent at the same time, but unfortunately I'm not  
designing the protocol. I'm implementing an existing one that only  
runs over HTTP.

> Also, I would look at making sure that you are not copying data  
> around much.

I was definitely paying attention to that. I'm using Python's  
`buffer` type when possible to prevent any duplication of data;  
ideally, there's only one real copy of it in memory, and a bunch of  
buffers pointing to it... then it can be garbage collected once it's  
been sent to all clients.

> I must admit that my Knowledge of all the twisted classes that are
> available is limited, so I don't know what class to use but I would
> suggest dropping in to the low level classes below web2 since you will
> need a little more control for this than normal web applications.

I had similar thoughts... I was thinking, once I had the connection  
established, I could try to bypass web2's IByteStream stuff and try  
to use transport.write directly. Do you think that would help? It's  
less runloopy overhead, at least.



From glyph at divmod.com  Thu Jun 28 12:12:32 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 28 Jun 2007 18:12:32 -0000
Subject: [Twisted-Python] Google used Twisted...
In-Reply-To: <46836D4B.7010702@tekNico.net>
References: <46836D4B.7010702@tekNico.net>
Message-ID: <20070628181232.8429.218263044.divmod.xquotient.169@joule.divmod.com>

On 08:11 am, nico at teknico.net wrote:
>...but nobody should know: ;-)
>(And apparently they still use it: )

Much as I'd love to brag about this, I think it's slightly jumping the 
gun :).  To my knowledge, Jot Live was the part of Jotspot that used 
Twisted, and it was discontinued or something.  The second link was just 
some guy at Google who read about Twisted and then presented something 
about it.

Google seems to be pretty good to the open source projects that they 
really use.  If they do start using it in earnest, I'm sure we'll hear 
about it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070628/e51346bf/attachment.html>

From glyph at divmod.com  Thu Jun 28 12:32:41 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 28 Jun 2007 18:32:41 -0000
Subject: [Twisted-Python] take my tickets, please
Message-ID: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>

According to the Twisted tracker, I currently have 142 tickets.

Many of these are simply because I'm the default assignee of the default 
"core" component, so almost all new tickets end up in my list.

It's getting to the point where I don't even have time to triage all the 
tickets assigned to me, let alone work on them.

If anyone is looking for stuff to do to help out Twisted, triaging all 
of the 'normal', 'core' tickets assigned to me would be a big help.  Not 
only would it circulate tickets to more appropriate people to be working 
on them than me, it will also generally make me feel less discouraged 
when I look at the apparently infinite amount of work I have to do.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070628/5de68aea/attachment.html>

From eprparadocs at gmail.com  Thu Jun 28 12:44:41 2007
From: eprparadocs at gmail.com (Chas.)
Date: Thu, 28 Jun 2007 14:44:41 -0400
Subject: [Twisted-Python] take my tickets, please
In-Reply-To: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>
References: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>
Message-ID: <2f66cbb30706281144s4875ad51qe4769c9fba5db299@mail.gmail.com>

Let me know if I can help out...either triaging the tickets or fixing the
'easier' things right now.

C.

On 6/28/07, glyph at divmod.com <glyph at divmod.com> wrote:
>
> According to the Twisted tracker, I currently have 142 tickets.
>
> Many of these are simply because I'm the default assignee of the default
> "core" component, so almost all new tickets end up in my list.
>
> It's getting to the point where I don't even have time to triage all the
> tickets assigned to me, let alone work on them.
>
> If anyone is looking for stuff to do to help out Twisted, triaging all of
> the 'normal', 'core' tickets assigned to me would be a big help.  Not only
> would it circulate tickets to more appropriate people to be working on them
> than me, it will also generally make me feel less discouraged when I look at
> the apparently infinite amount of work I have to do.
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070628/d6b8c561/attachment.html>

From adam at atlas.st  Thu Jun 28 14:27:32 2007
From: adam at atlas.st (Adam Atlas)
Date: Thu, 28 Jun 2007 16:27:32 -0400
Subject: [Twisted-Python] Implementing streaming (broadcast) TCP servers
In-Reply-To: <2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>
	<4683B853.7080700@acm.org>
	<2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>
Message-ID: <A023DDB6-8B23-4749-B80C-B2B379DD78B8@atlas.st>


On 28 Jun 2007, at 11.44, Adam Atlas wrote:
> I had similar thoughts... I was thinking, once I had the connection  
> established, I could try to bypass web2's IByteStream stuff and try  
> to use transport.write directly. Do you think that would help? It's  
> less runloopy overhead, at least.

For the record, this seems to be working. I rewrote it to work like  
this, and I was able to pump it up to 64 clients again (me  
broadcasting to the remote server from my own computer, and then  
starting 64 clients on my own computer) but CPU and memory usage were  
much better. CPU was standing around 1.5% and memory around 3.6%. (I  
know these could still be considered SORT OF high, but this is  
actually a vserver where both of these resources are quite limited --  
only 480 MB of the real server's memory.)

However, once all the clients disconnect, the memory doesn't seem to  
go back down to the expected level. Any ideas on where I should start  
looking to solve this?



From glyph at divmod.com  Thu Jun 28 17:44:18 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 28 Jun 2007 23:44:18 -0000
Subject: [Twisted-Python] take my tickets, please
In-Reply-To: <2f66cbb30706281144s4875ad51qe4769c9fba5db299@mail.gmail.com>
References: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>
	<2f66cbb30706281144s4875ad51qe4769c9fba5db299@mail.gmail.com>
Message-ID: <20070628234418.8429.1522579992.divmod.xquotient.218@joule.divmod.com>


On 06:44 pm, eprparadocs at gmail.com wrote:
>Let me know if I can help out...either triaging the tickets or fixing 
>the
>'easier' things right now.

I thought that's what I was doing :).

Don't worry about trying to triage controversial or confusing stuff, or 
reprioritize too much; just closing the obvious duplicates and 
reassigning things that have their component set blatantly wrong would 
be a lot of help.

And of course, *any* ticket that you want to steal and fix would be 
fine.
>On 6/28/07, glyph at divmod.com <glyph at divmod.com> wrote:
>>
>>According to the Twisted tracker, I currently have 142 tickets.
>>
>>Many of these are simply because I'm the default assignee of the 
>>default
>>"core" component, so almost all new tickets end up in my list.
>>
>>It's getting to the point where I don't even have time to triage all 
>>the
>>tickets assigned to me, let alone work on them.
>>
>>If anyone is looking for stuff to do to help out Twisted, triaging all 
>>of
>>the 'normal', 'core' tickets assigned to me would be a big help.  Not 
>>only
>>would it circulate tickets to more appropriate people to be working on 
>>them
>>than me, it will also generally make me feel less discouraged when I 
>>look at
>>the apparently infinite amount of work I have to do.
>>
>>_______________________________________________
>>Twisted-Python mailing list
>>Twisted-Python at twistedmatrix.com
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070628/77dae2fe/attachment.html>

From eprparadocs at gmail.com  Thu Jun 28 17:58:33 2007
From: eprparadocs at gmail.com (Chas.)
Date: Thu, 28 Jun 2007 19:58:33 -0400
Subject: [Twisted-Python] take my tickets, please
In-Reply-To: <20070628234418.8429.1522579992.divmod.xquotient.218@joule.divmod.com>
References: <20070628183241.8429.495916389.divmod.xquotient.176@joule.divmod.com>
	<2f66cbb30706281144s4875ad51qe4769c9fba5db299@mail.gmail.com>
	<20070628234418.8429.1522579992.divmod.xquotient.218@joule.divmod.com>
Message-ID: <2f66cbb30706281658x5a4b72eq461bbc6e1c80df2d@mail.gmail.com>

How does one get started?

C.

On 6/28/07, glyph at divmod.com <glyph at divmod.com> wrote:
>
>
> On 06:44 pm, eprparadocs at gmail.com wrote:
> >Let me know if I can help out...either triaging the tickets or fixing the
> >'easier' things right now.
>
> I thought that's what I was doing :).
>
> Don't worry about trying to triage controversial or confusing stuff, or
> reprioritize too much; just closing the obvious duplicates and reassigning
> things that have their component set blatantly wrong would be a lot of help.
>
> And of course, *any* ticket that you want to steal and fix would be fine.
>
>
> >On 6/28/07, glyph at divmod.com <glyph at divmod.com> wrote:
> >>
> >>According to the Twisted tracker, I currently have 142 tickets.
> >>
> >>Many of these are simply because I'm the default assignee of the default
> >>"core" component, so almost all new tickets end up in my list.
> >>
> >>It's getting to the point where I don't even have time to triage all the
> >>tickets assigned to me, let alone work on them.
> >>
> >>If anyone is looking for stuff to do to help out Twisted, triaging all
> of
> >>the 'normal', 'core' tickets assigned to me would be a big help.  Not
> only
> >>would it circulate tickets to more appropriate people to be working on
> them
> >>than me, it will also generally make me feel less discouraged when I
> look
> >>at
> >>the apparently infinite amount of work I have to do.
> >>
> >>_______________________________________________
> >>Twisted-Python mailing list
> >>Twisted-Python at twistedmatrix.com
> >>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070628/015940de/attachment.html>

From exarkun at divmod.com  Thu Jun 28 18:16:37 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 28 Jun 2007 20:16:37 -0400
Subject: [Twisted-Python] take my tickets, please
In-Reply-To: <2f66cbb30706281658x5a4b72eq461bbc6e1c80df2d@mail.gmail.com>
Message-ID: <20070629001637.4947.349358007.divmod.quotient.4974@ohm>

On Thu, 28 Jun 2007 19:58:33 -0400, "Chas." <eprparadocs at gmail.com> wrote:
>How does one get started?
>

Here's the list of open tickets:

  http://twistedmatrix.com/trac/report/1

You can also create a custom ticket view.  For example, open tickets assigned
to glyph are shown here:

http://twistedmatrix.com/trac/query?status=new&status=assigned&status=reopened&owner=glyph&order=priority

If you find a ticket you think you can resolve, attach the patch to the
ticket, change its priority to highest, and add "review" to its keywords.

You can also look at existing tickets with the review keyword:

http://twistedmatrix.com/trac/report/11

and provide feedback for them.  The review process is documented on the
wiki:

http://twistedmatrix.com/trac/wiki/ReviewProcess

You can look at the changes proposed on a ticket which has been marked for
review and comment about whether the changes are correct or if there is a
problem with them.

And if you don't know how to fix a ticket, you still may be able to help.  If
the ticket is related to a domain with which you are familiar and there is
an open question as to how to resolve it, you can add a comment making a
suggestion.  If a ticket is for a bug but does not include a unit test, you
can write a unit test and attach it; this is often even more useful than
just attaching a patch with a fix.

When writing code to contribute to Twisted, note that it must be MIT licenced.
Also, take a look at the coding standard here:

http://twistedmatrix.com/trac/browser/trunk/doc/development/policy/coding-standard.xhtml?format=raw

You can find other suggestions for ways to contribute on the wiki:

http://twistedmatrix.com/trac/wiki/ContributingToTwistedLabs

Jean-Paul



From nico at tekNico.net  Thu Jun 28 22:41:00 2007
From: nico at tekNico.net (Nicola Larosa)
Date: Fri, 29 Jun 2007 06:41:00 +0200
Subject: [Twisted-Python] Re: Implementing streaming (broadcast) TCP servers
In-Reply-To: <A023DDB6-8B23-4749-B80C-B2B379DD78B8@atlas.st>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>	<4683B853.7080700@acm.org>	<2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>
	<A023DDB6-8B23-4749-B80C-B2B379DD78B8@atlas.st>
Message-ID: <46848D5C.6040606@tekNico.net>

Adam Atlas wrote:
> However, once all the clients disconnect, the memory doesn't seem to go
> back down to the expected level. Any ideas on where I should start
> looking to solve this?

Are you using Python 2.5? It made great progress in giving the memory back
to the operating system.


-- 
Nicola Larosa - http://www.tekNico.net/

Se pensavate che Windows Vista vi avrebbe permesso di risparmiarvi
l'acquisto di un antivirus, vi sbagliavate. Se pensavate che fosse
più sicuro dei vecchi Windows, vi sbagliavate. Se pensate che possa
essere più sicuro di Linux o di MacOS X vi sbagliate di grosso.
 -- Alessandro Bottoni, Febbraio 2007





From adam at atlas.st  Thu Jun 28 23:05:21 2007
From: adam at atlas.st (Adam Atlas)
Date: Fri, 29 Jun 2007 01:05:21 -0400
Subject: [Twisted-Python] Re: Implementing streaming (broadcast) TCP
	servers
In-Reply-To: <46848D5C.6040606@tekNico.net>
References: <EBA2836B-515F-44C9-AA64-320B63E6FEB8@atlas.st>	<4683B853.7080700@acm.org>	<2A5FBFDE-5B46-4CC7-A532-A7DF36E7FB42@atlas.st>
	<A023DDB6-8B23-4749-B80C-B2B379DD78B8@atlas.st>
	<46848D5C.6040606@tekNico.net>
Message-ID: <F9C6FF07-47E6-42AE-A4FB-8E2E1C3C454C@atlas.st>



On 29 Jun 2007, at 00.41, Nicola Larosa wrote:
> Adam Atlas wrote:
>> However, once all the clients disconnect, the memory doesn't seem  
>> to go
>> back down to the expected level. Any ideas on where I should start
>> looking to solve this?
>
> Are you using Python 2.5? It made great progress in giving the  
> memory back
> to the operating system.

So I've heard.

I have 2.5, though I've been testing with 2.4, because this is a  
program I'm intending to distribute, not just for private use. So I  
want to keep it backwards-compatible with at least 2.4.



From roland.hedberg at adm.umu.se  Fri Jun 29 05:11:32 2007
From: roland.hedberg at adm.umu.se (Roland Hedberg)
Date: Fri, 29 Jun 2007 13:11:32 +0200
Subject: [Twisted-Python] What does soap.Proxy.callRemote() do that simple
 client.getPage() doesn't ?
Message-ID: <4684E8E4.7030008@adm.umu.se>

Hi!

I have two similar implementation of senders, one using HTTP "PUT" and
the other SOAP (and a put operation).

The core of the soap sender are the lines:

 proxy = soap.Proxy(recv)
 return proxy.callRemote('put',data)

While the HTTP one uses:

 return client.getPage(recv, method="PUT", postdata=data, headers=headers)

Basically soap.Proxy.callRemote() uses client.getPage() though with the
method POST instead of PUT. So there are some clear similarities here.

Now, I also have a dispatcher which uses either of these senders
depending on various reasons.
The crux is that when there is a continuous flow of data leaving by HTTP
"PUT" I see no problems, while when the same happens for SOAP, after a
while I see complains about "twisted.internet.error.ConnectBindError:
Couldn't bind: 24: Too many open files.".

I guess files in this instance equates to internet connections.
If so, is that because soap.Proxy.callRemote() doesn't close down the
connections in the same way as a direct call to client.getPage() does ?

There is obviously something I don't understand here.
Anyone that can enlighten me ?
And tell me how to get rid of the connections.

Running Twisted 2.5.0

-- Roland



From paulswartz at gmail.com  Fri Jun 29 09:38:20 2007
From: paulswartz at gmail.com (Paul Swartz)
Date: Fri, 29 Jun 2007 11:38:20 -0400
Subject: [Twisted-Python] [Conch] anyone using
	twisted.conch.ssh.session.SSHSession directly?
Message-ID: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>

I'm working on tests for t.c.s.session.SSHSession, and it's difficult
because of the terrible API SSHSession currently has.  I've tried a
rewrite in branches/session-2710, but I wanted to know if anyone was
actually using that class directly?  The typical use case is writing
an Avatar->ISession adapter, and if you're doing it that way nothing
should change for you even with this update.

In short, let me know if you're using
twisted.conch.ssh.session.SSHSession directly and I need to keep it
backwards compatible.  Thanks!

-p
-- 
Paul Swartz
paulswartz at gmail dot com
http://z3p.livejournal.com/
AIM: z3penguin



From itamar at itamarst.org  Fri Jun 29 13:25:10 2007
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 29 Jun 2007 15:25:10 -0400 (EDT)
Subject: [Twisted-Python] [Conch] anyone using 
	twisted.conch.ssh.session.SSHSession directly?
In-Reply-To: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>
References: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>
Message-ID: <60603.63.107.91.99.1183145110.squirrel@webmail.zoteca.com>

> I'm working on tests for t.c.s.session.SSHSession, and it's difficult
> because of the terrible API SSHSession currently has.  I've tried a
> rewrite in branches/session-2710, but I wanted to know if anyone was
> actually using that class directly?  The typical use case is writing
> an Avatar->ISession adapter, and if you're doing it that way nothing
> should change for you even with this update.

Rather than removing it, you could e.g. deprecate the old class and then
write a new one (using test-driven development) to ensure a decent API and
good test coverage.




From glyph at divmod.com  Fri Jun 29 14:46:07 2007
From: glyph at divmod.com (glyph at divmod.com)
Date: Fri, 29 Jun 2007 20:46:07 -0000
Subject: [Twisted-Python] [Conch] anyone using
	twisted.conch.ssh.session.SSHSession directly?
In-Reply-To: <60603.63.107.91.99.1183145110.squirrel@webmail.zoteca.com>
References: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>
	<60603.63.107.91.99.1183145110.squirrel@webmail.zoteca.com>
Message-ID: <20070629204607.8429.1198924326.divmod.xquotient.380@joule.divmod.com>


On 07:25 pm, itamar at itamarst.org wrote:
>>I'm working on tests for t.c.s.session.SSHSession, and it's difficult
>>because of the terrible API SSHSession currently has.  I've tried a
>>rewrite in branches/session-2710, but I wanted to know if anyone was
>>actually using that class directly?  The typical use case is writing
>>an Avatar->ISession adapter, and if you're doing it that way nothing
>>should change for you even with this update.
>
>Rather than removing it, you could e.g. deprecate the old class and 
>then
>write a new one (using test-driven development) to ensure a decent API 
>and
>good test coverage.

I tried a while ago to document some parts of the unspoken idioms around 
compatibility:

    http://twistedmatrix.com/trac/wiki/CompatibilityPolicy

It's still not done, but hey, as long as we're talking about it, Paul, 
have a look at the number of entries Conch has in that list near the 
bottom. ;-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20070629/c702c6f0/attachment.html>

From paulswartz at gmail.com  Fri Jun 29 14:59:53 2007
From: paulswartz at gmail.com (Paul Swartz)
Date: Fri, 29 Jun 2007 16:59:53 -0400
Subject: [Twisted-Python] [Conch] anyone using
	twisted.conch.ssh.session.SSHSession directly?
In-Reply-To: <20070629204607.8429.1198924326.divmod.xquotient.380@joule.divmod.com>
References: <324cfb540706290838y20cd7d93nf4a2b8657ae6c451@mail.gmail.com>
	<60603.63.107.91.99.1183145110.squirrel@webmail.zoteca.com>
	<20070629204607.8429.1198924326.divmod.xquotient.380@joule.divmod.com>
Message-ID: <324cfb540706291359j4a220091t806517515035712a@mail.gmail.com>

On 6/29/07, glyph at divmod.com <glyph at divmod.com> wrote:
>
> On 07:25 pm, itamar at itamarst.org wrote:
> >> I'm working on tests for t.c.s.session.SSHSession, and it's difficult
> >> because of the terrible API SSHSession currently has.  I've tried a
> >> rewrite in branches/session-2710, but I wanted to know if anyone was
> >> actually using that class directly?  The typical use case is writing
> >> an Avatar->ISession adapter, and if you're doing it that way nothing
> >> should change for you even with this update.
> >
> >Rather than removing it, you could e.g. deprecate the old class and then
> >write a new one (using test-driven development) to ensure a decent API and
> >good test coverage.
>
> I tried a while ago to document some parts of the unspoken idioms around
> compatibility:
>
>     http://twistedmatrix.com/trac/wiki/CompatibilityPolicy
>
> It's still not done, but hey, as long as we're talking about it, Paul, have
> a look at the number of entries Conch has in that list near the bottom. ;-)

Oh, I know.  My goal is to have the SoC branches take over testing for
Conch, so I can just scrub those old deprecated ones.

-p
-- 
Paul Swartz
paulswartz at gmail dot com
http://z3p.livejournal.com/
AIM: z3penguin



From twisted-python at 2xlp.com  Sat Jun 30 16:00:04 2007
From: twisted-python at 2xlp.com (Jonathan Vanasco)
Date: Sat, 30 Jun 2007 18:00:04 -0400
Subject: [Twisted-Python] Flash AMF and Twisted
In-Reply-To: <20070618170534.31981.1808740575.divmod.xquotient.17@joule.divmod.com>
References: <A3F520F1-B083-4DA9-A581-2234752CFE44@collab.nl>
	<20070618022344.4947.170473162.divmod.quotient.2321@ohm>
	<20070618170534.31981.1808740575.divmod.xquotient.17@joule.divmod.com>
Message-ID: <BD75E5F9-66F3-4B3F-ADC4-36642E57C692@2xlp.com>


On Jun 18, 2007, at 1:05 PM, glyph at divmod.com wrote:

> Thanks, too, for changing this so readily :).
>
> It makes me think, though, that maybe we should have a suggested  
> prefix for things-which-use-Twisted, since "py" is a little  
> confusing there.  Python has PyXXX, maybe Twisted should have  
> TwiXXX or similar?

Personally speaking ,  It would be nice if Twisted
	a) had a suggested prefix
	b) had 2 logos put into the public domain
		i. a form of the logo for people who want to show support on their  
sites that run twisted
		ii. a "powerd by" logo for applicaitons built on twisted.

This would be similar to what Mozilla did with the firefox logos.



// Jonathan Vanasco

| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|   CEO/Founder SyndiClick Networks
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|     Founder/CTO/CVO
|      FindMeOn.com - The cure for Multiple Web Personality Disorder
|      Web Identity Management and 3D Social Networking
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -
|      RoadSound.com - Tools For Bands, Stuff For Fans
|      Collaborative Online Management And Syndication Tools
| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
- - - - - - - - - - - - - - - - - - -





From thisaddressisnotmine at td.selfip.net  Sat Jun 30 16:50:50 2007
From: thisaddressisnotmine at td.selfip.net (Oleg Deribas)
Date: Sun, 01 Jul 2007 01:50:50 +0300
Subject: [Twisted-Python] web2 DAV client
Message-ID: <ua3jl4-6c5.ln1@td.selfip.net>

Hello,

Is it possible to use current web2 dav implementation as webdav client 
with support for digest auth?

-- 
Oleg




From phil at bubblehouse.org  Sat Jun 30 18:27:19 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Sat, 30 Jun 2007 20:27:19 -0400
Subject: [Twisted-Python] twisted.plugin issues
Message-ID: <55484996-4051-48EC-9D16-4656597ADE7D@bubblehouse.org>

Hello all,

I'm trying to implement a plugin system in a project using the  
twisted plugin framework. I've read through the docs pretty  
thoroughly, but I can't seem to figure out what I'm doing wrong.

Attached is a sample case that should illustrate the problem. The  
layout is as follows:

     plugin_dir/
     plugin_dir/test/
     plugin_dir/test/plugins/
     plugin_dir/test/plugins/myplugin.py
     test/
     test/__init__.py
     test/plugins/
     test/plugins/__init__.py
     test/sample.py
     test_plugin.py

First I created the test.plugins package, and included the following  
in test/plugins/__init__.py:

     import os, sys

     __path__ = [os.path.abspath(os.path.join(x, 'test', 'plugins'))
                     for x in sys.path]

     __all__ = []

Then I created my interfaces in the test.sample module:

     from zope import interface

     class ISamplePlugin(interface.Interface):
         '''My Sample Plugin Class'''

Next, I created the plugin in an arbitrary directory, under  
plugin_dir/test/plugins/myplugin.py:

     from zope.interface import implements
     from twisted import plugin
     from test.sample import ISamplePlugin

     class MyPlugin(object):
         implements(plugin.IPlugin, ISamplePlugin)

Finally, here's the sample script that tries to load the plugins in  
the arbitrary directory:

     from twisted import plugin

     import sys
     sys.path.append('.')
     sys.path.append('./plugin_dir')

     from test import sample, plugins
     from twisted import plugin
     plugin_result = plugin.getPlugins(sample.ISamplePlugin, plugins)

     for plugin in plugin_result:
         print repr(plugin) + ' was found.'

Which gives no output.

Here are the things I've checked for:

     * './plugin_dir' is definitely on the pythonpath when
       getPlugins is called. I've also tried using an absolute path.

     * once the path is modified, I can import manually with:
         import test.plugins.myplugins

I'm using the latest Twisted-SVN, under the pythonmac.org Python  
2.4.4 distribution on Mac OS X 10.4.10.

Any help would be greatly appreciated.

Thanks in advance,

-phil



-------------- next part --------------
A non-text attachment was scrubbed...
Name: plugin_test.tgz
Type: application/octet-stream
Size: 675 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20070630/3af90d99/attachment-0002.obj>

From exarkun at divmod.com  Sat Jun 30 19:32:32 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sat, 30 Jun 2007 21:32:32 -0400
Subject: [Twisted-Python] twisted.plugin issues
In-Reply-To: <55484996-4051-48EC-9D16-4656597ADE7D@bubblehouse.org>
Message-ID: <20070701013232.4947.1136742145.divmod.quotient.5400@ohm>

On Sat, 30 Jun 2007 20:27:19 -0400, Phil Christensen <phil at bubblehouse.org> wrote:
>Hello all,
>
>I'm trying to implement a plugin system in a project using the  twisted 
>plugin framework. I've read through the docs pretty  thoroughly, but I can't 
>seem to figure out what I'm doing wrong.
>
>Attached is a sample case that should illustrate the problem. The  layout is 
>as follows:
>
>     plugin_dir/
>     plugin_dir/test/
>     plugin_dir/test/plugins/
>     plugin_dir/test/plugins/myplugin.py
>     test/
>     test/__init__.py
>     test/plugins/
>     test/plugins/__init__.py
>     test/sample.py
>     test_plugin.py
>
>First I created the test.plugins package, and included the following  in 
>test/plugins/__init__.py:
>
>     import os, sys
>
>     __path__ = [os.path.abspath(os.path.join(x, 'test', 'plugins'))
>                     for x in sys.path]
>
>     __all__ = []
>
>Then I created my interfaces in the test.sample module:
>
>     from zope import interface
>
>     class ISamplePlugin(interface.Interface):
>         '''My Sample Plugin Class'''
>
>Next, I created the plugin in an arbitrary directory, under 
>plugin_dir/test/plugins/myplugin.py:
>
>     from zope.interface import implements
>     from twisted import plugin
>     from test.sample import ISamplePlugin
>
>     class MyPlugin(object):
>         implements(plugin.IPlugin, ISamplePlugin)

The problem may be here.  What happens if you use classProvides instead of
implements or bind an instance of MyPlugin to an attribute of this module?

>
>Finally, here's the sample script that tries to load the plugins in  the 
>arbitrary directory:
>
>     from twisted import plugin
>
>     import sys
>     sys.path.append('.')
>     sys.path.append('./plugin_dir')
>
>     from test import sample, plugins
>     from twisted import plugin
>     plugin_result = plugin.getPlugins(sample.ISamplePlugin, plugins)
>
>     for plugin in plugin_result:
>         print repr(plugin) + ' was found.'
>
>Which gives no output.
>
>Here are the things I've checked for:
>
>     * './plugin_dir' is definitely on the pythonpath when
>       getPlugins is called. I've also tried using an absolute path.
>
>     * once the path is modified, I can import manually with:
>         import test.plugins.myplugins
>
>I'm using the latest Twisted-SVN, under the pythonmac.org Python  2.4.4 
>distribution on Mac OS X 10.4.10.
>
>Any help would be greatly appreciated.
>
>Thanks in advance,
>

Jean-Paul



From phil at bubblehouse.org  Sat Jun 30 21:57:13 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Sat, 30 Jun 2007 23:57:13 -0400
Subject: [Twisted-Python] twisted.plugin issues
In-Reply-To: <20070701013232.4947.1136742145.divmod.quotient.5400@ohm>
References: <20070701013232.4947.1136742145.divmod.quotient.5400@ohm>
Message-ID: <8B4ADE5B-1CCA-42E9-9AD4-1923EBE616AA@bubblehouse.org>


On Jun 30, 2007, at 9:32 PM, Jean-Paul Calderone wrote:

> On Sat, 30 Jun 2007 20:27:19 -0400, Phil Christensen  
> <phil at bubblehouse.org> wrote:
>> Hello all,
>>
>> I'm trying to implement a plugin system in a project using the   
>> twisted plugin framework. I've read through the docs pretty   
>> thoroughly, but I can't seem to figure out what I'm doing wrong.
>>
>> Attached is a sample case that should illustrate the problem. The   
>> layout is as follows:
>>
>>     plugin_dir/
>>     plugin_dir/test/
>>     plugin_dir/test/plugins/
>>     plugin_dir/test/plugins/myplugin.py
>>     test/
>>     test/__init__.py
>>     test/plugins/
>>     test/plugins/__init__.py
>>     test/sample.py
>>     test_plugin.py
>>
>> First I created the test.plugins package, and included the  
>> following  in test/plugins/__init__.py:
>>
>>     import os, sys
>>
>>     __path__ = [os.path.abspath(os.path.join(x, 'test', 'plugins'))
>>                     for x in sys.path]
>>
>>     __all__ = []
>>
>> Then I created my interfaces in the test.sample module:
>>
>>     from zope import interface
>>
>>     class ISamplePlugin(interface.Interface):
>>         '''My Sample Plugin Class'''
>>
>> Next, I created the plugin in an arbitrary directory, under  
>> plugin_dir/test/plugins/myplugin.py:
>>
>>     from zope.interface import implements
>>     from twisted import plugin
>>     from test.sample import ISamplePlugin
>>
>>     class MyPlugin(object):
>>         implements(plugin.IPlugin, ISamplePlugin)
>
> The problem may be here.  What happens if you use classProvides  
> instead of
> implements or bind an instance of MyPlugin to an attribute of this  
> module?

Aha, this looks promising. Doing either of those things results in:


Traceback (most recent call last):
   File "test_plugin.py", line 11, in ?
     for plugin in plugin_result:
   File "/Users/phil/Workspace/Twisted/twisted/plugin.py", line 186,  
in getPlugins
     allDropins = getCache(package)
--- <exception caught here> ---
   File "/Users/phil/Workspace/Twisted/twisted/plugin.py", line 165,  
in getCache
     dropinPath.setContent(pickle.dumps(dropinDotCache))
cPickle.PicklingError: Can't pickle <InterfaceClass  
test.sample.ISamplePlugin>: import of module test.sample failed
<class 'test.plugins.myplugin.MyPlugin'> was found.


So this must be pretty close. I tried deleting the dropin.cache, but  
I'm still getting this exception.


>>
>> Finally, here's the sample script that tries to load the plugins  
>> in  the arbitrary directory:
>>
>>     from twisted import plugin
>>
>>     import sys
>>     sys.path.append('.')
>>     sys.path.append('./plugin_dir')
>>
>>     from test import sample, plugins
>>     from twisted import plugin
>>     plugin_result = plugin.getPlugins(sample.ISamplePlugin, plugins)
>>
>>     for plugin in plugin_result:
>>         print repr(plugin) + ' was found.'
>>



From exarkun at twistedmatrix.com  Sat Jun 30 22:05:02 2007
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 01 Jul 2007 04:05:02 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1183262702.07.1098746416@twistedmatrix.com

Bug summary
______________________
Summary for 2007-06-24 through 2007-07-01
Bugs opened: 14    Bugs closed: 9  Total open bugs: 985 (+5)

|== Type Changes   |== Priority Changes   |== Component Changes   
|Defect:       +4  |Highest:  -4          |Conch:  +0             
|Enhancement:  +1  |Normal:   +9          |Core:   +9             
|Task:         +1  |Low:      +0          |Pb:     -3             
                   |Lowest:   +1                                  


New / Reopened Bugs
______________________
                    ===== Normal =====
[#2715] SSHFactory shouldn't disable core dumps (opened by exarkun)
    defect          conch      http://twistedmatrix.com/trac/ticket/2715

[#2716] Eliminate relative imports from twisted.conch (opened by exarkun)
    task            core       http://twistedmatrix.com/trac/ticket/2716

[#2718] async howto implies Deferreds solve concurrency issues (opened by itamarst) (CLOSED, duplicate)
    defect          core       http://twistedmatrix.com/trac/ticket/2718

[#2719] async howto implies Deferreds solve concurrency issues (opened by itamarst)
    defect          core       http://twistedmatrix.com/trac/ticket/2719

[#2720] merge all deferreds howtos into one that doesn't suck (opened by itamarst)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2720

[#2721] internet-overview howto is sorta pointless (opened by itamarst)
    defect          core       http://twistedmatrix.com/trac/ticket/2721

[#2722] reactor basics howto is lacking important information (opened by itamarst)
    defect          core       http://twistedmatrix.com/trac/ticket/2722

[#2724] intended audience of Twisted documentation is not clear (opened by glyph)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2724

[#2725] twisted.internet.task.LoopingCall does not document a public API for checking to see if it is currently running. (opened by dreid)
    defect          core       http://twistedmatrix.com/trac/ticket/2725

[#2726] there is no way to kill a group of subprocesses in Twisted (with proposed fix for Windows using Job objects) (opened by deboute)
    defect          core       http://twistedmatrix.com/trac/ticket/2726

[#2727] plugin howto refers to "getPlugin" instead of "getPlugins" (opened by exarkun)
    defect          core       http://twistedmatrix.com/trac/ticket/2727

[#2245] Deferred implementation in C (opened by therve)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2245

                    ===== Low =====
[#2723] Twisted.Quotes does not serve its original intended purpose (opened by glyph)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2723

                    ===== Lowest =====
[#2717] Add a test to verify that Twisted.Quotes complies with fortune format. (opened by jml)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2717



Closed Bugs
______________________
                    ===== Highest =====
[#1843] twisted.spread.util.FilePager keeps all sent chunks in memory (opened by ino, closed by therve, fixed)
    defect          pb         http://twistedmatrix.com/trac/ticket/1843

[#2703] assertWarns has some restrictions (opened by therve, closed by therve, fixed)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2703

[#426 ] [PATCH] sending new style classes via perspective broker (opened by titty, closed by therve, fixed)
    enhancement     pb         http://twistedmatrix.com/trac/ticket/426

[#222 ] Missing common overridable/callable method summaries in docs (opened by jknight, closed by exarkun, fixed)
    enhancement     core       http://twistedmatrix.com/trac/ticket/222

                    ===== Normal =====
[#2321] twisted.test.test_pb.NSPTestCase.tearDown calls stopListening but doesn't return the Deferred (opened by exarkun, closed by therve, fixed)
    defect          pb         http://twistedmatrix.com/trac/ticket/2321

[#2718] async howto implies Deferreds solve concurrency issues (opened by itamarst, closed by therve, duplicate)
    defect          core       http://twistedmatrix.com/trac/ticket/2718

[#2711] ConnectionRefusedError doesn't provide any information about the connection that was refused (opened by jml, closed by therve, duplicate)
    enhancement     core       http://twistedmatrix.com/trac/ticket/2711

[#2543] "Noone" isn't a word (opened by indigo, closed by therve, fixed)
    defect          core       http://twistedmatrix.com/trac/ticket/2543

                    ===== Low =====
[#423 ] Simpler interface to the conch client code (opened by z3p, closed by z3p, duplicate)
    enhancement     conch      http://twistedmatrix.com/trac/ticket/423





From twisted-python at 2xlp.com  Sat Jun 30 22:09:24 2007
From: twisted-python at 2xlp.com (Jonathan Vanasco)
Date: Sun, 1 Jul 2007 00:09:24 -0400
Subject: [Twisted-Python] twisted to the iphone rescue ?
Message-ID: <038A7663-A59A-41BC-BD50-022D02657418@2xlp.com>

I just got an iPhone, and like many other tech people, I'm pissed:

a_ There's no terminal/shell - i think they wanted to lock-down the  
phone
b_ There's no Chat feature - they wanted to push people into an  
overpriced AT&T scheme

Some people have been doing workarounds:
re: http://arstechnica.com/journals/apple.ars/2007/06/25/aim-and-ssh- 
coming-to-an-iphone-near-you-sort-of

	iPhoneChat
		web-based aim proxy
		think twisted-words
		http://www.publictivity.com/iPhoneChat/

	WebShell
		web-based ssh proxy over https
		http://www-personal.umich.edu/~mressl/webshell/

And I heard of a few more in the pipes.

Is anyone working on stuff like this using Twisted though?

For a seasoned Twisted programmer, this should be pretty simple...  
I've done most of the features of both in other apps based on  
twisted , which seems to support both feature sets really really well.

Just wondering/hoping that someone here is planning on releasing some  
standalone stuff that people can download and run on their servers  
( ssh for security , chatting for aim/icq/jabber not throttling any  
one ip - which is happening right now )






