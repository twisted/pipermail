<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] TCP Proxy scalability issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20TCP%20Proxy%20scalability%20issue&In-Reply-To=%3CEA2F29B650A22546932C85031ED4F98AE07667%40mail-37ps.atlarge.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052064.html">
   <LINK REL="Next"  HREF="052066.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] TCP Proxy scalability issue</H1>
    <B>Mohapatra Saurav</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20TCP%20Proxy%20scalability%20issue&In-Reply-To=%3CEA2F29B650A22546932C85031ED4F98AE07667%40mail-37ps.atlarge.net%3E"
       TITLE="[Twisted-Python] TCP Proxy scalability issue">saurav.mohapatra at dimdim.com
       </A><BR>
    <I>Fri May  1 10:31:33 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052064.html">[Twisted-Python] TCP Proxy scalability issue
</A></li>
        <LI>Next message (by thread): <A HREF="052066.html">[Twisted-Python] TCP Proxy scalability issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52065">[ date ]</a>
              <a href="thread.html#52065">[ thread ]</a>
              <a href="subject.html#52065">[ subject ]</a>
              <a href="author.html#52065">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph,

Thanks for the response.

We're trying to proxy multiple VNC processes for a screen sharing
application. So though CPU load is low, the data being pushed out is
pretty high. We have around 16Kb of data being pushed out per second per
client for a normal case. The test server is running on EC2, but we see
the degradation in the production deployment (on physical machines
running on a cogent fiber connection). I was thinking it might have
something to do with amount of data being written and number of
simultenous writes issued. Something to do with transport.write()

I'll take a look at txloadbalancer. 

I can make a benchmarking application available to you, please mail me
off the list at <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">saurav.mohapatra at dimdim.com</A>

Regards
Saurav

-----Original Message-----
From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>
[mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-request at twistedmatrix.com</A>
Sent: Friday, May 01, 2009 12:00 PM
To: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Subject: Twisted-Python Digest, Vol 62, Issue 2

Send Twisted-Python mailing list submissions to
	<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>

To subscribe or unsubscribe via the World Wide Web, visit
	<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
or, via email, send a message with subject or body 'help' to
	<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-request at twistedmatrix.com</A>

You can reach the person managing the list at
	<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-owner at twistedmatrix.com</A>

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of Twisted-Python digest...&quot;


Today's Topics:

   1. Re: TCP Proxy scalability issue (<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>)


----------------------------------------------------------------------

Message: 1
Date: Fri, 01 May 2009 15:54:56 -0000
From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>
Subject: Re: [Twisted-Python] TCP Proxy scalability issue
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Message-ID:
	
&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">20090501155456.12555.1002021953.divmod.xquotient.10153 at weber.divmod.com</A>
&gt;<i>
</I>	
Content-Type: text/plain; charset=&quot;utf-8&quot;; format=&quot;flowed&quot;

On 02:02 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">saurav.mohapatra at dimdim.com</A> wrote:
&gt;<i>Worker processes W1...n run listening on P1..n on the loopback and one
</I>&gt;<i>router process (twisted based) runs on public port P0 exposed to the
</I>&gt;<i>real world.
</I>
I haven't used it myself, but that sounds a bit like txloadbalancer: 
<A HREF="https://launchpad.net/txloadbalancer">https://launchpad.net/txloadbalancer</A>

Are you using that?
&gt;<i>The clients connect to P0 and the first few bytes they send indicates
</I>&gt;<i>which worker process they wish to connect to. The Twisted protocol
</I>&gt;<i>implementation then creates a relay TCP connection to loopback worker
</I>&gt;<i>process port and after that forwards received data on P0 to the worker
</I>&gt;<i>port on loop back and sends back data received from worker port to the
</I>&gt;<i>external connection.
</I>
&gt;<i>We're noticing significant degradation / starvation of the clients 
</I>&gt;<i>under
</I>&gt;<i>load (around 25 concurrent connections are enough to simulate this).
</I>
&gt;<i>We're running on Linux (CentOS 5.2) using python 2.5 and Twisted latest
</I>&gt;<i>source tarball using the epoll reactor and all settings are default.
</I>&gt;<i>Each connection sends back around 8-24kb data per second.
</I>
While every application is a unique beast in terms of performance 
tuning, these numbers all sound surprisingly low to me for something as 
simple as a TCP proxy.

Are you saturating your CPU?  What is the load like on the box in 
question, both from the Twisted proxy and from the other processes?

Can you provide a benchmark that we can run somewhere else, to 
demonstrate the issue you're having?
&gt;<i>My question is are there any &quot;production&quot; settings I need to do
</I>&gt;<i>(threadpool etc.) to get the maximum out of twisted.
</I>
Nothing that you described will make any use of threads - is there some 
reason you mention threadpool size?

If you *are* using threads then perhaps you shouldn't be, and they're 
causing performance problems :)

However, aside from reactor selection, Twisted is designed to have very 
few knobs to turn; it has one button for performance tuning and we push 
it before it leaves the factory.  So if there's a performance problem, 
the issue is that we need to optimize something in Twisted, or you need 
to optimize something in your application.

You may be able to tweak various linux kernel parameters to be able to 
improve things a bit, but if you're running into problems at 25 
connections, it doesn't sound like you're running into kernel issues to 
me.



------------------------------

_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>


End of Twisted-Python Digest, Vol 62, Issue 2
*********************************************


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052064.html">[Twisted-Python] TCP Proxy scalability issue
</A></li>
	<LI>Next message (by thread): <A HREF="052066.html">[Twisted-Python] TCP Proxy scalability issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52065">[ date ]</a>
              <a href="thread.html#52065">[ thread ]</a>
              <a href="subject.html#52065">[ subject ]</a>
              <a href="author.html#52065">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
