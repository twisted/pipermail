<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] help using deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20help%20using%20deferred&In-Reply-To=%3C9cce290a0905150758n62cfe47bi628b0fa26fe0be0c%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052112.html">
   <LINK REL="Next"  HREF="052152.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] help using deferred</H1>
    <B>Luigi Conte</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20help%20using%20deferred&In-Reply-To=%3C9cce290a0905150758n62cfe47bi628b0fa26fe0be0c%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] help using deferred">luigiandcosolutions at gmail.com
       </A><BR>
    <I>Fri May 15 08:58:11 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052112.html">[Twisted-Python] help using deferred
</A></li>
        <LI>Next message (by thread): <A HREF="052152.html">[Twisted-Python] help using deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52147">[ date ]</a>
              <a href="thread.html#52147">[ thread ]</a>
              <a href="subject.html#52147">[ subject ]</a>
              <a href="author.html#52147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/5/11 Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt;

&gt;<i> On Mon, 11 May 2009 19:49:19 +0200, Luigi Conte &lt;
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">luigiandcosolutions at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [snip]
</I>&gt;<i> &gt;in my script I have to use connect method and then I have to do some
</I>&gt;<i> &gt;operations first of calling the start method
</I>&gt;<i> &gt;1) start connection
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    def startConnection(self):
</I>&gt;<i> &gt;        d = my_api.connect(self.ctrl_ip, self.ctrl_port, self.user,
</I>&gt;<i> &gt;self.pwd)
</I>&gt;<i> &gt;        d.addCallback(self.postConnection)
</I>&gt;<i>
</I>&gt;<i> Since you omitted the definition of postConnection, I have no way to know
</I>&gt;<i> what this does.
</I>&gt;<i>
</I>&gt;<i> &gt;        d.addErrback(twisted.python.log.err)
</I>&gt;<i>
</I>&gt;<i> Regardless, this is the wrong place to insert this errback.  You should
</I>&gt;<i> read
</I>&gt;<i> the Deferred documentation to learn what consequence it will have on your
</I>&gt;<i> program's flow.
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/defer.html">http://twistedmatrix.com/projects/core/documentation/howto/defer.html</A> is
</I>&gt;<i> probably a good place to start.
</I>&gt;<i>
</I>&gt;<i> &gt;        print &quot;Connection added&quot;
</I>&gt;<i> &gt;        return d
</I>&gt;<i> &gt;2) operation before starting a virtual machine:
</I>&gt;<i> &gt;def newVMCfg(self, new_vms_cfg):
</I>&gt;<i> &gt;       #...
</I>&gt;<i> &gt;       #some operations
</I>&gt;<i> &gt;       #if condition valid I try to start the virtual machine
</I>&gt;<i> &gt;                        # is this the correct way to pass args to the
</I>&gt;<i> start
</I>&gt;<i> &gt;method?
</I>&gt;<i> &gt;                        d = self.d.addCallback(self.startVM,(new_vm,
</I>&gt;<i> &gt;self.lnms[i])
</I>&gt;<i> &gt;                        print &quot;started vm %s&quot;%new_vm
</I>&gt;<i> &gt;        return d
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;in the main process I call them as:
</I>&gt;<i> &gt;d = startConnection()
</I>&gt;<i> &gt;d.addCallback(newVMCfg, arg)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Is it correct? Because the process stops at the first method called: I see
</I>&gt;<i> &gt;only &quot;connection added&quot;.
</I>&gt;<i>
</I>&gt;<i> That should indicate to you that something is going wrong after that print
</I>&gt;<i> statement is reached.  So examine what your program tries to do after that
</I>&gt;<i> point.  You may want to use a debugger.  You may want to try writing some
</I>&gt;<i> unit tests.
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>
I looked at the documentation and I understood something about defferd and
callbacks. I edited my code but it does nothing...
I'm going to explain the scenario and what I want to do:
- there is an api that provides some methods (connect, start, disconnect).
- all those methods return a deferred object
- I have an object that first tries to connect, then reads a file and calls
the start method many times in a loop cicle of his method.

I want to use the connect and wait until I'm really connected. How can I do
this using the deferred object that the api returns to me?
I want to do the same thing each time I call the start method from the api:
I want to wait the completing of start operation before doing another start
invocation.

so I do:
in the main process:
    d = gest.connettiCLI_to_CTRL()

in gest class I have:
    def connettiCLI_to_CTRL(self):
        d = api.connect(self.ctrl_ip, self.ctrl_port, self.user, self.pwd)
        d.addCallback(self.cbConnected)
        return d

    def cbConnected(self, connectResult):
        return self.postConnection()

    def postConnection(self):
        # I do something but I don't call api's methods here
        # then I go to the next step returning the next method
        return self.interpretaNewVMCfg(self.vms_cfg)

    def interpretaNewVMCfg(self, new_vms_cfg):
        for i in candidati:
            #start operation in loop
            #here I want to control each start operation
            d = api.startVM(new_vm, self.lnms[i])
        return d

thank you so much
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20090515/1a48cb4f/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052112.html">[Twisted-Python] help using deferred
</A></li>
	<LI>Next message (by thread): <A HREF="052152.html">[Twisted-Python] help using deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52147">[ date ]</a>
              <a href="thread.html#52147">[ thread ]</a>
              <a href="subject.html#52147">[ subject ]</a>
              <a href="author.html#52147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
