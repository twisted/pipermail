<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] help using deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20help%20using%20deferred&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019594.html">
   <LINK REL="Next"  HREF="019597.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] help using deferred</H1>
    <B>Luigi Conte</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20help%20using%20deferred&In-Reply-To="
       TITLE="[Twisted-Python] help using deferred">luigiandcosolutions at gmail.com
       </A><BR>
    <I>Mon May 11 06:24:54 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019594.html">[Twisted-Python] Twisted plugins and py2exe
</A></li>
        <LI>Next message: <A HREF="019597.html">[Twisted-Python] help using deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19595">[ date ]</a>
              <a href="thread.html#19595">[ thread ]</a>
              <a href="subject.html#19595">[ subject ]</a>
              <a href="author.html#19595">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi people,
I'm luigi and I'm a student at Politecnico di Milano, Italy. I'm working for
a graduate thesis on a framework called usher. It provides an API to do
connect e command operations. It manages all those calls with a defferred
object (i think). In fact when I call the connect it returns me a defferred
object. All that i want to know is how to call the other operations with
this object and how to know when an operation is completely done.
The procedure I call is simple: connect method, start method many times,
stop method, disconnect method. I want to call these methods sequentially
because I have to fallow a list of commands so I have to be sure the
previous methods are already been invoked. I'll post the main methods hoping
someone could help me in how to add the method in the deferred and how to
know when it is completely invoked.
# Connect
def connect(self, ctrl_host, ctrl_port, user, passwd):
        &quot;&quot;&quot;Connect to an Usher control server.

        @param ctrl_host: fqdn where Usher controller is running
        @type ctrl_host: string
        @param ctrl_port: port number Usher controller is listening on
        @type ctrl_port: int
        @param user: username of user connecting to Usher controller
        @type user: string
        @param passwd: password of user connecting to Usher controller
        @type passwd: string

        return: Deferred which returns and L{UsherResult}
        rtype: twisted.internet.defer.Deferred
        &quot;&quot;&quot;
        # serialize access to connect
        if not self.connect_lock.acquire(False):
            raise UsherEx, &quot;Connection Pending&quot;

        if self.factory:
            self.disconnect()

        # reset vms
        self.vms = {}
        # reset passwd to None until we're connected
        self.passwd = None
        self.factory = APIFactory()
        self.factory.api = self
        # connect to server
        reactor.connectSSL(ctrl_host, ctrl_port, self.factory,
            ssl.ClientContextFactory())
        d = self.factory.login(credentials.UsernamePassword(user, passwd),
            client=self)
        d.addErrback(self._handle_err, misc.whoami())
        d.addCallback(self._connected_to_ctrl, ctrl_host, ctrl_port, user,
            passwd)
        return d

# start
def start(self,
              cluster=None,
              prefix='',
              vmlist=None,
              count=None,
              first=None,
              last=None,
              dregex=None,
              dlist=None,
              dryrun=False,
              eid=None,
              **kw):
        &quot;&quot;&quot;Start a VM or set of VMs

        @param cluster: Name of cluster to which VMs should belong
        @type cluster: string
        @param prefix: prefix to prepend to VM names
        @type prefix: string
        @param vmlist: list of strings of VMs to start
        @type vmlist: list of strings
        @param count: Number of consecutive VMs to start
        @type count: int
        @param first: Lowest number of VM to start
        @type first: int
        @param last: Highest number of VM to start
        @type last: int
        @param dregex: regular expression to match against destination LNM
            names
        @type dregex: list of strings
        @param dlist: list of strings to match against destination LNM names
        @type dlist: list of strings
        @param dryrun: Show what would have happened if the command had been
                run without the dryrun command (at the instant that the
dryrun
                command was run of course)
        @type dryrun: bool
        @param eid: mechanism for admin user to be able to specify an
alternate
                username for forming suffix for regex
        @type eid: string
        @param kw: Extra arguments passed to controller for use by plugins
or
            LNM.  Any keywords starting with 'vm_' are added to VM's uargs
            parameter.  Note, the controller actually checks for two kw
            arguments: ram and ip_addrs.  Though these are, strictly
speaking,
            VM parameters, they're considered important enough that the
            controller checks for them.
        @type kw: dict

        @return: Deferred which returns an L{UsherResult}
        @rtype: twisted.internet.defer.Deferred

        @raise UsherNotConnected: Raised when not connected to Usher
            Controller
        @raise UsherPBDeadRefEx: Raised when capability for Usher
            Controller goes stale.  Must reconnect when this happens
        @raise UsherInvalidInputEx: Raised when an invalid input or
            combination of parameters is received.

        @attention: The following conditions must hold:
                1. first, last, and count must be non-negative
                2. specifying first requires last or count
                3. cannot use count with vmlist
                4. cannot use count with both first and last

       &quot;&quot;&quot;
        # make sure we're connected
        if not self.aref:
            raise UsherNotConnectedEx

        # combine these to reduce params
        if ((first and first &lt; 0) or (last and last &lt; 0) or (count and count
&lt;
            0)):
            raise UsherInvalidInputEx(
                    &quot;first, last, and count must be non-negative&quot;)
        vmrange = (first,last,count)
        # arg check
        self._arg_check(vmlist, vmrange)

        # get final destination list
        dlist = self._namecomplete(dlist, suffix=self.suffix)
        self._check_lnmlist(dlist)
        dregex = self._regex_append(dregex, dlist)
        dlist = self._regex_filter(dregex, self.lnms.keys())

        # complete names (if necessary) in the vmlist
        vmlist = self._namecomplete(vmlist, cluster, eid)
        # check that the vms specified don't already exist
        self._check_vmlist(vmlist, isin=True)
        vmlist = self._get_vm_names_to_start(vmlist, cluster, prefix,
vmrange,
            eid)

        # controller handles eid from kw, so add it
        if eid:
            kw['eid'] = eid

        if dryrun:
            d = UsherResult('dryrun', msg = 'started:' + linesep +
                    linesep.join(vmlist))
            return d

        try:
            if vmlist:
                d = self.aref.callRemote(&quot;start&quot;, vmlist, dlist,
                    **kw)
                d.addErrback(self._handle_err, misc.whoami())
            else:
                raise UsherInvalidInputEx(
                        &quot;No VMs started.  No unique VMs specified in
command&quot;)
            return d
        except pb.DeadReferenceError, ex:
            raise UsherPBDeadRefEx

If you want, all the package is at
<A HREF="http://usher.ucsd.edu/downloads/snapshots/usher/latest/usher-latest.tgz">http://usher.ucsd.edu/downloads/snapshots/usher/latest/usher-latest.tgz</A>
in the client folder you'll find the api.py

Thank you very much hoping someone will help this totally inexpert user,
Luigi.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20090511/4f45a018/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20090511/4f45a018/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019594.html">[Twisted-Python] Twisted plugins and py2exe
</A></li>
	<LI>Next message: <A HREF="019597.html">[Twisted-Python] help using deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19595">[ date ]</a>
              <a href="thread.html#19595">[ thread ]</a>
              <a href="subject.html#19595">[ subject ]</a>
              <a href="author.html#19595">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
