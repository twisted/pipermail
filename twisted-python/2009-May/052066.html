<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] TCP Proxy scalability issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20TCP%20Proxy%20scalability%20issue&In-Reply-To=%3C20090502011029.12555.540014919.divmod.xquotient.10190%40weber.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052065.html">
   <LINK REL="Next"  HREF="052067.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] TCP Proxy scalability issue</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20TCP%20Proxy%20scalability%20issue&In-Reply-To=%3C20090502011029.12555.540014919.divmod.xquotient.10190%40weber.divmod.com%3E"
       TITLE="[Twisted-Python] TCP Proxy scalability issue">glyph at divmod.com
       </A><BR>
    <I>Fri May  1 19:10:29 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052065.html">[Twisted-Python] TCP Proxy scalability issue
</A></li>
        <LI>Next message (by thread): <A HREF="052067.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52066">[ date ]</a>
              <a href="thread.html#52066">[ thread ]</a>
              <a href="subject.html#52066">[ subject ]</a>
              <a href="author.html#52066">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1 May, 04:31 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">saurav.mohapatra at dimdim.com</A> wrote:
&gt;<i>Glyph,
</I>&gt;<i>
</I>&gt;<i>Thanks for the response.
</I>
No problem.  Thanks for your clearly described inquiry :).
&gt;<i>We're trying to proxy multiple VNC processes for a screen sharing
</I>&gt;<i>application. So though CPU load is low, the data being pushed out is
</I>&gt;<i>pretty high. We have around 16Kb of data being pushed out per second 
</I>&gt;<i>per
</I>&gt;<i>client for a normal case. The test server is running on EC2, but we see
</I>&gt;<i>the degradation in the production deployment (on physical machines
</I>&gt;<i>running on a cogent fiber connection). I was thinking it might have
</I>&gt;<i>something to do with amount of data being written and number of
</I>&gt;<i>simultenous writes issued. Something to do with transport.write()
</I>
When you do a transport.write, twisted puts the data into a buffer on 
your transport and marks it as ready to write some data.  When you next 
get into epoll, epoll should wake up immediately, showing that lots of 
FDs are ready for writing, and Twisted will then immediately begin 
attempting to write all of the buffered data to those connections.

All of those sockets are in non-blocking mode and so send will 
immediately return regardless of how much data can actually be put onto 
the wire.

Therefore, in principle, if Twisted is not 100% busy on the CPU, then 
nothing *should* be causing it to deliver your data slower than it's 
coming in.  Unless, of course, there's a bug, which is always possible. 
But this is a pretty simple bit of code and inspecting it in the course 
of this email I don't see many places for such a bug to hide; so in this 
case I'd probably start the bug hunt in the application.  Or at least, 
by writing the simplest possible benchmark for Twisted itself, so that 
we can see the &quot;raw&quot; performance regardless of any application logic.
&gt;<i>I can make a benchmarking application available to you, please mail me
</I>&gt;<i>off the list at <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">saurav.mohapatra at dimdim.com</A>
</I>
I have done so.
&gt;<i>Regards
</I>&gt;<i>Saurav
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052065.html">[Twisted-Python] TCP Proxy scalability issue
</A></li>
	<LI>Next message (by thread): <A HREF="052067.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52066">[ date ]</a>
              <a href="thread.html#52066">[ thread ]</a>
              <a href="subject.html#52066">[ subject ]</a>
              <a href="author.html#52066">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
