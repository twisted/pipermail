<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How can I change max simultaneously connection in	twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20can%20I%20change%20max%20simultaneously%20connection%20in%0A%09twisted&In-Reply-To=%3C4A002425.2040609%40cdeledu.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052093.html">
   <LINK REL="Next"  HREF="052083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How can I change max simultaneously connection in	twisted</H1>
    <B>孙绍轩</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20can%20I%20change%20max%20simultaneously%20connection%20in%0A%09twisted&In-Reply-To=%3C4A002425.2040609%40cdeledu.com%3E"
       TITLE="[Twisted-Python] How can I change max simultaneously connection in	twisted">sunshaoxuan at cdeledu.com
       </A><BR>
    <I>Tue May  5 05:33:57 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052093.html">[Twisted-Python] how do i do that
</A></li>
        <LI>Next message (by thread): <A HREF="052083.html">[Twisted-Python] How can I change max simultaneously connection in	twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52080">[ date ]</a>
              <a href="thread.html#52080">[ thread ]</a>
              <a href="subject.html#52080">[ subject ]</a>
              <a href="author.html#52080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all

I just wrote a small code to holding many http requests until server's
status change. Everything is fine but when simultaneously connection up
to 1k+, the server code didn't response to new connection. I've set
ulimit -n's value to 65535 and the code using epollreactor mode. Are
there have some limitations? How can I configure to support more
connections?
BTW: I use Python 2.4.3 on CentOS 5 64-bit. follow is the code, Thanks
for you help!

from twisted.internet import epollreactor
epollreactor.install()

from twisted.internet import reactor, defer, threads
from twisted.web import server, resource, client
from twisted.python import log
from time import sleep
import sys

def checkstatus_wait(laststatus):
timeout = 25
while timeout &gt; 0:
if int(laststatus) &lt; status:
return True
else:
timeout -= 1
sleep(1)
return False

class Simple(resource.Resource):
isLeaf = True
def render_GET(self, request):
if &quot;cmd&quot; in request.args:
cmd = request.args['cmd'][0]
else:
cmd = &quot;&quot;

if cmp(cmd,&quot;listen&quot;) == 0:
if &quot;laststatus&quot; in request.args:
last = request.args['laststatus'][0]
if int(last) &lt; status:
return &quot;ret=1\nerrstring=need update\nlaststatus=%d\n\n&quot; % status
else:
d = threads.deferToThread(checkstatus_wait, last)
d.addCallback(self.testReturn, request)
return server.NOT_DONE_YET
else:
return &quot;ret=1\nerrstring=need update\nlaststatus=%d\n\n&quot; % status
elif cmp(cmd,&quot;updatestatus&quot;) == 0:
if status &lt; 1000000:
status += 1
else:
status = 0
#client.getPage('<A HREF="http://211.157.0.47/videochat/listen?cmd=updatestatus">http://211.157.0.47/videochat/listen?cmd=updatestatus</A>')
return &quot;ret=1\nerrstring=success update\n\n&quot;
else:
return &quot;ret=-1\nerrstring=wrong cmd\n\n&quot;

def testReturn(self, ret, request):
if ret:
request.write(&quot;ret=1\nerrstring=need update\nlaststatus=%d\n\n&quot; % status)
else:
request.write(&quot;ret=0\nerrstring=no need update\n\n&quot;)
request.finish()

status = 0

log.startLogging(sys.stdout)
site = server.Site(Simple())

reactor.suggestThreadPoolSize(5000)
reactor.listenTCP(8080, site)
reactor.run()

-- 


孙绍轩 Yorgo Sun
 
China Distance Education Holdings Limited
18th Floor, XueYuan International Tower, No.1 ZhiChun Road, HaiDian District, Beijing, China 100083
Phone: +8610-8231-9999 Ext 708
*********************************************************** 
CONFIDENTIALITY CAUTION:
This message is intended only for the use of the individual or entity to whom it is addressed and contains information that is privileged and confidential. If you, the reader of this message, are not the intended recipient, you should not disseminate, distribute or copy this communication. If you have received this communication in error, please notify us immediately by return email and delete the original message.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052093.html">[Twisted-Python] how do i do that
</A></li>
	<LI>Next message (by thread): <A HREF="052083.html">[Twisted-Python] How can I change max simultaneously connection in	twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52080">[ date ]</a>
              <a href="thread.html#52080">[ thread ]</a>
              <a href="subject.html#52080">[ subject ]</a>
              <a href="author.html#52080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
