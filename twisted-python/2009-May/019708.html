<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted protocol as Django data source
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20protocol%20as%20Django%20data%20source&In-Reply-To=200905281543.47655.esteve%40sindominio.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019697.html">
   <LINK REL="Next"  HREF="019685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted protocol as Django data source</H1>
    <B>Dan</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20protocol%20as%20Django%20data%20source&In-Reply-To=200905281543.47655.esteve%40sindominio.net"
       TITLE="[Twisted-Python] Twisted protocol as Django data source">charnedn at muohio.edu
       </A><BR>
    <I>Thu May 28 22:38:01 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019697.html">[Twisted-Python] Twisted protocol as Django data source
</A></li>
        <LI>Next message: <A HREF="019685.html">[Twisted-Python] Twisted protocol as Django data source
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19708">[ date ]</a>
              <a href="thread.html#19708">[ thread ]</a>
              <a href="subject.html#19708">[ subject ]</a>
              <a href="author.html#19708">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for all your replies.

Greg wrote:
&gt;<i> You might want to look into Orbited, there are a number of Django  
</I>&gt;<i> examples
</I>&gt;<i> out there:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.orbited.org">http://www.orbited.org</A>
</I>
This looks very cool.  <A HREF="http://preview.tinyurl.com/3suqth">http://preview.tinyurl.com/3suqth</A> (CometDaily)  
makes it seem extremely easy to develop for. Gonna play with this when  
I get a chance.

Jean-Paul wrote:
&gt;<i> Another option is to have Django talk to a Twisted process via some  
</I>&gt;<i> RPC
</I>&gt;<i> mechanism that won't require you to use Twisted in the Apache process.
</I>&gt;<i> For example, XML-RPC.
</I>

I should have thought of this, as we're already using XML-RPC  
extensively in the application. All I'd really need to do is write a  
get_latest_data function and have Ajax poll Django poll XML-RPC. I  
keep forgetting that the GIL isn't anywhere near as much of a problem  
for this application now that it's Twisted than it was back when it  
was done entirely in threads.

And Esteve, there's a very good chance I'm going to start using  
Thrift. Thanks for pointing that out.

Alex wrote:
&gt;<i> I wrote up some thoughts on this here:
</I>&gt;<i> <A HREF="http://clemesha.org/blog/2009/apr/23/Django-on-Twisted-using-latest-twisted-web-wsgi/">http://clemesha.org/blog/2009/apr/23/Django-on-Twisted-using-latest-twisted-web-wsgi/</A>
</I>&gt;<i>
</I>&gt;<i> basically it comes down to running Django off the very latest WSGI
</I>&gt;<i> code (in the trunk still)
</I>&gt;<i> found in twisted.web, which I've found to work very well.
</I>&gt;<i>
</I>&gt;<i> Also see here:
</I>&gt;<i> <A HREF="http://blog.dreid.org/2009/03/twisted-django-it-wont-burn-down-your.html">http://blog.dreid.org/2009/03/twisted-django-it-wont-burn-down-your.html</A>
</I>
WSGI is scary to me mostly because it's done in threads. Trying to  
find GIL-related bugs in the old code cost me a LOT of time. And while  
presumably this integration is done by people who are far better  
coders than I, I can't shake the thread safety thing.

Also, I almost never use someone else's svn head code if I can avoid  
it. This is partly because I don't consider myself a good enough  
debugger to file good reports against somebody's enormous source tree,  
but mostly because I want to be spending most of my time worrying  
about my code than someone else's.

The other unfortunate restraint is that Apache in this instance is non- 
optional, as the box we're using also houses mod_svn repositories.

Dave wrote:
&gt;<i> I don't think the database option is a hack. Have twisted write the  
</I>&gt;<i> live
</I>&gt;<i> stream items into a ring-buffer SQL database table (eg. use records  
</I>&gt;<i> 1-100
</I>&gt;<i> over and over again), including a timestamp for each entry. Then  
</I>&gt;<i> your django
</I>&gt;<i> page can always retrieve the most current set of entries by  
</I>&gt;<i> SELECTing * from
</I>&gt;<i> the table in descending order by timestamp, which django is good at,  
</I>&gt;<i> staying
</I>&gt;<i> live with constant refreshing. There are no interprocess communication
</I>&gt;<i> pipes, broken sockets and timeouts etc. to screw up, no flaky  
</I>&gt;<i> javascript to
</I>&gt;<i> worry about, and the DBMS will handle the multiple simultaneous  
</I>&gt;<i> separate
</I>&gt;<i> data sources correctly. The central twisted application only has to  
</I>&gt;<i> keep
</I>&gt;<i> track of the buffer position. It's just not as much fun, though.
</I>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod</A> wrote:
&gt;<i> Personally, I don't like using databases as a point of integration.
</I>&gt;<i> Inevitably your Django app or your Twisted app will want to enforce
</I>&gt;<i> constraints on the data and model things about the relationships  
</I>&gt;<i> between
</I>&gt;<i> rows beyond what one can glean by inspecting the SQL schema.
</I>
Okay, so calling it a &quot;hack&quot; probably wasn't a good choice of words. I  
was actually leaning strongly towards using our Postgres installation  
for Dave's reasons. But the thought of using the database for  
integration bothers me for precisely glyph's reason, even though we  
already have the multiplexer sticking data into Postgres. That's  
pretty much the driving worry behind my initial post. I'm trying to  
avoid Django's nice builtin database API like the plague because we  
store a LOT of data. Our indices have to be optimized for INSERTs; a  
typical query on this data comes with a human-noticeable delay (I  
haven't timed it, but on the order of a second). Doing that for 30-odd  
satellites isn't going to happen fast enough to make the UI smooth as  
we would like.

If I followed Dave's suggestion to the letter (ring-buffer), it would  
work, but something in me strongly resists storing the same data in  
two places. Probably the fact that every time I've done that, I've had  
sync issues. I could write a trigger for the synchronization, but that  
would break sqlite support, which I'm trying to keep in since it was  
requested at a conference.

Thank you all again for the advice, and I'm sorry if I misspelled  
anybody's name.

As I continue to work with this project, you'll doubtless hear from me  
again.

-Dan


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019697.html">[Twisted-Python] Twisted protocol as Django data source
</A></li>
	<LI>Next message: <A HREF="019685.html">[Twisted-Python] Twisted protocol as Django data source
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19708">[ date ]</a>
              <a href="thread.html#19708">[ thread ]</a>
              <a href="subject.html#19708">[ subject ]</a>
              <a href="author.html#19708">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
