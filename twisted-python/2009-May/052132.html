<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Consistent interfaces to	asynchronous	partially-available services	using	Deferreds and	state	machines (was Re: Another approach to allowing	__init__	to	work with Deferreds)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Consistent%20interfaces%20to%0A%09asynchronous%09partially-available%20services%09using%09Deferreds%20and%0A%09state%09machines%20%28was%20Re%3A%20Another%20approach%20to%20allowing%09__init__%0A%09to%09work%20with%20Deferreds%29&In-Reply-To=%3C18955.53185.984111.643482%40jon.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052120.html">
   <LINK REL="Next"  HREF="052138.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Consistent interfaces to	asynchronous	partially-available services	using	Deferreds and	state	machines (was Re: Another approach to allowing	__init__	to	work with Deferreds)</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Consistent%20interfaces%20to%0A%09asynchronous%09partially-available%20services%09using%09Deferreds%20and%0A%09state%09machines%20%28was%20Re%3A%20Another%20approach%20to%20allowing%09__init__%0A%09to%09work%20with%20Deferreds%29&In-Reply-To=%3C18955.53185.984111.643482%40jon.es%3E"
       TITLE="[Twisted-Python] Consistent interfaces to	asynchronous	partially-available services	using	Deferreds and	state	machines (was Re: Another approach to allowing	__init__	to	work with Deferreds)">terry at jon.es
       </A><BR>
    <I>Thu May 14 02:01:05 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052120.html">[Twisted-Python] Consistent interfaces to	asynchronous	partially-available services	using	Deferreds and	state	machines (was Re: Another approach to allowing	__init__	to	work with Deferreds)
</A></li>
        <LI>Next message (by thread): <A HREF="052138.html">[Twisted-Python] Consistent interfaces to	asynchronous	partially-available services	using	Deferreds and	state	machines (was Re: Another approach to allowing	__init__	to	work with Deferreds)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52132">[ date ]</a>
              <a href="thread.html#52132">[ thread ]</a>
              <a href="subject.html#52132">[ subject ]</a>
              <a href="author.html#52132">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;&gt;&gt;&gt;<i> &quot;Phil&quot; == Phil Christensen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">phil at bubblehouse.org</A>&gt; writes:
</I>
Phil&gt; I don't know if I agree with the need for such a feature (that is,
Phil&gt; deferred __init__ usage), but it was a very interesting coding
Phil&gt; challenge I wanted to take a whack at. I *think* I might have found a
Phil&gt; solution, but I don't know if it falls under the heading of
Phil&gt; &quot;decorator abuse&quot; ;-)

Hi Phil

I finally had time to look at your solution a bit (though I've not run
it). It does a couple of things I wouldn't have thought of, like putting
the dictionary onto the deferredInit function. A couple of comments,
supposing I understand your code properly:

 - One thing I had hoped to avoid was to slow the class methods down by
   having them always check the original deferred (or a flag) before taking
   action. My approach does this by moving them aside and then putting them
   back in place once the deferred fires. Your solution requires that every
   decorated method does several extra things before it gets going. That
   could be greatly reduced if you were to check self.initDeferred.called
   and simply call the original function if the deferred has fired.

 - If multiple calls are made to instance methods before the init deferred
   has fired, they will, as I read it, all try to del
   deferredInit.waiting[self] in _finish. So I guess that del needs to be
   conditional or in a try/except.

 - Using self as a key into the dict on initDeferred seems like it
   addresses Glyph's observation/criticism that my approach raises
   questions wrt inheritance.

 - You could use chainDeferred where you're currently using
   .addCallbacks(resultDeferred.callback, resultDeferred.errback)


That's all for now. I'll see if I have more time to think about all this.
When I tried to use a decorator the first time, I was also using a super
class (whereas you're putting state into a dict on the deferredInit
function) but I got into a mess accessing self properly (partly because, I
think, I wanted to have a mixin class and I was looking at
self.__class__.__mro__).

In any case, thanks for replying, for playing with it, and for posting your
code. I got to learn new things as a result, which is really great :-)

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052120.html">[Twisted-Python] Consistent interfaces to	asynchronous	partially-available services	using	Deferreds and	state	machines (was Re: Another approach to allowing	__init__	to	work with Deferreds)
</A></li>
	<LI>Next message (by thread): <A HREF="052138.html">[Twisted-Python] Consistent interfaces to	asynchronous	partially-available services	using	Deferreds and	state	machines (was Re: Another approach to allowing	__init__	to	work with Deferreds)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52132">[ date ]</a>
              <a href="thread.html#52132">[ thread ]</a>
              <a href="subject.html#52132">[ subject ]</a>
              <a href="author.html#52132">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
