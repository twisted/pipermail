<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Question about deferreds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Question%20about%20deferreds&In-Reply-To=%3C20090505193150.12555.1342013280.divmod.xquotient.10497%40weber.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052089.html">
   <LINK REL="Next"  HREF="052094.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Question about deferreds</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Question%20about%20deferreds&In-Reply-To=%3C20090505193150.12555.1342013280.divmod.xquotient.10497%40weber.divmod.com%3E"
       TITLE="[Twisted-Python] Question about deferreds">glyph at divmod.com
       </A><BR>
    <I>Tue May  5 13:31:50 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052089.html">[Twisted-Python] Question about deferreds
</A></li>
        <LI>Next message (by thread): <A HREF="052094.html">[Twisted-Python] Question about deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52090">[ date ]</a>
              <a href="thread.html#52090">[ thread ]</a>
              <a href="subject.html#52090">[ subject ]</a>
              <a href="author.html#52090">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01:48 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dfarrell at mypublisher.com</A> wrote:
&gt;<i>Hi all,
</I>
&gt;<i>I consider myself a Twisted &quot;newbie&quot;, so this might seem like a simple
</I>&gt;<i>couple of questions, hope you'll indulge me.
</I>
I hope a simple couple of answers will suffice.  Thank you for your 
clearly-worded questions :).
&gt;<i>When I first began experimenting with deferreds I was breaking up tasks
</I>&gt;<i>into sequences of steps something like this.
</I>(snip)
&gt;<i>When this runs I was under the mistaken impression that at the end of
</I>&gt;<i>each callback (step1, step2, step3, etc) the deferred would yield back
</I>&gt;<i>to the main loop (reactor) and allow other deferreds to run. Now I know
</I>&gt;<i>that the callback functions run sequentially one after another with no
</I>&gt;<i>break. So my first question is this: what is the advantage of this over
</I>&gt;<i>just combining the callback functions into one big function?, something
</I>&gt;<i>like this:
</I>
&gt;<i>d = Deferred()
</I>&gt;<i>
</I>&gt;<i>d.succeed(True)
</I>&gt;<i>
</I>&gt;<i>d.addCallback(OneBigStep)
</I>
Deferreds are not about breaking your work up into steps to save time. 
They're about breaking it up so that different systems can deal with the 
same asynchronous event in their own way.

For example, let's say you're working on a REST client that deals with 
invoices.  The server gives you data at a particular URL and you want to 
convert it into an &quot;Invoice&quot; instance.

Twisted itself isn't going to have that OneBigStep callback that 
converts HTTP straight into invoices for you, so you've got something 
that gives back a Deferred that fires with a string, getPage.  Then 
maybe there's an intermediary layer that deals with parsing XML or JSON 
or whatever.  Then there's a layer that takes the JSON or DOM structure 
and converts it into an Invoice.  Finally you've got your actual 
application code that wants to get the Invoice and *do* something with 
that Invoice.

And of course your final &quot;do something with that invoice&quot; step might 
need data retrieved asynchronously from other places, so it might need 
other Deferreds and other callbacks as well.

If you do have step1, step2, and step3 defined entirely in a single 
function, then yes, they should be in the same function.
&gt;<i>If step1(), step2() and step3() take a fair bit of time to complete,
</I>&gt;<i>doesn't this effectively block the reactor loop for the entire exection
</I>&gt;<i>of all the steps?
</I>
Yep.  That's the idea.  If you have long-running tasks that need to be 
split up into multiple steps, there are other facilities, *not* Deferred 
callbacks, that you can use.  For example, this:

<A HREF="http://twistedmatrix.com/documents/8.2.0/api/twisted.internet.task.html#coiterate">http://twistedmatrix.com/documents/8.2.0/api/twisted.internet.task.html#coiterate</A>
&gt;<i>My second question is related to this; what is a recommended way to
</I>&gt;<i>create the cooperative state machine I'm thinking of using deferreds?
</I>
(...)
&gt;<i>How do I get the execution of this to be this:
</I>
&gt;<i>1)      d1_step1
</I>&gt;<i>2)      d2_step1
</I>&gt;<i>3)      d1_step2
</I>&gt;<i>4)      d2_step2
</I>&gt;<i>5)      d1_step3
</I>&gt;<i>6)      d2_step3
</I>
&gt;<i>I want to have the state machines I create cooperatively 'multi-task',
</I>&gt;<i>yielding control back to the main loop at each state transition.
</I>
If you actually wanted to interleave Deferred callbacks like that it 
would be tricky.  But if you just want interleaved callbacks, use 
Cooperator as I mentioned above :).
&gt;<i>Thanks in advance for any help, guidance or references you can provide.
</I>&gt;<i>I really enjoy Twisted, I'm still working on getting the 'Zen' of it.
</I>
Thanks!


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052089.html">[Twisted-Python] Question about deferreds
</A></li>
	<LI>Next message (by thread): <A HREF="052094.html">[Twisted-Python] Question about deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52090">[ date ]</a>
              <a href="thread.html#52090">[ thread ]</a>
              <a href="subject.html#52090">[ subject ]</a>
              <a href="author.html#52090">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
