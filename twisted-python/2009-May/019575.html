<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How can I change max simultaneously connection in	twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20can%20I%20change%20max%20simultaneously%20connection%0A%20in%09twisted&In-Reply-To=4A002425.2040609%40cdeledu.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019572.html">
   <LINK REL="Next"  HREF="019576.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How can I change max simultaneously connection in	twisted</H1>
    <B>&#23385;&#32461;&#36713;</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20can%20I%20change%20max%20simultaneously%20connection%0A%20in%09twisted&In-Reply-To=4A002425.2040609%40cdeledu.com"
       TITLE="[Twisted-Python] How can I change max simultaneously connection in	twisted">sunshaoxuan at cdeledu.com
       </A><BR>
    <I>Tue May  5 08:22:22 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019572.html">[Twisted-Python] How can I change max simultaneously connection in	twisted
</A></li>
        <LI>Next message: <A HREF="019576.html">[Twisted-Python] How can I change max simultaneously connection in	twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19575">[ date ]</a>
              <a href="thread.html#19575">[ thread ]</a>
              <a href="subject.html#19575">[ subject ]</a>
              <a href="author.html#19575">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&#23385;&#32461;&#36713; &#20889;&#36947;:
&gt;<i> Hello all
</I>&gt;<i>
</I>&gt;<i> I just wrote a small code to holding many http requests until server's
</I>&gt;<i> status change. Everything is fine but when simultaneously connection up
</I>&gt;<i> to 1k+, the server code didn't response to new connection. I've set
</I>&gt;<i> ulimit -n's value to 65535 and the code using epollreactor mode. Are
</I>&gt;<i> there have some limitations? How can I configure to support more
</I>&gt;<i> connections?
</I>&gt;<i> BTW: I use Python 2.4.3 on CentOS 5 64-bit. follow is the code, Thanks
</I>&gt;<i> for you help!
</I>&gt;<i>
</I>&gt;<i> from twisted.internet import epollreactor
</I>&gt;<i> epollreactor.install()
</I>&gt;<i>
</I>&gt;<i> from twisted.internet import reactor, defer, threads
</I>&gt;<i> from twisted.web import server, resource, client
</I>&gt;<i> from twisted.python import log
</I>&gt;<i> from time import sleep
</I>&gt;<i> import sys
</I>&gt;<i>
</I>&gt;<i> def checkstatus_wait(laststatus):
</I>&gt;<i> timeout = 25
</I>&gt;<i> while timeout &gt; 0:
</I>&gt;<i> if int(laststatus) &lt; status:
</I>&gt;<i> return True
</I>&gt;<i> else:
</I>&gt;<i> timeout -= 1
</I>&gt;<i> sleep(1)
</I>&gt;<i> return False
</I>&gt;<i>
</I>&gt;<i> class Simple(resource.Resource):
</I>&gt;<i> isLeaf = True
</I>&gt;<i> def render_GET(self, request):
</I>&gt;<i> if &quot;cmd&quot; in request.args:
</I>&gt;<i> cmd = request.args['cmd'][0]
</I>&gt;<i> else:
</I>&gt;<i> cmd = &quot;&quot;
</I>&gt;<i>
</I>&gt;<i> if cmp(cmd,&quot;listen&quot;) == 0:
</I>&gt;<i> if &quot;laststatus&quot; in request.args:
</I>&gt;<i> last = request.args['laststatus'][0]
</I>&gt;<i> if int(last) &lt; status:
</I>&gt;<i> return &quot;ret=1\nerrstring=need update\nlaststatus=%d\n\n&quot; % status
</I>&gt;<i> else:
</I>&gt;<i> d = threads.deferToThread(checkstatus_wait, last)
</I>&gt;<i> d.addCallback(self.testReturn, request)
</I>&gt;<i> return server.NOT_DONE_YET
</I>&gt;<i> else:
</I>&gt;<i> return &quot;ret=1\nerrstring=need update\nlaststatus=%d\n\n&quot; % status
</I>&gt;<i> elif cmp(cmd,&quot;updatestatus&quot;) == 0:
</I>&gt;<i> if status &lt; 1000000:
</I>&gt;<i> status += 1
</I>&gt;<i> else:
</I>&gt;<i> status = 0
</I>&gt;<i> #client.getPage('<A HREF="http://211.157.0.47/videochat/listen?cmd=updatestatus'">http://211.157.0.47/videochat/listen?cmd=updatestatus'</A>)
</I>&gt;<i> return &quot;ret=1\nerrstring=success update\n\n&quot;
</I>&gt;<i> else:
</I>&gt;<i> return &quot;ret=-1\nerrstring=wrong cmd\n\n&quot;
</I>&gt;<i>
</I>&gt;<i> def testReturn(self, ret, request):
</I>&gt;<i> if ret:
</I>&gt;<i> request.write(&quot;ret=1\nerrstring=need update\nlaststatus=%d\n\n&quot; % status)
</I>&gt;<i> else:
</I>&gt;<i> request.write(&quot;ret=0\nerrstring=no need update\n\n&quot;)
</I>&gt;<i> request.finish()
</I>&gt;<i>
</I>&gt;<i> status = 0
</I>&gt;<i>
</I>&gt;<i> log.startLogging(sys.stdout)
</I>&gt;<i> site = server.Site(Simple())
</I>&gt;<i>
</I>&gt;<i> reactor.suggestThreadPoolSize(5000)
</I>&gt;<i> reactor.listenTCP(8080, site)
</I>&gt;<i> reactor.run()
</I>&gt;<i>
</I>&gt;<i>   
</I>I've found out how to solve the problem!
I've changed python from 2.4 to 2.5, the problem has gone. It's a bug in
twisted?

-- 


&#23385;&#32461;&#36713; Yorgo Sun
 
China Distance Education Holdings Limited
18th Floor, XueYuan International Tower, No.1 ZhiChun Road, HaiDian District, Beijing, China 100083
Phone: +8610-8231-9999 Ext 708
*********************************************************** 
CONFIDENTIALITY CAUTION:
This message is intended only for the use of the individual or entity to whom it is addressed and contains information that is privileged and confidential. If you, the reader of this message, are not the intended recipient, you should not disseminate, distribute or copy this communication. If you have received this communication in error, please notify us immediately by return email and delete the original message.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019572.html">[Twisted-Python] How can I change max simultaneously connection in	twisted
</A></li>
	<LI>Next message: <A HREF="019576.html">[Twisted-Python] How can I change max simultaneously connection in	twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19575">[ date ]</a>
              <a href="thread.html#19575">[ thread ]</a>
              <a href="subject.html#19575">[ subject ]</a>
              <a href="author.html#19575">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
