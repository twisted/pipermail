<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Windows spawnProcess - Child process inherits files and sockets (POSIX does not)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Windows%20spawnProcess%20-%20Child%20process%20inherits%0A%20files%20and%20sockets%20%28POSIX%20does%20not%29&In-Reply-To=%3CCADtv4OBXh%3DjKyFCSif5OxSxJHfZ5GFUownj3amKiG6Nx98GWMw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062721.html">
   <LINK REL="Next"  HREF="062723.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Windows spawnProcess - Child process inherits files and sockets (POSIX does not)</H1>
    <B>exvito here</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Windows%20spawnProcess%20-%20Child%20process%20inherits%0A%20files%20and%20sockets%20%28POSIX%20does%20not%29&In-Reply-To=%3CCADtv4OBXh%3DjKyFCSif5OxSxJHfZ5GFUownj3amKiG6Nx98GWMw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Windows spawnProcess - Child process inherits files and sockets (POSIX does not)">ex.vitorino at gmail.com
       </A><BR>
    <I>Thu Apr  7 11:09:04 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062721.html">[Twisted-Python] Windows spawnProcess - Child process inherits files and sockets (POSIX does not)
</A></li>
        <LI>Next message (by thread): <A HREF="062723.html">[Twisted-Python] Windows spawnProcess - Child process inherits files and sockets (POSIX does not)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62722">[ date ]</a>
              <a href="thread.html#62722">[ thread ]</a>
              <a href="subject.html#62722">[ subject ]</a>
              <a href="author.html#62722">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Apr 7, 2016 at 4:57 AM, Oliver Palmer &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">oliverpalmer at opalmer.com</A>&gt; wrote:

&gt;<i> Owner of pywincffi here, I'd certainly welcome a PR or two for pywincffi
</I>&gt;<i> with the necessary functions/constants/etc so you don't have to manage that
</I>&gt;<i> code and I'd be happy to help write it too.  I think the consensus is
</I>&gt;<i> Twisted is going to eventually replace calls into pywin32 with calls into
</I>&gt;<i> pywincffi rather than implement all of that code inside of Twisted itself.
</I>&gt;<i> I've already started doing this in a couple of places,
</I>&gt;<i> twisted.python.lockfile being the one I'm actively working on because it's
</I>&gt;<i> simpler to start with.  But the code inside of dumbwin32proc.py and
</I>&gt;<i> _win32handleinherit.py are both high on my list to convert too so it
</I>&gt;<i> probably makes sense that we work on this together if you're open to it.
</I>
Certainly. Thanks for reaching out.

&gt;<i> Looking at your code, some of it could be put into pywincffi already.  It
</I>&gt;<i> would need more tests and some additional code so the API calls are closer
</I>&gt;<i> to what's already in the project (type checking, default arguments,
</I>&gt;<i> documentation, etc) but overall it seems like you've already done the major
</I>&gt;<i> work of understanding how it all fits together.  The other advantages of
</I>&gt;<i> putting this code into pywincffi is testing and releases are easier because
</I>&gt;<i> the project is using AppVeyor to test all PRs and build the wheel files for
</I>&gt;<i> most major Python versions including both 32 and 64 bit variants.  From
</I>&gt;<i> Twisted's perspective, it's just a dependency on another library.
</I>
Agreed. I'll be happy to follow your guidance in that.

&gt;&gt;<i> Just for kicks I compared the performance of the ctypes vs cffi
</I>&gt;&gt;<i> implementation: ...
</I>&gt;<i>
</I>&gt;<i> Have you tried a comparison between out-of-line modules and those using
</I>&gt;<i> dlopen?  I imagine they'd end up being pretty similar in the end performance
</I>&gt;<i> wise but I am a little curious.  In pywincffi I started out using dlopen but
</I>&gt;<i> moved away from it because I needed to write some extra code which couldn't
</I>&gt;<i> be included from a header.  The other advantage I saw is that you don't have
</I>&gt;<i> to rely on the DLL being present and/or Windows being able to locate it so
</I>&gt;<i> you can include code which might only be available if you have some extra
</I>&gt;<i> library installed.
</I>
I did not and I confess that I haven't fully grasped (yet) the
different cffi &quot;approaches&quot;, if I may call them so.

&gt;&gt;<i> It is mostly based on SysInternals information at
</I>&gt;&gt;<i> <A HREF="http://forum.sysinternals.com/howto-enumerate-handles_topic18892.html.">http://forum.sysinternals.com/howto-enumerate-handles_topic18892.html.</A> There
</I>&gt;&gt;<i> are many other references across the web to those undocumented options and
</I>&gt;&gt;<i> data structures. But none of those come from formal Microsoft documents,
</I>&gt;&gt;<i> that I could find.
</I>&gt;<i>
</I>&gt;<i> Some of the people on that site either have contacts within Microsoft or
</I>&gt;<i> have worked for Microsoft at one point so I usually trust what's there if
</I>&gt;<i> it's the only source.  The other place I often look is the ReactOS project
</I>&gt;<i> where they've managed to reverse engineer quite a bit of the Windows kernel
</I>&gt;<i> which can either hint at the info you need or validate what you already
</I>&gt;<i> know.
</I>
AFAICT, SysInternals was bought by / integrated with Microsoft: tteir
tools are now available under Microsoft domains (example: Process
Explorer at <A HREF="https://technet.microsoft.com/en-us/sysinternals/processexplorer.aspx">https://technet.microsoft.com/en-us/sysinternals/processexplorer.aspx</A>).

&gt;&gt;<i> Wrapping up: I'm really not sure how to more forward with this: not only
</I>&gt;&gt;<i> does pywin32 not provide the needed APIs, but also one of those APIs --
</I>&gt;&gt;<i> documented -- is being used in an undocumented fashion.
</I>&gt;<i>
</I>&gt;<i> IMHO (again, with some bias), I think implementing the calls you need in
</I>&gt;<i> pywincffi is the first step.  If the calls are undocumented it would also be
</I>&gt;<i> a good place to do the necessary research, testing and development I think
</I>&gt;<i> in isolation from Twisted itself so it's clear we're going in the right
</I>&gt;<i> direction.  Once that's done a patch set for Twisted, which calls into
</I>&gt;<i> pywincffi, can be opened and tested across the supported platforms.  This
</I>&gt;<i> makes the patch set smaller but also makes it easier to understand what if
</I>&gt;<i> anything the new code breaks.
</I>
Sounds like a sane and safe approach.

&gt;<i> Regardless, even if you don't want to go the route of putting this into
</I>&gt;<i> pywincffi thanks for working on this because it helps in some of the work
</I>&gt;<i> I'm doing too.
</I>
Thank you to, again. I will issue PRs against pywincffi such that the
APIs are available. They most probably won't be up to pywincffi's
standards/requirements but I expect we can cooperate under that
context and go from there.
-- 
exvito


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062721.html">[Twisted-Python] Windows spawnProcess - Child process inherits files and sockets (POSIX does not)
</A></li>
	<LI>Next message (by thread): <A HREF="062723.html">[Twisted-Python] Windows spawnProcess - Child process inherits files and sockets (POSIX does not)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62722">[ date ]</a>
              <a href="thread.html#62722">[ thread ]</a>
              <a href="subject.html#62722">[ subject ]</a>
              <a href="author.html#62722">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
