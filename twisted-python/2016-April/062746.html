<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Cause epollreactor to busyspin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Cause%20epollreactor%20to%20busyspin&In-Reply-To=%3C3e9fdfd7ec98c8a681cdcfd64ab2851e%40imap.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062745.html">
   <LINK REL="Next"  HREF="062747.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Cause epollreactor to busyspin</H1>
    <B>Tim Hughes</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Cause%20epollreactor%20to%20busyspin&In-Reply-To=%3C3e9fdfd7ec98c8a681cdcfd64ab2851e%40imap.gmail.com%3E"
       TITLE="[Twisted-Python] Cause epollreactor to busyspin">thughes at thegoldfish.org
       </A><BR>
    <I>Thu Apr 21 04:30:58 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062745.html">[Twisted-Python] Cause epollreactor to busyspin
</A></li>
        <LI>Next message (by thread): <A HREF="062747.html">[Twisted-Python] Cause epollreactor to busyspin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62746">[ date ]</a>
              <a href="thread.html#62746">[ thread ]</a>
              <a href="subject.html#62746">[ subject ]</a>
              <a href="author.html#62746">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2016-04-21 03:57, Glyph wrote:
&gt;&gt;<i> On Apr 20, 2016, at 10:37, Tim Hughes &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">thughes at thegoldfish.org</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Hi All,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I have a latency sensitive application that gets affected when it is 
</I>&gt;&gt;<i> moved between cores or the system has to wake from idling.
</I>&gt;<i> 
</I>&gt;<i> Can you explain &quot;gets affected&quot; in more detail?  If moving between
</I>&gt;<i> cores is the issue, could you set its CPU affinity?
</I>
That is exactly what I would do with a physical machine but 
unfortunately where I need to use it is in china and I only have xen 
virtual machines available. I know this isn't the best situation but 
unfortunately that is all I can get in these locations.
&gt;<i> 
</I>&gt;&gt;<i> I would like to run the thread in as tight a loop as possible and to 
</I>&gt;&gt;<i> do this i need to cause epollreactor to busyspin on receiving data.
</I>&gt;<i> 
</I>&gt;<i> I am very curious about your application now :)
</I>
We are using it to test the performance of streaming financial market 
data over different CDN providers to different cities around the world. 
Currently trying to jump through the hoops to be able to opensource it 
and stick it on github. It isn't that exciting, it is basically a 
modified LineReceiver with the delimiter set to \x01 and the messages 
are key=value pairs at a peak rate of approx 130000 pairs per second 
<A HREF="https://en.wikipedia.org/wiki/Financial_Information_eXchange">https://en.wikipedia.org/wiki/Financial_Information_eXchange</A>

&gt;<i> 
</I>&gt;&gt;<i> I have worked out how to do it by editing the twisted code directly by 
</I>&gt;&gt;<i> hard coding the value of `timeout` to be 0 at this location in the 
</I>&gt;&gt;<i> code 
</I>&gt;&gt;<i> <A HREF="https://github.com/twisted/twisted/blob/f074ba3d5083aa1503abcf194aece327e7f84805/twisted/internet/epollreactor.py#L370">https://github.com/twisted/twisted/blob/f074ba3d5083aa1503abcf194aece327e7f84805/twisted/internet/epollreactor.py#L370</A>
</I>&gt;<i> 
</I>&gt;&gt;<i> Is it possible to actually set this on the reactor in a more sensible 
</I>&gt;&gt;<i> way so I don't need to patch the twisted codebase. ? Below is 
</I>&gt;&gt;<i> basically what I am doing.
</I>&gt;<i> 
</I>&gt;<i> You can achieve this with a tiny bit of extra overhead by doing
</I>&gt;<i> something like this:
</I>&gt;<i> 
</I>&gt;<i> def cant_sleep_clown_will_eat_me():
</I>&gt;<i>     reactor.callLater(0, cant_sleep_clown_will_eat_me)
</I>&gt;<i> cant_sleep_clown_will_eat_me()
</I>
Will give this a go

&gt;<i> 
</I>&gt;<i> Does this actually improve your latency?
</I>&gt;<i> 
</I>&gt;<i> -glyph
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062745.html">[Twisted-Python] Cause epollreactor to busyspin
</A></li>
	<LI>Next message (by thread): <A HREF="062747.html">[Twisted-Python] Cause epollreactor to busyspin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62746">[ date ]</a>
              <a href="thread.html#62746">[ thread ]</a>
              <a href="subject.html#62746">[ subject ]</a>
              <a href="author.html#62746">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
