<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] why deferred.setTimeout is not my favorite API	method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20why%20deferred.setTimeout%20is%20not%20my%20favorite%20API%0A%09method&In-Reply-To=%3C20040417235922.30707.1671390040.divmod.quotient.90%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040040.html">
   <LINK REL="Next"  HREF="040045.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] why deferred.setTimeout is not my favorite API	method</H1>
    <B>exarkun at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20why%20deferred.setTimeout%20is%20not%20my%20favorite%20API%0A%09method&In-Reply-To=%3C20040417235922.30707.1671390040.divmod.quotient.90%40ohm%3E"
       TITLE="[Twisted-Python] why deferred.setTimeout is not my favorite API	method">exarkun at divmod.com
       </A><BR>
    <I>Sat Apr 17 17:59:22 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040040.html">[Twisted-Python] why deferred.setTimeout is not my favorite API	method
</A></li>
        <LI>Next message (by thread): <A HREF="040045.html">[Twisted-Python] why deferred.setTimeout is not my favorite API	method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40043">[ date ]</a>
              <a href="thread.html#40043">[ thread ]</a>
              <a href="subject.html#40043">[ subject ]</a>
              <a href="author.html#40043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 17 Apr 2004 18:22:50 -0400, Jonathan Simms &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">slyphon at twistedmatrix.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> [snip]
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> d = iReturnADeferred()
</I>&gt;<i> 
</I>&gt;<i> def onTimeout():
</I>&gt;<i>     handleTimeoutCondition()
</I>&gt;<i> 
</I>&gt;<i> delayedCall = reactor.callLater(timeoutLen, onTimeout)
</I>&gt;<i> 
</I>&gt;<i> def success(value):
</I>&gt;<i>     handleSuccess()
</I>&gt;<i> 
</I>&gt;<i> def nonTimeoutFailure(reason):
</I>&gt;<i>     handleErrorCondition()
</I>&gt;<i> 
</I>&gt;<i> def cancelTimeout(val):
</I>&gt;<i>     if delayedCall.active():
</I>&gt;<i>         delayedCall.cancel()
</I>
      return val

&gt;<i> 
</I>&gt;<i> d.addBoth(cancelTimeout)
</I>&gt;<i> d.addCallback(success)
</I>&gt;<i> d.addErrback(nonTimeoutFailure)
</I>&gt;<i> 
</I>&gt;<i> -------------------------------------------------------
</I>
  While I think the above is very close to being correct (it even fooled me into thinking it was correct for several minutes, during which I composed an alternate email expounding on how we might simplify users' lives by extracting the common portions of the above into a helper function), ultimately even it does not solve all the issues relating to timing out Deferreds.

  The problem is simply that &quot;onTimeout&quot; in the above code cannot be correctly defined by anyone except the person who defined &quot;iReturnADeferred&quot;.

  The above pattern may be useful for framework implementors, but not users.  Framework implementors typically (though not always) understand how to handle timeout issues, so this is of little help.

  I think that users asking for help with setTimeout or with timing out Deferreds need to be handled in one of two ways:

  1) Direct them to APIs related to the features they wish to use with timeouts that already support timeouts directly (ie, not through setTimeout calls on the Deferreds they return).  Examples of such APIs include twisted.web.client.getPage and twisted.names.client.lookupAddress.

  2) If APIs for the feature they wish to use do not support timeouts, explain this.  Recommend that the user submit a patch or open an issue on the bug tracker, and/or apologize to them that Twisted is not yet perfect in every respect.

&gt;<i> [snip]
</I>&gt;<i> 
</I>&gt;<i> It makes no sense to leave a sharp, pointy thing lying around for users
</I>&gt;<i> to hurt themselves with, and to constantly tell them &quot;DON'T USE THAT&quot;.
</I>&gt;<i> 
</I>
  I think that deprecating setTimeout is a good thing, even if several years must pass before we can actually remove it.  In addition to the reasons Jonathan gave, I will add this:

  setTimeout() is the only part of Deferreds that tie them to twisted.internet.  If it is removed, defer.py could (other issues, such as backwards compatibility and user consternation aside) be moved to the twisted.python package.  It also makes it that much easier to use Deferreds with a non-Twisted reactor.

  Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040040.html">[Twisted-Python] why deferred.setTimeout is not my favorite API	method
</A></li>
	<LI>Next message (by thread): <A HREF="040045.html">[Twisted-Python] why deferred.setTimeout is not my favorite API	method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40043">[ date ]</a>
              <a href="thread.html#40043">[ thread ]</a>
              <a href="subject.html#40043">[ subject ]</a>
              <a href="author.html#40043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
