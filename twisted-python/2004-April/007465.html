<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] follow up: at what point does reactor.run() need	to be called?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20follow%20up%3A%20at%20what%20point%20does%20reactor.run%28%29%20need%0A%09to%20be%20called%3F&In-Reply-To=20040407080434.49961.qmail%40web80506.mail.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007464.html">
   <LINK REL="Next"  HREF="007466.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] follow up: at what point does reactor.run() need	to be called?</H1>
    <B>Neil Blakey-Milner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20follow%20up%3A%20at%20what%20point%20does%20reactor.run%28%29%20need%0A%09to%20be%20called%3F&In-Reply-To=20040407080434.49961.qmail%40web80506.mail.yahoo.com"
       TITLE="[Twisted-Python] follow up: at what point does reactor.run() need	to be called?">nbm at mithrandr.moria.org
       </A><BR>
    <I>Wed Apr  7 04:48:55 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007464.html">[Twisted-Python] follow up: at what point does reactor.run() need	to be called?
</A></li>
        <LI>Next message: <A HREF="007466.html">[Twisted-Python] Connection close identifier
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7465">[ date ]</a>
              <a href="thread.html#7465">[ thread ]</a>
              <a href="subject.html#7465">[ subject ]</a>
              <a href="author.html#7465">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed 2004-04-07 (01:04), Damon Fasching wrote:
&gt;<i> What I really see as a limitation is that it seems
</I>&gt;<i> that I must connect to all of my servers before
</I>&gt;<i> starting the reactor, something which is only done
</I>&gt;<i> once per process.  And because of that, I can't
</I>&gt;<i> interact with any of the servers until I have
</I>&gt;<i> connected to all of them (because the reactor isn't
</I>&gt;<i> running before then).
</I>&gt;<i> 
</I>&gt;<i> For example, why does the client hang if I change the
</I>&gt;<i> last lines to the following?
</I>&gt;<i> 
</I>&gt;<i> reactor.run()
</I>&gt;<i> factory = pb.PBClientFactory()
</I>&gt;<i> reactor.connectTCP(&quot;localhost&quot;, 8789, factory)
</I>&gt;<i> d = factory.getRootObject()
</I>&gt;<i> d.addCallback(gotRootObject)
</I>&gt;<i> d.addErrback(remoteCallFailure, &quot;getRootObject&quot;)
</I>&gt;<i> 
</I>&gt;<i> This seems to be an inevitable sequence of calls if I
</I>&gt;<i> want to be able to connect to a server after having
</I>&gt;<i> already connected to and intereacted with other
</I>&gt;<i> servers.  Start the reactor, do some stuff, and then
</I>&gt;<i> at a later point, connect to another server.  If I
</I>&gt;<i> substitute those lines for the original last 6 lines,
</I>&gt;<i> start the server and start the client...nothing
</I>&gt;<i> happens.  They both just sit there.
</I>&gt;<i> 
</I>&gt;<i> What have I misunderstood?
</I>&gt;<i> 
</I>&gt;<i> How can I connect to a server on the fly?
</I>
'reactor.run()' (almost) only returns when you're about to exit your
program.

It starts an &quot;event loop&quot;, whereby it responds to events (such as
information arriving from sockets, timers expiring, &amp;c.) for the rest of
its existence.

Event-based programming requires you to think about actions as responses
to events that may occur any time in the future relative to where you
are in the code.  So, you might:

1) After the reactor is called, a callLater'd function will be called
that will attempt to connect to a server.

2) An event informs you that you've been connected to that server, and
you send a query to the server.

3) An event informs you that the server has sent you some data (or
you're using LineReceiver, sux, or some other higher-level event
generator), and you close the connection.  Based on the data you
received, you want to connect to another server.

4) An event informs you that you've connected to the new server.  You
send the stored information or something derived from it to the server.

5) An event informs you that the new server has successfully received
your message (say, you're using SMTP and get an appropriate delivery
response).  You close the connection.  You set up a callLater function
to be called in five minutes start at step 1 again.

...

So, &quot;at a later point&quot; is a response based on an event - either
time-based or I/O-based (but probably abstracted away from simple socket
I/O for you).

If you start the reactor before setting up things that will generate
events, the reactor will never receive any events, and as such won't
start the response functions (callbacks), so basically nothing will
happen.

But you can set up new things that generate events (ie, connect to new
servers, start your own server, set up timers) after the reactor starts,
it just has to be in a response to some other event.

Neil
-- 
Neil Blakey-Milner
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nbm at mithrandr.moria.org</A>
<A HREF="http://mithrandr.moria.org/">http://mithrandr.moria.org/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007464.html">[Twisted-Python] follow up: at what point does reactor.run() need	to be called?
</A></li>
	<LI>Next message: <A HREF="007466.html">[Twisted-Python] Connection close identifier
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7465">[ date ]</a>
              <a href="thread.html#7465">[ thread ]</a>
              <a href="subject.html#7465">[ subject ]</a>
              <a href="author.html#7465">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
