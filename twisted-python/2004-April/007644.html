<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Transporting pb.Copyable classes?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Transporting%20pb.Copyable%20classes%3F&In-Reply-To=20040421010606.9235.84782281.divmod.quotient.4%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007642.html">
   <LINK REL="Next"  HREF="007651.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Transporting pb.Copyable classes?</H1>
    <B>Jasper Phillips</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Transporting%20pb.Copyable%20classes%3F&In-Reply-To=20040421010606.9235.84782281.divmod.quotient.4%40ohm"
       TITLE="[Twisted-Python] Transporting pb.Copyable classes?">jasper at peak.org
       </A><BR>
    <I>Tue Apr 20 21:44:40 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007642.html">[Twisted-Python] Transporting pb.Copyable classes?
</A></li>
        <LI>Next message: <A HREF="007651.html">[Twisted-Python] Transporting pb.Copyable classes?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7644">[ date ]</a>
              <a href="thread.html#7644">[ thread ]</a>
              <a href="subject.html#7644">[ subject ]</a>
              <a href="author.html#7644">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Wed, 21 Apr 2004 <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A> wrote:

&gt;<i> On Tue, 20 Apr 2004 17:48:00 -0700 (PDT), Jasper Phillips &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jasper at peak.org</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Wed, 21 Apr 2004, Andrew Bennetts wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; On Tue, Apr 20, 2004 at 04:20:32PM -0700, Jasper Phillips wrote:
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; I've been passing around instances of pb.Copyable classes for some
</I>&gt;<i> &gt; &gt; &gt; time, registering them via pb.setCopierForClassTree()...  However,
</I>&gt;<i> &gt; &gt; &gt; this doesn't allow me to pass the classes themselves.
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; I dug around in jelly and found
</I>&gt;<i> &gt; &gt; &gt; jelly.globalSecurity.allowInstancesOf(), which seems to do what I
</I>&gt;<i> &gt; &gt; &gt; want, but makes me nervious as it's pretty buried...
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; Passing classes seems like a reasonable thing to do, but now I
</I>&gt;<i> &gt; &gt; &gt; wonder if there is some reason that jelly doesn't allow it (except
</I>&gt;<i> &gt; &gt; &gt; via a buried method call)?  Or is this just an accidental
</I>&gt;<i> &gt; &gt; &gt; misfeature?
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Why not just pass the name of the class, and unserialise that as
</I>&gt;<i> &gt; &gt; appropriate?
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; I'm not a PB expert (or even close), but I always lean towards passing
</I>&gt;<i> &gt; &gt; data rather than code (or code-like things like classes) over remote
</I>&gt;<i> &gt; &gt; method calls when I can :)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; That's certainly feasible, but then I have an extra unserialize step
</I>&gt;<i> &gt; cluttering my code as the classes passed have attributes I want to access.
</I>&gt;<i> &gt; In general I'm passing game state which exists naturally as code, and while
</I>&gt;<i> &gt; I could always serialize and unserialize it, why bother if I don't have to?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Plus, isn't unserializing classes based upon their name exactly what jelly
</I>&gt;<i> &gt; does?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On the other hand it's debateable whether the things I'm passing
</I>&gt;<i> &gt; _should_ be classes at all (they represent a type of terrain, with
</I>&gt;<i> &gt; statically accessible fields describing their game effects).  However,
</I>&gt;<i> &gt; the quality of my code is really a seperate issue.
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i>   Just to be sure I'm reading this correctly, you have something like...
</I>&gt;<i> 
</I>&gt;<i>     class Foo:
</I>&gt;<i>         bar = []
</I>&gt;<i> 
</I>&gt;<i>     Foo.bar.append(baz)
</I>&gt;<i>     someRemoteRef.callRemote('doStuff', Foo)
</I>&gt;<i> 
</I>&gt;<i>   where you want 'remote_doStuff' to receive a class object whose &quot;bar&quot;
</I>&gt;<i>   attribute is [baz] (or possibly [RemoteReference(baz)], or *something*
</I>&gt;<i>   containing baz)?  If not, disregard the rest of my post :)  Otherwise
</I>&gt;<i>   ...
</I>
Oh no, no mutable state!  Purely static data and static methods.
What I have coils down to something like this:

class Terrain( pb.Copyable, pb.RemoteCopy ):
    def moveCost( cls, unit ):
        return cls.cost
    moveCost = classmethod( moveCost )

class Mountains( Terrain ):
    cost = 6


A bunch of hexes then have their .terrain = Mountains (etc.)  I could easily
change this to instantiation the various Terrains, but in my mind that
implies that an instance's state could differ.  I'm beginning to think
the distinction is more trouble than it's worth however, and potentially
confusing.

&gt;<i>   You're going to have difficulty using PB with this approach.  PB can
</I>&gt;<i>   serialize classes, but it does so in exactly the way Andrew described:
</I>&gt;<i>   it looks up their name and sends it, and the other side turns the name
</I>&gt;<i>   back into an object.  Any mutable class state you change on one side
</I>&gt;<i>   will *not* be reflected on the other side.
</I>
This is exactly what I want for these classes.

&gt;<i>   I'd recommend moving your mutable state off these class objects and onto
</I>&gt;<i>   instances of some sort.  Otherwise, you will have to implement special
</I>&gt;<i>   jelliers/unjelliers for the class objects you want treated specially.
</I>
Sorry for the confusion!  I really didn't mean to bring my code into the
discussion, I just want to know whether passing class objects is supposed to
work, because it doesn't for me (i.e. I get Insecure Jelly exceptions)
without tweaking inner bits of Twisted.

-Jasper



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007642.html">[Twisted-Python] Transporting pb.Copyable classes?
</A></li>
	<LI>Next message: <A HREF="007651.html">[Twisted-Python] Transporting pb.Copyable classes?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7644">[ date ]</a>
              <a href="thread.html#7644">[ thread ]</a>
              <a href="subject.html#7644">[ subject ]</a>
              <a href="author.html#7644">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
