<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Transporting pb.Copyable classes?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Transporting%20pb.Copyable%20classes%3F&In-Reply-To=20040421185337.9235.1895087205.divmod.quotient.13%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007653.html">
   <LINK REL="Next"  HREF="007655.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Transporting pb.Copyable classes?</H1>
    <B>Jasper Phillips</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Transporting%20pb.Copyable%20classes%3F&In-Reply-To=20040421185337.9235.1895087205.divmod.quotient.13%40ohm"
       TITLE="[Twisted-Python] Transporting pb.Copyable classes?">jasper at peak.org
       </A><BR>
    <I>Wed Apr 21 17:03:47 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007653.html">[Twisted-Python] Transporting pb.Copyable classes?
</A></li>
        <LI>Next message: <A HREF="007655.html">[Twisted-Python] Unwinding the Twisted Web (a progress report)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7654">[ date ]</a>
              <a href="thread.html#7654">[ thread ]</a>
              <a href="subject.html#7654">[ subject ]</a>
              <a href="author.html#7654">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Wed, 21 Apr 2004 <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A> wrote:

&gt;<i> On Wed, 21 Apr 2004 09:57:47 -0700 (PDT), Jasper Phillips &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jasper at peak.org</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; All this seems to me like frantic contortion to avoid a bug in jelly.
</I>&gt;<i> &gt; Shouldn't it be able to translate passed class objects into the remote
</I>&gt;<i> &gt; version, provided they have been properly registered?  Is there some reason
</I>&gt;<i> &gt; why not that I am missing?
</I>&gt;<i> 
</I>&gt;<i>   Indeed.  While I would do this differently, jelly should certainly be
</I>&gt;<i>   able to handle your approach.  Let's get into specifics, shall we?
</I>&gt;<i>   Here's some code:
</I>
I may end up doing it differently, but one thing at a time!  I'm in the
midst of upgrading to new cred, and already have plenty of scope with which
to hang myself. ;-)

I'm not particularily attached to the static class approach, it just
happened to be what came to mind when prototyping.  I'm definitely curious
now what you would do...  I've been programming in a vacuum for quite a
while. :-(


&gt;<i> &gt;&gt;&gt; from twisted.spread import jelly
</I>&gt;<i> &gt;&gt;&gt; class Foo: pass
</I>&gt;<i> ... 
</I>&gt;<i> &gt;&gt;&gt; f = Foo()
</I>&gt;<i> &gt;&gt;&gt; f.bar = Foo
</I>&gt;<i> &gt;&gt;&gt; jelly.jelly(f)
</I>&gt;<i> ['__main__.Foo', ['dictionary', ['bar', ['class', '__main__.Foo']]]]
</I>&gt;<i> 
</I>&gt;<i>   So far, so good.
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt;&gt; from twisted.spread import pb     
</I>&gt;<i> &gt;&gt;&gt; class Foo(pb.Copyable):
</I>&gt;<i> ...     pass
</I>&gt;<i> ... 
</I>&gt;<i> &gt;&gt;&gt; f = Foo()
</I>&gt;<i> &gt;&gt;&gt; f.bar = Foo
</I>&gt;<i> &gt;&gt;&gt; jelly.jelly(f)
</I>&gt;<i> ['__main__.Foo', ['dictionary', ['bar', ['class', '__main__.Foo']]]]
</I>&gt;<i> 
</I>&gt;<i>   Hmm, that works too.  I expected it not to, actually.  I suppose
</I>&gt;<i>   something you're doing with globalSecurity or setCopierForClassTree()
</I>&gt;<i>   may be mucking things up.
</I>
This test case doesn't seem quite right...  Why doesn't it fail since Foo
hasn't been registered?  Hmmm, looks like jelly()'s taster arg defaults to
DummySecurityOptions()...

What about registering Foo, and then calling with jelly.globalSecurity?:
---- Code ----
from twisted.spread import jelly, pb

class Foo( pb.Copyable ):  pass
jelly.setUnjellyableForClass( Foo, Foo )
#jelly.globalSecurity.allowInstancesOf( Foo )  # uncomment to fix

if __name__ == '__main__':
    f = Foo()
    f.bar = Foo
    print jelly.jelly( f, taster=jelly.globalSecurity )

---- End Code ----

This gives the Insecure Jelly exception I'm seeing, from jelly.py:482...
However, comment out `f.bar = Foo` or uncomment allowInstancesOf() and it
works.

Oh, and I'm using twisted 1.2 and python 2.3.3.


[snip]
&gt;<i>   Posting a demonstrative test case would be excellent :)  I suspect there
</I>&gt;<i>   is no bug in jelly, just a disagreement in expectations which can easily
</I>&gt;<i>   be resolved once there is a concrete example to talk about.
</I>
Is this a decent example?  As for a fix, it looks like the solution is there
in SecurityOptions.allowsInstancesOf(), but that it's just not exposed.

-Jasper



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007653.html">[Twisted-Python] Transporting pb.Copyable classes?
</A></li>
	<LI>Next message: <A HREF="007655.html">[Twisted-Python] Unwinding the Twisted Web (a progress report)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7654">[ date ]</a>
              <a href="thread.html#7654">[ thread ]</a>
              <a href="subject.html#7654">[ subject ]</a>
              <a href="author.html#7654">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
