<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ftp passive mode returning internal IP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ftp%20passive%20mode%20returning%20internal%20IP&In-Reply-To=CAFycZ9dkbgxKNm%3DOKVcrtsB5Sy4kKt5GWqfPwhz-rRAik_aetQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026302.html">
   <LINK REL="Next"  HREF="026306.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ftp passive mode returning internal IP</H1>
    <B>Paul Wiseman</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ftp%20passive%20mode%20returning%20internal%20IP&In-Reply-To=CAFycZ9dkbgxKNm%3DOKVcrtsB5Sy4kKt5GWqfPwhz-rRAik_aetQ%40mail.gmail.com"
       TITLE="[Twisted-Python] ftp passive mode returning internal IP">poalman at gmail.com
       </A><BR>
    <I>Tue Nov 20 17:02:02 EST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="026302.html">[Twisted-Python] ftp passive mode returning internal IP
</A></li>
        <LI>Next message: <A HREF="026306.html">[Twisted-Python] ftp passive mode returning internal IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26303">[ date ]</a>
              <a href="thread.html#26303">[ thread ]</a>
              <a href="subject.html#26303">[ subject ]</a>
              <a href="author.html#26303">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20 November 2012 21:31, Adi Roiban &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I don't think there is support for configuring the advertised IP address.
</I>&gt;<i> I don't know how EC2 ip forwarding works and how can you retrieve it.
</I>&gt;<i>
</I>&gt;<i> To use another IP address, in FTP.ftp_PASV(), look for the following lines:
</I>&gt;<i>
</I>&gt;<i>         self.dtpPort = self.getDTPPort(self.dtpFactory)
</I>&gt;<i>
</I>&gt;<i>         host = self.transport.getHost().host
</I>&gt;<i>         port = self.dtpPort.getHost().port
</I>&gt;<i>
</I>&gt;<i> Just replace 'self.transport.getHost().host' with your required IP or
</I>&gt;<i> another method for retrieving the IP address.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Adi
</I>&gt;<i>
</I>&gt;<i>
</I>Cheers Adi, I've made a function that launches 'curl ifconfig.me' through
subprocess, and I call that and save it when the server starts.

Is this definitely the only place where I need to override the host?

I'd rather wrap the transport object to be sure but twisted is still pretty
magic to me and I'm struggling to find out where this ProtocolWrapper
object is originating from.


&gt;<i> On 20 November 2012 22:47, Paul Wiseman &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">poalman at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; This possibly has nothing to do with twisted, but maybe if not someone
</I>&gt;<i> may
</I>&gt;<i> &gt; be able to point me in the right direction!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Basically I've set up a twisted FTP server on ec2, and when a client
</I>&gt;<i> tries
</I>&gt;<i> &gt; to enter passive mode I'm getting this:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Response: 227 Entering Passive Mode (x,x,x,x,159,122).
</I>&gt;<i> &gt; Status: Server sent passive reply with unroutable address. Using server
</I>&gt;<i> &gt; address instead.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; the x.x.x.x is the boxes private IP, rather than its public IP.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's getting this from ln. 851 in twisted/protocols/ftp.py v12.2.0
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is there somehow I can change the way twisted is getting the IP, or is
</I>&gt;<i> this
</I>&gt;<i> &gt; an issue with the server set up itself?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Any pointers or help on what to look/check for would be of huge help!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Paul
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Adi Roiban
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20121120/abe48fe3/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20121120/abe48fe3/attachment.htm</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026302.html">[Twisted-Python] ftp passive mode returning internal IP
</A></li>
	<LI>Next message: <A HREF="026306.html">[Twisted-Python] ftp passive mode returning internal IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26303">[ date ]</a>
              <a href="thread.html#26303">[ thread ]</a>
              <a href="subject.html#26303">[ subject ]</a>
              <a href="author.html#26303">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
