<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted Conch - Flow control
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Conch%20-%20Flow%20control&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026269.html">
   <LINK REL="Next"  HREF="026273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted Conch - Flow control</H1>
    <B>Matt Freeman</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Conch%20-%20Flow%20control&In-Reply-To="
       TITLE="[Twisted-Python] Twisted Conch - Flow control">matt at nonuby.com
       </A><BR>
    <I>Tue Nov  6 22:49:34 EST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="026269.html">[Twisted-Python] Create client in Server factory
</A></li>
        <LI>Next message: <A HREF="026273.html">[Twisted-Python] Twisted Conch - Flow control
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26270">[ date ]</a>
              <a href="thread.html#26270">[ thread ]</a>
              <a href="subject.html#26270">[ subject ]</a>
              <a href="author.html#26270">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I asked this question on  Stackoverflow (even offered a bounty) and IRC:

<A HREF="http://stackoverflow.com/questions/13117502/twisted-conch-flow-control">http://stackoverflow.com/questions/13117502/twisted-conch-flow-control</A>
--

I have a Twisted Conch SSH server and the typical scenario is this:

git via OpenSSH client &gt;&gt;--- WAN1 ---&gt;&gt; Twisted conch svr &gt;&gt;--- WAN2 --&gt;&gt;
Git server

There will be occassions that the 'git push' is sending data faster over
WAN1 than I can proxy it over WAN2, so I need to tell the client to slow
down (well before any TCP packet loss causes adjustments the TCP window
size) to avoid buffering too much on the Twisted server. Reading the RFC
for SSH this is accomplished with not acknowledging via adj window this
will then cause the git push to block on syscall write to the pipe backed
by openssh.

Looking at conch/ssh/connection.py:L216 in the method def
ssh_CHANNEL_DATA(self, packet): I can accomplish this with setting
localWindowSize to 0, and inflight data will still land as the predicate on
230 should still pass (give localWindowLeft). I am wondering if this is the
correct approach or am I missing something blindly obvious with regards to
flow control with Twisted SSH Conch? *

Note: I acknowledge there are methods placeholders for stopWriting and
startWriting on (channel) that I can override so I have hooks to control
the other side of the transmission 'git pull', but Im interested in first
leg. Also IPush/IPull producer dont seem applicable at this level and I
cant see how I can tie in these higher abstraction without butchering
conch?
-- 
Matt Freeman - @nonuby - <A HREF="http://blog.nonuby.com">http://blog.nonuby.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20121107/1b88b887/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20121107/1b88b887/attachment.htm</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026269.html">[Twisted-Python] Create client in Server factory
</A></li>
	<LI>Next message: <A HREF="026273.html">[Twisted-Python] Twisted Conch - Flow control
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26270">[ date ]</a>
              <a href="thread.html#26270">[ thread ]</a>
              <a href="subject.html#26270">[ subject ]</a>
              <a href="author.html#26270">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
