<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] utf-8 support for ftp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20utf-8%20support%20for%20ftp&In-Reply-To=%3CCACgdh2gD5feDgFS7-yqeN-UMi1CJEvPzq2pSu%3D8KyMh4N%3DANgg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058779.html">
   <LINK REL="Next"  HREF="058782.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] utf-8 support for ftp</H1>
    <B>Paul Wiseman</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20utf-8%20support%20for%20ftp&In-Reply-To=%3CCACgdh2gD5feDgFS7-yqeN-UMi1CJEvPzq2pSu%3D8KyMh4N%3DANgg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] utf-8 support for ftp">poalman at gmail.com
       </A><BR>
    <I>Thu Nov 22 10:15:01 MST 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058779.html">[Twisted-Python] utf-8 support for ftp
</A></li>
        <LI>Next message (by thread): <A HREF="058782.html">[Twisted-Python] Making ConnectionPool not pool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58780">[ date ]</a>
              <a href="thread.html#58780">[ thread ]</a>
              <a href="subject.html#58780">[ subject ]</a>
              <a href="author.html#58780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22 November 2012 11:35, Adi Roiban &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt; wrote:

&gt;<i> On 21 November 2012 19:45, Paul Wiseman &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">poalman at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; On 21 November 2012 17:35, Paul Wiseman &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">poalman at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I know this has been asked before, I've found it in several trackers.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; <A HREF="http://twistedmatrix.com/trac/ticket/5411">http://twistedmatrix.com/trac/ticket/5411</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://twistedmatrix.com/trac/ticket/4515">http://twistedmatrix.com/trac/ticket/4515</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://twistedmatrix.com/trac/ticket/5100">http://twistedmatrix.com/trac/ticket/5100</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Some of these were created a while ago, some with patches. I wondered
</I>&gt;<i> what
</I>&gt;<i> &gt;&gt; the current status was with regards to utf-8 in ftp? Is it currently
</I>&gt;<i> &gt;&gt; possible?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I'm trying to list a folder called 'Paul’s Mac Pro', this gets returned
</I>&gt;<i> as
</I>&gt;<i> &gt;&gt; 'Paulâ s Mac Pro'. The client tries to list that folder, and the server
</I>&gt;<i> &gt;&gt; returns 'PaulÃ¢Â Â s Mac Pro: No such file or directory.' I think the
</I>&gt;<i> client
</I>&gt;<i> &gt;&gt; is interpreting the bytes that make up the unicode char as separate
</I>&gt;<i> ascii
</I>&gt;<i> &gt;&gt; characters. (maybe a problem with the client? FileZilla 3.6.0.1)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; This problem may be made worse by my implementation of IFTPShell, I can
</I>&gt;<i> &gt;&gt; try to make an example if this isn't the expected result.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I'm returning all names and paths back encoded in utf-8, but maybe the
</I>&gt;<i> &gt;&gt; problem is the client isn't expecting it because there's no FEAT
</I>&gt;<i> command (is
</I>&gt;<i> &gt;&gt; the patch in 4515 ok to add?)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I just want to get an idea of how I can best go about getting this to
</I>&gt;<i> &gt;&gt; work. Will I need to build in support, or is it available in a newer
</I>&gt;<i> &gt;&gt; version, or by applying some patches?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks very much!!
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Paul
</I>&gt;<i>
</I>&gt;<i> The patch from #4515 does little to provide a functional UTF-8 FTP
</I>&gt;<i> implementation.
</I>&gt;<i> It is there only to help advertise future implementation of UTF-8 support.
</I>&gt;<i>
</I>&gt;<i> Thanks for reminding about #5411 . I have submitted a patch for review
</I>&gt;<i> together with required tests.
</I>&gt;<i>
</I>&gt;<i> I have a few more FTP ticket in work/waiting for review. As soon as
</I>&gt;<i> they are done, I will look at UTF-8 support.
</I>&gt;<i>
</I>&gt;<i>
</I>Awesome- sounds good! I'll keep an eye out for it! :)


&gt;<i> ----
</I>&gt;<i>
</I>&gt;<i> Patch #4515 is already in trunk, and together with patch for #5411 it
</I>&gt;<i> should be a good start for UTF-8 support.
</I>&gt;<i>
</I>&gt;<i> Ticket #5100 is mainly about the default IFTPShell implementation, but
</I>&gt;<i> if you have your own IFTPShell implementation just make sure it
</I>&gt;<i> accepts input as str encoded utf-8 and that it output str encoded
</I>&gt;<i> utf-8
</I>&gt;<i>
</I>
My IFPShell does this, I have crudely added ftp_FEAT and ftp_OPT to a
subclass of FTP which returns UTF8 in the list of features and responds
with CMD_OK for &quot;UTF8 ON&quot; OPT. Which will hopefully get me by until there
is support.

I'd like to help add support, but I'm not sure how you'd do it. The FTP
protocol needs to know what to return if a client asks UTF8 ON in OPT, but
it's up to the shell which needs to make sure it complies with this option
and return things in the right encoding? unless everything is returned in
unicode and the FTP protocol encodes it if utf8 is on, or throws an error
if anything is outside an ascii range.

but there are certain parts of it sound quite tricky to get right:

   &quot;Prior to transmitting response code 200 in response to the OPTS UTF-8

   command, the Server-FTP must not transmit UTF-8 encoded pathnames and
   should not accept them on commands: the Server-FTP should transmit
   either response code 501 or 553 in reply to any command which
   includes a pathname outside the range of 7-bit ASCII; and the Server-
   FTP should transmit response code 550 in reply to any command to
   which the server would otherwise have sent a UTF-8 encoded pathname.&quot;

     <A HREF="http://tools.ietf.org/html/draft-ietf-ftpext-utf-8-option-00#page-6">http://tools.ietf.org/html/draft-ietf-ftpext-utf-8-option-00#page-6</A>



&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Adi Roiban
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20121122/1a9798b2/attachment-0001.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058779.html">[Twisted-Python] utf-8 support for ftp
</A></li>
	<LI>Next message (by thread): <A HREF="058782.html">[Twisted-Python] Making ConnectionPool not pool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58780">[ date ]</a>
              <a href="thread.html#58780">[ thread ]</a>
              <a href="subject.html#58780">[ subject ]</a>
              <a href="author.html#58780">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
