<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted thumbnail server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20thumbnail%20server&In-Reply-To=%3CCACgdh2iR%2BfiQqb0iERB5A%3DUkp%3D0OuK4gMsSY2d07Cif8xkOhqg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058732.html">
   <LINK REL="Next"  HREF="058730.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted thumbnail server</H1>
    <B>Paul Wiseman</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20thumbnail%20server&In-Reply-To=%3CCACgdh2iR%2BfiQqb0iERB5A%3DUkp%3D0OuK4gMsSY2d07Cif8xkOhqg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] twisted thumbnail server">poalman at gmail.com
       </A><BR>
    <I>Fri Nov  2 09:42:31 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058732.html">[Twisted-Python] deferToThread and reactor loop
</A></li>
        <LI>Next message (by thread): <A HREF="058730.html">[Twisted-Python] twisted thumbnail server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58729">[ date ]</a>
              <a href="thread.html#58729">[ thread ]</a>
              <a href="subject.html#58729">[ subject ]</a>
              <a href="author.html#58729">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I hope this will be an easy question for some of you guys :)

I'm trying to set up a simple server which will accept requests over GET to
create a thumbnail for an image, and server it back as the response.

The images are stored in two S3 buckets, the originals are in one bucket
(store), and the generated thumbnails are stored in another (thumb) as a
cache so that the work doesn't need to be repeated.

Currently I'm checking if the thumbnail already exists in the thumb bucket.
I'm redirecting the request if it is or if not I'm downloading the image
from store, generating the thumb using PIL, uploading the thumbnail to the
thumb bucket and then redirecting the request.

I'm very new to twisted and was wondering if anyone who is more experienced
would be able to take a look at what I have so far and let me know if
anything is wrong/not ideal/will cause problems etc. or just general style
pointers? The more critical the better, as I said I'm very new to this.

I've just chucked it up on github:
<A HREF="https://github.com/GP89/thumbs/blob/master/thumb.py">https://github.com/GP89/thumbs/blob/master/thumb.py</A>

There's a definite memory leak right now which I believe is PIL, or
possibly StringIO objects not being disposed, hence all the random del
statements trying to cure it (unsuccessfully). Maybe there's something I'm
doing wrong in twisted that is causing things not to be cleaned up that I'm
not aware of as well.

I did try to use deferToThread, rather than my thread pool but the server
seemed to block up- I probably should have left it incase it was because I
was doing something obviously wrong. I think I'll make a branch quickly
with my deferToThread version.

Thanks very much for any time you can lend!

Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20121102/e8fa5d36/attachment-0001.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058732.html">[Twisted-Python] deferToThread and reactor loop
</A></li>
	<LI>Next message (by thread): <A HREF="058730.html">[Twisted-Python] twisted thumbnail server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58729">[ date ]</a>
              <a href="thread.html#58729">[ thread ]</a>
              <a href="subject.html#58729">[ subject ]</a>
              <a href="author.html#58729">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
