<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Specifying the local port for a twisted.names DNS query or resolver
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Specifying%20the%20local%20port%20for%20a%20twisted.names%0A%20DNS%20query%20or%20resolver&In-Reply-To=%3CBANLkTimWmvFPJpR%2BN0FyEiC9oDZP09e54w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056537.html">
   <LINK REL="Next"  HREF="056545.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Specifying the local port for a twisted.names DNS query or resolver</H1>
    <B>Anton Gyllenberg</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Specifying%20the%20local%20port%20for%20a%20twisted.names%0A%20DNS%20query%20or%20resolver&In-Reply-To=%3CBANLkTimWmvFPJpR%2BN0FyEiC9oDZP09e54w%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Specifying the local port for a twisted.names DNS query or resolver">anton at iki.fi
       </A><BR>
    <I>Tue Jun 14 23:52:09 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056537.html">[Twisted-Python] Specifying the local port for a	twisted.names	DNS query or resolver
</A></li>
        <LI>Next message (by thread): <A HREF="056545.html">[Twisted-Python] Specifying the local port for a	twisted.names	DNS query or resolver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56542">[ date ]</a>
              <a href="thread.html#56542">[ thread ]</a>
              <a href="subject.html#56542">[ subject ]</a>
              <a href="author.html#56542">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Jun 14, 2011 at 9:01 PM,  &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
&gt;<i> We'd be happy to have such a feature officially supported. Â Would you
</I>&gt;<i> like to work on a patch that adds a tested, documented hook for
</I>&gt;<i> selecting the source port?
</I>
Perhaps I could work on such a patch. I would be thankful for any tips
on where to start and what would be a good interface.

I looked at the code again, and I think the source port is selected by
calling dns.randomSource() deep in
twisted.names.client.Resolver._connectedProtocol(). This could perhaps
be broken out to a separate method of client.Resolver. It would
probably make sense to at the same time let the local IP address
(interface) be specified in addition to the port (as with the
bindAddress parameter). So perhaps Resolver._connectedProtocol() could
call a new method client.Resolver.getUDPBindAddress(), with the
default implementation returning ('', dns.getRandomSource()). Then a
user could subclass Resolver and override the getUDPBindAddress method
(or monkey patch an existing Resolver).

Currently Resolver._connectedProtocol() wraps the call to
dns.randomSource() and listenUDP in a &quot;while True&quot; loop, catching
CannotListenError so that if the randomly selected port is in use, a
new port will be selected by random. If we let the user change the
port selection logic, it might be good to safeguard against infinitely
looping if e.g., the user decides to always return the same port.
Perhaps re-raise the CannotListenError exception on the N-th loop.

Am I on the right track?

Best regards
Anton


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056537.html">[Twisted-Python] Specifying the local port for a	twisted.names	DNS query or resolver
</A></li>
	<LI>Next message (by thread): <A HREF="056545.html">[Twisted-Python] Specifying the local port for a	twisted.names	DNS query or resolver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56542">[ date ]</a>
              <a href="thread.html#56542">[ thread ]</a>
              <a href="subject.html#56542">[ subject ]</a>
              <a href="author.html#56542">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
