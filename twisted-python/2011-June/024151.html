<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to wait for a transport to write some data	before loosing the connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20wait%20for%20a%20transport%20to%20write%20some%20data%0A%09before%20loosing%20the%20connection&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024157.html">
   <LINK REL="Next"  HREF="024153.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to wait for a transport to write some data	before loosing the connection</H1>
    <B>emmanuel CAZENAVE</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20wait%20for%20a%20transport%20to%20write%20some%20data%0A%09before%20loosing%20the%20connection&In-Reply-To="
       TITLE="[Twisted-Python] How to wait for a transport to write some data	before loosing the connection">emmanuel.cazenave at gmail.com
       </A><BR>
    <I>Tue Jun 28 05:45:08 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024157.html">[Twisted-Python] jQuery.Deferred - why did they have to go and change the interface?
</A></li>
        <LI>Next message: <A HREF="024153.html">[Twisted-Python] How to wait for a transport to write some data before loosing the connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24151">[ date ]</a>
              <a href="thread.html#24151">[ thread ]</a>
              <a href="subject.html#24151">[ subject ]</a>
              <a href="author.html#24151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I wrote a server using a protocol that inherit from 'basic.LineReceiver'.

In some circonstances I need  to reject the data send by the client and to
close the connection. Here is how I do that:

class MyProtocol(basic.LineReceiver):

    ........

    def error(self, error_msg):
        self.transport.write(error_msg)
        self.transport.loseConnection()


Sometimes it works: the client gets notify of the error and the connection
is closed properly.
And some other times, the client does not received the error notification
and the server closes the connection, which causes the client (wich is not
written using twisted, but with the socket module from the standard lib) to
crash with 'socket.error: (10054, 'Connection reset by peer')'.

As I red somewhere in the docs or in the mailing list, self.transort.write
does can return before it really writes the data.

So how could I do, without using blocking code, to wait
until self.transort.write effectively writes the data to avoid closing the
connection with unwritten data ?

Thanks you.

Emmanuel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20110628/ccabaa73/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20110628/ccabaa73/attachment.htm</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024157.html">[Twisted-Python] jQuery.Deferred - why did they have to go and change the interface?
</A></li>
	<LI>Next message: <A HREF="024153.html">[Twisted-Python] How to wait for a transport to write some data before loosing the connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24151">[ date ]</a>
              <a href="thread.html#24151">[ thread ]</a>
              <a href="subject.html#24151">[ subject ]</a>
              <a href="author.html#24151">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
