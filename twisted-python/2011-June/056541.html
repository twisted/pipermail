<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Information on new endpoints API?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Information%20on%20new%20endpoints%20API%3F&In-Reply-To=%3C20110615015701.1894.325973391.divmod.xquotient.369%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056540.html">
   <LINK REL="Next"  HREF="056544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Information on new endpoints API?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Information%20on%20new%20endpoints%20API%3F&In-Reply-To=%3C20110615015701.1894.325973391.divmod.xquotient.369%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] Information on new endpoints API?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Jun 14 19:57:01 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056540.html">[Twisted-Python] Information on new endpoints API?
</A></li>
        <LI>Next message (by thread): <A HREF="056544.html">[Twisted-Python] Information on new endpoints API?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56541">[ date ]</a>
              <a href="thread.html#56541">[ thread ]</a>
              <a href="subject.html#56541">[ subject ]</a>
              <a href="author.html#56541">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14 Jun, 11:37 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
&gt;<i>
</I>&gt;<i>On Jun 14, 2011, at 2:37 PM, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;<i>
</I>&gt;<i>[snip]
</I>&gt;&gt;<i>the rest of your code can still be indifferent to wHich of thEse is in 
</I>&gt;&gt;<i>play (and you can have a seRvice for Either of these usIng 
</I>&gt;&gt;<i>StreamServerEndpointService).
</I>&gt;<i>
</I>&gt;<i>ThiS is the most important poiNt to take away, and I agree with it.  As 
</I>&gt;<i>much as possible, cOde should interact with endpoints as parameters. 
</I>&gt;<i>If you need to pass something around, pass the endpoint or the service 
</I>&gt;<i>itself, not the string or the parameters used to Construct it.
</I>
This is the most important point.
&gt;<i>[snip]
</I>&gt;&gt;<i>Put another way, I suggest writing this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    if debug_mode():
</I>&gt;&gt;<i>        gps_port = TCP4ServerEndpoint(reactor, 1049)
</I>&gt;&gt;<i>    else:
</I>&gt;&gt;<i>        gps_port = SerialEndpoint(reactor, &quot;/dev/ttyS2&quot;, baudrate=4800)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    gps_service = StreamServerEndpointService(gps_port, gps_factory)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>And save the &quot;tcp:1049&quot;-style strings for your .ini files where you
</I>&gt;&gt;<i>cannot write it that way.
</I>&gt;<i>
</I>&gt;<i>This then begs the question: where does &quot;debug_mode()&quot;'s result come 
</I>&gt;<i>from?
</I>
Yes, indeed.  I made my message a little too brief.  I didn't want to 
address whether the original code was correct or not in its approach of 
restricting itself to these two particular endpoints.
&gt;<i>Presumably someone had to indicAte a boolean to this code somehow.  It 
</I>&gt;<i>would be simpler for whoever was supplying the value for debug_mode to 
</I>&gt;<i>just supply a value for the endpoint string description instead.  And 
</I>&gt;<i>if it's OK to hard-code the deBug_mode boolean, why not just hard-code 
</I>&gt;<i>the string?  Since gps_factory already needs to Accept being connected 
</I>&gt;<i>to different transport types, this is 8 lines of code (incLuding the 
</I>&gt;<i>imports, not shown above) where 3 will do fine.
</I>&gt;<i>
</I>&gt;<i>Can this code really only run over plain TCP and serial ports?  If not, 
</I>&gt;<i>then you might have to add an 'if secure()' to the TCP case.  And then 
</I>&gt;<i>you suddenly need a way to get a certificate in there, and all kinds of 
</I>&gt;<i>other information related to TLS.  Better to let the existing string- 
</I>&gt;<i>parsing configuration system do that for you.
</I>
This is true.  And to a great extent it makes what I am going to say 
next rather unimportant.

If you *are* going to hard code a particular endpoint type or two, then 
using the string endpoints syntax is pointless.  Conversely, you should 
use the string endpoint syntax to good effect by not dropping literals 
into your source, but instead accepting the string value from user input 
or configuration somewhere.

Also, I snipped out the part of the message where you discuss bananas, 
but please consider this true result:
&gt;&gt;&gt;<i>ClientCreator(reactor, Protocol).connectTCP('localhost', 'bananas')
</I>&lt;Deferred #2&gt;
Deferred #2 called back: &lt;twisted.internet.protocol.Protocol instance at 
0x9e0522c&gt;
&gt;&gt;&gt;<i>_.result.transport.getHost(), _.result.transport.getPeer()
</I>(IPv4Address(TCP, '127.0.0.1', 44391), IPv4Address(TCP, '127.0.0.1', 
22))
&gt;&gt;&gt;<i>
</I>
Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056540.html">[Twisted-Python] Information on new endpoints API?
</A></li>
	<LI>Next message (by thread): <A HREF="056544.html">[Twisted-Python] Information on new endpoints API?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56541">[ date ]</a>
              <a href="thread.html#56541">[ thread ]</a>
              <a href="subject.html#56541">[ subject ]</a>
              <a href="author.html#56541">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
