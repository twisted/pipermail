<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A new &amp; improved IResource
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20new%20%26%20improved%20IResource&In-Reply-To=%3C7BC9278F-3783-4F11-9650-CA7166FB880B%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056531.html">
   <LINK REL="Next"  HREF="056536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A new &amp; improved IResource</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20new%20%26%20improved%20IResource&In-Reply-To=%3C7BC9278F-3783-4F11-9650-CA7166FB880B%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] A new &amp; improved IResource">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Jun 14 10:58:56 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056531.html">[Twisted-Python] A new &amp; improved IResource
</A></li>
        <LI>Next message (by thread): <A HREF="056536.html">[Twisted-Python] A new &amp; improved IResource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56535">[ date ]</a>
              <a href="thread.html#56535">[ thread ]</a>
              <a href="subject.html#56535">[ subject ]</a>
              <a href="author.html#56535">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jun 13, 2011, at 6:30 PM, Laurens Van Houtven wrote:

&gt;<i> On Mon, Jun 13, 2011 at 3:38 PM, &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> Another thing we want is something closer to locateChild as Nevow and
</I>&gt;<i> web2 had.  The key feature is being able to consume multiple path
</I>&gt;<i> segments (or none at all) at a time if desired.
</I>&gt;<i> 
</I>&gt;<i> Jean-Paul
</I>&gt;<i> 
</I>&gt;<i> I added it to the ticket.
</I>&gt;<i> 
</I>&gt;<i> Someone on IRC mentioned that locateChild isn't exactly perfect either -- how does it differ from the idealized API? 
</I>&gt;<i> 
</I>&gt;<i> For the people who hadn't seen locateChild before (much like myself) -- the main difference is that instead of just taking the *next* segment, it takes all of the remaining ones, and instead of returning a single child, it returns a child and the remaining segments. A possible problem with this is that people might get the impression they should mess with the segments... Comments welcome.
</I>
Yeah, messing with segments is an issue.  There's a thing that some Nevow applications would do which, while I'm not entirely sure it was a terrible idea, definitely exposed a weakness in this model.  We called it an &quot;internal redirect&quot;.  The basic idea is that your resource gets called with &quot;request, [a, b, c]&quot; and you return &quot;resource, [d, e, f]&quot;.  The problem with allowing this is that it decouples the resource from any sane way to identify its URL based on the request.  It's handy to have something like the 'prepath' attribute to assist in generating absolute URIs that can be passed to external systems, but you can't make that consistent in the face of code that arbitrarily manipulates the segments list.

Also, you can internally redirect this way based on path-based dispatch but you can't redirect based on hostname or other features of the request without mutating it.  So it seemed like a lopsided half-feature.

One off-the-cuff idea to address this would be to have a 'path' object with an API of its own; something like this:

def locateDescendant(self, request, path):
    year, month, day = path.consume(3)
    rsrc = self.resourceFromDate(year, month, day)
    return rsrc

.consume(integer) is something of a strawman here; you'd probably need a way to say stuff like &quot;consume all of the path segments&quot; or &quot;consume everything up to a segment with the value 'x'&quot;, so that we didn't lose the (legitimate) flexibility of having a list.  We could of course just pass in a mutable list and not return it, but that provides a little more flexibility than I'd like, because it would allow you to do all the same stuff as returning your own arbitrary sequence.

Really this 'path' is actually cursor over the URI inside the request.  It would be nice if the state associated with traversal were encapsulated entirely in that object, so that the request itself didn't get mutated as it traveled down the path.

&gt;<i> I'm also not sure if it should be allowed to return an IResource (and basically use the IResource getChild behavior whenever you see an IResource...) or if it should only return the new things.
</I>
One return-type signature is a good idea.  Convenience APIs are better.  That said, if we do go with 2-tuple as the return type, good error reporting is crucial; it's very easy to accidentally return a resource.

&gt;<i> Perhaps there could be an adapter: if entity.locateChild([a, b, c]) returns a (resource, [b, c]), the resource is adapted to IEntity (working title for I2NewResource2), and the adapter's .locateChild([b, c]) call gets translated into self.wrappedResource.getChild(b).getChild(c), or something.
</I>
That seems sensible.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20110614/56689e74/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056531.html">[Twisted-Python] A new &amp; improved IResource
</A></li>
	<LI>Next message (by thread): <A HREF="056536.html">[Twisted-Python] A new &amp; improved IResource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56535">[ date ]</a>
              <a href="thread.html#56535">[ thread ]</a>
              <a href="subject.html#56535">[ subject ]</a>
              <a href="author.html#56535">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
