<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Question about &quot;starving&quot; the reactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20about%20%22starving%22%20the%20reactor&In-Reply-To=80B89FFF-293D-426D-AF57-CBB07A689A44%40orestis.gr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024112.html">
   <LINK REL="Next"  HREF="024114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Question about &quot;starving&quot; the reactor</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20about%20%22starving%22%20the%20reactor&In-Reply-To=80B89FFF-293D-426D-AF57-CBB07A689A44%40orestis.gr"
       TITLE="[Twisted-Python] Question about &quot;starving&quot; the reactor">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Mon Jun 20 06:10:34 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024112.html">[Twisted-Python] Question about &quot;starving&quot; the reactor
</A></li>
        <LI>Next message: <A HREF="024114.html">[Twisted-Python] Question about &quot;starving&quot; the reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24113">[ date ]</a>
              <a href="thread.html#24113">[ thread ]</a>
              <a href="subject.html#24113">[ subject ]</a>
              <a href="author.html#24113">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/20/2011 10:04 AM, Orestis Markou wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I have a question about the &quot;best practices&quot; on making callbacks and
</I>&gt;<i> making sure you don't hog the reactor.
</I>&gt;<i>
</I>&gt;<i> So you pass a deferred to a client, who attaches a chain of callbacks
</I>
Who is &quot;you&quot; and who is &quot;client&quot;?

&gt;<i> that might probably do some CPU intensive stuff. How should one guard
</I>&gt;<i> for that? The obvious solution to me for the server part would be to
</I>&gt;<i> do
</I>
AIUI, callback/errback (or indeed any Twisted function) should not 
block, which means if they're doing any significant quantity of work 
they should deferToThread or use a task.cooperator to break it into chunks.

You can return a deferred from a callback to pause processing, so this 
is very easy to implement:

def my_callback(data):
   d = deferToThread(factor_some_prime, data['number'])
   d.addCallback(lambda x: 'prime factors are '+repr(x))
   return d

&gt;<i>
</I>&gt;<i> reactor.callLater(0, d.callback, arg)
</I>
That can help in some cases. Specifically if you're receiving datagrams, 
you might want to service the read() loop as much as possible before 
packets start to get dropped. But if d.callback is going to do a lot of 
work, it doesn't solve the problem - just delays it.

callbacks/errbacks should not do a lot of work.

&gt;<i>
</I>&gt;<i> insted of
</I>&gt;<i>
</I>&gt;<i> d.callback(arg)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What about the client part? What would be the best way to have a
</I>
I don't really understand what you mean by client and server part. A 
deferred is just a deferred. They don't even have to be used in a 
network context.

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024112.html">[Twisted-Python] Question about &quot;starving&quot; the reactor
</A></li>
	<LI>Next message: <A HREF="024114.html">[Twisted-Python] Question about &quot;starving&quot; the reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24113">[ date ]</a>
              <a href="thread.html#24113">[ thread ]</a>
              <a href="subject.html#24113">[ subject ]</a>
              <a href="author.html#24113">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
