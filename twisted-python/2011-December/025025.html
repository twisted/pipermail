<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20Solve%20a%20Problem%20Like%20Santa%20with%0A%09Stackless%20and%20Twisted&In-Reply-To=mailman.8295.1323876685.5291.twisted-python%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025022.html">
   <LINK REL="Next"  HREF="025031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted</H1>
    <B>Andrew Francis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20Solve%20a%20Problem%20Like%20Santa%20with%0A%09Stackless%20and%20Twisted&In-Reply-To=mailman.8295.1323876685.5291.twisted-python%40twistedmatrix.com"
       TITLE="[Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted">andrewfr_ice at yahoo.com
       </A><BR>
    <I>Wed Dec 14 14:24:21 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="025022.html">[Twisted-Python] Autobahn WebSockets 0.4.10
</A></li>
        <LI>Next message: <A HREF="025031.html">[Twisted-Python] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25025">[ date ]</a>
              <a href="thread.html#25025">[ thread ]</a>
              <a href="subject.html#25025">[ subject ]</a>
              <a href="author.html#25025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Glyph:

Message: 3
Date: Tue, 13 Dec 2011 23:45:54 -0500
From: Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;
Subject: Re: [Twisted-Python] How to Solve a Problem Like Santa with
&#160;&#160;&#160; Stackless and Twisted
To: Twisted general discussion &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Message-ID: &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">F1901420-DAD9-4879-8E65-CAFC123BACA4 at twistedmatrix.com</A>&gt;
Content-Type: text/plain; charset=&quot;iso-8859-1&quot;

On Dec 13, 2011, at 2:04 PM, Andrew Francis wrote:

Hi Glyph:

G&gt;The only reason that the 
Santa problem, expressed as a thread-synchronization problem, has to 
deal with G&gt;&quot;simultaneous&quot; arrival of 9 reindeer and 3 elves is a quirk of
 thread scheduling: the Santa thread can be ready to run G&gt;but not 
running.&#160; When the final reindeer arrives, a final elf may arrive before
 the scheduler decides it's time to give G&gt;Santa a chance to run, and then
 Santa has the opportunity to make the choice between the two. 

I agree: it is the scheduler that introduces quirks. Not that it matters but the important edge case is when three elves have arrived. Santa is awoken and placed on the queue. However additional reindeer have arrived bringing the count to nine. So when Santa runs, both the group of nine reindeer and group of three elves are ready. Hence the need for Santa to check when he is awake. In reality, I have to leave the programme running for a&#160; long time to see this happen.

G&gt;In an 
event-driven system, this state doesn't naturally exist: when you call 
Deferred.callback(), the callback runs the G&gt;relevant application code 
immediately.

In regards to Stackless, if I wanted to greatly simplify the problem, I would immediately schedule Santa once reindeer or a group of elves were ready. This is what Twisted is doing. Perhaps in a real-life case, this would be the correct action since it is obvious that Santa is a high priority task. However I am trying to be true to the original problem. Also a good solution should not depend on scheduling tricks.

Otherwise Twisted with deferred lists would otherwise be pretty effective. Again the secret sauce is that deferred lists are a join pattern of sorts. The component is that Twisted is essentially a non-preemptive first come first served scheduler. This behaviour also simplifies the problem.

G&gt;Despite
 the fundamentally sequential nature of reality, 

Maybe this is the reality of computers based on von Neuman architecture. However reality is fundamentally concurrent.

G&gt;Twisted reactor's 
scheduling mechanism does leave somethings to be desired; the quantum 
time-slice of Twisted is G&gt;effectively one reactor iteration, and there 
aren't really any tools for working with those.&#160; There's some latency 
G&gt;between becoming aware of some work that needs to be done (select(), or 
your chosen multiplexor, returning) and G&gt;actually doing the work (calling
 doRead, doWrite, or your timed event), but you don't get to decide on 
priorities once G&gt;Twisted's aware of the work; they're executed in a 
quasi-arbitrary order.

I feel a Twisted callback and a Stackless tasklet in non-preemptive mode suffer from a bigger problem: one does not know how long the code fragment will execute. The programmer is betting that the CPU slice will be relatively short. An additional assumption is that all tasklets/callbacks are created equally (actually in Stackless, one can use preferences to give some tasklets a limited priority). I feel the reason we have sophisticated schedulers is when throughput and fairness are a big deal. 

G&gt;Ultimately however, the order of the work 
will be arbitrary; if it's not influenced by the vagaries of Twisted's 
scheduler, G&gt;it will be influenced by something in the kernel scheduler 
that you don't understand or can't control, or in the IP stack, G&gt;or in a 
switch on your network, or in your hosting provider's firewall 
configuration, or something on a client machine G&gt;that you truly have no 
influence over at all.&#160; Having something give priority to an event that 
occurs at &quot;the same&quot; G&gt;time given all of these potential sources of 
interference is basically pointless.

I am not an expect in real-time systems. However I would argue that at a pragmatic level,&#160; timestamps have to be of a resolution that allows the application to make reasonable decisions. So if the application is measuring time in seconds to say two decimal places, as far as the application is concerned, it can have a reindeer and elf arriving at the same time if they have the same timestamps.&#160; 

Perhaps my original example leaves something to be desired. However my point still remains. If we constructed a schedule so that the ninth reindeer always arrived at T+11 seconds and three elves always arrived at T+9, T+10, and T+11 seconds, it would be a coin toss in Twisted as to whether reindeer or elves were serviced. Rather than a reindeer being in a queue, in Twisted, its file descriptor would be in a reader set. All I can say is that a Twisted solution would be unbiased (or biased towards elves if there we are playing with 10 of them). When the problem requires it is biased towards reindeer. If one had a burning desire, we could construct cases to measure if there was a bias.

Cheers,
Andrew


</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025022.html">[Twisted-Python] Autobahn WebSockets 0.4.10
</A></li>
	<LI>Next message: <A HREF="025031.html">[Twisted-Python] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25025">[ date ]</a>
              <a href="thread.html#25025">[ thread ]</a>
              <a href="subject.html#25025">[ subject ]</a>
              <a href="author.html#25025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
