<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Log output formatting (was Re: logging	question)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Log%20output%20formatting%20%28was%20Re%3A%20logging%0A%09question%29&In-Reply-To=20111201025752.GB3713%40boombah.thristian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="024977.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Log output formatting (was Re: logging	question)</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Log%20output%20formatting%20%28was%20Re%3A%20logging%0A%09question%29&In-Reply-To=20111201025752.GB3713%40boombah.thristian.org"
       TITLE="[Twisted-Python] Log output formatting (was Re: logging	question)">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Dec  1 02:22:47 EST 2011</I>
    <P><UL>
        
        <LI>Next message: <A HREF="024977.html">[Twisted-Python] Using decorator syntax in Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24976">[ date ]</a>
              <a href="thread.html#24976">[ thread ]</a>
              <a href="subject.html#24976">[ subject ]</a>
              <a href="author.html#24976">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Nov 30, 2011, at 9:57 PM, Tim Allen wrote:

&gt;<i> On Wed, Nov 30, 2011 at 01:04:27PM -0000, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i> On 04:07 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">screwtape at froup.com</A> wrote:
</I>&gt;&gt;&gt;<i> If the standard Twisted logging functions automatically constructed
</I>&gt;&gt;&gt;<i> LogMessage instances from dict instances, it should be easy enough for
</I>&gt;&gt;&gt;<i> future ILogObserver implementations to do the right thing (by just
</I>&gt;&gt;&gt;<i> calling str(msg)). Of course, they could also do more sophisticated
</I>&gt;&gt;&gt;<i> things like pulling particular keys out of the message to set
</I>&gt;&gt;&gt;<i> observer-specific message properties (like syslog channel and severity,
</I>&gt;&gt;&gt;<i> etc.)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Oooorrrr there could be a function that takes a dict intended to 
</I>&gt;&gt;<i> represent a text message and returns that message as a string.
</I>&gt;<i> 
</I>&gt;<i> As mentioned, we already have one of those in the form of
</I>&gt;<i> textFromEventDict().
</I>
Right, I think that's the tone all those extra letters are meant to suggest :).

&gt;<i> The trouble is that everybody who writes
</I>&gt;<i> a LogObserver needs to know that it exists, and remember to call it. If
</I>&gt;<i> it were the __str__() method of a LogMessage object, they'd have to go
</I>&gt;<i> out of their way to *not* do the right thing.
</I>
I really don't like using __str__ for structured conversions.  For example, textFromEventDict has very strict error-handling behavior: it will try as hard as it can to give you something so that you don't need to do extra error handling in your log observer.  But if you can get instances of LogMessage or some derived message type or possibly application-derived message types, the behavior might change and the error-handling would be less strict and now the default log observers need to be double-careful; once in LogMessage.__str__, once in the thing that calls it because you can never really know what str(x) is going to do.

For another there's a whole nasty battery of unicode-or-bytes issues that crop up when you start using __str__.

Finally, and I'm leaving it for last because this concern is rather silly, right now log events are constructed and propagated with extremely little copying, and the copying that does happen (ahem, log contexts) needs to be reduced.  Adding a LogMessage object into the mix, even if it is a subclass of dict, means we have to, at the very least, copy all the values from msg()'s keyword arguments into a new object, rather than just propagating them to log observers.

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20111201/151c52c3/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20111201/151c52c3/attachment-0001.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="024977.html">[Twisted-Python] Using decorator syntax in Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24976">[ date ]</a>
              <a href="thread.html#24976">[ thread ]</a>
              <a href="subject.html#24976">[ subject ]</a>
              <a href="author.html#24976">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
