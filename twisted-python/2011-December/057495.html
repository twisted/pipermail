<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to Solve a Problem Like Santa with Stackless	and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20Solve%20a%20Problem%20Like%20Santa%20with%20Stackless%0A%09and%20Twisted&In-Reply-To=%3C1323659154.8831.YahooMailNeo%40web120704.mail.ne1.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057494.html">
   <LINK REL="Next"  HREF="057496.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to Solve a Problem Like Santa with Stackless	and Twisted</H1>
    <B>Andrew Francis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20Solve%20a%20Problem%20Like%20Santa%20with%20Stackless%0A%09and%20Twisted&In-Reply-To=%3C1323659154.8831.YahooMailNeo%40web120704.mail.ne1.yahoo.com%3E"
       TITLE="[Twisted-Python] How to Solve a Problem Like Santa with Stackless	and Twisted">andrewfr_ice at yahoo.com
       </A><BR>
    <I>Sun Dec 11 20:05:54 MST 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057494.html">[Twisted-Python] Twisted-Python Digest, Vol 93, Issue 12
</A></li>
        <LI>Next message (by thread): <A HREF="057496.html">[Twisted-Python] How to Solve a Problem Like Santa with Stackless and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57495">[ date ]</a>
              <a href="thread.html#57495">[ thread ]</a>
              <a href="subject.html#57495">[ subject ]</a>
              <a href="author.html#57495">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Folks:

I don't know what to file this under but here goes:

Santa repeatedly sleeps until wakened by either all of his nine 
reindeer, back from their holidays, or by a group of three of his ten 
elves. If awakened by the reindeer, he harnesses each of them to his 
sleigh, delivers toys with them and finally unharnesses them (allowing 
them to go off on holiday). If awakened by a group of elves, he shows 
each of the group into his study, consults with them on toy R&amp;D and 
finally shows them each out (allowing them to go back to work). Santa 
should give priority to the reindeer in the case that there is both a 
group of elves and a group of reindeer waiting 

I recently modified the stackless.py library to support yet another new concurrency feature: join patterns. Well I think of my version as a sawed-off version of join patterns. Join patterns are a synchronization and message passing construct. The closest thing to a join pattern in Twisted is a deferred list. Stackless has nothing of the sort.


The Santa Claus Problem is a notorious problem in concurrency (<A HREF="http://www.youtube.com/watch?v=pqO6tKN2lc4">http://www.youtube.com/watch?v=pqO6tKN2lc4</A>). I have come up with a relatively short solution.  I think one would be hard pressed to come up with a shorter solution in Python. My desire was to compete with Simon Peyton Jones Haskell version in &quot;Beautiful Code.&quot; The full solution is here: <A HREF="http://andrewfr.wordpress.com/2011/11/30/the-santa-claus-problem-with-join-patterns.">http://andrewfr.wordpress.com/2011/11/30/the-santa-claus-problem-with-join-patterns.</A> The nucleus is: 
def santa(reindeer, elves):
    joinObject = stackless.join().addPattern([ch for _, ch, _ in reindeer]).\
                                  addPattern([ch for _, ch, _ in elves],3)

    reindeerPattern, elfPattern = joinObject.patterns

    while True:
        pattern = joinObject.join()
        if reindeerPattern.ready():
            print &quot;*** REINDEER GET PRIORITY ***&quot;
            reindeerPattern.join()
            pattern = reindeerPattern
        if pattern is reindeerPattern:
            harness(reindeerPattern)
            deliveryToys(reindeerPattern)
            unharness(reindeerPattern)
        elif pattern is elfPattern:
            consultWithSanta(elfPattern)

    stopTwisted()

In this solution I use Twisted to control the timer (I use the blockOn technique that Christopher Armstrong first used). 

def tick(seconds):
    tickCh = stackless.channel()
    reactor.callLater(seconds, tickCh.send, None)
    tickCh.receive()

However I could just as easily make reindeer and elves web services or RestFull interfaces. I am still working on the  Join Pattern API. Also it has also been a goal of mine to write a stacklessreactor to better integrate Stackless with the Twisted Reactor.

Cheers,
Andrew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20111211/5c526a94/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057494.html">[Twisted-Python] Twisted-Python Digest, Vol 93, Issue 12
</A></li>
	<LI>Next message (by thread): <A HREF="057496.html">[Twisted-Python] How to Solve a Problem Like Santa with Stackless and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57495">[ date ]</a>
              <a href="thread.html#57495">[ thread ]</a>
              <a href="subject.html#57495">[ subject ]</a>
              <a href="author.html#57495">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
