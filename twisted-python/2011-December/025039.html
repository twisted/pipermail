<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Question : Combining wokel XMPP and	twisted.internet.serial
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20%3A%20Combining%20wokel%20XMPP%20and%0A%09twisted.internet.serial&In-Reply-To=4EF2B790.1060706%40indoakses-online.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025038.html">
   <LINK REL="Next"  HREF="025040.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Question : Combining wokel XMPP and	twisted.internet.serial</H1>
    <B>Lucas Taylor</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20%3A%20Combining%20wokel%20XMPP%20and%0A%09twisted.internet.serial&In-Reply-To=4EF2B790.1060706%40indoakses-online.com"
       TITLE="[Twisted-Python] Question : Combining wokel XMPP and	twisted.internet.serial">ltaylor.volks at gmail.com
       </A><BR>
    <I>Thu Dec 22 01:12:58 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="025038.html">[Twisted-Python] Question : Combining wokel XMPP and	twisted.internet.serial
</A></li>
        <LI>Next message: <A HREF="025040.html">[Twisted-Python] Question : Combining wokel XMPP and	twisted.internet.serial
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25039">[ date ]</a>
              <a href="thread.html#25039">[ thread ]</a>
              <a href="subject.html#25039">[ subject ]</a>
              <a href="author.html#25039">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Dec 21, 2011, at 9:52 PM, bino oetomo wrote:

&gt;<i> Dear All ..
</I>&gt;<i>
</I>&gt;<i> A year ago, I need send some defined message to a jabber conference.
</I>&gt;<i> The message content will depend on a &quot;button-press&quot;.
</I>&gt;<i> My trick is to use ttyctrl (<A HREF="http://ttyctrl.sourceforge.net/">http://ttyctrl.sourceforge.net/</A>).
</I>&gt;<i>
</I>&gt;<i> So basicaly my &quot;system&quot; is builded from several parts:
</I>&gt;<i> 1. TTYCTRL : I made some small python XMLRPC client script, that will
</I>&gt;<i> send a msg to my local twisted server
</I>&gt;<i> 2. Twisted server, contain :
</I>&gt;<i> a. an XMLRPC server
</I>&gt;<i> b. XMPP Client ... use to send msg to remote jabber conference room
</I>&gt;<i>
</I>&gt;<i> I made a pastebin of that twisted script at : <A HREF="http://pastebin.com/iSRVZNwS">http://pastebin.com/iSRVZNwS</A>
</I>&gt;<i>
</I>&gt;<i> With that script the flow alway one-way only :
</I>&gt;<i> serial====&gt;Twisted_XMLRPC---&gt;Twisted_XMPP=====&gt;Jaber
</I>&gt;<i>
</I>&gt;<i> Now I need to do something different, since it's hard to find a Board
</I>&gt;<i> with RS232 onboard.
</I>&gt;<i> I Need to replace TTYCTRL with Arduino MCU.
</I>&gt;<i> Arduino will Send serial data to my PC.
</I>&gt;<i> So I'll need my twisted to able to receive data via serial
</I>&gt;<i> There will also incoming XMPP msg from Jabber that will need to be  
</I>&gt;<i> send
</I>&gt;<i> to arduino via Serial port.
</I>&gt;<i>
</I>&gt;<i> so the flow will be like :
</I>&gt;<i> serial&lt;====&gt;Twisted_Serial&lt;---&gt;Twisted_XMPP&lt;=====&gt;Jaber
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My question is, How to make :
</I>&gt;<i> 1. twisted.internet.serial to send data via an instance of XMPP  
</I>&gt;<i> client ? and
</I>&gt;<i> 2. my EchobotProtocol.onMessage (see pastebin), to write data to the
</I>&gt;<i> same serial port used by Point#1 above.
</I>&gt;<i>
</I>

This is a relevant FAQ for this situation:
<A HREF="http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother">http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother</A>

More specifically:
1. Create a Protocol class for your SerialPort that will communicate  
with the Arduino. Instances of this class will have access to the  
serial transport and can write out to the serial port. Incoming  
messages from the Arduino will be handled by the dataReceived method  
of the protocol.

2. Give your EchoBotProtocol a reference to the SerialPort somehow  
(e.g. via init), and set a reference to the EchoBotProtocol on the  
SerialPort.

Here's a quick sketch:

# Basic line receiver protocol
class ArduinoReceiver(LineReceiver):
	def lineReceived(self, line):
		print &quot;Line Received from Arduino&quot;
		self.echobot.send('some xmpp message for which I do not know the  
format')

# Wire up the serial port and protocol...note there are more  
parameters to create the SerialPort (baudrate, etc.)
serial = SerialPort(ArduinoReceiver, '/dev/tty.usbserial', reactor)

# EchoBot gets a reference to the serialport
class EchoBotProtocol(MessageProtocol):
   	def __init__(self, serial, *args, **kwargs):
		self.serial = serial
		# Set a reference to self on the serial protocol
		self.serial.protocol.echobot = self
		MessageProtocol.__init__(self, *args, **kwargs)

	def onMessage(self, msg):
		self.serial.transport.write('some message\n')

echobot = EchoBotProtocol(serial)

...and an update to your pastebin that may be helpful for context: <A HREF="http://pastebin.com/2EJ22wXa">http://pastebin.com/2EJ22wXa</A>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20111221/a9fdf72a/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20111221/a9fdf72a/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025038.html">[Twisted-Python] Question : Combining wokel XMPP and	twisted.internet.serial
</A></li>
	<LI>Next message: <A HREF="025040.html">[Twisted-Python] Question : Combining wokel XMPP and	twisted.internet.serial
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25039">[ date ]</a>
              <a href="thread.html#25039">[ thread ]</a>
              <a href="subject.html#25039">[ subject ]</a>
              <a href="author.html#25039">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
