<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20Solve%20a%20Problem%20Like%20Santa%20with%0A%09Stackless%20and%20Twisted&In-Reply-To=%3CF1901420-DAD9-4879-8E65-CAFC123BACA4%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057498.html">
   <LINK REL="Next"  HREF="057501.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20Solve%20a%20Problem%20Like%20Santa%20with%0A%09Stackless%20and%20Twisted&In-Reply-To=%3CF1901420-DAD9-4879-8E65-CAFC123BACA4%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Dec 13 21:45:54 MST 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057498.html">[Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted
</A></li>
        <LI>Next message (by thread): <A HREF="057501.html">[Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57500">[ date ]</a>
              <a href="thread.html#57500">[ thread ]</a>
              <a href="subject.html#57500">[ subject ]</a>
              <a href="author.html#57500">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Dec 13, 2011, at 2:04 PM, Andrew Francis wrote:

&gt;<i> Now at time T, there are eight reindeer and two elves ready. At T+1, an additional  reindeer and elf are ready (their timestamps are the same, timer resolution notwithstanding). However the Twisted reactor will serialise the events and trigger the callback. For argument, let us pretend the elvesArrive callback is activated and that wakes Santa. Santa consults with the elves. The problem is that all nine reindeer were ready and the priority rule is broken. I am not sure, from inside the callback, one could check to see if nine reindeer were indeed ready.
</I>
This strikes me as a problem with the way that quantum physics works more than the way that Twisted's reactor works :).  Broadly speaking, no two events can happen at the exact same time; even if they did, relativity says you wouldn't be able to tell if they happened at the exact same time unless they also happened to be exactly the same distance away from you.  (But then &quot;you&quot; would have to be exactly one atom big, which is a pretty demanding size to build a sensor.)

Even if it were possible in reality, once a network gets involved, you have a bunch of additional bits of technology serializing everything.  If your computer has one ethernet card, the reindeer and the elves have to report their readiness either in separate ethernet frames in one order or the other, or in one order or another within the same ethernet frame.  (If it has two ethernet cards, you still only have one PCI bus, et cetera.)

Despite the fundamentally sequential nature of reality, Twisted reactor's scheduling mechanism does leave some things to be desired; the quantum time-slice of Twisted is effectively one reactor iteration, and there aren't really any tools for working with those.  There's some latency between becoming aware of some work that needs to be done (select(), or your chosen multiplexor, returning) and actually doing the work (calling doRead, doWrite, or your timed event), but you don't get to decide on priorities once Twisted's aware of the work; they're executed in a quasi-arbitrary order.

Ultimately however, the order of the work will be arbitrary; if it's not influenced by the vagaries of Twisted's scheduler, it will be influenced by something in the kernel scheduler that you don't understand or can't control, or in the IP stack, or in a switch on your network, or in your hosting provider's firewall configuration, or something on a client machine that you truly have no influence over at all.  Having something give priority to an event that occurs at &quot;the same&quot; time given all of these potential sources of interference is basically pointless.

The only reason that the Santa problem, expressed as a thread-synchronization problem, has to deal with &quot;simultaneous&quot; arrival of 9 reindeer and 3 elves is a quirk of thread scheduling: the Santa thread can be ready to run but not running.  When the final reindeer arrives, a final elf may arrive before the scheduler decides it's time to give Santa a chance to run, and then Santa has the opportunity to make the choice between the two.  In an event-driven system, this state doesn't naturally exist: when you call Deferred.callback(), the callback runs the relevant application code immediately.

Even in a preemptively threaded system though, the notion of simultaneity is pretty arbitrary; you don't get much control over how long Santa will be left in the ready-to-run-but-not-running state.  If you really care about Santa giving priority to the reindeer, then the system requires another input: how long should Santa sleep after the elves become ready, before deciding to go with the elves rather than the reindeer?  Effectively in a threaded system Santa is sleeping, just for a very small and not configurable amount of time.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20111213/ef77e3c1/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057498.html">[Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted
</A></li>
	<LI>Next message (by thread): <A HREF="057501.html">[Twisted-Python] How to Solve a Problem Like Santa with	Stackless and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57500">[ date ]</a>
              <a href="thread.html#57500">[ thread ]</a>
              <a href="subject.html#57500">[ subject ]</a>
              <a href="author.html#57500">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
