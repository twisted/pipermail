<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] pending fixes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20pending%20fixes&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010018.html">
   <LINK REL="Next"  HREF="010020.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] pending fixes</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20pending%20fixes&In-Reply-To="
       TITLE="[Twisted-Python] pending fixes">andrea at cpushare.com
       </A><BR>
    <I>Sun Apr  3 09:38:54 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010018.html">[Twisted-Python] How can I call internet.MulticastServer() to	enable listenMultiple?
</A></li>
        <LI>Next message: <A HREF="010020.html">[Twisted-Python] pending fixes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10019">[ date ]</a>
              <a href="thread.html#10019">[ thread ]</a>
              <a href="subject.html#10019">[ subject ]</a>
              <a href="author.html#10019">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just as reminder, this is my pending patch against SVN. .disconnecting
can be added to all protocols or it can be renamed... (or we could use
hasattr in the meantime)

Index: Twisted/twisted/protocols/basic.py
===================================================================
--- Twisted/twisted/protocols/basic.py	(revision 13459)
+++ Twisted/twisted/protocols/basic.py	(working copy)
@@ -166,9 +166,23 @@
         &quot;&quot;&quot;
         return error.ConnectionLost('Line length exceeded')
     
+class PauseProducer(object):
+    paused = False
 
+    def pauseProducing(self):
+        self.paused = True
+        self.transport.pauseProducing()
 
-class LineReceiver(protocol.Protocol):
+    def resumeProducing(self):
+        self.paused = False
+        self.transport.resumeProducing()
+        self.dataReceived('')
+
+    def stopProducing(self):
+        self.paused = True
+        self.transport.stopProducing()
+
+class LineReceiver(protocol.Protocol, PauseProducer):
     &quot;&quot;&quot;A protocol that receives lines and/or raw data, depending on mode.
     
     In line mode, each line that's received becomes a callback to
@@ -188,7 +202,6 @@
     __buffer = ''
     delimiter = '\r\n'
     MAX_LENGTH = 16384
-    paused = False
     
     def clearLineBuffer(self):
         &quot;&quot;&quot;Clear buffered data.&quot;&quot;&quot;
@@ -279,21 +292,8 @@
         &quot;&quot;&quot;
         return self.transport.loseConnection()
 
-    def pauseProducing(self):
-        self.paused = True
-        self.transport.pauseProducing()
 
-    def resumeProducing(self):
-        self.paused = False
-        self.dataReceived('')
-        self.transport.resumeProducing()
-
-    def stopProducing(self):
-        self.paused = True
-        self.transport.stopProducing()
-
-
-class Int32StringReceiver(protocol.Protocol):
+class Int32StringReceiver(protocol.Protocol, PauseProducer):
     &quot;&quot;&quot;A receiver for int32-prefixed strings.
 
     An int32 string is a string prefixed by 4 bytes, the 32-bit length of
@@ -314,7 +314,7 @@
         &quot;&quot;&quot;Convert int32 prefixed strings into calls to stringReceived.
         &quot;&quot;&quot;
         self.recvd = self.recvd + recd
-        while len(self.recvd) &gt; 3:
+        while len(self.recvd) &gt; 3 and not self.paused and not self.transport.disconnecting:
             length ,= struct.unpack(&quot;!i&quot;,self.recvd[:4])
             if length &gt; self.MAX_LENGTH:
                 self.transport.loseConnection()
@@ -331,7 +331,7 @@
         self.transport.write(struct.pack(&quot;!i&quot;,len(data))+data)
 
 
-class Int16StringReceiver(protocol.Protocol):
+class Int16StringReceiver(protocol.Protocol, PauseProducer):
     &quot;&quot;&quot;A receiver for int16-prefixed strings.
 
     An int16 string is a string prefixed by 2 bytes, the 16-bit length of
@@ -351,7 +351,7 @@
         &quot;&quot;&quot;Convert int16 prefixed strings into calls to stringReceived.
         &quot;&quot;&quot;
         self.recvd = self.recvd + recd
-        while len(self.recvd) &gt; 1:
+        while len(self.recvd) &gt; 1 and not self.paused and not self.transport.disconnecting:
             length = (ord(self.recvd[0]) * 256) + ord(self.recvd[1])
             if len(self.recvd) &lt; length+2:
                 break
Index: Twisted/twisted/lore/latex.py
===================================================================
--- Twisted/twisted/lore/latex.py	(revision 13459)
+++ Twisted/twisted/lore/latex.py	(working copy)
@@ -104,7 +104,7 @@
 
     baseLevel = 0
     try:
-        diaHack = not not os.popen('which dia').read()
+        diaHack = not not os.popen('which dia 2&gt;/dev/null').read()
     except:
         # That's a no, then.
         diaHack = 0


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010018.html">[Twisted-Python] How can I call internet.MulticastServer() to	enable listenMultiple?
</A></li>
	<LI>Next message: <A HREF="010020.html">[Twisted-Python] pending fixes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10019">[ date ]</a>
              <a href="thread.html#10019">[ thread ]</a>
              <a href="subject.html#10019">[ subject ]</a>
              <a href="author.html#10019">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
