<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r13446%20-%20After%20a%20lengthy%0A%09discussion%2C%0A%09revert%20to%20previous%20threaded%20behavior%20wrt%20registering%20as%20the%20IO%20thread&In-Reply-To=%3C66bc10801b1c0e7a006e41c53bf05376%40fuhm.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042528.html">
   <LINK REL="Next"  HREF="042530.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r13446%20-%20After%20a%20lengthy%0A%09discussion%2C%0A%09revert%20to%20previous%20threaded%20behavior%20wrt%20registering%20as%20the%20IO%20thread&In-Reply-To=%3C66bc10801b1c0e7a006e41c53bf05376%40fuhm.net%3E"
       TITLE="[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread">foom at fuhm.net
       </A><BR>
    <I>Sun Apr  3 11:31:08 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042528.html">[Twisted-Python] pending fixes
</A></li>
        <LI>Next message (by thread): <A HREF="042530.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42529">[ date ]</a>
              <a href="thread.html#42529">[ thread ]</a>
              <a href="subject.html#42529">[ subject ]</a>
              <a href="author.html#42529">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 3, 2005, at 1:58 AM, Jp Calderone wrote:
&gt;<i> After a lengthy discussion, revert to previous threaded behavior wrt  
</I>&gt;<i> registering as the IO thread
</I>
&gt;<i> Modified: trunk/twisted/internet/posixbase.py
</I>&gt;<i> ======================================================================= 
</I>&gt;<i> =======
</I>&gt;<i> --- trunk/twisted/internet/posixbase.py	(original)
</I>&gt;<i> +++ trunk/twisted/internet/posixbase.py	Sat Apr  2 23:58:11 2005
</I>&gt;<i> @@ -155,7 +155,6 @@
</I>&gt;<i>          ReactorBase.__init__(self)
</I>&gt;<i>          if self.usingThreads or platformType == &quot;posix&quot;:
</I>&gt;<i>              self.installWaker()
</I>&gt;<i> -        threadable.whenThreaded(threadable.registerAsIOThread)
</I>&gt;<i>
</I>&gt;<i>      def _handleSignals(self):
</I>&gt;<i>          &quot;&quot;&quot;Install the signal handlers for the Twisted event loop.&quot;&quot;&quot;
</I>
You **do** realize this means isInIOThread always returns false after  
threading is enabled, if the reactor was started before threading was  
enabled, right?

Something like the following should be run in the test suite. It has to  
be in a separate process, though, to ensure it's in the incorrect  
state, so something needs to be done about passing in the reactor to  
run, also.

from twisted.python import threadable
from twisted.internet import reactor

def testIsInIOThread():
     print &quot;1)&quot;, threadable.isInIOThread()
     threadable.init(1)
     print &quot;2)&quot;, threadable.isInIOThread()
     reactor.crash()

reactor.callWhenRunning(testIsInIOThread)
reactor.run()

&gt;<i> @@ -202,10 +201,6 @@
</I>&gt;<i>          self.startRunning(installSignalHandlers=installSignalHandlers)
</I>&gt;<i>          self.mainLoop()
</I>&gt;<i>
</I>&gt;<i> -    def iterate(self, delay=0):
</I>&gt;<i> -        threadable.registerAsIOThread()
</I>&gt;<i> -        ReactorBase.iterate(self, delay)
</I>&gt;<i> -
</I>&gt;<i>      def mainLoop(self):
</I>&gt;<i>          while self.running:
</I>&gt;<i>              try:
</I>
iterate() is the external API, I think it, like startRunning, should  
also ensure the thread it's being called on is marked as the IO thread.

James



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042528.html">[Twisted-Python] pending fixes
</A></li>
	<LI>Next message (by thread): <A HREF="042530.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42529">[ date ]</a>
              <a href="thread.html#42529">[ thread ]</a>
              <a href="subject.html#42529">[ subject ]</a>
              <a href="author.html#42529">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
