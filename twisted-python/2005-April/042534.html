<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r13446%20-%20After%20a%20lengthy%0A%09discussion%2C%0A%09revert%20to%20previous%20threaded%20behavior%20wrt%20registering%20as%20the%20IO%20thread&In-Reply-To=%3C742c34a430ed1a78daebcb852c37cad7%40fuhm.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042533.html">
   <LINK REL="Next"  HREF="042547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r13446%20-%20After%20a%20lengthy%0A%09discussion%2C%0A%09revert%20to%20previous%20threaded%20behavior%20wrt%20registering%20as%20the%20IO%20thread&In-Reply-To=%3C742c34a430ed1a78daebcb852c37cad7%40fuhm.net%3E"
       TITLE="[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread">foom at fuhm.net
       </A><BR>
    <I>Sun Apr  3 21:52:34 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042533.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
        <LI>Next message (by thread): <A HREF="042547.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42534">[ date ]</a>
              <a href="thread.html#42534">[ thread ]</a>
              <a href="subject.html#42534">[ subject ]</a>
              <a href="author.html#42534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> [23:46] &lt;exarkun&gt; So, um, to back up and perhaps narrow scope slightly
</I>&gt;<i> [23:46] &lt;exarkun&gt; The current code does the right thing, I think, 
</I>&gt;<i> except when the platform lacks threads
</I>&gt;<i> [23:46] &lt;exarkun&gt; it does more than it needs to, probably, but it 
</I>&gt;<i> doesn't look like it ever does anything that's plain wrong
</I>&gt;<i> [23:47] &lt;exarkun&gt; platforms that lack thread support need to just not 
</I>&gt;<i> have registerAsIOThread called, or registerAsIOThread needs to be a 
</I>&gt;<i> no-op on those platforms
</I>
It already is, and always has been. From The Source:

def registerAsIOThread():
     &quot;&quot;&quot;Mark the current thread as responsable for I/O requests.
     &quot;&quot;&quot;
     global threaded
     global ioThread
     if threaded:
         import thread
         ioThread = thread.get_ident()


&gt;<i> [23:48] &lt;exarkun&gt; Correction: registerAsIOThread in __init__ on a 
</I>&gt;<i> thread-supporting platform is also sub-optimal now, as it forces the 
</I>&gt;<i> import of the thread module when we may not actually need it.
</I>
But it doesn't. See above. It is *because* of the behavior of doing 
nothing when threadable.init(1) has not yet been called that 
whenThreaded(registerAsIOThread) is necessary.

&gt;<i> [23:54] &lt;glyph&gt; Yes, but having iterate() behave in random, 
</I>&gt;<i> non-deterministic, broken ways in edge cases is preserving its current 
</I>&gt;<i> behavior :)
</I>
So, the reasoning for re-breaking iterate() is that iterate is also 
broken in some other way, and thus it should remain broken in this 
regard too? How does that even make a bit of sense?

Of course, right now, the only place isInIOThread is ever used in 
twisted is in reactor's wakeUp function, and there, it does not matter 
(except for efficiency) that it will always return False. So, we could 
simplify isInIOThread to &quot;return False&quot; and call it a feature.

A better solution may be to get rid of all this mess, and just make it 
so that if the thread module is available, it is used. Forget the 
&quot;threaded mode&quot; nonsense, and just make threaded-or-not something that 
has to be determined once, and finally, at startup.

James



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042533.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
	<LI>Next message (by thread): <A HREF="042547.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42534">[ date ]</a>
              <a href="thread.html#42534">[ thread ]</a>
              <a href="subject.html#42534">[ subject ]</a>
              <a href="author.html#42534">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
