<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [andrew-twisted at puzzling.org: Re: [Twisted-Python] shedding root]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5Bandrew-twisted%40puzzling.org%3A%20Re%3A%20%5BTwisted-Python%5D%20shedding%20root%5D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010058.html">
   <LINK REL="Next"  HREF="010060.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[andrew-twisted at puzzling.org: Re: [Twisted-Python] shedding root]</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5Bandrew-twisted%40puzzling.org%3A%20Re%3A%20%5BTwisted-Python%5D%20shedding%20root%5D&In-Reply-To="
       TITLE="[andrew-twisted at puzzling.org: Re: [Twisted-Python] shedding root]">andrew-twisted at puzzling.org
       </A><BR>
    <I>Wed Apr  6 02:58:33 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010058.html">[Twisted-Python] TCP File Copy
</A></li>
        <LI>Next message: <A HREF="010060.html">[Twisted-Python] Re: Twisted-Python Digest, Vol 13, Issue 9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10057">[ date ]</a>
              <a href="thread.html#10057">[ thread ]</a>
              <a href="subject.html#10057">[ subject ]</a>
              <a href="author.html#10057">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matt forgot to CC the list (then so did I).

----- Forwarded message from Andrew Bennetts &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrew-twisted at puzzling.org</A>&gt; -----

Date: Wed, 6 Apr 2005 12:16:40 +1000
From: Andrew Bennetts &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrew-twisted at puzzling.org</A>&gt;
To: Matt Feifarek &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">matt.feifarek at gmail.com</A>&gt;
Subject: Re: [Twisted-Python] shedding root
User-Agent: Mutt/1.5.6+20040907i

On Tue, Apr 05, 2005 at 09:25:17PM -0400, Matt Feifarek wrote:
&gt;<i> Thanks.
</I>&gt;<i> 
</I>&gt;<i> For some boring reasons, I can't really structure my whole app as a
</I>&gt;<i> twisted app; I just need some little  twisted bits.
</I>&gt;<i> 
</I>&gt;<i> It seems that it's hard to do that; you really have to drink the whole
</I>&gt;<i> kool-aid to use twisted.
</I>
It's not too hard, it's just not particularly visibly documented, because
it's not the usual case.

twistd uses twisted.application.  You'll want to do something like:

    from twisted.application import service
    from twisted.scripts.twistd import shedPrivileges
    from twisted.internet import reactor
    import mymodule

    app = service.Application('foo')
    myservice = mymodule.MyService(...)
    myservice.setServiceParent(app)

    service.IService(app).privilegedStartService()
    shedPrivileges(euid, uid, gid)
    service.IService(app).startService()
    reactor.addSystemEventTrigger('before', 'shutdown',
                                  service.IService(app).stopService)
    reactor.run()

Where MyService is a subclass of service.Service that overrides startService
and privilegedStartService.  You can attach any number of these to the
service.Applicaiton with setServiceParent.  Basically, this is the same as
you'd do in a .tac file, followed by direct calls to privilegedStartService,
shedPrivileges, startService, etc, rather than relying on twistd to do them.

Services in twisted.application.internet, such as TCPService, already define
appropriate privilegedStartService methods.

If all you need is allowing non-root users to bind to privileged ports, you
might find the authbind utility from debian to be a useful way to leave your
code ignorant of these matters.

-Andrew.


----- End forwarded message -----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010058.html">[Twisted-Python] TCP File Copy
</A></li>
	<LI>Next message: <A HREF="010060.html">[Twisted-Python] Re: Twisted-Python Digest, Vol 13, Issue 9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10057">[ date ]</a>
              <a href="thread.html#10057">[ thread ]</a>
              <a href="subject.html#10057">[ subject ]</a>
              <a href="author.html#10057">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
