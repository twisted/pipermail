<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Sending unicode strings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Sending%20unicode%20strings&In-Reply-To=200504230734.42190%40tintia.doriath">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010198.html">
   <LINK REL="Next"  HREF="010200.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Sending unicode strings</H1>
    <B>Bob Ippolito</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Sending%20unicode%20strings&In-Reply-To=200504230734.42190%40tintia.doriath"
       TITLE="[Twisted-Python] Sending unicode strings">bob at redivi.com
       </A><BR>
    <I>Sat Apr 23 02:03:09 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010198.html">[Twisted-Python] Sending unicode strings
</A></li>
        <LI>Next message: <A HREF="010200.html">[Twisted-Python] Sending unicode strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10199">[ date ]</a>
              <a href="thread.html#10199">[ thread ]</a>
              <a href="subject.html#10199">[ subject ]</a>
              <a href="author.html#10199">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Apr 23, 2005, at 1:34 AM, Michal Chruszcz wrote:

&gt;<i> I was undoubtedly surprised when I found out that I cannot pass unicode
</I>&gt;<i> strings to Twisted.
</I>&gt;<i> In 1.3 twisted.internet.abstract looks like this:
</I>&gt;<i>     def write(self, data):
</I>&gt;<i>         assert isinstance(data, str), &quot;Data must be a string.&quot;
</I>&gt;<i>         if not self.connected:
</I>&gt;<i>             return
</I>&gt;<i>
</I>&gt;<i> and in 2.0:
</I>&gt;<i>     def write(self, data):
</I>&gt;<i>         if isinstance(data, unicode): # no, really, I mean it
</I>&gt;<i>             raise TypeError(&quot;Data must be not be unicode&quot;)
</I>&gt;<i>
</I>&gt;<i> Why do you mean it? Why I can't send unicode through twisted? It's
</I>&gt;<i> ridiculous that I have to convert UTF8 strings to ISO on the client 
</I>&gt;<i> side
</I>&gt;<i> and then once again from ISO to UTF8 on the server side, so I suppose
</I>&gt;<i> you've got really good excuse.
</I>
You must ALWAYS encode or decode unicode at I/O boundaries in any 
programming language/framework.  Unicode has no encoding.  You must 
choose one at the I/O boundary, but that choice is up to you.  I 
suggest you read up on the hows and whys of Unicode, because apparently 
you missed something.

Specifically, Twisted's transports are for writing BYTES (not text).  
Unicode is strictly a bunch of characters that have no inherent byte 
representation.  The unicode type has nothing at all to do with UTF-8, 
I'm not sure why you decided they were related.  Technically the 
unicode type is represented internally with either UCS-2 or UCS-4 
depending on Python's configuration options.

The same is true for file objects in Python.  Though writing to them 
will automatically coerce to/from some default encoding 
(sys.getdefaultencoding()), usually ASCII, which hurts more than helps. 
  Twisted takes the high road and explicitly provides no automagic 
conversion for unicode objects.  If it did, your program would probably 
crash at random places if users of your application typed in non-ascii 
characters, because you didn't think enough about unicode before 
deciding to use it.  Now you are required to have a modicum of 
understanding about what you're doing when you use unicode, so it is 
far less likely that you will write code that has such silly bugs.

In more sane environments than Python, you will NOT have a single type 
that can represent both data and text at the same time (Python's str is 
evil).  Additionally, it is often the case that text types in more sane 
environments don't have a single internal representation (so you don't 
have to pay the N-byte penalty, or encoding/decoding costs at I/O 
boundaries for text you never really manipulate, etc.).

-bob



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010198.html">[Twisted-Python] Sending unicode strings
</A></li>
	<LI>Next message: <A HREF="010200.html">[Twisted-Python] Sending unicode strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10199">[ date ]</a>
              <a href="thread.html#10199">[ thread ]</a>
              <a href="subject.html#10199">[ subject ]</a>
              <a href="author.html#10199">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
