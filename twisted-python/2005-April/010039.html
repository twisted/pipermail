<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r13446%20-%20After%20a%20lengthy%0A%09discussion%2C%0A%09revert%20to%20previous%20threaded%20behavior%20wrt%20registering%20as%20the%20IO%20thread&In-Reply-To=742c34a430ed1a78daebcb852c37cad7%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010026.html">
   <LINK REL="Next"  HREF="010040.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r13446%20-%20After%20a%20lengthy%0A%09discussion%2C%0A%09revert%20to%20previous%20threaded%20behavior%20wrt%20registering%20as%20the%20IO%20thread&In-Reply-To=742c34a430ed1a78daebcb852c37cad7%40fuhm.net"
       TITLE="[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread">glyph at divmod.com
       </A><BR>
    <I>Mon Apr  4 19:03:36 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010026.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
        <LI>Next message: <A HREF="010040.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10039">[ date ]</a>
              <a href="thread.html#10039">[ thread ]</a>
              <a href="subject.html#10039">[ subject ]</a>
              <a href="author.html#10039">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>James Y Knight wrote:

&gt;<i> So, the reasoning for re-breaking iterate() is that iterate is also
</I>&gt;<i> broken in some other way, and thus it should remain broken in this
</I>&gt;<i> regard too? How does that even make a bit of sense?
</I>
iterate() is broken as an API.  Without even going into the problems 
with implementing it on a proactor, how does one determine when to start 
and stop services in a reactor that we one is calling .iterate() on? 
What happens when you call .stop()?  .crash()?  Do we need to invent an 
external status API so that the .iterate()-caller is &quot;on their honor&quot; to 
stop running at the appropriate time?  Without sensible semantics for 
starting and stopping services, you can't start and stop the thread pool 
reliably, and, poof, you can't do anything useful with threads.  These 
are the least of our problems.

This is iterate() as an _external_ API.  Internally, .doIteration() 
makes perfect sense for most reactors.  The original use-case for 
.iterate() was to support screen-painting APIs, such as in a 3D game - 
perhaps reactors should instead have a 'callAsOftenAsPossible(callable)' 
method to support that instead.  (callLater is a bit too expensive, I 
think, and besides it doesn't work when the FPU is in single-precision 
mode, as it is when running within a process like DirectX or certain 
proprietary openGL drivers on Windows).  Another option is for such a 
graphically intensive application subclass one of the reactors and add a 
  frame-drawing hook in doIteration.

Does someone with a real use-case want to come forward? :)

&gt;<i> A better solution may be to get rid of all this mess, and just make
</I>&gt;<i> it so that if the thread module is available, it is used. Forget the
</I>&gt;<i>  &quot;threaded mode&quot; nonsense, and just make threaded-or-not something
</I>&gt;<i> that has to be determined once, and finally, at startup.
</I>
The rationale for having this mess in the first place is that importing
the 'thread' module slows Python down by about 30%, even if you don't
actually run any threads.  Originally Twisted could run without
importing 'thread' at all even on a threaded platform - if we are going
to make the default resolver be threaded, then it's not clear how we
would restore that feature without leaving this mess intact and making
sure that installing the chosen resolver is done very early in the 
process's lifetime.

I'm open to other suggestions though.  I definitely don't like what 
we've got, and I don't think it works properly.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010026.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
	<LI>Next message: <A HREF="010040.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10039">[ date ]</a>
              <a href="thread.html#10039">[ thread ]</a>
              <a href="subject.html#10039">[ subject ]</a>
              <a href="author.html#10039">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
