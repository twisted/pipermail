<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r13446%20-%20After%20a%20lengthy%0A%09discussion%2C%0A%09revert%20to%20previous%20threaded%20behavior%20wrt%20registering%20as%20the%20IO%20thread&In-Reply-To=%3C37a477ea611993a9fadea43ebe718b40%40fuhm.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042547.html">
   <LINK REL="Next"  HREF="042535.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r13446%20-%20After%20a%20lengthy%0A%09discussion%2C%0A%09revert%20to%20previous%20threaded%20behavior%20wrt%20registering%20as%20the%20IO%20thread&In-Reply-To=%3C37a477ea611993a9fadea43ebe718b40%40fuhm.net%3E"
       TITLE="[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread">foom at fuhm.net
       </A><BR>
    <I>Mon Apr  4 18:28:55 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042547.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
        <LI>Next message (by thread): <A HREF="042535.html">[Twisted-Python] Creating an NT Service for a twistd script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42548">[ date ]</a>
              <a href="thread.html#42548">[ thread ]</a>
              <a href="subject.html#42548">[ subject ]</a>
              <a href="author.html#42548">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 4, 2005, at 7:03 PM, Glyph Lefkowitz wrote:
&gt;<i> The rationale for having this mess in the first place is that importing
</I>&gt;<i> the 'thread' module slows Python down by about 30%, even if you don't
</I>&gt;<i> actually run any threads.  Originally Twisted could run without
</I>&gt;<i> importing 'thread' at all even on a threaded platform - if we are going
</I>&gt;<i> to make the default resolver be threaded, then it's not clear how we
</I>&gt;<i> would restore that feature without leaving this mess intact and making
</I>&gt;<i> sure that installing the chosen resolver is done very early in the 
</I>&gt;<i> process's lifetime.
</I>
(summarized conversation, many lines cut):
[19:56] &lt;foom&gt; exarkun: how do you demonstrate that python slows down 
if you import thread?
[19:56] &lt;foom&gt; python -c 'import thread; import test.pystone; 
test.pystone.main()'
[19:56] &lt;foom&gt; doesn't show any slowdown vs not import thread'ing
[19:57] * exarkun tries some stuff
[20:13] &lt;foom&gt; it *does* slow down if you actually call 
thread.start_new_thread(lambda:0, ())
[20:14] &lt;foom&gt; on a new system, ever so slightly
[20:14] &lt;foom&gt; on an old system, a lot
[20:15] &lt;foom&gt; 31250 vs 17668 pystones on my RH73 system running py2.2
[20:15] &lt;foom&gt; 52631 vs 49504 pystones on my FC3 system py2.3
[20:16] &lt;foom&gt; 57471 vs 56179 pystones (on FC3 py2.4)
[20:18] &lt;exarkun&gt; a previous point release of 2.2 or 2.3 might have 
moved the PyEval_InitThreads() from threadmodule's init to 
start_new_thread
[20:21] &lt;exarkun&gt; hmm, no
[20:21] &lt;exarkun&gt; PyEval_InitThreads has been in start_new_thread for 8 
years :)
[20:22] &lt;exarkun&gt; hrm
[20:22] &lt;exarkun&gt; I suppose that doesn't tell us anything about whether 
another call to it was recently remove from the init function though
[20:27] &lt;foom&gt; exarkun: Instead, I'll run pystone on python1.5.2 and 
have the same behavior
[20:27] &lt;foom&gt; exarkun: and conclude that it's always been like that


Conclusions:
1) We do not need to worry about importing the thread module slowing 
anything down.
2) We do not need to worry about using the thread module slowing 
anything down, on modern systems.

Therefore, the rationale for the mess is invalid, and the mess can go 
away.

James



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042547.html">[Twisted-Python] Re: [Twisted-commits] r13446 - After a lengthy	discussion,	revert to previous threaded behavior wrt registering as the IO thread
</A></li>
	<LI>Next message (by thread): <A HREF="042535.html">[Twisted-Python] Creating an NT Service for a twistd script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42548">[ date ]</a>
              <a href="thread.html#42548">[ thread ]</a>
              <a href="subject.html#42548">[ subject ]</a>
              <a href="author.html#42548">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
