<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Pausing the transport in	http.HTTPChannel.lineReceived after all headers are received
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Pausing%20the%20transport%20in%0A%09http.HTTPChannel.lineReceived%20after%20all%20headers%20are%20received&In-Reply-To=%3C7D0E710F-7D1F-43DA-94E0-037AB5C6560B%40atleastfornow.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="029278.html">
   <LINK REL="Next"  HREF="029284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Pausing the transport in	http.HTTPChannel.lineReceived after all headers are received</H1>
    <B>HawkOwl</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Pausing%20the%20transport%20in%0A%09http.HTTPChannel.lineReceived%20after%20all%20headers%20are%20received&In-Reply-To=%3C7D0E710F-7D1F-43DA-94E0-037AB5C6560B%40atleastfornow.net%3E"
       TITLE="[Twisted-Python] Pausing the transport in	http.HTTPChannel.lineReceived after all headers are received">hawkowl at atleastfornow.net
       </A><BR>
    <I>Thu Mar 19 09:53:38 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="029278.html">[Twisted-Python] Pausing the transport in http.HTTPChannel.lineReceived after all headers are received
</A></li>
        <LI>Next message (by thread): <A HREF="029284.html">[Twisted-Python] 100-continue and rejecting connection after	headers are received
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61743">[ date ]</a>
              <a href="thread.html#61743">[ thread ]</a>
              <a href="subject.html#61743">[ subject ]</a>
              <a href="author.html#61743">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On 19 Mar 2015, at 23:26, Adi Roiban &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> My usecase is this:
</I>&gt;<i> 
</I>&gt;<i> When all headers of an HTTP request are received I want to ask a
</I>&gt;<i> remote service if the
</I>&gt;<i> request should be accepted and what to do with it.
</I>&gt;<i> 
</I>&gt;<i> Before I got the response for the remote service, I don't want to
</I>&gt;<i> receive/read HTTP data.
</I>&gt;<i> The response is returned via an deferred.
</I>&gt;<i> 
</I>&gt;<i> The HTTP data might be a 10G file which might be rejected.. for
</I>&gt;<i> example due to quota limits.
</I>&gt;<i> 
</I>&gt;<i> Here is a gist with a short example and my quick and dirty fix:
</I>&gt;<i> <A HREF="https://gist.github.com/adiroiban/621efeab47662a04cb20">https://gist.github.com/adiroiban/621efeab47662a04cb20</A>
</I>&gt;<i> 
</I>&gt;<i> ------
</I>&gt;<i> 
</I>&gt;<i> Do you think this is a valid use case and that  someone would be
</I>&gt;<i> willing to review a patch to add such a feature?
</I>
Ah yes, the 100-Continue stuff! I mentioned it briefly in my talk at PyCon AU.

It would be a useful feature, and I looked into it a little bit, but I'm not entirely sure how it would be accessible to user code. Most web server frameworks (Django, Klein, Flask, et al) work on a &quot;here's a full request, send a full response&quot; (only Twisted/Klein can do more than send a whole response without hacks :) ) and fitting it into that sort of framework would be a bit confusing.

So, my question is, because this functionality is desirable, how would it be exposed to the user? Maybe if it did traversal prior to the whole request being completed, and called something like headers_POST() or headers_GET() similar to render_GET/POST/etc, which would give the user access to these headers. A Deferred firing with True unblocks the producer, a Deferred firing with False kills off the request.

&gt;<i> 
</I>&gt;<i> -------
</I>&gt;<i> 
</I>&gt;<i> I first went on a wrong path as I was calling
</I>&gt;<i> self.transport.pauseProducing() instead of self.pauseProducing() but
</I>&gt;<i> while reading the code I found this:
</I>&gt;<i> 
</I>&gt;<i> In http.HTTPChannel  self.transport.producerPaused is confusing as it
</I>&gt;<i> is always False.. and looking at the code from internet/abstract.py I
</I>&gt;<i> can see that it is not touched by pauseProducing() ... how should
</I>&gt;<i> producerPaused be used?
</I>&gt;<i> 
</I>&gt;<i> Is this a bug or a feature? Is there a ticket for it?
</I>&gt;<i> 
</I>&gt;<i> I saw that when you return a non-zero value from lineReceived() it
</I>&gt;<i> will stop processing the remaining data but I could not find the
</I>&gt;<i> documentation for this behaviour.
</I>&gt;<i> 
</I>&gt;<i> Should I continue searching for the documentation ? or file a ticket?
</I>
This functionality does not exist in Twisted, it just automatically sends the 100. (<A HREF="https://twistedmatrix.com/trac/ticket/4673">https://twistedmatrix.com/trac/ticket/4673</A>) However, according to <A HREF="http://twisted-python.twistedmatrix.narkive.com/I9VkN3K3/twisted-web-giant-file-post-forwarding-and-early-bail-out">http://twisted-python.twistedmatrix.narkive.com/I9VkN3K3/twisted-web-giant-file-post-forwarding-and-early-bail-out</A> , it probably won't work that great -- only some clients do the 100 continue stuff, and others will just keep shovelling data down the pipe, so only by closing the connection (and them probably disregarding your error message) will it work.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thanks!
</I>&gt;<i> --
</I>&gt;<i> Adi Roiban
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 455 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: &lt;/pipermail/twisted-python/attachments/20150319/021dde7a/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="029278.html">[Twisted-Python] Pausing the transport in http.HTTPChannel.lineReceived after all headers are received
</A></li>
	<LI>Next message (by thread): <A HREF="029284.html">[Twisted-Python] 100-continue and rejecting connection after	headers are received
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61743">[ date ]</a>
              <a href="thread.html#61743">[ thread ]</a>
              <a href="subject.html#61743">[ subject ]</a>
              <a href="author.html#61743">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
