<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted thread pool
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20thread%20pool&In-Reply-To=%3C0938C870-10BD-424A-BF7F-6485E163C460%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029216.html">
   <LINK REL="Next"  HREF="029219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted thread pool</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20thread%20pool&In-Reply-To=%3C0938C870-10BD-424A-BF7F-6485E163C460%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] twisted thread pool">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Mar  2 14:50:40 MST 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029216.html">[Twisted-Python] twisted thread pool
</A></li>
        <LI>Next message: <A HREF="029219.html">[Twisted-Python] twisted thread pool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29218">[ date ]</a>
              <a href="thread.html#29218">[ thread ]</a>
              <a href="subject.html#29218">[ subject ]</a>
              <a href="author.html#29218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> On Mar 2, 2015, at 10:36 AM, Al Niessner &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">al.niessner at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Platform:
</I>&gt;<i> CPU: Intel (2x with 8 core each then hyper-threading gets us to 32 virtual)
</I>&gt;<i> Ubuntu 14.04
</I>&gt;<i> Python 3.4 (yes, I know)
</I>&gt;<i> Twisted 13.2.0
</I>&gt;<i> 
</I>&gt;<i> I use the vanilla twisted.internet.reactor.run() with the factory twisted.web.server.Site(root). It all runs just fine (seemingly) but,when I was snooping around on my machine, I had a ton of threads lying about. After cleaning up, I restarted my twisted application and found that I have 151 python3 threads lying about. I doubled checked and I have just twisted application running.
</I>&gt;<i> 
</I>&gt;<i> I browsed the documentation and the twisted thread pool claims to default between 5 and 10. However, I do abuse the deferToThread() cannot find any simple documentation on how that might feed back to the 151 threads. I thought maybe I need to exit the deferred returned from deferToThread() in some special way to clean it all up. However, I can find no documentation for it.
</I>&gt;<i> 
</I>&gt;<i> I have been googling about with many random search terms trying to puzzle the 151 threads from the documentation that tells me I should expect 5 to 10.
</I>&gt;<i> 
</I>&gt;<i> Can anyone please help understand why I have 151 threads and where they are coming from? Luckily they are all idle so the machine runs just fine.
</I>&gt;<i> 
</I>&gt;<i> The best story I can come up with is that there is one master thread on core-0 and then I get 10 threads in the pool for each of the other physical cores. However, the story is just numerology.
</I>
There are some bugs in the thread pool implementation (hopefully I'll get around to finishing my fix for soon, see &lt;<A HREF="https://twistedmatrix.com/trac/ticket/2673">https://twistedmatrix.com/trac/ticket/2673</A> &lt;<A HREF="https://twistedmatrix.com/trac/ticket/2673">https://twistedmatrix.com/trac/ticket/2673</A>&gt;&gt; for details) which may cause this issue, but given how far out of whack those numbers are, my inclination is to think it's something else in your environment.

Can you put your full code online somewhere so that we can test it?  Ideally after fixing it to be a minimal reproducer? :)

-g

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20150302/aeae23c0/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20150302/aeae23c0/attachment.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029216.html">[Twisted-Python] twisted thread pool
</A></li>
	<LI>Next message: <A HREF="029219.html">[Twisted-Python] twisted thread pool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29218">[ date ]</a>
              <a href="thread.html#29218">[ thread ]</a>
              <a href="subject.html#29218">[ subject ]</a>
              <a href="author.html#29218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
