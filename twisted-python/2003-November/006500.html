<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] Today is screw with twisted's guts day.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20Today%20is%20screw%20with%20twisted%27s%20guts%20day.&In-Reply-To=20031120005319.GM32299%40frobozz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006499.html">
   <LINK REL="Next"  HREF="006501.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] Today is screw with twisted's guts day.</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20Today%20is%20screw%20with%20twisted%27s%20guts%20day.&In-Reply-To=20031120005319.GM32299%40frobozz"
       TITLE="[Twisted-Python] Re: [Twisted-commits] Today is screw with twisted's guts day.">exarkun at intarweb.us
       </A><BR>
    <I>Wed Nov 19 20:12:56 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006499.html">[Twisted-Python] Re: [Twisted-commits] Today is screw with twisted's guts day.
</A></li>
        <LI>Next message: <A HREF="006501.html">[Twisted-Python] Re: [Twisted-commits] Today is screw with twisted's guts day.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6500">[ date ]</a>
              <a href="thread.html#6500">[ thread ]</a>
              <a href="subject.html#6500">[ subject ]</a>
              <a href="author.html#6500">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Nov 20, 2003 at 11:53:19AM +1100, Andrew Bennetts wrote:
&gt;<i> [snip]
</I>&gt;<i> 
</I>&gt;<i> So I think it's possible to lose thread calls.  I *think* this patch will
</I>&gt;<i> fix it, but more eyeballs are always welcome with threaded code:
</I>
  Thanks for noticing this.

&gt;<i> 
</I>&gt;<i> diff -u -r1.68 base.py
</I>&gt;<i> --- twisted/internet/base.py    19 Nov 2003 21:07:38 -0000      1.68
</I>&gt;<i> +++ twisted/internet/base.py    20 Nov 2003 00:52:08 -0000
</I>&gt;<i> @@ -400,12 +400,14 @@
</I>&gt;<i>          &quot;&quot;&quot;Run all pending timed calls.
</I>&gt;<i>          &quot;&quot;&quot;
</I>&gt;<i>          if self.threadCallQueue:
</I>&gt;<i> +            count = 0
</I>&gt;<i>              for (f, a, kw) in self.threadCallQueue:
</I>&gt;<i>                  try:
</I>&gt;<i>                      f(*a, **kw)
</I>&gt;<i>                  except:
</I>&gt;<i>                      log.err()
</I>&gt;<i> -            del self.threadCallQueue[:]
</I>&gt;<i> +                count += 1
</I>&gt;<i> +            del self.threadCallQueue[:count]
</I>&gt;<i>          now = time()
</I>&gt;<i>          while self._pendingTimedCalls and (self._pendingTimedCalls[-1].time &lt;= now):
</I>&gt;<i>              call = self._pendingTimedCalls.pop()
</I>&gt;<i> 
</I>
  That looks a little more complex than it needs to be.  What about this
version?


    def runUntilCurrent(self):
        &quot;&quot;&quot;Run all pending timed calls.
        &quot;&quot;&quot;
        if self.threadCallQueue:
            calls, self.threadCallQueue = self.threadCallQueue, []
            for (f, a, kw) in calls:               
                try:
                    f(*a, **kw)
                except:
                    log.err()

  I considered doing it this way first, but wasn't sure if anyone relied on
the identity of threadCallQueue (not that anyone should, but one never
knows).  If anyone thinks changing its identity should be avoided, I'd like
this version:

    def runUntilCurrent(self):
        &quot;&quot;&quot;Run all pending timed calls.
        &quot;&quot;&quot;
        if self.threadCallQueue:
            calls = self.threadCallQueue[:]
            del self.threadCallQueue[:]
            for (f, a, kw) in calls:
                try:
                    f(*a, **kw)
                except:
                    log.err()


  I suppose reverting it entirely is an option, seeing as how no one has yet
*actually* been bitten by the quadratic behavior (nor does it seem likely
that anyone will be), but all other things equal, it's nicer to use O(N)
algorithms deep down in the guts of Twisted than to use O(N**2) algorithms.

  Jp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031119/72313699/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031119/72313699/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006499.html">[Twisted-Python] Re: [Twisted-commits] Today is screw with twisted's guts day.
</A></li>
	<LI>Next message: <A HREF="006501.html">[Twisted-Python] Re: [Twisted-commits] Today is screw with twisted's guts day.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6500">[ date ]</a>
              <a href="thread.html#6500">[ thread ]</a>
              <a href="subject.html#6500">[ subject ]</a>
              <a href="author.html#6500">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
