<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deferred problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred%20problem&In-Reply-To=000001c3a471%24e6b30ee0%24687ba8c0%40vicky">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006316.html">
   <LINK REL="Next"  HREF="006309.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deferred problem</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred%20problem&In-Reply-To=000001c3a471%24e6b30ee0%24687ba8c0%40vicky"
       TITLE="[Twisted-Python] Deferred problem">andrew-twisted at puzzling.org
       </A><BR>
    <I>Thu Nov  6 19:49:19 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006316.html">[Twisted-Python] Deferred problem
</A></li>
        <LI>Next message: <A HREF="006309.html">[Twisted-Python] SelectReactor, readers and writers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6325">[ date ]</a>
              <a href="thread.html#6325">[ thread ]</a>
              <a href="subject.html#6325">[ subject ]</a>
              <a href="author.html#6325">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Nov 06, 2003 at 09:26:00AM -0500, vicky lupien wrote:

[reordered slightly]
&gt;<i> 
</I>&gt;<i>        def initPermissions(self, request):       #create and return the results of a sql query
</I>&gt;<i>            group = request.getComponent(myguard.Authenticated).group
</I>&gt;<i>            listGroup = group.split(',')
</I>&gt;<i>            sql = &quot;select permission from permissions where 1&quot;
</I>&gt;<i>            for item in listGroup:
</I>&gt;<i>                sql += &quot; or permissions.group='%s'&quot; % item.lstrip()
</I>&gt;<i>            theDeferred = self.dbpool.runQueryDict(sql)
</I>&gt;<i>            return theDeferred.addCallback(self.makeDict)        # suppose to call makeDict when the results has arrived
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>        def makeDict(self, results):
</I>&gt;<i>                # when I print what is in results, I can see all the data from the sql query
</I>&gt;<i>            listPermissions = []
</I>&gt;<i>            for item in results:
</I>&gt;<i>                listPermissions.append(item.get('permission'))
</I>&gt;<i>            return listPermissions                   # return the new list but the function setUp receive a deferred
</I>&gt;<i> 
</I>&gt;<i>        def setUp(self, request, *args):
</I>&gt;<i>            var = self.initPermissions(request)      #var is suppose to get the new list
</I>&gt;<i>            print var
</I>
setUp is receiving a Deferred from self.initPermissions, but then doesn't
wait for its result to arrive.  You should instead do something more like:

        def setUp(self, request, *args):
            d = self.initPermissions(request)
            def printVar(var):
                print var
            d.addCallback(printVar)

Although ideally you should add an errback too, even if it is just
twisted.python.log.err.

(I don't know how this will interact with the rest of Woven, but hopefully
I've clarified how you should be using Deferreds a little)

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006316.html">[Twisted-Python] Deferred problem
</A></li>
	<LI>Next message: <A HREF="006309.html">[Twisted-Python] SelectReactor, readers and writers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6325">[ date ]</a>
              <a href="thread.html#6325">[ thread ]</a>
              <a href="subject.html#6325">[ subject ]</a>
              <a href="author.html#6325">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
