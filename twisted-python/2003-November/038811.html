<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Scaling problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scaling%20problem&In-Reply-To=%3C200311050932.23119.uwe%40oss4u.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="038809.html">
   <LINK REL="Next"  HREF="038834.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Scaling problem</H1>
    <B>Uwe C. Schroeder</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scaling%20problem&In-Reply-To=%3C200311050932.23119.uwe%40oss4u.com%3E"
       TITLE="[Twisted-Python] Scaling problem">uwe at oss4u.com
       </A><BR>
    <I>Wed Nov  5 10:32:23 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="038809.html">[Twisted-Python] Scaling problem
</A></li>
        <LI>Next message (by thread): <A HREF="038834.html">[Twisted-Python] Scaling problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38811">[ date ]</a>
              <a href="thread.html#38811">[ thread ]</a>
              <a href="subject.html#38811">[ subject ]</a>
              <a href="author.html#38811">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Wednesday 05 November 2003 07:31 am, Itamar Shtull-Trauring wrote:
&gt;<i> On Wed, 5 Nov 2003 02:48:07 -0800
</I>&gt;<i>
</I>&gt;<i> &quot;Uwe C. Schroeder&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">uwe at oss4u.com</A>&gt; wrote:
</I>&gt;<i> &gt; I think I suffer from database latency in general and with the
</I>&gt;<i> &gt; expensive function in particular. The expensive function could be
</I>&gt;<i> &gt; moved to a thread and maybe I'll give it a try. However if I do this
</I>&gt;<i> &gt; for every method that writes more than 10 or 15 records to the
</I>&gt;<i> &gt; database I'll most likely end up with thousands of threads.
</I>&gt;<i>
</I>&gt;<i> No, Twisted has a thread pool, so if you are using Twisted APIs you
</I>&gt;<i> won't get more than the max number of threads the pool is configured to
</I>&gt;<i> use.
</I>
I know and I increased the threadpool limit a bit. Not much though because in 
the end it all runs on one cpu. I asume that if I start say 50 threads via 
deferToThread and the pool limit is 25 the requested threads are started when 
one becomes available ?

&gt;<i> &gt; The most expensive function I have (besides the printing mentioned
</I>&gt;<i> &gt; above) executes in about 3 seconds. This is not &quot;blocking&quot; in my
</I>&gt;<i> &gt; understanding, since the function never waits for something to happen,
</I>&gt;<i> &gt; it just calculates and stores stuff. Twisted is unresponsive for those
</I>&gt;<i> &gt; 3 seconds.
</I>&gt;<i>
</I>&gt;<i> If Twisted is unresponsive, that means it blocks. Any function that
</I>&gt;<i> takes more than 10ms should probably count as blocking, really. Try
</I>&gt;<i> running it in a thread. Because of the global interpreter lock, this
</I>&gt;<i> won't reduce runtime, but it'll enhance responsiveness to other clients.
</I> 
Responsiveness is what I need. Users are happy to wait a couple seconds if one 
can notify him and his screen still shows some &quot;progress&quot;.

&gt;<i> In general, it sounds like you are doing a lot of database queries. Some
</I>&gt;<i> ways to optimize this:
</I>&gt;<i>
</I>&gt;<i> 1. Do less queries - cache, merge identical requests, etc..
</I>
Yep - I already started moving some of the things into the database as stored 
procedures. This reduces the execution time tremendously since it get's rid 
of the DB API overhead. I know I still have some optimization potential by 
handing data blocks between methods so a particular method doesn't have to 
requery the database for something an other method already did.

&gt;<i> 2. Do a number of queries in a single transaction in a single thread,
</I>&gt;<i> rather than deferToThread, get result, run another query with
</I>&gt;<i> deferToThread again, etc..
</I>
I already do this, at least in some parts. You're right, the thread handling 
overhead is way too high to have single simple queries running in a thread 
each. It doesn't make sense to use a thread which costs you 1ms to set up for 
something that only runs 1ms.

&gt;<i> (3. Don't use RDBMS. Use an in-process database like ZODB or Quotient's
</I>&gt;<i> atop when it's done.)
</I>
:<i>-) I'd probably do that with a web application, but even there I'll allways 
</I>prefer a &quot;real&quot; database system. In process databases may be faster, therefor 
they are less relieable and correcting errors is a virtual impossibility.
Also the sher size of the data I handle would make something like ZODB blow up 
to a couple gigabytes in one month alone. 
Since my customers generally can afford it I rather use big iron for a couple 
thousand $$ to make the database faster. Specially in the finance and 
insurance industry it also makes the management happier if they see some big 
machines that look impressive in the rack. That's what they're used to and it 
gives them confidence in their investment (although one probably only uses 
10% of the machine :-) )
 
	UC

- --
Open Source Solutions 4U, LLC	2570 Fleetwood Drive
Phone:  +1 650 872 2425		San Bruno, CA 94066
Cell:   +1 650 302 2405		United States
Fax:    +1 650 872 2417
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE/qTQnjqGXBvRToM4RAqp1AJ4u5ORM99wqwQECY7ilUe5DzZrDGwCgjfEm
QfoGAI5kzxAstClINbfqoaw=
=6MHF
-----END PGP SIGNATURE-----



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="038809.html">[Twisted-Python] Scaling problem
</A></li>
	<LI>Next message (by thread): <A HREF="038834.html">[Twisted-Python] Scaling problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38811">[ date ]</a>
              <a href="thread.html#38811">[ thread ]</a>
              <a href="subject.html#38811">[ subject ]</a>
              <a href="author.html#38811">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
