<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Woven and nested database queries
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Woven%20and%20nested%20database%20queries&In-Reply-To=%3C003401c3b5a4%248e2aa7d0%244501a8c0%40wteixeiradsk1%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="039086.html">
   <LINK REL="Next"  HREF="039104.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Woven and nested database queries</H1>
    <B>Wenderson Teixeira</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Woven%20and%20nested%20database%20queries&In-Reply-To=%3C003401c3b5a4%248e2aa7d0%244501a8c0%40wteixeiradsk1%3E"
       TITLE="[Twisted-Python] Woven and nested database queries">wenderson at casadosprogramadores.com.br
       </A><BR>
    <I>Fri Nov 28 04:41:21 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="039086.html">[Twisted-Python] Fwd: Seems like the remote stuff works almost TOO well!
</A></li>
        <LI>Next message (by thread): <A HREF="039104.html">[Twisted-Python] Woven and nested database queries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39087">[ date ]</a>
              <a href="thread.html#39087">[ thread ]</a>
              <a href="subject.html#39087">[ subject ]</a>
              <a href="author.html#39087">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>	Hi,

	I'm new to the list and I'm just starting with Twisted and Woven.
	I think the framework is great, but I'm having some problems.
	When I try to make two nested &lt;div&gt;, both with independent queries,
	I get na error, the solution I've found is to create another model
	called &quot;loaddata&quot;, which does nothing, except call the queries.
	If anyone knows a better way, I'd like to hear, I've searched all
	over the Internet, and found nothing that could help.

	Thanks in advance,
 	 	
	Wenderson Teixeira


	Here is the minimum working code that exemplifies it:

from twisted.web.resource import Resource

from twisted.web.woven import page
from twisted.web import microdom
from twisted.enterprise import adbapi

class A(page.Page):

    # When &quot;loaddata&quot; is not present, I get the following error:
    # exceptions.AttributeError: DeferredWidget instance has no attribute 'd'
    template = &quot;&quot;&quot;
                &lt;html&gt;
                &lt;body&gt;
                    &lt;div model=&quot;loaddata&quot;/&gt;
                    &lt;p&gt;A&lt;/p&gt;
                    &lt;div model=&quot;a&quot;&gt;
                        &lt;div view=&quot;Text&quot;/&gt;
                        &lt;p&gt;B&lt;/p&gt;
                        &lt;ul model=&quot;b&quot; view=&quot;List&quot;&gt;
                            &lt;li pattern=&quot;listItem&quot; view=&quot;Text&quot; /&gt;
                        &lt;/ul&gt;
                    &lt;/div&gt;
                &lt;/body&gt;
                &lt;/html&gt;
                &quot;&quot;&quot;    

    def wmfactory_loaddata(self, request):
        self.runAQuery(request)
        self.runBQuery(request)
        return []

    def wmfactory_a(self, request):
        return self.runAQuery(request)

    def wmfactory_b(self, request):
        return self.runBQuery(request)

    def runQuery(self, queryStr, attr, callback):
        if not hasattr(self, attr):
            dbpool = adbapi.ConnectionPool(&quot;pyPgSQL.PgSQL&quot;, &quot;192.168.1.180::manesco_01:manesco&quot;)
            deferredQuery = dbpool.runQuery(queryStr)
            deferredQuery.addCallback(callback)
            dbpool.close()
            return deferredQuery
        return getattr(self, attr)
    
    def runAQuery(self, request):
        # Sample data
        #return [[1, 'Wenderson', 'WT', 2, 'Tex', None]]
        return self.runQuery(&quot;SELECT * FROM advogado WHERE id_adv=77&quot;, &quot;aDataset&quot;, self.gotAResult)

    def runBQuery(self, request):
        # Sample data
        #return [
        #    [1, 'Advogado Sr.'],
        #    [2, 'Advogado Pleno'],
        #    [3, 'Advogado Jr.'],
        #    [4, 'Estagiario'],
        #    [5, 'Assist. Criatividade'],
        #    [6, 'Empresario'],
        #    [7, 'Departamento Pessoal']
        #]
        return self.runQuery(&quot;SELECT * FROM categoria&quot;, &quot;bDataset&quot;, self.gotBResult)

    def gotAResult(self, data):
        self.aDataset = data
        return data
    
    def gotBResult(self, data):
        self.bDataset = data
        return data

resource = A(directory = &quot;C:\inetpub\wwwroot\man&quot;)

	



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="039086.html">[Twisted-Python] Fwd: Seems like the remote stuff works almost TOO well!
</A></li>
	<LI>Next message (by thread): <A HREF="039104.html">[Twisted-Python] Woven and nested database queries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39087">[ date ]</a>
              <a href="thread.html#39087">[ thread ]</a>
              <a href="subject.html#39087">[ subject ]</a>
              <a href="author.html#39087">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
