<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Woven application, objects not collected.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Woven%20application%2C%20objects%20not%20collected.&In-Reply-To=uznektzry.fsf%40inout.no">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006554.html">
   <LINK REL="Next"  HREF="006556.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Woven application, objects not collected.</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Woven%20application%2C%20objects%20not%20collected.&In-Reply-To=uznektzry.fsf%40inout.no"
       TITLE="[Twisted-Python] Woven application, objects not collected.">andrew-twisted at puzzling.org
       </A><BR>
    <I>Tue Nov 25 08:13:38 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006554.html">[Twisted-Python] Woven application, objects not collected.
</A></li>
        <LI>Next message: <A HREF="006556.html">[Twisted-Python] Woven application, objects not collected.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6555">[ date ]</a>
              <a href="thread.html#6555">[ thread ]</a>
              <a href="subject.html#6555">[ subject ]</a>
              <a href="author.html#6555">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Nov 25, 2003 at 01:10:09PM +0100, Syver Enstad wrote:
&gt;<i> 
</I>&gt;<i> I have a serious problem with some woven applications where deferreds
</I>&gt;<i> and their results returned from wmfactory_ methods are not garbage
</I>&gt;<i> collected. They just stack up in gc.garbage. The python documentation
</I>&gt;<i> states that the contents of gc.garbage are objects that are part of a
</I>&gt;<i> cycle can't be collected because they have a __del__ method.
</I>&gt;<i> 
</I>&gt;<i> Any help on this issue would be really appreciated.
</I>
Deferreds have a __del__ method, used to log unhandled errors, which has
often proved to be a valuable debugging aid (people often forget to
.addErrback(log.err)).

Unfortunately, this means that Deferreds in reference cycles can't be
automatically garbage collected.  Can you boil this down to a minimal test
case?  This sounds like the probable cause of a memory leak some users have
reported with Twisted Web.

The trick will be to figure out what the reference cycle is, and breaking
it.  It may help to do:
    twisted.internet.defer.Deferred.debug = True
and then inspect the .creator attribute of the Deferreds the end up in
gc.garbage.  You could also try manually poking around with gc.get_referrers
on those Deferreds.

If we can find a good enough test case, we might be able to write a unit
test to trigger it and then check gc.garbage, so that we can include it in
the test suite and stop it from happening again.

I'm very keen to find out what's causing this -- let me know if there's
anything I can help with.

-Andrew.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006554.html">[Twisted-Python] Woven application, objects not collected.
</A></li>
	<LI>Next message: <A HREF="006556.html">[Twisted-Python] Woven application, objects not collected.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6555">[ date ]</a>
              <a href="thread.html#6555">[ thread ]</a>
              <a href="subject.html#6555">[ subject ]</a>
              <a href="author.html#6555">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
