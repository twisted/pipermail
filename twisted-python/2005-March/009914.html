<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] help with ssl timeout and not reconnecting	client factory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20help%20with%20ssl%20timeout%20and%20not%20reconnecting%0A%09client%20factory&In-Reply-To=20050317225855.GU21597%40opteron.random">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009911.html">
   <LINK REL="Next"  HREF="009899.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] help with ssl timeout and not reconnecting	client factory</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20help%20with%20ssl%20timeout%20and%20not%20reconnecting%0A%09client%20factory&In-Reply-To=20050317225855.GU21597%40opteron.random"
       TITLE="[Twisted-Python] help with ssl timeout and not reconnecting	client factory">exarkun at divmod.com
       </A><BR>
    <I>Fri Mar 18 01:01:20 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009911.html">[Twisted-Python] help with ssl timeout and not reconnecting	client factory
</A></li>
        <LI>Next message: <A HREF="009899.html">[Twisted-Python] Commit Messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9914">[ date ]</a>
              <a href="thread.html#9914">[ thread ]</a>
              <a href="subject.html#9914">[ subject ]</a>
              <a href="author.html#9914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 17 Mar 2005 23:58:55 +0100, Andrea Arcangeli &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrea at cpushare.com</A>&gt; wrote:
&gt;<i>On Thu, Mar 17, 2005 at 11:51:04AM -0500, Itamar Shtull-Trauring wrote:
</I>&gt;<i> &gt; There was a bug in 1.3 in ReconnectingClientFactory that caused it to
</I>&gt;<i> &gt; not reconnect on TimeoutErrors. It's fixed in 2.0.
</I>&gt;<i> 
</I>&gt;<i> Ok. This should workaround the bug in my app:
</I>&gt;<i> 
</I>&gt;<i> Index: cpushare/proto.py
</I>&gt;<i> ===================================================================
</I>&gt;<i> RCS file: /home/andrea/crypto/cvs/cpushare/client/cpushare/cpushare/proto.py,v
</I>&gt;<i> retrieving revision 1.29
</I>&gt;<i> diff -u -p -r1.29 proto.py
</I>&gt;<i> --- cpushare/proto.py	13 Mar 2005 23:18:24 -0000	1.29
</I>&gt;<i> +++ cpushare/proto.py	17 Mar 2005 22:56:20 -0000
</I>&gt;<i> @@ -148,8 +148,24 @@ class cpushare_factory(ReconnectingClien
</I>&gt;<i>  		protocol.factory = self
</I>&gt;<i>  		return protocol
</I>&gt;<i>  
</I>&gt;<i> +	def clientConnectionLost(self, connector, reason):
</I>&gt;<i> +		print 'Lost connection. Reason:', reason
</I>&gt;<i> +		ReconnectingClientFactory.clientConnectionLost(self, connector, reason)
</I>&gt;<i> +
</I>&gt;<i>  	def clientConnectionFailed(self, connector, reason):
</I>&gt;<i>  		print 'Connection failed. Reason:', reason
</I>&gt;<i> +		# workaround for bug in 1.3.0 - start
</I>&gt;<i> +		from twisted.copyright import version
</I>&gt;<i> +		if '1.3.0' in version:
</I>&gt;<i> +			def workaround_clientConnectionFailed(connector, reason):
</I>&gt;<i> +				if self.continueTrying:
</I>&gt;<i> +					self.connector = connector
</I>&gt;<i> +					from twisted.internet import interfaces, error, defer
</I>&gt;<i> +					if not reason.check(error.UserError) or reason.check(defer.TimeoutError):
</I>&gt;<i> +						self.retry()
</I>&gt;<i> +			workaround_clientConnectionFailed(connector, reason)
</I>&gt;<i> +			return
</I>&gt;<i> +		# workaround for bug in 1.3.0 - end
</I>&gt;<i>  		ReconnectingClientFactory.clientConnectionFailed(self, connector, reason)
</I>&gt;<i>  
</I>&gt;<i>  	def connectionMade(self):
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thanks Itamar and Jp for the help!
</I>&gt;<i> 
</I>
  Glad to offer it :)  I wonder why you didn't go with the apparently equivalent but similar version of clientConnectionFailed, though:

    def clientConnectionFailed(self, connector, reason):
        print 'Connection failed. Reason:', reason
        # workaround for bug in 1.3.0 - start
        from twisted.copyright import version
        if '1.3.0' in version:
            if self.continueTrying:
                self.connector = connector
                self.retry()
            return
        # workaround for bug in 1.3.0 - end
        ReconnectingClientFactory.clientConnectionFailed(
            self, connector, reason)

  I guess I can see how defining a function for the logic further separates it from the rest of the code, but why define it inside the version test if suite? :)  Maybe that was just the most convenient place at the moment..  The main difference, though, is the total absense of the if guarding the call to self.retry().  It seems like you duplicated the 1.3 logic in the 1.3 work-around code.  Maybe I'm just misreading it, but it seems like you just want to omit that test and always retry().

  Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009911.html">[Twisted-Python] help with ssl timeout and not reconnecting	client factory
</A></li>
	<LI>Next message: <A HREF="009899.html">[Twisted-Python] Commit Messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9914">[ date ]</a>
              <a href="thread.html#9914">[ thread ]</a>
              <a href="subject.html#9914">[ subject ]</a>
              <a href="author.html#9914">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
