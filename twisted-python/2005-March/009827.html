<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Twisted and the Posh Module
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Twisted%20and%20the%20Posh%20Module&In-Reply-To=200503141059.51652.general%40eepatents.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009826.html">
   <LINK REL="Next"  HREF="009828.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Twisted and the Posh Module</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Twisted%20and%20the%20Posh%20Module&In-Reply-To=200503141059.51652.general%40eepatents.com"
       TITLE="[Twisted-Python] Re: Twisted and the Posh Module">exarkun at divmod.com
       </A><BR>
    <I>Mon Mar 14 14:19:14 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009826.html">[Twisted-Python] Re: Twisted and the Posh Module
</A></li>
        <LI>Next message: <A HREF="009828.html">[Twisted-Python] Re: Twisted and the Posh Module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9827">[ date ]</a>
              <a href="thread.html#9827">[ thread ]</a>
              <a href="subject.html#9827">[ subject ]</a>
              <a href="author.html#9827">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 14 Mar 2005 10:59:51 -0800, Ed Suominen &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">general at eepatents.com</A>&gt; wrote:
&gt;<i>On Monday 14 March 2005 10:13 am, 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-request at twistedmatrix.com</A> wrote:
</I>&gt;<i> &gt; Has anyone tried playing with Twisted and the posh module? I need to
</I>&gt;<i> &gt; do some CPU-intensive stuff inside the reactor, which unfortunately
</I>&gt;<i> &gt; holds on to the GIL. I was thinking of just making a deferToPosh()
</I>&gt;<i> &gt; type of method in the spirit of deferToThread(), but forking on each
</I>&gt;<i> &gt; operation would be pretty expensive. Which brings up the question of
</I>&gt;<i> &gt; having process pools.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Has anyone done anything like this? I don't really need any
</I>&gt;<i> &gt; interaction between the worker processes and Twisted, so in theory I
</I>&gt;<i> &gt; could spawn off some worker processes early and just communicate
</I>&gt;<i> &gt; queues of tasks to complete, independent of Twisted and the reactor.
</I>&gt;<i> 
</I>&gt;<i> I think having some sort of process pool mangagement in Twisted is a 
</I>&gt;<i> great idea, especially with multi-core CPUs emerging on the scene. I 
</I>&gt;<i> have access to a dual-core Pentium Prescott CPU and it would be great 
</I>&gt;<i> to have that available to keep both cores humming on a certain 
</I>&gt;<i> CPU-intensive project I'm considering.
</I>&gt;<i> 
</I>&gt;<i> However, I'm not sure the best way to go about it would be with the posh 
</I>&gt;<i> module, pypar (see <A HREF="http://datamining.anu.edu.au/~ole/pypar/">http://datamining.anu.edu.au/~ole/pypar/</A>), or just 
</I>&gt;<i> using Perspective Broker as an underlying message-passing mechanism 
</I>&gt;<i> with UNIX sockets and/or TCP. One thought might be to have a single 
</I>&gt;<i> master process start up and act as a PB server and process pool 
</I>&gt;<i> manager. Subsidiary processes could then make authenticated PB 
</I>&gt;<i> connections to the server to &quot;volunteer&quot; for work in the process pool. 
</I>&gt;<i> 
</I>&gt;<i> Note that pypar lets you easily find out how many CPUs you have under 
</I>&gt;<i> kernel control, with pypar.size(). Thus, the main process could start 
</I>&gt;<i> the process pool by spawning a subsidiary &quot;volunteer&quot; process for each 
</I>&gt;<i> CPU core present.
</I>
  Quotient currently uses Twisted's spawnProcess() to start up a worker process and communicates with it using PB over stdin/stdout.  The child process performs fulltext indexing and searches for the parent process.

  The code is currently about half transformed into a general process pool service.  Unfortunately I have not had time to work on this in several weeks, and probably will not have time to finish it for at least several more.  If anyone is interested in picking up development and finishing it, I'd be more than happy to accept patches :)  Once this is done, it should go into Twisted, since it is clearly a feature quite a few people using Twisted desire.

  Most of the code is currently in a module in a branch in the Quotient repository:

<A HREF="http://divmod.org/cvs/branches/exarkun/runnerup-2357/atop/runnerup.py?rev=7515&amp;view=markup">http://divmod.org/cvs/branches/exarkun/runnerup-2357/atop/runnerup.py?rev=7515&amp;view=markup</A>

  In particular, the ProcessController and ServiceController classes.

  Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009826.html">[Twisted-Python] Re: Twisted and the Posh Module
</A></li>
	<LI>Next message: <A HREF="009828.html">[Twisted-Python] Re: Twisted and the Posh Module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9827">[ date ]</a>
              <a href="thread.html#9827">[ thread ]</a>
              <a href="subject.html#9827">[ subject ]</a>
              <a href="author.html#9827">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
