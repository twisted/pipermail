<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Bootstrapping Servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Bootstrapping%20Servers&In-Reply-To=%3C9F028CC77827D611ACEE0002A5F12F070855157B%40semldsntmsx208.seml.astrazeneca.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042457.html">
   <LINK REL="Next"  HREF="042458.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Bootstrapping Servers</H1>
    <B>Harald.Nyman at astrazeneca.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Bootstrapping%20Servers&In-Reply-To=%3C9F028CC77827D611ACEE0002A5F12F070855157B%40semldsntmsx208.seml.astrazeneca.net%3E"
       TITLE="[Twisted-Python] Bootstrapping Servers">Harald.Nyman at astrazeneca.com
       </A><BR>
    <I>Thu Mar 24 05:44:23 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042457.html">[Twisted-Python] Bootstrapping Servers
</A></li>
        <LI>Next message (by thread): <A HREF="042458.html">[Twisted-Python] looping in a non-blocking way
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42459">[ date ]</a>
              <a href="thread.html#42459">[ thread ]</a>
              <a href="subject.html#42459">[ subject ]</a>
              <a href="author.html#42459">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I do something similar with the help of a shell script - roughly like
 
#!/bin/sh
touch START_SERVER
while [ -f START_SERVER ]
do
  rm START_SERVER
  thisDir=`pwd | gawk -F '/' '{print $NF}'`
  twistd --pidfile=${thisDir}.pid -noy che.tac &gt; /dev/null &amp;
done
echo Server ${thisDir} stopped.

 
--------------------------------------------------------------------
# Close connections, tell clients whether we're stopping or restarting,
......
 
    def _stopServer(self, restart):
        if restart:
            f = open('START_SERVER', 'w')
            f.close()
        reactor.stop()
        sys.exit()

Harald

-----Original Message-----
From: Grant McDonald [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">gmcdonald at infocomp.com</A>]
Sent: torsdag, 24 mars 2005 07:38
To: Twisted general discussion (E-mail)
Subject: [Twisted-Python] Bootstrapping Servers



Dear All, 

I have created some code to close all active connections to a server, spawn
a new instance of itself and call reactor.stop() to facilitate a remote
bootstrap restart of a server. The bootstrapping process takes place through
a loader where if passed an option to bootstrap the code pauses for 20 secs
to allow the previous process to exit:

import sys 

if sys.argv[1] == &quot;--bootstrap&quot; or sys.argv[1] == &quot;-b&quot;: 
    print 'bootstrapping' 
    del sys.argv[1] 
    import time 
    time.sleep(20.0) 

from twisted.python.runtime import platformType 
if platformType == &quot;win32&quot;: 
    from twisted.scripts.twistw import run 
else: 
    from twisted.scripts.twistd import run 

run() 

However the above code does not allow the server to start since twistd
complains that the port is in use: 

2005/03/24 17:14 AUS Eastern Daylight Time [-] Log opened. 
2005/03/24 17:14 AUS Eastern Daylight Time [-] twistd 1.3.0
(C:\Python23\python.exe 2.3.3) starting up 
2005/03/24 17:14 AUS Eastern Daylight Time [-] reactor class:
twisted.internet.default.SelectReactor 
2005/03/24 17:14 AUS Eastern Daylight Time [-] managers.ConnectionManager
starting on 12005 
2005/03/24 17:14 AUS Eastern Daylight Time [-] Traceback (most recent call
last): 
2005/03/24 17:14 AUS Eastern Daylight Time [-]   File &quot;D:\python
projects\programs\zcfscheduler\loader.py&quot;, line 15, in ?

2005/03/24 17:14 AUS Eastern Daylight Time [-]     run() 

&lt;-- snip --&gt; 

2005/03/24 17:14 AUS Eastern Daylight Time [-]     return getattr(reactor,
'listen'+self.method)(*self.args, **self.kwargs)

2005/03/24 17:14 AUS Eastern Daylight Time [-]   File
&quot;C:\Python23\lib\site-packages\twisted\internet\default.py&quot;, line 283, in
listenTCP

2005/03/24 17:14 AUS Eastern Daylight Time [-]     p.startListening() 
2005/03/24 17:14 AUS Eastern Daylight Time [-]   File
&quot;C:\Python23\lib\site-packages\twisted\internet\tcp.py&quot;, line 594, in
startListening

2005/03/24 17:14 AUS Eastern Daylight Time [-]     raise CannotListenError,
(self.interface, self.port, le) 
2005/03/24 17:14 AUS Eastern Daylight Time [-]
twisted.internet.error.CannotListenError: Couldn't listen on any:12005:
(10048, 'Address already in use').

how can i get the server to stop, restart itself and release the port in the
process? 

Regards, 

Grant McDonald 

 

Important notice: This message is intended for the individual(s) and
entity(s) addressed. The information contained in this transmission and any
attached, may be confidential and may also be the subject of legal
privilege, public interest immunity or legal professional privilege. Any
review, retransmission, dissemination or other use of, taking of any action
in reliance upon this information by person or entities other than the
recipient is prohibited and requires authorization from the sender. If you
are not the addressee indicated in this message (or responsible for delivery
of the message to such person) you may not copy or deliver this message to
anyone. In such cases you should destroy this message and kindly notify the
sender by reply email. 

WARNING: Although Infocomp has taken reasonable precautions so that no
viruses are present in this e-mail, the company cannot accept responsibility
for any loss or damage arising from the use of e-mail attachments.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/ms-tnef
Size: 8123 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20050324/5234398e/attachment-0002.bin&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042457.html">[Twisted-Python] Bootstrapping Servers
</A></li>
	<LI>Next message (by thread): <A HREF="042458.html">[Twisted-Python] looping in a non-blocking way
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42459">[ date ]</a>
              <a href="thread.html#42459">[ thread ]</a>
              <a href="subject.html#42459">[ subject ]</a>
              <a href="author.html#42459">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
