<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] looping in a non-blocking way
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20looping%20in%20a%20non-blocking%20way&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009949.html">
   <LINK REL="Next"  HREF="009954.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] looping in a non-blocking way</H1>
    <B>Eugene Coetzee</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20looping%20in%20a%20non-blocking%20way&In-Reply-To="
       TITLE="[Twisted-Python] looping in a non-blocking way">projects at reedflute.com
       </A><BR>
    <I>Thu Mar 24 04:01:12 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009949.html">[Twisted-Python] Bootstrapping Servers
</A></li>
        <LI>Next message: <A HREF="009954.html">[Twisted-Python] looping in a non-blocking way
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9950">[ date ]</a>
              <a href="thread.html#9950">[ thread ]</a>
              <a href="subject.html#9950">[ subject ]</a>
              <a href="author.html#9950">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everybody.

I have an application where I have  several polling protocol instances 
servicing an array of COM ports driven by  timers using 
reactor.callLater with typically 50 millisecond timing constants.  I'm 
also using  FTP client protocol instances to concurrently  refresh 
locally cached data from ftp servers. These files may be quite large and 
during the text parsing routines I end up with blocking loops which are 
undesirable.

Text files my be parsed in a loop with something like:

def importFromText(self,data):
               datalines=data.split(&quot;\r\n&quot;)
                for line in datalines:
                        arrin=[]
                        arrin.insert(0,line[0:10])
                        etc....

For large files the above blocks - starving the other COM port protocols 
drivers of processing time.

I have tried to &quot;yield&quot; to the reactor by calling reactor.iterate() in 
the above loop trying to do what you would normally accomplish with 
sleep(0) in a multithreaded  application. This solution seemed to 
partially solve the problem but I'm experiencing intermittent  stability 
problems with my polling protocol drivers that are normally quite 
robust  simply hanging up.

I'm now considering rewriting the above loop as a recursive function 
using reactor.callLater(0,recursiveTexParsingFunction(params)).

I'm aware of twisted.flow but the examples given are a bit sparse and 
obscure and having tried something like  
<A HREF="http://twistedmatrix.com/documents/current/api/twisted.flow.flow.html">http://twistedmatrix.com/documents/current/api/twisted.flow.flow.html</A> - 
it appears I don't understand how to apply twisted.flow  
(iterators/coroutines) solve my particular problem.

I hope I'm missing something obvious and more elegant since the above 
possible solutions seems like a lot of rework to solve a very simple 
problem.

Any thoughts/advise would be much appreciated.

regards,

Eugene Coetzee                  


Web                 -&gt; www.reedflute.com
=============================================== 




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009949.html">[Twisted-Python] Bootstrapping Servers
</A></li>
	<LI>Next message: <A HREF="009954.html">[Twisted-Python] looping in a non-blocking way
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9950">[ date ]</a>
              <a href="thread.html#9950">[ thread ]</a>
              <a href="subject.html#9950">[ subject ]</a>
              <a href="author.html#9950">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
