<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] setTimeout in Deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20setTimeout%20in%20Deferred&In-Reply-To=%3CPine.LNX.4.61.0503091242320.21930%40forty-thieves.cis.upenn.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042226.html">
   <LINK REL="Next"  HREF="042258.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] setTimeout in Deferred</H1>
    <B>Yun Mao</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20setTimeout%20in%20Deferred&In-Reply-To=%3CPine.LNX.4.61.0503091242320.21930%40forty-thieves.cis.upenn.edu%3E"
       TITLE="[Twisted-Python] setTimeout in Deferred">maoy at cis.upenn.edu
       </A><BR>
    <I>Wed Mar  9 21:53:58 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042226.html">[Twisted-Python] setTimeout in Deferred
</A></li>
        <LI>Next message (by thread): <A HREF="042258.html">[Twisted-Python] setTimeout in Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42256">[ date ]</a>
              <a href="thread.html#42256">[ thread ]</a>
              <a href="subject.html#42256">[ subject ]</a>
              <a href="author.html#42256">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Wed, 9 Mar 2005, Christopher Armstrong wrote:

&gt;<i> It's a bit more complex than that, and its input and behavior makes
</I>&gt;<i> some wrong assumptions and has some bad implications. It is the
</I>&gt;<i> end-user of a Deferred who usually wants to specify the timeout before
</I>&gt;<i> cancelling the operation. However, it is the creator of the Deferred
</I>&gt;<i> who needs to specify _how_ cancelling an operation works -- it's
</I>&gt;<i> different for every protocol / kind of operation. Putting the timeout
</I>&gt;<i> and the canceller next to each other is a bad idea. In practice, using
</I>&gt;<i> setTimeout leads to a bunch of stupid AlreadyCalled errors when the
</I>&gt;<i> end-user of a Deferred specifies a timeout and the framework code
</I>&gt;<i> doesn't know about it.
</I>&gt;<i>
</I>&gt;<i> The best way to offer timeout support in your code is to modify your
</I>&gt;<i> API. If you have a function like getPage which connects to an HTTP
</I>&gt;<i> server and downloads a resource, that getPage function should take a
</I>&gt;<i> timeout parameter. If set, the HTTP-downloader should disconnect from
</I>&gt;<i> the server when the timeout is reached, and simply send an errback to
</I>&gt;<i> the deferred.
</I>&gt;<i>
</I>
Thanks for the insight.

The problem is: many of the result-generating APIs do not have a timeout 
option, for example, XMLRPC calls, Database queries, etc. What can we do?
Are you suggesting to modify those APIs? I believe the framework should 
have something related to that.

I could imagine to write a TimerDeferred class or something to wrap the 
original Deferred, which handles timeout, and prevents AlreadyCalledError 
from happening. The tricky thing is, when those timed out calls return 
with callback/errback, there should be cancellation handlers to clean up 
the resources, like lateCallback(), lateErrback(). Of course, the simplest 
solution is to discard the results (just like what DeferredList does 
when fireOnOneCallback/errback is specified), but it is protocol specific.

Even with APIs that have the timeout option, there could also be problems 
when you use them in some form of combination. E.g. I'd write a procedure 
which involves one DNSLookup and one getPage() sequentially. I could 
specify timeout value with 2 seconds each, however what I really want the 
total time to be less than 4 seconds in which case DNS could take longer. 
It is not terribly hard to implement base on what we have now but it would 
be nice if there is a framework support that can calculate the correct 
timers for me.

Another form of &quot;cancellation&quot; is also related to the chaining effect. 
Suppose I want to start following two jobs at the same time:

1: A()-&gt;B()-C()
2: D()-&gt;E()

However, I only need the result from any of of them. i.e. as long as one 
of them is finished, the other thread is useless and should be canceled 
ASAP to prevent from resource consuming. Right now, I'm using 
DeferredList, but it doesn't cancel the other thread. A similar 
requirement is that if either one of them got errback, the other should be 
canceled.

Anyway, being able to schedule flexible timers is a very big advantage in 
async programming over multithreading to me. Otherwise, signals, locks, 
etc could just drive me nuts. However, I still believe in Twisted has the 
potential to have better framework support.

Yun



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042226.html">[Twisted-Python] setTimeout in Deferred
</A></li>
	<LI>Next message (by thread): <A HREF="042258.html">[Twisted-Python] setTimeout in Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42256">[ date ]</a>
              <a href="thread.html#42256">[ thread ]</a>
              <a href="subject.html#42256">[ subject ]</a>
              <a href="author.html#42256">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
