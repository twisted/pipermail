<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Threading traceback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Threading%20traceback&In-Reply-To=%3C200503301102.07995.uwe%40oss4u.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042498.html">
   <LINK REL="Next"  HREF="042496.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Threading traceback</H1>
    <B>Uwe C. Schroeder</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Threading%20traceback&In-Reply-To=%3C200503301102.07995.uwe%40oss4u.com%3E"
       TITLE="[Twisted-Python] Threading traceback">uwe at oss4u.com
       </A><BR>
    <I>Wed Mar 30 12:02:07 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042498.html">[Twisted-Python] RC's of Win32 installers for 2.0.0
</A></li>
        <LI>Next message (by thread): <A HREF="042496.html">[Twisted-Python] Re: [Twisted-commits] r13358 - brand as 2.0.0 and	apply my mods from 13320
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42495">[ date ]</a>
              <a href="thread.html#42495">[ thread ]</a>
              <a href="subject.html#42495">[ subject ]</a>
              <a href="author.html#42495">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi everyone,

I'm using twisted in a thread together with wxPython. 
Everything works quite fine, but I'm getting a strange traceback when I exit 
the application.
here's the scenario:

wx runs in the main thread
twisted runs in a secondary thread which is started like:

        _daemon = DaemonLoop(self,self._port)
        _daemon.setDaemon(True)
        _daemon.start()

where Daemonloop is (partial):
class DaemonLoop(threading.Thread,pb.Referenceable):
        def __init__(self, wxEvtHandler, port):
            super(DaemonLoop, self).__init__()
            self.ui = UIProxy(wxEvtHandler)
            self.port=port

        def _error(self,error):
	    if self.ui:
	        self.ui._error(error)
        
        def run(self):
	    # Run reactor
            reactor.run(installSignalHandlers=0)

	def stop(self):
	    reactor.stop()

        def connectionLost(self):
            self.ui.connectionLost()
	    reactor.stop()
            

I stop the application from the main thread using

_daemon.stop() &lt;- should kill the twisted reactor
wx.Exit() &lt;- kills the main thread

The app exits (on linux), but I get this traceback:

Unhandled exception in thread started by &lt;bound method DaemonLoop.__bootstrap 
of &lt;DaemonLoop(Thread-1, stopped daemon)&gt;&gt;
Traceback (most recent call last):
  File &quot;/usr/lib/python2.3/threading.py&quot;, line 451, in __bootstrap
    self.__stop()
  File &quot;/usr/lib/python2.3/threading.py&quot;, line 460, in __stop
    self.__block.notifyAll()
  File &quot;/usr/lib/python2.3/threading.py&quot;, line 256, in notifyAll
    self.notify(len(self.__waiters))
  File &quot;/usr/lib/python2.3/threading.py&quot;, line 238, in notify
    currentThread() # for side-effect
TypeError: 'NoneType' object is not callable


The problem seems to be on windows. There the app doesn't exit all the time, 
just sometimes. On Win the window disappears, but in the process list is 
still the application process.
So this looks to me like there are still non daemon threads around which keep 
the application from exiting.
On a side note: I'm also using the &quot;deferToThread&quot; method for some longer 
running tasks, so it might well be that it's one of those threads causing the 
issue. Is there a way to figure out which thread doesn't die? 
Any pointers are highly appreciated.

Thanks

UC

--
Open Source Solutions 4U, LLC	2570 Fleetwood Drive
Phone:  +1 650 872 2425		San Bruno, CA 94066
Cell:   +1 650 302 2405		United States
Fax:    +1 650 872 2417


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042498.html">[Twisted-Python] RC's of Win32 installers for 2.0.0
</A></li>
	<LI>Next message (by thread): <A HREF="042496.html">[Twisted-Python] Re: [Twisted-commits] r13358 - brand as 2.0.0 and	apply my mods from 13320
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42495">[ date ]</a>
              <a href="thread.html#42495">[ thread ]</a>
              <a href="subject.html#42495">[ subject ]</a>
              <a href="author.html#42495">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
