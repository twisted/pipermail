<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] TCP Packet Size Considerations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20TCP%20Packet%20Size%20Considerations&In-Reply-To=61DA7719C45FD31185280008C733EF6E04AC4CD0%40XCHANGE">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009726.html">
   <LINK REL="Next"  HREF="009727.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] TCP Packet Size Considerations</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20TCP%20Packet%20Size%20Considerations&In-Reply-To=61DA7719C45FD31185280008C733EF6E04AC4CD0%40XCHANGE"
       TITLE="[Twisted-Python] TCP Packet Size Considerations">andrew-twisted at puzzling.org
       </A><BR>
    <I>Wed Mar  9 01:06:47 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009726.html">[Twisted-Python] TCP Packet Size Considerations: Extra Info
</A></li>
        <LI>Next message: <A HREF="009727.html">[Twisted-Python] TCP Packet Size Considerations: Extra Info
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9728">[ date ]</a>
              <a href="thread.html#9728">[ thread ]</a>
              <a href="subject.html#9728">[ subject ]</a>
              <a href="author.html#9728">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Mar 09, 2005 at 04:10:21PM +1100, Grant McDonald wrote:
[...]
&gt;<i> 
</I>&gt;<i> class ServerDataConnection(Protocol):
</I>&gt;<i>     def closeConnection(self):
</I>&gt;<i>         self.transport.loseConnection()
</I>&gt;<i>    
</I>&gt;<i>     def dataReceived(self, data):
</I>&gt;<i>         f = file('received.dat', 'w')
</I>&gt;<i>         f.write(data)
</I>&gt;<i>         f.close()
</I>[...]

On Wed, Mar 09, 2005 at 04:56:19PM +1100, Grant McDonald wrote:
&gt;<i> After adding some code to report the transmission size i can confirm that 16837
</I>&gt;<i> bytes are sent and 8077 bytes are received via the previous code.
</I>
This is because while TCP is a byte-stream, the data can be delivered in
arbitrarily small pieces, depending on things like the MTU.  Your
ServerDataConnection is buggy, in that it only keeps the most recent chunk
received, rather than the full stream.  A better implementation would be:

class ServerDataConnection(Protocol):
    def closeConnection(self):
        self.transport.loseConnection()
 
    def connectionMade(self):
        self.f = file('received.dat', 'w')
   
    def dataReceived(self, data):
        self.f.write(data)
 
    def connectionLost(self):
        f.close()

See also the &quot;Protocol Design&quot; articles linked from <A HREF="http://itamarst.org/.">http://itamarst.org/.</A>

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009726.html">[Twisted-Python] TCP Packet Size Considerations: Extra Info
</A></li>
	<LI>Next message: <A HREF="009727.html">[Twisted-Python] TCP Packet Size Considerations: Extra Info
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9728">[ date ]</a>
              <a href="thread.html#9728">[ thread ]</a>
              <a href="subject.html#9728">[ subject ]</a>
              <a href="author.html#9728">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
