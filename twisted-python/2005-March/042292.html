<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted 2.0 prerelease (close!!)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%202.0%20prerelease%20%28close%21%21%29&In-Reply-To=%3C7bcdefe7917f30a6f202948915bb7ed7%40fuhm.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042285.html">
   <LINK REL="Next"  HREF="042293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted 2.0 prerelease (close!!)</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%202.0%20prerelease%20%28close%21%21%29&In-Reply-To=%3C7bcdefe7917f30a6f202948915bb7ed7%40fuhm.net%3E"
       TITLE="[Twisted-Python] Twisted 2.0 prerelease (close!!)">foom at fuhm.net
       </A><BR>
    <I>Fri Mar 11 09:55:31 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042285.html">[Twisted-Python] Twisted 2.0 prerelease (close!!)
</A></li>
        <LI>Next message (by thread): <A HREF="042293.html">[Twisted-Python] Twisted 2.0 prerelease (close!!)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42292">[ date ]</a>
              <a href="thread.html#42292">[ thread ]</a>
              <a href="subject.html#42292">[ subject ]</a>
              <a href="author.html#42292">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mar 11, 2005, at 3:59 AM, Andrea Arcangeli wrote:
&gt;<i> Thanks for the explanation. I've also got those messages, could you 
</I>&gt;<i> post
</I>&gt;<i> the patch so I can apply it to pyOpenSSL until it's merged? Thanks.
</I>
Here ya go. The last file is actually an unrelated patch that lets you 
pass None as the verify callback instead of using an empty lambda.

James

Index: src/ssl/connection.c
===================================================================
RCS file: /u/cvs/pyopenssl/pyOpenSSL/src/ssl/connection.c,v
retrieving revision 1.28
diff -u -r1.28 connection.c
--- src/ssl/connection.c        6 Aug 2004 10:21:56 -0000       1.28
+++ src/ssl/connection.c        23 Feb 2005 02:42:29 -0000
@@ -756,6 +756,43 @@
      return Py_None;
  }

+static char ssl_Connection_get_shutdown_doc[] = &quot;\n\
+Get shutdown state\n\
+\n\
+Arguments: self - The Connection object\n\
+           args - The Python argument tuple, should be empty\n\
+Returns:   The shutdown state, a bitmask of SENT_SHUTDOWN, 
RECEIVED_SHUTDOWN.\n\
+&quot;;
+static PyObject *
+ssl_Connection_get_shutdown(ssl_ConnectionObj *self, PyObject *args)
+{
+    if (!PyArg_ParseTuple(args, &quot;:get_shutdown&quot;))
+        return NULL;
+
+       return PyInt_FromLong((long)SSL_get_shutdown(self-&gt;ssl));
+}
+
+static char ssl_Connection_set_shutdown_doc[] = &quot;\n\
+Set shutdown state\n\
+\n\
+Arguments: self - The Connection object\n\
+           args - The Python argument tuple, should be\n\
+             shutdown state - bitmask of SENT_SHUTDOWN, 
RECEIVED_SHUTDOWN.\n\
+Returns:   None\n\
+&quot;;
+static PyObject *
+ssl_Connection_set_shutdown(ssl_ConnectionObj *self, PyObject *args)
+{
+    int shutdown;
+
+    if (!PyArg_ParseTuple(args, &quot;i:set_shutdown&quot;, &amp;shutdown))
+        return NULL;
+
+       SSL_set_shutdown(self-&gt;ssl, shutdown);
+    Py_INCREF(Py_None);
+    return Py_None;
+}
+
  static char ssl_Connection_state_string_doc[] = &quot;\n\
  Get a verbose state description\n\
  \n\
@@ -888,6 +925,8 @@
      ADD_METHOD(makefile),
      ADD_METHOD(get_app_data),
      ADD_METHOD(set_app_data),
+    ADD_METHOD(get_shutdown),
+    ADD_METHOD(set_shutdown),
      ADD_METHOD(state_string),
      ADD_METHOD(sock_shutdown),
      ADD_METHOD(get_peer_certificate),
Index: src/ssl/ssl.c
===================================================================
RCS file: /u/cvs/pyopenssl/pyOpenSSL/src/ssl/ssl.c,v
retrieving revision 1.12
diff -u -r1.12 ssl.c
--- src/ssl/ssl.c       10 Aug 2004 21:42:51 -0000      1.12
+++ src/ssl/ssl.c       23 Feb 2005 02:42:30 -0000
@@ -180,6 +180,10 @@
      PyModule_AddIntConstant(module, &quot;OP_NETSCAPE_CA_DN_BUG&quot;, 
SSL_OP_NETSCAPE_CA_DN_BUG);
      PyModule_AddIntConstant(module, 
&quot;OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG&quot;, 
SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG);

+       /* For SSL_set_shutdown */
+    PyModule_AddIntConstant(module, &quot;SENT_SHUTDOWN&quot;, 
SSL_SENT_SHUTDOWN);
+    PyModule_AddIntConstant(module, &quot;RECEIVED_SHUTDOWN&quot;, 
SSL_RECEIVED_SHUTDOWN);
+
      dict = PyModule_GetDict(module);
      if (!init_ssl_context(dict))
          goto error;
Index: src/ssl/context.c
===================================================================
RCS file: /u/cvs/pyopenssl/pyOpenSSL/src/ssl/context.c,v
retrieving revision 1.17
diff -u -r1.17 context.c
--- src/ssl/context.c   6 Aug 2004 10:21:56 -0000       1.17
+++ src/ssl/context.c   23 Feb 2005 02:42:29 -0000
@@ -562,8 +562,8 @@

      if (!PyArg_ParseTuple(args, &quot;iO:set_verify&quot;, &amp;mode, &amp;callback))
          return NULL;
-
-    if (!PyCallable_Check(callback))
+
+    if (callback != Py_None &amp;&amp; !PyCallable_Check(callback))
      {
          PyErr_SetString(PyExc_TypeError, &quot;expected PyCallable&quot;);
          return NULL;
@@ -572,8 +572,11 @@
      Py_DECREF(self-&gt;verify_callback);
      Py_INCREF(callback);
      self-&gt;verify_callback = callback;
-    SSL_CTX_set_verify(self-&gt;ctx, mode, global_verify_callback);
-
+       if (callback == Py_None)
+               SSL_CTX_set_verify(self-&gt;ctx, mode, NULL);
+       else
+               SSL_CTX_set_verify(self-&gt;ctx, mode, 
global_verify_callback);
+
      Py_INCREF(Py_None);
      return Py_None;
  }




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042285.html">[Twisted-Python] Twisted 2.0 prerelease (close!!)
</A></li>
	<LI>Next message (by thread): <A HREF="042293.html">[Twisted-Python] Twisted 2.0 prerelease (close!!)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42292">[ date ]</a>
              <a href="thread.html#42292">[ thread ]</a>
              <a href="subject.html#42292">[ subject ]</a>
              <a href="author.html#42292">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
