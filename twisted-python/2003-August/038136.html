<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] timeout using LivePage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20timeout%20using%20LivePage&In-Reply-To=%3C5A567B3E-D7E8-11D7-8128-000393B98B56%40frii.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="038133.html">
   <LINK REL="Next"  HREF="038141.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] timeout using LivePage</H1>
    <B>Sean Gillies</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20timeout%20using%20LivePage&In-Reply-To=%3C5A567B3E-D7E8-11D7-8128-000393B98B56%40frii.com%3E"
       TITLE="[Twisted-Python] timeout using LivePage">sgillies at frii.com
       </A><BR>
    <I>Tue Aug 26 11:11:37 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="038133.html">[Twisted-Python] timeout using LivePage
</A></li>
        <LI>Next message (by thread): <A HREF="038141.html">Fixed (Re: [Twisted-Python] timeout using LivePage)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38136">[ date ]</a>
              <a href="thread.html#38136">[ thread ]</a>
              <a href="subject.html#38136">[ subject ]</a>
              <a href="author.html#38136">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Monday, August 25, 2003, at 05:45  PM, Donovan Preston wrote:

&gt;<i> On Monday, August 25, 2003, at 1:30 PM, Sean Gillies wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Am very new to Twisted but am quickly finding that I like
</I>&gt;&gt;<i> it.  All my questions and comments involve Twisted 1.0.6
</I>&gt;&gt;<i> in combo with Python 2.3 on OS X.
</I>&gt;<i>
</I>&gt;<i> Great! Always glad to have more users giving me feedback.
</I>&gt;<i>
</I>&gt;<i> If you are going to be using LivePage, you should probably
</I>&gt;<i> track CVS instead of using a release, since LivePage is the
</I>&gt;<i> one major area of woven I am still doing major work on.
</I>&gt;<i>
</I>&gt;<i> First, I want to clarify some terminology. LivePage is designed
</I>&gt;<i> to allow two things:
</I>&gt;<i>
</I>&gt;<i> Client-To-Server Events: A JavaScript event handler in the
</I>&gt;<i> browser is routed to the Twisted server and causes some code
</I>&gt;<i> to run. This uses a channel I am calling the &quot;InputConduit&quot;
</I>&gt;<i>
</I>&gt;<i> Server-To-Client Events: Some event happened on the server
</I>&gt;<i> (For example, new mail arrived, another player entered the room)
</I>&gt;<i> and the server wants to &quot;Push&quot; some new HTML to the client.
</I>&gt;<i> This uses a channel I am calling the &quot;OutputConduit&quot;
</I>&gt;<i>
</I>&gt;&gt;<i> I've run into a problem while making a rough .rpy prototype of
</I>&gt;&gt;<i> a mapping application (ala MapQuest) using the U of Minnesota
</I>&gt;&gt;<i> MapServer's Python interface.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I will need to have server-side handlers for javascript events
</I>&gt;&gt;<i> to allow map zooming, panning, &amp;c and so have been experimenting
</I>&gt;&gt;<i> with LivePage.  I intend that the code should render a map image,
</I>&gt;&gt;<i> and upon clicking the image, we zoom into the map (changing model
</I>&gt;&gt;<i> data), and redraw the map image.  Unfortunately, browsers are
</I>&gt;&gt;<i> unable to load the
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> URL that is generated by my instance of LivePage, and so the map
</I>&gt;&gt;<i> is never redrawn as it should.
</I>&gt;<i>
</I>&gt;<i> There are actually two unrelated issues here. The first is that the
</I>&gt;<i> current implementation of LivePage in the Twisted CVS is geared
</I>&gt;<i> towards the NewReality web client (NewReality is a multiuser text
</I>&gt;<i> environment (game) written in Twisted) and thus the ability for
</I>&gt;<i> the server to send events to the client is pretty important.
</I>&gt;<i> You are connected and logged in using the web client, and
</I>&gt;<i> someone else enters the room -- you want the web browser to
</I>&gt;<i> display a notice about someone entering the room without having
</I>&gt;<i> to refresh the browser manually or set up continual reloading.
</I>&gt;<i>
</I>&gt;<i> The output conduit is implemented in certain browsers (those
</I>&gt;<i> lacking Flash and LiveConnect) by embedding an &lt;iframe&gt;
</I>&gt;<i> tag whose src=&quot;?woven_hookupOutputConduitToThisFrame=1&quot;
</I>&gt;<i> in the page. When the browser attempts to load this iframe, it
</I>&gt;<i> makes a request to the server, and twisted notices that the
</I>&gt;<i> browser &quot;wants to hook up the output conduit to this frame&quot;,
</I>&gt;<i> and *never finishes sending this page to the client*. The
</I>&gt;<i> Twisted server just holds this connection open forever, so
</I>&gt;<i> that it can write data to the client on demand in response
</I>&gt;<i> to events on the server, and this is why it appears your
</I>&gt;<i> browser is unable to load this URL.
</I>&gt;<i>
</I>&gt;<i> Since with your application it sounds like you only want
</I>&gt;<i> client-to-server events, you need to do a little bit of
</I>&gt;<i> hacking to prevent Woven from including the output
</I>&gt;<i> conduit HTML in your pages. This will get easier in future
</I>&gt;<i> releases of Twisted; I just haven't had time to enumerate
</I>&gt;<i> the possible ways people will want to use LivePage and
</I>&gt;<i> come up with an easy way for the programmer to specify
</I>&gt;<i> the features they want.
</I>&gt;<i>
</I>&gt;<i> If you look at the HTML fragment woven includes in your
</I>&gt;<i> page when you specify the view directive &quot;webConduitGlue&quot;
</I>&gt;<i> you will see it includes the following parts:
</I>&gt;<i>
</I>&gt;<i>   &lt;div&gt;
</I>&gt;<i>    &lt;script src=&quot;WebConduit2_js&quot; language=&quot;javascript&quot;&gt;&lt;/script&gt;
</I>&gt;<i>    &lt;iframe src=&quot;input_html&quot;
</I>&gt;<i>         style=&quot;width: 0; height: 0&quot; id=&quot;woven_inputConduit&quot;&gt;&lt;/iframe&gt;
</I>&gt;<i>    &lt;iframe
</I>&gt;<i>         src=&quot;?woven_hookupOutputConduitToThisFrame=1&quot;
</I>&gt;<i>         style=&quot;width: 100%&quot; id=&quot;woven_outputConduit&quot;&gt;&lt;/iframe&gt;
</I>&gt;<i>   &lt;/div&gt;
</I>&gt;<i>
</I>&gt;<i> Simply replace the view=&quot;webConduitGlue&quot; node with the above
</I>&gt;<i> fragment, sans the output conduit frame:
</I>&gt;<i>
</I>&gt;<i>   &lt;div&gt;
</I>&gt;<i>    &lt;script src=&quot;WebConduit2_js&quot; language=&quot;javascript&quot;&gt;&lt;/script&gt;
</I>&gt;<i>    &lt;iframe src=&quot;input_html&quot;
</I>&gt;<i>         style=&quot;width: 0; height: 0&quot; id=&quot;woven_inputConduit&quot;&gt;&lt;/iframe&gt;
</I>&gt;<i>   &lt;/div&gt;
</I>&gt;<i>
</I>&gt;<i> After you have done this, your pages will actually appear to fully
</I>&gt;<i> load and you should feel happier.
</I>&gt;<i>
</I>&gt;&gt;<i> The model data does get changed
</I>&gt;&gt;<i> successfully, and when I manually reload the page, I do see
</I>&gt;&gt;<i> the zoomed map image as I expect.
</I>&gt;<i>
</I>&gt;<i> The second issue is that you are not notifying your models
</I>&gt;<i> properly to tell them that they have changed. When a
</I>&gt;<i> client-to-server event is sent from the browser to the server,
</I>&gt;<i> the current version of Woven only sends the portions of the
</I>&gt;<i> page which have actually changed, not the entire page,
</I>&gt;<i> back to the browser. Again, this is something I would like
</I>&gt;<i> the programmer to be able to control, because sometimes
</I>&gt;<i> the changes are extensive enough that it makes more sense
</I>&gt;<i> to send the entire page back.
</I>&gt;<i>
</I>&gt;<i> Your redirect hack is not a terrible solution, actually. I have
</I>&gt;<i> used it before.
</I>&gt;<i>
</I>&gt;<i> See below for an example of how you can make your current
</I>&gt;<i> controller code notify the model properly.
</I>&gt;<i>
</I>Donovan,

I am now using Twisted from CVS and have made the change to my
template so that the webConduitGlue is not used.  Have also
made the change to my onclick event handler so that
widget.model.notify is called.

So far so good ... the model is being notified and the code in
my custom MapImage widget's setUp medthod is being executed.
I can tell because it is creating new map images in the app's
temporary location and these new images are exactly as I expect.

However, the document is not being rerendered properly: the HTML
returned to my browser is unchanged, the &lt;img /&gt; tag still points
to the old map image location.

FWIW, I'm using Mozilla, Safari, and IE 5 on OS X and see the same
issue with each of these.  Will I need to edit WebConduit2_js?  If
so, can you suggest where I would start?

cheers,
Sean



--
Sean Gillies
sgillies at frii dot com
<A HREF="http://www.frii.com/~sgillies">http://www.frii.com/~sgillies</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="038133.html">[Twisted-Python] timeout using LivePage
</A></li>
	<LI>Next message (by thread): <A HREF="038141.html">Fixed (Re: [Twisted-Python] timeout using LivePage)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38136">[ date ]</a>
              <a href="thread.html#38136">[ thread ]</a>
              <a href="subject.html#38136">[ subject ]</a>
              <a href="author.html#38136">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
