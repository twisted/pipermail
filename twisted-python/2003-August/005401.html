<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Jelly assertion error when running client and server in the same process
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Jelly%20assertion%20error%20when%20running%20client%20and%20server%20in%20the%20same%20process&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005399.html">
   <LINK REL="Next"  HREF="005402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Jelly assertion error when running client and server in the same process</H1>
    <B>Patrik Blommaskog</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Jelly%20assertion%20error%20when%20running%20client%20and%20server%20in%20the%20same%20process&In-Reply-To="
       TITLE="[Twisted-Python] Jelly assertion error when running client and server in the same process">pb_twisted at olga.mine.nu
       </A><BR>
    <I>Tue Aug  5 17:03:28 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="005399.html">[Twisted-Python] Re: Subclassing static.File
</A></li>
        <LI>Next message: <A HREF="005402.html">[Twisted-Python] possible patch for twisted.mail.protocols
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5401">[ date ]</a>
              <a href="thread.html#5401">[ thread ]</a>
              <a href="subject.html#5401">[ subject ]</a>
              <a href="author.html#5401">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a client and a server application communicating using Twisted and PB.
They run fine as separate programs.

When adding some unit tests, I try to run both the server and a client in
the same application, but I get an assertion error as shown below. I don't
really understand enough of what's happening under the Twisted hood to tell
from the message and looking at flavors.py what's causing the problem.

The applications are growing, so I made an attempt to make a minimal example
from scratch to demonstrate the problem. However, I failed to reproduce it
this way. Since stripping down the applications to a bare minimum can take
some time, I would first like to ask the list if anyone can give me an
indication of what could be the problem? Even with my bad etiquette of not
providing an example, someone is likely to have written that assert
statement for a reason.

Traceback (most recent call last):
  File &quot;C:\Python22\Lib\site-packages\twisted\internet\base.py&quot;, line 368,
in runUntilCurrent
    call.func(*call.args, **call.kw)
  File &quot;E:\p\storskogen\src\skogen\common\Core.py&quot;, line 132, in
onActorEntered
    handler(actor)
  File &quot;E:\p\storskogen\src\skogen\server\PlayerPerspective.py&quot;, line 65, in
onActorEntered
    self.remote.callRemote(&quot;addActor&quot;, actor)
  File &quot;C:\Python22\Lib\site-packages\twisted\spread\pb.py&quot;, line 323, in
callRemote
    return self.broker._sendMessage('',self.perspective, self.luid, name,
args, kw)
--- &lt;exception caught here&gt; ---
  File &quot;C:\Python22\Lib\site-packages\twisted\spread\pb.py&quot;, line 788, in
_sendMessage
    netArgs = self.serialize(args, perspective=perspective, method=message)
  File &quot;C:\Python22\Lib\site-packages\twisted\spread\pb.py&quot;, line 742, in
serialize
    return jelly(object, self.security, None, self)
  File &quot;C:\Python22\Lib\site-packages\twisted\spread\jelly.py&quot;, line 845, in
jelly
    return _Jellier(taster, persistentStore, invoker).jelly(object)
  File &quot;C:\Python22\Lib\site-packages\twisted\spread\jelly.py&quot;, line 451, in
jelly
    sxp.append(self.jelly(item))
  File &quot;C:\Python22\Lib\site-packages\twisted\spread\jelly.py&quot;, line 407, in
jelly
    return obj.jellyFor(self)
  File &quot;C:\Python22\Lib\site-packages\twisted\spread\flavors.py&quot;, line 434,
in jellyFor
    assert jellier.invoker is self.broker, &quot;You cannot exchange cached
proxies between brokers.&quot;
exceptions.AssertionError: You cannot exchange cached proxies between
brokers.

FWIW, I can say that the &quot;self.remote.callRemote(&quot;addActor&quot;, actor)&quot; line
belongs to the listener (server) side. Both peers make remote calls to each
other. The listener side has a number of Cacheable's and Cacheable's
containing Cacheable's, while the connecting side only exposes one
Referenceable.


- Patrik




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005399.html">[Twisted-Python] Re: Subclassing static.File
</A></li>
	<LI>Next message: <A HREF="005402.html">[Twisted-Python] possible patch for twisted.mail.protocols
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5401">[ date ]</a>
              <a href="thread.html#5401">[ thread ]</a>
              <a href="subject.html#5401">[ subject ]</a>
              <a href="author.html#5401">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
