<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Encoding patch for twisted.web.microdom.Document
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Encoding%20patch%20for%20twisted.web.microdom.Document&In-Reply-To=1061138187.3747.9.camel%40homebase.frisco.pt">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005562.html">
   <LINK REL="Next"  HREF="005563.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Encoding patch for twisted.web.microdom.Document</H1>
    <B>Cory Dodt</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Encoding%20patch%20for%20twisted.web.microdom.Document&In-Reply-To=1061138187.3747.9.camel%40homebase.frisco.pt"
       TITLE="[Twisted-Python] Encoding patch for twisted.web.microdom.Document">corydodt at yahoo.com
       </A><BR>
    <I>Mon Aug 18 12:14:20 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="005562.html">[Twisted-Python] Encoding patch for twisted.web.microdom.Document
</A></li>
        <LI>Next message: <A HREF="005563.html">[Twisted-Python] Newbie trying to figure out cred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5567">[ date ]</a>
              <a href="thread.html#5567">[ thread ]</a>
              <a href="subject.html#5567">[ subject ]</a>
              <a href="author.html#5567">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Francisco Miguel Cola&#231;o wrote:

&gt;<i>  I have patched that class, in order to make the xml opening as:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>This patch addresses the header without checking the actual character 
encoding of the document, which basically turns inside-out the current 
problem (character encoding can be utf-8 but header doesn't say so).  
Microdom does support utf-8 output, by checking if the strings it 
contains are UnicodeType.  This leaks all over the place, and you would 
get into trouble with your patch if you passed in encoding='utf-8' and 
then provided microdom with an 8-bit string.

There's a few ways to make this less leaky:

- if encoding parameter is something unicodey, make sure self.data is 
UnicodeType anywhere it is written to (i.e. anywhere it appears on the 
left side of an assignment) by raising an exception if it's not
*and*
- make sure you can't change encoding to a non-unicode encoding or pass 
a non-unicode encoding to any methods once the document has nodes

or

- internally convert everything to Unicode even if it is passed in as 
8-bit string, and then use only the encoding parameter to determine how 
writexml should work.

As it happens, there's already a bug open on this issue.  Please sign up 
on roundup and continue discussion of this issue here:

<A HREF="http://twistedmatrix.com/users/roundup.twistd/twisted/issue149">http://twistedmatrix.com/users/roundup.twistd/twisted/issue149</A>

Thanks!  I have already pasted your original email and my reply there.

Cory



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005562.html">[Twisted-Python] Encoding patch for twisted.web.microdom.Document
</A></li>
	<LI>Next message: <A HREF="005563.html">[Twisted-Python] Newbie trying to figure out cred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5567">[ date ]</a>
              <a href="thread.html#5567">[ thread ]</a>
              <a href="subject.html#5567">[ subject ]</a>
              <a href="author.html#5567">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
