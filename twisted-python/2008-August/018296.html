<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Monitoring configuration of twisted calls.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Monitoring%20configuration%20of%20twisted%20calls.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018295.html">
   <LINK REL="Next"  HREF="018297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Monitoring configuration of twisted calls.</H1>
    <B>Steve Lewis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Monitoring%20configuration%20of%20twisted%20calls.&In-Reply-To="
       TITLE="[Twisted-Python] Monitoring configuration of twisted calls.">spiritualmechanic at yahoo.com
       </A><BR>
    <I>Thu Aug 28 13:22:01 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018295.html">[Twisted-Python] Monitoring configuration of twisted calls.
</A></li>
        <LI>Next message: <A HREF="018297.html">[Twisted-Python] Monitoring configuration of twisted calls.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18296">[ date ]</a>
              <a href="thread.html#18296">[ thread ]</a>
              <a href="subject.html#18296">[ subject ]</a>
              <a href="author.html#18296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Okay, that seems to work. One more question:

We've defined a class called XMLRPCWithRemote that subclasses XMLRPC. Some of the methods are local, others with be called using the Proxy. I tried to wrap the function but I'm getting:

exceptions.AttributeError: Deferred instance has no __call__ method


This is the code I have for wrapping:

              def wrapper(*args, **kw):
                        func = self._getProxy(URL[&quot;url&quot;], URL[&quot;user&quot;], URL[&quot;passwd&quot;]).callRemote(remote_method, *args, **kw)
                        result = func(*args, **kw)
                        monitor[functionPath] = True
                                                
                        return result
                        
                    return wrapper

_getProxy is defined thusly:

    def _getProxy(self, url, username=None, password=None):
        log.msg(&quot;Get proxy&quot;)
        return Proxy(url, user=username, password=password, allowNone=True, useDateTime=True)


So it looks like I'm getting a deferred back from the callRemote, so it appears harder to wrap? I think that's what's going on. I'm guessing the local method doesn't require a deferred, so that's why it works.

Is there something obvious I'm missing? I started going down the path of overriding xmlrpc.Proxy or xmlrpc._QueryFactory but I'm not sure that's the simplest way.

Thanks a bunch,
Steve



----- Original Message ----
From: Jean-Paul Calderone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt;
To: Twisted general discussion &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Sent: Thursday, August 28, 2008 4:01:10 PM
Subject: Re: [Twisted-Python] Monitoring configuration of twisted calls.

On Thu, 28 Aug 2008 06:25:40 -0700 (PDT), Steve Lewis &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">spiritualmechanic at yahoo.com</A>&gt; wrote:
&gt;<i>I'm fairly new to twisted, although we are using it in production. What I'd like to do, is have a simple redlight/greenlight method (over XML-RPC) to tell me which methods have been called successfully at least once. The goal of this is not so much performance or uptime, but to just tell me that we are configured correctly.
</I>&gt;<i>
</I>&gt;<i>We're using twisted as a sort of service bus, so we have a decent amount of configuration that needs to be set up.
</I>&gt;<i>
</I>&gt;<i>What I've considered so far:
</I>&gt;<i>
</I>&gt;<i>[snip]
</I>&gt;<i>
</I>&gt;<i>2. Extending/subclassing XMLRPC:
</I>&gt;<i>
</I>&gt;<i>    def _getFunction(self, functionPath):
</I>&gt;<i>        '''
</I>&gt;<i>        Overrides XMLRPC._getFunction to use our simple mapper.
</I>&gt;<i>        '''
</I>&gt;<i>
</I>&gt;<i>        ## attempt default behavior for local methods
</I>&gt;<i>        try:
</I>&gt;<i>            func = XMLRPC._getFunction(self, functionPath)
</I>&gt;<i>            return func
</I>&gt;<i>        except NoSuchFunction:
</I>&gt;<i>            pass
</I>&gt;<i>
</I>&gt;<i>This would work in my head, but in actuality, the call doesn't actually happen here, it just returns the function.
</I>&gt;<i>
</I>
This is probably the best approach.  `_getFunction&#180; should probably be a
public method.  Its docstring directs users to override it, which is rather
in conflict with it being private.

To overcome the problem of the function not actually being called inside
`_getFunction&#180;, you just need to apply a wrapper to the function which is
looked up.  The wrapper can mark the call as successful.  For example:

    def _getFunction(self, functionPath):
        f = XMLRPC._getFunction(self, functionPath)
        def wrapper(*a, **kw):
            result = f(*a, **kw)
            self._monitor[functionPath] = True
            return result
        return wrapper

I'd also recommend filing a ticket to make `_getFunction&#180; public, so that
you don't have to rely on a private hook to make this work.

Jean-Paul

_______________________________________________
Twisted-Python mailing list
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>



      


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018295.html">[Twisted-Python] Monitoring configuration of twisted calls.
</A></li>
	<LI>Next message: <A HREF="018297.html">[Twisted-Python] Monitoring configuration of twisted calls.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18296">[ date ]</a>
              <a href="thread.html#18296">[ thread ]</a>
              <a href="subject.html#18296">[ subject ]</a>
              <a href="author.html#18296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
