<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Failure%20of%0A%20twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc%0A%20under%20pypy2&In-Reply-To=%3CCADzPF4tqz%2BYvP%2B6pDmPv2LKJReXZYcRKy208QDAu%3Dza_tgTEXg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064009.html">
   <LINK REL="Next"  HREF="031552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2</H1>
    <B>Daniel Sutcliffe</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Failure%20of%0A%20twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc%0A%20under%20pypy2&In-Reply-To=%3CCADzPF4tqz%2BYvP%2B6pDmPv2LKJReXZYcRKy208QDAu%3Dza_tgTEXg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2">dansut at gmail.com
       </A><BR>
    <I>Fri Jul 14 17:20:25 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064009.html">[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2
</A></li>
        <LI>Next message (by thread): <A HREF="031552.html">[Twisted-Python] Using Twisted with pytest fixtures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64010">[ date ]</a>
              <a href="thread.html#64010">[ thread ]</a>
              <a href="subject.html#64010">[ subject ]</a>
              <a href="author.html#64010">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Jul 13, 2017 at 4:22 PM, Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt; wrote:
&gt;&gt;&gt;<i> - the FAIL goes away if the .py is not removed from the plugins dir
</I>&gt;&gt;&gt;<i> and it seems to me that the .py removal is not actually required to
</I>&gt;&gt;&gt;<i> strictly test what
</I>&gt;&gt;&gt;<i> twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc
</I>&gt;&gt;&gt;<i> purports to be testing - so that could fix this test
</I>&gt;<i>
</I>&gt;<i> On Thu, Jul 13, 2017 at 10:14 PM Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i> It is totally fine to skip this test on PyPy.  It's testing the ability
</I>&gt;&gt;<i> to interact with a particular feature of the CPython interpreter, which
</I>&gt;&gt;<i> is intentionally absent on PyPy.  Ideally, the implementation would not
</I>&gt;&gt;<i> enumerate that module on PyPy since it isn't going to be importable as a
</I>&gt;&gt;<i> module.
</I>&gt;<i>
</I>&gt;<i> On Fri, Jul 14, 2017 at 2:22 AM, Craig Rodrigues &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rodrigc at crodrigues.org</A>&gt; wrote:
</I>&gt;&gt;<i> OK.  Based on your analysis, and also Glyph's recommendation,
</I>&gt;&gt;<i> I think it is OK for this test to skip if Pypy is used.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can you submit a patch for this test to skip on Pypy?
</I>&gt;&gt;<i> I think you can get things rolling if you do something like:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> (1)  Learn the procedure to submit a patch by reading:
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/trac/wiki/TwistedDevelopment#SubmittingaPatch">https://twistedmatrix.com/trac/wiki/TwistedDevelopment#SubmittingaPatch</A> .
</I>&gt;&gt;<i>       There are a number of steps, but really it is not that bad.
</I>
On Fri, Jul 14, 2017 at 11:47 AM, Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt; wrote:
&gt;<i> Created a ticket to get this ball rolling:
</I>&gt;<i> <A HREF="https://twistedmatrix.com/trac/ticket/9219">https://twistedmatrix.com/trac/ticket/9219</A>
</I>&gt;<i> This will be my second PR, but first for actual code, and have been
</I>&gt;<i> lurking for some while so already have some familiarity with the
</I>&gt;<i> process - let's see how badly I can screw it up though ;)
</I>
PR now exists: <A HREF="https://github.com/twisted/twisted/pull/837">https://github.com/twisted/twisted/pull/837</A>

&gt;&gt;<i> (2)   Submit a patch that does the following:
</I>&gt;&gt;<i>         - modify twisted/test/test_plugin.py so that you:
</I>&gt;&gt;<i>         (a)  import _PYPY from twisted.python.compat
</I>&gt;&gt;<i>         (b) and then do something like:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>          if _PYPY:
</I>&gt;&gt;<i>              test_freshPyReplacesStalePyc.skip = &quot;Does not work on PYPY&quot;
</I>&gt;<i>
</I>&gt;<i> I have an idea for a PR that goes a little bit further than this -
</I>&gt;<i> I'll submit to see if acceptable and if not I'll fall back to this
</I>&gt;<i> approach.
</I>
I ended up just doing the disabling - after playing around with trying
to improve testing in this area I decided that I was getting in over
my experience level and thought the basics was a a better first step.

I will say though, I think there is some mileage in actually changing the
  test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc
to be more of a
  test_plugin.test_freshPyReplacesCached
could remove the need to mess around with the idea of knowing there is
the .pyc (with PY3 legacy required) and dropin.cache involved at all
and making this test more of a 'unit' test.

Then more tests can be created to deal with specific cases, such as
test_lonePycLoads can be created (and skipped more meaningfully for
PyPy2) ... just a thought, and I don't mind doing if it is thought
useful.

Cheers
/dan
-- 
Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064009.html">[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2
</A></li>
	<LI>Next message (by thread): <A HREF="031552.html">[Twisted-Python] Using Twisted with pytest fixtures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64010">[ date ]</a>
              <a href="thread.html#64010">[ thread ]</a>
              <a href="subject.html#64010">[ subject ]</a>
              <a href="author.html#64010">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
