<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Failure%20of%0A%20twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc%0A%20under%20pypy2&In-Reply-To=%3C1499998468.3369087.1040428288.3CEB1C37%40webmail.messagingengine.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064006.html">
   <LINK REL="Next"  HREF="064008.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Failure%20of%0A%20twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc%0A%20under%20pypy2&In-Reply-To=%3C1499998468.3369087.1040428288.3CEB1C37%40webmail.messagingengine.com%3E"
       TITLE="[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Jul 13 20:14:28 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064006.html">[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2
</A></li>
        <LI>Next message (by thread): <A HREF="064008.html">[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64007">[ date ]</a>
              <a href="thread.html#64007">[ thread ]</a>
              <a href="subject.html#64007">[ subject ]</a>
              <a href="author.html#64007">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Thu, Jul 13, 2017, at 04:22 PM, Daniel Sutcliffe wrote:
&gt;<i> &gt; On Thu, Jul 13, 2017 at 5:57 AM, Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; I shall do my best as my intention is to use Twisted in a live
</I>&gt;<i> &gt;&gt; environment with PyPy so it would be great if the project viewed these
</I>&gt;<i> &gt;&gt; builds as required to be clean sometime in the future. This was just
</I>&gt;<i> &gt;&gt; the first ERROR I attacked, it was always my intention to look into
</I>&gt;<i> &gt;&gt; the others too, which I am also seeing.
</I>&gt;<i> 
</I>&gt;<i> On Thu, Jul 13, 2017 at 11:31 AM, Craig Rodrigues
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rodrigc at crodrigues.org</A>&gt; wrote:
</I>&gt;<i> &gt; Thanks for your motivation.
</I>&gt;<i> 
</I>&gt;<i> No problem, this is one of the few ways I can give back to the Twisted
</I>&gt;<i> project that is ultimately helping me achieve my goals;
</I>&gt;<i> besides getting to the bottom of these type of things is a fun
</I>&gt;<i> learning exercise for me :)
</I>&gt;<i> 
</I>&gt;<i> &gt; Please keep going, and share your findings on the mailing list.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Last year, Mark Williams worked on fixing many Twisted unit tests to either
</I>&gt;<i> &gt; pass or skip on Pypy, and even found one issue with Pypy itself (
</I>&gt;<i> &gt; <A HREF="https://bitbucket.org/pypy/pypy/issues/2335/maximum-recursion-depth-exceeded-with">https://bitbucket.org/pypy/pypy/issues/2335/maximum-recursion-depth-exceeded-with</A>
</I>&gt;<i> &gt; ).
</I>&gt;<i> 
</I>&gt;<i> This one is likely to fall on deaf ears in the PyPy project...
</I>&gt;<i> The reason for the ERROR and then FAIL is as I originally thought,
</I>&gt;<i> that __import__() under pypy is not loading .pyc files where the .py
</I>&gt;<i> is missing and:
</I>&gt;<i>   <A HREF="http://doc.pypy.org/en/latest/config/objspace.lonepycfiles.html">http://doc.pypy.org/en/latest/config/objspace.lonepycfiles.html</A>
</I>&gt;<i> tl;dr - they view it as dangerous due to pyc binary variations and
</I>&gt;<i> only allow by build time configuration option.
</I>&gt;<i> 
</I>&gt;<i> So the next question I guess is how to deal with this:
</I>&gt;<i> 
</I>&gt;<i> - presumably my first step is to log a bug in Trac as any change will
</I>&gt;<i> require one, I had only held off from doing this until I was more sure
</I>&gt;<i> of the cause of the issue.
</I>&gt;<i> 
</I>&gt;<i> - the FAIL goes away if the .py is not removed from the plugins dir
</I>&gt;<i> and it seems to me that the .py removal is not actually required to
</I>&gt;<i> strictly test what
</I>&gt;<i> twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc
</I>&gt;<i> purports to be testing - so that could fix this test
</I>&gt;<i> 
</I>&gt;<i> - the fact that the test ERRORs and then carries on and FAILs later in
</I>&gt;<i> a strange fashion is due to the fact twisted.plugin.getCache() simply
</I>&gt;<i> does a log.err() on encountering the odd situation - so maybe this
</I>&gt;<i> could be dealt with better knowing that PyPy does different things
</I>&gt;<i> than CPython here... ?
</I>&gt;<i> 
</I>&gt;<i> Could the more experienced please advise :)
</I>
It is totally fine to skip this test on PyPy.  It's testing the ability
to interact with a particular feature of the CPython interpreter, which
is intentionally absent on PyPy.  Ideally, the implementation would not
enumerate that module on PyPy since it isn't going to be importable as a
module.

In fact, many of the failing tests are for obscure corner cases which
can and should be skipped so that we can declare PyPy a supported
platform, then work on fixing them after the fact :-).

&gt;<i> &gt; If you feel there are improvements or additions to the buildbot jobs using
</I>&gt;<i> &gt; Pypy, please share your thoughts.  The buildbot master.cfg file is at
</I>&gt;<i> &gt; <A HREF="https://github.com/twisted-infra/braid/tree/master/services/buildbot/master">https://github.com/twisted-infra/braid/tree/master/services/buildbot/master</A>
</I>&gt;<i> 
</I>&gt;<i> I have not looked into why buildbot comes up with a different error to
</I>&gt;<i> the one I did on various platforms - fix for my situation and see if
</I>&gt;<i> it fixes the pypy buildbot before investigating?
</I>&gt;<i> 
</I>&gt;<i> The other error that I and the buildbot see on pypy is 12x (always) of
</I>&gt;<i>   Failure: twisted.internet.defer.TimeoutError
</I>&gt;<i> for
</I>&gt;<i>   twisted.protocols.test.test_tls.TLSMemoryBIOTests.test_hugeWrite_TLSv1_1
</I>&gt;<i> which is odd as if I run this test on its own it succeeds every time...
</I>&gt;<i> Thoughts on this appreciated but probably should start a new thread for
</I>&gt;<i> that...
</I>&gt;<i> 
</I>&gt;<i> Cheers
</I>&gt;<i> /dan
</I>&gt;<i> -- 
</I>&gt;<i> Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064006.html">[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2
</A></li>
	<LI>Next message (by thread): <A HREF="064008.html">[Twisted-Python] Failure of twisted.test.test_plugin.DeveloperSetupTests.test_freshPyReplacesStalePyc under pypy2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64007">[ date ]</a>
              <a href="thread.html#64007">[ thread ]</a>
              <a href="subject.html#64007">[ subject ]</a>
              <a href="author.html#64007">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
