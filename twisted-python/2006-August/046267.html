<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] &quot;Injecting&quot; a callWhenRunning when the reactor	is already running?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%22Injecting%22%20a%20callWhenRunning%20when%20the%20reactor%0A%09is%20already%20running%3F&In-Reply-To=%3C44CFB3C9.5000206%40ussonet.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="046272.html">
   <LINK REL="Next"  HREF="046262.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] &quot;Injecting&quot; a callWhenRunning when the reactor	is already running?</H1>
    <B>justind2 at ussonet.net</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%22Injecting%22%20a%20callWhenRunning%20when%20the%20reactor%0A%09is%20already%20running%3F&In-Reply-To=%3C44CFB3C9.5000206%40ussonet.net%3E"
       TITLE="[Twisted-Python] &quot;Injecting&quot; a callWhenRunning when the reactor	is already running?">justind2 at ussonet.net
       </A><BR>
    <I>Tue Aug  1 14:04:25 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="046272.html">[Twisted-Python] logging
</A></li>
        <LI>Next message (by thread): <A HREF="046262.html">[Twisted-Python] Restarting a reactor listener
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46267">[ date ]</a>
              <a href="thread.html#46267">[ thread ]</a>
              <a href="subject.html#46267">[ subject ]</a>
              <a href="author.html#46267">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you very much for the response. Hopefully these pointers will help 
me tie the basics down in my mind. The threading seems to be where I'm 
tripping up the most.

<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:

&gt;<i> On Tue, 01 Aug 2006 12:09:17 -0500, &quot;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justind2 at ussonet.net</A>&quot; 
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justind2 at ussonet.net</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Here is a script I've made and am playing with to try to understand 
</I>&gt;&gt;<i> how things behave in Twisted. I'm using twistedsnmp but I think my 
</I>&gt;&gt;<i> problem here is my understanding of how to use the reactor (or lack 
</I>&gt;&gt;<i> there of).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yeah... I don't know anything about twistedsnmp (it's not actually 
</I>&gt;<i> done by twistedmatrix labs); but I can see a couple of problems.
</I>&gt;<i>
</I>&gt;&gt;<i> I feel like I'm misunderstanding some fundamentals, but I may just be 
</I>&gt;&gt;<i> hard- headed.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Here are some fundamentals I think you might be missing:
</I>&gt;<i>
</I>&gt;<i> - Twisted is not thread safe.  Do not, e.g., call Deferred callbacks 
</I>&gt;<i> or create Deferreds in a thread, call them from methods like 
</I>&gt;<i> dataReceived or connectionLost.  (99% of your problem is here)
</I>&gt;<i> - This goes for pretty much any Twisted-using code as well.  I'm not 
</I>&gt;<i> really sure, not being familiar with twistedsnmp, but I'd bet that 
</I>&gt;<i> AgentProxy is not designed for instantiation or initialization from a 
</I>&gt;<i> thread.
</I>&gt;<i> - It looks like you want callFromThread, not callWhenRunning.
</I>&gt;<i>    - callWhenRunning: 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorCore.html#twisted.internet.interfaces.IReactorCore.callWhenRunning">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorCore.html#twisted.internet.interfaces.IReactorCore.callWhenRunning</A> 
</I>&gt;<i>
</I>&gt;<i>    - callFromThread: 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorThreads.html#twisted.internet.interfaces.IReactorThreads.callFromThread">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorThreads.html#twisted.internet.interfaces.IReactorThreads.callFromThread</A> 
</I>&gt;<i>
</I>&gt;<i> - err.trap raises exceptions, so checking it in an 'if' is 
</I>&gt;<i> nonsensical.  Maybe you want err.check?
</I>&gt;<i>   - trap: 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html#twisted.python.failure.Failure.trap">http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html#twisted.python.failure.Failure.trap</A> 
</I>&gt;<i>
</I>&gt;<i>   - check: 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html#twisted.python.failure.Failure.check">http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html#twisted.python.failure.Failure.check</A> 
</I>&gt;<i>
</I>&gt;<i> - The return value of callWhenRunning is ignored; there's no sense to 
</I>&gt;<i> having return_def return a value.
</I>&gt;<i>
</I>&gt;<i> Some stylistic stuff, too:
</I>&gt;<i>
</I>&gt;<i> - When posting examples to this mailing list, please reduce your 
</I>&gt;<i> example to a minimal runnable example
</I>&gt;<i> - Messages posted here should also generally follow Twisted 
</I>&gt;<i> conventions, unless there is a specific need not to.  For example:
</I>&gt;<i>   - use twisted.python.log, not python's 'logging' module.
</I>&gt;<i>   - use reactor.callInThread and reactor.callFromThread, not Python's 
</I>&gt;<i> 'threading' or 'thread' modules.  These have defined interactions with 
</I>&gt;<i> the reactor, random other threads don't.
</I>&gt;<i>
</I>&gt;<i> In summary: your &quot;working&quot; example works only by accident, and only 
</I>&gt;<i> sometimes.    I'd love to give you a simple answer, but you don't have 
</I>&gt;<i> a specific problem or misunderstanding; I think you've got entirely 
</I>&gt;<i> the wrong idea of how Twisted is running your code.
</I>&gt;<i>
</I>&gt;<i> You probably want to back off from SNMP a little bit and familiarize 
</I>&gt;<i> yourself with more basic applications of the Twisted programming model 
</I>&gt;<i> before trying this again.  This tutorial might be a good place to get 
</I>&gt;<i> started:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html">http://twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html</A> 
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Of course, the O'Reilly book is a pretty good source of documentation 
</I>&gt;<i> too :).
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="046272.html">[Twisted-Python] logging
</A></li>
	<LI>Next message (by thread): <A HREF="046262.html">[Twisted-Python] Restarting a reactor listener
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46267">[ date ]</a>
              <a href="thread.html#46267">[ thread ]</a>
              <a href="subject.html#46267">[ subject ]</a>
              <a href="author.html#46267">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
