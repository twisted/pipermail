<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] logging (was: &quot;Injecting&quot; ...)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20logging%20%28was%3A%20%22Injecting%22%20...%29&In-Reply-To=20060801211943.1717.1193299259.divmod.quotient.11418%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013760.html">
   <LINK REL="Next"  HREF="013763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] logging (was: &quot;Injecting&quot; ...)</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20logging%20%28was%3A%20%22Injecting%22%20...%29&In-Reply-To=20060801211943.1717.1193299259.divmod.quotient.11418%40ohm"
       TITLE="[Twisted-Python] logging (was: &quot;Injecting&quot; ...)">glyph at divmod.com
       </A><BR>
    <I>Tue Aug  1 18:36:29 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="013760.html">[Twisted-Python] logging (was: &quot;Injecting&quot; ...)
</A></li>
        <LI>Next message: <A HREF="013763.html">[Twisted-Python] logging (was: &quot;Injecting&quot; ...)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13761">[ date ]</a>
              <a href="thread.html#13761">[ thread ]</a>
              <a href="subject.html#13761">[ subject ]</a>
              <a href="author.html#13761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 1 Aug 2006 17:19:43 -0400, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:

&gt;&gt;<i>Was I wrong in this assessment?
</I>
&gt;<i>Not necessarily.
</I>
Hmm, my reply wasn't terribly clear.  I was really saying a few different things, all jumbled together.  First of all, just regarding your decision to use the logging module:

You made the correct decision.  If you need the features the logging module provides, you are best off using it, rather than modifying Twisted to do what it does.  I think the logging module serves its intended audience well, although I am not in its intended audience.

This is _especially_ true if your clients are requesting advanced features like log levels, verbosity selection, and a console log viewer.

what Twisted's log module can currently do:

You *CAN* include a 'level' and a 'debug flag' in Twisted log messages if you want.  Feel free to pass them along:

  log.msg(&quot;hi there&quot;, level=7, debug=&quot;banana&quot;)

but that's only because you can pass any other data you like as well.  This will be silently dropped by the default log observer, but you could write a different log observer (even one that invoked the 'logging' module ^_-) which honored your custom log variables.

Now, a bit more about my personal design choices regarding logging:

Logs are stored mainly to be analyzed: without analysis, log messages are just debug spew.  Sadly, despite the fact that it can handle arbitrary events and NOT just text messages, that's most of what the Twisted log module is currently used for: events which you can grep for in a text file if something goes wrong.  That's not really what I want to use it for though.

My preferred method of implementing log analysis is showcased in Mantissa; Allen Short wrote a pretty nice statistics-gathering system which uses the 'log' module to *collect* the statistics, but then stores them in a database, and then provides a DB-backed API for accessing specific statistics nor , not a generic &quot;log analysis&quot; tool which works on flat text files.

  (You can see that here: <A HREF="http://divmod.org/trac/browser/trunk/Mantissa/xmantissa/stats.py">http://divmod.org/trac/browser/trunk/Mantissa/xmantissa/stats.py</A> )

Rather than having a restricted set of data like &quot;level&quot; and &quot;debug&quot;, &quot;log events&quot; in Twisted are really just arbitrary events which can contain equally arbitrary data.  The &quot;_observeStatEvent&quot; method in that module makes use of this feature.

My long-term vision for log events is for every log message in Twisted to eventually go from looking like this:

  log.msg(&quot;did some stuff %s %r&quot; % (a, b))

to looking like this:

  log.msg(interface=IDidSomeStuff,
          format=&quot;did some stuff %(stuff)s %(morestuff)r&quot;,
          stuff=stuff,
          morestuff=morestuff))

Like this, textual observers have a formatting argument that they can use to log the debug message to a file for debugging, and and structured observers which understand the IDidSomeStuff log interface can capture this message and do something more specific with the 'stuff' and 'morestuff' attributes (which are presumably objects that can be manipulated in some other way than simple stringification).

However, logging is a low-priority area of development for Twisted right now, and while  there seems to be at least _rough_ consensus around the features I'm proposing here, the specifics of implementation have been bogged down in details.

There is a lot of grumbling about the current interface.  In particular various people think that formatting should be specified differently, or that the default logfile format needs to be changed to be structured, or that the **kw-dict-as-log-object API is unnecessary micro-optimization and we should use actual providers of the declared interface, or... well, it should suffice to say there are a lot of disagreements.  Nobody wants to commit extensively to an interface which is going to be changed, and hence, nobody wants to do the work to change the existing log messages -- or, even if someone volunteered to do that, nobody wants to be responsible for the _future_ work to make the existing log messages work some _other_ new way.

Despite the fact that we all know it's sub-optimal, everyone can agree that the current 'log.msg as persistent debug print' usage will continue to be supported into the indefinite future, so that's the one that gets used.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013760.html">[Twisted-Python] logging (was: &quot;Injecting&quot; ...)
</A></li>
	<LI>Next message: <A HREF="013763.html">[Twisted-Python] logging (was: &quot;Injecting&quot; ...)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13761">[ date ]</a>
              <a href="thread.html#13761">[ thread ]</a>
              <a href="subject.html#13761">[ subject ]</a>
              <a href="author.html#13761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
