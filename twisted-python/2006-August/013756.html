<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] &quot;Injecting&quot; a callWhenRunning when the reactor	is already running?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20%22Injecting%22%20a%20callWhenRunning%20when%20the%20reactor%0A%09is%20already%20running%3F&In-Reply-To=44CF8ABD.7040404%40ussonet.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013753.html">
   <LINK REL="Next"  HREF="013758.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] &quot;Injecting&quot; a callWhenRunning when the reactor	is already running?</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20%22Injecting%22%20a%20callWhenRunning%20when%20the%20reactor%0A%09is%20already%20running%3F&In-Reply-To=44CF8ABD.7040404%40ussonet.net"
       TITLE="[Twisted-Python] &quot;Injecting&quot; a callWhenRunning when the reactor	is already running?">glyph at divmod.com
       </A><BR>
    <I>Tue Aug  1 14:49:10 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="013753.html">[Twisted-Python] &quot;Injecting&quot; a callWhenRunning when the reactor is	already running?
</A></li>
        <LI>Next message: <A HREF="013758.html">[Twisted-Python] logging (was: &quot;Injecting&quot; ...)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13756">[ date ]</a>
              <a href="thread.html#13756">[ thread ]</a>
              <a href="subject.html#13756">[ subject ]</a>
              <a href="author.html#13756">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 01 Aug 2006 12:09:17 -0500, &quot;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justind2 at ussonet.net</A>&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justind2 at ussonet.net</A>&gt; wrote:
&gt;<i>Here is a script I've made and am playing with to try to understand how 
</I>&gt;<i>things behave in Twisted. I'm using twistedsnmp but I think my problem here 
</I>&gt;<i>is my understanding of how to use the reactor (or lack there of).
</I>
Yeah... I don't know anything about twistedsnmp (it's not actually done by twistedmatrix labs); but I can see a couple of problems.

&gt;<i>I feel like I'm misunderstanding some fundamentals, but I may just be hard- 
</I>&gt;<i>headed.
</I>
Here are some fundamentals I think you might be missing:

 - Twisted is not thread safe.  Do not, e.g., call Deferred callbacks or create Deferreds in a thread, call them from methods like dataReceived or connectionLost.  (99% of your problem is here)
 - This goes for pretty much any Twisted-using code as well.  I'm not really sure, not being familiar with twistedsnmp, but I'd bet that AgentProxy is not designed for instantiation or initialization from a thread.
 - It looks like you want callFromThread, not callWhenRunning.
    - callWhenRunning: <A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorCore.html#twisted.internet.interfaces.IReactorCore.callWhenRunning">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorCore.html#twisted.internet.interfaces.IReactorCore.callWhenRunning</A>
    - callFromThread: <A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorThreads.html#twisted.internet.interfaces.IReactorThreads.callFromThread">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorThreads.html#twisted.internet.interfaces.IReactorThreads.callFromThread</A>
 - err.trap raises exceptions, so checking it in an 'if' is nonsensical.  Maybe you want err.check?
   - trap: <A HREF="http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html#twisted.python.failure.Failure.trap">http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html#twisted.python.failure.Failure.trap</A>
   - check: <A HREF="http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html#twisted.python.failure.Failure.check">http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html#twisted.python.failure.Failure.check</A>
 - The return value of callWhenRunning is ignored; there's no sense to having return_def return a value.

Some stylistic stuff, too:

 - When posting examples to this mailing list, please reduce your example to a minimal runnable example
 - Messages posted here should also generally follow Twisted conventions, unless there is a specific need not to.  For example:
   - use twisted.python.log, not python's 'logging' module.
   - use reactor.callInThread and reactor.callFromThread, not Python's 'threading' or 'thread' modules.  These have defined interactions with the reactor, random other threads don't.

In summary: your &quot;working&quot; example works only by accident, and only sometimes.    I'd love to give you a simple answer, but you don't have a specific problem or misunderstanding; I think you've got entirely the wrong idea of how Twisted is running your code.

You probably want to back off from SNMP a little bit and familiarize yourself with more basic applications of the Twisted programming model before trying this again.  This tutorial might be a good place to get started:

<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html">http://twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html</A>

Of course, the O'Reilly book is a pretty good source of documentation too :).


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013753.html">[Twisted-Python] &quot;Injecting&quot; a callWhenRunning when the reactor is	already running?
</A></li>
	<LI>Next message: <A HREF="013758.html">[Twisted-Python] logging (was: &quot;Injecting&quot; ...)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13756">[ date ]</a>
              <a href="thread.html#13756">[ thread ]</a>
              <a href="subject.html#13756">[ subject ]</a>
              <a href="author.html#13756">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
