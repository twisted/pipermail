<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Direct access to main server class
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Direct%20access%20to%20main%20server%20class&In-Reply-To=%3C20060829030821.1717.849369791.divmod.quotient.33499%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="046414.html">
   <LINK REL="Next"  HREF="046416.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Direct access to main server class</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Direct%20access%20to%20main%20server%20class&In-Reply-To=%3C20060829030821.1717.849369791.divmod.quotient.33499%40ohm%3E"
       TITLE="[Twisted-Python] Direct access to main server class">glyph at divmod.com
       </A><BR>
    <I>Mon Aug 28 21:08:21 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="046414.html">[Twisted-Python] Direct access to main server class
</A></li>
        <LI>Next message (by thread): <A HREF="046416.html">[Twisted-Python] Direct access to main server class
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46415">[ date ]</a>
              <a href="thread.html#46415">[ thread ]</a>
              <a href="subject.html#46415">[ subject ]</a>
              <a href="author.html#46415">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Tue, 29 Aug 2006 02:55:03 +0200, Terry Jones &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">terry at jon.es</A>&gt; wrote:

&gt;<i>It does make me wonder though, still. What if you're writing a Twisted app
</I>&gt;<i>that you intend to license for commercial companies to run on their
</I>&gt;<i>intranets: You install the Python source and presumably the unit test code
</I>&gt;<i>gets run at some point, and maybe remains on the server. Then you're
</I>&gt;<i>showing the world how to access the innards of your service without going
</I>&gt;<i>through the approved authentication. Same comments apply to simply putting
</I>&gt;<i>the code online and letting people see how to get in to any instance they
</I>&gt;<i>can get local (user) access to. What can be done to prevent this? The most
</I>&gt;<i>obvious thing seems to be to verify the uid of the process trying to create
</I>&gt;<i>an authenticated user, and have both your unit tests and twistd run under
</I>&gt;<i>this uid.  If you don't do something about this, a normal user on the
</I>&gt;<i>system can simply import your module, create an instance, and start making
</I>&gt;<i>method calls (possibly unsuccessfully, due to file system permissions on
</I>&gt;<i>databases, etc). Maybe they wont get far, but it's an issue: especially if
</I>&gt;<i>the system has been built to allow this, and the unit tests show precisely
</I>&gt;<i>how to pull it off.
</I>
If your system is so insecure that anyone with some know-how can run arbitrary Python code in it, it is a pretty straightforward step to extract all the source code from the server directly.  Consider this simple Python quine:

    # quine.py
    print file(__file__).read()

If you think you can hide Python code by compiling it to bytecodes, have a look at <A HREF="http://www.crazy-compilers.com/decompyle/">http://www.crazy-compilers.com/decompyle/</A> -- that should quickly disabuse you of that notion.

Moreover, any security scheme that relies, in any way, upon the fact that your code is hidden is broken by design.  From wikipedia: &quot;computer science professors consider security through obscurity so obviously wrong that the matter doesn't need proof or study&quot;.

However, even disregarding that, _some_ code in your system is instantiating authenticated users and calling methods on them.  Assuming that your code is packaged and distributed (tests included, so as to make testing of deployments easier), anyone who can read the tests can read the rest of the code, and discover the same entrypoints.

So, I disagree in the strongest possible terms: it *isn't* an issue, and nobody should ever consider it as such when writing tests.  The correct way to write unit tests is one unit at a time, and it should not be polluted by misguided security concerns.

Apologies if this sounds too harsh.  I'm not just trolling, I promise :).  We have a lot of tests in the Twisted suite which bend over backwards to instantiate things through obtuse higher-than-unit-level interfaces (which often aren't really themselves public), rather than testing functionality directly.  These tests are all overcomplex, error prone, and generally contain race conditions and fail intermittently for unrelated reasons.

It is a systematic problem which we have spent literally years fixing, and we're not done.  JP Calderone, Chris Armstrong and I have almost daily conversations now about how to reduce this coupling and &quot;heal&quot; the Twisted suite so that tests will fail only when they're failing.  In other words, make the tests more &quot;unit-y&quot; and less like integration tests.  The idea you're proposing here seems to be enthusiastically attempting to doom a future project to a worse version of this syndrome :).  Programs like Twisted which interface heavily with the OS are hard enough to write good test for when you're only worrying about legitimate difficulties with the tests... if you start introducing concerns like &quot;maybe we're revealing too much in our test suite&quot; it becomes impossible.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="046414.html">[Twisted-Python] Direct access to main server class
</A></li>
	<LI>Next message (by thread): <A HREF="046416.html">[Twisted-Python] Direct access to main server class
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46415">[ date ]</a>
              <a href="thread.html#46415">[ thread ]</a>
              <a href="subject.html#46415">[ subject ]</a>
              <a href="author.html#46415">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
