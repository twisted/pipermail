<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] spawnProcess under Win32
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20spawnProcess%20under%20Win32&In-Reply-To=44E0906F.4050602%40mekensleep.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013820.html">
   <LINK REL="Next"  HREF="013824.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] spawnProcess under Win32</H1>
    <B>Michael Li</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20spawnProcess%20under%20Win32&In-Reply-To=44E0906F.4050602%40mekensleep.com"
       TITLE="[Twisted-Python] spawnProcess under Win32">mli at deform.com
       </A><BR>
    <I>Mon Aug 14 11:34:48 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="013820.html">[Twisted-Python] spawnProcess under Win32
</A></li>
        <LI>Next message: <A HREF="013824.html">[Twisted-Python] IResource and http.Site()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13818">[ date ]</a>
              <a href="thread.html#13818">[ thread ]</a>
              <a href="subject.html#13818">[ subject ]</a>
              <a href="author.html#13818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've recently fixed a problem in MPI 1.2.1 launching program RemoteShell.
It uses CreateProcessAsUser to spawn a process. The RemoteShell runs
as a service(daemon) and spawn a new process perfectly (without DOS
window). The followings are C-code, it might give you some hint.
 
        if (CreateProcess(
            NULL,
            tCmdLine,
            NULL, NULL, TRUE,
            //DETACHED_PROCESS | IDLE_PRIORITY_CLASS,
            //CREATE_NO_WINDOW | IDLE_PRIORITY_CLASS,
            CREATE_NO_WINDOW | IDLE_PRIORITY_CLASS | 
CREATE_NEW_PROCESS_GROUP,
            //DETACHED_PROCESS | IDLE_PRIORITY_CLASS | 
CREATE_NEW_PROCESS_GROUP,
            //CREATE_NO_WINDOW | IDLE_PRIORITY_CLASS | CREATE_SUSPENDED,
            pEnv,
            NULL,
            &amp;saInfo, &amp;psInfo))

Igor Kravtchenko wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> yes I see your point of view.
</I>&gt;<i> I deliberately passed that Win32 flags since I didn't wanted to get in 
</I>&gt;<i> details
</I>&gt;<i> of what kind of Win32 features we need or not.
</I>&gt;<i> It can indeed potentially breaks Twisted behavior if incorrect flags 
</I>&gt;<i> are passed.
</I>&gt;<i>
</I>&gt;<i> However it's just easier even if less secure.  Otherwise, you have to 
</I>&gt;<i> enumerate
</I>&gt;<i> all kind of features users want and implement them explicitly while 
</I>&gt;<i> having the
</I>&gt;<i> correct code guard to prevent from crash or incorrect behavior.
</I>&gt;<i>
</I>&gt;<i> I don't know about other Win32 developpers.  From my side, I just wanted
</I>&gt;<i> a way to prevent a console to be opened, so might be something like an
</I>&gt;<i> explicit CREATE_NO_CONSOLE flag or such.
</I>&gt;<i>
</I>&gt;<i> Igor.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, 14 Aug 2006 15:15:55 +0200, Igor Kravtchenko 
</I>&gt;&gt;<i> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">igor at mekensleep.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I've looked at the way Twisted creates a process under Win32 and 
</I>&gt;&gt;&gt;<i> I've noticed
</I>&gt;&gt;&gt;<i> that it uses the CreateProcess() function.  The problem is it 
</I>&gt;&gt;&gt;<i> doesn't mention any
</I>&gt;&gt;&gt;<i> creation flags (i.e.: it just passes 0) whereas here, we would need 
</I>&gt;&gt;&gt;<i> to pass
</I>&gt;&gt;&gt;<i> DETACHED_PROCESS to avoid a new console to be created.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I would be interested to know what do you think about this?
</I>&gt;&gt;&gt;<i> Does it seem to you a good idea?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Well, we do have a UNIX-specific argument to spawnProcess (usePTY), 
</I>&gt;&gt;<i> so I don't see why we couldn't have a Win32-specific argument as 
</I>&gt;&gt;<i> well.  However, &quot;win32flags&quot; seems like a pretty vague name, 
</I>&gt;&gt;<i> especially since it could be CreateProcess's dwCreationFlags argument 
</I>&gt;&gt;<i> or STARTUPINFO's dwFlags attribute.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also, depending on context, you might want CREATE_NO_WINDOW or 
</I>&gt;&gt;<i> DETACHED_PROCESS or possibly both.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I believe the right thing to do is to come up with some typical 
</I>&gt;&gt;<i> features of the Windows process environment and support them 
</I>&gt;&gt;<i> explicitly.  I don't believe all the flags you can pass to 
</I>&gt;&gt;<i> CreateProcess are compatible with the way Twisted expects 
</I>&gt;&gt;<i> subprocesses to behave, and I am definitely sure that not all the 
</I>&gt;&gt;<i> things you can put in STARTUPINFO are.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
==========
This email message and any attachments are for the sole use of the intended recipients and may contain proprietary and/or confidential information which may be privileged or otherwise protected from disclosure. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipients, please contact the sender by reply email and destroy the original message and any copies of the message as well as any attachments to the original message.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013820.html">[Twisted-Python] spawnProcess under Win32
</A></li>
	<LI>Next message: <A HREF="013824.html">[Twisted-Python] IResource and http.Site()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13818">[ date ]</a>
              <a href="thread.html#13818">[ thread ]</a>
              <a href="subject.html#13818">[ subject ]</a>
              <a href="author.html#13818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
