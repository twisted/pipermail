<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Reducing memory footprint of twisted app?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Reducing%20memory%20footprint%20of%20twisted%20app%3F&In-Reply-To=%3C20060818050304.GA23698%40steerpike.home.puzzling.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="046355.html">
   <LINK REL="Next"  HREF="046340.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Reducing memory footprint of twisted app?</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Reducing%20memory%20footprint%20of%20twisted%20app%3F&In-Reply-To=%3C20060818050304.GA23698%40steerpike.home.puzzling.org%3E"
       TITLE="[Twisted-Python] Reducing memory footprint of twisted app?">andrew-twisted at puzzling.org
       </A><BR>
    <I>Thu Aug 17 23:03:04 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="046355.html">[Twisted-Python] Reducing memory footprint of twisted app?
</A></li>
        <LI>Next message (by thread): <A HREF="046340.html">[Twisted-Python] will the real dave peticolas please stand up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46356">[ date ]</a>
              <a href="thread.html#46356">[ thread ]</a>
              <a href="subject.html#46356">[ subject ]</a>
              <a href="author.html#46356">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Aug 17, 2006 at 09:37:39PM -0400, jarrod roberson wrote:
&gt;<i> one of the things we did, and saw an approximately 30% REDUCTION in
</I>&gt;<i> memory foot print was add ing __slots__ definations to all he objects
</I>&gt;<i> we were creating in graphs.
</I>&gt;<i> 
</I>&gt;<i> This isn't twisted specific, so it should apply to any python application.
</I>&gt;<i> 
</I>&gt;<i> Granted we have hundreds of thousands of objects in the graph. But it
</I>&gt;<i> did make a noticiable change in the foot print.
</I>
Right, __slots__ can be helpful.

Some more advice that isn't Twisted specific:

It's very helpful to understand which objects are taking up the memory.  If you
know that, not can have a good idea if __slots__  will actually help before you
clutter your code with them, but you can perhaps realise that you shouldn't even
have 100000 simultaneous Request objects when you only have 1000 connections at
the time -- in my experience helping people on IRC, it's quite common that
there's accidentally a reference being kept to every request object (or
similar), thus causing memory leaks despite Python's garbage collection.  Saving
30% of memory on 100000 objects isn't anywhere near as good as saving 99% of
those objects from being needed in the first place!

If you understand what the culprits are, you can also decide that not only are
__slots__ helpful, you can also analyse those objects to figure out if they are
keeping more state than they really need.

And in fact, you can try speculatively adding __slots__ to a type of object as
an indirect way to see if a particular type is a major contributor to your
memory use or not -- if adding __slots__ to Foo doesn't help, there probably
aren't a significant number of instances contributing to the memory use.

Basically, I really strongly think people should *understand* their performance
issues so they can fix them better, rather than just blindly doing the
equivalent of &quot;gcc -O9&quot; and considering it solved.  It depends on the available
time and requirements, of course; if a quick band-aid is all that's needed, then
fair enough.  But I find it usually pays off to throughly understand what you're
fixing.

That said, if you need hundreds of thousands of objects in memory, __slots__ is
one of the simplest ways to improve memory consumption I know of :)

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="046355.html">[Twisted-Python] Reducing memory footprint of twisted app?
</A></li>
	<LI>Next message (by thread): <A HREF="046340.html">[Twisted-Python] will the real dave peticolas please stand up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46356">[ date ]</a>
              <a href="thread.html#46356">[ thread ]</a>
              <a href="subject.html#46356">[ subject ]</a>
              <a href="author.html#46356">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
