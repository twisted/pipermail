<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Direct access to main server class
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Direct%20access%20to%20main%20server%20class&In-Reply-To=17651.21161.513427.346881%40terry.jones.tc">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013904.html">
   <LINK REL="Next"  HREF="013906.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Direct access to main server class</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Direct%20access%20to%20main%20server%20class&In-Reply-To=17651.21161.513427.346881%40terry.jones.tc"
       TITLE="[Twisted-Python] Direct access to main server class">andrew-twisted at puzzling.org
       </A><BR>
    <I>Mon Aug 28 20:29:22 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="013904.html">[Twisted-Python] Direct access to main server class
</A></li>
        <LI>Next message: <A HREF="013906.html">[Twisted-Python] Direct access to main server class
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13905">[ date ]</a>
              <a href="thread.html#13905">[ thread ]</a>
              <a href="subject.html#13905">[ subject ]</a>
              <a href="author.html#13905">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Aug 28, 2006 at 10:31:37PM +0200, Terry Jones wrote:
[...]
&gt;<i> I could configure the unit tests to just use a different setup (different
</I>&gt;<i> DB etc) so it has nothing to do with the server version. That's in fact
</I>&gt;<i> what I used to do. I was mainly asking: now that I've built a nice new
</I>&gt;<i> front door using twisted.cred, how do I convert my existing unit tests to
</I>&gt;<i> all go through the door, changing as little as possible.
</I>
If you do that, they won't be *unit* tests any more, if I'm understanding your
structure correctly.

I'm guessing a significant proportion of your code you want to test, probably
the majority of it, has nothing directly to do with authentication or
permissions.  Also, *unit* tests (as opposed to functional tests or integration
tests or end-to-end tests or whatever other terms you prefer to use) test one
thing at a time, so tests for this code shouldn't also be testing
authentication.  If *every* test has to authenticate, then you're just wasting
effort: the tests run slower, there's more junk to step over in a debugger, and
you gain no extra testing value by testing the exact same thing in 50 (or
500...) different tests.

&gt;<i> &gt;&gt; 1) Fake it. Call directly into my code to make myself an authenticated
</I>&gt;<i> &gt;&gt; user object, and then start passing it in to methods on my own
</I>&gt;<i> &gt;&gt; class. This is ugly though, plus if the service is already running it's
</I>&gt;<i> &gt;&gt; a bad solution because it goes behind the back of twisted and asks for
</I>&gt;<i> &gt;&gt; trouble.
</I>&gt;<i> 
</I>&gt;<i> JP&gt; This actually sounds a little like what I described above.  What makes
</I>&gt;<i> JP&gt; you say it is ugly?  To me, it sounds like organizing your code so that
</I>&gt;<i> JP&gt; you can test it a unit at a time.  The tests which do this are testing
</I>&gt;<i> JP&gt; the behavior of your code when authentication has already succeeded.
</I>&gt;<i> JP&gt; You should also have tests for your authentication code, of course -
</I>&gt;<i> JP&gt; but that's a separate unit.
</I>&gt;<i> 
</I>&gt;<i> It feels ugly in the way that Trial (if I understand it) feels right.
</I>&gt;<i> There's an approved way to access the service, and robust tests should go
</I>&gt;<i> through it. I don't fully believe this - I guess some combination, as you
</I>&gt;<i> suggest, is probably going to be best. It feels ugly because, as I said,
</I>&gt;<i> having built a new front door, I immediately hack my way around it.
</I>
No, it's quite common, and sensible, for tests to go directly to the units (i.e.
objects and methods) they want to test, so that they test precisely what they
should test.

&gt;<i> &gt;&gt; OK, sorry for another typically long posting....
</I>&gt;<i> 
</I>&gt;<i> JP&gt; No problem.  I hope this was of some help.
</I>&gt;<i> 
</I>&gt;<i> Yes, it's great, thanks for answering. I feel like such a babe in the woods
</I>&gt;<i> with Twisted! Part of it, I guess, is only really getting to work on this
</I>&gt;<i> stuff when I'm not doing what I'm actually supposed to be doing.
</I>&gt;<i> 
</I>&gt;<i> Here's one more question, about cred. Given your initial comment and my
</I>&gt;<i> emerging understanding of what goes on, what you call a user object
</I>&gt;<i> (perhaps only because I called it that) is what's elsewhere called an
</I>&gt;<i> avatar. If so, it seems an avatar can be anything at all and that generally
</I>&gt;<i> an avatar is an instance of some class, and that that class has methods
</I>&gt;<i> which the connecting user is allowed to call. I almost want to say &quot;don't
</I>&gt;<i> bother answering, I know I must be right&quot;, but I won't delete this
</I>&gt;<i> paragraph just in case there are any other fundamental comments anyone
</I>&gt;<i> might make.
</I>
&quot;An avatar is a business logic object for a specific user. For POP3, it's a
mailbox, for a first-person-shooter it's the object that interacts with the
game, the actor as it were. Avatars are specific to an application, and each
avatar represents a single user.&quot;
    -- <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/cred.html#auto6">http://twistedmatrix.com/projects/core/documentation/howto/cred.html#auto6</A>

(and also
<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/glossary.html#Avatar,">http://twistedmatrix.com/projects/core/documentation/howto/glossary.html#Avatar,</A>
which says basically the same thing).

So yes, your understanding is correct.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013904.html">[Twisted-Python] Direct access to main server class
</A></li>
	<LI>Next message: <A HREF="013906.html">[Twisted-Python] Direct access to main server class
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13905">[ date ]</a>
              <a href="thread.html#13905">[ thread ]</a>
              <a href="subject.html#13905">[ subject ]</a>
              <a href="author.html#13905">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
