<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Connect to a Perspective Broker from a VB	App(using a python com server) (Pls disrigard previous one)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Connect%20to%20a%20Perspective%20Broker%20from%20a%20VB%0A%09App%28using%20a%20python%20com%20server%29%20%28Pls%20disrigard%20previous%20one%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013856.html">
   <LINK REL="Next"  HREF="013858.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Connect to a Perspective Broker from a VB	App(using a python com server) (Pls disrigard previous one)</H1>
    <B>Herm&#237;nio Miguel Sanches</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Connect%20to%20a%20Perspective%20Broker%20from%20a%20VB%0A%09App%28using%20a%20python%20com%20server%29%20%28Pls%20disrigard%20previous%20one%29&In-Reply-To="
       TITLE="[Twisted-Python] Connect to a Perspective Broker from a VB	App(using a python com server) (Pls disrigard previous one)">hsanches at gmail.com
       </A><BR>
    <I>Wed Aug 23 09:38:11 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="013856.html">[Twisted-Python] Connect to a Twisted Perspective Broker from a VB	application (using a python com server InProc)
</A></li>
        <LI>Next message: <A HREF="013858.html">[Twisted-Python] Connect to a Perspective Broker from a VB	App(using a python com server) (Pls disrigard previous one)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13857">[ date ]</a>
              <a href="thread.html#13857">[ thread ]</a>
              <a href="subject.html#13857">[ subject ]</a>
              <a href="author.html#13857">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Apologies, please disregard the previous email - here is the good one.

I need to connect to a PerspectiveBroker from a VB application.
I did it with a com server in python, which works fine when the com client
is also python code.
All the calls must be synchronous to the com server.
When Calling from VB it works fine every time if the function used from the
com server don't use the reactor.

The problem is that when I call (from the VB com client) the functions that
uses the twisted reactor it performs well the first time but for the the
second time it's called, it stalls. I have to kill the vb executable.
The function from the test code is: testBroker()

Please can you help me to shed some light on this? Should I do it another
way? Bellow is the code that I am using.

Many thanks
Miguel

----------------------------------------------------
The code for the python com client :

import win32com.client
object = win32com.client.Dispatch(&quot;Python.TestServer&quot;)
print object.gettestresult ()
print object.testBroker()
print object.gettestresult ()

----------------------------------------------------
The code for the VB com client:

Private Sub TestComServer()
 Dim y As Object
 Set y = CreateObject(&quot;Python.TestServer&quot;)
 MsgBox y.gettestresult
 MsgBox y.testBroker()
 MsgBox y.gettestresult()
 Set y = Nothing
End Sub
----------------------------------------------------
the code for the python comserver:

#testcom.py
from twisted.spread import pb
from twisted.internet import reactor, defer
from twisted.python import util
import sys
import time
import socket

class HelloWorld:
    _reg_clsid_ = &quot;{7CC9F362-486D-11D1-BB48-0000E838A65F}&quot;
    _reg_desc_ = &quot;Python Test COM Server&quot;
    _reg_progid_ = &quot;Python.TestServer&quot;
    _public_methods_ = ['testBroker','gettestresult']
    def __init__(self):
        self.sText='sText10'
        self.reactorFinished=False
    def get_ip(self):
        addrs = socket.getaddrinfo(socket.gethostname(), None)
        addr = addrs[0]
        IPaddr = addr[4][0]
        return IPaddr #&quot;localhost&quot;

    def get_ip(self):
        return &quot;localhost&quot;

    def get_port(self):
        return 8786

    def DealWithReactor(self):
        now = time.localtime(time.time())
        factory = pb.PBClientFactory()
        reactor.connectTCP(self.get_ip(), self.get_port(), factory)
        d = factory.getRootObject ()
        strt=&quot;hello network &quot;  + ' ' + time.asctime(now)
        d.addCallback(lambda object: object.callRemote(&quot;echo&quot;, strt))
        d.addErrback(lambda reason: 'error: '+str(reason.value ))
        d.addCallback(self.StopReactor)
        reactor.run()

    def StopReactor(self,obj):
        reactor.stop()
        self.reactorFinished=True
        self.sText=str(obj)
        return obj

    def testBroker(self):
        self.reactorFinished=False
        self.DealWithReactor()
        while self.reactorFinished==False:
            pass
        return 'OK testBroker22 self.reactorFinished:' + str(
self.reactorFinished)

    def gettestresult(self):
        return &quot;gettestresult:&quot; + str(self.sText)

if __name__=='__main__':
    import win32com.server.register
    win32com.server.register.UseCommandLine (HelloWorld)
    h=HelloWorld()
    print(h.gettestresult())
    print(h.testBroker())
    print(h.gettestresult())
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20060823/a298c271/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20060823/a298c271/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013856.html">[Twisted-Python] Connect to a Twisted Perspective Broker from a VB	application (using a python com server InProc)
</A></li>
	<LI>Next message: <A HREF="013858.html">[Twisted-Python] Connect to a Perspective Broker from a VB	App(using a python com server) (Pls disrigard previous one)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13857">[ date ]</a>
              <a href="thread.html#13857">[ thread ]</a>
              <a href="subject.html#13857">[ subject ]</a>
              <a href="author.html#13857">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
