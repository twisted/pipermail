<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Process completion not detected on HP-UX (#608)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Process%20completion%20not%20detected%20on%20HP-UX%20%28%23608%29&In-Reply-To=%3C010B4AF8-C58E-49F0-94B1-E9DA7874ECAA%40research.att.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="046287.html">
   <LINK REL="Next"  HREF="046291.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Process completion not detected on HP-UX (#608)</H1>
    <B>Glenn Hochberg</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Process%20completion%20not%20detected%20on%20HP-UX%20%28%23608%29&In-Reply-To=%3C010B4AF8-C58E-49F0-94B1-E9DA7874ECAA%40research.att.com%3E"
       TITLE="[Twisted-Python] Process completion not detected on HP-UX (#608)">gah at research.att.com
       </A><BR>
    <I>Tue Aug  8 10:59:00 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="046287.html">[Twisted-Python] observer patter in twisted?
</A></li>
        <LI>Next message (by thread): <A HREF="046291.html">[Twisted-Python] anyway to get data from a protocol instance?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46290">[ date ]</a>
              <a href="thread.html#46290">[ thread ]</a>
              <a href="subject.html#46290">[ subject ]</a>
              <a href="author.html#46290">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After much staring at the Twisted code and some experimenting, I  
finally discovered the nature of the problem.

The semantics of the select() call on HP-UX with respect to pipes is  
a bit different than the other OS's I have access to (i.e. Linux,  
Solaris, and Mac OS X).
In particular, the &quot;read hack&quot; in process.py does not work, because  
select shows the write-end of a pipe being both readable and writable  
whenever there is data in the pipe and the pipe is not full.  There  
does not appear to be any way to detect when all readers of the pipe  
have closed without actually writing at least one byte to the write- 
end (in which case you get a broken pipe error, as one would expect).

As a temporary workaround, I am doing the following in process.py:

a) detecting hp-ux pipe behavior and setting a global  
brokenHpUxPipeBehavior
b) disabling the read hack if this variable is set
c) in Process.processEnded() I check for the variable and if set,  
send closeConnection to each ProcessWriter in the pipes dict

This seems to do the trick.

I have posted to the comp.unix.hp.hpux newsgroup looking for a way to  
determine if the readers are all gone, but don't know whether one  
will turn up or not.

Anyone have any suggestions on better ways to fix this?

	-Glenn

On Jul 31, 2006, at 4:36 PM, Jean-Paul Calderone wrote:

&gt;<i> On Mon, 31 Jul 2006 15:58:40 -0400, Glenn Hochberg  
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">gah at research.att.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What approach would you recommend in troubleshooting the problem-- 
</I>&gt;&gt;<i> is  there built-in debugging that can be turned on that might give  
</I>&gt;&gt;<i> me  some more detailed information, or do I need to start adding  
</I>&gt;&gt;<i> log or  print statements?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Again, any help would be appreciated.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Run one of the unit tests which fails in debug mode.  For example,
</I>&gt;<i>
</I>&gt;<i>  trial -b twisted.trial.test.test_process.ProcessTestCase.testProcess
</I>&gt;<i>
</I>&gt;<i> If none of the existing unit tests fail, write a new one :)
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="046287.html">[Twisted-Python] observer patter in twisted?
</A></li>
	<LI>Next message (by thread): <A HREF="046291.html">[Twisted-Python] anyway to get data from a protocol instance?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46290">[ date ]</a>
              <a href="thread.html#46290">[ thread ]</a>
              <a href="subject.html#46290">[ subject ]</a>
              <a href="author.html#46290">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
