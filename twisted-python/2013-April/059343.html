<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Speed of twisted on Amazon EC2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Speed%20of%20twisted%20on%20Amazon%20EC2&In-Reply-To=%3CCAMwy1tzzPdt_B9cOyAFeeWTaCMgwdAAX9XJ%2B%3D8LD6q5iMLt2Ng%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059344.html">
   <LINK REL="Next"  HREF="059346.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Speed of twisted on Amazon EC2</H1>
    <B>Tom van Neerijnen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Speed%20of%20twisted%20on%20Amazon%20EC2&In-Reply-To=%3CCAMwy1tzzPdt_B9cOyAFeeWTaCMgwdAAX9XJ%2B%3D8LD6q5iMLt2Ng%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Speed of twisted on Amazon EC2">twisted at tomvn.com
       </A><BR>
    <I>Sun Apr 21 14:24:01 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059344.html">[Twisted-Python] Speed of twisted on Amazon EC2
</A></li>
        <LI>Next message (by thread): <A HREF="059346.html">[Twisted-Python] Speed of twisted on Amazon EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59343">[ date ]</a>
              <a href="thread.html#59343">[ thread ]</a>
              <a href="subject.html#59343">[ subject ]</a>
              <a href="author.html#59343">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tobias

My apologies, I should have included that information.
Before I get into my responses you've alluded to the answer already, which
is to say I should have been running on PyPy in the first place.
Twisted on PyPy is, at least for this really pointless benchmark, faster
than node.

I've re-run my tests using virtualenvs ( I was using Ubuntu packages which
may have been behind the latest releases), taken more care to record the
machine states, added PyPy to the mix and am responding inline with my
answers.

On Sun, Apr 21, 2013 at 1:36 PM, Tobias Oberstein &lt;
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tobias.oberstein at tavendo.de</A>&gt; wrote:

&gt;<i> Tom,
</I>&gt;<i>
</I>&gt;<i> which OS are you running on your EC2 instance? Amazon Linux?
</I>&gt;<i>
</I>I am running two m1.small Ubuntu 12.10 64bit in us-east-1, one for the web
server and the other for the ab.


&gt;<i> Which reactor are you running your Twisted test with? Epoll?
</I>&gt;<i>
</I>Default Linux reactor, so it's Epoll.


&gt;<i> Are you running on CPython or PyPy?
</I>&gt;<i>
</I>I am running on CPython with twisted 13.0.0 installed into a virtualenv,
but please see my results for PyPy below, they're far more impressive.


&gt;<i>
</I>&gt;<i> Can we see you Twisted hello world test app?
</I>&gt;<i>
</I>Sure:
from twisted.web import server, resource
from twisted.internet import reactor

class HelloResource(resource.Resource):
    isLeaf = True

    def render_GET(self, request):
        request.setHeader(&quot;content-type&quot;, &quot;text/plain&quot;)
        return &quot;Hello world!\n&quot;

reactor.listenTCP(8080, server.Site(HelloResource()))
reactor.run()


And for comparison the node code:
var http = require('http');
http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/plain'});
  res.end('Hello world!\n');
}).listen(8080, '0.0.0.0');


As I said you've already answered my question but here are my slightly more
controlled benchmarks from an ab -c 10 -n 100000 (I ran three and used the
average of the last two to ensure a warm JIT).

This time Twisted 13.0.0 in a CPython virtualenv yielded around 700 req/s.
Twisted 13.0.0 in a PyPy virtualenv yielded around 1.6k req/s.
Node 0.6.19 yielded around 1.6k req/s.

And for giggles 3x the concurrency with ab -c 30 -n 100000, which shows
Twisted on PyPy pulling ahead:
Twisted 13.0.0 in a PyPy virtualenv yielded around 2k req/s.
Node 0.6.19 yielded around 1.6k req/s.


&gt;<i> Tobias
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Mit freundlichen Grüßen,
</I>&gt;<i>
</I>&gt;<i> Tobias Oberstein
</I>&gt;<i> Geschäftsführer
</I>&gt;<i>
</I>&gt;<i> +49(0)9131 940 3574
</I>&gt;<i> +49(0)176 23 752 055
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tobias.oberstein at tavendo.de</A>
</I>&gt;<i> Skype: toberstein
</I>&gt;<i> Twitter: @oberstet
</I>&gt;<i> Xing: Tobias Oberstein
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Tavendo GmbH · Am Weihersbach 13 · 91074 Herzogenaurach · Deutschland
</I>&gt;<i> Office / Postanschrift : Waldstrasse 18 · 91054 Erlangen · Deutschland
</I>&gt;<i> +49(+)700 GO TAVENDO · +49(0)700 46 828 36 36 · www.tavendo.de
</I>&gt;<i> Amtsgericht Fürth · HRB 10365 · USt-Id.Nr DE246462916 · Geschäftsführer
</I>&gt;<i> Tobias Oberstein
</I>&gt;<i>
</I>&gt;<i> Von: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] Im Auftrag von Tom van Neerijnen
</I>&gt;<i> Gesendet: Sonntag, 21. April 2013 12:58
</I>&gt;<i> An: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
</I>&gt;<i> Betreff: [Twisted-Python] Speed of twisted on Amazon EC2
</I>&gt;<i>
</I>&gt;<i> Hi all
</I>&gt;<i> I recently wrote a hello world HTTP app in Twisted, Cyclone, node, Go and
</I>&gt;<i> Scala on the Play framework, and used a combination of ab and gattling to
</I>&gt;<i> see how fast each was on an m1.small instance on Amazon EC2. I also tested
</I>&gt;<i> it on bare metal (my laptop:)) but I'll get to that later.
</I>&gt;<i> The code I used for twisted was the web server code sample from the front
</I>&gt;<i> page of twistedmatrix.com with the numberRequests increment dropped and a
</I>&gt;<i> simple &quot;Hello World!&quot; returned instead.
</I>&gt;<i> For cyclone I used the sample code from the cyclone docs with the same
</I>&gt;<i> string being returned.
</I>&gt;<i> Node was the sample from their front page.
</I>&gt;<i> Play and Go I've never worked with before so those were copy pastes from
</I>&gt;<i> various examples on their pages but again same URI and return string as the
</I>&gt;<i> other frameworks.
</I>&gt;<i>
</I>&gt;<i> From one m1.small to another, Go, Play and node were handling about 1.5k
</I>&gt;<i> requests per second while Twisted and Cyclone were only handling 400-500
</I>&gt;<i> requests per second.
</I>&gt;<i> On loopback from the same m1.small I suspect I was starting to load test
</I>&gt;<i> the load testers more than the apps but locally all the frameworks were
</I>&gt;<i> performing similarly.
</I>&gt;<i> Load testing from another machine to my laptop I was seeing far better
</I>&gt;<i> performance from Twisted and Cyclone, both doing closer to 2k requests per
</I>&gt;<i> second. The other frameworks were only a little quicker but again, there's
</I>&gt;<i> a chance the machine running the load tests was the bottle neck.
</I>&gt;<i> These tests were very unscientifically done but I still wasn't expecting
</I>&gt;<i> to see such a big difference between specifically node and Twisted.  500
</I>&gt;<i> req/sec is plenty quick for 90% of what I do and of course I know there's
</I>&gt;<i> so much more to an application than returning hello world but I was
</I>&gt;<i> wondering if I was missing some trick to speed Twisted up to get close to
</I>&gt;<i> the others on EC2.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130421/66683cee/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059344.html">[Twisted-Python] Speed of twisted on Amazon EC2
</A></li>
	<LI>Next message (by thread): <A HREF="059346.html">[Twisted-Python] Speed of twisted on Amazon EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59343">[ date ]</a>
              <a href="thread.html#59343">[ thread ]</a>
              <a href="subject.html#59343">[ subject ]</a>
              <a href="author.html#59343">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
