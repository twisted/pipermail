<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] t.n.c.lookupAddress returns DNSNameError	for	hostnames w/ no A record
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20t.n.c.lookupAddress%20returns%20DNSNameError%0A%09for%09hostnames%20w/%20no%20A%20record&In-Reply-To=%3C20130402120319.24331.1753254230.divmod.xquotient.1%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059235.html">
   <LINK REL="Next"  HREF="059242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] t.n.c.lookupAddress returns DNSNameError	for	hostnames w/ no A record</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20t.n.c.lookupAddress%20returns%20DNSNameError%0A%09for%09hostnames%20w/%20no%20A%20record&In-Reply-To=%3C20130402120319.24331.1753254230.divmod.xquotient.1%40top%3E"
       TITLE="[Twisted-Python] t.n.c.lookupAddress returns DNSNameError	for	hostnames w/ no A record">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Apr  2 06:03:19 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059235.html">[Twisted-Python] t.n.c.lookupAddress returns DNSNameError for	hostnames w/ no A record
</A></li>
        <LI>Next message (by thread): <A HREF="059242.html">[Twisted-Python] t.n.c.lookupAddress returns DNSNameError for hostnames w/ no A record
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59239">[ date ]</a>
              <a href="thread.html#59239">[ thread ]</a>
              <a href="subject.html#59239">[ subject ]</a>
              <a href="author.html#59239">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06:48 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">byrsa at sinkhole.me</A> wrote:
&gt;<i>Hi all,
</I>&gt;<i>
</I>&gt;<i>I saw in previous posts that DNSNameError signifies an 'NXDOMAIN' 
</I>&gt;<i>status
</I>&gt;<i>and DNSServerError signifies 'SERVFAIL'. However, I am getting a
</I>&gt;<i>DNSNameError from twisted.names.client.lookupAddress() when I query a
</I>&gt;<i>hostname that has no A records, but *does have* other records (NS, SOA,
</I>&gt;<i>etc).
</I>&gt;<i>
</I>&gt;<i>An example:
</I>&gt;<i>
</I>&gt;<i>; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; megaupload.com ANY
</I>&gt;<i>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 19402
</I>&gt;<i>;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0
</I>&gt;<i>
</I>&gt;<i>;; QUESTION SECTION:
</I>&gt;<i>;megaupload.com. IN ANY
</I>&gt;<i>
</I>&gt;<i>;; ANSWER SECTION:
</I>&gt;<i>megaupload.com. 21600 IN SOA ns5.cirfu.net. ipr.ic.fbi.gov. 2013022001 
</I>&gt;<i>3600
</I>&gt;<i>900 604800 900
</I>&gt;<i>megaupload.com. 21600 IN NS ns5.cirfu.net.
</I>&gt;<i>megaupload.com. 21600 IN NS ns6.cirfu.net.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>dig is telling me 'status: NOERROR'. Is there an easy way to determine 
</I>&gt;<i>the
</I>&gt;<i>status of a DNS query from a twisted.names.dns.Message ? I checked the
</I>&gt;<i>source and it wasn't readily apparent (to me). In my code I'm checking 
</I>&gt;<i>the
</I>&gt;<i>value of failure.value.__class__.__name__ to determine if an answer is 
</I>&gt;<i>NX
</I>&gt;<i>or SERVFAIL. Seems like there should be a better way... Here's the code 
</I>&gt;<i>if
</I>&gt;<i>anybody wants to take a look:
</I>&gt;<i>
</I>&gt;<i><A HREF="http://paste.ubuntu.com/5669612/">http://paste.ubuntu.com/5669612/</A>
</I>&gt;<i>
</I>&gt;<i>Thanks to the Twisted devs and maintainers for all your hard work!
</I>
Hi byrsa,

The behavior you're describing does sound wrong.  However, I wasn't able 
to reproduce it locally.  Running your example, I get [] for 
megaupload.com, not an error.  Perhaps there is a tricky DNS server 
involved somewhere that is changing the response unexpectedly?  I 
suggest using something like tcpdump or wireshark to take a look at the 
actual traffic and perhaps produce a more deterministic demonstration of 
the problem.

Regarding how you should detect certain errors, though, Failure just 
wraps normal exceptions, so you can use `isinstance` to check for them 
instead of checking by name.  Failure also provides some APIs that wrap 
up isinstance to provide some more commonly useful behavior - see 
Failure.check and Failure.trap.

And regarding determining error from a Message, you can use the rCode 
attribute to get the raw server response code as an integer.  The values 
and their meanings are defined in the DNS RFC and there are symbolic 
constants in twisted.names.dns - eg OK, ENAME, ESERVER, etc.

Hope this helps,
Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059235.html">[Twisted-Python] t.n.c.lookupAddress returns DNSNameError for	hostnames w/ no A record
</A></li>
	<LI>Next message (by thread): <A HREF="059242.html">[Twisted-Python] t.n.c.lookupAddress returns DNSNameError for hostnames w/ no A record
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59239">[ date ]</a>
              <a href="thread.html#59239">[ thread ]</a>
              <a href="subject.html#59239">[ subject ]</a>
              <a href="author.html#59239">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
