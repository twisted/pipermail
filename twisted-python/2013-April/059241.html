<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Current callback best practices
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Current%20callback%20best%20practices&In-Reply-To=%3C9FC6C1DF-7EFB-4BCE-B482-B1EF6BE2DAD7%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059243.html">
   <LINK REL="Next"  HREF="059248.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Current callback best practices</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Current%20callback%20best%20practices&In-Reply-To=%3C9FC6C1DF-7EFB-4BCE-B482-B1EF6BE2DAD7%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Current callback best practices">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Apr  2 08:32:45 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059243.html">[Twisted-Python] Current callback best practices
</A></li>
        <LI>Next message (by thread): <A HREF="059248.html">[Twisted-Python] Current callback best practices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59241">[ date ]</a>
              <a href="thread.html#59241">[ thread ]</a>
              <a href="subject.html#59241">[ subject ]</a>
              <a href="author.html#59241">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Apr 2, 2013, at 3:52 AM, Hynek Schlawack &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">hs at ox.cx</A>&gt; wrote:

&gt;<i> My question can be simplified to: Closures yes or no?
</I>
&quot;As appropriate&quot;.

&gt;<i> They seem *really* handy since they allow to have some data present without handing it through all the time. Eg in my cred checker, I can refer to the user name from the closure instead of passing it around all the time – making the code much cleaner. Also most current examples and callbacks-are-hard-FUD-rebuttals seem to use them.
</I>&gt;<i> 
</I>&gt;<i> OTOH, private methods like `_cbPrintResult` are nicer to test individually.
</I>
Ideally, any private method exists in service of some goal of the public interface.  It's best to test them by exercising the case in the public API which they support, rather than calling them directly.  Before you write any such method, you ought to be able to write a failing test for the public interface which doesn't pass because you haven't written the private method yet :).

If you're writing private methods which need their own extensive internal test coverage, it might be good to consider whether what you're writing really needs to be public functionality.

However, even if you're going to have a private implementation detail complex enough to warrant its own test suite independent of the public feature it's supporting – and it is better to have such a suite than to have an explosion of irrelevant complexity in the tests for the public API - it's best to go with a private class or module than private methods on a public class.  Callback methods like _cbSomethingSomethingResult generally indicate an ad-hoc state machine as part of your class.  Chances are, if you're going down this road, you're missing quite a few states, and the ad-hoc state is smeared out across many poorly-encapsulated attributes.  After all, since it's not a closure, your only place to store any resulting state is 'self'.

The best solution at this point is not to try to test _cbWhatever methods directly, but rather, to spin out all the _cbSetDisconnected and _ebFixUpStuff methods into a dedicated class which has its own &quot;public&quot; interface that can be tested, but which is still private for Twisted's compatibility purposes.  That dedicated class can then have an explicit state machine of its own and will have attributes dedicated to just encapsulating the state that it's tasked with maintaining, instead of a random potpourri of different states from different responsibilities.

So I guess my recommendation would be &quot;closures&quot;, because any time using private methods as callbacks would be better, it seems like something else has gone wrong :).

&gt;<i> If “yes, closures”: Still using cb/eb prefixes? I don’t see them very often in recent examples. What about addBoth handlers?
</I>
If you're using a closure, use a descriptive name.  The 'cb/eb' prefix notation is not particularly illustrative; I often use an english word like 'when'.  whenDisconnected, whenResponseReceived, etc.

The only hard and fast rule is, if you have a closure, don't start its name with an underscore, there's no point to that :).

-g

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130402/d1717425/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059243.html">[Twisted-Python] Current callback best practices
</A></li>
	<LI>Next message (by thread): <A HREF="059248.html">[Twisted-Python] Current callback best practices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59241">[ date ]</a>
              <a href="thread.html#59241">[ thread ]</a>
              <a href="subject.html#59241">[ subject ]</a>
              <a href="author.html#59241">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
