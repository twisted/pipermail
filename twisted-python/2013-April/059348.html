<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.conch.checkers.SSHPublicKeyDatabase	validate signature data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.conch.checkers.SSHPublicKeyDatabase%0A%09validate%20signature%20data&In-Reply-To=%3CCAFycZ9cHs48AsPBtq5jyWtOc9c5q%2Bn72pR6%2BCNMjsH%2BCN16d-Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059352.html">
   <LINK REL="Next"  HREF="059349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.conch.checkers.SSHPublicKeyDatabase	validate signature data</H1>
    <B>Adi Roiban</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.conch.checkers.SSHPublicKeyDatabase%0A%09validate%20signature%20data&In-Reply-To=%3CCAFycZ9cHs48AsPBtq5jyWtOc9c5q%2Bn72pR6%2BCNMjsH%2BCN16d-Q%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] twisted.conch.checkers.SSHPublicKeyDatabase	validate signature data">adi at roiban.ro
       </A><BR>
    <I>Mon Apr 22 03:01:52 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059352.html">[Twisted-Python] question : txdbus and dbus-send
</A></li>
        <LI>Next message (by thread): <A HREF="059349.html">[Twisted-Python] twisted.conch.checkers.SSHPublicKeyDatabase	validate signature data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59348">[ date ]</a>
              <a href="thread.html#59348">[ thread ]</a>
              <a href="subject.html#59348">[ subject ]</a>
              <a href="author.html#59348">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

In RFC 4252 <A HREF="http://www.ietf.org/rfc/rfc4252.txt">http://www.ietf.org/rfc/rfc4252.txt</A> for The Secure Shell (SSH)
Authentication Protocol at section 7. Public Key Authentication Method:
&quot;publickey&quot;

There is the following information about SSH public key signature.

 The value of 'signature' is a signature by the corresponding private
key over the following data, in the following order:

      string    session identifier
      byte      SSH_MSG_USERAUTH_REQUEST
      string    user name
      string    service name
      string    &quot;publickey&quot;
      boolean   TRUE
      string    public key algorithm name
      string    public key to be used for authentication

   When the server receives this message, it MUST check whether the
supplied key is acceptable for authentication, and if so, it MUST
check whether the signature is correct.

The current code check that key is accepted for authentication and it also
verifies if signature is correct.

It does not check that session the format of the signed data, especially if
session identifier from signed data is  the same as the session of the the
current SSH transport  session.

-----

I also found this document describing how ssh public key authentication
works, but it differes from the current conch.ssh userauth.py
implementation... maybe it is for SSH v1
<A HREF="http://www.unixwiz.net/techtips/ssh-agent-forwarding.html#chal">http://www.unixwiz.net/techtips/ssh-agent-forwarding.html#chal</A>

------

Shouldn't twisted.conch.checkers.SSHPublicKeyDatabase also check that
session id from signed data match the one from transport session?

Maybe it does but I am not looking at the right place.

I see that in conch/checkers.py line 167
<A HREF="https://github.com/tomprince/twisted/blob/trunk/twisted/conch/checkers.py#L167">https://github.com/tomprince/twisted/blob/trunk/twisted/conch/checkers.py#L167</A>
there is this check, which once signature is valid  it just returns
avatar_id:

                if pubKey.verify(credentials.signature,
credentials.sigData):
                    return credentials.username

Thanks!

-- 
Adi Roiban
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130422/39a6ba35/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059352.html">[Twisted-Python] question : txdbus and dbus-send
</A></li>
	<LI>Next message (by thread): <A HREF="059349.html">[Twisted-Python] twisted.conch.checkers.SSHPublicKeyDatabase	validate signature data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59348">[ date ]</a>
              <a href="thread.html#59348">[ thread ]</a>
              <a href="subject.html#59348">[ subject ]</a>
              <a href="author.html#59348">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
