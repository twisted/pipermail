<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] hacking on flow
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20hacking%20on%20flow&In-Reply-To=20030410053302.GA6339%40doublegemini.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003518.html">
   <LINK REL="Next"  HREF="003520.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] hacking on flow</H1>
    <B>Philippe Lafoucri&#232;re</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20hacking%20on%20flow&In-Reply-To=20030410053302.GA6339%40doublegemini.com"
       TITLE="[Twisted-Python] hacking on flow">lafou at wanadoo.fr
       </A><BR>
    <I>Thu Apr 10 03:04:59 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003518.html">[Twisted-Python] hacking on flow
</A></li>
        <LI>Next message: <A HREF="003520.html">[Twisted-Python] hacking on flow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3519">[ date ]</a>
              <a href="thread.html#3519">[ thread ]</a>
              <a href="subject.html#3519">[ subject ]</a>
              <a href="author.html#3519">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Clarck

Your post is in a wrong thread...

BTW, how do you test this ? It seems to be good (well written), but I'm
not sure to exactly understand what you wanted to do.

If I sum up (from my point of view) :

Callable  : may be a function bloc that run only once
Iteration : may be a function bloc that loop on something (like a
datasource)
and Yield : hum, what's the point of Yield ?


Anyway, this version if different from the one on your website.

On Thu, 2003-04-10 at 07:33, Clark C. Evans wrote:
&gt;<i> work in progress on my understanding of extrepum's flow... not
</I>&gt;<i> in anyway near perfect
</I>&gt;<i> 
</I>&gt;<i> -------------
</I>&gt;<i> 
</I>&gt;<i> ''' Flow -- async data flows
</I>&gt;<i> 
</I>&gt;<i>     This is a flow module which is used for async data flows, 
</I>&gt;<i>     in particularly those coming from databases where blocking
</I>&gt;<i>     behavior is common.   Implementations will typically use
</I>&gt;<i>     generators (or anything implementing the iterator protocol)
</I>&gt;<i>     for each stage of the flow.
</I>&gt;<i> 
</I>&gt;<i>     Basically, communication within the data flow is carried
</I>&gt;<i>     out using the yield statement.  Besides using 'return' 
</I>&gt;<i>     or throwing a StopIteration exception, there are several
</I>&gt;<i>     items which yield can return:
</I>&gt;<i> 
</I>&gt;<i>        flow.Yield      This (singleton) value should be returned when an
</I>&gt;<i>                        operation would block, it gives other micro-threads
</I>&gt;<i>                        a chance to do their work.
</I>&gt;<i> 
</I>&gt;<i>        flow.Callable   A callable object should be returned when a function
</I>&gt;<i>                        should be executed.  This adds another stage to the
</I>&gt;<i>                        flow. These objects have a 'result' attribute which 
</I>&gt;<i>                        is filled in with the output of the function, or a 
</I>&gt;<i>                        subclass of failure.Failure for exceptions.
</I>&gt;<i> 
</I>&gt;<i>        flow.Iteration  An iterable object, that is, a generator, or array,
</I>&gt;<i>                        or class which implements both next() and __iter__.
</I>&gt;<i>                        These objects, like Callable, have a 'result' 
</I>&gt;<i>                        attribute, but also have a stop attribute which
</I>&gt;<i>                        is true when StopIteration has been thrown.
</I>&gt;<i> 
</I>&gt;<i>        &lt;anything&gt;      Any other return value
</I>&gt;<i>   
</I>&gt;<i> '''
</I>&gt;<i> from twisted.python import failure
</I>&gt;<i> from twisted.python.compat import StopIteration, iter
</I>&gt;<i> 
</I>&gt;<i> class FlowItem:
</I>&gt;<i>     ''' Base class of all flow objects '''
</I>&gt;<i>     def __init__(self):
</I>&gt;<i>         self.result = None
</I>&gt;<i> 
</I>&gt;<i> Yield = FlowItem()  # A special flow item which signals a block
</I>&gt;<i> 
</I>&gt;<i> class Iteration(FlowItem):
</I>&gt;<i>     ''' An iteration object
</I>&gt;<i> 
</I>&gt;<i>         Used for objects which implement __iter__ and next
</I>&gt;<i>         and can be called more than once maintaining state.
</I>&gt;<i>     '''
</I>&gt;<i>     def __init__(self, iterable):
</I>&gt;<i>         FlowItem.__init__(self)
</I>&gt;<i>         self.next    = iter(iterable).next
</I>&gt;<i>         self.stop    = 0
</I>&gt;<i>     def __call__(self):
</I>&gt;<i>         try:
</I>&gt;<i>             self.result = self.next()
</I>&gt;<i>         except StopIteration:
</I>&gt;<i>             self.stop = 1
</I>&gt;<i>             self.result = None
</I>&gt;<i>         except:
</I>&gt;<i>             self.stop = 1
</I>&gt;<i>             self.result = failure.Failure()
</I>&gt;<i>         return self.result
</I>&gt;<i> 
</I>&gt;<i> class Callable(FlowItem):
</I>&gt;<i>     ''' A callable, where the function value is returned '''
</I>&gt;<i>     def __init__(self, func, *args, **kwargs):
</I>&gt;<i>         FlowItem.__init__(self)
</I>&gt;<i>         self.args   = args
</I>&gt;<i>         self.kwargs = kwargs
</I>&gt;<i>         self.func   = func
</I>&gt;<i>     def __call__(self):
</I>&gt;<i>         try:
</I>&gt;<i>             self.result = apply(self.func, self.args, self.kwargs)
</I>&gt;<i>         except:
</I>&gt;<i>             self.result = failure.Failure()
</I>&gt;<i>         return self.result
</I>&gt;<i> 
</I>&gt;<i> class Controller(Iteration):
</I>&gt;<i>       ''' An iteration object that remains on the stack
</I>&gt;<i> 
</I>&gt;<i>           When a Callable or an Iteration return a FlowItem
</I>&gt;<i>           other than Yield, then they are normally replaced
</I>&gt;<i>           by the returned value, so that it's value is returned
</I>&gt;<i>           to the Callable's caller.  In the case of a Controller,
</I>&gt;<i>           this replacement behavior isn't performed.
</I>&gt;<i>       '''
</I>&gt;<i>       pass
</I>&gt;<i> 
</I>&gt;<i> class Flow(object):
</I>&gt;<i>     ''' an flow, call next() until the iterator raises StopIteration '''
</I>&gt;<i>     def __init__(self, controller):
</I>&gt;<i>         self._stack = [controller]
</I>&gt;<i>     def __iter__(self): return self
</I>&gt;<i>     def next(self):
</I>&gt;<i>         while self._stack:
</I>&gt;<i>             head = self._stack.pop()
</I>&gt;<i>             result = head()
</I>&gt;<i>             if isinstance(result, FlowItem):
</I>&gt;<i>                 if result is Yield: 
</I>&gt;<i>                     self._stack.append(head)
</I>&gt;<i>                     return 1
</I>&gt;<i>                 if isinstance(head, Controller):
</I>&gt;<i>                     self._stack.append(head)
</I>&gt;<i>                 self._stack.append(result)
</I>&gt;<i>         raise StopIteration
</I>&gt;<i> 
</I>&gt;<i> class DeferredFlow(object):
</I>&gt;<i>     pass
</I>&gt;<i>     # basically, create a Flow, loop on Flow.next()
</I>&gt;<i>     # for each item in the loop, do a reactor.callLater(0, next)
</I>&gt;<i>     # return the very last value or error via a Deferred
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>-- 
Philippe Lafoucri&#232;re &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">lafou at wanadoo.fr</A>&gt;
InFuzzion



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003518.html">[Twisted-Python] hacking on flow
</A></li>
	<LI>Next message: <A HREF="003520.html">[Twisted-Python] hacking on flow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3519">[ date ]</a>
              <a href="thread.html#3519">[ thread ]</a>
              <a href="subject.html#3519">[ subject ]</a>
              <a href="author.html#3519">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
