<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: hacking on flow
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20hacking%20on%20flow&In-Reply-To=%3C20030410154432.GA8077%40doublegemini.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="036030.html">
   <LINK REL="Next"  HREF="036033.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: hacking on flow</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20hacking%20on%20flow&In-Reply-To=%3C20030410154432.GA8077%40doublegemini.com%3E"
       TITLE="[Twisted-Python] Re: hacking on flow">cce at clarkevans.com
       </A><BR>
    <I>Thu Apr 10 09:44:32 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="036030.html">[Twisted-Python] Re: hacking on flow
</A></li>
        <LI>Next message (by thread): <A HREF="036033.html">[Twisted-Python] Re: Re: hacking on flow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36032">[ date ]</a>
              <a href="thread.html#36032">[ thread ]</a>
              <a href="subject.html#36032">[ subject ]</a>
              <a href="author.html#36032">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Apr 10, 2003 at 11:51:28AM +0200, Philippe Lafoucri&#232;re wrote:
|<i> I had to manage different flows in one application.
</I>|<i> 
</I>|<i> DS1 ----&gt; BLOC1 ---+
</I>|<i>                    |
</I>|<i> DS2 ----&gt; BLOC2 ---+---- BLOC3 -----&gt; DS3
</I>
Right.

|<i> is an exemple of what it could be. Every thing is a bloc. DSx are 
</I>|<i> datasources (there are also blocs). BLOCx are some treatment bloc that 
</I>|<i> operate with their inputs, and provide the result on their outputs.
</I>|<i> 
</I>|<i> this is the algorithm comming with :
</I>|<i> 
</I>|<i> all bloc are &quot;inactive&quot;
</I>|<i> for bloc in blocs:
</I>|<i>     if len(bloc.inputs) is 0:
</I>|<i>         bloc is &quot;active&quot; # it should be a datasource/producer
</I>|<i> 
</I>|<i> gotData(bloc, lines) :
</I>|<i>     for line in lines:
</I>|<i>         fill in connected blocs's inputs with outputs
</I>|<i>         connected blocs are active
</I>|<i>         while connected blocs's inputs are set:
</I>|<i>             wait # I know, this sucks
</I>|<i>     bloc is inactive
</I>|<i> 
</I>|<i> while there are still active blocs  
</I>|<i>     for bloc in blocs
</I>|<i>         if all inputs are available (!= None)
</I>|<i>             bloc.proceed().addCallback(gotData)
</I>
Ok.  So, basically, you have an input queue for each
code block, and when a particular condition on the 
queue is triggered, the code block fires.  For BLOC1,
it'd be any input from DS1, for BLOC2, it'd be input
from DS2.  For BLOC3, it'd be both input from BLOC1
and BLOC2.  

This is interesting.  With the new-improved flow 
(aka extrepum's method), this would be listed as
3 generators... plus 2 built-in generators.

DS1 = flow.QueryIterator(&quot;some query&quot;)
DS2 = flow.QueryIterator(&quot;another query&quot;)

def BLOC1:
    ds1 = flow.Generator( DS1 )
    yield ds1   # think of as ds1.next()
    while ds1.active:
        result = ds1.result   # value of ds1.next()
        //
        // process ds1.result, possibly
        // sending the result to the next
        // stage using:   yield result
        //
        yield ds1

def BLOC2:
    ds2 = flow.Generator( DS2 )
    yield ds2
    while ds2.active:
        result = ds2.result
        //
        // process ds2, calling yield result
        // to pass on value to next stage
        //
        yield ds2

def BLOC3:
    bl1 = flow.Generator(BLOC1())
    bl2 = flow.Generator(BLOC2())
    yield bl1; yield bl2
    while bl1.active and bl2.active:
        // do somethign with bl1.result and bl2.result
        yield bl1; yield bl2

d = flow.DeferredFlow(BLOC3)
d.addBoth(lambda x: print 'done')
reactor.start()

I'll make a test like this for the flow module so that
it's more clear.   This is such a *HUGE* improvement over
what I was doing... thank you _so_ much extrepum.

Best,

;) Clark


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="036030.html">[Twisted-Python] Re: hacking on flow
</A></li>
	<LI>Next message (by thread): <A HREF="036033.html">[Twisted-Python] Re: Re: hacking on flow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36032">[ date ]</a>
              <a href="thread.html#36032">[ thread ]</a>
              <a href="subject.html#36032">[ subject ]</a>
              <a href="author.html#36032">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
