<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: ApplicationService orderization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20ApplicationService%20orderization&In-Reply-To=%3CE542D743-6ADA-11D7-BB99-000A95686CD8%40mastersofbranding.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="036022.html">
   <LINK REL="Next"  HREF="036025.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: ApplicationService orderization</H1>
    <B>Bob Ippolito</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20ApplicationService%20orderization&In-Reply-To=%3CE542D743-6ADA-11D7-BB99-000A95686CD8%40mastersofbranding.com%3E"
       TITLE="[Twisted-Python] Re: ApplicationService orderization">bob at mastersofbranding.com
       </A><BR>
    <I>Wed Apr  9 16:30:41 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="036022.html">[Twisted-Python] Re: ApplicationService orderization
</A></li>
        <LI>Next message (by thread): <A HREF="036025.html">[Twisted-Python] Re: ApplicationService orderization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36042">[ date ]</a>
              <a href="thread.html#36042">[ thread ]</a>
              <a href="subject.html#36042">[ subject ]</a>
              <a href="author.html#36042">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I don't have time for a large reply right now, but....

On Wednesday, Apr 9, 2003, at 17:30 America/New_York, Kevin Turner 
wrote:

&gt;<i> [Recap:  Last night, Bob was complaining that the order that services
</I>&gt;<i> were started and stopped was undefined, saying
</I>&gt;<i>
</I>&gt;<i> Bob&gt; well if you have service A dependent on service B
</I>&gt;<i> Bob&gt; and you don't want service A to actually start service B
</I>&gt;<i> Bob&gt; like let's say you have a database service or something
</I>&gt;<i> Bob&gt; and you have another service that wants to persist stuff using the
</I>&gt;<i> Bob&gt; database service
</I>&gt;<i>
</I>&gt;<i> so he made the order in which services are started defined as the order
</I>&gt;<i> in which they were added to the service collection, and the reverse for
</I>&gt;<i> stopping.]
</I>&gt;<i>
</I>&gt;<i> Bob, I fear this solution is too fragile if your services really depend
</I>&gt;<i> on one another.  While it will work for now when installing services is
</I>&gt;<i> something that happens once in mktap, I fear it'll break down with more
</I>&gt;<i> dynamic service management.  Example::
</I>&gt;<i>
</I>&gt;<i>     application.addService(&quot;dataStore&quot;, StupidStorage())
</I>&gt;<i>     application.addService(&quot;dataMaker&quot;, FooService())
</I>&gt;<i>
</I>&gt;<i>     # ...later, decide we have outgrown StupidStorage:
</I>&gt;<i>     application.removeService(&quot;dataStore&quot;)
</I>&gt;<i>     application.addService(&quot;dataStore&quot;, RealStorage())
</I>
Well nomatter what, unless it uses 
application.getServiceNamed(&quot;dataStore&quot;) everywhere, you just broke 
dataMaker.  If you're changing the storage you have bigger things to 
worry about than this little corner case.  You need to pause/stop 
FooService, export all the data from the existing storage, stop the 
existing storage, start the new storage, import all the data into the 
new storage, change FooService's reference to the new storage, 
resume/start FooService, and cross your fingers.

It is a good feature that services get started and stopped in a 
sensible order, there's no reason they shouldn't.  I didn't want to 
change the implementation to a list because that would've required more 
code to change, and had the capability to break existing stuff because 
there is no API iterate an AbstractServiceCollection (or the bastard 
Application class, which should be one but doesn't mixin IIRC).

&gt;<i>
</I>&gt;<i> With your ordering, the new dataStore will now stop before dataMaker
</I>&gt;<i> does.
</I>&gt;<i>
</I>&gt;<i> Instead of introducing ordering dependencies into the flat top-level
</I>&gt;<i> service namespace, I think the right answer to your problem is to do as
</I>&gt;<i> Chris suggested: Use a hierarchical structure by making dataStore a
</I>&gt;<i> MultiService, and adding any dataMaker services at its children.  That
</I>&gt;<i> way your dataStore can always make sure its children shut down before 
</I>&gt;<i> it
</I>&gt;<i> does.
</I>
That's only an issue if you use persisted Application objects, I don't. 
  What if you want to stop the storage without stopping it's children?  
In some cases, my ApplicationServices only depend on the storage for 
initialization anyways, so it wouldn't make sense to force them to shut 
down when the storage does.

&gt;<i>
</I>&gt;<i> Does this work for you?  If so, I would like to revert your changes
</I>&gt;<i> making Application.services an OrderedDict before the (imminent!)
</I>&gt;<i> release, just because anything that requires a change to the
</I>&gt;<i> persistnceVersion is a big potential spot for trouble.  We have no
</I>&gt;<i> inter-version testing framework at all.
</I>
You can take out the version upgrade if it doesn't work.  I used an 
OrderedDict for that reason, it has the same interface as a normal 
dict..  so no change to the code (other than stopping in reverse order 
of keys, which will still work on a regular dict, and __init__ of 
course) were made.  The upgrade was purely so new services added to old 
application objects would have their start/stop order preserved.

-bob



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="036022.html">[Twisted-Python] Re: ApplicationService orderization
</A></li>
	<LI>Next message (by thread): <A HREF="036025.html">[Twisted-Python] Re: ApplicationService orderization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36042">[ date ]</a>
              <a href="thread.html#36042">[ thread ]</a>
              <a href="subject.html#36042">[ subject ]</a>
              <a href="author.html#36042">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
