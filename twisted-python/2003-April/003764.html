<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adapi.Connection._runQuery always does rollback()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adapi.Connection._runQuery%20always%20does%20rollback%28%29&In-Reply-To=20030426140722.GE26530%40frobozz.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003763.html">
   <LINK REL="Next"  HREF="003765.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adapi.Connection._runQuery always does rollback()</H1>
    <B>Eric C. Newton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adapi.Connection._runQuery%20always%20does%20rollback%28%29&In-Reply-To=20030426140722.GE26530%40frobozz.local"
       TITLE="[Twisted-Python] adapi.Connection._runQuery always does rollback()">ecn at metaslash.com
       </A><BR>
    <I>Sat Apr 26 12:12:08 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003763.html">[Twisted-Python] adapi.Connection._runQuery always does rollback()
</A></li>
        <LI>Next message: <A HREF="003765.html">[Twisted-Python] adapi.Connection._runQuery always does rollback()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3764">[ date ]</a>
              <a href="thread.html#3764">[ thread ]</a>
              <a href="subject.html#3764">[ subject ]</a>
              <a href="author.html#3764">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sure, that's a theory.  And, yay, verily, MySQL isn't known for it's
strict adherance to standards.  However:

   <A HREF="http://www.python.org/topics/database/DatabaseAPI-2.0.html#connection">http://www.python.org/topics/database/DatabaseAPI-2.0.html#connection</A>

Says

 rollback()
    This method is optional since not all databases provide 
    transaction support.[3]

And footnote 3 sayeth:

    3 If the database does not support the functionality required by
    the method, the interface should throw an exception in case the
    method is used.

    The preferred approach is to not implement the method and thus
    have Python generate an AttributeError in case the method is
    requested. This allows the programmer to check for database
    capabilities using the standard hasattr() function.

    For some dynamically configured interfaces it may not be
    appropriate to require dynamically making the method
    available. These interfaces should then raise a NotSupportedError
    to indicate the non-ability to perform the roll back when the
    method is invoked.

Further, a rollback trashes a whole transaction.  The query could be
part of a larger transaction which includes update operations.
Granted, this is just silly in the async thread-pool, but that's why I
found it rather surprising.

-Eric

On Sun, Apr 27, 2003 at 12:07:22AM +1000, Andrew Bennetts wrote:
&gt;<i> On Sat, Apr 26, 2003 at 09:55:46AM -0400, Eric C. Newton wrote:
</I>&gt;<i> &gt; RedHat 9.0 on intel
</I>&gt;<i> &gt; Twisted 1.0.4
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In twisted.enterprise.adbapi we find this method of ConnectionPool:
</I>&gt;<i> 
</I>&gt;<i> [snip -- runQuery always does a rollback]
</I>&gt;<i> 
</I>&gt;<i> The theory here, I believe is that queries are meant to have no side-effects
</I>&gt;<i> on the DB, so the rollback is done to guarantee this.  If you *do* want to
</I>&gt;<i> change the state of the DB, use runOperation.
</I>&gt;<i> 
</I>&gt;<i> &gt; PS. This buglet brought to you by MySQL which does not support rollback(), 
</I>&gt;<i> &gt;     and tells you with an exception.
</I>&gt;<i> 
</I>&gt;<i> Then the database module you are using doesn't adhere to DB-API 2.0[1], which
</I>&gt;<i> adbapi requires.
</I>&gt;<i> 
</I>&gt;<i> -Andrew.
</I>&gt;<i> 
</I>&gt;<i> [1]  <A HREF="http://www.python.org/topics/database/DatabaseAPI-2.0.html">http://www.python.org/topics/database/DatabaseAPI-2.0.html</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003763.html">[Twisted-Python] adapi.Connection._runQuery always does rollback()
</A></li>
	<LI>Next message: <A HREF="003765.html">[Twisted-Python] adapi.Connection._runQuery always does rollback()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3764">[ date ]</a>
              <a href="thread.html#3764">[ thread ]</a>
              <a href="subject.html#3764">[ subject ]</a>
              <a href="author.html#3764">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
