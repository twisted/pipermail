<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Multiple simultaneous SelectReactors?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20simultaneous%20SelectReactors%3F&In-Reply-To=%3C777E9878-6EE6-11D7-8B81-000393C9700E%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="036084.html">
   <LINK REL="Next"  HREF="036087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Multiple simultaneous SelectReactors?</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20simultaneous%20SelectReactors%3F&In-Reply-To=%3C777E9878-6EE6-11D7-8B81-000393C9700E%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Multiple simultaneous SelectReactors?">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Apr 14 20:03:35 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="036084.html">[Twisted-Python] Multiple simultaneous SelectReactors?
</A></li>
        <LI>Next message (by thread): <A HREF="036087.html">[Twisted-Python] errno handling in udp.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36086">[ date ]</a>
              <a href="thread.html#36086">[ thread ]</a>
              <a href="subject.html#36086">[ subject ]</a>
              <a href="author.html#36086">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Monday, April 14, 2003, at 08:36 PM, Peter Hansen wrote:

&gt;<i> There appear to be serious problems in several areas of 
</I>&gt;<i> twisted.internet
</I>&gt;<i> if one tries to create multiple SelectReactors to use at the same time.
</I>
That would be putting it mildly.

&gt;<i> Why would one want to?  For acceptance testing, when it can be 
</I>&gt;<i> desirable
</I>&gt;<i> that the code under test run in the same process as the test code, but
</I>&gt;<i> it's not appropriate to share the Reactor.
</I>
I'm aware of this use-case, but it was difficult to write for a variety 
of reasons.  History plays a large role in Twisted's, um, history.  We 
try very hard to support backwards compatibility for many versions, so 
that early adopters do not get burned by quicksand interfaces, and 
sometimes a bit of ugliness results.  This is one of those cases.

As someone new to Twisted, your time would probably be better spent 
coding your acceptance tests to use spawnProcess and actually invoking 
different Python processes for the different components.  It's 
relatively easy to communicate between them once this is done.

&gt;<i> 1. Is Twisted expected to support this in principle, if not currently
</I>&gt;<i> in practice?
</I>
Yes.  If you read the CVS logs, you'll notice a trend that more things 
these days take a &quot;reactor&quot; argument than they used to.  We have been 
slowly refactoring towards this for a while.

&gt;<i> 2. Are the globals &quot;reads&quot; and &quot;writes&quot; that are used in
</I>&gt;<i> twisted.internet.default there solely for optimization purposes, or is
</I>&gt;<i> there some more nefarious purpose?  Is it considered absolutely 
</I>&gt;<i> critical
</I>&gt;<i> that this optimization is in place?  (If so, it probably makes it
</I>&gt;<i> impossible to fix this limitation of Twisted.)
</I>
I would prefer that this optimization remain in place (changes to code 
this far down into the core is a severe problem), but it wasn't 
originally an optimization.  It's present there as a 
backwards-compatibility hack for twisted.internet.main, which is so 
deprecated that you will get sick and die if you even look at it.  It 
can probably be changed at this point.

&gt;<i> 3. Is it well-known that the abstract.FileDescriptor class does a quiet
</I>&gt;<i> little fallback to the global reactor if you don't pass it a reactor 
</I>&gt;<i> reference,
</I>&gt;<i> and that Port fails to pass in its own reactor reference when it 
</I>&gt;<i> creates
</I>&gt;<i> a Server object in doRead()?
</I>
Yes.  Trust me, this was the best compromise at the time :-).

&gt;<i> We've strung together a variety of little changes in the process of
</I>&gt;<i> figuring this out.  Once we're more confident of what we're doing,
</I>&gt;<i> I'd be happy to supply the fixes, but I'm not going to waste my time
</I>&gt;<i> if everyone thinks SelectReactor.doSelect() absolutely must do those
</I>&gt;<i> optimizations.
</I>
I would be happier with a simple subclass that was 
slightly-slower-but-multiple-reactor-capable.  However, if you were to 
supply a patch that actually caught all these nuances and fixed them in 
a sensible way, I seriously doubt I would turn it down if you undid a 
tiny (and dubious) optimization :).

&gt;<i> Also note: I'm working on the most recent released version, not CVS.
</I>&gt;<i> The slightest hint that this stuff is significantly changed in CVS
</I>&gt;<i> will send me there, but until now we weren't confident enough with
</I>&gt;<i> Twisted to work from unreleased code.  (Actually, attempting to
</I>&gt;<i> resolve this has slightly lowered my confidence in Twisted, but
</I>&gt;<i> only just a bit.)
</I>
The unreleased code doesn't fix this in particular, but it does include 
a LOT of bug fixes.  We are currently struggling to get a release out, 
thanks to the heroic efforts of Kevin Turner.  Hopefully it won't be 
much longer now :).
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (Darwin)

iD8DBQE+m2h8vVGR4uSOE2wRAhFTAKCjmEHVoQI1hAGZHXq7Y9DHlPSzFACeMOh6
bmy8goeb0OEsB/1b12qBz80=
=6aR2
-----END PGP SIGNATURE-----



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="036084.html">[Twisted-Python] Multiple simultaneous SelectReactors?
</A></li>
	<LI>Next message (by thread): <A HREF="036087.html">[Twisted-Python] errno handling in udp.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36086">[ date ]</a>
              <a href="thread.html#36086">[ thread ]</a>
              <a href="subject.html#36086">[ subject ]</a>
              <a href="author.html#36086">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
