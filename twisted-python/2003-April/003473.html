<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] enterprise.row
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20enterprise.row&In-Reply-To=1049701477.6953.383.camel%40qutang.gnubian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003471.html">
   <LINK REL="Next"  HREF="003477.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] enterprise.row</H1>
    <B>Dave Peticolas</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20enterprise.row&In-Reply-To=1049701477.6953.383.camel%40qutang.gnubian.org"
       TITLE="[Twisted-Python] enterprise.row">dave at krondo.com
       </A><BR>
    <I>Mon Apr  7 04:42:08 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003471.html">[Twisted-Python] enterprise.row
</A></li>
        <LI>Next message: <A HREF="003477.html">[Twisted-Python] enterprise.row
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3473">[ date ]</a>
              <a href="thread.html#3473">[ thread ]</a>
              <a href="subject.html#3473">[ subject ]</a>
              <a href="author.html#3473">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2003-04-07 at 00:44, Justin Ryan wrote:
&gt;<i> &gt; What I have done with postgres is to generate the primay key using
</I>&gt;<i> &gt; the nextval function on the sequence used for the serial column, setting
</I>&gt;<i> &gt; the row object's primary key, and then inserting it. This makes the t.e
</I>&gt;<i> &gt; code happy and you often need to know the new key anyway.
</I>&gt;<i> 
</I>&gt;<i> Could you post the code that does this, or a simple example of how you
</I>&gt;<i> are doing it?
</I>
One strategy I used was to subclass SQLReflector for postgres
databases like so:

class PGSQLReflector(SQLReflector):

    def newRow(self, row_class, template=None):
        return self.runInteraction(self._newRow, row_class, template)

    def _newRow(self, transaction, row_class, template=None):
        row = row_class()

        if template is not None:
            for column, _ in row_class.rowColumns:
                if (hasattr(template, column) and
                    not getKeyColumn(row_class, column)):
                    setattr(row, column, getattr(template, column))

        for key, _ in row_class.rowKeyColumns:
            sql = &quot;SELECT NEXTVAL('%s');&quot; % row_class.keyGenerators[key]
            transaction.execute(sql)
            val = transaction.fetchone()[0]
            row.assignKeyAttr(key, long(val))

        return row

This requires that you specify the names of the sequences used
to generate the keys in the row class. Obviously this code isn't
very general, since it assumes keys will always be generated by 
sequences.

For your extensions which allow defaults, it might be better
to insert the row and then use the 'lastval' function to find
out what key was assigned to the row.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030407/f1d0b846/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030407/f1d0b846/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003471.html">[Twisted-Python] enterprise.row
</A></li>
	<LI>Next message: <A HREF="003477.html">[Twisted-Python] enterprise.row
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3473">[ date ]</a>
              <a href="thread.html#3473">[ thread ]</a>
              <a href="subject.html#3473">[ subject ]</a>
              <a href="author.html#3473">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
