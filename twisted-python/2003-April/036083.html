<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Forcing adapter re-registration (patch)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Forcing%20adapter%20re-registration%20%28patch%29&In-Reply-To=%3C20030415110038.GH27721%40mumak.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="036087.html">
   <LINK REL="Next"  HREF="036085.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Forcing adapter re-registration (patch)</H1>
    <B>jml at ids.org.au</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Forcing%20adapter%20re-registration%20%28patch%29&In-Reply-To=%3C20030415110038.GH27721%40mumak.net%3E"
       TITLE="[Twisted-Python] Forcing adapter re-registration (patch)">jml at ids.org.au
       </A><BR>
    <I>Tue Apr 15 05:00:38 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="036087.html">[Twisted-Python] errno handling in udp.py
</A></li>
        <LI>Next message (by thread): <A HREF="036085.html">[Twisted-Python] Forcing adapter re-registration (patch)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36083">[ date ]</a>
              <a href="thread.html#36083">[ thread ]</a>
              <a href="subject.html#36083">[ subject ]</a>
              <a href="author.html#36083">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Woven code uses registerAdapter alot. When developing Woven code, it's
extremely handy to have a couple of 'rebuild' calls in your RPY. (If these
aren't there, the web server must be restarted for code canges to take effect)

However, registerAdapter and rebuild don't play nicely together. On a rebuild,
registerAdapter tries to re-register stuff, and throws an exception. 

Below is a patch that adds an optional keyword parameter 'force' to the
registerAdapter method. If force is set to a true value, registerAdapter should
happily re-register stuff. Otherwise, the current behaviour holds.

The tests work, and I'll quite happily commit if no-one has any problems.

cheers,
jml

===================================================================
RCS file: /cvs/Twisted/twisted/test/test_components.py,v
diff -u -r1.26 components.py
--- twisted/python/components.py        5 Apr 2003 00:28:37 -0000       1.26
+++ twisted/python/components.py        15 Apr 2003 00:32:30 -0000
@@ -115,7 +115,8 @@
         # mapping between (&lt;class&gt;, &lt;interface&gt;) and &lt;adapter class&gt;
         self.adapterRegistry = {}

-    def registerAdapter(self, adapterClass, origClass, *interfaceClasses):
+    def registerAdapter(self, adapterClass, origClass, *interfaceClasses,
+                        **kwarg):
         &quot;&quot;&quot;Register an adapter class.

         An adapter class is expected to implement the given interface, by
@@ -124,7 +125,8 @@
         &quot;&quot;&quot;
         assert interfaceClasses, &quot;You need to pass an Interface&quot;
         for interfaceClass in interfaceClasses:
-            if self.adapterRegistry.has_key((origClass, interfaceClass)):
+            if (self.adapterRegistry.has_key((origClass, interfaceClass))
+                and not kwarg.get('force')):
                 raise ValueError(
                     &quot;an adapter (%s) was already registered.&quot; % (
                         self.adapterRegistry[(origClass, interfaceClass)]


===================================================================
RCS file: /cvs/Twisted/twisted/test/test_components.py,v
retrieving revision 1.8
diff -u -r1.8 test_components.py
--- twisted/test/test_components.py     5 Jan 2003 02:39:22 -0000       1.8
+++ twisted/test/test_components.py     15 Apr 2003 00:39:11 -0000
@@ -284,3 +284,13 @@

         # should fail because we already registered an IMultiply adapter for IntAdder
         self.assertRaises(ValueError, components.registerAdapter, IntMultiplyWithAdder, IntAdder, IMultiply)
+
+    def testForcedRegister(self):
+        # should not fail, despite re-registering, because we are forcing
+        # it to re-register.
+        try:
+            components.registerAdapter(IntMultiplyWithAdder, IntAdder, IMultiply, force=1)
+        except ValueError:
+            self.fail(&quot;Should have forced re-registration&quot;)
+
+
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20030415/167ce612/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="036087.html">[Twisted-Python] errno handling in udp.py
</A></li>
	<LI>Next message (by thread): <A HREF="036085.html">[Twisted-Python] Forcing adapter re-registration (patch)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36083">[ date ]</a>
              <a href="thread.html#36083">[ thread ]</a>
              <a href="subject.html#36083">[ subject ]</a>
              <a href="author.html#36083">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
