<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Bloat (was Re: [Twisted-commits] DependentMultiService - chained start/stop of services in a sensible order)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Bloat%20%28was%20Re%3A%20%5BTwisted-commits%5D%20DependentMultiService%20-%20chained%20start/stop%20of%20services%20in%20a%20sensible%20order%29&In-Reply-To=9077504A-6E10-11D7-8B81-000393C9700E%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003556.html">
   <LINK REL="Next"  HREF="003564.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Bloat (was Re: [Twisted-commits] DependentMultiService - chained start/stop of services in a sensible order)</H1>
    <B>Bob Ippolito</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Bloat%20%28was%20Re%3A%20%5BTwisted-commits%5D%20DependentMultiService%20-%20chained%20start/stop%20of%20services%20in%20a%20sensible%20order%29&In-Reply-To=9077504A-6E10-11D7-8B81-000393C9700E%40twistedmatrix.com"
       TITLE="[Twisted-Python] Bloat (was Re: [Twisted-commits] DependentMultiService - chained start/stop of services in a sensible order)">bob at redivi.com
       </A><BR>
    <I>Sun Apr 13 22:54:11 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003556.html">[Twisted-Python] Bloat (was Re: [Twisted-commits] DependentMultiService - chained start/stop of services in a sensible order)
</A></li>
        <LI>Next message: <A HREF="003564.html">[Twisted-Python] Bloat (was Re: [Twisted-commits] DependentMultiService - chained start/stop of services in a sensible order)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3557">[ date ]</a>
              <a href="thread.html#3557">[ thread ]</a>
              <a href="subject.html#3557">[ subject ]</a>
              <a href="author.html#3557">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sunday, Apr 13, 2003, at 20:32 America/New_York, Glyph Lefkowitz 
wrote:

&gt;<i> This patch strikes me as unnecessary:
</I>&gt;<i>
</I>&gt;<i> On Sunday, April 13, 2003, at 03:48 PM, etrepum CVS wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Modified files:
</I>&gt;&gt;<i> Twisted/twisted/internet/app.py 1.89 1.90
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Log message:
</I>&gt;&gt;<i> DependentMultiService - chained start/stop of services in a sensible 
</I>&gt;&gt;<i> order
</I>&gt;<i>
</I>&gt;<i> but I would like to discuss it and other patches like it.  Not to pick 
</I>&gt;<i> on bob here; there isn't really a policy on avoiding bloat in Twisted, 
</I>&gt;<i> so it can't be said that this is a violation of anything in 
</I>&gt;<i> particular.  I just think we need one.
</I>&gt;<i>
</I>&gt;<i> First, my question is: do we have more than one or two users who 
</I>&gt;<i> actually need this functionality?  If it's a real, present need for a 
</I>&gt;<i> wide variety of applications, then much of this criticism does not 
</I>&gt;<i> apply.
</I>
Do we have more than two users that _know_ they need/want this 
functionality?  Probably not, yet.

Here's a use case.  Let's say you have some sort of service hierarchy 
that resembles a system startup.  The way Darwin does this is that it 
has plist files bundled with the actual &quot;rc&quot; scripts that determine 
which services get started and in what order by SystemStarter.  Here's 
an example plist file (in NeXT format, because XML is retarded) for the 
LDAP service:
{
   Description     = &quot;LDAP&quot;;
   Provides        = (&quot;LDAP&quot;);
   Requires        = (&quot;Network Configuration&quot;, &quot;DirectoryServices&quot;);
   OrderPreference = &quot;None&quot;;
}

In this case, in order for LDAP to start, the services that provide 
Network Configuration and DirectoryServices must already be running.  
It doesn't care which ordering bucket it sits in (OrderPreference can 
be Last, First, etc.), and it provides LDAP functionality to other 
services that want it.

DependentMultiService is a very crude basis for such a mechanism, 
because I don't need that kind of functionality yet.  However, it does 
provide a pretty decent base class for a future Twisted &quot;SystemStarter&quot; 
equivalent... which we *should* want to have someday.

Thinking like this could potentially make things such as tying 
authorizers to pb services and whatnot easier, if they're done in a 
service collection manner rather than just tied to the same parent.  
However, as you said, app and cred are already nasty and need a major 
refactoring.

&gt;<i>
</I>&gt;&gt;<i> +        # Warning:  On failure, service stops are not
</I>&gt;&gt;<i> +        # chained.  However, they will stop in the proper order.
</I>&gt;<i>
</I>&gt;<i> &quot;utility&quot; patches like this will invariably fail to take edge cases 
</I>&gt;<i> into account well.  I wouldn't say it's immediately obvious how 
</I>&gt;<i> edge-cases *should* be taken into account, personally, but I would 
</I>&gt;<i> guess that half-changing the semantics of the ordering in case of 
</I>&gt;<i> failure is not the correct thing to do.
</I>
Basically, it's not at all obvious what you do if you have a failure in 
a collection of interdependent services.  On startup or shutdown, if 
one fails, you obviously aren't going to be able to say that whole 
collection is started or stopped properly, so I make the remainder of 
the running services shut down immediately.  The only difference in 
semantics is that once a failure happens, the service stopping is no 
longer chained (the rest of the running services get stopService called 
immediately).  It really depends on what kind of services you have to 
determine whether you want to try and chain this or not.. but in most 
cases, startService and stopService don't return deferreds anyways, and 
in even more cases, you don't expect them to fail.  I'll go ahead and 
add an __init__ option that lets you decide which behavior gets chosen 
in the case of a failure.

Also, the fact that I'm returning a deferred here either way means that 
it's probably possible that you could even set a timeout.. which is 
kind of cool, but I've said before that the Deferred timeout API can 
cause some issues (it can't actually make something NOT happen.. which 
is really unfortunate).  I really think there should be an API to 
cancel Deferreds, and the methods that return them should be refactored 
to respect a cancel whenever possible.

-bob



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003556.html">[Twisted-Python] Bloat (was Re: [Twisted-commits] DependentMultiService - chained start/stop of services in a sensible order)
</A></li>
	<LI>Next message: <A HREF="003564.html">[Twisted-Python] Bloat (was Re: [Twisted-commits] DependentMultiService - chained start/stop of services in a sensible order)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3557">[ date ]</a>
              <a href="thread.html#3557">[ thread ]</a>
              <a href="subject.html#3557">[ subject ]</a>
              <a href="author.html#3557">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
