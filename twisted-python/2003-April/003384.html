<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] supressess warnings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20supressess%20warnings&In-Reply-To=96CF4C0E-6439-11D7-8A58-000393C92466%40dalkescientific.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003382.html">
   <LINK REL="Next"  HREF="003385.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] supressess warnings</H1>
    <B>Christopher Armstrong</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20supressess%20warnings&In-Reply-To=96CF4C0E-6439-11D7-8A58-000393C92466%40dalkescientific.com"
       TITLE="[Twisted-Python] supressess warnings">radix at twistedmatrix.com
       </A><BR>
    <I>Tue Apr  1 14:11:18 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003382.html">[Twisted-Python] supressess warnings
</A></li>
        <LI>Next message: <A HREF="003385.html">[Twisted-Python] supressess warnings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3384">[ date ]</a>
              <a href="thread.html#3384">[ thread ]</a>
              <a href="subject.html#3384">[ subject ]</a>
              <a href="author.html#3384">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Apr 01, 2003 at 07:00:53AM -0500, Andrew Dalke wrote:

&gt;<i> A bit of searching later and I found
</I>&gt;<i>   twisted/python/log.py
</I>&gt;<i> which redefines (!) warnings.showwarning to dump the data to a
</I>&gt;<i> logfile, which is initialized to a NullFile(), which does nothing.
</I>
Yeah, replacing showwarnings is the idiomatic way to override the
display of warnings. The bit that initializes the default logfile to
NullFile is something moshez and glyph wanted, and, for the record,
something I'm against. (sorry glyph :-)

&gt;<i> I started to change the code, so I could submit a patch.  I got the
</I>&gt;<i> code out of CVS and am reading the documentation at
</I>&gt;<i>   <A HREF="http://twistedmatrix.com/documents/howto/coding-standard">http://twistedmatrix.com/documents/howto/coding-standard</A>
</I>&gt;<i> It says that the main test suite builder is in 'twisted.test.test_all'
</I>&gt;<i> 
</I>&gt;<i> That module doesn't exist (can't import it) nor is the appropriate
</I>&gt;<i> file present anywhere.  And the hyperlink from that page yields
</I>&gt;<i>   &quot;No Such Resource
</I>&gt;<i>    File not found.&quot;
</I>
Oh, that's a bit out of date. Just run `./bin/trial -p twisted.test'
if you want to run all of the Twisted tests. I'll update the doc.

&gt;<i> It then says
</I>&gt;<i>   Acceptance tests are all automated by the bin/accepttests
</I>&gt;<i> but that program is in admin/accepttests
</I>&gt;<i> 
</I>&gt;<i> I ran that for my Mac OS X machine, with 'open' as the
</I>&gt;<i> WEBBROWSER setting (where does the '-b' option go, since
</I>&gt;<i> open doesn't block .. do I pass it to 'accepttests'?  Yes.) and  
</I>&gt;<i> /bin/true
</I>&gt;<i> as my IRCCLIENT, since I wouldn't know what to do with one
</I>&gt;<i> even assuming I had one.
</I>
Note that all developers aren't really expected to run these, it's
super-dependant on your environment and is finicky about how exactly
you start the script. I'll add this to the doc, as well.


...

Oh, it seems itamar just fixed those issues with the coding standard.

&gt;<i> Anyway, after a while it gave this error
</I>
&gt;<i> Running Command: './admin/../bin/mktap mail --domain foo.bar=dump  
</I>&gt;<i> --user postmaster=postmaster  --pop 18110'
</I>&gt;<i> option --pop not a unique prefix
</I>
I have no idea what this error means.

&gt;<i> Hmmm.... Is 'admin/runtests' the correct script to run?  I ran that,
</I>&gt;<i> and got the following output
</I>
Yeah, `admin/runtests' just runs `bin/trial -p twisted.test', for
convenience.

&gt;<i> ======================================================================== 
</I>&gt;<i> FAILURE: testReadLimit (twisted.test.test_policies.ThrottlingTestCase)
</I>&gt;<i> ------------------------------------------------------------------------ 
</I>
&gt;<i> ======================================================================== 
</I>&gt;<i> FAILURE: testWriteLimit (twisted.test.test_policies.ThrottlingTestCase)
</I>&gt;<i> ------------------------------------------------------------------------ 
</I>
&gt;<i> ======================================================================== 
</I>&gt;<i> FAILURE: testPackages (twisted.test.test_setup.CheckingPackagesTestCase)
</I>&gt;<i> ------------------------------------------------------------------------ 
</I>
This happened because you didn't use the `-P' option to cvs
update/checkout. Please put this in your ~/.cvsrc:

&quot;&quot;&quot;
update -d -P
checkout -P
&quot;&quot;&quot;

&gt;<i> ======================================================================== 
</I>&gt;<i> FAILURE: testFailing (twisted.test.test_tcp.LoopbackTestCase)
</I>&gt;<i> ------------------------------------------------------------------------ 
</I>
&gt;<i> ======================================================================== 
</I>&gt;<i> ERROR: testUnicodeTolerance (twisted.test.test_xml.MicroDOMTest)
</I>&gt;<i> ------------------------------------------------------------------------ 
</I>

I have no idea what the rest of the problems were about, though.

&gt;<i> And for the life of me I can't figure out why the log file should
</I>&gt;<i> default (when no logging is enabled) to the NullFile rather than
</I>&gt;<i> sys.stderr -- if you really want the NullFile, just pass it in.  So
</I>&gt;<i> I switched it to use sys.stderr.
</I> 
I wish this could be accepted, but unless glyph changes his mind, it
probably won't. The usual response is to use twistd, but twistd isn't
appropriate in all use-cases (it is in yours, however). The *reason*,
IIRC, was that &quot;you shouldn't spam unwanted stuff to STDIO&quot;, which I
think is stupid. Application developers could notice spam to stdio,
and, if they don't like it, startLogging to NullFile. (I've heard a
lot more complaints about &quot;Why don't I see any output!?&quot; than &quot;Why
does Twisted write stuff to my stdio?&quot;)

&lt;/rant&gt;

Sorry, I guess I'll stop beating a dead horse. :)

&gt;<i> Why's the Log pickleable? What happens if a cStringIO is passed
</I>&gt;<i> in instead of a file?  Or an outgoing network socket?  Or a
</I>&gt;<i> os.popen(&quot;lp&quot;)?
</I>
Well, it should probably be pickleable only when it _can_ be. :) i.e.,
__getstate__ could test for a `.name' attribute on the file object, or
something. Handling stuff like StringIO might be a bit trickier
without hardcoding an `isinstance(self.file, StringIO)' into
it... Perhaps it could `try: cPickle.dumps(self.file)' to test if the
file's pickleable in the case where it's not a named file ;-)

&gt;<i> It looks like Log.synchronized is old code that can be removed.  Yes?
</I>
No, I'm pretty sure this is so threaded code that writes to the log
doesn't break.

&gt;<i> Why does doc/examples/cursesclient.py set log.logfile directly?
</I>&gt;<i> Shouldn't it call log.startLogging(log.NullFile()) ?  It's the only  
</I>&gt;<i> other
</I>&gt;<i> piece of code which references log.NullFile.
</I>
Probably.

&gt;<i> Is 'discardLogs' the true inverse of startLogging?  If so, it
</I>&gt;<i> should add something to restore sys.stdout/sys.stderr if
</I>&gt;<i> startLogging asked them to be changed.
</I>&gt;<i> 
</I>&gt;<i> If not, where's the 'stopLogging' function?  And 'discard'
</I>&gt;<i> means to ignore logging?  Or should it throw away the
</I>&gt;<i> log files?  The terminology is confusing.
</I>
Well, if you want to switch your logging to something else
(sys.stdout/stderr), then pass that something else to startLogging,
probably.


&gt;<i> Anyway, the diff -u is attached for you all to review and
</I>&gt;<i> correct. 
</I>
&gt;<i> Oh, and with my changes, I now see the expected warning
</I>&gt;<i> when I start up, and I see two twisted messages ...
</I>&gt;<i> 
</I>&gt;<i> [Andrew-Dalkes-Computer:~/cvses/Twisted] dalke% python cansmi_rpc.py
</I>&gt;<i> /usr/local/lib/python2.3/site-packages/openeye/oechem.py:5: 
</I>&gt;<i> RuntimeWarning: Python C API version mismatch for module _oechem: This 
</I>&gt;<i> Python has API version 1012, module _oechem has version 1011.
</I>&gt;<i>   import _oechem
</I>&gt;<i> twisted.web.server.Site starting on 8080
</I>&gt;<i> Starting factory &lt;twisted.web.server.Site instance at 0x640850&gt;
</I>&gt;<i> 
</I>&gt;<i> which tells me that those two messages (&quot;Site starting&quot; and &quot;Starting
</I>&gt;<i> factory&quot;) were being sent to never-never-land the whole time.  Perhaps
</I>&gt;<i> the latter shouldn't be present?
</I>
Well, no, usually people use twistd. Which you should, if you're
writing a server. It handles logging, daemonization, and a whole slew
of other things for you, and, contrary to what most people think,
doesn't require the use of .taps (see the `-y' parameter).


Anyway, thanks for the in-depth message, it was helpful.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     <A HREF="http://twistedmatrix.com/users/radix.twistd/">http://twistedmatrix.com/users/radix.twistd/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003382.html">[Twisted-Python] supressess warnings
</A></li>
	<LI>Next message: <A HREF="003385.html">[Twisted-Python] supressess warnings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3384">[ date ]</a>
              <a href="thread.html#3384">[ thread ]</a>
              <a href="subject.html#3384">[ subject ]</a>
              <a href="author.html#3384">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
