<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted 1.0.4 - admin/runtests failures?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%201.0.4%20-%20admin/runtests%20failures%3F&In-Reply-To=%3C20030423.155734.48529138.warner%40lothar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="036227.html">
   <LINK REL="Next"  HREF="036315.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted 1.0.4 - admin/runtests failures?</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%201.0.4%20-%20admin/runtests%20failures%3F&In-Reply-To=%3C20030423.155734.48529138.warner%40lothar.com%3E"
       TITLE="[Twisted-Python] Twisted 1.0.4 - admin/runtests failures?">warner at lothar.com
       </A><BR>
    <I>Wed Apr 23 16:57:34 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="036227.html">[Twisted-Python] Twisted 1.0.4 - admin/runtests failures?
</A></li>
        <LI>Next message (by thread): <A HREF="036315.html">[Twisted-Python] Re: Twisted 1.0.4 - admin/runtests failures?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36228">[ date ]</a>
              <a href="thread.html#36228">[ thread ]</a>
              <a href="subject.html#36228">[ subject ]</a>
              <a href="author.html#36228">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Woops.  This is a localization problem.  Maybe it should be an expected
</I>&gt;<i> skip for certain values of LC_LANG?  Or maybe we should just not use ls.
</I>
Hmm, it means popen2 used french while reactor.spawnProcess used english.
That test clears the environment before running spawnProcess.. maybe we
should let it inherit the complete environment from its parent.

Could you try the attached patch and see if it fixes the problem?

&gt;<i> Multicast is known to be broken in a few situations.  Can you describe
</I>&gt;<i> your network setup.  In particular, do you have a firewall configured, or is
</I>&gt;<i> the machine performing NAT?
</I>
I've seen that test fail on machines that don't have any external network
interfaces configured (just the loopback interface). My guess is that it has
to do with the 'MULTICAST' flag, which isn't usually set on lo.

thanks,
 -Brian

-------------- next part --------------
Index: twisted/internet/default.py
===================================================================
RCS file: /cvs/Twisted/twisted/internet/default.py,v
retrieving revision 1.72
diff -u -r1.72 default.py
--- twisted/internet/default.py	21 Apr 2003 15:32:15 -0000	1.72
+++ twisted/internet/default.py	23 Apr 2003 22:55:48 -0000
@@ -149,8 +149,10 @@
 
     # IReactorProcess
 
-    def spawnProcess(self, processProtocol, executable, args=(), env={}, path=None,
-                     uid=None, gid=None, usePTY = 0):
+    def spawnProcess(self, processProtocol, executable, args=(), env=None,
+                     path=None, uid=None, gid=None, usePTY=0):
+        if env == None:
+            env = os.environ
         p = platform.getType()
         if p == 'posix':
             if usePTY:
Index: twisted/internet/interfaces.py
===================================================================
RCS file: /cvs/Twisted/twisted/internet/interfaces.py,v
retrieving revision 1.78
diff -u -r1.78 interfaces.py
--- twisted/internet/interfaces.py	21 Apr 2003 19:53:39 -0000	1.78
+++ twisted/internet/interfaces.py	23 Apr 2003 22:55:49 -0000
@@ -324,7 +324,7 @@
 
 class IReactorProcess(Interface):
 
-    def spawnProcess(self, processProtocol, executable, args=(), env={}, path=None, uid=None, gid=None, usePTY=0):
+    def spawnProcess(self, processProtocol, executable, args=(), env=None, path=None, uid=None, gid=None, usePTY=0):
         &quot;&quot;&quot;Spawn a process, with a process protcol.
 
         @param processProtocol: a L{ProcessProtocol} instance
@@ -337,7 +337,7 @@
                      executable's name.
 
         @param env: the environment variables to pass to the processs; a
-                    dictionary of strings.
+                    dictionary of strings. If 'None', use os.environ.
 
         @param path: the path to run the subprocess in - defaults to the
                      current directory.
Index: twisted/test/test_process.py
===================================================================
RCS file: /cvs/Twisted/twisted/test/test_process.py,v
retrieving revision 1.38
diff -u -r1.38 test_process.py
--- twisted/test/test_process.py	14 Apr 2003 06:28:27 -0000	1.38
+++ twisted/test/test_process.py	23 Apr 2003 22:55:49 -0000
@@ -378,7 +378,7 @@
         if not os.path.exists('/bin/ls'): raise RuntimeError(&quot;/bin/ls not found&quot;)
 
         p = Accumulator()
-        reactor.spawnProcess(p, '/bin/ls', [&quot;/bin/ls&quot;, &quot;ZZXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;], {}, &quot;/tmp&quot;,
+        reactor.spawnProcess(p, '/bin/ls', [&quot;/bin/ls&quot;, &quot;ZZXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;], None, &quot;/tmp&quot;,
                              usePTY=self.usePTY)
 
         while not p.closed:
@@ -391,7 +391,7 @@
         else: raise RuntimeError(&quot;gzip not found in /bin or /usr/bin&quot;)
         s = &quot;there's no place like home!\n&quot; * 3
         p = Accumulator()
-        reactor.spawnProcess(p, cmd, [cmd, &quot;-c&quot;], {}, &quot;/tmp&quot;,
+        reactor.spawnProcess(p, cmd, [cmd, &quot;-c&quot;], None, &quot;/tmp&quot;,
                              usePTY=self.usePTY)
         p.transport.write(s)
         p.transport.closeStdin()
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="036227.html">[Twisted-Python] Twisted 1.0.4 - admin/runtests failures?
</A></li>
	<LI>Next message (by thread): <A HREF="036315.html">[Twisted-Python] Re: Twisted 1.0.4 - admin/runtests failures?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36228">[ date ]</a>
              <a href="thread.html#36228">[ thread ]</a>
              <a href="subject.html#36228">[ subject ]</a>
              <a href="author.html#36228">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
