<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: flow.Zip
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20flow.Zip&In-Reply-To=1051081070.26792.96.camel%40biproc">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003705.html">
   <LINK REL="Next"  HREF="003714.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: flow.Zip</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20flow.Zip&In-Reply-To=1051081070.26792.96.camel%40biproc"
       TITLE="[Twisted-Python] Re: flow.Zip">cce at clarkevans.com
       </A><BR>
    <I>Wed Apr 23 10:33:29 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003705.html">[Twisted-Python] Re: flow.Zip
</A></li>
        <LI>Next message: <A HREF="003714.html">[Twisted-Python] Re: flow.Zip
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3711">[ date ]</a>
              <a href="thread.html#3711">[ thread ]</a>
              <a href="subject.html#3711">[ subject ]</a>
              <a href="author.html#3711">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Apr 23, 2003 at 08:57:50AM +0200, Philippe Lafoucri&#232;re wrote:
|<i> &gt; Cooperate() is called when an iterator would block, thus,
</I>|<i> &gt; the flow module allows other tasks (connections, users)
</I>|<i> &gt; to continue.   If you look at the source for flow.Threaded
</I>|<i> &gt; you will see that it raises Cooperate() when the database
</I>|<i> &gt; hasn't produced data yet.
</I>|<i> 
</I>|<i> Ho well. So, Cooperate() is a kind de defered (for flows) ?
</I>
Well, Cooperate is the whole reason for flow... otherwise you
could just use recursive generators.   Basically, in one of 
your generators (Threaded(QueryIterator())), your code would 
block waiting for a row, etc.  So rather than blocking, Threaded
returns Cooperate.   This return value is handled by the wrappers
all the way up the call chain.  At the top of the call chain is
Deferred, and when Deferrerd gets a Cooperate, it does a 
callLater(0, self), so that other processes can run.  


Suppose you have generator X -&gt; Y -&gt; Z, the picture 
then looks like...

     Wrap  &lt;--  Z
      |
      v
     Wrap  &lt;--&gt; Y
      |   
      v
     Wrap  &lt;--&gt; X
      |
      V
     Deferred
      |
      V
     reactor

So, rather than X talking to Y, talking to Z, each of
your generators is talking to a wrapper instead, which
tries to be as transparent as possible.   The 
wrapper has the following behavior:

    0.  If a value is returned from a generator to 
        a wrapper, it is given to the previous generator
        in the chain; at the bottom of the chain it is
        added to an array which is sent to the deferred's
        callback.  Failures are handled the same way.

    1.  If the value returned is a wrapper, then it adds
        the new wrapper to the top of the stack and 
        starts to process it.

    2.  When Cooperate is returned from a generator, 
        it is sent all the way down the Wrapper linked
        list so that the reactor can re-schedule the
        processing chain (micro-thread).

So, I hope this helps.  Cooperate is the whole reason
for flow... without the need to 'pause' the whole stack
one wouldn't need the wrapper at all.  

;) Clark


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003705.html">[Twisted-Python] Re: flow.Zip
</A></li>
	<LI>Next message: <A HREF="003714.html">[Twisted-Python] Re: flow.Zip
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3711">[ date ]</a>
              <a href="thread.html#3711">[ thread ]</a>
              <a href="subject.html#3711">[ subject ]</a>
              <a href="author.html#3711">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
