<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: supressess warnings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20supressess%20warnings&In-Reply-To=9C86C66E-648B-11D7-8A58-000393C92466%40dalkescientific.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003388.html">
   <LINK REL="Next"  HREF="003392.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: supressess warnings</H1>
    <B>Itamar Shtull-Trauring</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20supressess%20warnings&In-Reply-To=9C86C66E-648B-11D7-8A58-000393C92466%40dalkescientific.com"
       TITLE="[Twisted-Python] Re: supressess warnings">twisted at itamarst.org
       </A><BR>
    <I>Tue Apr  1 22:45:23 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003388.html">[Twisted-Python] Re: supressess warnings
</A></li>
        <LI>Next message: <A HREF="003392.html">[Twisted-Python] Re: supressess warnings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3389">[ date ]</a>
              <a href="thread.html#3389">[ thread ]</a>
              <a href="subject.html#3389">[ subject ]</a>
              <a href="author.html#3389">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 1 Apr 2003 16:48:01 -0500
Andrew Dalke &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dalke at dalkescientific.com</A>&gt; wrote:

&gt;<i> to actually use the log.  It isn't obvious anywhere that that
</I>&gt;<i> import will make a system level change.
</I>&gt;<i>    - what if I've changed warnings.showwarning in my own
</I>&gt;<i>         code (or in some other 3rd party package).  Where's the
</I>&gt;<i>         documentation which states that there will be a problem?
</I>&gt;<i> 
</I>&gt;<i>    - It's pervasive.  That is, if I import twisted.lore (perhaps
</I>&gt;<i>        because I want it to use it for my own documentation
</I>&gt;<i>        system) it's still the case that warnings.showwarning
</I>&gt;<i>        gets replaced.  There should be no reason for that.
</I>
I agree that this is bad. If you complain enough maybe glyph will listen
to reason.

&gt;<i> Are there any other system-level functions or settings which
</I>&gt;<i> get tweaked by Twisted?
</I>
Not that I can recall.

&gt;<i> There are only 4 places which use that, outside of some of the
</I>&gt;<i> test code.  Is it really that useful given how non-obvious it is?
</I>
No. We need to have thread-safe logging.

&gt;<i> Notice that log.py's Log class, which has a 'synchronized'
</I>&gt;<i> attribute, is not so initialized.  This suggests there's either a bug
</I>&gt;<i> (this class needs to be synchronized) or that that attribute is
</I>&gt;<i> unneeded.
</I>
Indeed.

&gt;<i> I still don't like that it goes into effect without me doing
</I>&gt;<i> anything other than an import.
</I>
Yes. Its glyph's fault, again.

&gt;<i> Looking only at the error message, it means that:
</I>&gt;<i>    - the option parsing code does automatic prefix expansion, so
</I>&gt;<i>         that if the option is '--pop3' and the argument is '--pop' and
</I>&gt;<i>         no other option starts with '--pop' then it's elided to
</I>&gt;<i>         '--pop3'.   
</I>...
&gt;<i>    - and no one has run those tests in a while, probably not since
</I>&gt;<i>       10-Feb-03 when moshez added the following option.
</I>&gt;<i> 
</I>&gt;<i>         [&quot;pop3s&quot;, &quot;S&quot;, 0, &quot;Port to start the POP3-over-SSL server on
</I>&gt;<i>         (0  
</I>&gt;<i> to disable).&quot;],
</I>
Yes, they only get run during releases. Jean-Paul fixed the --pop issue
in CVS I think.

Some of the failed tests look like timing issues, yes.

&gt;<i> -------
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>     File &quot;/Users/dalke/cvses/Twisted/twisted/trial/unittest.py&quot;, line 
</I>&gt;<i>     
</I>&gt;<i> 165, in runOneTest
</I>&gt;<i>      method(testCase)
</I>&gt;<i>     File &quot;/Users/dalke/cvses/Twisted/twisted/test/test_process.py&quot;,
</I>&gt;<i>     line  
</I>&gt;<i> 140, in testEcho
</I>&gt;<i>      self.assertEquals(len(p.buffer), len(p.s * 10))
</I>&gt;<i>   AttributeError: EchoProtocol instance has no attribute 'buffer'
</I>
Gar. I wonder why this isn't showing on the Max OS X buildbot.

&gt;<i> Trying to track that down, I see that
</I>&gt;<i>    twisted/internet/interfaces.py
</I>&gt;<i> has mention of
</I>&gt;<i>            @see: C{twisted.protocols.protocol.ProcessProtocol}
</I>
Typo - fixed in CVS.

Any bugs we can reproduce and are easily fixable will be fixed by next
release, e.g. the dom one.

&gt;<i> As mentioned, I don't like how system settings are changed
</I>&gt;<i> on an import, much less without documentation which says
</I>&gt;<i> this will happen.
</I>
We should have logging docs soon.

&gt;<i> If everything server related should be done in the context
</I>&gt;<i> of twistd, then that warnings.showwarning replacement
</I>&gt;<i> should only be done when twistd is used, which is why
</I>&gt;<i> the patch I sent only made the switch when startLogging
</I>&gt;<i> was called.
</I>
Again, I agree, bug glyph.

&gt;<i> The solution I see now, which is that showwarnings calls
</I>&gt;<i> the errlog instead of the msg log, still isn't the right
</I>&gt;<i> behaviour, IMO, if only because you are changing the
</I>&gt;<i> format of the error messages.  At the very least you should
</I>&gt;<i> call warnings.formatwarning instead of building your own
</I>&gt;<i> warning message.
</I>
The idea was to have more informative messages. Can you put in something
comparing the two formats?


&gt;<i> def showwarning(message, category, filename, lineno, file=None):
</I>&gt;<i>      m = warnings.formatwarning(message, category, filename, lineno)
</I>&gt;<i>      if file is None:
</I>&gt;<i>        err(m)
</I>&gt;<i>      else:
</I>&gt;<i>        file.write(m)
</I>
Done, at least partially.

&gt;<i> Finally, I noticed that other part of my patch were not accepted.
</I>&gt;<i> For example, the use of os.linesep is incorrect.  The log file is
</I>&gt;<i> opened in text mode, so &quot;\n&quot; will be converted to the appropriate
</I>&gt;<i> byte representation for the given platform.  In other words,
</I>&gt;<i> 
</I>&gt;<i>          logerr.write(str(stuff)+os.linesep)
</I>&gt;<i> should be
</I>&gt;<i>          logerr.write(str(stuff)+&quot;\n&quot;)
</I>&gt;<i> 
</I>&gt;<i> I also did some things to clean up the code, like getting
</I>&gt;<i> rid of unneeded module imports (like string) and replacing
</I>
&gt;<i> I noticed none of these were accepted.
</I>
Not really, I just didn't get around to reading the patch. I did some of
these in CVS.

&gt;<i> What should I do to make these sorts of changes more acceptable?
</I>
They were not bad, it seems, we just don't have time to deal with all of
them... I have a huge queue waiting for me :(

We do appreciate your efforts.

&gt;<i> After all, the point of a good unit test suite is to make it easy for
</I>&gt;<i> people to refactor and clean up existing code.  All the tests passed
</I>&gt;<i> identically before and after my changes.
</I>
Yes, but behaviour was changed I think? Possibly in a better way, but
changing behaviour takes more mental work on our part.

-- 
Itamar Shtull-Trauring    <A HREF="http://itamarst.org/">http://itamarst.org/</A>
<A HREF="http://www.zoteca.com">http://www.zoteca.com</A> -- Python &amp; Twisted consulting


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003388.html">[Twisted-Python] Re: supressess warnings
</A></li>
	<LI>Next message: <A HREF="003392.html">[Twisted-Python] Re: supressess warnings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3389">[ date ]</a>
              <a href="thread.html#3389">[ thread ]</a>
              <a href="subject.html#3389">[ subject ]</a>
              <a href="author.html#3389">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
