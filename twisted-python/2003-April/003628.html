<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] blocking question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20blocking%20question&In-Reply-To=20030418034311.GC23842%40frobozz.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003620.html">
   <LINK REL="Next"  HREF="003622.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] blocking question</H1>
    <B>Bob Ippolito</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20blocking%20question&In-Reply-To=20030418034311.GC23842%40frobozz.local"
       TITLE="[Twisted-Python] blocking question">bob at redivi.com
       </A><BR>
    <I>Fri Apr 18 12:52:30 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003620.html">[Twisted-Python] blocking question
</A></li>
        <LI>Next message: <A HREF="003622.html">[Twisted-Python] fwd: Accepted twisted 1.0.4-1 (i386 source all)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3628">[ date ]</a>
              <a href="thread.html#3628">[ thread ]</a>
              <a href="subject.html#3628">[ subject ]</a>
              <a href="author.html#3628">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thursday, Apr 17, 2003, at 23:43 America/New_York, Andrew Bennetts 
wrote:

&gt;<i> On Thu, Apr 17, 2003 at 11:15:06PM -0400, Konrad Rokicki wrote:
</I>&gt;&gt;<i> Hey everyone, newbie question:
</I>&gt;&gt;<i> Are there any Python/Twisted idioms for doing blocking? More 
</I>&gt;&gt;<i> specifically,
</I>&gt;&gt;<i> in a client I have a method to send a query to the server and another
</I>&gt;&gt;<i> method that gets called when the query is answered. Is there an easy 
</I>&gt;&gt;<i> way
</I>&gt;&gt;<i> to say &quot;send the query then wait x seconds for it to return in this
</I>&gt;&gt;<i> function&quot;?
</I>&gt;&gt;<i> It seems like blocking is taboo in twisted and if anyone has an
</I>&gt;&gt;<i> alternative I'd be glad to hear it. I guess I could do this
</I>&gt;&gt;<i> asynchronically but it would be a pain I think.
</I>&gt;<i>
</I>&gt;<i> See <A HREF="http://twistedmatrix.com/documents/howto/defer">http://twistedmatrix.com/documents/howto/defer</A> for more details on 
</I>&gt;<i> using
</I>&gt;<i> Deferreds.  See also the &quot;Writing a Server&quot; and &quot;Writing a Client&quot; 
</I>&gt;<i> howtos.
</I>&gt;<i> This is pretty basic Twisted stuff, so the existing docs cover it 
</I>&gt;<i> pretty
</I>&gt;<i> well.
</I>
Is Glyph's Deferred talk from PyCon online yet?  That might also be 
useful.

krad - You should've just gone to PyCon man, it was right in DC at GWU 
and there were god knows how many talks about various pieces of Twisted.

The only time threads are used in Twisted is if an API that only 
provides a blocking interface must be used.. for example, 
twisted.enterprise uses a threadpool to dispatch queries to DBAPI 
compliant databases, since DBAPI is synchronous and blocking.  The only 
other way around this is to have a pool of worker processes instead of 
worker threads, but you don't really have anything to gain with this 
approach b/c it uses more memory/resources and IPC is slower than 
thread communication.

But yeah, what you want to do is definitely the kind of thing that you 
should be using Deferreds for.. Also, due to the chaining behavior, you 
can do something practical like this:

from twisted.web import microdom, client
# Start webpage fetch
d = client.getPage('<A HREF="http://example.com/somewebpage.html'">http://example.com/somewebpage.html'</A>)
# If webpage fetch takes more than aFewSeconds, raise error
d.setTimeout(aFewSeconds)
# Take the web fetch result, and parse it into a DOM tree
# equivalent to saying: microdom.parseString(webFetchResult, 
beExtremelyLenient=1)
d.addCallback(microdom.parseString, beExtremelyLenient=1)
# this will get triggered if the timeout happens, or if there's a parse 
error
# however, with beExtremelyLenient, there usually won't be one.. it can 
parse some f'ed up html
d.addErrback(yourTimeoutOrParseErrorHandler)
# If everything goes OK, or if for some reason 
yourTimeoutOrParseErrorHandler returns a non-Failure result
# call yourPageHandlerThatUnderstandsDOMTrees(result)
# because microdom.parseString was called on the result, it is now a 
DOM tree instead of a string
d.addCallback(yourPageHandlerThatUnderstandsDOMTrees)

Another convenient thing about deferreds is that if the result of some 
callback is a deferred, then it will automagically be chained as 
well... for example, if yourPageHandlerThatUnderstandsDOMTrees wants to 
pass a fetched URL to the next callback handler, then all it has to do 
is return client.getPage(someURL) and the next handler will receive the 
result of that request, not the deferred instance for that request.

-bob



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003620.html">[Twisted-Python] blocking question
</A></li>
	<LI>Next message: <A HREF="003622.html">[Twisted-Python] fwd: Accepted twisted 1.0.4-1 (i386 source all)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3628">[ date ]</a>
              <a href="thread.html#3628">[ thread ]</a>
              <a href="subject.html#3628">[ subject ]</a>
              <a href="author.html#3628">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
