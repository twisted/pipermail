<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] self.channel.writeHeaders(version, code, reason, headers)\nbuiltins.AttributeError: \'NoneType\' object has no attribute \'writeHeaders\'\
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20self.channel.writeHeaders%28version%2C%20code%2C%20reason%2C%0A%20headers%29%5Cnbuiltins.AttributeError%3A%20%5C%27NoneType%5C%27%20object%20has%20no%0A%20attribute%20%5C%27writeHeaders%5C%27%5C&In-Reply-To=%3C06088082-A36B-4E0F-85F5-795FE449E50E%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="032425.html">
   <LINK REL="Next"  HREF="032427.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] self.channel.writeHeaders(version, code, reason, headers)\nbuiltins.AttributeError: \'NoneType\' object has no attribute \'writeHeaders\'\</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20self.channel.writeHeaders%28version%2C%20code%2C%20reason%2C%0A%20headers%29%5Cnbuiltins.AttributeError%3A%20%5C%27NoneType%5C%27%20object%20has%20no%0A%20attribute%20%5C%27writeHeaders%5C%27%5C&In-Reply-To=%3C06088082-A36B-4E0F-85F5-795FE449E50E%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] self.channel.writeHeaders(version, code, reason, headers)\nbuiltins.AttributeError: \'NoneType\' object has no attribute \'writeHeaders\'\">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Aug  4 20:35:05 MDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="032425.html">[Twisted-Python] self.channel.writeHeaders(version, code, reason, headers)\nbuiltins.AttributeError: \'NoneType\' object has no attribute \'writeHeaders\'\
</A></li>
        <LI>Next message (by thread): <A HREF="032427.html">[Twisted-Python] self.channel.writeHeaders(version, code, reason, headers)\nbuiltins.AttributeError: \'NoneType\' object has no attribute \'writeHeaders\'\
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32426">[ date ]</a>
              <a href="thread.html#32426">[ thread ]</a>
              <a href="subject.html#32426">[ subject ]</a>
              <a href="author.html#32426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> On Aug 4, 2019, at 5:57 PM, Waqar Khan &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wk80333 at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi Glyph,
</I>&gt;<i>   Thanks for the suggestion.
</I>&gt;<i> I tried the suggestion.. While it fixes the self.channel NoneType issue.. It creates another issue.
</I>&gt;<i> 
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>   File &quot;/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/events.py&quot;, line 88, in _run
</I>&gt;<i>     self._context.run(self._callback, *self._args)
</I>&gt;<i>   File &quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;, line 827, in adapt
</I>&gt;<i>     adapt.actual.callback(extracted)
</I>&gt;<i>   File &quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;, line 460, in callback
</I>&gt;<i>     self._startRunCallbacks(result)
</I>&gt;<i>   File &quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;, line 568, in _startRunCallbacks
</I>&gt;<i>     self._runCallbacks()
</I>&gt;<i> --- &lt;exception caught here&gt; ---
</I>&gt;<i>   File &quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;, line 654, in _runCallbacks
</I>&gt;<i>     current.result = callback(current.result, *args, **kw)
</I>&gt;<i> ......
</I>&gt;<i>     request.finish()
</I>&gt;<i>   File &quot;/usr/local/lib/python3.7/site-packages/twisted/web/server.py&quot;, line 268, in finish
</I>&gt;<i>     return http.Request.finish(self)
</I>&gt;<i>   File &quot;/usr/local/lib/python3.7/site-packages/twisted/web/http.py&quot;, line 1071, in finish
</I>&gt;<i>     &quot;Request.finish called on a request after its connection was lost; &quot;
</I>&gt;<i> builtins.RuntimeError: Request.finish called on a request after its connection was lost; use Request.notifyFinish to keep track of this.
</I>
Oh, hrm.  The idea here is that any code that returns NOT_DONE_YET (i.e. does asynchronous work to generate a response) should also be tracking whether it needs to call `.finish()` by watching a `.notifyFinish()` Deferred.  I bet that there are plenty of resources in Twisted which don't follow this rule, and we should fix those; but possibly we should also make this error message less stern.  Do you have a minimal example?

&gt;<i>  I have got some handle on the issue. I was wondering if you have any advise on how to debug the issue. 
</I>&gt;<i> Somewhere in the codebase are async/await code (from asyncio world). Hence, when the connection is closed down by client, seems like those pending coroutines are lingering on.
</I>
This, I have no idea about.  What tasks are you starting, when are you expecting them to get cleaned up, what are they blocking on, how do these interact with Twisted?  There are a couple dozen questions I'd have to know the answer to in order to even begin debugging this.  If you cancel all the outstanding tasks and look at their tracebacks when exiting it might give you more of a sense of where they're stuck...

-g

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="032425.html">[Twisted-Python] self.channel.writeHeaders(version, code, reason, headers)\nbuiltins.AttributeError: \'NoneType\' object has no attribute \'writeHeaders\'\
</A></li>
	<LI>Next message (by thread): <A HREF="032427.html">[Twisted-Python] self.channel.writeHeaders(version, code, reason, headers)\nbuiltins.AttributeError: \'NoneType\' object has no attribute \'writeHeaders\'\
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32426">[ date ]</a>
              <a href="thread.html#32426">[ thread ]</a>
              <a href="subject.html#32426">[ subject ]</a>
              <a href="author.html#32426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
