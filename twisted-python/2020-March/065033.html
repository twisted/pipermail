<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] IReactorTime.seconds: epoch time or no?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20IReactorTime.seconds%3A%20epoch%20time%20or%20no%3F&In-Reply-To=%3C0bbb2d6a-363a-488d-bda2-847463486b8f%40www.fastmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065032.html">
   <LINK REL="Next"  HREF="065034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] IReactorTime.seconds: epoch time or no?</H1>
    <B>Tom Most</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20IReactorTime.seconds%3A%20epoch%20time%20or%20no%3F&In-Reply-To=%3C0bbb2d6a-363a-488d-bda2-847463486b8f%40www.fastmail.com%3E"
       TITLE="[Twisted-Python] IReactorTime.seconds: epoch time or no?">twm at freecog.net
       </A><BR>
    <I>Tue Mar 24 17:05:02 MDT 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065032.html">[Twisted-Python] IReactorTime.seconds: epoch time or no?
</A></li>
        <LI>Next message (by thread): <A HREF="065034.html">[Twisted-Python] IReactorTime.seconds: epoch time or no?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65033">[ date ]</a>
              <a href="thread.html#65033">[ thread ]</a>
              <a href="subject.html#65033">[ subject ]</a>
              <a href="author.html#65033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'll offer a dissenting opinion:

I've worked on systems where the reactor is patched to use monotonic time. (This is essential on embedded systems that lack a real-time clock.) I'm not aware of this causing any issues, and it fixed real problems.

HTTPFactory is quite unusual in assuming that it is epoch time. Most parts of Twisted that require wall time call `time.time()` or equivalent directly. IMO HTTPFactory is in error here, and this is simply a bug. We should change HTTPFactory to use `time.time()` directly.

Since the time base of IReactorTime.seconds() hasn't ever been clearly defined, I think that we should really go the other way: use `time.monotonic()` by default where possible. (Or, more realistically, make it an option and maybe the default.)

---Tom

On Mon, Mar 23, 2020, at 1:24 PM, Amber Brown (hawkowl) wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 24/3/20 6:45 am, Richard van der Hoff wrote:
</I>&gt;<i> &gt; HTTPFactory seems to think that `reactor.seconds` is reliably an epoch 
</I>&gt;<i> &gt; time (see 
</I>&gt;<i> &gt; <A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L3110,">https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L3110,</A> 
</I>&gt;<i> &gt; etc).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On the other hand. AsyncioSelectorReactor.seconds() returns a monotonic 
</I>&gt;<i> &gt; time:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; python3 -c 'from twisted.internet import asyncioreactor; 
</I>&gt;<i> &gt; print(asyncioreactor.AsyncioSelectorReactor().seconds())'
</I>&gt;<i> &gt; 41116.763594412
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; One of these is wrong... I think it's HTTPFactory making bad 
</I>&gt;<i> &gt; assumptions, but can anyone confirm the intention here?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> It's a bug in asyncioreactor. IReactorTime defines it as &quot;current time 
</I>&gt;<i> in seconds&quot;, which _probably_ should be defined nicer 
</I>&gt;<i> (<A HREF="https://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorTime.html#seconds">https://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorTime.html#seconds</A>) 
</I>&gt;<i> but is generally epoch time.
</I>&gt;<i> 
</I>&gt;<i> asyncioreactor does have a few problems with time:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://twistedmatrix.com/trac/ticket/9611">https://twistedmatrix.com/trac/ticket/9611</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/trac/ticket/9780">https://twistedmatrix.com/trac/ticket/9780</A>
</I>&gt;<i> 
</I>&gt;<i> I can't find a bug for this issue, though, although I'm almost sure I've 
</I>&gt;<i> seen it before... so, if you could file one (and maybe a patch to fix 
</I>&gt;<i> it!) then that would be appreciated.
</I>&gt;<i> 
</I>&gt;<i> - Amber
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065032.html">[Twisted-Python] IReactorTime.seconds: epoch time or no?
</A></li>
	<LI>Next message (by thread): <A HREF="065034.html">[Twisted-Python] IReactorTime.seconds: epoch time or no?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65033">[ date ]</a>
              <a href="thread.html#65033">[ thread ]</a>
              <a href="subject.html#65033">[ subject ]</a>
              <a href="author.html#65033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
