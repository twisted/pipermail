<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] interface for Last-Modified
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20interface%20for%20Last-Modified&In-Reply-To=20020924.192833.105432764.glyph%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001733.html">
   <LINK REL="Next"  HREF="001736.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] interface for Last-Modified</H1>
    <B>Kevin Turner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20interface%20for%20Last-Modified&In-Reply-To=20020924.192833.105432764.glyph%40twistedmatrix.com"
       TITLE="[Twisted-Python] interface for Last-Modified">kevin.m.turner at pobox.com
       </A><BR>
    <I>Tue Sep 24 23:50:18 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001733.html">[Twisted-Python] breaking distrib.ResourceSubscription
</A></li>
        <LI>Next message: <A HREF="001736.html">[Twisted-Python] interface for Last-Modified
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1734">[ date ]</a>
              <a href="thread.html#1734">[ thread ]</a>
              <a href="subject.html#1734">[ subject ]</a>
              <a href="author.html#1734">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>itamar has led me to what looks to be a much more elegant solution. 
Since the only resources that worry about receiving conditional requests
are those that set cache validation headers (such as &quot;Last-Modified&quot;),
the check to see if you're dealing with a conditional request can go in
the L{http.Request.setLastModified} method.  setLastModified's return
value can then let the caller know if they date they gave was older than
the one in the conditional request, so they don't have to render the
body of the request.  And this works, because Last-Modified being a
header and all, you're having to set it before you write the request
body anyway.

So this works pretty well::

    class SimpleResource(resource.Resource):
        def render(self, request):
            if http.CACHED in (request.setLastModified(10),
                               request.setETag('MatchingTag')):
                return ''
            else:
                return &quot;correct&quot;

and I was all ready to check it in, until I tried to apply it in my
actual use-case, using it in a superclass::

    class AbstractCommitList(widgets.Widget, mvc.View):
        def display(self, request):
            if request.setLastModified(self.lastModified) is http.CACHED:
                # Body should be empty.
                return ''
            else:
                # Body is rendered by subclass.
                return ''
            # That wasn't a very effective conditional.

    class RssChannel(AbstractCommitList):
        def display(self, request):
            s = AbstractCommitList.display(self, request)
            # Now how do I know if I'm supposed to render the body or not?


I guess I could add Request.wantsABody() and have all display subclasses
call that.  Or maybe we've succeeded in moving the problem up above the
Resource.render level to higher-level things like widgets, so it's
something to be solved there.

Any thoughts?

-- 
The moon is waning gibbous, 90.6% illuminated, 17.7 days old.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001733.html">[Twisted-Python] breaking distrib.ResourceSubscription
</A></li>
	<LI>Next message: <A HREF="001736.html">[Twisted-Python] interface for Last-Modified
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1734">[ date ]</a>
              <a href="thread.html#1734">[ thread ]</a>
              <a href="subject.html#1734">[ subject ]</a>
              <a href="author.html#1734">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
