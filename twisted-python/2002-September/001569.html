<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ReconnectingClientFactory &amp; stopFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ReconnectingClientFactory%20%26%20stopFactory&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001568.html">
   <LINK REL="Next"  HREF="001570.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ReconnectingClientFactory &amp; stopFactory</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ReconnectingClientFactory%20%26%20stopFactory&In-Reply-To="
       TITLE="[Twisted-Python] ReconnectingClientFactory &amp; stopFactory">andrew-twisted at puzzling.org
       </A><BR>
    <I>Sun Sep  1 22:46:49 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001568.html">[Twisted-Python] random security thoughts
</A></li>
        <LI>Next message: <A HREF="001570.html">[Twisted-Python] ReconnectingClientFactory &amp; stopFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1569">[ date ]</a>
              <a href="thread.html#1569">[ thread ]</a>
              <a href="subject.html#1569">[ subject ]</a>
              <a href="author.html#1569">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think there might be a slight issue with the current client API.  If
the API is fine, the docs need improving! :)

Say you've subclasses ReconnectingClientFactory to connect to a database
in startFactory, disconnect in stopFactory.  If takes several connection
attempts, then multiple connections to the database will be opened and
closed (assuming this factory is only constructing one client, which is
the usual case, I suspect).

The problem appears to be that BaseConnector (in
twisted.internet.default) will always call stopFactory from
connectionLost/connectionFailed if it's state is 'disconnected', even if
it is between retries, because the connector knows nothing of the retry
logic in the Factory.

Does this sound like a geniune flaw, or am I misunderstanding something?
:<i>)
</I>
I'm wondering if perhaps the solution would be to add a method (or
methods) to IConnector that let clientConnectionLost and
clientConnectionFailed signal to the connector that it isn't done using
that connector yet.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001568.html">[Twisted-Python] random security thoughts
</A></li>
	<LI>Next message: <A HREF="001570.html">[Twisted-Python] ReconnectingClientFactory &amp; stopFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1569">[ date ]</a>
              <a href="thread.html#1569">[ thread ]</a>
              <a href="subject.html#1569">[ subject ]</a>
              <a href="author.html#1569">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
