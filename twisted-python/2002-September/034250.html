<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] [PATCH] manhole example, docs update
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%5BPATCH%5D%20manhole%20example%2C%20docs%20update&In-Reply-To=%3C20020925.050748.78720481.warner%40lothar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034248.html">
   <LINK REL="Next"  HREF="034256.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] [PATCH] manhole example, docs update</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%5BPATCH%5D%20manhole%20example%2C%20docs%20update&In-Reply-To=%3C20020925.050748.78720481.warner%40lothar.com%3E"
       TITLE="[Twisted-Python] [PATCH] manhole example, docs update">warner at lothar.com
       </A><BR>
    <I>Wed Sep 25 06:07:48 MDT 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034248.html">[Twisted-Python] Bits from the ARM
</A></li>
        <LI>Next message (by thread): <A HREF="034256.html">[Twisted-Python] [PATCH] manhole example, docs update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34250">[ date ]</a>
              <a href="thread.html#34250">[ thread ]</a>
              <a href="subject.html#34250">[ subject ]</a>
              <a href="author.html#34250">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Based upon a suggestion by Acapnotic, I wrote up a small example of how to
get started with the 'manhole' service (both a server and a transcript of
accessing the Application and changing the type of server). It's attached
here, in the form of a patch to docs/howto/manhole.html, and a sample server
to put in docs/examples/manhole.py . Hope you find it useful.

cheers,
 -Brian
-------------- next part --------------
#! /usr/bin/python

# demonstrate use of manhole to modify a running server

from twisted.internet.app import Application
from twisted.internet.protocol import Factory
from twisted.protocols.wire import QOTD
from twisted.tap.manhole import Options, updateApplication

app = Application(&quot;manhole-demo&quot;)

# add QOTD server
f = Factory()
f.protocol = QOTD
app.listenTCP(8123, f)

# add manhole with username and password
o = Options()
o.parseOptions([&quot;--user&quot;, &quot;username&quot;, &quot;--password&quot;, &quot;sekrit&quot;])
updateApplication(app, o)

app.run()
-------------- next part --------------
Index: doc/howto/manhole.html
===================================================================
RCS file: /cvs/Twisted/doc/howto/manhole.html,v
retrieving revision 1.6
diff -u -r1.6 manhole.html
--- doc/howto/manhole.html	20 Jun 2002 09:37:48 -0000	1.6
+++ doc/howto/manhole.html	25 Sep 2002 11:55:09 -0000
@@ -39,6 +39,24 @@
     can type arbitrary python code into the input area and get the
     results in the output area.&lt;/p&gt;
 
+    &lt;p&gt;At this point, you can get access to the main &lt;code class=&quot;API&quot;
+    base=&quot;twisted.internet.app&quot;&gt;Application&lt;/code&gt; object. You can use that
+    to obtain the &lt;code class=&quot;API&quot; base=&quot;twisted.spread.pb&quot;&gt;Service&lt;/code&gt;
+    objects inside it, or references to the &lt;code class=&quot;API&quot;
+    base=&quot;twisted.internet.protocol&quot;&gt;Factory&lt;/code&gt; objects that are
+    listening on TCP or UDP ports, by doing:&lt;/p&gt;
+
+&lt;pre class=&quot;python-interpreter&quot;&gt;
+from twisted.internet import app
+a = app.theApplication
+service = a.getServiceNamed(&quot;manhole&quot;)
+(port, factory, backlog, interface) = a.tcpPorts[0]
+&lt;/pre&gt;
+
+    &lt;p&gt;After that, you can do anything you want with those objects. A more
+    detailed example is at the bottom of this document.&lt;/p&gt;
+
+
     &lt;h2&gt;Special Commands&lt;/h2&gt;
 
     &lt;p&gt;There are a few special commands so far that make debugging
@@ -130,6 +148,71 @@
     brought to you by the &lt;code
     class=&quot;API&quot;&gt;twisted.python.explorer&lt;/code&gt; module, which was
     written largely by Kevin Turner.&lt;/p&gt;
+
+    &lt;h2&gt;Example&lt;/h2&gt;
+
+    &lt;p&gt;Here's an example of using the manhole service to examine and modify
+    a running server. The sample code starts a Quote Of The Day (&lt;code
+    class=&quot;API&quot; base=&quot;twisted.protocols.wire&quot;&gt;QOTD&lt;/code&gt;) server on port
+    8123, as well as a manhole service on the usual port 8787.&lt;/p&gt;
+
+    &lt;a href=&quot;../examples/manhole.py&quot; class=&quot;py-listing&quot;&gt;manhole.py&lt;/a&gt;
+
+    &lt;p&gt;Start this running, and test it out with &lt;code class=&quot;shell&quot;&gt;nc
+    localhost 8123&lt;/code&gt; (or &lt;code class=&quot;shell&quot;&gt;telnet localhost
+    8123&lt;/code&gt; if you don't have netcat installed).&lt;/p&gt;
+
+&lt;pre class=&quot;shell&quot;&gt;
+% nc localhost 8123
+An apple a day keeps the doctor away.
+&lt;/pre&gt;
+
+    &lt;p&gt;Then start the &lt;tt&gt;manhole&lt;/tt&gt; client and point it at the
+    application: username is &lt;tt&gt;username&lt;/tt&gt;, password is &lt;tt&gt;sekrit&lt;/tt&gt;.
+    The following is a transcript of the manhole session, and looks just
+    like the normal python interpreter, with lines you type prefixed with
+    &lt;tt&gt;&gt;&gt;&gt;&lt;/tt&gt;.&lt;/p&gt;
+
+&lt;pre class=&quot;python-interpreter&quot;&gt;
+Hello username, welcome to twisted.manhole in manhole-demo on some computer somewhere.
+Twisted 0.99.2rc2.
+
+&gt;&gt;&gt; from twisted.internet import app
+&gt;&gt;&gt; a = app.theApplication
+&gt;&gt;&gt; a
+&lt;'manhole-demo' app&gt;
+&gt;&gt;&gt; a.getServiceNamed(&quot;twisted.manhole&quot;)
+&lt;twisted.manhole.service.Service instance at 0x82d63dc&gt;
+&gt;&gt;&gt; a.tcpPorts
+[(8123, &lt;twisted.internet.protocol.Factory instance at 0x82da454&gt;, 5, ''), (8787, &lt;twisted.spread.pb.BrokerFactory instance at 0x82dac7c&gt;, 5, '')]
+&gt;&gt;&gt; f = a.tcpPorts[0][1]
+&gt;&gt;&gt; f
+&lt;twisted.internet.protocol.Factory instance at 0x82da454&gt;
+&gt;&gt;&gt; dir(f)
+['__doc__', '__implements__', '__module__', 'buildProtocol', 'doStart', 'doStop', 'noisy', 'numPorts', 'protocol', 'startFactory', 'stopFactory']
+&gt;&gt;&gt; from twisted.protocols.wire import Daytime
+&gt;&gt;&gt; a.tcpPorts[0][1].protocol = Daytime
+&lt;/pre&gt;
+
+    &lt;p&gt;Congratulations, you've just changed the Factory to use the &lt;code
+    class=&quot;API&quot; base=&quot;twisted.protocols.wire&quot;&gt;Daytime&lt;/code&gt; protocol
+    instead of the &lt;code class=&quot;API&quot;
+    base=&quot;twisted.protocols.wire&quot;&gt;QOTD&lt;/code&gt; protocol. Connect to port 8123
+    now and see the difference: you get a timestamp instead of a quote:&lt;/p&gt;
+
+&lt;pre class=&quot;shell&quot;&gt;
+% nc localhost 8123
+Wed Sep 25 11:14:58 2002
+&lt;/pre&gt;
+
+    &lt;p&gt;From here, you can do anything you want to your application. It is a
+    good idea to check the source for the &lt;code class=&quot;API&quot;
+    base=&quot;twisted.internet.app&quot;&gt;Application&lt;/code&gt; and &lt;code class=&quot;API&quot;
+    base=&quot;twisted.cred.service&quot;&gt;Service&lt;/code&gt; classes to see what else you
+    can extract from them.&lt;/p&gt;
+
+    &lt;p&gt;Have fun!&lt;/p&gt;
+
     &lt;hr /&gt;
 
     &lt;address&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034248.html">[Twisted-Python] Bits from the ARM
</A></li>
	<LI>Next message (by thread): <A HREF="034256.html">[Twisted-Python] [PATCH] manhole example, docs update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34250">[ date ]</a>
              <a href="thread.html#34250">[ thread ]</a>
              <a href="subject.html#34250">[ subject ]</a>
              <a href="author.html#34250">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
