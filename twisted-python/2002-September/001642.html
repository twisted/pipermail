<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] domtemplate examples
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20domtemplate%20examples&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001626.html">
   <LINK REL="Next"  HREF="001655.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] domtemplate examples</H1>
    <B>Bruce Mitchener</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20domtemplate%20examples&In-Reply-To="
       TITLE="[Twisted-Python] domtemplate examples">bruce at cubik.org
       </A><BR>
    <I>Fri Sep 13 14:25:34 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001626.html">[Twisted-Python] domtemplate examples
</A></li>
        <LI>Next message: <A HREF="001655.html">[Twisted-Python] domtemplate examples
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1642">[ date ]</a>
              <a href="thread.html#1642">[ thread ]</a>
              <a href="subject.html#1642">[ subject ]</a>
              <a href="author.html#1642">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I got around to solving this today for doing DB integration with webMVC:

Bruce Mitchener wrote:
&gt;<i> Does anyone have more involved examples (even ones they can only share 
</I>&gt;<i> privately for now) of using DOMTemplate than the one in doc/howto?
</I>&gt;<i> 
</I>&gt;<i> Examples of form integration and DB integration like outputting lists of 
</I>&gt;<i> things from a result set of a query would all be welcome.
</I>
The patch below makes the standard domwidgets.List friendly for 
Deferreds.  Similar things need to be done to the other widgets as well 
if that's the path that should be taken.

This code sucks for various reasons, but actually works:

class MIdentityList(wmvc.WModel):
     def __init__(self):
         self.dbpool = adbapi.ConnectionPool('pyPgSQL.PgSQL',
                                             'localhost',
                                             'bruce', 'XXXXXXXXX',
                                             database='XXXXXXXXX')
         self.dbauth = authorizer.Authorizer(self.dbpool)
         self.identityList = self.getIdentities()

     def setIdentities(self, result):
         self.identityList = result
     def getIdentities(self):
         return self.dbauth.getIdentities().addCallback(self.setIdentities)

class IdentityListWidget(domwidgets.Widget):
     def generateDOM(self, request, node):
         &quot;&quot;&quot;
         Generate DOM to represent a list of identities.
         &quot;&quot;&quot;
         if isinstance(self.model.identityList, defer.Deferred):
             return self.identityList
         self.add(domwidgets.List())
         return domwidgets.Widget.generateDOM(self, request, node)

class VIdentityList(wmvc.WView):
     templateFile = &quot;identity_list.xhtml&quot;
     def factory_identityList(self, request, node):
         return IdentityListWidget(self.model)

class CIdentityList(wmvc.WController):
     pass

wmvc.registerViewForModel(VIdentityList, MIdentityList)

Am I doing anything that is horribly wrong (apart from obvious things, 
like not grabbing a service and starting up the authorizer inside of the 
model), and that isn't likely to work beyond a simple test case like this?

I do like how the Deferreds integrate in with the DOMTemplate and webMVC 
stuff.  Pretty nice work, once I figured it out. :)

  - Bruce

Index: domwidgets.py
===================================================================
RCS file: /cvs/Twisted/twisted/web/domwidgets.py,v
retrieving revision 1.19
diff -u -r1.19 domwidgets.py
--- domwidgets.py       19 Aug 2002 03:22:01 -0000      1.19
+++ domwidgets.py       13 Sep 2002 18:13:59 -0000
@@ -3,6 +3,7 @@
  import urllib
  from xml.dom.minidom import parseString

+from twisted.internet import defer
  from twisted.python.mvc import View, Model
  from twisted.python import domhelpers, log

@@ -262,11 +263,14 @@
      &quot;&quot;&quot;
      tagName = None
      def generateDOM(self, request, node):
+        data = self.getData()
+        if isinstance(data, defer.Deferred):
+            return data.addCallback(self._cbGenerateDOM, request, node)
          node = Widget.generateDOM(self, request, node)
          # xxx with this implementation all elements of the list must 
use the same view widget
          listItem = domhelpers.get(node, 'listItem')
          domhelpers.clearNode(node)
-        for itemNum in range(len(self.getData())):
+        for itemNum in range(len(data)):
              # theory: by appending copies of the li node
              # each node will be handled once we exit from
              # here because handleNode will then recurse into
@@ -277,6 +281,10 @@
              domhelpers.superPrependAttribute(newNode, 'model', 
self.submodel + '[' + str(itemNum) + ']')
              node.appendChild(newNode)
          return node
+
+    def _cbGenerateDOM(self, result, request, node):
+        return self.generateDOM(request, node)
+

  class ColumnList(List):
      def __init__(self, model, columns=1, start=0, end=0):



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001626.html">[Twisted-Python] domtemplate examples
</A></li>
	<LI>Next message: <A HREF="001655.html">[Twisted-Python] domtemplate examples
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1642">[ date ]</a>
              <a href="thread.html#1642">[ thread ]</a>
              <a href="subject.html#1642">[ subject ]</a>
              <a href="author.html#1642">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
