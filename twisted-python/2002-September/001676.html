<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] DBReflector.loadObjectFrom question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20DBReflector.loadObjectFrom%20question&In-Reply-To=200209190343.g8J3hrR59424%40mailserver2.hushmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001675.html">
   <LINK REL="Next"  HREF="001741.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] DBReflector.loadObjectFrom question</H1>
    <B>Sean Riley</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20DBReflector.loadObjectFrom%20question&In-Reply-To=200209190343.g8J3hrR59424%40mailserver2.hushmail.com"
       TITLE="[Twisted-Python] DBReflector.loadObjectFrom question">sean at twistedmatrix.com
       </A><BR>
    <I>Thu Sep 19 14:25:32 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001675.html">[Twisted-Python] DBReflector.loadObjectFrom question
</A></li>
        <LI>Next message: <A HREF="001741.html">[Twisted-Python] twisted.web.woven.controller -- minor bugfix [PATCH]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1676">[ date ]</a>
              <a href="thread.html#1676">[ thread ]</a>
              <a href="subject.html#1676">[ subject ]</a>
              <a href="author.html#1676">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>there have been changes to improve the Row interface recently. Here is your
code modified to use the new interface:

from twisted.enterprise import adbapi, row, dbreflector
from twisted.internet import app

class AcctRow( row.RowObject ):
    rowColumns = [
        'id',
        't_id',
        'name',
        'label'
        ]
    rowKeyColumns = [( 'id', 'int4' )]
    rowTableName = &quot;acct&quot;

    def __repr__( self ):
        return 'Acct: &lt;%d %s&gt;' % ( self.id, self.name )


def gotData( data ):
    print &quot;got Data:&quot;, data

def refInit( result ):
    print 'refInit', result
    reflector.loadObjectsFrom( 'acct' ).addCallback( gotData)

dbpool = adbapi.ConnectionPool(&quot;pyPgSQL.PgSQL&quot;, database=&quot;sean&quot;,
host=&quot;localhost&quot;, port=5432)
reflector = dbreflector.SQLReflector( dbpool,[ AcctRow], refInit)

application = app.Application('rowTest')
application.run(save=0)

BTW, loadObjects must be run _after_ the reflector has been initialized
(after refInit) has been invoked because the initialization may be
asynchronous.

here is the above code running:

$ python e.py
Connecting to database: pyPgSQL.PgSQL () {'host': 'localhost'}
Enabling Multithreading.
starting waker
adbapi connecting: pyPgSQL.PgSQL {'host': 'localhost', 'port': 5432,
'database': 'sean'}
refInit None
got Data: [Acct: &lt;1 afd&gt;, Acct: &lt;2 afd&gt;, Acct: &lt;3 afd&gt;, Acct: &lt;4 afd&gt;, Acct:
&lt;5 afd&gt;]


-----Original Message-----
From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-admin at twistedmatrix.com</A>
[mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-admin at twistedmatrix.com</A>]On Behalf Of
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">carball at hush.com</A>
Sent: Wednesday, September 18, 2002 10:44 PM
To: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Subject: [Twisted-Python] DBReflector.loadObjectFrom question



greetings,

using loadObjectsFrom, it seems the RowClass i am passing in
should have dbColumns with data in it in order to build a
correct sql query. .

where does said data come from?
my dbColumns is just an empty list

also, i dont understand why i have to tell an instantiated
DBReflector what tablename, keys, and RowClass to use again in
loadObjectsFrom?

i apologize if i'm missing something obvious
i've read 'some' T.enterprise code, not enough to
understand it all. .

thanks in advance,
cary

--------------code-----------------------------
#!/usr/bin/env python
from twisted.enterprise import adbapi, row
from twisted.internet import app

class AcctRow( row.RowObject ):
rowColumns = [
'id',
't_id',
'name',
'label'
]
dbKeyColumns = [( 'id', 'int4' )]
def __repr__( self ):
return '%d %s' % ( self.id, self.name )

def refInit( result ):
print 'refInit', result

dbpool = adbapi.ConnectionPool( 'pyPgSQL.PgSQL' )
reflector = row.DBReflector( dbpool,
[( AcctRow,
'acct',
AcctRow.dbKeyColumns )],
refInit )

reflector.loadObjectsFrom( 'acct',
AcctRow.dbKeyColumns,
None,
AcctRow )

application = app.Application('rowTest')
application.run(save=0)

---------------------------
this fails in DBReflector._objectLoader, dbColumns is []??????
i'm using twisted 0.99.0

-----------output------------------
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">car at platypus</A> car $ ./rowTest.py
Installing SelectReactor, since unspecified.
Connecting to database: pyPgSQL.PgSQL ('',) {}
Enabling Multithreading.
adbapi connecting: pyPgSQL.PgSQL ('',)
Exception in SQL interaction! rolling back...
Traceback (most recent call last):
File '/usr/lib/python2.2/site-packages/twisted/enterprise/adbapi.py', line
154
, in _runInteraction
result = apply(interaction, (trans,)+args, kw)
File '/usr/lib/python2.2/site-packages/twisted/enterprise/row.py', line 245,
i
n _objectLoader
transaction.execute(sql)
File '/usr/lib/python2.2/site-packages/pyPgSQL/PgSQL.py', line 2393, in
execut
e
adbapi connecting: pyPgSQL.PgSQL ('',)
raise OperationalError, msg
libpq.OperationalError: ERROR: parser: parse error at or near 'FROM'

Traceback (most recent call last):
File '/usr/lib/python2.2/site-packages/twisted/internet/threads.py', line
33,
in _putResultInDeferred
result = apply(f, args, kwargs)
File '/usr/lib/python2.2/site-packages/twisted/enterprise/adbapi.py', line
154
, in _runInteraction
result = apply(interaction, (trans,)+args, kw)
File '/usr/lib/python2.2/site-packages/twisted/enterprise/row.py', line 245,
i
n _objectLoader
transaction.execute(sql)
File '/usr/lib/python2.2/site-packages/pyPgSQL/PgSQL.py', line 2393, in
execut
e
raise OperationalError, msg
libpq.OperationalError: ERROR: parser: parse error at or near 'FROM'

refInit None
Main loop terminated.





Get your free encrypted email at <A HREF="https://www.hushmail.com">https://www.hushmail.com</A>

_______________________________________________
Twisted-Python mailing list
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001675.html">[Twisted-Python] DBReflector.loadObjectFrom question
</A></li>
	<LI>Next message: <A HREF="001741.html">[Twisted-Python] twisted.web.woven.controller -- minor bugfix [PATCH]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1676">[ date ]</a>
              <a href="thread.html#1676">[ thread ]</a>
              <a href="subject.html#1676">[ subject ]</a>
              <a href="author.html#1676">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
