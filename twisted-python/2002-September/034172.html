<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] persistence interface
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20persistence%20interface&In-Reply-To=%3C20020915.182343.78715437.glyph%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034169.html">
   <LINK REL="Next"  HREF="034173.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] persistence interface</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20persistence%20interface&In-Reply-To=%3C20020915.182343.78715437.glyph%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] persistence interface">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Sep 15 17:23:43 MDT 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034169.html">[Twisted-Python] persistence interface
</A></li>
        <LI>Next message (by thread): <A HREF="034173.html">[Twisted-Python] persistence interface 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34172">[ date ]</a>
              <a href="thread.html#34172">[ thread ]</a>
              <a href="subject.html#34172">[ subject ]</a>
              <a href="author.html#34172">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Let me give some exposition of the ideas that lead to this, since the
persistence-adaptor style that Sean is proposing was at my suggestion, inspired
by what he's done so far on the Row API.

On Sun, 15 Sep 2002 14:15:29 -0400, Itamar Shtull-Trauring &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>&gt; wrote:
&gt;<i> So now we have the following persistence APIs:
</I>
&gt;<i> 1. getStateToPersist
</I>
The idea here is that it's specifically for relational, or &quot;essential&quot;
persistence, not complete persistence.  In order for this kind of persistence
to work, your objects need to have a fixed list of fixed and some semantic
meaning associated with any object references: containership, ownership, or
weak reference.

So you can't return a dictionary of arbitrary data; you return a dictionary of
the attributes that the persistence layer expects to see.

This also doesn't handle object versioning, since it expects your persistence
layer to impose some sort of structure on your data.  (You can't upgrade a
relational database without some serious effort and forethought in any event.)

&gt;<i> 2. getStateToCopy
</I>
This is for remote mirroring.  Now, I am tempted to suggest this be used for
persistence adapters as well, since the full name of this method is
getStateToCopy*For*, and it takes the serializer object (which could quite well
be a database reflector).

However, I think the differences are more subtle than that, since as I
mentioned, information about containership will probably need to be part of the
persistence-adapter API.

Not only is it meant to have semntic parity with relational databases (at least
for its first incarnation), it's only supposed to be persisting state that an
object absolutely &quot;needs&quot;; any duplicated data such as cached references,
backreferences to &quot;parent&quot; objects, or, in the relational case, lists that
point to child objects, need not be saved.  This means that rather than the
traditional way of handling class updating in Twisted, input one state, output
a new, fixed state for new versions of the class, is unworkable.  You can
change the internal representation of the object as much as you want, as long
as you can still re-build it from the info you got from the database.

We will be able to avoid the 'for' argument in getStateToPersist because we
will have different, specialized adapter interfaces for different kinds of
persistence.  FramerD needs very different information about an object's state
than a database would, but it's likely that none of the existing state methods
will suffice.

&gt;<i> 3. __getstate__
</I>
This is for full, faithful replication of objects to trusted sources, such as
.tap files.  There should be as little perturbation as possible in an object's
__getstate__ method; really, the only thing this should do it provide
versioning and remove attributes which are simply not persistable.

Consider using __getstate__ for a schema migration tool: dumping a database to
a large pickle with one version of a codebase, then loading it with a new
version and undumping it back into another database with a new schema.

&gt;<i> 4. Whatever it is marmalade is using
</I>
Ugh.

This one is the one I'd think of eliminating, if we're going to think of
eliminating one.  It's rather overcomplex to produce a sensible-looking object
hierarchy with DOM, and very hard to get it right.  That's why I eventually
gave up on sensibility and just settled for correctness in Application ;).

&gt;<i> I don't see any difference between (1) and (3), since they both return
</I>&gt;<i> dictionary that is used in persistence. Just make the requirements for
</I>&gt;<i> __getstate__ to be more strict when implementing IPersistence.
</I>
That would be rather difficult, since IPersistence may want to expect things
like indexing in order to reverse properly.

&gt;<i> How many persistence APIs do we need?!
</I>
As many as there are persistence mechanisms that people want to use with
Twisted :-).

-- 
 |    &lt;`'&gt;    |  Glyph Lefkowitz: Traveling Sorcerer   |
 |   &lt; _/ &gt;   |  Lead Developer,  the Twisted project  |
 |  &lt; ___/ &gt;  |      <A HREF="http://www.twistedmatrix.com">http://www.twistedmatrix.com</A>      |
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20020915/f7713295/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034169.html">[Twisted-Python] persistence interface
</A></li>
	<LI>Next message (by thread): <A HREF="034173.html">[Twisted-Python] persistence interface 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34172">[ date ]</a>
              <a href="thread.html#34172">[ thread ]</a>
              <a href="subject.html#34172">[ subject ]</a>
              <a href="author.html#34172">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
