<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] interface for Last-Modified
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20interface%20for%20Last-Modified&In-Reply-To=1032925819.14657.338.camel%40troglodyte.funhouse">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001734.html">
   <LINK REL="Next"  HREF="001735.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] interface for Last-Modified</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20interface%20for%20Last-Modified&In-Reply-To=1032925819.14657.338.camel%40troglodyte.funhouse"
       TITLE="[Twisted-Python] interface for Last-Modified">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Sep 25 02:07:00 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001734.html">[Twisted-Python] interface for Last-Modified
</A></li>
        <LI>Next message: <A HREF="001735.html">[Twisted-Python] FAILED (failures=1, errors=1164)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1736">[ date ]</a>
              <a href="thread.html#1736">[ thread ]</a>
              <a href="subject.html#1736">[ subject ]</a>
              <a href="author.html#1736">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 24 Sep 2002 20:50:18 -0700, Kevin Turner &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.m.turner at pobox.com</A>&gt; wrote:
&gt;<i> itamar has led me to what looks to be a much more elegant solution. 
</I>&gt;<i> Since the only resources that worry about receiving conditional requests
</I>&gt;<i> are those that set cache validation headers (such as &quot;Last-Modified&quot;),
</I>&gt;<i> the check to see if you're dealing with a conditional request can go in
</I>&gt;<i> the L{http.Request.setLastModified} method.  setLastModified's return
</I>&gt;<i> value can then let the caller know if they date they gave was older than
</I>&gt;<i> the one in the conditional request, so they don't have to render the
</I>&gt;<i> body of the request.  And this works, because Last-Modified being a
</I>&gt;<i> header and all, you're having to set it before you write the request
</I>&gt;<i> body anyway.
</I>
Wow!  This is not a solution I would have thought of, but I agree that it's
very clean.  If you've got this implemented, you're probably 99% of the way
there.

&gt;<i> and I was all ready to check it in, until I tried to apply it in my
</I>&gt;<i> actual use-case, using it in a superclass::
</I>
Your use-case is pretty much complete except for one thing:
(widgets.Widget, mvc.View):
&gt;<i>         def display(self, request):
</I>&gt;<i>             if request.setLastModified(self.lastModified) is http.CACHED:
</I>&gt;<i>                 # Body should be empty.
</I>&gt;<i>                 return ''
</I>&gt;<i>             else:
</I>&gt;<i>                 # Body is rendered by subclass.
</I>&gt;<i>                 return ''
</I>                  ^^^^^^^^^

Since this is a new superclass, we can redefine the interface of its subclasses
and change them not to be regular widgets.  Since .display() is rather
higher-level than .render() it might even make sense to do this at the
top-level render() rather than in a subclass...  Though twisted.web.widgets is
hopefully going away once woven is well-documented and provides replacements
for everything...  For an initial release, though, something like this:

                  return self.displayBody(request)

Worst case, if in the future this API is later supported at a lower level in
Widget itself, setLastModified will be called twice with the same argument.

&gt;<i>     class RssChannel(AbstractCommitList):
</I>&gt;<i>         def display(self, request):
</I>          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
and this would, of course, be

          def displayBody(self, request):
&gt;<i>             s = AbstractCommitList.display(self, request)
</I>&gt;<i>             # Now how do I know if I'm supposed to render the body or not?
</I>
Probably for the initial implementation, the only class to support this in the
base should be static.File.

-- 
 |    &lt;`'&gt;    |  Glyph Lefkowitz: Traveling Sorcerer   |
 |   &lt; _/ &gt;   |  Lead Developer,  the Twisted project  |
 |  &lt; ___/ &gt;  |      <A HREF="http://www.twistedmatrix.com">http://www.twistedmatrix.com</A>      |
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20020925/938f8aec/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20020925/938f8aec/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001734.html">[Twisted-Python] interface for Last-Modified
</A></li>
	<LI>Next message: <A HREF="001735.html">[Twisted-Python] FAILED (failures=1, errors=1164)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1736">[ date ]</a>
              <a href="thread.html#1736">[ thread ]</a>
              <a href="subject.html#1736">[ subject ]</a>
              <a href="author.html#1736">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
