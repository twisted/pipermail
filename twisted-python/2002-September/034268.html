<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] This forces a last modified header [...]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20This%20forces%20a%20last%20modified%0A%20header%20%5B...%5D&In-Reply-To=%3C3D939C13.4000702%40cubik.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034267.html">
   <LINK REL="Next"  HREF="034269.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] This forces a last modified header [...]</H1>
    <B>Bruce Mitchener</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20This%20forces%20a%20last%20modified%0A%20header%20%5B...%5D&In-Reply-To=%3C3D939C13.4000702%40cubik.org%3E"
       TITLE="[Twisted-Python] Re: [Twisted-commits] This forces a last modified header [...]">bruce at cubik.org
       </A><BR>
    <I>Thu Sep 26 17:45:23 MDT 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034267.html">[Twisted-Python] Re: [Twisted-commits] This forces a last modified header [...]
</A></li>
        <LI>Next message (by thread): <A HREF="034269.html">[Twisted-Python] Re: [Twisted-commits] Make the previous patch a little lazier by only getting the model if it's really needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34268">[ date ]</a>
              <a href="thread.html#34268">[ thread ]</a>
              <a href="subject.html#34268">[ subject ]</a>
              <a href="author.html#34268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Kevin,

Thanks for the constructive feedback!

Kevin Turner wrote:
&gt;&gt;<i>+            # Set the last modified date to ask the browser to
</I>&gt;&gt;<i>+            # not use a cached version.
</I>&gt;&gt;<i>+            request.setLastModified(time.time())
</I>&gt;<i> 
</I>&gt;<i> Setting Last-Modified does not ask the browser not to use a cached
</I>&gt;<i> version.  Setting Last-Modified *allows* the browser to use a cached
</I>&gt;<i> version.  Setting it to now() is not the best way to say &quot;don't use a
</I>&gt;<i> cache&quot;, particularly if it had no Last-Modified header on it before. 
</I>&gt;<i> Default behaviour is to always send the full page anyway, nothing will
</I>&gt;<i> ever change that to NOT_MODIFIED if you never do setLastModified.
</I>&gt;<i> 
</I>&gt;<i> If you don't want a page to be cached, you must set the conditions under
</I>&gt;<i> which a cache may be used for that page the *first time* you send it.
</I>
This sort of thing had worked on a previous project, but I suspect that, 
as you said, we were sending the Last-Modified header all the time 
rather than only occasionally like my change made.

The reason that things looked like it was not working correctly was due 
to some asynch handling of page rendering, which was somewhat amusing.

On a page with 2 widgets that did DB queries and that was the target of 
a form submission, this sort of thing could happen:

    * Form submission happens on page 1
    * Woven stuff runs, runs the form code on the server.
    * Commit method fires off asynch DB operation.
    * Browser redirect is issued.
    * Browser requests target page 2.
    * Woven starts to render page 2.
    * Widget 1 gets rendered with DB data.
    * The asynch DB operation finally runs and commits.
    * Widget 2 gets rendered with updated DB data.
    * User views page 2.

Due to the nature of widget 2 on page 2, it wasn't obvious that this was 
happening originally.  Donovan and I are working on making the form 
processing parts of Woven asynch friendly now and one of us will 
hopefully check something in tonight. Either way, I'll remove the buggy 
LastModified code this evening.

&gt;<i> I'm not sure exactly what your situation is, so I won't try to go into
</I>&gt;<i> detail, but I suggest browsing over
</I>&gt;<i> <A HREF="http://www.mnot.net/cache_docs/#CONTROL">http://www.mnot.net/cache_docs/#CONTROL</A>
</I>
Thanks for the pointer.  I'll definitely read through that.

  - Bruce



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034267.html">[Twisted-Python] Re: [Twisted-commits] This forces a last modified header [...]
</A></li>
	<LI>Next message (by thread): <A HREF="034269.html">[Twisted-Python] Re: [Twisted-commits] Make the previous patch a little lazier by only getting the model if it's really needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34268">[ date ]</a>
              <a href="thread.html#34268">[ thread ]</a>
              <a href="subject.html#34268">[ subject ]</a>
              <a href="author.html#34268">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
