<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] most efficient new connection rate limiting?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20most%20efficient%20new%20connection%20rate%20limiting%3F&In-Reply-To=%3C20090205072508.GA27714%40thorne.id.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051653.html">
   <LINK REL="Next"  HREF="051658.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] most efficient new connection rate limiting?</H1>
    <B>Stephen Thorne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20most%20efficient%20new%20connection%20rate%20limiting%3F&In-Reply-To=%3C20090205072508.GA27714%40thorne.id.au%3E"
       TITLE="[Twisted-Python] most efficient new connection rate limiting?">stephen at thorne.id.au
       </A><BR>
    <I>Thu Feb  5 00:25:08 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051653.html">[Twisted-Python] most efficient new connection rate limiting?
</A></li>
        <LI>Next message (by thread): <A HREF="051658.html">[Twisted-Python] Twisted Sprint in February
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51655">[ date ]</a>
              <a href="thread.html#51655">[ thread ]</a>
              <a href="subject.html#51655">[ subject ]</a>
              <a href="author.html#51655">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2009-02-04, Alec Matusis wrote:
&gt;<i> 1) Create an dictionary {ip1:count1, ip2: count2, .} in the server, and
</I>&gt;<i> check the counts for each incoming connection. 
</I>&gt;<i> Disconnect with transport.loseConnection() if the threshold for ip:count is
</I>&gt;<i> exceeded.
</I>&gt;<i> Reset this dictionary to empty dict {} every minute with reactor.callLater
</I>&gt;<i> timer.
</I>&gt;<i> 
</I>&gt;<i> 2) Use some Twisted rate limiter API that I am not familiar with?
</I>&gt;<i> 
</I>&gt;<i> 3) Use iptables rate-limiting module like so:
</I>&gt;<i> iptables -I INPUT -p tcp --dport 8888 -i eth0 -m state --state NEW -m recent
</I>&gt;<i> --set
</I>&gt;<i> iptables -I INPUT -p tcp --dport 8888 -i eth0 -m state --state NEW -m recent
</I>&gt;<i> --update --seconds 60 --hitcount 10 -j DROP
</I>
I would recommend approach (3) because approach (1) will do an accept()
of the connection and then drop it, giving the host on the other end a
syn/ack transaction followed by a closed connection, and then it will
probably attempt to reconnect immediately.

Whereas (3) relies on the tcp/ip stack of the connecting host to send a
bunch of syn packets until it gets through, or times out and follows its
timeout logic.

-- 
Regards,
Stephen Thorne
Development Engineer
NetBox Blue - 1300 737 060

NetBox Blue is proud to be a sponsor and exhibitor at IBM's Solutions 
Showcase 2009 events. These are held in Perth, Adelaide, Brisbane, Sydney and 
Melbourne in February and March. 
For more details and to register please visit: 
<A HREF="http://www.ibm.com/solutionsshowcase/au">http://www.ibm.com/solutionsshowcase/au</A>


Scanned by the NetBox from NetBox Blue
(<A HREF="http://netboxblue.com/">http://netboxblue.com/</A>)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051653.html">[Twisted-Python] most efficient new connection rate limiting?
</A></li>
	<LI>Next message (by thread): <A HREF="051658.html">[Twisted-Python] Twisted Sprint in February
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51655">[ date ]</a>
              <a href="thread.html#51655">[ thread ]</a>
              <a href="subject.html#51655">[ subject ]</a>
              <a href="author.html#51655">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
