<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Why do I get an AlreadyCalledError?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Why%20do%20I%20get%20an%20AlreadyCalledError%3F&In-Reply-To=EAED0465-9458-44D2-8AC1-B6F4EBFD57E8%40me.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019255.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Why do I get an AlreadyCalledError?</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Why%20do%20I%20get%20an%20AlreadyCalledError%3F&In-Reply-To=EAED0465-9458-44D2-8AC1-B6F4EBFD57E8%40me.com"
       TITLE="[Twisted-Python] Why do I get an AlreadyCalledError?">exarkun at divmod.com
       </A><BR>
    <I>Sat Feb 28 22:06:22 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019255.html">[Twisted-Python] Why do I get an AlreadyCalledError?
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19256">[ date ]</a>
              <a href="thread.html#19256">[ thread ]</a>
              <a href="subject.html#19256">[ subject ]</a>
              <a href="author.html#19256">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 28 Feb 2009 14:57:33 +0000, Conrad Winchester &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">conradwinchester at me.com</A>&gt; wrote:
&gt;<i>Thanks Jean-Paul,
</I>&gt;<i>
</I>&gt;<i>Useful information, but then I am confused -
</I>&gt;<i>
</I>&gt;<i>If I am running in a deferred how do I cause the errback to be called 
</I>&gt;<i>instead of the normal (non-error) callback?  How do I pass a failure  object 
</I>&gt;<i>to the error handler? How should I do the  self.process.errback(fail)?
</I>&gt;<i>
</I>&gt;<i>All of this has to happen inside of the deferred doesn't it, because  it is 
</I>&gt;<i>the deferred that is doing the work and where the errors will  occur?
</I>
If a Deferred is a container, it is a container for callbacks and results,
not for executing code.  So I wouldn't think about it in terms of &quot;happening
inside of a Deferred&quot;.  Instead, consider this definition of a function like
runInteraction (but which doesn't involve databases or threads):

    def execute(callable, *args):
        d = Deferred()
        try:
            result = callable(*args)
        except:
             d.errback()
        else:
             d.callback(result)
        return d

In its handling of Deferreds and results, this is largely what runInteraction
does.  Notice how any exception raised by `callable&#180; will be given to the
Deferred to be passed to any registered errbacks (in an &quot;except&quot; suite,
Deferred.errback with no arguments uses sys.exc_info() to find the current
exception).  This is a property of the implementation of `execute&#180;, though,
not a property of Deferred.  (However, the code which executes the callbacks
or errbacks attached to a Deferred is similar to this.)

So in your case, if you just raise an exception, the errbacks you add to
the Deferred returned by runInteraction will have it passed to them as a
failure.  (Sorry for the somewhat disjointed nature of this response, I
started writing this email hours ago and I just noticed I hadn't finished
it, but wanted to send it before I go to bed).

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019255.html">[Twisted-Python] Why do I get an AlreadyCalledError?
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19256">[ date ]</a>
              <a href="thread.html#19256">[ thread ]</a>
              <a href="subject.html#19256">[ subject ]</a>
              <a href="author.html#19256">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
