<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] mind, twisted.cred and HTTPAuthSessionWrapper
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20mind%2C%20twisted.cred%20and%20HTTPAuthSessionWrapper&In-Reply-To=200902192022.30377.esteve%40sindominio.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019207.html">
   <LINK REL="Next"  HREF="019209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] mind, twisted.cred and HTTPAuthSessionWrapper</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20mind%2C%20twisted.cred%20and%20HTTPAuthSessionWrapper&In-Reply-To=200902192022.30377.esteve%40sindominio.net"
       TITLE="[Twisted-Python] mind, twisted.cred and HTTPAuthSessionWrapper">exarkun at divmod.com
       </A><BR>
    <I>Thu Feb 19 14:59:19 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019207.html">[Twisted-Python] mind, twisted.cred and HTTPAuthSessionWrapper
</A></li>
        <LI>Next message: <A HREF="019209.html">[Twisted-Python] mind, twisted.cred and HTTPAuthSessionWrapper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19208">[ date ]</a>
              <a href="thread.html#19208">[ thread ]</a>
              <a href="subject.html#19208">[ subject ]</a>
              <a href="author.html#19208">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 19 Feb 2009 20:22:30 +0100, Esteve Fernandez &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">esteve at sindominio.net</A>&gt; wrote:
&gt;<i>On Thursday 19 February 2009 19:46:59 Jean-Paul Calderone wrote:
</I>&gt;&gt;<i> &gt;But, in our case, requestAvatar can only return something based on what
</I>&gt;&gt;<i> &gt; the checker returns. I mean, requestAvatar receives an avatarId (as a
</I>&gt;&gt;<i> &gt; result of Checker#requestAvatarId), a mind and a bunch of interfaces, but
</I>&gt;&gt;<i> &gt; the realm doesn't have any other information.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;What our checker does to authenticate an user, is to call a method on a
</I>&gt;&gt;<i> &gt; remote service and get back an object (a token) that represents the state
</I>&gt;&gt;<i> &gt; of a conversation between a client and that remote service. Then, the
</I>&gt;&gt;<i> &gt; client may issue more remote calls using the previously received token.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;We're using Twisted.web only as a front end to a remote service, and we'd
</I>&gt;&gt;<i> &gt; like to make it as decoupled as possible, as there will be other
</I>&gt;&gt;<i> &gt; frontends.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What if you use the token as the avatarId?
</I>&gt;<i>
</I>&gt;<i>But the general contract for requestAvatarId is to return a string identifying
</I>&gt;<i>the user. From ICredentialsChecker#requestAvatarId documentation:
</I>&gt;<i>
</I>&gt;<i>&quot;Returns - a Deferred which will fire a string which identifies an avatar, an
</I>&gt;<i>empty tuple to specify an authenticated anonymous user (provided as
</I>&gt;<i>checkers.ANONYMOUS) or fire a Failure(UnauthorizedLogin). Alternatively,
</I>&gt;<i>return the result itself.&quot;
</I>&gt;<i>
</I>&gt;<i>If so, our problem is that the token is an object that contains more
</I>&gt;<i>information (a timestamp, a cryptographic signature, etc.), so serializing
</I>&gt;<i>and deserializing it everytime we need that information is a bit cumbersome.
</I>&gt;<i>The remote service checks that token everytime it receives a call, and
</I>&gt;<i>responds with an appropiate response.
</I>
The convention is for avatarId to be a string, but as the anonymous case
indicates, that's not strictly required. :)  The real requirement is that
the realm be able to interpret the avatarId.  The way this generally works
is by making it a username string, but you're in charge of the realm, so it
can be whatever you like.  Of course, this makes it harder to re-use either
your checker or your realm with different components, but sometimes that's
okay.  It might be nice if this were explained in some document somewhere
but I don't think the current cred document should cover it, since going
into complex and subtle points like this tends to make it harder to get
the basic idea.  An advanced cred howto of some sort might be merited.

&gt;&gt;<i> &gt;I tried to mimic PB's behaviour, in the sense that (as the cred
</I>&gt;&gt;<i> &gt; documentation puts out):
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&quot;it is an object which serves an important role - any notifications which
</I>&gt;&gt;<i> &gt; are to be relayed to an authenticated client are passed through a 'mind'.
</I>&gt;&gt;<i> &gt; In addition, it allows passing more information to the realm during login
</I>&gt;&gt;<i> &gt; in addition to the avatar ID.&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is technically true but as far as I know no one has ever actually used
</I>&gt;&gt;<i> it that way.  I'm trying to think of an authentication scheme which would
</I>&gt;&gt;<i> benefit from it (let alone require it), but I'm drawing a blank.  PB just
</I>&gt;&gt;<i> has enough expressive power already to really need this.
</I>&gt;<i>
</I>&gt;<i>In that case, (although we might not actually need a mind in the end), would
</I>&gt;<i>PB have the same problem with HTTPAuthSessionWrapper? The mind argument is
</I>&gt;<i>always None (in HTTPAuthSessionWrapper#_login):
</I>
I'm not quite sure what you mean here - how should I equate PB and
HTTPAuthSessionWrapper?

&gt;<i>    def _login(self, credentials):
</I>&gt;<i>        d = self._portal.login(credentials, None, IResource)
</I>&gt;<i>        d.addCallbacks(self._loginSucceeded, self._loginFailed)
</I>&gt;<i>        return d
</I>&gt;<i>
</I>&gt;<i>So, I think HTTPAuthSessionWrapper should have a method (e.g.
</I>&gt;<i>createMind(self)), which would return None by default and that could be
</I>&gt;<i>overridden by subclasses if they need to return something else. I'll gladly
</I>&gt;<i>file an issue, provide a patch and a test case, if you think it's a valid
</I>&gt;<i>issue.
</I>
It probably *is* a good idea to allow the mind to be created somehow.  It
was only omitted because no obvious use-cases presented themselves at the
time.  I'm still not really convinced that this use case is a good one
though, so I'm not sure I'd be in favor of adding the hook now in order
to support this. ;)

In general, the mind feature of cred is underutilized, underdocumented,
and poorly understood.  Fixing these problems is great, but it may also
be the case that the mind is such an obscure use-case that most people
really just don't care about it.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019207.html">[Twisted-Python] mind, twisted.cred and HTTPAuthSessionWrapper
</A></li>
	<LI>Next message: <A HREF="019209.html">[Twisted-Python] mind, twisted.cred and HTTPAuthSessionWrapper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19208">[ date ]</a>
              <a href="thread.html#19208">[ thread ]</a>
              <a href="subject.html#19208">[ subject ]</a>
              <a href="author.html#19208">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
