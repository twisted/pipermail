<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] What to do when a service fails to start, also, 	deferred and startService
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20What%20to%20do%20when%20a%20service%20fails%20to%20start%2C%20also%2C%20%0A%09deferred%20and%20startService&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019227.html">
   <LINK REL="Next"  HREF="019226.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] What to do when a service fails to start, also, 	deferred and startService</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20What%20to%20do%20when%20a%20service%20fails%20to%20start%2C%20also%2C%20%0A%09deferred%20and%20startService&In-Reply-To="
       TITLE="[Twisted-Python] What to do when a service fails to start, also, 	deferred and startService">terry at jon.es
       </A><BR>
    <I>Thu Feb 26 07:25:46 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019227.html">[Twisted-Python] What to do when a service fails to start, also,	deferred and startService
</A></li>
        <LI>Next message: <A HREF="019226.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19249">[ date ]</a>
              <a href="thread.html#19249">[ thread ]</a>
              <a href="subject.html#19249">[ subject ]</a>
              <a href="author.html#19249">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Following up on myself....  Here's an updated/working version of the
MultiService subclass I proposed the other day:

    class GuardedMultiService(service.MultiService):

        def __init__(self, guardService):
            service.MultiService.__init__(self)
            self.guardService = guardService
            self.startDeferred = defer.Deferred()
            self.stopDeferred = defer.Deferred()

        def startService(self):
            def startOthers(_):
                log.msg(&quot;Guard service startup succeeded. Starting other services.&quot;)
                service.MultiService.startService(self)
            def initFailed(f):
                log.msg(&quot;Guard service startup failed.&quot;)
                return f
            d = defer.maybeDeferred(self.guardService.startService)
            d.addCallbacks(startOthers, initFailed)
            d.chainDeferred(self.startDeferred)

        def stopService(self):
            d = service.MultiService.stopService(self)
            d.addCallback(lambda _: self.guardService.stopService())
            d.chainDeferred(self.stopDeferred)
            return self.stopDeferred


This is pretty much as I described earlier.

I've added self.startDeferred and self.stopDeferred deferreds.  These give
the programmer using this class (who, I imagine, is probably doing so in
the context of writing a Twistd plugin - i.e., writing the makeService
method in a class implementing IServiceMaker and IPlugin) the chance to add
callbacks to the chain of events that happen when the service is started
and stopped. Their use is optional.

It's easy to see how to make guardService default to None, which would make
it possible to merge the above into MultiService itself.

If there's any interest at all in this, I'm happy to open a ticket, run
tests, submit a patch, etc.

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019227.html">[Twisted-Python] What to do when a service fails to start, also,	deferred and startService
</A></li>
	<LI>Next message: <A HREF="019226.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19249">[ date ]</a>
              <a href="thread.html#19249">[ thread ]</a>
              <a href="subject.html#19249">[ subject ]</a>
              <a href="author.html#19249">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
