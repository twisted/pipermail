<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] KeyError when an errback is triggered within a	conch TCP tunnel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20KeyError%20when%20an%20errback%20is%20triggered%20within%20a%0A%09conch%20TCP%20tunnel&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019197.html">
   <LINK REL="Next"  HREF="019196.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] KeyError when an errback is triggered within a	conch TCP tunnel</H1>
    <B>Luper Rouch</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20KeyError%20when%20an%20errback%20is%20triggered%20within%20a%0A%09conch%20TCP%20tunnel&In-Reply-To="
       TITLE="[Twisted-Python] KeyError when an errback is triggered within a	conch TCP tunnel">luper.rouch at gmail.com
       </A><BR>
    <I>Wed Feb 18 23:16:34 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019197.html">[Twisted-Python] raw xml to element, char encoding/decoding error
</A></li>
        <LI>Next message: <A HREF="019196.html">[Twisted-Python] KeyError when an errback is triggered within a	conch TCP tunnel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19195">[ date ]</a>
              <a href="thread.html#19195">[ thread ]</a>
              <a href="subject.html#19195">[ subject ]</a>
              <a href="author.html#19195">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry I have not been able to find a better title, please see the 
attached example which may be more descriptive.

Here is what it does:
  * set up an SSH connection
  * open a TCP forwarding channel through this connection
  * do something through the tunnel that will trigger an errback (in the
    example, try to do an XMLRPC call with no one listening on the
    tunnel's end)

This scenario gives me the following traceback (tested with Twisted 
8.1.0 and 8.2.0):

-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/python/log.py&quot;, 
line 84, in callWithLogger
     return callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/python/log.py&quot;, 
line 69, in callWithContext
     return context.call({ILogContext: newCtx}, func, *args, **kw)
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/python/context.py&quot;, 
line 59, in callWithContext
     return self.currentContext().callWithContext(ctx, func, *args, **kw)
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/python/context.py&quot;, 
line 37, in callWithContext
     return func(*args,**kw)
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/internet/selectreactor.py&quot;, 
line 156, in _doReadOrWrite
     self._disconnectSelectable(selectable, why, method==&quot;doRead&quot;)
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/internet/posixbase.py&quot;, 
line 193, in _disconnectSelectable
     selectable.connectionLost(f)
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/internet/tcp.py&quot;, 
line 520, in connectionLost
     protocol.connectionLost(reason)
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/conch/ssh/forwarding.py&quot;, 
line 129, in connectionLost
     self.channel.loseConnection()
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/conch/ssh/channel.py&quot;, 
line 253, in loseConnection
     self.conn.sendClose(self)
   File 
&quot;/usr/lib/python2.5/site-packages/Twisted-8.2.0-py2.5-linux-i686.egg/twisted/conch/ssh/connection.py&quot;, 
line 491, in sendClose
     self.channelsToRemoteChannel[channel]))
exceptions.KeyError: 
&lt;twisted.conch.ssh.forwarding.SSHListenClientForwardingChannel instance 
at 0x972048c&gt;
-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-

It works well in the other cases, i.e.:
  * the errback is triggered but the tunnel is not used (comment line 57,
    uncomment line 59)
  * the errback is not triggered (start the XMLRPC server by uncommenting
    line 100), using the tunnel or not

You get the error only when the tunnel is used AND the errback is triggered.

To run the example execute it with an user name that can login using ssh 
on your host, e.g. 'python test.py someuser' and enter its password.

Cheers,
Luper
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.py
Type: text/x-python
Size: 3121 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20090219/d11384ce/attachment.py">http://twistedmatrix.com/pipermail/twisted-python/attachments/20090219/d11384ce/attachment.py</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019197.html">[Twisted-Python] raw xml to element, char encoding/decoding error
</A></li>
	<LI>Next message: <A HREF="019196.html">[Twisted-Python] KeyError when an errback is triggered within a	conch TCP tunnel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19195">[ date ]</a>
              <a href="thread.html#19195">[ thread ]</a>
              <a href="subject.html#19195">[ subject ]</a>
              <a href="author.html#19195">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
