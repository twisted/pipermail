<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: How can I disconnect ssl connection from the	client side?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20How%20can%20I%20disconnect%20ssl%20connection%20from%20the%0A%09client%20side%3F&In-Reply-To=%3C797440730902020248t30042234ob6b12b325804bdd4%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051631.html">
   <LINK REL="Next"  HREF="051633.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: How can I disconnect ssl connection from the	client side?</H1>
    <B>Atsuo Ishimoto</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20How%20can%20I%20disconnect%20ssl%20connection%20from%20the%0A%09client%20side%3F&In-Reply-To=%3C797440730902020248t30042234ob6b12b325804bdd4%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Re: How can I disconnect ssl connection from the	client side?">ishimoto at gembook.org
       </A><BR>
    <I>Mon Feb  2 03:48:50 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051631.html">[Twisted-Python] Weekly Bug Summary
</A></li>
        <LI>Next message (by thread): <A HREF="051633.html">[Twisted-Python] Re: How can I disconnect ssl connection from	the client side?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51632">[ date ]</a>
              <a href="thread.html#51632">[ thread ]</a>
              <a href="subject.html#51632">[ subject ]</a>
              <a href="author.html#51632">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Investigating further, I found this is not SSL related problem, but in
my code may have bug. In the following script, I expect that reactor
stops in 2 secs after it started, but connectionLost() is not fired at
all.

Is this a bug in Twisted? Or Am I missing something?


=========================================
from twisted.protocols import basic
from twisted.internet import protocol, reactor

serverfactory = protocol.Factory()
serverfactory.protocol = basic.LineOnlyReceiver
port = reactor.listenTCP(9084, serverfactory, interface='127.0.0.1')

CANCELED = False
class Client(basic.LineReceiver):
    def connectionMade(self):
        class dmyfile:
            def read(self, n):
                if CANCELED:
                    return
                else:
                    return '1'

        s = basic.FileSender()
        print &quot;start sending&quot;

        def f1(lastChunk):
            print &quot;finished&quot;

        def f2(reason):
            print &quot;failed&quot;
            print reason

        s.beginFileTransfer(
            dmyfile(), self.transport, None
        ).addCallbacks(f1, f2)

    def connectionLost(self, conn, reason=protocol.connectionDone):
        print &quot;protocol:connectionlost&quot;


class Factory(protocol.ClientFactory):
    protocol = Client

    def clientConnectionLost(self, conn, reason):
        print &quot;clientConnectionLost&quot;
        reactor.stop()

conn = reactor.connectTCP('127.0.0.1', 9084, Factory())

def cancel():
    print &quot;cancel&quot;, conn.state
    global CANCELED
    CANCELED = True
    conn.disconnect()

reactor.callLater(2, cancel) # disconnect 2 sec later
reactor.run()


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051631.html">[Twisted-Python] Weekly Bug Summary
</A></li>
	<LI>Next message (by thread): <A HREF="051633.html">[Twisted-Python] Re: How can I disconnect ssl connection from	the client side?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51632">[ date ]</a>
              <a href="thread.html#51632">[ thread ]</a>
              <a href="subject.html#51632">[ subject ]</a>
              <a href="author.html#51632">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
