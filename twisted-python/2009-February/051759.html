<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Reentrant reactor iteration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Reentrant%20reactor%20iteration&In-Reply-To=%3C49A7F823.5010704%40cs.au.dk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051758.html">
   <LINK REL="Next"  HREF="051760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Reentrant reactor iteration</H1>
    <B>Marcel Keller</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Reentrant%20reactor%20iteration&In-Reply-To=%3C49A7F823.5010704%40cs.au.dk%3E"
       TITLE="[Twisted-Python] Reentrant reactor iteration">mkeller at cs.au.dk
       </A><BR>
    <I>Fri Feb 27 07:26:43 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051758.html">[Twisted-Python] server client in one code
</A></li>
        <LI>Next message (by thread): <A HREF="051760.html">[Twisted-Python] Reentrant reactor iteration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51759">[ date ]</a>
              <a href="thread.html#51759">[ thread ]</a>
              <a href="subject.html#51759">[ subject ]</a>
              <a href="author.html#51759">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am working on the VIFF project (viff.dk) which uses Twisted. I found 
out that our code is sometimes inefficient because we are generating 
many deferreds (maybe about 10000) in a callback. While doing that, no 
network communication is performed. Therefore, I investigated the 
possibility of adding a function to the reactor which is called every 
iteration and from which the iteration could be called safely. Then, we 
could generate all deferreds in that function and activate the reactor 
from to time. See the attached patch for details.

Some of our code runs twice as fast when using that hack. Are there any 
chances something similar might be included in Twisted? Or does anyone 
have a better solution for the described problem?

Furthermore, I have a question, which is probably related. The 
documentation of IReactorCore says about the iterate() function:

&quot;The reactor must have been started (via the run() method) prior to any 
invocations of this method. It must also be stopped manually after the 
last call to this method (via the stop() method). This method is not 
re-entrant: you must not call it recursively; in particular, you must 
not call it while the reactor is running.&quot;

This looks to me as if the reactor needs to be running and not running 
at the same time so that iterate() can be called. Is there an error in 
my reasoning?

Best regards,
Marcel Keller


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: twisted-hack.patch
URL: &lt;/pipermail/twisted-python/attachments/20090227/4f7c94aa/attachment.ksh&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051758.html">[Twisted-Python] server client in one code
</A></li>
	<LI>Next message (by thread): <A HREF="051760.html">[Twisted-Python] Reentrant reactor iteration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51759">[ date ]</a>
              <a href="thread.html#51759">[ thread ]</a>
              <a href="subject.html#51759">[ subject ]</a>
              <a href="author.html#51759">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
