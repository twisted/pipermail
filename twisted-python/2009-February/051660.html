<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Bad file descriptor traceback when deamonnizing kqueue reactorwith twistd
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Bad%20file%20descriptor%20traceback%20when%20deamonnizing%0A%20kqueue%20reactorwith%20twistd&In-Reply-To=%3C498C18B8.8040407%40thiengineering.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051659.html">
   <LINK REL="Next"  HREF="051643.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Bad file descriptor traceback when deamonnizing kqueue reactorwith twistd</H1>
    <B>Werner Thie</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Bad%20file%20descriptor%20traceback%20when%20deamonnizing%0A%20kqueue%20reactorwith%20twistd&In-Reply-To=%3C498C18B8.8040407%40thiengineering.ch%3E"
       TITLE="[Twisted-Python] Bad file descriptor traceback when deamonnizing kqueue reactorwith twistd">wthie at thiengineering.ch
       </A><BR>
    <I>Fri Feb  6 04:02:16 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051659.html">[Twisted-Python] Traceback on loseConnection
</A></li>
        <LI>Next message (by thread): <A HREF="051643.html">[Twisted-Python] redefine signal handlers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51660">[ date ]</a>
              <a href="thread.html#51660">[ thread ]</a>
              <a href="subject.html#51660">[ subject ]</a>
              <a href="author.html#51660">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

When I run the following command (as root) on FreeBSD all is well with

twistd -rpoll -o ftp

I get a running ftp server process on port 2121.

Everything is also up and running (no daemonizing) after

twistd -rkqueue -no ftp

Not so with (daemonized)

twistd -rkqueue -o ftp

The process dies with the attached traceback in twisted.log

Shall I file a ticket for this?

Thanks, Werner

2009-02-06 11:45:01+0100 [-] Log opened.
2009-02-06 11:45:01+0100 [-] twistd 8.2.0 (/usr/local/bin/python 2.5.2) 
starting up.
2009-02-06 11:45:01+0100 [-] reactor class: 
twisted.internet.kqreactor.KQueueReactor.
2009-02-06 11:45:01+0100 [-] twisted.protocols.ftp.FTPFactory starting 
on 2121
2009-02-06 11:45:01+0100 [-] Starting factory 
&lt;twisted.protocols.ftp.FTPFactory instance at 0x803d7ff38&gt;
2009-02-06 11:45:01+0100 [-] Traceback (most recent call last):
2009-02-06 11:45:01+0100 [-]   File &quot;/usr/local/bin/twistd&quot;, line 21, in 
&lt;module&gt;
2009-02-06 11:45:01+0100 [-]     run()
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/scripts/twistd.py&quot;, line 
27, in run
2009-02-06 11:45:01+0100 [-]     app.run(runApp, ServerOptions)
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/application/app.py&quot;, 
line 694, in run
2009-02-06 11:45:01+0100 [-]     runApp(config)
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/scripts/twistd.py&quot;, line 
23, in runApp
2009-02-06 11:45:01+0100 [-]     _SomeApplicationRunner(config).run()
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/application/app.py&quot;, 
line 423, in run
2009-02-06 11:45:01+0100 [-]     self.postApplication()
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/scripts/_twistd_unix.py&quot;, 
line 206, in postApplication
2009-02-06 11:45:01+0100 [-]     self.startApplication(self.application)
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/scripts/_twistd_unix.py&quot;, 
line 311, in startApplication
2009-02-06 11:45:01+0100 [-] 
service.IService(application).privilegedStartService()
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/application/service.py&quot;, 
line 273, in privilegedStartService
2009-02-06 11:45:01+0100 [-]     service.privilegedStartService()
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/application/internet.py&quot;, 
line 85, in privilegedStartService
2009-02-06 11:45:01+0100 [-]     self._port = self._getPort()
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/application/internet.py&quot;, 
line 116, in _getPort
2009-02-06 11:45:01+0100 [-]     *self.args, **self.kwargs)
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/internet/posixbase.py&quot;, 
line 356, in listenTCP
2009-02-06 11:45:01+0100 [-]     p.startListening()
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/internet/tcp.py&quot;, line 
875, in startListening
2009-02-06 11:45:01+0100 [-]     self.startReading()
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/internet/abstract.py&quot;, 
line 262, in startReading
2009-02-06 11:45:01+0100 [-]     self.reactor.addReader(self)
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/internet/kqreactor.py&quot;, 
line 125, in addReader
2009-02-06 11:45:01+0100 [-]     self._updateRegistration(fd, 
EVFILT_READ, EV_ADD)
2009-02-06 11:45:01+0100 [-]   File 
&quot;/usr/local/lib/python2.5/site-packages/twisted/internet/kqreactor.py&quot;, 
line 116, in _updateRegistration
2009-02-06 11:45:01+0100 [-]     self._kq.kevent([kevent(*args)], 0, 0)
2009-02-06 11:45:01+0100 [-] OSError: [Errno 9] Bad file descriptor


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051659.html">[Twisted-Python] Traceback on loseConnection
</A></li>
	<LI>Next message (by thread): <A HREF="051643.html">[Twisted-Python] redefine signal handlers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51660">[ date ]</a>
              <a href="thread.html#51660">[ thread ]</a>
              <a href="subject.html#51660">[ subject ]</a>
              <a href="author.html#51660">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
