<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] CFReactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20CFReactor&In-Reply-To=1F9829DE-2771-11D9-9668-000A95A50FB2%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008922.html">
   <LINK REL="Next"  HREF="008931.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] CFReactor</H1>
    <B>Bob Ippolito</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20CFReactor&In-Reply-To=1F9829DE-2771-11D9-9668-000A95A50FB2%40fuhm.net"
       TITLE="[Twisted-Python] CFReactor">bob at redivi.com
       </A><BR>
    <I>Tue Oct 26 13:35:03 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008922.html">[Twisted-Python] CFReactor
</A></li>
        <LI>Next message: <A HREF="008931.html">[Twisted-Python] CFReactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8923">[ date ]</a>
              <a href="thread.html#8923">[ thread ]</a>
              <a href="subject.html#8923">[ subject ]</a>
              <a href="author.html#8923">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Oct 26, 2004, at 13:04, James Y Knight wrote:

&gt;<i> On Oct 25, 2004, at 6:02 PM, Bob Ippolito wrote:
</I>&gt;&gt;<i> On Oct 25, 2004, at 17:24, James Y Knight wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Itamar just added half-closing support to Twisted, and I foolishly 
</I>&gt;&gt;&gt;<i> volunteered to look at adding support to cfreactor for him. However, 
</I>&gt;&gt;&gt;<i> that was before I looked at it. Now that I have, I have little idea 
</I>&gt;&gt;&gt;<i> what it's actually doing, so I'm afraid that I'm unable to actually 
</I>&gt;&gt;&gt;<i> implement this change.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The &quot;SelectableSocketWrapper&quot; looks like a horrible kludge, and I'm 
</I>&gt;&gt;&gt;<i> not sure why it's necessary. Why does it override the wrapped 
</I>&gt;&gt;&gt;<i> object's &quot;connectionLost&quot;? Why do you have to wrap&amp;override 
</I>&gt;&gt;&gt;<i> Selectable.start/stopReading/Writing, instead of doing that stuff in 
</I>&gt;&gt;&gt;<i> reactor.add/removeReader/Writer? What is simulate?? Essentially, I 
</I>&gt;&gt;&gt;<i> just don't understand why it is so different from the other 
</I>&gt;&gt;&gt;<i> reactors.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The SSW kludge is necessary because it inherits a lot of 
</I>&gt;&gt;<i> functionality from the existing default select-based reactor and its 
</I>&gt;&gt;<i> sockets.  It is a workaround for the lack of extensibility in the 
</I>&gt;&gt;<i> implementation of those sockets and that reactor.  It could be less 
</I>&gt;&gt;<i> hacky if it were inverted, but then you'd have to subclass every 
</I>&gt;&gt;<i> possible port and add the reactor notifications, and essentially copy 
</I>&gt;&gt;<i> about 80% of twisted.internet.default instead of subclassing it.  If 
</I>&gt;&gt;<i> you want to refactor it this way, be my guest.. but I'm not bored 
</I>&gt;&gt;<i> enough to do it :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The reason for the loseConnection hack is that the existing 
</I>&gt;&gt;<i> implementation of loseConnection doesn't do removeReader/Writer!  
</I>&gt;&gt;<i> loseConnection effectively kills the socket without notifying the 
</I>&gt;&gt;<i> reactor at all.  If the existing implementation told the reactor when 
</I>&gt;&gt;<i> it was done with a socket, SSW wouldn't be so much of a kludge.
</I>&gt;<i>
</I>&gt;<i> Er, I don't believe you. If that was the case, it would be a huge fd 
</I>&gt;<i> leak, which I'm pretty sure Twisted doesn't have. I removed that hack 
</I>&gt;<i> and I don't think anything further broke.
</I>
No.  It's not a fd leak because loseConnection closes the file 
descriptors.  It just doesn't tell the reactor it has done so.  It 
should leak SSW instances (memory) now, though.

&gt;<i> Anyways, I've changed cfreactor to do what I think should be the right 
</I>&gt;<i> thing, but it's randomly failing tests. Before my changes it was 
</I>&gt;<i> failing a lot of tests too, so I don't know if this is a regression or 
</I>&gt;<i> not.
</I>
I don't really have the time or need to debug this anytime soon.  When 
I first wrote CFReactor, it passed all of the tests.  Either changes in 
PyObjC (unlikely) or Twisted (likely) caused these test failures.  Some 
of it is probably due to tests making incorrect assumptions, especially 
because CFReactor isn't designed to be iterated (it has to set up a 
timer to stop itself).

-bob



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008922.html">[Twisted-Python] CFReactor
</A></li>
	<LI>Next message: <A HREF="008931.html">[Twisted-Python] CFReactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8923">[ date ]</a>
              <a href="thread.html#8923">[ thread ]</a>
              <a href="subject.html#8923">[ subject ]</a>
              <a href="author.html#8923">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
