<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ANN: deferred howto/tutorial
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ANN%3A%20deferred%20howto/tutorial&In-Reply-To=CD79D296-2533-11D9-B0B7-000393DC7B7C%40donfu.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008884.html">
   <LINK REL="Next"  HREF="008886.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ANN: deferred howto/tutorial</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ANN%3A%20deferred%20howto/tutorial&In-Reply-To=CD79D296-2533-11D9-B0B7-000393DC7B7C%40donfu.com"
       TITLE="[Twisted-Python] ANN: deferred howto/tutorial">andrew-twisted at puzzling.org
       </A><BR>
    <I>Sat Oct 23 17:23:24 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008884.html">[Twisted-Python] ANN: deferred howto/tutorial
</A></li>
        <LI>Next message: <A HREF="008886.html">[Twisted-Python] ANN: deferred howto/tutorial
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8885">[ date ]</a>
              <a href="thread.html#8885">[ thread ]</a>
              <a href="subject.html#8885">[ subject ]</a>
              <a href="author.html#8885">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Oct 23, 2004 at 10:40:40PM +0200, stefan wrote:
[...]
&gt;<i> What I also would like to see is some coding practices of how to style 
</I>&gt;<i> deferred code. I got used to inner functions in class methods, which 
</I>&gt;<i> for me looks clearest, but I'm sure there are other practices. A short 
</I>&gt;<i> discussion on that in the docs would be great. I've attached an example 
</I>&gt;<i> of my style, maybe someone with a different style can rewrite the 
</I>&gt;<i> example and comment on pros and cons?
</I>&gt;<i> ---------------------------------------------------------------
</I>&gt;<i> class X:
</I>&gt;<i>     ...
</I>&gt;<i>     def y(self):
</I>&gt;<i>         # do some method initialisation
</I>&gt;<i>         ...
</I>&gt;<i>         # callbacks
</I>&gt;<i>         def oneBack(result):
</I>[...]
&gt;<i>         return self.somethingDeferred().addCallback(oneBack)
</I>&gt;<i> ---------------------------------------------------------------
</I>
There's a cryptic note here that partly explains the usual style within
Twisted itself:
    <A HREF="http://twistedmatrix.com/documents/howto/policy/coding-standard#auto13">http://twistedmatrix.com/documents/howto/policy/coding-standard#auto13</A>

Twisted style is usually:

class X:
    def y(self):
        ...
        return self.somethingDeferred().addCallback(self._cbOneBack)

    def _cbOneBack(self, result):
        ...

I believe the main reason for this is flexibility.  Code in Twisted tends to
be framework code or library code, rather than an actual application, so it
is written with re-use in mind.  You can't override a callback that's
embedded within a method without overriding the whole method; making the
callback a method on the class solves that.  The &quot;_cb&quot; or &quot;_eb&quot; prefix
signals that it's intended to be used as the callback or errback for
something, and also that it's not an ordinary method that you would call
directly.

It also has other secondary advantages, like making setting breakpoints in
pdb easier, although I can't say I've taken advantage of that very often (I
typically set breakpoints by inserting &quot;import pdb; pdb.set_trace()&quot;), but
I imagine some other developers have.

A more important advantage (if you are strict on testing) is that you can
unit test the behaviour of the callback more easily if you can call it
directly.

If nothing else, I like my functions to be as short as possible, and
embedding a large callback within a method means I now have two large
functions (the embedded function, and the method that contains it), rather
than just one.

The obvious disadvantage compared to your style is the loss of the direct
visual association of which callbacks relate to which deferreds.  I'd be
moderately interested in hearing how other people cope with that, but I
haven't really found it to be a problem.  I expect that if I did, I'd just
put comments like &quot;# callback for deferred from self.frobnicate&quot; at the top
of each callback and errback.  Large, hard-to-navigate classes with lots of
methods can be a sign of a suboptimal design anyway.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008884.html">[Twisted-Python] ANN: deferred howto/tutorial
</A></li>
	<LI>Next message: <A HREF="008886.html">[Twisted-Python] ANN: deferred howto/tutorial
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8885">[ date ]</a>
              <a href="thread.html#8885">[ thread ]</a>
              <a href="subject.html#8885">[ subject ]</a>
              <a href="author.html#8885">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
