<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adbapi, PostgreSQL and Unicode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%2C%20PostgreSQL%20and%20Unicode&In-Reply-To=4284F2EF.3030406%40dkp.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010442.html">
   <LINK REL="Next"  HREF="010386.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adbapi, PostgreSQL and Unicode</H1>
    <B>Remy Cool</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%2C%20PostgreSQL%20and%20Unicode&In-Reply-To=4284F2EF.3030406%40dkp.com"
       TITLE="[Twisted-Python] adbapi, PostgreSQL and Unicode">mailinglists at smartology.nl
       </A><BR>
    <I>Tue May 17 03:18:32 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010442.html">[Twisted-Python] adbapi, PostgreSQL and Unicode
</A></li>
        <LI>Next message: <A HREF="010386.html">[Twisted-Python] Call for documentation reviewers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10460">[ date ]</a>
              <a href="thread.html#10460">[ thread ]</a>
              <a href="subject.html#10460">[ subject ]</a>
              <a href="author.html#10460">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Michal Eldar wrote:
&gt;<i> Remy Cool wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Matt Goodall wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Michal Eldar wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I keep getting - Unhandled error in Deferred
</I>&gt;&gt;&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You should attach an errback to the deferred and handle, or at least
</I>&gt;&gt;&gt;<i> log, the exception. That's what &quot;Unhandled error in Deferred&quot; means ;-).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I'm trying to perform an INSERT on my db (using adbapi with *pgdb*
</I>&gt;&gt;&gt;&gt;<i> module).
</I>&gt;&gt;&gt;&gt;<i> INSERT which comprises *Unicode* string
</I>&gt;&gt;&gt;&gt;<i> e.g. -
</I>&gt;&gt;&gt;&gt;<i> unicodeChar1 = u&quot;Character=[\N{GREEK CAPITAL LETTER GAMMA}]&quot;
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> the db is defined to Unicode
</I>&gt;&gt;&gt;&gt;<i> *client_encoding* value is set to *Unicode* when checking its value in
</I>&gt;&gt;&gt;&gt;<i> *cp_openfun *called function
</I>&gt;&gt;&gt;&gt;<i> execute the same INSERT directly with *pgdb *works great
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Does anyone has experience with adbapi with Unicode db ?!?!
</I>
&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I also use pgdb with adbapi and unicode without problems. Insert's with
</I>&gt;&gt;<i> unicode strings should not be problem even if the database is set to
</I>&gt;&gt;<i> SQLASCII. The pgdb module inspects the string before sending it to the
</I>&gt;&gt;<i> postgres machinery. If it's a unicode string (isinstance('the string',
</I>&gt;&gt;<i> unicode) ) it's encoded to utf-8.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've submitted a patch to Darcy at pygresql.org for enhanced unicode
</I>&gt;&gt;<i> support for pgdb. This patch takes care of the client_encoding stuff and
</I>&gt;&gt;<i> makes it possible to fetch unicode strings from select queries.
</I>
&gt;<i> First of all - Thanks !!! It was a nice surprise to find responses to my
</I>&gt;<i> quesion :)
</I>&gt;<i> 
</I>&gt;<i> I read about Unicode in the Twisted Archive and a link to the FAQ gave
</I>&gt;<i> me the solution:
</I>&gt;<i> I'm suppose to *encode* the unicode string before I'm passing it over...
</I>&gt;<i> This was THE difference when working with Twisted.
</I>&gt;<i> <A HREF="http://twistedmatrix.com/pipermail/twisted-python/2005-April/010198.html">http://twistedmatrix.com/pipermail/twisted-python/2005-April/010198.html</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/faq.html#auto25">http://twistedmatrix.com/projects/core/documentation/howto/faq.html#auto25</A>
</I>&gt;<i> 
</I>&gt;<i> Matt - I did try to attach an errback, but it failed to print the error,
</I>&gt;<i> because it probably included some non-ascii chars... I don't know why
</I>&gt;<i> Twisted don't show an appropriate error about this problem
</I>&gt;<i> Remi - is it not possible to retrieve Unicode string from SELECT query
</I>&gt;<i> with pgdb ? what is the behaviour nowadays?
</I>
The standard behaviour of pgdb is that unicode strings are automagically
encoded to utf-8 when inserting something in the database and you get
plain python strings for select queries. I've looked at the code of
other python database connectors and added (transparent) functionality
to pgdb so that it can it return unicode strings if you want it to.





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010442.html">[Twisted-Python] adbapi, PostgreSQL and Unicode
</A></li>
	<LI>Next message: <A HREF="010386.html">[Twisted-Python] Call for documentation reviewers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10460">[ date ]</a>
              <a href="thread.html#10460">[ thread ]</a>
              <a href="subject.html#10460">[ subject ]</a>
              <a href="author.html#10460">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
