<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] cleanup in twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20cleanup%20in%20twisted&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010521.html">
   <LINK REL="Next"  HREF="010513.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] cleanup in twisted</H1>
    <B>Joachim Boomberschloss</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20cleanup%20in%20twisted&In-Reply-To="
       TITLE="[Twisted-Python] cleanup in twisted">boomberschloss at yahoo.com
       </A><BR>
    <I>Mon May 23 08:12:49 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010521.html">[Twisted-Python] cleanup in twisted
</A></li>
        <LI>Next message: <A HREF="010513.html">[Twisted-Python] cleanup in twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10512">[ date ]</a>
              <a href="thread.html#10512">[ thread ]</a>
              <a href="subject.html#10512">[ subject ]</a>
              <a href="author.html#10512">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
--- Jp Calderone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; wrote:
&gt;<i> On Mon, 23 May 2005 02:40:53 -0700 (PDT), Joachim
</I>&gt;<i> Boomberschloss &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">boomberschloss at yahoo.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;--- Bob Ippolito &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bob at redivi.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On May 22, 2005, at 8:46 AM, Joachim
</I>&gt;<i> Boomberschloss
</I>&gt;<i> &gt;&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt; I just jotted down a little mechanism for
</I>&gt;<i> &gt;&gt; cleaning-up
</I>&gt;<i> &gt;&gt; &gt; in Twisted, and I wanted to see if:
</I>&gt;<i> &gt;&gt; &gt; 1. other people think it's needed
</I>&gt;<i> &gt;&gt; &gt; 2. other people manage to use it
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; What this does is enable one to define a
</I>&gt;<i> &gt;&gt; __cleanup__
</I>&gt;<i> &gt;&gt; &gt; method which gets call either when the instance
</I>&gt;<i> is
</I>&gt;<i> &gt;&gt; &gt; deleted, or when the reactor shuts down. It can
</I>&gt;<i> &gt;&gt; return
</I>&gt;<i> &gt;&gt; &gt; a dereffed that delays the shutdown. The
</I>&gt;<i> benefit
</I>&gt;<i> &gt;&gt; is
</I>&gt;<i> &gt;&gt; &gt; being able to define communication-related
</I>&gt;<i> stuff
</I>&gt;<i> &gt;&gt; in
</I>&gt;<i> &gt;&gt; &gt; the cleanup method, which is not so useful to
</I>&gt;<i> do
</I>&gt;<i> &gt;&gt; in
</I>&gt;<i> &gt;&gt; &gt; __del__.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; This is just begging for object leaks, because
</I>&gt;<i> &gt;&gt; __del__ disables
</I>&gt;<i> &gt;&gt; aspects of cyclic GC.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Hmmpf. What does this mean, and is there a simple
</I>&gt;<i> way
</I>&gt;<i> &gt;of resolving it?
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i>   If you construct a reference cycle which contains
</I>&gt;<i> an object which has a __del__ method, the entire
</I>&gt;<i> cycle becomes &quot;garbage&quot; - Python cannot free any of
</I>&gt;<i> the objects or call any of their __del__ methods. 
</I>&gt;<i> Instead, it puts them into the gc module's `garbage'
</I>&gt;<i> list and leaves them there forever.
</I>&gt;<i> 
</I>&gt;<i>   There's no simple way to resolve this (except to
</I>&gt;<i> not implement __del__, of course ;).
</I>&gt;<i> 
</I>&gt;<i>   A non-simple way to resolve it is to use weakref
</I>&gt;<i> callbacks instead of __del__.  Weakref callbacks
</I>&gt;<i> have some nasty bugs in versions of Python older
</I>&gt;<i> than 2.3.5 (more, the further back you go), and
</I>&gt;<i> they're trickier to use than __del__.  They don't
</I>&gt;<i> create garbage cycles, though.
</I>&gt;<i> 
</I>
Can you point me to an example of this (preferably in
Twisted)? Is this whole cleanup thing worth my time
fixing it in your opinion?

Joe.


		
Yahoo! Mail
Stay connected, organized, and protected. Take the tour:
<A HREF="http://tour.mail.yahoo.com/mailtour.html">http://tour.mail.yahoo.com/mailtour.html</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010521.html">[Twisted-Python] cleanup in twisted
</A></li>
	<LI>Next message: <A HREF="010513.html">[Twisted-Python] cleanup in twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10512">[ date ]</a>
              <a href="thread.html#10512">[ thread ]</a>
              <a href="subject.html#10512">[ subject ]</a>
              <a href="author.html#10512">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
