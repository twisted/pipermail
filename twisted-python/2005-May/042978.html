<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twistd thread problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twistd%20thread%20problem&In-Reply-To=%3C9c78c12df892cc1b36503f8f3b12cc0e%40ezabel.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042963.html">
   <LINK REL="Next"  HREF="042994.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twistd thread problem</H1>
    <B>orbitz at ezabel.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twistd%20thread%20problem&In-Reply-To=%3C9c78c12df892cc1b36503f8f3b12cc0e%40ezabel.com%3E"
       TITLE="[Twisted-Python] Twistd thread problem">orbitz at ezabel.com
       </A><BR>
    <I>Wed May 18 11:57:52 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042963.html">[Twisted-Python] Twistd thread problem
</A></li>
        <LI>Next message (by thread): <A HREF="042994.html">[Twisted-Python] Twistd thread problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42978">[ date ]</a>
              <a href="thread.html#42978">[ thread ]</a>
              <a href="subject.html#42978">[ subject ]</a>
              <a href="author.html#42978">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If your making a proxy you shouldn't a queue or worker threads.  Just 
connect to the destination and send your incoming data to it and it's 
outgoing data back to the client.  This can all be done in one thread.  
Even if you don't do it like this you also don't need a thread to send 
the data, sending smtp is fairly trivial you can do it by hand, or use 
the smtp client that comes with twisted (might as well learn sometime).

On May 16, 2005, at 7:50 PM, Jan Van Uytven wrote:

&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I coded an SMTP proxy that receives incoming e-mail requests and 
</I>&gt;<i> pushes the received e-mail onto a Queue were it is processed by a 
</I>&gt;<i> worker thread that finishes by sending the e-mail on to another SMTP 
</I>&gt;<i> server.
</I>&gt;<i>
</I>&gt;<i> The server part of the proxy was written in Twisted, but the worker 
</I>&gt;<i> thread uses smtplib to fire off the processed e-mails (I didn't know 
</I>&gt;<i> how to use the twisted smtp client in a thread).
</I>&gt;<i>
</I>&gt;<i> When I run the application using twistd -noy &lt;appname&gt;, it works 
</I>&gt;<i> great. When I try to daemonize it (twistd -oy &lt;appname&gt;) the server 
</I>&gt;<i> part works, but the worker thread doesn't. It creates and then I 
</I>&gt;<i> suspect it immediately dies, as no error is returned upon creation. A 
</I>&gt;<i> debug of the queue reveals that the thread is not pulling items off 
</I>&gt;<i> it. A debugging statement placed at the top of the thread never runs, 
</I>&gt;<i> and the twistd log reports nothing wrong. I'm using 
</I>&gt;<i> reactor.callInThread to start the worker function.
</I>&gt;<i>
</I>&gt;<i> I tried running twistd --spew -oy &lt;appname&gt; and captured the log it 
</I>&gt;<i> produced. I did a filter for anything with 'thread' in it, this is the 
</I>&gt;<i> result:
</I>&gt;<i>
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function ? in 
</I>&gt;<i> /usr/lib/python2.3/site-packages/twisted/python/threadpool.py, line 11
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function WorkerStop in 
</I>&gt;<i> /usr/lib/python2.3/site-packages/twisted/python/threadpool.py, line 23
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function init in 
</I>&gt;<i> /usr/lib/python2.3/site-packages/twisted/python/threadable.py, line 
</I>&gt;<i> 219
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function ThreadPool in 
</I>&gt;<i> /usr/lib/python2.3/site-packages/twisted/python/threadpool.py, line 31
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function ThreadSafeList in 
</I>&gt;<i> /usr/lib/python2.3/site-packages/twisted/python/threadpool.py, line 
</I>&gt;<i> 199
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function init in 
</I>&gt;<i> /usr/lib/python2.3/site-packages/twisted/python/threadable.py, line 
</I>&gt;<i> 219
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method __init__ of 
</I>&gt;<i> twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method start of 
</I>&gt;<i> twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method adjustPoolsize of 
</I>&gt;<i> twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method _startSomeWorkers of 
</I>&gt;<i> twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method callInThread of 
</I>&gt;<i> twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method _startSomeWorkers of 
</I>&gt;<i> twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method startAWorker of 
</I>&gt;<i> twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method __init__ of threading.Thread at 
</I>&gt;<i> -1216568116
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method __init__ of threading.Thread at 
</I>&gt;<i> -1216568116
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method _set_daemon of threading.Thread at 
</I>&gt;<i> -1216568116
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function currentThread in 
</I>&gt;<i> /usr/lib/python2.3/threading.py, line 669
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method isDaemon of threading._MainThread at 
</I>&gt;<i> -1214935060
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function Condition in 
</I>&gt;<i> /usr/lib/python2.3/threading.py, line 147
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method __init__ of threading._Condition at 
</I>&gt;<i> -1216567604
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method __init__ of threading._Condition at 
</I>&gt;<i> -1216567604
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method start of threading.Thread at 
</I>&gt;<i> -1216568116
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method _note of threading.Thread at 
</I>&gt;<i> -1216568116
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method run of threading.Thread at -1216568116
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method _worker of 
</I>&gt;<i> twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function currentThread in 
</I>&gt;<i> /usr/lib/python2.3/threading.py, line 669
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function threadMailer in twisted-copyuser.py, 
</I>&gt;<i> line 201
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method acquire of 
</I>&gt;<i> twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method release of 
</I>&gt;<i> twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method acquire of 
</I>&gt;<i> twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method release of 
</I>&gt;<i> twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method acquire of 
</I>&gt;<i> twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> 2005/05/16 09:15 PDT [-] method release of 
</I>&gt;<i> twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> 2005/05/16 09:15 PDT [-] function registerAsIOThread in 
</I>&gt;<i> /usr/lib/python2.3/site-packages/twisted/python/threadable.py, line 
</I>&gt;<i> 262
</I>&gt;<i>
</I>&gt;<i> Why would the worker thread act differently with twistd daemonized? 
</I>&gt;<i> Any suggestions, advice, or hints would be welcome.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Jan
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> Jan Van Uytven
</I>&gt;<i> Computer Systems &amp; Network Engineer
</I>&gt;<i> Convergent Media Network
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wyvern at crm3.com</A>
</I>&gt;<i>
</I>&gt;<i> Only in silence the word,
</I>&gt;<i> only in dark the light,
</I>&gt;<i> only in dying life:
</I>&gt;<i> Bright the hawk's flight on the empty sky.
</I>&gt;<i>
</I>&gt;<i> - Ursula K. LeGuin, 'A Wizard of Earthsea'
</I>&gt;<i>
</I>&gt;<i> *** LEGAL STUFF ***
</I>&gt;<i> This electronic message transmission, including any attached files, 
</I>&gt;<i> contains information which may be confidential and/or privileged.
</I>&gt;<i> The information is intended to be for the SOLE use of the individual 
</I>&gt;<i> or entity named above. If you are not the intended recipient, be aware 
</I>&gt;<i> that any review, disclosure, copying, distribution or use of the 
</I>&gt;<i> contents of this information is prohibited. This message is not to be 
</I>&gt;<i> forwarded for any reason without prior consent of the sender.
</I>&gt;<i> If you have received this electronic transmission in error, please 
</I>&gt;<i> notify the sender immediately by telephone (250) 386-4266 or by a 
</I>&gt;<i> 'reply to sender' only message and destroy all electronic and hard 
</I>&gt;<i> copies of the communication, including attachments, without reading or 
</I>&gt;<i> saving in any manner.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042963.html">[Twisted-Python] Twistd thread problem
</A></li>
	<LI>Next message (by thread): <A HREF="042994.html">[Twisted-Python] Twistd thread problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42978">[ date ]</a>
              <a href="thread.html#42978">[ thread ]</a>
              <a href="subject.html#42978">[ subject ]</a>
              <a href="author.html#42978">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
