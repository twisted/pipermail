<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twistd thread problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twistd%20thread%20problem&In-Reply-To=9c78c12df892cc1b36503f8f3b12cc0e%40ezabel.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010470.html">
   <LINK REL="Next"  HREF="010492.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twistd thread problem</H1>
    <B>Gangadhar NPK</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twistd%20thread%20problem&In-Reply-To=9c78c12df892cc1b36503f8f3b12cc0e%40ezabel.com"
       TITLE="[Twisted-Python] Twistd thread problem">npk.gangadhar at gmail.com
       </A><BR>
    <I>Fri May 20 13:59:01 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010470.html">[Twisted-Python] Twistd thread problem
</A></li>
        <LI>Next message: <A HREF="010492.html">[Twisted-Python] Twistd thread problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10486">[ date ]</a>
              <a href="thread.html#10486">[ thread ]</a>
              <a href="subject.html#10486">[ subject ]</a>
              <a href="author.html#10486">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>All,
I am still trying to get a grip of what Twisted is and how to use it.
So my opinions might not be completely accurate.
But, this is not regarding Twisted anycase.
Orbitz, can you please state why do you think it is not a good idea to
use a worker thread. If the OP wanted to create a high volume SMTP
proxy with each worker thread handling every invocation from the smtp
client (smtplib in this case), then don't you think this can scale
better than a single thread, wherein the remaining clients are waiting
in the wait queue (if something like that exists, am not sure about
that) while one smtp data transfer is being done.
Also, if the OP chose to use a master-servant model wherein the master
thread keeps a tab on each of the worker thread to see the status and
(may be) notify the user (via a ui) of the status, the thread model
will work ?
Please share your thoughts on this.
Thank You
Gangadhar

On 5/18/05, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">orbitz at ezabel.com</A> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">orbitz at ezabel.com</A>&gt; wrote:
&gt;<i> If your making a proxy you shouldn't a queue or worker threads.  Just
</I>&gt;<i> connect to the destination and send your incoming data to it and it's
</I>&gt;<i> outgoing data back to the client.  This can all be done in one thread.
</I>&gt;<i> Even if you don't do it like this you also don't need a thread to send
</I>&gt;<i> the data, sending smtp is fairly trivial you can do it by hand, or use
</I>&gt;<i> the smtp client that comes with twisted (might as well learn sometime).
</I>&gt;<i> 
</I>&gt;<i> On May 16, 2005, at 7:50 PM, Jan Van Uytven wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Hi all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I coded an SMTP proxy that receives incoming e-mail requests and
</I>&gt;<i> &gt; pushes the received e-mail onto a Queue were it is processed by a
</I>&gt;<i> &gt; worker thread that finishes by sending the e-mail on to another SMTP
</I>&gt;<i> &gt; server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The server part of the proxy was written in Twisted, but the worker
</I>&gt;<i> &gt; thread uses smtplib to fire off the processed e-mails (I didn't know
</I>&gt;<i> &gt; how to use the twisted smtp client in a thread).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When I run the application using twistd -noy &lt;appname&gt;, it works
</I>&gt;<i> &gt; great. When I try to daemonize it (twistd -oy &lt;appname&gt;) the server
</I>&gt;<i> &gt; part works, but the worker thread doesn't. It creates and then I
</I>&gt;<i> &gt; suspect it immediately dies, as no error is returned upon creation. A
</I>&gt;<i> &gt; debug of the queue reveals that the thread is not pulling items off
</I>&gt;<i> &gt; it. A debugging statement placed at the top of the thread never runs,
</I>&gt;<i> &gt; and the twistd log reports nothing wrong. I'm using
</I>&gt;<i> &gt; reactor.callInThread to start the worker function.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I tried running twistd --spew -oy &lt;appname&gt; and captured the log it
</I>&gt;<i> &gt; produced. I did a filter for anything with 'thread' in it, this is the
</I>&gt;<i> &gt; result:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function ? in
</I>&gt;<i> &gt; /usr/lib/python2.3/site-packages/twisted/python/threadpool.py, line 11
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function WorkerStop in
</I>&gt;<i> &gt; /usr/lib/python2.3/site-packages/twisted/python/threadpool.py, line 23
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function init in
</I>&gt;<i> &gt; /usr/lib/python2.3/site-packages/twisted/python/threadable.py, line
</I>&gt;<i> &gt; 219
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function ThreadPool in
</I>&gt;<i> &gt; /usr/lib/python2.3/site-packages/twisted/python/threadpool.py, line 31
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function ThreadSafeList in
</I>&gt;<i> &gt; /usr/lib/python2.3/site-packages/twisted/python/threadpool.py, line
</I>&gt;<i> &gt; 199
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function init in
</I>&gt;<i> &gt; /usr/lib/python2.3/site-packages/twisted/python/threadable.py, line
</I>&gt;<i> &gt; 219
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method __init__ of
</I>&gt;<i> &gt; twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method start of
</I>&gt;<i> &gt; twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method adjustPoolsize of
</I>&gt;<i> &gt; twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method _startSomeWorkers of
</I>&gt;<i> &gt; twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method callInThread of
</I>&gt;<i> &gt; twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method _startSomeWorkers of
</I>&gt;<i> &gt; twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method startAWorker of
</I>&gt;<i> &gt; twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method __init__ of threading.Thread at
</I>&gt;<i> &gt; -1216568116
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method __init__ of threading.Thread at
</I>&gt;<i> &gt; -1216568116
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method _set_daemon of threading.Thread at
</I>&gt;<i> &gt; -1216568116
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function currentThread in
</I>&gt;<i> &gt; /usr/lib/python2.3/threading.py, line 669
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method isDaemon of threading._MainThread at
</I>&gt;<i> &gt; -1214935060
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function Condition in
</I>&gt;<i> &gt; /usr/lib/python2.3/threading.py, line 147
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method __init__ of threading._Condition at
</I>&gt;<i> &gt; -1216567604
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method __init__ of threading._Condition at
</I>&gt;<i> &gt; -1216567604
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method start of threading.Thread at
</I>&gt;<i> &gt; -1216568116
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method _note of threading.Thread at
</I>&gt;<i> &gt; -1216568116
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method run of threading.Thread at -1216568116
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method _worker of
</I>&gt;<i> &gt; twisted.python.threadpool.ThreadPool at -1216569236
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function currentThread in
</I>&gt;<i> &gt; /usr/lib/python2.3/threading.py, line 669
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function threadMailer in twisted-copyuser.py,
</I>&gt;<i> &gt; line 201
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method acquire of
</I>&gt;<i> &gt; twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method release of
</I>&gt;<i> &gt; twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method acquire of
</I>&gt;<i> &gt; twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method release of
</I>&gt;<i> &gt; twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method acquire of
</I>&gt;<i> &gt; twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] method release of
</I>&gt;<i> &gt; twisted.python.threadable._XLock at -1216639284
</I>&gt;<i> &gt; 2005/05/16 09:15 PDT [-] function registerAsIOThread in
</I>&gt;<i> &gt; /usr/lib/python2.3/site-packages/twisted/python/threadable.py, line
</I>&gt;<i> &gt; 262
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Why would the worker thread act differently with twistd daemonized?
</I>&gt;<i> &gt; Any suggestions, advice, or hints would be welcome.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Jan
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Jan Van Uytven
</I>&gt;<i> &gt; Computer Systems &amp; Network Engineer
</I>&gt;<i> &gt; Convergent Media Network
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wyvern at crm3.com</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Only in silence the word,
</I>&gt;<i> &gt; only in dark the light,
</I>&gt;<i> &gt; only in dying life:
</I>&gt;<i> &gt; Bright the hawk's flight on the empty sky.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - Ursula K. LeGuin, 'A Wizard of Earthsea'
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; *** LEGAL STUFF ***
</I>&gt;<i> &gt; This electronic message transmission, including any attached files,
</I>&gt;<i> &gt; contains information which may be confidential and/or privileged.
</I>&gt;<i> &gt; The information is intended to be for the SOLE use of the individual
</I>&gt;<i> &gt; or entity named above. If you are not the intended recipient, be aware
</I>&gt;<i> &gt; that any review, disclosure, copying, distribution or use of the
</I>&gt;<i> &gt; contents of this information is prohibited. This message is not to be
</I>&gt;<i> &gt; forwarded for any reason without prior consent of the sender.
</I>&gt;<i> &gt; If you have received this electronic transmission in error, please
</I>&gt;<i> &gt; notify the sender immediately by telephone (250) 386-4266 or by a
</I>&gt;<i> &gt; 'reply to sender' only message and destroy all electronic and hard
</I>&gt;<i> &gt; copies of the communication, including attachments, without reading or
</I>&gt;<i> &gt; saving in any manner.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010470.html">[Twisted-Python] Twistd thread problem
</A></li>
	<LI>Next message: <A HREF="010492.html">[Twisted-Python] Twistd thread problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10486">[ date ]</a>
              <a href="thread.html#10486">[ thread ]</a>
              <a href="subject.html#10486">[ subject ]</a>
              <a href="author.html#10486">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
