<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] how to cancel a long running job on a server ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20how%20to%20cancel%20a%20long%20running%20job%20on%20a%20server%20%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010422.html">
   <LINK REL="Next"  HREF="010426.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] how to cancel a long running job on a server ?</H1>
    <B>Thomas Jung</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20how%20to%20cancel%20a%20long%20running%20job%20on%20a%20server%20%3F&In-Reply-To="
       TITLE="[Twisted-Python] how to cancel a long running job on a server ?">Thomas.Jung at iisb.fraunhofer.de
       </A><BR>
    <I>Tue May 10 06:26:38 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010422.html">[Twisted-Python] need help with waitForDeferred...
</A></li>
        <LI>Next message: <A HREF="010426.html">[Twisted-Python] how to cancel a long running job on a server ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10423">[ date ]</a>
              <a href="thread.html#10423">[ thread ]</a>
              <a href="subject.html#10423">[ subject ]</a>
              <a href="author.html#10423">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

another newbie question:

I have a server, where I can remotely call a function like remote_calc(), 
using the perspective broker,
which returns giving a result.
Sometimes, I want to cancel that computation, calling e.g. remote_cancel() 
(which remains to be implemented.....)

How can I have remote_calc() not to return before the result is done, and 
still be able to call remote_cancel while its running ?

I tried this:
=============================================================

from twisted.spread import pb
from twisted.internet import reactor,defer,threads

@defer.deferredGenerator
def calc(adeferred):
    print &quot;this is calc...&quot;
    d=defer.waitForDeferred(adeferred)
    yield d
    result=d.getResult()
    print &quot;calc: result=&quot;,result
    return


def do_calc():
    print &quot;do_calc starting...&quot;
    for i in range(10000):
        for j in range(10000):
            pass
    print &quot;do_calc done...&quot;
    return 456


class ServerObject(pb.Root):

    def remote_cancel(self):
        print &quot;this is server::cancel...&quot;

    def remote_calc(self,result):
        print &quot;server::calc: ...&quot;

       # thought this would wait until done, but doesnt....

        calc(threads.deferToThread(do_calc))
        print &quot;server::calc: returning&quot;
        return 123


if __name__ == '__main__':
    factory = pb.PBServerFactory(ServerObject())
    reactor.listenTCP(8800, factory)
    reactor.run()

===============================================================================

My expectation was that the call to &quot;calc&quot; in remote_calc would block, but it 
does not.
And if I dont defer the calculation to a thread, remote_cancel is not done 
until calculation finishes ...

Maybe there is some completely different way to do this in twisted ?

Thanks for any hint !



-- 
Dr. Thomas Jung
Fraunhofer-Institut IISB
91058 Erlangen, Schottkystr. 10
+49 9131 761264


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010422.html">[Twisted-Python] need help with waitForDeferred...
</A></li>
	<LI>Next message: <A HREF="010426.html">[Twisted-Python] how to cancel a long running job on a server ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10423">[ date ]</a>
              <a href="thread.html#10423">[ thread ]</a>
              <a href="subject.html#10423">[ subject ]</a>
              <a href="author.html#10423">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
