<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted compatibility with multiprocessing module in fork+execv mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20compatibility%20with%20multiprocessing%20module%0A%20in%20fork%2Bexecv%20mode&In-Reply-To=%3C58908503.20626.1443608736676.JavaMail.zimbra%40voismart.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062230.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted compatibility with multiprocessing module in fork+execv mode</H1>
    <B>Flavio Grossi</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20compatibility%20with%20multiprocessing%20module%0A%20in%20fork%2Bexecv%20mode&In-Reply-To=%3C58908503.20626.1443608736676.JavaMail.zimbra%40voismart.it%3E"
       TITLE="[Twisted-Python] twisted compatibility with multiprocessing module in fork+execv mode">fgrossi at voismart.it
       </A><BR>
    <I>Wed Sep 30 04:25:36 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062230.html">[Twisted-Python] Usage and testing of the new logging system
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29768">[ date ]</a>
              <a href="thread.html#29768">[ thread ]</a>
              <a href="subject.html#29768">[ subject ]</a>
              <a href="author.html#29768">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I know the multiprocessing module is not properly supported by twisted apps because of the interactions among duplicated file descriptors and signal handling, as discussed other times.

But python 3.4 introduces a new mode to use that module by spawning (i.e. fork() followed by execv()) the new processes instead of simply forking it.

So my question is how supported this is by twisted, and in general how safe it is to use subprocesses created by duplicating the parent immediately followed by the execv of a fresh interpreter.

What i'm thinking is something like this, to asynchronously process requests and delegate the cpu-bound work to some processes:

import multiprocessing

def worker(q):
    while True:
        work = q.get()
        do_something_cpu_bound_with(work)

def main():
    context = multiprocessing.get_context('spawn')
    q = context.Queue()
    p = context.Process(target=worker, args=(q,))
    p.start()
    q.put_nowait(work) # when async requests are made

if __name__ == '__main__':
    from twisted.internet import reactor
    reactor.callWhenRunning(main)
    reactor.run()

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062230.html">[Twisted-Python] Usage and testing of the new logging system
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29768">[ date ]</a>
              <a href="thread.html#29768">[ thread ]</a>
              <a href="subject.html#29768">[ subject ]</a>
              <a href="author.html#29768">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
