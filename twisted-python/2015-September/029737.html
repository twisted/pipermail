<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] HAProxy and twisted TCP/IP support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20HAProxy%20and%20twisted%20TCP/IP%20support&In-Reply-To=%3CA26CF3BB-3692-4B65-B3FC-FDA633514E18%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029711.html">
   <LINK REL="Next"  HREF="029712.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] HAProxy and twisted TCP/IP support</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20HAProxy%20and%20twisted%20TCP/IP%20support&In-Reply-To=%3CA26CF3BB-3692-4B65-B3FC-FDA633514E18%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] HAProxy and twisted TCP/IP support">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Sep  8 00:51:14 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029711.html">[Twisted-Python] HAProxy and twisted TCP/IP support
</A></li>
        <LI>Next message: <A HREF="029712.html">[Twisted-Python] Converting str to bytes in Py3 port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29737">[ date ]</a>
              <a href="thread.html#29737">[ thread ]</a>
              <a href="subject.html#29737">[ subject ]</a>
              <a href="author.html#29737">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Aug 31, 2015, at 11:48 PM, Zuhaib Siddique &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">zuhaib at hipchat.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hey all,
</I>
Hi Zuhaib!  Thanks for writing.

&gt;<i> I am looking at using HAProxy in front of Twisted for TCP connection and need to pass the source IP along.  We are currently looking at hacking tcp.py to add support for this: <A HREF="http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt">http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt</A> but wondering if this is something someone is already working on for twisted or maybe I dont need to hack tcp.py.
</I>
I am not aware of an implementation of this protocol, but it looks very interesting!  The usual argument I hear for load-balancing HTTP rather than TCP is that you lose information about the network protocol you're speaking that would be preserved by the &quot;Forwarded&quot; or &quot;X-Forwarded-For&quot; header.  But if Twisted supported this protocol then it could live behind haproxy with no loss of information, regardless of protocol!  And if it had a server-side version of this it could load-balance other similarly equipped software.  Exciting possibilities all around.

Hacking tcp.py is definitely the wrong way to go about implementing it, though.

The right way to go about this would be to implement a transceiver: something that implements a protocol for its transport, and implements a transport for another protocol.  The best example of this within Twisted right now is twisted.protocols.tls, the OpenSSL integration that superseded our much grosser, less flexible hacking of tcp.py.

So for this proxy protocol, you'd have a protocol that waited until it received the full PROXY protocol header (whether text-based or binary) and implement ITCPTransport to have values in getHost() and getPeer() that correspond to the values received from the PROXY message.

Does that make sense?

If I have an idle moment I might try my hand at an implementation myself, but I am not always super reliable ;-).

&gt;<i> Thanks
</I>&gt;<i> Zuhaib
</I>
-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20150907/2a0d45c8/attachment-0001.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20150907/2a0d45c8/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029711.html">[Twisted-Python] HAProxy and twisted TCP/IP support
</A></li>
	<LI>Next message: <A HREF="029712.html">[Twisted-Python] Converting str to bytes in Py3 port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29737">[ date ]</a>
              <a href="thread.html#29737">[ thread ]</a>
              <a href="subject.html#29737">[ subject ]</a>
              <a href="author.html#29737">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
