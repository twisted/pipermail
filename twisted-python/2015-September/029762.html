<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] inlineCallbacks eating unhandled exceptions?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20inlineCallbacks%20eating%20unhandled%20exceptions%3F&In-Reply-To=%3C3925E79A0E74A8438C83BF14914196B46A7C0971F5%40OPSYWNSR0152.comp.optiver.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062221.html">
   <LINK REL="Next"  HREF="062225.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] inlineCallbacks eating unhandled exceptions?</H1>
    <B>Timothy Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20inlineCallbacks%20eating%20unhandled%20exceptions%3F&In-Reply-To=%3C3925E79A0E74A8438C83BF14914196B46A7C0971F5%40OPSYWNSR0152.comp.optiver.com%3E"
       TITLE="[Twisted-Python] inlineCallbacks eating unhandled exceptions?">Timothy.Allen at optiver.com.au
       </A><BR>
    <I>Thu Sep 24 22:30:50 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062221.html">[Twisted-Python] Paid summer work for the Twisted Software	Foundation
</A></li>
        <LI>Next message (by thread): <A HREF="062225.html">[Twisted-Python] inlineCallbacks eating unhandled exceptions?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29762">[ date ]</a>
              <a href="thread.html#29762">[ thread ]</a>
              <a href="subject.html#29762">[ subject ]</a>
              <a href="author.html#29762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The other day I was experimenting with the inlineCallbacks decorator in Twisted 15.4, and occasionally when I'd typo a variable name or similar, I'd  get an &quot;unhandled error&quot; in the log without a traceback, which was rather unhelpful. Eventually, I managed to produce the following test-case:

    <A HREF="https://gist.github.com/OptiverTimAll/43263a7a4cf5a298e8f5">https://gist.github.com/OptiverTimAll/43263a7a4cf5a298e8f5</A>

If I run it as-is, I get the following unhelpful output:

    CRITICAL:twisted:Unhandled error in Deferred:
    CRITICAL:twisted:

If I comment out the line that redirects Twisted's logging to the standard library's logging system, I get much more helpful output:

    Unhandled error in Deferred:


    Traceback (most recent call last):
      File &quot;./ic-test.py&quot;, line 20, in &lt;module&gt;
        bogus_callback()
      File &quot;/home/timall/.virtualenvs/txfuse/lib/python2.7/site-packages/twisted/internet/defer.py&quot;, line 1274, in unwindGenerator
        return _inlineCallbacks(None, gen, Deferred())
    --- &lt;exception caught here&gt; ---
      File &quot;/home/timall/.virtualenvs/txfuse/lib/python2.7/site-packages/twisted/internet/defer.py&quot;, line 1128, in _inlineCallbacks
        result = g.send(result)
      File &quot;./ic-test.py&quot;, line 17, in bogus_callback
        yield does_not_exist()
    exceptions.NameError: global name 'does_not_exist' is not defined

I expected that changing the destination of log messages wouldn't change their content, but apparently I was wrong. I got the incantation for re-routing Twisted's logging system into the Python one by stitching together code-snippets from <A HREF="http://twistedmatrix.com/documents/current/core/howto/logger.html#starting-the-global-log-publisher">http://twistedmatrix.com/documents/current/core/howto/logger.html#starting-the-global-log-publisher</A> Is there some better way, or some other thing I should be doing?

--
Timothy Allen
Tools Developer

39 Hunter Street, Sydney NSW 2000
T: +61 2 9275 6000 &#9474; F: +61 2 9275 6150
W: <A HREF="http://www.optiver.com/sydney">http://www.optiver.com/sydney</A>
We're hiring (lots)!

Information contained in this communication (including any attachments) is confidential and may be privileged or subject to copyright.  If you have received this communication in error you are not authorised to use the information in any way and Optiver requests that you notify the sender by return email, destroy all copies and delete the information from your system.  Optiver does not represent, warrant or guarantee that this communication is free from computer viruses or other defects or that the integrity of this communication has been maintained.  Any views expressed in this communication are those of the individual sender.  Optiver does not accept liability for any loss or damage caused directly or indirectly by this communication or its use.

Please consider the environment before printing this email.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062221.html">[Twisted-Python] Paid summer work for the Twisted Software	Foundation
</A></li>
	<LI>Next message (by thread): <A HREF="062225.html">[Twisted-Python] inlineCallbacks eating unhandled exceptions?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29762">[ date ]</a>
              <a href="thread.html#29762">[ thread ]</a>
              <a href="subject.html#29762">[ subject ]</a>
              <a href="author.html#29762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
