<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] newbie confusion - puzzling reactor response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20newbie%20confusion%20-%20puzzling%20reactor%20response&In-Reply-To=%3C9D980C3C-84F2-48C5-A89A-245978D4996E%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054042.html">
   <LINK REL="Next"  HREF="054044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] newbie confusion - puzzling reactor response</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20newbie%20confusion%20-%20puzzling%20reactor%20response&In-Reply-To=%3C9D980C3C-84F2-48C5-A89A-245978D4996E%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] newbie confusion - puzzling reactor response">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Feb 12 18:58:46 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054042.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
        <LI>Next message (by thread): <A HREF="054044.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54043">[ date ]</a>
              <a href="thread.html#54043">[ thread ]</a>
              <a href="subject.html#54043">[ subject ]</a>
              <a href="author.html#54043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Feb 12, 2010, at 3:11 PM, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:

&gt;<i> On 07:35 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rich at noir.com</A> wrote:
</I>&gt;&gt;<i> 
</I>
&gt;&gt;<i> Er... on second thought... isn't there still a utility in asynchronous
</I>&gt;&gt;<i> file io which yields to the reactor?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> It may be always readable/writable, but if I simply read/write, I'll
</I>&gt;&gt;<i> block the process for as long as that takes, block on read, block on
</I>&gt;&gt;<i> write.  Whereas if I use async io on the descriptor and go through the
</I>&gt;&gt;<i> reactor, I'm effectively yielding to the reactor and any other
</I>&gt;&gt;<i> actionable descriptors on each loop as well as allowing my reads and
</I>&gt;&gt;<i> writes to happen simultaneously.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Or am I missing something?
</I>&gt;<i> 
</I>&gt;<i> There could be utility in such, but Twisted has no support for it, 
</I>&gt;<i> largely because actual support on various platforms is still pretty 
</I>&gt;<i> ragged.
</I>&gt;<i> 
</I>&gt;<i> On Linux, you can get the aio_* family of functions, but they're pretty 
</I>&gt;<i> crap.  They have tons of limitations (only block-aligned reads allowed, 
</I>&gt;<i> only a certain number of outstanding operations (system wide) at a time, 
</I>&gt;<i> etc, and the failure mode for not complying with these limitations is 
</I>&gt;<i> that the APIs block).
</I>&gt;<i> 
</I>&gt;<i> It's a bit better on Windows, so someone could probably fashion an 
</I>&gt;<i> extension to iocpreactor for this.  There isn't a lot of developer 
</I>&gt;<i> attention focused on implementing Windows-only extensions right now, 
</I>&gt;<i> though.
</I>
In my opinion, the right way to go about something like this would be to come up with an API for asynchronous File I/O in Twisted, implement that API using subprocesses or maybe the reactor threadpool, and then attempt to optimize and simplify it using special platform-speciifc APIs later.  (Important note: do not _expose_ the threaded nature of the code to application code at any point: just deliver the data to something in the reactor thread, to dispatch as it sees fit.)

My impression is that OS-level asynchronous file I/O APIs are fairly raw because, unlike network connectivity, you won't get thousands of connections at once.  If you only have one disk, you can only really get a benefit from two, maybe three file I/O slave processes, and that's a fairly small amount of resources to manage.  Granted, it's tricky to really identify how many &quot;disks&quot; you've got in a system, and the performance characteristics change radically based on what kind of disk technology is involved, but generally speaking a few worker threads and a queue of I/O operations would cover the vast majority of use-cases.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054042.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
	<LI>Next message (by thread): <A HREF="054044.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54043">[ date ]</a>
              <a href="thread.html#54043">[ thread ]</a>
              <a href="subject.html#54043">[ subject ]</a>
              <a href="author.html#54043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
