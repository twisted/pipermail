<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Is AMP secure enough for the internet?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Is%20AMP%20secure%20enough%20for%20the%20internet%3F&In-Reply-To=%3C389E5688-EDCF-4F8B-8223-D90632D40F27%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054196.html">
   <LINK REL="Next"  HREF="054202.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Is AMP secure enough for the internet?</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Is%20AMP%20secure%20enough%20for%20the%20internet%3F&In-Reply-To=%3C389E5688-EDCF-4F8B-8223-D90632D40F27%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Is AMP secure enough for the internet?">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Feb 28 16:34:26 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054196.html">[Twisted-Python] Is AMP secure enough for the internet?
</A></li>
        <LI>Next message (by thread): <A HREF="054202.html">[Twisted-Python] Is AMP secure enough for the internet?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54204">[ date ]</a>
              <a href="thread.html#54204">[ thread ]</a>
              <a href="subject.html#54204">[ subject ]</a>
              <a href="author.html#54204">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 27, 2010, at 3:59 PM, Attila Nagy wrote:

&gt;<i> Hello,
</I>
Hello!

&gt;<i> I'm planning a data collector gateway and wondering whether Twisted's
</I>&gt;<i> AMP would be good for the task.
</I>
Yes, I believe so.

&gt;<i> AMP seems to be a good fit for the job, but I'm not sure about the
</I>&gt;<i> security. I make the client side too, but I won't operate it, bad guys
</I>&gt;<i> can take over that side and I want to protect my side.
</I>
This is a good rule to live by with any internet protocol :).

&gt;<i> What would I like to do:
</I>&gt;<i> 1. authenticate and authorize connecting clients with their SSL certificates
</I>&gt;<i> 2. securely transfer arbitrary (binary and json) data from and to the
</I>&gt;<i> clients (both the server and client would be twisted)
</I>&gt;<i> 3. protect the server from malicious clients
</I>&gt;<i> 
</I>&gt;<i> I have some concerns about all three. For the first, is this OK now:
</I>&gt;<i> <A HREF="http://twistedmatrix.com/pipermail/twisted-python/2007-August/015926.html">http://twistedmatrix.com/pipermail/twisted-python/2007-August/015926.html</A> ?
</I>
I'm not sure what you're asking.  The example given in that message is doing a blocking handshake, which is still a bad idea.  I don't believe the bug being described has been fixed (although I hope someone will correct me and tell me I'm wrong).

However, you can authenticate connections with TLS certificates by using a command that inherits from AMP's StartTLS, and do the verification in the provided callback.

Bootstrapping the TLS connection off of a plaintext connection is generally a better idea anyway, since that way you can support features like virtual hosting - when your client asks to secure the connection, the server can know who the client thinks it is talking to and intermediaries can route the connection to the appropriate back-end endpoint without necessarily understanding the protocol past that point.

&gt;<i> For the second: the server should not be affected by the data which the
</I>&gt;<i> client sends. I mean exploiting bugs in the data paths and limited
</I>&gt;<i> protection from DoS, like abusing blocking pieces of code and therefore
</I>&gt;<i> halting the reactor, or preventing memory overflow (if it sends 3TBs of
</I>&gt;<i> data, it shouldn't be queued up in RAM, I should be in control about
</I>&gt;<i> what happens in this case, or twisted should be clear measures for
</I>&gt;<i> these) etc...
</I>
If you really want to harden Twisted's AMP implementation, you'll have to do a bit more work.  Right now, individual AMP keys can only be 255 bytes, individual values are restricted to 65535 bytes, but boxes (messages of key/value pairs) can be arbitrarily big.  It would be good to have a limit which restricted their size, and it would be fairly simple to do.

Really DoS-proof protocols are really hard, but AMP's wire-level design is intentionally simple to make it amenable to lots of implementation hardening against many different types of attack.

In other words, it is not already the protocol code that you want, but it would be easier to make AMP into the code that you want than to start from scratch.

&gt;<i> And by the third I mean the above, plus for example if I have only one
</I>&gt;<i> command defined for AMP with one string argument then no matter what
</I>&gt;<i> happens, the client should only access that function  with that argument
</I>&gt;<i> and no other part of the program.
</I>
To my knowledge, AMP is already completely secure in this sense.  I'm not a security auditor, but I would be _very_ surprised if you could execute arbitrary code by sending any sequence of bytes to a simple Twisted AMP server which only took a string argument.

&gt;<i> How do you feel, is Twisted and AMP a good choice for that?
</I>
Yes.

Thanks for considering it,

-glyph



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054196.html">[Twisted-Python] Is AMP secure enough for the internet?
</A></li>
	<LI>Next message (by thread): <A HREF="054202.html">[Twisted-Python] Is AMP secure enough for the internet?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54204">[ date ]</a>
              <a href="thread.html#54204">[ thread ]</a>
              <a href="subject.html#54204">[ subject ]</a>
              <a href="author.html#54204">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
