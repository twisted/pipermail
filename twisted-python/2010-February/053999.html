<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Handling exceptions in twisted.internet.udp?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Handling%20exceptions%20in%20twisted.internet.udp%3F&In-Reply-To=%3C20100208165705.26099.1521985357.divmod.xquotient.793%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053998.html">
   <LINK REL="Next"  HREF="054000.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Handling exceptions in twisted.internet.udp?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Handling%20exceptions%20in%20twisted.internet.udp%3F&In-Reply-To=%3C20100208165705.26099.1521985357.divmod.xquotient.793%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] Handling exceptions in twisted.internet.udp?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Feb  8 09:57:05 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053998.html">[Twisted-Python] Handling exceptions in twisted.internet.udp?
</A></li>
        <LI>Next message (by thread): <A HREF="054000.html">[Twisted-Python] Handling exceptions in twisted.internet.udp?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53999">[ date ]</a>
              <a href="thread.html#53999">[ thread ]</a>
              <a href="subject.html#53999">[ subject ]</a>
              <a href="author.html#53999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04:20 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bra at fsn.hu</A> wrote:
&gt;<i>Hello,
</I>&gt;<i>
</I>&gt;<i>I have a code, which opens persistent (connected, see:
</I>&gt;<i><A HREF="http://twistedmatrix.com/documents/current/core/howto/udp.html#auto2">http://twistedmatrix.com/documents/current/core/howto/udp.html#auto2</A>)
</I>&gt;<i>UDP connections, and sends and receives data on them.
</I>&gt;<i>
</I>&gt;<i>The problem is that occasionally I receive ICMP 13 (administratively
</I>&gt;<i>prohibited) errors from the destinations, which triggers and exception
</I>&gt;<i>and closes the UDP socket. I would like to keep that open, no matter
</I>&gt;<i>what happens.
</I>&gt;<i>On FreeBSD the exception comes during writing into the socket with
</I>&gt;<i>transport.write, so this is an easy one.
</I>
This is probably a bug:

  <A HREF="http://twistedmatrix.com/trac/ticket/2790">http://twistedmatrix.com/trac/ticket/2790</A>

So you're right that you have to handle it in your app code (and that 
it's easy to do so, fortunately).  Hopefully someday this will no longer 
be true.
&gt;<i>But on Linux it's a little bit harder, because there I get exception 
</I>&gt;<i>not
</I>&gt;<i>during writing, but reading, which is handled here:
</I>&gt;<i><A HREF="http://twistedmatrix.com/trac/browser/tags/releases/twisted-9.0.0/twisted/internet/udp.py#L113">http://twistedmatrix.com/trac/browser/tags/releases/twisted-9.0.0/twisted/internet/udp.py#L113</A>
</I>
And this looks like another bug. :)
&gt;<i>[snip]
</I>&gt;<i>&quot;/usr/lib64/python2.6/site-packages/Twisted-9.0.0_r27775-py2.6-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/udp.py&quot;,
</I>&gt;<i>line 109, in doRead
</I>&gt;<i>            data, addr = self.socket.recvfrom(self.maxPacketSize)
</I>&gt;<i>        socket.error: [Errno 113] No route to host
</I>&gt;<i>
</I>&gt;<i>I wonder what is the preferred way of achieving that the socket will be
</I>&gt;<i>write()-able and kept open regardless what ICMP or other sending or
</I>&gt;<i>receiving error occurs?
</I>
It seems like udp.py should be handling EHOSTUNREACH (and probably 
several more errors that it also misses currently).  There's already a 
`connectionRefused` callback which could be invoked to handle these 
cases.

This seems pretty related to another open ticket:

  <A HREF="http://twistedmatrix.com/trac/ticket/3396">http://twistedmatrix.com/trac/ticket/3396</A>

Aside from monkey-patching the doRead method, I don't see a way for an 
application to handle this one.

Development has started on fixing each of these issues.  The latter 
seems to even have been reviewed and is now waiting for someone to 
address the review feedback.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053998.html">[Twisted-Python] Handling exceptions in twisted.internet.udp?
</A></li>
	<LI>Next message (by thread): <A HREF="054000.html">[Twisted-Python] Handling exceptions in twisted.internet.udp?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53999">[ date ]</a>
              <a href="thread.html#53999">[ thread ]</a>
              <a href="subject.html#53999">[ subject ]</a>
              <a href="author.html#53999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
