<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Try/catching yielded Exceptions and getting proper	tracebacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Try/catching%20yielded%20Exceptions%20and%20getting%20proper%0A%09tracebacks&In-Reply-To=%3C4B822C30.2050709%40vultaire.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054158.html">
   <LINK REL="Next"  HREF="054138.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Try/catching yielded Exceptions and getting proper	tracebacks</H1>
    <B>Paul Goins</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Try/catching%20yielded%20Exceptions%20and%20getting%20proper%0A%09tracebacks&In-Reply-To=%3C4B822C30.2050709%40vultaire.net%3E"
       TITLE="[Twisted-Python] Try/catching yielded Exceptions and getting proper	tracebacks">general at vultaire.net
       </A><BR>
    <I>Mon Feb 22 00:03:12 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054158.html">[Twisted-Python] [ANNOUNCE] Twisted 10.0.0pre1 is now released
</A></li>
        <LI>Next message (by thread): <A HREF="054138.html">[Twisted-Python] Try/catching yielded Exceptions and getting	proper	tracebacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54135">[ date ]</a>
              <a href="thread.html#54135">[ thread ]</a>
              <a href="subject.html#54135">[ subject ]</a>
              <a href="author.html#54135">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm frequently using the inlineCallbacks idiom for writing code, but am
often finding myself frustrated with rather counterintuitive tracebacks.

Let's say I'm writing an XML-RPC handler, and even if an exception
occurs, I want it to return something to the user and dump the exception
to the log file.  However, if an exception occurs when I'm using the
inlineCallbacks decorator, I sometimes get lacking tracebacks.  Maybe
I'll have the line number of the function that yielded the exception,
but I'll have no detailed information as to where the exception really
came from.

For example, in the example I've pasted at the end of this mail, I get a
traceback as follows:

Traceback (most recent call last):
  File &quot;exceptions.py&quot;, line 13, in xmlrpc_dosomething
    result = yield self._do_something_else()
Exception: die die die!!!

However, the exception happens within _do_something_else on line 20.

I have a simple complete example copy/pasted below.  Is there a better
way to accomplish this?

Thanks.

- Paul Goins

-----------------------------------
from twisted.web.xmlrpc import XMLRPC
from twisted.web.server import Site
from twisted.web.resource import Resource
from twisted.internet import reactor, defer
import sys, traceback


class MyApp(XMLRPC):

    @defer.inlineCallbacks
    def xmlrpc_dosomething(self):
        try:
            result = yield self._do_something_else()
            defer.returnValue(result)
        except Exception:
            print &gt;&gt; sys.stderr, traceback.format_exc()

    @defer.inlineCallbacks
    def _do_something_else(self):
        yield
        raise Exception(&quot;die die die!!!&quot;)

@defer.inlineCallbacks
def cause_trouble(app):
    val = yield app.xmlrpc_dosomething()
    print val
    reactor.stop()

if __name__ == &quot;__main__&quot;:
    app = MyApp()
    r = Resource()
    r.putChild(&quot;RPC2&quot;, app)
    s = Site(r)
    reactor.listenTCP(8123, s)
    reactor.callLater(0.2, cause_trouble, app)
    reactor.run()




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054158.html">[Twisted-Python] [ANNOUNCE] Twisted 10.0.0pre1 is now released
</A></li>
	<LI>Next message (by thread): <A HREF="054138.html">[Twisted-Python] Try/catching yielded Exceptions and getting	proper	tracebacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54135">[ date ]</a>
              <a href="thread.html#54135">[ thread ]</a>
              <a href="subject.html#54135">[ subject ]</a>
              <a href="author.html#54135">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
