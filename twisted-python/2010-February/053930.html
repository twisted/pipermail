<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] understanding deferreds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20understanding%20deferreds&In-Reply-To=%3C19303.28211.344816.837753%40jon.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053928.html">
   <LINK REL="Next"  HREF="053934.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] understanding deferreds</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20understanding%20deferreds&In-Reply-To=%3C19303.28211.344816.837753%40jon.es%3E"
       TITLE="[Twisted-Python] understanding deferreds">terry at jon.es
       </A><BR>
    <I>Mon Feb  1 17:13:39 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053928.html">[Twisted-Python] understanding deferreds
</A></li>
        <LI>Next message (by thread): <A HREF="053934.html">[Twisted-Python] understanding deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53930">[ date ]</a>
              <a href="thread.html#53930">[ thread ]</a>
              <a href="subject.html#53930">[ subject ]</a>
              <a href="author.html#53930">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;&gt;&gt;&gt;<i> &quot;Alexey&quot; == twisted-web  &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-web at udmvt.ru</A>&gt; writes:
</I>
Alexey&gt; Is it true, that adding many callback functions as filters is
Alexey&gt; elegant, but impractical solution?

Many callbacks as a filter is elegant &amp; practical.

But there's a difference with errbacks, as people are touching on. That's,
with a bit of hand-waving, because when things are going right there's only
one thing happening - you're in the middle of a computation figuring out
the single result. With errors though, there are multiple types of errors,
many ways of dealing with them, multiple different possible outcomes when
an error occurs.

So the callback chain is great when everything is working, but the errback
chain can sometimes feel like it's not quite the right tool for the job.
But there are some techniques to mitigate that, and I think they work quite
well.

Alexey&gt; Since there is only a [linear] list of pairs (callback, errback),
Alexey&gt; the last errbacks have to be complex to distinguish the failures,
Alexey&gt; that came from the previous callback from failures, that traverse
Alexey&gt; the errback chain from the beginning.

Alexey&gt; Should I only use errbacks as a means of catching errors only from
Alexey&gt; who have produced the Deferred?  And never use them to catch
Alexey&gt; errors, that came from my callbacks?

No. One thing to think about is the flow down the call/errback chain. You
can do something like this.

  d = IReturnADeferred()

  d.addErrback(e1)
  d.addCallback(c1)

  d.addErrback(e2, 'first')

  d.addCallback(c2)
  d.addCallback(c3)
  d.addErrback(e2, 'second')

Here e1 will only get errors created by IReturnADeferred. If
IReturnADeferred has no problem, you're into c1 and e1 is &quot;behind&quot; you on
the call/errback chain. Note that I add e2 to the errback chain twice.
That's a way of having the same function be called for (perhaps) the same
reason, but on the chain in 2 places. By the time the flow of control gets
to c2 or c3, e2 can only be called with 'second' as its argument.

Alexey&gt; Nevertheless the Deferred mechanism always catch the exceptions in
Alexey&gt; my callbacks, I have to always catch them myself and never let them
Alexey&gt; out uncontrolled (since I cannot distinguish, say TypeError that
Alexey&gt; came from the first callback from TypeError, that came from the
Alexey&gt; next callback, and they are not the same for me, since I try to do
Alexey&gt; a cleanup)?  But then I have to translate all errors to my invented
Alexey&gt; exceptions, so they will differ.

See the above example.

Alexey&gt; Or just tell me, that I have missed something, I'm still getting
Alexey&gt; into the theme!

The other thing that's very useful is to write errbacks like this:

  def e1(fail):
    fail.trap(TypeError, KeyError)
    # Do stuff to handle just TypeError, KeyError

  def e2(fail):
    fail.trap(MyException)
    # Do stuff to handle MyException

then you just do

  d = IReturnADeferred()
  d.addErrback(e1)
  d.addErrback(e2)

The fail.trap will cause the function to immediately return the current
failure if it's not one of the mentioned types. See also fail.check (which
is what trap uses).  I.e., go read the source of twisted.python.failure

That approach is nice because you can write your err handling methods
completely separately, and can probably not worry about the order you list
them in, etc. The failure just falls down the errback chain until it hits
something that can deal with it (&quot;trap&quot; it).


Another thing you could do (a bit of a hack) is to add an attribute to a
failure object to mark that you've processed it (e.g., that it has been
logged).

And you might want to read the recent post to this list by Brian Warner
(which I've also been meaning to reply to - hi Brian!). See
<A HREF="http://twistedmatrix.com/pipermail/twisted-python/2010-January/021330.html">http://twistedmatrix.com/pipermail/twisted-python/2010-January/021330.html</A>

Probably others have suggestions on nice ways to handle particular
cases. Those are just some that I've used.

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053928.html">[Twisted-Python] understanding deferreds
</A></li>
	<LI>Next message (by thread): <A HREF="053934.html">[Twisted-Python] understanding deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53930">[ date ]</a>
              <a href="thread.html#53930">[ thread ]</a>
              <a href="subject.html#53930">[ subject ]</a>
              <a href="author.html#53930">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
