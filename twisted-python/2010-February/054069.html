<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Authenticating with md5 hashed passwords
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Authenticating%20with%20md5%20hashed%20passwords&In-Reply-To=%3C20100215164511.26099.288315412.divmod.xquotient.1343%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054068.html">
   <LINK REL="Next"  HREF="054071.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Authenticating with md5 hashed passwords</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Authenticating%20with%20md5%20hashed%20passwords&In-Reply-To=%3C20100215164511.26099.288315412.divmod.xquotient.1343%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] Authenticating with md5 hashed passwords">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Feb 15 09:45:11 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054068.html">[Twisted-Python] Authenticating with md5 hashed passwords
</A></li>
        <LI>Next message (by thread): <A HREF="054071.html">[Twisted-Python] Authenticating with md5 hashed passwords
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54069">[ date ]</a>
              <a href="thread.html#54069">[ thread ]</a>
              <a href="subject.html#54069">[ subject ]</a>
              <a href="author.html#54069">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04:32 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">raq at cttc.upc.edu</A> wrote:
&gt;<i>Jean-Paul:
</I>&gt;<i>
</I>&gt;<i>On Mon, 2010-02-15 at 13:25 +0000, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i> &gt;&gt;What do you mean when you say you're using plain text passwords?
</I>&gt;&gt;<i> &gt;&gt;Authentication involves multiple parties handling the password in
</I>&gt;&gt;<i> &gt;&gt;multiple ways, and the &quot;plain text&quot;-ness of the password changes 
</I>&gt;&gt;<i>from
</I>&gt;&gt;<i> &gt;&gt;step to step.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;I mean that the the server authenticates the client using a NOT 
</I>&gt;&gt;<i>HASHED
</I>&gt;&gt;<i> &gt;password. In my case using a VARCHAR field in a PostgreSQL table
</I>&gt;&gt;<i> &gt;&gt; &gt;from hashlib import md5
</I>&gt;&gt;<i> &gt;&gt; &gt;md5Password = md5(password).hexdigest()
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I'm confused here.  I don't see this code in your checker 
</I>&gt;&gt;<i>implementation
</I>&gt;&gt;<i>in the attached code.  Is this code running someplace else?
</I>&gt;<i>
</I>&gt;<i>No, of course you can not. This is only a little python script I use to
</I>&gt;<i>produce I hashed password that I can put in the VARCHAR field of my
</I>&gt;<i>PostgreSQL table. This way I can make 'pure-ftpd' authenticate using 
</I>&gt;<i>md5
</I>&gt;<i>hashed passwords, but for that reason I have to change pb.py code at
</I>&gt;<i>twisted, swaping '.digest()' with '.hexdigest()'.
</I>&gt;<i>That way it works but at the price of having to change original twisted
</I>&gt;<i>code, which is not the option I want to support.
</I>
Ah, I see.  I didn't understand that you had MD5 hashed passwords stored 
in your database.

Fortunately, the .digest() and .hexdigest() outputs of an MD5 object are 
related in a simple way.  You can go from one to the other using 
str.encode('hex') or str.decode('hex').

So, if you have hex encoded MD5 digests in your database table, then you 
can convert them to the regular MD5 digests expected by PB with 
hex_digest_password.decode('hex') and pass the result of that to 
`checkMD5Password`.
&gt;&gt;<i>
</I>&gt;&gt;<i>Indeed.  `checkMD5Password` needs to be passed the MD5 digest of the
</I>&gt;&gt;<i>password, not the hex encoded MD5 digest (despite being documented as
</I>&gt;&gt;<i>taking the plaintext password itself).
</I>&gt;<i>
</I>&gt;<i>Yes I can understand that. So if I could put ha md5 hashed password in
</I>&gt;<i>the database but using digest() instead of hexdigest() I could make the
</I>&gt;<i>server authenticate but using 'checkMD5Password()' method directly a 
</I>&gt;<i>the
</I>&gt;<i>checker, but as you have said this is going to be deprecated.
</I>
This discussion has led me to realize that checkMD5Password probably 
shouldn't be deprecated.  Instead the documentation should be fixed so 
that it's clear why it's useful.

So, assuming we don't deprecate it, and you use the decode('hex') 
approach above, does that let you do your authentication for both apps 
and let you avoid keeping a modified version of Twisted?
&gt;&gt;<i> &gt;So, how should I do it in order not to be using deprecated code? I
</I>&gt;&gt;<i> &gt;would
</I>&gt;&gt;<i> &gt;like to know some details so that I can have a better understanding 
</I>&gt;&gt;<i>of
</I>&gt;&gt;<i> &gt;how authentication is working.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>If you have the plaintext password in the PB server, then you can just
</I>&gt;&gt;<i>call `checkPassword` instead of `checkMD5Password` in
</I>&gt;&gt;<i>DBCredentialsChecker._cbAuthenticate.
</I>&gt;<i>
</I>&gt;<i>Yes. This is working with plaintext password in the PB server, but not
</I>&gt;<i>with md5 hashed passwords, right?
</I>
Right, which doesn't make sense for you, but I suggested this thinking 
that your database had plaintext passwords in it.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054068.html">[Twisted-Python] Authenticating with md5 hashed passwords
</A></li>
	<LI>Next message (by thread): <A HREF="054071.html">[Twisted-Python] Authenticating with md5 hashed passwords
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54069">[ date ]</a>
              <a href="thread.html#54069">[ thread ]</a>
              <a href="subject.html#54069">[ subject ]</a>
              <a href="author.html#54069">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
