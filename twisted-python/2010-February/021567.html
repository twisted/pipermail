<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Authenticating with md5 hashed passwords
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Authenticating%20with%20md5%20hashed%20passwords&In-Reply-To=1266227696.12763.200.camel%40mundo">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021566.html">
   <LINK REL="Next"  HREF="021568.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Authenticating with md5 hashed passwords</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Authenticating%20with%20md5%20hashed%20passwords&In-Reply-To=1266227696.12763.200.camel%40mundo"
       TITLE="[Twisted-Python] Authenticating with md5 hashed passwords">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Feb 15 08:25:04 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021566.html">[Twisted-Python] Authenticating with md5 hashed passwords
</A></li>
        <LI>Next message: <A HREF="021568.html">[Twisted-Python] Authenticating with md5 hashed passwords
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21567">[ date ]</a>
              <a href="thread.html#21567">[ thread ]</a>
              <a href="subject.html#21567">[ subject ]</a>
              <a href="author.html#21567">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09:54 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">raq at cttc.upc.edu</A> wrote:
&gt;<i>Jean-Paul,
</I>&gt;<i>
</I>&gt;<i>Thanks for your answers. Answers bellow. Also attachments of
</I>&gt;<i>client/server application tests.
</I>&gt;<i>
</I>&gt;<i>On Fri, 2010-02-12 at 20:06 +0000, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i>On 06:03 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">raq at cttc.upc.edu</A> wrote:
</I>&gt;&gt;<i> &gt;Hello everybody,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;I am trying to build a a client/server application using Perspective
</I>&gt;&gt;<i> &gt;Broker and wanting to authenticate against a PostgreSQL database.
</I>&gt;&gt;<i> &gt;Everything works fine if I user plain text passwords, but when trying
</I>&gt;&gt;<i> &gt;to
</I>&gt;&gt;<i> &gt;hash then using md5 using
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>What do you mean when you say you're using plain text passwords?
</I>&gt;&gt;<i>Authentication involves multiple parties handling the password in
</I>&gt;&gt;<i>multiple ways, and the &quot;plain text&quot;-ness of the password changes from
</I>&gt;&gt;<i>step to step.
</I>&gt;<i>
</I>&gt;<i>I mean that the the server authenticates the client using a NOT HASHED
</I>&gt;<i>password. In my case using a VARCHAR field in a PostgreSQL table
</I>&gt;&gt;<i> &gt;from hashlib import md5
</I>&gt;&gt;<i> &gt;md5Password = md5(password).hexdigest()
</I>&gt;&gt;<i> &gt;
</I>
I'm confused here.  I don't see this code in your checker implementation 
in the attached code.  Is this code running someplace else?
&gt;&gt;<i> &gt;then it does not authenticate (I use
</I>&gt;&gt;<i> &gt;credentials.checkMD5Password(password) at the checker class)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;Then after reading
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;twisted/spread/pb.py
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;I saw that everything is done in the functions:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;respond(challenge, password)
</I>&gt;&gt;<i> &gt;challenge()
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;and the methods
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;checkMD5Password(self, md5Password)
</I>&gt;&gt;<i> &gt;checkPassword(self, password)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;at the
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;class _PortalAuthChallenger(Referenceable, _JellyableAvatarMixin)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;By changing digest() with hexdigest(), it works.
</I>
Indeed.  `checkMD5Password` needs to be passed the MD5 digest of the 
password, not the hex encoded MD5 digest (despite being documented as 
taking the plaintext password itself).
&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;The question is:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;I there some way to make it work without making changes at the 
</I>&gt;&gt;<i>'pb.py'
</I>&gt;&gt;<i> &gt;module?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;Yes. I should use md5Password = md5(password).digest() to produce the
</I>&gt;&gt;<i> &gt;password, but then I cant authenticate with a 'pure-ftpd' daemon I 
</I>&gt;&gt;<i>need
</I>&gt;&gt;<i> &gt;to work with.
</I>
This seems to be the crux of the matter.  I'm not sure how the PB auth 
code and the FTP auth code interact, though.  Perhaps your FTP code can 
just do its own password hashing?
&gt;&gt;<i> &gt;Any alternatives?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>You should register an IUsernameHashedPassword checker with the portal
</I>&gt;&gt;<i>you pass to PBServerFactory and use PBClientFactory.login.  See
</I>&gt;&gt;<i>pbbenchserver.py and pbbenchclient.py for examples of this.  Despite 
</I>&gt;&gt;<i>the
</I>&gt;<i>
</I>&gt;<i>Yes I did so. You can see the attached examples I am testing with
</I>&gt;&gt;<i>fact that you're passing a UsernamePassword instance to
</I>&gt;&gt;<i>PBClientFactory.login, the plain text password is never sent over the
</I>&gt;&gt;<i>network.
</I>&gt;<i>
</I>&gt;<i>Yes I Know. You do that at the 'respond(challenge, password)' in
</I>&gt;<i>'pb.py', do you?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Also, IUsernameMD5Password is about to be deprecated, along with the
</I>&gt;&gt;<i>checkMD5Password method of _PortalAuthChallenger.
</I>&gt;<i>
</I>&gt;<i>So, how should I do it in order not to be using deprecated code? I 
</I>&gt;<i>would
</I>&gt;<i>like to know some details so that I can have a better understanding of
</I>&gt;<i>how authentication is working.
</I>
If you have the plaintext password in the PB server, then you can just 
call `checkPassword` instead of `checkMD5Password` in 
DBCredentialsChecker._cbAuthenticate.

Jean-Paul

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021566.html">[Twisted-Python] Authenticating with md5 hashed passwords
</A></li>
	<LI>Next message: <A HREF="021568.html">[Twisted-Python] Authenticating with md5 hashed passwords
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21567">[ date ]</a>
              <a href="thread.html#21567">[ thread ]</a>
              <a href="subject.html#21567">[ subject ]</a>
              <a href="author.html#21567">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
