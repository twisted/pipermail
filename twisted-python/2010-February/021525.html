<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] newbie confusion - puzzling reactor response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20newbie%20confusion%20-%20puzzling%20reactor%20response&In-Reply-To=4B7307ED.4010400%40noir.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021523.html">
   <LINK REL="Next"  HREF="021539.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] newbie confusion - puzzling reactor response</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20newbie%20confusion%20-%20puzzling%20reactor%20response&In-Reply-To=4B7307ED.4010400%40noir.com"
       TITLE="[Twisted-Python] newbie confusion - puzzling reactor response">exarkun at twistedmatrix.com
       </A><BR>
    <I>Wed Feb 10 15:39:57 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021523.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
        <LI>Next message: <A HREF="021539.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21525">[ date ]</a>
              <a href="thread.html#21525">[ thread ]</a>
              <a href="subject.html#21525">[ subject ]</a>
              <a href="author.html#21525">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07:24 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rich at noir.com</A> wrote:
&gt;<i>I don't think so.  I believe the reactor is actually added during the 
</I>&gt;<i>import.  (I learned this as I discovered that reactors can't be 
</I>&gt;<i>restarted, which means you have to manually create a new one as a 
</I>&gt;<i>fixture for simple unittest work.)
</I>&gt;<i>
</I>&gt;<i>I looked through the code and there's a call in the reactor to fileno 
</I>&gt;<i>immediately after the call to doRead.  It seems to be attempting to 
</I>&gt;<i>check for file descriptors which broke during the read, but I think 
</I>&gt;<i>that's a mistake.  (Or at least, I'm confused about how else to do it). 
</I>&gt;<i>Seems to me that the only time my object has control in order to remove 
</I>&gt;<i>itself is during doRead.  So I'm thinking that either...
</I>&gt;<i>
</I>&gt;<i>a) there's some other way to close out my object that I just haven't 
</I>&gt;<i>discovered or
</I>&gt;<i>
</I>&gt;<i>b) the code which checks the file descriptor, (which may have been 
</I>&gt;<i>closed), after doRead is doing so mistakenly.
</I>&gt;<i>
</I>&gt;<i>For now, in my real code, I'm just leaving the file descriptor.  But 
</I>&gt;<i>I'd like to know how this is intended to be used.
</I>
It isn't `doRead`'s job to close the file descriptor.  At most, it's 
`doRead`'s job to signal that the descriptor is no longer worth keeping 
open by returning something like an instance of ConnectionDone or 
ConnectionLost.  Then the reactor will call connectionLost on your 
object and you can close the file descriptor there.

The documentation for how this all works could probably be improved. 
Once you figure it out, would you mind submitting a patch?

Also, you won't accomplish much by adding a file descriptor for a normal 
file to the reactor.  Select, poll, etc, will always indicate that such 
descriptors are both readable and writeable.

Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021523.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
	<LI>Next message: <A HREF="021539.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21525">[ date ]</a>
              <a href="thread.html#21525">[ thread ]</a>
              <a href="subject.html#21525">[ subject ]</a>
              <a href="author.html#21525">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
