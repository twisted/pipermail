<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] newbie confusion - puzzling reactor response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20newbie%20confusion%20-%20puzzling%20reactor%20response&In-Reply-To=4B75AD67.7090802%40noir.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021539.html">
   <LINK REL="Next"  HREF="021543.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] newbie confusion - puzzling reactor response</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20newbie%20confusion%20-%20puzzling%20reactor%20response&In-Reply-To=4B75AD67.7090802%40noir.com"
       TITLE="[Twisted-Python] newbie confusion - puzzling reactor response">exarkun at twistedmatrix.com
       </A><BR>
    <I>Fri Feb 12 15:11:38 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021539.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
        <LI>Next message: <A HREF="021543.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21542">[ date ]</a>
              <a href="thread.html#21542">[ thread ]</a>
              <a href="subject.html#21542">[ subject ]</a>
              <a href="author.html#21542">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07:35 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rich at noir.com</A> wrote:
&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i>It isn't `doRead`'s job to close the file descriptor.  At most, it's
</I>&gt;&gt;<i>`doRead`'s job to signal that the descriptor is no longer worth 
</I>&gt;&gt;<i>keeping
</I>&gt;&gt;<i>open by returning something like an instance of ConnectionDone or
</I>&gt;&gt;<i>ConnectionLost.  Then the reactor will call connectionLost on your
</I>&gt;&gt;<i>object and you can close the file descriptor there.
</I>&gt;<i>Thank you!  That's the info I was looking for.
</I>&gt;&gt;<i>The documentation for how this all works could probably be improved.
</I>&gt;&gt;<i>Once you figure it out, would you mind submitting a patch?
</I>&gt;<i>I don't think I've even seen mention of ConnectionDone in the doc yet.
</I>&gt;<i>
</I>&gt;<i>I think there's a design decision here about the doc.  It seems to me
</I>&gt;<i>that the return codes are part of the interface and as such should
</I>&gt;<i>probably be documented in twisted.internet.interfaces.py whereas 
</I>&gt;<i>there's
</I>&gt;<i>almost nothing there now.  Instead, some of this is in
</I>&gt;<i>twisted.internet.abstract.  Granted, the distinction between an 
</I>&gt;<i>abstract
</I>&gt;<i>class and a &quot;zope.interface.Interface&quot; is subtle.
</I>&gt;<i>
</I>&gt;<i>As a newbie, the interface is the thing I find first and most easily.
</I>&gt;<i>I'm directed there by the doc and by the reference material.  I have to
</I>&gt;<i>dig around to even notice that the abstract class exists.
</I>
You're absolutely right.  These interfaces should be documenting the 
meaning of the return value for these methods, since it is an integral 
part of the required interface.
&gt;&gt;<i>Also, you won't accomplish much by adding a file descriptor for a 
</I>&gt;&gt;<i>normal
</I>&gt;&gt;<i>file to the reactor.  Select, poll, etc, will always indicate that 
</I>&gt;&gt;<i>such
</I>&gt;&gt;<i>descriptors are both readable and writeable.
</I>
&gt;<i>Er... on second thought... isn't there still a utility in asynchronous
</I>&gt;<i>file io which yields to the reactor?
</I>&gt;<i>
</I>&gt;<i>It may be always readable/writable, but if I simply read/write, I'll
</I>&gt;<i>block the process for as long as that takes, block on read, block on
</I>&gt;<i>write.  Whereas if I use async io on the descriptor and go through the
</I>&gt;<i>reactor, I'm effectively yielding to the reactor and any other
</I>&gt;<i>actionable descriptors on each loop as well as allowing my reads and
</I>&gt;<i>writes to happen simultaneously.
</I>&gt;<i>
</I>&gt;<i>Or am I missing something?
</I>
There could be utility in such, but Twisted has no support for it, 
largely because actual support on various platforms is still pretty 
ragged.

On Linux, you can get the aio_* family of functions, but they're pretty 
crap.  They have tons of limitations (only block-aligned reads allowed, 
only a certain number of outstanding operations (system wide) at a time, 
etc, and the failure mode for not complying with these limitations is 
that the APIs block).

It's a bit better on Windows, so someone could probably fashion an 
extension to iocpreactor for this.  There isn't a lot of developer 
attention focused on implementing Windows-only extensions right now, 
though.

Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021539.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
	<LI>Next message: <A HREF="021543.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21542">[ date ]</a>
              <a href="thread.html#21542">[ thread ]</a>
              <a href="subject.html#21542">[ subject ]</a>
              <a href="author.html#21542">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
