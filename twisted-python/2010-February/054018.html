<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] newbie confusion - puzzling reactor response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20newbie%20confusion%20-%20puzzling%20reactor%20response&In-Reply-To=%3C4B7307ED.4010400%40noir.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054014.html">
   <LINK REL="Next"  HREF="054020.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] newbie confusion - puzzling reactor response</H1>
    <B>K. Richard Pixley</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20newbie%20confusion%20-%20puzzling%20reactor%20response&In-Reply-To=%3C4B7307ED.4010400%40noir.com%3E"
       TITLE="[Twisted-Python] newbie confusion - puzzling reactor response">rich at noir.com
       </A><BR>
    <I>Wed Feb 10 12:24:29 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054014.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
        <LI>Next message (by thread): <A HREF="054020.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54018">[ date ]</a>
              <a href="thread.html#54018">[ thread ]</a>
              <a href="subject.html#54018">[ subject ]</a>
              <a href="author.html#54018">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I don't think so.  I believe the reactor is actually added during the 
import.  (I learned this as I discovered that reactors can't be 
restarted, which means you have to manually create a new one as a 
fixture for simple unittest work.)

I looked through the code and there's a call in the reactor to fileno 
immediately after the call to doRead.  It seems to be attempting to 
check for file descriptors which broke during the read, but I think 
that's a mistake.  (Or at least, I'm confused about how else to do it).  
Seems to me that the only time my object has control in order to remove 
itself is during doRead.  So I'm thinking that either...

a) there's some other way to close out my object that I just haven't 
discovered or

b) the code which checks the file descriptor, (which may have been 
closed), after doRead is doing so mistakenly.

For now, in my real code, I'm just leaving the file descriptor.  But I'd 
like to know how this is intended to be used.

--rich (still a newbie)

Mark Bailey wrote:
&gt;<i> Hi:
</I>&gt;<i>
</I>&gt;<i> Aren't you adding two readers?  One is added in the __init__ method of 
</I>&gt;<i> inputFile, the other in the test code.
</I>&gt;<i>
</I>&gt;<i> I'm also a newbie so maybe I'm equally confused...
</I>&gt;<i>
</I>&gt;<i> On Tue, Feb 9, 2010 at 8:47 PM, K. Richard Pixley &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rich at noir.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rich at noir.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     I'm confused be the response I get to the attached program.
</I>&gt;<i>
</I>&gt;<i>     In a nutshell, I'm building a reader, attaching it with addReader,
</I>&gt;<i>     later removing it with removeReader.  And I'm getting this:
</I>&gt;<i>
</I>&gt;<i>         time python test_reactor.py
</I>&gt;<i>         Traceback (most recent call last):
</I>&gt;<i>         Failure: twisted.internet.error.ConnectionFdescWentAway: Uh:
</I>&gt;<i>         Filedescriptor went away.
</I>&gt;<i>
</I>&gt;<i>     Which seems to be telling me that I don't know as much yet as I'd
</I>&gt;<i>     hoped.
</I>&gt;<i>
</I>&gt;<i>     Why would the reactor care about a closed file descriptor that
</I>&gt;<i>     isn't even in it's interest set?
</I>&gt;<i>
</I>&gt;<i>     --rich
</I>&gt;<i>
</I>&gt;<i>     #!/usr/bin/env python
</I>&gt;<i>     # -*- coding: utf-8 -*-
</I>&gt;<i>
</I>&gt;<i>     import os
</I>&gt;<i>
</I>&gt;<i>     from zope.interface import implements
</I>&gt;<i>     from twisted.internet import reactor
</I>&gt;<i>     from twisted.internet.interfaces import IReadDescriptor
</I>&gt;<i>
</I>&gt;<i>     class inputFile(object):
</I>&gt;<i>        implements(IReadDescriptor)
</I>&gt;<i>
</I>&gt;<i>        def __init__(self, filename):
</I>&gt;<i>            self.filename = filename
</I>&gt;<i>            self.filedes = os.open(filename, os.O_RDONLY | os.O_NONBLOCK)
</I>&gt;<i>            reactor.addReader(self)
</I>&gt;<i>
</I>&gt;<i>        def fileno(self):
</I>&gt;<i>            return self.filedes
</I>&gt;<i>
</I>&gt;<i>        def connectionLost(self, reason):
</I>&gt;<i>            raise reason
</I>&gt;<i>
</I>&gt;<i>        def logPrefix(self):
</I>&gt;<i>            return 'inputFile'
</I>&gt;<i>
</I>&gt;<i>        def doRead(self):
</I>&gt;<i>            reactor.removeReader(self)
</I>&gt;<i>            os.close(self.filedes)
</I>&gt;<i>            self.filedes = -1
</I>&gt;<i>            reactor.stop()
</I>&gt;<i>
</I>&gt;<i>     if __name__ == '__main__':
</I>&gt;<i>        r = inputFile('/etc/group')
</I>&gt;<i>        reactor.addReader(r)
</I>&gt;<i>        reactor.run()
</I>&gt;<i>
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     Twisted-Python mailing list
</I>&gt;<i>     <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;<i>     <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>   
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20100210/3597b75d/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054014.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
	<LI>Next message (by thread): <A HREF="054020.html">[Twisted-Python] newbie confusion - puzzling reactor response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54018">[ date ]</a>
              <a href="thread.html#54018">[ thread ]</a>
              <a href="subject.html#54018">[ subject ]</a>
              <a href="author.html#54018">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
