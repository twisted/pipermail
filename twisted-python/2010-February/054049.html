<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Streaming File Transfer Protocol?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Streaming%20File%20Transfer%20Protocol%3F&In-Reply-To=%3C20100213230619.GC18546%40steerpike.home.puzzling.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054048.html">
   <LINK REL="Next"  HREF="054051.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Streaming File Transfer Protocol?</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Streaming%20File%20Transfer%20Protocol%3F&In-Reply-To=%3C20100213230619.GC18546%40steerpike.home.puzzling.org%3E"
       TITLE="[Twisted-Python] Streaming File Transfer Protocol?">andrew at bemusement.org
       </A><BR>
    <I>Sat Feb 13 16:06:19 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054048.html">[Twisted-Python] Streaming File Transfer Protocol?
</A></li>
        <LI>Next message (by thread): <A HREF="054051.html">[Twisted-Python] Sending jpeg data over TCP/IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54049">[ date ]</a>
              <a href="thread.html#54049">[ thread ]</a>
              <a href="subject.html#54049">[ subject ]</a>
              <a href="author.html#54049">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Darren Govoni wrote:
&gt;<i>    I spoke too fast. But pardon my noobiness.
</I>&gt;<i> 
</I>&gt;<i>    Ok, so I am using a simple protocol that is listening on a TCP port.
</I>&gt;<i> 
</I>&gt;<i>    One the client side, I write 4096 bytes using self.transport.write(bytes)
</I>&gt;<i> 
</I>&gt;<i>    on dataReceived side, I get only 1448.
</I>&gt;<i> 
</I>&gt;<i>    Now, what I &quot;want&quot; to happen is when I issue a write of a known
</I>&gt;<i>    number of bytes.  I &quot;want&quot; those bytes to arrive in total because
</I>&gt;<i>    they represent a pickled object.  The server has no idea if the
</I>&gt;<i>    bytes are split and scattered (again, I want the control protocol
</I>&gt;<i>    to take affect).
</I>&gt;<i> 
</I>&gt;<i>    1) Am I doing something wrong here?
</I>
Yes.  You are expecting guarantees that aren't provided by TCP.  TCP
only guarantees that a stream of bytes will arrive in order (or not at
all).  It guarantees nothing about what size packets those bytes will
arrive in.  As you've already noticed it is common for packets to be
broken up into less than 1500 bytes (1500 is a common MTU for internet
hops[1]), and depending on the network links between your hosts it could
quite easily be broken up even further.

So, you need to use some sort of framing in your protocol.

&gt;<i>    2) Can I force twisted to send ALL the bytes I issue in the write without
</I>&gt;<i>    re-thinking TCP or forcing me to re-implement TCP?
</I>
Twisted by itself cannot solve this for you.  Even if there were some
way to guarantee that your write was written to the network in a single
packet (and there can't be due to how TCP works, but let's assume you
can), it wouldn't matter because the next hop in the network connection
would be free to break up that large packet into smaller pieces, and
probably would.

Your data needs to be self-describe how long each message is, i.e. frame
them.  See &lt;<A HREF="http://www.xml.com/pub/a/ws/2003/11/25/protocols.html">http://www.xml.com/pub/a/ws/2003/11/25/protocols.html</A>&gt; (and
the rest of the series at &lt;<A HREF="http://www.xml.com/pub/au/215">http://www.xml.com/pub/au/215</A>&gt;).

Twisted provides some facilities for building protocols with different
kinds of framing, e.g. delimited by a special marker (LineReceiver) or
length-prefixed (NetstringReceiver, Int32StringReceiver).  Those classes
can be found in twisted.protocols.basic.

-Andrew.

[1] <A HREF="http://en.wikipedia.org/wiki/Maximum_transmission_unit">http://en.wikipedia.org/wiki/Maximum_transmission_unit</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054048.html">[Twisted-Python] Streaming File Transfer Protocol?
</A></li>
	<LI>Next message (by thread): <A HREF="054051.html">[Twisted-Python] Sending jpeg data over TCP/IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54049">[ date ]</a>
              <a href="thread.html#54049">[ thread ]</a>
              <a href="subject.html#54049">[ subject ]</a>
              <a href="author.html#54049">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
