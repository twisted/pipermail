<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Serializing cftp and ssh sessions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Serializing%20cftp%20and%20ssh%20sessions&In-Reply-To=%3C86A36C5B-6A8A-4A7C-AF45-8D6D6E324B31%40Chaos1.DE%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Serializing cftp and ssh sessions</H1>
    <B>Axel Rau</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Serializing%20cftp%20and%20ssh%20sessions&In-Reply-To=%3C86A36C5B-6A8A-4A7C-AF45-8D6D6E324B31%40Chaos1.DE%3E"
       TITLE="[Twisted-Python] Serializing cftp and ssh sessions">Axel.Rau at chaos1.de
       </A><BR>
    <I>Tue Oct 14 00:02:01 MDT 2014</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61340">[ date ]</a>
              <a href="thread.html#61340">[ thread ]</a>
              <a href="subject.html#61340">[ subject ]</a>
              <a href="author.html#61340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have adapted t.c.s.cftp and one of the ssh examples to transfer files to a remote host and than execute some commands there.
Both has to be done for several remote hosts in sequence.
Start of the ssh session has to wait until the cftp sessions are complete and after that has completed, the cftp session for the next host has to be started . . .

The cftp part begins so:

def distributeStuff(host, tasks):
    . . .
    doConnect(reactor, options, tasks)


def doConnect(reactor, options, tasks):
    . . .
    conn.tasks = tasks
    vhk = verifyHostKey
    uao = SSHUserAuthClient(options['user'], options, conn)
    connect(host, port, options, vhk, uao).addErrback(_ebExit)

class SSHConn(connection.SSHConnection):
    def serviceStarted(self):
        self.openChannel(SSHSession())

I played with inlineCallbacks but could not find a point where to place my yielded function.
I tried to overwrite channelClosed in SSHConn:

    def channelClosed(self, channel):
        super(SSHConn, self).channelClosed(channel)
        if len(self.channels) == 0:
            print ‚[Last channel closed.]'
            # open ssh ssession:
            . . .
 but that gave an unhandled error:
2014-10-14 07:54:34+0200 [SSHService ssh-connection on SSHClientTransport,client] Unhandled Error
	Traceback (most recent call last):
	  File &quot;/usr/local/py_venv/p27/lib/python2.7/site-packages/twisted/internet/tcp.py&quot;, line 214, in doRead
	    return self._dataReceived(data)
	  File &quot;/usr/local/py_venv/p27/lib/python2.7/site-packages/twisted/internet/tcp.py&quot;, line 220, in _dataReceived
	    rval = self.protocol.dataReceived(data)
	  File &quot;/usr/local/py_venv/p27/lib/python2.7/site-packages/twisted/conch/ssh/transport.py&quot;, line 461, in dataReceived
	    self.dispatchMessage(messageNum, packet[1:])
	  File &quot;/usr/local/py_venv/p27/lib/python2.7/site-packages/twisted/conch/ssh/transport.py&quot;, line 483, in dispatchMessage
	    messageNum, payload)
	--- &lt;exception caught here&gt; ---
	  File &quot;/usr/local/py_venv/p27/lib/python2.7/site-packages/twisted/python/log.py&quot;, line 88, in callWithLogger
	    return callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
	  File „/usr/local/py_venv/p27/lib/python2.7/site-p
(bt stopped here).

Please advise!

Thanks, Axel
—
PGP-Key:29E99DD6  ☀ +49 151 2300 9283  ☀ computing @ chaos claudius



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61340">[ date ]</a>
              <a href="thread.html#61340">[ thread ]</a>
              <a href="subject.html#61340">[ subject ]</a>
              <a href="author.html#61340">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
