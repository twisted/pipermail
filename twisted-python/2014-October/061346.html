<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted hangs when using pyapns
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20hangs%20when%20using%20pyapns&In-Reply-To=%3C6391312B-9BC4-49B5-AD77-468F8A10A9BC%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="061343.html">
   <LINK REL="Next"  HREF="061349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted hangs when using pyapns</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20hangs%20when%20using%20pyapns&In-Reply-To=%3C6391312B-9BC4-49B5-AD77-468F8A10A9BC%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Twisted hangs when using pyapns">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Oct 14 16:38:06 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="061343.html">[Twisted-Python] Twisted hangs when using pyapns
</A></li>
        <LI>Next message (by thread): <A HREF="061349.html">[Twisted-Python] Twisted hangs when using pyapns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61346">[ date ]</a>
              <a href="thread.html#61346">[ thread ]</a>
              <a href="subject.html#61346">[ subject ]</a>
              <a href="author.html#61346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 14, 2014, at 1:06 AM, Ni Wesley &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nispray at gmail.com</A>&gt; wrote:

&gt;<i> Hi all,
</I>&gt;<i>    I don't know if here is the right place. 
</I>&gt;<i> I hit a problem with pyapns which is based on twisted.
</I>&gt;<i> 
</I>&gt;<i> So, I get code from our parter and setup up env involving interacting with APNS for IOS pushing work.
</I>&gt;<i> 
</I>&gt;<i> I hit the problem that twisted hangs after a while's idle, I mean, when I start twisted with command: 
</I>&gt;<i> twistd -r epoll web --class=pyapns.server.APNSServer --port=7077
</I>&gt;<i> 
</I>&gt;<i> Then, raise an notification to IOS device by pyapns(<A HREF="https://github.com/samuraisam/pyapns">https://github.com/samuraisam/pyapns</A>),it's OK.
</I>&gt;<i> 
</I>&gt;<i> However, if I let the system alone for a while, then, new raised notifications are all failed, what's more, if now I kill twisted process, and restart with the above command again, push operations are successful again.
</I>&gt;<i> 
</I>&gt;<i> I use python2.7 and twisted 14.0.0 on Redhat6.4.
</I>&gt;<i> 
</I>&gt;<i> So, anyone has hit this problem?
</I>
pyapns uses threads very heavily, and so my guess would be most likely that you're calling a Twisted API from a non-main thread.  Without seeing the code it's impossible to say.

There's some Twisted-based apache2-licensed APNS integration code available here: &lt;<A HREF="https://trac.calendarserver.org/browser/CalendarServer/trunk/calendarserver/push/applepush.py">https://trac.calendarserver.org/browser/CalendarServer/trunk/calendarserver/push/applepush.py</A>&gt;.  Unfortunately it is a little bound up with internal implementation details of calendar server, but it's almost generic and it might be worth the effort to extract, since it will almost certainly give you more robust behavior than integrating pyapns and Twisted.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20141014/9c0e3595/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="061343.html">[Twisted-Python] Twisted hangs when using pyapns
</A></li>
	<LI>Next message (by thread): <A HREF="061349.html">[Twisted-Python] Twisted hangs when using pyapns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61346">[ date ]</a>
              <a href="thread.html#61346">[ thread ]</a>
              <a href="subject.html#61346">[ subject ]</a>
              <a href="author.html#61346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
