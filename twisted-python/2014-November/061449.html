<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How do I debug this network problem?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20do%20I%20debug%20this%20network%20problem%3F&In-Reply-To=%3C49CEBBAB-9C87-4E15-8283-AFF71A86A951%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="061448.html">
   <LINK REL="Next"  HREF="061451.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How do I debug this network problem?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20do%20I%20debug%20this%20network%20problem%3F&In-Reply-To=%3C49CEBBAB-9C87-4E15-8283-AFF71A86A951%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] How do I debug this network problem?">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Nov 21 19:58:09 MST 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="061448.html">[Twisted-Python] How do I debug this network problem?
</A></li>
        <LI>Next message (by thread): <A HREF="061451.html">[Twisted-Python] How do I debug this network problem?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61449">[ date ]</a>
              <a href="thread.html#61449">[ thread ]</a>
              <a href="subject.html#61449">[ subject ]</a>
              <a href="author.html#61449">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Nov 22, 2014, at 01:50, Peter Westlake &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">peter.westlake at pobox.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Fri, 21 Nov 2014, at 19:26, Glyph wrote:
</I>&gt;&gt;&gt;<i> On Nov 21, 2014, at 15:13, Peter Westlake &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">peter.westlake at pobox.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">peter.westlake at pobox.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;<i> Iammissing something obvious. The file opened by open() immediately goes out of scope.  AAAUGH!
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i> So... back to square one?  Or is this the solution to your problem?  I don't entirely follow how this connects..
</I>&gt;<i>  
</I>&gt;<i> I didn't explain, sorry. This does indeed solve my problem!
</I>
Thanks for explaining that whole interaction.  Wow, that is a scary amount of abstraction-boundary-crossing, congratulations on diagnosing it :-).

&gt;<i> To fix the bug (and it is fixed, and passes testing) I had the option of either saving the file object:
</I>&gt;<i>  
</I>&gt;<i> devnull = open('/dev/null')
</I>&gt;<i> ...
</I>&gt;<i> spawnProcess(...childFDS{0: devnull.fileno(), 1: 'r', 2: 'r'}...)
</I>&gt;<i>  
</I>&gt;<i> or closing stdin:
</I>&gt;<i>  
</I>&gt;<i> spawnProcess(...childFDS{1: 'r', 2: 'r'}...)
</I>
Closing stdin is probably the best option here, but the original problem was caused by a mixing of levels.

On one level, you've got open(), which wants to sort of pretend that an open file is an object, and that the operating system resource involved is an implementation detail that can be cleaned up by the garbage collector.

On the other level, you've got spawnProcess, which is operating entirely in terms of file descriptors as process-global state.

Any time you want to open a file descriptor for spawnProcess to consume, I suggest that you open it with os.open &lt;<A HREF="https://docs.python.org/2/library/os.html#os.open">https://docs.python.org/2/library/os.html#os.open</A> &lt;<A HREF="https://docs.python.org/2/library/os.html#os.open">https://docs.python.org/2/library/os.html#os.open</A>&gt;&gt;, which just hands you an integer and makes it your own problem to close it explicitly with os.close &lt;<A HREF="https://docs.python.org/2/library/os.html#os.close">https://docs.python.org/2/library/os.html#os.close</A> &lt;<A HREF="https://docs.python.org/2/library/os.html#os.close">https://docs.python.org/2/library/os.html#os.close</A>&gt;&gt;; this is operating at the same abstraction level and therefore less error-prone.

-glyph



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20141122/baa86dd3/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="061448.html">[Twisted-Python] How do I debug this network problem?
</A></li>
	<LI>Next message (by thread): <A HREF="061451.html">[Twisted-Python] How do I debug this network problem?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61449">[ date ]</a>
              <a href="thread.html#61449">[ thread ]</a>
              <a href="subject.html#61449">[ subject ]</a>
              <a href="author.html#61449">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
