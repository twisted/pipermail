<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A resizable cooperator class for queuing and dispatching jobs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20resizable%20cooperator%20class%20for%20queuing%20and%0A%20dispatching%20jobs&In-Reply-To=19232.50673.973763.680203%40jon.es">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021153.html">
   <LINK REL="Next"  HREF="021167.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A resizable cooperator class for queuing and dispatching jobs</H1>
    <B>Dave Peticolas</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20resizable%20cooperator%20class%20for%20queuing%20and%0A%20dispatching%20jobs&In-Reply-To=19232.50673.973763.680203%40jon.es"
       TITLE="[Twisted-Python] A resizable cooperator class for queuing and dispatching jobs">dave at krondo.com
       </A><BR>
    <I>Thu Dec 10 22:36:40 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="021153.html">[Twisted-Python] A resizable cooperator class for queuing	and	dispatching jobs
</A></li>
        <LI>Next message: <A HREF="021167.html">[Twisted-Python] A resizable cooperator class for queuing and dispatching jobs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21166">[ date ]</a>
              <a href="thread.html#21166">[ thread ]</a>
              <a href="subject.html#21166">[ subject ]</a>
              <a href="author.html#21166">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Terry Jones wrote:
&gt;&gt;&gt;&gt;&gt;&gt;<i> &quot;Dave&quot; == Dave Peticolas &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dave at krondo.com</A>&gt; writes:
</I>&gt;<i> Dave&gt; This is really nifty. I know I could use this.
</I>&gt;<i> 
</I>&gt;<i> Great. Me too :-)
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> There's also the issue about what to do when the dispatch function hits
</I>&gt;&gt;&gt;<i> an error.  An option could be added to re-queue the job, but it's
</I>&gt;&gt;&gt;<i> perhaps better to let the dispatch function do that along with whatever
</I>&gt;&gt;&gt;<i> else it needs.
</I>&gt;<i> 
</I>&gt;<i> Dave&gt; One reason to have a separate error handler is to support generic
</I>&gt;<i> Dave&gt; error-handling strategies, like 're-try N times and then send an
</I>&gt;<i> Dave&gt; email here', etc. Though maybe you could do that with decorators on
</I>&gt;<i> Dave&gt; the dispatch function. It does mean the dispatch function needs to
</I>&gt;<i> Dave&gt; know about the task queue, though.
</I>&gt;<i> 
</I>&gt;<i> Yes. But I think that's fine, and appropriate. If you're doing something
</I>&gt;<i> more sophisticated you can make a class that creates the dispatch queue,
</I>&gt;<i> deals with errors, resubmission, etc. That's how I plan to use it.
</I>
Makes sense.


&gt;<i> Dave&gt; Having written something like this, though not as general or as
</I>&gt;<i> Dave&gt; elegant, several times, I've found that pause() and resume() is a
</I>&gt;<i> Dave&gt; very useful API. That's not the same as setting the width to 0 and
</I>&gt;<i> Dave&gt; then back again, as pause() and resume() don't require you to know or
</I>&gt;<i> Dave&gt; remember the current width of the queue.
</I>&gt;<i> 
</I>&gt;<i> OK, I added pause/resume. You can change the width when it's paused (or on
</I>&gt;<i> resume). Jobs can still be added to the queue when the thing is paused,
</I>&gt;<i> they just don't get dispatched. The pause method returns a deferred that
</I>&gt;<i> fires when all currently underway tasks have completed.  There's also a new
</I>&gt;<i> method 'size' which gets you a 2-tuple of the number of tasks currently
</I>&gt;<i> underway and the length of the queue. And I made it so you can clear the
</I>&gt;<i> queue (perhaps useful if you want to pause, get the pending jobs via
</I>&gt;<i> pending(), and clear the queue before resuming, etc).  I also got rid of
</I>&gt;<i> narrow/widen, following Glyph's comments.
</I>
Cool. What about being able to get the set of underway objects, in
addition to the set of pending objects? Then you can get the whole
state of the queue at that point.

I think:

   queue.resume(0)

doesn't work the way you'd expect at the moment.


&gt;<i> I'll stick it somewhere more official / permanent soon (I guess into
</I>&gt;<i> Launchpad, either in the Fluidinfo PPA or as a sub-project of the tx
</I>&gt;<i> collection). For now you can grab the code &amp; the tests at
</I>&gt;<i> <A HREF="http://jon.es/other/rdq.tar.bz2">http://jon.es/other/rdq.tar.bz2</A> The tests feel funky to me - the ones that
</I>&gt;<i> really do anything are all based on expected timings of jobs, queue sizes,
</I>&gt;<i> etc. That's what I'm supposed to be testing, but perhaps my way of doing it
</I>&gt;<i> is weird.
</I>&gt;<i> 
</I>&gt;<i> Terry
</I>&gt;<i> 
</I>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021153.html">[Twisted-Python] A resizable cooperator class for queuing	and	dispatching jobs
</A></li>
	<LI>Next message: <A HREF="021167.html">[Twisted-Python] A resizable cooperator class for queuing and dispatching jobs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21166">[ date ]</a>
              <a href="thread.html#21166">[ thread ]</a>
              <a href="subject.html#21166">[ subject ]</a>
              <a href="author.html#21166">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
