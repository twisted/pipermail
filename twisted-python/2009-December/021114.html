<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] TimAllen changed [#3956 - Add arraysize option	to runQuery in adbapi]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20TimAllen%20changed%20%5B%233956%20-%20Add%20arraysize%20option%0A%09to%20runQuery%20in%20adbapi%5D&In-Reply-To=E1NHY8J-0001ht-Qh%40cube.twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021113.html">
   <LINK REL="Next"  HREF="021115.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] TimAllen changed [#3956 - Add arraysize option	to runQuery in adbapi]</H1>
    <B>Gerrat Rickert</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20TimAllen%20changed%20%5B%233956%20-%20Add%20arraysize%20option%0A%09to%20runQuery%20in%20adbapi%5D&In-Reply-To=E1NHY8J-0001ht-Qh%40cube.twistedmatrix.com"
       TITLE="[Twisted-Python] TimAllen changed [#3956 - Add arraysize option	to runQuery in adbapi]">grickert at coldstorage.com
       </A><BR>
    <I>Mon Dec  7 11:47:55 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="021113.html">[Twisted-Python] Syntactic sugar for deferreds
</A></li>
        <LI>Next message: <A HREF="021115.html">[Twisted-Python] voiced/opped in twisted IRC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21114">[ date ]</a>
              <a href="thread.html#21114">[ thread ]</a>
              <a href="subject.html#21114">[ subject ]</a>
              <a href="author.html#21114">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> 1. About `t.e.adbapi.Transaction.cursor`: It seems that the only
&gt;<i>read/write attribute on a cursor object is `arraysize`, and it seems
</I>&gt;<i>clunky to mess with `Transaction`'s public interface just for that. How
</I>&gt;<i>about leaving the instance variable as `_cursor` and adding
</I>&gt;<i>`getArraySize`/`setArraySize` methods? (a property would be even
</I>better,
&gt;<i>but that requires a new-style class)
</I>&gt;<i>
</I>&gt;<i>I'm kind of ambivalent about the whole approach of this patch, really:
</I>&gt;<i>the only method that `runQuery()` ever calls on the cursor is
</I>&gt;<i>`fetchall()`, which DBAPI-2.0 describes with &quot;Note that the cursor's
</I>&gt;<i>`arraysize` attribute can affect the performance of this operation.&quot;
</I>&gt;<i>Presumably in sensible DBAPI modules, `fetchall()` will read chunks as
</I>&gt;<i>large as possible rather than limiting itself to `arraysize`, but
</I>Gerrat
&gt;<i>appears to have found a module that needlessly limits itself, so some
</I>&gt;<i>configuration is needed.
</I>&gt;<i>
</I>&gt;<i>However, do we really need to set a separate `arraysize` for every
</I>&gt;<i>query? Considering we always call `fetchall()`, presumably we'll always
</I>&gt;<i>want to use whatever `arraysize` makes `fetchall()` fastest. I doubt
</I>&gt;<i>there's a value that would work for every DBAPI module in every Twisted
</I>&gt;<i>installation all over the world, but it seems sensible that every query
</I>&gt;<i>in a given `ConnectionPool` would want to use the same arraysize. How
</I>&gt;<i>about adding a `cp_arraysize` keyword parameter to `ConnectionPool`,
</I>and
&gt;<i>applying that setting in `_runInteraction()`? It's a pretty easy way to
</I>&gt;<i>configure `arraysize`, it has no backwards compatibility problems, and
</I>&gt;<i>it shouldn't be too hard for each Twisted user to find a value that
</I>&gt;<i>improves things overall in their environment.
</I>&gt;<i>
</I>&gt;<i>Of course, when you're pushing for performance there's always
</I>&gt;<i>exceptions, and some users might need to set `arraysize` differently
</I>for
&gt;<i>different queries, and maybe use other calls than `fetchall()`. They
</I>can
&gt;<i>continue using `runInteraction()` as they presumably already do.
</I>
Sorry I've dropped the ball on this whole request that I initiated.  I'm
kind 
of swamped at work this time of year (I should have more time starting
mid 
Jan.)  I have a minute to weigh in though.

As for the exact details on how this is implemented, I don't have any
strong 
preferences.  I like the suggestion to add the `cp_arraysize` parameter
to 
`ConnectionPool` and apply it in `_runInteraction()`...wish I'd thought
of it.

I also agree that it's unfortunate that the performance of `fetchall()`
is 
impacted by the `arraysize` attribute; but I think that if it's a
deficiency, 
the issue is with the DBAPI-2.0 specification, not with this
implementation. 
(It would be kind of pointless mentioning that `arraysize` could affect
the 
performance of this method, if this method ignored `arraysize`.)

Regards,
	Gerrat

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021113.html">[Twisted-Python] Syntactic sugar for deferreds
</A></li>
	<LI>Next message: <A HREF="021115.html">[Twisted-Python] voiced/opped in twisted IRC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21114">[ date ]</a>
              <a href="thread.html#21114">[ thread ]</a>
              <a href="subject.html#21114">[ subject ]</a>
              <a href="author.html#21114">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
