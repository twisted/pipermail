<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A resizable cooperator class for queuing	and	dispatching jobs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20resizable%20cooperator%20class%20for%20queuing%0A%09and%09dispatching%20jobs&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021150.html">
   <LINK REL="Next"  HREF="021166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A resizable cooperator class for queuing	and	dispatching jobs</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20resizable%20cooperator%20class%20for%20queuing%0A%09and%09dispatching%20jobs&In-Reply-To="
       TITLE="[Twisted-Python] A resizable cooperator class for queuing	and	dispatching jobs">terry at jon.es
       </A><BR>
    <I>Thu Dec 10 04:57:05 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="021150.html">[Twisted-Python] A resizable cooperator class for queuing and dispatching jobs
</A></li>
        <LI>Next message: <A HREF="021166.html">[Twisted-Python] A resizable cooperator class for queuing and dispatching jobs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21153">[ date ]</a>
              <a href="thread.html#21153">[ thread ]</a>
              <a href="subject.html#21153">[ subject ]</a>
              <a href="author.html#21153">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;&gt;&gt;&gt;<i> &quot;Dave&quot; == Dave Peticolas &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dave at krondo.com</A>&gt; writes:
</I>Dave&gt; This is really nifty. I know I could use this.

Great. Me too :-)

&gt;&gt;<i> There's also the issue about what to do when the dispatch function hits
</I>&gt;&gt;<i> an error.  An option could be added to re-queue the job, but it's
</I>&gt;&gt;<i> perhaps better to let the dispatch function do that along with whatever
</I>&gt;&gt;<i> else it needs.
</I>
Dave&gt; One reason to have a separate error handler is to support generic
Dave&gt; error-handling strategies, like 're-try N times and then send an
Dave&gt; email here', etc. Though maybe you could do that with decorators on
Dave&gt; the dispatch function. It does mean the dispatch function needs to
Dave&gt; know about the task queue, though.

Yes. But I think that's fine, and appropriate. If you're doing something
more sophisticated you can make a class that creates the dispatch queue,
deals with errors, resubmission, etc. That's how I plan to use it.

Dave&gt; Having written something like this, though not as general or as
Dave&gt; elegant, several times, I've found that pause() and resume() is a
Dave&gt; very useful API. That's not the same as setting the width to 0 and
Dave&gt; then back again, as pause() and resume() don't require you to know or
Dave&gt; remember the current width of the queue.

OK, I added pause/resume. You can change the width when it's paused (or on
resume). Jobs can still be added to the queue when the thing is paused,
they just don't get dispatched. The pause method returns a deferred that
fires when all currently underway tasks have completed.  There's also a new
method 'size' which gets you a 2-tuple of the number of tasks currently
underway and the length of the queue. And I made it so you can clear the
queue (perhaps useful if you want to pause, get the pending jobs via
pending(), and clear the queue before resuming, etc).  I also got rid of
narrow/widen, following Glyph's comments.

I'll stick it somewhere more official / permanent soon (I guess into
Launchpad, either in the Fluidinfo PPA or as a sub-project of the tx
collection). For now you can grab the code &amp; the tests at
<A HREF="http://jon.es/other/rdq.tar.bz2">http://jon.es/other/rdq.tar.bz2</A> The tests feel funky to me - the ones that
really do anything are all based on expected timings of jobs, queue sizes,
etc. That's what I'm supposed to be testing, but perhaps my way of doing it
is weird.

Terry

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021150.html">[Twisted-Python] A resizable cooperator class for queuing and dispatching jobs
</A></li>
	<LI>Next message: <A HREF="021166.html">[Twisted-Python] A resizable cooperator class for queuing and dispatching jobs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21153">[ date ]</a>
              <a href="thread.html#21153">[ thread ]</a>
              <a href="subject.html#21153">[ subject ]</a>
              <a href="author.html#21153">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
