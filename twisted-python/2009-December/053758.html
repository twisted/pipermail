<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to profiling twisted web?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20profiling%20twisted%20web%3F&In-Reply-To=%3C95bb10690912281002h461e9b75i84f6c2d5f9d0a29a%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053756.html">
   <LINK REL="Next"  HREF="053759.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to profiling twisted web?</H1>
    <B>Reza Lotun</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20profiling%20twisted%20web%3F&In-Reply-To=%3C95bb10690912281002h461e9b75i84f6c2d5f9d0a29a%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] How to profiling twisted web?">rlotun at gmail.com
       </A><BR>
    <I>Mon Dec 28 11:02:09 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053756.html">[Twisted-Python] How to profiling twisted web?
</A></li>
        <LI>Next message (by thread): <A HREF="053759.html">[Twisted-Python] How to profiling twisted web?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53758">[ date ]</a>
              <a href="thread.html#53758">[ thread ]</a>
              <a href="subject.html#53758">[ subject ]</a>
              <a href="author.html#53758">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

&gt;<i> Currently I'm running twisted web via this command line:
</I>&gt;<i> twistd.bat web -n --path=%path%
</I>&gt;<i> ...
</I>&gt;<i> 1. How can I turn on the --profile option?
</I>
You should just be able to do something like:

    twistd.bat web -n --path=%path% --profile=stats_obj
--profiler=cProfile --savestats

Then after a duration of time pounding the server with requests you can stop
it and introspect the stats_obj file:

python
&gt;&gt;<i> import pstats
</I>&gt;&gt;<i> s = pstats.Stats('stats_obj')
</I>&gt;&gt;<i> s.sort_stats('time').print_stats()
</I>
This will give you an ordered list of functions where the most time has been
spent. It's also useful to sort by cumulative time. For more information on
how to introspect stats objects see the Python documentation for the pstats
and cProfile module.

&gt;<i> 2. Any way to know how many millisecond elapsed between &quot;request received&quot;
</I>&gt;<i> and render_POST call?
</I>
You'll have to measure this yourself I think. A glance at the twisted
codebase informs me:
- In twisted/web/http.py incoming requests are handled by an
HTTPChannel (the protocol from the http server factory)
- Incoming data is processed by the lineReceived method which creates
a Request object
- When all content for a request is received the allContentsReceived
method is invoked, which in turn calls the requestReceived method on
the Request object, which does some internal processing like parsing a
POST-encoded body if there is one. This then calls the process method
on the Request object
- In twisted/web/server.py the Request subclass' process method then
finds the resource being requested and calls the render method

I imagine you could modify the code in the above places to set global
variables by calling time.time(), and dumping them out at some point.

&gt;<i> 3. If there are a bunch of files need to be uploaded (say at 50MB/s speed )
</I>&gt;<i> and save by server, Should I write the file directly in render_POST or using
</I>&gt;<i> deferred call?
</I>
Do you mean the server will be *receiving* a file in the HTTP request
body? You can access the request body by looking at request.content
which exposes a File-like API (that is, threat it like you would an
open file in Python).

If you want to *send* a file via Twisted, take a look at:
<A HREF="http://twistedmatrix.com/documents/current/core/howto/producers.html">http://twistedmatrix.com/documents/current/core/howto/producers.html</A>
and
<A HREF="http://twistedmatrix.com/documents/9.0.0/api/twisted.protocols.basic.FileSender.html">http://twistedmatrix.com/documents/9.0.0/api/twisted.protocols.basic.FileSender.html</A>

Cheers,
Reza

-- 
Reza Lotun
mobile: +44 (0)7521 310 763
email:  <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rlotun at gmail.com</A>
work:   <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">reza at tweetdeck.com</A>
twitter: @rlotun


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053756.html">[Twisted-Python] How to profiling twisted web?
</A></li>
	<LI>Next message (by thread): <A HREF="053759.html">[Twisted-Python] How to profiling twisted web?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53758">[ date ]</a>
              <a href="thread.html#53758">[ thread ]</a>
              <a href="subject.html#53758">[ subject ]</a>
              <a href="author.html#53758">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
