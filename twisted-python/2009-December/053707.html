<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] copy.deepcopy domish.Element works in python	2.5	but not in 2.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20copy.deepcopy%20domish.Element%20works%20in%20python%0A%092.5%09but%20not%20in%202.6&In-Reply-To=%3C20091217181113.15596.456256757.divmod.xquotient.407%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053706.html">
   <LINK REL="Next"  HREF="053715.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] copy.deepcopy domish.Element works in python	2.5	but not in 2.6</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20copy.deepcopy%20domish.Element%20works%20in%20python%0A%092.5%09but%20not%20in%202.6&In-Reply-To=%3C20091217181113.15596.456256757.divmod.xquotient.407%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] copy.deepcopy domish.Element works in python	2.5	but not in 2.6">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Dec 17 11:11:13 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053706.html">[Twisted-Python] copy.deepcopy domish.Element works in python 2.5	but not in 2.6
</A></li>
        <LI>Next message (by thread): <A HREF="053715.html">[Twisted-Python] copy.deepcopy domish.Element works in python 2.5	but not in 2.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53707">[ date ]</a>
              <a href="thread.html#53707">[ thread ]</a>
              <a href="subject.html#53707">[ subject ]</a>
              <a href="author.html#53707">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05:40 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">gabriel.rossetti at arimaz.com</A> wrote:
&gt;<i>Hello everyone,
</I>&gt;<i>
</I>&gt;<i>for some reason copy.deepcopy forks great on a domish.Element on 2.5 
</I>&gt;<i>but
</I>&gt;<i>not in 2.6 :
</I>&gt;<i>
</I>&gt;<i>Python 2.5.4 (r254:67916, Sep 20 2009, 10:05:43)
</I>&gt;<i>[GCC 4.4.1] on linux2
</I>&gt;<i>Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
</I>&gt;<i> &gt;&gt;&gt; from twisted.words.xish import domish
</I>&gt;<i> &gt;&gt;&gt; import copy
</I>&gt;<i> &gt;&gt;&gt; msg = domish.Element(('jabber:client', 'message'))
</I>&gt;<i> &gt;&gt;&gt; msg2 = copy.deepcopy(msg)
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Python 2.6.4 (r264:75706, Nov  2 2009, 14:38:03)
</I>&gt;<i>[GCC 4.4.1] on linux2
</I>&gt;<i>Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
</I>&gt;<i> &gt;&gt;&gt; from twisted.words.xish import domish
</I>&gt;<i> &gt;&gt;&gt; import copy
</I>&gt;<i> &gt;&gt;&gt; msg = domish.Element(('jabber:client', 'message'))
</I>&gt;<i> &gt;&gt;&gt; msg2 = copy.deepcopy(msg)
</I>&gt;<i>Exception RuntimeError: 'maximum recursion depth exceeded while calling
</I>&gt;<i>a Python object' in &lt;type 'exceptions.AttributeError'&gt; ignored
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>does someone understand why? I'm using twisted 8.2 on ubuntu 9.10. 
</I>&gt;<i>Thank
</I>&gt;<i>you,
</I>&gt;<i>Gabriel
</I>
Actually, it looks like it works about equally well on either version. 
While it looks like an exception was raised by deepcopy on Python 2.6, 
notice that the exception was actually *ignored*.  You get back a copy, 
and it even seems to have all the right attributes. ;)

The infinite recursion in deepcopy happens on Python 2.5 as well.  I'm 
not completely sure why it's not being reported, but it probably has to 
do with tiny differences in how deepcopy works.  hasattr is well known 
for swallowing exceptions silently.  The impressive thing is that the 
error is reported at all in Python 2.6.

A good rule of thumb is to assume that types don't support being copied 
like this unless their docs explicitly state that they do.  If you want 
this to be supported, it's probably not too hard to implement.  Feel 
free to file a ticket with a patch. :)

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053706.html">[Twisted-Python] copy.deepcopy domish.Element works in python 2.5	but not in 2.6
</A></li>
	<LI>Next message (by thread): <A HREF="053715.html">[Twisted-Python] copy.deepcopy domish.Element works in python 2.5	but not in 2.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53707">[ date ]</a>
              <a href="thread.html#53707">[ thread ]</a>
              <a href="subject.html#53707">[ subject ]</a>
              <a href="author.html#53707">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
