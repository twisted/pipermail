<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] reactor.callLater() or	reactor.callFromThread()	when sending msg just before quit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20reactor.callLater%28%29%20or%0A%09reactor.callFromThread%28%29%09when%20sending%20msg%20just%20before%20quit&In-Reply-To=%3C20091208151406.2549.1712465614.divmod.xquotient.448%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053622.html">
   <LINK REL="Next"  HREF="053624.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] reactor.callLater() or	reactor.callFromThread()	when sending msg just before quit</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20reactor.callLater%28%29%20or%0A%09reactor.callFromThread%28%29%09when%20sending%20msg%20just%20before%20quit&In-Reply-To=%3C20091208151406.2549.1712465614.divmod.xquotient.448%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] reactor.callLater() or	reactor.callFromThread()	when sending msg just before quit">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Dec  8 08:14:06 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053622.html">[Twisted-Python] reactor.callLater() or reactor.callFromThread() when sending msg just before quit
</A></li>
        <LI>Next message (by thread): <A HREF="053624.html">[Twisted-Python] reactor.callLater() or reactor.callFromThread() when sending msg just before quit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53623">[ date ]</a>
              <a href="thread.html#53623">[ thread ]</a>
              <a href="subject.html#53623">[ subject ]</a>
              <a href="author.html#53623">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12:50 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">gabriel.rossetti at arimaz.com</A> wrote:
&gt;<i>Hello everyone,
</I>&gt;<i>
</I>&gt;<i>I have to send a message just before my service quits, but sometimes 
</I>&gt;<i>the
</I>&gt;<i>reactor quits before the msg is sent.
</I>&gt;<i>I was wondering if I should user reactor.callLater like so :
</I>&gt;<i>
</I>&gt;<i>self.sendMessage(msg)
</I>&gt;<i>reactor.callLater(1, self.stop)
</I>&gt;<i>
</I>&gt;<i>(which I don't really like), or use reactor.callFromThread like so :
</I>&gt;<i>
</I>&gt;<i>self.sendMessage(msg)
</I>&gt;<i>reactor.callFromThread(self.stop)
</I>&gt;<i>
</I>&gt;<i>(self.stop calls reactor.stop at some point).
</I>&gt;<i>
</I>&gt;<i>I really need for that msg to be sent before the reactor shuts down.
</I>
You should stop the reactor only after you receive acknowledgement that 
the message arrived at its destination.  Hopefully the protocol you're 
using supports this.

There are several ways in which bytes on a TCP connection can get lost. 
When you call reactor.stop() immediately after trying to send some 
bytes, it's most likely that they get lost because they are still in 
Twisted's send buffer.  However, even if they get out of Twisted's send 
buffer and into the kernel's, they still may get lost on the network. 
And even if they arrive in the destination's kernel receive buffer, the 
receiving process may still exit (perhaps unintentionally) without 
reading them.  And even if it reads them, it may exit without processing 
them.  And even if they are processed, the disk I/O which records the 
result of that processing may be interrupted by a power loss or similar 
event.

You may not need to deal with all of these eventualities (it depends on 
the purpose and reliability requirements of your application, of 
course).  It's very common to want to know that the application on the 
other side of the connection read and processed the bytes, though.  This 
requires that the protocol allow messages to be acknowledged.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053622.html">[Twisted-Python] reactor.callLater() or reactor.callFromThread() when sending msg just before quit
</A></li>
	<LI>Next message (by thread): <A HREF="053624.html">[Twisted-Python] reactor.callLater() or reactor.callFromThread() when sending msg just before quit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53623">[ date ]</a>
              <a href="thread.html#53623">[ thread ]</a>
              <a href="subject.html#53623">[ subject ]</a>
              <a href="author.html#53623">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
