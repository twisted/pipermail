<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twistd logging
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twistd%20logging&In-Reply-To=9d748c780912091014p547542d4y29b3f62532702e2a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021136.html">
   <LINK REL="Next"  HREF="021127.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twistd logging</H1>
    <B>Lucas Taylor</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twistd%20logging&In-Reply-To=9d748c780912091014p547542d4y29b3f62532702e2a%40mail.gmail.com"
       TITLE="[Twisted-Python] Twistd logging">ltaylor.volks at gmail.com
       </A><BR>
    <I>Wed Dec  9 17:34:24 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="021136.html">[Twisted-Python] Twistd logging
</A></li>
        <LI>Next message: <A HREF="021127.html">[Twisted-Python] A resizable cooperator class for queuing and	dispatching jobs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21143">[ date ]</a>
              <a href="thread.html#21143">[ thread ]</a>
              <a href="subject.html#21143">[ subject ]</a>
              <a href="author.html#21143">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/9/09 11:14 AM, Landreville wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Wed, Dec 9, 2009 at 12:26 PM, &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 8 Dec, 09:04 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">landreville at deadtreepages.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">landreville at deadtreepages.com</A>&gt; wrote:
</I>&gt;<i>     &gt;Is there a way I can customize the format of log file?
</I>&gt;<i>     &gt;I want to add more information to each line (about the xmlrpc method
</I>&gt;<i>     &gt;being
</I>&gt;<i>     &gt;called), but I can't find where these lines get written out. I know I
</I>&gt;<i>     &gt;can
</I>&gt;<i>     &gt;print a message to the log in my _getFunction, but I would prefer to
</I>&gt;<i>     &gt;have
</I>&gt;<i>     &gt;one line per request.
</I>&gt;<i> 
</I>&gt;<i>     Are you talking about the CLF request log or the main log file (normally
</I>&gt;<i>     called &quot;twistd.log&quot;)?
</I>&gt;<i> 
</I>&gt;<i>     The former can be controlled by overriding the &quot;log&quot; method of Site.
</I>&gt;<i>     The latter is controlled by the general log observer(s) which is
</I>&gt;<i>     installed.  You can read about customizing the log observer using .tac
</I>&gt;<i>     files in the online documentation:
</I>&gt;<i> 
</I>&gt;<i>      <A HREF="http://twistedmatrix.com/documents/current/core/howto/application.html">http://twistedmatrix.com/documents/current/core/howto/application.html</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I'm talking about the main log file (twistd.log) that is created. I want
</I>&gt;<i> to customize the lines that are written to it, the document only tells
</I>&gt;<i> me how to use a different observer, not how to format the lines that are
</I>&gt;<i> being output by twistd.
</I>&gt;<i> 
</I>&gt;<i> I would like to change the output from:
</I>&gt;<i> 2009-12-09 12:59:01-0500 [-] 127.0.0.1 - - [09/Dec/2009:17:59:01 +0000]
</I>&gt;<i> &quot;POST /XMLRPC HTTP/1.0&quot; 200 647 &quot;-&quot; &quot;xmlrpclib.py/1.0.1
</I>&gt;<i> &lt;<A HREF="http://xmlrpclib.py/1.0.1">http://xmlrpclib.py/1.0.1</A>&gt; (by www.pythonware.com
</I>&gt;<i> &lt;<A HREF="http://www.pythonware.com">http://www.pythonware.com</A>&gt;)
</I>&gt;<i> to include &quot;xmlrpc method: system.listMethods&quot; at the end (or something
</I>&gt;<i> similar to include the methd name&quot;.
</I>&gt;<i> 
</I>&gt;<i> I see in the observers an eventDict is passed in to be output in the
</I>&gt;<i> log, but where does that eventDict get created/passed in?
</I>&gt;<i> 
</I>
The output you describe is the CLF request log generated by the Site
instance (via twisted.web.http.HTTPFactory.log). You can do as suggested
and override the &quot;log&quot; method on your Site instance. This will give you
access to the request and allow you to extract the xmlrpc method.

Something like...

class Site(server.Site):
    def log(self, request):
        request.content.seek(0,0)
        args, functionPath = xmlrpclib.loads(request.content.read())

	# Keep the CLF line
	server.Site.log(self, request)

	# Add your own info on another line
        if hasattr(self, &quot;logFile&quot;):
            self.logFile.write('xmlrpc method: %s\n' % (functionPath,))

You did say you would prefer to have one line per request, so you might
want to just recreate the log method from HTTPFactory here and make
appropriate modifications (calculating request date/time and adding your
xmlrpc info).




</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021136.html">[Twisted-Python] Twistd logging
</A></li>
	<LI>Next message: <A HREF="021127.html">[Twisted-Python] A resizable cooperator class for queuing and	dispatching jobs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21143">[ date ]</a>
              <a href="thread.html#21143">[ thread ]</a>
              <a href="subject.html#21143">[ subject ]</a>
              <a href="author.html#21143">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
