<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Simulating time for reactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Simulating%20time%20for%20reactor&In-Reply-To=1073934360.1249.31.camel%40sheriffpony">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006983.html">
   <LINK REL="Next"  HREF="006988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Simulating time for reactor</H1>
    <B>Phillip J. Eby</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Simulating%20time%20for%20reactor&In-Reply-To=1073934360.1249.31.camel%40sheriffpony"
       TITLE="[Twisted-Python] Simulating time for reactor">pje at telecommunity.com
       </A><BR>
    <I>Mon Jan 12 14:55:09 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006983.html">[Twisted-Python] Simulating time for reactor
</A></li>
        <LI>Next message: <A HREF="006988.html">[Twisted-Python] twisted-bugs mailing list back in action
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6985">[ date ]</a>
              <a href="thread.html#6985">[ thread ]</a>
              <a href="subject.html#6985">[ subject ]</a>
              <a href="author.html#6985">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At 02:06 PM 1/12/04 -0500, Itamar Shtull-Trauring wrote:
&gt;<i>On Mon, 2004-01-12 at 12:35, David Bolen wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; For example, if IReactorCore included a now() or time() method which
</I>&gt;<i> &gt; was the only way it grabbed system time, then tests could mock up a
</I>&gt;<i> &gt; reactor to be installed at the start of a test and just override that
</I>&gt;<i> &gt; one method to control time.  From looking at base.py in the Twisted
</I>&gt;<i> &gt; distribution for example, it only appears that a few uses of
</I>&gt;<i> &gt; time.time() would have to be tweaked.
</I>&gt;<i>
</I>&gt;<i>This still wouldn't alter how long e.g. select() waits, but since that
</I>&gt;<i>has maximum timeouts you'd probably be fine with just changing the time
</I>&gt;<i>to be 30 secs in the future, yeah.
</I>
For tests in PEAK that involve reactors, I use a &quot;clock&quot; object with 
time(), select(), and sleep() methods.  The select() and sleep() methods 
just increment the time() value by the given number of seconds.  So, for 
each test, time() starts at zero and we go from there.

One other issue to watch for: the insertion of delayed calls must be 
stable.  That is, if you add two delayed calls with the same target time, 
they must end up in the list in the order that they were added.  Otherwise, 
tests will behave oddly.  It's been a long time since I looked at Twisted's 
base reactor code, but it seems to me that the last time I did, Twisted was 
*not* using a stable insertion algorithm.  Mine uses insort_right and 
pop(0), with an object type that compares equal for equal target times.  If 
this latter constraint isn't met, it's not possible to get a stable 
insertion using the bisect module's insort functions.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006983.html">[Twisted-Python] Simulating time for reactor
</A></li>
	<LI>Next message: <A HREF="006988.html">[Twisted-Python] twisted-bugs mailing list back in action
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6985">[ date ]</a>
              <a href="thread.html#6985">[ thread ]</a>
              <a href="subject.html#6985">[ subject ]</a>
              <a href="author.html#6985">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
