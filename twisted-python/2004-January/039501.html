<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Simulating time for reactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Simulating%20time%20for%20reactor&In-Reply-To=%3Cuhdyzg8i1.fsf%40fitlinxx.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="039495.html">
   <LINK REL="Next"  HREF="039491.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Simulating time for reactor</H1>
    <B>David Bolen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Simulating%20time%20for%20reactor&In-Reply-To=%3Cuhdyzg8i1.fsf%40fitlinxx.com%3E"
       TITLE="[Twisted-Python] Re: Simulating time for reactor">db3l at fitlinxx.com
       </A><BR>
    <I>Tue Jan 13 08:42:46 MST 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="039495.html">[Twisted-Python] Re: Simulating time for reactor
</A></li>
        <LI>Next message (by thread): <A HREF="039491.html">[Twisted-Python] Simulating time for reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39501">[ date ]</a>
              <a href="thread.html#39501">[ thread ]</a>
              <a href="subject.html#39501">[ subject ]</a>
              <a href="author.html#39501">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Christopher Armstrong &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">radix at twistedmatrix.com</A>&gt; writes:

&gt;<i> That's your incorrect assumption; you can stop
</I>&gt;<i> reactors. reactor.crash().
</I>
Well, actually I'm well aware of being able to stop reactors.  It's
just that doing so isn't a good fit for my current test scenario.

&gt;<i>                            Usually one does this from some callback
</I>&gt;<i> within their test.
</I>
Ah, there's your incorrect assumption :-) That the reactor delayed
events that are created by the code under test end up in a callback
within the test itself.  If that were the case I might not have a
problem using reactor.run() and reactor.stop(), although I suppose I'd
still have to think about the case when the callback was incorrectly
never called - how would the test terminate in that case with a
failure?  (Guess I'd have to install an additional callLater as a
back-stop or something, which is unnecessary latency in a failure
scenario - could easily add up over a lot of tests)

&gt;<i>                    I've written tests with both iterate() and
</I>&gt;<i> run()/crash(); the latter is usually more natural to me. I don't
</I>&gt;<i> remember enough right now to try to make a blanket assertion about
</I>&gt;<i> which one is better, though (maybe I should write more tests again ;).
</I>
I'm definitely not saying which is better or worse, but in the tests I
was referring to, iterate() was clearly more applicable.  I think I
could see using run()/crash() if I were testing a more protocol piece
of code, but that's not my current scenario, where it's primarily
delayed calls I want control of.

As an example, I'm testing the controller portion of an MVC setup.
Most of the tests initialize a model to some known state, assign it to
a controller, and then initiate certain events through the controller.
The controller will be part of a bigger Twisted-based system, but the
controller itself handles no network I/O, so the only part of Twisted
it's really depending on is the IReactorTime for delayed actions used
as timeouts in the controller.  The checks in the test are that the
model ends up in the right final state after the events.  I don't care
how the controller accomplishes that feat (it's internals are opaque
to users and semi-opaque to tests), just that the model ends up the
right way.

Some of the model changes are triggered by internal timeouts within
the controller, so to test that, the test adjusts the timeout value
used by the controller (hence &quot;semi-opaque&quot;) when establishing delayed
calls so that I know the call - if the controller set it up - will
fire during the next iterate().  I can then sequence the iterate()
call along with other events to simulate various permutations of
timing of events with respect to the delayed call occurring.  To my
mind it's extremely clean and controlled given that I'm effectively
testing asynchronous events with respect to specific use cases.  That
is, except for externally overriding the timer value, which is only
needed to ensure the delayed call will trigger when I want it to (thus
my request here).

But with respect to reactor.run(), the key is that the callback for
the delayed call is internal to the controller and the test is not
interfering with that at all, nor does it have visibility to it.  I
could theoretically subclass the controller as a mock controller to
add a reactor.stop() to such a callback, but that would be much more
complexity to me than simply using iterate() when appropriate in the
test.  I think both have their place, but I definitely like the
availability of iterate() for this scenario.

-- David



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="039495.html">[Twisted-Python] Re: Simulating time for reactor
</A></li>
	<LI>Next message (by thread): <A HREF="039491.html">[Twisted-Python] Simulating time for reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39501">[ date ]</a>
              <a href="thread.html#39501">[ thread ]</a>
              <a href="subject.html#39501">[ subject ]</a>
              <a href="author.html#39501">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
