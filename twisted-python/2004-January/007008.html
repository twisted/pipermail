<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferred proposed update
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferred%20proposed%20update&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007005.html">
   <LINK REL="Next"  HREF="007011.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferred proposed update</H1>
    <B>Fabrice Coudert</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferred%20proposed%20update&In-Reply-To="
       TITLE="[Twisted-Python] deferred proposed update">fabrice.coudert at free.fr
       </A><BR>
    <I>Fri Jan 16 10:22:58 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007005.html">[Twisted-Python] can't get twisted to install on SunOS...
</A></li>
        <LI>Next message: <A HREF="007011.html">[Twisted-Python] deferred proposed update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7008">[ date ]</a>
              <a href="thread.html#7008">[ thread ]</a>
              <a href="subject.html#7008">[ subject ]</a>
              <a href="author.html#7008">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I 'd like to add a pre-processing and post-processing callback in a 
deferred callback list. I did somthing like this :

my_defer = getADeferredForSomething()
new_defer = defer.Deferred()
new_defer.addCallback(preprocessing)
new_defer.chainDeferred(my_defer)
new_defer.addCallback(postprocessing)
my_defer = new_defer

My problem is that postprocessing doesn't receive the result of the last 
callback in my_defer, but it reveive None.
This can be explained in twisted source by that chainDeferred(d) is 
equivalent to addCallbacks(d.callback, d.errback), but this two methods 
are not really sort of callback methods for deferred coz they didn't 
return a result.

So I patched Deferred class to add &quot;return self.result&quot;, and it works well :

Deferred_old = defer.Deferred
class Deferred_new(Deferred_old):
    def callback(self, result):
        Deferred_old.callback(self, result)
        return self.result
    def errback(self, fail=None):
        Deferred_old.errback(self, fail)
        return self.result
defer.Deferred = Deferred_new

Notes by doing this you can also get final result when firing the 
callbacks :

final_result = my_defer.callback(result)

I dunno if this patch will fail something else in twisted.

fc.








</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007005.html">[Twisted-Python] can't get twisted to install on SunOS...
</A></li>
	<LI>Next message: <A HREF="007011.html">[Twisted-Python] deferred proposed update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7008">[ date ]</a>
              <a href="thread.html#7008">[ thread ]</a>
              <a href="subject.html#7008">[ subject ]</a>
              <a href="author.html#7008">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
