<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Where is best place to put my custom code?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Where%20is%20best%20place%20to%20put%20my%20custom%20code%3F&In-Reply-To=%3C71D2DB39-3D92-11D8-B76A-0030656C6B9E%40webcrunchers.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="039405.html">
   <LINK REL="Next"  HREF="039412.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Where is best place to put my custom code?</H1>
    <B>JD</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Where%20is%20best%20place%20to%20put%20my%20custom%20code%3F&In-Reply-To=%3C71D2DB39-3D92-11D8-B76A-0030656C6B9E%40webcrunchers.com%3E"
       TITLE="[Twisted-Python] Re: Where is best place to put my custom code?">lists at webcrunchers.com
       </A><BR>
    <I>Fri Jan  2 19:13:39 MST 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="039405.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
        <LI>Next message (by thread): <A HREF="039412.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39411">[ date ]</a>
              <a href="thread.html#39411">[ thread ]</a>
              <a href="subject.html#39411">[ subject ]</a>
              <a href="author.html#39411">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 1, 2004, at 6:52 PM, Andrew Bennetts wrote:

&gt;<i> On Thu, Jan 01, 2004 at 11:25:37AM -0800, JD wrote:
</I>&gt;&gt;<i> On Dec 31, 2003, at 7:43 PM, Eric Mangold wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Since this is IRC you shouldn't go issuing commands until your signed
</I>&gt;&gt;&gt;<i> on, thus the signedOn method of your protocol would be the right 
</I>&gt;&gt;&gt;<i> place.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ok,   good point....   but how do I issue commands?   let's say I have
</I>&gt;&gt;<i> a IRCClient class called &quot;testIRC&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> do I use:    testIRC.sendLine('signedOn')  to send the command to the
</I>&gt;&gt;<i> IRC server
</I>&gt;&gt;<i> to signon?
</I>&gt;<i>
</I>&gt;<i> No.  IRCClient is a LineReceiver subclass, because that's how the 
</I>&gt;<i> low-level
</I>&gt;<i> protocol works.
</I>
I think I understand.   what is needed in the docs,   is a better 
description of just
what the roles of these objects are supposed to do,   and where we,  as 
users
of Twisted,  would have a much better chance to use Twisted in the way 
it is
intended.    So the usage of 'sendLine' in a 'lineReceiver' would be 
inappropriate?
but if that's true,  then how does one send a command to the IRC server?

By the way,   I've chosen this as a simple test application,  not 
unlike what I
want to really do,   so I have chosen a relatively simple application,  
where I
just extract all the users of a specified IRC server,  and return the 
data.

I have not specified the form of the data,  that's not important,  but 
what's
important to me,  is the understand how to use Twisted in the way it was
intended.

I have this:

class IRC_test(irc.IRCClient):

     def whois_on(self):
     	&quot;&quot;&quot;
     	This method issues a 'WHO' command to see who is on the server.
     	&quot;&quot;&quot;
     	self.sendLine(&quot;WHO&quot;)

     def signedOn(self):
         &quot;&quot;&quot;Called after sucessfully signing on to the server.   So we 
immediately
         issue the 'whois_on' message to let the server go and do it's 
stuff.
         &quot;&quot;&quot;
         self.whois_on(self)

     def whois_result(self, prefix,  info):
		&quot;&quot;&quot;
		This is the code the IRC is somehow going to call.   Then,
		after it is called,  it stores the info in the factory
		and returns by calling 'reactor.stop()' to exit the reactor.run()
		&quot;&quot;&quot;
		self.result = extract_whois_data(info)
		reactor.stop()
		
     def irc_RPL_WHOISSERVER(self, prefix, params):
     	&quot;&quot;&quot;
     	This was not included in the parent class IRCClient,
     	So I add it here.  'lineReceived' gets the
     	command = numeric_to_symbolic[command],  which is now
     	the string 'RPL_WHOISSERVER'.   To get THIS method to call,
     	the 'handleCommand' method first generates a key to the
     	class's 'attribute' dictionary,  by pre-pending 'irc_'
     	in front of it to get this method,  which is then called.
     	'params' would then have the result data.   We need to
     	hack around to see what form it's in.
     	&quot;&quot;&quot;
         self.whois_result(params[1])
		
def test_irc(host, port):
	&quot;&quot;&quot;
	This function scans a particular IRC server,  and returns a dictionary
	of all the nicks and IP addresses.  Nick is the key,  the IP or reverse
	dns is the value.
	&quot;&quot;&quot;
	my_nick = &quot;jd6969&quot;
	data_dict = {}		# place where I want my IRC data
	myTestFactory = IRC_test(data_dict,  my_nick)
	reactor.connectTCP(host, port, myTestFactory)
	reactor.run()		# I just wait for the server to respond
	return data_dict	# when it does, I just want to return with the data

I know this is a pretty stupid and useless application,  but this is 
very close to what I want
it to do,  without revealing anything.    I haven't tested this yet,  
because I just want to be
sure I'm doing it right,  rather then to spend weeks down a particular 
path to nowhere.
	
&gt;<i> However, you're not using the low-level protocol, you're
</I>&gt;<i> using an abstraction on top of it -- IRCClient.  Don't break the 
</I>&gt;<i> abstraction
</I>&gt;<i> (by calling LineReceiver's sendLine method) unless you have a good 
</I>&gt;<i> reason to
</I>&gt;<i> and you know the protocol spec well enough to know what you're doing 
</I>&gt;<i> (which
</I>&gt;<i> would be RFC 2812 in this case, I think).
</I>
I believe I do,  because I still have to tell the IRC server what I 
want it to do.
And the only way I can see,  is with the sendLine command.

&gt;<i>
</I>&gt;<i> As far as I'm aware, sending a line saying 'signedOn' to the server 
</I>&gt;<i> doesn't
</I>&gt;<i> make any sense in the IRC protocol, so this definitely wouldn't achieve
</I>&gt;<i> anything useful, except causing an error from the server that the 
</I>&gt;<i> IRCClient
</I>&gt;<i> instance probably won't expect (because you broke the abstraction and 
</I>&gt;<i> snuck
</I>&gt;<i> behind its back to do it).
</I>
Ok,   so it is clear I'm doing this wrong.  If that's the case,  then 
what is the
RIGHT way of doing it?

&gt;<i>
</I>&gt;&gt;<i> or do I:   testIRC.register('mynick', 'myhost', 'irc.debian.com')
</I>&gt;<i>
</I>&gt;<i> That looks much saner.  And noticeably more full of information than
</I>&gt;<i> testIRC.sendLine('signedOn')...
</I>&gt;<i>
</I>&gt;&gt;<i> then,   when I want to do the &quot;who&quot; command,  would I do:
</I>&gt;&gt;<i> testIRC.sendLine('who')
</I>&gt;<i>
</I>&gt;<i> Well, I believe the WHO command requires an argument, so it would be 
</I>&gt;<i> more
</I>&gt;<i> like testIRC.sendLine('WHO ' + name)... but see my next answer.
</I>
hmmm - in checking the RFC it mentions I can either &quot;WHO &lt;channel&gt;&quot; or
&quot;WHO&quot; without specifying a channel,  in which it gets the names of ALL 
the users
of the IRC server not hidden.

&gt;<i>
</I>&gt;&gt;<i> then,   i would expect to call me back,   so I would override the
</I>&gt;&gt;<i> &quot;action&quot; method,
</I>&gt;&gt;<i> like so:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> def action(self, user, channel, msg):
</I>&gt;&gt;<i> 	&lt; extract the info I want from msg and store it somewhere,  probably
</I>&gt;&gt;<i> in an instance variable in testIRC object &gt;
</I>&gt;&gt;<i>          reactor.stop()    ---  to exit the client and disconnect,   
</I>&gt;&gt;<i> or
</I>&gt;&gt;<i> would I have to put the reactor.stop() in the
</I>&gt;&gt;<i>          factory's &quot;clientConnectionFailed&quot; method,  which I would
</I>&gt;&gt;<i> override of course.
</I>&gt;<i>
</I>&gt;<i> That's not what the action method is for.  As the docstring for action 
</I>&gt;<i> says:
</I>&gt;<i> &quot;Called when I see a user perform an ACTION on a channel.&quot;  An ACTION 
</I>&gt;<i> is a
</I>&gt;<i> specific thing in IRC, not a catch-all for every type of message from
</I>&gt;<i> server to client.  See the RFC if you're not familar with the terms.
</I>
Yes - I was mislead...   I interpreted this as an action that might come
from the server,  such as the result of a WHO command (in using my 
example)

I think if you take a look at the shell of my application,   I'm no 
longer using this.

&gt;<i> The right way to do this is implemented in sandbox/exarkun/irc2.py -- 
</I>&gt;<i> see
</I>&gt;<i> the AdvancedClient.who method.  I'd follow JP's earlier suggestion and 
</I>&gt;<i> use
</I>&gt;<i> it.
</I>
I was NOT aware that anything in &quot;sandbox&quot; had anything to do with IRC.
Expecially when words like this are chosen.   One can interpret 
'sandbox' in
many zillion ways,  so how would I even know this.

I took a look at this,  and WOW - this might be just what I need.   I'm 
going to
have to spend a lot of time studying this.    I had no clue this even 
existed,
primarily because the name 'sandbox' really had nothing to do with IRC,
and I just couldn't make the connection.

&gt;<i> The answer is of course none of those.  You should've already noticed 
</I>&gt;<i> that
</I>&gt;<i> IRCClient doesn't implement a who() method, so it's hardly surprising 
</I>&gt;<i> it
</I>&gt;<i> hasn't implemented a command to deal with its response.
</I>
yes - as it also doesn't implement a LOT of things,  and yet they are
defined as overrideable functions.

&gt;<i>  irc2.py does,
</I>&gt;<i> though (and uses Deferreds for dealing with the response, which is 
</I>&gt;<i> cleaner
</I>&gt;<i> anyway).
</I>
Kewl - and now just being aware of that,    I definately want to check 
it out.
And also I could use some connents on my above approach,  as I have
avoided the pitfalls you outlined above.

&gt;<i> I thought you wanted to use the WHO command not WHOIS?  Please try to 
</I>&gt;<i> be
</I>&gt;<i> precise.
</I>
I thought they were almost the same....  at least that's what I read in 
the RFC's.
What is the difference?

&gt;<i> Anyway, irc2.py also implements WHOIS.
</I>
Kewl

&gt;<i>
</I>&gt;&gt;<i> Could I add this to my IRCClient's subclass?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IE:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     def irc_RPL_WHOISSERVER(self, prefix, params):
</I>&gt;&gt;<i>         self.whois(params[1])
</I>&gt;<i>
</I>&gt;<i> If you look at irc2.py, you'll see it does override this method.  Note 
</I>&gt;<i> that
</I>&gt;<i> 'whois' is a bad name for the response handler -- the existing 
</I>&gt;<i> convention in
</I>&gt;<i> IRCClient is that 'join', 'nick', etc, are the methods that *issue* the
</I>&gt;<i> command, not that handle the response.
</I>
I haven't seen any mention of naming conventions,  but if there is one,
I certainly would want to know where it is.

&gt;<i> I think the biggest critical step you're missing is that you're busily
</I>&gt;<i> trying to reinvent a wheel that's already been made in
</I>&gt;<i> sandbox/exarkun/irc2.py, though.
</I>
that is obviously true....  I explained above why I just didn't even 
know of it's
existance until it was pointed out to me.

John



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="039405.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
	<LI>Next message (by thread): <A HREF="039412.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39411">[ date ]</a>
              <a href="thread.html#39411">[ thread ]</a>
              <a href="subject.html#39411">[ subject ]</a>
              <a href="author.html#39411">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
