<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Where is best place to put my custom code?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Where%20is%20best%20place%20to%20put%20my%20custom%20code%3F&In-Reply-To=%3C20040102025208.GB11930%40frobozz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="039404.html">
   <LINK REL="Next"  HREF="039411.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Where is best place to put my custom code?</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Where%20is%20best%20place%20to%20put%20my%20custom%20code%3F&In-Reply-To=%3C20040102025208.GB11930%40frobozz%3E"
       TITLE="[Twisted-Python] Re: Where is best place to put my custom code?">andrew-twisted at puzzling.org
       </A><BR>
    <I>Thu Jan  1 19:52:08 MST 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="039404.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
        <LI>Next message (by thread): <A HREF="039411.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39405">[ date ]</a>
              <a href="thread.html#39405">[ thread ]</a>
              <a href="subject.html#39405">[ subject ]</a>
              <a href="author.html#39405">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Jan 01, 2004 at 11:25:37AM -0800, JD wrote:
&gt;<i> On Dec 31, 2003, at 7:43 PM, Eric Mangold wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Since this is IRC you shouldn't go issuing commands until your signed
</I>&gt;<i> &gt;on, thus the signedOn method of your protocol would be the right place.
</I>&gt;<i> 
</I>&gt;<i> Ok,   good point....   but how do I issue commands?   let's say I have
</I>&gt;<i> a IRCClient class called &quot;testIRC&quot;.
</I>&gt;<i> 
</I>&gt;<i> do I use:    testIRC.sendLine('signedOn')  to send the command to the 
</I>&gt;<i> IRC server
</I>&gt;<i> to signon?
</I>
No.  IRCClient is a LineReceiver subclass, because that's how the low-level
protocol works.  However, you're not using the low-level protocol, you're
using an abstraction on top of it -- IRCClient.  Don't break the abstraction
(by calling LineReceiver's sendLine method) unless you have a good reason to
and you know the protocol spec well enough to know what you're doing (which
would be RFC 2812 in this case, I think).

As far as I'm aware, sending a line saying 'signedOn' to the server doesn't
make any sense in the IRC protocol, so this definitely wouldn't achieve
anything useful, except causing an error from the server that the IRCClient
instance probably won't expect (because you broke the abstraction and snuck
behind its back to do it).

&gt;<i> or do I:   testIRC.register('mynick', 'myhost', 'irc.debian.com')
</I>
That looks much saner.  And noticeably more full of information than
testIRC.sendLine('signedOn')...

&gt;<i> then,   when I want to do the &quot;who&quot; command,  would I do:   
</I>&gt;<i> testIRC.sendLine('who')
</I>
Well, I believe the WHO command requires an argument, so it would be more
like testIRC.sendLine('WHO ' + name)... but see my next answer.

&gt;<i> then,   i would expect to call me back,   so I would override the 
</I>&gt;<i> &quot;action&quot; method,
</I>&gt;<i> like so:
</I>&gt;<i> 
</I>&gt;<i> def action(self, user, channel, msg):
</I>&gt;<i> 	&lt; extract the info I want from msg and store it somewhere,  probably 
</I>&gt;<i> in an instance variable in testIRC object &gt;
</I>&gt;<i>          reactor.stop()    ---  to exit the client and disconnect,   or 
</I>&gt;<i> would I have to put the reactor.stop() in the
</I>&gt;<i>          factory's &quot;clientConnectionFailed&quot; method,  which I would 
</I>&gt;<i> override of course.
</I>
That's not what the action method is for.  As the docstring for action says:
&quot;Called when I see a user perform an ACTION on a channel.&quot;  An ACTION is a
specific thing in IRC, not a catch-all for every type of message from
server to client.  See the RFC if you're not familar with the terms.

The right way to do this is implemented in sandbox/exarkun/irc2.py -- see
the AdvancedClient.who method.  I'd follow JP's earlier suggestion and use
it.

&gt;<i> It's things like this that throw me totally for a loop.   Where to put 
</I>&gt;<i> things....  what gets the call back...
</I>
It depends on the protocol implementation.  There's no single generic answer
for the whole of Twisted.

&gt;<i> &gt;No. An ACTION in IRC terms is a user doing an /me.
</I>&gt;<i> 
</I>&gt;<i> Ok,  if &quot;action&quot; isn't the callback which I override to get the output 
</I>&gt;<i> of the who command,
</I>&gt;<i> then what is?
</I>&gt;<i> 
</I>&gt;<i> myInfo?   luserClient?
</I>&gt;<i> 
</I>&gt;<i> luserChannels - Called with the number of channels existant on the 
</I>&gt;<i> server (ALMOST what I want)
</I>&gt;<i> luserOp - Called with the number of ops logged on to the server 
</I>&gt;<i> (GETTING CLOSER - NOT QUITE)
</I>&gt;<i> luserMe - Called with information about the server connected to. 
</I>&gt;<i> (CLOSEST YET - but no IP address info)
</I>
The answer is of course none of those.  You should've already noticed that
IRCClient doesn't implement a who() method, so it's hardly surprising it
hasn't implemented a command to deal with its response.  irc2.py does,
though (and uses Deferreds for dealing with the response, which is cleaner
anyway).

&gt;<i> Ok,   so how do these get called?   As far as I can tell,    
</I>&gt;<i> &quot;handleCommand&quot; calls
</I>&gt;<i> 
</I>&gt;<i> method = getattr(self, &quot;irc_%s&quot; % command, None)
</I>&gt;<i> 
</I>&gt;<i> which it then somehow then calls back to:
</I>&gt;<i> 
</I>&gt;<i>     def irc_RPL_LUSERME(self, prefix, params):
</I>&gt;<i>         self.luserMe(params[1])
</I>&gt;<i> 
</I>&gt;<i> I really want:   RPL_WHOISSERVER,  but (sigh) it's not there.   Nobody 
</I>&gt;<i> bothered to finish this
</I>&gt;<i> module.
</I>
I thought you wanted to use the WHO command not WHOIS?  Please try to be
precise.

Anyway, irc2.py also implements WHOIS.

&gt;<i> Could I add this to my IRCClient's subclass?
</I>&gt;<i> 
</I>&gt;<i> IE:
</I>&gt;<i> 
</I>&gt;<i>     def irc_RPL_WHOISSERVER(self, prefix, params):
</I>&gt;<i>         self.whois(params[1])
</I>
If you look at irc2.py, you'll see it does override this method.  Note that
'whois' is a bad name for the response handler -- the existing convention in
IRCClient is that 'join', 'nick', etc, are the methods that *issue* the
command, not that handle the response.

&gt;<i> Is this all I have to do....   but then would 'getattr' as you see 
</I>&gt;<i> above,   know how to get the method name?
</I>&gt;<i> Or would I have to add this somehow to another dictionary?
</I>
Yes, it would.  Please see the docs for getattr in the Python standard
library reference.

&gt;<i> Anyway,   other then being totally confused,   is there any hope?   I 
</I>&gt;<i> think I'm just missing a few
</I>&gt;<i> critical steps.    Or do I have them all?
</I>
No idea.  You tell me :)

I think the biggest critical step you're missing is that you're busily
trying to reinvent a wheel that's already been made in
sandbox/exarkun/irc2.py, though.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="039404.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
	<LI>Next message (by thread): <A HREF="039411.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39405">[ date ]</a>
              <a href="thread.html#39405">[ thread ]</a>
              <a href="subject.html#39405">[ subject ]</a>
              <a href="author.html#39405">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
