<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Some suggestions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Some%20suggestions&In-Reply-To=%3C3B77F233.40208%40itamarst.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="032754.html">
   <LINK REL="Next"  HREF="032760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Some suggestions</H1>
    <B>Itamar</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Some%20suggestions&In-Reply-To=%3C3B77F233.40208%40itamarst.org%3E"
       TITLE="[Twisted-Python] Some suggestions">twisted at itamarst.org
       </A><BR>
    <I>Mon Aug 13 09:28:51 MDT 2001</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="032754.html">[Twisted-Python] twisted enterprise
</A></li>
        <LI>Next message (by thread): <A HREF="032760.html">[Twisted-Python] Some suggestions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32759">[ date ]</a>
              <a href="thread.html#32759">[ thread ]</a>
              <a href="subject.html#32759">[ subject ]</a>
              <a href="author.html#32759">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph Lefkowitz wrote:


&gt;&gt;<i>My main concern is *safety*. For example, I'm pretty sure making 
</I>&gt;&gt;<i>connectionLose() synchronized is not enough to make it thread safe. 
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Why not? If it's synchronized, and doWrite is synchronized, then I can't
</I>&gt;<i> figure out what the safety issue is.  Did you try, and experience some, or
</I>&gt;<i> do you know of some potential ones from reading it?
</I>
It is not thread-safe. This is because the whole addReader / addWriter / 
doSelect etc. code in internet.main isn't thread safe, so even if the 
FileDescriptor is internally thread safe its interactions with the list 
of readers and writers aren't.

For adding writers/readers this is less of an issue, although still 
potentially buggy. Removing on the other hand can lead to select() calls 
on already closed FilEDescriptors (as in the traceback I emailed the list.)

For example, look at the select.select(readers.keys()....) call. If the 
FileDescriptor is closed by a thread right after the .keys() call then 
select() will run on a closed descriptor and barf.

Now, messing around with this so it's thread safe starts getting way too 
icky. I would like therefore to redo the Scheduler so that it is thread 
safe, and use it to schedule closing and writing to transports.

I think the way this should work is that each thread should have an 
associated Task to which it adds methods to be called. That way a single 
thread can't monopolize the scheduler. This means however that it should 
be possible to add works to tasks after they've been added to the scheduler.

I think the best way to do this is to use python's built-in Queue class. 
In order to not slow down non-threaded apps, I will implement a 
non-thread safe Queue class with the same interface (or the non-blocking 
parts of the interface, anyway) so that you can do:

	from threadable import Queue

And get the appropriate Queue class. Make sense?




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="032754.html">[Twisted-Python] twisted enterprise
</A></li>
	<LI>Next message (by thread): <A HREF="032760.html">[Twisted-Python] Some suggestions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32759">[ date ]</a>
              <a href="thread.html#32759">[ thread ]</a>
              <a href="subject.html#32759">[ subject ]</a>
              <a href="author.html#32759">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
