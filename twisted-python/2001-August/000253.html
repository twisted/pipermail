<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Suggested new module: twisted.internet.threadtask
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Suggested%20new%20module%3A%20twisted.internet.threadtask&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000252.html">
   <LINK REL="Next"  HREF="000231.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Suggested new module: twisted.internet.threadtask</H1>
    <B>Itamar Shtull-Trauring</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Suggested%20new%20module%3A%20twisted.internet.threadtask&In-Reply-To="
       TITLE="[Twisted-Python] Suggested new module: twisted.internet.threadtask">itamar at zoteca.com
       </A><BR>
    <I>Mon Aug 13 13:23:41 EDT 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="000252.html">[Twisted-Python] Some suggestions
</A></li>
        <LI>Next message: <A HREF="000231.html">[Twisted-Python] First try at thread-safe FileDescriptor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#253">[ date ]</a>
              <a href="thread.html#253">[ thread ]</a>
              <a href="subject.html#253">[ subject ]</a>
              <a href="author.html#253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Actually there is no need for using this class. And perhaps an 
</I>&gt;<i> additional scheduler module for threads only may be better than altering 
</I>&gt;<i> the existing one.
</I>
Okay, attached is a first shot at a task scheduler for threads. 
Basically, tasks that are not thread safe should be added to this 
scheduler, and then they will be called by the event loop.

I tested this by shutting off the synchronization in FileDescriptor, and 
having my threaded server add all writes and closes to this scheduler 
instead of calling them directly. It seemed to work fine, though CPU 
usage seemed to be higher.


Future improvements:
1) Make locking more fine-grained.
2) Just like classes can have a synchronized property with a list of 
functions to be synchrnoized, I think there can be a scheduled property 
as well, which would automate the following idiom for making thread-safe 
operations using the scheduler:


def write(self, msg):
     if not threadable.isInIOThread():
         threadtask.schedule(self.write, (msg, ))
         return

     # regular write functionality goes here
     ...


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: threadtask.py
Url: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20010813/924a5148/attachment.txt">http://twistedmatrix.com/pipermail/twisted-python/attachments/20010813/924a5148/attachment.txt</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000252.html">[Twisted-Python] Some suggestions
</A></li>
	<LI>Next message: <A HREF="000231.html">[Twisted-Python] First try at thread-safe FileDescriptor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#253">[ date ]</a>
              <a href="thread.html#253">[ thread ]</a>
              <a href="subject.html#253">[ subject ]</a>
              <a href="author.html#253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
