<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] reload / restart best practices ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20reload%20/%20restart%20best%20practices%20%3F&In-Reply-To=%3CFF4BEB18-5277-4C04-A3C5-492926D863CA%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059507.html">
   <LINK REL="Next"  HREF="059511.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] reload / restart best practices ?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20reload%20/%20restart%20best%20practices%20%3F&In-Reply-To=%3CFF4BEB18-5277-4C04-A3C5-492926D863CA%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] reload / restart best practices ?">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Jun 12 14:31:55 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059507.html">[Twisted-Python] reload / restart best practices ?
</A></li>
        <LI>Next message (by thread): <A HREF="059511.html">[Twisted-Python] reload / restart best practices ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59510">[ date ]</a>
              <a href="thread.html#59510">[ thread ]</a>
              <a href="subject.html#59510">[ subject ]</a>
              <a href="author.html#59510">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jun 12, 2013, at 11:40 AM, Jonathan Vanasco &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at 2xlp.com</A>&gt; wrote:

&gt;<i> Does anyone have a suggestion on how to best approach this ?  I saw some old discussions about ideas for implementing graceful restarts via autoload, and other stuff.
</I>
I'm not sure what &quot;autoload&quot; is.  I am assuming it's some kind of auto-re-loading technology though.

&gt;<i> Because my application might be in mid-conversation with external APIs , I don't want to kill the process and respawn.
</I>
You do want to re-start your process.  What you're diagnosing is some weird, unknown thread/process interaction and unless you get a clean slate, you don't know what is happening.

You may not want to do so immediately, though, since, as you say:

&gt;<i> I'd like them to finish , and shutdown/restart N seconds later ( assuming that I wouldn't be able to fully shutdown because of an issue with a locked thread ).  
</I>
The issue is with letting them finish.  In order to accomplish this, you should write IService implementations that have stopService methods that, when called, will wait for any operations in flight associated with that service.

Once everything is quiesced, you can re-exec ([sys.executable] + sys.argv) and that ought to result in the same process starting up again.  If you've done the appropriate thing and made all your stopService methods wait for their operations to complete, then waiting for them all to complete is just putting them all into a MultiService, calling stopService() on that MultiService, and adding a callback/errback to the Deferred it returns which calls os.exec.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130612/829acbd0/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059507.html">[Twisted-Python] reload / restart best practices ?
</A></li>
	<LI>Next message (by thread): <A HREF="059511.html">[Twisted-Python] reload / restart best practices ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59510">[ date ]</a>
              <a href="thread.html#59510">[ thread ]</a>
              <a href="subject.html#59510">[ subject ]</a>
              <a href="author.html#59510">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
