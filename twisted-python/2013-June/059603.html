<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20If%20the%20errbacks%20of%20a%20canceled%20Deferred%20are%0A%20called%20with%20error%20other%20than%20CancelledError%2C%20is%20this%20acceptable%3F&In-Reply-To=%3CCACqnu4W7PfSXUmpRVrfSjjZ5eWZaksmB9aRF6nc5P3jV_OHokw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059602.html">
   <LINK REL="Next"  HREF="059599.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20If%20the%20errbacks%20of%20a%20canceled%20Deferred%20are%0A%20called%20with%20error%20other%20than%20CancelledError%2C%20is%20this%20acceptable%3F&In-Reply-To=%3CCACqnu4W7PfSXUmpRVrfSjjZ5eWZaksmB9aRF6nc5P3jV_OHokw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?">terry at jon.es
       </A><BR>
    <I>Sat Jun 22 17:52:08 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059602.html">[Twisted-Python] If the errbacks of a canceled Deferred are	called with error other than CancelledError, is this acceptable?
</A></li>
        <LI>Next message (by thread): <A HREF="059599.html">[Twisted-Python] If the errbacks of a canceled Deferred are	called with error other than CancelledError, is this acceptable?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59603">[ date ]</a>
              <a href="thread.html#59603">[ thread ]</a>
              <a href="subject.html#59603">[ subject ]</a>
              <a href="author.html#59603">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tom

I'm not sure we should continue this discussion on the list seeing as the
original issue seems to be settled. Anyway, here's an answer and maybe we
could/should take it offline if there's more to say?

On Sat, Jun 22, 2013 at 11:14 PM, Tom Prince &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tom.prince at ualberta.net</A>&gt;wrote:

&gt;<i> Terry Jones &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">terry at jon.es</A>&gt; writes:
</I>&gt;<i> &gt; The problem that I was originally trying to address by getting 'cancel'
</I>&gt;<i> &gt; into deferreds is that the control flow you mention gets totally stuck
</I>&gt;<i> if a
</I>&gt;<i> &gt; deferred never fires for some reason (this was happening to me in talking
</I>&gt;<i> &gt; to the Twitter API).
</I>&gt;<i>
</I>&gt;<i> .cancel as currently implemented addresses this, as calling cancel
</I>&gt;<i> causes the deferred to fire.
</I>

Right. When I say &quot;originally&quot; I mean in Jan 2010, before cancel was
implemented. See the thread URL I posted a couple of times in this thread
to see how it wen t down.


&gt;<i> &gt; This goes against the thinking that only the code that creates a deferred
</I>&gt;<i> &gt; can fire it.
</I>&gt;<i>
</I>&gt;<i> To allow anything else would be to break the abstraction
</I>&gt;<i>
</I>&gt;<i>     d = Deferred()
</I>&gt;<i>     return d
</I>&gt;<i>     ...
</I>&gt;<i>     d.callback(5)
</I>&gt;<i>
</I>&gt;<i> vs.
</I>&gt;<i>     d = Deferred()
</I>&gt;<i>     d.addCallback(lambda x: x+1)
</I>&gt;<i>     return d
</I>&gt;<i>     ...
</I>&gt;<i>     d.callback(4)
</I>&gt;<i>
</I>&gt;<i> There is currently no way of distinguishing these to code
</I>&gt;<i> snippets. Allowing other code to callback/errback the deferred
</I>&gt;<i> would cause different results in the two cases.
</I>

That depends how you do it. If you actually have 2 deferreds, the original
(which you can't err/callback yourself cause things will break) and one
that you create yourself (as a &quot;controllable&quot; deferred), then you can allow
the latter to be call/errbacked and hook the former up to the latter if the
former fires first. That's what the code samples I posted do, including the
one from Jan 2010.


&gt;<i> &gt; As API writers, we're used to being in control: we don't think it's a
</I>&gt;<i> &gt; good idea if we create and return a deferred in a method and the code
</I>&gt;<i> &gt; we return the deferred to then fires it itself.
</I>&gt;<i>
</I>&gt;<i> It isn't so much a matter of control, as of abstraction. It isn't
</I>&gt;<i> uncommon for a single deferred to be pass through several systems, with
</I>&gt;<i> each stage adding more callbacks, changing the value that the next stage
</I>&gt;<i> will see in the callbacks they add.
</I>&gt;<i>
</I>
Right.


&gt;<i> If the &quot;final&quot; consumer could fire the deferred with any value, it would
</I>&gt;<i> need to know about all the stagse (or at least the first one) to know
</I>&gt;<i> what kind of value to put in.
</I>

In the ControlableDeferred2013 class I posted the other night, this isn't
the case. If the deferred using code fires it, the only callbacks and
errbacks that are run are ones that that code added (not ones added to the
original deferred by the code that made it or any intermediates).


&gt;<i> &gt; But as app writers consuming deferreds from these APIs, we
</I>&gt;<i> &gt; want more control (I do, anyway).
</I>&gt;<i>
</I>&gt;<i> Well, the consumer can't control the deferreds that it gets but, as your
</I>&gt;<i> code demonstrates, it is easy enough to create a new deferred that
</I>&gt;<i> behaves however the consumer wants. The fact that this isn't the same
</I>&gt;<i> object isn't signifiant, since the identity of deferreds isn't an
</I>&gt;<i> interesting thing.
</I>

Yes.

&gt;<i> The ControllableDeferred2013 class I posted last night shows one
</I>&gt;<i> &gt; way.
</I>&gt;<i>
</I>&gt;<i> One comment about the code you posted: There doesn't really seem to be a
</I>&gt;<i> need to create a sepearte class, that forwards
</I>&gt;<i> .addCallback/.addErrback. You can just create a regular deferred that is
</I>&gt;<i> hooked hooked up in the appropriate way. (It may make sense for the
</I>&gt;<i> stage that sets this up to have an object, but it shouldn't pass it
</I>&gt;<i> along, it should just pass a regular deferred on). There are a few
</I>&gt;<i> places that accept deferreds that depend on the object being an instance
</I>&gt;<i> of deferred, which your object isn't.
</I>

Yes, you can do that too (and there are other approaches). Here's a
subclassing version that's similar to what you just described:
<A HREF="http://twistedmatrix.com/pipermail/twisted-python/2010-January/021311.html">http://twistedmatrix.com/pipermail/twisted-python/2010-January/021311.html</A>
They're all basically the same idea (at least the way I do it), just based
on setting up another deferred and hooking the original up to it when/if
needed.

Terry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130623/e2d70cf3/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059602.html">[Twisted-Python] If the errbacks of a canceled Deferred are	called with error other than CancelledError, is this acceptable?
</A></li>
	<LI>Next message (by thread): <A HREF="059599.html">[Twisted-Python] If the errbacks of a canceled Deferred are	called with error other than CancelledError, is this acceptable?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59603">[ date ]</a>
              <a href="thread.html#59603">[ thread ]</a>
              <a href="subject.html#59603">[ subject ]</a>
              <a href="author.html#59603">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
