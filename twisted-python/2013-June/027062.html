<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Testing AMP-based code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Testing%20AMP-based%20code&In-Reply-To=%3C87a9msiwok.fsf%40x200s.i-did-not-set--mail-host-address--so-tickle-me%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027054.html">
   <LINK REL="Next"  HREF="027034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Testing AMP-based code</H1>
    <B>Free Ekanayaka</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Testing%20AMP-based%20code&In-Reply-To=%3C87a9msiwok.fsf%40x200s.i-did-not-set--mail-host-address--so-tickle-me%3E"
       TITLE="[Twisted-Python] Testing AMP-based code">free at 64studio.com
       </A><BR>
    <I>Fri Jun 14 08:39:07 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027054.html">[Twisted-Python] Testing AMP-based code
</A></li>
        <LI>Next message: <A HREF="027034.html">[Twisted-Python] A bug of the DNSDatagramProtocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27062">[ date ]</a>
              <a href="thread.html#27062">[ thread ]</a>
              <a href="subject.html#27062">[ subject ]</a>
              <a href="author.html#27062">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>|<i>--==&gt; On Wed, 12 Jun 2013 23:16:12 -0000, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> said:
</I>
  &gt; I think this is thinking in the right direction.  Twisted generally
  &gt; tries to be responsible for testing its own code, and the
  &gt; serialization from commands to bytes (and the reverse) that AMP does
  &gt; is part of Twisted, so you should really be free from the burden of
  &gt; testing that that stuff works.

Agreed. Thanks for the detailed explanation about the AMP internals, I
hadn't take time yet to fully read the implementation, I did now and
your directions helped.

I'm certainly happy to integrate the docs with this information as Glyph
suggested.

  &gt; So this all means that your application logic can all live on a
  &gt; CommandLocator subclass.

Indeed, I had figured out this particular bit already.

  &gt; When you really want to put this on an AMP server, you can hook an
  &gt; AMP instance up to your CommandLocator subclass (AMP takes a locator
  &gt; as an __init__ argument).  When you want to test your command
  &gt; implementations, you can hook the CommandLocator up to a
  &gt; BoxDispatcher and a box sender and throw boxes straight at it with
  &gt; no network interation.

Okay this is where it get interesting and I'd like to hear for opinions
for a few different possibilities. Following the your idea above, I've
put together this little example of application code with tests (it
expands the one attached to the ticket):

<A HREF="http://pastebin.com/6hTw5WDC">http://pastebin.com/6hTw5WDC</A>

I've included some comments that are not really code comments, but
rather just express issues/considerations.

I believe there are two parts of application code that you want to test
(possibly differently). One part are the application-defined AMP
commands and their responders, the other part is the application client
code that make use of them via callRemote. So basically two different
layers.

My question is probably if folks have any opinion about whether to mock
the parts of your applications that invoke callRemote (typically by
providing fakes, so you don't invoke callRemote at all), or
alternatively to fake callRemote itself. As I wrote in the paste, this
probably drifts towards a &quot;state-based vs behavior-based&quot; matter.

  &gt; Some pieces are probably still missing from the public API - for
  &gt; example, you do want to test that your objects all get properly
  &gt; serialized and deserialized through AMP, particularly if you're
  &gt; implementing custom Argument types.  There are some private APIs,
  &gt; _objectsToStrings and _stringsToObjects mostly, that really help with
  &gt; testing this, and we should think about how to expose this
  &gt; functionality publically.  Also, we should document this whole pile of
  &gt; stuff.

I do have custom Argument types. Those could be exercised indirectly by
faking callRemote the way the FakeBoxDispatcher class in the paste does,
but there might be nicer approaches.

  &gt; Maybe you'd be interested in writing something up after you've
  &gt; had a chance to play with these ideas?

Sure. It feels part of these questions are not purely AMP-specific and
are generally relevant for testing application code that uses protocols
indirectly. I guess a popular approach is to wrap protocols inside
&quot;Client&quot; classes and then provide fake versions of those clients, which
at the end is perhaps what I should do in this case too (e.g. fake the
MathClient in the code).

Cheers,

Free

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027054.html">[Twisted-Python] Testing AMP-based code
</A></li>
	<LI>Next message: <A HREF="027034.html">[Twisted-Python] A bug of the DNSDatagramProtocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27062">[ date ]</a>
              <a href="thread.html#27062">[ thread ]</a>
              <a href="subject.html#27062">[ subject ]</a>
              <a href="author.html#27062">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
