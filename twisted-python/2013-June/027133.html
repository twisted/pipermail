<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20If%20the%20errbacks%20of%20a%20canceled%20Deferred%20are%0A%20called%20with%20error%20other%20than%20CancelledError%2C%20is%20this%20acceptable%3F&In-Reply-To=%3CCACqnu4Wt8RF6wcD6hFLxXz2F%3Dz-Gc27Yb2Pnj4Rmsu4fOmqc5A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027131.html">
   <LINK REL="Next"  HREF="027134.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20If%20the%20errbacks%20of%20a%20canceled%20Deferred%20are%0A%20called%20with%20error%20other%20than%20CancelledError%2C%20is%20this%20acceptable%3F&In-Reply-To=%3CCACqnu4Wt8RF6wcD6hFLxXz2F%3Dz-Gc27Yb2Pnj4Rmsu4fOmqc5A%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?">terry at jon.es
       </A><BR>
    <I>Fri Jun 21 09:42:09 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027131.html">[Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?
</A></li>
        <LI>Next message: <A HREF="027134.html">[Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27133">[ date ]</a>
              <a href="thread.html#27133">[ thread ]</a>
              <a href="subject.html#27133">[ subject ]</a>
              <a href="author.html#27133">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi JP

Thanks for the summary. I agree (and agreed in my first post in this
thread) that the CancelledError should (has to) come all the way back. I
missed that we were still talking about that.

Was there a conclusion on Glyph's suggestion of using subclasses of
CancelledError? Chris raised the point that there might be many of them for
a given API. But an API could define a few subclasses, just the most useful
to start with (if there are any at all), and document them, and later
define some more if need be, etc. That would be backwards consistent with
processing by Failure.check and try/except on CancelledError - unless my
Python memory has rotted more than I think. It seems a good path to
providing more info (for APIs that want to). Or is there a problem with it
that I also missed?

Terry



On Fri, Jun 21, 2013 at 3:30 PM, &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:

&gt;<i> On 10:26 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">terry at jon.es</A> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi Tom
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Since most apis in twisted don't pass a canceller, the behavior is a2+a3.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Right. That was the intention (glyph's). It was expected that over time
</I>&gt;&gt;<i> more Twisted apis that create deferreds would add cancellers. As I
</I>&gt;&gt;<i> understand it, Kai Zhang is now adding cancellers to some apis returning
</I>&gt;&gt;<i> deferreds, starting with the POP3 client.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Based on JP's comment, I still think I'm missing something here.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The only suggestion I've been making is that, if we wanted to, we could
</I>&gt;&gt;<i> allow a value to be passed to the cancel call. That would allow errback
</I>&gt;&gt;<i> functions to receive more information when a Deferred is canceled. You'd
</I>&gt;&gt;<i> still get a CancelledError in any case, but the value would be in the
</I>&gt;&gt;<i> exception instance as args[0], as in
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> An idea very much like this was discussed when Deferred cancellation was
</I>&gt;<i> being implemented.  My recollection is that it was ultimately explicitly
</I>&gt;<i> rejected, though I don't remember why nor do I find discussion of it on the
</I>&gt;<i> ticket (#990) (lack of this information somewhere seems like a failure of
</I>&gt;<i> the development process).  I admit the idea of being able to get additional
</I>&gt;<i> information passed through the system seems appealing to me, but *not*
</I>&gt;<i> having any additional information does simplify the interface.  Considering
</I>&gt;<i> how much trouble people already have with Deferreds without even bringing
</I>&gt;<i> cancellation into play, maybe the simpler interface is a good thing.
</I>&gt;<i>
</I>&gt;<i> My earlier point was that any Deferred for which cancellation is not
</I>&gt;<i> already explicitly implemented already has a cancellation behavior: it will
</I>&gt;<i> fire its errback chain with `CancelledError`.  It is an incompatible change
</I>&gt;<i> to replace this with a different exception type - such as `ConnectionDone`.
</I>&gt;<i>
</I>&gt;<i> This is slightly different than your suggestion, Terry, I think - in that
</I>&gt;<i> you propose sticking more information onto the `CancelledError`, not
</I>&gt;<i> changing the type of the `Failure` that is sent down the errback chain.
</I>&gt;<i>  However, the thread was started specifically with the question of whether
</I>&gt;<i> changing `CancelledError` to `ConnectionDone` is acceptable and that's the
</I>&gt;<i> point I was mainly focused on.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>&gt;<i>
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.</A>**com &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-**bin/mailman/listinfo/twisted-**python&lt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-**bin/mailman/listinfo/twisted-**python&lt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>&gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130621/f197046c/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130621/f197046c/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027131.html">[Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?
</A></li>
	<LI>Next message: <A HREF="027134.html">[Twisted-Python] If the errbacks of a canceled Deferred are called with error other than CancelledError, is this acceptable?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27133">[ date ]</a>
              <a href="thread.html#27133">[ thread ]</a>
              <a href="subject.html#27133">[ subject ]</a>
              <a href="author.html#27133">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
