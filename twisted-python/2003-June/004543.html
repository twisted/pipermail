<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Adding persistent db connections to twisted web server?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Adding%20persistent%20db%20connections%20to%20twisted%20web%20server%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004542.html">
   <LINK REL="Next"  HREF="004544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Adding persistent db connections to twisted web server?</H1>
    <B>Lewin, Karl E</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Adding%20persistent%20db%20connections%20to%20twisted%20web%20server%3F&In-Reply-To="
       TITLE="[Twisted-Python] Adding persistent db connections to twisted web server?">Karl.Lewin at BNSF.com
       </A><BR>
    <I>Thu Jun 12 09:12:29 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004542.html">[Twisted-Python] Default location for templates of .rpy's
</A></li>
        <LI>Next message: <A HREF="004544.html">[Twisted-Python] DeferredList solves the multiple query issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4543">[ date ]</a>
              <a href="thread.html#4543">[ thread ]</a>
              <a href="subject.html#4543">[ subject ]</a>
              <a href="author.html#4543">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What is the best/accepted/preferred approach to adding a pool of db
connections that can be re-used in *.rpy's?

My first attempt is to add have a class like this:

# DBPool.py
from twisted.enterprise import adbapi 
from MySQLdb import cursors

class genericQuery(adbapi.Augmentation): 
        def __init__(self):
		adbapi.Augmentation.__init__(self,
                                         adbapi.ConnectionPool&quot;MySQLdb&quot;,
                                         host='localhost',db='xxxxx',
                                         cursorclass=cursors.DictCursor))
	def getData(self,sql,parms=None):
	        if parms==None:
			return self.runQuery(sql)
		else:
			return self.runQuery(sql,parms)

And make a copy of web.py with the following added to the updateApplication
function:

    root.registry.setComponent(genericQuery,genericQuery())

(with the proper imports added as well) and then test it with something
like:


#test.rpy
from twisted.enterprise import adbapi 
from twisted.web import resource,server
from DBPool import genericQuery

class MyGreatResource(resource.Resource):
    def render(self, request):
        q = registry.getComponent(genericQuery)
        d = q.getData(&quot;select version()&quot;)
        d.addCallback(self.returnResult,request)
        return server.NOT_DONE_YET

    def returnResult(self, resultlist, request):
        request.write(`resultlist`)
	request.finish()

resource = MyGreatResource()

I realize that there can be some more paramaterization of the
dbmodule/database/etc parameters but I haven't don't that yet.

Is that a decent way of doing this(or rephrased, how stupid is this way of
doing this)?  How an *.rpy that needed to perform multiple queries work?  Is
there an example of using twisted.web and twisted.enterprise together
anywhere?  

Thanks-
Karl


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004542.html">[Twisted-Python] Default location for templates of .rpy's
</A></li>
	<LI>Next message: <A HREF="004544.html">[Twisted-Python] DeferredList solves the multiple query issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4543">[ date ]</a>
              <a href="thread.html#4543">[ thread ]</a>
              <a href="subject.html#4543">[ subject ]</a>
              <a href="author.html#4543">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
