<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Patch for twisted.protocols.nntp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Patch%20for%20twisted.protocols.nntp&In-Reply-To=%3Cpan.2003.06.23.21.07.18.104943%40smurf.noris.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="037173.html">
   <LINK REL="Next"  HREF="037235.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Patch for twisted.protocols.nntp</H1>
    <B>Matthias Urlichs</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Patch%20for%20twisted.protocols.nntp&In-Reply-To=%3Cpan.2003.06.23.21.07.18.104943%40smurf.noris.de%3E"
       TITLE="[Twisted-Python] Patch for twisted.protocols.nntp">smurf at smurf.noris.de
       </A><BR>
    <I>Mon Jun 23 15:07:18 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037173.html">[Twisted-Python] Patch for twisted.protocols.nntp
</A></li>
        <LI>Next message (by thread): <A HREF="037235.html">[Twisted-Python] Patch for twisted.protocols.nntp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37179">[ date ]</a>
              <a href="thread.html#37179">[ thread ]</a>
              <a href="subject.html#37179">[ subject ]</a>
              <a href="author.html#37179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Jp Calderone wrote:

&gt;<i>  They can complete in any order because the code responsible for the
</I>&gt;<i> Deferred's callback must buffer the message in memory.
</I>&gt;<i> 
</I>Nope. Converting the code to assemble the articles in file-like objects,
or whatever, instead, wouldn't make much of a difference to my current
code -- they would still be able to complete in any order.  Part of the
niceness of streaming CHECK and TAKETHIS messages to an NNTP server is
that there is no ordering required; you can't do that with SMTP.

On the other hand, thinking about this I just had an idea how to manage
the transition from a bunch of parallel Deferreds to a serialized
producer/consumer scheme (addCallback() a code snipped which enqueues the
Deferred onto a queue, and take it from there one-by-one). It's still
going to start out as a Deferred, though; &quot;a producer which needs to do
something special when it first delivers data and which might trigger an
error instead&quot; is complicated code which lumps at least three concepts
into one piece of code, while using a Deferred in the first step leads to
nicely separated stages with distinct code -- always a win in my book.

&gt;<i> At the very least, the object that is currently a string should become a
</I>&gt;<i> file object (This should have minimal impact on your code -- if
</I>&gt;<i> buffering in memory is acceptable to you, you only have to build a
</I>&gt;<i> StringIO object from your string)
</I>
That would be no problem. Whether the Deferred returns an in-memory string
or a file object doesn't make a whole lot of difference, esp. as a simple
'if not hasattr(f,&quot;read&quot;): f = StringIO.StringIO(f)' is sufficient for
turning one into the other.

&gt;<i> It -does- seem that this is becoming a common task (smtp.py and pop3.py
</I>&gt;<i> do it, imap4.py needs to do, and now nntp.py), so maybe I'll write a
</I>&gt;<i> utility mixin to help out, and I'll see if I can generalize it away from
</I>&gt;<i> just file-like objects too.
</I>
That would be nice to have. I'd write it as an adapter or similar, i.e. a
class which turns an LF-based dots-ignorant possibly-without-final-LF
producer into one which has CRLFs, dot-escapes, and a guaranteed CRLF at
the end. That way it'd be useable for things which aren't a streaming
protocol. Direct back-end access to the NNTP storage comes to mind;
it stores articles in the latter format.

-- 
Matthias Urlichs   |   {M:U} IT Design @ m-u-it.de   |  <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">smurf at smurf.noris.de</A>
Disclaimer: The quote was selected randomly. Really. | <A HREF="http://smurf.noris.de">http://smurf.noris.de</A>
-- 
There will always be some delightful mysteries in your life.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037173.html">[Twisted-Python] Patch for twisted.protocols.nntp
</A></li>
	<LI>Next message (by thread): <A HREF="037235.html">[Twisted-Python] Patch for twisted.protocols.nntp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37179">[ date ]</a>
              <a href="thread.html#37179">[ thread ]</a>
              <a href="subject.html#37179">[ subject ]</a>
              <a href="author.html#37179">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
