<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] t.w.microdom and empty HTML elements
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20t.w.microdom%20and%20empty%20HTML%20elements&In-Reply-To=%3C20030627202850.GA3488%40polynode.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="037297.html">
   <LINK REL="Next"  HREF="037301.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] t.w.microdom and empty HTML elements</H1>
    <B>Alex Levy</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20t.w.microdom%20and%20empty%20HTML%20elements&In-Reply-To=%3C20030627202850.GA3488%40polynode.com%3E"
       TITLE="[Twisted-Python] t.w.microdom and empty HTML elements">mesozoic at polynode.com
       </A><BR>
    <I>Fri Jun 27 14:28:50 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037297.html">[Twisted-Python] blocking code in object constructors
</A></li>
        <LI>Next message (by thread): <A HREF="037301.html">[Twisted-Python] Some Question about on woven and rpy/page.Page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37300">[ date ]</a>
              <a href="thread.html#37300">[ thread ]</a>
              <a href="subject.html#37300">[ subject ]</a>
              <a href="author.html#37300">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>While looking into a problem where my pages were showing up blank on IE,
Moonfallen pointed me to the NEVERSINGLETON list in t.w.microdom.toxml().
There is a list of elements which should never be rendered as &lt;node/&gt;, and
instead should always be &lt;node&gt;&lt;/node&gt;.

Upon looking through the specs for XHTML at w3c.org, however, I found that
the _only_ XHTML elements which are allowed as singletons are those whose
content models are &quot;EMPTY&quot; -- &lt;br/&gt;, &lt;hr/&gt;, and so on.  The list of EMPTY
elements is not huge.

I understand the issue that microdom cannot get bogged down with HTML
tweaks; it is, after all, supposed to produce XML.  But it seems like
t.w.microdom shouldn't be spitting out invalid XHTML, even if (for now) it
doesn't look like it breaks anyone's browser.

As I understand it there is no real difference in XML between &lt;node/&gt; and
&lt;node&gt;&lt;/node&gt;.  Given that, wouldn't it be better for toxml() to use an
ALLOWSINGLETON list instead of NEVERSINGLETON?  That is, unless an element
is explicitly allowed to be &lt;foo/&gt;, it would be &lt;foo&gt;&lt;/foo&gt;?

If this is of interest to anyone, below is a diff that implements this; the
list of elements is from the XHTML 1.0 DTD.  I haven't tested it, so someone
else will have to do that, but it works on my page.


Index: twisted/web/microdom.py
===================================================================
RCS file: /cvs/Twisted/twisted/web/microdom.py,v
retrieving revision 1.93
diff -u -r1.93 microdom.py
--- twisted/web/microdom.py	27 Jun 2003 19:10:35 -0000	1.93
+++ twisted/web/microdom.py	27 Jun 2003 20:16:17 -0000
@@ -449,8 +449,9 @@
 
     def writexml(self, stream, indent='', addindent='', newl='', strip=0):
         # write beginning
-        NEVERSINGLETON = ('a', 'li', 'div', 'span', 'title', 'script',
-                          'textarea', 'select', 'style')
+        ALLOWSINGLETON = ('img', 'br', 'hr', 'base', 'meta', 'link', 'param',
+                          'area', 'input', 'col', 'basefont', 'isindex',
+                          'frame')
         # this should never be necessary unless people start
         # changing .tagName on the fly(?)
         if not self.preserveCase:
@@ -468,7 +469,7 @@
             for child in self.childNodes:
                 child.writexml(stream, newindent, addindent, newl, strip)
             w(j((newl, indent, &quot;&lt;/&quot;, self.endTagName, '&gt;')))
-        elif self.tagName.lower() in NEVERSINGLETON:
+        elif self.tagName.lower() not in ALLOWSINGLETON:
             w(j(('&gt;&lt;/', self.endTagName, '&gt;')))
         else:
             w(&quot; /&gt;&quot;)


-- 
Alex Levy
WWW: <A HREF="http://mesozoic.geecs.org">http://mesozoic.geecs.org</A>

&quot;Never let your sense of morals prevent you from doing what is right.&quot;
 -- Salvor Hardin, Isaac Asimov's _Foundation_


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037297.html">[Twisted-Python] blocking code in object constructors
</A></li>
	<LI>Next message (by thread): <A HREF="037301.html">[Twisted-Python] Some Question about on woven and rpy/page.Page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37300">[ date ]</a>
              <a href="thread.html#37300">[ thread ]</a>
              <a href="subject.html#37300">[ subject ]</a>
              <a href="author.html#37300">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
