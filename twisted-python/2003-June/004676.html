<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] IP address, server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20IP%20address%2C%20server&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004639.html">
   <LINK REL="Next"  HREF="004641.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] IP address, server</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20IP%20address%2C%20server&In-Reply-To="
       TITLE="[Twisted-Python] IP address, server">warner at lothar.com
       </A><BR>
    <I>Mon Jun 23 19:01:20 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004639.html">[Twisted-Python] IP address, server
</A></li>
        <LI>Next message: <A HREF="004641.html">[Twisted-Python] PATCH: doc/historic/index.html  reality link
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4676">[ date ]</a>
              <a href="thread.html#4676">[ thread ]</a>
              <a href="subject.html#4676">[ subject ]</a>
              <a href="author.html#4676">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Erik van Blokland &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">erik at letterror.com</A>&gt; writes:

&gt;<i> The tiny http server script works when I take a browser on
</I>&gt;<i> the same machine as the server and look at
</I>&gt;<i> <A HREF="http://127.0.0.1:801,">http://127.0.0.1:801,</A> I get the expected result, so the
</I>&gt;<i> server is alive. When I take a look from a different machine
</I>&gt;<i> using the local IP address of the server <A HREF="http://10.0.0.5:801">http://10.0.0.5:801</A>
</I>&gt;<i> I get no response. Other services over my network to the
</I>&gt;<i> server work fine. Do I need to do more, listen to a specific
</I>&gt;<i> port, tell the server the IP address? Is this supposed to
</I>&gt;<i> work and the problem lies elsewhere, OS perhaps (would be
</I>&gt;<i> good to know too)
</I>
Very strange. There's nothing in your code that should treat requests coming
from the local host any differently than requests coming in over the
network. My suspicion is that there's some kind of packet filter in place
that is dropping inbound connections to low-numbered ports.

You say other services on that same machine work fine, so it doesn't sound
like a network problem, or a filter that rejects *all* incoming connection
requests. Try having your Twisted server listen on a port like 9999 and see
what happens. Port 801 falls into the &quot;privileged&quot; range, so on many systems
you must be root to bind to it.. maybe OS-X does something special with
these kinds of ports.

I ran your script (on an older box, with python 2.2.0), and didn't see the
behavior you describe. (I did have to run it as root, and of course with
2.2.0 I had to turn True into 1). I do see a few other problems, though.
render() is supposed to either return a string with the HTML (or whatever)
to be sent to the client, *or* return NOT_DONE_YET and do .write/.finish .
Your code does .write, .finish, and then returns None, which isn't quite the
same (it calls .finish twice). I think it's ok to call .finish before you
return NOT_DONE_YET. I would write the code one of these two ways:

    def render(self, httprequest):
        hdr = httprequest.getAllHeaders()
        html = '&lt;html&gt;&lt;body&gt;Have a nice day&lt;/body&gt;&lt;/html&gt;'
        httprequest.write(html)
        httprequest.setHeader('Content-Length', len(html))
        httprequest.setHeader('Content-Type', 'html/plain')
        httprequest.setResponseCode(200)
        return server.NOT_DONE_YET

or:

    def render(self, httprequest):
        return '&lt;html&gt;&lt;body&gt;Have a nice day&lt;/body&gt;&lt;/html&gt;'

Note also that you're &quot;html&quot; variable has a %d that isn't currently being
used in a % format operation, so it will wind up as a literal % in the data
sent to the client.

You might want to add the following to the beginning of your code to see the
double-.finish warning and other log messages:

 from twisted.python import log
 import sys
 log.startLogging(sys.stdout)


Hope that gives you some new directions to try out..

cheers,
 -Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004639.html">[Twisted-Python] IP address, server
</A></li>
	<LI>Next message: <A HREF="004641.html">[Twisted-Python] PATCH: doc/historic/index.html  reality link
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4676">[ date ]</a>
              <a href="thread.html#4676">[ thread ]</a>
              <a href="subject.html#4676">[ subject ]</a>
              <a href="author.html#4676">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
