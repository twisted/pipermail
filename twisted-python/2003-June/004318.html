<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Excel, Twisted, and wxPython
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Excel%2C%20Twisted%2C%20and%20wxPython&In-Reply-To=FE33DCFC-9401-11D7-B9B9-000393C92466%40dalkescientific.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004320.html">
   <LINK REL="Next"  HREF="004352.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Excel, Twisted, and wxPython</H1>
    <B>Uwe C. Schroeder</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Excel%2C%20Twisted%2C%20and%20wxPython&In-Reply-To=FE33DCFC-9401-11D7-B9B9-000393C92466%40dalkescientific.com"
       TITLE="[Twisted-Python] Excel, Twisted, and wxPython">uwe at oss4u.com
       </A><BR>
    <I>Sun Jun  1 04:57:06 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004320.html">[Twisted-Python] Excel, Twisted, and wxPython
</A></li>
        <LI>Next message: <A HREF="004352.html">[Twisted-Python] Excel, Twisted, and wxPython
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4318">[ date ]</a>
              <a href="thread.html#4318">[ thread ]</a>
              <a href="subject.html#4318">[ subject ]</a>
              <a href="author.html#4318">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well, I have no idea if you can get this working, but here are my $0.02

The problem with twisted and wx is that both systems are event driven and both 
have a never-ending mainloop to process those events.
As you figured out already, wx is particularly weird with event loops. The wx 
MainLoop processes only non-modal UI events. The moment you open a modal 
window (or a pulldown menu) the mainloop stops looping and waits for some 
&quot;sub-loop&quot; to terminate. Unfortunately this sub-loop depends on the platform 
you are on. AFAIK wxWindows simply uses the loops from the different toolkits 
(GTK, MS ....), so there is basically no way to hook into those loops in a 
platform independant way. Maybe Robin can shed some light on this.

This is also the problem with the twisted wx support code. It works nicely as 
long as you don't use a modal window. Then the code simply stops working. 
That's why I posted a recipe on activestate's python cookbook, which uses a 
timer to run the twisted reactor without actually running the reactor loop. 
This is the only way I could get it working without using threads and as I 
see in your Python2 file you figured that one out.

I am not sure what the wxApp Mainloop does internally. Maybe you try calling 
the Dispatch and ProcessIdle methods once in a while, or dig into the source 
and figure out what they do internally. My guess would be that some UI events 
aren't processed properly.
Another wild idea that just jumped to my mind. Try an event.Skip() at the end 
of you OnIdle handler.  Maybe there is some other internal idle event handler 
that never gets called since you have your own and thus you miss some 
internal handling.

Not much, but maybe it helps.


On Sunday 01 June 2003 12:23 am, Andrew Dalke wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>    I'm working on an add-in for Excel, under MS Windows.  This takes
</I>&gt;<i> information
</I>&gt;<i> from the current selection and uses XML-RPC to call a remote server.
</I>&gt;<i>
</I>&gt;<i>    The call may take a while, so I want to have a &quot;Cancel&quot; button.  I
</I>&gt;<i> decided to use wxPython for the GUI, with a modal dialog.  Basically,
</I>&gt;<i> a wxGauge (for the progress bar) and a &quot;Cancel&quot; button.
</I>&gt;<i>
</I>&gt;<i>    The RPC call itself may take several minutes, so I need to use either
</I>&gt;<i> threads or Twisted, and obviously I decided on the latter.  (This is an
</I>&gt;<i> in-process add-in; I'm worried about using threads inside the Excel
</I>&gt;<i> process itself.)
</I>&gt;<i>
</I>&gt;<i>    I can't figure out how to make this all work together.  There's some
</I>&gt;<i> support code in Twisted for wxPython, but it appears to only support
</I>&gt;<i> the main event loop, while I'm running a modal window, and never call
</I>&gt;<i> my wxApp's MainLoop.
</I>&gt;<i>
</I>&gt;<i>    I tried replacing my wxDialog with a wxFrame, which kinda works,
</I>&gt;<i> except
</I>&gt;<i> that the background is very strange.  It looks like it hasn't been
</I>&gt;<i> fully initialized.
</I>&gt;<i>
</I>&gt;<i>    I've attached my code, in the hopes that someone here can help me
</I>&gt;<i> figure out what to do.
</I>&gt;<i>
</I>&gt;<i>    BTW, Twisted's wxPython support subsumes wx's main loop code.  Is
</I>&gt;<i> there any reason there can't be an implementation which hooks into
</I>&gt;<i> wx's idle loop, so that users can decide who's in charge?  I think that
</I>&gt;<i> would actually fix my problem, since Modals (I think) process the
</I>&gt;<i> idle loop ...  Nope, I'm not clever enough to figure that out - my
</I>&gt;<i> attempt is attached as &quot;Progress2.py&quot;
</I>&gt;<i>
</I>&gt;<i> 					Andrew
</I>&gt;<i> 					<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dalke at dalkescientific.com</A>
</I>

--
Open Source Solutions 4U, LLC	2570 Fleetwood Drive
Phone:  +1 650 872 2425		San Bruno, CA 94066
Cell:   +1 650 302 2405		United States
Fax:    +1 650 872 2417



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004320.html">[Twisted-Python] Excel, Twisted, and wxPython
</A></li>
	<LI>Next message: <A HREF="004352.html">[Twisted-Python] Excel, Twisted, and wxPython
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4318">[ date ]</a>
              <a href="thread.html#4318">[ thread ]</a>
              <a href="subject.html#4318">[ subject ]</a>
              <a href="author.html#4318">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
