<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Patch for twisted.protocols.nntp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Patch%20for%20twisted.protocols.nntp&In-Reply-To=%3C20030623161647.GA14057%40meson.dyndns.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="037166.html">
   <LINK REL="Next"  HREF="037179.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Patch for twisted.protocols.nntp</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Patch%20for%20twisted.protocols.nntp&In-Reply-To=%3C20030623161647.GA14057%40meson.dyndns.org%3E"
       TITLE="[Twisted-Python] Patch for twisted.protocols.nntp">exarkun at intarweb.us
       </A><BR>
    <I>Mon Jun 23 10:16:47 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037166.html">[Twisted-Python] Patch for twisted.protocols.nntp
</A></li>
        <LI>Next message (by thread): <A HREF="037179.html">[Twisted-Python] Patch for twisted.protocols.nntp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37173">[ date ]</a>
              <a href="thread.html#37173">[ thread ]</a>
              <a href="subject.html#37173">[ subject ]</a>
              <a href="author.html#37173">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jun 23, 2003 at 12:51:40PM +0200, Matthias Urlichs wrote:
&gt;<i> Hi, Jp Calderone wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Hmm, this is the only part of the patch I am unsure about.  The API
</I>&gt;<i> &gt; seems a little too tuned to your use-case.  I think the way to go for
</I>&gt;<i> &gt; this would be to have a Producer passed in and make the NNTP protocol a
</I>&gt;<i> &gt; Consumer for that (in turn acting as a Producer for its transport
</I>&gt;<i> &gt; object).  Would you be willing to make this change? (If you need an
</I>&gt;<i> &gt; example of how this might work, check out smtp.py)
</I>&gt;<i> 
</I>&gt;<i> Hmm. Looking at the SMTP case, it needs refactoring in that the producer
</I>&gt;<i> isn't decoupled from the file object it ends up reading, thus I can't plug
</I>&gt;<i> a different kind of producer in there.
</I>
  Yea, it isn't perfect.

&gt;<i> 
</I>&gt;<i> Looking further, there's a slightly-broken data-from-file producer in
</I>&gt;<i> doc/historic/2003/pycon/twisted-internet/twisted-internet.py ...
</I>&gt;<i> 
</I>&gt;<i> Anyway, I need NNTP to be a streaming protocol. With a Deferred, this is
</I>&gt;<i> easy -- each Deferred gets a callback which writes TAKETHIS plus the
</I>&gt;<i> message to the server (and queues the result code recognition), so these
</I>&gt;<i> can complete in any order, which is very nice.
</I>
  They can complete in any order because the code responsible for the
Deferred's callback must buffer the message in memory.

&gt;<i> A producer interface would instead have an arbitrary number of producers,
</I>&gt;<i> all of which are active, but as soon as the first one returns anything I
</I>&gt;<i> have to temporarily deactivate all the others. That sounds dangerous --
</I>&gt;<i> what if a producer can't be paused? Then I need to buffer their data, too,
</I>&gt;<i> which is no different from the current case where the article data also
</I>&gt;<i> end up in memory.
</I>
  At the very least, the object that is currently a string should become a
file object (This should have minimal impact on your code -- if buffering in
memory is acceptable to you, you only have to build a StringIO object from
your string), and the NNTP protocol class should consume it in a manner
similar to that of smtp.py.  It -does- seem that this is becoming a common
task (smtp.py and pop3.py do it, imap4.py needs to do, and now nntp.py), so
maybe I'll write a utility mixin to help out, and I'll see if I can
generalize it away from just file-like objects too.

  This gives clients at least the opportunity to avoid loading entire
messages into memory, which is what I am looking for.  Am I right in
thinking this leaves you with all the functionality you want?

  Jp

-- 
&quot;Minerals are inexhaustible and will never be depleted. A stream of
investment creates additions to proved reserves, a very large in-ground
inventory, constantly renewed as it is extracted... How much was in the
ground at the start and how much will be left at the end are unknown and
irrelevant.&quot;  -- Morry Adelman, World Renowned Economist
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20030623/749b3f5b/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037166.html">[Twisted-Python] Patch for twisted.protocols.nntp
</A></li>
	<LI>Next message (by thread): <A HREF="037179.html">[Twisted-Python] Patch for twisted.protocols.nntp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37173">[ date ]</a>
              <a href="thread.html#37173">[ thread ]</a>
              <a href="subject.html#37173">[ subject ]</a>
              <a href="author.html#37173">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
