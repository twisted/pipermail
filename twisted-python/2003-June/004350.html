<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Problem with ReverseProxy and POST requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problem%20with%20ReverseProxy%20and%20POST%20requests&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004349.html">
   <LINK REL="Next"  HREF="004351.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Problem with ReverseProxy and POST requests</H1>
    <B>Lance Kurisaki</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problem%20with%20ReverseProxy%20and%20POST%20requests&In-Reply-To="
       TITLE="[Twisted-Python] Problem with ReverseProxy and POST requests">lkurisaki at ambiron.net
       </A><BR>
    <I>Mon Jun  2 13:03:53 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004349.html">[Twisted-Python] Is twisted supposed to run on AIX/HPUX?
</A></li>
        <LI>Next message: <A HREF="004351.html">[Twisted-Python] Problem with ReverseProxy and POST requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4350">[ date ]</a>
              <a href="thread.html#4350">[ thread ]</a>
              <a href="subject.html#4350">[ subject ]</a>
              <a href="author.html#4350">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to use the Reverse Proxy, and found that the example
(proxy.py) works fine for GET requests, but not for POSTs. The problem
was that the body of the POST was not being forwarded, so the request
would hang while the destination server waited for the rest of the body.

I fixed it with the following patch to the ReverseProxyResource method
in the module twisted.web.proxy.

					Lance


Index: twisted/web/proxy.py
===================================================================
RCS file: /cvs/Twisted/twisted/web/proxy.py,v
retrieving revision 1.11
diff -c -r1.11 proxy.py
*** twisted/web/proxy.py        8 Jan 2003 14:18:56 -0000       1.11
--- twisted/web/proxy.py        2 Jun 2003 16:54:36 -0000
***************
*** 178,183 ****
--- 178,184 ----

      def render(self, request):
          request.received_headers['host'] = self.host
+         request.content.seek(0, 0)
          clientFactory = ProxyClientFactory(request.method, self.path,
                                       request.clientproto,
                                       request.getAllHeaders(),


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004349.html">[Twisted-Python] Is twisted supposed to run on AIX/HPUX?
</A></li>
	<LI>Next message: <A HREF="004351.html">[Twisted-Python] Problem with ReverseProxy and POST requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4350">[ date ]</a>
              <a href="thread.html#4350">[ thread ]</a>
              <a href="subject.html#4350">[ subject ]</a>
              <a href="author.html#4350">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
