<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] call XMLRPC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20call%20XMLRPC&In-Reply-To=CANAxZ%2BOBq89z7UPgxETSZLOi2K5X74LH-ZAiLERvZZRvWTH-DA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025495.html">
   <LINK REL="Next"  HREF="025497.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] call XMLRPC</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20call%20XMLRPC&In-Reply-To=CANAxZ%2BOBq89z7UPgxETSZLOi2K5X74LH-ZAiLERvZZRvWTH-DA%40mail.gmail.com"
       TITLE="[Twisted-Python] call XMLRPC">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Tue Apr 17 04:46:09 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025495.html">[Twisted-Python] call XMLRPC
</A></li>
        <LI>Next message: <A HREF="025497.html">[Twisted-Python] call XMLRPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25496">[ date ]</a>
              <a href="thread.html#25496">[ thread ]</a>
              <a href="subject.html#25496">[ subject ]</a>
              <a href="author.html#25496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/17/2012 03:38 AM, joel tremblet wrote:

&gt;<i> I try to declare the Proxy(OF_XMLRPC_URL) differently, without success
</I>&gt;<i>
</I>&gt;<i> Where is my mistake ....
</I>
That code is all wrong, and (to be blunt) pretty horrible too.

Why have you re-implemented a HTTP protocol yourself? You're bound to 
get this wrong (and in fact have, in several ways). Don't do this. Use 
the HTTP stack that comes with Twisted.

Anyway, your major mistake in the 1st example is that, at the end of the 
lineReceived method, you always call the sendResponse() method. This 
happens immediately, before the XMLRPC reply has come back, so your code 
sends &quot;no value&quot;. You need to attach the sendResponse method to the 
deferred returned from the xmlrpc call.

I would junk it and start again, like this:

from twisted.web import server, resource, xmlrpc, http

proxy = xmlrpc.Proxy(XMLRPC_URL)

class MyResource(resource.Resource):
   isLeaf = True
   def render_GET(self, request):
     sessid = request.args['sessid'][0]
     keyid = request.args['keyid'][0]
     d = proxy.callRemote('checkCommand', sessid, keyid)
     d.addCallback(self._done, request)
     d.addErrback(self._err, request)
     return server.NOT_DONE_YET

   def _done(self, res, request):
     if res!=1:
       request.setResponseCode(406)
     else:
       request.setResponseCode(200)
     request.finish()

   def _err(self, failure, request):
     request.setResponseCode(405)
     request.finish()

reactor.listenTCP(8080, server.Site(MyResource()))
reactor.run()

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025495.html">[Twisted-Python] call XMLRPC
</A></li>
	<LI>Next message: <A HREF="025497.html">[Twisted-Python] call XMLRPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25496">[ date ]</a>
              <a href="thread.html#25496">[ thread ]</a>
              <a href="subject.html#25496">[ subject ]</a>
              <a href="author.html#25496">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
