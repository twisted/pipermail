<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted names - how to add answers to a message	and send replies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20names%20-%20how%20to%20add%20answers%20to%20a%20message%0A%09and%20send%20replies&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017027.html">
   <LINK REL="Next"  HREF="017029.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted names - how to add answers to a message	and send replies</H1>
    <B>Chris Dew</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20names%20-%20how%20to%20add%20answers%20to%20a%20message%0A%09and%20send%20replies&In-Reply-To="
       TITLE="[Twisted-Python] twisted names - how to add answers to a message	and send replies">chris at sidwells.com
       </A><BR>
    <I>Wed Mar 12 04:04:21 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017027.html">[Twisted-Python] Re: question about deferred lists tutorial	description
</A></li>
        <LI>Next message: <A HREF="017029.html">[Twisted-Python] twisted names - how to add answers to a message	and send replies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17028">[ date ]</a>
              <a href="thread.html#17028">[ thread ]</a>
              <a href="subject.html#17028">[ subject ]</a>
              <a href="author.html#17028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a small script which answers dns queries by returning the original
message.  I have spent a couple of hours RTFMing, but I still cannot find
out how to correctly add answers to the message, before returning it.

I want to add an answer, either a Record_CNAME or Record_A, so as to produce
a trivial authoritative-only DNS server.

Adding a Record_XXX object to message.answers using the Array's 'append'
method produces a MalformedPacket (according to wireshark), though the
server does not throw any exceptions.   (In this situation, the answer
count, as shown by dig, does rise to 1, even though no answer is displayed
[due to malformed packet?].)

Perhaps there is a completely different way to do this?  Could I craft a
message with answers from scratch?

Any help appreciated,

Chris.


#!/usr/bin/python

from twisted.internet.protocol import Protocol, Factory
from twisted.internet import reactor
from twisted.names.server import DNSServerFactory
from twisted.names.dns import Query, DNSDatagramProtocol, RRHeader,
Record_CNAME, Record_A, Message
from twisted.names import dns
from twisted.internet.interfaces import IAddress

class Controller(object):
    def messageReceived(self, m, protocol, addr):
        print m, dir(m), m.queries, m.answers
        # tried all sorts of things here
        protocol.transport.write(m.toStr(), addr)

controller = Controller()

if __name__ == &quot;__main__&quot;:
    reactor.listenUDP(53, DNSDatagramProtocol(controller))
    reactor.run()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20080312/dd0c9a82/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20080312/dd0c9a82/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017027.html">[Twisted-Python] Re: question about deferred lists tutorial	description
</A></li>
	<LI>Next message: <A HREF="017029.html">[Twisted-Python] twisted names - how to add answers to a message	and send replies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17028">[ date ]</a>
              <a href="thread.html#17028">[ thread ]</a>
              <a href="subject.html#17028">[ subject ]</a>
              <a href="author.html#17028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
