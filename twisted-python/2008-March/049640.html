<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Advice sought on application evolution
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advice%20sought%20on%20application%20evolution&In-Reply-To=%3C20080321220702.GB13036%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049636.html">
   <LINK REL="Next"  HREF="049642.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Advice sought on application evolution</H1>
    <B>washort at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advice%20sought%20on%20application%20evolution&In-Reply-To=%3C20080321220702.GB13036%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] Advice sought on application evolution">washort at twistedmatrix.com
       </A><BR>
    <I>Fri Mar 21 16:07:02 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049636.html">[Twisted-Python] Advice sought on application evolution
</A></li>
        <LI>Next message (by thread): <A HREF="049642.html">[Twisted-Python] Advice sought on application evolution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49640">[ date ]</a>
              <a href="thread.html#49640">[ thread ]</a>
              <a href="subject.html#49640">[ subject ]</a>
              <a href="author.html#49640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Mar 21, 2008 at 12:23:08PM -0700, Don Dwiggins wrote:
&gt;<i> A small example of something that bothers me is the necessity to break 
</I>&gt;<i> up otherwise &quot;unitary&quot; functions because some parts of them involve 
</I>&gt;<i> communications or heavy computation.  More concretely, consider the 
</I>&gt;<i> following sketch of a method:
</I>&gt;<i> def frobulate(...):
</I>&gt;<i>    step_1()
</I>&gt;<i>    step_2()
</I>&gt;<i>    step_3()
</I>&gt;<i>    step_4()
</I>&gt;<i>    step_5()
</I>&gt;<i>    return result5
</I>&gt;<i> 
</I>&gt;<i> Where the steps are logically coherent parts of the frobulation (in 
</I>&gt;<i> Beck's terms, the method &quot;smells good&quot;).  Now assume that step_3 
</I>&gt;<i> involves a database access.  To avoid blocking, I might twist it like this:
</I>&gt;<i> 
</I>&gt;<i> def frobulate():
</I>&gt;<i>    step_1()
</I>&gt;<i>    step_2()
</I>&gt;<i>    deferred = step_3_async()
</I>&gt;<i>    deferred.addCallback(frobulate_4_and_5)
</I>&gt;<i>    return deferred
</I>&gt;<i> 
</I>&gt;<i> def frobulate_4_and_5(...):
</I>&gt;<i>    step_4()
</I>&gt;<i>    step_5()
</I>&gt;<i>    return result5
</I>&gt;<i> 
</I>&gt;<i> (Where step_3 has been changed to start the access and return a
</I>&gt;<i> deferred.)  In this simple sketch, the &quot;visual noise&quot; introduced isn't
</I>&gt;<i> too bad, but I'm afraid that as the functions multiply and become more 
</I>&gt;<i> complex, it'll make the application considerably harder to understand 
</I>&gt;<i> and manage, and possibly more prone to errors and/or unintended 
</I>&gt;<i> blocking, where twisting a synchronous operation would require serious 
</I>&gt;<i> re-architecting.
</I>
There's a significant advantage to this approach you may not have
considered: When reading frobulate(), you can be assured that no other
code is being executed between step_1(), step_2(), and step_3_async().
Between step_3_async and step_4, anything may happen and arbitrary
amounts of time can pass. Having this explicitly represented in the code
makes certain things /much/ easier to reason about. I agree that the
syntax can be a little unwieldy, but the basic idea is sound: if you are
going to stop executing a multi-step operation and continue it later, it
should be clear that the flow of execution doesn't directly pass between
the two parts of the operation. There are other languages that make this
easier to express, but Python has enough advantages that I find this
problem worth putting up with. :)

&gt;<i>&lt;snip code example with generators&gt;
</I>&gt;<i> This is looking a lot better, but still the asynchrony of step_3 &quot;shows 
</I>&gt;<i> through&quot;.  (Again, I'm taking the viewpoint of someone trying to 
</I>&gt;<i> understand, maintain, and extend the functionality of the application, 
</I>&gt;<i> without having the asynchronous aspects &quot;thrust in his face&quot; more than 
</I>&gt;<i> absolutely necessary.)
</I>
It does show through, and it has to, to make the program comprehensible.
I have a mild dislike for inlineCallbacks because it _does_ minimize the
changes between 'sequential' and 'twisted' code. :)

Basically, there are two choices in this regard for concurrency:

1) Preserve the property that only code you can see locally referenced
   can be executed (i.e., that in &quot;step1(); step2()&quot; only code called
   by those two functions can be executed before the statement is
   finished) and complicate the syntax in places where other code needs
   to be allowed to execute.

2) Preserve the syntax of statements being executed in order but give up
   the guarantee that nothing will be changed by 'outside' code in
   between them.

Twisted's design is centered entirely around #1. Multithreaded
concurrency chooses #2, which is why there's much need for locks and
mutexes and monitors and what have you. The result is slightly more
verbose code, but much more _understandable_ code.
 
&gt;<i> Of course, I can avoid all this by going to a threading or separate 
</I>&gt;<i> process solution, but I'd like to find out if I'm missing something 
</I>&gt;<i> before I make such a commitment.
</I>
Separate processes can be the best of both worlds -- things can run in
sequence and not affect each other in surprising ways. The downside is
that it's more difficult for them to affect each other at all. :)

I hope this helps explain some of Twisted's design choices.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049636.html">[Twisted-Python] Advice sought on application evolution
</A></li>
	<LI>Next message (by thread): <A HREF="049642.html">[Twisted-Python] Advice sought on application evolution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49640">[ date ]</a>
              <a href="thread.html#49640">[ thread ]</a>
              <a href="subject.html#49640">[ subject ]</a>
              <a href="author.html#49640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
