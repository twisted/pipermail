<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] writing back through open connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20writing%20back%20through%20open%20connections&In-Reply-To=%3Ce6a690760803050023n392d648cm63f73c5999255046%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049465.html">
   <LINK REL="Next"  HREF="049522.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] writing back through open connections</H1>
    <B>Chris Dew</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20writing%20back%20through%20open%20connections&In-Reply-To=%3Ce6a690760803050023n392d648cm63f73c5999255046%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] writing back through open connections">chris at sidwells.com
       </A><BR>
    <I>Wed Mar  5 01:23:24 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049465.html">[Twisted-Python] writing back through open connections
</A></li>
        <LI>Next message (by thread): <A HREF="049522.html">[Twisted-Python] writing back through open connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49466">[ date ]</a>
              <a href="thread.html#49466">[ thread ]</a>
              <a href="subject.html#49466">[ subject ]</a>
              <a href="author.html#49466">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Forgive any newbie errors, as I'm new to Twisted.

The pattern discussed *seems* to be the same as the 'comet' pattern in web
development: a client contacts the server, but rather than responding
quickly, the server 'files away' the connection in case there is something
to send later.  (Filing away, in my case is done by adding a reference to
the stream as a member of a 'Connection' class withing my server.
'Connections' can either be 'open' [able to send immediately] or 'buffering'
[waiting for the client to reconnect].)

I have implemented this pattern using twisted.web2 as follows:

A render method creates a stream, but 'files it away', rather than calling
stream.finish().  The render method *does* complete and return, but the
connection is thereby held open and no data is immediately sent.

Sometime later, or perhaps never, something happens on the server which
causes it to send data on the previously 'filed away' stream and calls
stream.finish().  (In my case, because this is comet, the client immediately
makes another connection to the server, which is again 'filed away'.)

I hope this doesn't muddy the issue.

Regards,

Chris,

P.S. I have heard of Nevow Athena, but I wanted something very simple.

On 05/03/2008, Drew Smathers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">drew.smathers at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On Tue, Mar 4, 2008 at 11:42 PM, David Welch &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dwelch at umail.ucsb.edu</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; Matt,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  I read that howto/servers documentation and I have set up my code into
</I>&gt;<i> &gt;  a Factory and Protocol that handles incoming connections.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Honestly, I don't think we're dealing with a design pattern issue now.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; I don't
</I>&gt;<i> &gt;  think I explained myself well enough though. When a client connects,
</I>&gt;<i> &gt;  the server may or may not being send data back right away so I need to
</I>&gt;<i> &gt;  be able to send data to that connected client on the servers terms.
</I>&gt;<i> &gt;  For example:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  Client 1 connects -- Factory instantiates Protocol class to handle
</I>&gt;<i> &gt;  communication (connection doesn't close)
</I>&gt;<i> &gt;  Client 2 connects -- Factory instantiates Protocol class to handle
</I>&gt;<i> &gt;  communication (connection doesn't close)
</I>&gt;<i> &gt;  &lt;time has passed until server decides it needs to send a plugin to one
</I>&gt;<i> &gt;  of the clients&gt;
</I>&gt;<i> &gt;  Server sends plugin to Client 1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  So how can that server send data to client 1 if client 1 hasn't caused
</I>&gt;<i> &gt;  an event (The server side causes a certain event it should send data
</I>&gt;<i> &gt;  to a selected client).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Define `event'.  Is the initial connection not an event?  If you have
</I>&gt;<i> an open connection, the client doesn't have fart back through it every
</I>&gt;<i> 5 seconds (by the semantics of most protocols) to keep it open or
</I>&gt;<i> anything.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;  I understand that if a client sends data to the
</I>&gt;<i> &gt;  server I can than write back to the client using the dataReceived
</I>&gt;<i> &gt;  function within the Protocol instantiation.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Are you sure you understand?  You're calling dataReceive to send data?
</I>&gt;<i>   If you're calling a method (that's what you meant by &quot;function within
</I>&gt;<i> the Protocol instantiation&quot;, I guess) with &quot;receive&quot; in the name, then
</I>&gt;<i> you can only be very confused.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; In this case once N number
</I>&gt;<i> &gt;  of agents have connected I want the server to push data to the clients
</I>&gt;<i> &gt;  without the Client writing to the server. Thanks again for the help.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So write back data to the client.  That's all I can say until you
</I>&gt;<i> describe what you've tried (w/ code) and why it failed (w/ a
</I>&gt;<i> stacktrace) - vs. in pretty vague terms on essay on what you want to
</I>&gt;<i> do and haven't even attempted.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> \\\\\/\&quot;/\\\\\\\\\\\
</I>&gt;<i> \\\\/ // //\/\\\\\\\
</I>&gt;<i> \\\/  \\// /\ \/\\\\
</I>&gt;<i> \\/ /\/ / /\/ /\ \\\
</I>&gt;<i> \/ / /\/ /\  /\\\ \\
</I>&gt;<i> / /\\\  /\\\ \\\\\/\
</I>&gt;<i> \/\\\\\/\\\\\/\\\\\\
</I>&gt;<i>                d.p.s
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20080305/7a8de9a8/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049465.html">[Twisted-Python] writing back through open connections
</A></li>
	<LI>Next message (by thread): <A HREF="049522.html">[Twisted-Python] writing back through open connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49466">[ date ]</a>
              <a href="thread.html#49466">[ thread ]</a>
              <a href="subject.html#49466">[ subject ]</a>
              <a href="author.html#49466">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
