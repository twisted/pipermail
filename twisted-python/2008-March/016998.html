<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferred classes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferred%20classes&In-Reply-To=35886.202.46.129.17.1204895125.squirrel%40202.46.129.82">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016993.html">
   <LINK REL="Next"  HREF="016995.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferred classes</H1>
    <B>Amaury Forgeot d'Arc</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferred%20classes&In-Reply-To=35886.202.46.129.17.1204895125.squirrel%40202.46.129.82"
       TITLE="[Twisted-Python] deferred classes">amauryfa at gmail.com
       </A><BR>
    <I>Fri Mar  7 10:10:38 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016993.html">[Twisted-Python] deferred classes
</A></li>
        <LI>Next message: <A HREF="016995.html">[Twisted-Python] trial (unit test) naming convention or obligation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16998">[ date ]</a>
              <a href="thread.html#16998">[ thread ]</a>
              <a href="subject.html#16998">[ subject ]</a>
              <a href="author.html#16998">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

On Fri, Mar 7, 2008 at 2:05 PM,  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">big_tyo at inf.its-sby.edu</A>&gt; wrote:
&gt;<i> hi can anyone explain to me how
</I>&gt;<i>  defer.deferredlist,defer.deferredqueue,defer.deferredlock,and
</I>&gt;<i>  defer.deferredsemaphore works?
</I>&gt;<i>
</I>&gt;<i>  an explanation with example will be very much help to me learning twisted
</I>
Deferreds are indeed a key feature in twisted.
First, did you read these two pages?
<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/async.html">http://twistedmatrix.com/projects/core/documentation/howto/async.html</A>
<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/defer.html">http://twistedmatrix.com/projects/core/documentation/howto/defer.html</A>

(In summary: a Deferred is a promise that some result will come. To
get the result, you attach functions to the deferred; they will be
called when the result is available.)

Then the objects you list are easy to explain:
- defer.DeferredList is a deferred, which fires when all embedded
Deferreds have been fired.
- defer.DeferredQueue is a queue whose &quot;get&quot; method returns a Deferred
which fires when data is available.
- Similarly, defer.DeferredLock and defer.DeferredSemaphore are the
usual concurrency primitives, whose &quot;acquire&quot; method returns a
Deferred which fires when the acquisition is done.

Here is an example with DeferredSemaphore and DeferredList.
IMO the beauty of twisted is that the processing of one file is
described in a linear fashion: fetchOneFile() seems to run in
parallel.

===================================================

from twisted.internet import defer, reactor
from twisted.web.client import downloadPage
import os

# list of urls to retrieve
urls = [
    '<A HREF="http://xxx',">http://xxx',</A>
    '<A HREF="http://yyy',">http://yyy',</A>
    '<A HREF="http://zzz',">http://zzz',</A>
    '<A HREF="http://ttt',">http://ttt',</A>
]

# Only 2 simultaneous downloads
semaphore = defer.DeferredSemaphore(2)

def fetchOneFile(url):
    # Process one file:
    # - wait to get a a semaphore slot
    # - fetch the url
    # - release the semaphore

    d = semaphore.acquire()

    def fetchData(_):
        print &quot;fetch&quot;, url
        return downloadPage(url, os.path.basename(url))
    d.addCallback(fetchData)

    def fetched(result):
        print &quot;fetched&quot;, url, result
    d.addBoth(fetched)

    d.addBoth(lambda _:semaphore.release())

    return d


downloads = defer.DeferredList([fetchOneFile(url) for url in urls])
def end(result):
    reactor.stop()
downloads.addBoth(end)
reactor.run()


-- 
Amaury Forgeot d'Arc


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016993.html">[Twisted-Python] deferred classes
</A></li>
	<LI>Next message: <A HREF="016995.html">[Twisted-Python] trial (unit test) naming convention or obligation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16998">[ date ]</a>
              <a href="thread.html#16998">[ thread ]</a>
              <a href="subject.html#16998">[ subject ]</a>
              <a href="author.html#16998">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
