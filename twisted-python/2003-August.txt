From Richard.Townsend at edl.uk.eds.com  Fri Aug  1 03:10:13 2003
From: Richard.Townsend at edl.uk.eds.com (Richard.Townsend at edl.uk.eds.com)
Date: Fri, 1 Aug 2003 08:10:13 +0100 
Subject: [Twisted-Python] Re: Re: PB - detecting loss of connection
Message-ID: <76ADB8C376C3D31193F50008C7E6D3B2F3E16C@EWHKA005>

> aReferenceable.broker.notifyOnDisconnect(f)

> f() will now be called on disconnect, aReferenceable the result of
> getObjectAt() or any call that returns a RemoteReference.

Thanks, Itamar - that's just what I wanted.
 -Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20030801/a880a13b/attachment.htm 

From screwtape at froup.com  Fri Aug  1 04:06:03 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Fri, 1 Aug 2003 18:06:03 +1000
Subject: [Twisted-Python] Twisted and Rendezvous
In-Reply-To: <20030730.145647.21615978.warner@lothar.com>
References: <20030730130240.GC25612@ferd2.thristian.org> <20030730.145647.21615978.warner@lothar.com>
Message-ID: <20030801080603.GA7792@ferd2.thristian.org>

On Wed, Jul 30, 2003 at 02:56:47PM -0700, Brian Warner wrote:
> screwtape at froup.com writes:
> 
> > A few weeks ago, someone on the list mentioned Rendezvous support for
> > Twisted. Curious, I picked up the Rendezvous specification documents,
> > and got to hacking.
> 
> That's cool. I'm not sure this falls into the same scope, but it occurred to
> me that it would be handy to have a DNS server that provided SRV records
> based upon registrations arriving from other server programs. If the
> application (say, an HTTP server) launched, started listening on an
> arbitrary port, then told the DNS/SRV server its service name and port
> number, the DNS server could start feeding appropriate SRV records for the
> application.

Having a nice standard structure for SRV records is the purposes of
the DNS-SD specification: http://tinyurl.com/ipj7

It turns out that a service like what you describe is going to be
quite important for anyone who wants to write software that uses
Rendezvous and doesn't require Mac OS X - as far as I can tell, only
one application at a time per host can bind to a particular port on a
multicast address, so if the OS doesn't supply an mDNS responder (or
your language doesn't have bindings for the OS's mDNS responder) then
applications will try and supply their own, and if two or more such
applications try and run simultaneously, problems will occur.

Thus some kind of server that sits on the network and offers mDNS
services to applications who otherwise can't offer them, possibly
working as a regular DNS server as well (configure it as the DNS
server for the '.local' domain to make legacy apps magically look up
multicast-DNS based host-names) would be an absolute boon.

Note that you only need a multicast DNS proxy to serve DNS records -
if another process on your host has already bound to the mDNS address
and port, you can look up multicast DNS records by sending ordinary
DNS packets to the mDNS port. In Twisted, it looks like this:

	from twisted.names import client

	resl = client.Resolver(servers=[('224.0.0.251', 5353)])
	resl.lookupAddress('grundoon.local').addCallback(processAddress)


> I'd have the application keep a TCP connection open to the DNS server, and
> if that connection went down, the SRV record would be removed. It would work
> a lot like dynamic DNS, except per-application instead of per-host.

The DNS-SD documentation mentions (in passing) various other
ways of updating DNS rather than multicast DNS - manual update,
scripts that use protocol-specific browsing to create a standard DNS
zone file, or (as you mention) RFC 2136, Dynamic DNS Update.

I had a brief, 20-second glance at the dynamic DNS RFC, and I can't
see any reason you shouldn't be able to send per-application records
to a dynamic DNS server. You'd still have hassles with cooperatively
maintaining DNS records and so forth, of course...

I like the idea of having a TCP connection alive (with keepalive
packets, I assume) to maintain one's DNS records. You should be able
to supply more than one record, of course (DNS-SD requires that you
serve up a PTR record and a TXT record along with your SRV record),
so the wire protocol might be a bit more complex.



Hmm.. how stable and extensible and reliable is twisted.names?

> just looking to plant some idea seeds..
>  -Brian

Always welcome. :)

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _    _
|
| "We've got a lot in common" "I've always thought so, too." -- M*A*S*H
|



From screwtape at froup.com  Fri Aug  1 04:20:14 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Fri, 1 Aug 2003 18:20:14 +1000
Subject: [Twisted-Python] Win32 Service
In-Reply-To: <3F28BFA5.9743.14D34878@localhost>
References: <3F28BFA5.9743.14D34878@localhost>
Message-ID: <20030801082014.GB7792@ferd2.thristian.org>

On Thu, Jul 31, 2003 at 07:05:09AM -0700, Mike Owens wrote:
> I am currently running twisted on an XP machine. What is the 
> recommended way of running twistd as a service? Or should I just 
> create a custom web script and run that as a service?

I don't believe twistd plays nicely with NT-style services at the
moment. If I had to make a Twisted-using Python script into an NT
service tomorrow, I'd be playing with py2exe:

	http://starship.python.net/crew/theller/py2exe/

Obviously, that's more for setting up your script on your server
(farm) rather than for rapid development...

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _    _
|
| Just think of this number as a sort of parrot. -- Ross Williams
|



From tv at twistedmatrix.com  Fri Aug  1 04:15:33 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Fri, 1 Aug 2003 11:15:33 +0300
Subject: [Twisted-Python] Callbacks, Looping, and Variable Binding
In-Reply-To: <20030731202024.3E44338FCB@www.fastmail.fm>
References: <20030731171328.BAF3F389C1@www.fastmail.fm> <20030731195004.GB32069@lapdog> <20030731202024.3E44338FCB@www.fastmail.fm>
Message-ID: <20030801081532.GB781@lapdog>

On Thu, Jul 31, 2003 at 02:20:24PM -0600, Justin Johnson wrote:
>      for item in list:
>          d.addCallbacks(onSuccess, log.err, callbackArgs=(item,))
>          deferreds.append(d)
> 
> and then defining onSuccess like...
> 
>     def onSuccess(results, args):
>         item = args[0]
>         d = item.doSomethingElseThatReturnsDeferred()
>         return d
> 
> Is this an acceptable way to accomplish this?  It is working in my code
> but I'd like to do things the right way.

	Yes. I'd make that prettier with

    def onSuccess(results, item):
        d = item.doSomethingElseThatReturnsDeferred()
        return d
...
    for item in list:
	d.addCallback(onSuccess, item)
	d.addErrback(log.err)
	deferreds.append(d)

> > 	Besides, you are adding the outer d to deferreds once per
> > 	iteration. That's broken.
> I'm not sure what you mean here.  I was adding my deferred to a list and
> it seemed to be doing what I wanted (at least I think it was).

	Your original code had

>     d = doSomethingThatReturnsDeferred()
>
>     for item in list:
>         d.addCallbacks(onSuccess, log.err)
>         deferreds.append(d)

	Which ends up adding the _same_ d len(list) times to deferreds.

-- 
:(){ :|:&};:



From smurf at smurf.noris.de  Fri Aug  1 06:36:23 2003
From: smurf at smurf.noris.de (Matthias Urlichs)
Date: Fri, 01 Aug 2003 12:36:23 +0200
Subject: [Twisted-Python] Considering Twisted for OfflineIMAP
References: <20030726134815.GA26482@complete.org> <20030726163502.GA26873@lapdog>
Message-ID: <pan.2003.08.01.10.36.21.695032@smurf.noris.de>

Hi, Tommi Virtanen wrote:

> counting the currently open IMAP connections and when the number
> 	is below the limit, taking more work from a queue

Or you could use a semaphore.

Feel free to add this code to twisted.internet.deferred.
The interface should be identical to python.threading.Semaphore,
except that I was too lazy to add any verbose statements...

class Semaphore(object):
    def __init__(self, value=1, verbose=None):
        self.queue=[]
        self.value=value

    def acquire(self):
        d=Deferred()
        if self.value:
            self.value -= 1
            d.callback(False)
        else:
            self.queue.append(d)
        return d

    def release(self):
        if self.queue:
            self.queue.pop(0).callback(True)
        else:
            self.value += 1

The callback's parameter answers the "did I have to wait for a slot"
question, in case the caller needs that question answered. (Most don't.)

-- 
Matthias Urlichs   |   {M:U} IT Design @ m-u-it.de   |  smurf at smurf.noris.de
Disclaimer: The quote was selected randomly. Really. | http://smurf.noris.de
-- 
s = (char*)(long)retval;                /* ouch */
             -- Larry Wall in doio.c from the perl source code




From justinjohnson at fastmail.fm  Fri Aug  1 07:57:36 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Fri, 01 Aug 2003 05:57:36 -0600
Subject: [Twisted-Python] Callbacks, Looping, and Variable Binding
In-Reply-To: <20030801081532.GB781@lapdog>
References: <20030731171328.BAF3F389C1@www.fastmail.fm> <20030731195004.GB32069@lapdog> <20030731202024.3E44338FCB@www.fastmail.fm> <20030801081532.GB781@lapdog>
Message-ID: <20030801115737.043D337B8A@www.fastmail.fm>

> 	Yes. I'd make that prettier with
> 
>     def onSuccess(results, item):
>         d = item.doSomethingElseThatReturnsDeferred()
>         return d
> ...
>     for item in list:
> 	d.addCallback(onSuccess, item)
> 	d.addErrback(log.err)
> 	deferreds.append(d)

Yes, that looks much cleaner.

> > > 	Besides, you are adding the outer d to deferreds once per
> > > 	iteration. That's broken.
> > I'm not sure what you mean here.  I was adding my deferred to a list and
> > it seemed to be doing what I wanted (at least I think it was).
> 
> 	Your original code had
> 
> >     d = doSomethingThatReturnsDeferred()
> >
> >     for item in list:
> >         d.addCallbacks(onSuccess, log.err)
> >         deferreds.append(d)
> 
> 	Which ends up adding the _same_ d len(list) times to deferreds.

Ahhh.... I see.  That was a result of me rewriting my code for the post
to this list, and not putting things in their original place.  Thanks for
your help.




From mporter at despammed.com  Fri Aug  1 08:05:04 2003
From: mporter at despammed.com (Michael Porter)
Date: Fri, 1 Aug 2003 13:05:04 +0100
Subject: [Twisted-Python] twisted and wxPython 2.4.1.2
References: <76ADB8C376C3D31193F50008C7E6D3B2F3E16C@EWHKA005>
Message-ID: <002e01c35825$24e3f7e0$0201a8c0@dan>

Re: Re: PB - detecting loss of connectionHas anyone got twisted running with
wxPython 2.4.1.2?

If I run the example wxdemo.py with Twisted 1.0.6 and wxPython 2.4.1.2 on
Windows I get the following error:

Traceback (most recent call last):
  File "C:\dev\controlled\mpjuke\unused\wxdemo.py", line 65, in ?
    demo()
  File "C:\dev\controlled\mpjuke\unused\wxdemo.py", line 61, in demo
    reactor.run()
  File "C:\dev\controlled\mpjuke\pymods\twisted\internet\default.py", line
121, in run
    self.startRunning(installSignalHandlers=installSignalHandlers)
  File "C:\dev\controlled\mpjuke\pymods\twisted\internet\default.py", line
115, in startRunning
    self._handleSignals()
  File "C:\dev\controlled\mpjuke\pymods\twisted\internet\default.py", line
87, in _handleSignals
    signal.signal(signal.SIGINT, self.sigInt)
SystemError: error return without exception set

If I change the demo to run with reactor.run(installSignalHandlers=0) it
works fine, but I'd prefer to have this enabled.

The problem occurs with Python 2.2 or 2.3 with this version of wxPython but
it didn't occur with wxPython 2.3.2.1.

Thanks,

Mike.




From justinjohnson at fastmail.fm  Fri Aug  1 08:01:28 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Fri, 01 Aug 2003 06:01:28 -0600
Subject: [Twisted-Python] Win32 Service
In-Reply-To: ARRAY(0xa11a878)
References: ARRAY(0xa085dd8)
Message-ID: <20030801120128.0FA6C381A7@www.fastmail.fm>

I'm not using twistd, but I did get my xmlrpc service written in twisted
to run as a service using the attached file.

-Justin

On Fri, 1 Aug 2003 18:20:14 +1000, screwtape at froup.com said:
> On Thu, Jul 31, 2003 at 07:05:09AM -0700, Mike Owens wrote:
> > I am currently running twisted on an XP machine. What is the 
> > recommended way of running twistd as a service? Or should I just 
> > create a custom web script and run that as a service?
> 
> I don't believe twistd plays nicely with NT-style services at the
> moment. If I had to make a Twisted-using Python script into an NT
> service tomorrow, I'd be playing with py2exe:
> 
> 	http://starship.python.net/crew/theller/py2exe/
> 
> Obviously, that's more for setting up your script on your server
> (farm) rather than for rapid development...
> 
> -- 
>  ___________ ___________________________________
> | Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _
>   _    _
> |
> | Just think of this number as a sort of parrot. -- Ross Williams
> |
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winsvc.py
Type: application/unknown
Size: 1550 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030801/955a4adc/attachment.bin 

From itamar at itamarst.org  Fri Aug  1 12:58:49 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 1 Aug 2003 12:58:49 -0400
Subject: [Twisted-Python] twisted and wxPython 2.4.1.2
In-Reply-To: <002e01c35825$24e3f7e0$0201a8c0@dan>
References: <76ADB8C376C3D31193F50008C7E6D3B2F3E16C@EWHKA005>
	<002e01c35825$24e3f7e0$0201a8c0@dan>
Message-ID: <20030801125849.2a9237d6.itamar@itamarst.org>

On Fri, 1 Aug 2003 13:05:04 +0100
"Michael Porter" <mporter at despammed.com> wrote:

> If I change the demo to run with reactor.run(installSignalHandlers=0)
> it works fine, but I'd prefer to have this enabled.
> 
> The problem occurs with Python 2.2 or 2.3 with this version of
> wxPython but it didn't occur with wxPython 2.3.2.1.

As far as we can tell this is a wxPython bug - someone opened a report
in the wxPython SF bug tracker, see if it's been resolved.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
http://www.zoteca.com -- Python & Twisted consulting



From rdrb at 123.cl  Fri Aug  1 13:14:03 2003
From: rdrb at 123.cl (RITA Y/O RODRIGO DIAZ Y/O BENENSON)
Date: Fri, 01 Aug 2003 13:14:03 -0400
Subject: [Twisted-Python] kill a twisted server on Windows
Message-ID: <39f8538a5b.38a5b39f85@noborrar.co.cl>

Hi,

How do I write at basch command on
Window equivalent to the *nix shell
command 

kill `cat twistd.pid` ?


Thanks.
RodrigoB.




From Rudy.Schockaert at pandora.be  Fri Aug  1 13:34:33 2003
From: Rudy.Schockaert at pandora.be (Rudy Schockaert)
Date: Fri, 01 Aug 2003 19:34:33 +0200
Subject: [Twisted-Python] Win32 Service
In-Reply-To: <20030801120128.0FA6C381A7@www.fastmail.fm>
References: ARRAY(0xa085dd8) <20030801120128.0FA6C381A7@www.fastmail.fm>
Message-ID: <3F2AA4A9.20506@pandora.be>

Justin Johnson wrote:

>I'm not using twistd, but I did get my xmlrpc service written in twisted
>to run as a service using the attached file.
>
>-Justin
>  
>
This is just what I needed. Thanks a lot.




From mporter at despammed.com  Fri Aug  1 14:49:04 2003
From: mporter at despammed.com (Michael Porter)
Date: Fri, 1 Aug 2003 19:49:04 +0100
Subject: [Twisted-Python] twisted and wxPython 2.4.1.2
Message-ID: <008501c3585d$94f3bbf0$0201a8c0@dan>

From: "Itamar Shtull-Trauring" <itamar at itamarst.org>


> On Fri, 1 Aug 2003 13:05:04 +0100
> "Michael Porter" <mporter at despammed.com> wrote:
>
> > If I change the demo to run with reactor.run(installSignalHandlers=0)
> > it works fine, but I'd prefer to have this enabled.
> >
> > The problem occurs with Python 2.2 or 2.3 with this version of
> > wxPython but it didn't occur with wxPython 2.3.2.1.
>
> As far as we can tell this is a wxPython bug - someone opened a report
> in the wxPython SF bug tracker, see if it's been resolved.


Ok, seems this isn't a twisted problem. As far as I can figure out from the
bug trackers (wxWindows ID 746099 and Python ID 762198) this has now been
fixed although it doesn't seem to have made it into the latest wxPython
binary and I can't find a way of finding out which bug IDs are fixed in a
release.

Hopefully it'll make its way through soon.

Thanks,

Mike.




From micahlists at comcast.net  Fri Aug  1 19:56:07 2003
From: micahlists at comcast.net (Micah Yoder)
Date: Fri, 1 Aug 2003 16:56:07 -0700
Subject: [Twisted-Python] Docs...
Message-ID: <200308011656.07132.micahlists@comcast.net>

Hi,

I know it has been mentioned before that more/better docs would be nice.

Can I suggest a doc like "twisted.web for PHP developers" with lots of 
examples including stuff like sessions and database access?

I would actually be willing to help with such a manual, but I'm still trying 
to understand much of this stuff myself. :)  I am currently working on my 
first twisted.web app.  I'm getting there, but the docs still leave some 
questions.  If a few others would find this useful and have some of the 
knowledge needed, perhaps we could collaborate on it.

As for the examples on the site, how about sending them with a MIME type of 
text/plain?  That would allow viewing them in the browser insted of 
downloading them, which would be nice.

Also, where are the apps?  Searching Freshmeat for "twisted" doesn't really 
come up with any Twisted apps, unless WebTK counts.  For example, a Twisted 
based bulletin board or blog.  Something like that would help a lot!

Thanks,
Micah

-- 
Yoder Internet Development
Honest and Affordable Web Development and Linux consulting
http://yoderdev.com





From warner at lothar.com  Sat Aug  2 02:37:41 2003
From: warner at lothar.com (Brian Warner)
Date: Fri, 01 Aug 2003 23:37:41 -0700 (PDT)
Subject: [Twisted-Python] StepReactor?
References: <3F28BCCD.90303@tekNico.net> <20030731071406.GC30331@frobozz>
 <3F28D112.8020301@tekNico.net>
Message-ID: <20030801.233741.59470359.warner@lothar.com>

Nicola Larosa <nico at tekNico.net> writes:
> 
> Come to think of it, is there a way in Twisted to schedule an event at an
> absolute time, instead of at a relative one?

Sure.

 reactor.callLater(desiredTime - time.time(), func)

:-).

The reactor stores DelayedCalls with absolute times instead of relative ones
internally. The callLater API accepts relative times because that's
generally the most useful to work with.

 -Brian



From warner at lothar.com  Sat Aug  2 04:09:50 2003
From: warner at lothar.com (Brian Warner)
Date: Sat, 02 Aug 2003 01:09:50 -0700 (PDT)
Subject: [Twisted-Python] Remote PB calls in
 ApplicationService.stopService
References: <20030731210210.GR282@perpetual.moxn.net>
Message-ID: <20030802.010950.23653851.warner@lothar.com>

Alex Levy <mesozoic at polynode.com> writes:
> 
>    def stopService(self):
>      somePBRemoteCall(i_am_dying_event)
>      app.ApplicationService.stopService(self)
> 
> On the sending side, this results in 'Connection failed'. On the receiving
> side, the following traceback appears. Could somebody more familiar with the
> internals of Perspective Broker explain what's going wrong, or how I might
> change my approach?

There are a couple of problems interacting here. One is that you're sending
out data as the application is shutting down, which means that many of the
usual assumptions (about the request eventually being sent over the wire,
about a response eventually coming back) are not guaranteed to remain true.

A second is that, currently, all PB calls require acknowledgement, even if
you expect the answer to be a simple 'None' (like the None that's returned
implicitly when you fall off the end of a Python function). There are hooks
in place to allow a call to tell the receiver that no answer is expected (or
will be accepted), allowing that end to skip the response phase, but those
hooks are disabled because there is no way to the caller to know whether
you're going to add a callback to the Deferred or not (especially because
that callback could be added *after* the request has been sent). So for now,
the far end always acknowleges every single PB call.

Or at least it tries to. I suspect you're seeing the following sequence of
events:

 reactor.stop()
  'shutdown' system event trigger is fired, callbacks are run
    app._beforeShutDown is run as a 'before' trigger on the 'shutdown' event
     stopService() is run on all Services
      callRemote(aaaaaarrgh)
       remote_aaaaaarrgh is serialized and queued, maybe sent, maybe not
    app._afterShutDown is run as the 'after' trigger, does app.save()
 reactor exits
 program exits
 all sockets are closed

The serialized remote call may or may not get sent: if the transport's
.write method tries to write some data immediately, then it will probably
get out. But the connection will be dropped soon afterwards, probably before
the far end has completed sending an answer.

Given that PB is about acknowleged method invocations, it will probably be
cleaner to try to delay shutdown briefly while you get your "I am dying"
messages through. Fortunately, both .stopService and the before-shutdown
event trigger that drives it have a useful property: you can return a
Deferred from them and the rest of the shutdown process will be stalled
until that Deferred is fired.

So just do this:

   def stopService(self):
     d = somePBRemoteCall(i_am_dying_event)
     app.ApplicationService.stopService(self)
     return d

(or do the superclass call first, it doesn't matter)

This will send out your shutdown messages but then return to the main
reactor loop, waiting for the messages to be acknowleged before proceeding
with the rest of shutdown (app.save() and exiting the reactor).

BTW: I think the exception you're seeing is a bug, and results from the
connectionLost messages being invoked twice on the same Broker. I think this
is an edge case that can only happen when a sender does something weird.

hope that helps,
 -Brian



From sflist at ihonk.com  Sat Aug  2 06:37:00 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Sat, 2 Aug 2003 03:37:00 -0700
Subject: [Twisted-Python] Event Driven Programming 101 question
Message-ID: <200308020337.00916.sflist@ihonk.com>

Hi all,

I've got a few questions about Deferreds. I understand the concept better, but 
I need a little help at the moment. It's apparent to me that a lot's going on 
behind the scenes between Deferreds and the Reactor, and that 
twisted.enterprise orchestrates things in a way I don't yet understand.

I'm looking at this from the perspective of my little XML-RPC server. A client 
hits a XML-RPC function, and by the time that function returns its value, it 
needs all its Deferreds to have generated their results. That leads to this 
question:

When is a Deferred guaranteed to have a result?

One answer could be, "When its callback gets called." And that would be true. 
But what if the function that gets the Deferred needs the result before it 
can move on? It seems like it'll get the Deferred and then go on its merry 
way, whether the Deferred has a result or not. And that's confusing to me, 
because I'm left wondering what happens if my database takes a long time to 
respond:

def xmlrpc_foo(self):
	result = dbpool.runQuery("select * from gigantic_table") # adbapi
	return result

In this case, what's it gonna be? A Deferred that's evaluated as None because 
Postgres is still churning, or is Twisted only going to let the code continue 
once the Deferred has a result?

Sorry if it seems I'm not making sense... Event-driven programming is new to 
me, but I'm a motivated learner. :-) (And if anybody knows of a good general 
guide to this paradigm, I'm all ears.)

Thanks for your help!

Steve



From m at moshez.org  Sat Aug  2 06:55:27 2003
From: m at moshez.org (Moshe Zadka)
Date: 2 Aug 2003 10:55:27 -0000
Subject: [Twisted-Python] Remote PB calls in
 ApplicationService.stopService
In-Reply-To: <20030802.010950.23653851.warner@lothar.com>
References: <20030802.010950.23653851.warner@lothar.com>, <20030731210210.GR282@perpetual.moxn.net>
Message-ID: <20030802105527.19416.qmail@green.zadka.com>

On Sat, 02 Aug 2003, Brian Warner <warner at lothar.com> wrote:

> Given that PB is about acknowleged method invocations, it will probably be
> cleaner to try to delay shutdown briefly while you get your "I am dying"
> messages through. Fortunately, both .stopService and the before-shutdown
> event trigger that drives it have a useful property: you can return a
> Deferred from them and the rest of the shutdown process will be stalled
> until that Deferred is fired.

BTW, currently that feature is not in the new Application code I'm working
on. I could add it, but when we discussed it I didn't know of anybody
using that feature. It seems a bit too dangerous to allow a buggy remote
side to delay our shutdown by a long amount of time [depending on PB
timeouts]. I humbly suggest that an architecture which depends on being
able to send "one last message" is probably flawed.

-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From m at moshez.org  Sat Aug  2 07:01:46 2003
From: m at moshez.org (Moshe Zadka)
Date: 2 Aug 2003 11:01:46 -0000
Subject: [Twisted-Python] Event Driven Programming 101 question
In-Reply-To: <200308020337.00916.sflist@ihonk.com>
References: <200308020337.00916.sflist@ihonk.com>
Message-ID: <20030802110146.19493.qmail@green.zadka.com>

On Sat, 2 Aug 2003, Steve Freitas <sflist at ihonk.com> wrote:

> It's apparent to me that a lot's going on 
> behind the scenes between Deferreds and the Reactor

Nope. There's very little magic going on.
 
> When is a Deferred guaranteed to have a result?
> 
> One answer could be, "When its callback gets called." And that would be true. 

Yep.

> But what if the function that gets the Deferred needs the result before it 
> can move on?

It's out of luck.

> def xmlrpc_foo(self):
> 	result = dbpool.runQuery("select * from gigantic_table") # adbapi
> 	return result

This "just" works. When xmlrpc_foo returns a result, the Twisted XMLRPC
machinery checks if it is a deferred. If it is, it won't send a result
back to the client until the deferred is triggered.

Here is the code in question, just to see how little magic there is:

'''
            request.setHeader("content-type", "text/xml")
            defer.maybeDeferred(function, *args).addErrback(
                self._ebRender
            ).addCallback(
                self._cbRender, request
            )
'''

[_ebRender and _cbRender do the work of actually formatting the response]
-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From nico at tekNico.net  Sat Aug  2 03:09:05 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Sat, 02 Aug 2003 09:09:05 +0200
Subject: [Twisted-Python] StepReactor?
In-Reply-To: <20030801.233741.59470359.warner@lothar.com>
References: <3F28BCCD.90303@tekNico.net> <20030731071406.GC30331@frobozz> <3F28D112.8020301@tekNico.net> <20030801.233741.59470359.warner@lothar.com>
Message-ID: <3F2B6391.5010102@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

>> Come to think of it, is there a way in Twisted to schedule an event at an
>> absolute time, instead of at a relative one?

> Sure.
>
>  reactor.callLater(desiredTime - time.time(), func)
>
> :-).

Of course. :^)


> The reactor stores DelayedCalls with absolute times instead of relative ones
> internally.

That's good to know.


> The callLater API accepts relative times because that's
> generally the most useful to work with.

Very true, and arguably there's no point in coming up with some convention
to specify absolute time, since the above syntax is clear enough.


- --
"I'm a Python fanatic these days, I find that I'm able to program about
three times faster than I could in Java, and I was able to program
in Java about three times faster than I could in C."  Andy Hertzfeld

Nicola Larosa - nico at tekNico.net

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/K2OPXv0hgDImBm4RAnytAKCR5qWWWY74+t1liIW/3t9//3aZAgCaA4N6
zT/0F9U83zVGYzb09YwqUKQ=
=VD4g
-----END PGP SIGNATURE-----





From tv at twistedmatrix.com  Sat Aug  2 10:22:16 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 2 Aug 2003 17:22:16 +0300
Subject: [Twisted-Python] [PATCH] SMTP cleanup, do not hide error messages
Message-ID: <20030802142216.GA25941@lapdog>

	Hi. Here's a patch that does two things to twisted.protocol.smtp:

	1) use sendLine instead of self.transport.write, for prettiness
	   and also to make debug printing in sendLine be actually useful.

	2) use the code and error message from SMTPBadSender and
	   SMTPBadRcpt exceptions trapped, not a hardcoded "550 I'm
	   not telling you what want wrong." Helps debugging scalemail
	   a _lot_.

	You have at most a few days to protest, or I will
	commit. Explicitly saying "looks good" appreciated.

Index: twisted/protocols/smtp.py
===================================================================
RCS file: /cvs/Twisted/twisted/protocols/smtp.py,v
retrieving revision 1.69
diff -u -u -r1.69 smtp.py
--- twisted/protocols/smtp.py	23 Jul 2003 23:10:54 -0000	1.69
+++ twisted/protocols/smtp.py	2 Aug 2003 14:46:49 -0000
@@ -444,9 +444,9 @@
         lines = message.splitlines()
         lastline = lines[-1:]
         for line in lines[:-1]:
-            self.transport.write('%3.3d-%s\r\n' % (code, line))
-        self.transport.write('%3.3d %s\r\n' % (code,
-                                               lastline and lastline[0] or ''))
+            self.sendLine('%3.3d-%s' % (code, line))
+        self.sendLine('%3.3d %s' % (code,
+                                    lastline and lastline[0] or ''))
 
     def lineReceived(self, line):
         self.resetTimeout()
@@ -558,7 +558,9 @@
 
     def _ebFromValidate(self, failure):
         if failure.check(SMTPBadSender):
-            self.sendCode(550, 'Cannot receive for specified address')
+            self.sendCode(failure.value.code,
+                          'Cannot receive for specified address %s: %s'
+                          % (repr(str(failure.value.addr)), failure.value.resp))
         elif failure.check(SMTPServerError):
             self.sendCode(failure.value.code, failure.value.resp)
         else:
@@ -632,7 +634,7 @@
 
     def _ebToValidate(self, failure):
         if failure.check(SMTPBadRcpt):
-            self.sendCode(550, 'Cannot receive for specified address')
+            self.sendCode(failure.value.code, failure.value.resp)
         elif failure.check(SMTPServerError):
             self.sendCode(failure.value.code, failure.value.resp)
         else:

-- 
:(){ :|:&};:



From tv at twistedmatrix.com  Sat Aug  2 10:27:50 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 2 Aug 2003 17:27:50 +0300
Subject: [Twisted-Python] [PATCH] make syslog work
Message-ID: <20030802142750.GB25941@lapdog>

	Hi. Here's a patch that does a few things to twistd and
	twisted.python.syslog.

	1) twistd: allow using -n and --syslog at the same time,
	   by reordering the elif's.

	2) rewrite twisted.python.syslog to save it from bitrot,
	   I don't think it could have worked at all. To avoid
	   code duplication, refactor twisted.python.log a bit;
	   we don't want twistedy time stamps in syslog, but we
	   want rest of the nice things.

	You have at most a few days to protest, or I will
	commit. Explicitly saying "looks good" appreciated.

Index: twisted/scripts/twistd.py
===================================================================
RCS file: /cvs/Twisted/twisted/scripts/twistd.py,v
retrieving revision 1.53
diff -u -u -r1.53 twistd.py
--- twisted/scripts/twistd.py	19 Jul 2003 21:36:49 -0000	1.53
+++ twisted/scripts/twistd.py	2 Aug 2003 14:46:28 -0000
@@ -282,11 +282,11 @@
             print 'daemons cannot log to stdout'
             os._exit(1)
         logFile = sys.stdout
-    elif config['nodaemon'] and not config['logfile']:
-        logFile = sys.stdout
     elif config['syslog']:
         from twisted.python import syslog
         syslog.startLogging(config['prefix'])
+    elif config['nodaemon'] and not config['logfile']:
+        logFile = sys.stdout
     else:
         logPath = os.path.abspath(config['logfile'] or 'twistd.log')
         logFile = logfile.LogFile(os.path.basename(logPath), os.path.dirname(logPath))
Index: twisted/python/log.py
===================================================================
RCS file: /cvs/Twisted/twisted/python/log.py,v
retrieving revision 1.50
diff -u -u -r1.50 log.py
--- twisted/python/log.py	17 Jul 2003 09:11:33 -0000	1.50
+++ twisted/python/log.py	2 Aug 2003 14:46:29 -0000
@@ -235,6 +235,12 @@
         self.write = f.write
         self.flush = f.flush
 
+    def prefix(self, eventDict):
+        y,mon,d,h,min, iigg,nnoo,rree,daylight = time.localtime(eventDict['time'])
+        return ("%0.4d/%0.2d/%0.2d %0.2d:%0.2d %s [%s] " %
+                (y, mon, d, h, min, time.tzname[daylight],
+                 eventDict['system']))
+
     def _emit(self, eventDict):
         edm = eventDict['message']
         if not edm:
@@ -244,10 +250,10 @@
                 text = eventDict['format'] % eventDict
         else:
             text = ' '.join(map(str, edm))
+        prefix = self.prefix(eventDict)
         y,mon,d,h,min, iigg,nnoo,rree,daylight = time.localtime(eventDict['time'])
-        self.write("%0.4d/%0.2d/%0.2d %0.2d:%0.2d %s [%s] %s\n" %
-                   (y, mon, d, h, min, time.tzname[daylight],
-                    eventDict['system'], text.replace("\n","\n\t")))
+        self.write("%s%s\n" %
+                   (self.prefix(eventDict), text.replace("\n","\n\t")))
         self.flush()                    # hoorj!
 
     def start(self):
@@ -306,8 +312,14 @@
     _oldshowwarning = None
 
 
-def startLogging(file, setStdout=1):
-    """Initialize logging to a specified file. If setStdout is true 
+def startLogging(file, *a, **kw):
+    """Initialize logging to a specified file.
+    """
+    flo = FileLogObserver(file)
+    startLoggingToObserver(flo, *a, **kw)
+
+def startLoggingToObserver(obs, setStdout=1):
+    """Initialize logging to a specified observer. If setStdout is true 
        (defaults to yes), also redirect sys.stdout and sys.stderr 
        to the specified file.
     """
@@ -318,8 +330,7 @@
     if defaultObserver:
         defaultObserver.stop()
         defaultObserver = None
-    flo = FileLogObserver(file)
-    flo.start()
+    obs.start()
     msg("Log opened.")
     if setStdout:
         sys.stdout = logfile
Index: twisted/python/syslog.py
===================================================================
RCS file: /cvs/Twisted/twisted/python/syslog.py,v
retrieving revision 1.1
diff -u -u -r1.1 syslog.py
--- twisted/python/syslog.py	23 Nov 2002 19:54:22 -0000	1.1
+++ twisted/python/syslog.py	2 Aug 2003 14:46:29 -0000
@@ -18,33 +18,25 @@
 import sys
 import log
 
-class SyslogLogger:
-
+class SyslogLogger(log.FileLogObserver):
     def __init__(self, prefix):
-        self.prefix = prefix
+        syslog.openlog(prefix)
+
+    def prefix(self, eventDict):
+        return ("[%s] " % eventDict['system'])
 
     def write(self, data):
         if not data or data=='\n':
             return
-        logger = log.logOwner.owner()
-        if logger:
-            data = logger.log(data)
         data = data.split('\n')
         if not data[-1]:
             data.pop()
         for line in data:
-            syslog.syslog("[%s] %s" % (self.prefix, line))
-
-    def writelines(self, lines):
-        for line in lines:
-            self.write(line)
-
-    def close(self):
-        pass
+            syslog.syslog(line)
 
     def flush(self):
         pass
 
 
-def startLogging(prefix='Twisted'):
-    sys.stdout = sys.stderr = log.logfile = SyslogLogger(prefix)
+def startLogging(prefix='Twisted', setStdout=1):
+    log.startLoggingToObserver(SyslogLogger(prefix), setStdout=setStdout)

-- 
:(){ :|:&};:



From itamar at itamarst.org  Sat Aug  2 11:07:15 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sat, 2 Aug 2003 11:07:15 -0400
Subject: [Twisted-Python] [PATCH] make syslog work
In-Reply-To: <20030802142750.GB25941@lapdog>
References: <20030802142750.GB25941@lapdog>
Message-ID: <20030802110715.0541319d.itamar@itamarst.org>

On Sat, 2 Aug 2003 17:27:50 +0300
Tommi Virtanen <tv at twistedmatrix.com> wrote:

> 	2) rewrite twisted.python.syslog to save it from bitrot,
> 	   I don't think it could have worked at all. To avoid
> 	   code duplication, refactor twisted.python.log a bit;
> 	   we don't want twistedy time stamps in syslog, but we
> 	   want rest of the nice things.

Given that we now have a better logging API, syslog should indeed be
changed, but slightly differently. Instead of making syslog look like a
file, why not use the logging API directly? That is to say, add a
SyslogObserver, and then
twistef.python.log.addObserver(SyslogObserver().notify). notify() will
be called with the low-level dict of the log messages, which would give
you a lot more flexibility.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
http://www.zoteca.com -- Python & Twisted consulting



From uwe at oss4u.com  Sat Aug  2 11:35:55 2003
From: uwe at oss4u.com (Uwe C. Schroeder)
Date: Sat, 2 Aug 2003 08:35:55 -0700
Subject: [Twisted-Python] Event Driven Programming 101 question
In-Reply-To: <200308020337.00916.sflist@ihonk.com>
References: <200308020337.00916.sflist@ihonk.com>
Message-ID: <200308020835.55670.uwe@oss4u.com>

On Saturday 02 August 2003 03:37 am, Steve Freitas wrote:
> Hi all,
>
> I've got a few questions about Deferreds. I understand the concept better,
> but I need a little help at the moment. It's apparent to me that a lot's
> going on behind the scenes between Deferreds and the Reactor, and that
> twisted.enterprise orchestrates things in a way I don't yet understand.
>
> I'm looking at this from the perspective of my little XML-RPC server. A
> client hits a XML-RPC function, and by the time that function returns its
> value, it needs all its Deferreds to have generated their results. That
> leads to this question:

You write a chain of results: for example
[ abstract code ]

remotecall(mydatabase, getresultset1).addCallback(result1OK)

def result1OK(result):
	remotecall(get result based on result, result).addCallback(allOK)

def allOK(result):
    this is guaranteed to have the result


>
> When is a Deferred guaranteed to have a result?
>
> One answer could be, "When its callback gets called." And that would be
> true. But what if the function that gets the Deferred needs the result
> before it can move on? It seems like it'll get the Deferred and then go on
> its merry way, whether the Deferred has a result or not. And that's
> confusing to me, because I'm left wondering what happens if my database
> takes a long time to respond:
>
> def xmlrpc_foo(self):
> 	result = dbpool.runQuery("select * from gigantic_table") # adbapi
> 	return result
>
> In this case, what's it gonna be? A Deferred that's evaluated as None
> because Postgres is still churning, or is Twisted only going to let the
> code continue once the Deferred has a result?
>
> Sorry if it seems I'm not making sense... Event-driven programming is new
> to me, but I'm a motivated learner. :-) (And if anybody knows of a good
> general guide to this paradigm, I'm all ears.)
>
> Thanks for your help!
>
> Steve
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-- 
	UC

--
Open Source Solutions 4U, LLC	2570 Fleetwood Drive
Phone:  +1 650 872 2425		San Bruno, CA 94066
Cell:   +1 650 302 2405		United States
Fax:    +1 650 872 2417




From glyph at twistedmatrix.com  Sat Aug  2 13:09:33 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 2 Aug 2003 12:09:33 -0500
Subject: [Twisted-Python] Remote PB calls in ApplicationService.stopService
In-Reply-To: <20030802105527.19416.qmail@green.zadka.com>
Message-ID: <1694803C-C50C-11D7-8F2D-000393C9700E@twistedmatrix.com>

On Saturday, August 2, 2003, at 05:55 AM, Moshe Zadka wrote:

> BTW, currently that feature is not in the new Application code I'm 
> working
> on. I could add it, but when we discussed it I didn't know of anybody
> using that feature. It seems a bit too dangerous to allow a buggy 
> remote
> side to delay our shutdown by a long amount of time [depending on PB
> timeouts]. I humbly suggest that an architecture which depends on being
> able to send "one last message" is probably flawed.

There are a couple of different use-cases here that need to be 
separated; for example, shutting down an active thread pool requires 
waiting, otherwise you will deadlock - and yes, this is due to the fact 
that OS threads are a basically flawed concept, but we've been over 
that one before :).

Sometimes it's also useful to be able to send out a descriptive message 
before dying, like, "The service is going down!  Please hurry up."  I 
admit that the deferred-from-stopService is probably not the best way 
to handle this, though; there should be a different canonical way to 
shut down a Twisted server that allows those sorts of messages to be 
sent.

However, as long as the deferred in the latter case always comes with 
the timeout, I think the use cases are about equivalent.  Thoughts?




From tv at twistedmatrix.com  Sat Aug  2 13:03:23 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 2 Aug 2003 20:03:23 +0300
Subject: [Twisted-Python] [PATCH] make syslog work
In-Reply-To: <20030802142750.GB25941@lapdog>
References: <20030802142750.GB25941@lapdog>
Message-ID: <20030802170323.GB27956@lapdog>

On Sat, Aug 02, 2003 at 05:27:50PM +0300, Tommi Virtanen wrote:
> 	Hi. Here's a patch that does a few things to twistd and
> 	twisted.python.syslog.

	This is now issue163.

-- 
:(){ :|:&};:



From tv at twistedmatrix.com  Sat Aug  2 12:58:20 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 2 Aug 2003 19:58:20 +0300
Subject: [Twisted-Python] [PATCH] SMTP cleanup, do not hide error messages
In-Reply-To: <20030802142216.GA25941@lapdog>
References: <20030802142216.GA25941@lapdog>
Message-ID: <20030802165820.GA27956@lapdog>

On Sat, Aug 02, 2003 at 05:22:16PM +0300, Tommi Virtanen wrote:
> 	Hi. Here's a patch that does two things to twisted.protocol.smtp:

	This is now issue162.

-- 
:(){ :|:&};:



From glyph at twistedmatrix.com  Sat Aug  2 20:16:58 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 2 Aug 2003 19:16:58 -0500
Subject: [Twisted-Python] [PATCH] SMTP cleanup, do not hide error messages
In-Reply-To: <20030802165820.GA27956@lapdog>
Message-ID: <CC2B7633-C547-11D7-8F2D-000393C9700E@twistedmatrix.com>

On Saturday, August 2, 2003, at 11:58 AM, Tommi Virtanen wrote:

> 	This is now issue162.

Thanks for putting these in the bugtracker, Tommi.




From glyph at twistedmatrix.com  Sat Aug  2 20:27:57 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 2 Aug 2003 19:27:57 -0500
Subject: [Twisted-Python] Roundup Fever
Message-ID: <54F9F1DC-C549-11D7-8F2D-000393C9700E@twistedmatrix.com>

Dear Twisted Team (and assorted onlookers),

I am trying to create a semblance of a project plan by assembling a 
sort of paper-mache out of the things that have been entered in the 
bugtracker.

If you have an account on the bugtracker, you may find that you have 
issues assigned to you.  Random issues.  Issues that you have no idea 
how to resolve or even understand.  Don't worry, I don't seriously 
expect you to take care of these yourself - however, we have a lot of 
issues in the tracker that nobody is responsible for.  I wish to 
distribute the responsibility of distributing responsibility by 
creating a game of hot potato with unwanted issues.

In other words, if you find yourself assigned an issue that you are 
clueless about, please find someone who has the requisite knowledge 
*and enough free time* to take care of the problem, then assign that 
issue to that person.

Although no bonus points will be given, feel free to use visual aids or 
props in order to convince your favorite Twisted team member to 
volunteer.  I am told that broken beer bottles, two-by-fours with nails 
in the end, and tire irons are popular with the kids these days.

In case you were wondering about *my* free time, I have already bitten 
off as many issues as I can possibly chew, and then some.  Also, I have 
secured for myself one of each of the recommended visual aids: No 
further convincing is necessary.

Ever grateful for your continued patronage,

	-glyph




From micahlists at comcast.net  Sun Aug  3 02:38:06 2003
From: micahlists at comcast.net (Micah Yoder)
Date: Sat, 2 Aug 2003 23:38:06 -0700
Subject: [Twisted-Python] Getting the hang of twisted.web
Message-ID: <200308022338.06935.micahlists@comcast.net>

Ok, I have the following in web.py:

***
from twisted.web import resource

class Simple(resource.Resource):
    isLeaf = True
    def render(self, request):
        return "<html>Hello, world!</html>"

class Hello(resource.Resource):

    def __init__(self):
      resource.Resource.__init__(self)
      self.putChild('simple', Simple())

    def getChild(self, name, request):
        if name == '':
            return self
        return Resource.getChild(
            self, name, request)

    def render(self, request):
      s = request.getSession()
      if not hasattr(s, 'var'):
        s.var = 1
      else:
        s.var = s.var * 2
      return """<html>
      Hello, world! I am located at %r and am at %d. My args are %s. Site %s.
    </html>"""               % (request.prepath, s.var, repr(request.args), 
repr(request.site))

***

Then I:

$ mktap web --class=web.Hello
$ twistd -f web.tap

Seems to work fine.  I can go to http://localhost:8080/ to get the Hello() 
class and http://localhost:8080/simple to get the Simple() class.

Questions:

1. Is there anything I'm doing obviously wrong or a "non-Twisted" way, like 
with the session variable or the child stuff?

2. What about persistant HTTP sessions?  I thought one of the points of this 
mktap stuff was to allow persistance in protocols.  I do:
$ killall twistd
$ twistd -f web-shutdown.tap
and go to the index page again and the counter gets re-started at 1.  Can't 
they be made to persist?

3. Finally, some advice on how to structure my "real" project would be 
appreciated.  I have a program that will store and index a large amount of 
data (several megabytes), and intend to have resources that search and 
display it.  The original importing of the data takes several seconds now, 
and will take probably a minute or more by the time I'm done.  The data is 
being stored in a Python class, with methods to set it up and search it, 
along with direct public instance-variable access to some structures.

The question is, where should this class object be stored in a .tap-ified 
program?  Right now I have the class instance as a global variable in the 
module that my related resource objects are in, but that doesn't seem ideal.  
I thought about storing it in the Site() object, but there doesn't seem to be 
a way to access the Site object from a resource request.  request.site only 
returns None ... is ths a bug?

(Yes, I've been doing this application so far with just a reactor and a Site() 
object.  But it seems prudent to try to .tap-ify it.)

Thanks!
Micah

-- 
Yoder Internet Development
Honest and Affordable Web Development and Linux consulting
http://yoderdev.com





From screwtape at froup.com  Sun Aug  3 09:05:48 2003
From: screwtape at froup.com (Tim Allen)
Date: Sun, 3 Aug 2003 23:05:48 +1000
Subject: [Twisted-Python] Surprises in twisted.web.woven
Message-ID: <3372A4FF-C5B3-11D7-B0D7-003065D61A3E@froup.com>

I had a little play with Woven tonight, and I'm pleased to report that 
I'm (slowly) getting my head around it quite satisfyingly. However, I 
did come across some things which surprised me - I'm not going to call 
them bugs, because I don't understand Woven well enough.

Firstly, I'm rendering HTML, so my HTML template file starts off with 
an HTML doctype. Woven appears to eat this doctype, which is rather a 
shame - including the proper doctype makes Internet Explorer 6 behave 
much more like Mozilla, which in turn makes writing webpages much less 
stressful. I do wind up with the standard XML header at the top of the 
output, but as I'm not trying to output XML, I'm afraid this might 
confuse something.

Secondly, I was surprised by the behaviour of view templates. See the 
sample rpy code below:

	from twisted.web.woven import page, view

	class TestContent(view.View):
	    template = """<ul model="sampleList" view="List">
	            		<li pattern="listItem" model="." view="Text"/>
			            <li pattern="emptyList"><i>empty</i></li>
	    		      </ul>"""

	class TestPage(page.Page):
     	template = """<html><body>
                 		<h1 model="title" view="Text"/>
						<div view="content"/>
	            	  </body></html>"""

	    def wvfactory_content(self, request, node, model): return 
TestContent(model)

	    def wmfactory_title(self, request): return "Test page"

	    def wmfactory_sampleList(self, request): return ["Hello", "world!"]

	resource = TestPage()

What I expected was a list that looked like:

	* Hello
	* world!

What I got was a list that looked like:

	* <__builtin__.TestPage instance at 0x554f08>
     * empty

If I wrap the <ul> element in the template in a <div> (or anything 
else), then the output is correct - but I get the dummy <div> in the 
output.

...it seems that view.View ignores model= and view= attributes on 
top-level elements in templates, and I have no idea why.

Thirdly, looking again at the above sample code - the TestPage template 
contains a reference to a model named 'title', and Woven looks for the 
model 'title' in the TestPage instance. Fair enough. The TestContent 
template contains a reference to a model named 'sampleList', and Woven 
looks for the model 'sampleList'... not in the TestContent instance as 
I would expect, but in the TestPage instance again.

Finally, if I have a template that looks like this:

	<p>Have a look at
	<a href="cat1.png">these</a>
	<a href="cat2.png">three</a>
	<a href="cat3.png">cats</a>.</p>

then the output HTML looks like:

	<p>Have a look at <a href="cat1.png">these</a><a
	href="cat2.png">three</a><a href="cat3.png">cats</a>.</p>

...spaces aren't preserved. I expect an XML processor is allowed to 
collapse whitespace, but not remove it entirely.




From mesozoic at polynode.com  Sun Aug  3 11:37:27 2003
From: mesozoic at polynode.com (Alex Levy)
Date: Sun, 3 Aug 2003 15:37:27 +0000
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <3372A4FF-C5B3-11D7-B0D7-003065D61A3E@froup.com>
References: <3372A4FF-C5B3-11D7-B0D7-003065D61A3E@froup.com>
Message-ID: <20030803153727.GS282@perpetual.moxn.net>

On Sun, Aug 03, 2003 at 11:05:48PM +1000, Tim Allen wrote:
> I had a little play with Woven tonight, and I'm pleased to report that 
> I'm (slowly) getting my head around it quite satisfyingly. However, I 
> did come across some things which surprised me - I'm not going to call 
> them bugs, because I don't understand Woven well enough.

Don't you know anything about software development? These are FEATURES :)

You've hit a problem that I encountered as well; the root element in a Woven
template doesn't behave the same way as its child elements. What you want is
this:

  class TestContent(view.View):
    template = """
    <div><ul model="sampleList" view="List">...</ul></div>
    """

I believe this is one of those "just accept it" situations. Fortunately,
wrapping your work in <div></div>'s isn't that bad; they don't affect layout
(unless your CSS puts padding on every div, which is nuts), and HTML
pretty-printing has been added to CVS in time for the next release.

O[Bn to your models question. Views must be given a model to operate on; they
do not (as far as I know) intrinsically contain models of their own. When
your <div view="content"/> element is given no explicit model in the
template, it is given the entire Page as its model. (That means the 'model'
object being passed to wvfactory_content is actually the Page instance.)
This works because it looks for the sampleList submodel on whatever model
it's been given.

Unless you have a good reason for passing the entire Page model to your
views (and you might), another way to do this is:

  class TestContent(view.View):
    template = """
    <div><ul model="." view="List">...</ul></div>
    """
    
  class TestPage(page.Page):
    template = """
    <html>...<div model="sampleList" view="content"/>...</html>
    """

> Finally, if I have a template that looks like this:
> 
>     <p>Have a look at
>     <a href="cat1.png">these</a>
>     <a href="cat2.png">three</a>
>     <a href="cat3.png">cats</a>.</p>
> 
> then the output HTML looks like:
> 
>     <p>Have a look at <a href="cat1.png">these</a><a
>     href="cat2.png">three</a><a href="cat3.png">cats</a>.</p>

This is another issue that I've wrangled with for some time. Feel free to
make a lot of noise and hope somebody fixes it; I believe the problem lies
in the XML parser itself. As Wayne so aptly put it, "We fear change."

The two quick fixes I've employed to get around this until a better solution
presents itself are either &nbsp; entities after every anchor, or using CSS
to add spacing. [The second option is, in my opinion, much cleaner.]

  in my template:
  <a class="navbar" href="1">Home</a>
  <a class="navbar" href="2">Stuff</a>
  ...
  
  in my CSS:
  a.navbar { padding: 0px 5px 0px 5px; }

I'm not entirely happy with this, but it makes my pages look nice until any
issues with the XML parser get hammered out.

As far as chomping off docstrings, that's something you might want to add to
the tracker <http://www.twistedmatrix.com/bugs>. I see it happening on my
site as well, and Woven probably shouldn't be doing that.

-- 
Alex Levy
WWW: http://mesozoic.geecs.org
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_



From edmundd at eSentire.com  Sun Aug  3 14:12:20 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sun, 3 Aug 2003 14:12:20 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
Message-ID: <Pine.BSO.4.44.0308031404030.7592-100000@cyclops4.esentire.com>

Hi all!

I am new to the list, so please excuse me if this has been dealt with
already. I did try to search for an answer in the archives and was unable
to find an answer.

I am trying to use PB with SSL. I have managed to get it to work (or, at
least it looks like it is working). I will get some patches submitted
later this week if desired. The problem I ran across was that I had to
force PB to change its logic as to who talks first.

Normally: client connects to PB server, PB server initiates communication
back to client over TCP connection

However, when using SSL, if PB initiates communication, then the whole
process essentially hangs. The SSL handshaking between client and server
doe snot occur. If I hack the code so that PB expects the client to
initiate the communication, and hack the client to start first (basically
send a "hello"), then it works.

It seems the SSL connection does not perform the handshaking/negotiation
until the client tries to send a byte. Is this correct? Is this the way it
is suppose to work? Is there a way to force the SSL handshaking to occur
immediately?  Note: If I use OpenSSL's s_client or s_server, I can get the
communication to go. That is, the handshaking is independent of who starts
talking first.

Thanks!
Ed






From itamar at itamarst.org  Sun Aug  3 14:18:55 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 3 Aug 2003 14:18:55 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308031404030.7592-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308031404030.7592-100000@cyclops4.esentire.com>
Message-ID: <20030803141855.02f679b2.itamar@itamarst.org>

On Sun, 3 Aug 2003 14:12:20 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> It seems the SSL connection does not perform the
> handshaking/negotiation until the client tries to send a byte. Is this
> correct? Is this the way it is suppose to work? Is there a way to
> force the SSL handshaking to occur immediately?  Note: If I use
> OpenSSL's s_client or s_server, I can get the communication to go.
> That is, the handshaking is independent of who starts talking first.

There is a bug in current version, which is fixed in CVS. Even better,
1.0.7 has new connection API which is much cleaner and makes SSL support
more like other protocols (i.e. you use reactor.connectSSL), and also PB
in 1.0.7 will let you use new cred, for those of you who want to do
that.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
http://www.zoteca.com -- Python & Twisted consulting



From dp at twistedmatrix.com  Sun Aug  3 16:20:57 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Sun, 3 Aug 2003 13:20:57 -0700
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <20030803153727.GS282@perpetual.moxn.net>
References: <3372A4FF-C5B3-11D7-B0D7-003065D61A3E@froup.com> <20030803153727.GS282@perpetual.moxn.net>
Message-ID: <FDF96B60-C5EF-11D7-AD2C-000A95864FC4@twistedmatrix.com>

Alex channelled me; he wrote the same response I would have. The 
problem with directives not being handled on the outermost node 
returned from a widget I consider a bug; it might be easy to fix (now; 
it wasn't easy the way woven was structured before), if I find some 
time to look into it.

On Sunday, August 3, 2003, at 8:37 AM, Alex Levy wrote:

> As far as chomping off docstrings, that's something you might want to 
> add to
> the tracker <http://www.twistedmatrix.com/bugs>. I see it happening on 
> my
> site as well, and Woven probably shouldn't be doing that.

I think you mean doctype, and this is a microdom bug, not a woven bug.

dp




From lists at webcrunchers.com  Sun Aug  3 19:01:30 2003
From: lists at webcrunchers.com (John D.)
Date: Sun, 3 Aug 2003 16:01:30 -0700
Subject: [Twisted-Python] Mac OS-9 support?   Does it exist?
Message-ID: <v03110700bb53434790e6@[192.168.0.2]>

I just joined the mailing list.   I would have first read the archive if It was available,  thus the need to ask this to the list.

I want to use the latest Twisted 1.0.6 with my latest Python 2.3 on my Mac OS-9.   I tried to install it on the Mac ver of python,  but I'm getting all kinds of error when I drag the "setup.py" into the Mac python IDE.

I looked at the requirement of Twisted,  and it mentions we also need Encryption,  and some other utilities,  but there was nothing on the web site that says any of this works on Mac OS-9.

I looked at the source code of the "setup.py",  and I want to call your attention to this line in that module...

# Apple distributes a nasty version of Python 2.2 w/ all release builds of
# OS X 10.2 and OS X Server 10.2
BROKEN_CONFIG = '2.2 (#1, 07/14/02, 23:25:09) \n[GCC Apple cpp-precomp 6.14]'
if sys.platform == 'darwin' and sys.version == BROKEN_CONFIG:
    # change this to 1 if you have some need to compile
    # with -flat_namespace as opposed to -bundle_loader
    FLAT_NAMESPACE = 0
    BROKEN_ARCH = '-arch i386'
    BROKEN_NAMESPACE = '-flat_namespace -undefined_suppress'
    import distutils.sysconfig
    distutils.sysconfig.get_config_vars()
    x = distutils.sysconfig._config_vars['LDSHARED']
    y = x.replace(BROKEN_ARCH, '')
    if not FLAT_NAMESPACE:
        e = os.path.realpath(sys.executable)
        y = y.replace(BROKEN_NAMESPACE, '-bundle_loader ' + e)
    if y != x:
        print "Fixing some of Apple's compiler flag mistakes..."
        distutils.sysconfig._config_vars['LDSHARED'] = y

     <---- rest deleted ---->

As you can see,  it appears to only support Mac OS-9 and not OS-10,  is that true?

We have a host of applications that already use Twisted,  and we want to port these applications over to the Mac OS-9,  because there is still a wide base of users (at least in this field).

Does anyone know if any effort is underway to support Mac OS-9 if the current one doesn't?

John





From glyph at twistedmatrix.com  Sun Aug  3 23:51:38 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 3 Aug 2003 22:51:38 -0500
Subject: [Twisted-Python] Mac OS-9 support?   Does it exist?
In-Reply-To: <v03110700bb53434790e6@[192.168.0.2]>
Message-ID: <F34A2876-C62E-11D7-8F2D-000393C9700E@twistedmatrix.com>

On Sunday, August 3, 2003, at 06:01 PM, John D. wrote:

> As you can see,  it appears to only support Mac OS-9 and not OS-10,  
> is that true?

I think you mean "OS-10 and not OS-9".  That would be correct.

> Does anyone know if any effort is underway to support Mac OS-9 if the 
> current one doesn't?

 From what I know of Mac OS 9, it does not support a host of basic 
features that Twisted needs in order to function.  It may be possible 
to port, and I would love to increase Twisted's portability if you are 
interested in contributing patches to that effect.

However, I don't believe any core Twisted developers have access to or 
interest in Mac OS 9.




From itamar at itamarst.org  Mon Aug  4 00:01:52 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 4 Aug 2003 00:01:52 -0400
Subject: [Twisted-Python] Mac OS-9 support?   Does it exist?
In-Reply-To: <F34A2876-C62E-11D7-8F2D-000393C9700E@twistedmatrix.com>
References: <v03110700bb53434790e6@[192.168.0.2]>
	<F34A2876-C62E-11D7-8F2D-000393C9700E@twistedmatrix.com>
Message-ID: <20030804000152.1483d0c0.itamar@itamarst.org>

On Sun, 3 Aug 2003 22:51:38 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> However, I don't believe any core Twisted developers have access to or
> 
> interest in Mac OS 9.

Well, I'd do it for money (assuming Bob or Donovan say it's possible) :)

-- 
Itamar Shtull-Trauring    http://itamarst.org/
http://www.zoteca.com -- Python & Twisted consulting



From bob at redivi.com  Mon Aug  4 03:02:49 2003
From: bob at redivi.com (Bob Ippolito)
Date: Mon, 4 Aug 2003 03:02:49 -0400
Subject: [Twisted-Python] Mac OS-9 support?   Does it exist?
In-Reply-To: <20030804000152.1483d0c0.itamar@itamarst.org>
Message-ID: <A86BBC4A-C649-11D7-BBEC-000A95686CD8@redivi.com>

On Monday, Aug 4, 2003, at 00:01 America/New_York, Itamar 
Shtull-Trauring wrote:

> On Sun, 3 Aug 2003 22:51:38 -0500
> Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:
>
>> However, I don't believe any core Twisted developers have access to or
>>
>> interest in Mac OS 9.
>
> Well, I'd do it for money (assuming Bob or Donovan say it's possible) 
> :)

It's possible.  I have access to OS9, but I'm not interested *IN THE 
LEAST* in ever using OS9.

-bob




From nico at tekNico.net  Mon Aug  4 05:06:57 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Mon, 04 Aug 2003 11:06:57 +0200
Subject: [Twisted-Python] Goin' with the Flow
Message-ID: <3F2E2231.8030708@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

A couple of comments about Flow, as seen in 1.0.7alpha3.


Example 16 (next to last) in the howto does not work, looks like flow.py
misses the line:

from twisted.flow.threads import *

(Added to the tracker as bug #168.)


Also, the howto mentions ThreadedIterator, that is nowhere to be found.

(Added to the tracker as bug #169.)


Lastly, if Twisted makes one's head spin, Flow makes the whole body enter
the Sufi dances. :^)

- --
"I'm a Python fanatic these days, I find that I'm able to program about
three times faster than I could in Java, and I was able to program
in Java about three times faster than I could in C."  Andy Hertzfeld

Nicola Larosa - nico at tekNico.net


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/LiIvXv0hgDImBm4RAvdNAJ4ii2xebUI128IlOhqDWAJG+lcurACfY3Th
PUD66uYkwXQ0T9sK2tFqGWg=
=B5+C
-----END PGP SIGNATURE-----





From screwtape at froup.com  Mon Aug  4 05:47:13 2003
From: screwtape at froup.com (Tim Allen)
Date: Mon, 4 Aug 2003 19:47:13 +1000
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <20030803153727.GS282@perpetual.moxn.net>
Message-ID: <A00950EC-C660-11D7-B0D7-003065D61A3E@froup.com>

On Monday, Aug 4, 2003, at 01:37 Australia/Sydney, Alex Levy wrote:

> On Sun, Aug 03, 2003 at 11:05:48PM +1000, Tim Allen wrote:
>> I had a little play with Woven tonight, and I'm pleased to report that
>> I'm (slowly) getting my head around it quite satisfyingly. However, I
>> did come across some things which surprised me - I'm not going to call
>> them bugs, because I don't understand Woven well enough.
>
> Don't you know anything about software development? These are FEATURES 
> :)

Oh, right, my bad. :)

> You've hit a problem that I encountered as well; the root element in a 
> Woven
> template doesn't behave the same way as its child elements. What you 
> want is
> this:
>
>   class TestContent(view.View):
>     template = """
>     <div><ul model="sampleList" view="List">...</ul></div>
>     """
>
> I believe this is one of those "just accept it" situations. 
> Fortunately,
> wrapping your work in <div></div>'s isn't that bad; they don't affect 
> layout
> (unless your CSS puts padding on every div, which is nuts), and HTML
> pretty-printing has been added to CVS in time for the next release.

Donovan Preston writes that he considers it a bug, I have faith he'll 
get around to it eventually, that's good enough for me. (Last time I 
wrote, I asked for HTML pretty-printing, and lo and behold, here it is. 
:)

> O[Bn to your models question. Views must be given a model to operate 
> on; they
> do not (as far as I know) intrinsically contain models of their own.

Ahh, that makes sense.

I was being misled by the special case of Page - Page inherits from 
View, but uses itself as the default model. Apparently other things 
that inherit from View have different behaviour.

<snip>

>> Finally, if I have a template that looks like this:
>>
>>     <p>Have a look at
>>     <a href="cat1.png">these</a>
>>     <a href="cat2.png">three</a>
>>     <a href="cat3.png">cats</a>.</p>
>>
>> then the output HTML looks like:
>>
>>     <p>Have a look at <a href="cat1.png">these</a><a
>>     href="cat2.png">three</a><a href="cat3.png">cats</a>.</p>
>
> This is another issue that I've wrangled with for some time. Feel free 
> to
> make a lot of noise and hope somebody fixes it; I believe the problem 
> lies
> in the XML parser itself. As Wayne so aptly put it, "We fear change."

Hmm. How sad.

I guess I'll have a look at the XML parser, if I have time.

> The two quick fixes I've employed to get around this until a better 
> solution
> presents itself are either &nbsp; entities after every anchor, or 
> using CSS
> to add spacing. [The second option is, in my opinion, much cleaner.]

Cleaner, yes, but not much. :(

Also, I'm imagining this same problem could crop up among hetereogenous 
collections of tags, in which case CSS isn't quite as useful.

> I'm not entirely happy with this, but it makes my pages look nice 
> until any
> issues with the XML parser get hammered out.

As an interim step, sure.

> As far as chomping off docstrings, that's something you might want to 
> add to
> the tracker <http://www.twistedmatrix.com/bugs>. I see it happening on 
> my
> site as well, and Woven probably shouldn't be doing that.

Well, I was going to try fixing this little issue so I spent a while 
tracing code and learning the structure of view.View and so forth, 
until I discovered the following snippet in 
microdom.Document.writexml():

         if self.doctype:
             stream.write("<!DOCTYPE "+self.doctype+">" + newl)

And lo and behold, ever since I discovered that, it's been working fine.

Maybe I should subscribe to the CVS commits list as well before I start 
poking around in Twisted again. :)




From screwtape at froup.com  Mon Aug  4 08:13:26 2003
From: screwtape at froup.com (Tim Allen)
Date: Mon, 4 Aug 2003 22:13:26 +1000
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <20030803153727.GS282@perpetual.moxn.net>
Message-ID: <0D06F9E5-C675-11D7-B0D7-003065D61A3E@froup.com>

On Monday, Aug 4, 2003, at 01:37 Australia/Sydney, Alex Levy wrote:
> On Sun, Aug 03, 2003 at 11:05:48PM +1000, Tim Allen wrote:
>> Finally, if I have a template that looks like this:
>>
>>     <p>Have a look at
>>     <a href="cat1.png">these</a>
>>     <a href="cat2.png">three</a>
>>     <a href="cat3.png">cats</a>.</p>
>>
>> then the output HTML looks like:
>>
>>     <p>Have a look at <a href="cat1.png">these</a><a
>>     href="cat2.png">three</a><a href="cat3.png">cats</a>.</p>
>
> This is another issue that I've wrangled with for some time. Feel free 
> to
> make a lot of noise and hope somebody fixes it; I believe the problem 
> lies
> in the XML parser itself. As Wayne so aptly put it, "We fear change."

As it turns out, I suspect this is false.

twisted.web.microdom.MicroDOMParser.shouldPreserveSpace() currently 
looks like:

     def shouldPreserveSpace(self):
         for edx in xrange(len(self.elementstack)):
             el = self.elementstack[-edx]
             if el.tagName == 'pre' or el.getAttribute("xml:space", '') 
== 'preserve':
                 return 1
         return 0

I dare say that a simple modification of this method would be enough, 
without delving into the depths of the XML parser (which doesn't 
discard pure-whitespace text elements at all).

Off the top of my head, I can think of three whitespace-handling modes:

  * Preserve all whitespace (as used in the HTML <pre> tag and elements 
with xml:space='preserve'.)
  * Collapse redundant whitespace (if not string.strip(): return ' ') 
which most closely matches how HTML user-agents handle whitespace.
  * Strip whitespace (run .strip() over all text nodes - I believe this 
most closely matches how XML processors handle whitespace).

Is there any reason why white-space preserving should not always be on?




From fog at initd.org  Mon Aug  4 10:26:44 2003
From: fog at initd.org (Federico Di Gregorio)
Date: 04 Aug 2003 16:26:44 +0200
Subject: [Twisted-Python] ccc camp and holiday
Message-ID: <1060007204.1233.42.camel@localhost>

i will be at the ccc camp and after that in amsterdam and paris. i don't
know how much it is common on this list but on others vacancies
announces targeted at meeting to consume alchoolic substances and
exchanging gpg keys are welcome. if you don't like, just don't answer,
else mail me privately :)

federico

-- 
Federico Di Gregorio
Debian GNU/Linux Developer                                fog at debian.org
INIT.D Developer                                           fog at initd.org
             Quis custodiet ipsos custodes? -- Juvenal, Satires, VI, 347
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa parte del messaggio =?ISO-8859-1?Q?=E8?= firmata
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030804/b7caf6de/attachment.pgp 

From dizzyd at jabber.org  Mon Aug  4 10:32:44 2003
From: dizzyd at jabber.org (Dave Smith)
Date: Mon, 4 Aug 2003 08:32:44 -0600
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <0D06F9E5-C675-11D7-B0D7-003065D61A3E@froup.com>
Message-ID: <82A3328F-C688-11D7-84FC-00039386381C@jabber.org>

On Monday, Aug 4, 2003, at 06:13 America/Denver, Tim Allen wrote:

> Is there any reason why white-space preserving should not always be on?

I concur with you -- it should always be on. Of note, so does the XML 
spec, section 2.10:

http://www.w3.org/TR/REC-xml#sec-white-space

Hope that helps. ;)

Diz




From Rudy.Schockaert at pandora.be  Mon Aug  4 11:07:02 2003
From: Rudy.Schockaert at pandora.be (Rudy Schockaert)
Date: Mon, 04 Aug 2003 17:07:02 +0200
Subject: [Twisted-Python] Help needed with SMTP service
Message-ID: <3F2E7696.9020106@pandora.be>

Hi,

The more I try to grasp how the twisted.mail package works, the more I 
get confused. I sure must learn a lot more about the internals of twisted.

What I want to do looks very simple, but somehow I can't find the 
correct the way.
I want to create a service that accepts messages, and for each message 
checks if the recipients exist in a dict. If the recipient exists, the 
message should be attached to a new message with 
table[originalRecipient] as the new recipient.

Can someone point me in the right direction? I don't ask for a complete 
solution, just for some guidelines.

TIA,

Rudy




From khowe at perfnet.ca  Mon Aug  4 11:48:16 2003
From: khowe at perfnet.ca (Kevin Howe)
Date: Mon, 4 Aug 2003 11:48:16 -0400
Subject: [Twisted-Python] Help needed with SMTP service
Message-ID: <000701c35a9f$d5a81c10$1a00000a@KHOWE>

> Hi,
>
> The more I try to grasp how the twisted.mail package works, the more I
> get confused. I sure must learn a lot more about the internals of twisted.
>
> What I want to do looks very simple, but somehow I can't find the
> correct the way.
> I want to create a service that accepts messages, and for each message
> checks if the recipients exist in a dict. If the recipient exists, the
> message should be attached to a new message with
> table[originalRecipient] as the new recipient.
>
> Can someone point me in the right direction? I don't ask for a complete
> solution, just for some guidelines.
>
> TIA,
>
> Rudy

This might help, it's an example of a very basic SMTP server:

http://twistedmatrix.com/pipermail/twisted-python/2003-June/004618.html






From glyph at twistedmatrix.com  Mon Aug  4 13:28:44 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 4 Aug 2003 12:28:44 -0500
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <0D06F9E5-C675-11D7-B0D7-003065D61A3E@froup.com>
Message-ID: <19524A43-C6A1-11D7-8F2D-000393C9700E@twistedmatrix.com>

On Monday, August 4, 2003, at 07:13 AM, Tim Allen wrote:

> Is there any reason why white-space preserving should not always be on?

Believe it or not, it's a bottleneck.

In order to preserve whitespace, you have to create a bunch of extra 
Node and str objects, which consume a not-inconsiderable set of 
resources for, let's say, a directory full of reasonably sized Woven 
templates.

This cost is exacerbated by the fact that woven copies and inspects the 
entire tree of DOM objects on every page render.

Last I profiled this was many months ago, however; I was seeing serious 
performance problems with Woven which have since been optimized in 
other ways.  I'd be interested in hearing your results if you try it 
otherwise.




From Martin.Moellenbeck at t-online.de  Mon Aug  4 13:49:25 2003
From: Martin.Moellenbeck at t-online.de (=?iso-8859-1?Q?Martin_M=F6llenbeck?=)
Date: Mon, 4 Aug 2003 19:49:25 +0200
Subject: [Twisted-Python] t.w.w.view.View override getTemplate
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAARFFe7Wq86Uqt5quoDxSVd8KAAAAQAAAAsRxHAQ0AnUSUbWyFqc962QEAAAAA@t-online.de>

Hi,

I want to generate the template by myself and override the method
View.getTemplate,
but it seen not work.

Can Anybody help me?

Martin M?llenbeck




From Martin.Moellenbeck at t-online.de  Mon Aug  4 14:04:36 2003
From: Martin.Moellenbeck at t-online.de (=?iso-8859-1?Q?Martin_M=F6llenbeck?=)
Date: Mon, 4 Aug 2003 20:04:36 +0200
Subject: AW: [Twisted-Python] t.w.w.view.View override getTemplate
In-Reply-To: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAARFFe7Wq86Uqt5quoDxSVd8KAAAAQAAAAsRxHAQ0AnUSUbWyFqc962QEAAAAA@t-online.de>
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAARFFe7Wq86Uqt5quoDxSVd8KAAAAQAAAAb9AT0a7950ybtStkMvn5RAEAAAAA@t-online.de>

Hi,

it will work if i override the lookupTemplate method.

Martin

> -----Urspr?ngliche Nachricht-----
> Von: twisted-python-admin at twistedmatrix.com 
> [mailto:twisted-python-admin at twistedmatrix.com] Im Auftrag 
> von Martin M?llenbeck
> Gesendet: Montag, 4. August 2003 19:49
> An: TwistedMatrix
> Betreff: [Twisted-Python] t.w.w.view.View override getTemplate
> 
> 
> Hi,
> 
> I want to generate the template by myself and override the 
> method View.getTemplate, but it seen not work.
> 
> Can Anybody help me?
> 
> Martin M?llenbeck
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com 
> http://twistedmatrix.com/cgi-> bin/mailman/listinfo/twisted-python
> 




From pje at telecommunity.com  Mon Aug  4 14:14:51 2003
From: pje at telecommunity.com (Phillip J. Eby)
Date: Mon, 04 Aug 2003 14:14:51 -0400
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <19524A43-C6A1-11D7-8F2D-000393C9700E@twistedmatrix.com>
References: <0D06F9E5-C675-11D7-B0D7-003065D61A3E@froup.com>
Message-ID: <5.1.1.6.0.20030804141006.0314ba20@telecommunity.com>

At 12:28 PM 8/4/03 -0500, Glyph Lefkowitz wrote:

>On Monday, August 4, 2003, at 07:13 AM, Tim Allen wrote:
>
>>Is there any reason why white-space preserving should not always be on?
>
>Believe it or not, it's a bottleneck.
>
>In order to preserve whitespace, you have to create a bunch of extra Node 
>and str objects, which consume a not-inconsiderable set of resources for, 
>let's say, a directory full of reasonably sized Woven templates.
>
>This cost is exacerbated by the fact that woven copies and inspects the 
>entire tree of DOM objects on every page render.

You might be interested in the technique I use for 
peak.web.templates.  First, my DOMlet objects aren't even as sophisticated 
as Twisted's microdom; they are just objects that cwrite unicode 
streams.  Second, each node has a 'staticText' attribute that can be either 
a unicode value or None.  So, parent nodes can glom together adjacent nodes 
with staticText.  Then, if that node only has static content, it defines 
its own staticText attribute, so it can be glommed together with its peers, 
by its parent.  The net result is that a template, as a whole, consists of 
dynamic nodes occasionally interrupted by a block of static text.




From bob at redivi.com  Mon Aug  4 14:41:16 2003
From: bob at redivi.com (Bob Ippolito)
Date: Mon, 4 Aug 2003 14:41:16 -0400
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <5.1.1.6.0.20030804141006.0314ba20@telecommunity.com>
Message-ID: <3B6CD87A-C6AB-11D7-8933-000A95686CD8@redivi.com>

On Monday, Aug 4, 2003, at 14:14 America/New_York, Phillip J. Eby wrote:

> At 12:28 PM 8/4/03 -0500, Glyph Lefkowitz wrote:
>
>> On Monday, August 4, 2003, at 07:13 AM, Tim Allen wrote:
>>
>>> Is there any reason why white-space preserving should not always be 
>>> on?
>>
>> Believe it or not, it's a bottleneck.
>>
>> In order to preserve whitespace, you have to create a bunch of extra 
>> Node and str objects, which consume a not-inconsiderable set of 
>> resources for, let's say, a directory full of reasonably sized Woven 
>> templates.
>>
>> This cost is exacerbated by the fact that woven copies and inspects 
>> the entire tree of DOM objects on every page render.
>
> You might be interested in the technique I use for peak.web.templates. 
>  First, my DOMlet objects aren't even as sophisticated as Twisted's 
> microdom; they are just objects that cwrite unicode streams.  Second, 
> each node has a 'staticText' attribute that can be either a unicode 
> value or None.  So, parent nodes can glom together adjacent nodes with 
> staticText.  Then, if that node only has static content, it defines 
> its own staticText attribute, so it can be glommed together with its 
> peers, by its parent.  The net result is that a template, as a whole, 
> consists of dynamic nodes occasionally interrupted by a block of 
> static text.

That's pretty much what donovan and I were doing with STAN back at 
pycon dc, but I don't think either of us tried very hard to actually do 
anything much with it after the fact.  It was a kind of "optimizing 
compiler" for templates.

-bob




From edmundd at eSentire.com  Mon Aug  4 16:30:01 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Mon, 4 Aug 2003 16:30:01 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
Message-ID: <Pine.BSO.4.44.0308041627560.1514-100000@cyclops4.esentire.com>

Greetings!

Grabbed a copy of 1.0.7alpha2. Tried out a simple echo server using
"getObjectAtSSL", and it seems to work. Looking over the docs and
API, I cannot seem to find anyplace that would allow the specification
of client certificates. Is this supported (or planned to be supported)?

Regards,
Ed




From itamar at itamarst.org  Mon Aug  4 16:44:23 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 4 Aug 2003 16:44:23 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308041627560.1514-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308041627560.1514-100000@cyclops4.esentire.com>
Message-ID: <20030804164423.7159e71a.itamar@itamarst.org>

On Mon, 4 Aug 2003 16:30:01 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> Grabbed a copy of 1.0.7alpha2. Tried out a simple echo server using
> "getObjectAtSSL", and it seems to work. Looking over the docs and
> API, I cannot seem to find anyplace that would allow the specification
> of client certificates. Is this supported (or planned to be
> supported)?

1. Use CVS, or the upcoming alpha, which has better SSL API, as soon as
you can.

2. Yes, you can specify client certificate by making a custom context
factory. See the example context factories in twisted.internet.ssl and
read the pyOpenSSL docs for the Context object.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Mon Aug  4 17:02:42 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Mon, 4 Aug 2003 17:02:42 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804164423.7159e71a.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>

Greetings!

I see the custom context factory on the server side. What I don't see
is the corresponding pieces on the client side.

(dig, dig, dig)

Aha! Digging into the library, I see getObjectAtSSL does take a context
(this is not documented on the web site documentation -> Aside: is it
possible to add a version number to the web site documentation so that it
is possible to know _which_ version of Twisted it is referring to?).
I believe that the order of arguements has been switched from previous
versions (hard to tell, I have such a hacked up PB now that it would take
a bit of time to go digging, but I believe the context was before the
timeout previously as I based my hacked version on the 1.0.5 code).

Thanks!
Ed

On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 16:30:01 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > Grabbed a copy of 1.0.7alpha2. Tried out a simple echo server using
> > "getObjectAtSSL", and it seems to work. Looking over the docs and
> > API, I cannot seem to find anyplace that would allow the specification
> > of client certificates. Is this supported (or planned to be
> > supported)?
>
> 1. Use CVS, or the upcoming alpha, which has better SSL API, as soon as
> you can.
>
> 2. Yes, you can specify client certificate by making a custom context
> factory. See the example context factories in twisted.internet.ssl and
> read the pyOpenSSL docs for the Context object.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From dizzyd at jabber.org  Mon Aug  4 17:04:42 2003
From: dizzyd at jabber.org (Dave Smith)
Date: Mon, 4 Aug 2003 15:04:42 -0600
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <19524A43-C6A1-11D7-8F2D-000393C9700E@twistedmatrix.com>
Message-ID: <447EFE45-C6BF-11D7-8494-00039386381C@jabber.org>

On Monday, Aug 4, 2003, at 11:28 America/Denver, Glyph Lefkowitz wrote:

>
> On Monday, August 4, 2003, at 07:13 AM, Tim Allen wrote:
>
>> Is there any reason why white-space preserving should not always be 
>> on?
>
> Believe it or not, it's a bottleneck.
>
> In order to preserve whitespace, you have to create a bunch of extra 
> Node and str objects, which consume a not-inconsiderable set of 
> resources for, let's say, a directory full of reasonably sized Woven 
> templates.

This "bottleneck" is highly dependent on your DOM _implementation_. 
Many DOMs normalize adjacent sections of text/CData to avoid this exact 
issue. It should be a relatively simple fix to the MicroDOMParser to 
avoid extra nodes on adjacent CData sections.

<shameless-plug>You could always look at xish.domish.Element.addContent 
as an example. ;) </shameless-plug>

Diz




From itamar at itamarst.org  Mon Aug  4 17:21:32 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 4 Aug 2003 17:21:32 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>
References: <20030804164423.7159e71a.itamar@itamarst.org>
	<Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>
Message-ID: <20030804172132.20a3167c.itamar@itamarst.org>

On Mon, 4 Aug 2003 17:02:42 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> a bit of time to go digging, but I believe the context was before the
> timeout previously as I based my hacked version on the 1.0.5 code).

As of 1.0.7 you shouldn't need to do this. If you *do* end up hacking PB
please do tell us so we can fix it so it's not necessary. What are you
using PB for, by the way?

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Mon Aug  4 17:34:06 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Mon, 4 Aug 2003 17:34:06 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804172132.20a3167c.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308041730340.1514-100000@cyclops4.esentire.com>

I'm trying Twisted out as a framework to provide distributed monitoring of
computer systems. Twisted is looking good overall, but there are a number
of components I was using with Erlang that I would like to have (in
particular, the ideas of on the fly upgrades - I will have to see how easy
it would be to implement these pieces).

Regards!
Ed

On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 17:02:42 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > a bit of time to go digging, but I believe the context was before the
> > timeout previously as I based my hacked version on the 1.0.5 code).
>
> As of 1.0.7 you shouldn't need to do this. If you *do* end up hacking PB
> please do tell us so we can fix it so it's not necessary. What are you
> using PB for, by the way?
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Mon Aug  4 18:52:33 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804172132.20a3167c.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308041824330.1514-100000@cyclops4.esentire.com>

Greetings!

Okay, tried something a bit more complicated, basically it is a modified
version of pb6server/pb6client code from the documentation.

I'm locking up again. It looks like it gets further than when I had my
problems with 1.0.5. The client claims to have gotten a root reference
(good, this is further), but the server does not show the attaching
client. It looks like the client is blocking in the pb.logIn method.

Twisted Version: 1.0.7alpha2

Note: I did have this working with a hacked up 1.0.5.

SERVER SIDE
-----------

#! /usr/bin/python

from twisted.spread import pb
from twisted.cred.authorizer import DefaultAuthorizer
import twisted.internet.app

from OpenSSL import SSL
from twisted.internet import ssl

import os

class TransferClientPerspective(pb.Perspective):

    def attached(self, clientref, identity):
        print "client attached! they are:", identity
        return self

    def detached(self, ref, identity):
        print "client detached! they were:", identity

    def perspective_transferEvent(self, event):
        print "I am %s, transferEvent(%s) called on %s" % (self.myname, event, self)
        return true



class ServerContextFactory:

    def getContext(self):
        ctx = SSL.Context(SSL.SSLv23_METHOD)
        ctx.use_certificate_file('server.pem')
        ctx.use_privatekey_file('server.pem')
        return ctx


class TransferServer:
    def __init__(self):
        pass

    def run(self):
        print "TransferServer.run() called"

        app = twisted.internet.app.Application("TransferServer")
        auth = DefaultAuthorizer(app)

        service = pb.Service("TransferService", app, auth)
        service.perspectiveClass = TransferClientPerspective

        client1 = service.createPerspective("perspective1")
        client1.myname = "client1"

        identity1 = auth.createIdentity("user1")
        identity1.setPassword("pass1")
        identity1.addKeyByString("TransferService", "perspective1")
        auth.addIdentity(identity1)

        print "Starting service listening now"
        app.listenSSL(8800, pb.BrokerFactory(pb.AuthRoot(auth)), ServerContextFactory())
        app.run(save=0)

server = TransferServer()
server.run()



CLIENT SIDE
-----------

#! /usr/bin/python

from twisted.spread import pb
from twisted.internet import reactor, ssl
from twisted.internet.protocol import ClientFactory
import pdb


class TransferClient:
    def __init__(self):
        pass

    def go(self):
        def1 = pb.getObjectAtSSL("crete.internal", 8800, 15)
        def1.addCallbacks(self.logIn,self.unable)
        print "finishing main()"
        reactor.run()

    def logIn(self, root):
        print "TransferClient.login() called"
        print "Got root reference: %s" % root
        def2 = pb.logIn(root, service="TransferService", username="user1", password="pass1", perspective="perspective1")
        def2.addCallbacks(self.startTransfer,self.unable)


    def startTransfer(self, perspective):
        print "TransferClient.startTransfer() called"
        print "Got perspective1 reference: %s" % perspective
        print "Asking it to transferEvent(13)"
        perspective.callRemote("transferEvent", 13)

    def unable(self, error):
        print "TransferClient.unable() called"
        error.printTraceback()

client = TransferClient()
client.go()




On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 17:02:42 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > a bit of time to go digging, but I believe the context was before the
> > timeout previously as I based my hacked version on the 1.0.5 code).
>
> As of 1.0.7 you shouldn't need to do this. If you *do* end up hacking PB
> please do tell us so we can fix it so it's not necessary. What are you
> using PB for, by the way?
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From sflist at ihonk.com  Mon Aug  4 18:59:02 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Mon, 4 Aug 2003 15:59:02 -0700
Subject: [Twisted-Python] Maturity of twisted.web.woven?
Message-ID: <200308041559.02222.sflist@ihonk.com>

Hi all,

In David Mertz's recent DeveloperWorks articles on Twisted, he states the 
opinion, "Twisted's Web templating framework, woven, while becoming quite 
sophisticated, is unstable enough that I will only touch on it here."[1]

Do the core developers agree with this? The reason I'm asking is that I'm 
looking at coding a commercial (read: credit-card accepting, 
livelihood-producing) website in the next several weeks, and I'd like to do 
it in Twisted if that's the wise choice. But I'd like to know if it might be 
wiser to pick something that isn't being developed so quickly any more, e.g. 
Webware.

Thanks,

Steve Freitas

[1] http://www-106.ibm.com/developerworks/linux/library/l-twist2.html



From itamar at itamarst.org  Mon Aug  4 19:37:50 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 4 Aug 2003 19:37:50 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308041824330.1514-100000@cyclops4.esentire.com>
References: <20030804172132.20a3167c.itamar@itamarst.org>
	<Pine.BSO.4.44.0308041824330.1514-100000@cyclops4.esentire.com>
Message-ID: <20030804193750.187800b0.itamar@itamarst.org>

On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> I'm locking up again. It looks like it gets further than when I had my
> problems with 1.0.5. The client claims to have gotten a root reference
> (good, this is further), but the server does not show the attaching
> client. It looks like the client is blocking in the pb.logIn method.
> 
> Twisted Version: 1.0.7alpha2

getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
I'll be glad to take a look.

  # this is how it'd look:
  factory = pb.PBClientFactory()
  reactor.connectSSL("localhost", 8787, contextFactory, factory)
  deferredOfPerspective = factory.getPerspective("identity", "password",
perspective="joe")

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From cce at clarkevans.com  Mon Aug  4 19:51:35 2003
From: cce at clarkevans.com (Clark C. Evans)
Date: Mon, 4 Aug 2003 23:51:35 +0000
Subject: [Twisted-Python] Goin' with the Flow
In-Reply-To: <3F2E2231.8030708@tekNico.net>
References: <3F2E2231.8030708@tekNico.net>
Message-ID: <20030804235135.GA12033@polya.axista.com>

Nicola,

Thank you for taking time to play with flow.  I'm working on an LDAP adapter 
and shortly there after will somehow find a way to get async PostgreSQL 
queries to work with it (instead of using the Threaded/QueryIterator hack).
However, recently I've been caught up with an unexpected move and have 
been job hunting, which has limited my time for Twisted (and YAML).  But,
that should straighten out in the next month or so... and then I'll be
back at it.

Flow will be more easily understood with an application that uses 
it... I've been putting together a simple LDAP browser (using OpenLDAP)
and ldap queries using Twisted/Flow and python-ldap.   It also will
use iCal and PostgreSQL queries.   The current app I have which uses
Flow is proprietary (*sigh*) so I can't post it.   In short, flow is
useful when:

   1.  You have a ton of deferred calls and would like to keep
       the logic as a single "function".   Or, in other words,
       you are implementing a state machine which can allow other
       twisted requests to be handled during each state change.

   2.  You need to have results returned incrementally, and deferreds
       arn't quite working for you in this regard.

Best,

Clark



From glyph at twistedmatrix.com  Mon Aug  4 20:04:47 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 4 Aug 2003 19:04:47 -0500
Subject: [Twisted-Python] Maturity of twisted.web.woven?
In-Reply-To: <200308041559.02222.sflist@ihonk.com>
Message-ID: <6D478CF2-C6D8-11D7-A0F7-000393C9700E@twistedmatrix.com>

On Monday, August 4, 2003, at 05:59 PM, Steve Freitas wrote:

> In David Mertz's recent DeveloperWorks articles on Twisted, he states 
> the
> opinion, "Twisted's Web templating framework, woven, while becoming 
> quite
> sophisticated, is unstable enough that I will only touch on it 
> here."[1]

It is changing less than it used to be.  However, it isn't done.

> Do the core developers agree with this?

It's more or less true.

> The reason I'm asking is that I'm looking at coding a commercial 
> (read: credit-card accepting, livelihood-producing) website in the 
> next several weeks, and I'd like to do it in Twisted if that's the 
> wise choice. But I'd like to know if it might be wiser to pick 
> something that isn't being developed so quickly any more, e.g. > Webware.

Well!  You certainly wouldn't be coming to this list if you wanted an 
*objective* assessment, so I'll give you my highly distorted view of 
things :).

Woven is a web framework written by crazy geniuses, for crazy geniuses. 
  (That is, by Donovan, for me.)  Don't get too hung up on the word 
"genius" there, though - the operative word is "crazy".

If you are used to more "traditional" web development environments like 
PHP or JSP or whatever, you'll find the object model in woven more than 
a little confusing, and by confusing, I mean "better".  If you've been 
around the block with more hard-core web development models (like Zope, 
Cocoon, WebObjects) you will find that Woven extends the "object 
publishing" metaphor all the way down to individual XML nodes within a 
page; this is a very powerful paradigm to work inside of if you have a 
highly dynamic, interactive website with lots of re-usable objects you 
want to display in different contexts.

I think there are also things happening with Javascript and user events 
and other things that involve creating coherent abstractions around 
web-things which are neither coherent nor abstract.  Do you remember 
"push"?  It's like that.  Except of course it uses cross-browser 
javascript and therefore it terrifies me so thoroughly that I will 
speak no more of it.

The good news is that if you want to create an application which really 
wants to be interactive and hook it up to the web, woven lets you do 
really amazing things in that regard.  But don't just take my word for 
it - we (and by that I mean "the Divmod team") have been putting 
together a similarly livelihood-producing chunk of code which you can 
take a peek at over on http://www.divmod.org/ - the Quotient 
conversation server uses Woven extensively.  I am putting my literal 
money where my proverbial mouth is, and things seem to be going along 
pretty well in that regard.

The bad news is that you will have to track CVS.  You will have to 
hassle Twisted team members to fix bugs that affect your code.  You 
will need to read all the documentation - twice - and then ask for more 
documentation to be written.  You will almost certainly see tracebacks 
that unravel the very fabric that binds our HTML-formatted reality 
together.

Now, take your pulse.  Is it over 130 beats per minute, after reading 
the chilling tale of bleeding-edge web development above?  If not, then 
Woven is the right choice for you.  I personally think it's worth the 
trouble. (Don't think that just because I'm wearing the "glyph #1 best 
Twisted developer" foam pope hat that I don't need to deal with any 
trouble... Did I mention that my girlfriend used woven?  When it was 
considerably less stable than it is now?)

However, it is definitely an adventure you need to be prepared for.

So, in the immortal words of Space Harrier: "GET READY"




From ram at forefront-tech.com  Mon Aug  4 20:10:22 2003
From: ram at forefront-tech.com (Rick Morrison)
Date: Mon, 4 Aug 2003 20:10:22 -0400
Subject: [Twisted-Python] Subclassing static.File
Message-ID: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>

Hi All:

Warning: newbie alert:

Just beginning to look into Twisted, and I'm really impressed with the
breadth of the functionality here.
But, I'm having a bit of trouble getting my head fully around this thing.
Here's what I'm currently having trouble with.
Here's a simple program (that doesn't work) that subclasses the static.File
class:


from twisted.internet import app
from twisted.web import static, server

class FileLogger(static.File):
    def __init__(self, path, defaultType="text/html", ignoredExts=(),
registry=None, allowExt=0):
        static.File(self, path, defaultType, ignoredExts, registry,
allowExt)

    def render(self, request):
        static.File.render(self, request)

root = FileLogger('/home/me/twtest')
a = app.Application('web')
a.listenTCP(8080, server.Site(root))
a.run(0)


When I hit the site with a browser, the browser hangs. Interrupting the
twisted session causes the page to immediately appear in the browser.
...Comment out the override of the render() function, and everything works
fine.

What's going on?




From dp at twistedmatrix.com  Mon Aug  4 20:28:06 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Mon, 4 Aug 2003 17:28:06 -0700
Subject: [Twisted-Python] Subclassing static.File
In-Reply-To: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>
References: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>
Message-ID: <AEF7CE10-C6DB-11D7-BE05-000A95864FC4@twistedmatrix.com>

On Monday, August 4, 2003, at 5:10 PM, Rick Morrison wrote:
>
>     def render(self, request):
>         static.File.render(self, request)
>
> When I hit the site with a browser, the browser hangs. Interrupting the
> twisted session causes the page to immediately appear in the browser.
> ...Comment out the override of the render() function, and everything 
> works
> fine.
>
> What's going on?

You are not returning a value from render. The return value from render
be either a string, being the HTML output of the object, or 
server.NOT_DONE_YET,
in which case you should arrange to have request.write("<html />") and
request.finish() called at a later time.

In this case, you obviously want to return the value of the call to 
static.File.render:

def render(self, request):
	return static.File.render(self, request)

Wouldn't it be nice if the return value of a python function was the 
value of the last
expression in the function? ;-)

dp




From andrew-twisted at puzzling.org  Tue Aug  5 01:43:00 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue, 5 Aug 2003 15:43:00 +1000
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>
References: <20030804164423.7159e71a.itamar@itamarst.org> <Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>
Message-ID: <20030805054300.GB2144@frobozz>

On Mon, Aug 04, 2003 at 05:02:42PM -0400, Edmund Dengler wrote:
[...]
> (this is not documented on the web site documentation -> Aside: is it
> possible to add a version number to the web site documentation so that it
> is possible to know _which_ version of Twisted it is referring to?).

It already does, if you know where to look:
    http://twistedmatrix.com/documents/TwistedDocs/current/api/public/twisted.copyright.html#version

-Andrew.




From radix at twistedmatrix.com  Tue Aug  5 04:20:27 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Tue, 5 Aug 2003 04:20:27 -0400
Subject: [Twisted-Python] Subclassing static.File
In-Reply-To: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>
References: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>
Message-ID: <20030805082027.GK998@radii>

On Mon, Aug 04, 2003 at 08:10:22PM -0400, Rick Morrison wrote:
> class FileLogger(static.File):
>     def __init__(self, path, defaultType="text/html", ignoredExts=(), registry=None, allowExt=0):
>         static.File(self, path, defaultType, ignoredExts, registry, allowExt)

^^^ This should be "static.File.__init__(..)", not "static.File(..)"

>     def render(self, request):
>         static.File.render(self, request)

You need a "return".


Why are you subclassing static.File? It's usually inappropriate.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From justinjohnson at fastmail.fm  Tue Aug  5 10:02:31 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 05 Aug 2003 08:02:31 -0600
Subject: [Twisted-Python] Unruly Callback Code
Message-ID: <20030805140231.A321218591@www.fastmail.fm>

I have some code that is getting a bit unruly due to the number of
callbacks I am doing.  I've defined all of this in a single method
because it is part of a command line tool with multiple sub-commands,
each with its own options, and I made the entire program (i.e. the
command line tool) the class, and the sub-commands are methods on that
class.  However, I'm beginning to think I need to rearrange this so it is
more maintainable, like putting each sub-command in its own class so the
callbacks can be methods on the class instead of inline functions.

Would someone mind looking at the code below and suggesting ways to clean
this up?

Thanks.
-Justin


	# Subcommand: mkvob
	def cmd_mkvob(self):
		"""Usage: mkvob -v vob-tag[,vob-tag,...] -o site [-g group] [-s site,site,...]
		"""
		options = self.config.subOptions
		original_site = options["original"]
		group = options["group"]
		vobs = options["vobs"].split(",")
		sites = []
		if options["sites"] != None:
			sites = options["sites"].split(",")

		def gotObject(object):
			self.perspectives[original_site] = object
			print "Successfully connected to %s (%s)." % (original_site, config.siteToServer[original_site])
			print "Calling remote mkvob ..."
			d = object.callRemote("mkvob", vobs, group)
			return d
		def gotNoObject(object):
			print "Failed to connect:", object
			return object

		def renameReplica(results, vobs, original_site):
			# Do I have to connect again to do this?
			obj = self.perspectives[original_site]
			obj.callRemote("renameReplica", vobs, "original", original_site)
			return obj

		def mkRepExport(results, vobs, sites, original_site):
			obj = self.perspectives[original_site]
			d = obj.callRemote("mkReplicaExport", vobs, sites)
			return d

		def _stop(*args):
			print "The mkvob operation completed successfully"
			reactor.stop()
			return args

		def mkRepImport(results, vobs, sites):
			if len(vobs) > 0 and len(sites) > 0:
				deferreds = []
				for site in sites:
					def onSuccess(object, site):
						self.perspectives[site] = object
						d = object.callRemote("mkReplicaImport", vobs)
						return d
					def applyTriggers(results, vobs, site):
						obj = self.perspectives[site]
						d = obj.callRemote("applyTriggers", vobs)
						return d
					d = self.connectToServer(config.siteToServer[site])
					d.addCallback(onSuccess, site).addErrback(log.err)
					d.addCallback(applyTriggers, vobs, site).addErrback(log.err)
					deferreds.append(d)
				return defer.DeferredList(deferreds)
			return results
				
		d = self.connectToServer(config.siteToServer[original_site])
		d.addCallbacks(gotObject, gotNoObject)
		d.addCallback(renameReplica, vobs, original_site).addErrback(log.err)
		d.addCallback(mkRepExport, vobs, sites, original_site).addErrback(log.err)
		d.addCallback(mkRepImport, vobs, sites).addErrback(log.err)
		d.addBoth(_stop)
		#log.startLogging(sys.stdout)
		reactor.run()



From edmundd at eSentire.com  Tue Aug  5 10:15:11 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 10:15:11 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030805054300.GB2144@frobozz>
Message-ID: <Pine.BSO.4.44.0308051013500.8424-100000@cyclops4.esentire.com>

Thanks! It would be helpful if the version number could appear as a footer
to each page, including the "How To" sections. With the API changing, it
is helpful to know if I am at least looking at some sane version :-).

Regards,
Ed

On Tue, 5 Aug 2003, Andrew Bennetts wrote:

> On Mon, Aug 04, 2003 at 05:02:42PM -0400, Edmund Dengler wrote:
> [...]
> > (this is not documented on the web site documentation -> Aside: is it
> > possible to add a version number to the web site documentation so that it
> > is possible to know _which_ version of Twisted it is referring to?).
>
> It already does, if you know where to look:
>     http://twistedmatrix.com/documents/TwistedDocs/current/api/public/twisted.copyright.html#version
>
> -Andrew.
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Tue Aug  5 10:16:46 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 10:16:46 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804193750.187800b0.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308051015580.8424-100000@cyclops4.esentire.com>

Downloading the CVS to give it a go. Is there any reason to deprecate this
method? Is getObjectAt() also going to be deprecated?

Regards,
Ed

On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > I'm locking up again. It looks like it gets further than when I had my
> > problems with 1.0.5. The client claims to have gotten a root reference
> > (good, this is further), but the server does not show the attaching
> > client. It looks like the client is blocking in the pb.logIn method.
> >
> > Twisted Version: 1.0.7alpha2
>
> getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
> I'll be glad to take a look.
>
>   # this is how it'd look:
>   factory = pb.PBClientFactory()
>   reactor.connectSSL("localhost", 8787, contextFactory, factory)
>   deferredOfPerspective = factory.getPerspective("identity", "password",
> perspective="joe")
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From itamar at itamarst.org  Tue Aug  5 10:37:58 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 5 Aug 2003 10:37:58 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051015580.8424-100000@cyclops4.esentire.com>
References: <20030804193750.187800b0.itamar@itamarst.org>
	<Pine.BSO.4.44.0308051015580.8424-100000@cyclops4.esentire.com>
Message-ID: <20030805103758.28fd3ec7.itamar@itamarst.org>

On Tue, 5 Aug 2003 10:16:46 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> Downloading the CVS to give it a go. Is there any reason to deprecate
> this method? Is getObjectAt() also going to be deprecated?

Yes, and yes :)

The reason is that it ties getting an object to the transport. Every
time you write a new transport, you need to write a new function.
Whereas with the new way, which is the normal way Twisted protocols
work, new transport can be used without writing extra code. In addition
you have the benefits of auto-reconnecting if you want, ability to do
multiple logins over the same PB connection easily, and in general code
that is much cleaner.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Tue Aug  5 10:50:05 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 10:50:05 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804193750.187800b0.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>

Trying it out. Is there any documentation (ala the How To's) to show how
to use the new API.

Tried it out, had to change the contextFactory and context orders, and
used serviceName and perspectiveName.

Here is the new go() method in the client side:

----------

    def go(self):
        factory = pb.PBClientFactory()
        reactor.connectSSL("localhost", 8800, factory, ssl.ClientContextFactory())
        def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
        def1.addCallbacks(self.startTransfer, self.unable)
        print "finishing go()"
        reactor.run()

----------

And here is what I get when I run it:

> python pb7client.py
pb7client.py:16: DeprecationWarning: Please update your backend to use updated APIs.
  def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
finishing go()
TransferClient.unable() called
Failure: twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 61: Connection refused.

I can telnet to the port, so it is not a networking issue.

Regards,
Ed

On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > I'm locking up again. It looks like it gets further than when I had my
> > problems with 1.0.5. The client claims to have gotten a root reference
> > (good, this is further), but the server does not show the attaching
> > client. It looks like the client is blocking in the pb.logIn method.
> >
> > Twisted Version: 1.0.7alpha2
>
> getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
> I'll be glad to take a look.
>
>   # this is how it'd look:
>   factory = pb.PBClientFactory()
>   reactor.connectSSL("localhost", 8787, contextFactory, factory)
>   deferredOfPerspective = factory.getPerspective("identity", "password",
> perspective="joe")
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Tue Aug  5 10:52:49 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 10:52:49 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030805103758.28fd3ec7.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308051052150.8424-100000@cyclops4.esentire.com>

Ahh, this definitely makes more sense. I was wondering why the transport
seemed to be tied so intimately with what was going on the layer above it.

Ed

On Tue, 5 Aug 2003, Itamar Shtull-Trauring wrote:

> On Tue, 5 Aug 2003 10:16:46 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > Downloading the CVS to give it a go. Is there any reason to deprecate
> > this method? Is getObjectAt() also going to be deprecated?
>
> Yes, and yes :)
>
> The reason is that it ties getting an object to the transport. Every
> time you write a new transport, you need to write a new function.
> Whereas with the new way, which is the normal way Twisted protocols
> work, new transport can be used without writing extra code. In addition
> you have the benefits of auto-reconnecting if you want, ability to do
> multiple logins over the same PB connection easily, and in general code
> that is much cleaner.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From itamar at itamarst.org  Tue Aug  5 11:25:57 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 5 Aug 2003 11:25:57 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
References: <20030804193750.187800b0.itamar@itamarst.org>
	<Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
Message-ID: <20030805112557.13e0a812.itamar@itamarst.org>

On Tue, 5 Aug 2003 10:50:05 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> I can telnet to the port, so it is not a networking issue.

Are you sure? Because connectSSL is what getObjectAtSSL would be using
internally, so that is *not* the issue. Also, on windows you'd want to
make that 127.0.0.1 or it will not work.

The DeprecationWarning is due to the use of getPerspective(), which has
also been deprecated. I'll make the warning more clear. Basically PB
should now use new cred, which is far far cleaner and easier to use (the
PBClientFactory.login() method for connecting and PBServerFactory on
server side.) Using getPerspective() will still work for the forseeable
future, of course. See twisted.test.test_pb (the last 4 classes, IIRC)
for examples of how to do this.

I know this may be annoying, but we're doing this because of all the
issues we had with the old APIs that were broken and hard to use in a
variety of ways. Hopefully documentation of the new APIs will be
available soon.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Tue Aug  5 11:30:15 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 11:30:15 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
Message-ID: <Pine.BSO.4.44.0308051127571.8424-100000@cyclops4.esentire.com>

Whoops! Too fast on the keyboard. The "localhost" was suppose to be
"crete.internal".

Fixed and ran. The new error message is:

> python pb7client.py
pb7client.py:16: DeprecationWarning: Please update your backend to use updated APIs.
  def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
finishing go()
TransferClient.unable() called
Failure: twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 22: Invalid argument.

Possibility: Should the "user1" be something else?

Regards!
Ed

On Tue, 5 Aug 2003, Edmund Dengler wrote:

> Trying it out. Is there any documentation (ala the How To's) to show how
> to use the new API.
>
> Tried it out, had to change the contextFactory and context orders, and
> used serviceName and perspectiveName.
>
> Here is the new go() method in the client side:
>
> ----------
>
>     def go(self):
>         factory = pb.PBClientFactory()
>         reactor.connectSSL("localhost", 8800, factory, ssl.ClientContextFactory())
>         def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
>         def1.addCallbacks(self.startTransfer, self.unable)
>         print "finishing go()"
>         reactor.run()
>
> ----------
>
> And here is what I get when I run it:
>
> > python pb7client.py
> pb7client.py:16: DeprecationWarning: Please update your backend to use updated APIs.
>   def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
> finishing go()
> TransferClient.unable() called
> Failure: twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 61: Connection refused.
>
> I can telnet to the port, so it is not a networking issue.
>
> Regards,
> Ed
>
> On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:
>
> > On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
> > Edmund Dengler <edmundd at eSentire.com> wrote:
> >
> > > I'm locking up again. It looks like it gets further than when I had my
> > > problems with 1.0.5. The client claims to have gotten a root reference
> > > (good, this is further), but the server does not show the attaching
> > > client. It looks like the client is blocking in the pb.logIn method.
> > >
> > > Twisted Version: 1.0.7alpha2
> >
> > getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
> > I'll be glad to take a look.
> >
> >   # this is how it'd look:
> >   factory = pb.PBClientFactory()
> >   reactor.connectSSL("localhost", 8787, contextFactory, factory)
> >   deferredOfPerspective = factory.getPerspective("identity", "password",
> > perspective="joe")
> >
> > --
> > Itamar Shtull-Trauring    http://itamarst.org/
> > Available for Python & Twisted consulting
> >
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Tue Aug  5 11:32:51 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 11:32:51 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
Message-ID: <Pine.BSO.4.44.0308051132050.8424-100000@cyclops4.esentire.com>

Never mind! Got it to work. I had a mistyping in the server side when
doing a bit of mucking about.

Connection established and transfer working at the moment.

Regards!
Ed

On Tue, 5 Aug 2003, Edmund Dengler wrote:

> Trying it out. Is there any documentation (ala the How To's) to show how
> to use the new API.
>
> Tried it out, had to change the contextFactory and context orders, and
> used serviceName and perspectiveName.
>
> Here is the new go() method in the client side:
>
> ----------
>
>     def go(self):
>         factory = pb.PBClientFactory()
>         reactor.connectSSL("localhost", 8800, factory, ssl.ClientContextFactory())
>         def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
>         def1.addCallbacks(self.startTransfer, self.unable)
>         print "finishing go()"
>         reactor.run()
>
> ----------
>
> And here is what I get when I run it:
>
> > python pb7client.py
> pb7client.py:16: DeprecationWarning: Please update your backend to use updated APIs.
>   def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
> finishing go()
> TransferClient.unable() called
> Failure: twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 61: Connection refused.
>
> I can telnet to the port, so it is not a networking issue.
>
> Regards,
> Ed
>
> On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:
>
> > On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
> > Edmund Dengler <edmundd at eSentire.com> wrote:
> >
> > > I'm locking up again. It looks like it gets further than when I had my
> > > problems with 1.0.5. The client claims to have gotten a root reference
> > > (good, this is further), but the server does not show the attaching
> > > client. It looks like the client is blocking in the pb.logIn method.
> > >
> > > Twisted Version: 1.0.7alpha2
> >
> > getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
> > I'll be glad to take a look.
> >
> >   # this is how it'd look:
> >   factory = pb.PBClientFactory()
> >   reactor.connectSSL("localhost", 8787, contextFactory, factory)
> >   deferredOfPerspective = factory.getPerspective("identity", "password",
> > perspective="joe")
> >
> > --
> > Itamar Shtull-Trauring    http://itamarst.org/
> > Available for Python & Twisted consulting
> >
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Tue Aug  5 11:34:29 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 11:34:29 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030805112557.13e0a812.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308051133440.8424-100000@cyclops4.esentire.com>

Would you recommend that I have a look at the new methods, and get away
from getPerspective() et al.? How stable (or production ready) are they?

Regards!
Ed

On Tue, 5 Aug 2003, Itamar Shtull-Trauring wrote:

> On Tue, 5 Aug 2003 10:50:05 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > I can telnet to the port, so it is not a networking issue.
>
> Are you sure? Because connectSSL is what getObjectAtSSL would be using
> internally, so that is *not* the issue. Also, on windows you'd want to
> make that 127.0.0.1 or it will not work.
>
> The DeprecationWarning is due to the use of getPerspective(), which has
> also been deprecated. I'll make the warning more clear. Basically PB
> should now use new cred, which is far far cleaner and easier to use (the
> PBClientFactory.login() method for connecting and PBServerFactory on
> server side.) Using getPerspective() will still work for the forseeable
> future, of course. See twisted.test.test_pb (the last 4 classes, IIRC)
> for examples of how to do this.
>
> I know this may be annoying, but we're doing this because of all the
> issues we had with the old APIs that were broken and hard to use in a
> variety of ways. Hopefully documentation of the new APIs will be
> available soon.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From tv at twistedmatrix.com  Tue Aug  5 12:02:44 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Tue, 5 Aug 2003 19:02:44 +0300
Subject: [Twisted-Python] Unruly Callback Code
In-Reply-To: <20030805140231.A321218591@www.fastmail.fm>
References: <20030805140231.A321218591@www.fastmail.fm>
Message-ID: <20030805160244.GA32531@lapdog>

On Tue, Aug 05, 2003 at 08:02:31AM -0600, Justin Johnson wrote:
> Would someone mind looking at the code below and suggesting ways to clean
> this up?

> 	# Subcommand: mkvob
> 	def cmd_mkvob(self):
> 		"""Usage: mkvob -v vob-tag[,vob-tag,...] -o site [-g group] [-s site,site,...]
> 		"""
> 		options = self.config.subOptions
> 		original_site = options["original"]
> 		group = options["group"]
> 		vobs = options["vobs"].split(",")
> 		sites = []
> 		if options["sites"] != None:
 		if options["sites"] is not None:
> 			sites = options["sites"].split(",")
> 
> 		def gotObject(object):
		def gotObject(object, vobs, group):
> 			self.perspectives[original_site] = object
> 			print "Successfully connected to %s (%s)." % (original_site, config.siteToServer[original_site])
> 			print "Calling remote mkvob ..."
> 			d = object.callRemote("mkvob", vobs, group)
> 			return d

	I'd actually avoid passing vobs and group into gotObject like
	that. Just have them as parameters; that means the function
	body is independent of its location, which I consider a lot
	cleaner.

> 		def renameReplica(results, vobs, original_site):
> 			# Do I have to connect again to do this?
> 			obj = self.perspectives[original_site]
> 			obj.callRemote("renameReplica", vobs, "original", original_site)
> 			return obj
> 
> 		def mkRepExport(results, vobs, sites, original_site):
> 			obj = self.perspectives[original_site]
> 			d = obj.callRemote("mkReplicaExport", vobs, sites)
> 			return d

	The tricks you play with self.perspectives are quite
	confusing, IMHO. I'd be more inclined to adding the
	callbacks accessing self.perspectives at a stage where
	I could pass them the perspective as an argument.
	That is,

		def gotObject(object, vobs, group):
			d = object.callRemote("mkvob", vobs, group)
			d.addCallback(renameReplica, object, vobs, original_site)
			d.addCallback(mkRepExport, object, vobs, sites, original_site)
			d.addCallback(mkRepImport, object, vobs, sites)
			return d

	Also, object is a bad name, as that name means other things in
	python2.2.

> 		def _stop(*args):
> 			print "The mkvob operation completed successfully"
> 			reactor.stop()
> 			return args

		def _stop(fail):
			reactor.stop()
			return fail

	That's not true, _stop is also called on errors.

	Also, _stop gets no extra arguments in .addBoth, so args=(aFailure,)
	and then you return that tuple.. 

> 		def mkRepImport(results, vobs, sites):
> 			if len(vobs) > 0 and len(sites) > 0:
> 				deferreds = []
> 				for site in sites:
> 					def onSuccess(object, site):
> 						self.perspectives[site] = object
> 						d = object.callRemote("mkReplicaImport", vobs)
> 						return d
> 					def applyTriggers(results, vobs, site):
> 						obj = self.perspectives[site]
> 						d = obj.callRemote("applyTriggers", vobs)
> 						return d
> 					d = self.connectToServer(config.siteToServer[site])
> 					d.addCallback(onSuccess, site).addErrback(log.err)
> 					d.addCallback(applyTriggers, vobs, site).addErrback(log.err)
> 					deferreds.append(d)
> 				return defer.DeferredList(deferreds)
> 			return results

	You just stepped in the DeferredList trap. DeferredList
	_never_ .errback()s unless it's told to fireOnOneErrback.
	That means you miss what errors might have happened.

	And fireOnOneErrback isn't normally what you want; you want
	to handle the results one by one.

> 		d = self.connectToServer(config.siteToServer[original_site])
> 		d.addCallbacks(gotObject, gotNoObject)
> 		d.addCallback(renameReplica, vobs, original_site).addErrback(log.err)
> 		d.addCallback(mkRepExport, vobs, sites, original_site).addErrback(log.err)
> 		d.addCallback(mkRepImport, vobs, sites).addErrback(log.err)

	There's no need to .addErrback that much. There's probably no
	reason to have gotNoObject special cased, and handle later
	errors just with log.err.

		d = self.connectToServer(config.siteToServer[original_site])
		d.addCallback(gotObject, vobs, group)
		d.addCallback(renameReplica, vobs, original_site)
		d.addCallback(mkRepExport, vobs, sites, original_site)
		d.addCallback(mkRepImport, vobs, sites)
		d.addErrback(log.err)

-- 
:(){ :|:&};:



From itamar at itamarst.org  Tue Aug  5 12:13:40 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 5 Aug 2003 12:13:40 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051133440.8424-100000@cyclops4.esentire.com>
References: <20030805112557.13e0a812.itamar@itamarst.org>
	<Pine.BSO.4.44.0308051133440.8424-100000@cyclops4.esentire.com>
Message-ID: <20030805121340.00f3bf5a.itamar@itamarst.org>

On Tue, 5 Aug 2003 11:34:29 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> Would you recommend that I have a look at the new methods, and get
> away from getPerspective() et al.? How stable (or production ready)
> are they?

They still might change - but I need feedback to know if they need to
change in any way, so please try them :)

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From itamar at itamarst.org  Tue Aug  5 12:14:44 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 5 Aug 2003 12:14:44 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051127571.8424-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
	<Pine.BSO.4.44.0308051127571.8424-100000@cyclops4.esentire.com>
Message-ID: <20030805121444.341563d4.itamar@itamarst.org>

On Tue, 5 Aug 2003 11:30:15 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> Failure: twisted.internet.error.ConnectionRefusedError: Connection was
> refused by other side: 22: Invalid argument.
> 
> Possibility: Should the "user1" be something else?

ConnectionRefusedError is still on the networking layer, before it even
hits PB. You using listenSSL on the other side?

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Tue Aug  5 14:32:06 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 05 Aug 2003 12:32:06 -0600
Subject: [Twisted-Python] Unruly Callback Code
In-Reply-To: <20030805160244.GA32531@lapdog>
References: <20030805140231.A321218591@www.fastmail.fm> <20030805160244.GA32531@lapdog>
Message-ID: <20030805183206.30A8E38D0F@www.fastmail.fm>

How's it look now?  I still need to add appropriate errbacks for each
deferred in the deferred list, as opposed to using an errback on the
entire list.  Any other suggestions (even minor) about variable/function
naming or anything else?


	# Subcommand: mkvob
	def cmd_mkvob(self):
		"""Usage: mkvob -v vob-tag[,vob-tag,...] -o site [-g group] [-s site,site,...]
		"""
		options = self.config.subOptions
		original_site = options["original"]
		group = options["group"]
		vobs = options["vobs"].split(",")
		sites = []
		if options["sites"] is not None:
			sites = options["sites"].split(",")

		def renameReplica(results, perspective, vobs, original_site):
			d = perspective.callRemote("renameReplica", vobs, "original", original_site)
			return d

		def mkRepExport(results, perspective, vobs, sites):
			d = perspective.callRemote("mkReplicaExport", vobs, sites)
			return d

		def _stop(fail):
			reactor.stop()
			return fail

		def mkRepImport(results, perspective, vobs, sites):
			if len(vobs) > 0 and len(sites) > 0:
				deferreds = []
				for site in sites:
					def applyTriggers(results, perspective, vobs):
						d = perspective.callRemote("applyTriggers", vobs)
						return d
					def gotObject(perspective, vobs):
						d = perspective.callRemote("mkReplicaImport", vobs)
						d.addCallback(applyTriggers, perspective, vobs)
						return d
					d = self.connectToServer(config.siteToServer[site])
					d.addCallback(gotObject, vobs)
					deferreds.append(d)
				return defer.DeferredList(deferreds)
			return results
				
		def gotObject(perspective, vobs, group, original_site, sites):
			d = perspective.callRemote("mkvob", vobs, group)
			d.addCallback(renameReplica, perspective, vobs, original_site)
			d.addCallback(mkRepExport, perspective, vobs, sites)
			d.addCallback(mkRepImport, perspective, vobs, sites)
			d.addErrback(log.err)
			d.addBoth(_stop)
			return d

		# Connect to the server and start the chain of deferreds
		d = self.connectToServer(config.siteToServer[original_site])
		d.addCallback(gotObject, vobs, group, original_site, sites)
		reactor.run()

On Tue, 5 Aug 2003 19:02:44 +0300, "Tommi Virtanen"
<tv at twistedmatrix.com> said:
> On Tue, Aug 05, 2003 at 08:02:31AM -0600, Justin Johnson wrote:
> > Would someone mind looking at the code below and suggesting ways to clean
> > this up?
> 
> > 	# Subcommand: mkvob
> > 	def cmd_mkvob(self):
> > 		"""Usage: mkvob -v vob-tag[,vob-tag,...] -o site [-g group] [-s site,site,...]
> > 		"""
> > 		options = self.config.subOptions
> > 		original_site = options["original"]
> > 		group = options["group"]
> > 		vobs = options["vobs"].split(",")
> > 		sites = []
> > 		if options["sites"] != None:
>  		if options["sites"] is not None:
> > 			sites = options["sites"].split(",")
> > 
> > 		def gotObject(object):
> 		def gotObject(object, vobs, group):
> > 			self.perspectives[original_site] = object
> > 			print "Successfully connected to %s (%s)." % (original_site, config.siteToServer[original_site])
> > 			print "Calling remote mkvob ..."
> > 			d = object.callRemote("mkvob", vobs, group)
> > 			return d
> 
> 	I'd actually avoid passing vobs and group into gotObject like
> 	that. Just have them as parameters; that means the function
> 	body is independent of its location, which I consider a lot
> 	cleaner.
> 
> > 		def renameReplica(results, vobs, original_site):
> > 			# Do I have to connect again to do this?
> > 			obj = self.perspectives[original_site]
> > 			obj.callRemote("renameReplica", vobs, "original", original_site)
> > 			return obj
> > 
> > 		def mkRepExport(results, vobs, sites, original_site):
> > 			obj = self.perspectives[original_site]
> > 			d = obj.callRemote("mkReplicaExport", vobs, sites)
> > 			return d
> 
> 	The tricks you play with self.perspectives are quite
> 	confusing, IMHO. I'd be more inclined to adding the
> 	callbacks accessing self.perspectives at a stage where
> 	I could pass them the perspective as an argument.
> 	That is,
> 
> 		def gotObject(object, vobs, group):
> 			d = object.callRemote("mkvob", vobs, group)
> 			d.addCallback(renameReplica, object, vobs, original_site)
> 			d.addCallback(mkRepExport, object, vobs, sites, original_site)
> 			d.addCallback(mkRepImport, object, vobs, sites)
> 			return d
> 
> 	Also, object is a bad name, as that name means other things in
> 	python2.2.
> 
> > 		def _stop(*args):
> > 			print "The mkvob operation completed successfully"
> > 			reactor.stop()
> > 			return args
> 
> 		def _stop(fail):
> 			reactor.stop()
> 			return fail
> 
> 	That's not true, _stop is also called on errors.
> 
> 	Also, _stop gets no extra arguments in .addBoth, so args=(aFailure,)
> 	and then you return that tuple.. 
> 
> > 		def mkRepImport(results, vobs, sites):
> > 			if len(vobs) > 0 and len(sites) > 0:
> > 				deferreds = []
> > 				for site in sites:
> > 					def onSuccess(object, site):
> > 						self.perspectives[site] = object
> > 						d = object.callRemote("mkReplicaImport", vobs)
> > 						return d
> > 					def applyTriggers(results, vobs, site):
> > 						obj = self.perspectives[site]
> > 						d = obj.callRemote("applyTriggers", vobs)
> > 						return d
> > 					d = self.connectToServer(config.siteToServer[site])
> > 					d.addCallback(onSuccess, site).addErrback(log.err)
> > 					d.addCallback(applyTriggers, vobs, site).addErrback(log.err)
> > 					deferreds.append(d)
> > 				return defer.DeferredList(deferreds)
> > 			return results
> 
> 	You just stepped in the DeferredList trap. DeferredList
> 	_never_ .errback()s unless it's told to fireOnOneErrback.
> 	That means you miss what errors might have happened.
> 
> 	And fireOnOneErrback isn't normally what you want; you want
> 	to handle the results one by one.
> 
> > 		d = self.connectToServer(config.siteToServer[original_site])
> > 		d.addCallbacks(gotObject, gotNoObject)
> > 		d.addCallback(renameReplica, vobs, original_site).addErrback(log.err)
> > 		d.addCallback(mkRepExport, vobs, sites, original_site).addErrback(log.err)
> > 		d.addCallback(mkRepImport, vobs, sites).addErrback(log.err)
> 
> 	There's no need to .addErrback that much. There's probably no
> 	reason to have gotNoObject special cased, and handle later
> 	errors just with log.err.
> 
> 		d = self.connectToServer(config.siteToServer[original_site])
> 		d.addCallback(gotObject, vobs, group)
> 		d.addCallback(renameReplica, vobs, original_site)
> 		d.addCallback(mkRepExport, vobs, sites, original_site)
> 		d.addCallback(mkRepImport, vobs, sites)
> 		d.addErrback(log.err)
> 
> -- 
> :(){ :|:&};:
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From syver-en at online.no  Tue Aug  5 14:41:43 2003
From: syver-en at online.no (Syver Enstad)
Date: 05 Aug 2003 20:41:43 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
Message-ID: <ud6fk54m0.fsf@online.no>

I asked on the #twisted irc channel today about this, and Itamar
answered that it was possible but maybe only in CVS, I was also
directed to this list as the proper channel to ask woven questions.

I have the following setup:

class MyPage(page.Page):
   def wmfactory_myClass....
       ... some code that does a asynch operation and return a deferred
       deferred.addCallback(self._cbMyClass)
       return deferred
   
   def _cbMyClass(self, result):
       return MyClass(result)


class MyClass(model.MethodModel):
   def wmfactory_listing(......
       return [.......]


template:

<span model="myClass" view="None>
  <table model="listing" view="List">
        ....
  </table>
</span>

I get an error that the view cannot find the submodel, listing. The
modelStack is [DeferredWrapper, MyPage]. 

I use Twisted 1.0.6.

So my question is: How can I use deferreds the way I am outlining
here? Or is there a simple workaround?

-- 

Vennlig hilsen 

Syver Enstad




From ram at forefront-tech.com  Tue Aug  5 15:18:40 2003
From: ram at forefront-tech.com (Rick Morrison)
Date: Tue, 5 Aug 2003 15:18:40 -0400
Subject: [Twisted-Python] Re: Subclassing static.File
Message-ID: <004101c35b86$61ed41f0$1510a8c0@forefronttech>

Wow, that was fast! Thanks to all for the correction.

For the curious, I'm subclassing static.File.render() simply so that I can
dump the server.Request headers to see how twisted packages up the data for
a HTTP POST request, since I couldn't find that info in the twisted^H^Hy
little maze of documentation. If you'd like, when I'm finished with my
plunking around, perhaps I'll write up a few paragraphs on this that you can
drop into the pertinent doc files.

Rick




From dp at twistedmatrix.com  Tue Aug  5 15:27:07 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Tue, 5 Aug 2003 12:27:07 -0700
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <ud6fk54m0.fsf@online.no>
References: <ud6fk54m0.fsf@online.no>
Message-ID: <CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com>

On Tuesday, August 5, 2003, at 11:41 AM, Syver Enstad wrote:

<snip deferred model>

> template:
>
> <span model="myClass" view="None>
>   <table model="listing" view="List">
>         ....
>   </table>
> </span>

Change view="None" to view="Widget". The None widget (DefaultWidget) 
doesn't know anything about Deferreds, and thus can't pause the 
rendering of the rest of the node until the deferred has fired.

dp




From pb_twisted at olga.mine.nu  Tue Aug  5 17:03:28 2003
From: pb_twisted at olga.mine.nu (Patrik Blommaskog)
Date: Tue, 5 Aug 2003 23:03:28 +0200
Subject: [Twisted-Python] Jelly assertion error when running client and server in the same process
Message-ID: <JAEDJDIBADCJHPFLNEDFOEKPCAAA.pb_twisted@olga.mine.nu>

I have a client and a server application communicating using Twisted and PB.
They run fine as separate programs.

When adding some unit tests, I try to run both the server and a client in
the same application, but I get an assertion error as shown below. I don't
really understand enough of what's happening under the Twisted hood to tell
from the message and looking at flavors.py what's causing the problem.

The applications are growing, so I made an attempt to make a minimal example
from scratch to demonstrate the problem. However, I failed to reproduce it
this way. Since stripping down the applications to a bare minimum can take
some time, I would first like to ask the list if anyone can give me an
indication of what could be the problem? Even with my bad etiquette of not
providing an example, someone is likely to have written that assert
statement for a reason.

Traceback (most recent call last):
  File "C:\Python22\Lib\site-packages\twisted\internet\base.py", line 368,
in runUntilCurrent
    call.func(*call.args, **call.kw)
  File "E:\p\storskogen\src\skogen\common\Core.py", line 132, in
onActorEntered
    handler(actor)
  File "E:\p\storskogen\src\skogen\server\PlayerPerspective.py", line 65, in
onActorEntered
    self.remote.callRemote("addActor", actor)
  File "C:\Python22\Lib\site-packages\twisted\spread\pb.py", line 323, in
callRemote
    return self.broker._sendMessage('',self.perspective, self.luid, name,
args, kw)
--- <exception caught here> ---
  File "C:\Python22\Lib\site-packages\twisted\spread\pb.py", line 788, in
_sendMessage
    netArgs = self.serialize(args, perspective=perspective, method=message)
  File "C:\Python22\Lib\site-packages\twisted\spread\pb.py", line 742, in
serialize
    return jelly(object, self.security, None, self)
  File "C:\Python22\Lib\site-packages\twisted\spread\jelly.py", line 845, in
jelly
    return _Jellier(taster, persistentStore, invoker).jelly(object)
  File "C:\Python22\Lib\site-packages\twisted\spread\jelly.py", line 451, in
jelly
    sxp.append(self.jelly(item))
  File "C:\Python22\Lib\site-packages\twisted\spread\jelly.py", line 407, in
jelly
    return obj.jellyFor(self)
  File "C:\Python22\Lib\site-packages\twisted\spread\flavors.py", line 434,
in jellyFor
    assert jellier.invoker is self.broker, "You cannot exchange cached
proxies between brokers."
exceptions.AssertionError: You cannot exchange cached proxies between
brokers.

FWIW, I can say that the "self.remote.callRemote("addActor", actor)" line
belongs to the listener (server) side. Both peers make remote calls to each
other. The listener side has a number of Cacheable's and Cacheable's
containing Cacheable's, while the connecting side only exposes one
Referenceable.


- Patrik





From twisted at goldenspud.com  Tue Aug  5 18:37:43 2003
From: twisted at goldenspud.com (Matthew R. Scott)
Date: Tue, 5 Aug 2003 17:37:43 -0500
Subject: [Twisted-Python] possible patch for twisted.mail.protocols
Message-ID: <200308051737.43922.twisted@goldenspud.com>

I am writing a custom POP-toaster type of application using as much of 
existing twisted infrastructure as possible...

I found a spot in the twisted.mail.protocols.VirtualPOP3 class that does the 
"right thing" when you log into the server using APOP but then does the 
"wrong thing" when you try to use traditional USER/PASS login.

Here is the patch for the changes I made to make both do the "right thing". 
Basically, authenticateUserAPOP and authenticateUserPASS now do the same 
thing to get the portal associated with the domain; the only difference now 
is how they call portal.login

This probably explains the user at domain problem I had described last week, to 
which I got a response that assumed that logging in with user at domain was 
working correctly :)

I ran 'trail twisted.test' and no mail-related tests failed...


$ cvs diff -nau
Index: twisted/mail/protocols.py
===================================================================
RCS file: /cvs/Twisted/twisted/mail/protocols.py,v
retrieving revision 1.16
diff -a -u -n -a -u -r1.16 protocols.py
cvs server: conflicting specifications of output style
cvs server: conflicting specifications of output style
--- twisted/mail/protocols.py   15 Jul 2003 00:07:35 -0000      1.16
+++ twisted/mail/protocols.py   5 Aug 2003 22:16:18 -0000
@@ -168,12 +168,17 @@
             )

     def authenticateUserPASS(self, user, password):
-        portal = self.service.defaultPortal()
-        return portal.login(
-            cred.credentials.UsernamePassword(user, password),
-            None,
-            pop3.IMailbox
-        )
+        user, domain = self.lookupDomain(user)
+        try:
+            portal = self.service.lookupPortal(domain)
+        except KeyError:
+            return defer.fail(cred.error.UnauthorizedLogin())
+        else:
+            return portal.login(
+                cred.credentials.UsernamePassword(user, password),
+                None,
+                pop3.IMailbox,
+                )

     def lookupDomain(self, user):
         try:


-- 
Matthew R. Scott
OMAjA / http://www.omaja.com/




From syver-en at online.no  Tue Aug  5 18:38:58 2003
From: syver-en at online.no (Syver Enstad)
Date: 06 Aug 2003 00:38:58 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com>
References: <ud6fk54m0.fsf@online.no>
	<CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com>
Message-ID: <un0en4tml.fsf@online.no>

Donovan Preston <dp at twistedmatrix.com> writes:

> On Tuesday, August 5, 2003, at 11:41 AM, Syver Enstad wrote:
> 
> <snip deferred model>
> 
> > template:
> >
> > <span model="myClass" view="None>
> >   <table model="listing" view="List">
> >         ....
> >   </table>
> > </span>
> 
> Change view="None" to view="Widget". The None widget (DefaultWidget)
> doesn't know anything about Deferreds, and thus can't pause the
> rendering of the rest of the node until the deferred has fired.

Thanks Donovan, that did the trick. Great, I've done some pretty gross
hacks to get around that problem, it was about time I learned how to
do it. 

Regarding views, how do I find out what views one should use? What is
the default view (or isn't there such a thing)? When should one use
Widget and when should one use None? Are there any documents on things
like this?


-- 

Vennlig hilsen 

Syver Enstad




From dp at twistedmatrix.com  Tue Aug  5 18:54:10 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Tue, 5 Aug 2003 15:54:10 -0700
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <un0en4tml.fsf@online.no>
References: <ud6fk54m0.fsf@online.no> <CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com> <un0en4tml.fsf@online.no>
Message-ID: <BA1A791A-C797-11D7-8BDE-000A95864FC4@twistedmatrix.com>

On Tuesday, August 5, 2003, at 3:38 PM, Syver Enstad wrote:

<snip>

> Thanks Donovan, that did the trick. Great, I've done some pretty gross
> hacks to get around that problem, it was about time I learned how to
> do it.
>
> Regarding views, how do I find out what views one should use? What is
> the default view (or isn't there such a thing)? When should one use
> Widget and when should one use None? Are there any documents on things
> like this?

You can look in widgets.py to see what basic widgets are available. 
view="None" is aliased to DefaultWidget by the view-lookup machinery. 
You can see by the volume of code in Widget vs. DefaultWidget that 
widget is a lot more functional. DefaultWidget is supposed to exist 
only to minimize the amount of processing that happens on Widgets that 
aren't doing any work. DefaultWidget doesn't know a thing about 
deferreds but Widget does, which is why you had your problem.

I consider it a bug that you had to say view="Widget" in your case; 
normally you shouldn't be required to know about implementation details 
of Widgets in order to get deferred-model support to work.

Someone could even file a bug which says something like "DefaultWidget 
needs to know about Deferreds"

dp




From twisted at goldenspud.com  Tue Aug  5 19:01:00 2003
From: twisted at goldenspud.com (Matthew R. Scott)
Date: Tue, 5 Aug 2003 18:01:00 -0500
Subject: [Twisted-Python] callback conventions
Message-ID: <200308051801.00365.twisted@goldenspud.com>

Where I work, we have been using a convention of specifying callbacks that do 
not need to be used outside of a certain scope, by defining functions within 
functions.  So far, it has helped us keep our code cleaner-looking and easier 
to browse and maintain.

Example snipped from working code:

class Daemon(pb.Referenceable):
    # ...
    def pingServer(self):
        def success(result):
            self.reactor.callLater(1, self.pingServer)
        def failure(reason):
            self.onDisconnect()
            self.connect()
        try:
            df = self.callRemote('ping')
        except:
            failure('Ping unsuccessful')
        else:
            df.addCallbacks(success, failure)
    # ...

What you would typically have to do the 'classic' way:

class Daemon(pb.Referenceable:
    # ...
    def cb_pingServerSuccess(self, result):
        self.reactor.callLater(1, self.pingServer)
    def cb_pingServerFailure(self, reason):
        self.onDisconnect()
        self.connect()
    def pingServer(self):
        try:
            df = self.callRemote('ping')
        except:
            self.cb_pingServerFailure('Ping unsuccessful')
        else:
            df.addCallbacks(cb_pingServerSuccess, 
                            cb_pingServerFailure)
    # ...

Others may already use this, but we speculated that the reason it is not in 
widespread use is because prior to python2.2 the scoping rules for 
functions-inside-functions made it more difficult to do this easily.

(I personally am not sure as Python 2.2 was the first Python version I've 
developed with)

Comments, questions, mild flames appreciated :) ... 

-- 
Matthew R. Scott
OMAjA / http://www.omaja.com/




From jgoerzen at complete.org  Tue Aug  5 20:57:37 2003
From: jgoerzen at complete.org (John Goerzen)
Date: Tue, 05 Aug 2003 19:57:37 -0500
Subject: [Twisted-Python] Re: Flag storing broke in IMAP4Client
References: <20030801014711.GA21619@complete.org> <20030801020039.GB32720@frobozz>
Message-ID: <87r83zfvr2.fsf@complete.org>

Andrew Bennetts <andrew-twisted at puzzling.org> writes:

> On Thu, Jul 31, 2003 at 08:47:11PM -0500, John Goerzen wrote:
>> 
>> This would likely be a problem for all IMAP commands that issues STORE to the
>> server: setFlags(), addFlags(), removeFlags(), etc.
>
> I *strongly* recommend using either CVS or the latest alpha if you are using
> IMAP.  There has been a lot of work (almost forty checkins) done on it since
> 1.0.6:
>     http://twistedmatrix.com/users/jh.twistd/viewcvs/cgi/viewcvs.cgi/twisted/protocols/imap4.py?cvsroot=Twisted

It hasn't fixed this problem, however.

Am I the only one using IMAP4Client for serious work?  (This is not a
rhetorical or accusatory question; merely an honest inquiry)

Some of these problems I feel like I should be able to fix myself, but
the imap4.py code is sparsely-commented and I fear unintended
side-effects...

-- John




From andrew-twisted at puzzling.org  Tue Aug  5 22:52:11 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Wed, 6 Aug 2003 12:52:11 +1000
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051013500.8424-100000@cyclops4.esentire.com>
References: <20030805054300.GB2144@frobozz> <Pine.BSO.4.44.0308051013500.8424-100000@cyclops4.esentire.com>
Message-ID: <20030806025211.GA10960@frobozz>

On Tue, Aug 05, 2003 at 10:15:11AM -0400, Edmund Dengler wrote:
> Thanks! It would be helpful if the version number could appear as a footer
> to each page, including the "How To" sections. With the API changing, it
> is helpful to know if I am at least looking at some sane version :-).

Yes, I agree -- I've added a bug assigned to myself about this:
    http://twistedmatrix.com/bugs/issue176

-Andrew.




From nico at tekNico.net  Wed Aug  6 04:55:49 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Wed, 06 Aug 2003 10:55:49 +0200
Subject: [Twisted-Python] Breaking up long computations
Message-ID: <3F30C295.6010404@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I think I drank enough kool-aid to see that "Deferred are not magical things
that turn long code into short", so I'm trying to break long, cyclical
computations into Twisted-compliant pieces.

Let's say I have a matrix and want to make some computation on its elements
(this does not involve Numeric or numarray, by the way, it's just an example):


data = ((1, 1, 1),
        (2, 2, 2),
        (3, 3, 3))

sqrSum = 0
for row in data:
    for num in row:
        sqrSum += num*num
print sqrSum


To be able to make one operation per event, I break the loops using iter()
and reactor.callLater(), and end up with this, actually working, script:


from twisted.internet import reactor

def computeRow(sqrSum, rowIter, dataIter):
    try:
        num = rowIter.next()
    except StopIteration:
        reactor.callLater(0, computeData, sqrSum, dataIter)
    else:
        sqrSum += num*num
        reactor.callLater(0, computeRow, sqrSum, rowIter, dataIter)

def computeData(sqrSum, dataIter):
    try:
        row = dataIter.next()
    except StopIteration:
        print sqrSum
        reactor.stop()
    else:
        rowIter = iter(row)
        reactor.callLater(0, computeRow, sqrSum, rowIter, dataIter)

data = ((1, 1, 1),
        (2, 2, 2),
        (3, 3, 3))
sqrSum = 0
dataIter = iter(data)
computeData(sqrSum, dataIter)
reactor.run()


(In both cases, the answer is 42. :^) )

Apparently, this allows Twisted to process any other events that may happen
in the middle of the computation. But I wonder, since I'm not using threads,
and Twisted runs the reactor and my code in the same process/thread, how
could such events get inserted into the queue?

I mean, if I'm appending non-delaying events from inside the computation,
one after the other, how can anything else get a chance to get started
*before* the computation completes?

Obviously, in such a case there would be no point in this exercise in
decomposing, so I feel I'm overlooking something fundamental.


- --
"Unlike some other scripting languages, Python syntax tends to be in
words rather than typographical syntax - it's very unlikely you'll be
writing lines of code that look like comic book curse words. As a result,
when you have to come back to your code six months later, odds are you
will still be able to understand it."  Samuele Pedroni and Noel Rappin

Nicola Larosa - nico at tekNico.net
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/MMKTXv0hgDImBm4RAgBLAJ9WdmIDeOSPJYLtYLQB5unbuhPajACeKzhl
s2bZSXJzeSEXLrJlpMYHtZE=
=9JKY
-----END PGP SIGNATURE-----





From syver at inout.no  Wed Aug  6 05:47:12 2003
From: syver at inout.no (Syver Enstad)
Date: 06 Aug 2003 11:47:12 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <BA1A791A-C797-11D7-8BDE-000A95864FC4@twistedmatrix.com>
References: <ud6fk54m0.fsf@online.no>
	<CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com>
	<un0en4tml.fsf@online.no>
	<BA1A791A-C797-11D7-8BDE-000A95864FC4@twistedmatrix.com>
Message-ID: <ud6fjnmn3.fsf@inout.no>

I found a bug by the way:

At line: 176 in lookupSubmodel
                if isinstance(currentModel, defer.Deferred):
                    currentModel.addCallback(adaptToIModel,
                                             element, parentModel)
                    return currentModel

The variable parentModel is not defined.




From andrew-twisted at puzzling.org  Wed Aug  6 05:50:27 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Wed, 6 Aug 2003 19:50:27 +1000
Subject: [Twisted-Python] Breaking up long computations
In-Reply-To: <3F30C295.6010404@tekNico.net>
References: <3F30C295.6010404@tekNico.net>
Message-ID: <20030806095027.GA11724@frobozz>

On Wed, Aug 06, 2003 at 10:55:49AM +0200, Nicola Larosa wrote:
[...]
> To be able to make one operation per event, I break the loops using iter()
> and reactor.callLater(), and end up with this, actually working, script:
> 
> 
> from twisted.internet import reactor
> 
> def computeRow(sqrSum, rowIter, dataIter):
>     try:
>         num = rowIter.next()
>     except StopIteration:
>         reactor.callLater(0, computeData, sqrSum, dataIter)
>     else:
>         sqrSum += num*num
>         reactor.callLater(0, computeRow, sqrSum, rowIter, dataIter)
> 
> def computeData(sqrSum, dataIter):
>     try:
>         row = dataIter.next()
>     except StopIteration:
>         print sqrSum
>         reactor.stop()
>     else:
>         rowIter = iter(row)
>         reactor.callLater(0, computeRow, sqrSum, rowIter, dataIter)
> 
> data = ((1, 1, 1),
>         (2, 2, 2),
>         (3, 3, 3))
> sqrSum = 0
> dataIter = iter(data)
> computeData(sqrSum, dataIter)
> reactor.run()

Note that both computeRow and computeData return immediately.  (Well,
computeRow does a tiny amount of work, but no matter how big your data
matrix is, computeRow will always do a small but constant amount per call,
which is the main thing)

> Apparently, this allows Twisted to process any other events that may happen
> in the middle of the computation. But I wonder, since I'm not using threads,
> and Twisted runs the reactor and my code in the same process/thread, how
> could such events get inserted into the queue?

Precisely because your functions return control to the reactor repeatedly,
rather than doing it all in one hit, there is now room for the reactor to
process any other events that need processing, if any.

> I mean, if I'm appending non-delaying events from inside the computation,
> one after the other, how can anything else get a chance to get started
> *before* the computation completes?

The key here is that reactor.callLater(0, func) will *always* cause the
function to be called on the next iteration of the reactor, even though it
can be considered already due, so that other events get a chance to happen.

E.g., consider a network server that is doing the above calculation in
addition to serving some network clients.  Network events can happen at any
time, they are caused by things completely external to your process, so it's
entirely possible that some data might arrive while computeRow is doing its
subset of the calculation.  Then, when computeRow returns, and the reactor
will do something like this:
    - check that there are no more scheduled events that need to be run *in
      this iteration*.  It *won't* pull anything off the delayed call queue
      that wasn't there before it started processing delayed calls.  Let's
      assume there's nothing else to do here.  [I'm guessing this is the bit
      you weren't getting, but I'll tell complete story anyway, just in
      case]
    - then the reactor will finish that iteration, so it'll start a new one.
    - it'll peek at the first thing on the delayed call queue, to see how
      long until something needs to be called
    - it will then check for IO events using select (or poll, or kqueue,
      or ...).  It passes the time to the next event as the timeout for the
      select call, so if there's been no unprocessed network activity since
      the last iteration, it will block until that timeout, or there is some
      activity (which ever happens first).
    - If there's any IO events to be processed, it calls the relevant event
      handlers.  In my example above, perhaps a message from a client just
      arrived, this will lead (via a few layers of abstraction) to a
      protocol's dataReceived method being called (which in turn may call a
      'messageReceived' handler and spawn a database query, or something).
    - After the IO events have been processed, it will finally turn its
      attention back to the delayed call queue, find all of them that are
      now due, and run those.
    - And then the next reactor iteration will happen.

So, every time you call reactor.callLater(0, func) and return back to the
reactor, rather than doing the work immediately, you're giving the reactor a
chance to breath and catch up on any other events that have been happening
-- but it will get back to your work as soon as it has.  If there's nothing
else happening, then your task will be getting 100% of the CPU time, minus the
overhead of jumping back-and-forth between the reactor and your functions
periodically to make sure nothing else needs Twisted's attention.

I hope I've made things clearer, rather than just confusing them :)

-Andrew.




From syver at inout.no  Wed Aug  6 05:50:12 2003
From: syver at inout.no (Syver Enstad)
Date: 06 Aug 2003 11:50:12 +0200
Subject: [Twisted-Python] callback conventions
In-Reply-To: <200308051801.00365.twisted@goldenspud.com>
References: <200308051801.00365.twisted@goldenspud.com>
Message-ID: <u7k5rnmi3.fsf@inout.no>

"Matthew R. Scott" <twisted at goldenspud.com> writes:

> Others may already use this, but we speculated that the reason it is not in 
> widespread use is because prior to python2.2 the scoping rules for 
> functions-inside-functions made it more difficult to do this easily.

That is true. Out of the box only 2.2 an onwards have nested scopes
(you could enable them with a from __future__ in 2.1

That said coincidences had it that I just starting doing local
function as deferred callbacks yesterday.




From tv at twistedmatrix.com  Wed Aug  6 04:08:23 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Wed, 6 Aug 2003 11:08:23 +0300
Subject: [Twisted-Python] Unruly Callback Code
In-Reply-To: <20030805183206.30A8E38D0F@www.fastmail.fm>
References: <20030805140231.A321218591@www.fastmail.fm> <20030805160244.GA32531@lapdog> <20030805183206.30A8E38D0F@www.fastmail.fm>
Message-ID: <20030806080823.GB1777@lapdog>

On Tue, Aug 05, 2003 at 12:32:06PM -0600, Justin Johnson wrote:
> 		def gotObject(perspective, vobs, group, original_site, sites):
> 			d = perspective.callRemote("mkvob", vobs, group)
> 			d.addCallback(renameReplica, perspective, vobs, original_site)
> 			d.addCallback(mkRepExport, perspective, vobs, sites)
> 			d.addCallback(mkRepImport, perspective, vobs, sites)
> 			d.addErrback(log.err)
> 			d.addBoth(_stop)
> 			return d
> 
> 		# Connect to the server and start the chain of deferreds
> 		d = self.connectToServer(config.siteToServer[original_site])
> 		d.addCallback(gotObject, vobs, group, original_site, sites)
> 		reactor.run()

	I'd do stopping and error handling near reactor.run()

		def gotObject(perspective, vobs, group, original_site, sites):
			d = perspective.callRemote("mkvob", vobs, group)
			d.addCallback(renameReplica, perspective, vobs, original_site)
			d.addCallback(mkRepExport, perspective, vobs, sites)
			d.addCallback(mkRepImport, perspective, vobs, sites)
			return d

		# Connect to the server and start the chain of deferreds
		d = self.connectToServer(config.siteToServer[original_site])
		d.addCallback(gotObject, vobs, group, original_site, sites)
		d.addErrback(log.err)
		d.addBoth(_stop)
		reactor.run()

-- 
:(){ :|:&};:



From nico at tekNico.net  Wed Aug  6 06:18:42 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Wed, 06 Aug 2003 12:18:42 +0200
Subject: [Twisted-Python] Breaking up long computations
In-Reply-To: <20030806095027.GA11724@frobozz>
References: <3F30C295.6010404@tekNico.net> <20030806095027.GA11724@frobozz>
Message-ID: <3F30D602.9020406@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> - check that there are no more scheduled events that need to be run *in
>   this iteration*.  It *won't* pull anything off the delayed call queue
>   that wasn't there before it started processing delayed calls.  Let's
>   assume there's nothing else to do here.  [I'm guessing this is the bit
>   you weren't getting, but I'll tell complete story anyway, just in case]
> - then the reactor will finish that iteration, so it'll start a new one.
> - it'll peek at the first thing on the delayed call queue, to see how
>   long until something needs to be called
> - it will then check for IO events using select (or poll, or kqueue, or
>   ...).  It passes the time to the next event as the timeout for the
>   select call, so if there's been no unprocessed network activity since
>   the last   iteration, it will block until that timeout, or there is
>   some activity (which ever happens first).
> - If there's any IO events to be processed, it calls the relevant event
>   handlers.  In my example above, perhaps a message from a client just
>   arrived, this will lead (via a few layers of abstraction) to a
>   protocol's dataReceived method being called (which in turn may call a
>   'messageReceived' handler and spawn a database query, or something).
> - After the IO events have been processed, it will finally turn its
>   attention back to the delayed call queue, find all of them that are now
>   due, and run those.
> - And then the next reactor iteration will happen.

So, the reactor goes back and forth between the select and the call queue at
each iteration, that's what I was overlooking.


> I hope I've made things clearer, rather than just confusing them :)

Yes, you've been most helpful, thanks.


- --
"Unlike some other scripting languages, Python syntax tends to be in
words rather than typographical syntax - it's very unlikely you'll be
writing lines of code that look like comic book curse words. As a result,
when you have to come back to your code six months later, odds are you
will still be able to understand it."  Samuele Pedroni and Noel Rappin

Nicola Larosa - nico at tekNico.net
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/MNYAXv0hgDImBm4RAp10AJ0R+FFqkh5Oeb314OX24FZvaIPYQgCfV97q
IyHhf9ugv8o/SdBZqdJUxpw=
=bUvg
-----END PGP SIGNATURE-----





From justinjohnson at fastmail.fm  Wed Aug  6 08:03:42 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Wed, 06 Aug 2003 06:03:42 -0600
Subject: [Twisted-Python] Unruly Callback Code
In-Reply-To: <20030806080823.GB1777@lapdog>
References: <20030805140231.A321218591@www.fastmail.fm> <20030805160244.GA32531@lapdog> <20030805183206.30A8E38D0F@www.fastmail.fm> <20030806080823.GB1777@lapdog>
Message-ID: <20030806120342.2D22C38C91@www.fastmail.fm>

Thanks for all your help.

On Wed, 6 Aug 2003 11:08:23 +0300, "Tommi Virtanen"
<tv at twistedmatrix.com> said:
> On Tue, Aug 05, 2003 at 12:32:06PM -0600, Justin Johnson wrote:
> > 		def gotObject(perspective, vobs, group, original_site, sites):
> > 			d = perspective.callRemote("mkvob", vobs, group)
> > 			d.addCallback(renameReplica, perspective, vobs, original_site)
> > 			d.addCallback(mkRepExport, perspective, vobs, sites)
> > 			d.addCallback(mkRepImport, perspective, vobs, sites)
> > 			d.addErrback(log.err)
> > 			d.addBoth(_stop)
> > 			return d
> > 
> > 		# Connect to the server and start the chain of deferreds
> > 		d = self.connectToServer(config.siteToServer[original_site])
> > 		d.addCallback(gotObject, vobs, group, original_site, sites)
> > 		reactor.run()
> 
> 	I'd do stopping and error handling near reactor.run()
> 
> 		def gotObject(perspective, vobs, group, original_site, sites):
> 			d = perspective.callRemote("mkvob", vobs, group)
> 			d.addCallback(renameReplica, perspective, vobs, original_site)
> 			d.addCallback(mkRepExport, perspective, vobs, sites)
> 			d.addCallback(mkRepImport, perspective, vobs, sites)
> 			return d
> 
> 		# Connect to the server and start the chain of deferreds
> 		d = self.connectToServer(config.siteToServer[original_site])
> 		d.addCallback(gotObject, vobs, group, original_site, sites)
> 		d.addErrback(log.err)
> 		d.addBoth(_stop)
> 		reactor.run()
> 
> -- 
> :(){ :|:&};:
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From rdrb at 123.cl  Wed Aug  6 09:50:04 2003
From: rdrb at 123.cl (RITA Y/O RODRIGO DIAZ Y/O BENENSON)
Date: Wed, 06 Aug 2003 09:50:04 -0400
Subject: [Twisted-Python] ParagraphText refuse to work
Message-ID: <9c99a9bb05.9bb059c99a@noborrar.co.cl>

Hi!

I have posted this question some time ago, but I got no answer.
I'm making a very simple Woven program that publish over web the content of a complex objects structure. So I created an IModel interface for the object.

The problem that I have is that some elements of the model return Strings. So I use the ParagraphText view. But it does not work as espected.

It should render "a\nb\nc" as:

<p>a</p><p>b</p><p>c</p>

but I only get:

<p>abc</p>

if I change ParagraphText by a Text view I got:

a
b
c


So it seems that the data arrive fine, but is not render as expected.

Where is the problem ?

I have checked the CVS but the code looks the same as for Twisted 1.0.6 (and with 1.0.5 the behaviour was the same).

I suppose that I'm doing something wrong. Please, support...


RodrigoB.








From lheller at atdesk.com  Wed Aug  6 10:54:24 2003
From: lheller at atdesk.com (Lance Heller)
Date: Wed, 06 Aug 2003 10:54:24 -0400
Subject: [Twisted-Python] gtk manhole
Message-ID: <200308061454.h76EsOui013568@localhost.localdomain>

Hello,
	
	While I've some experience with Python, I'm new to twisted.
I've just completed an install of Twisted-1.0.6 on my RH8.0 system:

Linux version 2.4.18-26.8.0smp (bhcompile at daffy.perf.redhat.com) (gcc version 3.2 20020903 (Red Hat Linux 8.0 3.2-7)) #1 SMP Mon Feb 24 09:44:00 EST 2003

Python 2.2.1 (#1, Aug 30 2002, 12:15:30) 
[GCC 3.2 20020822 (Red Hat Linux Rawhide 3.2-4)] on linux2
Type "help", "copyright", "credits" or "license" for more information.


However I'm having a problem getting manhole up and going:

programmer130:../lheller-1388: manhole
Traceback (most recent call last):
  File "/usr/bin/manhole", line 34, in ?
    manhole.run()
  File "/usr/lib/python2.2/site-packages/twisted/scripts/manhole.py", line 114, in run
    run(config)
  File "/usr/lib/python2.2/site-packages/twisted/scripts/manhole.py", line 124, in run_gtk1
    from twisted.spread.ui import gtkutil
  File "/usr/lib/python2.2/site-packages/twisted/spread/ui/gtkutil.py", line 62, in ?
    class GetString(gtk.GtkWindow):
AttributeError: 'module' object has no attribute 'GtkWindow'


I've installed these components in addition to Twisted:
pyOpenSSL-0.5.1,  pycrypto-1.9a6,  pyserial-1.19

and have these packages on the system:

gtk-engines-0.11-13
usermode-gtk-1.63-1
gtk+-1.2.10-22
gtkam-0.1.4-6
gnome-python2-gtkhtml2-1.99.11-8
pygtk2-1.99.12-7
rep-gtk-0.16.0.90-4
gtk2-2.0.6-8
authconfig-gtk-4.2.12-3
gtk2-engines-1.9.0-4
gtkhtml-devel-1.0.4-3
gtkhtml2-2.0.1-2
mtr-gtk-0.49-7
gtk+-devel-1.2.10-22
pygtk2-libglade-1.99.12-7
gtk2-devel-2.0.6-8
pygtk2-devel-1.99.12-7

pygtk2-1.99.12-7
python-devel-2.2.1-17
python-2.2.1-17
pygtk2-libglade-1.99.12-7
python-tools-2.2.1-17
pyOpenSSL-0.5.0.91-1
rpm-python-4.1-1.06
mod_python-3.0.0-10


What am I missing here that disables manholes GTK functionality?

Any pointers or suggestions you may have will be greatly appreciated.


Lance


----------------------------------------------------------------------
   Lance Heller                  |      ATD
   Software Engineer             |      11 eWall Street
   lheller at atdesk.com            |      Mount Pleasant, SC
   voice: (834)789-2146          |      29464, USA
   fax:   (834)789-2010          |      www.atdesk.com
----------------------------------------------------------------------

-- 
047CF18A: 55F1 FF14 0620 1B7F A82E  B5F8 3C94 02F7 047C F18A
8B7C7901: 424F 17DB 5683 6A18 CDD6  6C65 5E1E 9F86 8B7C 7901
5F648A7E: 8B86 24FB 1CD9 C997 C2A3  9E5D 16BD 5F7F 5F64 8A7E


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030806/ff637da7/attachment.pgp 

From itamar at itamarst.org  Wed Aug  6 10:58:26 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 6 Aug 2003 10:58:26 -0400
Subject: [Twisted-Python] Breaking up long computations
In-Reply-To: <3F30C295.6010404@tekNico.net>
References: <3F30C295.6010404@tekNico.net>
Message-ID: <20030806105826.6aaa5989.itamar@itamarst.org>

On Wed, 06 Aug 2003 10:55:49 +0200
Nicola Larosa <nico at tekNico.net> wrote:

> Let's say I have a matrix and want to make some computation on its
> elements(this does not involve Numeric or numarray, by the way, it's
> just an example):

If it does, you should use a thread, since hopefully they release the
global interpreter lock and thus will be faster on SMP machines, and
maybe even regular machines.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From R.Livsey at cache-22.co.uk  Wed Aug  6 11:18:53 2003
From: R.Livsey at cache-22.co.uk (RLivsey)
Date: Wed, 06 Aug 2003 16:18:53 +0100
Subject: [Twisted-Python] Advice on starting a project
Message-ID: <3F311C5D.2000405@cache-22.co.uk>

Hi, I'm fairly new to python and Twisted (ok fairly is an 
understatement) so bare with me :o)

I'm about to start development of a chat style system.
The basic system will be setup as follows:

A number of chat clients designed/programmed in FlashMX.
A server using Twisted.

The clients will communicate with each other via the server using 
XML-sockets. I have managed to get a Flash app communicating with the 
server based on the echo sample whereby Flash sends a message and then 
receives a message. This works fine.

However I am now trying to figure out how to get the clients to talk to 
each other and I cant work out how it will work.

How would I get a list of clients currently connected so that I can send 
a message from one client to its recipient?

Any advice on what to look at and any examples that would be useful?

The final app will use the abilities of Twisted more by having the 
ability for admins to monitor activity etc on IRC and telnet etc.. but 
for the moment I'm just trying to figure out the basics.

Cheers.

-- 
R.Livsey
Incutio Web Developer
[ PHP | Perl | Java | C# ]
www.cache-22.co.uk
www.incutio.com






From rich at enflyer.com  Wed Aug  6 13:10:20 2003
From: rich at enflyer.com (Rich Cavanaugh)
Date: Wed, 6 Aug 2003 13:10:20 -0400
Subject: [Twisted-Python] ParagraphText refuse to work
In-Reply-To: <9c99a9bb05.9bb059c99a@noborrar.co.cl>
Message-ID: <DBBCDB12-C830-11D7-84C2-000A95890854@enflyer.com>

Attached is a minor patch to widgets.py that should correct this. I 
haven't tested this though.

rich
-------------- next part --------------
A non-text attachment was scrubbed...
Name: widgets.py-paratext.patch
Type: application/applefile
Size: 1435 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030806/5fd4e540/attachment.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: widgets.py-paratext.patch
Type: application/octet-stream
Size: 812 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030806/5fd4e540/attachment.obj 
-------------- next part --------------


On Wednesday, August 6, 2003, at 09:50 AM, RITA Y/O RODRIGO DIAZ Y/O 
BENENSON wrote:

> Hi!
>
> I have posted this question some time ago, but I got no answer.
> I'm making a very simple Woven program that publish over web the 
> content of a complex objects structure. So I created an IModel 
> interface for the object.
>
> The problem that I have is that some elements of the model return 
> Strings. So I use the ParagraphText view. But it does not work as 
> espected.
>
> It should render "a\nb\nc" as:
>
> <p>a</p><p>b</p><p>c</p>
>
> but I only get:
>
> <p>abc</p>
>
> if I change ParagraphText by a Text view I got:
>
> a
> b
> c
>
>
> So it seems that the data arrive fine, but is not render as expected.
>
> Where is the problem ?
>
> I have checked the CVS but the code looks the same as for Twisted 
> 1.0.6 (and with 1.0.5 the behaviour was the same).
>
> I suppose that I'm doing something wrong. Please, support...
>
>
> RodrigoB.
>
>
>
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

From radix at twistedmatrix.com  Wed Aug  6 14:13:38 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Wed, 6 Aug 2003 14:13:38 -0400
Subject: [Twisted-Python] Deferred.setTimeout sucks
Message-ID: <20030806181338.GD11752@radii>

I've implemented a better API than setTimeout for
Deferreds. Description and patch are here:

http://twistedmatrix.com/bugs/issue178

If it's accepted, I'll update HOWTOs and usages of setTimeout.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From peter at engcorp.com  Wed Aug  6 14:20:45 2003
From: peter at engcorp.com (Peter Hansen)
Date: Wed, 06 Aug 2003 14:20:45 -0400
Subject: [Twisted-Python] Re: [Zope3-dev] twisted zope
References: <69427200-C17B-11D7-A7D5-000393C9700E@twistedmatrix.com>
Message-ID: <3F3146FD.ACC2C7CF@engcorp.com>

Glyph Lefkowitz wrote:
> 
> On Monday, July 28, 2003, at 01:20 PM, Gary Poster wrote:
> 
> > Oh yeah, forgot about that.  I've seen several discussions of the
> > licensing on the Twisted list... Maybe Phil Eby's implementation is
> > the only way out of that one.
> 
> The whole point of those discussions has generally been that the
> current structure is important to make relicensing a possibility :-).
> 
> While twisted as a whole is being very actively (one might even say
> "agressively") developed, some portions of the framework, like the core
> reactor, seem to be extremely stable at this point.
> 
> (Please, chime in if you disagree.)

<chime chime>

I mentioned in the past a concern that the default SelectReactor 
was being created with default variables that bind to globals for
the read and write lists that are passed to select.select().  Among
other things, it's ugly as sin, probably doesn't help performance 
much anyway, prevents creating multiple *separate* reactors (very
useful in, for example, proper unit and acceptance testing), and
has caused us at least some trouble with respect to stopping and
restarting reactors (because the globals aren't cleaned out 
properly at any point).

(Disclaimer: these comments are not based on the current Twisted,
but release 1.0.3 or 4, as I recall, but if this part has really
been "stable" then I doubt anything has changed much here.)

The last (first) time I suggested changes, the answer was a fairly
clear "we don't plan to change this ever", but if there's any
willingness to consider changes, then even the core reactor
might not be considered "extremely stable" at this point.

-Peter



From itamar at itamarst.org  Wed Aug  6 14:40:24 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 6 Aug 2003 14:40:24 -0400
Subject: [Twisted-Python] Re: [Zope3-dev] twisted zope
In-Reply-To: <3F3146FD.ACC2C7CF@engcorp.com>
References: <69427200-C17B-11D7-A7D5-000393C9700E@twistedmatrix.com>
	<3F3146FD.ACC2C7CF@engcorp.com>
Message-ID: <20030806144024.37bbd84e.itamar@itamarst.org>

On Wed, 06 Aug 2003 14:20:45 -0400
Peter Hansen <peter at engcorp.com> wrote:

> The last (first) time I suggested changes, the answer was a fairly
> clear "we don't plan to change this ever", but if there's any
> willingness to consider changes, then even the core reactor
> might not be considered "extremely stable" at this point.

The internals may change in this case, but the *API* will be identical.
So as far as users of Twisted are concerned it won't matter.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From itamar at itamarst.org  Wed Aug  6 14:41:27 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 6 Aug 2003 14:41:27 -0400
Subject: Please add bugs and patches to the issue tracker (was
 [Twisted-Python] ParagraphText refuse to work)
In-Reply-To: <DBBCDB12-C830-11D7-84C2-000A95890854@enflyer.com>
References: <9c99a9bb05.9bb059c99a@noborrar.co.cl>
	<DBBCDB12-C830-11D7-84C2-000A95890854@enflyer.com>
Message-ID: <20030806144127.2fce33f8.itamar@itamarst.org>

On Wed, 6 Aug 2003 13:10:20 -0400
Rich Cavanaugh <rich at enflyer.com> wrote:

> Attached is a minor patch to widgets.py that should correct this. I 
> haven't tested this though.

Could you please add patches to the tracker?

http://www.twistedmatrix.com/bugs/


-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From twisted at goldenspud.com  Wed Aug  6 15:10:31 2003
From: twisted at goldenspud.com (Matthew R. Scott)
Date: Wed, 6 Aug 2003 14:10:31 -0500
Subject: [Twisted-Python] possible patch for twisted.mail.protocols
In-Reply-To: <200308051737.43922.twisted@goldenspud.com>
References: <200308051737.43922.twisted@goldenspud.com>
Message-ID: <200308061410.31301.twisted@goldenspud.com>

On Tue 2003-08-05 17:37, Matthew R. Scott wrote:
> Here is the patch for the changes I made to make both do the "right thing".

I noticed the trend is to upload patches to the bug tracker, so I've done that 
with this patch.


-- 
Matthew R. Scott
OMAjA / http://www.omaja.com/




From glyph at twistedmatrix.com  Wed Aug  6 15:57:29 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 6 Aug 2003 14:57:29 -0500
Subject: [Twisted-Python] Re: Flag storing broke in IMAP4Client
In-Reply-To: <87r83zfvr2.fsf@complete.org>
Message-ID: <35DCCDFC-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>

On Tuesday, August 5, 2003, at 07:57 PM, John Goerzen wrote:

> Am I the only one using IMAP4Client for serious work?  (This is not a
> rhetorical or accusatory question; merely an honest inquiry)

Nope.  We are too.

	http://www.divmod.org/

However, we are waiting for the maintainer to get back from vacation.




From glyph at twistedmatrix.com  Wed Aug  6 15:59:09 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 6 Aug 2003 14:59:09 -0500
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <ud6fjnmn3.fsf@inout.no>
Message-ID: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>

On Wednesday, August 6, 2003, at 04:47 AM, Syver Enstad wrote:

> I found a bug by the way:

Enter it into the bugtracker, please?  http://www.twistedmatrix.com/bugs




From peter at engcorp.com  Wed Aug  6 16:06:50 2003
From: peter at engcorp.com (Peter Hansen)
Date: Wed, 06 Aug 2003 16:06:50 -0400
Subject: [Twisted-Python] Re: [Zope3-dev] twisted zope
References: <69427200-C17B-11D7-A7D5-000393C9700E@twistedmatrix.com>
		<3F3146FD.ACC2C7CF@engcorp.com> <20030806144024.37bbd84e.itamar@itamarst.org>
Message-ID: <3F315FDA.F3BF5B70@engcorp.com>

Itamar Shtull-Trauring wrote:
> 
> On Wed, 06 Aug 2003 14:20:45 -0400
> Peter Hansen <peter at engcorp.com> wrote:
> 
> > The last (first) time I suggested changes, the answer was a fairly
> > clear "we don't plan to change this ever", but if there's any
> > willingness to consider changes, then even the core reactor
> > might not be considered "extremely stable" at this point.
> 
> The internals may change in this case, but the *API* will be identical.
> So as far as users of Twisted are concerned it won't matter.

There's certainly little need for an API change to make this work
better, except for the odd existing method which does not take
an external reactor argument but simply finds the global one 
magically and uses it.  I believe there was a transition happening
to clean this up so that all such methods allowed a reactor to
be passed in, so other than this aspect, I agree no API change 
should happen (nor is one needed).

-Peter



From syver-en at online.no  Wed Aug  6 19:42:33 2003
From: syver-en at online.no (Syver Enstad)
Date: 07 Aug 2003 01:42:33 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>
References: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>
Message-ID: <u65la5p5i.fsf@online.no>

Glyph Lefkowitz <glyph at twistedmatrix.com> writes:

> On Wednesday, August 6, 2003, at 04:47 AM, Syver Enstad wrote:
> 
> > I found a bug by the way:
> 
> Enter it into the bugtracker, please?
> http://www.twistedmatrix.com/bugs

Done.

Should this work?

In some template:
    <tr>
        <td model="deferredModel/One" view="Text">List item here</td>
        <td model="deferredModel/Two" view="Text">List item here</td>
    </tr>

class MyModel(MethodModel):
    def wmfactory_deferredModel(self, request):
        .....
        return deferred # promises to be a dictionary


As it is now this fails in lookupSubmodel / getSubmodel, because the
DeferredWrapper has not got a submodel named One.



-- 

Vennlig hilsen 

Syver Enstad




From edmundd at eSentire.com  Wed Aug  6 19:42:17 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Wed, 6 Aug 2003 19:42:17 -0400 (EDT)
Subject: [Twisted-Python] Woven and XSL
Message-ID: <Pine.BSO.4.44.0308061938180.25785-100000@cyclops4.esentire.com>

Hi all!

Having a look at the Woven component, and I have a question. Does Woven
support some form of XSL transformations, or would I need to "emulate"
this feature by using extremely simple XHTML pages (basically begin/end
HTML with a model/view call), perform said transformations internally, and
return a ready to render DOM model?

The reason I ask is we are using some fairly complex XSL code to render
pages to maintain a consistent look and feel (things such as placing the
alignment in the header of a table, which will then be fed down through
each cell unless overridden). To try and do things with XHTML would
require replicating a lot of format code manually throughout the page. Is
there a different model with Woven that I should be looking at?

Regards!
Ed





From itamar at itamarst.org  Wed Aug  6 19:50:27 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 6 Aug 2003 19:50:27 -0400
Subject: [Twisted-Python] Woven and XSL
In-Reply-To: <Pine.BSO.4.44.0308061938180.25785-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308061938180.25785-100000@cyclops4.esentire.com>
Message-ID: <20030806195027.48e8dfbd.itamar@itamarst.org>

On Wed, 6 Aug 2003 19:42:17 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> require replicating a lot of format code manually throughout the page.
> Is there a different model with Woven that I should be looking at?

Look at the examples for using widgets.ExpandMacro in the mailing list
archives (same approach as ZPT's METAL).

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From dp at twistedmatrix.com  Wed Aug  6 22:44:01 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Wed, 6 Aug 2003 19:44:01 -0700
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <u65la5p5i.fsf@online.no>
References: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com> <u65la5p5i.fsf@online.no>
Message-ID: <008ED3F1-C881-11D7-9429-000A95864FC4@twistedmatrix.com>

On Wednesday, August 6, 2003, at 4:42 PM, Syver Enstad wrote:
>
> Should this work?
>
> In some template:
>     <tr>
>         <td model="deferredModel/One" view="Text">List item here</td>
>         <td model="deferredModel/Two" view="Text">List item here</td>
>     </tr>
>
> class MyModel(MethodModel):
>     def wmfactory_deferredModel(self, request):
>         .....
>         return deferred # promises to be a dictionary
>
>
> As it is now this fails in lookupSubmodel / getSubmodel, because the
> DeferredWrapper has not got a submodel named One.

This will not work, and I can't justify the effort required to make it 
work. Do it like this instead:

<tr model="deferredModel" view="None">
	<td model="One">...</td>
	<td model="Two">...</td>
</tr>

dp




From tim.andrews at adpro.com.au  Thu Aug  7 01:38:33 2003
From: tim.andrews at adpro.com.au (Tim Andrews)
Date: Thu, 7 Aug 2003 15:08:33 +0930
Subject: [Twisted-Python] trouble with registering an IModel adapter
Message-ID: <MIEKLAIKJGMEAEJNJKJAEEAKCBAA.tim.andrews@adpro.com.au>

Hi folks,

I copied the following code from the manual, but keep on getting exceptions.
Any clues?

Thanks,

Tim

# Demonstration of registering an IModel adapter
#
# Copied from "The Twisted Documentation" section 7.3.5
#
# Raises the following exception:
#
#   exceptions.AttributeError: MyDataModel instance has no attribute 'orig'

from twisted.web.woven import model, page

template = """
  <html>
   <body>
     <h2 model="something" view="Text">something stuff goes here!</h2>
    </body>
  </html>
"""

class MyData:
  def __init__(self, something=""):
    self.something = something

class MyDataModel(model.MethodModel):
  def wmfactory_something(self, request):
    return self.orig.something

from twisted.python import components
from twisted.web.woven import interfaces

components.registerAdapter(MyDataModel, MyData, interfaces.IModel)

resource = page.Page(MyDataModel(), template=template)




From dp at twistedmatrix.com  Thu Aug  7 01:46:57 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Wed, 6 Aug 2003 22:46:57 -0700
Subject: [Twisted-Python] trouble with registering an IModel adapter
In-Reply-To: <MIEKLAIKJGMEAEJNJKJAEEAKCBAA.tim.andrews@adpro.com.au>
References: <MIEKLAIKJGMEAEJNJKJAEEAKCBAA.tim.andrews@adpro.com.au>
Message-ID: <8EDDE785-C89A-11D7-9429-000A95864FC4@twistedmatrix.com>

On Wednesday, August 6, 2003, at 10:38 PM, Tim Andrews wrote:

> Hi folks,
>
> I copied the following code from the manual, but keep on getting 
> exceptions.
> Any clues?
>
> Thanks,
>
> Tim
>
> # Demonstration of registering an IModel adapter
> #
> # Copied from "The Twisted Documentation" section 7.3.5
> #
> # Raises the following exception:
> #
> #   exceptions.AttributeError: MyDataModel instance has no attribute 
> 'orig'

That example must be very, very old. It should be 'original', like any 
other Adapter, not 'orig'.

dp




From tard at 2kservices.com  Thu Aug  7 03:00:45 2003
From: tard at 2kservices.com (Alexander Zhukov)
Date: Thu, 7 Aug 2003 11:00:45 +0400
Subject: [Twisted-Python] Advice on starting a project
In-Reply-To: <3F311C5D.2000405@cache-22.co.uk>
References: <3F311C5D.2000405@cache-22.co.uk>
Message-ID: <481364389338.20030807110045@2kservices.com>

Hello RLivsey,

Wednesday, August 6, 2003, 7:18:53 PM, you wrote:

R> How would I get a list of clients currently connected so that I can send
R> a message from one client to its recipient?
R> Any advice on what to look at and any examples that would be useful?

I'm new to twisted too and work on a similar project now (twisted
on serverside and flash and C# on clientside).

I'm not sure if it's the right way in twisted, but this example
receivs lines from one connection and writes them to all other
connections.

from twisted.internet.protocol import Factory
from twisted.protocols.basic import LineReceiver
from twisted.internet import reactor

class Chat(LineReceiver):
    def connectionMade(self):
        self.factory.addClient(self)

    def lineReceived(self,line):
        self.factory.sendAll(line)

    def connectionLost(self, reason):
        self.factory.removeClient(self)

class MyFactory(Factory):

    protocol = Chat

    def startFactory(self):
        self.clients = []

    def addClient(self,cli):
        self.clients.append(cli)

    def removeClient(self,cli):
        self.clients.remove(cli)

    def sendAll(self,msg):
        [cli.sendLine(msg) for cli in self.clients]

def main():
    f = MyFactory()
    reactor.listenTCP(8000, f)
    reactor.run()

if __name__ == '__main__':
    main()

-- 
Best regards,
 Alexander                            mailto:tard at 2kservices.com




From syver at inout.no  Thu Aug  7 06:03:48 2003
From: syver at inout.no (Syver Enstad)
Date: 07 Aug 2003 12:03:48 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <008ED3F1-C881-11D7-9429-000A95864FC4@twistedmatrix.com>
References: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>
	<u65la5p5i.fsf@online.no>
	<008ED3F1-C881-11D7-9429-000A95864FC4@twistedmatrix.com>
Message-ID: <uznil2396.fsf@inout.no>

Donovan Preston <dp at twistedmatrix.com> writes:

> On Wednesday, August 6, 2003, at 4:42 PM, Syver Enstad wrote:
> >
> > Should this work?
> >
> > In some template:
> >     <tr>
> >         <td model="deferredModel/One" view="Text">List item here</td>
> >         <td model="deferredModel/Two" view="Text">List item here</td>
> >     </tr>
> >
> > class MyModel(MethodModel):
> >     def wmfactory_deferredModel(self, request):
> >         .....
> >         return deferred # promises to be a dictionary
> >
> >
> > As it is now this fails in lookupSubmodel / getSubmodel, because the
> > DeferredWrapper has not got a submodel named One.
> 
> This will not work, and I can't justify the effort required to make it
> work. Do it like this instead:

The view must be Widget in my experience because DefaultWidget doesn't
handle deferreds in generate.

> <tr model="deferredModel" view="None">
<tr model="deferredModel" view="Widget">
> 	<td model="One">...</td>
> 	<td model="Two">...</td>
> </tr>






From radix at twistedmatrix.com  Thu Aug  7 09:06:46 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Thu, 7 Aug 2003 09:06:46 -0400
Subject: [Twisted-Python] Advice on starting a project
In-Reply-To: <481364389338.20030807110045@2kservices.com>
References: <3F311C5D.2000405@cache-22.co.uk> <481364389338.20030807110045@2kservices.com>
Message-ID: <20030807130646.GA964@radii>

On Thu, Aug 07, 2003 at 11:00:45AM +0400, Alexander Zhukov wrote:
> Wednesday, August 6, 2003, 7:18:53 PM, you wrote:
> 
> R> How would I get a list of clients currently connected so that I can send
> R> a message from one client to its recipient?
> R> Any advice on what to look at and any examples that would be useful?
> 
> I'm new to twisted too and work on a similar project now (twisted
> on serverside and flash and C# on clientside).
> 
> I'm not sure if it's the right way in twisted, but this example
> receivs lines from one connection and writes them to all other
> connections.

Yep, this is a good example.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From int at mtx.ru  Thu Aug  7 10:01:02 2003
From: int at mtx.ru (Pavel Volkovitskiy)
Date: 07 Aug 2003 18:01:02 +0400
Subject: [Twisted-Python] im gtk2 port
Message-ID: <1060264862.17907.9.camel@int.matrixtelecom.net>

Does im gtk2 port exist?

---
Pavel






From mesozoic at polynode.com  Thu Aug  7 13:37:10 2003
From: mesozoic at polynode.com (Alex Levy)
Date: Thu, 7 Aug 2003 13:37:10 -0400
Subject: [Twisted-Python] Woven and XSL
In-Reply-To: <20030806195027.48e8dfbd.itamar@itamarst.org>
References: <Pine.BSO.4.44.0308061938180.25785-100000@cyclops4.esentire.com> <20030806195027.48e8dfbd.itamar@itamarst.org>
Message-ID: <20030807173710.GA8938@perpetual.moxn.net>

On Wed, Aug 06, 2003 at 07:50:27PM -0400, Itamar Shtull-Trauring wrote:
> On Wed, 6 Aug 2003 19:42:17 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
> 
> > require replicating a lot of format code manually throughout the page.
> > Is there a different model with Woven that I should be looking at?
> 
> Look at the examples for using widgets.ExpandMacro in the mailing list
> archives (same approach as ZPT's METAL).

http://www.twistedmatrix.com/pipermail/twisted-python/2003-June/004662.html

(to save you some time)

-- 
Alex Levy
WWW: http://mesozoic.geecs.org
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_



From dp at twistedmatrix.com  Thu Aug  7 16:11:18 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Thu, 7 Aug 2003 13:11:18 -0700
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <uznil2396.fsf@inout.no>
References: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com> <u65la5p5i.fsf@online.no> <008ED3F1-C881-11D7-9429-000A95864FC4@twistedmatrix.com> <uznil2396.fsf@inout.no>
Message-ID: <4E237BDE-C913-11D7-9AF6-000A95864FC4@twistedmatrix.com>

On Thursday, August 7, 2003, at 3:03 AM, Syver Enstad wrote:
>
> The view must be Widget in my experience because DefaultWidget doesn't
> handle deferreds in generate.

Right. Doh. Someone file a bug.

dp





From pyp at gmx.net  Thu Aug  7 21:47:45 2003
From: pyp at gmx.net (Mike Mueller)
Date: Fri, 08 Aug 2003 03:47:45 +0200
Subject: [Twisted-Python] Win32 installer for Python2.3
Message-ID: <5.2.1.1.1.20030808033600.00ab90f0@pop.gmx.net>

I am looking for twisted1.0.6 for Python 2.3 for Windows. There is a 
installer for Python2.2, but I could not find anything for 2.3. I do have 
VC++ 6.0 but could not figure out how to compile from the UNIX sources.

It would be nice if somebody could help me.

Thanks.

Mike




From edmundd at eSentire.com  Fri Aug  8 01:19:53 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Fri, 8 Aug 2003 01:19:53 -0400 (EDT)
Subject: [Twisted-Python] Woven and sessions
Message-ID: <Pine.BSO.4.44.0308080104300.30471-100000@cyclops4.esentire.com>

Okay, been playing around with the session stuff. Still trying to get my
head around how ths is structured.

Created a site. Created a single child "xxx". Created a session wrapped
child "yyy".

Now,
   "http://localhost:8080/xxx/session-init/yyy"
will cause a cookie to be loaded, and a redirect to
   "http://localhost:8080/xxx/yyy?__session_just_started__=1"
if I accept the cookie.  Rejecting the cookie causes something akin to
   "http://localhost:8080/xxx/e11a075ad25656dca2b90022507746b6/yyy"
to be loaded.

If I type:
   "http://localhost:8080/xxx/yyy"
then I get to the appropriate page, with no cookie loaded.

Question 1: Can I suppress the "__session_just_started=1"?
Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
session?

I also noted a page talking about sandbox and pathargs, and : separated
arguments. Is this available, or should I look at creating a custom
resource?

What I am looking to do at the end is support sessioning whether or not
cookies are being allowed, and to allow URLs to be taken.

Question 3: I assume that all of this works similarly for perspective
wrappers? I was trying one Guard example I found on the net, and I am
having trouble actually causing the login page to appear (basically, I am
using the "perspective-init" in the URL, and I seem to get some other web
page with three input fields, rather than the supposedly specified login
page).

Aside Question: Is there a way to setup default error pages? I checked the
How To's and looked in the archives for a simple example, and couldn't
find any.

Regards!
Ed




From glyph at twistedmatrix.com  Fri Aug  8 01:43:13 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 8 Aug 2003 00:43:13 -0500
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <Pine.BSO.4.44.0308080104300.30471-100000@cyclops4.esentire.com>
Message-ID: <33D93BC8-C963-11D7-9301-000393C9700E@twistedmatrix.com>

On Friday, August 8, 2003, at 12:19 AM, Edmund Dengler wrote:

> Question 1: Can I suppress the "__session_just_started=1"?

Not at the moment.  It used to be off, but some browsers balked at the 
redirect cycle.

> Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
> session?

It should happen automatically.  Isn't it?

> I also noted a page talking about sandbox and pathargs, and : separated
> arguments. Is this available, or should I look at creating a custom
> resource?

This is available in sandbox/cce/pathargs.py .

> What I am looking to do at the end is support sessioning whether or not
> cookies are being allowed, and to allow URLs to be taken.

"allow URLs to be taken"?  Say again?

> Question 3: I assume that all of this works similarly for perspective
> wrappers? I was trying one Guard example I found on the net, and I am
> having trouble actually causing the login page to appear (basically, I 
> am
> using the "perspective-init" in the URL, and I seem to get some other 
> web
> page with three input fields, rather than the supposedly specified 
> login
> page).

PerspectiveWrapper is old, dying code.  Use the (badly-named) 
UsernamePasswordWrapper.  An example is in sandbox/glyph/dynademo/ .

> Aside Question: Is there a way to setup default error pages? I checked 
> the
> How To's and looked in the archives for a simple example, and couldn't
> find any.

No, but this is in the bugtracker:

http://www.twistedmatrix.com/users/roundup.twistd/twisted/issue135

Some patches are available.

Sorry for the dearth of documentation here.  The folks responsible for 
these bits of code have been very busy lately :)




From mmoellenbeck at plus.de  Fri Aug  8 02:35:29 2003
From: mmoellenbeck at plus.de (mmoellenbeck at plus.de)
Date: Fri, 8 Aug 2003 08:35:29 +0200
Subject: Antwort: [Twisted-Python] Win32 installer for Python2.3
Message-ID: <OFC082C4EB.41BD97C3-ONC1256D7C.0023E032@uz.tengelmann.de>

Simple go to the twisted-root (there is a setup.py) and type python 
setup.py bdist_wininst.

After that there will be a windows installer under dist.

Martin





An:     twisted-python at twistedmatrix.com
Kopie: 
 

Thema:  [Twisted-Python] Win32 installer for Python2.3

 
Mike Mueller <pyp at gmx.net>
Gesendet von:
twisted-python-admin at twistedmatrix.com
08.08.2003 03:47
Bitte antworten an twisted-python







I am looking for twisted1.0.6 for Python 2.3 for Windows. There is a 
installer for Python2.2, but I could not find anything for 2.3. I do have 
VC++ 6.0 but could not figure out how to compile from the UNIX sources.

It would be nice if somebody could help me.

Thanks.

Mike


_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python






From syver-en at online.no  Fri Aug  8 04:03:01 2003
From: syver-en at online.no (Syver Enstad)
Date: 08 Aug 2003 10:03:01 +0200
Subject: [Twisted-Python] Win32 installer for Python2.3
In-Reply-To: <5.2.1.1.1.20030808033600.00ab90f0@pop.gmx.net>
References: <5.2.1.1.1.20030808033600.00ab90f0@pop.gmx.net>
Message-ID: <uptjg8tl6.fsf@online.no>

Mike Mueller <pyp at gmx.net> writes:

> I am looking for twisted1.0.6 for Python 2.3 for Windows. There is a
> installer for Python2.2, but I could not find anything for 2.3. I do
> have VC++ 6.0 but could not figure out how to compile from the UNIX
> sources.
> 
> It would be nice if somebody could help me.

Hey Mike, it's very simple (as long as you have got MSVC 6). Go to the
root directory of the twisted source package. Type python setup.py
install.

Done!
 

-- 

Vennlig hilsen 

Syver Enstad




From edmundd at eSentire.com  Fri Aug  8 10:29:27 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Fri, 8 Aug 2003 10:29:27 -0400 (EDT)
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <33D93BC8-C963-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <Pine.BSO.4.44.0308081019360.3145-100000@cyclops4.esentire.com>


On Fri, 8 Aug 2003, Glyph Lefkowitz wrote:

>
> On Friday, August 8, 2003, at 12:19 AM, Edmund Dengler wrote:
>
> > Question 1: Can I suppress the "__session_just_started=1"?
>
> Not at the moment.  It used to be off, but some browsers balked at the
> redirect cycle.

I would question this. I have used a few systems that used redirects to
perform logins (via Apache, Resin) and I have yet to find a browser in
which this was an issue. Do you know specifically which ones?

>
> > Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
> > session?
>
> It should happen automatically.  Isn't it?

No it doesn't, which is an issue. I perform an /xxx/yyy, and I get the
page with no cookie set or placed in the URL.

>
> > I also noted a page talking about sandbox and pathargs, and : separated
> > arguments. Is this available, or should I look at creating a custom
> > resource?
>
> This is available in sandbox/cce/pathargs.py .
>
> > What I am looking to do at the end is support sessioning whether or not
> > cookies are being allowed, and to allow URLs to be taken.
>
> "allow URLs to be taken"?  Say again?

Sorry, "allow URLs to be bookmarked". I am trying to ensure that if a
person bookmarks a URL, that the next time they come in, they are
sessioned properly and that they will be logged in properly.

>
> > Question 3: I assume that all of this works similarly for perspective
> > wrappers? I was trying one Guard example I found on the net, and I am
> > having trouble actually causing the login page to appear (basically, I
> > am
> > using the "perspective-init" in the URL, and I seem to get some other
> > web
> > page with three input fields, rather than the supposedly specified
> > login
> > page).
>
> PerspectiveWrapper is old, dying code.  Use the (badly-named)
> UsernamePasswordWrapper.  An example is in sandbox/glyph/dynademo/ .
>
> > Aside Question: Is there a way to setup default error pages? I checked
> > the
> > How To's and looked in the archives for a simple example, and couldn't
> > find any.
>
> No, but this is in the bugtracker:
>
> http://www.twistedmatrix.com/users/roundup.twistd/twisted/issue135
>
> Some patches are available.

The above seems to be a problem related to a "if I cannot find the next
piece here through getChild, what do I do now?". Is there a possibility
of a model such as, "cannot do this, call my parent object in some manner
and tell it to deal with the issue"? Basically, a model with some
form of exception ("I did not return a fragment, but rather an issue") or
a callback ("yeah, you wanted me to do something, and I can't, so you deal
with it")?

In this way, the root object could have a "if a page cannot be found for
any reason, then do the following", and this could be overridden at each
level if desired.

Not sure if this follows the Twisted way of things.

>
> Sorry for the dearth of documentation here.  The folks responsible for
> these bits of code have been very busy lately :)

No probs. I understand extreme development. I figure with a mixture of
hacking snippets up to experiment, and hopefully answers to some of my
not-so-brilliant questions, that I can muddle through this evaluation.

Regards!
Ed





From radix at twistedmatrix.com  Fri Aug  8 10:45:36 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 8 Aug 2003 10:45:36 -0400
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <Pine.BSO.4.44.0308081019360.3145-100000@cyclops4.esentire.com>
References: <33D93BC8-C963-11D7-9301-000393C9700E@twistedmatrix.com> <Pine.BSO.4.44.0308081019360.3145-100000@cyclops4.esentire.com>
Message-ID: <20030808144536.GD964@radii>

On Fri, Aug 08, 2003 at 10:29:27AM -0400, Edmund Dengler wrote:
> 
> On Fri, 8 Aug 2003, Glyph Lefkowitz wrote:
>
> > Not at the moment.  It used to be off, but some browsers balked at the
> > redirect cycle.
> 
> I would question this. I have used a few systems that used redirects to
> perform logins (via Apache, Resin) and I have yet to find a browser in
> which this was an issue. Do you know specifically which ones?

wget

> > > Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
> > > session?
> >
> > It should happen automatically.  Isn't it?
> 
> No it doesn't, which is an issue. I perform an /xxx/yyy, and I get the
> page with no cookie set or placed in the URL.

I don't understand this, it works for me. If there is a SessionWrapper
at /, /xxx, or /xxx/yyy, then it should be working.

> > "allow URLs to be taken"?  Say again?
> 
> Sorry, "allow URLs to be bookmarked". I am trying to ensure that if a
> person bookmarks a URL, that the next time they come in, they are
> sessioned properly and that they will be logged in properly.

http://twistedmatrix.com/bugs/issue138 -- I had this same
problem. it's assigned to dp, but he hasn't gotten around to fixing it
yet.


-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From edmundd at eSentire.com  Fri Aug  8 12:02:38 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Fri, 8 Aug 2003 12:02:38 -0400 (EDT)
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <20030808144536.GD964@radii>
Message-ID: <Pine.BSO.4.44.0308081200500.3145-100000@cyclops4.esentire.com>

Howdy all!

Here is the (striped) sample code I am using to play with the session
stuff. I am using the CVS tip from Aug 5.

===============================

from twisted.internet import reactor
from twisted.web import static, server

# imports needed for woven guard
from twisted.web.woven import guard


sessWrapped = static.Data("you should never see this", "text/plain")
swChild = static.Data("here is the stuff", "text/plain")
sessWrapped.putChild("yyy", swChild)
swrap = guard.SessionWrapper(sessWrapped)

da = static.Data("you should never see this ???", "text/plain")
da.putChild("xxx", swrap)

site = server.Site(da)
reactor.listenTCP(8080, site)
reactor.run()

===============================

If I do http://localhost:8080/xxx/yyy, I get back the page with no session
key.

Regards,
Ed

On Fri, 8 Aug 2003, Christopher Armstrong wrote:

> > > > Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
> > > > session?
> > >
> > > It should happen automatically.  Isn't it?
> >
> > No it doesn't, which is an issue. I perform an /xxx/yyy, and I get the
> > page with no cookie set or placed in the URL.
>
> I don't understand this, it works for me. If there is a SessionWrapper
> at /, /xxx, or /xxx/yyy, then it should be working.
>





From dp at twistedmatrix.com  Fri Aug  8 13:14:14 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Fri, 8 Aug 2003 10:14:14 -0700
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <20030808144536.GD964@radii>
References: <33D93BC8-C963-11D7-9301-000393C9700E@twistedmatrix.com> <Pine.BSO.4.44.0308081019360.3145-100000@cyclops4.esentire.com> <20030808144536.GD964@radii>
Message-ID: <BC528716-C9C3-11D7-B0D5-000A95864FC4@twistedmatrix.com>

On Friday, August 8, 2003, at 7:45 AM, Christopher Armstrong wrote:

>
> http://twistedmatrix.com/bugs/issue138 -- I had this same
> problem. it's assigned to dp, but he hasn't gotten around to fixing it
> yet.

I will fix it soon, hopefully within the next week.

dp




From edmundd at eSentire.com  Fri Aug  8 19:12:00 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Fri, 8 Aug 2003 19:12:00 -0400 (EDT)
Subject: [Twisted-Python] ADBAPI and individual rows
Message-ID: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>

Greetings!

Digging a bit more into the DB side, and I wonder a bit about the API for
adbapi. From what I can tell, the runQuery() will return a Deferred for
the whole result set (which implies the result set is in memory). Is there
a method or style for running a query in which each row will be passed
back through a Deferred one at a time? (Basically, each cycle through
reactor.run() would be returning a single row).

What I am looking for is how to deal with a large result set without
requiring the whole set be in memory. Should I be looking elsewhere within
Twisted to do this?

Regards!
Ed





From jjanecek at telusplanet.net  Fri Aug  8 19:18:05 2003
From: jjanecek at telusplanet.net (John Janecek)
Date: Fri, 08 Aug 2003 17:18:05 -0600
Subject: [Twisted-Python] UDP and factories
In-Reply-To: <20030808114022.20705.51579.Mailman@pyramid.twistedmatrix.c
 om>
Message-ID: <5.1.0.14.2.20030808171228.00b62ea8@mail.telusplanet.net>

I am attempting to use DatagramProtocol with a factory
are u supposed to use DatagramProtocol with a factory ??
am i out to lunch ?

ie

from twisted.internet.protocol import DatagramProtocol
from twisted.internet import reactor
from twisted.internet.protocol import Factory

class Echo(DatagramProtocol):
     def datagramReceived(self, data, (host, port)):
         print "received %r from %s:%d" % (data, host, port)
         self.transport.write(data, (host, 7000))

echo_factory = Factory()
echo_factory.protocol = Echo


reactor.listenUDP(6000,echo_factory)
reactor.run()

I am using twisted v 1.05 and windows XP

everytime i attempt to run the above code i get

Traceback (most recent call last):
   File "pyRtp.py", line 97, in ?
     reactor.listenUDP(6000,echo_factory)
   File "E:\Python22\Lib\site-packages\twisted\internet\default.py", line 
181, in
  listenUDP
     p = udp.Port(port, protocol, interface, maxPacketSize, self)
   File "E:\Python22\Lib\site-packages\twisted\internet\udp.py", line 65, 
in __in
it__
     assert isinstance(proto, protocol.DatagramProtocol)
AssertionError

what am i doing wrong ?
If i am not supposed to use a factory with UDP what is a better solution ?

Thanx :)





From mesozoic at polynode.com  Fri Aug  8 20:21:23 2003
From: mesozoic at polynode.com (Alex Levy)
Date: Fri, 8 Aug 2003 20:21:23 -0400
Subject: [Twisted-Python] UDP and factories
In-Reply-To: <5.1.0.14.2.20030808171228.00b62ea8@mail.telusplanet.net>
References: <20030808114022.20705.51579.Mailman@pyramid.twistedmatrix.com> <5.1.0.14.2.20030808171228.00b62ea8@mail.telusplanet.net>
Message-ID: <20030809002123.GD8938@perpetual.moxn.net>

On Fri, Aug 08, 2003 at 05:18:05PM -0600, John Janecek wrote:
> I am attempting to use DatagramProtocol with a factory
> are u supposed to use DatagramProtocol with a factory ??
> am i out to lunch ?

Yes, you are -- but don't worry, it was leftover ham sandwiches ;]
No, you do not need to use a factory for a DatagramProtocol.  Thus:

> from twisted.internet.protocol import DatagramProtocol
> from twisted.internet import reactor
> 
> class Echo(DatagramProtocol):
>     def datagramReceived(self, data, (host, port)):
>         print "received %r from %s:%d" % (data, host, port)
>         self.transport.write(data, (host, 7000))
> 
> reactor.listenUDP(6000,Echo())
> reactor.run()

Look at <http://twistedmatrix.com/documents/howto/udp> for more information.

-- 
Alex Levy
WWW: http://mesozoic.geecs.org
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_



From mary-twisted at puzzling.org  Fri Aug  8 20:43:35 2003
From: mary-twisted at puzzling.org (Mary)
Date: Sat, 9 Aug 2003 10:43:35 +1000
Subject: [Twisted-Python] Woven: access to submodels
In-Reply-To: <6577C938-BA1C-11D7-8547-000A95864FC4@twistedmatrix.com>
References: <20030713022136.GB1862@titus.home.puzzling.org> <6577C938-BA1C-11D7-8547-000A95864FC4@twistedmatrix.com>
Message-ID: <20030809004335.GP1102@titus.home.puzzling.org>

Replying to an old thread here, I work though my problems slowly...

On Sat, Jul 19, 2003, Donovan Preston wrote:
> So, fortunately, things may be simpler than they seem.  You can just
> pass the DeferredWrapper as the Main Model to the next Page instance
> you construct, and as long as you are going to be rendering that Page
> next, Woven will just wait on it as it would any other Deferred.

[some bits of code snipped]

> class DeferredProducer(model.MethodModel):
>     def wmfactory_someDeferred(self, reqeuest):
>         d = defer.Deferred()
>         reactor.callLater(0.5, self.produce, d)
>         return d
> 
>     def produce(self, d):
>         d.callback( "Hello, here is some text" )
> 
> class MainPage(page.Page):
>     template = """<html>
>     <h3 model="someNotDeferred" view="Text"> qawsf</h3>
>     <span model="someDeferred" view="Text"> qwensd</span>
> </html> """
> 
>     def getDynamicChild(self, name, request):
>         return ChildPage(
>                     self.model.getSubmodel(request, 'someDeferred'))
> 
> class ChildPage(page.Page):
>     template = """<html>
>     Hello! Our main model is a deferred, so the next node will have to 
> wait
>     <span model="." view="Text"> ncxnz</span>
> </html> """

Sorry, I'm not too familiar with the stages in which this gets sent to
the browser, but this code assumes that the ChildPage is always going to
exist.

In my blog model, obviously there are authors that don't exist. So
/author/Mary/ would be represented by a ChildPage Resource, but
/author/Donovan/ should 404. Is that possible in a code structure like
this, or is it too late to produce the appropriate error at the:
    <span model="." view="Text"> ncxnz</span>
stage, which is the first time Twisted Web needs to wait on our Deferred
main model?

-Mary



From mary-twisted at puzzling.org  Fri Aug  8 23:05:44 2003
From: mary-twisted at puzzling.org (Mary)
Date: Sat, 9 Aug 2003 13:05:44 +1000
Subject: [Twisted-Python] Woven: access to submodels
In-Reply-To: <20030809004335.GP1102@titus.home.puzzling.org>
References: <6577C938-BA1C-11D7-8547-000A95864FC4@twistedmatrix.com> <20030809004335.GP1102@titus.home.puzzling.org>
Message-ID: <20030809030544.GC6338@titus.home.puzzling.org>

On Sat, Aug 09, 2003, Mary wrote:
> In my blog model, obviously there are authors that don't exist. So
> /author/Mary/ would be represented by a ChildPage Resource, but
> /author/Donovan/ should 404. Is that possible in a code structure like
> this, or is it too late to produce the appropriate error at the:
>     <span model="." view="Text"> ncxnz</span>
> stage, which is the first time Twisted Web needs to wait on our Deferred
> main model?

OK, as per discussion on IRC, I used a DeferredResource instead, and
return a ChildPage if the database query finds an author and an
ErrorPage otherwise.

-Mary



From justin at gnubia.net  Fri Aug  8 23:12:19 2003
From: justin at gnubia.net (Justin Ryan)
Date: 08 Aug 2003 22:12:19 -0500
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
Message-ID: <1060398739.2133.104.camel@samadhi>

adbapi could almost definitely be extended to have a special method or
paramater/flag to the existing methods for doing this.

On Fri, 2003-08-08 at 18:12, Edmund Dengler wrote:
> Greetings!
> 
> Digging a bit more into the DB side, and I wonder a bit about the API for
> adbapi. From what I can tell, the runQuery() will return a Deferred for
> the whole result set (which implies the result set is in memory). Is there
> a method or style for running a query in which each row will be passed
> back through a Deferred one at a time? (Basically, each cycle through
> reactor.run() would be returning a single row).
> 
> What I am looking for is how to deal with a large result set without
> requiring the whole set be in memory. Should I be looking elsewhere within
> Twisted to do this?
> 
> Regards!
> Ed
> 
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030808/3437fc11/attachment.pgp 

From jml at ids.org.au  Sat Aug  9 13:26:00 2003
From: jml at ids.org.au (Jonathan Lange)
Date: Sun, 10 Aug 2003 03:26:00 +1000
Subject: [Twisted-Python] Logging to stdout from trial
Message-ID: <20030809172600.GA7035@mumak.net>


The trial script takes a --logfile option, and writes all logs to this file. If
you haven't noticed in the past, it's because it logs to test.log

Below is a patch that sets the logfile to sys.stdout if the logfile is given as
'-'. e.g. trial --logfile=- twisted.test.test_trial

I'd commit this but I know very little about twisted's logging, and I don't
know whether this solves the real problem or not.


Index: twisted/scripts/trial.py
===================================================================
RCS file: /cvs/Twisted/twisted/scripts/trial.py,v
retrieving revision 1.46
diff -u -r1.46 trial.py
--- twisted/scripts/trial.py    19 Jul 2003 21:36:49 -0000      1.46
+++ twisted/scripts/trial.py    9 Aug 2003 05:58:05 -0000
@@ -254,7 +254,10 @@
                print
                print x['format'] % x
        log.addObserver(seeWarnings)
-       log.startLogging(open(config['logfile'], 'a'), 0)
+       if config['logfile'] == '-':
+           log.startLogging(sys.stdout, 0)
+       else:
+           log.startLogging(open(config['logfile'], 'a'), 0)

     tbformat = config['tbformat']

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030810/19e5b7e4/attachment.pgp 

From fog at initd.org  Sat Aug  9 03:42:36 2003
From: fog at initd.org (Federico Di Gregorio)
Date: 09 Aug 2003 09:42:36 +0200
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <1060398739.2133.104.camel@samadhi>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
	 <1060398739.2133.104.camel@samadhi>
Message-ID: <1060414956.1252.9.camel@localhost>

Il sab, 2003-08-09 alle 05:12, Justin Ryan ha scritto:
> adbapi could almost definitely be extended to have a special method or
> paramater/flag to the existing methods for doing this.

a long time ago i promised to rework the adbpi (mainly to implement the
min/max stuff that currently does not work). i'll start sending patches
after the ccc (nobody twisted here?). the special method you talk of
should be quite easy to implement.

ciao,

-- 
Federico Di Gregorio
Debian GNU/Linux Developer                                fog at debian.org
INIT.D Developer                                           fog at initd.org
   God is real. Unless declared integer. -- Anonymous FORTRAN programmer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa parte del messaggio =?ISO-8859-1?Q?=E8?= firmata
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030809/fef2461a/attachment.pgp 

From dave at krondo.com  Sat Aug  9 05:19:02 2003
From: dave at krondo.com (Dave Peticolas)
Date: 09 Aug 2003 02:19:02 -0700
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
Message-ID: <1060420741.1121.234.camel@oneiros>

On Fri, 2003-08-08 at 16:12, Edmund Dengler wrote:
> Greetings!
> 
> Digging a bit more into the DB side, and I wonder a bit about the API for
> adbapi. From what I can tell, the runQuery() will return a Deferred for
> the whole result set (which implies the result set is in memory). Is there
> a method or style for running a query in which each row will be passed
> back through a Deferred one at a time? (Basically, each cycle through
> reactor.run() would be returning a single row).
> 
> What I am looking for is how to deal with a large result set without
> requiring the whole set be in memory. Should I be looking elsewhere within
> Twisted to do this?

You should look at runInteraction. That calls a user-specified
function with what is essentially a DB-API cursor in a separate
thread. You can do what you like with the cursor, including
fetching results one row at a time.

You might also look at the Flow module. I've never used it,
but I think it was designed to solve such problems.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030809/c72b29d4/attachment.pgp 

From dave at krondo.com  Sat Aug  9 05:20:33 2003
From: dave at krondo.com (Dave Peticolas)
Date: 09 Aug 2003 02:20:33 -0700
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <1060414956.1252.9.camel@localhost>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
	 <1060398739.2133.104.camel@samadhi>  <1060414956.1252.9.camel@localhost>
Message-ID: <1060420833.1071.237.camel@oneiros>

On Sat, 2003-08-09 at 00:42, Federico Di Gregorio wrote:
> Il sab, 2003-08-09 alle 05:12, Justin Ryan ha scritto:
> > adbapi could almost definitely be extended to have a special method or
> > paramater/flag to the existing methods for doing this.
> 
> a long time ago i promised to rework the adbpi (mainly to implement the
> min/max stuff that currently does not work).

It seems I have beat you to it :) Min/max now works -- see current 
CVS.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030809/366a7627/attachment.pgp 

From tv at twistedmatrix.com  Sat Aug  9 02:56:05 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 9 Aug 2003 09:56:05 +0300
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
Message-ID: <20030809065605.GA25647@lapdog>

On Fri, Aug 08, 2003 at 07:12:00PM -0400, Edmund Dengler wrote:
> Digging a bit more into the DB side, and I wonder a bit about the API for
> adbapi. From what I can tell, the runQuery() will return a Deferred for
> the whole result set (which implies the result set is in memory). Is there
> a method or style for running a query in which each row will be passed
> back through a Deferred one at a time? (Basically, each cycle through
> reactor.run() would be returning a single row).
> 
> What I am looking for is how to deal with a large result set without
> requiring the whole set be in memory. Should I be looking elsewhere within
> Twisted to do this?

	Here's what I did with Ldaptor (note how the callback and the
	returned Deferred play together):

    def search(self,
	       filterText=None,
	       filterObject=None,
	       attributes=(),
	       scope=pureldap.LDAP_SCOPE_wholeSubtree,
	       derefAliases=pureldap.LDAP_DEREF_neverDerefAliases,
	       sizeLimit=0,
	       timeLimit=0,
	       typesOnly=0,
	       callback=None):
	"""

	Perform an LDAP search with this object as the base.

	@param filterText: LDAP search filter as a string.

	@param filterObject: LDAP search filter as LDAPFilter.
	Note if both filterText and filterObject are given, they
	are combined with AND. If neither is given, the search is
	made with a filter that matches everything.

	@param attributes: List of attributes to retrieve for the
	result objects. An empty list and means all.

	@param scope: Whether to recurse into subtrees.

	@param derefAliases: Whether to deref LDAP aliases. TODO write
	better documentation.

	@param sizeLimit: At most how many entries to return. 0 means
	unlimited.

	@param timeLimit: At most how long to use for processing the
	search request. 0 means unlimited.

	@param typesOnly: Whether to return attribute types only, or
	also values.

	@param callback: Callback function to call for each resulting
	LDAPEntry. None means gather the results into a list and give
	that to the Deferred returned from here.

	@return: A Deferred that will complete when the search is
	done. The Deferred gives None if callback was given and a list
	of the search results if callback is not given or is None.

	"""

-- 
:(){ :|:&};:



From edmundd at eSentire.com  Sat Aug  9 12:45:30 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 12:45:30 -0400 (EDT)
Subject: [Twisted-Python] Sessions and URLs
Message-ID: <Pine.BSO.4.44.0308091236270.32656-100000@cyclops4.esentire.com>

Hi all!

Dug into the library. It looks like woven.guard.SessionWrapper is setup
to return a child EVEN IF YOU DO NOT HAVE A SESSION!!.

Basically. the code structure of getChild() looks like (I could be wrong
in my understanding, so please correct if I am making a mistake):

     some setup stuff
     if we have a session key as the next bit in the path
       ...
       if the key matches the cookie
         we have cookies enabled, get rid of the embedded key
         ...
       else (cookies are disabled, keep the key)
         ...
     elif we have a cookie from the browser
       ...
     elif we are explicitely calling "session-init"
       ...
     else (we do not have a cookie anywhere)
       return the child anyways!!!

So, the code is structured such that a cookie is not available, the normal
children still get returned. Is this suppose to be how it works? Should
this be changed so that a flag is available for "force session"? Or should
a session always be forced (no option)?

Should we have a pattern such as "session-name:cookie" so we can do a
pattern match for old sessions no longer cached (and force a new session)?

Regards!
Ed





From radix at twistedmatrix.com  Sat Aug  9 15:05:19 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sat, 9 Aug 2003 15:05:19 -0400
Subject: [Twisted-Python] Sessions and URLs
In-Reply-To: <Pine.BSO.4.44.0308091236270.32656-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308091236270.32656-100000@cyclops4.esentire.com>
Message-ID: <20030809190519.GG964@radii>

On Sat, Aug 09, 2003 at 12:45:30PM -0400, Edmund Dengler wrote:
> Hi all!
> Should we have a pattern such as "session-name:cookie" so we can do a
> pattern match for old sessions no longer cached (and force a new session)?

This is exactly what the proposed solution of that bug I referenced
the other day is.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From edmundd at eSentire.com  Sat Aug  9 16:35:24 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 16:35:24 -0400 (EDT)
Subject: [Twisted-Python] SQL, Threaded, and flows
Message-ID: <Pine.BSO.4.44.0308091633040.32656-100000@cyclops4.esentire.com>

Hi all!

I am trying the example from the Flow HowTo page, and I have into an
exception.

===========================

from __future__         import generators
from twisted.enterprise import adbapi
from twisted.internet   import reactor
from twisted.flow import flow

dbpool = adbapi.ConnectionPool("SomeDriver",host='localhost',
             db='Database',user='User',passwd='Password')

sql = """
  (SELECT 'one')
UNION ALL
  (SELECT 'two')
UNION ALL
  (SELECT 'three')
"""

def consumer():
    query = flow.Threaded(flow.QueryIterator(dbpool, sql))
    yield query
    for row in query:
        print "Processed result : ", row

from twisted.internet import reactor
def finish(result):
    print "Deferred Complete : ", result
f = flow.Deferred(consumer())
f.addBoth(finish)
reactor.callLater(1,reactor.stop)
reactor.run()

# prints
# Processed result :  ('one',)
# Processed result :  ('two',)
# Processed result :  ('three',)
# Deferred Complete:  []

===========================

> python flow-query.py
Deferred Complete :  [Failure instance: Traceback: exceptions.AttributeError, 'module' object has no attribute 'Threaded'
/opt/python/lib/python2.2/site-packages/twisted/flow/wrap.py:100:_yield
flow-query.py:18:consumer
]

Is there something I need to do? Has the API changed?

Regards!
Ed





From edmundd at eSentire.com  Sat Aug  9 16:57:06 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 16:57:06 -0400 (EDT)
Subject: [Twisted-Python] Twisted Style
Message-ID: <Pine.BSO.4.44.0308091637310.32656-100000@cyclops4.esentire.com>

Hi all!

The Twisted stuff looks very good, and I think I am getting my head around
to the way it works. I am looking for how I should be approaching a basic
problem, and how to cast it in the Twisted model.

Basically, I have a client transferring database rows to a server. I would
like to transfer each row one-at-a-time, and I need information coming
back to know whether the transfer was successful and to record in the
client's database.

I have tried the following (please note that the code has been stripped
to show the essence):

Server (using PB)
-----------------

Has a Perspective:

class MyPerspective(pb.Perspective):
    def attached(self, clientref, identity):
        ...

    def attached(self, ref, identity):
        ...

    def perspective_transferXXX(self, XXX):
        ...

...create an app and a service...
...create appropriate perspective and identity things...
...listen at a socket...


Client (1)
----------

class TransferClient:
    def __init__(self):

    def go(self):
        ...connect to server, defer to connection()...

    def connection(self, perspective):
        # Connection to server has been made
        ...save away perspective...
        self.transferCycle()

    def transferCycle(self):
        # Start a whole cycle (each cycle may transfer multiple rows)
        self.transferXXXs()

    def getXXXs(self):
        # Lets get the data to transfer
        ...setup database query, defer result set to transferXXXs()...

    def transferXXXs(self, XXXs):
        # We have our data from the query
        ...save away some state information...
        self.transferXXX(...first row...)

    def transferXXX(self, XXX):
        # Transfer a single row
        ...call remote perspective for XXX, defer return to doneXXX()...

    def doneXXX(self, result):
        # The row has been transferred and returned a result
        if successfully transferred:
            ...do appropriate work...
        if we still need to transfer more rows:
            self.transferXXX(...with the next row...)
        else:
            self.cycleDone()
            # Note: if we had other stuff, we would start them
            # transferring as well

    def cycleDone(self):
        # We have done a single cycle of transfers
        ...put a deferred for YYY seconds to start the cycle again...


Now, this seems like an awful lot of methods simply to support deferred
execution. Is there a way to use flows to acheive this? I have looked at
the HowTo pages, but it is not clear how to use the Flow components within
a PB model. Is there another approach?

Regards!
Ed






From edmundd at eSentire.com  Sat Aug  9 17:09:04 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 17:09:04 -0400 (EDT)
Subject: [Twisted-Python] Revisiting sessions
Message-ID: <Pine.BSO.4.44.0308091700430.32656-100000@cyclops4.esentire.com>

Just tried to get a session to apply to the entire website (rather than to
one subdirectory).

So, tried the following code:

========================================

from twisted.internet import reactor
from twisted.web import static, server
from twisted.web.woven import guard

sessWrapped = static.Data("you should never see this", "text/plain")
swChild = static.Data("NO", "text/plain")
sessWrapped.putChild("yyy", swChild)
swrap = guard.SessionWrapper(sessWrapped)

da = static.Data("you should never see this", "text/plain")
# da.putChild("", static.Data("The great void at the top", "text/plain"))
da.putChild("", swrap)

site = server.Site(da)
reactor.listenTCP(8080, site)
reactor.run()

============================

If I put the static.Data(), rather than the swrap as the Child, I get "The
great void at the top". If I try to use swrap to generate a session key, I
get:

lynx http://localhost:8080
==> redirects to http://localhost:8080//
==> Which returns a "No such child resource"

lynx http://localhost:8080/yyy
==> Which returns a "No such child resource"

lynx http://localhost:8080/session-init/yyy
==> Which returns a "No such child resource"

So, it seems that I cannot use the session at the top (at least the way I
think it works). What am I doing wrong?

Thanks!
Ed





From cce at clarkevans.com  Sat Aug  9 17:14:05 2003
From: cce at clarkevans.com (Clark C. Evans)
Date: Sat, 9 Aug 2003 21:14:05 +0000
Subject: [Twisted-Python] SQL, Threaded, and flows
In-Reply-To: <Pine.BSO.4.44.0308091633040.32656-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308091633040.32656-100000@cyclops4.esentire.com>
Message-ID: <20030809211405.GA76105@polya.axista.com>

Edmund,

   This has been fixed in the CVS repository.  In short, when flow
   was added into twisted, the "threaded" stuff seemed to be not 
   totally stable and really not core (as it is more useful with an
   async Database or LDAP driver).  Thus, QueryIterator and Threaded
   arn't imported into the flow module automatically as the example
   assumed.  You can get to these two classes via:

      from twisted.flow.threads import QueryIterator, Threaded

   And then the example should mostly work from there.  Although
   you do need an actual database connection, of course.   

Best,

Clark

[1] http://twistedmatrix.com/users/jh.twistd/viewcvs/cgi/viewcvs.cgi/doc/howto/flow.html?rev=HEAD&content-type=text/vnd.viewcvs-markup&cvsroot=Twisted

On Sat, Aug 09, 2003 at 04:35:24PM -0400, Edmund Dengler wrote:
| Hi all!
| 
| I am trying the example from the Flow HowTo page, and I have into an
| exception.
| 
| ===========================
| 
| from __future__         import generators
| from twisted.enterprise import adbapi
| from twisted.internet   import reactor
| from twisted.flow import flow
| 
| dbpool = adbapi.ConnectionPool("SomeDriver",host='localhost',
|              db='Database',user='User',passwd='Password')
| 
| sql = """
|   (SELECT 'one')
| UNION ALL
|   (SELECT 'two')
| UNION ALL
|   (SELECT 'three')
| """
| 
| def consumer():
|     query = flow.Threaded(flow.QueryIterator(dbpool, sql))
|     yield query
|     for row in query:
|         print "Processed result : ", row
| 
| from twisted.internet import reactor
| def finish(result):
|     print "Deferred Complete : ", result
| f = flow.Deferred(consumer())
| f.addBoth(finish)
| reactor.callLater(1,reactor.stop)
| reactor.run()
| 
| # prints
| # Processed result :  ('one',)
| # Processed result :  ('two',)
| # Processed result :  ('three',)
| # Deferred Complete:  []
| 
| ===========================
| 
| > python flow-query.py
| Deferred Complete :  [Failure instance: Traceback: exceptions.AttributeError, 'module' object has no attribute 'Threaded'
| /opt/python/lib/python2.2/site-packages/twisted/flow/wrap.py:100:_yield
| flow-query.py:18:consumer
| ]
| 
| Is there something I need to do? Has the API changed?
| 
| Regards!
| Ed
| 
| 
| 
| _______________________________________________
| Twisted-Python mailing list
| Twisted-Python at twistedmatrix.com
| http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From edmundd at eSentire.com  Sat Aug  9 17:23:42 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 17:23:42 -0400 (EDT)
Subject: [Twisted-Python] SQL, Threaded, and flows
In-Reply-To: <20030809211405.GA76105@polya.axista.com>
Message-ID: <Pine.BSO.4.44.0308091721330.32656-100000@cyclops4.esentire.com>

Greetings!

Is this a recommended package/module to use, or should I be avoiding it
(for reasons such as it is going towards being deprecated)?

Thanks!
Ed

On Sat, 9 Aug 2003, Clark C. Evans wrote:

> Edmund,
>
>    This has been fixed in the CVS repository.  In short, when flow
>    was added into twisted, the "threaded" stuff seemed to be not
>    totally stable and really not core (as it is more useful with an
>    async Database or LDAP driver).  Thus, QueryIterator and Threaded
>    arn't imported into the flow module automatically as the example
>    assumed.  You can get to these two classes via:
>
>       from twisted.flow.threads import QueryIterator, Threaded
>
>    And then the example should mostly work from there.  Although
>    you do need an actual database connection, of course.
>
> Best,
>
> Clark
>
> [1] http://twistedmatrix.com/users/jh.twistd/viewcvs/cgi/viewcvs.cgi/doc/howto/flow.html?rev=HEAD&content-type=text/vnd.viewcvs-markup&cvsroot=Twisted
>
> On Sat, Aug 09, 2003 at 04:35:24PM -0400, Edmund Dengler wrote:
> | Hi all!
> |
> | I am trying the example from the Flow HowTo page, and I have into an
> | exception.
> |
> | ===========================
> |
> | from __future__         import generators
> | from twisted.enterprise import adbapi
> | from twisted.internet   import reactor
> | from twisted.flow import flow
> |
> | dbpool = adbapi.ConnectionPool("SomeDriver",host='localhost',
> |              db='Database',user='User',passwd='Password')
> |
> | sql = """
> |   (SELECT 'one')
> | UNION ALL
> |   (SELECT 'two')
> | UNION ALL
> |   (SELECT 'three')
> | """
> |
> | def consumer():
> |     query = flow.Threaded(flow.QueryIterator(dbpool, sql))
> |     yield query
> |     for row in query:
> |         print "Processed result : ", row
> |
> | from twisted.internet import reactor
> | def finish(result):
> |     print "Deferred Complete : ", result
> | f = flow.Deferred(consumer())
> | f.addBoth(finish)
> | reactor.callLater(1,reactor.stop)
> | reactor.run()
> |
> | # prints
> | # Processed result :  ('one',)
> | # Processed result :  ('two',)
> | # Processed result :  ('three',)
> | # Deferred Complete:  []
> |
> | ===========================
> |
> | > python flow-query.py
> | Deferred Complete :  [Failure instance: Traceback: exceptions.AttributeError, 'module' object has no attribute 'Threaded'
> | /opt/python/lib/python2.2/site-packages/twisted/flow/wrap.py:100:_yield
> | flow-query.py:18:consumer
> | ]
> |
> | Is there something I need to do? Has the API changed?
> |
> | Regards!
> | Ed
> |
> |
> |
> | _______________________________________________
> | Twisted-Python mailing list
> | Twisted-Python at twistedmatrix.com
> | http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Sat Aug  9 17:28:34 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 17:28:34 -0400 (EDT)
Subject: [Twisted-Python] SQL, Threaded, and flows
In-Reply-To: <20030809211405.GA76105@polya.axista.com>
Message-ID: <Pine.BSO.4.44.0308091726540.32656-100000@cyclops4.esentire.com>

Added the import line, changed to query line to:

    query = Threaded(QueryIterator(dbpool, sql))

It now executes (no exceptions), but nothing is returned/printed. I am
obviously missing something, but I don't know enough of the internals
to hazard a guess as to what.

I am currently using the Aug 5 CVS tip.

Regards!
Ed

On Sat, 9 Aug 2003, Clark C. Evans wrote:

> Edmund,
>
>    This has been fixed in the CVS repository.  In short, when flow
>    was added into twisted, the "threaded" stuff seemed to be not
>    totally stable and really not core (as it is more useful with an
>    async Database or LDAP driver).  Thus, QueryIterator and Threaded
>    arn't imported into the flow module automatically as the example
>    assumed.  You can get to these two classes via:
>
>       from twisted.flow.threads import QueryIterator, Threaded
>
>    And then the example should mostly work from there.  Although
>    you do need an actual database connection, of course.
>
> Best,
>
> Clark
>
> [1] http://twistedmatrix.com/users/jh.twistd/viewcvs/cgi/viewcvs.cgi/doc/howto/flow.html?rev=HEAD&content-type=text/vnd.viewcvs-markup&cvsroot=Twisted
>
> On Sat, Aug 09, 2003 at 04:35:24PM -0400, Edmund Dengler wrote:
> | Hi all!
> |
> | I am trying the example from the Flow HowTo page, and I have into an
> | exception.
> |
> | ===========================
> |
> | from __future__         import generators
> | from twisted.enterprise import adbapi
> | from twisted.internet   import reactor
> | from twisted.flow import flow
> |
> | dbpool = adbapi.ConnectionPool("SomeDriver",host='localhost',
> |              db='Database',user='User',passwd='Password')
> |
> | sql = """
> |   (SELECT 'one')
> | UNION ALL
> |   (SELECT 'two')
> | UNION ALL
> |   (SELECT 'three')
> | """
> |
> | def consumer():
> |     query = flow.Threaded(flow.QueryIterator(dbpool, sql))
> |     yield query
> |     for row in query:
> |         print "Processed result : ", row
> |
> | from twisted.internet import reactor
> | def finish(result):
> |     print "Deferred Complete : ", result
> | f = flow.Deferred(consumer())
> | f.addBoth(finish)
> | reactor.callLater(1,reactor.stop)
> | reactor.run()
> |
> | # prints
> | # Processed result :  ('one',)
> | # Processed result :  ('two',)
> | # Processed result :  ('three',)
> | # Deferred Complete:  []
> |
> | ===========================
> |
> | > python flow-query.py
> | Deferred Complete :  [Failure instance: Traceback: exceptions.AttributeError, 'module' object has no attribute 'Threaded'
> | /opt/python/lib/python2.2/site-packages/twisted/flow/wrap.py:100:_yield
> | flow-query.py:18:consumer
> | ]
> |
> | Is there something I need to do? Has the API changed?
> |
> | Regards!
> | Ed
> |
> |
> |
> | _______________________________________________
> | Twisted-Python mailing list
> | Twisted-Python at twistedmatrix.com
> | http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From cce at clarkevans.com  Sat Aug  9 17:41:19 2003
From: cce at clarkevans.com (Clark C. Evans)
Date: Sat, 9 Aug 2003 21:41:19 +0000
Subject: [Twisted-Python] SQL, Threaded, and flows
In-Reply-To: <Pine.BSO.4.44.0308091726540.32656-100000@cyclops4.esentire.com>
References: <20030809211405.GA76105@polya.axista.com> <Pine.BSO.4.44.0308091726540.32656-100000@cyclops4.esentire.com>
Message-ID: <20030809214119.GA76405@polya.axista.com>

On Sat, Aug 09, 2003 at 05:28:34PM -0400, Edmund Dengler wrote:
| Added the import line, changed to query line to:
| 
|     query = Threaded(QueryIterator(dbpool, sql))
| 
| It now executes (no exceptions), but nothing is returned/printed. I am
| obviously missing something, but I don't know enough of the internals
| to hazard a guess as to what.

Yes, there is another stupid bug in the example, the
callLater(1,reactor.stop) line should be deleted and the 
reactor.stop() should go into the finish() function.  

| > | from twisted.internet import reactor
| > | def finish(result):
| > |     print "Deferred Complete : ", result
+         reactor.stop()
| > | f = flow.Deferred(consumer())
| > | f.addBoth(finish)
-   reactor.callLater(1,reactor.stop)
| > | reactor.run()

I'm also on IRC right now, or if you are in the US I can
give you a quick phone call. (send me personally your phone
if you want me to give you a quick phone call)

Best,

Clark



From edmundd at eSentire.com  Sat Aug  9 18:19:25 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
Subject: [Twisted-Python] Twisted and Postgresql
Message-ID: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>

Greetings!

When trying to transfer a row set, which was obtained using the pyPgSQL
module, I am having problems with specific types not being jelly-able. In
particular, the row itself PgResultSetConcreteRow(?)(this is from memory)
and PgInt2 (which I found out by trying to send individual elements of the
row set over). Has anybody else encountered these, and is there a solution
other than defining my own set of jelly-able components (for example, is
there a stock jelly library someplace)?

I did a search on the archives, with nothing found.

Regards!
Ed





From edmundd at eSentire.com  Sat Aug  9 20:17:13 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 20:17:13 -0400 (EDT)
Subject: [Twisted-Python] Deferring the return within PB
Message-ID: <Pine.BSO.4.44.0308092011260.32656-100000@cyclops4.esentire.com>

As I forge ahead, another question rears it's ugly head to be thrashed!

I am calling a PB perspective method from the client to the server.

    def perspective_transferXXX(self, XXX):
        ...deal with this item...

I would like to perform a database operation on the server end. How do I
defer the return statement til the operation is done?

Roughly speaking:

    def perspective_transferXXX(self, XXX):
        ...perform the database operation, defer to doneTransferXXX()...
        ...do NOT return a value for the perspective call...

    def doneTransferXXX(self, XXX):
        ...perform any other cleanup...
        ...NOW return a value for the perspective call...


I would note that the use of Deferred's and such looks like it is slowly
going towards the model of continuation-style-passing (a very funky and
mind twisting model from the functional languages world), which would
allow for this sort of asynchronous operation very cleanly.

How would I specify the above effects within Twisted? I have tried to see
if this was answered in the documentation or the archive lists, to no
effect.

Regards!
Ed




From pyp at gmx.net  Sat Aug  9 20:49:29 2003
From: pyp at gmx.net (Mike Mueller)
Date: Sun, 10 Aug 2003 02:49:29 +0200
Subject: Antwort: [Twisted-Python] Win32 installer for Python2.3
In-Reply-To: <OFC082C4EB.41BD97C3-ONC1256D7C.0023E032@uz.tengelmann.de>
Message-ID: <5.2.1.1.1.20030810024414.00ad5398@pop.gmx.net>

At 08:35 08.08.2003 +0200, you wrote:
>Simple go to the twisted-root (there is a setup.py) and type python
>setup.py bdist_wininst.
>
>After that there will be a windows installer under dist.
>
>Martin

Thanks. Worked at the first try.

PythonWin 2.3 (#46, Jul 29 2003, 18:54:32) [MSC v.1200 32 bit (Intel)] on 
win32.
Portions Copyright 1994-2001 Mark Hammond (mhammond at skippinet.com.au) - see 
'Help/About PythonWin' for further copyright information.
 >>> import twisted
 >>> twisted.python
<module 'twisted.python' from 'twisted\python\__init__.pyc'>
 >>>

Before I used  ..twisted\win32\build.py which did not work.
Learned something here :).

Mike







From abe at fettig.net  Sat Aug  9 21:17:30 2003
From: abe at fettig.net (Abe Fettig)
Date: 09 Aug 2003 21:17:30 -0400
Subject: [Twisted-Python] Deferring the return within PB
In-Reply-To: <Pine.BSO.4.44.0308092011260.32656-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308092011260.32656-100000@cyclops4.esentire.com>
Message-ID: <1060478249.542.20.camel@mingus>

On Sat, 2003-08-09 at 20:17, Edmund Dengler wrote:

> I would like to perform a database operation on the server end. How do I
> defer the return statement til the operation is done?
> 
> Roughly speaking:
> 
>     def perspective_transferXXX(self, XXX):
>         ...perform the database operation, defer to doneTransferXXX()...
>         ...do NOT return a value for the perspective call...
> 
>     def doneTransferXXX(self, XXX):
>         ...perform any other cleanup...
>         ...NOW return a value for the perspective call...

Good news - you can add multiple callbacks to a single Deferred, and
they will be called sequentially, with the output of each one passed to
the next.  So, in your example:

	def perspective_transferXXX(self, *args):
		d = deferredFunction()
		d.addCallback(self.doneTransfer)
		return d

	def doneTransfer(self, response):
		return response.split() # or whatever

In this example, the (eventually) returned value of deferredFunction()
gets passed to doneTransfer first, which is free to alter it as
neccessary before actually returning the value to the client.

For a much better explanation, see the "Using Deferreds" HOWTO.

Abe




From glyph at twistedmatrix.com  Sat Aug  9 23:29:08 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 9 Aug 2003 22:29:08 -0500
Subject: [Twisted-Python] Sessions and URLs
In-Reply-To: <Pine.BSO.4.44.0308091236270.32656-100000@cyclops4.esentire.com>
Message-ID: <CD4B706D-CAE2-11D7-9301-000393C9700E@twistedmatrix.com>

On Saturday, August 9, 2003, at 11:45 AM, Edmund Dengler wrote:

> So, the code is structured such that a cookie is not available, the 
> normal
> children still get returned. Is this suppose to be how it works? Should
> this be changed so that a flag is available for "force session"? Or 
> should
> a session always be forced (no option)?

Sorry, this should be documented.  You correctly figured out the series 
of steps (more or less) but you missed the annotation of the request 
:-).

SessionWrapper mangles the request, slightly changing the semantics of 
getSession, so that it may return None.  
UsernamePasswordWrapper.getChild begins with

         s = request.getSession()
         if s is None:
             return request.setupSession()

since it currently requires a session in order to operate.  Eventually 
I hope to remove this and have it operate without a session when 
possible.

> Should we have a pattern such as "session-name:cookie" so we can do a
> pattern match for old sessions no longer cached (and force a new 
> session)?

"pattern match"?  No, we just use a dictionary lookup.  SessionWrapper 
will already create a new session when the old one is no longer cached.




From edmundd at eSentire.com  Sat Aug  9 23:44:12 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 23:44:12 -0400 (EDT)
Subject: [Twisted-Python] Sessions and URLs
In-Reply-To: <CD4B706D-CAE2-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <Pine.BSO.4.44.0308092339320.32656-100000@cyclops4.esentire.com>

Greetings!

If there is no pattern match such as "session-name:XXXXX", then how will
you know if an entry is a cookie or a named child? For example, is "yyy" a
cookie or a child? Now, if the code was changed to check for children
first (to see if they exist or not), then you could possibly do this, bit
that would mean old links pointing to a no longer existent child would be
considered a cookie.

Or am I misunderstanding this (which is quite possible)?

Regards,
Ed

On Sat, 9 Aug 2003, Glyph Lefkowitz wrote:

>
> On Saturday, August 9, 2003, at 11:45 AM, Edmund Dengler wrote:
>
> > So, the code is structured such that a cookie is not available, the
> > normal
> > children still get returned. Is this suppose to be how it works? Should
> > this be changed so that a flag is available for "force session"? Or
> > should
> > a session always be forced (no option)?
>
> Sorry, this should be documented.  You correctly figured out the series
> of steps (more or less) but you missed the annotation of the request
> :-).
>
> SessionWrapper mangles the request, slightly changing the semantics of
> getSession, so that it may return None.
> UsernamePasswordWrapper.getChild begins with
>
>          s = request.getSession()
>          if s is None:
>              return request.setupSession()
>
> since it currently requires a session in order to operate.  Eventually
> I hope to remove this and have it operate without a session when
> possible.
>
> > Should we have a pattern such as "session-name:cookie" so we can do a
> > pattern match for old sessions no longer cached (and force a new
> > session)?
>
> "pattern match"?  No, we just use a dictionary lookup.  SessionWrapper
> will already create a new session when the old one is no longer cached.
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From mary-twisted at puzzling.org  Sun Aug 10 05:04:52 2003
From: mary-twisted at puzzling.org (Mary)
Date: Sun, 10 Aug 2003 19:04:52 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
Message-ID: <20030810090452.GA5285@titus.home.puzzling.org>

The problem I'm describing is best illustrated by the two examples
attached.

safe.py renders the following HTML for the / URL (Twisted 1.0.7alpha4):

<?xml version="1.0"?>

<html>
 <body>
  <h1>My name
  </h1>
 </body>
</html>

If I start bad.py like this: "twistd -n -y bad.py" and request the /
URL, it infinitely loops (judging from the output of --spew), and
further, renders twistd uninteruptable via either Ctrl-C or SIGTERM.

In this particular case I'm open to suggestions of "well, don't do that
then" -- the reason, incidently, that I'm trying to use another TestPage
as a submodel is in order to generate previous and next links between
certain pages.

-Mary
-------------- next part --------------
from twisted.web import server
from twisted.internet import app
from twisted.web.woven import page

class TestPage(page.Page):

    template = '''
    <html>
    <body>
    <h1 model="prev/name"/>
    </body>
    </html>
    '''

    def wmfactory_name(self, request):
        return "My name"

    def wmfactory_prev(self, request):
        return TestPage()

s = TestPage()
site = server.Site(s)
application = app.Application("Eyes")
application.listenTCP(8088, site)

-------------- next part --------------
from twisted.web import server
from twisted.internet import app
from twisted.web.woven import page

class TestPage(page.Page):

    template = '''
    <html>
    <body>
    <h1 model="name"/>
    <div model="prev">
    <h1 model="name"/>
    </div>
    </body>
    </html>
    '''

    def wmfactory_name(self, request):
        return "My name"

    def wmfactory_prev(self, request):
        return TestPage()

s = TestPage()
site = server.Site(s)
application = app.Application("Eyes")
application.listenTCP(8088, site)


From radix at twistedmatrix.com  Sun Aug 10 09:46:37 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sun, 10 Aug 2003 09:46:37 -0400
Subject: [Twisted-Python] Sessions and URLs
In-Reply-To: <Pine.BSO.4.44.0308092339320.32656-100000@cyclops4.esentire.com>
References: <CD4B706D-CAE2-11D7-9301-000393C9700E@twistedmatrix.com> <Pine.BSO.4.44.0308092339320.32656-100000@cyclops4.esentire.com>
Message-ID: <20030810134637.GI964@radii>

On Sat, Aug 09, 2003 at 11:44:12PM -0400, Edmund Dengler wrote:
>
> On Sat, 9 Aug 2003, Glyph Lefkowitz wrote:
>
> > "pattern match"?  No, we just use a dictionary lookup.  SessionWrapper
> > will already create a new session when the old one is no longer cached.
>
> If there is no pattern match such as "session-name:XXXXX", then how
> will you know if an entry is a cookie or a named child?
...
> Or am I misunderstanding this (which is quite possible)?

No, you've got it right, though your wording is odd (the session ID
isn't a "cookie", "cookie" means something completely different in our
context). I think the point glyph missed is that you're worried about
people visiting URLs with *old* session IDs in them, which is the same
problem I've been having.

> 
> Regards,
> Ed
> 

> 
> >
> > On Saturday, August 9, 2003, at 11:45 AM, Edmund Dengler wrote:
> >
> > > So, the code is structured such that a cookie is not available, the
> > > normal
> > > children still get returned. Is this suppose to be how it works? Should
> > > this be changed so that a flag is available for "force session"? Or
> > > should
> > > a session always be forced (no option)?
> >
> > Sorry, this should be documented.  You correctly figured out the series
> > of steps (more or less) but you missed the annotation of the request
> > :-).
> >
> > SessionWrapper mangles the request, slightly changing the semantics of
> > getSession, so that it may return None.
> > UsernamePasswordWrapper.getChild begins with
> >
> >          s = request.getSession()
> >          if s is None:
> >              return request.setupSession()
> >
> > since it currently requires a session in order to operate.  Eventually
> > I hope to remove this and have it operate without a session when
> > possible.
> >
> > > Should we have a pattern such as "session-name:cookie" so we can do a
> > > pattern match for old sessions no longer cached (and force a new
> > > session)?
> >
> >
> >
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From mesozoic at polynode.com  Sun Aug 10 12:19:57 2003
From: mesozoic at polynode.com (Alex Levy)
Date: Sun, 10 Aug 2003 12:19:57 -0400
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030810090452.GA5285@titus.home.puzzling.org>
References: <20030810090452.GA5285@titus.home.puzzling.org>
Message-ID: <20030810161957.GE8938@perpetual.moxn.net>

class TestPage(page.Page):
    template = '''
    <html>
    <body>
    <div model="prev">
      ...
    </div>
    </body>
    </html>
    '''
    def wmfactory_prev(self, request):
        return TestPage()

This is an infinite loop. A Page class is both its own model and its own
view; despite the fact that you've made it part of the template here, it
will insert its own template and replace the <div/> you have.

So, when the submodel is created (a TestPage instance), it attempts to
render itself, which makes a TestPage instance as a submodel, which needs to
be rendered, and so on. Ad infinum.

Which begs the question, what are you trying to do? There is likely another
way around whatever problem you're trying to solve.

-- 
Alex Levy
WWW: http://mesozoic.geecs.org
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_



From itamar at itamarst.org  Sun Aug 10 13:21:41 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 10 Aug 2003 13:21:41 -0400
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>
Message-ID: <20030810132141.54519b78.itamar@itamarst.org>

On Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> When trying to transfer a row set, which was obtained using the
> pyPgSQL module, I am having problems with specific types not being
> jelly-able. In particular, the row itself
> PgResultSetConcreteRow(?)(this is from memory) and PgInt2 (which I
> found out by trying to send individual elements of the row set over).
> Has anybody else encountered these, and is there a solution other than
> defining my own set of jelly-able components (for example, is there a
> stock jelly library someplace)?

Just convert them into lists and ints or dicts, the applicable python
object that the pypgsql type emulates. SO, write a function that
recurses a postgresql result and cleans it up, and then addCallback it
to the Deferred of the database query result.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Sun Aug 10 13:38:30 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sun, 10 Aug 2003 13:38:30 -0400 (EDT)
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <20030810132141.54519b78.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308101336550.21433-100000@cyclops4.esentire.com>

I tried doing it as one of my steps (which is how I ran into the PgInt2
issue when I just did the top level). This is probably easier than
jelly-ing everything, and probably not all that much work (a couple of
hours?), just hoping that there was an already done solution.

Regards!
Ed

On Sun, 10 Aug 2003, Itamar Shtull-Trauring wrote:

> On Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > When trying to transfer a row set, which was obtained using the
> > pyPgSQL module, I am having problems with specific types not being
> > jelly-able. In particular, the row itself
> > PgResultSetConcreteRow(?)(this is from memory) and PgInt2 (which I
> > found out by trying to send individual elements of the row set over).
> > Has anybody else encountered these, and is there a solution other than
> > defining my own set of jelly-able components (for example, is there a
> > stock jelly library someplace)?
>
> Just convert them into lists and ints or dicts, the applicable python
> object that the pypgsql type emulates. SO, write a function that
> recurses a postgresql result and cleans it up, and then addCallback it
> to the Deferred of the database query result.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From lists at ghaering.de  Sun Aug 10 14:09:58 2003
From: lists at ghaering.de (=?ISO-8859-1?Q?Gerhard_H=E4ring?=)
Date: Sun, 10 Aug 2003 20:09:58 +0200
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <20030810132141.54519b78.itamar@itamarst.org>
References: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>
	<20030810132141.54519b78.itamar@itamarst.org>
Message-ID: <3F368A76.7030304@ghaering.de>

Itamar Shtull-Trauring wrote:
> On Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
> 
>>When trying to transfer a row set, which was obtained using the
>>pyPgSQL module, I am having problems with specific types not being
>>jelly-able. In particular, the row itself
>>PgResultSetConcreteRow(?)(this is from memory) and PgInt2 (which I
>>found out by trying to send individual elements of the row set over).
>>Has anybody else encountered these, and is there a solution other than
>>defining my own set of jelly-able components (for example, is there a
>>stock jelly library someplace)?
> 
> Just convert them into lists and ints or dicts, [...]

First, you want to use pyPgSQL 2.4, which returns Python objects (int, 
...) instead of the pyPgSQL specific numeric types.

Second, you may want to set fetchReturnsList on the connection object to 
1 to get tuples instead of PgResultSets back.

HTH,

-- Gerhard



From gh at ghaering.de  Sun Aug 10 14:15:24 2003
From: gh at ghaering.de (=?ISO-8859-1?Q?Gerhard_H=E4ring?=)
Date: Sun, 10 Aug 2003 20:15:24 +0200
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <3F368A76.7030304@ghaering.de>
References: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>	<20030810132141.54519b78.itamar@itamarst.org>
	<3F368A76.7030304@ghaering.de>
Message-ID: <3F368BBC.30101@ghaering.de>

Gerhard H?ring wrote:
> [pyPgSQL]
> Second, you may want to set fetchReturnsList on the connection object to 
> 1 to get tuples instead of PgResultSets back.

Oh well. fetchReturnsList is a module-level variable, instead of a 
connection-level variable, like it should be.

-- Gerhard



From edmundd at eSentire.com  Sun Aug 10 14:15:32 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sun, 10 Aug 2003 14:15:32 -0400 (EDT)
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <3F368A76.7030304@ghaering.de>
Message-ID: <Pine.BSO.4.44.0308101414030.21433-100000@cyclops4.esentire.com>

I am using 2.4 (at least that is what PgSQL/__init__.py says).

The result set is due to the use of the Twisted API. How does this work
with Deferreds within the adbapi?

Regards!
Ed

On Sun, 10 Aug 2003, [ISO-8859-1] Gerhard H?ring wrote:

> Itamar Shtull-Trauring wrote:
> > On Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
> > Edmund Dengler <edmundd at eSentire.com> wrote:
> >
> >>When trying to transfer a row set, which was obtained using the
> >>pyPgSQL module, I am having problems with specific types not being
> >>jelly-able. In particular, the row itself
> >>PgResultSetConcreteRow(?)(this is from memory) and PgInt2 (which I
> >>found out by trying to send individual elements of the row set over).
> >>Has anybody else encountered these, and is there a solution other than
> >>defining my own set of jelly-able components (for example, is there a
> >>stock jelly library someplace)?
> >
> > Just convert them into lists and ints or dicts, [...]
>
> First, you want to use pyPgSQL 2.4, which returns Python objects (int,
> ...) instead of the pyPgSQL specific numeric types.
>
> Second, you may want to set fetchReturnsList on the connection object to
> 1 to get tuples instead of PgResultSets back.
>
> HTH,
>
> -- Gerhard
>




From radix at twistedmatrix.com  Sun Aug 10 14:19:48 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sun, 10 Aug 2003 14:19:48 -0400
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <Pine.BSO.4.44.0308101414030.21433-100000@cyclops4.esentire.com>
References: <3F368A76.7030304@ghaering.de> <Pine.BSO.4.44.0308101414030.21433-100000@cyclops4.esentire.com>
Message-ID: <20030810181948.GJ964@radii>

On Sun, Aug 10, 2003 at 02:15:32PM -0400, Edmund Dengler wrote:
> I am using 2.4 (at least that is what PgSQL/__init__.py says).
> 
> The result set is due to the use of the Twisted API. How does this work
> with Deferreds within the adbapi?

Nope, Twisted knows nothing about result sets.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From edmundd at eSentire.com  Sun Aug 10 14:33:38 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sun, 10 Aug 2003 14:33:38 -0400 (EDT)
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <20030810181948.GJ964@radii>
Message-ID: <Pine.BSO.4.44.0308101431310.21433-100000@cyclops4.esentire.com>

Greetings!

Maybe I am missing something then. When using the adbapi, and following
the examples in the HowTo pages, I get a deferred for the query that
passes in the entire result set. How would I restructure the example(s)
such that a deferred would only get a single row, and how would I then
cause the next row to be fetched (via a deferred)?

Regards!
Ed

On Sun, 10 Aug 2003, Christopher Armstrong wrote:

> On Sun, Aug 10, 2003 at 02:15:32PM -0400, Edmund Dengler wrote:
> > I am using 2.4 (at least that is what PgSQL/__init__.py says).
> >
> > The result set is due to the use of the Twisted API. How does this work
> > with Deferreds within the adbapi?
>
> Nope, Twisted knows nothing about result sets.
>
> --
>  Twisted | Christopher Armstrong: International Man of Twistery
>   Radix  |          Release Manager,  Twisted Project
> ---------+     http://twistedmatrix.com/users/radix.twistd/
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From radix at twistedmatrix.com  Sun Aug 10 14:51:16 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sun, 10 Aug 2003 14:51:16 -0400
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <Pine.BSO.4.44.0308101431310.21433-100000@cyclops4.esentire.com>
References: <20030810181948.GJ964@radii> <Pine.BSO.4.44.0308101431310.21433-100000@cyclops4.esentire.com>
Message-ID: <20030810185116.GK964@radii>

On Sun, Aug 10, 2003 at 02:33:38PM -0400, Edmund Dengler wrote:
> On Sun, 10 Aug 2003, Christopher Armstrong wrote:
>
> > Nope, Twisted knows nothing about result sets.
>
> Maybe I am missing something then. When using the adbapi, and following
> the examples in the HowTo pages, I get a deferred for the query that
> passes in the entire result set. How would I restructure the example(s)
> such that a deferred would only get a single row, and how would I then
> cause the next row to be fetched (via a deferred)?

Ah, yes, we had a miscommunication. I thought by "result set" you
meant PgResultSet, which is the kind of object that pypgsql returns by
default. If you're just talking about lists, the proper term to use is
"list" or perhaps "sequence".

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From mary-twisted at puzzling.org  Sun Aug 10 18:24:31 2003
From: mary-twisted at puzzling.org (Mary)
Date: Mon, 11 Aug 2003 08:24:31 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030810161957.GE8938@perpetual.moxn.net>
References: <20030810090452.GA5285@titus.home.puzzling.org> <20030810161957.GE8938@perpetual.moxn.net>
Message-ID: <20030810222431.GA847@titus.home.puzzling.org>

On Sun, Aug 10, 2003, Alex Levy wrote:
> Which begs the question, what are you trying to do? There is likely another
> way around whatever problem you're trying to solve.

Previous and next links between pages.

The trouble here is that the logic used within the model is the same
logic that is used to generate children, so splitting them into a
MethodModel (say) and a Page with is passed that MethodModel will still
mean sharing data between them in some way.

For example, assume I am generating a page representing all blog entries
in the month of January 2002. I need to have a link to the page
representing December 2001, and the page representing February 2002.

I also want to link to all the entries themselves. So this would be some
kind of submodel ("entries", say). But when the page's children are
requested, I need to use similar logic (the logic for "entries" is "get
all valid children" and the logic for getDynamicChild is "is this a
valid child?"). In the particular storage method I'm using, neither
example is completely trivial either[1]. Hence why I was attempting to
use the Page itself as its own model rather than passing it a model. If
I pass it a model, I still need to use much of the model logic in
getDynamicChild.

-Mary

[1] It may be that I'm not very good at conceptualising this stuff, but
there's a conflict between the tree-based view which is "months are
parents, entries are children" and a flat view in which December 31st
2001 is right before January 1 2002.



From mary-twisted at puzzling.org  Sun Aug 10 18:25:34 2003
From: mary-twisted at puzzling.org (Mary)
Date: Mon, 11 Aug 2003 08:25:34 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030810161957.GE8938@perpetual.moxn.net>
References: <20030810090452.GA5285@titus.home.puzzling.org> <20030810161957.GE8938@perpetual.moxn.net>
Message-ID: <20030810222534.GB847@titus.home.puzzling.org>

On Sun, Aug 10, 2003, Alex Levy wrote:
> This is an infinite loop. A Page class is both its own model and its own
> view; despite the fact that you've made it part of the template here, it
> will insert its own template and replace the <div/> you have.

Do infinite loops always make twistd uninteruptable?

-Mary



From glyph at twistedmatrix.com  Sun Aug 10 21:59:33 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 10 Aug 2003 20:59:33 -0500
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030810222534.GB847@titus.home.puzzling.org>
Message-ID: <73BDE51B-CB9F-11D7-9301-000393C9700E@twistedmatrix.com>

On Sunday, August 10, 2003, at 05:25 PM, Mary wrote:

> Do infinite loops always make twistd uninteruptable?

As you might imagine, it's not twistd, but python.

Some do, and some don't.  I _think_ that the difference is that 
infinite loops which allocate memory are uninterruptible but those 
which are simply iterating can be interrupted, but I have never managed 
to establish a deterministic difference.




From andrew-twisted at puzzling.org  Sun Aug 10 22:06:32 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 11 Aug 2003 12:06:32 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <73BDE51B-CB9F-11D7-9301-000393C9700E@twistedmatrix.com>
References: <20030810222534.GB847@titus.home.puzzling.org> <73BDE51B-CB9F-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <20030811020632.GA2218@frobozz>

On Sun, Aug 10, 2003 at 08:59:33PM -0500, Glyph Lefkowitz wrote:
> 
> On Sunday, August 10, 2003, at 05:25 PM, Mary wrote:
> 
> >Do infinite loops always make twistd uninteruptable?
> 
> As you might imagine, it's not twistd, but python.
> 
> Some do, and some don't.  I _think_ that the difference is that 
> infinite loops which allocate memory are uninterruptible but those 
> which are simply iterating can be interrupted, but I have never managed 
> to establish a deterministic difference.

Also, bare "except:" clauses can suppress KeyboardInterrupt errors, and a
quick grep shows a disturbingly large number of these in Twisted (perhaps
the Coding Standard needs updating?).  That still wouldn't explain why
SIGTERM doesn't work, though :/

-Andrew.




From andrew-twisted at puzzling.org  Sun Aug 10 22:20:49 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 11 Aug 2003 12:20:49 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030811020632.GA2218@frobozz>
References: <20030810222534.GB847@titus.home.puzzling.org> <73BDE51B-CB9F-11D7-9301-000393C9700E@twistedmatrix.com> <20030811020632.GA2218@frobozz>
Message-ID: <20030811022049.GB2218@frobozz>

On Mon, Aug 11, 2003 at 12:06:32PM +1000, Andrew Bennetts wrote:
> 
> Also, bare "except:" clauses can suppress KeyboardInterrupt errors, and a
> quick grep shows a disturbingly large number of these in Twisted (perhaps
> the Coding Standard needs updating?).  That still wouldn't explain why
> SIGTERM doesn't work, though :/

Except of course, Twisted (by default) installs signal handlers to intercept
SIGTERM and SIGINT.  And these just register a call back in the reactor to
shut it down at the next iteration -- but if there's an infinite loop, the
reactor never regains control, so you're stuck.

So, perhaps these signal handlers should:
    a) log that the event happened *immediately*, if it's possible to safely
       use the log file in a signal handler.  That way at least looking at
       the log file you know you're not being completely ignored, and e.g. a
       message like "Caught SIGTERM -- reactor will shutdown on the next
       iteration." would make it clear that if your program isn't shutting
       down, your code isn't returning to the reactor.
    b) keep a counter, so that if 5 SIGINT or SIGTERMs are caught without
       the reactor shutting down, somehow force a shutdown, perhaps
       uncleanly.  Hopefully this can be done without calling os._exit() ;)
       Bonus points for logging a traceback of where-ever the main thread
       was at the time, to help track down infinite loops...

-Andrew.




From glyph at twistedmatrix.com  Sun Aug 10 23:55:06 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 10 Aug 2003 22:55:06 -0500
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030811022049.GB2218@frobozz>
Message-ID: <98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>

On Sunday, August 10, 2003, at 09:20 PM, Andrew Bennetts wrote:

>     b) keep a counter, so that if 5 SIGINT or SIGTERMs are caught 
> without
>        the reactor shutting down, somehow force a shutdown, perhaps
>        uncleanly.  Hopefully this can be done without calling 
> os._exit() ;)
>        Bonus points for logging a traceback of where-ever the main 
> thread
>        was at the time, to help track down infinite loops...

Huh!  The reactor used to do this at one point, but it seems to have 
been removed.  It's been a while since I looked at the reactor, but 
does anyone remember doing this?




From itamar at itamarst.org  Mon Aug 11 00:03:05 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 11 Aug 2003 00:03:05 -0400
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>
References: <20030811022049.GB2218@frobozz>
	<98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <20030811000305.74850555.itamar@itamarst.org>

On Sun, 10 Aug 2003 22:55:06 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> Huh!  The reactor used to do this at one point, but it seems to have 
> been removed.  It's been a while since I looked at the reactor, but 
> does anyone remember doing this?

I don't remember the reactor ever doing this, so it must've been a long
time ago. Someone add a bug to the issue tracker, please?


-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From stuart.hungerford at anu.edu.au  Mon Aug 11 00:06:37 2003
From: stuart.hungerford at anu.edu.au (Stuart Hungerford)
Date: Mon, 11 Aug 2003 14:06:37 +1000
Subject: [Twisted-Python] static.Data and embedded URL's...
Message-ID: <5.2.0.9.0.20030811135648.028ea0f8@anusf.anu.edu.au>

Hi all,

I'm using twisted.web for an application that generates very
simple HTML page responses.  It's probably way too simple to
consider using Woven.

I've have some resources inheriting from twisted.web.static.Data
and in their render() method they use a very simplistic
template/substitute:

       def render(self, request):
           lines = load_template('foo.html')
           lines = lines % ('foo', 'bar')
           return lines

My question is how embedded URL's in the string result are handled.
Should static.Data pass URL's originally from foo.html for local
images and stylesheets etc for processing?   I may have misunderstood
the role of the static.* classes here?

I'd welcome any comments on a more twistedonic way of doing this
kind of thing...
Cheers,

Stu

--
:: Stuart Hungerford (stuart.hungerford at anu.edu.au)
:: ANU Internet Futures Group




From andrew-twisted at puzzling.org  Mon Aug 11 00:07:10 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 11 Aug 2003 14:07:10 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>
References: <20030811022049.GB2218@frobozz> <98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <20030811040709.GC2218@frobozz>

On Sun, Aug 10, 2003 at 10:55:06PM -0500, Glyph Lefkowitz wrote:
> 
> On Sunday, August 10, 2003, at 09:20 PM, Andrew Bennetts wrote:
> 
> >    b) keep a counter, so that if 5 SIGINT or SIGTERMs are caught without
> >       the reactor shutting down, somehow force a shutdown, perhaps
> >       uncleanly.  Hopefully this can be done without calling os._exit() ;)
> >       Bonus points for logging a traceback of where-ever the main thread
> >       was at the time, to help track down infinite loops...
> 
> Huh!  The reactor used to do this at one point, but it seems to have 
> been removed.  It's been a while since I looked at the reactor, but 
> does anyone remember doing this?

It did used to do this (that's where I got the idea from ;), but there's not
much sign of it anymore.  There's a global 'interruptCountdown' in
twisted.internet.main, but it's no longer used anywhere that I can find.
I'm guessing that in the great Reactor Refactor, or the Bride of Reactor
Refactor, this feature went AWOL...

Who wants to have this bug assigned to them?  :)

-Andrew.




From abe at fettig.net  Mon Aug 11 02:11:07 2003
From: abe at fettig.net (Abe Fettig)
Date: 11 Aug 2003 02:11:07 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
Message-ID: <1060582267.614.15.camel@mingus>

Attached you'll find a patch for twisted.web.woven.widgets.  This patch
is designed to let the List view handle hierarchical data, and therefore
generate tree structures and menus instead of plain lists.

Currently this patch works by checking each Model object within a list
for a "children" attribute.  If the Model has a "children" attribute,
the List view generates a child set of nodes, using its template as the
view and the contents of the "children" attribute as the model.  

Sorry if this isn't making sense, it's past my bedtime :-/

Anyhow, there's an example attached that will hopefully illustrate what
I'm trying to say here.  Run this example without the patch, only the
top-level list is used to generate the output.  Run it with the patch,
and the complete hierarchy is rendered.

I'd like to get some feedback on this.  I'm not really happy with the
hard-coded "children" attribute thing - if there's a more
elegant/twistedish way of expressing a hierarchy of objects in Python
I'd love to know about it.

Abe
-------------- next part --------------
A non-text attachment was scrubbed...
Name: list-demo.py
Type: text/x-python
Size: 1236 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030811/029cf1a4/attachment.py 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: woven-widgets-List-patch.txt
Type: text/x-patch
Size: 797 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030811/029cf1a4/attachment.bin 

From radix at twistedmatrix.com  Mon Aug 11 10:30:19 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Mon, 11 Aug 2003 10:30:19 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
In-Reply-To: <1060582267.614.15.camel@mingus>
References: <1060582267.614.15.camel@mingus>
Message-ID: <20030811143019.GL964@radii>

On Mon, Aug 11, 2003 at 02:11:07AM -0400, Abe Fettig wrote:
> I'd like to get some feedback on this.  I'm not really happy with the
> hard-coded "children" attribute thing - if there's a more
> elegant/twistedish way of expressing a hierarchy of objects in Python
> I'd love to know about it.

Well, my first instinct would be move it into a completely separate
Widget class. Once that's done, I'd make the model, rather than a list
of things with .children attributes, just a list of lists. Also, some
extra patterns for more fine-grained control of how this thing gets
renderred would be nice, but I can't think of any now. 

I do have a need for something like this in Plonk, for the navigation
menu -- I'd like a hierarchy of links displayed rather than just a
contextual "current children" list. I'll try your patch (or something
like it) when I get around to implementing that, and I'll have much
better input then :)



-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From abe at fettig.net  Mon Aug 11 11:15:52 2003
From: abe at fettig.net (Abe Fettig)
Date: 11 Aug 2003 11:15:52 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
In-Reply-To: <20030811143019.GL964@radii>
References: <1060582267.614.15.camel@mingus>  <20030811143019.GL964@radii>
Message-ID: <1060614952.578.29.camel@mingus>

On Mon, 2003-08-11 at 10:30, Christopher Armstrong wrote:

> Well, my first instinct would be move it into a completely separate
> Widget class. 

Fair enough - I just put it into List since it's only a few additional
lines of code, and I didn't want to have to copy-paste the existing List
widget.

> Once that's done, I'd make the model, rather than a list
> of things with .children attributes, just a list of lists. 

You could do it with lists, I suppose.  Say you want to express a
typical hierarchical tree, like this:

Inbox
Outbox
Personal Mail
	Joe
	Fred

You could have a model like so:

[
	["Inbox", []],
	["Outbox", []],
	["Personal Mail", [
		["Joe", []],
		["Fred", []]
	]
]
 
Where each item in the tree is a list made up of two objects: item,
children.

Is that preferable?  It still doesn't seem like the most elegant way of
doing things.  Does anyone have a better idea?

Abe




From bob at redivi.com  Mon Aug 11 11:54:20 2003
From: bob at redivi.com (Bob Ippolito)
Date: Mon, 11 Aug 2003 11:54:20 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
In-Reply-To: <1060614952.578.29.camel@mingus>
Message-ID: <11D6BEF2-CC14-11D7-A79E-000A95686CD8@redivi.com>

On Monday, Aug 11, 2003, at 11:15 America/New_York, Abe Fettig wrote:

> On Mon, 2003-08-11 at 10:30, Christopher Armstrong wrote:
>
>> Well, my first instinct would be move it into a completely separate
>> Widget class.
>
> Fair enough - I just put it into List since it's only a few additional
> lines of code, and I didn't want to have to copy-paste the existing 
> List
> widget.

Couldn't you have done it by subclassing List?

-bob




From radix at twistedmatrix.com  Mon Aug 11 12:18:22 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Mon, 11 Aug 2003 12:18:22 -0400
Subject: [Twisted-Python] Re: [Twisted-commits] Adventures in Epydoc: Stop The Hurt, part 1: The end of privatization
In-Reply-To: <E19mF8V-00084e-00@pyramid.twistedmatrix.com>
References: <E19mF8V-00084e-00@pyramid.twistedmatrix.com>
Message-ID: <20030811161822.GM964@radii>

On Mon, Aug 11, 2003 at 11:03:07AM -0500, radix CVS wrote:
> Modified files:
> Twisted/admin/epyrun 1.20 1.21
> 
> Log message:
> Adventures in Epydoc: Stop The Hurt, part 1: The end of privatization

Some of you have been complaining about the huge size of the API
documentation in recent releases. I've discovered that the reason for
this was most likely a work-around that spiv did so that there are
HTML files for every single method in the documented code (they each
just contained a tiny snippet of HTML that redirected to the canonical
location of the documentation for that method). Assuming 4k blocks on
your filesystem, all of these tiny files added to an immense amount of
wasted space. 

I haven't taken this out, however: I've cut the size of the
documentation in half by removing the "private" cruft. epydoc by
default generates a separate tree of documentation that contains
everything the `public' tree has, but also things it deems "private",
like methods that begin with "_", or objects that are not listed in a
module's "__all__". I've hacked it so that *everything* is considered
`public' by epydoc, and it no longer generates that duplicate
`private' tree.

Next up on my todo for the documentation is to try to get epydoc to
stop documenting non-Twisted things. Currently it's documenting many
things from the Python standard library as well as third-party
libraries that Twisted uses. All of this extra documentation builds up
to about 8.8MB of wasted space, assuming 4k blocks. After that, I'm
going to look into getting the docs building with Python 2.3 (Cory
Dodt has reported problems with code using the twisted.python.hook
module). Also, I'll try to get the Twisted version number on every
page of docs.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From abe at fettig.net  Mon Aug 11 15:29:28 2003
From: abe at fettig.net (Abe Fettig)
Date: 11 Aug 2003 15:29:28 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
In-Reply-To: <11D6BEF2-CC14-11D7-A79E-000A95686CD8@redivi.com>
References: <11D6BEF2-CC14-11D7-A79E-000A95686CD8@redivi.com>
Message-ID: <1060630168.614.208.camel@mingus>

On Mon, 2003-08-11 at 11:54, Bob Ippolito wrote:
> On Monday, Aug 11, 2003, at 11:15 America/New_York, Abe Fettig wrote:

> > Fair enough - I just put it into List since it's only a few additional
> > lines of code, and I didn't want to have to copy-paste the existing 
> > List
> > widget.
> 
> Couldn't you have done it by subclassing List?

Well, yes, but since I'm modifying the behavior of _iterateData it still
means copying and pasting half the code.  Although if I end up using a
model that's incompatible with ListModel than I'll be would be required
to do this anyway.

I've attached a second demo that provides a Tree widget class that
inherits from List.  This widget takes a Model made up of nested lists,
instead of the objects-with-.children I was using before.

Again, comments are invited.

Abe
-------------- next part --------------
A non-text attachment was scrubbed...
Name: list-demo2.py
Type: text/x-python
Size: 1757 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030811/da42abf4/attachment.py 

From edd at usefulinc.com  Tue Aug 12 07:27:45 2003
From: edd at usefulinc.com (Edd Dumbill)
Date: 12 Aug 2003 12:27:45 +0100
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
Message-ID: <1060687664.22348.18.camel@pingu.bunker.heddley.com>

Hello,

Firstly, thanks for Twisted, I'm just starting to use it and I'm
impressed with what I see.  I'm also grateful for the help folks have
given me on the IRC channel.

So here's my problem.  I'm adapting the spider from Twisted to my own
purposes.  One problem I've come across is this: that an HTTP connection
will be opened OK, but is just held open with no return for many many
minutes by a server.

So, I want to implement a timeout.  As I understand it, this is
different from the timeout given at reactor.connectTCP time, as it's
post-connect.  Certainly that's how it looks from here.

I guess that somewhere I want a callLater which stops a download after
so many seconds, and that's what I tried to do.  Unfortunately I have no
idea what to do to implement that.  Most of my attempts ended up in
raising exceptions that brought everything to a halt: my understanding
of the thread of execution throughout the various Twisted components is
currently very immature.

I'd be grateful for pointers on how to implement this, with reference to
twisted/web/spider.py.  Essentially what I want is a timeout to cause an
error that will result in SpiderSender.downloadFailed being invoked,
pretty much as for any other error relating to the HTTP connection does.

With many thanks,

-- Edd





From glyph at twistedmatrix.com  Tue Aug 12 09:48:29 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 12 Aug 2003 08:48:29 -0500
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
In-Reply-To: <1060687664.22348.18.camel@pingu.bunker.heddley.com>
Message-ID: <A7A1A6D4-CCCB-11D7-B69D-000393C9700E@twistedmatrix.com>

On Tuesday, August 12, 2003, at 06:27 AM, Edd Dumbill wrote:

> I'd be grateful for pointers on how to implement this, with reference 
> to
> twisted/web/spider.py.  Essentially what I want is a timeout to cause 
> an
> error that will result in SpiderSender.downloadFailed being invoked,
> pretty much as for any other error relating to the HTTP connection 
> does.

I certainly haven't tested this, but in your SpiderSender subclass, you 
probably want something like

	myTimeout = 120 # seconds
	def notifyDownloadStart(self, uri):
	    reactor.callLater(self.myTimeout, self._timeOut, uri)
	    # rest of notifyDownloadStart

	def _timeOut(self, uri):
	    if self.downloaders.has_key(uri):
	        self.downloaders[uri].loseConnection()




From bob at redivi.com  Tue Aug 12 10:17:15 2003
From: bob at redivi.com (Bob Ippolito)
Date: Tue, 12 Aug 2003 10:17:15 -0400
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
In-Reply-To: <A7A1A6D4-CCCB-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <ACB2C7AF-CCCF-11D7-8C06-000A95686CD8@redivi.com>

On Tuesday, Aug 12, 2003, at 09:48 America/New_York, Glyph Lefkowitz 
wrote:

>
> On Tuesday, August 12, 2003, at 06:27 AM, Edd Dumbill wrote:
>
>> I'd be grateful for pointers on how to implement this, with reference 
>> to
>> twisted/web/spider.py.  Essentially what I want is a timeout to cause 
>> an
>> error that will result in SpiderSender.downloadFailed being invoked,
>> pretty much as for any other error relating to the HTTP connection 
>> does.
>
> I certainly haven't tested this, but in your SpiderSender subclass, 
> you probably want something like
>
> 	myTimeout = 120 # seconds
> 	def notifyDownloadStart(self, uri):
> 	    reactor.callLater(self.myTimeout, self._timeOut, uri)
> 	    # rest of notifyDownloadStart
>
> 	def _timeOut(self, uri):
> 	    if self.downloaders.has_key(uri):
> 	        self.downloaders[uri].loseConnection()

So how do you make this work based upon a *request* to make a download 
stop, rather than a predetermined amount of time?  ;)

-bob




From edd at usefulinc.com  Tue Aug 12 10:22:57 2003
From: edd at usefulinc.com (Edd Dumbill)
Date: 12 Aug 2003 15:22:57 +0100
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
In-Reply-To: <A7A1A6D4-CCCB-11D7-B69D-000393C9700E@twistedmatrix.com>
References: <A7A1A6D4-CCCB-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <1060698177.22348.27.camel@pingu.bunker.heddley.com>

On Tue, 2003-08-12 at 14:48, Glyph Lefkowitz wrote:
> I certainly haven't tested this, but in your SpiderSender subclass, you 
> probably want something like
> 
> 	myTimeout = 120 # seconds
> 	def notifyDownloadStart(self, uri):
> 	    reactor.callLater(self.myTimeout, self._timeOut, uri)
> 	    # rest of notifyDownloadStart
> 
> 	def _timeOut(self, uri):
> 	    if self.downloaders.has_key(uri):
> 	        self.downloaders[uri].loseConnection()
> 

Thanks, I'll try that.  I think it was the loseConnection() bit I was
missing.

My interim solution is a bit nuttier, and I'm not actually convinced it
works, either, but it did allow me to find a bug with 302 redirect loops
(issue 99!)

class TimeOutHTTPPageDownloader(client.HTTPPageDownloader,TimeoutMixin):
    def connectionMade (self):
        self.setTimeout (30)
        client.HTTPPageDownloader.connectionMade (self)

class HTTPDownloader(client.HTTPDownloader):

    protocol = TimeOutHTTPPageDownloader
   

...

-- Edd





From lafou at wanadoo.fr  Tue Aug 12 10:28:16 2003
From: lafou at wanadoo.fr (Philippe =?ISO-8859-1?Q?Lafoucri=E8re?=)
Date: 12 Aug 2003 16:28:16 +0200
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
In-Reply-To: <ACB2C7AF-CCCF-11D7-8C06-000A95686CD8@redivi.com>
References: <ACB2C7AF-CCCF-11D7-8C06-000A95686CD8@redivi.com>
Message-ID: <1060698496.2927.27.camel@biproc>

You should set a var when the download starts :

> > 	myTimeout = 120 # seconds
		self.started = False
> > 	def notifyDownloadStart(self, uri):
> > 	    reactor.callLater(self.myTimeout, self._timeOut, uri)
> > 	    # rest of notifyDownloadStart
		# if download starts :
		self.started = True
> >
> > 	def _timeOut(self, uri):
		if self.started:
> >	 	    if self.downloaders.has_key(uri):
> >	 	        self.downloaders[uri].loseConnection()





From justinjohnson at fastmail.fm  Tue Aug 12 11:22:18 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 12 Aug 2003 09:22:18 -0600
Subject: [Twisted-Python] PB service send output to client
Message-ID: <20030812152218.9B50537F35@www.fastmail.fm>

What is the best way to have a PB service send output to a client to be
printed on the screen?  The only way I'm aware of is by making the client
be a PB service as well with only a remote_print method, but I wasn't
sure if that was the best way to do this.

Thanks.
-Justin



From itamar at itamarst.org  Tue Aug 12 11:54:24 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 12 Aug 2003 11:54:24 -0400
Subject: [Twisted-Python] PB service send output to client
In-Reply-To: <20030812152218.9B50537F35@www.fastmail.fm>
References: <20030812152218.9B50537F35@www.fastmail.fm>
Message-ID: <20030812115424.61d1f3ce.itamar@itamarst.org>

On Tue, 12 Aug 2003 09:22:18 -0600
"Justin Johnson" <justinjohnson at fastmail.fm> wrote:

> What is the best way to have a PB service send output to a client to
> be printed on the screen?  The only way I'm aware of is by making the
> client be a PB service as well with only a remote_print method, but I
> wasn't sure if that was the best way to do this.

"service"? The client should have a PB Referenceable it passes to the
server, that has a remote_print.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Tue Aug 12 12:04:04 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 12 Aug 2003 10:04:04 -0600
Subject: [Twisted-Python] PB service send output to client
In-Reply-To: <20030812115424.61d1f3ce.itamar@itamarst.org>
References: <20030812152218.9B50537F35@www.fastmail.fm> <20030812115424.61d1f3ce.itamar@itamarst.org>
Message-ID: <20030812160404.F2CA337C93@www.fastmail.fm>

Okay, that's what I thought.  Thanks.

On Tue, 12 Aug 2003 11:54:24 -0400, "Itamar Shtull-Trauring"
<itamar at itamarst.org> said:
> On Tue, 12 Aug 2003 09:22:18 -0600
> "Justin Johnson" <justinjohnson at fastmail.fm> wrote:
> 
> > What is the best way to have a PB service send output to a client to
> > be printed on the screen?  The only way I'm aware of is by making the
> > client be a PB service as well with only a remote_print method, but I
> > wasn't sure if that was the best way to do this.
> 
> "service"? The client should have a PB Referenceable it passes to the
> server, that has a remote_print.
> 
> -- 
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From nico at tekNico.net  Tue Aug 12 13:47:10 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Tue, 12 Aug 2003 19:47:10 +0200
Subject: [Twisted-Python] Watching over a Twisted daemon
Message-ID: <3F39281E.9070607@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I'm using the ProcessMonitor class from t.runner.procmon, with good results,
to start and monitor a few daemons from Twisted. If a daemon goes down, it
is restarted immediately, because the class does not detach from the
daemons' streams.

This unfortunately introduces a single point of failure, because if the
Twisted process goes down, it not only does not monitors the daemons
anymore, but effectively takes them down with it.

It would be nice if Twisted could, via the ProcessMonitor class or
otherwise, monitor long running processes to whose streams it is not connected.

That would even allow one to start a second Twisted instance monitoring the
first, while the first could monitor the second, so that they would
effectively act as the watchdog of each other.

I could try and reimplement the ProcessMonitor class making it use pid
files, the output of the ps command, or even /proc/ directly (non-portable),
but first I would like to know if this is a sound idea, or maybe there are
simpler ways to get this result.


- --
"Finding a pianist who can play the notes is cheap.
Just as finding a programmer who can write code is cheap. [...]
Finding a pianist who is a musician, or finding a coder who is an artist
- - that is a rare and precious find indeed."  Russell, on Slashdot

Nicola Larosa - nico at tekNico.net


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/OSgdXv0hgDImBm4RAm2GAKC+4+gcqKuDNuI1Yf3TguzDjQ90zgCfZqo5
oDuXTPu6iiJtcGM9fGlWk/A=
=G1Ub
-----END PGP SIGNATURE-----





From nico at tekNico.net  Tue Aug 12 14:01:54 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Tue, 12 Aug 2003 20:01:54 +0200
Subject: [Twisted-Python] Patch to procmon.py
Message-ID: <3F392B92.2040005@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

The class ProcessMonitor, from t.runner.procmon, is very useful to start and
monitor processes from within Twisted. Alas, that class sends all output
from the controlled processes to the log.

The attached simple patch to the startProcess method allows one to
substitute another protocol for the LoggingProtocol one, on a per-process
basis, keeping the current one as default.

Would it be appropriate for me to submit it to the bug tracker, using it as
a Feature Request container?


- --
"Finding a pianist who can play the notes is cheap.
Just as finding a programmer who can write code is cheap. [...]
Finding a pianist who is a musician, or finding a coder who is an artist
- - that is a rare and precious find indeed."  Russell, on Slashdot

Nicola Larosa - nico at tekNico.net


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/OSuRXv0hgDImBm4RAlOnAKCvvw8qbKybo/fZ50FdJLxWqDnw3QCgx3OW
A+F1TriIL/zjNjUiVE6XEoo=
=sRuq
-----END PGP SIGNATURE-----
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: procmon.py.diff
Url: http://twistedmatrix.com/pipermail/twisted-python/attachments/20030812/c01a01e9/attachment.txt 

From itamar at itamarst.org  Tue Aug 12 16:04:07 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 12 Aug 2003 16:04:07 -0400
Subject: [Twisted-Python] Patch to procmon.py
In-Reply-To: <3F392B92.2040005@tekNico.net>
References: <3F392B92.2040005@tekNico.net>
Message-ID: <20030812160407.35f35eda.itamar@itamarst.org>

On Tue, 12 Aug 2003 20:01:54 +0200
Nicola Larosa <nico at tekNico.net> wrote:

> Would it be appropriate for me to submit it to the bug tracker, using
> it as a Feature Request container?

Yes. *All* patches should go into the tracker.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From tv at twistedmatrix.com  Tue Aug 12 17:15:34 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Wed, 13 Aug 2003 00:15:34 +0300
Subject: [Twisted-Python] Watching over a Twisted daemon
In-Reply-To: <3F39281E.9070607@tekNico.net>
References: <3F39281E.9070607@tekNico.net>
Message-ID: <20030812211534.GA24793@lapdog>

On Tue, Aug 12, 2003 at 07:47:10PM +0200, Nicola Larosa wrote:
> This unfortunately introduces a single point of failure, because if the
> Twisted process goes down, it not only does not monitors the daemons
> anymore, but effectively takes them down with it.

	You really can't control a more-reliable system with a
	less-reliable system. The procmon process is meant to
	be simple enough to not die in vain.

	And monitoring daemons without being able to receive
	their SIGCHLDs is both race-prone and requires polling.
	Not nice.

-- 
:(){ :|:&};:



From maoy at cis.upenn.edu  Wed Aug 13 00:55:09 2003
From: maoy at cis.upenn.edu (Yun Mao)
Date: Wed, 13 Aug 2003 00:55:09 -0400
Subject: [Twisted-Python] suggestions needed on a process output event
In-Reply-To: <20030812160407.35f35eda.itamar@itamarst.org>
References: <3F392B92.2040005@tekNico.net> <20030812160407.35f35eda.itamar@itamarst.org>
Message-ID: <3F39C4AD.5070407@cis.upenn.edu>

Hi. I'm a new to twisted python (and python) and found that they are 
really interesting! I have several questions:
1. Can a reactor listen on several ports at the same time?
2. How to add some special event? For example, I have a process running: 
say "tail -f /var/log/messages". I wish, each time, when the process 
outputs a new line, my protocol could receive such an event (like 
dataReceived), and I can get that new line as my data. How to implement 
this?

Thank you very much!
--yun




From itamar at itamarst.org  Wed Aug 13 01:05:06 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 13 Aug 2003 01:05:06 -0400
Subject: [Twisted-Python] suggestions needed on a process output event
In-Reply-To: <3F39C4AD.5070407@cis.upenn.edu>
References: <3F392B92.2040005@tekNico.net>
	<20030812160407.35f35eda.itamar@itamarst.org>
	<3F39C4AD.5070407@cis.upenn.edu>
Message-ID: <20030813010506.062c3838.itamar@itamarst.org>

On Wed, 13 Aug 2003 00:55:09 -0400
Yun Mao <maoy at cis.upenn.edu> wrote:

> 1. Can a reactor listen on several ports at the same time?

Yes. Just do reactor.listenTCP multiple times.

> 2. How to add some special event? For example, I have a process
> running: say "tail -f /var/log/messages". I wish, each time, when the
> process outputs a new line, my protocol could receive such an event
> (like dataReceived), and I can get that new line as my data. How to
> implement this?

reactor.spawnProcess, with a twisted.protocols.basic.LineReceiver hooked
up to the process. See http://twistedmatrix.com/documents/howto/process

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From glyph at twistedmatrix.com  Wed Aug 13 01:16:10 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 13 Aug 2003 00:16:10 -0500
Subject: [Twisted-Python] suggestions needed on a process output event
In-Reply-To: <20030813010506.062c3838.itamar@itamarst.org>
Message-ID: <40208A96-CD4D-11D7-B69D-000393C9700E@twistedmatrix.com>

On Wednesday, August 13, 2003, at 12:05 AM, Itamar Shtull-Trauring 
wrote:

>> 2. How to add some special event? For example, I have a process
>> running: say "tail -f /var/log/messages". I wish, each time, when the
>> process outputs a new line, my protocol could receive such an event
>> (like dataReceived), and I can get that new line as my data. How to
>> implement this?
>
> reactor.spawnProcess, with a twisted.protocols.basic.LineReceiver 
> hooked
> up to the process. See http://twistedmatrix.com/documents/howto/process

If your process is literally 'tail -f', having an extra UNIX process 
around for it is kinda wasteful.  You can get the same effect by 
keeping an open file around and reading the remainder of it every 
second.  (using reactor.callLater)




From m at moshez.org  Wed Aug 13 01:41:25 2003
From: m at moshez.org (Moshe Zadka)
Date: 13 Aug 2003 05:41:25 -0000
Subject: [Twisted-Python] suggestions needed on a process output event
In-Reply-To: <40208A96-CD4D-11D7-B69D-000393C9700E@twistedmatrix.com>
References: <40208A96-CD4D-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <20030813054125.19634.qmail@green.zadka.com>

On Wed, 13 Aug 2003, Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> If your process is literally 'tail -f', having an extra UNIX process 
> around for it is kinda wasteful.  You can get the same effect by 
> keeping an open file around and reading the remainder of it every 
> second.  (using reactor.callLater)

Remembering such details as clearing EOF bits, and possibly chasing
inodes and stuff. Tail is not as trivial as one would have thought :)
 
-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From nico at tekNico.net  Wed Aug 13 03:39:09 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Wed, 13 Aug 2003 09:39:09 +0200
Subject: [Twisted-Python] Patch to procmon.py
In-Reply-To: <20030812160407.35f35eda.itamar@itamarst.org>
References: <3F392B92.2040005@tekNico.net> <20030812160407.35f35eda.itamar@itamarst.org>
Message-ID: <3F39EB1D.1010000@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> Yes. *All* patches should go into the tracker.

Done. Created issue 194, assigned it to tv, since he seems to have done the
most recent commits to CVS.


- --
"Finding a pianist who can play the notes is cheap.
Just as finding a programmer who can write code is cheap. [...]
Finding a pianist who is a musician, or finding a coder who is an artist
- - that is a rare and precious find indeed."  Russell, on Slashdot

Nicola Larosa - nico at tekNico.net

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/OesbXv0hgDImBm4RAqQEAKC/PWhZF4UiotQIrcF3HqVWF+r+4wCeIpi3
En16oY4KSXgI3kP+byq1dAQ=
=EzGL
-----END PGP SIGNATURE-----




From twisted at evpopov.com  Wed Aug 13 05:42:49 2003
From: twisted at evpopov.com (twisted at evpopov.com)
Date: Wed, 13 Aug 2003 11:42:49 +0200 (MEST)
Subject: [Twisted-Python] Support for ICMP / traceroute ?
Message-ID: <1060767769.3f3a08190933f@imp.pro.proxad.net>

(note to moderators: I sent this message two times before but with a wrong 
source email. You can safely delete them)

Hi,

I?m currently evaluating ?Twisted? to make cross-platform network developments.

The targeted OS are: Win32 (W2K and above), Linux. More Unix flavors would have 
to be supported later on.

>From what I?ve read about ?Twisted?, it should work on those platforms as it is 
python-based. Could you confirm that my own .py scripts will run as-is under 
those different platforms (provided I myself don?t use platform-specific 
features of course) ?

I will need to implement the ping protocol (client side), and most probably 
also the traceroute ?protocol?. I didn?t see those protocols in the doc, but 
would it be possible to implement them with Twisted ? I saw some classes 
related to raw sockets, so I?m confident it should be manageable. I would like 
some confirmations it?s possible and ?cross-platform?ly.

Note: for traceroute, the TTL of the packet has to be set with each packet: 
with the socket API, you can use a setsockopt() call to set it, I don?t know 
how it is managed (if it is) with Twisted. Another way would be to build our 
own IP packet, so that we can set the TTL field.

If answers to those questions are positive, then you may have won a new twisted 
user :).

Thanks for any reply.



From lucas at lucaserve.com  Wed Aug 13 06:04:17 2003
From: lucas at lucaserve.com (Lucas Taylor)
Date: Wed, 13 Aug 2003 03:04:17 -0700
Subject: [Twisted-Python] Deferred database transaction confusion
Message-ID: <01d201c36182$45719420$0201a8c0@lucas2k>

Greetings!

I'm trying to figure out the best way to accomplish database
transactions and I haven't quite got my head wrapped around deferreds
and the adbapi. I'm hoping someone can nudge me in the right direction.

Basically, we have simple terminals that communicate over dialup lines
to a host server. The host server essentially handles the modem
negotiation and passes everything else through to our Twisted server. We
process the transaction and return the result to the client, and the
protocol specifies an ACK is to be returned on successful receipt. So
I've got a dictionary of transport.sessionnos which hold the ACK state
of the connection. Once the terminal has ACKed the host server, it
passes that along to the Twisted server and drops the connection. On
connectionLost I lookup the ACK value of the connection to make sure the
terminal rx'd the data and then I should be able to commit or rollback
any pending db transactions.

Now here's where I'm stuck. I've got a rudimentary idea of how I will be
chaining callbacks to the deferred results of my db interactions, and
once complete the data will be sent to the terminal. And the registered
errbacks need to be able to rollback if necessary. But how do I get the
protocol handler to access the database connection to issue the
commit/rollback?

btw, thanks to the developers for making my project so incredibly
'do-able'. It's really quite cool - I was able to demo a proof of
concept in an evening after downloading Twisted. The protocol handling
was so easy to setup for what we needed that it was silly.


Thanks,

Lucas Taylor




From itamar at itamarst.org  Wed Aug 13 08:23:53 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 13 Aug 2003 08:23:53 -0400
Subject: [Twisted-Python] Deferred database transaction confusion
In-Reply-To: <01d201c36182$45719420$0201a8c0@lucas2k>
References: <01d201c36182$45719420$0201a8c0@lucas2k>
Message-ID: <20030813082353.2ac6cdaa.itamar@itamarst.org>

On Wed, 13 Aug 2003 03:04:17 -0700
"Lucas Taylor" <lucas at lucaserve.com> wrote:

> Now here's where I'm stuck. I've got a rudimentary idea of how I will
> be chaining callbacks to the deferred results of my db interactions,
> and once complete the data will be sent to the terminal. And the
> registered errbacks need to be able to rollback if necessary. But how
> do I get the protocol handler to access the database connection to
> issue the commit/rollback?

You don't. The commit/rollback happens before the Deferred's callbacks
get called. In fact, the commit/rollback are done for you automatically
- if you runInteraction the operations you did will be committed if they
succeeded or rolled back if an exception was raised in the interaction
function.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From abe at fettig.net  Wed Aug 13 10:27:26 2003
From: abe at fettig.net (Abe Fettig)
Date: 13 Aug 2003 10:27:26 -0400
Subject: [Twisted-Python] woven View question
Message-ID: <1060784845.519.10.camel@mingus>

Is it considered cool to use a Woven template to pass arguments to the
View?  For example:

<div view='MyCustomView' doOptionalStuff='1'></div>

...where the View will read the doOptionalStuff parameter and alter it's
output accordingly.

Abe




From corydodt at yahoo.com  Wed Aug 13 11:04:10 2003
From: corydodt at yahoo.com (Cory Dodt)
Date: Wed, 13 Aug 2003 08:04:10 -0700
Subject: [Twisted-Python] Ann: Win32/Python2.3 available
Message-ID: <3F3A536A.1060902@yahoo.com>

Just a note to let you Windows folks know that there are now official 
installers for Python 2.3.  These are built against 1.0.7alpha4.  Python 
2.2 is also now available for this release.

These installers represent a complete overhaul of both the installer 
itself and the system used to build it.  Let me know at 
http://twistedmatrix.com/bugs if there are any problems (assign to 
moonfallen); it's currently untested on WinXP and Win98.

I'd also be interested in hearing about any problems if you want to 
build an installer yourself for whatever reason.  The instructions are 
in win32/README.win32.

C




From twisted at evpopov.com  Wed Aug 13 12:02:14 2003
From: twisted at evpopov.com (popov)
Date: Wed, 13 Aug 2003 18:02:14 +0200
Subject: [Twisted-Python] Support for ICMP / traceroute ?
Message-ID: <005701c361b4$4854cb30$f901a8c0@galbedir>

(a new try, as it seems the message was broken the last time I sent it)

Hi,

I'm currently evaluating 'Twisted' to make cross-platform network
developments.

The targeted OS are: Win32 (W2K and above), Linux. More Unix flavors would
have to be supported later on.

>From what I've read about 'Twisted', it should work on those platforms as it
is python-based. Could you confirm that my own .py scripts will run as-is
under those different platforms (provided I myself don't use
platform-specific features of course) ?

I will need to implement the ping protocol (client side), and most probably
also the traceroute 'protocol'. I didn't see those protocols in the doc, but
would it be possible to implement them with Twisted ? I saw some classes
related to raw sockets, so I'm confident it should be manageable. I would
like some confirmations it's possible and 'cross-platform'ly.

Note: for traceroute, the TTL of the packet has to be set with each packet:
with the socket API, you can use a setsockopt() call to set it, I don't know
how it is managed (if it is) with Twisted. Another way would be to build our
own IP packet, so that we can set the TTL field.

If answers to those questions are positive, then you may have won a new
twisted user :).

Thanks for any reply.




From lucas at lucaserve.com  Wed Aug 13 13:18:07 2003
From: lucas at lucaserve.com (Lucas Taylor)
Date: Wed, 13 Aug 2003 10:18:07 -0700
Subject: [Twisted-Python] Deferred database transaction confusion
References: <01d201c36182$45719420$0201a8c0@lucas2k> <20030813082353.2ac6cdaa.itamar@itamarst.org>
Message-ID: <01e901c361be$de0e1050$0201a8c0@lucas2k>

OK, I receive a response from my interaction, and it will have been
committed if no exceptions occurred. Does this mean I have no way of
controlling the commit/rollback behavior? How would you wrap a series of
transactions that relied on each other?
Say I have a series of db work that needs to be done, like:

selectCustomer
(do some work)
updateCustomer
updateBalance
(do some more work)
insertTxTable

Ignoring the fact that I don't want to commit any of these transactions
until I rx a response from the client, how would I treat these as
atomic? I don't want the updates to actually commit until the insert is
complete into the TxTable. I guess I could move a lot of the logic to a
single stored procedure if it's going to be committed on execution
before the client actually receives the results. But that's no fun.

Maybe what I'll have to do is keep track of every db update/insert and
have corresponding balancing procedures so that I can do a manual
rollback

Thanks,

Lucas Taylor


----- Original Message -----
From: "Itamar Shtull-Trauring" <itamar at itamarst.org>
To: <twisted-python at twistedmatrix.com>
Sent: Wednesday, August 13, 2003 5:23 AM
Subject: Re: [Twisted-Python] Deferred database transaction confusion


>
> You don't. The commit/rollback happens before the Deferred's callbacks
> get called. In fact, the commit/rollback are done for you
automatically
> - if you runInteraction the operations you did will be committed if
they
> succeeded or rolled back if an exception was raised in the interaction
> function.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>




From itamar at itamarst.org  Wed Aug 13 13:26:24 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 13 Aug 2003 13:26:24 -0400
Subject: [Twisted-Python] Deferred database transaction confusion
In-Reply-To: <01e901c361be$de0e1050$0201a8c0@lucas2k>
References: <01d201c36182$45719420$0201a8c0@lucas2k>
	<20030813082353.2ac6cdaa.itamar@itamarst.org>
	<01e901c361be$de0e1050$0201a8c0@lucas2k>
Message-ID: <20030813132624.3297076e.itamar@itamarst.org>

On Wed, 13 Aug 2003 10:18:07 -0700
"Lucas Taylor" <lucas at lucaserve.com> wrote:

> selectCustomer
> (do some work)
> updateCustomer
> updateBalance
> (do some more work)
> insertTxTable

do it in a runInteraction, which is the span of a single transaction,
and lets you do multiple operations. And you can use
reactor.callFromThread to communicate with the main reactor thread.

> Maybe what I'll have to do is keep track of every db update/insert and
> have corresponding balancing procedures so that I can do a manual
> rollback

Eeew, no, don't do that. Worst case roll your own database interaction
code using the threading support, you don't have to use
twisted.enterprise if it doesn't make sense.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Wed Aug 13 15:21:08 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Wed, 13 Aug 2003 13:21:08 -0600
Subject: [Twisted-Python] win32eventreactor problems
Message-ID: <20030813192108.295D937F83@www.fastmail.fm>

I had the win32eventreactor working a while back, but now I have a
problem and I'm not sure what's going on.  The attached file installs
win32eventreactor as follows:

---
if not config.isUnix:
	from twisted.internet import win32eventreactor
	win32eventreactor.install()
---

When I run this I get the following error:

---
Traceback (most recent call last):
  File "E:\ccase\python\uhg\uht\process.py", line 13, in ?
    win32eventreactor.install()
  File
  "E:\Python22\Lib\site-packages\twisted\internet\win32eventreactor.py",
  li
ne 228, in install
    main.installReactor(r)
  File "E:\Python22\Lib\site-packages\twisted\internet\main.py", line 90,
  in ins
tallReactor
    assert not sys.modules.has_key('twisted.internet.reactor'), \
AssertionError: reactor already installed
---

If I comment out the line win32eventreactor.install(), I get the
following error.

---
Traceback (most recent call last):
  File "E:\ccase\python\uhg\uht\process.py", line 60, in ?
    d = openProcess(["cleartool", "lsvob", "-s"])
  File "E:\ccase\python\uhg\uht\process.py", line 55, in openProcess
    reactor.spawnProcess(proto, cmd, cmd_and_args, env=os.environ)
  File "E:\Python22\Lib\site-packages\twisted\internet\default.py", line
  168, in
 spawnProcess
    raise NotImplementedError, "process only available in this reactor on
    POSIX"

NotImplementedError: process only available in this reactor on POSIX
---

As far as I can tell, none of my modules I import are trying to import
and install win32eventreactor.

I'm running Twisted 1.0.7alpha4. with Python 2.2.
Anyone know what I'm doing wrong?  I realize the win32 reactor needs to
be rewritten.  Just trying to make due with what is there now.

Thanks.
-Justin



From radix at twistedmatrix.com  Wed Aug 13 14:29:31 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Wed, 13 Aug 2003 14:29:31 -0400
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813192108.295D937F83@www.fastmail.fm>
References: <20030813192108.295D937F83@www.fastmail.fm>
Message-ID: <20030813182931.GD1789@radii>

On Wed, Aug 13, 2003 at 01:21:08PM -0600, Justin Johnson wrote:
> I had the win32eventreactor working a while back, but now I have a
> problem and I'm not sure what's going on.  The attached file installs
> win32eventreactor as follows:
> 
> ---
> if not config.isUnix:
> 	from twisted.internet import win32eventreactor
> 	win32eventreactor.install()
> ---
> 
> When I run this I get the following error:
> 
> ---
> AssertionError: reactor already installed
> ---

Somewhere, "from twisted.internet import reactor" is happening before
you install the win32eventreactor. The non-default reactors must be
installed before any imports of twisted.internet.reactor.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From itamar at itamarst.org  Wed Aug 13 15:29:12 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 13 Aug 2003 15:29:12 -0400
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813192108.295D937F83@www.fastmail.fm>
References: <20030813192108.295D937F83@www.fastmail.fm>
Message-ID: <20030813152912.48c5e70d.itamar@itamarst.org>

Installing a reactor has to be the *first* thing you do. If at any point
a module did "from twisted.internet import reactor" beforehand, that
will have the default reactor automatically installed if there is no
reactor already. So move that to be the first thing that runs.

This is another good reason to use twistd.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Wed Aug 13 15:32:10 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Wed, 13 Aug 2003 13:32:10 -0600
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813192108.295D937F83@www.fastmail.fm>
References: <20030813192108.295D937F83@www.fastmail.fm>
Message-ID: <20030813193210.8FCA23796A@www.fastmail.fm>

Once more *with* attached file.

On Wed, 13 Aug 2003 13:21:08 -0600, "Justin Johnson"
<justinjohnson at fastmail.fm> said:
> I had the win32eventreactor working a while back, but now I have a
> problem and I'm not sure what's going on.  The attached file installs
> win32eventreactor as follows:
> 
> ---
> if not config.isUnix:
> 	from twisted.internet import win32eventreactor
> 	win32eventreactor.install()
> ---
> 
> When I run this I get the following error:
> 
> ---
> Traceback (most recent call last):
>   File "E:\ccase\python\uhg\uht\process.py", line 13, in ?
>     win32eventreactor.install()
>   File
>   "E:\Python22\Lib\site-packages\twisted\internet\win32eventreactor.py",
>   li
> ne 228, in install
>     main.installReactor(r)
>   File "E:\Python22\Lib\site-packages\twisted\internet\main.py", line 90,
>   in ins
> tallReactor
>     assert not sys.modules.has_key('twisted.internet.reactor'), \
> AssertionError: reactor already installed
> ---
> 
> If I comment out the line win32eventreactor.install(), I get the
> following error.
> 
> ---
> Traceback (most recent call last):
>   File "E:\ccase\python\uhg\uht\process.py", line 60, in ?
>     d = openProcess(["cleartool", "lsvob", "-s"])
>   File "E:\ccase\python\uhg\uht\process.py", line 55, in openProcess
>     reactor.spawnProcess(proto, cmd, cmd_and_args, env=os.environ)
>   File "E:\Python22\Lib\site-packages\twisted\internet\default.py", line
>   168, in
>  spawnProcess
>     raise NotImplementedError, "process only available in this reactor on
>     POSIX"
> 
> NotImplementedError: process only available in this reactor on POSIX
> ---
> 
> As far as I can tell, none of my modules I import are trying to import
> and install win32eventreactor.
> 
> I'm running Twisted 1.0.7alpha4. with Python 2.2.
> Anyone know what I'm doing wrong?  I realize the win32 reactor needs to
> be rewritten.  Just trying to make due with what is there now.
> 
> Thanks.
> -Justin
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: process.py
Type: application/unknown
Size: 1844 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030813/78d41915/attachment.bin 

From bob at redivi.com  Wed Aug 13 15:38:51 2003
From: bob at redivi.com (Bob Ippolito)
Date: Wed, 13 Aug 2003 15:38:51 -0400
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813192108.295D937F83@www.fastmail.fm>
Message-ID: <C4513EF0-CDC5-11D7-9407-000A95686CD8@redivi.com>

On Wednesday, Aug 13, 2003, at 15:21 America/New_York, Justin Johnson 
wrote:

> I had the win32eventreactor working a while back, but now I have a
> problem and I'm not sure what's going on.  The attached file installs
> win32eventreactor as follows:
>
> ---
> if not config.isUnix:
> 	from twisted.internet import win32eventreactor
> 	win32eventreactor.install()
> ---
>
> When I run this I get the following error:
>
> ---
> Traceback (most recent call last):
>   File "E:\ccase\python\uhg\uht\process.py", line 13, in ?
>     win32eventreactor.install()
>   File
>   
> "E:\Python22\Lib\site-packages\twisted\internet\win32eventreactor.py",
>   li
> ne 228, in install
>     main.installReactor(r)
>   File "E:\Python22\Lib\site-packages\twisted\internet\main.py", line 
> 90,
>   in ins
> tallReactor
>     assert not sys.modules.has_key('twisted.internet.reactor'), \
> AssertionError: reactor already installed

You need to win32eventreactor.install() before you import reactor from 
anywhere.. so this typically means that it needs to be at or near the 
top of your __main__ script, and you should do this before you even 
import other modules from Twisted.

-bob




From justinjohnson at fastmail.fm  Wed Aug 13 15:42:11 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Wed, 13 Aug 2003 13:42:11 -0600
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813152912.48c5e70d.itamar@itamarst.org>
References: <20030813192108.295D937F83@www.fastmail.fm> <20030813152912.48c5e70d.itamar@itamarst.org>
Message-ID: <20030813194211.8DBF938C63@www.fastmail.fm>

Sure enough... one of my modules was importing twisted.spread.pb.
I guess I'll look into using twistd and a mktap plugin.

Thank you.

On Wed, 13 Aug 2003 15:29:12 -0400, "Itamar Shtull-Trauring"
<itamar at itamarst.org> said:
> Installing a reactor has to be the *first* thing you do. If at any point
> a module did "from twisted.internet import reactor" beforehand, that
> will have the default reactor automatically installed if there is no
> reactor already. So move that to be the first thing that runs.
> 
> This is another good reason to use twistd.
> 
> -- 
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From radix at twistedmatrix.com  Wed Aug 13 14:46:41 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Wed, 13 Aug 2003 14:46:41 -0400
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813194211.8DBF938C63@www.fastmail.fm>
References: <20030813192108.295D937F83@www.fastmail.fm> <20030813152912.48c5e70d.itamar@itamarst.org> <20030813194211.8DBF938C63@www.fastmail.fm>
Message-ID: <20030813184641.GE1789@radii>

On Wed, Aug 13, 2003 at 01:42:11PM -0600, Justin Johnson wrote:
> Sure enough... one of my modules was importing twisted.spread.pb.
> I guess I'll look into using twistd and a mktap plugin.

remember, you don't necessarily need a mktap plugin. see `twistd
--python'.


-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From tv at twistedmatrix.com  Wed Aug 13 12:10:07 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Wed, 13 Aug 2003 19:10:07 +0300
Subject: [Twisted-Python] Support for ICMP / traceroute ?
In-Reply-To: <1060767769.3f3a08190933f@imp.pro.proxad.net>
References: <1060767769.3f3a08190933f@imp.pro.proxad.net>
Message-ID: <20030813161007.GA20984@lapdog>

On Wed, Aug 13, 2003 at 11:42:49AM +0200, twisted at evpopov.com wrote:
> If answers to those questions are positive, then you may have won a new twisted 
> user :).

	Everything you listed is possible to do with Twisted.

	Parts of it may require you to extend Twisted, but that
	doesn't mean it would be impossible, or even hard.

	Happy?

	Welcome to the fan club.

-- 
:(){ :|:&};:



From m at moshez.org  Wed Aug 13 18:34:50 2003
From: m at moshez.org (Moshe Zadka)
Date: 13 Aug 2003 22:34:50 -0000
Subject: [Twisted-Python] Support for ICMP / traceroute ?
In-Reply-To: <20030813161007.GA20984@lapdog>
References: <20030813161007.GA20984@lapdog>, <1060767769.3f3a08190933f@imp.pro.proxad.net>
Message-ID: <20030813223450.23824.qmail@green.zadka.com>

On Wed, 13 Aug 2003, Tommi Virtanen <tv at twistedmatrix.com> wrote:

> 	Parts of it may require you to extend Twisted, but that
> 	doesn't mean it would be impossible, or even hard.

To clarify what Tommi said: few things [except actual bugs, which
hopefully we don't have] will force you to actually *modify*
Twisted. You may need to write new network code, but stuff like
reactor.{listen,connect}With will hopefully save you from having
to actually modify Twisted.
 
-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From fcolaco at demnet.ubi.pt  Wed Aug 13 21:45:30 2003
From: fcolaco at demnet.ubi.pt (Francisco Miguel =?ISO-8859-1?Q?Cola=E7o?=)
Date: 14 Aug 2003 02:45:30 +0100
Subject: [Twisted-Python] I am having severe problems with guard.
Message-ID: <1060825530.4474.22.camel@homebase.frisco.pt>

  I am having severe problems with guard.  I am making a site in which
users must be authenticated, and a session must be following and
reacting to the user's activities.

  I have made the following module.

from twisted.cred.portal import Portal, IRealm
from twisted.web.util import Redirect

import page, model
reload (page)
reload (model)



class Realm:
    __implements__ = IRealm    
    
    
    def requestAvatar (self, id, mind, *interfaces):
        if IResource not in interfaces:
            raise NotImplementedError ('I cannot do non-web logins
yet.')
        
        ## We are in a web login.        
        m = interfaces[0].model  ## This line should raise an
exception... thus, this is never executed.
        if id:
            m.orig['username'] = id
        else:
            m.orig['username'] = None
        
        resource = page.Page (m)
        resource.putChild ('', SessionWrapper (UsernamePasswordWrapper
(dem_portal, callback = redirectToIndex)))
        return IResource, resource, None


## Create an instance of the realm.
dem_realm = Realm ()



from twisted.cred.checkers import
InMemoryUsernamePasswordDatabaseDontUse, AllowAnonymousAccess
from twisted.web.woven.guard import UsernamePasswordWrapper,
SessionWrapper



def redirectToIndex (dummy):
    """I will redirect to the site main page.
    """
    
    return Redirect ('/index.rpy')



def createResource ():
    ## Create a memory checker.
    checker = InMemoryUsernamePasswordDatabaseDontUse ()
    checker.addUser ('fhc', '12345')
    checker.addUser ('humberto', 'zzzzz')
    checker.addUser ('aes', 'qa')
    
    ## Allow access from unknowns.
    anon = AllowAnonymousAccess()
    
    ## Create the portal.
    dem_portal = Portal (Realm)
    dem_portal.registerChecker (checker)
    dem_portal.registerChecker (anon)
    
    m = model.get_new_model ()
    upass = UsernamePasswordWrapper (dem_portal, callback =
redirectToIndex)
    
    resource = page.Page (m, templateFile = 'index.template.xhtml')
    resource.putChild ('', SessionWrapper (upass))
    
    return resource


page.Page is a customized page that works well, lest that the
'init-perspective' link keeps returning 'No such Resource'.  The page
as several wchild_, wvfactory_ and wvupdate_ attached to it.  I also
would like to contribute back the widgets I have done, as soon as I get
them ready and session aware, if someone has the need for them
(calendar, menu tabs, localized date, title boxes, etc.)

  I have sorted the documentation, logged just about any kind of object
dictionary information and even browsed through the sources, but I still
feel completely lost.

  If help can be provided by someone, I would appreciate if these
questions could be answered:

  1. Why doesn't perspective-init work?

  2. How can I put up a customized login page?

  3. How can I access the page (resource) within requestAvatar?

  4. How can I access the session object from a widget?

  5. How can I examine and issue cookies?

  I hope this does not give you a lot of trouble.  Programming twisted
has been both a wonderful and humbling experience, but I do prefer Woven
to anything I have tried before.  I find it an excellent piece of work
and wish to stick with it for my web programming, while I learn the rest
of Twisted for all the other communication needs.

  Thanks in advance.

     Francisco Cola?o




From tard at 2kservices.com  Thu Aug 14 04:25:15 2003
From: tard at 2kservices.com (Alexander Zhukov)
Date: 14 Aug 2003 12:25:15 +0400
Subject: [Twisted-Python] Problems with wxPython and Twisted on linux
Message-ID: <1060849515.1261.11.camel@dhcp109.off>

Hi. I've problems running wxPython with twisted reactor under linux.
When I try to run the application with 

	wxsupport.install(app)
	reactor.run()

I get the following exception:

Traceback (most recent call last):
  File "wxdemo.py", line 36, in ?
    demo()
  File "wxdemo.py", line 33, in demo
    reactor.run()
  File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
line 121, in run
    self.startRunning(installSignalHandlers=installSignalHandlers)
  File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
line 115, in startRunning
    self._handleSignals()
  File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
line 87, in _handleSignals
    signal.signal(signal.SIGINT, self.sigInt)
SystemError: error return without exception set



Twisted version 1.0.6 and 1.0.7alpha4
wxPythonGTK 2.4.1.2

The same code works fine on windows. Any ideas how to fix it?




From glyph at twistedmatrix.com  Thu Aug 14 06:03:15 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 14 Aug 2003 05:03:15 -0500
Subject: [Twisted-Python] Deleting packages from Twisted and breaking all your code (THIS MEANS YOU)
Message-ID: <85D21C65-CE3E-11D7-B69D-000393C9700E@twistedmatrix.com>

Did the title get your attention?  Good.  If you know someone with 
deployed Twisted code which they hope to upgrade whose attention it did 
not get, please draw their attention here.

I would like to remove some of the more incendiary modules from Twisted 
and put them either into their own repositories for the duration or 
just put them into my directory in sandbox rather than distributing 
with the tarball proper.

The list for the moment (with attendant plans) is:



- twisted.sibling

We definitely need something like this, but it is unmaintained and I am 
unaware of any code that uses it outside of Ninjaneering's proprietary 
codebase.  It should be revisited at some later date once we have 
re-architected the whole of cred/pb/application, and we can leverage 
them to do consistent and semi-transparent distribution.

- twisted.popsicle

Kind of an interesting idea, but totally a research project.  There is 
no more work going into this because it's been empirically determined 
to be too hard to write a back-end.  Probably some neat ideas that 
might be worth picking up again though.  (This is largely being 
superseded by our persistence strategy on Quotient.  Have I mentioned 
quotient yet?  check it out, seriously, it's the best example of the 
core Twisted team's intent of certain facilities in Twisted than you're 
likely to find anywhere else.  http://www.divmod.org/ )

- twisted.world

TOTALLY AWESOME idea that I am really disappointed that I had to let go 
of for performance reasons.  However it is not extensively tested, it 
is very very VERY slow, it is not even the slightest bit fault 
tolerant, and it will even lose data under normal operation in some 
weird corner cases.  Also it leaks disk resources really fast.  All 
these problems are fixable and the overall architecture is sound, but 
it will need a very clever database-head with some serious time on 
his/her hands to improve.




If you have code that relies on any of these, please say something NOW. 
  I would like releases subsequent to 1.1 to start deleting some of the 
superfluous stuff in the Twisted tree so that our users can feel more 
comfortable about trusting what's in the core package to be supported.  
Experimental development projects like these should be carried out 
elsewhere before being merged in, in the future.




From exarkun at intarweb.us  Thu Aug 14 09:11:51 2003
From: exarkun at intarweb.us (Jp Calderone)
Date: Thu, 14 Aug 2003 09:11:51 -0400
Subject: [Twisted-Python] Problems with wxPython and Twisted on linux
In-Reply-To: <1060849515.1261.11.camel@dhcp109.off>
References: <1060849515.1261.11.camel@dhcp109.off>
Message-ID: <20030814131151.GB17971@intarweb.us>

On Thu, Aug 14, 2003 at 12:25:15PM +0400, Alexander Zhukov wrote:
> Hi. I've problems running wxPython with twisted reactor under linux.
> When I try to run the application with 
> 
> 	wxsupport.install(app)
> 	reactor.run()
> 
> I get the following exception:
> 
> [snip - traceback]
> 
> Twisted version 1.0.6 and 1.0.7alpha4
> wxPythonGTK 2.4.1.2
> 
> The same code works fine on windows. Any ideas how to fix it?
> 

  This is a wxPython bug, IIRC.  It was discussed on the list several weeks
ago, but I'm not sure the final resolution was ever posted here.

  Could someone who remembers all the details sum them up in reply to this
thread (and maybe the old one, too?)

  Jp

-- 
Examinations are formidable even to the best prepared, for
even the greatest fool may ask more than the wisest man can answer.
                -- C.C. Colton
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030814/60227352/attachment.pgp 

From justinjohnson at fastmail.fm  Thu Aug 14 09:18:34 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Thu, 14 Aug 2003 07:18:34 -0600
Subject: [Twisted-Python] Problems installing Quotient
Message-ID: <20030814131834.838CC3807A@www.fastmail.fm>

I'm running RedHat 9, Python 2.2.2, Twisted-1.0.7alpha2, latest Quotient,
Lupy, and Reverend.

After installing Quotient, Lupy, and Reverend, I get the following error
trying to run mktap.  Do I need to be running from CVS or something?  The
instructions said 1.0.7alpha1 or greater was okay.  IMessage is not
defined in twisted.protocols.imap4.py.

[jjohn53 at marmot jjohn53]$ mktap quotient --help
An error unexpected occurred:
Traceback (most recent call last):
  File "/usr/lib/python2.2/site-packages/twisted/scripts/mktap.py", line
  182, in run
    options.parseOptions(sys.argv[1:])
  File "/usr/lib/python2.2/site-packages/twisted/python/usage.py", line
  210, in parseOptions
    self.postOptions()
  File "/usr/lib/python2.2/site-packages/twisted/scripts/mktap.py", line
  166, in postOptions
    self.parseOptions(self.params)
  File "/usr/lib/python2.2/site-packages/twisted/python/usage.py", line
  199, in parseOptions
    self.subOptions = parser()
  File "/usr/lib/python2.2/site-packages/twisted/scripts/mktap.py", line
  107, in <lambda>
    [x, None, (lambda obj = y: obj.load().Options()), getattr(y,
    'description', '')]
  File "/usr/lib/python2.2/site-packages/twisted/python/plugin.py", line
  68, in load
    return namedModule(self.module)
  File "/usr/lib/python2.2/site-packages/twisted/python/reflect.py", line
  369, in namedModule
    topLevel = __import__(name)
  File "/usr/lib/python2.2/site-packages/quotient/tap.py", line 15, in ?
    from quotient import login, grabbers, smtpin
  File "/usr/lib/python2.2/site-packages/quotient/login.py", line 41, in
  ?
    from quotient.imapbox import Account as IMAP4Account
  File "/usr/lib/python2.2/site-packages/quotient/imapbox.py", line 13,
  in ?
    from twisted.protocols.imap4 import IAccount, IMailbox, IMessage,
    IMAP4Server, statusRequestHelper
ImportError: cannot import name IMessage
[jjohn53 at marmot jjohn53]$



From mporter at despammed.com  Thu Aug 14 05:09:33 2003
From: mporter at despammed.com (Michael Porter)
Date: Thu, 14 Aug 2003 10:09:33 +0100
Subject: [Twisted-Python] Problems with wxPython and Twisted on linux
References: <1060849515.1261.11.camel@dhcp109.off>
Message-ID: <004501c36269$3473ac70$0201a8c0@dan>

----- Original Message -----
From: "Alexander Zhukov" <tard at 2kservices.com>
Sent: Thursday, August 14, 2003 9:25 AM


> Hi. I've problems running wxPython with twisted reactor under linux.
> When I try to run the application with
>
> wxsupport.install(app)
> reactor.run()
>
> I get the following exception:
>
> Traceback (most recent call last):
>   File "wxdemo.py", line 36, in ?
>     demo()
>   File "wxdemo.py", line 33, in demo
>     reactor.run()
>   File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
> line 121, in run
>     self.startRunning(installSignalHandlers=installSignalHandlers)
>   File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
> line 115, in startRunning
>     self._handleSignals()
>   File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
> line 87, in _handleSignals
>     signal.signal(signal.SIGINT, self.sigInt)
> SystemError: error return without exception set
>
>
>
> Twisted version 1.0.6 and 1.0.7alpha4
> wxPythonGTK 2.4.1.2
>
> The same code works fine on windows. Any ideas how to fix it?
>

This is the same problem I made a post about a few weeks back. It does occur
on Windows (at least for me) but only with the latest version of wxPython
(wxPython 2.4.1.2). It's in the bug trackers for Python (id 762198) and
wxWindows (id 746099) and has apparently been fixed but I don't know when it
will make it into a release.

If you run without signal handlers (reactor.run(installSignalHandlers=0)) it
doesn't occur.

Mike.







From ali at infomed.sld.cu  Thu Aug 14 11:01:01 2003
From: ali at infomed.sld.cu (Ali)
Date: Thu, 14 Aug 2003 11:01:01 -0400
Subject: [Twisted-Python] Documentation about form, guard and *coduicts
Message-ID: <1060873261.3f3ba42d6b740@webmail.sld.cu>

Hi, 

I'm very new to twisted, i read the howtos and i found little info on
form, guard and livepage. where can i find more info on those topics???

TIA,
 Ali



-------------------------------------------------
Este mensaje fue enviado usando el servicio de correo en web de Infomed
http://webmail.sld.cu



From tv at twistedmatrix.com  Thu Aug 14 10:54:29 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu, 14 Aug 2003 17:54:29 +0300
Subject: [Twisted-Python] Support for ICMP / traceroute ?
In-Reply-To: <20030813223450.23824.qmail@green.zadka.com>
References: <1060767769.3f3a08190933f@imp.pro.proxad.net> <20030813223450.23824.qmail@green.zadka.com>
Message-ID: <20030814145429.GA9223@lapdog>

On Wed, Aug 13, 2003 at 10:34:50PM -0000, Moshe Zadka wrote:
> > 	Parts of it may require you to extend Twisted, but that
> > 	doesn't mean it would be impossible, or even hard.
> To clarify what Tommi said: few things [except actual bugs, which
> hopefully we don't have] will force you to actually *modify*
> Twisted. You may need to write new network code, but stuff like
> reactor.{listen,connect}With will hopefully save you from having
> to actually modify Twisted.

	Yes, the use of the word extend was meant exactly in that
	way.

-- 
:(){ :|:&};:



From itamar at itamarst.org  Thu Aug 14 11:05:07 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 14 Aug 2003 11:05:07 -0400
Subject: [Twisted-Python] Deleting packages from Twisted and breaking
 all your code (THIS MEANS YOU)
In-Reply-To: <85D21C65-CE3E-11D7-B69D-000393C9700E@twistedmatrix.com>
References: <85D21C65-CE3E-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <20030814110507.7b176090.itamar@itamarst.org>

On Thu, 14 Aug 2003 05:03:15 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> I would like to remove some of the more incendiary modules from
> Twisted and put them either into their own repositories for the
> duration or just put them into my directory in sandbox rather than
> distributing with the tarball proper.

We also ought to have some sort of policy that all new module and
package development should start in the sandbox. I really like the way
the application refactor has been going on in the sandbox, for example.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From bob at redivi.com  Thu Aug 14 11:21:13 2003
From: bob at redivi.com (Bob Ippolito)
Date: Thu, 14 Aug 2003 11:21:13 -0400
Subject: [Twisted-Python] Deleting packages from Twisted and breaking all your code (THIS MEANS YOU)
In-Reply-To: <20030814110507.7b176090.itamar@itamarst.org>
Message-ID: <F118C3C9-CE6A-11D7-AB6E-000A95686CD8@redivi.com>

On Thursday, Aug 14, 2003, at 11:05 America/New_York, Itamar 
Shtull-Trauring wrote:

> On Thu, 14 Aug 2003 05:03:15 -0500
> Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:
>
>> I would like to remove some of the more incendiary modules from
>> Twisted and put them either into their own repositories for the
>> duration or just put them into my directory in sandbox rather than
>> distributing with the tarball proper.
>
> We also ought to have some sort of policy that all new module and
> package development should start in the sandbox. I really like the way
> the application refactor has been going on in the sandbox, for example.

I agree with this as well, my CFReactor is sitting in the sandbox too.

-bob




From mkimpenhaus at plus.de  Thu Aug 14 13:35:27 2003
From: mkimpenhaus at plus.de (mkimpenhaus at plus.de)
Date: Thu, 14 Aug 2003 19:35:27 +0200
Subject: [Twisted-Python] [twisted-conch] Building own Channels
Message-ID: <OF599B7EA9.DCDBD270-ONC1256D82.005F0595@uz.tengelmann.de>

Hi @all

i am fairly new to twisted conch an connecting per ssh to servers.

I took a look at the sample and everything was working fine. Then I tried 
to derive from the SSHChannel and gave that channel a new name.
F*ck - that seemed to be the wrong way, no connection could be 
established. I searched the code for some hints and found that there are 
already some channels (session, forward-tcp and direct-tcp) implemented 
which seem to work. I was wondering that the derived channel was working 
when naming it by the name of one of those already implemented 
channles(session, forward-tcp and direct-tcp).

Therefore my question:

How do I implement own channels with own names?

Best regards and respect,
Marcus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20030814/6de990e2/attachment.htm 

From z3p at twistedmatrix.com  Thu Aug 14 14:21:09 2003
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Thu, 14 Aug 2003 13:21:09 -0500
Subject: [Twisted-Python] [twisted-conch] Building own Channels
In-Reply-To: <OF599B7EA9.DCDBD270-ONC1256D82.005F0595@uz.tengelmann.de>
References: <OF599B7EA9.DCDBD270-ONC1256D82.005F0595@uz.tengelmann.de>
Message-ID: <20030814182109.GA12125@pyramid.twistedmatrix.com>

On Thu, Aug 14, 2003 at 07:35:27PM +0200, mkimpenhaus at plus.de wrote:
> How do I implement own channels with own names?

If you want to use a channel with a different name, you need to tell the
server and the client that it's a valid channel-name.  Currently, the
only valid ones are session (executing a shell or a command), direct-tcp
(local->remote TCP forwarding) and forward-tcp (remote->local TCP
forwarding.  If you want to implement a different type of channel, the
method you'll want to look at it is
twisted.conch.ssh.connection.SSHConnection.getChannel, and the channel_*
methods.  You probably should take a look at the SSH Connection Protocol
I-D as well.

-p
-- 
       Paul Swartz
(o_    http://www.twistedmatrix.com/users/z3p.twistd/  _o)
//\    z3p at twistedmatrix.com                           /\\
V_/_   AIM: z3penguin                                 _\_V->



From maoy at cis.upenn.edu  Thu Aug 14 14:39:11 2003
From: maoy at cis.upenn.edu (Yun Mao)
Date: Thu, 14 Aug 2003 14:39:11 -0400
Subject: [Twisted-Python] where is the log message
References: <OF599B7EA9.DCDBD270-ONC1256D82.005F0595@uz.tengelmann.de> <20030814182109.GA12125@pyramid.twistedmatrix.com>
Message-ID: <016c01c36293$5e769490$bf00a8c0@evolution>

Hi,
  When I run an application by twistd -y xxx.py --logfile -, I can get all
the log information on the screen. How to get the log info if I only do
python xxx.py ??
Thanks!
Yun




From glyph at twistedmatrix.com  Thu Aug 14 19:21:22 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 14 Aug 2003 18:21:22 -0500
Subject: [Twisted-Python] Problems installing Quotient
In-Reply-To: <20030814131834.838CC3807A@www.fastmail.fm>
Message-ID: <04483A2C-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>

On Thursday, August 14, 2003, at 08:18 AM, Justin Johnson wrote:

> After installing Quotient, Lupy, and Reverend, I get the following 
> error
> trying to run mktap.  Do I need to be running from CVS or something?  
> The
> instructions said 1.0.7alpha1 or greater was okay.  IMessage is not
> defined in twisted.protocols.imap4.py.

Thanks for your interest ;).  Try getting alpha4.  We are trying to 
make sure that Quotient releases do not require Twisted from CVS, but 
they typically *will* require the latest (even alpha) release.

Sorry about the incorrect README.




From glyph at twistedmatrix.com  Thu Aug 14 19:22:31 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 14 Aug 2003 18:22:31 -0500
Subject: [Twisted-Python] Documentation about form, guard and *coduicts
In-Reply-To: <1060873261.3f3ba42d6b740@webmail.sld.cu>
Message-ID: <2D7A311E-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>

On Thursday, August 14, 2003, at 10:01 AM, Ali wrote:

> I'm very new to twisted, i read the howtos and i found little info on
> form, guard

There are some examples in sandbox/glyph in CVS, and looking over 
recent mailing list archives should give you some clues.

> and livepage.

Without a direct neural interface to dp's brain this may be a bit 
challenging.

> where can i find more info on those topics???





From glyph at twistedmatrix.com  Thu Aug 14 19:24:17 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 14 Aug 2003 18:24:17 -0500
Subject: [Twisted-Python] where is the log message
In-Reply-To: <016c01c36293$5e769490$bf00a8c0@evolution>
Message-ID: <6CE75B6E-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>

On Thursday, August 14, 2003, at 01:39 PM, Yun Mao wrote:

>   When I run an application by twistd -y xxx.py --logfile -, I can get 
> all
> the log information on the screen. How to get the log info if I only do
> python xxx.py ??

@see C{twisted.python.log.startLogging}




From andrew-twisted at puzzling.org  Thu Aug 14 21:32:27 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Fri, 15 Aug 2003 11:32:27 +1000
Subject: [Twisted-Python] where is the log message
In-Reply-To: <6CE75B6E-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>
References: <016c01c36293$5e769490$bf00a8c0@evolution> <6CE75B6E-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <20030815013227.GA5127@frobozz>

On Thu, Aug 14, 2003 at 06:24:17PM -0500, Glyph Lefkowitz wrote:
> 
> @see C{twisted.python.log.startLogging}

I think the correct epytext for that is:
    @see L{twisted.python.log.startLogging}

</nitpick>

-Andrew.




From Dave at centralmanclc.com  Fri Aug 15 07:00:53 2003
From: Dave at centralmanclc.com (Dave Thorne)
Date: Fri, 15 Aug 2003 12:00:53 +0100
Subject: [Twisted-Python] Newbie here - question about Guard
Message-ID: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>

Hi,

My name is Dave Thorne, I am a developer at the Central Manchester City
Learning Centre in England, and I have joined this list because I am hoping
to use Twisted for a couple of projects I am working on.

I have just set up a woven application and I am thoroughly getting into the
code and setting everything up, but the one element I am missing is user
authentication. I have found twisted.web.woven.guard and think that this is
what I want, but I may be wrong. All I need is a way of authenticating my
woven application ( my user list is in a database I have - ZODB) so that
users can log in and get access to their information. Unfortunately I can't
seem to find any information about authentication using the guard classes,
and I wondered if anyone could help me. The documentation I have downloaded
is incomplete and I can't find anything on the web about it. I'm not too
bothered about how the authentication works (i.e. basic authentication of
the web browser or a more application driven authentication).

If anyone has any documentation, or even a simple example so I can get
started that would be a great help. Failing that, does anyone have any
experience using the guard classes that would be willing to help me?

Of course, if guard is not the method I need, and there is any other way of
authentication that I don't know about, it would be nice to be pointed in
the right direction.

yours Hopefully,
Dave



From itamar at itamarst.org  Fri Aug 15 08:01:04 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 15 Aug 2003 08:01:04 -0400
Subject: [Twisted-Python] Newbie here - question about Guard
In-Reply-To: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>
References: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>
Message-ID: <20030815080104.35755c4e.itamar@itamarst.org>

On Fri, 15 Aug 2003 12:00:53 +0100
Dave Thorne <Dave at centralmanclc.com> wrote:

> If anyone has any documentation, or even a simple example so I can get
> started that would be a great help. Failing that, does anyone have any
> experience using the guard classes that would be willing to help me?

Look at twisted/web/woven/simpleguard.py and sandbox/glyph/dynademo/
(1.0.7alpha4 or later, probably.)

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Fri Aug 15 13:56:30 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Fri, 15 Aug 2003 11:56:30 -0600
Subject: [Twisted-Python] twistedmatrix.com minor correction
Message-ID: <20030815175630.8CDF538800@www.fastmail.fm>

At http://twistedmatrix.com/products/download. the 1.07 alpha is listed,
but the info below refers to 1.06 which already released.


-----
Twisted 1.0.7alpha4 - Release Candidate

This is an Alpha of Twisted. It is not an official release: there may be
a number of alphas and RCs before *1.0.6* is considered a candidate for
full release. Until then, use this in production at your own risk. If you
want the latest stable release of Twisted, see Twisted 1.0.6, below.



From khowe at perfnet.ca  Fri Aug 15 14:36:00 2003
From: khowe at perfnet.ca (Kevin Howe)
Date: Fri, 15 Aug 2003 14:36:00 -0400
Subject: [Twisted-Python] Using users/roles with Woven
Message-ID: <000301c3635c$165dc150$1a00000a@KHOWE>

Hi,

I've been examining /sandbox/glyph/dynademo in order to learn about guard,
and have a question about where to store login information.

NOTE: I am ultra-new to twisted, so please correct me if I am totally off
base here :)

User accounts stored in RDBMS:

  User table (user information)
      user_id, first_name, last_name, email

  Roles table (actions the user is allowed to perform)
      user_id, role

  A user may have multiple roles.

Once a user is logged in their profile is fetched from the "User" table and
their permissions are fetched from the "Roles" table. This needs to be
stored for the session so that all pages have access to it. Views are then
customized based on the roles, something like the following:

  class LoggedIn(BasePage):

      def wvupdate_info(self, request, widget, data):

          prefs = request.getSession(IPreferences)
          roles = getattr(prefs, 'roles', [])
          if 'View Info' in roles:
              return 'Information'
          else:
              return ''

Should the login profile/roles be stored somewhere other than Session? The
Twisted.Cred documentation seems to suggest that it should be stored in
either an Indentity or a Perspective:

  In order to simplify integration of services that come from lots of
different places,
  Twisted.Cred presents user-account related information in two different
ways.
  Application-independent user information, such as passwords, public keys,
and
  other things related to the existence and authentication of a particular
person
  should reside in an Identity. Information related to a particular service,
such as
  e-mail messages, high scores, or to-do lists should be represented by a
Perspective.

Could someone explain what a more twisted-style approach might be?

- Kevin





From itamar at itamarst.org  Fri Aug 15 15:09:23 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 15 Aug 2003 15:09:23 -0400
Subject: [Twisted-Python] Using users/roles with Woven
In-Reply-To: <000301c3635c$165dc150$1a00000a@KHOWE>
References: <000301c3635c$165dc150$1a00000a@KHOWE>
Message-ID: <20030815150923.57c2bb91.itamar@itamarst.org>

On Fri, 15 Aug 2003 14:36:00 -0400
"Kevin Howe" <khowe at perfnet.ca> wrote:

> Should the login profile/roles be stored somewhere other than Session?
> The Twisted.Cred documentation seems to suggest that it should be
> stored in either an Indentity or a Perspective:

Argh. Those are both deprecated. I'll update the docs to note this, but
we really need docs of the new system...

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From radix at twistedmatrix.com  Fri Aug 15 14:12:06 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 15 Aug 2003 14:12:06 -0400
Subject: [Twisted-Python] Newbie here - question about Guard
In-Reply-To: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>
References: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>
Message-ID: <20030815181206.GB946@radii>

On Fri, Aug 15, 2003 at 12:00:53PM +0100, Dave Thorne wrote:

> All I need is a way of authenticating my woven application ( my user
> list is in a database I have - ZODB) so that users can log in and
> get access to their information.

You're going to need to create a Credentials Checker to look into ZODB
to get the information. See twisted.cred.checkers.FilePasswordDB for
an example of how to do this -- that one reads a file that has
"username:password" lines and authenticates against
it. `requestAvatarID' is the only public interface that it must
implement.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From radix at twistedmatrix.com  Fri Aug 15 14:14:44 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 15 Aug 2003 14:14:44 -0400
Subject: [Twisted-Python] twistedmatrix.com minor correction
In-Reply-To: <20030815175630.8CDF538800@www.fastmail.fm>
References: <20030815175630.8CDF538800@www.fastmail.fm>
Message-ID: <20030815181444.GC946@radii>

On Fri, Aug 15, 2003 at 11:56:30AM -0600, Justin Johnson wrote:
> At http://twistedmatrix.com/products/download. the 1.07 alpha is listed,
> but the info below refers to 1.06 which already released.

woops, i'll fix it

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From rprice at collegenet.com  Fri Aug 15 17:09:13 2003
From: rprice at collegenet.com (Ray Price)
Date: 15 Aug 2003 14:09:13 -0700
Subject: [Twisted-Python] zserver to twisted migration
Message-ID: <1060981753.17149.267.camel@hotpepper.unival.com>

I am new to Twisted and I'd like to move a few applications from the
Zope Zserver to Twisted.

It is easy to install code within Zserver by adding the following lines
to z2.py:

            #install my own handler
            sys.path.insert(0,"/usr/local/mycode")
            theModule=zhttp_handler('moduleName',"/cgi-bin/")
            hs.install_handler(theModule)

What would be involved in running the above module in twisted?

Thanks,
Ray






From fcolaco at demnet.ubi.pt  Sat Aug 16 16:43:08 2003
From: fcolaco at demnet.ubi.pt (Francisco Miguel =?ISO-8859-1?Q?Cola=E7o?=)
Date: Sat, 16 Aug 2003 21:43:08 +0100
Subject: [Twisted-Python] Some doubts abot guard.
Message-ID: <1061066546.3563.8.camel@homebase.frisco.pt>

  Dear friends,

  Somehow I have managed to put the site authentication to work.  I
still have some doubs about guard:

  1.  If I try to run the site off index.rpy, I am redirected to
'host:port/session-init', which has no resource.  I have to put
'http://hostname:port:file.rpy' in order for the site to load
correctely.  How can I correct this behaviour?

  2.  How can I enter a custom page upon login failure?

  3.  How should I access the session and the user information using
newcred, since 'cred' is (according to this own mailing list) being
deprecated?

  4.  I wish to do a slashdot/plone type of site on woven.  Is anybody
doing the same.  I can offer to help out.  Please reply to the mailing
list so that everyone can know about it and join in.

  Thanks in advance,

     Francisco Cola?o




From screwtape at froup.com  Sun Aug 17 11:21:42 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Mon, 18 Aug 2003 01:21:42 +1000
Subject: [Twisted-Python] Twisted and curses
Message-ID: <20030817152142.GA28629@ferd2.thristian.org>

I've been toying with the idea of writing a GUI toolkit in Python with
the curses library. Obviously such a thing would have to be
event-driven, and if I ever wanted any network connectivity I'd want
to use Twisted.

Twisted does not come with a curses reactor, but with a little
experimentation I found out how to make the reactor's .listenWith()
method do more or less what I wanted.

Code is here (5KB tarball):

	http://members.optusnet.com.au/thristian/curses.tar.gz

You get cursesapp.py, a thin wrapper around curses setup, teardown,
and the eventloop, and test.py, a very simple demonstration program.
There's lots of comments and docstrings.

What do you think?

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _    _
|
| "Screwtape: the Hippocrates of Large Animal Transport"
|



From fcolaco at demnet.ubi.pt  Sun Aug 17 12:36:28 2003
From: fcolaco at demnet.ubi.pt (Francisco Miguel =?ISO-8859-1?Q?Cola=E7o?=)
Date: Sun, 17 Aug 2003 17:36:28 +0100
Subject: [Twisted-Python] Encoding patch for twisted.web.microdom.Document
Message-ID: <1061138187.3747.9.camel@homebase.frisco.pt>

  I have patched that class, in order to make the xml opening as:
 
  <?xml version="1.0" encoding="utf-8" ?>

  One may choose the encoding by passing the encoding="my-encoding" as
an additional argument to Document.

  This is the only way I have for the site I do (in continental
portuguese, if that matters) in Galeon and Mozilla.
Here is the diff (I have renamed the original microdom.py to
microdom-old.py in order to test the server.


CUT HERE-------------
198c198
<     def __init__(self, documentElement=None):
---
>     def __init__(self, documentElement=None, encoding='utf-8'):
202a203,205
>         ## Add a default encoding.
>         self.encoding = encoding
>
227c230
<         stream.write('<?xml version="1.0"?>' + newl)
---
>         stream.write('<?xml version="1.0" encoding="' + self.encoding
+ '" ?>' + newl)
CUT HERE-------------

  Maybe the same thing dould be applied in xmlrpc.py, since the <?xml?>
string is also hardwired.  Is this patch useful?

    Francisco Cola?o




From twistedmail at filosi.com  Sun Aug 17 12:43:53 2003
From: twistedmail at filosi.com (Alex May)
Date: Sun, 17 Aug 2003 12:43:53 -0400
Subject: [Twisted-Python] Newbie trying to figure out cred
Message-ID: <200308171243.53458.twistedmail@filosi.com>

Hello All,

I am new to the twisted framework.  After some searching through the docs, I 
finally found the howtos and examples that let me grok the basic twisted 
concepts.  Since then I've been successful putting together a basic web 
application with twisted.

Now I am trying to add credential functionality and I am completely lost.  
Initially I read all the API docs, and could not make much sense of how to 
stitch everything together.  Nor could I find any web based credential 
examples.  Finally I found the mailing list thread titled "lies, damn lies, 
and interfaces", which outlined a new cred interface and gave an example 
file.

I upgraded to twisted 1.0.6 and downloaded sandbox/webhappyrealm.py.  When I 
run it and attempt to access /site1 I get the following:

-----
web.Server Traceback (most recent call last):  

twisted.cred.error.UnhandledCredentials: No checker for 
twisted.cred.credentials.IAnonymous ,twisted.cred.credentials.ICredentials

twisted.cred.error.UnhandledCredentials: No checker for 
twisted.cred.credentials.IAnonymous ,twisted.cred.credentials.ICredentials
-----
 
Are these new interfaces mature enough to use?  Should I instead use the CVS 
version of twisted?  Or am I just being stupid and doing something wrong?

Please help!

Thanks,
Alex

PS: I'm running python 2.2.2.





From glyph at twistedmatrix.com  Sun Aug 17 14:16:07 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 17 Aug 2003 13:16:07 -0500
Subject: [Twisted-Python] Newbie trying to figure out cred
In-Reply-To: <200308171243.53458.twistedmail@filosi.com>
Message-ID: <DF298CA8-D0DE-11D7-92D5-000393C9700E@twistedmatrix.com>

On Sunday, August 17, 2003, at 11:43 AM, Alex May wrote:

> I upgraded to twisted 1.0.6 and downloaded sandbox/webhappyrealm.py.  
> When I
> run it and attempt to access /site1 I get the following:

If you are using new cred, please upgrade to the latest alpha.  (There 
should be another one coming out tonight.)  It is new code, and while 
the core isn't changing very much, a lot of other systems that use it 
are being updated, and new examples are being added.

Also, please check out Quotient (www.divmod.org) for a more complete 
example.

I have noticed that about 1/3 of the traffic on this mailing list is 
now "I am trying to understand  cred (usually in the context of 
woven.guard) and the docs seem incomplete.  Help!".  It's is my fault 
that it's so badly documented, and I am duly apologetic, but I simply 
don't have the time to fix this in the near term, and we need a 
solution in the near term.

Thankfully, Travis has agreed to take over the issue for me for a 
while.  I'd like it if some of you that are having problems with the 
state of the documentation could coordinate with him to produce a 
sensible tutorial (and probably some patches to guard!) that will 
reduce the future volume of these questions :)




From wari at home.wari.org  Mon Aug 18 06:56:13 2003
From: wari at home.wari.org (Wari Wahab)
Date: 18 Aug 2003 18:56:13 +0800
Subject: [Twisted-Python] IMAP4Client barfed with cyrus-imap
Message-ID: <1061204173.12582.58.camel@minisync>

Hi there, I was trying out IMAP4Client subclass (is that the correct
way?), and I did a simple 10 liner program that lists out available
folders in an IMAP box, things worked fine with the courier imap server,
but when I tried it with a cyrus imapd, this error occurred on
IMAP4Client.login()

2003/08/18 18:33 SGT [MailClient,client] Capabilities problem: [Failure
instance: Traceback: twisted.protocols.imap4.IMAP4Exception, Unexpected
extra arguments to Capability

So, the difference between these two servers are:
[mailstuff]# telnet courierhost 143
Trying 202.172.46.73...
Connected to courierhost.
Escape character is '^]'.
* OK Courier-IMAP ready. Copyright 1998-2000 Double Precision, Inc.  See
COPYING for distribution information.
A01 CAPABILITY
* CAPABILITY IMAP4rev1 CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT
THREAD=REFERENCES SORT STARTTLS
A01 OK CAPABILITY completed
A02 LOGOUT
* BYE Courier-IMAP server shutting down
A02 OK LOGOUT completed
Connection closed by foreign host.

[mailstuff]# telnet cyrushost 143
Trying 65.200.24.205...
Connected to cyrushost.
Escape character is '^]'.
* OK cyrushost Cyrus IMAP4 v2.1.13 server ready
A01 CAPABILITY
* CAPABILITY IMAP4 IMAP4rev1 ACL QUOTA LITERAL+ MAILBOX-REFERRALS
NAMESPACE UIDPLUS ID NO_ATOMIC_RENAME UNSELECT CHILDREN MULTIAPPEND SORT
THREAD=ORDEREDSUBJECT THREAD=REFERENCES IDLE STARTTLS AUTH=DIGEST-MD5
AUTH=CRAM-MD5
A01 OK Completed
A02 LOGOUT
* BYE LOGOUT received
A02 OK Completed
Connection closed by foreign host.

Is this a bug?



From exarkun at intarweb.us  Mon Aug 18 10:19:12 2003
From: exarkun at intarweb.us (Jp Calderone)
Date: Mon, 18 Aug 2003 10:19:12 -0400
Subject: [Twisted-Python] IMAP4Client barfed with cyrus-imap
In-Reply-To: <1061204173.12582.58.camel@minisync>
References: <1061204173.12582.58.camel@minisync>
Message-ID: <20030818141912.GA30824@intarweb.us>

On Mon, Aug 18, 2003 at 06:56:13PM +0800, Wari Wahab wrote:
> Hi there, I was trying out IMAP4Client subclass (is that the correct
> way?), and I did a simple 10 liner program that lists out available
> folders in an IMAP box, things worked fine with the courier imap server,
> but when I tried it with a cyrus imapd, this error occurred on
> IMAP4Client.login()
> 
> 2003/08/18 18:33 SGT [MailClient,client] Capabilities problem: [Failure
> instance: Traceback: twisted.protocols.imap4.IMAP4Exception, Unexpected
> extra arguments to Capability
> 
> [snip transcript]
> 
> Is this a bug?
> 

  Probably!  Could you create an issue at http://twistedmatrix.com/bugs/ and
attach the full traceback, as well as a log of the actual transcript
(capture with a logger, such as ethereal, or debug output from the server
(uncomment some of the prints that are already there)) if possible?

  Jp

-- 
"There is no reason for any individual to have a computer in their
home."
                -- Ken Olson, President of DEC, World Future Society
                   Convention, 1977
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030818/a3229235/attachment.pgp 

From corydodt at yahoo.com  Mon Aug 18 12:14:20 2003
From: corydodt at yahoo.com (Cory Dodt)
Date: Mon, 18 Aug 2003 09:14:20 -0700
Subject: [Twisted-Python] Encoding patch for twisted.web.microdom.Document
In-Reply-To: <1061138187.3747.9.camel@homebase.frisco.pt>
References: <1061138187.3747.9.camel@homebase.frisco.pt>
Message-ID: <3F40FB5C.6040909@yahoo.com>

Francisco Miguel Cola?o wrote:

>  I have patched that class, in order to make the xml opening as:
>
>
>  <?xml version="1.0" encoding="utf-8" ?>
>
>  
>
This patch addresses the header without checking the actual character 
encoding of the document, which basically turns inside-out the current 
problem (character encoding can be utf-8 but header doesn't say so).  
Microdom does support utf-8 output, by checking if the strings it 
contains are UnicodeType.  This leaks all over the place, and you would 
get into trouble with your patch if you passed in encoding='utf-8' and 
then provided microdom with an 8-bit string.

There's a few ways to make this less leaky:

- if encoding parameter is something unicodey, make sure self.data is 
UnicodeType anywhere it is written to (i.e. anywhere it appears on the 
left side of an assignment) by raising an exception if it's not
*and*
- make sure you can't change encoding to a non-unicode encoding or pass 
a non-unicode encoding to any methods once the document has nodes

or

- internally convert everything to Unicode even if it is passed in as 
8-bit string, and then use only the encoding parameter to determine how 
writexml should work.

As it happens, there's already a bug open on this issue.  Please sign up 
on roundup and continue discussion of this issue here:

http://twistedmatrix.com/users/roundup.twistd/twisted/issue149

Thanks!  I have already pasted your original email and my reply there.

Cory




From wari at home.wari.org  Mon Aug 18 12:17:16 2003
From: wari at home.wari.org (Wari Wahab)
Date: Tue, 19 Aug 2003 00:17:16 +0800
Subject: [Twisted-Python] IMAP4Client barfed with cyrus-imap
In-Reply-To: <20030818141912.GA30824@intarweb.us>
References: <1061204173.12582.58.camel@minisync> <20030818141912.GA30824@intarweb.us>
Message-ID: <20030818161716.GA30478@celestix.com>

* Jp Calderone <exarkun at intarweb.us> [030818 22:32]:
> On Mon, Aug 18, 2003 at 06:56:13PM +0800, Wari Wahab wrote:
> > Is this a bug?
> Probably!  Could you create an issue at
> http://twistedmatrix.com/bugs/ and attach the full traceback, as
> well as a log of the actual transcript (capture with a logger, such
> as ethereal, or debug output from the server (uncomment some of the
> prints that are already there)) if possible?

Ah, ethereal made the conversation so much clearer now:

-----------------------------------------
0001 CAPABILITY .
* OK cyrushost Cyrus IMAP4 v2.1.13 server ready.
0001 BAD Unexpected extra arguments to Capability.
-----------------------------------------

And that's it. The extra dot killed it. It's now registered with issues
as msg606.



From twistedmail at filosi.com  Mon Aug 18 15:14:24 2003
From: twistedmail at filosi.com (Alex May)
Date: Mon, 18 Aug 2003 15:14:24 -0400
Subject: [Twisted-Python] Newbie trying to figure out cred
In-Reply-To: <DF298CA8-D0DE-11D7-92D5-000393C9700E@twistedmatrix.com>
References: <DF298CA8-D0DE-11D7-92D5-000393C9700E@twistedmatrix.com>
Message-ID: <200308181514.24060.twistedmail@filosi.com>

> If you are using new cred, please upgrade to the latest alpha.  (There
> should be another one coming out tonight.)  It is new code, and while
> the core isn't changing very much, a lot of other systems that use it
> are being updated, and new examples are being added.

Honestly, I don't care which cred I use, I just want to get something working.  
I chose new cred only because webhappyrealm.py was available too look at.  If 
new cred is too unstable, I'll happily use old cred - if I can ever figure 
out how to get it to work.

Anyway I updated to the latest alpha (1.0.7aplha4) and webhappyrealm.py still 
failed (even worse as I was unable to access /site2 either).

> Also, please check out Quotient (www.divmod.org) for a more complete
> example.

They require Python 2.3.  Unfortunately, because I'm using gentoo, it will be 
a real pain in the ass to upgrade.  I'll certainly take a look at the source 
code though.  Thanks.

Alex

On Sunday 17 August 2003 02:16 pm, Glyph Lefkowitz wrote:
> On Sunday, August 17, 2003, at 11:43 AM, Alex May wrote:
> > I upgraded to twisted 1.0.6 and downloaded sandbox/webhappyrealm.py.
> > When I
> > run it and attempt to access /site1 I get the following:
>
> If you are using new cred, please upgrade to the latest alpha.  (There
> should be another one coming out tonight.)  It is new code, and while
> the core isn't changing very much, a lot of other systems that use it
> are being updated, and new examples are being added.
>
> Also, please check out Quotient (www.divmod.org) for a more complete
> example.
>
> I have noticed that about 1/3 of the traffic on this mailing list is
> now "I am trying to understand  cred (usually in the context of
> woven.guard) and the docs seem incomplete.  Help!".  It's is my fault
> that it's so badly documented, and I am duly apologetic, but I simply
> don't have the time to fix this in the near term, and we need a
> solution in the near term.
>
> Thankfully, Travis has agreed to take over the issue for me for a
> while.  I'd like it if some of you that are having problems with the
> state of the documentation could coordinate with him to produce a
> sensible tutorial (and probably some patches to guard!) that will
> reduce the future volume of these questions :)
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From andrew-twisted at puzzling.org  Mon Aug 18 21:42:07 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue, 19 Aug 2003 11:42:07 +1000
Subject: [Twisted-Python] Twisted and curses
In-Reply-To: <20030817152142.GA28629@ferd2.thristian.org>
References: <20030817152142.GA28629@ferd2.thristian.org>
Message-ID: <20030819014207.GC472@frobozz>

On Mon, Aug 18, 2003 at 01:21:42AM +1000, screwtape at froup.com wrote:
[...]
> Twisted does not come with a curses reactor, but with a little
> experimentation I found out how to make the reactor's .listenWith()
> method do more or less what I wanted.

Have you seen doc/examples/cursesclient.py ?

> Code is here (5KB tarball):
> 
> 	http://members.optusnet.com.au/thristian/curses.tar.gz
> 
> You get cursesapp.py, a thin wrapper around curses setup, teardown,
> and the eventloop, and test.py, a very simple demonstration program.
> There's lots of comments and docstrings.
> 
> What do you think?

I'm no curses expert, but I'd be interested to see if your cursesapp can
simplify doc/examples/cursesclient.py... ;)

I think proper curses support in Twisted is a good idea though...

-Andrew.




From rtjohan at syspres.com  Tue Aug 19 00:30:56 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Mon, 18 Aug 2003 21:30:56 -0700
Subject: [Twisted-Python] Twisted Install Bug or doing something stupid [newbie]
In-Reply-To: <20030819014207.GC472@frobozz>
Message-ID: <000001c3660a$af776750$3d01a8c0@rjc800>

Just trying twisted for 1st time.

I'm very impressed with what I've read and seen so far.

Did a long evaluation of the different web platforms and twisted has just
about won. Just need to develop some simple stuff for sanity test.

Since I wanted to develop on Python 2.3, I installed Twisted 1.0.7alpha4.

When running pydoc and doing search for twisted - get lot's of docs listed.
Any of the twisted documetnation produces the following error in the web
browser: "problem in C:\Python23\lib\site-packages\twisted\__init__.pyc -
ImportError: cannot import name compat".

Is there something special that needs to be done before documentation is
available or is this just a bug with this alpha release?

Thanks,
Richard





From rtjohan at syspres.com  Tue Aug 19 00:40:06 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Mon, 18 Aug 2003 21:40:06 -0700
Subject: [Twisted-Python] Benchmark/performance of Twisted vs. the Cheetah/Webware/Apache/mod_webkit combo? [newbie]
Message-ID: <000101c3660b$f7a51350$3d01a8c0@rjc800>

Just curious about if there is some general feeling about how Twisted
performs. Would be good to know for estimating the server hardware
requirements.

Is there some dicussion / paper that coves how best to configure
Twisted/Woven for maxium performance? Not needed at the moment, but been
reading the Apache load balancing features. Would be nice to know that this
is available when required.

What does the asynchronous implementation mean in terms of performance. How
much does that give. Primarily looking at Twisted/Woven at the moment for
creating web apps using postgresql DB backend.

If there is some other group I should be posting these newbie questions to,
please let me know.

Thanks,
Richard





From screwtape at froup.com  Tue Aug 19 02:01:56 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Tue, 19 Aug 2003 16:01:56 +1000
Subject: [Twisted-Python] Twisted and curses
In-Reply-To: <20030819014207.GC472@frobozz>
References: <20030817152142.GA28629@ferd2.thristian.org> <20030819014207.GC472@frobozz>
Message-ID: <20030819060156.GA2335@ferd2.thristian.org>

On Tue, Aug 19, 2003 at 11:42:07AM +1000, Andrew Bennetts wrote:
> On Mon, Aug 18, 2003 at 01:21:42AM +1000, screwtape at froup.com wrote:
> [...]
> > Twisted does not come with a curses reactor, but with a little
> > experimentation I found out how to make the reactor's .listenWith()
> > method do more or less what I wanted.
> 
> Have you seen doc/examples/cursesclient.py ?

Uh... no. Bugger, I thought I searched the docs before starting.
Evidently, I wasn't thorough enough.

As it turns out, the idea I eventually hit upon is exactly the method
that example uses. Oh well, I guess I learned more about the internals
of the reactor than I otherwise would have. :)

> > Code is here (5KB tarball):
> > 
> > 	http://members.optusnet.com.au/thristian/curses.tar.gz
> > 
> > You get cursesapp.py, a thin wrapper around curses setup, teardown,
> > and the eventloop, and test.py, a very simple demonstration program.
> > There's lots of comments and docstrings.
> > 
> > What do you think?
> 
> I'm no curses expert, but I'd be interested to see if your cursesapp can
> simplify doc/examples/cursesclient.py... ;)

Hmm.. I don't know about simplify, but beautify, sure.

Also, my code handles terminal resizing, which the example code
doesn't.

I'll take a closer look at cursesclient.py tonight or tomorrow and see
if I can (a) figure out exactly what it's doing, and (b) write an
equivalent program that uses my curses module.

> I think proper curses support in Twisted is a good idea though...

Me too, surprisingly. :)

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _
|
| This empty tagline? It's where my conversation piece used to be.
|



From alienoid at is.lg.ua  Tue Aug 19 03:49:19 2003
From: alienoid at is.lg.ua (Ruslan Spivak)
Date: Tue, 19 Aug 2003 10:49:19 +0300
Subject: [Twisted-Python] wxpython + twisted: how to call method on app start up
Message-ID: <3F41D67F.9040104@is.lg.ua>

Hello.

Can you help me with the following:

I have wxpython + twisted application, i have button event handler - 
when button is pressed client connects to twisted server via ssl.


class MyFrame(wxFrame, TaskBarApp):
     ....
     ....

     def OnConnect(self, event=None):
         # Called when 'connect' button is pressed
         bf = pb.PBClientFactory()
         from twisted.internet import ssl
         contextFactory = ssl.ClientContextFactory()
         reactor.connectSSL("localhost", 33333, bf, contextFactory, 30)
         d = bf.getRootObject()

         d.addCallbacks(self.gotObject, self.gotError)


class MyApp(wxApp):
     def OnInit(self):
         frame = MyFrame(NULL, -1, "Infoservice HomeLAN")
         frame.Show(true)
         self.SetTopWindow(frame)
         return true

app = MyApp(0)
wxsupport.install(app)
reactor.run()

In my case user has option - 'autoconnect', so when application is 
launched and autoconnect is true, it will automatically connect to 
server. So i need to call OnConnect, but where is the right place where 
i need to put call to OnConnect? Should i do it with reactor callLater 
or somehow else?

Your help is very, very appreciated.
Thanks in advance.

Best regards,
Ruslan




From mkimpenhaus at plus.de  Tue Aug 19 08:20:01 2003
From: mkimpenhaus at plus.de (mkimpenhaus at plus.de)
Date: Tue, 19 Aug 2003 14:20:01 +0200
Subject: [Twisted-Python] [twisted-conch] Using flow package to control workflow
Message-ID: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>

Hi @all,

I am very sorry, but again I need some advice using the conch package, 
better in this case using the flow package together with conch.

Problem is -> I am using conch to connect per ssh to an server -> execute 
some scripts on the ssh-server -> got the callback and process the result.
For now this is working fine, but there's the problem when triggering the 
connection this method is used to give an resultset. Therefore I thought 
to use the flow package to block the triggering method until the result 
comes.

First, is this attempt ok ? Is it possible to use flow to synchronize that 
async thingie??
Next, what should I use -> I tried to use flow.Block() but now the whole 
script seem to hang?

I would like to give an example but this would go beyond the scope...

Any help is very appreciated.

Best regards and respect,
Marcus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20030819/4601316e/attachment.htm 

From bob at redivi.com  Tue Aug 19 10:06:42 2003
From: bob at redivi.com (Bob Ippolito)
Date: Tue, 19 Aug 2003 10:06:42 -0400
Subject: [Twisted-Python] Re: [Pyobjc-dev] Re: pdb in PyObjC apps?
In-Reply-To: <2m8ypqm14l.fsf@starship.python.net>
Message-ID: <5BD9297E-D24E-11D7-AA43-000A95686CD8@redivi.com>

On Tuesday, Aug 19, 2003, at 05:45 America/New_York, Michael Hudson 
wrote:

> Zachery Bir <zbir at urbanape.com> writes:
>
>> Note to self: Don't use pdb and try to catch it through
>> double-clicking  the app :)
>
> :-)
>
> It shouldn't be *too* outrageously hard to teach my pyrepl interactive
> tool how to cooperate with the Cocoa run loop (you need a way to give
> an fd to Cocoa and say "give me control when there's something to read
> on this" and I'm sure I saw one of them somewhere) in which case you
> could have an interactive session running alongside your
> application... Hmm, where's that can of tuits?

I've developed a CoreFoundation reactor for Twisted that would 
facilitate this sort of thing.  It's not mainline yet because I haven't 
had time to fully test and write enough examples -- it does work, but 
I'm not currently comfortable putting it in the rest of Twisted yet 
(especially due to the Pyrex build dependency).

Here's what you would do (this obviously needs Developer Tools 
installed):

Download Pyrex 0.8.2

Modify Pyrex/Compiler/Nodes.py .. change the block starting on line 160 
to this (small fix to allow system includes):
     for filename in env.include_files:
       if not (filename.startswith('<') and filename.endswith('>')):
         filename = '"%s"' % filename
       code.putln('#include %s' % filename)

Install Pyrex

Checkout CVS HEAD of Twisted

Build and install Twisted (or put twisted into your PYTHONPATH, I have 
a symlink of ~/src/Twisted/twisted at 
~/Library/Python/2.3/site-packages/twisted)

Go into Twisted/sandbox/etrepum/cfsupport

python setup.py build_ext -i

cd TWISTEDPACKAGE/internet
ln -s TWISTEDCVS/sandbox/etrepum/cfreactor.py .
ln -s TWISTEDCVS/sandbox/etrepum/cfsupport/cfsupport.so .

That should work, to test it check out the examples in 
TWISTEDCVS/sandbox/etrepum/examples/PyObjC (which obviously require 
PyObjC, you can get that from PackageManager)

Also note that the cfsupport module is enough to just get notifications 
on the fd, but I recommend using Twisted for anything that talks 
sockets anyway.

-bob




From mkimpenhaus at plus.de  Tue Aug 19 10:19:01 2003
From: mkimpenhaus at plus.de (mkimpenhaus at plus.de)
Date: Tue, 19 Aug 2003 16:19:01 +0200
Subject: [Twisted-Python] [twisted-conch] Executing .profile after login
Message-ID: <OF1B9F8E84.2292C96A-ONC1256D87.004E7029@uz.tengelmann.de>

Hi @all,

me again with some problems :-)

When I login on the ssh-server I want the .profile to be executed. There 
are some special scripts setting the environment for the user.
Is there a simple way to do so??

Best regards and respect,
Marcus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20030819/80eee740/attachment.htm 

From z3p at twistedmatrix.com  Tue Aug 19 10:50:53 2003
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Tue, 19 Aug 2003 09:50:53 -0500
Subject: [Twisted-Python] [twisted-conch] Using flow package to control workflow
In-Reply-To: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>
References: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>
Message-ID: <20030819145053.GA11565@pyramid.twistedmatrix.com>

On Tue, Aug 19, 2003 at 02:20:01PM +0200, mkimpenhaus at plus.de wrote:
> Hi @all,
> 
> I am very sorry, but again I need some advice using the conch package, 
> better in this case using the flow package together with conch.

I know nothing  about flow, but I'll try to answer your questions.

> Problem is -> I am using conch to connect per ssh to an server -> execute 
> some scripts on the ssh-server -> got the callback and process the result.
> For now this is working fine, but there's the problem when triggering the 
> connection this method is used to give an resultset. Therefore I thought 
> to use the flow package to block the triggering method until the result 
> comes.

The last part of that paragraph made no sense.  "triggering the
connection this method is used to give a result set"?  Does that mean
the client class has a function you call with the result?  In general,
the way to "block" on a method is to have that method return a Deferred,
which is called back with the results.  Actual blocking methods will
hang the reactor as it will have to wait for your method to return as
well.

> First, is this attempt ok ? Is it possible to use flow to synchronize that 
> async thingie??

> Next, what should I use -> I tried to use flow.Block() but now the whole 
> script seem to hang?

These are both flow questions, so hopefully someone else can answer
them.

-p
-- 
       Paul Swartz
(o_    http://www.twistedmatrix.com/users/z3p.twistd/  _o)
//\    z3p at twistedmatrix.com                           /\\
V_/_   AIM: z3penguin                                 _\_V->



From z3p at twistedmatrix.com  Tue Aug 19 10:54:00 2003
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Tue, 19 Aug 2003 09:54:00 -0500
Subject: [Twisted-Python] [twisted-conch] Executing .profile after login
In-Reply-To: <OF1B9F8E84.2292C96A-ONC1256D87.004E7029@uz.tengelmann.de>
References: <OF1B9F8E84.2292C96A-ONC1256D87.004E7029@uz.tengelmann.de>
Message-ID: <20030819145400.GB11565@pyramid.twistedmatrix.com>

On Tue, Aug 19, 2003 at 04:19:01PM +0200, mkimpenhaus at plus.de wrote:
> Hi @all,
> 
> me again with some problems :-)
> 
> When I login on the ssh-server I want the .profile to be executed. There 
> are some special scripts setting the environment for the user.
> Is there a simple way to do so??

Which part of the connection is conch?  Server, client, or both?

-p
-- 
       Paul Swartz
(o_    http://www.twistedmatrix.com/users/z3p.twistd/  _o)
//\    z3p at twistedmatrix.com                           /\\
V_/_   AIM: z3penguin                                 _\_V->



From mkimpenhaus at plus.de  Tue Aug 19 11:33:53 2003
From: mkimpenhaus at plus.de (mkimpenhaus at plus.de)
Date: Tue, 19 Aug 2003 17:33:53 +0200
Subject: Antwort: Re: [Twisted-Python] [twisted-conch] Executing .profile after
 login
Message-ID: <OF346454EC.0AF30C6E-ONC1256D87.00551B0C@uz.tengelmann.de>

Hi Paul,

sorry for giving not all informations.
The conch part is the client which connects to an AIX server with sshd.

I tried to place a file called rc into the users home/.ssh directory but 
it wasn't executed anyway.
Also using the command argument in the authorized_keys gave no success.

source: http://www.oreilly.com/catalog/sshtdg/chapter/ch08.html

Best regards and respect
Marcus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20030819/51d933b5/attachment.htm 

From z3p at twistedmatrix.com  Tue Aug 19 11:51:25 2003
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Tue, 19 Aug 2003 10:51:25 -0500
Subject: [Twisted-Python] [twisted-conch] Executing .profile after login
In-Reply-To: <OF346454EC.0AF30C6E-ONC1256D87.00551B0C@uz.tengelmann.de>
References: <OF346454EC.0AF30C6E-ONC1256D87.00551B0C@uz.tengelmann.de>
Message-ID: <20030819155125.GC11565@pyramid.twistedmatrix.com>

On Tue, Aug 19, 2003 at 05:33:53PM +0200, mkimpenhaus at plus.de wrote:
> Hi Paul,
> 
> sorry for giving not all informations.
> The conch part is the client which connects to an AIX server with sshd.

Then it's not really a conch problem.  The server is in charge of
running all the necessary programs.  I'd suggest checking the sshd
and/or bash documentation.

-p
--
Paul Swartz
(o_    http://www.twistedmatrix.com/users/z3p.twistd/  _o)
//\    z3p at twistedmatrix.com                           /\\
V_/_   AIM: z3penguin                                 _\_V->



From cce at clarkevans.com  Tue Aug 19 15:46:55 2003
From: cce at clarkevans.com (Clark C. Evans)
Date: Tue, 19 Aug 2003 19:46:55 +0000
Subject: [Twisted-Python] Using flow package to control workflow
In-Reply-To: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>
References: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>
Message-ID: <20030819194655.GA21407@polya.axista.com>

On Tue, Aug 19, 2003 at 02:20:01PM +0200, mkimpenhaus at plus.de wrote:
| Is it possible to use flow to synchronize that async thingie??

You can use Deferreds within a 'flow' generator, here is an example...

    from __future__ import generators
    from twisted.internet import defer, reactor
    from twisted.flow import flow
    
    def funcThatReturnsDeferred(immediate):
        d = defer.Deferred()
        if immediate:
            d.callback("immediate value")
        else:
            reactor.callLater(1, lambda: d.callback("delayed value"))
        return d 
    
    def myflow():
        #
        # To use a 'deferred' within a generator, it must first
        # be wrapped, then yield, and then use next() on the wrapper.
        #
        immediate = flow.wrap(funcThatReturnsDeferred(True))
        yield immediate
        print immediate.next()
    
        delayed = flow.wrap(funcThatReturnsDeferred(False))
        yield delayed
        print delayed.next()
   
    d = flow.Deferred(myflow)
    d.addCallback(lambda _: reactor.stop())
    reactor.run()

| Next, what should I use -> I tried to use flow.Block() but now
| the whole script seem to hang?

Use flow.Deferred() instead, which in effect takes the results
yielded by the flow and returns them in a list.

| I would like to give an example but this would go beyond the scope...

I hope the above can help.  

Best,

Clark



From oussoren at cistron.nl  Wed Aug 20 02:25:02 2003
From: oussoren at cistron.nl (Ronald Oussoren)
Date: Wed, 20 Aug 2003 08:25:02 +0200
Subject: [Twisted-Python] Re: [Pyobjc-dev] Re: pdb in PyObjC apps?
In-Reply-To: <5BD9297E-D24E-11D7-AA43-000A95686CD8@redivi.com>
References: <5BD9297E-D24E-11D7-AA43-000A95686CD8@redivi.com>
Message-ID: <07E29F7D-D2D7-11D7-BE1F-0003931CFE24@cistron.nl>

On Tuesday, 19 August, 2003, at 16:06, Bob Ippolito wrote:

> On Tuesday, Aug 19, 2003, at 05:45 America/New_York, Michael Hudson 
> wrote:
>
>> Zachery Bir <zbir at urbanape.com> writes:
>>
>>> Note to self: Don't use pdb and try to catch it through
>>> double-clicking  the app :)
>>
>> :-)
>>
>> It shouldn't be *too* outrageously hard to teach my pyrepl interactive
>> tool how to cooperate with the Cocoa run loop (you need a way to give
>> an fd to Cocoa and say "give me control when there's something to read
>> on this" and I'm sure I saw one of them somewhere) in which case you
>> could have an interactive session running alongside your
>> application... Hmm, where's that can of tuits?
>
> I've developed a CoreFoundation reactor for Twisted that would 
> facilitate this sort of thing.  It's not mainline yet because I 
> haven't had time to fully test and write enough examples -- it does 
> work, but I'm not currently comfortable putting it in the rest of 
> Twisted yet (especially due to the Pyrex build dependency).
>
> Here's what you would do (this obviously needs Developer Tools 
> installed):
>
> Download Pyrex 0.8.2
>
> Modify Pyrex/Compiler/Nodes.py .. change the block starting on line 
> 160 to this (small fix to allow system includes):
>     for filename in env.include_files:
>       if not (filename.startswith('<') and filename.endswith('>')):
>         filename = '"%s"' % filename
>       code.putln('#include %s' % filename)
>
> Install Pyrex
>
> Checkout CVS HEAD of Twisted
>
> Build and install Twisted (or put twisted into your PYTHONPATH, I have 
> a symlink of ~/src/Twisted/twisted at 
> ~/Library/Python/2.3/site-packages/twisted)
>
> Go into Twisted/sandbox/etrepum/cfsupport
>
> python setup.py build_ext -i
>
> cd TWISTEDPACKAGE/internet
> ln -s TWISTEDCVS/sandbox/etrepum/cfreactor.py .
> ln -s TWISTEDCVS/sandbox/etrepum/cfsupport/cfsupport.so .
>
> That should work, to test it check out the examples in 
> TWISTEDCVS/sandbox/etrepum/examples/PyObjC (which obviously require 
> PyObjC, you can get that from PackageManager)
>
> Also note that the cfsupport module is enough to just get 
> notifications on the fd, but I recommend using Twisted for anything 
> that talks sockets anyway.

Why didn't you use PyObjC? Is there functionality in CoreFoundation 
that is not in Cocoa or are there other reasons?

Ronald




From lafou at wanadoo.fr  Wed Aug 20 03:50:49 2003
From: lafou at wanadoo.fr (Philippe =?ISO-8859-1?Q?Lafoucri=E8re?=)
Date: 20 Aug 2003 09:50:49 +0200
Subject: [Twisted-Python] IBM developer works
Message-ID: <1061365849.29822.12.camel@biproc>

How to use Twisted.web to serve pages like PHP :

http://www-106.ibm.com/developerworks/linux/library/l-twist3.html






From m at moshez.org  Wed Aug 20 05:25:50 2003
From: m at moshez.org (Moshe Zadka)
Date: 20 Aug 2003 09:25:50 -0000
Subject: [Twisted-Python] IBM developer works
In-Reply-To: <1061365849.29822.12.camel@biproc>
References: <1061365849.29822.12.camel@biproc>
Message-ID: <20030820092550.19084.qmail@green.zadka.com>

On 20 Aug 2003, Philippe =?ISO-8859-1?Q?Lafoucri=E8re?= <lafou at wanadoo.fr> wrote:

> How to use Twisted.web to serve pages like PHP :

Yes, indeed.
That's exactly what it shows. We have already explained why
this is not a good idea.
-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From lafou at wanadoo.fr  Wed Aug 20 05:51:51 2003
From: lafou at wanadoo.fr (Philippe =?ISO-8859-1?Q?Lafoucri=E8re?=)
Date: 20 Aug 2003 11:51:51 +0200
Subject: [Twisted-Python] IBM developer works
In-Reply-To: <20030820092550.19084.qmail@green.zadka.com>
References: <1061365849.29822.12.camel@biproc>
	 <20030820092550.19084.qmail@green.zadka.com>
Message-ID: <1061373111.29825.33.camel@biproc>

> Yes, indeed.
> That's exactly what it shows. We have already explained why
> this is not a good idea.

I know ! I just it's a bad idea to let such article on Internet. Newbies
would always make the same mistake :(




From rtjohan at syspres.com  Wed Aug 20 06:54:57 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Wed, 20 Aug 2003 03:54:57 -0700
Subject: [Twisted-Python] IBM developer works
In-Reply-To: <1061373111.29825.33.camel@biproc>
Message-ID: <004b01c36709$7f4fd210$4601a8c0@rjc800>

I just saw the arcticles on IBM, but have not had
a chance to go through them yet. Just started looking
at Twisted. If there are any well known gotchas I would
be very grateful for any heads-up.

Is there a good article on how to use Twisted for doing
web applications for instance? Is Twisted / Woven a good
way to go for web applications?

Forced to do some .Net/C# for some customers at the moment.
Would prefer to use Python.

Thanks,
Richard

>-----Original Message-----
>From: twisted-python-admin at twistedmatrix.com
>[mailto:twisted-python-admin at twistedmatrix.com] On Behalf Of
>Philippe Lafoucri?re
>Sent: Wednesday, August 20, 2003 2:52 AM
>To: twisted-python at twistedmatrix.com
>Subject: Re: [Twisted-Python] IBM developer works
>
>
>> Yes, indeed.
>> That's exactly what it shows. We have already explained why
>> this is not a good idea.
>
>I know ! I just it's a bad idea to let such article on
>Internet. Newbies
>would always make the same mistake :(
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>





From glyph at twistedmatrix.com  Wed Aug 20 09:18:44 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 20 Aug 2003 08:18:44 -0500
Subject: [Twisted-Python] IBM developer works
In-Reply-To: <004b01c36709$7f4fd210$4601a8c0@rjc800>
Message-ID: <D2ECBB21-D310-11D7-92D5-000393C9700E@twistedmatrix.com>

On Wednesday, August 20, 2003, at 05:54 AM, Richard Johannesson wrote:

> Is there a good article on how to use Twisted for doing
> web applications for instance? Is Twisted / Woven a good
> way to go for web applications?

This article is not particularly bad, as far as that goes; (aside from 
the minor gaffe of defining a class in an RPY file which is mislabeled 
".py") I think it's unfair to say it's "like PHP".  That said, the 
article is about writing a web application, and Twisted works best when 
you reconfigure the sub-atomic particles in your brain to completely 
disassociate the concepts of "web" and "application".

Woven encourages you to develop a completely separate, 
separately-testable abstraction of your application, then wrap that 
with web-specific code.  David's article is just showing you the 
web-specific code part of that, and his "application objects" are lists 
of dictionaries of strings; nothing too sophisticated.

The trouble with documenting such a system is that it's geared towards 
doing non-trivial things.  If your example is non-trivial, then you can 
get carried away with explaining the example rather than explaining 
what the example is supposed to demonstrate.  If it's trivial, then you 
end up with abbreviated versions of things which are intended for more 
sophisticated use-cases, and so they don't always make sense.

For what it's worth, I think David's articles are doing a good job of 
finding that balance.  I'm sure that we'll need a lot more 
documentation before it's clear, though.

Maybe this should be Twisted's motto: "Making theoretically impossible 
things easy, and easy things theoretically possible."




From screwtape at froup.com  Wed Aug 20 10:53:59 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Thu, 21 Aug 2003 00:53:59 +1000
Subject: [Twisted-Python] Twisted and curses
In-Reply-To: <20030819014207.GC472@frobozz>
References: <20030817152142.GA28629@ferd2.thristian.org> <20030819014207.GC472@frobozz>
Message-ID: <20030820145358.GA10188@ferd2.thristian.org>

On Tue, Aug 19, 2003 at 11:42:07AM +1000, Andrew Bennetts wrote:
> I'm no curses expert, but I'd be interested to see if your cursesapp can
> simplify doc/examples/cursesclient.py... ;)

Meh. I spent an evening on it, and I'm still not sure exactly what
cursesclient.py does (other than 'demonstrate that curses and twisted
work together').

On the other hand, I *do* now have a semi-functional IRC client
written for curses that redraws properly when the window is resized
and everything.

I also have a much better understanding of why some oddities of the
Twisted API are the way they are, and a better understanding of why my
curses API sucks.

I guess I'll have a ponder and get back to it if I think of something.
*sigh*

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _
|
| "IMHO, we are a rhombus." -- DrnknMnky
|



From mailinglists at aguete.org  Wed Aug 20 14:12:55 2003
From: mailinglists at aguete.org (Manuel Duran Aguete)
Date: Wed, 20 Aug 2003 20:12:55 +0200
Subject: [Twisted-Python] Transactions with SQLReflector.
Message-ID: <1061403175.31151.26.camel@aguete.dyndns.org>

Hello,
	I need transactions usign SQLReflector. How can I ativate this ?
Basically I have an array of rowObjects  and I want to insert all of
them in a database table, but all in a transaction, and rollback if an
error occurrs.

							Thanks.




From dave at krondo.com  Wed Aug 20 14:51:45 2003
From: dave at krondo.com (Dave Peticolas)
Date: 20 Aug 2003 11:51:45 -0700
Subject: [Twisted-Python] Transactions with SQLReflector.
In-Reply-To: <1061403175.31151.26.camel@aguete.dyndns.org>
References: <1061403175.31151.26.camel@aguete.dyndns.org>
Message-ID: <1061405504.1071.558.camel@oneiros>

On Wed, 2003-08-20 at 11:12, Manuel Duran Aguete wrote:
> Hello,
> 	I need transactions usign SQLReflector. How can I ativate this ?
> Basically I have an array of rowObjects  and I want to insert all of
> them in a database table, but all in a transaction, and rollback if an
> error occurrs.

There isn't an automatic way to do this, but what you can
do is, instead of using sqlreflector.InsertRow(...), use
sqlreflector.InsertRowSQL(...) to build the sql calls to
do this, and then execute them all with the same cursor
using the connection pool's runInteraction method.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030820/362fc801/attachment.pgp 

From bob at redivi.com  Wed Aug 20 18:18:54 2003
From: bob at redivi.com (Bob Ippolito)
Date: Wed, 20 Aug 2003 18:18:54 -0400
Subject: [Twisted-Python] Re: [Pyobjc-dev] Re: pdb in PyObjC apps?
In-Reply-To: <07E29F7D-D2D7-11D7-BE1F-0003931CFE24@cistron.nl>
Message-ID: <48E96202-D35C-11D7-A5A9-000A95686CD8@redivi.com>

On Wednesday, Aug 20, 2003, at 02:25 America/New_York, Ronald Oussoren 
wrote:

> Why didn't you use PyObjC? Is there functionality in CoreFoundation 
> that is not in Cocoa or are there other reasons?

CFSocket notifications, (theoretical) Carbon runloop support, etc.  I 
wrote it in Pyrex after a huge waste of time trying to get it to work 
reliably in ctypes (callbacks would eventually start jumping to random 
locations in memory under load, core dump on uncaught exceptions, 
etc... I think it could be a libffi issue), and I didn't want to go 
through the same ordeal with PyObjC's callbacks after my last failed 
attempt to do Rendezvous callbacks with it.  The Pyrex module was not 
hard to write, and my wrapper does take a  CFRunLoopRef from a PyObjC 
NSRunLoop if you're trying to integrate it with Cocoa or whatever.

-bob




From rtjohan at syspres.com  Thu Aug 21 20:12:37 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Thu, 21 Aug 2003 17:12:37 -0700
Subject: [Twisted-Python] Where to report twistedmatrix.com website errors?
In-Reply-To: <48E96202-D35C-11D7-A5A9-000A95686CD8@redivi.com>
Message-ID: <004501c36842$186eca30$4601a8c0@rjc800>

Noticing a few broken links on the twistedmatrix.com website. Didn't find
any mention of where to email such bug to. Probably not to this list. Anyone
know?





From bob at redivi.com  Thu Aug 21 21:44:55 2003
From: bob at redivi.com (Bob Ippolito)
Date: Thu, 21 Aug 2003 21:44:55 -0400
Subject: [Twisted-Python] Where to report twistedmatrix.com website errors?
In-Reply-To: <004501c36842$186eca30$4601a8c0@rjc800>
Message-ID: <3AF4ECAA-D442-11D7-AFB0-000A95686CD8@redivi.com>

On Thursday, Aug 21, 2003, at 20:12 America/New_York, Richard 
Johannesson wrote:

> Noticing a few broken links on the twistedmatrix.com website. Didn't 
> find
> any mention of where to email such bug to. Probably not to this list. 
> Anyone
> know?

http://www.twistedmatrix.com/bugs/

Create yourself an account

And post issues with the Topics field filled out as "website", sans 
quotes.

-bob




From paul.rudin at ntlworld.com  Fri Aug 22 06:48:31 2003
From: paul.rudin at ntlworld.com (Paul Rudin)
Date: 22 Aug 2003 11:48:31 +0100
Subject: [Twisted-Python] Internet services for online gaming teams.
In-Reply-To: <20030822063901.8702.5871.Mailman@pyramid.twistedmatrix.com>
Message-ID: <m3k796otmo.fsf@ntlworld.com>

Greetings Twisted people (Twisters? :-)),

I recently stumbled over twisted and I thought it might be an
appropriate base for an idea I had.

This message outlines what I have in mind, and I'm hoping that people
will provide some insight into whether Twisted would be likely to
be of significant assistance in implementing such an idea.

This message is possibly only marginally on topic for this list -
please forgive me if you feel it's inappropriate content. If I proceed
with this idea rest assured I will be back with many specific
technical queries :-)

Background
----------

Competitive gaming over the internet has been around for about a
decade, and today is a hobby for millions (and a living for a
few). Teams - in this context traditionally called "clans" compete
against in other in online leagues and ladders, as well as sending
teams to compete in LAN tournaments. Popular games are Quake3, Unreal
Tournament, CounterStrike... (there are hundreds if not thousands).

Clans are notable in that they exist almost exclusively in the
internet. The vast majority of clan members will never meet their
teammates in real life - although as noted above some teams will
attend LAN events. Hence nearly all the organisation and social
interaction happens over the net.

Clans typically will have a number of online services to facilitate
this. Examples:

- irc channels - usually a private one and a public one, normally on
  quakenet (in Europe at least)

- One or more web servers.  Often incorporating some kind of "web
  forum" - phpbb or similar. Clan web servers often have similar
  functionality - access to rosters, game strategies, upcoming
  events, team lists for particular events... result history -
  standing in various leagues and ladders and so forth.

- One or more ftp servers. For hosting recording of prior games; and
  miscellaneous useful files for members.

- A nntp server.

- A voice comms server. E.g. teamspeak or similar.

- One or more game servers. 

- A mail server.


These servers may interact with each other in an ad hoc way. For
example web severs may use scripts to query or control game
servers. Bots in irc channels might provide access to some information
on game servers. However in general these services will not be well
integrated - it is necessary for members to have accounts on each
different server these accounts need to be managed as people join or
leave the clan or change their roles with the clan.


These servers are often hosted in fairly unreliable
environments. Many clan members will have broadband connections at
home and some of the services will be hosted on these. Some services
might be hosted using machines and bandwidth provided by people's
employers or place of study. Those administering the services will
often not be experienced system administrators and will be using
platforms not necessarily ideal for such operations. Often there maybe
be external factors controlling when machines will be up; the
availability of bandwith; and firewalls limiting the types of packets
the machines can send and receive.

Game servers tend to be the exception where the clan will pay a
hosting company to provide a server on fast hardware with a high
bandwith, low latency net connection.

The idea.
---------


I am aware of a number of projects attempting to provide an off the
shelf web server for clans; but it strikes me that it would be a fun
and potentially useful project to have an integrated system across
web, ftp, irc, game servers, voice comms servers etc.

Such a system would have a number of features.

- A repository of all information relating to the clan. This
  repository of information should be stored redundantly and it should
  be easy to propagate across the internet.

- Authentication and sophisticated authorisation mechanism the work
  across all the services

- Access to information information using a variety of standard net
  protocols using familiar software.

- The ability to host services on a variety of different platforms and
  to share the hosting among different servers which may not be very
  reliable.

- Some "off the shelf" utilities to provide the kinds of thing likely
  to be common to most clans.

- Customisable and extensible.

- Very easy to install, so that people without technical expertise can
  contribute CPU cycles and bandwidth to providing services.


A prototype
-----------

As a starting point a web server and an irc bot providing access to
the same distributed persistent information would be a good starting
point for a kind of proof of concept.

Twisted.
--------

I hope the above gives you the flavour of the kind of thing I have in
mind. It's not a detailed or well thought out plan - just something
that occurred to me the other day. I don't know much about Twisted -
but on looking through the web site it seems like it would be a good
tool kit for building such a system. Is this impression accurate?

Part of my motivation for contemplating this is simply to gain some
experience of network programming. I have considerable programming
experience, but mostly large desktop applications.




From andrew-twisted at puzzling.org  Fri Aug 22 07:38:16 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Fri, 22 Aug 2003 21:38:16 +1000
Subject: [Twisted-Python] Internet services for online gaming teams.
In-Reply-To: <m3k796otmo.fsf@ntlworld.com>
References: <20030822063901.8702.5871.Mailman@pyramid.twistedmatrix.com> <m3k796otmo.fsf@ntlworld.com>
Message-ID: <20030822113815.GA9606@frobozz>

On Fri, Aug 22, 2003 at 11:48:31AM +0100, Paul Rudin wrote:
[...]
> The idea.
> ---------
> 
> 
> I am aware of a number of projects attempting to provide an off the
> shelf web server for clans; but it strikes me that it would be a fun
> and potentially useful project to have an integrated system across
> web, ftp, irc, game servers, voice comms servers etc.
[...]

[In short, lots of different protocols integrated into one convenient
bundle]

> Twisted.
> --------
> 
> I hope the above gives you the flavour of the kind of thing I have in
> mind. It's not a detailed or well thought out plan - just something
> that occurred to me the other day. I don't know much about Twisted -
> but on looking through the web site it seems like it would be a good
> tool kit for building such a system. Is this impression accurate?

Yes, I think Twisted would be an excellent fit for this -- multi-protocol
servers are something it excels at.

-Andrew.




From rtjohan at syspres.com  Fri Aug 22 17:31:25 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Fri, 22 Aug 2003 14:31:25 -0700
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <000101c3660b$f7a51350$3d01a8c0@rjc800>
Message-ID: <005e01c368f4$be2c2960$4601a8c0@rjc800>

It seems the twistedmatrix.com website tends to be pretty slow.
What hardware is the twistedmatrix.com website being run on?
Where is it hosted? I'm in California.

Is Twisted + Woven ready for production web apps?
 - Is Woven API stable?
 - Good HTML / XHTML support
 - Scales to multiple web servers / load balancing

Just seems from what I've read twisted is supposed to be pretty close to
Apache + mod_python in terms of performance. Would be nice to find out the
limitation of the platform before hiring and training developers to build
web apps on this platform. Knowing the major limitations can start planning
for it and add that to the head count so those fixes or needed development
gets done.

Any feedback would be appreciated,
Richard





From dp at twistedmatrix.com  Fri Aug 22 18:01:30 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Fri, 22 Aug 2003 15:01:30 -0700
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <005e01c368f4$be2c2960$4601a8c0@rjc800>
References: <005e01c368f4$be2c2960$4601a8c0@rjc800>
Message-ID: <2FCC4150-D4EC-11D7-B76C-000A95864FC4@twistedmatrix.com>

On Friday, August 22, 2003, at 2:31 PM, Richard Johannesson wrote:

> It seems the twistedmatrix.com website tends to be pretty slow.
> What hardware is the twistedmatrix.com website being run on?
> Where is it hosted? I'm in California.

The problem with twistedmatrix.com is that it is currently hosted on
768kbit/sec SDSL...

>
> Is Twisted + Woven ready for production web apps?
>  - Is Woven API stable?

Woven's API is approaching stability. LivePage is currently the only
portion of the API which will still be changing significantly, and it is
possible to make complex apps without even knowing what LivePage is.

>  - Good HTML / XHTML support

Woven templates are XML and woven itself outputs XML.

>  - Scales to multiple web servers / load balancing

Whether this works is really up to how you design your app. Is your 
back-end
data store designed to support scaling across multiple machines?

> Just seems from what I've read twisted is supposed to be pretty close 
> to
> Apache + mod_python in terms of performance. Would be nice to find out 
> the
> limitation of the platform before hiring and training developers to 
> build
> web apps on this platform. Knowing the major limitations can start 
> planning
> for it and add that to the head count so those fixes or needed 
> development
> gets done.

Apache will be faster for serving static files because that is what it 
is designed
for; twisted + woven will be faster for large, very complex, very 
dynamic web
applications because that is what it is designed for. Really, the 
biggest
increase you will see is in programmer and designer productivity; woven
is engineered to cleanly separate the template from the code so that 
skinning
becomes trivial; and to support compositing of small components into 
large,
complex components so that your programmers focus on the functionality
of the app, not the complexities inherit in generating HTML and handling
form input.

dp




From rtjohan at syspres.com  Fri Aug 22 19:12:53 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Fri, 22 Aug 2003 16:12:53 -0700
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <2FCC4150-D4EC-11D7-B76C-000A95864FC4@twistedmatrix.com>
Message-ID: <006901c36902$eb2509b0$4601a8c0@rjc800>

Thanks dp,

>> It seems the twistedmatrix.com website tends to be pretty slow.
>The problem with twistedmatrix.com is that it is currently hosted on
>768kbit/sec SDSL...

Ok - makes sense.

>> Is Twisted + Woven ready for production web apps?
>>  - Is Woven API stable?
>Woven's API is approaching stability. LivePage is currently the only
>portion of the API which will still be changing significantly,
>and it is
>possible to make complex apps without even knowing what LivePage is.
>
>>  - Good HTML / XHTML support
>Woven templates are XML and woven itself outputs XML.

Is there anyone doing XSLT in Twisted? Any xml comparison to say 4suite?

>>  - Scales to multiple web servers / load balancing
>Whether this works is really up to how you design your app. Is your
>back-end data store designed to support scaling across multiple machines?

I was thinking in comparison to using Apache loadbalancing - mod_proxy?

>Apache will be faster for serving static files because that is what it
>is designed
>for; twisted + woven will be faster for large, very complex, very
>dynamic web
>applications because that is what it is designed for. Really, the
>biggest increase you will see is in programmer and designer productivity;
woven
>is engineered to cleanly separate the template from the code so that
>skinning becomes trivial; and to support compositing of small components
into
>large, complex components so that your programmers focus on the
functionality
>of the app, not the complexities inherit in generating HTML and handling
form input.

How would you compare getting web programmers up to speed on twisted vs with
.Net, webware, and zope.

My impression with zope seems to have everything, but also a mess.

Developed using .Net - pretty easy, but buggy.

Webware, seems simple and has a similar clean style to twisted. But, twisted
seems more capable / flexible.

Richard





From bob at redivi.com  Fri Aug 22 20:50:51 2003
From: bob at redivi.com (Bob Ippolito)
Date: Fri, 22 Aug 2003 20:50:51 -0400
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <2FCC4150-D4EC-11D7-B76C-000A95864FC4@twistedmatrix.com>
Message-ID: <D80E508C-D503-11D7-B83B-000A95686CD8@redivi.com>

On Friday, Aug 22, 2003, at 18:01 America/New_York, Donovan Preston 
wrote:

>> Just seems from what I've read twisted is supposed to be pretty close 
>> to
>> Apache + mod_python in terms of performance. Would be nice to find 
>> out the
>> limitation of the platform before hiring and training developers to 
>> build
>> web apps on this platform. Knowing the major limitations can start 
>> planning
>> for it and add that to the head count so those fixes or needed 
>> development
>> gets done.
>
> Apache will be faster for serving static files because that is what it 
> is designed
> for; twisted + woven will be faster for large, very complex, very 
> dynamic web
> applications because that is what it is designed for. Really, the 
> biggest
> increase you will see is in programmer and designer productivity; woven
> is engineered to cleanly separate the template from the code so that 
> skinning
> becomes trivial; and to support compositing of small components into 
> large,
> complex components so that your programmers focus on the functionality
> of the app, not the complexities inherit in generating HTML and 
> handling
> form input.

And this is, of course, why we have squid, because that is what it is 
designed for :)

-bob




From bob at redivi.com  Fri Aug 22 21:01:26 2003
From: bob at redivi.com (Bob Ippolito)
Date: Fri, 22 Aug 2003 21:01:26 -0400
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <006901c36902$eb2509b0$4601a8c0@rjc800>
Message-ID: <522082A5-D505-11D7-B83B-000A95686CD8@redivi.com>

On Friday, Aug 22, 2003, at 19:12 America/New_York, Richard Johannesson 
wrote:

>>>  - Good HTML / XHTML support
>> Woven templates are XML and woven itself outputs XML.
>
> Is there anyone doing XSLT in Twisted? Any xml comparison to say 
> 4suite?

I don't think so, but there isn't any reason why you can't use the 
4suite modules (they're in python, right?).

>
>>>  - Scales to multiple web servers / load balancing
>> Whether this works is really up to how you design your app. Is your
>> back-end data store designed to support scaling across multiple 
>> machines?
>
> I was thinking in comparison to using Apache loadbalancing - mod_proxy?

Theoretically, you would want to do backend load balancing with Twisted 
in a different way, because it has really convenient ways to talk over 
a network (perspective broker, primarily).  If you're just doing round 
robin load balancing or something you might as well use squid on the 
front end or something of that sort.  Unless the application is CPU 
dependent you can probably get away with one or more squid servers and 
a single Twisted server.  It's been a long time since I've seen a site 
/ load that really crawls because of CPU reasons though, it's usually 
the database's fault or just a bandwidth issue.

>
>> Apache will be faster for serving static files because that is what it
>> is designed
>> for; twisted + woven will be faster for large, very complex, very
>> dynamic web
>> applications because that is what it is designed for. Really, the
>> biggest increase you will see is in programmer and designer 
>> productivity;
> woven
>> is engineered to cleanly separate the template from the code so that
>> skinning becomes trivial; and to support compositing of small 
>> components
> into
>> large, complex components so that your programmers focus on the
> functionality
>> of the app, not the complexities inherit in generating HTML and 
>> handling
> form input.
>
> How would you compare getting web programmers up to speed on twisted 
> vs with
> .Net, webware, and zope.
>
> My impression with zope seems to have everything, but also a mess.

I couldn't really find a reason to use Zope, unless it was just to make 
a Plone site ;)  I tried though, but it's just too awkward for me.  
Maybe someone who wasn't used to programming "real" python would have a 
better time with Zope.

>
> Developed using .Net - pretty easy, but buggy.
>

C# is probably one of the most painful web languages I've ever 
developed with for oh so many reasons.   Microsoft really designed some 
horrible to use APIs.  They all seem pretty much ok theoretically, but 
the syntax you end up writing is god awful and long.

> Webware, seems simple and has a similar clean style to twisted. But, 
> twisted
> seems more capable / flexible.

No experience with it..

-bob




From glyph at twistedmatrix.com  Fri Aug 22 15:12:43 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 22 Aug 2003 14:12:43 -0500
Subject: [Twisted-Python] Internet services for online gaming teams.
In-Reply-To: <m3k796otmo.fsf@ntlworld.com>
Message-ID: <9B50FD4C-D4D4-11D7-A143-000393C9700E@twistedmatrix.com>

I'm curious how you're planning to do the integration with existing 
game servers, since those tend to be pretty tricky to communicate with.

And, I'll plug it again: many of the features you're describing are 
already on the timetable for Quotient: http://www.divmod.org/ .  I'm 
spending a lot of time on that these days :).

Twisted is an excellent toolkit for building these sorts of apps, but 
don't underestimate the difficulty of the problem.  Especially, it 
sounds like you need a loosely coupled, wide-area distributed, 
peer-to-peer persistence system (or possibly, object database).  This 
problem can be as hard as you want to make it, so you probably want to 
have a slightly better idea of what services you want to provide beyond 
"providing access to the same distributed persistent information".

I know because I've been thinking about this problem for the past 4 
years or so and I haven't really come up with anything yet :).




From rtjohan at syspres.com  Fri Aug 22 23:31:55 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Fri, 22 Aug 2003 20:31:55 -0700
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <522082A5-D505-11D7-B83B-000A95686CD8@redivi.com>
Message-ID: <000b01c36927$1b0158e0$4601a8c0@rjc800>

Good input bob,

>> My impression with zope seems to have everything, but also a mess.
>I couldn't really find a reason to use Zope, unless it was just to make
>a Plone site ;)  I tried though, but it's just too awkward for me.
>Maybe someone who wasn't used to programming "real" python
>would have a better time with Zope.

That's the impression I got.

>> Developed using .Net - pretty easy, but buggy.
>C# is probably one of the most painful web languages I've ever
>developed with for oh so many reasons.   Microsoft really
>designed some horrible to use APIs.  They all seem pretty much ok
theoretically, but
>the syntax you end up writing is god awful and long.

.Net seems like a big improvement over ASP/PHP, but prefer Python easily
over .Net. If you've done .Net and Twisted - how would you compare the
learning curve for a typical web programmer using either .Net or
Twisted/Woven platform?

Richard





From paul.rudin at ntlworld.com  Sat Aug 23 03:57:12 2003
From: paul.rudin at ntlworld.com (Paul Rudin)
Date: 23 Aug 2003 08:57:12 +0100
Subject: [Twisted-Python] Internet services for online gaming teams.
In-Reply-To: <9B50FD4C-D4D4-11D7-A143-000393C9700E@twistedmatrix.com>
References: <9B50FD4C-D4D4-11D7-A143-000393C9700E@twistedmatrix.com>
Message-ID: <m3fzjsvmav.fsf@ntlworld.com>

Glyph Lefkowitz <glyph at twistedmatrix.com> writes:

> I'm curious how you're planning to do the integration with existing
> game servers, since those tend to be pretty tricky to communicate with.

I think I have to be realistic in that some existing software - the
game server and the voice comms server might be hard to integrate
fully. Nevertheless many game servers provide have things like the
ability to administer them remotely; a fairly rich scripting language;
built in web servers for remote administration and in game irc
clients.

I suppose that for each game it might be necessary to write a proxy
that knew how to talk to the game server on one side and the rest of
the system on the other. For games with rich scripting languages it
might be possible to have scripts running both client and server side
for games that were able to integrate with the rest of the system.

The trouble is that (even to the extent it's possible) you need to
code something for each game.

However many games do provide a consistent mechanism for querying them
about the current gamestate. So in the first instance one could simply
provide web forms and functionality in irc bots that allows you to
find out where team mates are playing, and what's happening on the
game servers that you control.

> 
> And, I'll plug it again: many of the features you're describing are
> already on the timetable for Quotient: http://www.divmod.org/ .  I'm
> spending a lot of time on that these days :).
> 

Thanks - I'll take a look.

> Twisted is an excellent toolkit for building these sorts of apps, but
> don't underestimate the difficulty of the problem.  Especially, it
> sounds like you need a loosely coupled, wide-area distributed,
> peer-to-peer persistence system (or possibly, object database).  This
> problem can be as hard as you want to make it, so you probably want to
> have a slightly better idea of what services you want to provide
> beyond "providing access to the same distributed persistent
> information".
> 

Yes - I think some reading up on peer-to-peer systems would do me some
good. 



> I know because I've been thinking about this problem for the past 4
> years or so and I haven't really come up with anything yet :).


I have an advantage: being almost completely ignorant of this area I
don't realise how hard the problem is :-)



Anyway in the short term I think I should do two things - I'll sit
down and write a better description of of what I'd like to produce
without worrying too much how it'll be achieved, and I'll start
writing little some very little programs just to gain some familiarity
with twisted,




From washort at twistedmatrix.com  Sat Aug 23 05:15:44 2003
From: washort at twistedmatrix.com (Allen Short)
Date: Sat, 23 Aug 2003 04:15:44 -0500 (CDT)
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <000b01c36927$1b0158e0$4601a8c0@rjc800>
References: <522082A5-D505-11D7-B83B-000A95686CD8@redivi.com>
	<000b01c36927$1b0158e0$4601a8c0@rjc800>
Message-ID: <20030823.041544.501808932.washort@twistedmatrix.com>

>>>>> "Richard" == Richard Johannesson <rtjohan at syspres.com> writes:


    > .Net seems like a big improvement over ASP/PHP, but prefer
    > Python easily over .Net. If you've done .Net and Twisted - how
    > would you compare the learning curve for a typical web
    > programmer using either .Net or Twisted/Woven platform?


I haven't used any of the dotnet stuff, but the small bits I've seen
have indicated it's not very different in philosophy from the
ASP/PHP/CGI/etc way of doing things. I'm not sure there's really a
"curve" for learning woven; for me, after a few years of dealing with
the prevailing models of webpage generation, Woven came as a breath of
fresh air: it's the only web framework I've used that I haven't come
to hate. However, as glyph pointed out recently, you have to
"reconfigure the sub-atomic particles in your brain to completely
disassociate the concepts of 'web' and 'application'." Some people
will be ready to do this, some won't. Once you've made the mental leap
to treating webpage generation as structure-based and not
string-based, you're most of the way there. 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030823/92af74d9/attachment.pgp 

From douglas at paradise.net.nz  Sat Aug 23 10:43:33 2003
From: douglas at paradise.net.nz (Douglas Bagnall)
Date: Sun, 24 Aug 2003 02:43:33 +1200
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <000b01c36927$1b0158e0$4601a8c0@rjc800>
References: <000b01c36927$1b0158e0$4601a8c0@rjc800>
Message-ID: <3F477D95.2090003@paradise.net.nz>


Richard Johannesson wrote:

> .Net seems like a big improvement over ASP/PHP, but prefer Python easily
> over .Net. If you've done .Net and Twisted - how would you compare the
> learning curve for a typical web programmer using either .Net or
> Twisted/Woven platform?
> 

I don't know .Net, but from experience and months of lurking, I would 
say the Twisted newbie experience is characterised by waves of confusion 
and euphoria.  The learning curve is juddery, but generally enjoyable.

The closest thing to Woven I have used is Axkit (perl warning: 
http://axkit.org/), but of course Twisted as a whole is deeper and 
wider.  If you can take advantage of that, and if you have a bit of 
time, then I would recommend Twisted.  But if you have just a few weeks 
to make a boring web app, you might be better off with any old *SP.


douglas






From bob at redivi.com  Sat Aug 23 12:29:52 2003
From: bob at redivi.com (Bob Ippolito)
Date: Sat, 23 Aug 2003 12:29:52 -0400
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <20030823.041544.501808932.washort@twistedmatrix.com>
Message-ID: <05F9DACC-D587-11D7-B83B-000A95686CD8@redivi.com>

On Saturday, Aug 23, 2003, at 05:15 America/New_York, Allen Short wrote:

>>>>>> "Richard" == Richard Johannesson <rtjohan at syspres.com> writes:
>
>
>> .Net seems like a big improvement over ASP/PHP, but prefer
>> Python easily over .Net. If you've done .Net and Twisted - how
>> would you compare the learning curve for a typical web
>> programmer using either .Net or Twisted/Woven platform?
>
>
> I haven't used any of the dotnet stuff, but the small bits I've seen
> have indicated it's not very different in philosophy from the
> ASP/PHP/CGI/etc way of doing things. I'm not sure there's really a
> "curve" for learning woven; for me, after a few years of dealing with
> the prevailing models of webpage generation, Woven came as a breath of
> fresh air: it's the only web framework I've used that I haven't come
> to hate. However, as glyph pointed out recently, you have to
> "reconfigure the sub-atomic particles in your brain to completely
> disassociate the concepts of 'web' and 'application'." Some people
> will be ready to do this, some won't. Once you've made the mental leap
> to treating webpage generation as structure-based and not
> string-based, you're most of the way there.

There is a big difference between ASP/PHP/CGI/etc and ASP.NET: it tries 
to be pseudo-event-driven.  In the Page class you have methods that you 
can override, such as when a page loads, a session starts, the page 
ends, etc.  This is because caching is emphasized EVERYWHERE.  The 
ASP.NET and ADO.NET as a whole are built specifically to be cached.

-bob




From glyph at twistedmatrix.com  Sat Aug 23 21:32:51 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 23 Aug 2003 20:32:51 -0500
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <2FCC4150-D4EC-11D7-B76C-000A95864FC4@twistedmatrix.com>
Message-ID: <E07CD6A2-D5D2-11D7-A143-000393C9700E@twistedmatrix.com>

On Friday, August 22, 2003, at 05:01 PM, Donovan Preston wrote:

> 768kbit/sec SDSL...

ADSL, actually: 384k down, 256k up.  This is being fixed soon.




From radix at twistedmatrix.com  Sat Aug 23 22:18:21 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sat, 23 Aug 2003 22:18:21 -0400
Subject: [Twisted-Python] twistedmatrix.com downtime!
Message-ID: <20030824021821.GI1508@twistedmatrix.com>

Twistedmatrix.com is going to be down while glyph moves to Boston --
probably a couple of days. We have set up a secondary MX for email, so
messages to people @ twistedmatrix.com will not be lost. Also, of
course, the web site, CVS, and all other services will be down. Thank
you for your patience in the matter!

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From sflist at ihonk.com  Sun Aug 24 00:57:07 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Sat, 23 Aug 2003 21:57:07 -0700
Subject: [Twisted-Python] XML-RPC: Why encapsulate in a list?
Message-ID: <BB6D93B3.BB30%sflist@ihonk.com>

Hi all,

If I try this code:

def xmlrpc_blah(self):
    return { 'x': "yadda" }

What I get back through Python's xmlrpclib client is...

[{'x':"yadda"}]

Why does my dictionary (ergo struct) get encapsulated in a list (ergo
array)? What should I do if I just want to return a struct?

Thanks!

Steve Freitas




From itamar at itamarst.org  Sun Aug 24 09:45:03 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 24 Aug 2003 09:45:03 -0400
Subject: [Twisted-Python] XML-RPC: Why encapsulate in a list?
In-Reply-To: <BB6D93B3.BB30%sflist@ihonk.com>
References: <BB6D93B3.BB30%sflist@ihonk.com>
Message-ID: <20030824094503.41a5a09d.itamar@itamarst.org>

On Sat, 23 Aug 2003 21:57:07 -0700
Steve Freitas <sflist at ihonk.com> wrote:

> Why does my dictionary (ergo struct) get encapsulated in a list (ergo
> array)? What should I do if I just want to return a struct?

I can't reproduce this issue (twisted 1.0.7a5, python 2.2). Perhaps
there's a bug in your code somewhere - try with a simple test case and
see if it still happens? If it does, please add a bug report in our
issue tracker with minimal example code for the bug so we can fix it.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From typo at soniq.net  Sun Aug 24 21:15:12 2003
From: typo at soniq.net (Paul Boehm)
Date: Mon, 25 Aug 2003 03:15:12 +0200
Subject: [Twisted-Python] bug in conch tutorial
Message-ID: <20030825011512.GB28467@soniq.net>

class CatChannel(channel.SSHChannel):
    name = 'session'
    def channelOpen(self, data):
        d = self.conn.sendRequest(self, 'exec', common.NS('cat'),
                                  wantReply = 1)
        d.addCallback(self._cbSendRequest)
        self.catData = ''

imho self.catData should be cleared before it's possible for the
deferred to fire, and append to catData.

    def _cbSendRequest(self, ignored):
        self.write('This data will be echoed back to us by "cat."\r\n')
        self.conn.sendEOF(self)
        self.loseConnection()
    def dataReceived(self, data):
        self.catData += data
    def closed(self):
        print 'We got this from "cat":', self.catData



From sgillies at frii.com  Mon Aug 25 16:30:30 2003
From: sgillies at frii.com (Sean Gillies)
Date: Mon, 25 Aug 2003 14:30:30 -0600
Subject: [Twisted-Python] timeout using LivePage
Message-ID: <F8103AB0-D73A-11D7-8128-000393B98B56@frii.com>

Hi,

Am very new to Twisted but am quickly finding that I like
it.  All my questions and comments involve Twisted 1.0.6
in combo with Python 2.3 on OS X.

I've run into a problem while making a rough .rpy prototype of
a mapping application (ala MapQuest) using the U of Minnesota
MapServer's Python interface.

I will need to have server-side handlers for javascript events
to allow map zooming, panning, &c and so have been experimenting
with LivePage.  I intend that the code should render a map image,
and upon clicking the image, we zoom into the map (changing model
data), and redraw the map image.  Unfortunately, browsers are
unable to load the

mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1

URL that is generated by my instance of LivePage, and so the map
is never redrawn as it should.  The model data does get changed
successfully, and when I manually reload the page, I do see
the zoomed map image as I expect.

What is this 'woven_hookupOutputConduitToThisFrame' all about?
Do I need to set up another method to handle this URL?

I know that it's not recommended to put so much logic in the .rpy
file, but as I said, a quick and dirty prototype is what I'm after.
Am attaching the source of mapserv.rpy here:

--------------------------------------------------------------------
import os
import time
from twisted.web.woven import page, widgets, controller, model
from mapscript import *

base_mapfile = 'navtech_std.map'

# Get map object from the session data if we can
class MapModel(model.MethodModel):
     def wmfactory_mapobj(self, request):
         session_obj = request.getSession()
         try:
             session_mapobj = session_obj.mapobj
         except AttributeError:
             session_mapobj = mapObj(base_mapfile)
             session_obj.mapobj = session_mapobj
         return session_mapobj

# Widget for creating a temp map image and a tag linking to it
class MapImage(widgets.Widget):
     def setUp(self, request, node, data):
         mapobj = data
         node.tagName = "img"
         imgobj = mapobj.draw()
         tmp_file = '%s_%d_%d.%s' \
                  % (mapobj.name, time.time(), os.getpid(),
                     imgobj.format.extension )
         imgobj.save(os.path.join('/tmp', tmp_file))
         map_url = os.path.join('/tmp', tmp_file)
         node.setAttribute('src', map_url)
         node.setAttribute('height', str(mapobj.height))
         node.setAttribute('width', str(mapobj.width))
         node.setAttribute('border', '1')

# Widget for displaying the current scale of the map
class MapScale(widgets.Widget):
     def setUp(self, request, node, data):
         text = 'Scale: 1:%d' % (data.scale)
         newNode = request.d.createTextNode(text)
         node.appendChild(newNode)

# Template, using the web conduit glue
template = """<html>
   <body>
     <img model="mapobj" view="map_image" controller="map_ctrl"/>
     <p model="mapobj" view="map_scale" />
     <div view="webConduitGlue" />
   </body>
</html>
"""

# Zoom into the map in the event of a javascript onclick
class MyEventHandler(controller.Controller):
     def handle(self, request):
         self.view.addEventHandler("onclick", self.onClick)

     def onClick(self, request, widget):
         # Get session map object (layers and spatial extents)
         session_obj = request.getSession()
         try:
             session_mapobj = session_obj.mapobj
         except AttributeError:
             session_mapobj = mapObj(base_mapfile)
             session_obj.mapobj = session_mapob

         # zoom in on the map
         w = session_mapobj.width
         h = session_mapobj.height
         pt = pointObj()
         pt.x, pt.y = w/2, h/2
         session_mapobj.zoomPoint(2, pt, w, h, session_mapobj.extent, 
None)
         print session_mapobj.extent.minx, session_mapobj.extent.maxx
         print self, "Zoomed!!!"

         # There is a better way to redraw the map, certainly
         request.redirect('http://localhost:8084/mapserv.rpy/')
         request.finish()

# Page class
class MyPage(page.LivePage):
     def wcfactory_map_ctrl(self, request, node, model):
         return MyEventHandler(model)

# Resource
resource = MyPage(MapModel(), template=template)
resource.setSubviewFactory("map_image", MapImage)
resource.setSubviewFactory("map_scale", MapScale)
-----------------------------------------------------------------------

looking forward to any insights into LivePage and also looking forward
to getting enough experience with Twisted that I can begin to contribute
to the list discussions.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies




From maxk at touro.edu  Mon Aug 25 16:46:32 2003
From: maxk at touro.edu (Max Khesin)
Date: Mon, 25 Aug 2003 16:46:32 -0400 (EDT)
Subject: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <20030825134901.25074.49920.Mailman@pyramid.twistedmatrix.com>
Message-ID: <Pine.A41.4.10.10308251644120.2576-100000@academic.touro.edu>

Hi all,
I am trying to get twisted working on an RH7.1 box (in order to run
buildbot). As 7.1 comes with (and relies on) python 1.5 I had to install
parallel version 2.2 as python2. How do I configure twisted to run with
this setup?
thanks,
max.





From developer at csrules.dyndns.org  Mon Aug 25 16:52:06 2003
From: developer at csrules.dyndns.org (darryl)
Date: Mon, 25 Aug 2003 15:52:06 -0500 (CDT)
Subject: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <Pine.A41.4.10.10308251644120.2576-100000@academic.touro.edu>
References: <20030825134901.25074.49920.Mailman@pyramid.twistedmatrix.com>
        <Pine.A41.4.10.10308251644120.2576-100000@academic.touro.edu>
Message-ID: <10870.209.5.247.105.1061844726.squirrel@home.vandorp.ca>

You can just do:

python2 setup.py install

-D

> Hi all,
> I am trying to get twisted working on an RH7.1 box (in order to run
> buildbot). As 7.1 comes with (and relies on) python 1.5 I had to install
> parallel version 2.2 as python2. How do I configure twisted to run with
> this setup?
> thanks,
> max.
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python






From Martin.Moellenbeck at t-online.de  Mon Aug 25 16:59:18 2003
From: Martin.Moellenbeck at t-online.de (=?iso-8859-1?Q?Martin_M=F6llenbeck?=)
Date: Mon, 25 Aug 2003 22:59:18 +0200
Subject: AW: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <Pine.A41.4.10.10308251644120.2576-100000@academic.touro.edu>
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAARFFe7Wq86Uqt5quoDxSVd8KAAAAQAAAAHqQDJCiac0OM30azfWcsGAEAAAAA@t-online.de>

hi,

download the tar.gz and go to the twisted root.

Then type:

<path_to_python2.2>/python setup.py build

 and if not error occurs

<path_to_python2.2>/python setup.py install

greeting
	Martin

-----Urspr?ngliche Nachricht-----
Von: twisted-python-admin at twistedmatrix.com
[mailto:twisted-python-admin at twistedmatrix.com] Im Auftrag von Max
Khesin
Gesendet: Montag, 25. August 2003 22:47
An: twisted-python at twistedmatrix.com
Betreff: [Twisted-Python] twisted installation (new to list)


Hi all,
I am trying to get twisted working on an RH7.1 box (in order to run
buildbot). As 7.1 comes with (and relies on) python 1.5 I had to install
parallel version 2.2 as python2. How do I configure twisted to run with
this setup? thanks, max.



_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From 2002 at weholt.org  Mon Aug 25 18:39:24 2003
From: 2002 at weholt.org (Thomas Weholt)
Date: Tue, 26 Aug 2003 00:39:24 +0200
Subject: [Twisted-Python] Question about multiple XML-RPC handlers
Message-ID: <007101c36b59$bcab7340$0401a8c0@razor>

>From the docs I see this example on how to implement a XML-RPC service :

from twisted.web import xmlrpc, server

class Example(xmlrpc.XMLRPC):
    """An example object to be published."""

    def xmlrpc_echo(self, x):
        """Return all passed args."""
        return x

    def xmlrpc_add(self, a, b):
        """Return sum of arguments."""
        return a + b


def main():
    from twisted.internet.app import Application
    app = Application("xmlrpc")
    r = Example()
    app.listenTCP(7080, server.Site(r))
    return app

application = main()

if __name__ == '__main__':
    application.run(save=0)

Test it with :

>>> import xmlrpclib
>>> s = xmlrpclib.Server('http://localhost:7080/')
>>> s.echo("lala")
'lala'

All is well and fine. But I need to differentiate abit, more like :

>>> import xmlrpclib
>>> s = xmlrpclib.Server('http://localhost:7080/')
>>> s.Example.echo("lala")
'lala'

For instance, if I create another XML-RPC-handler:

class Dummy(xmlrpc.XMLRPC):

    def xmlrpc_subtract(self, x, y):
        return x - y

I want someway to register it with the server and be able to call :

>>> import xmlrpclib
>>> s = xmlrpclib.Server('http://localhost:7080/')
>>> s.Example.echo("lala")
'lala'
>>> s.Example.add(1,2)
3
>>> s.Dummy.subtract(1,2)
-1

I've hacked the current XML-RPC code in Twisted abit to fit my needs, but
I'd like to be able to use the standard Twisted framework for this, not some
ad-hoc/mediocre/experimental thingy. Can I create a root-request which
somehow redirects the call to the correct instance/method if found or give a
proper failure-result if nothing is found?

Any clue or hint would be highly appreciated.

Best regards,
Thomas Weholt





From itamar at itamarst.org  Mon Aug 25 18:43:58 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 25 Aug 2003 18:43:58 -0400
Subject: [Twisted-Python] Question about multiple XML-RPC handlers
In-Reply-To: <007101c36b59$bcab7340$0401a8c0@razor>
References: <007101c36b59$bcab7340$0401a8c0@razor>
Message-ID: <20030825184358.1f15f1f9.itamar@itamarst.org>

On Tue, 26 Aug 2003 00:39:24 +0200
"Thomas Weholt" <2002 at weholt.org> wrote:

> I've hacked the current XML-RPC code in Twisted abit to fit my needs,
> but I'd like to be able to use the standard Twisted framework for
> this, not some ad-hoc/mediocre/experimental thingy. Can I create a
> root-request which somehow redirects the call to the correct
> instance/method if found or give a proper failure-result if nothing is
> found?

Dave Peticolas has some code in the issue tracker that  does this. It'll
be integrated into CVS sooner or later.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From dp at twistedmatrix.com  Mon Aug 25 19:45:20 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Mon, 25 Aug 2003 16:45:20 -0700
Subject: [Twisted-Python] timeout using LivePage
In-Reply-To: <F8103AB0-D73A-11D7-8128-000393B98B56@frii.com>
References: <F8103AB0-D73A-11D7-8128-000393B98B56@frii.com>
Message-ID: <2FF8F04E-D756-11D7-9014-000A95864FC4@twistedmatrix.com>

On Monday, August 25, 2003, at 1:30 PM, Sean Gillies wrote:

> Hi,
>
> Am very new to Twisted but am quickly finding that I like
> it.  All my questions and comments involve Twisted 1.0.6
> in combo with Python 2.3 on OS X.

Great! Always glad to have more users giving me feedback.

If you are going to be using LivePage, you should probably
track CVS instead of using a release, since LivePage is the
one major area of woven I am still doing major work on.

First, I want to clarify some terminology. LivePage is designed
to allow two things:

Client-To-Server Events: A JavaScript event handler in the
browser is routed to the Twisted server and causes some code
to run. This uses a channel I am calling the "InputConduit"

Server-To-Client Events: Some event happened on the server
(For example, new mail arrived, another player entered the room)
and the server wants to "Push" some new HTML to the client.
This uses a channel I am calling the "OutputConduit"

> I've run into a problem while making a rough .rpy prototype of
> a mapping application (ala MapQuest) using the U of Minnesota
> MapServer's Python interface.
>
> I will need to have server-side handlers for javascript events
> to allow map zooming, panning, &c and so have been experimenting
> with LivePage.  I intend that the code should render a map image,
> and upon clicking the image, we zoom into the map (changing model
> data), and redraw the map image.  Unfortunately, browsers are
> unable to load the
>
> mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1
>
> URL that is generated by my instance of LivePage, and so the map
> is never redrawn as it should.

There are actually two unrelated issues here. The first is that the
current implementation of LivePage in the Twisted CVS is geared
towards the NewReality web client (NewReality is a multiuser text
environment (game) written in Twisted) and thus the ability for
the server to send events to the client is pretty important.
You are connected and logged in using the web client, and
someone else enters the room -- you want the web browser to
display a notice about someone entering the room without having
to refresh the browser manually or set up continual reloading.

The output conduit is implemented in certain browsers (those
lacking Flash and LiveConnect) by embedding an <iframe>
tag whose src="?woven_hookupOutputConduitToThisFrame=1"
in the page. When the browser attempts to load this iframe, it
makes a request to the server, and twisted notices that the
browser "wants to hook up the output conduit to this frame",
and *never finishes sending this page to the client*. The
Twisted server just holds this connection open forever, so
that it can write data to the client on demand in response
to events on the server, and this is why it appears your
browser is unable to load this URL.

Since with your application it sounds like you only want
client-to-server events, you need to do a little bit of
hacking to prevent Woven from including the output
conduit HTML in your pages. This will get easier in future
releases of Twisted; I just haven't had time to enumerate
the possible ways people will want to use LivePage and
come up with an easy way for the programmer to specify
the features they want.

If you look at the HTML fragment woven includes in your
page when you specify the view directive "webConduitGlue"
you will see it includes the following parts:

   <div>
    <script src="WebConduit2_js" language="javascript"></script>
    <iframe src="input_html"
         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
    <iframe
         src="?woven_hookupOutputConduitToThisFrame=1"
         style="width: 100%" id="woven_outputConduit"></iframe>
   </div>

Simply replace the view="webConduitGlue" node with the above
fragment, sans the output conduit frame:

   <div>
    <script src="WebConduit2_js" language="javascript"></script>
    <iframe src="input_html"
         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
   </div>

After you have done this, your pages will actually appear to fully
load and you should feel happier.

> The model data does get changed
> successfully, and when I manually reload the page, I do see
> the zoomed map image as I expect.

The second issue is that you are not notifying your models
properly to tell them that they have changed. When a
client-to-server event is sent from the browser to the server,
the current version of Woven only sends the portions of the
page which have actually changed, not the entire page,
back to the browser. Again, this is something I would like
the programmer to be able to control, because sometimes
the changes are extensive enough that it makes more sense
to send the entire page back.

Your redirect hack is not a terrible solution, actually. I have
used it before.

See below for an example of how you can make your current
controller code notify the model properly.

> What is this 'woven_hookupOutputConduitToThisFrame' all about?
> Do I need to set up another method to handle this URL?
>
> I know that it's not recommended to put so much logic in the .rpy
> file, but as I said, a quick and dirty prototype is what I'm after.
> Am attaching the source of mapserv.rpy here:
>
> --------------------------------------------------------------------
> import os
> import time
> from twisted.web.woven import page, widgets, controller, model
> from mapscript import *
>
> base_mapfile = 'navtech_std.map'
>
> # Get map object from the session data if we can
> class MapModel(model.MethodModel):
>     def wmfactory_mapobj(self, request):
>         session_obj = request.getSession()
>         try:
>             session_mapobj = session_obj.mapobj
>         except AttributeError:
>             session_mapobj = mapObj(base_mapfile)
>             session_obj.mapobj = session_mapobj
>         return session_mapobj
>
> # Widget for creating a temp map image and a tag linking to it
> class MapImage(widgets.Widget):
>     def setUp(self, request, node, data):
>         mapobj = data
>         node.tagName = "img"
>         imgobj = mapobj.draw()
>         tmp_file = '%s_%d_%d.%s' \
>                  % (mapobj.name, time.time(), os.getpid(),
>                     imgobj.format.extension )
>         imgobj.save(os.path.join('/tmp', tmp_file))
>         map_url = os.path.join('/tmp', tmp_file)
>         node.setAttribute('src', map_url)
>         node.setAttribute('height', str(mapobj.height))
>         node.setAttribute('width', str(mapobj.width))
>         node.setAttribute('border', '1')
>
> # Widget for displaying the current scale of the map
> class MapScale(widgets.Widget):
>     def setUp(self, request, node, data):
>         text = 'Scale: 1:%d' % (data.scale)
>         newNode = request.d.createTextNode(text)
>         node.appendChild(newNode)
>
> # Template, using the web conduit glue
> template = """<html>
>   <body>
>     <img model="mapobj" view="map_image" controller="map_ctrl"/>
>     <p model="mapobj" view="map_scale" />
>     <div view="webConduitGlue" />
>   </body>
> </html>
> """
>
> # Zoom into the map in the event of a javascript onclick
> class MyEventHandler(controller.Controller):
>     def handle(self, request):
>         self.view.addEventHandler("onclick", self.onClick)
>
>     def onClick(self, request, widget):
>         # Get session map object (layers and spatial extents)
>         session_obj = request.getSession()
>         try:
>             session_mapobj = session_obj.mapobj
>         except AttributeError:
>             session_mapobj = mapObj(base_mapfile)
>             session_obj.mapobj = session_mapob
>
>         # zoom in on the map
>         w = session_mapobj.width
>         h = session_mapobj.height
>         pt = pointObj()
>         pt.x, pt.y = w/2, h/2
>         session_mapobj.zoomPoint(2, pt, w, h, session_mapobj.extent, 
> None)
>         print session_mapobj.extent.minx, session_mapobj.extent.maxx
>         print self, "Zoomed!!!"

            # Tell the browser that the model has changed, and
            # any widgets which rely on this model will have to be
            # rerendered, and the HTML sent to the browser
	 widget.model.notify({'request': request})

            # Delete the next three lines
>         # There is a better way to redraw the map, certainly
>         request.redirect('http://localhost:8084/mapserv.rpy/')
>         request.finish()
>
> # Page class
> class MyPage(page.LivePage):
>     def wcfactory_map_ctrl(self, request, node, model):
>         return MyEventHandler(model)
>
> # Resource
> resource = MyPage(MapModel(), template=template)
> resource.setSubviewFactory("map_image", MapImage)
> resource.setSubviewFactory("map_scale", MapScale)
> -----------------------------------------------------------------------
>
> looking forward to any insights into LivePage and also looking forward
> to getting enough experience with Twisted that I can begin to 
> contribute
> to the list discussions.

By the way, addEventHandler takes additional arguments
which are javascript strings which will be evaluated within the
context of the browser, and the results will be sent as additional
arguments to the server-side event handler.

To take advantage of this, you have to know a bit about
JavaScript, but for example, if you know about the IE global
"event" object, you could use it to pass the current x, y
position of the mouse to the server with something like
this:

self.view.addEventHandler("onclick", self.onClick, 'event.x', 'event.y')

Then defining the event handler like this:

def addEventHandler(self, request, widget, x, y):
	print "x, y", x, y

Of course, doing this means knowing enough about javascript to do
this properly, but those are problems with JavaScript and not Woven.
I think Mozilla has different semantics for getting at the event object
which may require changes in WebConduit2_js. I would consider it a
bug if changes are required.

I hope this helps!

Donovan




From maxk at touro.edu  Mon Aug 25 20:04:39 2003
From: maxk at touro.edu (Max Khesin)
Date: Mon, 25 Aug 2003 20:04:39 -0400 (EDT)
Subject: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <10870.209.5.247.105.1061844726.squirrel@home.vandorp.ca>
Message-ID: <Pine.A41.4.10.10308252003050.14190-100000@academic.touro.edu>

I tried python2 setup.py install, as daryl suggested. got this stuff:

bash-2.05$ python2 setup.py install
running install
Traceback (most recent call last):
  File "setup.py", line 331, in ?
    setup(**setup_args)
  File "/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/core.py",
line 138, in setup
  File "/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/dist.py",
line 902, in run_commands
  File "/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/dist.py",
line 921, in run_command
  File "/usr/lib/python2.2/cmd.py", line 112, in ensure_finalized
    except EOFError:
  File
"/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/command/install.py",
line 267, in finalize_options
  File
"/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/sysconfig.py",
line 417, in get_config_vars
  File
"/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/sysconfig.py",
line 322, in _init_posix
distutils.errors.DistutilsPlatformError: invalid Python installation:
unable to open /usr/lib/python2.2/config/Makefile (No such file or
directory)

Any ideas?
thanks,
max.




From itamar at itamarst.org  Mon Aug 25 20:11:28 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 25 Aug 2003 20:11:28 -0400
Subject: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <Pine.A41.4.10.10308252003050.14190-100000@academic.touro.edu>
References: <10870.209.5.247.105.1061844726.squirrel@home.vandorp.ca>
	<Pine.A41.4.10.10308252003050.14190-100000@academic.touro.edu>
Message-ID: <20030825201128.18efa944.itamar@itamarst.org>

On Mon, 25 Aug 2003 20:04:39 -0400 (EDT)
Max Khesin <maxk at touro.edu> wrote:

> I tried python2 setup.py install, as daryl suggested. got this stuff:

Install python2-dev rpm or whatever it's called (-devel?). What're you
using buildbot for, by the way?

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From sflist at ihonk.com  Mon Aug 25 23:50:03 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Mon, 25 Aug 2003 20:50:03 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
Message-ID: <200308252045.59176.sflist@ihonk.com>

Hi all,

This is maybe just a Python library question, but I'm not sure.

I'd like to set up an XML-RPC server function to accept a dictionary/struct. 
So I thought I'd do this...

def xmlrpc_foo(self, **mydict):

But when I send it a struct, it throws an error of '0 args expected, 1 given,' 
much like...

>>> def blah(**myDict):
>>>   return myDict['x']
>>>
>>> print blah({'x':42, 'y':3})

...does. So under regular Python, the way to make this work fine is:

>>> def blah(myDict):
>>>   return myDict['x']
>>>
>>> print blah({'x':42, 'y':3})

But when I try this under twisted...

def xmlrpc_foo(self, myDict):
        return myDict['x']

I get a key error, saying strings are not callable.

So how do I get a twisted xmlrpc function to accept a struct? I assume I have 
to take it into a string and somehow serialize it into a dictionary using 
XML-RPC magic I haven't learned about, as in...

def xmlrpc_foo(self, myDict):
        ...magically transform myDict (a string) into myNewDict (a dict!)...
        return myNewDict['x']

Any help is appreciated! Thanks!

Steve



From dave at krondo.com  Tue Aug 26 00:25:28 2003
From: dave at krondo.com (Dave Peticolas)
Date: 25 Aug 2003 21:25:28 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <200308252045.59176.sflist@ihonk.com>
References: <200308252045.59176.sflist@ihonk.com>
Message-ID: <1061871928.2133.47.camel@oneiros>

On Mon, 2003-08-25 at 20:50, Steve Freitas wrote:
> Hi all,
> 
> This is maybe just a Python library question, but I'm not sure.
> 
> I'd like to set up an XML-RPC server function to accept a dictionary/struct. 
> So I thought I'd do this...
> 
> def xmlrpc_foo(self, **mydict):
>
> But when I send it a struct, it throws an error of '0 args expected, 1 given,' 
> much like...

This will never work since XML-RPC doesn't support **kw arguments.


> >>> def blah(**myDict):
> >>>   return myDict['x']
> >>>
> >>> print blah({'x':42, 'y':3})
> 
> ...does. So under regular Python, the way to make this work fine is:
>
> >>> def blah(myDict):
> >>>   return myDict['x']
> >>>
> >>> print blah({'x':42, 'y':3})
> 
> But when I try this under twisted...
> 
> def xmlrpc_foo(self, myDict):
>         return myDict['x']
> 
> I get a key error, saying strings are not callable.
> 
> So how do I get a twisted xmlrpc function to accept a struct? I assume I have 
> to take it into a string and somehow serialize it into a dictionary using 
> XML-RPC magic I haven't learned about, as in...
> 
> def xmlrpc_foo(self, myDict):
>         ...magically transform myDict (a string) into myNewDict (a dict!)...
>         return myNewDict['x']
> 
> Any help is appreciated! Thanks!

No, you just send a python dictionary. XML-RPC will serialize
it as a struct and it will be converted back to a Python dict
before it is passed to your handler.

If you're using Twisted on the client side as well:

  proxy.callRemote('foo', {'x':42})

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030825/b51c9f48/attachment.pgp 

From golux at comcast.net  Tue Aug 26 03:29:06 2003
From: golux at comcast.net (Steve Waterbury)
Date: Tue, 26 Aug 2003 03:29:06 -0400
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <1061871928.2133.47.camel@oneiros>
References: <200308252045.59176.sflist@ihonk.com> <1061871928.2133.47.camel@oneiros>
Message-ID: <3F4B0C42.6080407@comcast.net>

Dave Peticolas wrote:
> On Mon, 2003-08-25 at 20:50, Steve Freitas wrote:

>>So how do I get a twisted xmlrpc function to accept a struct? I assume I have 
>>to take it into a string and somehow serialize it into a dictionary using 
>>XML-RPC magic I haven't learned about, as in...
>>
>>def xmlrpc_foo(self, myDict):
>>        ...magically transform myDict (a string) into myNewDict (a dict!)...
>>        return myNewDict['x']
>>
>>Any help is appreciated! Thanks!
> 
> 
> No, you just send a python dictionary. XML-RPC will serialize
> it as a struct and it will be converted back to a Python dict
> before it is passed to your handler.
> 
> If you're using Twisted on the client side as well:
> 
>   proxy.callRemote('foo', {'x':42})

Or you can use objects instead of structs, jelly them,
and send the jellied objects over xmlrpc -- xmlrpc has
no problem with nested lists, which is what jelly
produces.  Good ol' jelly!  Caveat:  the objects'
attributes have to be jellyable (some types aren't).
This is analogous to the PB "copyable" paradigm.

- Steve.




From sgillies at frii.com  Tue Aug 26 09:48:12 2003
From: sgillies at frii.com (Sean Gillies)
Date: Tue, 26 Aug 2003 07:48:12 -0600
Subject: [Twisted-Python] timeout using LivePage
In-Reply-To: <2FF8F04E-D756-11D7-9014-000A95864FC4@twistedmatrix.com>
Message-ID: <EF75DB24-D7CB-11D7-8128-000393B98B56@frii.com>

On Monday, August 25, 2003, at 05:45  PM, Donovan Preston wrote:

>
> On Monday, August 25, 2003, at 1:30 PM, Sean Gillies wrote:
>
>> Hi,
>>
>> Am very new to Twisted but am quickly finding that I like
>> it.  All my questions and comments involve Twisted 1.0.6
>> in combo with Python 2.3 on OS X.
>
> Great! Always glad to have more users giving me feedback.
>
> If you are going to be using LivePage, you should probably
> track CVS instead of using a release, since LivePage is the
> one major area of woven I am still doing major work on.
>
> First, I want to clarify some terminology. LivePage is designed
> to allow two things:
>
> Client-To-Server Events: A JavaScript event handler in the
> browser is routed to the Twisted server and causes some code
> to run. This uses a channel I am calling the "InputConduit"
>
> Server-To-Client Events: Some event happened on the server
> (For example, new mail arrived, another player entered the room)
> and the server wants to "Push" some new HTML to the client.
> This uses a channel I am calling the "OutputConduit"
>
>> I've run into a problem while making a rough .rpy prototype of
>> a mapping application (ala MapQuest) using the U of Minnesota
>> MapServer's Python interface.
>>
>> I will need to have server-side handlers for javascript events
>> to allow map zooming, panning, &c and so have been experimenting
>> with LivePage.  I intend that the code should render a map image,
>> and upon clicking the image, we zoom into the map (changing model
>> data), and redraw the map image.  Unfortunately, browsers are
>> unable to load the
>>
>> mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1
>>
>> URL that is generated by my instance of LivePage, and so the map
>> is never redrawn as it should.
>
> There are actually two unrelated issues here. The first is that the
> current implementation of LivePage in the Twisted CVS is geared
> towards the NewReality web client (NewReality is a multiuser text
> environment (game) written in Twisted) and thus the ability for
> the server to send events to the client is pretty important.
> You are connected and logged in using the web client, and
> someone else enters the room -- you want the web browser to
> display a notice about someone entering the room without having
> to refresh the browser manually or set up continual reloading.
>
> The output conduit is implemented in certain browsers (those
> lacking Flash and LiveConnect) by embedding an <iframe>
> tag whose src="?woven_hookupOutputConduitToThisFrame=1"
> in the page. When the browser attempts to load this iframe, it
> makes a request to the server, and twisted notices that the
> browser "wants to hook up the output conduit to this frame",
> and *never finishes sending this page to the client*. The
> Twisted server just holds this connection open forever, so
> that it can write data to the client on demand in response
> to events on the server, and this is why it appears your
> browser is unable to load this URL.
>
> Since with your application it sounds like you only want
> client-to-server events, you need to do a little bit of
> hacking to prevent Woven from including the output
> conduit HTML in your pages. This will get easier in future
> releases of Twisted; I just haven't had time to enumerate
> the possible ways people will want to use LivePage and
> come up with an easy way for the programmer to specify
> the features they want.
>
> If you look at the HTML fragment woven includes in your
> page when you specify the view directive "webConduitGlue"
> you will see it includes the following parts:
>
>   <div>
>    <script src="WebConduit2_js" language="javascript"></script>
>    <iframe src="input_html"
>         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
>    <iframe
>         src="?woven_hookupOutputConduitToThisFrame=1"
>         style="width: 100%" id="woven_outputConduit"></iframe>
>   </div>
>
> Simply replace the view="webConduitGlue" node with the above
> fragment, sans the output conduit frame:
>
>   <div>
>    <script src="WebConduit2_js" language="javascript"></script>
>    <iframe src="input_html"
>         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
>   </div>
>
> After you have done this, your pages will actually appear to fully
> load and you should feel happier.
>
>> The model data does get changed
>> successfully, and when I manually reload the page, I do see
>> the zoomed map image as I expect.
>
> The second issue is that you are not notifying your models
> properly to tell them that they have changed. When a
> client-to-server event is sent from the browser to the server,
> the current version of Woven only sends the portions of the
> page which have actually changed, not the entire page,
> back to the browser. Again, this is something I would like
> the programmer to be able to control, because sometimes
> the changes are extensive enough that it makes more sense
> to send the entire page back.
>
> Your redirect hack is not a terrible solution, actually. I have
> used it before.
>
> See below for an example of how you can make your current
> controller code notify the model properly.
>
>> What is this 'woven_hookupOutputConduitToThisFrame' all about?
>> Do I need to set up another method to handle this URL?
>>
>> I know that it's not recommended to put so much logic in the .rpy
>> file, but as I said, a quick and dirty prototype is what I'm after.
>> Am attaching the source of mapserv.rpy here:
>>
>> --------------------------------------------------------------------
>> import os
>> import time
>> from twisted.web.woven import page, widgets, controller, model
>> from mapscript import *
>>
>> base_mapfile = 'navtech_std.map'
>>
>> # Get map object from the session data if we can
>> class MapModel(model.MethodModel):
>>     def wmfactory_mapobj(self, request):
>>         session_obj = request.getSession()
>>         try:
>>             session_mapobj = session_obj.mapobj
>>         except AttributeError:
>>             session_mapobj = mapObj(base_mapfile)
>>             session_obj.mapobj = session_mapobj
>>         return session_mapobj
>>
>> # Widget for creating a temp map image and a tag linking to it
>> class MapImage(widgets.Widget):
>>     def setUp(self, request, node, data):
>>         mapobj = data
>>         node.tagName = "img"
>>         imgobj = mapobj.draw()
>>         tmp_file = '%s_%d_%d.%s' \
>>                  % (mapobj.name, time.time(), os.getpid(),
>>                     imgobj.format.extension )
>>         imgobj.save(os.path.join('/tmp', tmp_file))
>>         map_url = os.path.join('/tmp', tmp_file)
>>         node.setAttribute('src', map_url)
>>         node.setAttribute('height', str(mapobj.height))
>>         node.setAttribute('width', str(mapobj.width))
>>         node.setAttribute('border', '1')
>>
>> # Widget for displaying the current scale of the map
>> class MapScale(widgets.Widget):
>>     def setUp(self, request, node, data):
>>         text = 'Scale: 1:%d' % (data.scale)
>>         newNode = request.d.createTextNode(text)
>>         node.appendChild(newNode)
>>
>> # Template, using the web conduit glue
>> template = """<html>
>>   <body>
>>     <img model="mapobj" view="map_image" controller="map_ctrl"/>
>>     <p model="mapobj" view="map_scale" />
>>     <div view="webConduitGlue" />
>>   </body>
>> </html>
>> """
>>
>> # Zoom into the map in the event of a javascript onclick
>> class MyEventHandler(controller.Controller):
>>     def handle(self, request):
>>         self.view.addEventHandler("onclick", self.onClick)
>>
>>     def onClick(self, request, widget):
>>         # Get session map object (layers and spatial extents)
>>         session_obj = request.getSession()
>>         try:
>>             session_mapobj = session_obj.mapobj
>>         except AttributeError:
>>             session_mapobj = mapObj(base_mapfile)
>>             session_obj.mapobj = session_mapob
>>
>>         # zoom in on the map
>>         w = session_mapobj.width
>>         h = session_mapobj.height
>>         pt = pointObj()
>>         pt.x, pt.y = w/2, h/2
>>         session_mapobj.zoomPoint(2, pt, w, h, session_mapobj.extent,  
>> None)
>>         print session_mapobj.extent.minx, session_mapobj.extent.maxx
>>         print self, "Zoomed!!!"
>
>            # Tell the browser that the model has changed, and
>            # any widgets which rely on this model will have to be
>            # rerendered, and the HTML sent to the browser
> 	 widget.model.notify({'request': request})
>
>            # Delete the next three lines
>>         # There is a better way to redraw the map, certainly
>>         request.redirect('http://localhost:8084/mapserv.rpy/')
>>         request.finish()
>>
>> # Page class
>> class MyPage(page.LivePage):
>>     def wcfactory_map_ctrl(self, request, node, model):
>>         return MyEventHandler(model)
>>
>> # Resource
>> resource = MyPage(MapModel(), template=template)
>> resource.setSubviewFactory("map_image", MapImage)
>> resource.setSubviewFactory("map_scale", MapScale)
>> ---------------------------------------------------------------------- 
>> -
>>
>> looking forward to any insights into LivePage and also looking forward
>> to getting enough experience with Twisted that I can begin to  
>> contribute
>> to the list discussions.
>
> By the way, addEventHandler takes additional arguments
> which are javascript strings which will be evaluated within the
> context of the browser, and the results will be sent as additional
> arguments to the server-side event handler.
>
> To take advantage of this, you have to know a bit about
> JavaScript, but for example, if you know about the IE global
> "event" object, you could use it to pass the current x, y
> position of the mouse to the server with something like
> this:
>
> self.view.addEventHandler("onclick", self.onClick, 'event.x',  
> 'event.y')
>
> Then defining the event handler like this:
>
> def addEventHandler(self, request, widget, x, y):
> 	print "x, y", x, y
>
> Of course, doing this means knowing enough about javascript to do
> this properly, but those are problems with JavaScript and not Woven.
> I think Mozilla has different semantics for getting at the event object
> which may require changes in WebConduit2_js. I would consider it a
> bug if changes are required.
>
> I hope this helps!
>
> Donovan
>

Hi Donovan,

Thanks for the reply.  I can't wait to try out your recommendations.

I had read in the docs about the extra args to addEventHandler, but
appreciate seeing an example that's so close to my particular need.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies




From justinjohnson at fastmail.fm  Tue Aug 26 09:48:02 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 26 Aug 2003 07:48:02 -0600
Subject: [Twisted-Python] Progressbar via curses for cmdline, LivePage for web
Message-ID: <20030826134802.C9EEE39DB2@www.fastmail.fm>

I have some questions about displaying console output using curses for
unix and Console or some other module for windows.  I did see posts
earlier about curses and have read the example cursesclient.py file in
cvs, but I still have some questions.

I have several methods in a PB server that do things with DeferredLists. 
I want progress on the overall task to be reported as each of the
callbacks get called.  The way I have been doing this is having my client
subclass pb.Referenceable, defining remote_print on the client, and then
passing the client as an argument to the server's remote calls.  Then
each callback prints a "." when they complete and an "F" upon failure,
thus sort of simulating a progress bar.

This doesn't work when I have multiple tasks going at once whose progress
I want to report separately.  So it seems to me that I need to start
using curses or some other such module.  I would have to define tasks
(something that has its own progress bar) and pass the task or the id to
the task to the callbacks so they would update the appropriate progress
bar.

Additionally, I would like to provide similar functionality for a web
interface to the server, using woven, and probably LivePage so that
progress could be communicated back appropriately.

So... I'm going to start digging into this, but I am wondering, has
anyone done this before?  Do you have any pointers for me?

Thanks.
-Justin



From 2002 at weholt.org  Tue Aug 26 12:58:16 2003
From: 2002 at weholt.org (Thomas Weholt)
Date: Tue, 26 Aug 2003 18:58:16 +0200
Subject: [Twisted-Python] Forms-handling in Twisted
Message-ID: <001201c36bf3$3f154790$0401a8c0@razor>

Can anybody provide a simple example on how to use the form-widget in
Twisted? I need something that sets datatype and some form of validation on
post, server-side.

Somethinglike the Guard-example in the latest alpha would be great.

Best regards,
Thomas Weholt




From sgillies at frii.com  Tue Aug 26 13:11:37 2003
From: sgillies at frii.com (Sean Gillies)
Date: Tue, 26 Aug 2003 11:11:37 -0600
Subject: [Twisted-Python] timeout using LivePage
In-Reply-To: <2FF8F04E-D756-11D7-9014-000A95864FC4@twistedmatrix.com>
Message-ID: <5A567B3E-D7E8-11D7-8128-000393B98B56@frii.com>

On Monday, August 25, 2003, at 05:45  PM, Donovan Preston wrote:

> On Monday, August 25, 2003, at 1:30 PM, Sean Gillies wrote:
>
>> Hi,
>>
>> Am very new to Twisted but am quickly finding that I like
>> it.  All my questions and comments involve Twisted 1.0.6
>> in combo with Python 2.3 on OS X.
>
> Great! Always glad to have more users giving me feedback.
>
> If you are going to be using LivePage, you should probably
> track CVS instead of using a release, since LivePage is the
> one major area of woven I am still doing major work on.
>
> First, I want to clarify some terminology. LivePage is designed
> to allow two things:
>
> Client-To-Server Events: A JavaScript event handler in the
> browser is routed to the Twisted server and causes some code
> to run. This uses a channel I am calling the "InputConduit"
>
> Server-To-Client Events: Some event happened on the server
> (For example, new mail arrived, another player entered the room)
> and the server wants to "Push" some new HTML to the client.
> This uses a channel I am calling the "OutputConduit"
>
>> I've run into a problem while making a rough .rpy prototype of
>> a mapping application (ala MapQuest) using the U of Minnesota
>> MapServer's Python interface.
>>
>> I will need to have server-side handlers for javascript events
>> to allow map zooming, panning, &c and so have been experimenting
>> with LivePage.  I intend that the code should render a map image,
>> and upon clicking the image, we zoom into the map (changing model
>> data), and redraw the map image.  Unfortunately, browsers are
>> unable to load the
>>
>> mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1
>>
>> URL that is generated by my instance of LivePage, and so the map
>> is never redrawn as it should.
>
> There are actually two unrelated issues here. The first is that the
> current implementation of LivePage in the Twisted CVS is geared
> towards the NewReality web client (NewReality is a multiuser text
> environment (game) written in Twisted) and thus the ability for
> the server to send events to the client is pretty important.
> You are connected and logged in using the web client, and
> someone else enters the room -- you want the web browser to
> display a notice about someone entering the room without having
> to refresh the browser manually or set up continual reloading.
>
> The output conduit is implemented in certain browsers (those
> lacking Flash and LiveConnect) by embedding an <iframe>
> tag whose src="?woven_hookupOutputConduitToThisFrame=1"
> in the page. When the browser attempts to load this iframe, it
> makes a request to the server, and twisted notices that the
> browser "wants to hook up the output conduit to this frame",
> and *never finishes sending this page to the client*. The
> Twisted server just holds this connection open forever, so
> that it can write data to the client on demand in response
> to events on the server, and this is why it appears your
> browser is unable to load this URL.
>
> Since with your application it sounds like you only want
> client-to-server events, you need to do a little bit of
> hacking to prevent Woven from including the output
> conduit HTML in your pages. This will get easier in future
> releases of Twisted; I just haven't had time to enumerate
> the possible ways people will want to use LivePage and
> come up with an easy way for the programmer to specify
> the features they want.
>
> If you look at the HTML fragment woven includes in your
> page when you specify the view directive "webConduitGlue"
> you will see it includes the following parts:
>
>   <div>
>    <script src="WebConduit2_js" language="javascript"></script>
>    <iframe src="input_html"
>         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
>    <iframe
>         src="?woven_hookupOutputConduitToThisFrame=1"
>         style="width: 100%" id="woven_outputConduit"></iframe>
>   </div>
>
> Simply replace the view="webConduitGlue" node with the above
> fragment, sans the output conduit frame:
>
>   <div>
>    <script src="WebConduit2_js" language="javascript"></script>
>    <iframe src="input_html"
>         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
>   </div>
>
> After you have done this, your pages will actually appear to fully
> load and you should feel happier.
>
>> The model data does get changed
>> successfully, and when I manually reload the page, I do see
>> the zoomed map image as I expect.
>
> The second issue is that you are not notifying your models
> properly to tell them that they have changed. When a
> client-to-server event is sent from the browser to the server,
> the current version of Woven only sends the portions of the
> page which have actually changed, not the entire page,
> back to the browser. Again, this is something I would like
> the programmer to be able to control, because sometimes
> the changes are extensive enough that it makes more sense
> to send the entire page back.
>
> Your redirect hack is not a terrible solution, actually. I have
> used it before.
>
> See below for an example of how you can make your current
> controller code notify the model properly.
>
Donovan,

I am now using Twisted from CVS and have made the change to my
template so that the webConduitGlue is not used.  Have also
made the change to my onclick event handler so that
widget.model.notify is called.

So far so good ... the model is being notified and the code in
my custom MapImage widget's setUp medthod is being executed.
I can tell because it is creating new map images in the app's
temporary location and these new images are exactly as I expect.

However, the document is not being rerendered properly: the HTML
returned to my browser is unchanged, the <img /> tag still points
to the old map image location.

FWIW, I'm using Mozilla, Safari, and IE 5 on OS X and see the same
issue with each of these.  Will I need to edit WebConduit2_js?  If
so, can you suggest where I would start?

cheers,
Sean



--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies




From abe at fettig.net  Tue Aug 26 13:21:50 2003
From: abe at fettig.net (Abe Fettig)
Date: 26 Aug 2003 13:21:50 -0400
Subject: [Twisted-Python] Forms-handling in Twisted
In-Reply-To: <001201c36bf3$3f154790$0401a8c0@razor>
References: <001201c36bf3$3f154790$0401a8c0@razor>
Message-ID: <1061918509.594.6.camel@mingus>

On Tue, 2003-08-26 at 12:58, Thomas Weholt wrote:
> Can anybody provide a simple example on how to use the form-widget in
> Twisted?

I've been working on understanding this myself.  Attached is an
incomplete example, but it does illustrate how to set up a form and use
it within a woven template. 

Notable points:

* the same template is used both for the form and the error page
* view is left blank in the template; woven sees that the model is a
FormMethod object and automatically selects the correct View.

Abe
-------------- next part --------------
A non-text attachment was scrubbed...
Name: twisted-form-demo.py
Type: text/x-python
Size: 1300 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030826/1949efa4/attachment.py 

From sflist at ihonk.com  Tue Aug 26 16:51:36 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Tue, 26 Aug 2003 13:51:36 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <1061871928.2133.47.camel@oneiros>
References: <200308252045.59176.sflist@ihonk.com> <1061871928.2133.47.camel@oneiros>
Message-ID: <200308261351.36319.sflist@ihonk.com>

Hi Dave,

Thanks for your reply!

> No, you just send a python dictionary. XML-RPC will serialize
> it as a struct and it will be converted back to a Python dict
> before it is passed to your handler.
>
> If you're using Twisted on the client side as well:
>
>   proxy.callRemote('foo', {'x':42})

Unfortunately I'm using C++ on the client side, with XmlRpc++ as my library 
(http://xmlrpcpp.sourceforge.net/). I'd like to avoid putting Python in that 
mix, as I wasn't planning on using it on the client at all. 

Besides, I thought this was what I was doing when I sent my Twisted server a 
simple struct. If XML-RPC serializes it as a struct (which was what I was 
sending), what am I doing wrong to prevent it from working as you describe?

Thanks!

Steve



From sflist at ihonk.com  Tue Aug 26 16:52:00 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Tue, 26 Aug 2003 13:52:00 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <3F4B0C42.6080407@comcast.net>
References: <200308252045.59176.sflist@ihonk.com> <1061871928.2133.47.camel@oneiros> <3F4B0C42.6080407@comcast.net>
Message-ID: <200308261352.00527.sflist@ihonk.com>

Hi Steve,

> Or you can use objects instead of structs, jelly them,
> and send the jellied objects over xmlrpc -- xmlrpc has
> no problem with nested lists, which is what jelly
> produces.  Good ol' jelly!  Caveat:  the objects'
> attributes have to be jellyable (some types aren't).
> This is analogous to the PB "copyable" paradigm.

As I noted in my other reply, I'm unfortunately using C++ on the client side. 
Any other ideas on how I get Twisted to turn my struct into a dictionary?

Steve



From dave at krondo.com  Tue Aug 26 17:47:07 2003
From: dave at krondo.com (Dave Peticolas)
Date: 26 Aug 2003 14:47:07 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <200308261351.36319.sflist@ihonk.com>
References: <200308252045.59176.sflist@ihonk.com>
	 <1061871928.2133.47.camel@oneiros>  <200308261351.36319.sflist@ihonk.com>
Message-ID: <1061934427.2133.59.camel@oneiros>

On Tue, 2003-08-26 at 13:51, Steve Freitas wrote:
> Hi Dave,
> 
> Thanks for your reply!
> 
> > No, you just send a python dictionary. XML-RPC will serialize
> > it as a struct and it will be converted back to a Python dict
> > before it is passed to your handler.
> >
> > If you're using Twisted on the client side as well:
> >
> >   proxy.callRemote('foo', {'x':42})
> 
> Unfortunately I'm using C++ on the client side, with XmlRpc++ as my library 
> (http://xmlrpcpp.sourceforge.net/). I'd like to avoid putting Python in that 
> mix, as I wasn't planning on using it on the client at all. 
> 
> Besides, I thought this was what I was doing when I sent my Twisted server a 
> simple struct. If XML-RPC serializes it as a struct (which was what I was 
> sending), what am I doing wrong to prevent it from working as you describe?

A struct should be unserialized to a Python dict no problem.

It's hard to say from here what is going on, but Twisted's
XMLRPC class is so simple it should be easy to add a few
print statements to find out what is happening. Check out
the XMLRPC.render(...) function. You might want to print
the request content and unserialized arguments as a starting
point.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030826/c0c378ef/attachment.pgp 

From sgillies at frii.com  Tue Aug 26 18:42:48 2003
From: sgillies at frii.com (Sean Gillies)
Date: Tue, 26 Aug 2003 16:42:48 -0600
Subject: Fixed (Re: [Twisted-Python] timeout using LivePage)
In-Reply-To: <5A567B3E-D7E8-11D7-8128-000393B98B56@frii.com>
Message-ID: <9DFB3412-D816-11D7-8128-000393B98B56@frii.com>

On Tuesday, August 26, 2003, at 11:11  AM, Sean Gillies wrote:

> ...
>
> So far so good ... the model is being notified and the code in
> my custom MapImage widget's setUp medthod is being executed.
> I can tell because it is creating new map images in the app's
> temporary location and these new images are exactly as I expect.
>
> However, the document is not being rerendered properly: the HTML
> returned to my browser is unchanged, the <img /> tag still points
> to the old map image location.
>
> FWIW, I'm using Mozilla, Safari, and IE 5 on OS X and see the same
> issue with each of these.  Will I need to edit WebConduit2_js?  If
> so, can you suggest where I would start?
>
> cheers,
> Sean
>

No problem with LivePage or the javascript in WebConduit2_js after
all.

After I changed my MapImage widget class to extend widget.Image,
and wrote a proper setUp method, I get map zooming just as I
need.

Slick stuff, Donovan!

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies




From glyph at twistedmatrix.com  Thu Aug 28 20:16:09 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 28 Aug 2003 19:16:09 -0500
Subject: [Twisted-Python] Re: [Twisted-commits] log stderr and non-zero exit code in CGIs, don't show info to users as it is a security risk (closes issue #241)
In-Reply-To: <E19sOlM-0000eO-00@pyramid.twistedmatrix.com>
Message-ID: <FD55CF30-D9B5-11D7-96C4-000393C9700E@twistedmatrix.com>

On Thursday, August 28, 2003, at 10:32 AM, itamarst CVS wrote:

> log stderr and non-zero exit code in CGIs, don't show info to users as 
> it is a security risk (closes issue #241)

We shouldn't swallow errors in these situations.  If it's a security 
risk, provide a way for the server administrator to turn it off, but 
this is a _bad_ default.

If you doubt the wisdom of making this default, please consult any 
number of Perl FAQs of the form:

	Q. "I wrote a CGI and it works perfectly, but now I moved it to 
another server and I get nothing but a "500 Internal Server Error" 
page.  How do I tell what went wrong!?!?!?"

	A. Look in your apache logs.

	---

	Q. "I looked at my apache logs and nothing makes sense!  How do I tell 
what the error was??!"

	A. ...

Also, could you clarify the security risk of displaying stderr from CGI 
scripts?  I've never heard of a CGI that puts security-critical 
information on stderr rather than stdout and makes it a risk to display 
to users.




From itamar at itamarst.org  Thu Aug 28 20:50:05 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 28 Aug 2003 20:50:05 -0400
Subject: [Twisted-Python] Re: [Twisted-commits] log stderr and non-zero
 exit code in CGIs, don't show info to users as it is a security risk
 (closes issue #241)
In-Reply-To: <FD55CF30-D9B5-11D7-96C4-000393C9700E@twistedmatrix.com>
References: <E19sOlM-0000eO-00@pyramid.twistedmatrix.com>
	<FD55CF30-D9B5-11D7-96C4-000393C9700E@twistedmatrix.com>
Message-ID: <20030828205005.05371e43.itamar@itamarst.org>

On Thu, 28 Aug 2003 19:16:09 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> Also, could you clarify the security risk of displaying stderr from
> CGI scripts?  I've never heard of a CGI that puts security-critical 
> information on stderr rather than stdout and makes it a risk to
> display to users.

If it's a python script it's probably going to be a traceback.

Also, I don't care about the Perl FAQ :) If you can't figure out how to
read the exact same info out of a logfile, you shouldn't be trying to
debug a CGI script.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From glyph at twistedmatrix.com  Thu Aug 28 20:59:37 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 28 Aug 2003 19:59:37 -0500
Subject: [Twisted-Python] Re: [Twisted-commits] log stderr and non-zero exit code in CGIs, don't show info to users as it is a security risk (closes issue #241)
In-Reply-To: <20030828205005.05371e43.itamar@itamarst.org>
Message-ID: <0FC6C27C-D9BC-11D7-96C4-000393C9700E@twistedmatrix.com>

On Thursday, August 28, 2003, at 07:50 PM, Itamar Shtull-Trauring wrote:

> Also, I don't care about the Perl FAQ :) If you can't figure out how to
> read the exact same info out of a logfile, you shouldn't be trying to
> debug a CGI script.

Well, I'll defer to a poll, here, if anyone is interested in this 
issue.  In the absence of more than one user's feedback putting it one 
way or the other, I will revert this change.




From itamar at itamarst.org  Thu Aug 28 21:26:42 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 28 Aug 2003 21:26:42 -0400
Subject: [Twisted-Python] Re: [Twisted-commits] log stderr and non-zero
 exit code in CGIs, don't show info to users as it is a security risk
 (closes issue #241)
In-Reply-To: <0FC6C27C-D9BC-11D7-96C4-000393C9700E@twistedmatrix.com>
References: <20030828205005.05371e43.itamar@itamarst.org>
	<0FC6C27C-D9BC-11D7-96C4-000393C9700E@twistedmatrix.com>
Message-ID: <20030828212642.7529d345.itamar@itamarst.org>

On Thu, 28 Aug 2003 19:59:37 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> Well, I'll defer to a poll, here, if anyone is interested in this 
> issue.  In the absence of more than one user's feedback putting it one
> 
> way or the other, I will revert this change.

Only revert the removed HTML output - it should be logged to the log
file regardless.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From syver at inout.no  Fri Aug 29 04:00:36 2003
From: syver at inout.no (Syver Enstad)
Date: 29 Aug 2003 10:00:36 +0200
Subject: [Twisted-Python] Woven dynamic table, patterns and idioms wanted.
Message-ID: <ud6eodhaz.fsf@inout.no>

I am finally beginning to grasp woven, but I have a bit of code in my
woven application that seems to reimplement views and would like some
advice on how to avoid that.

The scenerio is as follows: I have a table with a header and a rows
where each row present an object. I use view="List" but I can't
specify each attribute in the object as a column in the table with
model and view because these are dynamic.

In a static solution this would look something like this:
<table model="myModel" view="List">
  <tr pattern="listItem">
    <td model="anAttribute" view="Text" />
    <td model="anotherAttribute" view="Date" />
    <td model="aThirdAttribute" view="Money" />
  </tr>
</table>

The solution that I use now which works okay is to just specify a
custom view on the whole object (for each row) and use that view to
generate the xml, including custom formatting and so on. This means
that I basically reimplement the woven view functionality. 

What I have now is something like this:
<table model="myModel" view="List">
  <tr pattern="listItem" view="myCustomTableRowView"/>
</table>

Where myCustomTableRowView basically loops through a table listing the
required fields and formatting for this kind of object, creates a td
for each of them, formats the data.

My naive take on this would be to be able to specify model and view
attributes on the xml I generate, but when I tried this it wouldn't
work, I guess it is to late in the process to do so. 

If anyone has any ideas on woven idioms/patterns for this type of
application, I would be glad to hear of it.




From Matt.Boersma at arraybiopharma.com  Fri Aug 29 13:27:44 2003
From: Matt.Boersma at arraybiopharma.com (Boersma, Matt)
Date: Fri, 29 Aug 2003 11:27:44 -0600
Subject: [Twisted-Python] New PB API example?
Message-ID: <59213C5E21925E4FB4335B1AF601C2230213AB@fiji.arraybp.com>

Howdy twisters,

I'm writing a Perspective Broker client-server app.  Things have been working fine, but as of recent Twisted builds (1.07 alpha 5?), my server code warns me that code like this:
    app = Application('myserver')
    app.listenTCP(8789, BrokerFactory(MyServer()))
    app.run()
is deprecated.  Specifically, that I should replace BrokerFactory with PBServerFactory.

So I have plunged into catching up with this new API.  And I'm heavily confused.  All the existing HOWTOs and pbxxxx.py examples still use (deprecated) code as above.  And even after searching the mailing list and re-reading the PB tutorials, I'm not getting it.

I'd like my client to use PBClientFactory.login, and for the server to authorize the client by logging in to an Oracle database and running a test query.  (Credentials in this case map directly to Oracle username/passwords--don't flame me, I inherited this system.)  Then the client receives a remotely callable Perspective specific to his or her role in this system.

I'm specifically unclear as to how to use my Authorizer subclass, and if I need to create a Portal subclass and plug it in to PBServerFactory.

If anyone has even a trivial example of how to use the new PB cred APIs, I'd be very grateful if you could share it with me.

This electronic message transmission is a PRIVATE communication which contains
information which may be confidential or privileged. The information is intended 
to be for the use of the individual or entity named above. If you are not the 
intended recipient, please be aware that any disclosure, copying, distribution 
or use of the contents of this information is prohibited. Please notify the
sender  of the delivery error by replying to this message, or notify us by
telephone (877-633-2436, ext. 0), and then delete it from your system.




From itamar at itamarst.org  Fri Aug 29 14:00:04 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 29 Aug 2003 14:00:04 -0400
Subject: [Twisted-Python] New PB API example?
In-Reply-To: <59213C5E21925E4FB4335B1AF601C2230213AB@fiji.arraybp.com>
References: <59213C5E21925E4FB4335B1AF601C2230213AB@fiji.arraybp.com>
Message-ID: <20030829140004.190a2b74.itamar@itamarst.org>

On Fri, 29 Aug 2003 11:27:44 -0600
"Boersma, Matt" <Matt.Boersma at arraybiopharma.com> wrote:

> If anyone has even a trivial example of how to use the new PB cred
> APIs, I'd be very grateful if you could share it with me.

Look at twisted.test.test_pb, the last few classes. You don't use an
Authorizer at all.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Fri Aug 29 16:41:26 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Fri, 29 Aug 2003 14:41:26 -0600
Subject: [Twisted-Python] DeferredList failure accumulation
Message-ID: <20030829204126.2EF673A3BB@www.fastmail.fm>

I've been doing a lot with DeferredList's lately and just want to make
sure I'm doing things the "right" way.  There a couple different
situations where I want to report errors in Deferred's that are added to
a DeferredList.

1)  I define a remote_status method on the PB client that initiates the
request.  The PB server calls the remote_status method on the client to
update the status for the particular task and redisplay the grid below,
and if the status if a failure, passes the failure as an argument which
gets added to an overall list of failures that are displayed nicely when
all tasks are complete.

      | 1 | 2 | 3 | 4 | status
----------------------------------
job1  | S | S | S | S | success
----------------------------------
job2  | S | F | S | F | failure
----------------------------------

Failures
----------------------------------
Task: job2
Step: step2
Failure: blah blah blah

Task: job2
Step: step4
Failure: blah blah blah

2)  If the DeferredList is used in a general class that represents some
data type worked on by the PB server, have each Deferred have an errback
that adds its errors into a list of errors.  Then add a callback to the
entire DeferredList that checks to see if there are any accumulated
failures.  If it finds failures, it errback's with a list of the failure
objects represented as strings so we don't have to deal with
InsecureJelly problems.

Does this sound like an alright way to do this?  Anyone have any
suggestions at improving this?

Thanks.
-Justin



From Matt.Boersma at arraybiopharma.com  Fri Aug 29 18:02:38 2003
From: Matt.Boersma at arraybiopharma.com (Boersma, Matt)
Date: Fri, 29 Aug 2003 16:02:38 -0600
Subject: [Twisted-Python] Plain text password with PB authentication?
Message-ID: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>

First, thanks to Itamar for nudging me in the right direction.  I never thought of looking at the unit tests for documentation, but so far that's the clearest explanation of the new PBServerFactory stuff I've seen.

Here's my problem.  I have a PB client that calls login against the server, with a UsernamePassword object as credentials.  PB sets up for me nice default implementations of the authentication mechanisms, but refuses to send the actual password to the server, only a doubly MD5-hashed version of same.

No!  Stop your flames!  Trading only hashes across the wire makes perfect sense--in most cases.  I fully understand, and I've written nearly identical Java code recently to do the same.

But...in this case I want simply to delegate the actual authentication on the server side to an Oracle login.  That is, if I can get a SQLConnectionPool with the given username and password and execute a test query, then the user is considered authenticated.  This requires that the server have the actual password, not its hash.  (Oracle doesn't appear to support anything besides clear text login, at least through the cx_Oracle and DCOracle2 APIs.)

So my options are:
- Create subclasses of PBClientFactory, CredentialsChecker, perhaps others, purely to undo the strict md5-hashing behavior of PB instead supply the clear text password.
- Leave the existing authentication as-is and create a dummy CredentialsChecker that always allows login.  Then do the "real" authentication in a secondary method the client is required to call.

Which of these two ugly approaches is more Twisted?

This electronic message transmission is a PRIVATE communication which contains
information which may be confidential or privileged. The information is intended 
to be for the use of the individual or entity named above. If you are not the 
intended recipient, please be aware that any disclosure, copying, distribution 
or use of the contents of this information is prohibited. Please notify the
sender  of the delivery error by replying to this message, or notify us by
telephone (877-633-2436, ext. 0), and then delete it from your system.




From exarkun at intarweb.us  Fri Aug 29 23:47:17 2003
From: exarkun at intarweb.us (Jp Calderone)
Date: Fri, 29 Aug 2003 23:47:17 -0400
Subject: [Twisted-Python] Plain text password with PB authentication?
In-Reply-To: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>
References: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>
Message-ID: <20030830034717.GA3400@intarweb.us>

On Fri, Aug 29, 2003 at 04:02:38PM -0600, Boersma, Matt wrote:
> First, thanks to Itamar for nudging me in the right direction.  I never
> thought of looking at the unit tests for documentation, but so far that's
> the clearest explanation of the new PBServerFactory stuff I've seen.
> 
> Here's my problem.  I have a PB client that calls login against the
> server, with a UsernamePassword object as credentials.  PB sets up for me
> nice default implementations of the authentication mechanisms, but refuses
> to send the actual password to the server, only a doubly MD5-hashed
> version of same.
> 
> No!  Stop your flames!  Trading only hashes across the wire makes perfect
> sense--in most cases.  I fully understand, and I've written nearly
> identical Java code recently to do the same.

  No need to flame.  Authenticating against plaintext passwords is fine --
as long as your transport is secure.

  Make sure your server uses listenSSL() and your client uses connectSSL().

> 
> But...in this case I want simply to delegate the actual authentication on
> the server side to an Oracle login.  That is, if I can get a
> SQLConnectionPool with the given username and password and execute a test
> query, then the user is considered authenticated.  This requires that the
> server have the actual password, not its hash.  (Oracle doesn't appear to
> support anything besides clear text login, at least through the cx_Oracle
> and DCOracle2 APIs.)
> 

  Disappointed.  Maybe some of the enterprise fell out of the box during
shipping.

> So my options are:
> - Create subclasses of PBClientFactory, CredentialsChecker, perhaps
>   others, purely to undo the strict md5-hashing behavior of PB instead
>   supply the clear text password.

  You only need to subclass PBClientFactory and PBServerFactory, nothing
else.

  Override PBServerFactory.buildProtocol() and set a different root object,
one that implements remote_login() that takes both the plaintext username
and password as arguments and returns the avatar right away (or a deferred
that is called back with the avatar eventually).

  Then override PBClientFactory.login() to send both the username and
password to the server's login() method.


> - Leave the existing authentication as-is and create a dummy
>   CredentialsChecker that always allows login.  Then do the "real"
>   authentication in a secondary method the client is required to call.

  Don't do this.

> 
> Which of these two ugly approaches is more Twisted?
> 

  The former approach isn't ugly at all.  The latter is pretty hackish.

  Once again, for emphasis: don't do this unless your transport is secure.

  Jp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030829/b96f8ba4/attachment.pgp 

From itamar at itamarst.org  Sat Aug 30 03:22:04 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sat, 30 Aug 2003 03:22:04 -0400
Subject: [Twisted-Python] Plain text password with PB authentication?
In-Reply-To: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>
References: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>
Message-ID: <20030830032204.3dcabd45.itamar@itamarst.org>

On Fri, 29 Aug 2003 16:02:38 -0600
"Boersma, Matt" <Matt.Boersma at arraybiopharma.com> wrote:

> Here's my problem.  I have a PB client that calls login against the
> server, with a UsernamePassword object as credentials.  PB sets up for
> me nice default implementations of the authentication mechanisms, but
> refuses to send the actual password to the server, only a doubly
> MD5-hashed version of same.

Pluggable credential types for PB logins, which will eventually be
supported, would allow this. Until then do what Jean-Paul said, make
your own custom login method.



From jjanecek at telusplanet.net  Sat Aug 30 06:34:58 2003
From: jjanecek at telusplanet.net (John Janecek)
Date: Sat, 30 Aug 2003 04:34:58 -0600
Subject: [Twisted-Python] Twisted sure is Twisted :)
In-Reply-To: <20030829113955.4009.30646.Mailman@pyramid.twistedmatrix.co
 m>
Message-ID: <5.1.0.14.2.20030830040248.00b59830@pop.telusplanet.net>

Twisted once u get a grip on it sure is pretty impressive.
I used twisted to forward UDP packets as a relay. Take one
UDP packet and then retrans it to many other clients. On
a FreeBSD box P3 750 the delay in retrans on packet to
like 5 clients was less then 1ms which was very impressive.

In using twisted i know the reactor is broken in wxpython.

What would happen if u ran a normal reactor in a seperate thread,
and then passed the info from twisted into wxpython using an event
handler similar to the wxpython thread demo ??

The only problem with that is i can not see how u would pass info
from wxpython back into twisted. Hmmmm maybe if u made a queue,
and then passed the commands onto a queue and then the reactor would
pull them off. Something to ponder :). Solution on ActiveState cookbook
will work, but i do not like timers.

The idea behind deferred is intresting. The defered call back does not seem
to fire until it is added. How the heck does that work ? I am refering to the
database example. Hmmmm not really important but kinda neat.

def getAge(user):
     return dbpool.runQuery("SELECT age FROM users WHERE name = ?", user)

def printResult(l):
     if l:
         print l[0][0], "years old"
     else:
         print "No such user"

d=getAge("joe")
d.addCallback(printResult)

like here d is the function getAge. My gut instict tell me the moment I 
call getAge
the database query should be run. But yet it is not run till u add the 
callback.
and if i add an errorback after it, it is not run till it has been added 
also, I can
not see how it works :)). Hmmmm must be part of the magic :))

Starting to look into woven. Basic examples are impressive. It is a real
object oriented web design. In the sandbox on CVS in the directory glyph
there is an example on forms. I am unable to get it to work. It runs but 
eveytime
I try and make it work I get in my browser the error no such child 
resource. I guess
I have to keep pluggin away at it :). My limited experience shows i need to 
change
my thinking, since twisted is not a "API" system like PHP, but more of a 
framework.
Maybe it would help if i drank a bottle of vodka first :)

I guess the only complaint i have about twisted is lack of woven examples, 
like for
forms and guard. But heya it is opensource and free, so if i do not like it 
I can
use some crappy comercial product :)).

Anyways Twisted is really cool. A lot of it seems to be very magical :). 
Pondering whether
I should get rid of my apache server and run a twisted one :)).

Anyway this is the crap i ramble off at 4 am :)
Just basically wanted to say twisted is cool.





From andrew-twisted at puzzling.org  Sat Aug 30 21:53:35 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Sun, 31 Aug 2003 11:53:35 +1000
Subject: [Twisted-Python] Twisted sure is Twisted :)
In-Reply-To: <5.1.0.14.2.20030830040248.00b59830@pop.telusplanet.net>
References: <20030829113955.4009.30646.Mailman@pyramid.twistedmatrix.com> <5.1.0.14.2.20030830040248.00b59830@pop.telusplanet.net>
Message-ID: <20030831015335.GA2722@frobozz>

On Sat, Aug 30, 2003 at 04:34:58AM -0600, John Janecek wrote:
> Twisted once u get a grip on it sure is pretty impressive.
> I used twisted to forward UDP packets as a relay. Take one
> UDP packet and then retrans it to many other clients. On
> a FreeBSD box P3 750 the delay in retrans on packet to
> like 5 clients was less then 1ms which was very impressive.
> 
> In using twisted i know the reactor is broken in wxpython.
> 
> What would happen if u ran a normal reactor in a seperate thread,
> and then passed the info from twisted into wxpython using an event
> handler similar to the wxpython thread demo ??

You could use reactor.callInThread(myWxMainLoop), I guess -- but last time I
looked at wxpython, it *had* to be run in the main thread, so this might get
slightly messy (I'm pretty sure the Twisted reactor doesn't mind being run
in a non-main thread, so this shouldn't be insurmountable).  Of course, it's
been quite a while since I've used wxpython, so this might not be an issue
anymore.

> The only problem with that is i can not see how u would pass info
> from wxpython back into twisted. Hmmmm maybe if u made a queue,

Just use reactor.callFromThread -- a thread can call this to safely schedule a
function to be run in the main event loop.  See
http://twistedmatrix.com/documents/howto/threading.  

> The idea behind deferred is intresting. The defered call back does not
> seem to fire until it is added. How the heck does that work ? I am
> refering to the database example. Hmmmm not really important but kinda
> neat.

Deferred callbacks obviously can't fire until they're added to the deferred,
but of course they might not fire immediately upon addCallback, though --
because the deferred might not have been called yet.

> def getAge(user):
>     return dbpool.runQuery("SELECT age FROM users WHERE name = ?", user)
> 
> def printResult(l):
>     if l:
>         print l[0][0], "years old"
>     else:
>         print "No such user"
> 
> d=getAge("joe")
> d.addCallback(printResult)
> 
> like here d is the function getAge. My gut instict tell me the moment I

No, here 'd' is a deferred result from the function 'getAge'.  A deferred is
simply an object that represents a result that probably hasn't arrived yet.

> call getAge the database query should be run. But yet it is not run till u
> add the callback.  and if i add an errorback after it, it is not run till
> it has been added also, I can not see how it works :)). Hmmmm must be part
> of the magic :))

So, in this case, dbpool.runQuery ducks off and runs the database query in a
thread behind the scenes, and returns immediately without waiting for the
result to arrive -- because databases can take an arbitrarily long time to
return a result.  In the meantime, the code that called runQuery can add
callbacks and errbacks to the deferred result from runQuery, and the
deferred will see to it that those are run when the result does arrive (if
the result has already arrived by the time you add a callback, it will be
run immediately).

The running of the callback is completely independent to the running of the
query.  If you never add any callbacks or errbacks and just discard the
deferred from dbpool.runQuery immediately, the query is still run on the
database -- it's just that when the twisted.enterprise.adbapi code gets the
result back from the database, it will fire the deferred (using
Deferred.callback or Deferred.errback), and the deferred will find it has no
callbacks to trigger, which is fine.

If you haven't already, read http://twistedmatrix.com/documents/howto/defer.

[...]
> Anyway this is the crap i ramble off at 4 am :)
> Just basically wanted to say twisted is cool.

Thanks!  :)

-Andrew.




From ecn at metaslash.com  Sun Aug 31 16:48:47 2003
From: ecn at metaslash.com (Eric C. Newton)
Date: Sun, 31 Aug 2003 16:48:47 -0400
Subject: [Twisted-Python] error in pollreactor.py
Message-ID: <20030831204847.GA8139@localhost.localdomain>

Method _dictRemove of pollreactor.py:

    def _dictRemove(self, selectable, mdict):
        try:
            # the easy way
            fd = reader.fileno()
        except:
            # the hard way: necessary because fileno() may disappear at any
            # moment, thanks to python's underlying sockets impl
            for fd, fdes in selectables.items():
                if selectable is fdes:
                    break
            else:
                # Hmm, maybe not the right course of action?  This method can't
                # fail, because it happens inside error detection...
                return
        if mdict.has_key(fd):
            del mdict[fd]
            self._updateRegistration(fd)

First, "reader.fileno()" is just not going to work because there is no
variable "reader" in the scope.  This error is hidden by the
all-encompassing except clause.  Second, this comment about fileno()
disappearing... I don't believe it.  Does anyone know if this is
really true?

Code works (in my limited tests) if changed to:

    def _dictRemove(self, selectable, mdict):
        fd = selectable.fileno()
        if mdict.has_key(fd):
            del mdict[fd]
            self._updateRegistration(fd)

-Eric



From exarkun at intarweb.us  Sun Aug 31 17:16:28 2003
From: exarkun at intarweb.us (Jp Calderone)
Date: Sun, 31 Aug 2003 17:16:28 -0400
Subject: [Twisted-Python] error in pollreactor.py
In-Reply-To: <20030831204847.GA8139@localhost.localdomain>
References: <20030831204847.GA8139@localhost.localdomain>
Message-ID: <20030831211628.GA15991@intarweb.us>

On Sun, Aug 31, 2003 at 04:48:47PM -0400, Eric C. Newton wrote:
> Method _dictRemove of pollreactor.py:
> 
>     def _dictRemove(self, selectable, mdict):
>         try:
>             # the easy way
>             fd = reader.fileno()
>         except:
>             # the hard way: necessary because fileno() may disappear at any
>             # moment, thanks to python's underlying sockets impl
>             for fd, fdes in selectables.items():
>                 if selectable is fdes:
>                     break
>             else:
>                 # Hmm, maybe not the right course of action?  This method can't
>                 # fail, because it happens inside error detection...
>                 return
>         if mdict.has_key(fd):
>             del mdict[fd]
>             self._updateRegistration(fd)
> 
> First, "reader.fileno()" is just not going to work because there is no
> variable "reader" in the scope.  This error is hidden by the
> all-encompassing except clause.  Second, this comment about fileno()
> disappearing... I don't believe it.  Does anyone know if this is
> really true?

  What the comment really means, I believe, is that fileno() may return -1
at any time, without warning.  -1 will never be in the dict, so a lookup for
what the file descriptor used to be must be done.

> 
> Code works (in my limited tests) if changed to:
> 
>     def _dictRemove(self, selectable, mdict):
>         fd = selectable.fileno()
>         if mdict.has_key(fd):
>             del mdict[fd]
>             self._updateRegistration(fd)
> 

  I think you're on the right track, but would use this instead:

    def _dictRemove(self, selectable, mdict):
        fd = selectable.fileno()
        if fd == -1:
            for fd, fdes in selectables.iteritems():
                if fdes is selectable:
                    break
            else:
                # This should probably be reported.  It should
                # never happen.
                return
        try:
            del mdict[fd]
        except KeyError:
            pass
        else:
            self._updateRegistration(fd)

  Jp

-- 
http://catandgirl.com/view.cgi?44
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20030831/ebfbde78/attachment.pgp 

From jjanecek at telusplanet.net  Sun Aug 31 23:27:39 2003
From: jjanecek at telusplanet.net (John Janecek)
Date: Sun, 31 Aug 2003 21:27:39 -0600
Subject: [Twisted-Python] Form Processor hmmmm looks cool what does it do :)
In-Reply-To: <20030831114047.12805.97073.Mailman@pyramid.twistedmatrix.c
 om>
Message-ID: <5.1.0.14.2.20030831211027.00bbb788@pop.telusplanet.net>

Thanx to the dude who answered my last post :)
When i get some time i have to try and put into practive wxpython suggestions

I took the form processor example from the sandbox and made it do something.
What it is doing i am not quite sure :)

#form_input.py
#simple proggie to test how to handle forms
#hacked together from myformstuf which is in the glyph directory in the sandbox
#not really sure if this is done right

from twisted.web.woven import page
#this module is required for the method def wmfactory_form(self, request): 
to work
from twisted.web.woven.form import FormProcessor
from twisted.python import formmethod as fm

class FormPage(page.Page) :

     template = '''
     <html>
     <head><title>a form page</title>
     </head>
     <body>
     <form action="post" model="form" />
     </body>
     </html>
     '''

     formSignature = fm.MethodSignature(
             fm.String("username","","User Name : ","Enter a user name"),
             fm.Password("password","","Password : ","Enter a password")
             )

     def proc(self,**kw) :
         print "proc : ",kw

     def wmfactory_form(self, request):
         print "factory form"
         return self.formSignature.method(self.proc)

     def wchild_post(self,request) :
         print "child post ",request.args
         return FormProcessor(self.formSignature.method(self.proc))



#the test throttle code
def main() :
     print "Main Loop"
     from twisted.web.server import Site
     from twisted.internet import reactor

     reactor.listenTCP(9999,Site(FormPage()))
     reactor.run()

main()

self.proc is a required arguement.
It returns a dictionary with all the form variables in it when form is posted.
I am not really sure what am i supposed to do in this function. Like in 
this instance
would this be where i could stick variables into a data base ?

The method FormProcessor(self.formSignature.method(self.proc)) appears from 
the code
to be able to take a second arguement where i can add my own view. If no 
view is added
it uses the view that is provided by default. It would be kinda nice to 
have my own view,
how would my own view be able to access the variables that are posted from 
the form.

FormProcessor also appears to be able to take a 3rd arguement that is some 
sort of error view,
what type of errors would happen, and how will they be triggered.

FormProcessor looks like the smart way to handle forms. Unfortunately I 
seem to be missing a few pieces.

Well i will keep on plugging away at it :)
Hmmmm well anyways i am kinda lost i will think about being lost some more :))


Thanx

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20030831/00bcce84/attachment.htm 

From Richard.Townsend at edl.uk.eds.com  Fri Aug  1 01:10:13 2003
From: Richard.Townsend at edl.uk.eds.com (Richard.Townsend at edl.uk.eds.com)
Date: Fri, 1 Aug 2003 08:10:13 +0100 
Subject: [Twisted-Python] Re: Re: PB - detecting loss of connection
Message-ID: <76ADB8C376C3D31193F50008C7E6D3B2F3E16C@EWHKA005>

> aReferenceable.broker.notifyOnDisconnect(f)

> f() will now be called on disconnect, aReferenceable the result of
> getObjectAt() or any call that returns a RemoteReference.

Thanks, Itamar - that's just what I wanted.
 -Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20030801/a880a13b/attachment.html>

From screwtape at froup.com  Fri Aug  1 02:06:03 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Fri, 1 Aug 2003 18:06:03 +1000
Subject: [Twisted-Python] Twisted and Rendezvous
In-Reply-To: <20030730.145647.21615978.warner@lothar.com>
References: <20030730130240.GC25612@ferd2.thristian.org> <20030730.145647.21615978.warner@lothar.com>
Message-ID: <20030801080603.GA7792@ferd2.thristian.org>

On Wed, Jul 30, 2003 at 02:56:47PM -0700, Brian Warner wrote:
> screwtape at froup.com writes:
> 
> > A few weeks ago, someone on the list mentioned Rendezvous support for
> > Twisted. Curious, I picked up the Rendezvous specification documents,
> > and got to hacking.
> 
> That's cool. I'm not sure this falls into the same scope, but it occurred to
> me that it would be handy to have a DNS server that provided SRV records
> based upon registrations arriving from other server programs. If the
> application (say, an HTTP server) launched, started listening on an
> arbitrary port, then told the DNS/SRV server its service name and port
> number, the DNS server could start feeding appropriate SRV records for the
> application.

Having a nice standard structure for SRV records is the purposes of
the DNS-SD specification: http://tinyurl.com/ipj7

It turns out that a service like what you describe is going to be
quite important for anyone who wants to write software that uses
Rendezvous and doesn't require Mac OS X - as far as I can tell, only
one application at a time per host can bind to a particular port on a
multicast address, so if the OS doesn't supply an mDNS responder (or
your language doesn't have bindings for the OS's mDNS responder) then
applications will try and supply their own, and if two or more such
applications try and run simultaneously, problems will occur.

Thus some kind of server that sits on the network and offers mDNS
services to applications who otherwise can't offer them, possibly
working as a regular DNS server as well (configure it as the DNS
server for the '.local' domain to make legacy apps magically look up
multicast-DNS based host-names) would be an absolute boon.

Note that you only need a multicast DNS proxy to serve DNS records -
if another process on your host has already bound to the mDNS address
and port, you can look up multicast DNS records by sending ordinary
DNS packets to the mDNS port. In Twisted, it looks like this:

	from twisted.names import client

	resl = client.Resolver(servers=[('224.0.0.251', 5353)])
	resl.lookupAddress('grundoon.local').addCallback(processAddress)


> I'd have the application keep a TCP connection open to the DNS server, and
> if that connection went down, the SRV record would be removed. It would work
> a lot like dynamic DNS, except per-application instead of per-host.

The DNS-SD documentation mentions (in passing) various other
ways of updating DNS rather than multicast DNS - manual update,
scripts that use protocol-specific browsing to create a standard DNS
zone file, or (as you mention) RFC 2136, Dynamic DNS Update.

I had a brief, 20-second glance at the dynamic DNS RFC, and I can't
see any reason you shouldn't be able to send per-application records
to a dynamic DNS server. You'd still have hassles with cooperatively
maintaining DNS records and so forth, of course...

I like the idea of having a TCP connection alive (with keepalive
packets, I assume) to maintain one's DNS records. You should be able
to supply more than one record, of course (DNS-SD requires that you
serve up a PTR record and a TXT record along with your SRV record),
so the wire protocol might be a bit more complex.



Hmm.. how stable and extensible and reliable is twisted.names?

> just looking to plant some idea seeds..
>  -Brian

Always welcome. :)

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _    _
|
| "We've got a lot in common" "I've always thought so, too." -- M*A*S*H
|



From screwtape at froup.com  Fri Aug  1 02:20:14 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Fri, 1 Aug 2003 18:20:14 +1000
Subject: [Twisted-Python] Win32 Service
In-Reply-To: <3F28BFA5.9743.14D34878@localhost>
References: <3F28BFA5.9743.14D34878@localhost>
Message-ID: <20030801082014.GB7792@ferd2.thristian.org>

On Thu, Jul 31, 2003 at 07:05:09AM -0700, Mike Owens wrote:
> I am currently running twisted on an XP machine. What is the 
> recommended way of running twistd as a service? Or should I just 
> create a custom web script and run that as a service?

I don't believe twistd plays nicely with NT-style services at the
moment. If I had to make a Twisted-using Python script into an NT
service tomorrow, I'd be playing with py2exe:

	http://starship.python.net/crew/theller/py2exe/

Obviously, that's more for setting up your script on your server
(farm) rather than for rapid development...

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _    _
|
| Just think of this number as a sort of parrot. -- Ross Williams
|



From tv at twistedmatrix.com  Fri Aug  1 02:15:33 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Fri, 1 Aug 2003 11:15:33 +0300
Subject: [Twisted-Python] Callbacks, Looping, and Variable Binding
In-Reply-To: <20030731202024.3E44338FCB@www.fastmail.fm>
References: <20030731171328.BAF3F389C1@www.fastmail.fm> <20030731195004.GB32069@lapdog> <20030731202024.3E44338FCB@www.fastmail.fm>
Message-ID: <20030801081532.GB781@lapdog>

On Thu, Jul 31, 2003 at 02:20:24PM -0600, Justin Johnson wrote:
>      for item in list:
>          d.addCallbacks(onSuccess, log.err, callbackArgs=(item,))
>          deferreds.append(d)
> 
> and then defining onSuccess like...
> 
>     def onSuccess(results, args):
>         item = args[0]
>         d = item.doSomethingElseThatReturnsDeferred()
>         return d
> 
> Is this an acceptable way to accomplish this?  It is working in my code
> but I'd like to do things the right way.

	Yes. I'd make that prettier with

    def onSuccess(results, item):
        d = item.doSomethingElseThatReturnsDeferred()
        return d
...
    for item in list:
	d.addCallback(onSuccess, item)
	d.addErrback(log.err)
	deferreds.append(d)

> > 	Besides, you are adding the outer d to deferreds once per
> > 	iteration. That's broken.
> I'm not sure what you mean here.  I was adding my deferred to a list and
> it seemed to be doing what I wanted (at least I think it was).

	Your original code had

>     d = doSomethingThatReturnsDeferred()
>
>     for item in list:
>         d.addCallbacks(onSuccess, log.err)
>         deferreds.append(d)

	Which ends up adding the _same_ d len(list) times to deferreds.

-- 
:(){ :|:&};:



From smurf at smurf.noris.de  Fri Aug  1 04:36:23 2003
From: smurf at smurf.noris.de (Matthias Urlichs)
Date: Fri, 01 Aug 2003 12:36:23 +0200
Subject: [Twisted-Python] Considering Twisted for OfflineIMAP
References: <20030726134815.GA26482@complete.org> <20030726163502.GA26873@lapdog>
Message-ID: <pan.2003.08.01.10.36.21.695032@smurf.noris.de>

Hi, Tommi Virtanen wrote:

> counting the currently open IMAP connections and when the number
> 	is below the limit, taking more work from a queue

Or you could use a semaphore.

Feel free to add this code to twisted.internet.deferred.
The interface should be identical to python.threading.Semaphore,
except that I was too lazy to add any verbose statements...

class Semaphore(object):
    def __init__(self, value=1, verbose=None):
        self.queue=[]
        self.value=value

    def acquire(self):
        d=Deferred()
        if self.value:
            self.value -= 1
            d.callback(False)
        else:
            self.queue.append(d)
        return d

    def release(self):
        if self.queue:
            self.queue.pop(0).callback(True)
        else:
            self.value += 1

The callback's parameter answers the "did I have to wait for a slot"
question, in case the caller needs that question answered. (Most don't.)

-- 
Matthias Urlichs   |   {M:U} IT Design @ m-u-it.de   |  smurf at smurf.noris.de
Disclaimer: The quote was selected randomly. Really. | http://smurf.noris.de
-- 
s = (char*)(long)retval;                /* ouch */
             -- Larry Wall in doio.c from the perl source code




From justinjohnson at fastmail.fm  Fri Aug  1 05:57:36 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Fri, 01 Aug 2003 05:57:36 -0600
Subject: [Twisted-Python] Callbacks, Looping, and Variable Binding
In-Reply-To: <20030801081532.GB781@lapdog>
References: <20030731171328.BAF3F389C1@www.fastmail.fm> <20030731195004.GB32069@lapdog> <20030731202024.3E44338FCB@www.fastmail.fm> <20030801081532.GB781@lapdog>
Message-ID: <20030801115737.043D337B8A@www.fastmail.fm>

> 	Yes. I'd make that prettier with
> 
>     def onSuccess(results, item):
>         d = item.doSomethingElseThatReturnsDeferred()
>         return d
> ...
>     for item in list:
> 	d.addCallback(onSuccess, item)
> 	d.addErrback(log.err)
> 	deferreds.append(d)

Yes, that looks much cleaner.

> > > 	Besides, you are adding the outer d to deferreds once per
> > > 	iteration. That's broken.
> > I'm not sure what you mean here.  I was adding my deferred to a list and
> > it seemed to be doing what I wanted (at least I think it was).
> 
> 	Your original code had
> 
> >     d = doSomethingThatReturnsDeferred()
> >
> >     for item in list:
> >         d.addCallbacks(onSuccess, log.err)
> >         deferreds.append(d)
> 
> 	Which ends up adding the _same_ d len(list) times to deferreds.

Ahhh.... I see.  That was a result of me rewriting my code for the post
to this list, and not putting things in their original place.  Thanks for
your help.




From mporter at despammed.com  Fri Aug  1 06:05:04 2003
From: mporter at despammed.com (Michael Porter)
Date: Fri, 1 Aug 2003 13:05:04 +0100
Subject: [Twisted-Python] twisted and wxPython 2.4.1.2
References: <76ADB8C376C3D31193F50008C7E6D3B2F3E16C@EWHKA005>
Message-ID: <002e01c35825$24e3f7e0$0201a8c0@dan>

Re: Re: PB - detecting loss of connectionHas anyone got twisted running with
wxPython 2.4.1.2?

If I run the example wxdemo.py with Twisted 1.0.6 and wxPython 2.4.1.2 on
Windows I get the following error:

Traceback (most recent call last):
  File "C:\dev\controlled\mpjuke\unused\wxdemo.py", line 65, in ?
    demo()
  File "C:\dev\controlled\mpjuke\unused\wxdemo.py", line 61, in demo
    reactor.run()
  File "C:\dev\controlled\mpjuke\pymods\twisted\internet\default.py", line
121, in run
    self.startRunning(installSignalHandlers=installSignalHandlers)
  File "C:\dev\controlled\mpjuke\pymods\twisted\internet\default.py", line
115, in startRunning
    self._handleSignals()
  File "C:\dev\controlled\mpjuke\pymods\twisted\internet\default.py", line
87, in _handleSignals
    signal.signal(signal.SIGINT, self.sigInt)
SystemError: error return without exception set

If I change the demo to run with reactor.run(installSignalHandlers=0) it
works fine, but I'd prefer to have this enabled.

The problem occurs with Python 2.2 or 2.3 with this version of wxPython but
it didn't occur with wxPython 2.3.2.1.

Thanks,

Mike.




From justinjohnson at fastmail.fm  Fri Aug  1 06:01:28 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Fri, 01 Aug 2003 06:01:28 -0600
Subject: [Twisted-Python] Win32 Service
In-Reply-To: ARRAY(0xa11a878)
References: ARRAY(0xa085dd8)
Message-ID: <20030801120128.0FA6C381A7@www.fastmail.fm>

I'm not using twistd, but I did get my xmlrpc service written in twisted
to run as a service using the attached file.

-Justin

On Fri, 1 Aug 2003 18:20:14 +1000, screwtape at froup.com said:
> On Thu, Jul 31, 2003 at 07:05:09AM -0700, Mike Owens wrote:
> > I am currently running twisted on an XP machine. What is the 
> > recommended way of running twistd as a service? Or should I just 
> > create a custom web script and run that as a service?
> 
> I don't believe twistd plays nicely with NT-style services at the
> moment. If I had to make a Twisted-using Python script into an NT
> service tomorrow, I'd be playing with py2exe:
> 
> 	http://starship.python.net/crew/theller/py2exe/
> 
> Obviously, that's more for setting up your script on your server
> (farm) rather than for rapid development...
> 
> -- 
>  ___________ ___________________________________
> | Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _
>   _    _
> |
> | Just think of this number as a sort of parrot. -- Ross Williams
> |
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winsvc.py
Type: application/unknown
Size: 1550 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030801/955a4adc/attachment-0002.bin>

From itamar at itamarst.org  Fri Aug  1 10:58:49 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 1 Aug 2003 12:58:49 -0400
Subject: [Twisted-Python] twisted and wxPython 2.4.1.2
In-Reply-To: <002e01c35825$24e3f7e0$0201a8c0@dan>
References: <76ADB8C376C3D31193F50008C7E6D3B2F3E16C@EWHKA005>
	<002e01c35825$24e3f7e0$0201a8c0@dan>
Message-ID: <20030801125849.2a9237d6.itamar@itamarst.org>

On Fri, 1 Aug 2003 13:05:04 +0100
"Michael Porter" <mporter at despammed.com> wrote:

> If I change the demo to run with reactor.run(installSignalHandlers=0)
> it works fine, but I'd prefer to have this enabled.
> 
> The problem occurs with Python 2.2 or 2.3 with this version of
> wxPython but it didn't occur with wxPython 2.3.2.1.

As far as we can tell this is a wxPython bug - someone opened a report
in the wxPython SF bug tracker, see if it's been resolved.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
http://www.zoteca.com -- Python & Twisted consulting



From rdrb at 123.cl  Fri Aug  1 11:14:03 2003
From: rdrb at 123.cl (RITA Y/O RODRIGO DIAZ Y/O BENENSON)
Date: Fri, 01 Aug 2003 13:14:03 -0400
Subject: [Twisted-Python] kill a twisted server on Windows
Message-ID: <39f8538a5b.38a5b39f85@noborrar.co.cl>

Hi,

How do I write at basch command on
Window equivalent to the *nix shell
command 

kill `cat twistd.pid` ?


Thanks.
RodrigoB.




From Rudy.Schockaert at pandora.be  Fri Aug  1 11:34:33 2003
From: Rudy.Schockaert at pandora.be (Rudy Schockaert)
Date: Fri, 01 Aug 2003 19:34:33 +0200
Subject: [Twisted-Python] Win32 Service
In-Reply-To: <20030801120128.0FA6C381A7@www.fastmail.fm>
References: ARRAY(0xa085dd8) <20030801120128.0FA6C381A7@www.fastmail.fm>
Message-ID: <3F2AA4A9.20506@pandora.be>

Justin Johnson wrote:

>I'm not using twistd, but I did get my xmlrpc service written in twisted
>to run as a service using the attached file.
>
>-Justin
>  
>
This is just what I needed. Thanks a lot.




From mporter at despammed.com  Fri Aug  1 12:49:04 2003
From: mporter at despammed.com (Michael Porter)
Date: Fri, 1 Aug 2003 19:49:04 +0100
Subject: [Twisted-Python] twisted and wxPython 2.4.1.2
Message-ID: <008501c3585d$94f3bbf0$0201a8c0@dan>

From: "Itamar Shtull-Trauring" <itamar at itamarst.org>


> On Fri, 1 Aug 2003 13:05:04 +0100
> "Michael Porter" <mporter at despammed.com> wrote:
>
> > If I change the demo to run with reactor.run(installSignalHandlers=0)
> > it works fine, but I'd prefer to have this enabled.
> >
> > The problem occurs with Python 2.2 or 2.3 with this version of
> > wxPython but it didn't occur with wxPython 2.3.2.1.
>
> As far as we can tell this is a wxPython bug - someone opened a report
> in the wxPython SF bug tracker, see if it's been resolved.


Ok, seems this isn't a twisted problem. As far as I can figure out from the
bug trackers (wxWindows ID 746099 and Python ID 762198) this has now been
fixed although it doesn't seem to have made it into the latest wxPython
binary and I can't find a way of finding out which bug IDs are fixed in a
release.

Hopefully it'll make its way through soon.

Thanks,

Mike.




From micahlists at comcast.net  Fri Aug  1 17:56:07 2003
From: micahlists at comcast.net (Micah Yoder)
Date: Fri, 1 Aug 2003 16:56:07 -0700
Subject: [Twisted-Python] Docs...
Message-ID: <200308011656.07132.micahlists@comcast.net>

Hi,

I know it has been mentioned before that more/better docs would be nice.

Can I suggest a doc like "twisted.web for PHP developers" with lots of 
examples including stuff like sessions and database access?

I would actually be willing to help with such a manual, but I'm still trying 
to understand much of this stuff myself. :)  I am currently working on my 
first twisted.web app.  I'm getting there, but the docs still leave some 
questions.  If a few others would find this useful and have some of the 
knowledge needed, perhaps we could collaborate on it.

As for the examples on the site, how about sending them with a MIME type of 
text/plain?  That would allow viewing them in the browser insted of 
downloading them, which would be nice.

Also, where are the apps?  Searching Freshmeat for "twisted" doesn't really 
come up with any Twisted apps, unless WebTK counts.  For example, a Twisted 
based bulletin board or blog.  Something like that would help a lot!

Thanks,
Micah

-- 
Yoder Internet Development
Honest and Affordable Web Development and Linux consulting
http://yoderdev.com





From warner at lothar.com  Sat Aug  2 00:37:41 2003
From: warner at lothar.com (Brian Warner)
Date: Fri, 01 Aug 2003 23:37:41 -0700 (PDT)
Subject: [Twisted-Python] StepReactor?
References: <3F28BCCD.90303@tekNico.net> <20030731071406.GC30331@frobozz>
 <3F28D112.8020301@tekNico.net>
Message-ID: <20030801.233741.59470359.warner@lothar.com>

Nicola Larosa <nico at tekNico.net> writes:
> 
> Come to think of it, is there a way in Twisted to schedule an event at an
> absolute time, instead of at a relative one?

Sure.

 reactor.callLater(desiredTime - time.time(), func)

:-).

The reactor stores DelayedCalls with absolute times instead of relative ones
internally. The callLater API accepts relative times because that's
generally the most useful to work with.

 -Brian



From warner at lothar.com  Sat Aug  2 02:09:50 2003
From: warner at lothar.com (Brian Warner)
Date: Sat, 02 Aug 2003 01:09:50 -0700 (PDT)
Subject: [Twisted-Python] Remote PB calls in
 ApplicationService.stopService
References: <20030731210210.GR282@perpetual.moxn.net>
Message-ID: <20030802.010950.23653851.warner@lothar.com>

Alex Levy <mesozoic at polynode.com> writes:
> 
>    def stopService(self):
>      somePBRemoteCall(i_am_dying_event)
>      app.ApplicationService.stopService(self)
> 
> On the sending side, this results in 'Connection failed'. On the receiving
> side, the following traceback appears. Could somebody more familiar with the
> internals of Perspective Broker explain what's going wrong, or how I might
> change my approach?

There are a couple of problems interacting here. One is that you're sending
out data as the application is shutting down, which means that many of the
usual assumptions (about the request eventually being sent over the wire,
about a response eventually coming back) are not guaranteed to remain true.

A second is that, currently, all PB calls require acknowledgement, even if
you expect the answer to be a simple 'None' (like the None that's returned
implicitly when you fall off the end of a Python function). There are hooks
in place to allow a call to tell the receiver that no answer is expected (or
will be accepted), allowing that end to skip the response phase, but those
hooks are disabled because there is no way to the caller to know whether
you're going to add a callback to the Deferred or not (especially because
that callback could be added *after* the request has been sent). So for now,
the far end always acknowleges every single PB call.

Or at least it tries to. I suspect you're seeing the following sequence of
events:

 reactor.stop()
  'shutdown' system event trigger is fired, callbacks are run
    app._beforeShutDown is run as a 'before' trigger on the 'shutdown' event
     stopService() is run on all Services
      callRemote(aaaaaarrgh)
       remote_aaaaaarrgh is serialized and queued, maybe sent, maybe not
    app._afterShutDown is run as the 'after' trigger, does app.save()
 reactor exits
 program exits
 all sockets are closed

The serialized remote call may or may not get sent: if the transport's
.write method tries to write some data immediately, then it will probably
get out. But the connection will be dropped soon afterwards, probably before
the far end has completed sending an answer.

Given that PB is about acknowleged method invocations, it will probably be
cleaner to try to delay shutdown briefly while you get your "I am dying"
messages through. Fortunately, both .stopService and the before-shutdown
event trigger that drives it have a useful property: you can return a
Deferred from them and the rest of the shutdown process will be stalled
until that Deferred is fired.

So just do this:

   def stopService(self):
     d = somePBRemoteCall(i_am_dying_event)
     app.ApplicationService.stopService(self)
     return d

(or do the superclass call first, it doesn't matter)

This will send out your shutdown messages but then return to the main
reactor loop, waiting for the messages to be acknowleged before proceeding
with the rest of shutdown (app.save() and exiting the reactor).

BTW: I think the exception you're seeing is a bug, and results from the
connectionLost messages being invoked twice on the same Broker. I think this
is an edge case that can only happen when a sender does something weird.

hope that helps,
 -Brian



From sflist at ihonk.com  Sat Aug  2 04:37:00 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Sat, 2 Aug 2003 03:37:00 -0700
Subject: [Twisted-Python] Event Driven Programming 101 question
Message-ID: <200308020337.00916.sflist@ihonk.com>

Hi all,

I've got a few questions about Deferreds. I understand the concept better, but 
I need a little help at the moment. It's apparent to me that a lot's going on 
behind the scenes between Deferreds and the Reactor, and that 
twisted.enterprise orchestrates things in a way I don't yet understand.

I'm looking at this from the perspective of my little XML-RPC server. A client 
hits a XML-RPC function, and by the time that function returns its value, it 
needs all its Deferreds to have generated their results. That leads to this 
question:

When is a Deferred guaranteed to have a result?

One answer could be, "When its callback gets called." And that would be true. 
But what if the function that gets the Deferred needs the result before it 
can move on? It seems like it'll get the Deferred and then go on its merry 
way, whether the Deferred has a result or not. And that's confusing to me, 
because I'm left wondering what happens if my database takes a long time to 
respond:

def xmlrpc_foo(self):
	result = dbpool.runQuery("select * from gigantic_table") # adbapi
	return result

In this case, what's it gonna be? A Deferred that's evaluated as None because 
Postgres is still churning, or is Twisted only going to let the code continue 
once the Deferred has a result?

Sorry if it seems I'm not making sense... Event-driven programming is new to 
me, but I'm a motivated learner. :-) (And if anybody knows of a good general 
guide to this paradigm, I'm all ears.)

Thanks for your help!

Steve



From m at moshez.org  Sat Aug  2 04:55:27 2003
From: m at moshez.org (Moshe Zadka)
Date: 2 Aug 2003 10:55:27 -0000
Subject: [Twisted-Python] Remote PB calls in
 ApplicationService.stopService
In-Reply-To: <20030802.010950.23653851.warner@lothar.com>
References: <20030802.010950.23653851.warner@lothar.com>, <20030731210210.GR282@perpetual.moxn.net>
Message-ID: <20030802105527.19416.qmail@green.zadka.com>

On Sat, 02 Aug 2003, Brian Warner <warner at lothar.com> wrote:

> Given that PB is about acknowleged method invocations, it will probably be
> cleaner to try to delay shutdown briefly while you get your "I am dying"
> messages through. Fortunately, both .stopService and the before-shutdown
> event trigger that drives it have a useful property: you can return a
> Deferred from them and the rest of the shutdown process will be stalled
> until that Deferred is fired.

BTW, currently that feature is not in the new Application code I'm working
on. I could add it, but when we discussed it I didn't know of anybody
using that feature. It seems a bit too dangerous to allow a buggy remote
side to delay our shutdown by a long amount of time [depending on PB
timeouts]. I humbly suggest that an architecture which depends on being
able to send "one last message" is probably flawed.

-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From m at moshez.org  Sat Aug  2 05:01:46 2003
From: m at moshez.org (Moshe Zadka)
Date: 2 Aug 2003 11:01:46 -0000
Subject: [Twisted-Python] Event Driven Programming 101 question
In-Reply-To: <200308020337.00916.sflist@ihonk.com>
References: <200308020337.00916.sflist@ihonk.com>
Message-ID: <20030802110146.19493.qmail@green.zadka.com>

On Sat, 2 Aug 2003, Steve Freitas <sflist at ihonk.com> wrote:

> It's apparent to me that a lot's going on 
> behind the scenes between Deferreds and the Reactor

Nope. There's very little magic going on.
 
> When is a Deferred guaranteed to have a result?
> 
> One answer could be, "When its callback gets called." And that would be true. 

Yep.

> But what if the function that gets the Deferred needs the result before it 
> can move on?

It's out of luck.

> def xmlrpc_foo(self):
> 	result = dbpool.runQuery("select * from gigantic_table") # adbapi
> 	return result

This "just" works. When xmlrpc_foo returns a result, the Twisted XMLRPC
machinery checks if it is a deferred. If it is, it won't send a result
back to the client until the deferred is triggered.

Here is the code in question, just to see how little magic there is:

'''
            request.setHeader("content-type", "text/xml")
            defer.maybeDeferred(function, *args).addErrback(
                self._ebRender
            ).addCallback(
                self._cbRender, request
            )
'''

[_ebRender and _cbRender do the work of actually formatting the response]
-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From nico at tekNico.net  Sat Aug  2 01:09:05 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Sat, 02 Aug 2003 09:09:05 +0200
Subject: [Twisted-Python] StepReactor?
In-Reply-To: <20030801.233741.59470359.warner@lothar.com>
References: <3F28BCCD.90303@tekNico.net> <20030731071406.GC30331@frobozz> <3F28D112.8020301@tekNico.net> <20030801.233741.59470359.warner@lothar.com>
Message-ID: <3F2B6391.5010102@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

>> Come to think of it, is there a way in Twisted to schedule an event at an
>> absolute time, instead of at a relative one?

> Sure.
>
>  reactor.callLater(desiredTime - time.time(), func)
>
> :-).

Of course. :^)


> The reactor stores DelayedCalls with absolute times instead of relative ones
> internally.

That's good to know.


> The callLater API accepts relative times because that's
> generally the most useful to work with.

Very true, and arguably there's no point in coming up with some convention
to specify absolute time, since the above syntax is clear enough.


- --
"I'm a Python fanatic these days, I find that I'm able to program about
three times faster than I could in Java, and I was able to program
in Java about three times faster than I could in C."  Andy Hertzfeld

Nicola Larosa - nico at tekNico.net

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/K2OPXv0hgDImBm4RAnytAKCR5qWWWY74+t1liIW/3t9//3aZAgCaA4N6
zT/0F9U83zVGYzb09YwqUKQ=
=VD4g
-----END PGP SIGNATURE-----





From tv at twistedmatrix.com  Sat Aug  2 08:22:16 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 2 Aug 2003 17:22:16 +0300
Subject: [Twisted-Python] [PATCH] SMTP cleanup, do not hide error messages
Message-ID: <20030802142216.GA25941@lapdog>

	Hi. Here's a patch that does two things to twisted.protocol.smtp:

	1) use sendLine instead of self.transport.write, for prettiness
	   and also to make debug printing in sendLine be actually useful.

	2) use the code and error message from SMTPBadSender and
	   SMTPBadRcpt exceptions trapped, not a hardcoded "550 I'm
	   not telling you what want wrong." Helps debugging scalemail
	   a _lot_.

	You have at most a few days to protest, or I will
	commit. Explicitly saying "looks good" appreciated.

Index: twisted/protocols/smtp.py
===================================================================
RCS file: /cvs/Twisted/twisted/protocols/smtp.py,v
retrieving revision 1.69
diff -u -u -r1.69 smtp.py
--- twisted/protocols/smtp.py	23 Jul 2003 23:10:54 -0000	1.69
+++ twisted/protocols/smtp.py	2 Aug 2003 14:46:49 -0000
@@ -444,9 +444,9 @@
         lines = message.splitlines()
         lastline = lines[-1:]
         for line in lines[:-1]:
-            self.transport.write('%3.3d-%s\r\n' % (code, line))
-        self.transport.write('%3.3d %s\r\n' % (code,
-                                               lastline and lastline[0] or ''))
+            self.sendLine('%3.3d-%s' % (code, line))
+        self.sendLine('%3.3d %s' % (code,
+                                    lastline and lastline[0] or ''))
 
     def lineReceived(self, line):
         self.resetTimeout()
@@ -558,7 +558,9 @@
 
     def _ebFromValidate(self, failure):
         if failure.check(SMTPBadSender):
-            self.sendCode(550, 'Cannot receive for specified address')
+            self.sendCode(failure.value.code,
+                          'Cannot receive for specified address %s: %s'
+                          % (repr(str(failure.value.addr)), failure.value.resp))
         elif failure.check(SMTPServerError):
             self.sendCode(failure.value.code, failure.value.resp)
         else:
@@ -632,7 +634,7 @@
 
     def _ebToValidate(self, failure):
         if failure.check(SMTPBadRcpt):
-            self.sendCode(550, 'Cannot receive for specified address')
+            self.sendCode(failure.value.code, failure.value.resp)
         elif failure.check(SMTPServerError):
             self.sendCode(failure.value.code, failure.value.resp)
         else:

-- 
:(){ :|:&};:



From tv at twistedmatrix.com  Sat Aug  2 08:27:50 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 2 Aug 2003 17:27:50 +0300
Subject: [Twisted-Python] [PATCH] make syslog work
Message-ID: <20030802142750.GB25941@lapdog>

	Hi. Here's a patch that does a few things to twistd and
	twisted.python.syslog.

	1) twistd: allow using -n and --syslog at the same time,
	   by reordering the elif's.

	2) rewrite twisted.python.syslog to save it from bitrot,
	   I don't think it could have worked at all. To avoid
	   code duplication, refactor twisted.python.log a bit;
	   we don't want twistedy time stamps in syslog, but we
	   want rest of the nice things.

	You have at most a few days to protest, or I will
	commit. Explicitly saying "looks good" appreciated.

Index: twisted/scripts/twistd.py
===================================================================
RCS file: /cvs/Twisted/twisted/scripts/twistd.py,v
retrieving revision 1.53
diff -u -u -r1.53 twistd.py
--- twisted/scripts/twistd.py	19 Jul 2003 21:36:49 -0000	1.53
+++ twisted/scripts/twistd.py	2 Aug 2003 14:46:28 -0000
@@ -282,11 +282,11 @@
             print 'daemons cannot log to stdout'
             os._exit(1)
         logFile = sys.stdout
-    elif config['nodaemon'] and not config['logfile']:
-        logFile = sys.stdout
     elif config['syslog']:
         from twisted.python import syslog
         syslog.startLogging(config['prefix'])
+    elif config['nodaemon'] and not config['logfile']:
+        logFile = sys.stdout
     else:
         logPath = os.path.abspath(config['logfile'] or 'twistd.log')
         logFile = logfile.LogFile(os.path.basename(logPath), os.path.dirname(logPath))
Index: twisted/python/log.py
===================================================================
RCS file: /cvs/Twisted/twisted/python/log.py,v
retrieving revision 1.50
diff -u -u -r1.50 log.py
--- twisted/python/log.py	17 Jul 2003 09:11:33 -0000	1.50
+++ twisted/python/log.py	2 Aug 2003 14:46:29 -0000
@@ -235,6 +235,12 @@
         self.write = f.write
         self.flush = f.flush
 
+    def prefix(self, eventDict):
+        y,mon,d,h,min, iigg,nnoo,rree,daylight = time.localtime(eventDict['time'])
+        return ("%0.4d/%0.2d/%0.2d %0.2d:%0.2d %s [%s] " %
+                (y, mon, d, h, min, time.tzname[daylight],
+                 eventDict['system']))
+
     def _emit(self, eventDict):
         edm = eventDict['message']
         if not edm:
@@ -244,10 +250,10 @@
                 text = eventDict['format'] % eventDict
         else:
             text = ' '.join(map(str, edm))
+        prefix = self.prefix(eventDict)
         y,mon,d,h,min, iigg,nnoo,rree,daylight = time.localtime(eventDict['time'])
-        self.write("%0.4d/%0.2d/%0.2d %0.2d:%0.2d %s [%s] %s\n" %
-                   (y, mon, d, h, min, time.tzname[daylight],
-                    eventDict['system'], text.replace("\n","\n\t")))
+        self.write("%s%s\n" %
+                   (self.prefix(eventDict), text.replace("\n","\n\t")))
         self.flush()                    # hoorj!
 
     def start(self):
@@ -306,8 +312,14 @@
     _oldshowwarning = None
 
 
-def startLogging(file, setStdout=1):
-    """Initialize logging to a specified file. If setStdout is true 
+def startLogging(file, *a, **kw):
+    """Initialize logging to a specified file.
+    """
+    flo = FileLogObserver(file)
+    startLoggingToObserver(flo, *a, **kw)
+
+def startLoggingToObserver(obs, setStdout=1):
+    """Initialize logging to a specified observer. If setStdout is true 
        (defaults to yes), also redirect sys.stdout and sys.stderr 
        to the specified file.
     """
@@ -318,8 +330,7 @@
     if defaultObserver:
         defaultObserver.stop()
         defaultObserver = None
-    flo = FileLogObserver(file)
-    flo.start()
+    obs.start()
     msg("Log opened.")
     if setStdout:
         sys.stdout = logfile
Index: twisted/python/syslog.py
===================================================================
RCS file: /cvs/Twisted/twisted/python/syslog.py,v
retrieving revision 1.1
diff -u -u -r1.1 syslog.py
--- twisted/python/syslog.py	23 Nov 2002 19:54:22 -0000	1.1
+++ twisted/python/syslog.py	2 Aug 2003 14:46:29 -0000
@@ -18,33 +18,25 @@
 import sys
 import log
 
-class SyslogLogger:
-
+class SyslogLogger(log.FileLogObserver):
     def __init__(self, prefix):
-        self.prefix = prefix
+        syslog.openlog(prefix)
+
+    def prefix(self, eventDict):
+        return ("[%s] " % eventDict['system'])
 
     def write(self, data):
         if not data or data=='\n':
             return
-        logger = log.logOwner.owner()
-        if logger:
-            data = logger.log(data)
         data = data.split('\n')
         if not data[-1]:
             data.pop()
         for line in data:
-            syslog.syslog("[%s] %s" % (self.prefix, line))
-
-    def writelines(self, lines):
-        for line in lines:
-            self.write(line)
-
-    def close(self):
-        pass
+            syslog.syslog(line)
 
     def flush(self):
         pass
 
 
-def startLogging(prefix='Twisted'):
-    sys.stdout = sys.stderr = log.logfile = SyslogLogger(prefix)
+def startLogging(prefix='Twisted', setStdout=1):
+    log.startLoggingToObserver(SyslogLogger(prefix), setStdout=setStdout)

-- 
:(){ :|:&};:



From itamar at itamarst.org  Sat Aug  2 09:07:15 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sat, 2 Aug 2003 11:07:15 -0400
Subject: [Twisted-Python] [PATCH] make syslog work
In-Reply-To: <20030802142750.GB25941@lapdog>
References: <20030802142750.GB25941@lapdog>
Message-ID: <20030802110715.0541319d.itamar@itamarst.org>

On Sat, 2 Aug 2003 17:27:50 +0300
Tommi Virtanen <tv at twistedmatrix.com> wrote:

> 	2) rewrite twisted.python.syslog to save it from bitrot,
> 	   I don't think it could have worked at all. To avoid
> 	   code duplication, refactor twisted.python.log a bit;
> 	   we don't want twistedy time stamps in syslog, but we
> 	   want rest of the nice things.

Given that we now have a better logging API, syslog should indeed be
changed, but slightly differently. Instead of making syslog look like a
file, why not use the logging API directly? That is to say, add a
SyslogObserver, and then
twistef.python.log.addObserver(SyslogObserver().notify). notify() will
be called with the low-level dict of the log messages, which would give
you a lot more flexibility.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
http://www.zoteca.com -- Python & Twisted consulting



From uwe at oss4u.com  Sat Aug  2 09:35:55 2003
From: uwe at oss4u.com (Uwe C. Schroeder)
Date: Sat, 2 Aug 2003 08:35:55 -0700
Subject: [Twisted-Python] Event Driven Programming 101 question
In-Reply-To: <200308020337.00916.sflist@ihonk.com>
References: <200308020337.00916.sflist@ihonk.com>
Message-ID: <200308020835.55670.uwe@oss4u.com>

On Saturday 02 August 2003 03:37 am, Steve Freitas wrote:
> Hi all,
>
> I've got a few questions about Deferreds. I understand the concept better,
> but I need a little help at the moment. It's apparent to me that a lot's
> going on behind the scenes between Deferreds and the Reactor, and that
> twisted.enterprise orchestrates things in a way I don't yet understand.
>
> I'm looking at this from the perspective of my little XML-RPC server. A
> client hits a XML-RPC function, and by the time that function returns its
> value, it needs all its Deferreds to have generated their results. That
> leads to this question:

You write a chain of results: for example
[ abstract code ]

remotecall(mydatabase, getresultset1).addCallback(result1OK)

def result1OK(result):
	remotecall(get result based on result, result).addCallback(allOK)

def allOK(result):
    this is guaranteed to have the result


>
> When is a Deferred guaranteed to have a result?
>
> One answer could be, "When its callback gets called." And that would be
> true. But what if the function that gets the Deferred needs the result
> before it can move on? It seems like it'll get the Deferred and then go on
> its merry way, whether the Deferred has a result or not. And that's
> confusing to me, because I'm left wondering what happens if my database
> takes a long time to respond:
>
> def xmlrpc_foo(self):
> 	result = dbpool.runQuery("select * from gigantic_table") # adbapi
> 	return result
>
> In this case, what's it gonna be? A Deferred that's evaluated as None
> because Postgres is still churning, or is Twisted only going to let the
> code continue once the Deferred has a result?
>
> Sorry if it seems I'm not making sense... Event-driven programming is new
> to me, but I'm a motivated learner. :-) (And if anybody knows of a good
> general guide to this paradigm, I'm all ears.)
>
> Thanks for your help!
>
> Steve
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-- 
	UC

--
Open Source Solutions 4U, LLC	2570 Fleetwood Drive
Phone:  +1 650 872 2425		San Bruno, CA 94066
Cell:   +1 650 302 2405		United States
Fax:    +1 650 872 2417




From glyph at twistedmatrix.com  Sat Aug  2 11:09:33 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 2 Aug 2003 12:09:33 -0500
Subject: [Twisted-Python] Remote PB calls in ApplicationService.stopService
In-Reply-To: <20030802105527.19416.qmail@green.zadka.com>
Message-ID: <1694803C-C50C-11D7-8F2D-000393C9700E@twistedmatrix.com>

On Saturday, August 2, 2003, at 05:55 AM, Moshe Zadka wrote:

> BTW, currently that feature is not in the new Application code I'm 
> working
> on. I could add it, but when we discussed it I didn't know of anybody
> using that feature. It seems a bit too dangerous to allow a buggy 
> remote
> side to delay our shutdown by a long amount of time [depending on PB
> timeouts]. I humbly suggest that an architecture which depends on being
> able to send "one last message" is probably flawed.

There are a couple of different use-cases here that need to be 
separated; for example, shutting down an active thread pool requires 
waiting, otherwise you will deadlock - and yes, this is due to the fact 
that OS threads are a basically flawed concept, but we've been over 
that one before :).

Sometimes it's also useful to be able to send out a descriptive message 
before dying, like, "The service is going down!  Please hurry up."  I 
admit that the deferred-from-stopService is probably not the best way 
to handle this, though; there should be a different canonical way to 
shut down a Twisted server that allows those sorts of messages to be 
sent.

However, as long as the deferred in the latter case always comes with 
the timeout, I think the use cases are about equivalent.  Thoughts?




From tv at twistedmatrix.com  Sat Aug  2 11:03:23 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 2 Aug 2003 20:03:23 +0300
Subject: [Twisted-Python] [PATCH] make syslog work
In-Reply-To: <20030802142750.GB25941@lapdog>
References: <20030802142750.GB25941@lapdog>
Message-ID: <20030802170323.GB27956@lapdog>

On Sat, Aug 02, 2003 at 05:27:50PM +0300, Tommi Virtanen wrote:
> 	Hi. Here's a patch that does a few things to twistd and
> 	twisted.python.syslog.

	This is now issue163.

-- 
:(){ :|:&};:



From tv at twistedmatrix.com  Sat Aug  2 10:58:20 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 2 Aug 2003 19:58:20 +0300
Subject: [Twisted-Python] [PATCH] SMTP cleanup, do not hide error messages
In-Reply-To: <20030802142216.GA25941@lapdog>
References: <20030802142216.GA25941@lapdog>
Message-ID: <20030802165820.GA27956@lapdog>

On Sat, Aug 02, 2003 at 05:22:16PM +0300, Tommi Virtanen wrote:
> 	Hi. Here's a patch that does two things to twisted.protocol.smtp:

	This is now issue162.

-- 
:(){ :|:&};:



From glyph at twistedmatrix.com  Sat Aug  2 18:16:58 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 2 Aug 2003 19:16:58 -0500
Subject: [Twisted-Python] [PATCH] SMTP cleanup, do not hide error messages
In-Reply-To: <20030802165820.GA27956@lapdog>
Message-ID: <CC2B7633-C547-11D7-8F2D-000393C9700E@twistedmatrix.com>

On Saturday, August 2, 2003, at 11:58 AM, Tommi Virtanen wrote:

> 	This is now issue162.

Thanks for putting these in the bugtracker, Tommi.




From glyph at twistedmatrix.com  Sat Aug  2 18:27:57 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 2 Aug 2003 19:27:57 -0500
Subject: [Twisted-Python] Roundup Fever
Message-ID: <54F9F1DC-C549-11D7-8F2D-000393C9700E@twistedmatrix.com>

Dear Twisted Team (and assorted onlookers),

I am trying to create a semblance of a project plan by assembling a 
sort of paper-mache out of the things that have been entered in the 
bugtracker.

If you have an account on the bugtracker, you may find that you have 
issues assigned to you.  Random issues.  Issues that you have no idea 
how to resolve or even understand.  Don't worry, I don't seriously 
expect you to take care of these yourself - however, we have a lot of 
issues in the tracker that nobody is responsible for.  I wish to 
distribute the responsibility of distributing responsibility by 
creating a game of hot potato with unwanted issues.

In other words, if you find yourself assigned an issue that you are 
clueless about, please find someone who has the requisite knowledge 
*and enough free time* to take care of the problem, then assign that 
issue to that person.

Although no bonus points will be given, feel free to use visual aids or 
props in order to convince your favorite Twisted team member to 
volunteer.  I am told that broken beer bottles, two-by-fours with nails 
in the end, and tire irons are popular with the kids these days.

In case you were wondering about *my* free time, I have already bitten 
off as many issues as I can possibly chew, and then some.  Also, I have 
secured for myself one of each of the recommended visual aids: No 
further convincing is necessary.

Ever grateful for your continued patronage,

	-glyph




From micahlists at comcast.net  Sun Aug  3 00:38:06 2003
From: micahlists at comcast.net (Micah Yoder)
Date: Sat, 2 Aug 2003 23:38:06 -0700
Subject: [Twisted-Python] Getting the hang of twisted.web
Message-ID: <200308022338.06935.micahlists@comcast.net>

Ok, I have the following in web.py:

***
from twisted.web import resource

class Simple(resource.Resource):
    isLeaf = True
    def render(self, request):
        return "<html>Hello, world!</html>"

class Hello(resource.Resource):

    def __init__(self):
      resource.Resource.__init__(self)
      self.putChild('simple', Simple())

    def getChild(self, name, request):
        if name == '':
            return self
        return Resource.getChild(
            self, name, request)

    def render(self, request):
      s = request.getSession()
      if not hasattr(s, 'var'):
        s.var = 1
      else:
        s.var = s.var * 2
      return """<html>
      Hello, world! I am located at %r and am at %d. My args are %s. Site %s.
    </html>"""               % (request.prepath, s.var, repr(request.args), 
repr(request.site))

***

Then I:

$ mktap web --class=web.Hello
$ twistd -f web.tap

Seems to work fine.  I can go to http://localhost:8080/ to get the Hello() 
class and http://localhost:8080/simple to get the Simple() class.

Questions:

1. Is there anything I'm doing obviously wrong or a "non-Twisted" way, like 
with the session variable or the child stuff?

2. What about persistant HTTP sessions?  I thought one of the points of this 
mktap stuff was to allow persistance in protocols.  I do:
$ killall twistd
$ twistd -f web-shutdown.tap
and go to the index page again and the counter gets re-started at 1.  Can't 
they be made to persist?

3. Finally, some advice on how to structure my "real" project would be 
appreciated.  I have a program that will store and index a large amount of 
data (several megabytes), and intend to have resources that search and 
display it.  The original importing of the data takes several seconds now, 
and will take probably a minute or more by the time I'm done.  The data is 
being stored in a Python class, with methods to set it up and search it, 
along with direct public instance-variable access to some structures.

The question is, where should this class object be stored in a .tap-ified 
program?  Right now I have the class instance as a global variable in the 
module that my related resource objects are in, but that doesn't seem ideal.  
I thought about storing it in the Site() object, but there doesn't seem to be 
a way to access the Site object from a resource request.  request.site only 
returns None ... is ths a bug?

(Yes, I've been doing this application so far with just a reactor and a Site() 
object.  But it seems prudent to try to .tap-ify it.)

Thanks!
Micah

-- 
Yoder Internet Development
Honest and Affordable Web Development and Linux consulting
http://yoderdev.com





From screwtape at froup.com  Sun Aug  3 07:05:48 2003
From: screwtape at froup.com (Tim Allen)
Date: Sun, 3 Aug 2003 23:05:48 +1000
Subject: [Twisted-Python] Surprises in twisted.web.woven
Message-ID: <3372A4FF-C5B3-11D7-B0D7-003065D61A3E@froup.com>

I had a little play with Woven tonight, and I'm pleased to report that 
I'm (slowly) getting my head around it quite satisfyingly. However, I 
did come across some things which surprised me - I'm not going to call 
them bugs, because I don't understand Woven well enough.

Firstly, I'm rendering HTML, so my HTML template file starts off with 
an HTML doctype. Woven appears to eat this doctype, which is rather a 
shame - including the proper doctype makes Internet Explorer 6 behave 
much more like Mozilla, which in turn makes writing webpages much less 
stressful. I do wind up with the standard XML header at the top of the 
output, but as I'm not trying to output XML, I'm afraid this might 
confuse something.

Secondly, I was surprised by the behaviour of view templates. See the 
sample rpy code below:

	from twisted.web.woven import page, view

	class TestContent(view.View):
	    template = """<ul model="sampleList" view="List">
	            		<li pattern="listItem" model="." view="Text"/>
			            <li pattern="emptyList"><i>empty</i></li>
	    		      </ul>"""

	class TestPage(page.Page):
     	template = """<html><body>
                 		<h1 model="title" view="Text"/>
						<div view="content"/>
	            	  </body></html>"""

	    def wvfactory_content(self, request, node, model): return 
TestContent(model)

	    def wmfactory_title(self, request): return "Test page"

	    def wmfactory_sampleList(self, request): return ["Hello", "world!"]

	resource = TestPage()

What I expected was a list that looked like:

	* Hello
	* world!

What I got was a list that looked like:

	* <__builtin__.TestPage instance at 0x554f08>
     * empty

If I wrap the <ul> element in the template in a <div> (or anything 
else), then the output is correct - but I get the dummy <div> in the 
output.

...it seems that view.View ignores model= and view= attributes on 
top-level elements in templates, and I have no idea why.

Thirdly, looking again at the above sample code - the TestPage template 
contains a reference to a model named 'title', and Woven looks for the 
model 'title' in the TestPage instance. Fair enough. The TestContent 
template contains a reference to a model named 'sampleList', and Woven 
looks for the model 'sampleList'... not in the TestContent instance as 
I would expect, but in the TestPage instance again.

Finally, if I have a template that looks like this:

	<p>Have a look at
	<a href="cat1.png">these</a>
	<a href="cat2.png">three</a>
	<a href="cat3.png">cats</a>.</p>

then the output HTML looks like:

	<p>Have a look at <a href="cat1.png">these</a><a
	href="cat2.png">three</a><a href="cat3.png">cats</a>.</p>

...spaces aren't preserved. I expect an XML processor is allowed to 
collapse whitespace, but not remove it entirely.




From mesozoic at polynode.com  Sun Aug  3 09:37:27 2003
From: mesozoic at polynode.com (Alex Levy)
Date: Sun, 3 Aug 2003 15:37:27 +0000
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <3372A4FF-C5B3-11D7-B0D7-003065D61A3E@froup.com>
References: <3372A4FF-C5B3-11D7-B0D7-003065D61A3E@froup.com>
Message-ID: <20030803153727.GS282@perpetual.moxn.net>

On Sun, Aug 03, 2003 at 11:05:48PM +1000, Tim Allen wrote:
> I had a little play with Woven tonight, and I'm pleased to report that 
> I'm (slowly) getting my head around it quite satisfyingly. However, I 
> did come across some things which surprised me - I'm not going to call 
> them bugs, because I don't understand Woven well enough.

Don't you know anything about software development? These are FEATURES :)

You've hit a problem that I encountered as well; the root element in a Woven
template doesn't behave the same way as its child elements. What you want is
this:

  class TestContent(view.View):
    template = """
    <div><ul model="sampleList" view="List">...</ul></div>
    """

I believe this is one of those "just accept it" situations. Fortunately,
wrapping your work in <div></div>'s isn't that bad; they don't affect layout
(unless your CSS puts padding on every div, which is nuts), and HTML
pretty-printing has been added to CVS in time for the next release.

O[Bn to your models question. Views must be given a model to operate on; they
do not (as far as I know) intrinsically contain models of their own. When
your <div view="content"/> element is given no explicit model in the
template, it is given the entire Page as its model. (That means the 'model'
object being passed to wvfactory_content is actually the Page instance.)
This works because it looks for the sampleList submodel on whatever model
it's been given.

Unless you have a good reason for passing the entire Page model to your
views (and you might), another way to do this is:

  class TestContent(view.View):
    template = """
    <div><ul model="." view="List">...</ul></div>
    """
    
  class TestPage(page.Page):
    template = """
    <html>...<div model="sampleList" view="content"/>...</html>
    """

> Finally, if I have a template that looks like this:
> 
>     <p>Have a look at
>     <a href="cat1.png">these</a>
>     <a href="cat2.png">three</a>
>     <a href="cat3.png">cats</a>.</p>
> 
> then the output HTML looks like:
> 
>     <p>Have a look at <a href="cat1.png">these</a><a
>     href="cat2.png">three</a><a href="cat3.png">cats</a>.</p>

This is another issue that I've wrangled with for some time. Feel free to
make a lot of noise and hope somebody fixes it; I believe the problem lies
in the XML parser itself. As Wayne so aptly put it, "We fear change."

The two quick fixes I've employed to get around this until a better solution
presents itself are either &nbsp; entities after every anchor, or using CSS
to add spacing. [The second option is, in my opinion, much cleaner.]

  in my template:
  <a class="navbar" href="1">Home</a>
  <a class="navbar" href="2">Stuff</a>
  ...
  
  in my CSS:
  a.navbar { padding: 0px 5px 0px 5px; }

I'm not entirely happy with this, but it makes my pages look nice until any
issues with the XML parser get hammered out.

As far as chomping off docstrings, that's something you might want to add to
the tracker <http://www.twistedmatrix.com/bugs>. I see it happening on my
site as well, and Woven probably shouldn't be doing that.

-- 
Alex Levy
WWW: http://mesozoic.geecs.org
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_



From edmundd at eSentire.com  Sun Aug  3 12:12:20 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sun, 3 Aug 2003 14:12:20 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
Message-ID: <Pine.BSO.4.44.0308031404030.7592-100000@cyclops4.esentire.com>

Hi all!

I am new to the list, so please excuse me if this has been dealt with
already. I did try to search for an answer in the archives and was unable
to find an answer.

I am trying to use PB with SSL. I have managed to get it to work (or, at
least it looks like it is working). I will get some patches submitted
later this week if desired. The problem I ran across was that I had to
force PB to change its logic as to who talks first.

Normally: client connects to PB server, PB server initiates communication
back to client over TCP connection

However, when using SSL, if PB initiates communication, then the whole
process essentially hangs. The SSL handshaking between client and server
doe snot occur. If I hack the code so that PB expects the client to
initiate the communication, and hack the client to start first (basically
send a "hello"), then it works.

It seems the SSL connection does not perform the handshaking/negotiation
until the client tries to send a byte. Is this correct? Is this the way it
is suppose to work? Is there a way to force the SSL handshaking to occur
immediately?  Note: If I use OpenSSL's s_client or s_server, I can get the
communication to go. That is, the handshaking is independent of who starts
talking first.

Thanks!
Ed






From itamar at itamarst.org  Sun Aug  3 12:18:55 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 3 Aug 2003 14:18:55 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308031404030.7592-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308031404030.7592-100000@cyclops4.esentire.com>
Message-ID: <20030803141855.02f679b2.itamar@itamarst.org>

On Sun, 3 Aug 2003 14:12:20 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> It seems the SSL connection does not perform the
> handshaking/negotiation until the client tries to send a byte. Is this
> correct? Is this the way it is suppose to work? Is there a way to
> force the SSL handshaking to occur immediately?  Note: If I use
> OpenSSL's s_client or s_server, I can get the communication to go.
> That is, the handshaking is independent of who starts talking first.

There is a bug in current version, which is fixed in CVS. Even better,
1.0.7 has new connection API which is much cleaner and makes SSL support
more like other protocols (i.e. you use reactor.connectSSL), and also PB
in 1.0.7 will let you use new cred, for those of you who want to do
that.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
http://www.zoteca.com -- Python & Twisted consulting



From dp at twistedmatrix.com  Sun Aug  3 14:20:57 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Sun, 3 Aug 2003 13:20:57 -0700
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <20030803153727.GS282@perpetual.moxn.net>
References: <3372A4FF-C5B3-11D7-B0D7-003065D61A3E@froup.com> <20030803153727.GS282@perpetual.moxn.net>
Message-ID: <FDF96B60-C5EF-11D7-AD2C-000A95864FC4@twistedmatrix.com>

Alex channelled me; he wrote the same response I would have. The 
problem with directives not being handled on the outermost node 
returned from a widget I consider a bug; it might be easy to fix (now; 
it wasn't easy the way woven was structured before), if I find some 
time to look into it.

On Sunday, August 3, 2003, at 8:37 AM, Alex Levy wrote:

> As far as chomping off docstrings, that's something you might want to 
> add to
> the tracker <http://www.twistedmatrix.com/bugs>. I see it happening on 
> my
> site as well, and Woven probably shouldn't be doing that.

I think you mean doctype, and this is a microdom bug, not a woven bug.

dp




From lists at webcrunchers.com  Sun Aug  3 17:01:30 2003
From: lists at webcrunchers.com (John D.)
Date: Sun, 3 Aug 2003 16:01:30 -0700
Subject: [Twisted-Python] Mac OS-9 support?   Does it exist?
Message-ID: <v03110700bb53434790e6@[192.168.0.2]>

I just joined the mailing list.   I would have first read the archive if It was available,  thus the need to ask this to the list.

I want to use the latest Twisted 1.0.6 with my latest Python 2.3 on my Mac OS-9.   I tried to install it on the Mac ver of python,  but I'm getting all kinds of error when I drag the "setup.py" into the Mac python IDE.

I looked at the requirement of Twisted,  and it mentions we also need Encryption,  and some other utilities,  but there was nothing on the web site that says any of this works on Mac OS-9.

I looked at the source code of the "setup.py",  and I want to call your attention to this line in that module...

# Apple distributes a nasty version of Python 2.2 w/ all release builds of
# OS X 10.2 and OS X Server 10.2
BROKEN_CONFIG = '2.2 (#1, 07/14/02, 23:25:09) \n[GCC Apple cpp-precomp 6.14]'
if sys.platform == 'darwin' and sys.version == BROKEN_CONFIG:
    # change this to 1 if you have some need to compile
    # with -flat_namespace as opposed to -bundle_loader
    FLAT_NAMESPACE = 0
    BROKEN_ARCH = '-arch i386'
    BROKEN_NAMESPACE = '-flat_namespace -undefined_suppress'
    import distutils.sysconfig
    distutils.sysconfig.get_config_vars()
    x = distutils.sysconfig._config_vars['LDSHARED']
    y = x.replace(BROKEN_ARCH, '')
    if not FLAT_NAMESPACE:
        e = os.path.realpath(sys.executable)
        y = y.replace(BROKEN_NAMESPACE, '-bundle_loader ' + e)
    if y != x:
        print "Fixing some of Apple's compiler flag mistakes..."
        distutils.sysconfig._config_vars['LDSHARED'] = y

     <---- rest deleted ---->

As you can see,  it appears to only support Mac OS-9 and not OS-10,  is that true?

We have a host of applications that already use Twisted,  and we want to port these applications over to the Mac OS-9,  because there is still a wide base of users (at least in this field).

Does anyone know if any effort is underway to support Mac OS-9 if the current one doesn't?

John





From glyph at twistedmatrix.com  Sun Aug  3 21:51:38 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 3 Aug 2003 22:51:38 -0500
Subject: [Twisted-Python] Mac OS-9 support?   Does it exist?
In-Reply-To: <v03110700bb53434790e6@[192.168.0.2]>
Message-ID: <F34A2876-C62E-11D7-8F2D-000393C9700E@twistedmatrix.com>

On Sunday, August 3, 2003, at 06:01 PM, John D. wrote:

> As you can see,  it appears to only support Mac OS-9 and not OS-10,  
> is that true?

I think you mean "OS-10 and not OS-9".  That would be correct.

> Does anyone know if any effort is underway to support Mac OS-9 if the 
> current one doesn't?

 From what I know of Mac OS 9, it does not support a host of basic 
features that Twisted needs in order to function.  It may be possible 
to port, and I would love to increase Twisted's portability if you are 
interested in contributing patches to that effect.

However, I don't believe any core Twisted developers have access to or 
interest in Mac OS 9.




From itamar at itamarst.org  Sun Aug  3 22:01:52 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 4 Aug 2003 00:01:52 -0400
Subject: [Twisted-Python] Mac OS-9 support?   Does it exist?
In-Reply-To: <F34A2876-C62E-11D7-8F2D-000393C9700E@twistedmatrix.com>
References: <v03110700bb53434790e6@[192.168.0.2]>
	<F34A2876-C62E-11D7-8F2D-000393C9700E@twistedmatrix.com>
Message-ID: <20030804000152.1483d0c0.itamar@itamarst.org>

On Sun, 3 Aug 2003 22:51:38 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> However, I don't believe any core Twisted developers have access to or
> 
> interest in Mac OS 9.

Well, I'd do it for money (assuming Bob or Donovan say it's possible) :)

-- 
Itamar Shtull-Trauring    http://itamarst.org/
http://www.zoteca.com -- Python & Twisted consulting



From bob at redivi.com  Mon Aug  4 01:02:49 2003
From: bob at redivi.com (Bob Ippolito)
Date: Mon, 4 Aug 2003 03:02:49 -0400
Subject: [Twisted-Python] Mac OS-9 support?   Does it exist?
In-Reply-To: <20030804000152.1483d0c0.itamar@itamarst.org>
Message-ID: <A86BBC4A-C649-11D7-BBEC-000A95686CD8@redivi.com>

On Monday, Aug 4, 2003, at 00:01 America/New_York, Itamar 
Shtull-Trauring wrote:

> On Sun, 3 Aug 2003 22:51:38 -0500
> Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:
>
>> However, I don't believe any core Twisted developers have access to or
>>
>> interest in Mac OS 9.
>
> Well, I'd do it for money (assuming Bob or Donovan say it's possible) 
> :)

It's possible.  I have access to OS9, but I'm not interested *IN THE 
LEAST* in ever using OS9.

-bob




From nico at tekNico.net  Mon Aug  4 03:06:57 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Mon, 04 Aug 2003 11:06:57 +0200
Subject: [Twisted-Python] Goin' with the Flow
Message-ID: <3F2E2231.8030708@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

A couple of comments about Flow, as seen in 1.0.7alpha3.


Example 16 (next to last) in the howto does not work, looks like flow.py
misses the line:

from twisted.flow.threads import *

(Added to the tracker as bug #168.)


Also, the howto mentions ThreadedIterator, that is nowhere to be found.

(Added to the tracker as bug #169.)


Lastly, if Twisted makes one's head spin, Flow makes the whole body enter
the Sufi dances. :^)

- --
"I'm a Python fanatic these days, I find that I'm able to program about
three times faster than I could in Java, and I was able to program
in Java about three times faster than I could in C."  Andy Hertzfeld

Nicola Larosa - nico at tekNico.net


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/LiIvXv0hgDImBm4RAvdNAJ4ii2xebUI128IlOhqDWAJG+lcurACfY3Th
PUD66uYkwXQ0T9sK2tFqGWg=
=B5+C
-----END PGP SIGNATURE-----





From screwtape at froup.com  Mon Aug  4 03:47:13 2003
From: screwtape at froup.com (Tim Allen)
Date: Mon, 4 Aug 2003 19:47:13 +1000
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <20030803153727.GS282@perpetual.moxn.net>
Message-ID: <A00950EC-C660-11D7-B0D7-003065D61A3E@froup.com>

On Monday, Aug 4, 2003, at 01:37 Australia/Sydney, Alex Levy wrote:

> On Sun, Aug 03, 2003 at 11:05:48PM +1000, Tim Allen wrote:
>> I had a little play with Woven tonight, and I'm pleased to report that
>> I'm (slowly) getting my head around it quite satisfyingly. However, I
>> did come across some things which surprised me - I'm not going to call
>> them bugs, because I don't understand Woven well enough.
>
> Don't you know anything about software development? These are FEATURES 
> :)

Oh, right, my bad. :)

> You've hit a problem that I encountered as well; the root element in a 
> Woven
> template doesn't behave the same way as its child elements. What you 
> want is
> this:
>
>   class TestContent(view.View):
>     template = """
>     <div><ul model="sampleList" view="List">...</ul></div>
>     """
>
> I believe this is one of those "just accept it" situations. 
> Fortunately,
> wrapping your work in <div></div>'s isn't that bad; they don't affect 
> layout
> (unless your CSS puts padding on every div, which is nuts), and HTML
> pretty-printing has been added to CVS in time for the next release.

Donovan Preston writes that he considers it a bug, I have faith he'll 
get around to it eventually, that's good enough for me. (Last time I 
wrote, I asked for HTML pretty-printing, and lo and behold, here it is. 
:)

> O[Bn to your models question. Views must be given a model to operate 
> on; they
> do not (as far as I know) intrinsically contain models of their own.

Ahh, that makes sense.

I was being misled by the special case of Page - Page inherits from 
View, but uses itself as the default model. Apparently other things 
that inherit from View have different behaviour.

<snip>

>> Finally, if I have a template that looks like this:
>>
>>     <p>Have a look at
>>     <a href="cat1.png">these</a>
>>     <a href="cat2.png">three</a>
>>     <a href="cat3.png">cats</a>.</p>
>>
>> then the output HTML looks like:
>>
>>     <p>Have a look at <a href="cat1.png">these</a><a
>>     href="cat2.png">three</a><a href="cat3.png">cats</a>.</p>
>
> This is another issue that I've wrangled with for some time. Feel free 
> to
> make a lot of noise and hope somebody fixes it; I believe the problem 
> lies
> in the XML parser itself. As Wayne so aptly put it, "We fear change."

Hmm. How sad.

I guess I'll have a look at the XML parser, if I have time.

> The two quick fixes I've employed to get around this until a better 
> solution
> presents itself are either &nbsp; entities after every anchor, or 
> using CSS
> to add spacing. [The second option is, in my opinion, much cleaner.]

Cleaner, yes, but not much. :(

Also, I'm imagining this same problem could crop up among hetereogenous 
collections of tags, in which case CSS isn't quite as useful.

> I'm not entirely happy with this, but it makes my pages look nice 
> until any
> issues with the XML parser get hammered out.

As an interim step, sure.

> As far as chomping off docstrings, that's something you might want to 
> add to
> the tracker <http://www.twistedmatrix.com/bugs>. I see it happening on 
> my
> site as well, and Woven probably shouldn't be doing that.

Well, I was going to try fixing this little issue so I spent a while 
tracing code and learning the structure of view.View and so forth, 
until I discovered the following snippet in 
microdom.Document.writexml():

         if self.doctype:
             stream.write("<!DOCTYPE "+self.doctype+">" + newl)

And lo and behold, ever since I discovered that, it's been working fine.

Maybe I should subscribe to the CVS commits list as well before I start 
poking around in Twisted again. :)




From screwtape at froup.com  Mon Aug  4 06:13:26 2003
From: screwtape at froup.com (Tim Allen)
Date: Mon, 4 Aug 2003 22:13:26 +1000
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <20030803153727.GS282@perpetual.moxn.net>
Message-ID: <0D06F9E5-C675-11D7-B0D7-003065D61A3E@froup.com>

On Monday, Aug 4, 2003, at 01:37 Australia/Sydney, Alex Levy wrote:
> On Sun, Aug 03, 2003 at 11:05:48PM +1000, Tim Allen wrote:
>> Finally, if I have a template that looks like this:
>>
>>     <p>Have a look at
>>     <a href="cat1.png">these</a>
>>     <a href="cat2.png">three</a>
>>     <a href="cat3.png">cats</a>.</p>
>>
>> then the output HTML looks like:
>>
>>     <p>Have a look at <a href="cat1.png">these</a><a
>>     href="cat2.png">three</a><a href="cat3.png">cats</a>.</p>
>
> This is another issue that I've wrangled with for some time. Feel free 
> to
> make a lot of noise and hope somebody fixes it; I believe the problem 
> lies
> in the XML parser itself. As Wayne so aptly put it, "We fear change."

As it turns out, I suspect this is false.

twisted.web.microdom.MicroDOMParser.shouldPreserveSpace() currently 
looks like:

     def shouldPreserveSpace(self):
         for edx in xrange(len(self.elementstack)):
             el = self.elementstack[-edx]
             if el.tagName == 'pre' or el.getAttribute("xml:space", '') 
== 'preserve':
                 return 1
         return 0

I dare say that a simple modification of this method would be enough, 
without delving into the depths of the XML parser (which doesn't 
discard pure-whitespace text elements at all).

Off the top of my head, I can think of three whitespace-handling modes:

  * Preserve all whitespace (as used in the HTML <pre> tag and elements 
with xml:space='preserve'.)
  * Collapse redundant whitespace (if not string.strip(): return ' ') 
which most closely matches how HTML user-agents handle whitespace.
  * Strip whitespace (run .strip() over all text nodes - I believe this 
most closely matches how XML processors handle whitespace).

Is there any reason why white-space preserving should not always be on?




From fog at initd.org  Mon Aug  4 08:26:44 2003
From: fog at initd.org (Federico Di Gregorio)
Date: 04 Aug 2003 16:26:44 +0200
Subject: [Twisted-Python] ccc camp and holiday
Message-ID: <1060007204.1233.42.camel@localhost>

i will be at the ccc camp and after that in amsterdam and paris. i don't
know how much it is common on this list but on others vacancies
announces targeted at meeting to consume alchoolic substances and
exchanging gpg keys are welcome. if you don't like, just don't answer,
else mail me privately :)

federico

-- 
Federico Di Gregorio
Debian GNU/Linux Developer                                fog at debian.org
INIT.D Developer                                           fog at initd.org
             Quis custodiet ipsos custodes? -- Juvenal, Satires, VI, 347
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa parte del messaggio è firmata
URL: </pipermail/twisted-python/attachments/20030804/b7caf6de/attachment.sig>

From dizzyd at jabber.org  Mon Aug  4 08:32:44 2003
From: dizzyd at jabber.org (Dave Smith)
Date: Mon, 4 Aug 2003 08:32:44 -0600
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <0D06F9E5-C675-11D7-B0D7-003065D61A3E@froup.com>
Message-ID: <82A3328F-C688-11D7-84FC-00039386381C@jabber.org>

On Monday, Aug 4, 2003, at 06:13 America/Denver, Tim Allen wrote:

> Is there any reason why white-space preserving should not always be on?

I concur with you -- it should always be on. Of note, so does the XML 
spec, section 2.10:

http://www.w3.org/TR/REC-xml#sec-white-space

Hope that helps. ;)

Diz




From Rudy.Schockaert at pandora.be  Mon Aug  4 09:07:02 2003
From: Rudy.Schockaert at pandora.be (Rudy Schockaert)
Date: Mon, 04 Aug 2003 17:07:02 +0200
Subject: [Twisted-Python] Help needed with SMTP service
Message-ID: <3F2E7696.9020106@pandora.be>

Hi,

The more I try to grasp how the twisted.mail package works, the more I 
get confused. I sure must learn a lot more about the internals of twisted.

What I want to do looks very simple, but somehow I can't find the 
correct the way.
I want to create a service that accepts messages, and for each message 
checks if the recipients exist in a dict. If the recipient exists, the 
message should be attached to a new message with 
table[originalRecipient] as the new recipient.

Can someone point me in the right direction? I don't ask for a complete 
solution, just for some guidelines.

TIA,

Rudy




From khowe at perfnet.ca  Mon Aug  4 09:48:16 2003
From: khowe at perfnet.ca (Kevin Howe)
Date: Mon, 4 Aug 2003 11:48:16 -0400
Subject: [Twisted-Python] Help needed with SMTP service
Message-ID: <000701c35a9f$d5a81c10$1a00000a@KHOWE>

> Hi,
>
> The more I try to grasp how the twisted.mail package works, the more I
> get confused. I sure must learn a lot more about the internals of twisted.
>
> What I want to do looks very simple, but somehow I can't find the
> correct the way.
> I want to create a service that accepts messages, and for each message
> checks if the recipients exist in a dict. If the recipient exists, the
> message should be attached to a new message with
> table[originalRecipient] as the new recipient.
>
> Can someone point me in the right direction? I don't ask for a complete
> solution, just for some guidelines.
>
> TIA,
>
> Rudy

This might help, it's an example of a very basic SMTP server:

http://twistedmatrix.com/pipermail/twisted-python/2003-June/004618.html






From glyph at twistedmatrix.com  Mon Aug  4 11:28:44 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 4 Aug 2003 12:28:44 -0500
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <0D06F9E5-C675-11D7-B0D7-003065D61A3E@froup.com>
Message-ID: <19524A43-C6A1-11D7-8F2D-000393C9700E@twistedmatrix.com>

On Monday, August 4, 2003, at 07:13 AM, Tim Allen wrote:

> Is there any reason why white-space preserving should not always be on?

Believe it or not, it's a bottleneck.

In order to preserve whitespace, you have to create a bunch of extra 
Node and str objects, which consume a not-inconsiderable set of 
resources for, let's say, a directory full of reasonably sized Woven 
templates.

This cost is exacerbated by the fact that woven copies and inspects the 
entire tree of DOM objects on every page render.

Last I profiled this was many months ago, however; I was seeing serious 
performance problems with Woven which have since been optimized in 
other ways.  I'd be interested in hearing your results if you try it 
otherwise.




From Martin.Moellenbeck at t-online.de  Mon Aug  4 11:49:25 2003
From: Martin.Moellenbeck at t-online.de (=?iso-8859-1?Q?Martin_M=F6llenbeck?=)
Date: Mon, 4 Aug 2003 19:49:25 +0200
Subject: [Twisted-Python] t.w.w.view.View override getTemplate
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAARFFe7Wq86Uqt5quoDxSVd8KAAAAQAAAAsRxHAQ0AnUSUbWyFqc962QEAAAAA@t-online.de>

Hi,

I want to generate the template by myself and override the method
View.getTemplate,
but it seen not work.

Can Anybody help me?

Martin Möllenbeck




From Martin.Moellenbeck at t-online.de  Mon Aug  4 12:04:36 2003
From: Martin.Moellenbeck at t-online.de (=?iso-8859-1?Q?Martin_M=F6llenbeck?=)
Date: Mon, 4 Aug 2003 20:04:36 +0200
Subject: AW: [Twisted-Python] t.w.w.view.View override getTemplate
In-Reply-To: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAARFFe7Wq86Uqt5quoDxSVd8KAAAAQAAAAsRxHAQ0AnUSUbWyFqc962QEAAAAA@t-online.de>
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAARFFe7Wq86Uqt5quoDxSVd8KAAAAQAAAAb9AT0a7950ybtStkMvn5RAEAAAAA@t-online.de>

Hi,

it will work if i override the lookupTemplate method.

Martin

> -----Ursprüngliche Nachricht-----
> Von: twisted-python-admin at twistedmatrix.com 
> [mailto:twisted-python-admin at twistedmatrix.com] Im Auftrag 
> von Martin Möllenbeck
> Gesendet: Montag, 4. August 2003 19:49
> An: TwistedMatrix
> Betreff: [Twisted-Python] t.w.w.view.View override getTemplate
> 
> 
> Hi,
> 
> I want to generate the template by myself and override the 
> method View.getTemplate, but it seen not work.
> 
> Can Anybody help me?
> 
> Martin Möllenbeck
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com 
> http://twistedmatrix.com/cgi-> bin/mailman/listinfo/twisted-python
> 




From pje at telecommunity.com  Mon Aug  4 12:14:51 2003
From: pje at telecommunity.com (Phillip J. Eby)
Date: Mon, 04 Aug 2003 14:14:51 -0400
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <19524A43-C6A1-11D7-8F2D-000393C9700E@twistedmatrix.com>
References: <0D06F9E5-C675-11D7-B0D7-003065D61A3E@froup.com>
Message-ID: <5.1.1.6.0.20030804141006.0314ba20@telecommunity.com>

At 12:28 PM 8/4/03 -0500, Glyph Lefkowitz wrote:

>On Monday, August 4, 2003, at 07:13 AM, Tim Allen wrote:
>
>>Is there any reason why white-space preserving should not always be on?
>
>Believe it or not, it's a bottleneck.
>
>In order to preserve whitespace, you have to create a bunch of extra Node 
>and str objects, which consume a not-inconsiderable set of resources for, 
>let's say, a directory full of reasonably sized Woven templates.
>
>This cost is exacerbated by the fact that woven copies and inspects the 
>entire tree of DOM objects on every page render.

You might be interested in the technique I use for 
peak.web.templates.  First, my DOMlet objects aren't even as sophisticated 
as Twisted's microdom; they are just objects that cwrite unicode 
streams.  Second, each node has a 'staticText' attribute that can be either 
a unicode value or None.  So, parent nodes can glom together adjacent nodes 
with staticText.  Then, if that node only has static content, it defines 
its own staticText attribute, so it can be glommed together with its peers, 
by its parent.  The net result is that a template, as a whole, consists of 
dynamic nodes occasionally interrupted by a block of static text.




From bob at redivi.com  Mon Aug  4 12:41:16 2003
From: bob at redivi.com (Bob Ippolito)
Date: Mon, 4 Aug 2003 14:41:16 -0400
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <5.1.1.6.0.20030804141006.0314ba20@telecommunity.com>
Message-ID: <3B6CD87A-C6AB-11D7-8933-000A95686CD8@redivi.com>

On Monday, Aug 4, 2003, at 14:14 America/New_York, Phillip J. Eby wrote:

> At 12:28 PM 8/4/03 -0500, Glyph Lefkowitz wrote:
>
>> On Monday, August 4, 2003, at 07:13 AM, Tim Allen wrote:
>>
>>> Is there any reason why white-space preserving should not always be 
>>> on?
>>
>> Believe it or not, it's a bottleneck.
>>
>> In order to preserve whitespace, you have to create a bunch of extra 
>> Node and str objects, which consume a not-inconsiderable set of 
>> resources for, let's say, a directory full of reasonably sized Woven 
>> templates.
>>
>> This cost is exacerbated by the fact that woven copies and inspects 
>> the entire tree of DOM objects on every page render.
>
> You might be interested in the technique I use for peak.web.templates. 
>  First, my DOMlet objects aren't even as sophisticated as Twisted's 
> microdom; they are just objects that cwrite unicode streams.  Second, 
> each node has a 'staticText' attribute that can be either a unicode 
> value or None.  So, parent nodes can glom together adjacent nodes with 
> staticText.  Then, if that node only has static content, it defines 
> its own staticText attribute, so it can be glommed together with its 
> peers, by its parent.  The net result is that a template, as a whole, 
> consists of dynamic nodes occasionally interrupted by a block of 
> static text.

That's pretty much what donovan and I were doing with STAN back at 
pycon dc, but I don't think either of us tried very hard to actually do 
anything much with it after the fact.  It was a kind of "optimizing 
compiler" for templates.

-bob




From edmundd at eSentire.com  Mon Aug  4 14:30:01 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Mon, 4 Aug 2003 16:30:01 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
Message-ID: <Pine.BSO.4.44.0308041627560.1514-100000@cyclops4.esentire.com>

Greetings!

Grabbed a copy of 1.0.7alpha2. Tried out a simple echo server using
"getObjectAtSSL", and it seems to work. Looking over the docs and
API, I cannot seem to find anyplace that would allow the specification
of client certificates. Is this supported (or planned to be supported)?

Regards,
Ed




From itamar at itamarst.org  Mon Aug  4 14:44:23 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 4 Aug 2003 16:44:23 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308041627560.1514-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308041627560.1514-100000@cyclops4.esentire.com>
Message-ID: <20030804164423.7159e71a.itamar@itamarst.org>

On Mon, 4 Aug 2003 16:30:01 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> Grabbed a copy of 1.0.7alpha2. Tried out a simple echo server using
> "getObjectAtSSL", and it seems to work. Looking over the docs and
> API, I cannot seem to find anyplace that would allow the specification
> of client certificates. Is this supported (or planned to be
> supported)?

1. Use CVS, or the upcoming alpha, which has better SSL API, as soon as
you can.

2. Yes, you can specify client certificate by making a custom context
factory. See the example context factories in twisted.internet.ssl and
read the pyOpenSSL docs for the Context object.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Mon Aug  4 15:02:42 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Mon, 4 Aug 2003 17:02:42 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804164423.7159e71a.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>

Greetings!

I see the custom context factory on the server side. What I don't see
is the corresponding pieces on the client side.

(dig, dig, dig)

Aha! Digging into the library, I see getObjectAtSSL does take a context
(this is not documented on the web site documentation -> Aside: is it
possible to add a version number to the web site documentation so that it
is possible to know _which_ version of Twisted it is referring to?).
I believe that the order of arguements has been switched from previous
versions (hard to tell, I have such a hacked up PB now that it would take
a bit of time to go digging, but I believe the context was before the
timeout previously as I based my hacked version on the 1.0.5 code).

Thanks!
Ed

On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 16:30:01 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > Grabbed a copy of 1.0.7alpha2. Tried out a simple echo server using
> > "getObjectAtSSL", and it seems to work. Looking over the docs and
> > API, I cannot seem to find anyplace that would allow the specification
> > of client certificates. Is this supported (or planned to be
> > supported)?
>
> 1. Use CVS, or the upcoming alpha, which has better SSL API, as soon as
> you can.
>
> 2. Yes, you can specify client certificate by making a custom context
> factory. See the example context factories in twisted.internet.ssl and
> read the pyOpenSSL docs for the Context object.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From dizzyd at jabber.org  Mon Aug  4 15:04:42 2003
From: dizzyd at jabber.org (Dave Smith)
Date: Mon, 4 Aug 2003 15:04:42 -0600
Subject: [Twisted-Python] Surprises in twisted.web.woven
In-Reply-To: <19524A43-C6A1-11D7-8F2D-000393C9700E@twistedmatrix.com>
Message-ID: <447EFE45-C6BF-11D7-8494-00039386381C@jabber.org>

On Monday, Aug 4, 2003, at 11:28 America/Denver, Glyph Lefkowitz wrote:

>
> On Monday, August 4, 2003, at 07:13 AM, Tim Allen wrote:
>
>> Is there any reason why white-space preserving should not always be 
>> on?
>
> Believe it or not, it's a bottleneck.
>
> In order to preserve whitespace, you have to create a bunch of extra 
> Node and str objects, which consume a not-inconsiderable set of 
> resources for, let's say, a directory full of reasonably sized Woven 
> templates.

This "bottleneck" is highly dependent on your DOM _implementation_. 
Many DOMs normalize adjacent sections of text/CData to avoid this exact 
issue. It should be a relatively simple fix to the MicroDOMParser to 
avoid extra nodes on adjacent CData sections.

<shameless-plug>You could always look at xish.domish.Element.addContent 
as an example. ;) </shameless-plug>

Diz




From itamar at itamarst.org  Mon Aug  4 15:21:32 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 4 Aug 2003 17:21:32 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>
References: <20030804164423.7159e71a.itamar@itamarst.org>
	<Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>
Message-ID: <20030804172132.20a3167c.itamar@itamarst.org>

On Mon, 4 Aug 2003 17:02:42 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> a bit of time to go digging, but I believe the context was before the
> timeout previously as I based my hacked version on the 1.0.5 code).

As of 1.0.7 you shouldn't need to do this. If you *do* end up hacking PB
please do tell us so we can fix it so it's not necessary. What are you
using PB for, by the way?

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Mon Aug  4 15:34:06 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Mon, 4 Aug 2003 17:34:06 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804172132.20a3167c.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308041730340.1514-100000@cyclops4.esentire.com>

I'm trying Twisted out as a framework to provide distributed monitoring of
computer systems. Twisted is looking good overall, but there are a number
of components I was using with Erlang that I would like to have (in
particular, the ideas of on the fly upgrades - I will have to see how easy
it would be to implement these pieces).

Regards!
Ed

On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 17:02:42 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > a bit of time to go digging, but I believe the context was before the
> > timeout previously as I based my hacked version on the 1.0.5 code).
>
> As of 1.0.7 you shouldn't need to do this. If you *do* end up hacking PB
> please do tell us so we can fix it so it's not necessary. What are you
> using PB for, by the way?
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Mon Aug  4 16:52:33 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804172132.20a3167c.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308041824330.1514-100000@cyclops4.esentire.com>

Greetings!

Okay, tried something a bit more complicated, basically it is a modified
version of pb6server/pb6client code from the documentation.

I'm locking up again. It looks like it gets further than when I had my
problems with 1.0.5. The client claims to have gotten a root reference
(good, this is further), but the server does not show the attaching
client. It looks like the client is blocking in the pb.logIn method.

Twisted Version: 1.0.7alpha2

Note: I did have this working with a hacked up 1.0.5.

SERVER SIDE
-----------

#! /usr/bin/python

from twisted.spread import pb
from twisted.cred.authorizer import DefaultAuthorizer
import twisted.internet.app

from OpenSSL import SSL
from twisted.internet import ssl

import os

class TransferClientPerspective(pb.Perspective):

    def attached(self, clientref, identity):
        print "client attached! they are:", identity
        return self

    def detached(self, ref, identity):
        print "client detached! they were:", identity

    def perspective_transferEvent(self, event):
        print "I am %s, transferEvent(%s) called on %s" % (self.myname, event, self)
        return true



class ServerContextFactory:

    def getContext(self):
        ctx = SSL.Context(SSL.SSLv23_METHOD)
        ctx.use_certificate_file('server.pem')
        ctx.use_privatekey_file('server.pem')
        return ctx


class TransferServer:
    def __init__(self):
        pass

    def run(self):
        print "TransferServer.run() called"

        app = twisted.internet.app.Application("TransferServer")
        auth = DefaultAuthorizer(app)

        service = pb.Service("TransferService", app, auth)
        service.perspectiveClass = TransferClientPerspective

        client1 = service.createPerspective("perspective1")
        client1.myname = "client1"

        identity1 = auth.createIdentity("user1")
        identity1.setPassword("pass1")
        identity1.addKeyByString("TransferService", "perspective1")
        auth.addIdentity(identity1)

        print "Starting service listening now"
        app.listenSSL(8800, pb.BrokerFactory(pb.AuthRoot(auth)), ServerContextFactory())
        app.run(save=0)

server = TransferServer()
server.run()



CLIENT SIDE
-----------

#! /usr/bin/python

from twisted.spread import pb
from twisted.internet import reactor, ssl
from twisted.internet.protocol import ClientFactory
import pdb


class TransferClient:
    def __init__(self):
        pass

    def go(self):
        def1 = pb.getObjectAtSSL("crete.internal", 8800, 15)
        def1.addCallbacks(self.logIn,self.unable)
        print "finishing main()"
        reactor.run()

    def logIn(self, root):
        print "TransferClient.login() called"
        print "Got root reference: %s" % root
        def2 = pb.logIn(root, service="TransferService", username="user1", password="pass1", perspective="perspective1")
        def2.addCallbacks(self.startTransfer,self.unable)


    def startTransfer(self, perspective):
        print "TransferClient.startTransfer() called"
        print "Got perspective1 reference: %s" % perspective
        print "Asking it to transferEvent(13)"
        perspective.callRemote("transferEvent", 13)

    def unable(self, error):
        print "TransferClient.unable() called"
        error.printTraceback()

client = TransferClient()
client.go()




On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 17:02:42 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > a bit of time to go digging, but I believe the context was before the
> > timeout previously as I based my hacked version on the 1.0.5 code).
>
> As of 1.0.7 you shouldn't need to do this. If you *do* end up hacking PB
> please do tell us so we can fix it so it's not necessary. What are you
> using PB for, by the way?
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From sflist at ihonk.com  Mon Aug  4 16:59:02 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Mon, 4 Aug 2003 15:59:02 -0700
Subject: [Twisted-Python] Maturity of twisted.web.woven?
Message-ID: <200308041559.02222.sflist@ihonk.com>

Hi all,

In David Mertz's recent DeveloperWorks articles on Twisted, he states the 
opinion, "Twisted's Web templating framework, woven, while becoming quite 
sophisticated, is unstable enough that I will only touch on it here."[1]

Do the core developers agree with this? The reason I'm asking is that I'm 
looking at coding a commercial (read: credit-card accepting, 
livelihood-producing) website in the next several weeks, and I'd like to do 
it in Twisted if that's the wise choice. But I'd like to know if it might be 
wiser to pick something that isn't being developed so quickly any more, e.g. 
Webware.

Thanks,

Steve Freitas

[1] http://www-106.ibm.com/developerworks/linux/library/l-twist2.html



From itamar at itamarst.org  Mon Aug  4 17:37:50 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 4 Aug 2003 19:37:50 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308041824330.1514-100000@cyclops4.esentire.com>
References: <20030804172132.20a3167c.itamar@itamarst.org>
	<Pine.BSO.4.44.0308041824330.1514-100000@cyclops4.esentire.com>
Message-ID: <20030804193750.187800b0.itamar@itamarst.org>

On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> I'm locking up again. It looks like it gets further than when I had my
> problems with 1.0.5. The client claims to have gotten a root reference
> (good, this is further), but the server does not show the attaching
> client. It looks like the client is blocking in the pb.logIn method.
> 
> Twisted Version: 1.0.7alpha2

getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
I'll be glad to take a look.

  # this is how it'd look:
  factory = pb.PBClientFactory()
  reactor.connectSSL("localhost", 8787, contextFactory, factory)
  deferredOfPerspective = factory.getPerspective("identity", "password",
perspective="joe")

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From cce at clarkevans.com  Mon Aug  4 17:51:35 2003
From: cce at clarkevans.com (Clark C. Evans)
Date: Mon, 4 Aug 2003 23:51:35 +0000
Subject: [Twisted-Python] Goin' with the Flow
In-Reply-To: <3F2E2231.8030708@tekNico.net>
References: <3F2E2231.8030708@tekNico.net>
Message-ID: <20030804235135.GA12033@polya.axista.com>

Nicola,

Thank you for taking time to play with flow.  I'm working on an LDAP adapter 
and shortly there after will somehow find a way to get async PostgreSQL 
queries to work with it (instead of using the Threaded/QueryIterator hack).
However, recently I've been caught up with an unexpected move and have 
been job hunting, which has limited my time for Twisted (and YAML).  But,
that should straighten out in the next month or so... and then I'll be
back at it.

Flow will be more easily understood with an application that uses 
it... I've been putting together a simple LDAP browser (using OpenLDAP)
and ldap queries using Twisted/Flow and python-ldap.   It also will
use iCal and PostgreSQL queries.   The current app I have which uses
Flow is proprietary (*sigh*) so I can't post it.   In short, flow is
useful when:

   1.  You have a ton of deferred calls and would like to keep
       the logic as a single "function".   Or, in other words,
       you are implementing a state machine which can allow other
       twisted requests to be handled during each state change.

   2.  You need to have results returned incrementally, and deferreds
       arn't quite working for you in this regard.

Best,

Clark



From glyph at twistedmatrix.com  Mon Aug  4 18:04:47 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 4 Aug 2003 19:04:47 -0500
Subject: [Twisted-Python] Maturity of twisted.web.woven?
In-Reply-To: <200308041559.02222.sflist@ihonk.com>
Message-ID: <6D478CF2-C6D8-11D7-A0F7-000393C9700E@twistedmatrix.com>

On Monday, August 4, 2003, at 05:59 PM, Steve Freitas wrote:

> In David Mertz's recent DeveloperWorks articles on Twisted, he states 
> the
> opinion, "Twisted's Web templating framework, woven, while becoming 
> quite
> sophisticated, is unstable enough that I will only touch on it 
> here."[1]

It is changing less than it used to be.  However, it isn't done.

> Do the core developers agree with this?

It's more or less true.

> The reason I'm asking is that I'm looking at coding a commercial 
> (read: credit-card accepting, livelihood-producing) website in the 
> next several weeks, and I'd like to do it in Twisted if that's the 
> wise choice. But I'd like to know if it might be wiser to pick 
> something that isn't being developed so quickly any more, e.g. > Webware.

Well!  You certainly wouldn't be coming to this list if you wanted an 
*objective* assessment, so I'll give you my highly distorted view of 
things :).

Woven is a web framework written by crazy geniuses, for crazy geniuses. 
  (That is, by Donovan, for me.)  Don't get too hung up on the word 
"genius" there, though - the operative word is "crazy".

If you are used to more "traditional" web development environments like 
PHP or JSP or whatever, you'll find the object model in woven more than 
a little confusing, and by confusing, I mean "better".  If you've been 
around the block with more hard-core web development models (like Zope, 
Cocoon, WebObjects) you will find that Woven extends the "object 
publishing" metaphor all the way down to individual XML nodes within a 
page; this is a very powerful paradigm to work inside of if you have a 
highly dynamic, interactive website with lots of re-usable objects you 
want to display in different contexts.

I think there are also things happening with Javascript and user events 
and other things that involve creating coherent abstractions around 
web-things which are neither coherent nor abstract.  Do you remember 
"push"?  It's like that.  Except of course it uses cross-browser 
javascript and therefore it terrifies me so thoroughly that I will 
speak no more of it.

The good news is that if you want to create an application which really 
wants to be interactive and hook it up to the web, woven lets you do 
really amazing things in that regard.  But don't just take my word for 
it - we (and by that I mean "the Divmod team") have been putting 
together a similarly livelihood-producing chunk of code which you can 
take a peek at over on http://www.divmod.org/ - the Quotient 
conversation server uses Woven extensively.  I am putting my literal 
money where my proverbial mouth is, and things seem to be going along 
pretty well in that regard.

The bad news is that you will have to track CVS.  You will have to 
hassle Twisted team members to fix bugs that affect your code.  You 
will need to read all the documentation - twice - and then ask for more 
documentation to be written.  You will almost certainly see tracebacks 
that unravel the very fabric that binds our HTML-formatted reality 
together.

Now, take your pulse.  Is it over 130 beats per minute, after reading 
the chilling tale of bleeding-edge web development above?  If not, then 
Woven is the right choice for you.  I personally think it's worth the 
trouble. (Don't think that just because I'm wearing the "glyph #1 best 
Twisted developer" foam pope hat that I don't need to deal with any 
trouble... Did I mention that my girlfriend used woven?  When it was 
considerably less stable than it is now?)

However, it is definitely an adventure you need to be prepared for.

So, in the immortal words of Space Harrier: "GET READY"




From ram at forefront-tech.com  Mon Aug  4 18:10:22 2003
From: ram at forefront-tech.com (Rick Morrison)
Date: Mon, 4 Aug 2003 20:10:22 -0400
Subject: [Twisted-Python] Subclassing static.File
Message-ID: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>

Hi All:

Warning: newbie alert:

Just beginning to look into Twisted, and I'm really impressed with the
breadth of the functionality here.
But, I'm having a bit of trouble getting my head fully around this thing.
Here's what I'm currently having trouble with.
Here's a simple program (that doesn't work) that subclasses the static.File
class:


from twisted.internet import app
from twisted.web import static, server

class FileLogger(static.File):
    def __init__(self, path, defaultType="text/html", ignoredExts=(),
registry=None, allowExt=0):
        static.File(self, path, defaultType, ignoredExts, registry,
allowExt)

    def render(self, request):
        static.File.render(self, request)

root = FileLogger('/home/me/twtest')
a = app.Application('web')
a.listenTCP(8080, server.Site(root))
a.run(0)


When I hit the site with a browser, the browser hangs. Interrupting the
twisted session causes the page to immediately appear in the browser.
...Comment out the override of the render() function, and everything works
fine.

What's going on?




From dp at twistedmatrix.com  Mon Aug  4 18:28:06 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Mon, 4 Aug 2003 17:28:06 -0700
Subject: [Twisted-Python] Subclassing static.File
In-Reply-To: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>
References: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>
Message-ID: <AEF7CE10-C6DB-11D7-BE05-000A95864FC4@twistedmatrix.com>

On Monday, August 4, 2003, at 5:10 PM, Rick Morrison wrote:
>
>     def render(self, request):
>         static.File.render(self, request)
>
> When I hit the site with a browser, the browser hangs. Interrupting the
> twisted session causes the page to immediately appear in the browser.
> ...Comment out the override of the render() function, and everything 
> works
> fine.
>
> What's going on?

You are not returning a value from render. The return value from render
be either a string, being the HTML output of the object, or 
server.NOT_DONE_YET,
in which case you should arrange to have request.write("<html />") and
request.finish() called at a later time.

In this case, you obviously want to return the value of the call to 
static.File.render:

def render(self, request):
	return static.File.render(self, request)

Wouldn't it be nice if the return value of a python function was the 
value of the last
expression in the function? ;-)

dp




From andrew-twisted at puzzling.org  Mon Aug  4 23:43:00 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue, 5 Aug 2003 15:43:00 +1000
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>
References: <20030804164423.7159e71a.itamar@itamarst.org> <Pine.BSO.4.44.0308041656500.1514-100000@cyclops4.esentire.com>
Message-ID: <20030805054300.GB2144@frobozz>

On Mon, Aug 04, 2003 at 05:02:42PM -0400, Edmund Dengler wrote:
[...]
> (this is not documented on the web site documentation -> Aside: is it
> possible to add a version number to the web site documentation so that it
> is possible to know _which_ version of Twisted it is referring to?).

It already does, if you know where to look:
    http://twistedmatrix.com/documents/TwistedDocs/current/api/public/twisted.copyright.html#version

-Andrew.




From radix at twistedmatrix.com  Tue Aug  5 02:20:27 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Tue, 5 Aug 2003 04:20:27 -0400
Subject: [Twisted-Python] Subclassing static.File
In-Reply-To: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>
References: <003401c35ae5$fab6a3f0$1510a8c0@forefronttech>
Message-ID: <20030805082027.GK998@radii>

On Mon, Aug 04, 2003 at 08:10:22PM -0400, Rick Morrison wrote:
> class FileLogger(static.File):
>     def __init__(self, path, defaultType="text/html", ignoredExts=(), registry=None, allowExt=0):
>         static.File(self, path, defaultType, ignoredExts, registry, allowExt)

^^^ This should be "static.File.__init__(..)", not "static.File(..)"

>     def render(self, request):
>         static.File.render(self, request)

You need a "return".


Why are you subclassing static.File? It's usually inappropriate.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From justinjohnson at fastmail.fm  Tue Aug  5 08:02:31 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 05 Aug 2003 08:02:31 -0600
Subject: [Twisted-Python] Unruly Callback Code
Message-ID: <20030805140231.A321218591@www.fastmail.fm>

I have some code that is getting a bit unruly due to the number of
callbacks I am doing.  I've defined all of this in a single method
because it is part of a command line tool with multiple sub-commands,
each with its own options, and I made the entire program (i.e. the
command line tool) the class, and the sub-commands are methods on that
class.  However, I'm beginning to think I need to rearrange this so it is
more maintainable, like putting each sub-command in its own class so the
callbacks can be methods on the class instead of inline functions.

Would someone mind looking at the code below and suggesting ways to clean
this up?

Thanks.
-Justin


	# Subcommand: mkvob
	def cmd_mkvob(self):
		"""Usage: mkvob -v vob-tag[,vob-tag,...] -o site [-g group] [-s site,site,...]
		"""
		options = self.config.subOptions
		original_site = options["original"]
		group = options["group"]
		vobs = options["vobs"].split(",")
		sites = []
		if options["sites"] != None:
			sites = options["sites"].split(",")

		def gotObject(object):
			self.perspectives[original_site] = object
			print "Successfully connected to %s (%s)." % (original_site, config.siteToServer[original_site])
			print "Calling remote mkvob ..."
			d = object.callRemote("mkvob", vobs, group)
			return d
		def gotNoObject(object):
			print "Failed to connect:", object
			return object

		def renameReplica(results, vobs, original_site):
			# Do I have to connect again to do this?
			obj = self.perspectives[original_site]
			obj.callRemote("renameReplica", vobs, "original", original_site)
			return obj

		def mkRepExport(results, vobs, sites, original_site):
			obj = self.perspectives[original_site]
			d = obj.callRemote("mkReplicaExport", vobs, sites)
			return d

		def _stop(*args):
			print "The mkvob operation completed successfully"
			reactor.stop()
			return args

		def mkRepImport(results, vobs, sites):
			if len(vobs) > 0 and len(sites) > 0:
				deferreds = []
				for site in sites:
					def onSuccess(object, site):
						self.perspectives[site] = object
						d = object.callRemote("mkReplicaImport", vobs)
						return d
					def applyTriggers(results, vobs, site):
						obj = self.perspectives[site]
						d = obj.callRemote("applyTriggers", vobs)
						return d
					d = self.connectToServer(config.siteToServer[site])
					d.addCallback(onSuccess, site).addErrback(log.err)
					d.addCallback(applyTriggers, vobs, site).addErrback(log.err)
					deferreds.append(d)
				return defer.DeferredList(deferreds)
			return results
				
		d = self.connectToServer(config.siteToServer[original_site])
		d.addCallbacks(gotObject, gotNoObject)
		d.addCallback(renameReplica, vobs, original_site).addErrback(log.err)
		d.addCallback(mkRepExport, vobs, sites, original_site).addErrback(log.err)
		d.addCallback(mkRepImport, vobs, sites).addErrback(log.err)
		d.addBoth(_stop)
		#log.startLogging(sys.stdout)
		reactor.run()



From edmundd at eSentire.com  Tue Aug  5 08:15:11 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 10:15:11 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030805054300.GB2144@frobozz>
Message-ID: <Pine.BSO.4.44.0308051013500.8424-100000@cyclops4.esentire.com>

Thanks! It would be helpful if the version number could appear as a footer
to each page, including the "How To" sections. With the API changing, it
is helpful to know if I am at least looking at some sane version :-).

Regards,
Ed

On Tue, 5 Aug 2003, Andrew Bennetts wrote:

> On Mon, Aug 04, 2003 at 05:02:42PM -0400, Edmund Dengler wrote:
> [...]
> > (this is not documented on the web site documentation -> Aside: is it
> > possible to add a version number to the web site documentation so that it
> > is possible to know _which_ version of Twisted it is referring to?).
>
> It already does, if you know where to look:
>     http://twistedmatrix.com/documents/TwistedDocs/current/api/public/twisted.copyright.html#version
>
> -Andrew.
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Tue Aug  5 08:16:46 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 10:16:46 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804193750.187800b0.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308051015580.8424-100000@cyclops4.esentire.com>

Downloading the CVS to give it a go. Is there any reason to deprecate this
method? Is getObjectAt() also going to be deprecated?

Regards,
Ed

On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > I'm locking up again. It looks like it gets further than when I had my
> > problems with 1.0.5. The client claims to have gotten a root reference
> > (good, this is further), but the server does not show the attaching
> > client. It looks like the client is blocking in the pb.logIn method.
> >
> > Twisted Version: 1.0.7alpha2
>
> getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
> I'll be glad to take a look.
>
>   # this is how it'd look:
>   factory = pb.PBClientFactory()
>   reactor.connectSSL("localhost", 8787, contextFactory, factory)
>   deferredOfPerspective = factory.getPerspective("identity", "password",
> perspective="joe")
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From itamar at itamarst.org  Tue Aug  5 08:37:58 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 5 Aug 2003 10:37:58 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051015580.8424-100000@cyclops4.esentire.com>
References: <20030804193750.187800b0.itamar@itamarst.org>
	<Pine.BSO.4.44.0308051015580.8424-100000@cyclops4.esentire.com>
Message-ID: <20030805103758.28fd3ec7.itamar@itamarst.org>

On Tue, 5 Aug 2003 10:16:46 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> Downloading the CVS to give it a go. Is there any reason to deprecate
> this method? Is getObjectAt() also going to be deprecated?

Yes, and yes :)

The reason is that it ties getting an object to the transport. Every
time you write a new transport, you need to write a new function.
Whereas with the new way, which is the normal way Twisted protocols
work, new transport can be used without writing extra code. In addition
you have the benefits of auto-reconnecting if you want, ability to do
multiple logins over the same PB connection easily, and in general code
that is much cleaner.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Tue Aug  5 08:50:05 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 10:50:05 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030804193750.187800b0.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>

Trying it out. Is there any documentation (ala the How To's) to show how
to use the new API.

Tried it out, had to change the contextFactory and context orders, and
used serviceName and perspectiveName.

Here is the new go() method in the client side:

----------

    def go(self):
        factory = pb.PBClientFactory()
        reactor.connectSSL("localhost", 8800, factory, ssl.ClientContextFactory())
        def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
        def1.addCallbacks(self.startTransfer, self.unable)
        print "finishing go()"
        reactor.run()

----------

And here is what I get when I run it:

> python pb7client.py
pb7client.py:16: DeprecationWarning: Please update your backend to use updated APIs.
  def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
finishing go()
TransferClient.unable() called
Failure: twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 61: Connection refused.

I can telnet to the port, so it is not a networking issue.

Regards,
Ed

On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:

> On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > I'm locking up again. It looks like it gets further than when I had my
> > problems with 1.0.5. The client claims to have gotten a root reference
> > (good, this is further), but the server does not show the attaching
> > client. It looks like the client is blocking in the pb.logIn method.
> >
> > Twisted Version: 1.0.7alpha2
>
> getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
> I'll be glad to take a look.
>
>   # this is how it'd look:
>   factory = pb.PBClientFactory()
>   reactor.connectSSL("localhost", 8787, contextFactory, factory)
>   deferredOfPerspective = factory.getPerspective("identity", "password",
> perspective="joe")
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Tue Aug  5 08:52:49 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 10:52:49 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030805103758.28fd3ec7.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308051052150.8424-100000@cyclops4.esentire.com>

Ahh, this definitely makes more sense. I was wondering why the transport
seemed to be tied so intimately with what was going on the layer above it.

Ed

On Tue, 5 Aug 2003, Itamar Shtull-Trauring wrote:

> On Tue, 5 Aug 2003 10:16:46 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > Downloading the CVS to give it a go. Is there any reason to deprecate
> > this method? Is getObjectAt() also going to be deprecated?
>
> Yes, and yes :)
>
> The reason is that it ties getting an object to the transport. Every
> time you write a new transport, you need to write a new function.
> Whereas with the new way, which is the normal way Twisted protocols
> work, new transport can be used without writing extra code. In addition
> you have the benefits of auto-reconnecting if you want, ability to do
> multiple logins over the same PB connection easily, and in general code
> that is much cleaner.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From itamar at itamarst.org  Tue Aug  5 09:25:57 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 5 Aug 2003 11:25:57 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
References: <20030804193750.187800b0.itamar@itamarst.org>
	<Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
Message-ID: <20030805112557.13e0a812.itamar@itamarst.org>

On Tue, 5 Aug 2003 10:50:05 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> I can telnet to the port, so it is not a networking issue.

Are you sure? Because connectSSL is what getObjectAtSSL would be using
internally, so that is *not* the issue. Also, on windows you'd want to
make that 127.0.0.1 or it will not work.

The DeprecationWarning is due to the use of getPerspective(), which has
also been deprecated. I'll make the warning more clear. Basically PB
should now use new cred, which is far far cleaner and easier to use (the
PBClientFactory.login() method for connecting and PBServerFactory on
server side.) Using getPerspective() will still work for the forseeable
future, of course. See twisted.test.test_pb (the last 4 classes, IIRC)
for examples of how to do this.

I know this may be annoying, but we're doing this because of all the
issues we had with the old APIs that were broken and hard to use in a
variety of ways. Hopefully documentation of the new APIs will be
available soon.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Tue Aug  5 09:30:15 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 11:30:15 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
Message-ID: <Pine.BSO.4.44.0308051127571.8424-100000@cyclops4.esentire.com>

Whoops! Too fast on the keyboard. The "localhost" was suppose to be
"crete.internal".

Fixed and ran. The new error message is:

> python pb7client.py
pb7client.py:16: DeprecationWarning: Please update your backend to use updated APIs.
  def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
finishing go()
TransferClient.unable() called
Failure: twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 22: Invalid argument.

Possibility: Should the "user1" be something else?

Regards!
Ed

On Tue, 5 Aug 2003, Edmund Dengler wrote:

> Trying it out. Is there any documentation (ala the How To's) to show how
> to use the new API.
>
> Tried it out, had to change the contextFactory and context orders, and
> used serviceName and perspectiveName.
>
> Here is the new go() method in the client side:
>
> ----------
>
>     def go(self):
>         factory = pb.PBClientFactory()
>         reactor.connectSSL("localhost", 8800, factory, ssl.ClientContextFactory())
>         def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
>         def1.addCallbacks(self.startTransfer, self.unable)
>         print "finishing go()"
>         reactor.run()
>
> ----------
>
> And here is what I get when I run it:
>
> > python pb7client.py
> pb7client.py:16: DeprecationWarning: Please update your backend to use updated APIs.
>   def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
> finishing go()
> TransferClient.unable() called
> Failure: twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 61: Connection refused.
>
> I can telnet to the port, so it is not a networking issue.
>
> Regards,
> Ed
>
> On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:
>
> > On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
> > Edmund Dengler <edmundd at eSentire.com> wrote:
> >
> > > I'm locking up again. It looks like it gets further than when I had my
> > > problems with 1.0.5. The client claims to have gotten a root reference
> > > (good, this is further), but the server does not show the attaching
> > > client. It looks like the client is blocking in the pb.logIn method.
> > >
> > > Twisted Version: 1.0.7alpha2
> >
> > getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
> > I'll be glad to take a look.
> >
> >   # this is how it'd look:
> >   factory = pb.PBClientFactory()
> >   reactor.connectSSL("localhost", 8787, contextFactory, factory)
> >   deferredOfPerspective = factory.getPerspective("identity", "password",
> > perspective="joe")
> >
> > --
> > Itamar Shtull-Trauring    http://itamarst.org/
> > Available for Python & Twisted consulting
> >
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Tue Aug  5 09:32:51 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 11:32:51 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
Message-ID: <Pine.BSO.4.44.0308051132050.8424-100000@cyclops4.esentire.com>

Never mind! Got it to work. I had a mistyping in the server side when
doing a bit of mucking about.

Connection established and transfer working at the moment.

Regards!
Ed

On Tue, 5 Aug 2003, Edmund Dengler wrote:

> Trying it out. Is there any documentation (ala the How To's) to show how
> to use the new API.
>
> Tried it out, had to change the contextFactory and context orders, and
> used serviceName and perspectiveName.
>
> Here is the new go() method in the client side:
>
> ----------
>
>     def go(self):
>         factory = pb.PBClientFactory()
>         reactor.connectSSL("localhost", 8800, factory, ssl.ClientContextFactory())
>         def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
>         def1.addCallbacks(self.startTransfer, self.unable)
>         print "finishing go()"
>         reactor.run()
>
> ----------
>
> And here is what I get when I run it:
>
> > python pb7client.py
> pb7client.py:16: DeprecationWarning: Please update your backend to use updated APIs.
>   def1 = factory.getPerspective("user1", "pass1", serviceName="TransferService", perspectiveName="perspective1")
> finishing go()
> TransferClient.unable() called
> Failure: twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 61: Connection refused.
>
> I can telnet to the port, so it is not a networking issue.
>
> Regards,
> Ed
>
> On Mon, 4 Aug 2003, Itamar Shtull-Trauring wrote:
>
> > On Mon, 4 Aug 2003 18:52:33 -0400 (EDT)
> > Edmund Dengler <edmundd at eSentire.com> wrote:
> >
> > > I'm locking up again. It looks like it gets further than when I had my
> > > problems with 1.0.5. The client claims to have gotten a root reference
> > > (good, this is further), but the server does not show the attaching
> > > client. It looks like the client is blocking in the pb.logIn method.
> > >
> > > Twisted Version: 1.0.7alpha2
> >
> > getObjectAtSSL is deprecated in CVS. If you can reproduce this with CVS
> > I'll be glad to take a look.
> >
> >   # this is how it'd look:
> >   factory = pb.PBClientFactory()
> >   reactor.connectSSL("localhost", 8787, contextFactory, factory)
> >   deferredOfPerspective = factory.getPerspective("identity", "password",
> > perspective="joe")
> >
> > --
> > Itamar Shtull-Trauring    http://itamarst.org/
> > Available for Python & Twisted consulting
> >
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Tue Aug  5 09:34:29 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Tue, 5 Aug 2003 11:34:29 -0400 (EDT)
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <20030805112557.13e0a812.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308051133440.8424-100000@cyclops4.esentire.com>

Would you recommend that I have a look at the new methods, and get away
from getPerspective() et al.? How stable (or production ready) are they?

Regards!
Ed

On Tue, 5 Aug 2003, Itamar Shtull-Trauring wrote:

> On Tue, 5 Aug 2003 10:50:05 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > I can telnet to the port, so it is not a networking issue.
>
> Are you sure? Because connectSSL is what getObjectAtSSL would be using
> internally, so that is *not* the issue. Also, on windows you'd want to
> make that 127.0.0.1 or it will not work.
>
> The DeprecationWarning is due to the use of getPerspective(), which has
> also been deprecated. I'll make the warning more clear. Basically PB
> should now use new cred, which is far far cleaner and easier to use (the
> PBClientFactory.login() method for connecting and PBServerFactory on
> server side.) Using getPerspective() will still work for the forseeable
> future, of course. See twisted.test.test_pb (the last 4 classes, IIRC)
> for examples of how to do this.
>
> I know this may be annoying, but we're doing this because of all the
> issues we had with the old APIs that were broken and hard to use in a
> variety of ways. Hopefully documentation of the new APIs will be
> available soon.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From tv at twistedmatrix.com  Tue Aug  5 10:02:44 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Tue, 5 Aug 2003 19:02:44 +0300
Subject: [Twisted-Python] Unruly Callback Code
In-Reply-To: <20030805140231.A321218591@www.fastmail.fm>
References: <20030805140231.A321218591@www.fastmail.fm>
Message-ID: <20030805160244.GA32531@lapdog>

On Tue, Aug 05, 2003 at 08:02:31AM -0600, Justin Johnson wrote:
> Would someone mind looking at the code below and suggesting ways to clean
> this up?

> 	# Subcommand: mkvob
> 	def cmd_mkvob(self):
> 		"""Usage: mkvob -v vob-tag[,vob-tag,...] -o site [-g group] [-s site,site,...]
> 		"""
> 		options = self.config.subOptions
> 		original_site = options["original"]
> 		group = options["group"]
> 		vobs = options["vobs"].split(",")
> 		sites = []
> 		if options["sites"] != None:
 		if options["sites"] is not None:
> 			sites = options["sites"].split(",")
> 
> 		def gotObject(object):
		def gotObject(object, vobs, group):
> 			self.perspectives[original_site] = object
> 			print "Successfully connected to %s (%s)." % (original_site, config.siteToServer[original_site])
> 			print "Calling remote mkvob ..."
> 			d = object.callRemote("mkvob", vobs, group)
> 			return d

	I'd actually avoid passing vobs and group into gotObject like
	that. Just have them as parameters; that means the function
	body is independent of its location, which I consider a lot
	cleaner.

> 		def renameReplica(results, vobs, original_site):
> 			# Do I have to connect again to do this?
> 			obj = self.perspectives[original_site]
> 			obj.callRemote("renameReplica", vobs, "original", original_site)
> 			return obj
> 
> 		def mkRepExport(results, vobs, sites, original_site):
> 			obj = self.perspectives[original_site]
> 			d = obj.callRemote("mkReplicaExport", vobs, sites)
> 			return d

	The tricks you play with self.perspectives are quite
	confusing, IMHO. I'd be more inclined to adding the
	callbacks accessing self.perspectives at a stage where
	I could pass them the perspective as an argument.
	That is,

		def gotObject(object, vobs, group):
			d = object.callRemote("mkvob", vobs, group)
			d.addCallback(renameReplica, object, vobs, original_site)
			d.addCallback(mkRepExport, object, vobs, sites, original_site)
			d.addCallback(mkRepImport, object, vobs, sites)
			return d

	Also, object is a bad name, as that name means other things in
	python2.2.

> 		def _stop(*args):
> 			print "The mkvob operation completed successfully"
> 			reactor.stop()
> 			return args

		def _stop(fail):
			reactor.stop()
			return fail

	That's not true, _stop is also called on errors.

	Also, _stop gets no extra arguments in .addBoth, so args=(aFailure,)
	and then you return that tuple.. 

> 		def mkRepImport(results, vobs, sites):
> 			if len(vobs) > 0 and len(sites) > 0:
> 				deferreds = []
> 				for site in sites:
> 					def onSuccess(object, site):
> 						self.perspectives[site] = object
> 						d = object.callRemote("mkReplicaImport", vobs)
> 						return d
> 					def applyTriggers(results, vobs, site):
> 						obj = self.perspectives[site]
> 						d = obj.callRemote("applyTriggers", vobs)
> 						return d
> 					d = self.connectToServer(config.siteToServer[site])
> 					d.addCallback(onSuccess, site).addErrback(log.err)
> 					d.addCallback(applyTriggers, vobs, site).addErrback(log.err)
> 					deferreds.append(d)
> 				return defer.DeferredList(deferreds)
> 			return results

	You just stepped in the DeferredList trap. DeferredList
	_never_ .errback()s unless it's told to fireOnOneErrback.
	That means you miss what errors might have happened.

	And fireOnOneErrback isn't normally what you want; you want
	to handle the results one by one.

> 		d = self.connectToServer(config.siteToServer[original_site])
> 		d.addCallbacks(gotObject, gotNoObject)
> 		d.addCallback(renameReplica, vobs, original_site).addErrback(log.err)
> 		d.addCallback(mkRepExport, vobs, sites, original_site).addErrback(log.err)
> 		d.addCallback(mkRepImport, vobs, sites).addErrback(log.err)

	There's no need to .addErrback that much. There's probably no
	reason to have gotNoObject special cased, and handle later
	errors just with log.err.

		d = self.connectToServer(config.siteToServer[original_site])
		d.addCallback(gotObject, vobs, group)
		d.addCallback(renameReplica, vobs, original_site)
		d.addCallback(mkRepExport, vobs, sites, original_site)
		d.addCallback(mkRepImport, vobs, sites)
		d.addErrback(log.err)

-- 
:(){ :|:&};:



From itamar at itamarst.org  Tue Aug  5 10:13:40 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 5 Aug 2003 12:13:40 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051133440.8424-100000@cyclops4.esentire.com>
References: <20030805112557.13e0a812.itamar@itamarst.org>
	<Pine.BSO.4.44.0308051133440.8424-100000@cyclops4.esentire.com>
Message-ID: <20030805121340.00f3bf5a.itamar@itamarst.org>

On Tue, 5 Aug 2003 11:34:29 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> Would you recommend that I have a look at the new methods, and get
> away from getPerspective() et al.? How stable (or production ready)
> are they?

They still might change - but I need feedback to know if they need to
change in any way, so please try them :)

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From itamar at itamarst.org  Tue Aug  5 10:14:44 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 5 Aug 2003 12:14:44 -0400
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051127571.8424-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308051037020.8424-100000@cyclops4.esentire.com>
	<Pine.BSO.4.44.0308051127571.8424-100000@cyclops4.esentire.com>
Message-ID: <20030805121444.341563d4.itamar@itamarst.org>

On Tue, 5 Aug 2003 11:30:15 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> Failure: twisted.internet.error.ConnectionRefusedError: Connection was
> refused by other side: 22: Invalid argument.
> 
> Possibility: Should the "user1" be something else?

ConnectionRefusedError is still on the networking layer, before it even
hits PB. You using listenSSL on the other side?

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Tue Aug  5 12:32:06 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 05 Aug 2003 12:32:06 -0600
Subject: [Twisted-Python] Unruly Callback Code
In-Reply-To: <20030805160244.GA32531@lapdog>
References: <20030805140231.A321218591@www.fastmail.fm> <20030805160244.GA32531@lapdog>
Message-ID: <20030805183206.30A8E38D0F@www.fastmail.fm>

How's it look now?  I still need to add appropriate errbacks for each
deferred in the deferred list, as opposed to using an errback on the
entire list.  Any other suggestions (even minor) about variable/function
naming or anything else?


	# Subcommand: mkvob
	def cmd_mkvob(self):
		"""Usage: mkvob -v vob-tag[,vob-tag,...] -o site [-g group] [-s site,site,...]
		"""
		options = self.config.subOptions
		original_site = options["original"]
		group = options["group"]
		vobs = options["vobs"].split(",")
		sites = []
		if options["sites"] is not None:
			sites = options["sites"].split(",")

		def renameReplica(results, perspective, vobs, original_site):
			d = perspective.callRemote("renameReplica", vobs, "original", original_site)
			return d

		def mkRepExport(results, perspective, vobs, sites):
			d = perspective.callRemote("mkReplicaExport", vobs, sites)
			return d

		def _stop(fail):
			reactor.stop()
			return fail

		def mkRepImport(results, perspective, vobs, sites):
			if len(vobs) > 0 and len(sites) > 0:
				deferreds = []
				for site in sites:
					def applyTriggers(results, perspective, vobs):
						d = perspective.callRemote("applyTriggers", vobs)
						return d
					def gotObject(perspective, vobs):
						d = perspective.callRemote("mkReplicaImport", vobs)
						d.addCallback(applyTriggers, perspective, vobs)
						return d
					d = self.connectToServer(config.siteToServer[site])
					d.addCallback(gotObject, vobs)
					deferreds.append(d)
				return defer.DeferredList(deferreds)
			return results
				
		def gotObject(perspective, vobs, group, original_site, sites):
			d = perspective.callRemote("mkvob", vobs, group)
			d.addCallback(renameReplica, perspective, vobs, original_site)
			d.addCallback(mkRepExport, perspective, vobs, sites)
			d.addCallback(mkRepImport, perspective, vobs, sites)
			d.addErrback(log.err)
			d.addBoth(_stop)
			return d

		# Connect to the server and start the chain of deferreds
		d = self.connectToServer(config.siteToServer[original_site])
		d.addCallback(gotObject, vobs, group, original_site, sites)
		reactor.run()

On Tue, 5 Aug 2003 19:02:44 +0300, "Tommi Virtanen"
<tv at twistedmatrix.com> said:
> On Tue, Aug 05, 2003 at 08:02:31AM -0600, Justin Johnson wrote:
> > Would someone mind looking at the code below and suggesting ways to clean
> > this up?
> 
> > 	# Subcommand: mkvob
> > 	def cmd_mkvob(self):
> > 		"""Usage: mkvob -v vob-tag[,vob-tag,...] -o site [-g group] [-s site,site,...]
> > 		"""
> > 		options = self.config.subOptions
> > 		original_site = options["original"]
> > 		group = options["group"]
> > 		vobs = options["vobs"].split(",")
> > 		sites = []
> > 		if options["sites"] != None:
>  		if options["sites"] is not None:
> > 			sites = options["sites"].split(",")
> > 
> > 		def gotObject(object):
> 		def gotObject(object, vobs, group):
> > 			self.perspectives[original_site] = object
> > 			print "Successfully connected to %s (%s)." % (original_site, config.siteToServer[original_site])
> > 			print "Calling remote mkvob ..."
> > 			d = object.callRemote("mkvob", vobs, group)
> > 			return d
> 
> 	I'd actually avoid passing vobs and group into gotObject like
> 	that. Just have them as parameters; that means the function
> 	body is independent of its location, which I consider a lot
> 	cleaner.
> 
> > 		def renameReplica(results, vobs, original_site):
> > 			# Do I have to connect again to do this?
> > 			obj = self.perspectives[original_site]
> > 			obj.callRemote("renameReplica", vobs, "original", original_site)
> > 			return obj
> > 
> > 		def mkRepExport(results, vobs, sites, original_site):
> > 			obj = self.perspectives[original_site]
> > 			d = obj.callRemote("mkReplicaExport", vobs, sites)
> > 			return d
> 
> 	The tricks you play with self.perspectives are quite
> 	confusing, IMHO. I'd be more inclined to adding the
> 	callbacks accessing self.perspectives at a stage where
> 	I could pass them the perspective as an argument.
> 	That is,
> 
> 		def gotObject(object, vobs, group):
> 			d = object.callRemote("mkvob", vobs, group)
> 			d.addCallback(renameReplica, object, vobs, original_site)
> 			d.addCallback(mkRepExport, object, vobs, sites, original_site)
> 			d.addCallback(mkRepImport, object, vobs, sites)
> 			return d
> 
> 	Also, object is a bad name, as that name means other things in
> 	python2.2.
> 
> > 		def _stop(*args):
> > 			print "The mkvob operation completed successfully"
> > 			reactor.stop()
> > 			return args
> 
> 		def _stop(fail):
> 			reactor.stop()
> 			return fail
> 
> 	That's not true, _stop is also called on errors.
> 
> 	Also, _stop gets no extra arguments in .addBoth, so args=(aFailure,)
> 	and then you return that tuple.. 
> 
> > 		def mkRepImport(results, vobs, sites):
> > 			if len(vobs) > 0 and len(sites) > 0:
> > 				deferreds = []
> > 				for site in sites:
> > 					def onSuccess(object, site):
> > 						self.perspectives[site] = object
> > 						d = object.callRemote("mkReplicaImport", vobs)
> > 						return d
> > 					def applyTriggers(results, vobs, site):
> > 						obj = self.perspectives[site]
> > 						d = obj.callRemote("applyTriggers", vobs)
> > 						return d
> > 					d = self.connectToServer(config.siteToServer[site])
> > 					d.addCallback(onSuccess, site).addErrback(log.err)
> > 					d.addCallback(applyTriggers, vobs, site).addErrback(log.err)
> > 					deferreds.append(d)
> > 				return defer.DeferredList(deferreds)
> > 			return results
> 
> 	You just stepped in the DeferredList trap. DeferredList
> 	_never_ .errback()s unless it's told to fireOnOneErrback.
> 	That means you miss what errors might have happened.
> 
> 	And fireOnOneErrback isn't normally what you want; you want
> 	to handle the results one by one.
> 
> > 		d = self.connectToServer(config.siteToServer[original_site])
> > 		d.addCallbacks(gotObject, gotNoObject)
> > 		d.addCallback(renameReplica, vobs, original_site).addErrback(log.err)
> > 		d.addCallback(mkRepExport, vobs, sites, original_site).addErrback(log.err)
> > 		d.addCallback(mkRepImport, vobs, sites).addErrback(log.err)
> 
> 	There's no need to .addErrback that much. There's probably no
> 	reason to have gotNoObject special cased, and handle later
> 	errors just with log.err.
> 
> 		d = self.connectToServer(config.siteToServer[original_site])
> 		d.addCallback(gotObject, vobs, group)
> 		d.addCallback(renameReplica, vobs, original_site)
> 		d.addCallback(mkRepExport, vobs, sites, original_site)
> 		d.addCallback(mkRepImport, vobs, sites)
> 		d.addErrback(log.err)
> 
> -- 
> :(){ :|:&};:
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From syver-en at online.no  Tue Aug  5 12:41:43 2003
From: syver-en at online.no (Syver Enstad)
Date: 05 Aug 2003 20:41:43 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
Message-ID: <ud6fk54m0.fsf@online.no>

I asked on the #twisted irc channel today about this, and Itamar
answered that it was possible but maybe only in CVS, I was also
directed to this list as the proper channel to ask woven questions.

I have the following setup:

class MyPage(page.Page):
   def wmfactory_myClass....
       ... some code that does a asynch operation and return a deferred
       deferred.addCallback(self._cbMyClass)
       return deferred
   
   def _cbMyClass(self, result):
       return MyClass(result)


class MyClass(model.MethodModel):
   def wmfactory_listing(......
       return [.......]


template:

<span model="myClass" view="None>
  <table model="listing" view="List">
        ....
  </table>
</span>

I get an error that the view cannot find the submodel, listing. The
modelStack is [DeferredWrapper, MyPage]. 

I use Twisted 1.0.6.

So my question is: How can I use deferreds the way I am outlining
here? Or is there a simple workaround?

-- 

Vennlig hilsen 

Syver Enstad




From ram at forefront-tech.com  Tue Aug  5 13:18:40 2003
From: ram at forefront-tech.com (Rick Morrison)
Date: Tue, 5 Aug 2003 15:18:40 -0400
Subject: [Twisted-Python] Re: Subclassing static.File
Message-ID: <004101c35b86$61ed41f0$1510a8c0@forefronttech>

Wow, that was fast! Thanks to all for the correction.

For the curious, I'm subclassing static.File.render() simply so that I can
dump the server.Request headers to see how twisted packages up the data for
a HTTP POST request, since I couldn't find that info in the twisted^H^Hy
little maze of documentation. If you'd like, when I'm finished with my
plunking around, perhaps I'll write up a few paragraphs on this that you can
drop into the pertinent doc files.

Rick




From dp at twistedmatrix.com  Tue Aug  5 13:27:07 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Tue, 5 Aug 2003 12:27:07 -0700
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <ud6fk54m0.fsf@online.no>
References: <ud6fk54m0.fsf@online.no>
Message-ID: <CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com>

On Tuesday, August 5, 2003, at 11:41 AM, Syver Enstad wrote:

<snip deferred model>

> template:
>
> <span model="myClass" view="None>
>   <table model="listing" view="List">
>         ....
>   </table>
> </span>

Change view="None" to view="Widget". The None widget (DefaultWidget) 
doesn't know anything about Deferreds, and thus can't pause the 
rendering of the rest of the node until the deferred has fired.

dp




From pb_twisted at olga.mine.nu  Tue Aug  5 15:03:28 2003
From: pb_twisted at olga.mine.nu (Patrik Blommaskog)
Date: Tue, 5 Aug 2003 23:03:28 +0200
Subject: [Twisted-Python] Jelly assertion error when running client and server in the same process
Message-ID: <JAEDJDIBADCJHPFLNEDFOEKPCAAA.pb_twisted@olga.mine.nu>

I have a client and a server application communicating using Twisted and PB.
They run fine as separate programs.

When adding some unit tests, I try to run both the server and a client in
the same application, but I get an assertion error as shown below. I don't
really understand enough of what's happening under the Twisted hood to tell
from the message and looking at flavors.py what's causing the problem.

The applications are growing, so I made an attempt to make a minimal example
from scratch to demonstrate the problem. However, I failed to reproduce it
this way. Since stripping down the applications to a bare minimum can take
some time, I would first like to ask the list if anyone can give me an
indication of what could be the problem? Even with my bad etiquette of not
providing an example, someone is likely to have written that assert
statement for a reason.

Traceback (most recent call last):
  File "C:\Python22\Lib\site-packages\twisted\internet\base.py", line 368,
in runUntilCurrent
    call.func(*call.args, **call.kw)
  File "E:\p\storskogen\src\skogen\common\Core.py", line 132, in
onActorEntered
    handler(actor)
  File "E:\p\storskogen\src\skogen\server\PlayerPerspective.py", line 65, in
onActorEntered
    self.remote.callRemote("addActor", actor)
  File "C:\Python22\Lib\site-packages\twisted\spread\pb.py", line 323, in
callRemote
    return self.broker._sendMessage('',self.perspective, self.luid, name,
args, kw)
--- <exception caught here> ---
  File "C:\Python22\Lib\site-packages\twisted\spread\pb.py", line 788, in
_sendMessage
    netArgs = self.serialize(args, perspective=perspective, method=message)
  File "C:\Python22\Lib\site-packages\twisted\spread\pb.py", line 742, in
serialize
    return jelly(object, self.security, None, self)
  File "C:\Python22\Lib\site-packages\twisted\spread\jelly.py", line 845, in
jelly
    return _Jellier(taster, persistentStore, invoker).jelly(object)
  File "C:\Python22\Lib\site-packages\twisted\spread\jelly.py", line 451, in
jelly
    sxp.append(self.jelly(item))
  File "C:\Python22\Lib\site-packages\twisted\spread\jelly.py", line 407, in
jelly
    return obj.jellyFor(self)
  File "C:\Python22\Lib\site-packages\twisted\spread\flavors.py", line 434,
in jellyFor
    assert jellier.invoker is self.broker, "You cannot exchange cached
proxies between brokers."
exceptions.AssertionError: You cannot exchange cached proxies between
brokers.

FWIW, I can say that the "self.remote.callRemote("addActor", actor)" line
belongs to the listener (server) side. Both peers make remote calls to each
other. The listener side has a number of Cacheable's and Cacheable's
containing Cacheable's, while the connecting side only exposes one
Referenceable.


- Patrik





From twisted at goldenspud.com  Tue Aug  5 16:37:43 2003
From: twisted at goldenspud.com (Matthew R. Scott)
Date: Tue, 5 Aug 2003 17:37:43 -0500
Subject: [Twisted-Python] possible patch for twisted.mail.protocols
Message-ID: <200308051737.43922.twisted@goldenspud.com>

I am writing a custom POP-toaster type of application using as much of 
existing twisted infrastructure as possible...

I found a spot in the twisted.mail.protocols.VirtualPOP3 class that does the 
"right thing" when you log into the server using APOP but then does the 
"wrong thing" when you try to use traditional USER/PASS login.

Here is the patch for the changes I made to make both do the "right thing". 
Basically, authenticateUserAPOP and authenticateUserPASS now do the same 
thing to get the portal associated with the domain; the only difference now 
is how they call portal.login

This probably explains the user at domain problem I had described last week, to 
which I got a response that assumed that logging in with user at domain was 
working correctly :)

I ran 'trail twisted.test' and no mail-related tests failed...


$ cvs diff -nau
Index: twisted/mail/protocols.py
===================================================================
RCS file: /cvs/Twisted/twisted/mail/protocols.py,v
retrieving revision 1.16
diff -a -u -n -a -u -r1.16 protocols.py
cvs server: conflicting specifications of output style
cvs server: conflicting specifications of output style
--- twisted/mail/protocols.py   15 Jul 2003 00:07:35 -0000      1.16
+++ twisted/mail/protocols.py   5 Aug 2003 22:16:18 -0000
@@ -168,12 +168,17 @@
             )

     def authenticateUserPASS(self, user, password):
-        portal = self.service.defaultPortal()
-        return portal.login(
-            cred.credentials.UsernamePassword(user, password),
-            None,
-            pop3.IMailbox
-        )
+        user, domain = self.lookupDomain(user)
+        try:
+            portal = self.service.lookupPortal(domain)
+        except KeyError:
+            return defer.fail(cred.error.UnauthorizedLogin())
+        else:
+            return portal.login(
+                cred.credentials.UsernamePassword(user, password),
+                None,
+                pop3.IMailbox,
+                )

     def lookupDomain(self, user):
         try:


-- 
Matthew R. Scott
OMAjA / http://www.omaja.com/




From syver-en at online.no  Tue Aug  5 16:38:58 2003
From: syver-en at online.no (Syver Enstad)
Date: 06 Aug 2003 00:38:58 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com>
References: <ud6fk54m0.fsf@online.no>
	<CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com>
Message-ID: <un0en4tml.fsf@online.no>

Donovan Preston <dp at twistedmatrix.com> writes:

> On Tuesday, August 5, 2003, at 11:41 AM, Syver Enstad wrote:
> 
> <snip deferred model>
> 
> > template:
> >
> > <span model="myClass" view="None>
> >   <table model="listing" view="List">
> >         ....
> >   </table>
> > </span>
> 
> Change view="None" to view="Widget". The None widget (DefaultWidget)
> doesn't know anything about Deferreds, and thus can't pause the
> rendering of the rest of the node until the deferred has fired.

Thanks Donovan, that did the trick. Great, I've done some pretty gross
hacks to get around that problem, it was about time I learned how to
do it. 

Regarding views, how do I find out what views one should use? What is
the default view (or isn't there such a thing)? When should one use
Widget and when should one use None? Are there any documents on things
like this?


-- 

Vennlig hilsen 

Syver Enstad




From dp at twistedmatrix.com  Tue Aug  5 16:54:10 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Tue, 5 Aug 2003 15:54:10 -0700
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <un0en4tml.fsf@online.no>
References: <ud6fk54m0.fsf@online.no> <CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com> <un0en4tml.fsf@online.no>
Message-ID: <BA1A791A-C797-11D7-8BDE-000A95864FC4@twistedmatrix.com>

On Tuesday, August 5, 2003, at 3:38 PM, Syver Enstad wrote:

<snip>

> Thanks Donovan, that did the trick. Great, I've done some pretty gross
> hacks to get around that problem, it was about time I learned how to
> do it.
>
> Regarding views, how do I find out what views one should use? What is
> the default view (or isn't there such a thing)? When should one use
> Widget and when should one use None? Are there any documents on things
> like this?

You can look in widgets.py to see what basic widgets are available. 
view="None" is aliased to DefaultWidget by the view-lookup machinery. 
You can see by the volume of code in Widget vs. DefaultWidget that 
widget is a lot more functional. DefaultWidget is supposed to exist 
only to minimize the amount of processing that happens on Widgets that 
aren't doing any work. DefaultWidget doesn't know a thing about 
deferreds but Widget does, which is why you had your problem.

I consider it a bug that you had to say view="Widget" in your case; 
normally you shouldn't be required to know about implementation details 
of Widgets in order to get deferred-model support to work.

Someone could even file a bug which says something like "DefaultWidget 
needs to know about Deferreds"

dp




From twisted at goldenspud.com  Tue Aug  5 17:01:00 2003
From: twisted at goldenspud.com (Matthew R. Scott)
Date: Tue, 5 Aug 2003 18:01:00 -0500
Subject: [Twisted-Python] callback conventions
Message-ID: <200308051801.00365.twisted@goldenspud.com>

Where I work, we have been using a convention of specifying callbacks that do 
not need to be used outside of a certain scope, by defining functions within 
functions.  So far, it has helped us keep our code cleaner-looking and easier 
to browse and maintain.

Example snipped from working code:

class Daemon(pb.Referenceable):
    # ...
    def pingServer(self):
        def success(result):
            self.reactor.callLater(1, self.pingServer)
        def failure(reason):
            self.onDisconnect()
            self.connect()
        try:
            df = self.callRemote('ping')
        except:
            failure('Ping unsuccessful')
        else:
            df.addCallbacks(success, failure)
    # ...

What you would typically have to do the 'classic' way:

class Daemon(pb.Referenceable:
    # ...
    def cb_pingServerSuccess(self, result):
        self.reactor.callLater(1, self.pingServer)
    def cb_pingServerFailure(self, reason):
        self.onDisconnect()
        self.connect()
    def pingServer(self):
        try:
            df = self.callRemote('ping')
        except:
            self.cb_pingServerFailure('Ping unsuccessful')
        else:
            df.addCallbacks(cb_pingServerSuccess, 
                            cb_pingServerFailure)
    # ...

Others may already use this, but we speculated that the reason it is not in 
widespread use is because prior to python2.2 the scoping rules for 
functions-inside-functions made it more difficult to do this easily.

(I personally am not sure as Python 2.2 was the first Python version I've 
developed with)

Comments, questions, mild flames appreciated :) ... 

-- 
Matthew R. Scott
OMAjA / http://www.omaja.com/




From jgoerzen at complete.org  Tue Aug  5 18:57:37 2003
From: jgoerzen at complete.org (John Goerzen)
Date: Tue, 05 Aug 2003 19:57:37 -0500
Subject: [Twisted-Python] Re: Flag storing broke in IMAP4Client
References: <20030801014711.GA21619@complete.org> <20030801020039.GB32720@frobozz>
Message-ID: <87r83zfvr2.fsf@complete.org>

Andrew Bennetts <andrew-twisted at puzzling.org> writes:

> On Thu, Jul 31, 2003 at 08:47:11PM -0500, John Goerzen wrote:
>> 
>> This would likely be a problem for all IMAP commands that issues STORE to the
>> server: setFlags(), addFlags(), removeFlags(), etc.
>
> I *strongly* recommend using either CVS or the latest alpha if you are using
> IMAP.  There has been a lot of work (almost forty checkins) done on it since
> 1.0.6:
>     http://twistedmatrix.com/users/jh.twistd/viewcvs/cgi/viewcvs.cgi/twisted/protocols/imap4.py?cvsroot=Twisted

It hasn't fixed this problem, however.

Am I the only one using IMAP4Client for serious work?  (This is not a
rhetorical or accusatory question; merely an honest inquiry)

Some of these problems I feel like I should be able to fix myself, but
the imap4.py code is sparsely-commented and I fear unintended
side-effects...

-- John




From andrew-twisted at puzzling.org  Tue Aug  5 20:52:11 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Wed, 6 Aug 2003 12:52:11 +1000
Subject: [Twisted-Python] SSL and Perspective Broker
In-Reply-To: <Pine.BSO.4.44.0308051013500.8424-100000@cyclops4.esentire.com>
References: <20030805054300.GB2144@frobozz> <Pine.BSO.4.44.0308051013500.8424-100000@cyclops4.esentire.com>
Message-ID: <20030806025211.GA10960@frobozz>

On Tue, Aug 05, 2003 at 10:15:11AM -0400, Edmund Dengler wrote:
> Thanks! It would be helpful if the version number could appear as a footer
> to each page, including the "How To" sections. With the API changing, it
> is helpful to know if I am at least looking at some sane version :-).

Yes, I agree -- I've added a bug assigned to myself about this:
    http://twistedmatrix.com/bugs/issue176

-Andrew.




From nico at tekNico.net  Wed Aug  6 02:55:49 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Wed, 06 Aug 2003 10:55:49 +0200
Subject: [Twisted-Python] Breaking up long computations
Message-ID: <3F30C295.6010404@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I think I drank enough kool-aid to see that "Deferred are not magical things
that turn long code into short", so I'm trying to break long, cyclical
computations into Twisted-compliant pieces.

Let's say I have a matrix and want to make some computation on its elements
(this does not involve Numeric or numarray, by the way, it's just an example):


data = ((1, 1, 1),
        (2, 2, 2),
        (3, 3, 3))

sqrSum = 0
for row in data:
    for num in row:
        sqrSum += num*num
print sqrSum


To be able to make one operation per event, I break the loops using iter()
and reactor.callLater(), and end up with this, actually working, script:


from twisted.internet import reactor

def computeRow(sqrSum, rowIter, dataIter):
    try:
        num = rowIter.next()
    except StopIteration:
        reactor.callLater(0, computeData, sqrSum, dataIter)
    else:
        sqrSum += num*num
        reactor.callLater(0, computeRow, sqrSum, rowIter, dataIter)

def computeData(sqrSum, dataIter):
    try:
        row = dataIter.next()
    except StopIteration:
        print sqrSum
        reactor.stop()
    else:
        rowIter = iter(row)
        reactor.callLater(0, computeRow, sqrSum, rowIter, dataIter)

data = ((1, 1, 1),
        (2, 2, 2),
        (3, 3, 3))
sqrSum = 0
dataIter = iter(data)
computeData(sqrSum, dataIter)
reactor.run()


(In both cases, the answer is 42. :^) )

Apparently, this allows Twisted to process any other events that may happen
in the middle of the computation. But I wonder, since I'm not using threads,
and Twisted runs the reactor and my code in the same process/thread, how
could such events get inserted into the queue?

I mean, if I'm appending non-delaying events from inside the computation,
one after the other, how can anything else get a chance to get started
*before* the computation completes?

Obviously, in such a case there would be no point in this exercise in
decomposing, so I feel I'm overlooking something fundamental.


- --
"Unlike some other scripting languages, Python syntax tends to be in
words rather than typographical syntax - it's very unlikely you'll be
writing lines of code that look like comic book curse words. As a result,
when you have to come back to your code six months later, odds are you
will still be able to understand it."  Samuele Pedroni and Noel Rappin

Nicola Larosa - nico at tekNico.net
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/MMKTXv0hgDImBm4RAgBLAJ9WdmIDeOSPJYLtYLQB5unbuhPajACeKzhl
s2bZSXJzeSEXLrJlpMYHtZE=
=9JKY
-----END PGP SIGNATURE-----





From syver at inout.no  Wed Aug  6 03:47:12 2003
From: syver at inout.no (Syver Enstad)
Date: 06 Aug 2003 11:47:12 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <BA1A791A-C797-11D7-8BDE-000A95864FC4@twistedmatrix.com>
References: <ud6fk54m0.fsf@online.no>
	<CD32BE64-C77A-11D7-888A-000A95864FC4@twistedmatrix.com>
	<un0en4tml.fsf@online.no>
	<BA1A791A-C797-11D7-8BDE-000A95864FC4@twistedmatrix.com>
Message-ID: <ud6fjnmn3.fsf@inout.no>

I found a bug by the way:

At line: 176 in lookupSubmodel
                if isinstance(currentModel, defer.Deferred):
                    currentModel.addCallback(adaptToIModel,
                                             element, parentModel)
                    return currentModel

The variable parentModel is not defined.




From andrew-twisted at puzzling.org  Wed Aug  6 03:50:27 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Wed, 6 Aug 2003 19:50:27 +1000
Subject: [Twisted-Python] Breaking up long computations
In-Reply-To: <3F30C295.6010404@tekNico.net>
References: <3F30C295.6010404@tekNico.net>
Message-ID: <20030806095027.GA11724@frobozz>

On Wed, Aug 06, 2003 at 10:55:49AM +0200, Nicola Larosa wrote:
[...]
> To be able to make one operation per event, I break the loops using iter()
> and reactor.callLater(), and end up with this, actually working, script:
> 
> 
> from twisted.internet import reactor
> 
> def computeRow(sqrSum, rowIter, dataIter):
>     try:
>         num = rowIter.next()
>     except StopIteration:
>         reactor.callLater(0, computeData, sqrSum, dataIter)
>     else:
>         sqrSum += num*num
>         reactor.callLater(0, computeRow, sqrSum, rowIter, dataIter)
> 
> def computeData(sqrSum, dataIter):
>     try:
>         row = dataIter.next()
>     except StopIteration:
>         print sqrSum
>         reactor.stop()
>     else:
>         rowIter = iter(row)
>         reactor.callLater(0, computeRow, sqrSum, rowIter, dataIter)
> 
> data = ((1, 1, 1),
>         (2, 2, 2),
>         (3, 3, 3))
> sqrSum = 0
> dataIter = iter(data)
> computeData(sqrSum, dataIter)
> reactor.run()

Note that both computeRow and computeData return immediately.  (Well,
computeRow does a tiny amount of work, but no matter how big your data
matrix is, computeRow will always do a small but constant amount per call,
which is the main thing)

> Apparently, this allows Twisted to process any other events that may happen
> in the middle of the computation. But I wonder, since I'm not using threads,
> and Twisted runs the reactor and my code in the same process/thread, how
> could such events get inserted into the queue?

Precisely because your functions return control to the reactor repeatedly,
rather than doing it all in one hit, there is now room for the reactor to
process any other events that need processing, if any.

> I mean, if I'm appending non-delaying events from inside the computation,
> one after the other, how can anything else get a chance to get started
> *before* the computation completes?

The key here is that reactor.callLater(0, func) will *always* cause the
function to be called on the next iteration of the reactor, even though it
can be considered already due, so that other events get a chance to happen.

E.g., consider a network server that is doing the above calculation in
addition to serving some network clients.  Network events can happen at any
time, they are caused by things completely external to your process, so it's
entirely possible that some data might arrive while computeRow is doing its
subset of the calculation.  Then, when computeRow returns, and the reactor
will do something like this:
    - check that there are no more scheduled events that need to be run *in
      this iteration*.  It *won't* pull anything off the delayed call queue
      that wasn't there before it started processing delayed calls.  Let's
      assume there's nothing else to do here.  [I'm guessing this is the bit
      you weren't getting, but I'll tell complete story anyway, just in
      case]
    - then the reactor will finish that iteration, so it'll start a new one.
    - it'll peek at the first thing on the delayed call queue, to see how
      long until something needs to be called
    - it will then check for IO events using select (or poll, or kqueue,
      or ...).  It passes the time to the next event as the timeout for the
      select call, so if there's been no unprocessed network activity since
      the last iteration, it will block until that timeout, or there is some
      activity (which ever happens first).
    - If there's any IO events to be processed, it calls the relevant event
      handlers.  In my example above, perhaps a message from a client just
      arrived, this will lead (via a few layers of abstraction) to a
      protocol's dataReceived method being called (which in turn may call a
      'messageReceived' handler and spawn a database query, or something).
    - After the IO events have been processed, it will finally turn its
      attention back to the delayed call queue, find all of them that are
      now due, and run those.
    - And then the next reactor iteration will happen.

So, every time you call reactor.callLater(0, func) and return back to the
reactor, rather than doing the work immediately, you're giving the reactor a
chance to breath and catch up on any other events that have been happening
-- but it will get back to your work as soon as it has.  If there's nothing
else happening, then your task will be getting 100% of the CPU time, minus the
overhead of jumping back-and-forth between the reactor and your functions
periodically to make sure nothing else needs Twisted's attention.

I hope I've made things clearer, rather than just confusing them :)

-Andrew.




From syver at inout.no  Wed Aug  6 03:50:12 2003
From: syver at inout.no (Syver Enstad)
Date: 06 Aug 2003 11:50:12 +0200
Subject: [Twisted-Python] callback conventions
In-Reply-To: <200308051801.00365.twisted@goldenspud.com>
References: <200308051801.00365.twisted@goldenspud.com>
Message-ID: <u7k5rnmi3.fsf@inout.no>

"Matthew R. Scott" <twisted at goldenspud.com> writes:

> Others may already use this, but we speculated that the reason it is not in 
> widespread use is because prior to python2.2 the scoping rules for 
> functions-inside-functions made it more difficult to do this easily.

That is true. Out of the box only 2.2 an onwards have nested scopes
(you could enable them with a from __future__ in 2.1

That said coincidences had it that I just starting doing local
function as deferred callbacks yesterday.




From tv at twistedmatrix.com  Wed Aug  6 02:08:23 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Wed, 6 Aug 2003 11:08:23 +0300
Subject: [Twisted-Python] Unruly Callback Code
In-Reply-To: <20030805183206.30A8E38D0F@www.fastmail.fm>
References: <20030805140231.A321218591@www.fastmail.fm> <20030805160244.GA32531@lapdog> <20030805183206.30A8E38D0F@www.fastmail.fm>
Message-ID: <20030806080823.GB1777@lapdog>

On Tue, Aug 05, 2003 at 12:32:06PM -0600, Justin Johnson wrote:
> 		def gotObject(perspective, vobs, group, original_site, sites):
> 			d = perspective.callRemote("mkvob", vobs, group)
> 			d.addCallback(renameReplica, perspective, vobs, original_site)
> 			d.addCallback(mkRepExport, perspective, vobs, sites)
> 			d.addCallback(mkRepImport, perspective, vobs, sites)
> 			d.addErrback(log.err)
> 			d.addBoth(_stop)
> 			return d
> 
> 		# Connect to the server and start the chain of deferreds
> 		d = self.connectToServer(config.siteToServer[original_site])
> 		d.addCallback(gotObject, vobs, group, original_site, sites)
> 		reactor.run()

	I'd do stopping and error handling near reactor.run()

		def gotObject(perspective, vobs, group, original_site, sites):
			d = perspective.callRemote("mkvob", vobs, group)
			d.addCallback(renameReplica, perspective, vobs, original_site)
			d.addCallback(mkRepExport, perspective, vobs, sites)
			d.addCallback(mkRepImport, perspective, vobs, sites)
			return d

		# Connect to the server and start the chain of deferreds
		d = self.connectToServer(config.siteToServer[original_site])
		d.addCallback(gotObject, vobs, group, original_site, sites)
		d.addErrback(log.err)
		d.addBoth(_stop)
		reactor.run()

-- 
:(){ :|:&};:



From nico at tekNico.net  Wed Aug  6 04:18:42 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Wed, 06 Aug 2003 12:18:42 +0200
Subject: [Twisted-Python] Breaking up long computations
In-Reply-To: <20030806095027.GA11724@frobozz>
References: <3F30C295.6010404@tekNico.net> <20030806095027.GA11724@frobozz>
Message-ID: <3F30D602.9020406@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> - check that there are no more scheduled events that need to be run *in
>   this iteration*.  It *won't* pull anything off the delayed call queue
>   that wasn't there before it started processing delayed calls.  Let's
>   assume there's nothing else to do here.  [I'm guessing this is the bit
>   you weren't getting, but I'll tell complete story anyway, just in case]
> - then the reactor will finish that iteration, so it'll start a new one.
> - it'll peek at the first thing on the delayed call queue, to see how
>   long until something needs to be called
> - it will then check for IO events using select (or poll, or kqueue, or
>   ...).  It passes the time to the next event as the timeout for the
>   select call, so if there's been no unprocessed network activity since
>   the last   iteration, it will block until that timeout, or there is
>   some activity (which ever happens first).
> - If there's any IO events to be processed, it calls the relevant event
>   handlers.  In my example above, perhaps a message from a client just
>   arrived, this will lead (via a few layers of abstraction) to a
>   protocol's dataReceived method being called (which in turn may call a
>   'messageReceived' handler and spawn a database query, or something).
> - After the IO events have been processed, it will finally turn its
>   attention back to the delayed call queue, find all of them that are now
>   due, and run those.
> - And then the next reactor iteration will happen.

So, the reactor goes back and forth between the select and the call queue at
each iteration, that's what I was overlooking.


> I hope I've made things clearer, rather than just confusing them :)

Yes, you've been most helpful, thanks.


- --
"Unlike some other scripting languages, Python syntax tends to be in
words rather than typographical syntax - it's very unlikely you'll be
writing lines of code that look like comic book curse words. As a result,
when you have to come back to your code six months later, odds are you
will still be able to understand it."  Samuele Pedroni and Noel Rappin

Nicola Larosa - nico at tekNico.net
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/MNYAXv0hgDImBm4RAp10AJ0R+FFqkh5Oeb314OX24FZvaIPYQgCfV97q
IyHhf9ugv8o/SdBZqdJUxpw=
=bUvg
-----END PGP SIGNATURE-----





From justinjohnson at fastmail.fm  Wed Aug  6 06:03:42 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Wed, 06 Aug 2003 06:03:42 -0600
Subject: [Twisted-Python] Unruly Callback Code
In-Reply-To: <20030806080823.GB1777@lapdog>
References: <20030805140231.A321218591@www.fastmail.fm> <20030805160244.GA32531@lapdog> <20030805183206.30A8E38D0F@www.fastmail.fm> <20030806080823.GB1777@lapdog>
Message-ID: <20030806120342.2D22C38C91@www.fastmail.fm>

Thanks for all your help.

On Wed, 6 Aug 2003 11:08:23 +0300, "Tommi Virtanen"
<tv at twistedmatrix.com> said:
> On Tue, Aug 05, 2003 at 12:32:06PM -0600, Justin Johnson wrote:
> > 		def gotObject(perspective, vobs, group, original_site, sites):
> > 			d = perspective.callRemote("mkvob", vobs, group)
> > 			d.addCallback(renameReplica, perspective, vobs, original_site)
> > 			d.addCallback(mkRepExport, perspective, vobs, sites)
> > 			d.addCallback(mkRepImport, perspective, vobs, sites)
> > 			d.addErrback(log.err)
> > 			d.addBoth(_stop)
> > 			return d
> > 
> > 		# Connect to the server and start the chain of deferreds
> > 		d = self.connectToServer(config.siteToServer[original_site])
> > 		d.addCallback(gotObject, vobs, group, original_site, sites)
> > 		reactor.run()
> 
> 	I'd do stopping and error handling near reactor.run()
> 
> 		def gotObject(perspective, vobs, group, original_site, sites):
> 			d = perspective.callRemote("mkvob", vobs, group)
> 			d.addCallback(renameReplica, perspective, vobs, original_site)
> 			d.addCallback(mkRepExport, perspective, vobs, sites)
> 			d.addCallback(mkRepImport, perspective, vobs, sites)
> 			return d
> 
> 		# Connect to the server and start the chain of deferreds
> 		d = self.connectToServer(config.siteToServer[original_site])
> 		d.addCallback(gotObject, vobs, group, original_site, sites)
> 		d.addErrback(log.err)
> 		d.addBoth(_stop)
> 		reactor.run()
> 
> -- 
> :(){ :|:&};:
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From rdrb at 123.cl  Wed Aug  6 07:50:04 2003
From: rdrb at 123.cl (RITA Y/O RODRIGO DIAZ Y/O BENENSON)
Date: Wed, 06 Aug 2003 09:50:04 -0400
Subject: [Twisted-Python] ParagraphText refuse to work
Message-ID: <9c99a9bb05.9bb059c99a@noborrar.co.cl>

Hi!

I have posted this question some time ago, but I got no answer.
I'm making a very simple Woven program that publish over web the content of a complex objects structure. So I created an IModel interface for the object.

The problem that I have is that some elements of the model return Strings. So I use the ParagraphText view. But it does not work as espected.

It should render "a\nb\nc" as:

<p>a</p><p>b</p><p>c</p>

but I only get:

<p>abc</p>

if I change ParagraphText by a Text view I got:

a
b
c


So it seems that the data arrive fine, but is not render as expected.

Where is the problem ?

I have checked the CVS but the code looks the same as for Twisted 1.0.6 (and with 1.0.5 the behaviour was the same).

I suppose that I'm doing something wrong. Please, support...


RodrigoB.








From lheller at atdesk.com  Wed Aug  6 08:54:24 2003
From: lheller at atdesk.com (Lance Heller)
Date: Wed, 06 Aug 2003 10:54:24 -0400
Subject: [Twisted-Python] gtk manhole
Message-ID: <200308061454.h76EsOui013568@localhost.localdomain>

Hello,
	
	While I've some experience with Python, I'm new to twisted.
I've just completed an install of Twisted-1.0.6 on my RH8.0 system:

Linux version 2.4.18-26.8.0smp (bhcompile at daffy.perf.redhat.com) (gcc version 3.2 20020903 (Red Hat Linux 8.0 3.2-7)) #1 SMP Mon Feb 24 09:44:00 EST 2003

Python 2.2.1 (#1, Aug 30 2002, 12:15:30) 
[GCC 3.2 20020822 (Red Hat Linux Rawhide 3.2-4)] on linux2
Type "help", "copyright", "credits" or "license" for more information.


However I'm having a problem getting manhole up and going:

programmer130:../lheller-1388: manhole
Traceback (most recent call last):
  File "/usr/bin/manhole", line 34, in ?
    manhole.run()
  File "/usr/lib/python2.2/site-packages/twisted/scripts/manhole.py", line 114, in run
    run(config)
  File "/usr/lib/python2.2/site-packages/twisted/scripts/manhole.py", line 124, in run_gtk1
    from twisted.spread.ui import gtkutil
  File "/usr/lib/python2.2/site-packages/twisted/spread/ui/gtkutil.py", line 62, in ?
    class GetString(gtk.GtkWindow):
AttributeError: 'module' object has no attribute 'GtkWindow'


I've installed these components in addition to Twisted:
pyOpenSSL-0.5.1,  pycrypto-1.9a6,  pyserial-1.19

and have these packages on the system:

gtk-engines-0.11-13
usermode-gtk-1.63-1
gtk+-1.2.10-22
gtkam-0.1.4-6
gnome-python2-gtkhtml2-1.99.11-8
pygtk2-1.99.12-7
rep-gtk-0.16.0.90-4
gtk2-2.0.6-8
authconfig-gtk-4.2.12-3
gtk2-engines-1.9.0-4
gtkhtml-devel-1.0.4-3
gtkhtml2-2.0.1-2
mtr-gtk-0.49-7
gtk+-devel-1.2.10-22
pygtk2-libglade-1.99.12-7
gtk2-devel-2.0.6-8
pygtk2-devel-1.99.12-7

pygtk2-1.99.12-7
python-devel-2.2.1-17
python-2.2.1-17
pygtk2-libglade-1.99.12-7
python-tools-2.2.1-17
pyOpenSSL-0.5.0.91-1
rpm-python-4.1-1.06
mod_python-3.0.0-10


What am I missing here that disables manholes GTK functionality?

Any pointers or suggestions you may have will be greatly appreciated.


Lance


----------------------------------------------------------------------
   Lance Heller                  |      ATD
   Software Engineer             |      11 eWall Street
   lheller at atdesk.com            |      Mount Pleasant, SC
   voice: (834)789-2146          |      29464, USA
   fax:   (834)789-2010          |      www.atdesk.com
----------------------------------------------------------------------

-- 
047CF18A: 55F1 FF14 0620 1B7F A82E  B5F8 3C94 02F7 047C F18A
8B7C7901: 424F 17DB 5683 6A18 CDD6  6C65 5E1E 9F86 8B7C 7901
5F648A7E: 8B86 24FB 1CD9 C997 C2A3  9E5D 16BD 5F7F 5F64 8A7E


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 228 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030806/ff637da7/attachment.sig>

From itamar at itamarst.org  Wed Aug  6 08:58:26 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 6 Aug 2003 10:58:26 -0400
Subject: [Twisted-Python] Breaking up long computations
In-Reply-To: <3F30C295.6010404@tekNico.net>
References: <3F30C295.6010404@tekNico.net>
Message-ID: <20030806105826.6aaa5989.itamar@itamarst.org>

On Wed, 06 Aug 2003 10:55:49 +0200
Nicola Larosa <nico at tekNico.net> wrote:

> Let's say I have a matrix and want to make some computation on its
> elements(this does not involve Numeric or numarray, by the way, it's
> just an example):

If it does, you should use a thread, since hopefully they release the
global interpreter lock and thus will be faster on SMP machines, and
maybe even regular machines.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From R.Livsey at cache-22.co.uk  Wed Aug  6 09:18:53 2003
From: R.Livsey at cache-22.co.uk (RLivsey)
Date: Wed, 06 Aug 2003 16:18:53 +0100
Subject: [Twisted-Python] Advice on starting a project
Message-ID: <3F311C5D.2000405@cache-22.co.uk>

Hi, I'm fairly new to python and Twisted (ok fairly is an 
understatement) so bare with me :o)

I'm about to start development of a chat style system.
The basic system will be setup as follows:

A number of chat clients designed/programmed in FlashMX.
A server using Twisted.

The clients will communicate with each other via the server using 
XML-sockets. I have managed to get a Flash app communicating with the 
server based on the echo sample whereby Flash sends a message and then 
receives a message. This works fine.

However I am now trying to figure out how to get the clients to talk to 
each other and I cant work out how it will work.

How would I get a list of clients currently connected so that I can send 
a message from one client to its recipient?

Any advice on what to look at and any examples that would be useful?

The final app will use the abilities of Twisted more by having the 
ability for admins to monitor activity etc on IRC and telnet etc.. but 
for the moment I'm just trying to figure out the basics.

Cheers.

-- 
R.Livsey
Incutio Web Developer
[ PHP | Perl | Java | C# ]
www.cache-22.co.uk
www.incutio.com






From rich at enflyer.com  Wed Aug  6 11:10:20 2003
From: rich at enflyer.com (Rich Cavanaugh)
Date: Wed, 6 Aug 2003 13:10:20 -0400
Subject: [Twisted-Python] ParagraphText refuse to work
In-Reply-To: <9c99a9bb05.9bb059c99a@noborrar.co.cl>
Message-ID: <DBBCDB12-C830-11D7-84C2-000A95890854@enflyer.com>

Attached is a minor patch to widgets.py that should correct this. I 
haven't tested this though.

rich
-------------- next part --------------
A non-text attachment was scrubbed...
Name: widgets.py-paratext.patch
Type: application/applefile
Size: 1435 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030806/5fd4e540/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: widgets.py-paratext.patch
Type: application/octet-stream
Size: 812 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030806/5fd4e540/attachment-0002.obj>
-------------- next part --------------


On Wednesday, August 6, 2003, at 09:50 AM, RITA Y/O RODRIGO DIAZ Y/O 
BENENSON wrote:

> Hi!
>
> I have posted this question some time ago, but I got no answer.
> I'm making a very simple Woven program that publish over web the 
> content of a complex objects structure. So I created an IModel 
> interface for the object.
>
> The problem that I have is that some elements of the model return 
> Strings. So I use the ParagraphText view. But it does not work as 
> espected.
>
> It should render "a\nb\nc" as:
>
> <p>a</p><p>b</p><p>c</p>
>
> but I only get:
>
> <p>abc</p>
>
> if I change ParagraphText by a Text view I got:
>
> a
> b
> c
>
>
> So it seems that the data arrive fine, but is not render as expected.
>
> Where is the problem ?
>
> I have checked the CVS but the code looks the same as for Twisted 
> 1.0.6 (and with 1.0.5 the behaviour was the same).
>
> I suppose that I'm doing something wrong. Please, support...
>
>
> RodrigoB.
>
>
>
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

From radix at twistedmatrix.com  Wed Aug  6 12:13:38 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Wed, 6 Aug 2003 14:13:38 -0400
Subject: [Twisted-Python] Deferred.setTimeout sucks
Message-ID: <20030806181338.GD11752@radii>

I've implemented a better API than setTimeout for
Deferreds. Description and patch are here:

http://twistedmatrix.com/bugs/issue178

If it's accepted, I'll update HOWTOs and usages of setTimeout.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From peter at engcorp.com  Wed Aug  6 12:20:45 2003
From: peter at engcorp.com (Peter Hansen)
Date: Wed, 06 Aug 2003 14:20:45 -0400
Subject: [Twisted-Python] Re: [Zope3-dev] twisted zope
References: <69427200-C17B-11D7-A7D5-000393C9700E@twistedmatrix.com>
Message-ID: <3F3146FD.ACC2C7CF@engcorp.com>

Glyph Lefkowitz wrote:
> 
> On Monday, July 28, 2003, at 01:20 PM, Gary Poster wrote:
> 
> > Oh yeah, forgot about that.  I've seen several discussions of the
> > licensing on the Twisted list... Maybe Phil Eby's implementation is
> > the only way out of that one.
> 
> The whole point of those discussions has generally been that the
> current structure is important to make relicensing a possibility :-).
> 
> While twisted as a whole is being very actively (one might even say
> "agressively") developed, some portions of the framework, like the core
> reactor, seem to be extremely stable at this point.
> 
> (Please, chime in if you disagree.)

<chime chime>

I mentioned in the past a concern that the default SelectReactor 
was being created with default variables that bind to globals for
the read and write lists that are passed to select.select().  Among
other things, it's ugly as sin, probably doesn't help performance 
much anyway, prevents creating multiple *separate* reactors (very
useful in, for example, proper unit and acceptance testing), and
has caused us at least some trouble with respect to stopping and
restarting reactors (because the globals aren't cleaned out 
properly at any point).

(Disclaimer: these comments are not based on the current Twisted,
but release 1.0.3 or 4, as I recall, but if this part has really
been "stable" then I doubt anything has changed much here.)

The last (first) time I suggested changes, the answer was a fairly
clear "we don't plan to change this ever", but if there's any
willingness to consider changes, then even the core reactor
might not be considered "extremely stable" at this point.

-Peter



From itamar at itamarst.org  Wed Aug  6 12:40:24 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 6 Aug 2003 14:40:24 -0400
Subject: [Twisted-Python] Re: [Zope3-dev] twisted zope
In-Reply-To: <3F3146FD.ACC2C7CF@engcorp.com>
References: <69427200-C17B-11D7-A7D5-000393C9700E@twistedmatrix.com>
	<3F3146FD.ACC2C7CF@engcorp.com>
Message-ID: <20030806144024.37bbd84e.itamar@itamarst.org>

On Wed, 06 Aug 2003 14:20:45 -0400
Peter Hansen <peter at engcorp.com> wrote:

> The last (first) time I suggested changes, the answer was a fairly
> clear "we don't plan to change this ever", but if there's any
> willingness to consider changes, then even the core reactor
> might not be considered "extremely stable" at this point.

The internals may change in this case, but the *API* will be identical.
So as far as users of Twisted are concerned it won't matter.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From itamar at itamarst.org  Wed Aug  6 12:41:27 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 6 Aug 2003 14:41:27 -0400
Subject: Please add bugs and patches to the issue tracker (was
 [Twisted-Python] ParagraphText refuse to work)
In-Reply-To: <DBBCDB12-C830-11D7-84C2-000A95890854@enflyer.com>
References: <9c99a9bb05.9bb059c99a@noborrar.co.cl>
	<DBBCDB12-C830-11D7-84C2-000A95890854@enflyer.com>
Message-ID: <20030806144127.2fce33f8.itamar@itamarst.org>

On Wed, 6 Aug 2003 13:10:20 -0400
Rich Cavanaugh <rich at enflyer.com> wrote:

> Attached is a minor patch to widgets.py that should correct this. I 
> haven't tested this though.

Could you please add patches to the tracker?

http://www.twistedmatrix.com/bugs/


-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From twisted at goldenspud.com  Wed Aug  6 13:10:31 2003
From: twisted at goldenspud.com (Matthew R. Scott)
Date: Wed, 6 Aug 2003 14:10:31 -0500
Subject: [Twisted-Python] possible patch for twisted.mail.protocols
In-Reply-To: <200308051737.43922.twisted@goldenspud.com>
References: <200308051737.43922.twisted@goldenspud.com>
Message-ID: <200308061410.31301.twisted@goldenspud.com>

On Tue 2003-08-05 17:37, Matthew R. Scott wrote:
> Here is the patch for the changes I made to make both do the "right thing".

I noticed the trend is to upload patches to the bug tracker, so I've done that 
with this patch.


-- 
Matthew R. Scott
OMAjA / http://www.omaja.com/




From glyph at twistedmatrix.com  Wed Aug  6 13:57:29 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 6 Aug 2003 14:57:29 -0500
Subject: [Twisted-Python] Re: Flag storing broke in IMAP4Client
In-Reply-To: <87r83zfvr2.fsf@complete.org>
Message-ID: <35DCCDFC-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>

On Tuesday, August 5, 2003, at 07:57 PM, John Goerzen wrote:

> Am I the only one using IMAP4Client for serious work?  (This is not a
> rhetorical or accusatory question; merely an honest inquiry)

Nope.  We are too.

	http://www.divmod.org/

However, we are waiting for the maintainer to get back from vacation.




From glyph at twistedmatrix.com  Wed Aug  6 13:59:09 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 6 Aug 2003 14:59:09 -0500
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <ud6fjnmn3.fsf@inout.no>
Message-ID: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>

On Wednesday, August 6, 2003, at 04:47 AM, Syver Enstad wrote:

> I found a bug by the way:

Enter it into the bugtracker, please?  http://www.twistedmatrix.com/bugs




From peter at engcorp.com  Wed Aug  6 14:06:50 2003
From: peter at engcorp.com (Peter Hansen)
Date: Wed, 06 Aug 2003 16:06:50 -0400
Subject: [Twisted-Python] Re: [Zope3-dev] twisted zope
References: <69427200-C17B-11D7-A7D5-000393C9700E@twistedmatrix.com>
		<3F3146FD.ACC2C7CF@engcorp.com> <20030806144024.37bbd84e.itamar@itamarst.org>
Message-ID: <3F315FDA.F3BF5B70@engcorp.com>

Itamar Shtull-Trauring wrote:
> 
> On Wed, 06 Aug 2003 14:20:45 -0400
> Peter Hansen <peter at engcorp.com> wrote:
> 
> > The last (first) time I suggested changes, the answer was a fairly
> > clear "we don't plan to change this ever", but if there's any
> > willingness to consider changes, then even the core reactor
> > might not be considered "extremely stable" at this point.
> 
> The internals may change in this case, but the *API* will be identical.
> So as far as users of Twisted are concerned it won't matter.

There's certainly little need for an API change to make this work
better, except for the odd existing method which does not take
an external reactor argument but simply finds the global one 
magically and uses it.  I believe there was a transition happening
to clean this up so that all such methods allowed a reactor to
be passed in, so other than this aspect, I agree no API change 
should happen (nor is one needed).

-Peter



From syver-en at online.no  Wed Aug  6 17:42:33 2003
From: syver-en at online.no (Syver Enstad)
Date: 07 Aug 2003 01:42:33 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>
References: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>
Message-ID: <u65la5p5i.fsf@online.no>

Glyph Lefkowitz <glyph at twistedmatrix.com> writes:

> On Wednesday, August 6, 2003, at 04:47 AM, Syver Enstad wrote:
> 
> > I found a bug by the way:
> 
> Enter it into the bugtracker, please?
> http://www.twistedmatrix.com/bugs

Done.

Should this work?

In some template:
    <tr>
        <td model="deferredModel/One" view="Text">List item here</td>
        <td model="deferredModel/Two" view="Text">List item here</td>
    </tr>

class MyModel(MethodModel):
    def wmfactory_deferredModel(self, request):
        .....
        return deferred # promises to be a dictionary


As it is now this fails in lookupSubmodel / getSubmodel, because the
DeferredWrapper has not got a submodel named One.



-- 

Vennlig hilsen 

Syver Enstad




From edmundd at eSentire.com  Wed Aug  6 17:42:17 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Wed, 6 Aug 2003 19:42:17 -0400 (EDT)
Subject: [Twisted-Python] Woven and XSL
Message-ID: <Pine.BSO.4.44.0308061938180.25785-100000@cyclops4.esentire.com>

Hi all!

Having a look at the Woven component, and I have a question. Does Woven
support some form of XSL transformations, or would I need to "emulate"
this feature by using extremely simple XHTML pages (basically begin/end
HTML with a model/view call), perform said transformations internally, and
return a ready to render DOM model?

The reason I ask is we are using some fairly complex XSL code to render
pages to maintain a consistent look and feel (things such as placing the
alignment in the header of a table, which will then be fed down through
each cell unless overridden). To try and do things with XHTML would
require replicating a lot of format code manually throughout the page. Is
there a different model with Woven that I should be looking at?

Regards!
Ed





From itamar at itamarst.org  Wed Aug  6 17:50:27 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 6 Aug 2003 19:50:27 -0400
Subject: [Twisted-Python] Woven and XSL
In-Reply-To: <Pine.BSO.4.44.0308061938180.25785-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308061938180.25785-100000@cyclops4.esentire.com>
Message-ID: <20030806195027.48e8dfbd.itamar@itamarst.org>

On Wed, 6 Aug 2003 19:42:17 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> require replicating a lot of format code manually throughout the page.
> Is there a different model with Woven that I should be looking at?

Look at the examples for using widgets.ExpandMacro in the mailing list
archives (same approach as ZPT's METAL).

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From dp at twistedmatrix.com  Wed Aug  6 20:44:01 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Wed, 6 Aug 2003 19:44:01 -0700
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <u65la5p5i.fsf@online.no>
References: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com> <u65la5p5i.fsf@online.no>
Message-ID: <008ED3F1-C881-11D7-9429-000A95864FC4@twistedmatrix.com>

On Wednesday, August 6, 2003, at 4:42 PM, Syver Enstad wrote:
>
> Should this work?
>
> In some template:
>     <tr>
>         <td model="deferredModel/One" view="Text">List item here</td>
>         <td model="deferredModel/Two" view="Text">List item here</td>
>     </tr>
>
> class MyModel(MethodModel):
>     def wmfactory_deferredModel(self, request):
>         .....
>         return deferred # promises to be a dictionary
>
>
> As it is now this fails in lookupSubmodel / getSubmodel, because the
> DeferredWrapper has not got a submodel named One.

This will not work, and I can't justify the effort required to make it 
work. Do it like this instead:

<tr model="deferredModel" view="None">
	<td model="One">...</td>
	<td model="Two">...</td>
</tr>

dp




From tim.andrews at adpro.com.au  Wed Aug  6 23:38:33 2003
From: tim.andrews at adpro.com.au (Tim Andrews)
Date: Thu, 7 Aug 2003 15:08:33 +0930
Subject: [Twisted-Python] trouble with registering an IModel adapter
Message-ID: <MIEKLAIKJGMEAEJNJKJAEEAKCBAA.tim.andrews@adpro.com.au>

Hi folks,

I copied the following code from the manual, but keep on getting exceptions.
Any clues?

Thanks,

Tim

# Demonstration of registering an IModel adapter
#
# Copied from "The Twisted Documentation" section 7.3.5
#
# Raises the following exception:
#
#   exceptions.AttributeError: MyDataModel instance has no attribute 'orig'

from twisted.web.woven import model, page

template = """
  <html>
   <body>
     <h2 model="something" view="Text">something stuff goes here!</h2>
    </body>
  </html>
"""

class MyData:
  def __init__(self, something=""):
    self.something = something

class MyDataModel(model.MethodModel):
  def wmfactory_something(self, request):
    return self.orig.something

from twisted.python import components
from twisted.web.woven import interfaces

components.registerAdapter(MyDataModel, MyData, interfaces.IModel)

resource = page.Page(MyDataModel(), template=template)




From dp at twistedmatrix.com  Wed Aug  6 23:46:57 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Wed, 6 Aug 2003 22:46:57 -0700
Subject: [Twisted-Python] trouble with registering an IModel adapter
In-Reply-To: <MIEKLAIKJGMEAEJNJKJAEEAKCBAA.tim.andrews@adpro.com.au>
References: <MIEKLAIKJGMEAEJNJKJAEEAKCBAA.tim.andrews@adpro.com.au>
Message-ID: <8EDDE785-C89A-11D7-9429-000A95864FC4@twistedmatrix.com>

On Wednesday, August 6, 2003, at 10:38 PM, Tim Andrews wrote:

> Hi folks,
>
> I copied the following code from the manual, but keep on getting 
> exceptions.
> Any clues?
>
> Thanks,
>
> Tim
>
> # Demonstration of registering an IModel adapter
> #
> # Copied from "The Twisted Documentation" section 7.3.5
> #
> # Raises the following exception:
> #
> #   exceptions.AttributeError: MyDataModel instance has no attribute 
> 'orig'

That example must be very, very old. It should be 'original', like any 
other Adapter, not 'orig'.

dp




From tard at 2kservices.com  Thu Aug  7 01:00:45 2003
From: tard at 2kservices.com (Alexander Zhukov)
Date: Thu, 7 Aug 2003 11:00:45 +0400
Subject: [Twisted-Python] Advice on starting a project
In-Reply-To: <3F311C5D.2000405@cache-22.co.uk>
References: <3F311C5D.2000405@cache-22.co.uk>
Message-ID: <481364389338.20030807110045@2kservices.com>

Hello RLivsey,

Wednesday, August 6, 2003, 7:18:53 PM, you wrote:

R> How would I get a list of clients currently connected so that I can send
R> a message from one client to its recipient?
R> Any advice on what to look at and any examples that would be useful?

I'm new to twisted too and work on a similar project now (twisted
on serverside and flash and C# on clientside).

I'm not sure if it's the right way in twisted, but this example
receivs lines from one connection and writes them to all other
connections.

from twisted.internet.protocol import Factory
from twisted.protocols.basic import LineReceiver
from twisted.internet import reactor

class Chat(LineReceiver):
    def connectionMade(self):
        self.factory.addClient(self)

    def lineReceived(self,line):
        self.factory.sendAll(line)

    def connectionLost(self, reason):
        self.factory.removeClient(self)

class MyFactory(Factory):

    protocol = Chat

    def startFactory(self):
        self.clients = []

    def addClient(self,cli):
        self.clients.append(cli)

    def removeClient(self,cli):
        self.clients.remove(cli)

    def sendAll(self,msg):
        [cli.sendLine(msg) for cli in self.clients]

def main():
    f = MyFactory()
    reactor.listenTCP(8000, f)
    reactor.run()

if __name__ == '__main__':
    main()

-- 
Best regards,
 Alexander                            mailto:tard at 2kservices.com




From syver at inout.no  Thu Aug  7 04:03:48 2003
From: syver at inout.no (Syver Enstad)
Date: 07 Aug 2003 12:03:48 +0200
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <008ED3F1-C881-11D7-9429-000A95864FC4@twistedmatrix.com>
References: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com>
	<u65la5p5i.fsf@online.no>
	<008ED3F1-C881-11D7-9429-000A95864FC4@twistedmatrix.com>
Message-ID: <uznil2396.fsf@inout.no>

Donovan Preston <dp at twistedmatrix.com> writes:

> On Wednesday, August 6, 2003, at 4:42 PM, Syver Enstad wrote:
> >
> > Should this work?
> >
> > In some template:
> >     <tr>
> >         <td model="deferredModel/One" view="Text">List item here</td>
> >         <td model="deferredModel/Two" view="Text">List item here</td>
> >     </tr>
> >
> > class MyModel(MethodModel):
> >     def wmfactory_deferredModel(self, request):
> >         .....
> >         return deferred # promises to be a dictionary
> >
> >
> > As it is now this fails in lookupSubmodel / getSubmodel, because the
> > DeferredWrapper has not got a submodel named One.
> 
> This will not work, and I can't justify the effort required to make it
> work. Do it like this instead:

The view must be Widget in my experience because DefaultWidget doesn't
handle deferreds in generate.

> <tr model="deferredModel" view="None">
<tr model="deferredModel" view="Widget">
> 	<td model="One">...</td>
> 	<td model="Two">...</td>
> </tr>






From radix at twistedmatrix.com  Thu Aug  7 07:06:46 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Thu, 7 Aug 2003 09:06:46 -0400
Subject: [Twisted-Python] Advice on starting a project
In-Reply-To: <481364389338.20030807110045@2kservices.com>
References: <3F311C5D.2000405@cache-22.co.uk> <481364389338.20030807110045@2kservices.com>
Message-ID: <20030807130646.GA964@radii>

On Thu, Aug 07, 2003 at 11:00:45AM +0400, Alexander Zhukov wrote:
> Wednesday, August 6, 2003, 7:18:53 PM, you wrote:
> 
> R> How would I get a list of clients currently connected so that I can send
> R> a message from one client to its recipient?
> R> Any advice on what to look at and any examples that would be useful?
> 
> I'm new to twisted too and work on a similar project now (twisted
> on serverside and flash and C# on clientside).
> 
> I'm not sure if it's the right way in twisted, but this example
> receivs lines from one connection and writes them to all other
> connections.

Yep, this is a good example.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From int at mtx.ru  Thu Aug  7 08:01:02 2003
From: int at mtx.ru (Pavel Volkovitskiy)
Date: 07 Aug 2003 18:01:02 +0400
Subject: [Twisted-Python] im gtk2 port
Message-ID: <1060264862.17907.9.camel@int.matrixtelecom.net>

Does im gtk2 port exist?

---
Pavel






From mesozoic at polynode.com  Thu Aug  7 11:37:10 2003
From: mesozoic at polynode.com (Alex Levy)
Date: Thu, 7 Aug 2003 13:37:10 -0400
Subject: [Twisted-Python] Woven and XSL
In-Reply-To: <20030806195027.48e8dfbd.itamar@itamarst.org>
References: <Pine.BSO.4.44.0308061938180.25785-100000@cyclops4.esentire.com> <20030806195027.48e8dfbd.itamar@itamarst.org>
Message-ID: <20030807173710.GA8938@perpetual.moxn.net>

On Wed, Aug 06, 2003 at 07:50:27PM -0400, Itamar Shtull-Trauring wrote:
> On Wed, 6 Aug 2003 19:42:17 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
> 
> > require replicating a lot of format code manually throughout the page.
> > Is there a different model with Woven that I should be looking at?
> 
> Look at the examples for using widgets.ExpandMacro in the mailing list
> archives (same approach as ZPT's METAL).

http://www.twistedmatrix.com/pipermail/twisted-python/2003-June/004662.html

(to save you some time)

-- 
Alex Levy
WWW: http://mesozoic.geecs.org
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_



From dp at twistedmatrix.com  Thu Aug  7 14:11:18 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Thu, 7 Aug 2003 13:11:18 -0700
Subject: [Twisted-Python] Woven and submodelling through deferreds
In-Reply-To: <uznil2396.fsf@inout.no>
References: <7111413C-C848-11D7-A0F7-000393C9700E@twistedmatrix.com> <u65la5p5i.fsf@online.no> <008ED3F1-C881-11D7-9429-000A95864FC4@twistedmatrix.com> <uznil2396.fsf@inout.no>
Message-ID: <4E237BDE-C913-11D7-9AF6-000A95864FC4@twistedmatrix.com>

On Thursday, August 7, 2003, at 3:03 AM, Syver Enstad wrote:
>
> The view must be Widget in my experience because DefaultWidget doesn't
> handle deferreds in generate.

Right. Doh. Someone file a bug.

dp





From pyp at gmx.net  Thu Aug  7 19:47:45 2003
From: pyp at gmx.net (Mike Mueller)
Date: Fri, 08 Aug 2003 03:47:45 +0200
Subject: [Twisted-Python] Win32 installer for Python2.3
Message-ID: <5.2.1.1.1.20030808033600.00ab90f0@pop.gmx.net>

I am looking for twisted1.0.6 for Python 2.3 for Windows. There is a 
installer for Python2.2, but I could not find anything for 2.3. I do have 
VC++ 6.0 but could not figure out how to compile from the UNIX sources.

It would be nice if somebody could help me.

Thanks.

Mike




From edmundd at eSentire.com  Thu Aug  7 23:19:53 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Fri, 8 Aug 2003 01:19:53 -0400 (EDT)
Subject: [Twisted-Python] Woven and sessions
Message-ID: <Pine.BSO.4.44.0308080104300.30471-100000@cyclops4.esentire.com>

Okay, been playing around with the session stuff. Still trying to get my
head around how ths is structured.

Created a site. Created a single child "xxx". Created a session wrapped
child "yyy".

Now,
   "http://localhost:8080/xxx/session-init/yyy"
will cause a cookie to be loaded, and a redirect to
   "http://localhost:8080/xxx/yyy?__session_just_started__=1"
if I accept the cookie.  Rejecting the cookie causes something akin to
   "http://localhost:8080/xxx/e11a075ad25656dca2b90022507746b6/yyy"
to be loaded.

If I type:
   "http://localhost:8080/xxx/yyy"
then I get to the appropriate page, with no cookie loaded.

Question 1: Can I suppress the "__session_just_started=1"?
Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
session?

I also noted a page talking about sandbox and pathargs, and : separated
arguments. Is this available, or should I look at creating a custom
resource?

What I am looking to do at the end is support sessioning whether or not
cookies are being allowed, and to allow URLs to be taken.

Question 3: I assume that all of this works similarly for perspective
wrappers? I was trying one Guard example I found on the net, and I am
having trouble actually causing the login page to appear (basically, I am
using the "perspective-init" in the URL, and I seem to get some other web
page with three input fields, rather than the supposedly specified login
page).

Aside Question: Is there a way to setup default error pages? I checked the
How To's and looked in the archives for a simple example, and couldn't
find any.

Regards!
Ed




From glyph at twistedmatrix.com  Thu Aug  7 23:43:13 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 8 Aug 2003 00:43:13 -0500
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <Pine.BSO.4.44.0308080104300.30471-100000@cyclops4.esentire.com>
Message-ID: <33D93BC8-C963-11D7-9301-000393C9700E@twistedmatrix.com>

On Friday, August 8, 2003, at 12:19 AM, Edmund Dengler wrote:

> Question 1: Can I suppress the "__session_just_started=1"?

Not at the moment.  It used to be off, but some browsers balked at the 
redirect cycle.

> Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
> session?

It should happen automatically.  Isn't it?

> I also noted a page talking about sandbox and pathargs, and : separated
> arguments. Is this available, or should I look at creating a custom
> resource?

This is available in sandbox/cce/pathargs.py .

> What I am looking to do at the end is support sessioning whether or not
> cookies are being allowed, and to allow URLs to be taken.

"allow URLs to be taken"?  Say again?

> Question 3: I assume that all of this works similarly for perspective
> wrappers? I was trying one Guard example I found on the net, and I am
> having trouble actually causing the login page to appear (basically, I 
> am
> using the "perspective-init" in the URL, and I seem to get some other 
> web
> page with three input fields, rather than the supposedly specified 
> login
> page).

PerspectiveWrapper is old, dying code.  Use the (badly-named) 
UsernamePasswordWrapper.  An example is in sandbox/glyph/dynademo/ .

> Aside Question: Is there a way to setup default error pages? I checked 
> the
> How To's and looked in the archives for a simple example, and couldn't
> find any.

No, but this is in the bugtracker:

http://www.twistedmatrix.com/users/roundup.twistd/twisted/issue135

Some patches are available.

Sorry for the dearth of documentation here.  The folks responsible for 
these bits of code have been very busy lately :)




From mmoellenbeck at plus.de  Fri Aug  8 00:35:29 2003
From: mmoellenbeck at plus.de (mmoellenbeck at plus.de)
Date: Fri, 8 Aug 2003 08:35:29 +0200
Subject: Antwort: [Twisted-Python] Win32 installer for Python2.3
Message-ID: <OFC082C4EB.41BD97C3-ONC1256D7C.0023E032@uz.tengelmann.de>

Simple go to the twisted-root (there is a setup.py) and type python 
setup.py bdist_wininst.

After that there will be a windows installer under dist.

Martin





An:     twisted-python at twistedmatrix.com
Kopie: 
 

Thema:  [Twisted-Python] Win32 installer for Python2.3

 
Mike Mueller <pyp at gmx.net>
Gesendet von:
twisted-python-admin at twistedmatrix.com
08.08.2003 03:47
Bitte antworten an twisted-python







I am looking for twisted1.0.6 for Python 2.3 for Windows. There is a 
installer for Python2.2, but I could not find anything for 2.3. I do have 
VC++ 6.0 but could not figure out how to compile from the UNIX sources.

It would be nice if somebody could help me.

Thanks.

Mike


_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python






From syver-en at online.no  Fri Aug  8 02:03:01 2003
From: syver-en at online.no (Syver Enstad)
Date: 08 Aug 2003 10:03:01 +0200
Subject: [Twisted-Python] Win32 installer for Python2.3
In-Reply-To: <5.2.1.1.1.20030808033600.00ab90f0@pop.gmx.net>
References: <5.2.1.1.1.20030808033600.00ab90f0@pop.gmx.net>
Message-ID: <uptjg8tl6.fsf@online.no>

Mike Mueller <pyp at gmx.net> writes:

> I am looking for twisted1.0.6 for Python 2.3 for Windows. There is a
> installer for Python2.2, but I could not find anything for 2.3. I do
> have VC++ 6.0 but could not figure out how to compile from the UNIX
> sources.
> 
> It would be nice if somebody could help me.

Hey Mike, it's very simple (as long as you have got MSVC 6). Go to the
root directory of the twisted source package. Type python setup.py
install.

Done!
 

-- 

Vennlig hilsen 

Syver Enstad




From edmundd at eSentire.com  Fri Aug  8 08:29:27 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Fri, 8 Aug 2003 10:29:27 -0400 (EDT)
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <33D93BC8-C963-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <Pine.BSO.4.44.0308081019360.3145-100000@cyclops4.esentire.com>


On Fri, 8 Aug 2003, Glyph Lefkowitz wrote:

>
> On Friday, August 8, 2003, at 12:19 AM, Edmund Dengler wrote:
>
> > Question 1: Can I suppress the "__session_just_started=1"?
>
> Not at the moment.  It used to be off, but some browsers balked at the
> redirect cycle.

I would question this. I have used a few systems that used redirects to
perform logins (via Apache, Resin) and I have yet to find a browser in
which this was an issue. Do you know specifically which ones?

>
> > Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
> > session?
>
> It should happen automatically.  Isn't it?

No it doesn't, which is an issue. I perform an /xxx/yyy, and I get the
page with no cookie set or placed in the URL.

>
> > I also noted a page talking about sandbox and pathargs, and : separated
> > arguments. Is this available, or should I look at creating a custom
> > resource?
>
> This is available in sandbox/cce/pathargs.py .
>
> > What I am looking to do at the end is support sessioning whether or not
> > cookies are being allowed, and to allow URLs to be taken.
>
> "allow URLs to be taken"?  Say again?

Sorry, "allow URLs to be bookmarked". I am trying to ensure that if a
person bookmarks a URL, that the next time they come in, they are
sessioned properly and that they will be logged in properly.

>
> > Question 3: I assume that all of this works similarly for perspective
> > wrappers? I was trying one Guard example I found on the net, and I am
> > having trouble actually causing the login page to appear (basically, I
> > am
> > using the "perspective-init" in the URL, and I seem to get some other
> > web
> > page with three input fields, rather than the supposedly specified
> > login
> > page).
>
> PerspectiveWrapper is old, dying code.  Use the (badly-named)
> UsernamePasswordWrapper.  An example is in sandbox/glyph/dynademo/ .
>
> > Aside Question: Is there a way to setup default error pages? I checked
> > the
> > How To's and looked in the archives for a simple example, and couldn't
> > find any.
>
> No, but this is in the bugtracker:
>
> http://www.twistedmatrix.com/users/roundup.twistd/twisted/issue135
>
> Some patches are available.

The above seems to be a problem related to a "if I cannot find the next
piece here through getChild, what do I do now?". Is there a possibility
of a model such as, "cannot do this, call my parent object in some manner
and tell it to deal with the issue"? Basically, a model with some
form of exception ("I did not return a fragment, but rather an issue") or
a callback ("yeah, you wanted me to do something, and I can't, so you deal
with it")?

In this way, the root object could have a "if a page cannot be found for
any reason, then do the following", and this could be overridden at each
level if desired.

Not sure if this follows the Twisted way of things.

>
> Sorry for the dearth of documentation here.  The folks responsible for
> these bits of code have been very busy lately :)

No probs. I understand extreme development. I figure with a mixture of
hacking snippets up to experiment, and hopefully answers to some of my
not-so-brilliant questions, that I can muddle through this evaluation.

Regards!
Ed





From radix at twistedmatrix.com  Fri Aug  8 08:45:36 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 8 Aug 2003 10:45:36 -0400
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <Pine.BSO.4.44.0308081019360.3145-100000@cyclops4.esentire.com>
References: <33D93BC8-C963-11D7-9301-000393C9700E@twistedmatrix.com> <Pine.BSO.4.44.0308081019360.3145-100000@cyclops4.esentire.com>
Message-ID: <20030808144536.GD964@radii>

On Fri, Aug 08, 2003 at 10:29:27AM -0400, Edmund Dengler wrote:
> 
> On Fri, 8 Aug 2003, Glyph Lefkowitz wrote:
>
> > Not at the moment.  It used to be off, but some browsers balked at the
> > redirect cycle.
> 
> I would question this. I have used a few systems that used redirects to
> perform logins (via Apache, Resin) and I have yet to find a browser in
> which this was an issue. Do you know specifically which ones?

wget

> > > Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
> > > session?
> >
> > It should happen automatically.  Isn't it?
> 
> No it doesn't, which is an issue. I perform an /xxx/yyy, and I get the
> page with no cookie set or placed in the URL.

I don't understand this, it works for me. If there is a SessionWrapper
at /, /xxx, or /xxx/yyy, then it should be working.

> > "allow URLs to be taken"?  Say again?
> 
> Sorry, "allow URLs to be bookmarked". I am trying to ensure that if a
> person bookmarks a URL, that the next time they come in, they are
> sessioned properly and that they will be logged in properly.

http://twistedmatrix.com/bugs/issue138 -- I had this same
problem. it's assigned to dp, but he hasn't gotten around to fixing it
yet.


-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From edmundd at eSentire.com  Fri Aug  8 10:02:38 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Fri, 8 Aug 2003 12:02:38 -0400 (EDT)
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <20030808144536.GD964@radii>
Message-ID: <Pine.BSO.4.44.0308081200500.3145-100000@cyclops4.esentire.com>

Howdy all!

Here is the (striped) sample code I am using to play with the session
stuff. I am using the CVS tip from Aug 5.

===============================

from twisted.internet import reactor
from twisted.web import static, server

# imports needed for woven guard
from twisted.web.woven import guard


sessWrapped = static.Data("you should never see this", "text/plain")
swChild = static.Data("here is the stuff", "text/plain")
sessWrapped.putChild("yyy", swChild)
swrap = guard.SessionWrapper(sessWrapped)

da = static.Data("you should never see this ???", "text/plain")
da.putChild("xxx", swrap)

site = server.Site(da)
reactor.listenTCP(8080, site)
reactor.run()

===============================

If I do http://localhost:8080/xxx/yyy, I get back the page with no session
key.

Regards,
Ed

On Fri, 8 Aug 2003, Christopher Armstrong wrote:

> > > > Question 2: Can I force a session cycle (ie, force /xxx/yyy to have a
> > > > session?
> > >
> > > It should happen automatically.  Isn't it?
> >
> > No it doesn't, which is an issue. I perform an /xxx/yyy, and I get the
> > page with no cookie set or placed in the URL.
>
> I don't understand this, it works for me. If there is a SessionWrapper
> at /, /xxx, or /xxx/yyy, then it should be working.
>





From dp at twistedmatrix.com  Fri Aug  8 11:14:14 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Fri, 8 Aug 2003 10:14:14 -0700
Subject: [Twisted-Python] Woven and sessions
In-Reply-To: <20030808144536.GD964@radii>
References: <33D93BC8-C963-11D7-9301-000393C9700E@twistedmatrix.com> <Pine.BSO.4.44.0308081019360.3145-100000@cyclops4.esentire.com> <20030808144536.GD964@radii>
Message-ID: <BC528716-C9C3-11D7-B0D5-000A95864FC4@twistedmatrix.com>

On Friday, August 8, 2003, at 7:45 AM, Christopher Armstrong wrote:

>
> http://twistedmatrix.com/bugs/issue138 -- I had this same
> problem. it's assigned to dp, but he hasn't gotten around to fixing it
> yet.

I will fix it soon, hopefully within the next week.

dp




From edmundd at eSentire.com  Fri Aug  8 17:12:00 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Fri, 8 Aug 2003 19:12:00 -0400 (EDT)
Subject: [Twisted-Python] ADBAPI and individual rows
Message-ID: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>

Greetings!

Digging a bit more into the DB side, and I wonder a bit about the API for
adbapi. From what I can tell, the runQuery() will return a Deferred for
the whole result set (which implies the result set is in memory). Is there
a method or style for running a query in which each row will be passed
back through a Deferred one at a time? (Basically, each cycle through
reactor.run() would be returning a single row).

What I am looking for is how to deal with a large result set without
requiring the whole set be in memory. Should I be looking elsewhere within
Twisted to do this?

Regards!
Ed





From jjanecek at telusplanet.net  Fri Aug  8 17:18:05 2003
From: jjanecek at telusplanet.net (John Janecek)
Date: Fri, 08 Aug 2003 17:18:05 -0600
Subject: [Twisted-Python] UDP and factories
In-Reply-To: <20030808114022.20705.51579.Mailman@pyramid.twistedmatrix.c
 om>
Message-ID: <5.1.0.14.2.20030808171228.00b62ea8@mail.telusplanet.net>

I am attempting to use DatagramProtocol with a factory
are u supposed to use DatagramProtocol with a factory ??
am i out to lunch ?

ie

from twisted.internet.protocol import DatagramProtocol
from twisted.internet import reactor
from twisted.internet.protocol import Factory

class Echo(DatagramProtocol):
     def datagramReceived(self, data, (host, port)):
         print "received %r from %s:%d" % (data, host, port)
         self.transport.write(data, (host, 7000))

echo_factory = Factory()
echo_factory.protocol = Echo


reactor.listenUDP(6000,echo_factory)
reactor.run()

I am using twisted v 1.05 and windows XP

everytime i attempt to run the above code i get

Traceback (most recent call last):
   File "pyRtp.py", line 97, in ?
     reactor.listenUDP(6000,echo_factory)
   File "E:\Python22\Lib\site-packages\twisted\internet\default.py", line 
181, in
  listenUDP
     p = udp.Port(port, protocol, interface, maxPacketSize, self)
   File "E:\Python22\Lib\site-packages\twisted\internet\udp.py", line 65, 
in __in
it__
     assert isinstance(proto, protocol.DatagramProtocol)
AssertionError

what am i doing wrong ?
If i am not supposed to use a factory with UDP what is a better solution ?

Thanx :)





From mesozoic at polynode.com  Fri Aug  8 18:21:23 2003
From: mesozoic at polynode.com (Alex Levy)
Date: Fri, 8 Aug 2003 20:21:23 -0400
Subject: [Twisted-Python] UDP and factories
In-Reply-To: <5.1.0.14.2.20030808171228.00b62ea8@mail.telusplanet.net>
References: <20030808114022.20705.51579.Mailman@pyramid.twistedmatrix.com> <5.1.0.14.2.20030808171228.00b62ea8@mail.telusplanet.net>
Message-ID: <20030809002123.GD8938@perpetual.moxn.net>

On Fri, Aug 08, 2003 at 05:18:05PM -0600, John Janecek wrote:
> I am attempting to use DatagramProtocol with a factory
> are u supposed to use DatagramProtocol with a factory ??
> am i out to lunch ?

Yes, you are -- but don't worry, it was leftover ham sandwiches ;]
No, you do not need to use a factory for a DatagramProtocol.  Thus:

> from twisted.internet.protocol import DatagramProtocol
> from twisted.internet import reactor
> 
> class Echo(DatagramProtocol):
>     def datagramReceived(self, data, (host, port)):
>         print "received %r from %s:%d" % (data, host, port)
>         self.transport.write(data, (host, 7000))
> 
> reactor.listenUDP(6000,Echo())
> reactor.run()

Look at <http://twistedmatrix.com/documents/howto/udp> for more information.

-- 
Alex Levy
WWW: http://mesozoic.geecs.org
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_



From mary-twisted at puzzling.org  Fri Aug  8 18:43:35 2003
From: mary-twisted at puzzling.org (Mary)
Date: Sat, 9 Aug 2003 10:43:35 +1000
Subject: [Twisted-Python] Woven: access to submodels
In-Reply-To: <6577C938-BA1C-11D7-8547-000A95864FC4@twistedmatrix.com>
References: <20030713022136.GB1862@titus.home.puzzling.org> <6577C938-BA1C-11D7-8547-000A95864FC4@twistedmatrix.com>
Message-ID: <20030809004335.GP1102@titus.home.puzzling.org>

Replying to an old thread here, I work though my problems slowly...

On Sat, Jul 19, 2003, Donovan Preston wrote:
> So, fortunately, things may be simpler than they seem.  You can just
> pass the DeferredWrapper as the Main Model to the next Page instance
> you construct, and as long as you are going to be rendering that Page
> next, Woven will just wait on it as it would any other Deferred.

[some bits of code snipped]

> class DeferredProducer(model.MethodModel):
>     def wmfactory_someDeferred(self, reqeuest):
>         d = defer.Deferred()
>         reactor.callLater(0.5, self.produce, d)
>         return d
> 
>     def produce(self, d):
>         d.callback( "Hello, here is some text" )
> 
> class MainPage(page.Page):
>     template = """<html>
>     <h3 model="someNotDeferred" view="Text"> qawsf</h3>
>     <span model="someDeferred" view="Text"> qwensd</span>
> </html> """
> 
>     def getDynamicChild(self, name, request):
>         return ChildPage(
>                     self.model.getSubmodel(request, 'someDeferred'))
> 
> class ChildPage(page.Page):
>     template = """<html>
>     Hello! Our main model is a deferred, so the next node will have to 
> wait
>     <span model="." view="Text"> ncxnz</span>
> </html> """

Sorry, I'm not too familiar with the stages in which this gets sent to
the browser, but this code assumes that the ChildPage is always going to
exist.

In my blog model, obviously there are authors that don't exist. So
/author/Mary/ would be represented by a ChildPage Resource, but
/author/Donovan/ should 404. Is that possible in a code structure like
this, or is it too late to produce the appropriate error at the:
    <span model="." view="Text"> ncxnz</span>
stage, which is the first time Twisted Web needs to wait on our Deferred
main model?

-Mary



From mary-twisted at puzzling.org  Fri Aug  8 21:05:44 2003
From: mary-twisted at puzzling.org (Mary)
Date: Sat, 9 Aug 2003 13:05:44 +1000
Subject: [Twisted-Python] Woven: access to submodels
In-Reply-To: <20030809004335.GP1102@titus.home.puzzling.org>
References: <6577C938-BA1C-11D7-8547-000A95864FC4@twistedmatrix.com> <20030809004335.GP1102@titus.home.puzzling.org>
Message-ID: <20030809030544.GC6338@titus.home.puzzling.org>

On Sat, Aug 09, 2003, Mary wrote:
> In my blog model, obviously there are authors that don't exist. So
> /author/Mary/ would be represented by a ChildPage Resource, but
> /author/Donovan/ should 404. Is that possible in a code structure like
> this, or is it too late to produce the appropriate error at the:
>     <span model="." view="Text"> ncxnz</span>
> stage, which is the first time Twisted Web needs to wait on our Deferred
> main model?

OK, as per discussion on IRC, I used a DeferredResource instead, and
return a ChildPage if the database query finds an author and an
ErrorPage otherwise.

-Mary



From justin at gnubia.net  Fri Aug  8 21:12:19 2003
From: justin at gnubia.net (Justin Ryan)
Date: 08 Aug 2003 22:12:19 -0500
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
Message-ID: <1060398739.2133.104.camel@samadhi>

adbapi could almost definitely be extended to have a special method or
paramater/flag to the existing methods for doing this.

On Fri, 2003-08-08 at 18:12, Edmund Dengler wrote:
> Greetings!
> 
> Digging a bit more into the DB side, and I wonder a bit about the API for
> adbapi. From what I can tell, the runQuery() will return a Deferred for
> the whole result set (which implies the result set is in memory). Is there
> a method or style for running a query in which each row will be passed
> back through a Deferred one at a time? (Basically, each cycle through
> reactor.run() would be returning a single row).
> 
> What I am looking for is how to deal with a large result set without
> requiring the whole set be in memory. Should I be looking elsewhere within
> Twisted to do this?
> 
> Regards!
> Ed
> 
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20030808/3437fc11/attachment.sig>

From jml at ids.org.au  Sat Aug  9 11:26:00 2003
From: jml at ids.org.au (Jonathan Lange)
Date: Sun, 10 Aug 2003 03:26:00 +1000
Subject: [Twisted-Python] Logging to stdout from trial
Message-ID: <20030809172600.GA7035@mumak.net>


The trial script takes a --logfile option, and writes all logs to this file. If
you haven't noticed in the past, it's because it logs to test.log

Below is a patch that sets the logfile to sys.stdout if the logfile is given as
'-'. e.g. trial --logfile=- twisted.test.test_trial

I'd commit this but I know very little about twisted's logging, and I don't
know whether this solves the real problem or not.


Index: twisted/scripts/trial.py
===================================================================
RCS file: /cvs/Twisted/twisted/scripts/trial.py,v
retrieving revision 1.46
diff -u -r1.46 trial.py
--- twisted/scripts/trial.py    19 Jul 2003 21:36:49 -0000      1.46
+++ twisted/scripts/trial.py    9 Aug 2003 05:58:05 -0000
@@ -254,7 +254,10 @@
                print
                print x['format'] % x
        log.addObserver(seeWarnings)
-       log.startLogging(open(config['logfile'], 'a'), 0)
+       if config['logfile'] == '-':
+           log.startLogging(sys.stdout, 0)
+       else:
+           log.startLogging(open(config['logfile'], 'a'), 0)

     tbformat = config['tbformat']

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030810/19e5b7e4/attachment.sig>

From fog at initd.org  Sat Aug  9 01:42:36 2003
From: fog at initd.org (Federico Di Gregorio)
Date: 09 Aug 2003 09:42:36 +0200
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <1060398739.2133.104.camel@samadhi>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
	 <1060398739.2133.104.camel@samadhi>
Message-ID: <1060414956.1252.9.camel@localhost>

Il sab, 2003-08-09 alle 05:12, Justin Ryan ha scritto:
> adbapi could almost definitely be extended to have a special method or
> paramater/flag to the existing methods for doing this.

a long time ago i promised to rework the adbpi (mainly to implement the
min/max stuff that currently does not work). i'll start sending patches
after the ccc (nobody twisted here?). the special method you talk of
should be quite easy to implement.

ciao,

-- 
Federico Di Gregorio
Debian GNU/Linux Developer                                fog at debian.org
INIT.D Developer                                           fog at initd.org
   God is real. Unless declared integer. -- Anonymous FORTRAN programmer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa parte del messaggio è firmata
URL: </pipermail/twisted-python/attachments/20030809/fef2461a/attachment.sig>

From dave at krondo.com  Sat Aug  9 03:19:02 2003
From: dave at krondo.com (Dave Peticolas)
Date: 09 Aug 2003 02:19:02 -0700
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
Message-ID: <1060420741.1121.234.camel@oneiros>

On Fri, 2003-08-08 at 16:12, Edmund Dengler wrote:
> Greetings!
> 
> Digging a bit more into the DB side, and I wonder a bit about the API for
> adbapi. From what I can tell, the runQuery() will return a Deferred for
> the whole result set (which implies the result set is in memory). Is there
> a method or style for running a query in which each row will be passed
> back through a Deferred one at a time? (Basically, each cycle through
> reactor.run() would be returning a single row).
> 
> What I am looking for is how to deal with a large result set without
> requiring the whole set be in memory. Should I be looking elsewhere within
> Twisted to do this?

You should look at runInteraction. That calls a user-specified
function with what is essentially a DB-API cursor in a separate
thread. You can do what you like with the cursor, including
fetching results one row at a time.

You might also look at the Flow module. I've never used it,
but I think it was designed to solve such problems.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20030809/c72b29d4/attachment.sig>

From dave at krondo.com  Sat Aug  9 03:20:33 2003
From: dave at krondo.com (Dave Peticolas)
Date: 09 Aug 2003 02:20:33 -0700
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <1060414956.1252.9.camel@localhost>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
	 <1060398739.2133.104.camel@samadhi>  <1060414956.1252.9.camel@localhost>
Message-ID: <1060420833.1071.237.camel@oneiros>

On Sat, 2003-08-09 at 00:42, Federico Di Gregorio wrote:
> Il sab, 2003-08-09 alle 05:12, Justin Ryan ha scritto:
> > adbapi could almost definitely be extended to have a special method or
> > paramater/flag to the existing methods for doing this.
> 
> a long time ago i promised to rework the adbpi (mainly to implement the
> min/max stuff that currently does not work).

It seems I have beat you to it :) Min/max now works -- see current 
CVS.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20030809/366a7627/attachment.sig>

From tv at twistedmatrix.com  Sat Aug  9 00:56:05 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sat, 9 Aug 2003 09:56:05 +0300
Subject: [Twisted-Python] ADBAPI and individual rows
In-Reply-To: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308081909050.28552-100000@cyclops4.esentire.com>
Message-ID: <20030809065605.GA25647@lapdog>

On Fri, Aug 08, 2003 at 07:12:00PM -0400, Edmund Dengler wrote:
> Digging a bit more into the DB side, and I wonder a bit about the API for
> adbapi. From what I can tell, the runQuery() will return a Deferred for
> the whole result set (which implies the result set is in memory). Is there
> a method or style for running a query in which each row will be passed
> back through a Deferred one at a time? (Basically, each cycle through
> reactor.run() would be returning a single row).
> 
> What I am looking for is how to deal with a large result set without
> requiring the whole set be in memory. Should I be looking elsewhere within
> Twisted to do this?

	Here's what I did with Ldaptor (note how the callback and the
	returned Deferred play together):

    def search(self,
	       filterText=None,
	       filterObject=None,
	       attributes=(),
	       scope=pureldap.LDAP_SCOPE_wholeSubtree,
	       derefAliases=pureldap.LDAP_DEREF_neverDerefAliases,
	       sizeLimit=0,
	       timeLimit=0,
	       typesOnly=0,
	       callback=None):
	"""

	Perform an LDAP search with this object as the base.

	@param filterText: LDAP search filter as a string.

	@param filterObject: LDAP search filter as LDAPFilter.
	Note if both filterText and filterObject are given, they
	are combined with AND. If neither is given, the search is
	made with a filter that matches everything.

	@param attributes: List of attributes to retrieve for the
	result objects. An empty list and means all.

	@param scope: Whether to recurse into subtrees.

	@param derefAliases: Whether to deref LDAP aliases. TODO write
	better documentation.

	@param sizeLimit: At most how many entries to return. 0 means
	unlimited.

	@param timeLimit: At most how long to use for processing the
	search request. 0 means unlimited.

	@param typesOnly: Whether to return attribute types only, or
	also values.

	@param callback: Callback function to call for each resulting
	LDAPEntry. None means gather the results into a list and give
	that to the Deferred returned from here.

	@return: A Deferred that will complete when the search is
	done. The Deferred gives None if callback was given and a list
	of the search results if callback is not given or is None.

	"""

-- 
:(){ :|:&};:



From edmundd at eSentire.com  Sat Aug  9 10:45:30 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 12:45:30 -0400 (EDT)
Subject: [Twisted-Python] Sessions and URLs
Message-ID: <Pine.BSO.4.44.0308091236270.32656-100000@cyclops4.esentire.com>

Hi all!

Dug into the library. It looks like woven.guard.SessionWrapper is setup
to return a child EVEN IF YOU DO NOT HAVE A SESSION!!.

Basically. the code structure of getChild() looks like (I could be wrong
in my understanding, so please correct if I am making a mistake):

     some setup stuff
     if we have a session key as the next bit in the path
       ...
       if the key matches the cookie
         we have cookies enabled, get rid of the embedded key
         ...
       else (cookies are disabled, keep the key)
         ...
     elif we have a cookie from the browser
       ...
     elif we are explicitely calling "session-init"
       ...
     else (we do not have a cookie anywhere)
       return the child anyways!!!

So, the code is structured such that a cookie is not available, the normal
children still get returned. Is this suppose to be how it works? Should
this be changed so that a flag is available for "force session"? Or should
a session always be forced (no option)?

Should we have a pattern such as "session-name:cookie" so we can do a
pattern match for old sessions no longer cached (and force a new session)?

Regards!
Ed





From radix at twistedmatrix.com  Sat Aug  9 13:05:19 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sat, 9 Aug 2003 15:05:19 -0400
Subject: [Twisted-Python] Sessions and URLs
In-Reply-To: <Pine.BSO.4.44.0308091236270.32656-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308091236270.32656-100000@cyclops4.esentire.com>
Message-ID: <20030809190519.GG964@radii>

On Sat, Aug 09, 2003 at 12:45:30PM -0400, Edmund Dengler wrote:
> Hi all!
> Should we have a pattern such as "session-name:cookie" so we can do a
> pattern match for old sessions no longer cached (and force a new session)?

This is exactly what the proposed solution of that bug I referenced
the other day is.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From edmundd at eSentire.com  Sat Aug  9 14:35:24 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 16:35:24 -0400 (EDT)
Subject: [Twisted-Python] SQL, Threaded, and flows
Message-ID: <Pine.BSO.4.44.0308091633040.32656-100000@cyclops4.esentire.com>

Hi all!

I am trying the example from the Flow HowTo page, and I have into an
exception.

===========================

from __future__         import generators
from twisted.enterprise import adbapi
from twisted.internet   import reactor
from twisted.flow import flow

dbpool = adbapi.ConnectionPool("SomeDriver",host='localhost',
             db='Database',user='User',passwd='Password')

sql = """
  (SELECT 'one')
UNION ALL
  (SELECT 'two')
UNION ALL
  (SELECT 'three')
"""

def consumer():
    query = flow.Threaded(flow.QueryIterator(dbpool, sql))
    yield query
    for row in query:
        print "Processed result : ", row

from twisted.internet import reactor
def finish(result):
    print "Deferred Complete : ", result
f = flow.Deferred(consumer())
f.addBoth(finish)
reactor.callLater(1,reactor.stop)
reactor.run()

# prints
# Processed result :  ('one',)
# Processed result :  ('two',)
# Processed result :  ('three',)
# Deferred Complete:  []

===========================

> python flow-query.py
Deferred Complete :  [Failure instance: Traceback: exceptions.AttributeError, 'module' object has no attribute 'Threaded'
/opt/python/lib/python2.2/site-packages/twisted/flow/wrap.py:100:_yield
flow-query.py:18:consumer
]

Is there something I need to do? Has the API changed?

Regards!
Ed





From edmundd at eSentire.com  Sat Aug  9 14:57:06 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 16:57:06 -0400 (EDT)
Subject: [Twisted-Python] Twisted Style
Message-ID: <Pine.BSO.4.44.0308091637310.32656-100000@cyclops4.esentire.com>

Hi all!

The Twisted stuff looks very good, and I think I am getting my head around
to the way it works. I am looking for how I should be approaching a basic
problem, and how to cast it in the Twisted model.

Basically, I have a client transferring database rows to a server. I would
like to transfer each row one-at-a-time, and I need information coming
back to know whether the transfer was successful and to record in the
client's database.

I have tried the following (please note that the code has been stripped
to show the essence):

Server (using PB)
-----------------

Has a Perspective:

class MyPerspective(pb.Perspective):
    def attached(self, clientref, identity):
        ...

    def attached(self, ref, identity):
        ...

    def perspective_transferXXX(self, XXX):
        ...

...create an app and a service...
...create appropriate perspective and identity things...
...listen at a socket...


Client (1)
----------

class TransferClient:
    def __init__(self):

    def go(self):
        ...connect to server, defer to connection()...

    def connection(self, perspective):
        # Connection to server has been made
        ...save away perspective...
        self.transferCycle()

    def transferCycle(self):
        # Start a whole cycle (each cycle may transfer multiple rows)
        self.transferXXXs()

    def getXXXs(self):
        # Lets get the data to transfer
        ...setup database query, defer result set to transferXXXs()...

    def transferXXXs(self, XXXs):
        # We have our data from the query
        ...save away some state information...
        self.transferXXX(...first row...)

    def transferXXX(self, XXX):
        # Transfer a single row
        ...call remote perspective for XXX, defer return to doneXXX()...

    def doneXXX(self, result):
        # The row has been transferred and returned a result
        if successfully transferred:
            ...do appropriate work...
        if we still need to transfer more rows:
            self.transferXXX(...with the next row...)
        else:
            self.cycleDone()
            # Note: if we had other stuff, we would start them
            # transferring as well

    def cycleDone(self):
        # We have done a single cycle of transfers
        ...put a deferred for YYY seconds to start the cycle again...


Now, this seems like an awful lot of methods simply to support deferred
execution. Is there a way to use flows to acheive this? I have looked at
the HowTo pages, but it is not clear how to use the Flow components within
a PB model. Is there another approach?

Regards!
Ed






From edmundd at eSentire.com  Sat Aug  9 15:09:04 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 17:09:04 -0400 (EDT)
Subject: [Twisted-Python] Revisiting sessions
Message-ID: <Pine.BSO.4.44.0308091700430.32656-100000@cyclops4.esentire.com>

Just tried to get a session to apply to the entire website (rather than to
one subdirectory).

So, tried the following code:

========================================

from twisted.internet import reactor
from twisted.web import static, server
from twisted.web.woven import guard

sessWrapped = static.Data("you should never see this", "text/plain")
swChild = static.Data("NO", "text/plain")
sessWrapped.putChild("yyy", swChild)
swrap = guard.SessionWrapper(sessWrapped)

da = static.Data("you should never see this", "text/plain")
# da.putChild("", static.Data("The great void at the top", "text/plain"))
da.putChild("", swrap)

site = server.Site(da)
reactor.listenTCP(8080, site)
reactor.run()

============================

If I put the static.Data(), rather than the swrap as the Child, I get "The
great void at the top". If I try to use swrap to generate a session key, I
get:

lynx http://localhost:8080
==> redirects to http://localhost:8080//
==> Which returns a "No such child resource"

lynx http://localhost:8080/yyy
==> Which returns a "No such child resource"

lynx http://localhost:8080/session-init/yyy
==> Which returns a "No such child resource"

So, it seems that I cannot use the session at the top (at least the way I
think it works). What am I doing wrong?

Thanks!
Ed





From cce at clarkevans.com  Sat Aug  9 15:14:05 2003
From: cce at clarkevans.com (Clark C. Evans)
Date: Sat, 9 Aug 2003 21:14:05 +0000
Subject: [Twisted-Python] SQL, Threaded, and flows
In-Reply-To: <Pine.BSO.4.44.0308091633040.32656-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308091633040.32656-100000@cyclops4.esentire.com>
Message-ID: <20030809211405.GA76105@polya.axista.com>

Edmund,

   This has been fixed in the CVS repository.  In short, when flow
   was added into twisted, the "threaded" stuff seemed to be not 
   totally stable and really not core (as it is more useful with an
   async Database or LDAP driver).  Thus, QueryIterator and Threaded
   arn't imported into the flow module automatically as the example
   assumed.  You can get to these two classes via:

      from twisted.flow.threads import QueryIterator, Threaded

   And then the example should mostly work from there.  Although
   you do need an actual database connection, of course.   

Best,

Clark

[1] http://twistedmatrix.com/users/jh.twistd/viewcvs/cgi/viewcvs.cgi/doc/howto/flow.html?rev=HEAD&content-type=text/vnd.viewcvs-markup&cvsroot=Twisted

On Sat, Aug 09, 2003 at 04:35:24PM -0400, Edmund Dengler wrote:
| Hi all!
| 
| I am trying the example from the Flow HowTo page, and I have into an
| exception.
| 
| ===========================
| 
| from __future__         import generators
| from twisted.enterprise import adbapi
| from twisted.internet   import reactor
| from twisted.flow import flow
| 
| dbpool = adbapi.ConnectionPool("SomeDriver",host='localhost',
|              db='Database',user='User',passwd='Password')
| 
| sql = """
|   (SELECT 'one')
| UNION ALL
|   (SELECT 'two')
| UNION ALL
|   (SELECT 'three')
| """
| 
| def consumer():
|     query = flow.Threaded(flow.QueryIterator(dbpool, sql))
|     yield query
|     for row in query:
|         print "Processed result : ", row
| 
| from twisted.internet import reactor
| def finish(result):
|     print "Deferred Complete : ", result
| f = flow.Deferred(consumer())
| f.addBoth(finish)
| reactor.callLater(1,reactor.stop)
| reactor.run()
| 
| # prints
| # Processed result :  ('one',)
| # Processed result :  ('two',)
| # Processed result :  ('three',)
| # Deferred Complete:  []
| 
| ===========================
| 
| > python flow-query.py
| Deferred Complete :  [Failure instance: Traceback: exceptions.AttributeError, 'module' object has no attribute 'Threaded'
| /opt/python/lib/python2.2/site-packages/twisted/flow/wrap.py:100:_yield
| flow-query.py:18:consumer
| ]
| 
| Is there something I need to do? Has the API changed?
| 
| Regards!
| Ed
| 
| 
| 
| _______________________________________________
| Twisted-Python mailing list
| Twisted-Python at twistedmatrix.com
| http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From edmundd at eSentire.com  Sat Aug  9 15:23:42 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 17:23:42 -0400 (EDT)
Subject: [Twisted-Python] SQL, Threaded, and flows
In-Reply-To: <20030809211405.GA76105@polya.axista.com>
Message-ID: <Pine.BSO.4.44.0308091721330.32656-100000@cyclops4.esentire.com>

Greetings!

Is this a recommended package/module to use, or should I be avoiding it
(for reasons such as it is going towards being deprecated)?

Thanks!
Ed

On Sat, 9 Aug 2003, Clark C. Evans wrote:

> Edmund,
>
>    This has been fixed in the CVS repository.  In short, when flow
>    was added into twisted, the "threaded" stuff seemed to be not
>    totally stable and really not core (as it is more useful with an
>    async Database or LDAP driver).  Thus, QueryIterator and Threaded
>    arn't imported into the flow module automatically as the example
>    assumed.  You can get to these two classes via:
>
>       from twisted.flow.threads import QueryIterator, Threaded
>
>    And then the example should mostly work from there.  Although
>    you do need an actual database connection, of course.
>
> Best,
>
> Clark
>
> [1] http://twistedmatrix.com/users/jh.twistd/viewcvs/cgi/viewcvs.cgi/doc/howto/flow.html?rev=HEAD&content-type=text/vnd.viewcvs-markup&cvsroot=Twisted
>
> On Sat, Aug 09, 2003 at 04:35:24PM -0400, Edmund Dengler wrote:
> | Hi all!
> |
> | I am trying the example from the Flow HowTo page, and I have into an
> | exception.
> |
> | ===========================
> |
> | from __future__         import generators
> | from twisted.enterprise import adbapi
> | from twisted.internet   import reactor
> | from twisted.flow import flow
> |
> | dbpool = adbapi.ConnectionPool("SomeDriver",host='localhost',
> |              db='Database',user='User',passwd='Password')
> |
> | sql = """
> |   (SELECT 'one')
> | UNION ALL
> |   (SELECT 'two')
> | UNION ALL
> |   (SELECT 'three')
> | """
> |
> | def consumer():
> |     query = flow.Threaded(flow.QueryIterator(dbpool, sql))
> |     yield query
> |     for row in query:
> |         print "Processed result : ", row
> |
> | from twisted.internet import reactor
> | def finish(result):
> |     print "Deferred Complete : ", result
> | f = flow.Deferred(consumer())
> | f.addBoth(finish)
> | reactor.callLater(1,reactor.stop)
> | reactor.run()
> |
> | # prints
> | # Processed result :  ('one',)
> | # Processed result :  ('two',)
> | # Processed result :  ('three',)
> | # Deferred Complete:  []
> |
> | ===========================
> |
> | > python flow-query.py
> | Deferred Complete :  [Failure instance: Traceback: exceptions.AttributeError, 'module' object has no attribute 'Threaded'
> | /opt/python/lib/python2.2/site-packages/twisted/flow/wrap.py:100:_yield
> | flow-query.py:18:consumer
> | ]
> |
> | Is there something I need to do? Has the API changed?
> |
> | Regards!
> | Ed
> |
> |
> |
> | _______________________________________________
> | Twisted-Python mailing list
> | Twisted-Python at twistedmatrix.com
> | http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From edmundd at eSentire.com  Sat Aug  9 15:28:34 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 17:28:34 -0400 (EDT)
Subject: [Twisted-Python] SQL, Threaded, and flows
In-Reply-To: <20030809211405.GA76105@polya.axista.com>
Message-ID: <Pine.BSO.4.44.0308091726540.32656-100000@cyclops4.esentire.com>

Added the import line, changed to query line to:

    query = Threaded(QueryIterator(dbpool, sql))

It now executes (no exceptions), but nothing is returned/printed. I am
obviously missing something, but I don't know enough of the internals
to hazard a guess as to what.

I am currently using the Aug 5 CVS tip.

Regards!
Ed

On Sat, 9 Aug 2003, Clark C. Evans wrote:

> Edmund,
>
>    This has been fixed in the CVS repository.  In short, when flow
>    was added into twisted, the "threaded" stuff seemed to be not
>    totally stable and really not core (as it is more useful with an
>    async Database or LDAP driver).  Thus, QueryIterator and Threaded
>    arn't imported into the flow module automatically as the example
>    assumed.  You can get to these two classes via:
>
>       from twisted.flow.threads import QueryIterator, Threaded
>
>    And then the example should mostly work from there.  Although
>    you do need an actual database connection, of course.
>
> Best,
>
> Clark
>
> [1] http://twistedmatrix.com/users/jh.twistd/viewcvs/cgi/viewcvs.cgi/doc/howto/flow.html?rev=HEAD&content-type=text/vnd.viewcvs-markup&cvsroot=Twisted
>
> On Sat, Aug 09, 2003 at 04:35:24PM -0400, Edmund Dengler wrote:
> | Hi all!
> |
> | I am trying the example from the Flow HowTo page, and I have into an
> | exception.
> |
> | ===========================
> |
> | from __future__         import generators
> | from twisted.enterprise import adbapi
> | from twisted.internet   import reactor
> | from twisted.flow import flow
> |
> | dbpool = adbapi.ConnectionPool("SomeDriver",host='localhost',
> |              db='Database',user='User',passwd='Password')
> |
> | sql = """
> |   (SELECT 'one')
> | UNION ALL
> |   (SELECT 'two')
> | UNION ALL
> |   (SELECT 'three')
> | """
> |
> | def consumer():
> |     query = flow.Threaded(flow.QueryIterator(dbpool, sql))
> |     yield query
> |     for row in query:
> |         print "Processed result : ", row
> |
> | from twisted.internet import reactor
> | def finish(result):
> |     print "Deferred Complete : ", result
> | f = flow.Deferred(consumer())
> | f.addBoth(finish)
> | reactor.callLater(1,reactor.stop)
> | reactor.run()
> |
> | # prints
> | # Processed result :  ('one',)
> | # Processed result :  ('two',)
> | # Processed result :  ('three',)
> | # Deferred Complete:  []
> |
> | ===========================
> |
> | > python flow-query.py
> | Deferred Complete :  [Failure instance: Traceback: exceptions.AttributeError, 'module' object has no attribute 'Threaded'
> | /opt/python/lib/python2.2/site-packages/twisted/flow/wrap.py:100:_yield
> | flow-query.py:18:consumer
> | ]
> |
> | Is there something I need to do? Has the API changed?
> |
> | Regards!
> | Ed
> |
> |
> |
> | _______________________________________________
> | Twisted-Python mailing list
> | Twisted-Python at twistedmatrix.com
> | http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From cce at clarkevans.com  Sat Aug  9 15:41:19 2003
From: cce at clarkevans.com (Clark C. Evans)
Date: Sat, 9 Aug 2003 21:41:19 +0000
Subject: [Twisted-Python] SQL, Threaded, and flows
In-Reply-To: <Pine.BSO.4.44.0308091726540.32656-100000@cyclops4.esentire.com>
References: <20030809211405.GA76105@polya.axista.com> <Pine.BSO.4.44.0308091726540.32656-100000@cyclops4.esentire.com>
Message-ID: <20030809214119.GA76405@polya.axista.com>

On Sat, Aug 09, 2003 at 05:28:34PM -0400, Edmund Dengler wrote:
| Added the import line, changed to query line to:
| 
|     query = Threaded(QueryIterator(dbpool, sql))
| 
| It now executes (no exceptions), but nothing is returned/printed. I am
| obviously missing something, but I don't know enough of the internals
| to hazard a guess as to what.

Yes, there is another stupid bug in the example, the
callLater(1,reactor.stop) line should be deleted and the 
reactor.stop() should go into the finish() function.  

| > | from twisted.internet import reactor
| > | def finish(result):
| > |     print "Deferred Complete : ", result
+         reactor.stop()
| > | f = flow.Deferred(consumer())
| > | f.addBoth(finish)
-   reactor.callLater(1,reactor.stop)
| > | reactor.run()

I'm also on IRC right now, or if you are in the US I can
give you a quick phone call. (send me personally your phone
if you want me to give you a quick phone call)

Best,

Clark



From edmundd at eSentire.com  Sat Aug  9 16:19:25 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
Subject: [Twisted-Python] Twisted and Postgresql
Message-ID: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>

Greetings!

When trying to transfer a row set, which was obtained using the pyPgSQL
module, I am having problems with specific types not being jelly-able. In
particular, the row itself PgResultSetConcreteRow(?)(this is from memory)
and PgInt2 (which I found out by trying to send individual elements of the
row set over). Has anybody else encountered these, and is there a solution
other than defining my own set of jelly-able components (for example, is
there a stock jelly library someplace)?

I did a search on the archives, with nothing found.

Regards!
Ed





From edmundd at eSentire.com  Sat Aug  9 18:17:13 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 20:17:13 -0400 (EDT)
Subject: [Twisted-Python] Deferring the return within PB
Message-ID: <Pine.BSO.4.44.0308092011260.32656-100000@cyclops4.esentire.com>

As I forge ahead, another question rears it's ugly head to be thrashed!

I am calling a PB perspective method from the client to the server.

    def perspective_transferXXX(self, XXX):
        ...deal with this item...

I would like to perform a database operation on the server end. How do I
defer the return statement til the operation is done?

Roughly speaking:

    def perspective_transferXXX(self, XXX):
        ...perform the database operation, defer to doneTransferXXX()...
        ...do NOT return a value for the perspective call...

    def doneTransferXXX(self, XXX):
        ...perform any other cleanup...
        ...NOW return a value for the perspective call...


I would note that the use of Deferred's and such looks like it is slowly
going towards the model of continuation-style-passing (a very funky and
mind twisting model from the functional languages world), which would
allow for this sort of asynchronous operation very cleanly.

How would I specify the above effects within Twisted? I have tried to see
if this was answered in the documentation or the archive lists, to no
effect.

Regards!
Ed




From pyp at gmx.net  Sat Aug  9 18:49:29 2003
From: pyp at gmx.net (Mike Mueller)
Date: Sun, 10 Aug 2003 02:49:29 +0200
Subject: Antwort: [Twisted-Python] Win32 installer for Python2.3
In-Reply-To: <OFC082C4EB.41BD97C3-ONC1256D7C.0023E032@uz.tengelmann.de>
Message-ID: <5.2.1.1.1.20030810024414.00ad5398@pop.gmx.net>

At 08:35 08.08.2003 +0200, you wrote:
>Simple go to the twisted-root (there is a setup.py) and type python
>setup.py bdist_wininst.
>
>After that there will be a windows installer under dist.
>
>Martin

Thanks. Worked at the first try.

PythonWin 2.3 (#46, Jul 29 2003, 18:54:32) [MSC v.1200 32 bit (Intel)] on 
win32.
Portions Copyright 1994-2001 Mark Hammond (mhammond at skippinet.com.au) - see 
'Help/About PythonWin' for further copyright information.
 >>> import twisted
 >>> twisted.python
<module 'twisted.python' from 'twisted\python\__init__.pyc'>
 >>>

Before I used  ..twisted\win32\build.py which did not work.
Learned something here :).

Mike







From abe at fettig.net  Sat Aug  9 19:17:30 2003
From: abe at fettig.net (Abe Fettig)
Date: 09 Aug 2003 21:17:30 -0400
Subject: [Twisted-Python] Deferring the return within PB
In-Reply-To: <Pine.BSO.4.44.0308092011260.32656-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308092011260.32656-100000@cyclops4.esentire.com>
Message-ID: <1060478249.542.20.camel@mingus>

On Sat, 2003-08-09 at 20:17, Edmund Dengler wrote:

> I would like to perform a database operation on the server end. How do I
> defer the return statement til the operation is done?
> 
> Roughly speaking:
> 
>     def perspective_transferXXX(self, XXX):
>         ...perform the database operation, defer to doneTransferXXX()...
>         ...do NOT return a value for the perspective call...
> 
>     def doneTransferXXX(self, XXX):
>         ...perform any other cleanup...
>         ...NOW return a value for the perspective call...

Good news - you can add multiple callbacks to a single Deferred, and
they will be called sequentially, with the output of each one passed to
the next.  So, in your example:

	def perspective_transferXXX(self, *args):
		d = deferredFunction()
		d.addCallback(self.doneTransfer)
		return d

	def doneTransfer(self, response):
		return response.split() # or whatever

In this example, the (eventually) returned value of deferredFunction()
gets passed to doneTransfer first, which is free to alter it as
neccessary before actually returning the value to the client.

For a much better explanation, see the "Using Deferreds" HOWTO.

Abe




From glyph at twistedmatrix.com  Sat Aug  9 21:29:08 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 9 Aug 2003 22:29:08 -0500
Subject: [Twisted-Python] Sessions and URLs
In-Reply-To: <Pine.BSO.4.44.0308091236270.32656-100000@cyclops4.esentire.com>
Message-ID: <CD4B706D-CAE2-11D7-9301-000393C9700E@twistedmatrix.com>

On Saturday, August 9, 2003, at 11:45 AM, Edmund Dengler wrote:

> So, the code is structured such that a cookie is not available, the 
> normal
> children still get returned. Is this suppose to be how it works? Should
> this be changed so that a flag is available for "force session"? Or 
> should
> a session always be forced (no option)?

Sorry, this should be documented.  You correctly figured out the series 
of steps (more or less) but you missed the annotation of the request 
:-).

SessionWrapper mangles the request, slightly changing the semantics of 
getSession, so that it may return None.  
UsernamePasswordWrapper.getChild begins with

         s = request.getSession()
         if s is None:
             return request.setupSession()

since it currently requires a session in order to operate.  Eventually 
I hope to remove this and have it operate without a session when 
possible.

> Should we have a pattern such as "session-name:cookie" so we can do a
> pattern match for old sessions no longer cached (and force a new 
> session)?

"pattern match"?  No, we just use a dictionary lookup.  SessionWrapper 
will already create a new session when the old one is no longer cached.




From edmundd at eSentire.com  Sat Aug  9 21:44:12 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sat, 9 Aug 2003 23:44:12 -0400 (EDT)
Subject: [Twisted-Python] Sessions and URLs
In-Reply-To: <CD4B706D-CAE2-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <Pine.BSO.4.44.0308092339320.32656-100000@cyclops4.esentire.com>

Greetings!

If there is no pattern match such as "session-name:XXXXX", then how will
you know if an entry is a cookie or a named child? For example, is "yyy" a
cookie or a child? Now, if the code was changed to check for children
first (to see if they exist or not), then you could possibly do this, bit
that would mean old links pointing to a no longer existent child would be
considered a cookie.

Or am I misunderstanding this (which is quite possible)?

Regards,
Ed

On Sat, 9 Aug 2003, Glyph Lefkowitz wrote:

>
> On Saturday, August 9, 2003, at 11:45 AM, Edmund Dengler wrote:
>
> > So, the code is structured such that a cookie is not available, the
> > normal
> > children still get returned. Is this suppose to be how it works? Should
> > this be changed so that a flag is available for "force session"? Or
> > should
> > a session always be forced (no option)?
>
> Sorry, this should be documented.  You correctly figured out the series
> of steps (more or less) but you missed the annotation of the request
> :-).
>
> SessionWrapper mangles the request, slightly changing the semantics of
> getSession, so that it may return None.
> UsernamePasswordWrapper.getChild begins with
>
>          s = request.getSession()
>          if s is None:
>              return request.setupSession()
>
> since it currently requires a session in order to operate.  Eventually
> I hope to remove this and have it operate without a session when
> possible.
>
> > Should we have a pattern such as "session-name:cookie" so we can do a
> > pattern match for old sessions no longer cached (and force a new
> > session)?
>
> "pattern match"?  No, we just use a dictionary lookup.  SessionWrapper
> will already create a new session when the old one is no longer cached.
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From mary-twisted at puzzling.org  Sun Aug 10 03:04:52 2003
From: mary-twisted at puzzling.org (Mary)
Date: Sun, 10 Aug 2003 19:04:52 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
Message-ID: <20030810090452.GA5285@titus.home.puzzling.org>

The problem I'm describing is best illustrated by the two examples
attached.

safe.py renders the following HTML for the / URL (Twisted 1.0.7alpha4):

<?xml version="1.0"?>

<html>
 <body>
  <h1>My name
  </h1>
 </body>
</html>

If I start bad.py like this: "twistd -n -y bad.py" and request the /
URL, it infinitely loops (judging from the output of --spew), and
further, renders twistd uninteruptable via either Ctrl-C or SIGTERM.

In this particular case I'm open to suggestions of "well, don't do that
then" -- the reason, incidently, that I'm trying to use another TestPage
as a submodel is in order to generate previous and next links between
certain pages.

-Mary
-------------- next part --------------
from twisted.web import server
from twisted.internet import app
from twisted.web.woven import page

class TestPage(page.Page):

    template = '''
    <html>
    <body>
    <h1 model="prev/name"/>
    </body>
    </html>
    '''

    def wmfactory_name(self, request):
        return "My name"

    def wmfactory_prev(self, request):
        return TestPage()

s = TestPage()
site = server.Site(s)
application = app.Application("Eyes")
application.listenTCP(8088, site)

-------------- next part --------------
from twisted.web import server
from twisted.internet import app
from twisted.web.woven import page

class TestPage(page.Page):

    template = '''
    <html>
    <body>
    <h1 model="name"/>
    <div model="prev">
    <h1 model="name"/>
    </div>
    </body>
    </html>
    '''

    def wmfactory_name(self, request):
        return "My name"

    def wmfactory_prev(self, request):
        return TestPage()

s = TestPage()
site = server.Site(s)
application = app.Application("Eyes")
application.listenTCP(8088, site)


From radix at twistedmatrix.com  Sun Aug 10 07:46:37 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sun, 10 Aug 2003 09:46:37 -0400
Subject: [Twisted-Python] Sessions and URLs
In-Reply-To: <Pine.BSO.4.44.0308092339320.32656-100000@cyclops4.esentire.com>
References: <CD4B706D-CAE2-11D7-9301-000393C9700E@twistedmatrix.com> <Pine.BSO.4.44.0308092339320.32656-100000@cyclops4.esentire.com>
Message-ID: <20030810134637.GI964@radii>

On Sat, Aug 09, 2003 at 11:44:12PM -0400, Edmund Dengler wrote:
>
> On Sat, 9 Aug 2003, Glyph Lefkowitz wrote:
>
> > "pattern match"?  No, we just use a dictionary lookup.  SessionWrapper
> > will already create a new session when the old one is no longer cached.
>
> If there is no pattern match such as "session-name:XXXXX", then how
> will you know if an entry is a cookie or a named child?
...
> Or am I misunderstanding this (which is quite possible)?

No, you've got it right, though your wording is odd (the session ID
isn't a "cookie", "cookie" means something completely different in our
context). I think the point glyph missed is that you're worried about
people visiting URLs with *old* session IDs in them, which is the same
problem I've been having.

> 
> Regards,
> Ed
> 

> 
> >
> > On Saturday, August 9, 2003, at 11:45 AM, Edmund Dengler wrote:
> >
> > > So, the code is structured such that a cookie is not available, the
> > > normal
> > > children still get returned. Is this suppose to be how it works? Should
> > > this be changed so that a flag is available for "force session"? Or
> > > should
> > > a session always be forced (no option)?
> >
> > Sorry, this should be documented.  You correctly figured out the series
> > of steps (more or less) but you missed the annotation of the request
> > :-).
> >
> > SessionWrapper mangles the request, slightly changing the semantics of
> > getSession, so that it may return None.
> > UsernamePasswordWrapper.getChild begins with
> >
> >          s = request.getSession()
> >          if s is None:
> >              return request.setupSession()
> >
> > since it currently requires a session in order to operate.  Eventually
> > I hope to remove this and have it operate without a session when
> > possible.
> >
> > > Should we have a pattern such as "session-name:cookie" so we can do a
> > > pattern match for old sessions no longer cached (and force a new
> > > session)?
> >
> >
> >
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From mesozoic at polynode.com  Sun Aug 10 10:19:57 2003
From: mesozoic at polynode.com (Alex Levy)
Date: Sun, 10 Aug 2003 12:19:57 -0400
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030810090452.GA5285@titus.home.puzzling.org>
References: <20030810090452.GA5285@titus.home.puzzling.org>
Message-ID: <20030810161957.GE8938@perpetual.moxn.net>

class TestPage(page.Page):
    template = '''
    <html>
    <body>
    <div model="prev">
      ...
    </div>
    </body>
    </html>
    '''
    def wmfactory_prev(self, request):
        return TestPage()

This is an infinite loop. A Page class is both its own model and its own
view; despite the fact that you've made it part of the template here, it
will insert its own template and replace the <div/> you have.

So, when the submodel is created (a TestPage instance), it attempts to
render itself, which makes a TestPage instance as a submodel, which needs to
be rendered, and so on. Ad infinum.

Which begs the question, what are you trying to do? There is likely another
way around whatever problem you're trying to solve.

-- 
Alex Levy
WWW: http://mesozoic.geecs.org
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_



From itamar at itamarst.org  Sun Aug 10 11:21:41 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 10 Aug 2003 13:21:41 -0400
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>
References: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>
Message-ID: <20030810132141.54519b78.itamar@itamarst.org>

On Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
Edmund Dengler <edmundd at eSentire.com> wrote:

> When trying to transfer a row set, which was obtained using the
> pyPgSQL module, I am having problems with specific types not being
> jelly-able. In particular, the row itself
> PgResultSetConcreteRow(?)(this is from memory) and PgInt2 (which I
> found out by trying to send individual elements of the row set over).
> Has anybody else encountered these, and is there a solution other than
> defining my own set of jelly-able components (for example, is there a
> stock jelly library someplace)?

Just convert them into lists and ints or dicts, the applicable python
object that the pypgsql type emulates. SO, write a function that
recurses a postgresql result and cleans it up, and then addCallback it
to the Deferred of the database query result.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From edmundd at eSentire.com  Sun Aug 10 11:38:30 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sun, 10 Aug 2003 13:38:30 -0400 (EDT)
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <20030810132141.54519b78.itamar@itamarst.org>
Message-ID: <Pine.BSO.4.44.0308101336550.21433-100000@cyclops4.esentire.com>

I tried doing it as one of my steps (which is how I ran into the PgInt2
issue when I just did the top level). This is probably easier than
jelly-ing everything, and probably not all that much work (a couple of
hours?), just hoping that there was an already done solution.

Regards!
Ed

On Sun, 10 Aug 2003, Itamar Shtull-Trauring wrote:

> On Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
>
> > When trying to transfer a row set, which was obtained using the
> > pyPgSQL module, I am having problems with specific types not being
> > jelly-able. In particular, the row itself
> > PgResultSetConcreteRow(?)(this is from memory) and PgInt2 (which I
> > found out by trying to send individual elements of the row set over).
> > Has anybody else encountered these, and is there a solution other than
> > defining my own set of jelly-able components (for example, is there a
> > stock jelly library someplace)?
>
> Just convert them into lists and ints or dicts, the applicable python
> object that the pypgsql type emulates. SO, write a function that
> recurses a postgresql result and cleans it up, and then addCallback it
> to the Deferred of the database query result.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From lists at ghaering.de  Sun Aug 10 12:09:58 2003
From: lists at ghaering.de (=?ISO-8859-1?Q?Gerhard_H=E4ring?=)
Date: Sun, 10 Aug 2003 20:09:58 +0200
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <20030810132141.54519b78.itamar@itamarst.org>
References: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>
	<20030810132141.54519b78.itamar@itamarst.org>
Message-ID: <3F368A76.7030304@ghaering.de>

Itamar Shtull-Trauring wrote:
> On Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
> Edmund Dengler <edmundd at eSentire.com> wrote:
> 
>>When trying to transfer a row set, which was obtained using the
>>pyPgSQL module, I am having problems with specific types not being
>>jelly-able. In particular, the row itself
>>PgResultSetConcreteRow(?)(this is from memory) and PgInt2 (which I
>>found out by trying to send individual elements of the row set over).
>>Has anybody else encountered these, and is there a solution other than
>>defining my own set of jelly-able components (for example, is there a
>>stock jelly library someplace)?
> 
> Just convert them into lists and ints or dicts, [...]

First, you want to use pyPgSQL 2.4, which returns Python objects (int, 
...) instead of the pyPgSQL specific numeric types.

Second, you may want to set fetchReturnsList on the connection object to 
1 to get tuples instead of PgResultSets back.

HTH,

-- Gerhard



From gh at ghaering.de  Sun Aug 10 12:15:24 2003
From: gh at ghaering.de (=?ISO-8859-1?Q?Gerhard_H=E4ring?=)
Date: Sun, 10 Aug 2003 20:15:24 +0200
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <3F368A76.7030304@ghaering.de>
References: <Pine.BSO.4.44.0308091814450.32656-100000@cyclops4.esentire.com>	<20030810132141.54519b78.itamar@itamarst.org>
	<3F368A76.7030304@ghaering.de>
Message-ID: <3F368BBC.30101@ghaering.de>

Gerhard Häring wrote:
> [pyPgSQL]
> Second, you may want to set fetchReturnsList on the connection object to 
> 1 to get tuples instead of PgResultSets back.

Oh well. fetchReturnsList is a module-level variable, instead of a 
connection-level variable, like it should be.

-- Gerhard



From edmundd at eSentire.com  Sun Aug 10 12:15:32 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sun, 10 Aug 2003 14:15:32 -0400 (EDT)
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <3F368A76.7030304@ghaering.de>
Message-ID: <Pine.BSO.4.44.0308101414030.21433-100000@cyclops4.esentire.com>

I am using 2.4 (at least that is what PgSQL/__init__.py says).

The result set is due to the use of the Twisted API. How does this work
with Deferreds within the adbapi?

Regards!
Ed

On Sun, 10 Aug 2003, [ISO-8859-1] Gerhard H�ring wrote:

> Itamar Shtull-Trauring wrote:
> > On Sat, 9 Aug 2003 18:19:25 -0400 (EDT)
> > Edmund Dengler <edmundd at eSentire.com> wrote:
> >
> >>When trying to transfer a row set, which was obtained using the
> >>pyPgSQL module, I am having problems with specific types not being
> >>jelly-able. In particular, the row itself
> >>PgResultSetConcreteRow(?)(this is from memory) and PgInt2 (which I
> >>found out by trying to send individual elements of the row set over).
> >>Has anybody else encountered these, and is there a solution other than
> >>defining my own set of jelly-able components (for example, is there a
> >>stock jelly library someplace)?
> >
> > Just convert them into lists and ints or dicts, [...]
>
> First, you want to use pyPgSQL 2.4, which returns Python objects (int,
> ...) instead of the pyPgSQL specific numeric types.
>
> Second, you may want to set fetchReturnsList on the connection object to
> 1 to get tuples instead of PgResultSets back.
>
> HTH,
>
> -- Gerhard
>




From radix at twistedmatrix.com  Sun Aug 10 12:19:48 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sun, 10 Aug 2003 14:19:48 -0400
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <Pine.BSO.4.44.0308101414030.21433-100000@cyclops4.esentire.com>
References: <3F368A76.7030304@ghaering.de> <Pine.BSO.4.44.0308101414030.21433-100000@cyclops4.esentire.com>
Message-ID: <20030810181948.GJ964@radii>

On Sun, Aug 10, 2003 at 02:15:32PM -0400, Edmund Dengler wrote:
> I am using 2.4 (at least that is what PgSQL/__init__.py says).
> 
> The result set is due to the use of the Twisted API. How does this work
> with Deferreds within the adbapi?

Nope, Twisted knows nothing about result sets.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From edmundd at eSentire.com  Sun Aug 10 12:33:38 2003
From: edmundd at eSentire.com (Edmund Dengler)
Date: Sun, 10 Aug 2003 14:33:38 -0400 (EDT)
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <20030810181948.GJ964@radii>
Message-ID: <Pine.BSO.4.44.0308101431310.21433-100000@cyclops4.esentire.com>

Greetings!

Maybe I am missing something then. When using the adbapi, and following
the examples in the HowTo pages, I get a deferred for the query that
passes in the entire result set. How would I restructure the example(s)
such that a deferred would only get a single row, and how would I then
cause the next row to be fetched (via a deferred)?

Regards!
Ed

On Sun, 10 Aug 2003, Christopher Armstrong wrote:

> On Sun, Aug 10, 2003 at 02:15:32PM -0400, Edmund Dengler wrote:
> > I am using 2.4 (at least that is what PgSQL/__init__.py says).
> >
> > The result set is due to the use of the Twisted API. How does this work
> > with Deferreds within the adbapi?
>
> Nope, Twisted knows nothing about result sets.
>
> --
>  Twisted | Christopher Armstrong: International Man of Twistery
>   Radix  |          Release Manager,  Twisted Project
> ---------+     http://twistedmatrix.com/users/radix.twistd/
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From radix at twistedmatrix.com  Sun Aug 10 12:51:16 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sun, 10 Aug 2003 14:51:16 -0400
Subject: [Twisted-Python] Twisted and Postgresql
In-Reply-To: <Pine.BSO.4.44.0308101431310.21433-100000@cyclops4.esentire.com>
References: <20030810181948.GJ964@radii> <Pine.BSO.4.44.0308101431310.21433-100000@cyclops4.esentire.com>
Message-ID: <20030810185116.GK964@radii>

On Sun, Aug 10, 2003 at 02:33:38PM -0400, Edmund Dengler wrote:
> On Sun, 10 Aug 2003, Christopher Armstrong wrote:
>
> > Nope, Twisted knows nothing about result sets.
>
> Maybe I am missing something then. When using the adbapi, and following
> the examples in the HowTo pages, I get a deferred for the query that
> passes in the entire result set. How would I restructure the example(s)
> such that a deferred would only get a single row, and how would I then
> cause the next row to be fetched (via a deferred)?

Ah, yes, we had a miscommunication. I thought by "result set" you
meant PgResultSet, which is the kind of object that pypgsql returns by
default. If you're just talking about lists, the proper term to use is
"list" or perhaps "sequence".

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From mary-twisted at puzzling.org  Sun Aug 10 16:24:31 2003
From: mary-twisted at puzzling.org (Mary)
Date: Mon, 11 Aug 2003 08:24:31 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030810161957.GE8938@perpetual.moxn.net>
References: <20030810090452.GA5285@titus.home.puzzling.org> <20030810161957.GE8938@perpetual.moxn.net>
Message-ID: <20030810222431.GA847@titus.home.puzzling.org>

On Sun, Aug 10, 2003, Alex Levy wrote:
> Which begs the question, what are you trying to do? There is likely another
> way around whatever problem you're trying to solve.

Previous and next links between pages.

The trouble here is that the logic used within the model is the same
logic that is used to generate children, so splitting them into a
MethodModel (say) and a Page with is passed that MethodModel will still
mean sharing data between them in some way.

For example, assume I am generating a page representing all blog entries
in the month of January 2002. I need to have a link to the page
representing December 2001, and the page representing February 2002.

I also want to link to all the entries themselves. So this would be some
kind of submodel ("entries", say). But when the page's children are
requested, I need to use similar logic (the logic for "entries" is "get
all valid children" and the logic for getDynamicChild is "is this a
valid child?"). In the particular storage method I'm using, neither
example is completely trivial either[1]. Hence why I was attempting to
use the Page itself as its own model rather than passing it a model. If
I pass it a model, I still need to use much of the model logic in
getDynamicChild.

-Mary

[1] It may be that I'm not very good at conceptualising this stuff, but
there's a conflict between the tree-based view which is "months are
parents, entries are children" and a flat view in which December 31st
2001 is right before January 1 2002.



From mary-twisted at puzzling.org  Sun Aug 10 16:25:34 2003
From: mary-twisted at puzzling.org (Mary)
Date: Mon, 11 Aug 2003 08:25:34 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030810161957.GE8938@perpetual.moxn.net>
References: <20030810090452.GA5285@titus.home.puzzling.org> <20030810161957.GE8938@perpetual.moxn.net>
Message-ID: <20030810222534.GB847@titus.home.puzzling.org>

On Sun, Aug 10, 2003, Alex Levy wrote:
> This is an infinite loop. A Page class is both its own model and its own
> view; despite the fact that you've made it part of the template here, it
> will insert its own template and replace the <div/> you have.

Do infinite loops always make twistd uninteruptable?

-Mary



From glyph at twistedmatrix.com  Sun Aug 10 19:59:33 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 10 Aug 2003 20:59:33 -0500
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030810222534.GB847@titus.home.puzzling.org>
Message-ID: <73BDE51B-CB9F-11D7-9301-000393C9700E@twistedmatrix.com>

On Sunday, August 10, 2003, at 05:25 PM, Mary wrote:

> Do infinite loops always make twistd uninteruptable?

As you might imagine, it's not twistd, but python.

Some do, and some don't.  I _think_ that the difference is that 
infinite loops which allocate memory are uninterruptible but those 
which are simply iterating can be interrupted, but I have never managed 
to establish a deterministic difference.




From andrew-twisted at puzzling.org  Sun Aug 10 20:06:32 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 11 Aug 2003 12:06:32 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <73BDE51B-CB9F-11D7-9301-000393C9700E@twistedmatrix.com>
References: <20030810222534.GB847@titus.home.puzzling.org> <73BDE51B-CB9F-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <20030811020632.GA2218@frobozz>

On Sun, Aug 10, 2003 at 08:59:33PM -0500, Glyph Lefkowitz wrote:
> 
> On Sunday, August 10, 2003, at 05:25 PM, Mary wrote:
> 
> >Do infinite loops always make twistd uninteruptable?
> 
> As you might imagine, it's not twistd, but python.
> 
> Some do, and some don't.  I _think_ that the difference is that 
> infinite loops which allocate memory are uninterruptible but those 
> which are simply iterating can be interrupted, but I have never managed 
> to establish a deterministic difference.

Also, bare "except:" clauses can suppress KeyboardInterrupt errors, and a
quick grep shows a disturbingly large number of these in Twisted (perhaps
the Coding Standard needs updating?).  That still wouldn't explain why
SIGTERM doesn't work, though :/

-Andrew.




From andrew-twisted at puzzling.org  Sun Aug 10 20:20:49 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 11 Aug 2003 12:20:49 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030811020632.GA2218@frobozz>
References: <20030810222534.GB847@titus.home.puzzling.org> <73BDE51B-CB9F-11D7-9301-000393C9700E@twistedmatrix.com> <20030811020632.GA2218@frobozz>
Message-ID: <20030811022049.GB2218@frobozz>

On Mon, Aug 11, 2003 at 12:06:32PM +1000, Andrew Bennetts wrote:
> 
> Also, bare "except:" clauses can suppress KeyboardInterrupt errors, and a
> quick grep shows a disturbingly large number of these in Twisted (perhaps
> the Coding Standard needs updating?).  That still wouldn't explain why
> SIGTERM doesn't work, though :/

Except of course, Twisted (by default) installs signal handlers to intercept
SIGTERM and SIGINT.  And these just register a call back in the reactor to
shut it down at the next iteration -- but if there's an infinite loop, the
reactor never regains control, so you're stuck.

So, perhaps these signal handlers should:
    a) log that the event happened *immediately*, if it's possible to safely
       use the log file in a signal handler.  That way at least looking at
       the log file you know you're not being completely ignored, and e.g. a
       message like "Caught SIGTERM -- reactor will shutdown on the next
       iteration." would make it clear that if your program isn't shutting
       down, your code isn't returning to the reactor.
    b) keep a counter, so that if 5 SIGINT or SIGTERMs are caught without
       the reactor shutting down, somehow force a shutdown, perhaps
       uncleanly.  Hopefully this can be done without calling os._exit() ;)
       Bonus points for logging a traceback of where-ever the main thread
       was at the time, to help track down infinite loops...

-Andrew.




From glyph at twistedmatrix.com  Sun Aug 10 21:55:06 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 10 Aug 2003 22:55:06 -0500
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <20030811022049.GB2218@frobozz>
Message-ID: <98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>

On Sunday, August 10, 2003, at 09:20 PM, Andrew Bennetts wrote:

>     b) keep a counter, so that if 5 SIGINT or SIGTERMs are caught 
> without
>        the reactor shutting down, somehow force a shutdown, perhaps
>        uncleanly.  Hopefully this can be done without calling 
> os._exit() ;)
>        Bonus points for logging a traceback of where-ever the main 
> thread
>        was at the time, to help track down infinite loops...

Huh!  The reactor used to do this at one point, but it seems to have 
been removed.  It's been a while since I looked at the reactor, but 
does anyone remember doing this?




From itamar at itamarst.org  Sun Aug 10 22:03:05 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 11 Aug 2003 00:03:05 -0400
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>
References: <20030811022049.GB2218@frobozz>
	<98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <20030811000305.74850555.itamar@itamarst.org>

On Sun, 10 Aug 2003 22:55:06 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> Huh!  The reactor used to do this at one point, but it seems to have 
> been removed.  It's been a while since I looked at the reactor, but 
> does anyone remember doing this?

I don't remember the reactor ever doing this, so it must've been a long
time ago. Someone add a bug to the issue tracker, please?


-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From stuart.hungerford at anu.edu.au  Sun Aug 10 22:06:37 2003
From: stuart.hungerford at anu.edu.au (Stuart Hungerford)
Date: Mon, 11 Aug 2003 14:06:37 +1000
Subject: [Twisted-Python] static.Data and embedded URL's...
Message-ID: <5.2.0.9.0.20030811135648.028ea0f8@anusf.anu.edu.au>

Hi all,

I'm using twisted.web for an application that generates very
simple HTML page responses.  It's probably way too simple to
consider using Woven.

I've have some resources inheriting from twisted.web.static.Data
and in their render() method they use a very simplistic
template/substitute:

       def render(self, request):
           lines = load_template('foo.html')
           lines = lines % ('foo', 'bar')
           return lines

My question is how embedded URL's in the string result are handled.
Should static.Data pass URL's originally from foo.html for local
images and stylesheets etc for processing?   I may have misunderstood
the role of the static.* classes here?

I'd welcome any comments on a more twistedonic way of doing this
kind of thing...
Cheers,

Stu

--
:: Stuart Hungerford (stuart.hungerford at anu.edu.au)
:: ANU Internet Futures Group




From andrew-twisted at puzzling.org  Sun Aug 10 22:07:10 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Mon, 11 Aug 2003 14:07:10 +1000
Subject: [Twisted-Python] Uninteruptable infinite loop: Woven rendering
In-Reply-To: <98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>
References: <20030811022049.GB2218@frobozz> <98752AC2-CBAF-11D7-9301-000393C9700E@twistedmatrix.com>
Message-ID: <20030811040709.GC2218@frobozz>

On Sun, Aug 10, 2003 at 10:55:06PM -0500, Glyph Lefkowitz wrote:
> 
> On Sunday, August 10, 2003, at 09:20 PM, Andrew Bennetts wrote:
> 
> >    b) keep a counter, so that if 5 SIGINT or SIGTERMs are caught without
> >       the reactor shutting down, somehow force a shutdown, perhaps
> >       uncleanly.  Hopefully this can be done without calling os._exit() ;)
> >       Bonus points for logging a traceback of where-ever the main thread
> >       was at the time, to help track down infinite loops...
> 
> Huh!  The reactor used to do this at one point, but it seems to have 
> been removed.  It's been a while since I looked at the reactor, but 
> does anyone remember doing this?

It did used to do this (that's where I got the idea from ;), but there's not
much sign of it anymore.  There's a global 'interruptCountdown' in
twisted.internet.main, but it's no longer used anywhere that I can find.
I'm guessing that in the great Reactor Refactor, or the Bride of Reactor
Refactor, this feature went AWOL...

Who wants to have this bug assigned to them?  :)

-Andrew.




From abe at fettig.net  Mon Aug 11 00:11:07 2003
From: abe at fettig.net (Abe Fettig)
Date: 11 Aug 2003 02:11:07 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
Message-ID: <1060582267.614.15.camel@mingus>

Attached you'll find a patch for twisted.web.woven.widgets.  This patch
is designed to let the List view handle hierarchical data, and therefore
generate tree structures and menus instead of plain lists.

Currently this patch works by checking each Model object within a list
for a "children" attribute.  If the Model has a "children" attribute,
the List view generates a child set of nodes, using its template as the
view and the contents of the "children" attribute as the model.  

Sorry if this isn't making sense, it's past my bedtime :-/

Anyhow, there's an example attached that will hopefully illustrate what
I'm trying to say here.  Run this example without the patch, only the
top-level list is used to generate the output.  Run it with the patch,
and the complete hierarchy is rendered.

I'd like to get some feedback on this.  I'm not really happy with the
hard-coded "children" attribute thing - if there's a more
elegant/twistedish way of expressing a hierarchy of objects in Python
I'd love to know about it.

Abe
-------------- next part --------------
A non-text attachment was scrubbed...
Name: list-demo.py
Type: text/x-python
Size: 1236 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030811/029cf1a4/attachment-0002.py>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: woven-widgets-List-patch.txt
Type: text/x-patch
Size: 797 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030811/029cf1a4/attachment-0002.bin>

From radix at twistedmatrix.com  Mon Aug 11 08:30:19 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Mon, 11 Aug 2003 10:30:19 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
In-Reply-To: <1060582267.614.15.camel@mingus>
References: <1060582267.614.15.camel@mingus>
Message-ID: <20030811143019.GL964@radii>

On Mon, Aug 11, 2003 at 02:11:07AM -0400, Abe Fettig wrote:
> I'd like to get some feedback on this.  I'm not really happy with the
> hard-coded "children" attribute thing - if there's a more
> elegant/twistedish way of expressing a hierarchy of objects in Python
> I'd love to know about it.

Well, my first instinct would be move it into a completely separate
Widget class. Once that's done, I'd make the model, rather than a list
of things with .children attributes, just a list of lists. Also, some
extra patterns for more fine-grained control of how this thing gets
renderred would be nice, but I can't think of any now. 

I do have a need for something like this in Plonk, for the navigation
menu -- I'd like a hierarchy of links displayed rather than just a
contextual "current children" list. I'll try your patch (or something
like it) when I get around to implementing that, and I'll have much
better input then :)



-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From abe at fettig.net  Mon Aug 11 09:15:52 2003
From: abe at fettig.net (Abe Fettig)
Date: 11 Aug 2003 11:15:52 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
In-Reply-To: <20030811143019.GL964@radii>
References: <1060582267.614.15.camel@mingus>  <20030811143019.GL964@radii>
Message-ID: <1060614952.578.29.camel@mingus>

On Mon, 2003-08-11 at 10:30, Christopher Armstrong wrote:

> Well, my first instinct would be move it into a completely separate
> Widget class. 

Fair enough - I just put it into List since it's only a few additional
lines of code, and I didn't want to have to copy-paste the existing List
widget.

> Once that's done, I'd make the model, rather than a list
> of things with .children attributes, just a list of lists. 

You could do it with lists, I suppose.  Say you want to express a
typical hierarchical tree, like this:

Inbox
Outbox
Personal Mail
	Joe
	Fred

You could have a model like so:

[
	["Inbox", []],
	["Outbox", []],
	["Personal Mail", [
		["Joe", []],
		["Fred", []]
	]
]
 
Where each item in the tree is a list made up of two objects: item,
children.

Is that preferable?  It still doesn't seem like the most elegant way of
doing things.  Does anyone have a better idea?

Abe




From bob at redivi.com  Mon Aug 11 09:54:20 2003
From: bob at redivi.com (Bob Ippolito)
Date: Mon, 11 Aug 2003 11:54:20 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
In-Reply-To: <1060614952.578.29.camel@mingus>
Message-ID: <11D6BEF2-CC14-11D7-A79E-000A95686CD8@redivi.com>

On Monday, Aug 11, 2003, at 11:15 America/New_York, Abe Fettig wrote:

> On Mon, 2003-08-11 at 10:30, Christopher Armstrong wrote:
>
>> Well, my first instinct would be move it into a completely separate
>> Widget class.
>
> Fair enough - I just put it into List since it's only a few additional
> lines of code, and I didn't want to have to copy-paste the existing 
> List
> widget.

Couldn't you have done it by subclassing List?

-bob




From radix at twistedmatrix.com  Mon Aug 11 10:18:22 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Mon, 11 Aug 2003 12:18:22 -0400
Subject: [Twisted-Python] Re: [Twisted-commits] Adventures in Epydoc: Stop The Hurt, part 1: The end of privatization
In-Reply-To: <E19mF8V-00084e-00@pyramid.twistedmatrix.com>
References: <E19mF8V-00084e-00@pyramid.twistedmatrix.com>
Message-ID: <20030811161822.GM964@radii>

On Mon, Aug 11, 2003 at 11:03:07AM -0500, radix CVS wrote:
> Modified files:
> Twisted/admin/epyrun 1.20 1.21
> 
> Log message:
> Adventures in Epydoc: Stop The Hurt, part 1: The end of privatization

Some of you have been complaining about the huge size of the API
documentation in recent releases. I've discovered that the reason for
this was most likely a work-around that spiv did so that there are
HTML files for every single method in the documented code (they each
just contained a tiny snippet of HTML that redirected to the canonical
location of the documentation for that method). Assuming 4k blocks on
your filesystem, all of these tiny files added to an immense amount of
wasted space. 

I haven't taken this out, however: I've cut the size of the
documentation in half by removing the "private" cruft. epydoc by
default generates a separate tree of documentation that contains
everything the `public' tree has, but also things it deems "private",
like methods that begin with "_", or objects that are not listed in a
module's "__all__". I've hacked it so that *everything* is considered
`public' by epydoc, and it no longer generates that duplicate
`private' tree.

Next up on my todo for the documentation is to try to get epydoc to
stop documenting non-Twisted things. Currently it's documenting many
things from the Python standard library as well as third-party
libraries that Twisted uses. All of this extra documentation builds up
to about 8.8MB of wasted space, assuming 4k blocks. After that, I'm
going to look into getting the docs building with Python 2.3 (Cory
Dodt has reported problems with code using the twisted.python.hook
module). Also, I'll try to get the Twisted version number on every
page of docs.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From abe at fettig.net  Mon Aug 11 13:29:28 2003
From: abe at fettig.net (Abe Fettig)
Date: 11 Aug 2003 15:29:28 -0400
Subject: [Twisted-Python] RFC - List hierarchies in Woven
In-Reply-To: <11D6BEF2-CC14-11D7-A79E-000A95686CD8@redivi.com>
References: <11D6BEF2-CC14-11D7-A79E-000A95686CD8@redivi.com>
Message-ID: <1060630168.614.208.camel@mingus>

On Mon, 2003-08-11 at 11:54, Bob Ippolito wrote:
> On Monday, Aug 11, 2003, at 11:15 America/New_York, Abe Fettig wrote:

> > Fair enough - I just put it into List since it's only a few additional
> > lines of code, and I didn't want to have to copy-paste the existing 
> > List
> > widget.
> 
> Couldn't you have done it by subclassing List?

Well, yes, but since I'm modifying the behavior of _iterateData it still
means copying and pasting half the code.  Although if I end up using a
model that's incompatible with ListModel than I'll be would be required
to do this anyway.

I've attached a second demo that provides a Tree widget class that
inherits from List.  This widget takes a Model made up of nested lists,
instead of the objects-with-.children I was using before.

Again, comments are invited.

Abe
-------------- next part --------------
A non-text attachment was scrubbed...
Name: list-demo2.py
Type: text/x-python
Size: 1757 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030811/da42abf4/attachment-0002.py>

From edd at usefulinc.com  Tue Aug 12 05:27:45 2003
From: edd at usefulinc.com (Edd Dumbill)
Date: 12 Aug 2003 12:27:45 +0100
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
Message-ID: <1060687664.22348.18.camel@pingu.bunker.heddley.com>

Hello,

Firstly, thanks for Twisted, I'm just starting to use it and I'm
impressed with what I see.  I'm also grateful for the help folks have
given me on the IRC channel.

So here's my problem.  I'm adapting the spider from Twisted to my own
purposes.  One problem I've come across is this: that an HTTP connection
will be opened OK, but is just held open with no return for many many
minutes by a server.

So, I want to implement a timeout.  As I understand it, this is
different from the timeout given at reactor.connectTCP time, as it's
post-connect.  Certainly that's how it looks from here.

I guess that somewhere I want a callLater which stops a download after
so many seconds, and that's what I tried to do.  Unfortunately I have no
idea what to do to implement that.  Most of my attempts ended up in
raising exceptions that brought everything to a halt: my understanding
of the thread of execution throughout the various Twisted components is
currently very immature.

I'd be grateful for pointers on how to implement this, with reference to
twisted/web/spider.py.  Essentially what I want is a timeout to cause an
error that will result in SpiderSender.downloadFailed being invoked,
pretty much as for any other error relating to the HTTP connection does.

With many thanks,

-- Edd





From glyph at twistedmatrix.com  Tue Aug 12 07:48:29 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 12 Aug 2003 08:48:29 -0500
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
In-Reply-To: <1060687664.22348.18.camel@pingu.bunker.heddley.com>
Message-ID: <A7A1A6D4-CCCB-11D7-B69D-000393C9700E@twistedmatrix.com>

On Tuesday, August 12, 2003, at 06:27 AM, Edd Dumbill wrote:

> I'd be grateful for pointers on how to implement this, with reference 
> to
> twisted/web/spider.py.  Essentially what I want is a timeout to cause 
> an
> error that will result in SpiderSender.downloadFailed being invoked,
> pretty much as for any other error relating to the HTTP connection 
> does.

I certainly haven't tested this, but in your SpiderSender subclass, you 
probably want something like

	myTimeout = 120 # seconds
	def notifyDownloadStart(self, uri):
	    reactor.callLater(self.myTimeout, self._timeOut, uri)
	    # rest of notifyDownloadStart

	def _timeOut(self, uri):
	    if self.downloaders.has_key(uri):
	        self.downloaders[uri].loseConnection()




From bob at redivi.com  Tue Aug 12 08:17:15 2003
From: bob at redivi.com (Bob Ippolito)
Date: Tue, 12 Aug 2003 10:17:15 -0400
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
In-Reply-To: <A7A1A6D4-CCCB-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <ACB2C7AF-CCCF-11D7-8C06-000A95686CD8@redivi.com>

On Tuesday, Aug 12, 2003, at 09:48 America/New_York, Glyph Lefkowitz 
wrote:

>
> On Tuesday, August 12, 2003, at 06:27 AM, Edd Dumbill wrote:
>
>> I'd be grateful for pointers on how to implement this, with reference 
>> to
>> twisted/web/spider.py.  Essentially what I want is a timeout to cause 
>> an
>> error that will result in SpiderSender.downloadFailed being invoked,
>> pretty much as for any other error relating to the HTTP connection 
>> does.
>
> I certainly haven't tested this, but in your SpiderSender subclass, 
> you probably want something like
>
> 	myTimeout = 120 # seconds
> 	def notifyDownloadStart(self, uri):
> 	    reactor.callLater(self.myTimeout, self._timeOut, uri)
> 	    # rest of notifyDownloadStart
>
> 	def _timeOut(self, uri):
> 	    if self.downloaders.has_key(uri):
> 	        self.downloaders[uri].loseConnection()

So how do you make this work based upon a *request* to make a download 
stop, rather than a predetermined amount of time?  ;)

-bob




From edd at usefulinc.com  Tue Aug 12 08:22:57 2003
From: edd at usefulinc.com (Edd Dumbill)
Date: 12 Aug 2003 15:22:57 +0100
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
In-Reply-To: <A7A1A6D4-CCCB-11D7-B69D-000393C9700E@twistedmatrix.com>
References: <A7A1A6D4-CCCB-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <1060698177.22348.27.camel@pingu.bunker.heddley.com>

On Tue, 2003-08-12 at 14:48, Glyph Lefkowitz wrote:
> I certainly haven't tested this, but in your SpiderSender subclass, you 
> probably want something like
> 
> 	myTimeout = 120 # seconds
> 	def notifyDownloadStart(self, uri):
> 	    reactor.callLater(self.myTimeout, self._timeOut, uri)
> 	    # rest of notifyDownloadStart
> 
> 	def _timeOut(self, uri):
> 	    if self.downloaders.has_key(uri):
> 	        self.downloaders[uri].loseConnection()
> 

Thanks, I'll try that.  I think it was the loseConnection() bit I was
missing.

My interim solution is a bit nuttier, and I'm not actually convinced it
works, either, but it did allow me to find a bug with 302 redirect loops
(issue 99!)

class TimeOutHTTPPageDownloader(client.HTTPPageDownloader,TimeoutMixin):
    def connectionMade (self):
        self.setTimeout (30)
        client.HTTPPageDownloader.connectionMade (self)

class HTTPDownloader(client.HTTPDownloader):

    protocol = TimeOutHTTPPageDownloader
   

...

-- Edd





From lafou at wanadoo.fr  Tue Aug 12 08:28:16 2003
From: lafou at wanadoo.fr (Philippe =?ISO-8859-1?Q?Lafoucri=E8re?=)
Date: 12 Aug 2003 16:28:16 +0200
Subject: [Twisted-Python] Setting a timeout for HTTPDownloader
In-Reply-To: <ACB2C7AF-CCCF-11D7-8C06-000A95686CD8@redivi.com>
References: <ACB2C7AF-CCCF-11D7-8C06-000A95686CD8@redivi.com>
Message-ID: <1060698496.2927.27.camel@biproc>

You should set a var when the download starts :

> > 	myTimeout = 120 # seconds
		self.started = False
> > 	def notifyDownloadStart(self, uri):
> > 	    reactor.callLater(self.myTimeout, self._timeOut, uri)
> > 	    # rest of notifyDownloadStart
		# if download starts :
		self.started = True
> >
> > 	def _timeOut(self, uri):
		if self.started:
> >	 	    if self.downloaders.has_key(uri):
> >	 	        self.downloaders[uri].loseConnection()





From justinjohnson at fastmail.fm  Tue Aug 12 09:22:18 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 12 Aug 2003 09:22:18 -0600
Subject: [Twisted-Python] PB service send output to client
Message-ID: <20030812152218.9B50537F35@www.fastmail.fm>

What is the best way to have a PB service send output to a client to be
printed on the screen?  The only way I'm aware of is by making the client
be a PB service as well with only a remote_print method, but I wasn't
sure if that was the best way to do this.

Thanks.
-Justin



From itamar at itamarst.org  Tue Aug 12 09:54:24 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 12 Aug 2003 11:54:24 -0400
Subject: [Twisted-Python] PB service send output to client
In-Reply-To: <20030812152218.9B50537F35@www.fastmail.fm>
References: <20030812152218.9B50537F35@www.fastmail.fm>
Message-ID: <20030812115424.61d1f3ce.itamar@itamarst.org>

On Tue, 12 Aug 2003 09:22:18 -0600
"Justin Johnson" <justinjohnson at fastmail.fm> wrote:

> What is the best way to have a PB service send output to a client to
> be printed on the screen?  The only way I'm aware of is by making the
> client be a PB service as well with only a remote_print method, but I
> wasn't sure if that was the best way to do this.

"service"? The client should have a PB Referenceable it passes to the
server, that has a remote_print.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Tue Aug 12 10:04:04 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 12 Aug 2003 10:04:04 -0600
Subject: [Twisted-Python] PB service send output to client
In-Reply-To: <20030812115424.61d1f3ce.itamar@itamarst.org>
References: <20030812152218.9B50537F35@www.fastmail.fm> <20030812115424.61d1f3ce.itamar@itamarst.org>
Message-ID: <20030812160404.F2CA337C93@www.fastmail.fm>

Okay, that's what I thought.  Thanks.

On Tue, 12 Aug 2003 11:54:24 -0400, "Itamar Shtull-Trauring"
<itamar at itamarst.org> said:
> On Tue, 12 Aug 2003 09:22:18 -0600
> "Justin Johnson" <justinjohnson at fastmail.fm> wrote:
> 
> > What is the best way to have a PB service send output to a client to
> > be printed on the screen?  The only way I'm aware of is by making the
> > client be a PB service as well with only a remote_print method, but I
> > wasn't sure if that was the best way to do this.
> 
> "service"? The client should have a PB Referenceable it passes to the
> server, that has a remote_print.
> 
> -- 
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From nico at tekNico.net  Tue Aug 12 11:47:10 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Tue, 12 Aug 2003 19:47:10 +0200
Subject: [Twisted-Python] Watching over a Twisted daemon
Message-ID: <3F39281E.9070607@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I'm using the ProcessMonitor class from t.runner.procmon, with good results,
to start and monitor a few daemons from Twisted. If a daemon goes down, it
is restarted immediately, because the class does not detach from the
daemons' streams.

This unfortunately introduces a single point of failure, because if the
Twisted process goes down, it not only does not monitors the daemons
anymore, but effectively takes them down with it.

It would be nice if Twisted could, via the ProcessMonitor class or
otherwise, monitor long running processes to whose streams it is not connected.

That would even allow one to start a second Twisted instance monitoring the
first, while the first could monitor the second, so that they would
effectively act as the watchdog of each other.

I could try and reimplement the ProcessMonitor class making it use pid
files, the output of the ps command, or even /proc/ directly (non-portable),
but first I would like to know if this is a sound idea, or maybe there are
simpler ways to get this result.


- --
"Finding a pianist who can play the notes is cheap.
Just as finding a programmer who can write code is cheap. [...]
Finding a pianist who is a musician, or finding a coder who is an artist
- - that is a rare and precious find indeed."  Russell, on Slashdot

Nicola Larosa - nico at tekNico.net


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/OSgdXv0hgDImBm4RAm2GAKC+4+gcqKuDNuI1Yf3TguzDjQ90zgCfZqo5
oDuXTPu6iiJtcGM9fGlWk/A=
=G1Ub
-----END PGP SIGNATURE-----





From nico at tekNico.net  Tue Aug 12 12:01:54 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Tue, 12 Aug 2003 20:01:54 +0200
Subject: [Twisted-Python] Patch to procmon.py
Message-ID: <3F392B92.2040005@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

The class ProcessMonitor, from t.runner.procmon, is very useful to start and
monitor processes from within Twisted. Alas, that class sends all output
from the controlled processes to the log.

The attached simple patch to the startProcess method allows one to
substitute another protocol for the LoggingProtocol one, on a per-process
basis, keeping the current one as default.

Would it be appropriate for me to submit it to the bug tracker, using it as
a Feature Request container?


- --
"Finding a pianist who can play the notes is cheap.
Just as finding a programmer who can write code is cheap. [...]
Finding a pianist who is a musician, or finding a coder who is an artist
- - that is a rare and precious find indeed."  Russell, on Slashdot

Nicola Larosa - nico at tekNico.net


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/OSuRXv0hgDImBm4RAlOnAKCvvw8qbKybo/fZ50FdJLxWqDnw3QCgx3OW
A+F1TriIL/zjNjUiVE6XEoo=
=sRuq
-----END PGP SIGNATURE-----
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: procmon.py.diff
URL: </pipermail/twisted-python/attachments/20030812/c01a01e9/attachment.ksh>

From itamar at itamarst.org  Tue Aug 12 14:04:07 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 12 Aug 2003 16:04:07 -0400
Subject: [Twisted-Python] Patch to procmon.py
In-Reply-To: <3F392B92.2040005@tekNico.net>
References: <3F392B92.2040005@tekNico.net>
Message-ID: <20030812160407.35f35eda.itamar@itamarst.org>

On Tue, 12 Aug 2003 20:01:54 +0200
Nicola Larosa <nico at tekNico.net> wrote:

> Would it be appropriate for me to submit it to the bug tracker, using
> it as a Feature Request container?

Yes. *All* patches should go into the tracker.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From tv at twistedmatrix.com  Tue Aug 12 15:15:34 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Wed, 13 Aug 2003 00:15:34 +0300
Subject: [Twisted-Python] Watching over a Twisted daemon
In-Reply-To: <3F39281E.9070607@tekNico.net>
References: <3F39281E.9070607@tekNico.net>
Message-ID: <20030812211534.GA24793@lapdog>

On Tue, Aug 12, 2003 at 07:47:10PM +0200, Nicola Larosa wrote:
> This unfortunately introduces a single point of failure, because if the
> Twisted process goes down, it not only does not monitors the daemons
> anymore, but effectively takes them down with it.

	You really can't control a more-reliable system with a
	less-reliable system. The procmon process is meant to
	be simple enough to not die in vain.

	And monitoring daemons without being able to receive
	their SIGCHLDs is both race-prone and requires polling.
	Not nice.

-- 
:(){ :|:&};:



From maoy at cis.upenn.edu  Tue Aug 12 22:55:09 2003
From: maoy at cis.upenn.edu (Yun Mao)
Date: Wed, 13 Aug 2003 00:55:09 -0400
Subject: [Twisted-Python] suggestions needed on a process output event
In-Reply-To: <20030812160407.35f35eda.itamar@itamarst.org>
References: <3F392B92.2040005@tekNico.net> <20030812160407.35f35eda.itamar@itamarst.org>
Message-ID: <3F39C4AD.5070407@cis.upenn.edu>

Hi. I'm a new to twisted python (and python) and found that they are 
really interesting! I have several questions:
1. Can a reactor listen on several ports at the same time?
2. How to add some special event? For example, I have a process running: 
say "tail -f /var/log/messages". I wish, each time, when the process 
outputs a new line, my protocol could receive such an event (like 
dataReceived), and I can get that new line as my data. How to implement 
this?

Thank you very much!
--yun




From itamar at itamarst.org  Tue Aug 12 23:05:06 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 13 Aug 2003 01:05:06 -0400
Subject: [Twisted-Python] suggestions needed on a process output event
In-Reply-To: <3F39C4AD.5070407@cis.upenn.edu>
References: <3F392B92.2040005@tekNico.net>
	<20030812160407.35f35eda.itamar@itamarst.org>
	<3F39C4AD.5070407@cis.upenn.edu>
Message-ID: <20030813010506.062c3838.itamar@itamarst.org>

On Wed, 13 Aug 2003 00:55:09 -0400
Yun Mao <maoy at cis.upenn.edu> wrote:

> 1. Can a reactor listen on several ports at the same time?

Yes. Just do reactor.listenTCP multiple times.

> 2. How to add some special event? For example, I have a process
> running: say "tail -f /var/log/messages". I wish, each time, when the
> process outputs a new line, my protocol could receive such an event
> (like dataReceived), and I can get that new line as my data. How to
> implement this?

reactor.spawnProcess, with a twisted.protocols.basic.LineReceiver hooked
up to the process. See http://twistedmatrix.com/documents/howto/process

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From glyph at twistedmatrix.com  Tue Aug 12 23:16:10 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 13 Aug 2003 00:16:10 -0500
Subject: [Twisted-Python] suggestions needed on a process output event
In-Reply-To: <20030813010506.062c3838.itamar@itamarst.org>
Message-ID: <40208A96-CD4D-11D7-B69D-000393C9700E@twistedmatrix.com>

On Wednesday, August 13, 2003, at 12:05 AM, Itamar Shtull-Trauring 
wrote:

>> 2. How to add some special event? For example, I have a process
>> running: say "tail -f /var/log/messages". I wish, each time, when the
>> process outputs a new line, my protocol could receive such an event
>> (like dataReceived), and I can get that new line as my data. How to
>> implement this?
>
> reactor.spawnProcess, with a twisted.protocols.basic.LineReceiver 
> hooked
> up to the process. See http://twistedmatrix.com/documents/howto/process

If your process is literally 'tail -f', having an extra UNIX process 
around for it is kinda wasteful.  You can get the same effect by 
keeping an open file around and reading the remainder of it every 
second.  (using reactor.callLater)




From m at moshez.org  Tue Aug 12 23:41:25 2003
From: m at moshez.org (Moshe Zadka)
Date: 13 Aug 2003 05:41:25 -0000
Subject: [Twisted-Python] suggestions needed on a process output event
In-Reply-To: <40208A96-CD4D-11D7-B69D-000393C9700E@twistedmatrix.com>
References: <40208A96-CD4D-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <20030813054125.19634.qmail@green.zadka.com>

On Wed, 13 Aug 2003, Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> If your process is literally 'tail -f', having an extra UNIX process 
> around for it is kinda wasteful.  You can get the same effect by 
> keeping an open file around and reading the remainder of it every 
> second.  (using reactor.callLater)

Remembering such details as clearing EOF bits, and possibly chasing
inodes and stuff. Tail is not as trivial as one would have thought :)
 
-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From nico at tekNico.net  Wed Aug 13 01:39:09 2003
From: nico at tekNico.net (Nicola Larosa)
Date: Wed, 13 Aug 2003 09:39:09 +0200
Subject: [Twisted-Python] Patch to procmon.py
In-Reply-To: <20030812160407.35f35eda.itamar@itamarst.org>
References: <3F392B92.2040005@tekNico.net> <20030812160407.35f35eda.itamar@itamarst.org>
Message-ID: <3F39EB1D.1010000@tekNico.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> Yes. *All* patches should go into the tracker.

Done. Created issue 194, assigned it to tv, since he seems to have done the
most recent commits to CVS.


- --
"Finding a pianist who can play the notes is cheap.
Just as finding a programmer who can write code is cheap. [...]
Finding a pianist who is a musician, or finding a coder who is an artist
- - that is a rare and precious find indeed."  Russell, on Slashdot

Nicola Larosa - nico at tekNico.net

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQE/OesbXv0hgDImBm4RAqQEAKC/PWhZF4UiotQIrcF3HqVWF+r+4wCeIpi3
En16oY4KSXgI3kP+byq1dAQ=
=EzGL
-----END PGP SIGNATURE-----




From twisted at evpopov.com  Wed Aug 13 03:42:49 2003
From: twisted at evpopov.com (twisted at evpopov.com)
Date: Wed, 13 Aug 2003 11:42:49 +0200 (MEST)
Subject: [Twisted-Python] Support for ICMP / traceroute ?
Message-ID: <1060767769.3f3a08190933f@imp.pro.proxad.net>

(note to moderators: I sent this message two times before but with a wrong 
source email. You can safely delete them)

Hi,

Im currently evaluating Twisted to make cross-platform network developments.

The targeted OS are: Win32 (W2K and above), Linux. More Unix flavors would have 
to be supported later on.

>From what Ive read about Twisted, it should work on those platforms as it is 
python-based. Could you confirm that my own .py scripts will run as-is under 
those different platforms (provided I myself dont use platform-specific 
features of course) ?

I will need to implement the ping protocol (client side), and most probably 
also the traceroute protocol. I didnt see those protocols in the doc, but 
would it be possible to implement them with Twisted ? I saw some classes 
related to raw sockets, so Im confident it should be manageable. I would like 
some confirmations its possible and cross-platformly.

Note: for traceroute, the TTL of the packet has to be set with each packet: 
with the socket API, you can use a setsockopt() call to set it, I dont know 
how it is managed (if it is) with Twisted. Another way would be to build our 
own IP packet, so that we can set the TTL field.

If answers to those questions are positive, then you may have won a new twisted 
user :).

Thanks for any reply.



From lucas at lucaserve.com  Wed Aug 13 04:04:17 2003
From: lucas at lucaserve.com (Lucas Taylor)
Date: Wed, 13 Aug 2003 03:04:17 -0700
Subject: [Twisted-Python] Deferred database transaction confusion
Message-ID: <01d201c36182$45719420$0201a8c0@lucas2k>

Greetings!

I'm trying to figure out the best way to accomplish database
transactions and I haven't quite got my head wrapped around deferreds
and the adbapi. I'm hoping someone can nudge me in the right direction.

Basically, we have simple terminals that communicate over dialup lines
to a host server. The host server essentially handles the modem
negotiation and passes everything else through to our Twisted server. We
process the transaction and return the result to the client, and the
protocol specifies an ACK is to be returned on successful receipt. So
I've got a dictionary of transport.sessionnos which hold the ACK state
of the connection. Once the terminal has ACKed the host server, it
passes that along to the Twisted server and drops the connection. On
connectionLost I lookup the ACK value of the connection to make sure the
terminal rx'd the data and then I should be able to commit or rollback
any pending db transactions.

Now here's where I'm stuck. I've got a rudimentary idea of how I will be
chaining callbacks to the deferred results of my db interactions, and
once complete the data will be sent to the terminal. And the registered
errbacks need to be able to rollback if necessary. But how do I get the
protocol handler to access the database connection to issue the
commit/rollback?

btw, thanks to the developers for making my project so incredibly
'do-able'. It's really quite cool - I was able to demo a proof of
concept in an evening after downloading Twisted. The protocol handling
was so easy to setup for what we needed that it was silly.


Thanks,

Lucas Taylor




From itamar at itamarst.org  Wed Aug 13 06:23:53 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 13 Aug 2003 08:23:53 -0400
Subject: [Twisted-Python] Deferred database transaction confusion
In-Reply-To: <01d201c36182$45719420$0201a8c0@lucas2k>
References: <01d201c36182$45719420$0201a8c0@lucas2k>
Message-ID: <20030813082353.2ac6cdaa.itamar@itamarst.org>

On Wed, 13 Aug 2003 03:04:17 -0700
"Lucas Taylor" <lucas at lucaserve.com> wrote:

> Now here's where I'm stuck. I've got a rudimentary idea of how I will
> be chaining callbacks to the deferred results of my db interactions,
> and once complete the data will be sent to the terminal. And the
> registered errbacks need to be able to rollback if necessary. But how
> do I get the protocol handler to access the database connection to
> issue the commit/rollback?

You don't. The commit/rollback happens before the Deferred's callbacks
get called. In fact, the commit/rollback are done for you automatically
- if you runInteraction the operations you did will be committed if they
succeeded or rolled back if an exception was raised in the interaction
function.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From abe at fettig.net  Wed Aug 13 08:27:26 2003
From: abe at fettig.net (Abe Fettig)
Date: 13 Aug 2003 10:27:26 -0400
Subject: [Twisted-Python] woven View question
Message-ID: <1060784845.519.10.camel@mingus>

Is it considered cool to use a Woven template to pass arguments to the
View?  For example:

<div view='MyCustomView' doOptionalStuff='1'></div>

...where the View will read the doOptionalStuff parameter and alter it's
output accordingly.

Abe




From corydodt at yahoo.com  Wed Aug 13 09:04:10 2003
From: corydodt at yahoo.com (Cory Dodt)
Date: Wed, 13 Aug 2003 08:04:10 -0700
Subject: [Twisted-Python] Ann: Win32/Python2.3 available
Message-ID: <3F3A536A.1060902@yahoo.com>

Just a note to let you Windows folks know that there are now official 
installers for Python 2.3.  These are built against 1.0.7alpha4.  Python 
2.2 is also now available for this release.

These installers represent a complete overhaul of both the installer 
itself and the system used to build it.  Let me know at 
http://twistedmatrix.com/bugs if there are any problems (assign to 
moonfallen); it's currently untested on WinXP and Win98.

I'd also be interested in hearing about any problems if you want to 
build an installer yourself for whatever reason.  The instructions are 
in win32/README.win32.

C




From twisted at evpopov.com  Wed Aug 13 10:02:14 2003
From: twisted at evpopov.com (popov)
Date: Wed, 13 Aug 2003 18:02:14 +0200
Subject: [Twisted-Python] Support for ICMP / traceroute ?
Message-ID: <005701c361b4$4854cb30$f901a8c0@galbedir>

(a new try, as it seems the message was broken the last time I sent it)

Hi,

I'm currently evaluating 'Twisted' to make cross-platform network
developments.

The targeted OS are: Win32 (W2K and above), Linux. More Unix flavors would
have to be supported later on.

>From what I've read about 'Twisted', it should work on those platforms as it
is python-based. Could you confirm that my own .py scripts will run as-is
under those different platforms (provided I myself don't use
platform-specific features of course) ?

I will need to implement the ping protocol (client side), and most probably
also the traceroute 'protocol'. I didn't see those protocols in the doc, but
would it be possible to implement them with Twisted ? I saw some classes
related to raw sockets, so I'm confident it should be manageable. I would
like some confirmations it's possible and 'cross-platform'ly.

Note: for traceroute, the TTL of the packet has to be set with each packet:
with the socket API, you can use a setsockopt() call to set it, I don't know
how it is managed (if it is) with Twisted. Another way would be to build our
own IP packet, so that we can set the TTL field.

If answers to those questions are positive, then you may have won a new
twisted user :).

Thanks for any reply.




From lucas at lucaserve.com  Wed Aug 13 11:18:07 2003
From: lucas at lucaserve.com (Lucas Taylor)
Date: Wed, 13 Aug 2003 10:18:07 -0700
Subject: [Twisted-Python] Deferred database transaction confusion
References: <01d201c36182$45719420$0201a8c0@lucas2k> <20030813082353.2ac6cdaa.itamar@itamarst.org>
Message-ID: <01e901c361be$de0e1050$0201a8c0@lucas2k>

OK, I receive a response from my interaction, and it will have been
committed if no exceptions occurred. Does this mean I have no way of
controlling the commit/rollback behavior? How would you wrap a series of
transactions that relied on each other?
Say I have a series of db work that needs to be done, like:

selectCustomer
(do some work)
updateCustomer
updateBalance
(do some more work)
insertTxTable

Ignoring the fact that I don't want to commit any of these transactions
until I rx a response from the client, how would I treat these as
atomic? I don't want the updates to actually commit until the insert is
complete into the TxTable. I guess I could move a lot of the logic to a
single stored procedure if it's going to be committed on execution
before the client actually receives the results. But that's no fun.

Maybe what I'll have to do is keep track of every db update/insert and
have corresponding balancing procedures so that I can do a manual
rollback

Thanks,

Lucas Taylor


----- Original Message -----
From: "Itamar Shtull-Trauring" <itamar at itamarst.org>
To: <twisted-python at twistedmatrix.com>
Sent: Wednesday, August 13, 2003 5:23 AM
Subject: Re: [Twisted-Python] Deferred database transaction confusion


>
> You don't. The commit/rollback happens before the Deferred's callbacks
> get called. In fact, the commit/rollback are done for you
automatically
> - if you runInteraction the operations you did will be committed if
they
> succeeded or rolled back if an exception was raised in the interaction
> function.
>
> --
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
>




From itamar at itamarst.org  Wed Aug 13 11:26:24 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 13 Aug 2003 13:26:24 -0400
Subject: [Twisted-Python] Deferred database transaction confusion
In-Reply-To: <01e901c361be$de0e1050$0201a8c0@lucas2k>
References: <01d201c36182$45719420$0201a8c0@lucas2k>
	<20030813082353.2ac6cdaa.itamar@itamarst.org>
	<01e901c361be$de0e1050$0201a8c0@lucas2k>
Message-ID: <20030813132624.3297076e.itamar@itamarst.org>

On Wed, 13 Aug 2003 10:18:07 -0700
"Lucas Taylor" <lucas at lucaserve.com> wrote:

> selectCustomer
> (do some work)
> updateCustomer
> updateBalance
> (do some more work)
> insertTxTable

do it in a runInteraction, which is the span of a single transaction,
and lets you do multiple operations. And you can use
reactor.callFromThread to communicate with the main reactor thread.

> Maybe what I'll have to do is keep track of every db update/insert and
> have corresponding balancing procedures so that I can do a manual
> rollback

Eeew, no, don't do that. Worst case roll your own database interaction
code using the threading support, you don't have to use
twisted.enterprise if it doesn't make sense.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Wed Aug 13 13:21:08 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Wed, 13 Aug 2003 13:21:08 -0600
Subject: [Twisted-Python] win32eventreactor problems
Message-ID: <20030813192108.295D937F83@www.fastmail.fm>

I had the win32eventreactor working a while back, but now I have a
problem and I'm not sure what's going on.  The attached file installs
win32eventreactor as follows:

---
if not config.isUnix:
	from twisted.internet import win32eventreactor
	win32eventreactor.install()
---

When I run this I get the following error:

---
Traceback (most recent call last):
  File "E:\ccase\python\uhg\uht\process.py", line 13, in ?
    win32eventreactor.install()
  File
  "E:\Python22\Lib\site-packages\twisted\internet\win32eventreactor.py",
  li
ne 228, in install
    main.installReactor(r)
  File "E:\Python22\Lib\site-packages\twisted\internet\main.py", line 90,
  in ins
tallReactor
    assert not sys.modules.has_key('twisted.internet.reactor'), \
AssertionError: reactor already installed
---

If I comment out the line win32eventreactor.install(), I get the
following error.

---
Traceback (most recent call last):
  File "E:\ccase\python\uhg\uht\process.py", line 60, in ?
    d = openProcess(["cleartool", "lsvob", "-s"])
  File "E:\ccase\python\uhg\uht\process.py", line 55, in openProcess
    reactor.spawnProcess(proto, cmd, cmd_and_args, env=os.environ)
  File "E:\Python22\Lib\site-packages\twisted\internet\default.py", line
  168, in
 spawnProcess
    raise NotImplementedError, "process only available in this reactor on
    POSIX"

NotImplementedError: process only available in this reactor on POSIX
---

As far as I can tell, none of my modules I import are trying to import
and install win32eventreactor.

I'm running Twisted 1.0.7alpha4. with Python 2.2.
Anyone know what I'm doing wrong?  I realize the win32 reactor needs to
be rewritten.  Just trying to make due with what is there now.

Thanks.
-Justin



From radix at twistedmatrix.com  Wed Aug 13 12:29:31 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Wed, 13 Aug 2003 14:29:31 -0400
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813192108.295D937F83@www.fastmail.fm>
References: <20030813192108.295D937F83@www.fastmail.fm>
Message-ID: <20030813182931.GD1789@radii>

On Wed, Aug 13, 2003 at 01:21:08PM -0600, Justin Johnson wrote:
> I had the win32eventreactor working a while back, but now I have a
> problem and I'm not sure what's going on.  The attached file installs
> win32eventreactor as follows:
> 
> ---
> if not config.isUnix:
> 	from twisted.internet import win32eventreactor
> 	win32eventreactor.install()
> ---
> 
> When I run this I get the following error:
> 
> ---
> AssertionError: reactor already installed
> ---

Somewhere, "from twisted.internet import reactor" is happening before
you install the win32eventreactor. The non-default reactors must be
installed before any imports of twisted.internet.reactor.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From itamar at itamarst.org  Wed Aug 13 13:29:12 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 13 Aug 2003 15:29:12 -0400
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813192108.295D937F83@www.fastmail.fm>
References: <20030813192108.295D937F83@www.fastmail.fm>
Message-ID: <20030813152912.48c5e70d.itamar@itamarst.org>

Installing a reactor has to be the *first* thing you do. If at any point
a module did "from twisted.internet import reactor" beforehand, that
will have the default reactor automatically installed if there is no
reactor already. So move that to be the first thing that runs.

This is another good reason to use twistd.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Wed Aug 13 13:32:10 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Wed, 13 Aug 2003 13:32:10 -0600
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813192108.295D937F83@www.fastmail.fm>
References: <20030813192108.295D937F83@www.fastmail.fm>
Message-ID: <20030813193210.8FCA23796A@www.fastmail.fm>

Once more *with* attached file.

On Wed, 13 Aug 2003 13:21:08 -0600, "Justin Johnson"
<justinjohnson at fastmail.fm> said:
> I had the win32eventreactor working a while back, but now I have a
> problem and I'm not sure what's going on.  The attached file installs
> win32eventreactor as follows:
> 
> ---
> if not config.isUnix:
> 	from twisted.internet import win32eventreactor
> 	win32eventreactor.install()
> ---
> 
> When I run this I get the following error:
> 
> ---
> Traceback (most recent call last):
>   File "E:\ccase\python\uhg\uht\process.py", line 13, in ?
>     win32eventreactor.install()
>   File
>   "E:\Python22\Lib\site-packages\twisted\internet\win32eventreactor.py",
>   li
> ne 228, in install
>     main.installReactor(r)
>   File "E:\Python22\Lib\site-packages\twisted\internet\main.py", line 90,
>   in ins
> tallReactor
>     assert not sys.modules.has_key('twisted.internet.reactor'), \
> AssertionError: reactor already installed
> ---
> 
> If I comment out the line win32eventreactor.install(), I get the
> following error.
> 
> ---
> Traceback (most recent call last):
>   File "E:\ccase\python\uhg\uht\process.py", line 60, in ?
>     d = openProcess(["cleartool", "lsvob", "-s"])
>   File "E:\ccase\python\uhg\uht\process.py", line 55, in openProcess
>     reactor.spawnProcess(proto, cmd, cmd_and_args, env=os.environ)
>   File "E:\Python22\Lib\site-packages\twisted\internet\default.py", line
>   168, in
>  spawnProcess
>     raise NotImplementedError, "process only available in this reactor on
>     POSIX"
> 
> NotImplementedError: process only available in this reactor on POSIX
> ---
> 
> As far as I can tell, none of my modules I import are trying to import
> and install win32eventreactor.
> 
> I'm running Twisted 1.0.7alpha4. with Python 2.2.
> Anyone know what I'm doing wrong?  I realize the win32 reactor needs to
> be rewritten.  Just trying to make due with what is there now.
> 
> Thanks.
> -Justin
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: process.py
Type: application/unknown
Size: 1844 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030813/78d41915/attachment-0002.bin>

From bob at redivi.com  Wed Aug 13 13:38:51 2003
From: bob at redivi.com (Bob Ippolito)
Date: Wed, 13 Aug 2003 15:38:51 -0400
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813192108.295D937F83@www.fastmail.fm>
Message-ID: <C4513EF0-CDC5-11D7-9407-000A95686CD8@redivi.com>

On Wednesday, Aug 13, 2003, at 15:21 America/New_York, Justin Johnson 
wrote:

> I had the win32eventreactor working a while back, but now I have a
> problem and I'm not sure what's going on.  The attached file installs
> win32eventreactor as follows:
>
> ---
> if not config.isUnix:
> 	from twisted.internet import win32eventreactor
> 	win32eventreactor.install()
> ---
>
> When I run this I get the following error:
>
> ---
> Traceback (most recent call last):
>   File "E:\ccase\python\uhg\uht\process.py", line 13, in ?
>     win32eventreactor.install()
>   File
>   
> "E:\Python22\Lib\site-packages\twisted\internet\win32eventreactor.py",
>   li
> ne 228, in install
>     main.installReactor(r)
>   File "E:\Python22\Lib\site-packages\twisted\internet\main.py", line 
> 90,
>   in ins
> tallReactor
>     assert not sys.modules.has_key('twisted.internet.reactor'), \
> AssertionError: reactor already installed

You need to win32eventreactor.install() before you import reactor from 
anywhere.. so this typically means that it needs to be at or near the 
top of your __main__ script, and you should do this before you even 
import other modules from Twisted.

-bob




From justinjohnson at fastmail.fm  Wed Aug 13 13:42:11 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Wed, 13 Aug 2003 13:42:11 -0600
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813152912.48c5e70d.itamar@itamarst.org>
References: <20030813192108.295D937F83@www.fastmail.fm> <20030813152912.48c5e70d.itamar@itamarst.org>
Message-ID: <20030813194211.8DBF938C63@www.fastmail.fm>

Sure enough... one of my modules was importing twisted.spread.pb.
I guess I'll look into using twistd and a mktap plugin.

Thank you.

On Wed, 13 Aug 2003 15:29:12 -0400, "Itamar Shtull-Trauring"
<itamar at itamarst.org> said:
> Installing a reactor has to be the *first* thing you do. If at any point
> a module did "from twisted.internet import reactor" beforehand, that
> will have the default reactor automatically installed if there is no
> reactor already. So move that to be the first thing that runs.
> 
> This is another good reason to use twistd.
> 
> -- 
> Itamar Shtull-Trauring    http://itamarst.org/
> Available for Python & Twisted consulting
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From radix at twistedmatrix.com  Wed Aug 13 12:46:41 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Wed, 13 Aug 2003 14:46:41 -0400
Subject: [Twisted-Python] win32eventreactor problems
In-Reply-To: <20030813194211.8DBF938C63@www.fastmail.fm>
References: <20030813192108.295D937F83@www.fastmail.fm> <20030813152912.48c5e70d.itamar@itamarst.org> <20030813194211.8DBF938C63@www.fastmail.fm>
Message-ID: <20030813184641.GE1789@radii>

On Wed, Aug 13, 2003 at 01:42:11PM -0600, Justin Johnson wrote:
> Sure enough... one of my modules was importing twisted.spread.pb.
> I guess I'll look into using twistd and a mktap plugin.

remember, you don't necessarily need a mktap plugin. see `twistd
--python'.


-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From tv at twistedmatrix.com  Wed Aug 13 10:10:07 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Wed, 13 Aug 2003 19:10:07 +0300
Subject: [Twisted-Python] Support for ICMP / traceroute ?
In-Reply-To: <1060767769.3f3a08190933f@imp.pro.proxad.net>
References: <1060767769.3f3a08190933f@imp.pro.proxad.net>
Message-ID: <20030813161007.GA20984@lapdog>

On Wed, Aug 13, 2003 at 11:42:49AM +0200, twisted at evpopov.com wrote:
> If answers to those questions are positive, then you may have won a new twisted 
> user :).

	Everything you listed is possible to do with Twisted.

	Parts of it may require you to extend Twisted, but that
	doesn't mean it would be impossible, or even hard.

	Happy?

	Welcome to the fan club.

-- 
:(){ :|:&};:



From m at moshez.org  Wed Aug 13 16:34:50 2003
From: m at moshez.org (Moshe Zadka)
Date: 13 Aug 2003 22:34:50 -0000
Subject: [Twisted-Python] Support for ICMP / traceroute ?
In-Reply-To: <20030813161007.GA20984@lapdog>
References: <20030813161007.GA20984@lapdog>, <1060767769.3f3a08190933f@imp.pro.proxad.net>
Message-ID: <20030813223450.23824.qmail@green.zadka.com>

On Wed, 13 Aug 2003, Tommi Virtanen <tv at twistedmatrix.com> wrote:

> 	Parts of it may require you to extend Twisted, but that
> 	doesn't mean it would be impossible, or even hard.

To clarify what Tommi said: few things [except actual bugs, which
hopefully we don't have] will force you to actually *modify*
Twisted. You may need to write new network code, but stuff like
reactor.{listen,connect}With will hopefully save you from having
to actually modify Twisted.
 
-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From fcolaco at demnet.ubi.pt  Wed Aug 13 19:45:30 2003
From: fcolaco at demnet.ubi.pt (Francisco Miguel =?ISO-8859-1?Q?Cola=E7o?=)
Date: 14 Aug 2003 02:45:30 +0100
Subject: [Twisted-Python] I am having severe problems with guard.
Message-ID: <1060825530.4474.22.camel@homebase.frisco.pt>

  I am having severe problems with guard.  I am making a site in which
users must be authenticated, and a session must be following and
reacting to the user's activities.

  I have made the following module.

from twisted.cred.portal import Portal, IRealm
from twisted.web.util import Redirect

import page, model
reload (page)
reload (model)



class Realm:
    __implements__ = IRealm    
    
    
    def requestAvatar (self, id, mind, *interfaces):
        if IResource not in interfaces:
            raise NotImplementedError ('I cannot do non-web logins
yet.')
        
        ## We are in a web login.        
        m = interfaces[0].model  ## This line should raise an
exception... thus, this is never executed.
        if id:
            m.orig['username'] = id
        else:
            m.orig['username'] = None
        
        resource = page.Page (m)
        resource.putChild ('', SessionWrapper (UsernamePasswordWrapper
(dem_portal, callback = redirectToIndex)))
        return IResource, resource, None


## Create an instance of the realm.
dem_realm = Realm ()



from twisted.cred.checkers import
InMemoryUsernamePasswordDatabaseDontUse, AllowAnonymousAccess
from twisted.web.woven.guard import UsernamePasswordWrapper,
SessionWrapper



def redirectToIndex (dummy):
    """I will redirect to the site main page.
    """
    
    return Redirect ('/index.rpy')



def createResource ():
    ## Create a memory checker.
    checker = InMemoryUsernamePasswordDatabaseDontUse ()
    checker.addUser ('fhc', '12345')
    checker.addUser ('humberto', 'zzzzz')
    checker.addUser ('aes', 'qa')
    
    ## Allow access from unknowns.
    anon = AllowAnonymousAccess()
    
    ## Create the portal.
    dem_portal = Portal (Realm)
    dem_portal.registerChecker (checker)
    dem_portal.registerChecker (anon)
    
    m = model.get_new_model ()
    upass = UsernamePasswordWrapper (dem_portal, callback =
redirectToIndex)
    
    resource = page.Page (m, templateFile = 'index.template.xhtml')
    resource.putChild ('', SessionWrapper (upass))
    
    return resource


page.Page is a customized page that works well, lest that the
'init-perspective' link keeps returning 'No such Resource'.  The page
as several wchild_, wvfactory_ and wvupdate_ attached to it.  I also
would like to contribute back the widgets I have done, as soon as I get
them ready and session aware, if someone has the need for them
(calendar, menu tabs, localized date, title boxes, etc.)

  I have sorted the documentation, logged just about any kind of object
dictionary information and even browsed through the sources, but I still
feel completely lost.

  If help can be provided by someone, I would appreciate if these
questions could be answered:

  1. Why doesn't perspective-init work?

  2. How can I put up a customized login page?

  3. How can I access the page (resource) within requestAvatar?

  4. How can I access the session object from a widget?

  5. How can I examine and issue cookies?

  I hope this does not give you a lot of trouble.  Programming twisted
has been both a wonderful and humbling experience, but I do prefer Woven
to anything I have tried before.  I find it an excellent piece of work
and wish to stick with it for my web programming, while I learn the rest
of Twisted for all the other communication needs.

  Thanks in advance.

     Francisco Colaço




From tard at 2kservices.com  Thu Aug 14 02:25:15 2003
From: tard at 2kservices.com (Alexander Zhukov)
Date: 14 Aug 2003 12:25:15 +0400
Subject: [Twisted-Python] Problems with wxPython and Twisted on linux
Message-ID: <1060849515.1261.11.camel@dhcp109.off>

Hi. I've problems running wxPython with twisted reactor under linux.
When I try to run the application with 

	wxsupport.install(app)
	reactor.run()

I get the following exception:

Traceback (most recent call last):
  File "wxdemo.py", line 36, in ?
    demo()
  File "wxdemo.py", line 33, in demo
    reactor.run()
  File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
line 121, in run
    self.startRunning(installSignalHandlers=installSignalHandlers)
  File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
line 115, in startRunning
    self._handleSignals()
  File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
line 87, in _handleSignals
    signal.signal(signal.SIGINT, self.sigInt)
SystemError: error return without exception set



Twisted version 1.0.6 and 1.0.7alpha4
wxPythonGTK 2.4.1.2

The same code works fine on windows. Any ideas how to fix it?




From glyph at twistedmatrix.com  Thu Aug 14 04:03:15 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 14 Aug 2003 05:03:15 -0500
Subject: [Twisted-Python] Deleting packages from Twisted and breaking all your code (THIS MEANS YOU)
Message-ID: <85D21C65-CE3E-11D7-B69D-000393C9700E@twistedmatrix.com>

Did the title get your attention?  Good.  If you know someone with 
deployed Twisted code which they hope to upgrade whose attention it did 
not get, please draw their attention here.

I would like to remove some of the more incendiary modules from Twisted 
and put them either into their own repositories for the duration or 
just put them into my directory in sandbox rather than distributing 
with the tarball proper.

The list for the moment (with attendant plans) is:



- twisted.sibling

We definitely need something like this, but it is unmaintained and I am 
unaware of any code that uses it outside of Ninjaneering's proprietary 
codebase.  It should be revisited at some later date once we have 
re-architected the whole of cred/pb/application, and we can leverage 
them to do consistent and semi-transparent distribution.

- twisted.popsicle

Kind of an interesting idea, but totally a research project.  There is 
no more work going into this because it's been empirically determined 
to be too hard to write a back-end.  Probably some neat ideas that 
might be worth picking up again though.  (This is largely being 
superseded by our persistence strategy on Quotient.  Have I mentioned 
quotient yet?  check it out, seriously, it's the best example of the 
core Twisted team's intent of certain facilities in Twisted than you're 
likely to find anywhere else.  http://www.divmod.org/ )

- twisted.world

TOTALLY AWESOME idea that I am really disappointed that I had to let go 
of for performance reasons.  However it is not extensively tested, it 
is very very VERY slow, it is not even the slightest bit fault 
tolerant, and it will even lose data under normal operation in some 
weird corner cases.  Also it leaks disk resources really fast.  All 
these problems are fixable and the overall architecture is sound, but 
it will need a very clever database-head with some serious time on 
his/her hands to improve.




If you have code that relies on any of these, please say something NOW. 
  I would like releases subsequent to 1.1 to start deleting some of the 
superfluous stuff in the Twisted tree so that our users can feel more 
comfortable about trusting what's in the core package to be supported.  
Experimental development projects like these should be carried out 
elsewhere before being merged in, in the future.




From exarkun at intarweb.us  Thu Aug 14 07:11:51 2003
From: exarkun at intarweb.us (Jp Calderone)
Date: Thu, 14 Aug 2003 09:11:51 -0400
Subject: [Twisted-Python] Problems with wxPython and Twisted on linux
In-Reply-To: <1060849515.1261.11.camel@dhcp109.off>
References: <1060849515.1261.11.camel@dhcp109.off>
Message-ID: <20030814131151.GB17971@intarweb.us>

On Thu, Aug 14, 2003 at 12:25:15PM +0400, Alexander Zhukov wrote:
> Hi. I've problems running wxPython with twisted reactor under linux.
> When I try to run the application with 
> 
> 	wxsupport.install(app)
> 	reactor.run()
> 
> I get the following exception:
> 
> [snip - traceback]
> 
> Twisted version 1.0.6 and 1.0.7alpha4
> wxPythonGTK 2.4.1.2
> 
> The same code works fine on windows. Any ideas how to fix it?
> 

  This is a wxPython bug, IIRC.  It was discussed on the list several weeks
ago, but I'm not sure the final resolution was ever posted here.

  Could someone who remembers all the details sum them up in reply to this
thread (and maybe the old one, too?)

  Jp

-- 
Examinations are formidable even to the best prepared, for
even the greatest fool may ask more than the wisest man can answer.
                -- C.C. Colton
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030814/60227352/attachment.sig>

From justinjohnson at fastmail.fm  Thu Aug 14 07:18:34 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Thu, 14 Aug 2003 07:18:34 -0600
Subject: [Twisted-Python] Problems installing Quotient
Message-ID: <20030814131834.838CC3807A@www.fastmail.fm>

I'm running RedHat 9, Python 2.2.2, Twisted-1.0.7alpha2, latest Quotient,
Lupy, and Reverend.

After installing Quotient, Lupy, and Reverend, I get the following error
trying to run mktap.  Do I need to be running from CVS or something?  The
instructions said 1.0.7alpha1 or greater was okay.  IMessage is not
defined in twisted.protocols.imap4.py.

[jjohn53 at marmot jjohn53]$ mktap quotient --help
An error unexpected occurred:
Traceback (most recent call last):
  File "/usr/lib/python2.2/site-packages/twisted/scripts/mktap.py", line
  182, in run
    options.parseOptions(sys.argv[1:])
  File "/usr/lib/python2.2/site-packages/twisted/python/usage.py", line
  210, in parseOptions
    self.postOptions()
  File "/usr/lib/python2.2/site-packages/twisted/scripts/mktap.py", line
  166, in postOptions
    self.parseOptions(self.params)
  File "/usr/lib/python2.2/site-packages/twisted/python/usage.py", line
  199, in parseOptions
    self.subOptions = parser()
  File "/usr/lib/python2.2/site-packages/twisted/scripts/mktap.py", line
  107, in <lambda>
    [x, None, (lambda obj = y: obj.load().Options()), getattr(y,
    'description', '')]
  File "/usr/lib/python2.2/site-packages/twisted/python/plugin.py", line
  68, in load
    return namedModule(self.module)
  File "/usr/lib/python2.2/site-packages/twisted/python/reflect.py", line
  369, in namedModule
    topLevel = __import__(name)
  File "/usr/lib/python2.2/site-packages/quotient/tap.py", line 15, in ?
    from quotient import login, grabbers, smtpin
  File "/usr/lib/python2.2/site-packages/quotient/login.py", line 41, in
  ?
    from quotient.imapbox import Account as IMAP4Account
  File "/usr/lib/python2.2/site-packages/quotient/imapbox.py", line 13,
  in ?
    from twisted.protocols.imap4 import IAccount, IMailbox, IMessage,
    IMAP4Server, statusRequestHelper
ImportError: cannot import name IMessage
[jjohn53 at marmot jjohn53]$



From mporter at despammed.com  Thu Aug 14 03:09:33 2003
From: mporter at despammed.com (Michael Porter)
Date: Thu, 14 Aug 2003 10:09:33 +0100
Subject: [Twisted-Python] Problems with wxPython and Twisted on linux
References: <1060849515.1261.11.camel@dhcp109.off>
Message-ID: <004501c36269$3473ac70$0201a8c0@dan>

----- Original Message -----
From: "Alexander Zhukov" <tard at 2kservices.com>
Sent: Thursday, August 14, 2003 9:25 AM


> Hi. I've problems running wxPython with twisted reactor under linux.
> When I try to run the application with
>
> wxsupport.install(app)
> reactor.run()
>
> I get the following exception:
>
> Traceback (most recent call last):
>   File "wxdemo.py", line 36, in ?
>     demo()
>   File "wxdemo.py", line 33, in demo
>     reactor.run()
>   File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
> line 121, in run
>     self.startRunning(installSignalHandlers=installSignalHandlers)
>   File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
> line 115, in startRunning
>     self._handleSignals()
>   File "/usr/lib/python2.2/site-packages/twisted/internet/default.py",
> line 87, in _handleSignals
>     signal.signal(signal.SIGINT, self.sigInt)
> SystemError: error return without exception set
>
>
>
> Twisted version 1.0.6 and 1.0.7alpha4
> wxPythonGTK 2.4.1.2
>
> The same code works fine on windows. Any ideas how to fix it?
>

This is the same problem I made a post about a few weeks back. It does occur
on Windows (at least for me) but only with the latest version of wxPython
(wxPython 2.4.1.2). It's in the bug trackers for Python (id 762198) and
wxWindows (id 746099) and has apparently been fixed but I don't know when it
will make it into a release.

If you run without signal handlers (reactor.run(installSignalHandlers=0)) it
doesn't occur.

Mike.







From ali at infomed.sld.cu  Thu Aug 14 09:01:01 2003
From: ali at infomed.sld.cu (Ali)
Date: Thu, 14 Aug 2003 11:01:01 -0400
Subject: [Twisted-Python] Documentation about form, guard and *coduicts
Message-ID: <1060873261.3f3ba42d6b740@webmail.sld.cu>

Hi, 

I'm very new to twisted, i read the howtos and i found little info on
form, guard and livepage. where can i find more info on those topics???

TIA,
 Ali



-------------------------------------------------
Este mensaje fue enviado usando el servicio de correo en web de Infomed
http://webmail.sld.cu



From tv at twistedmatrix.com  Thu Aug 14 08:54:29 2003
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu, 14 Aug 2003 17:54:29 +0300
Subject: [Twisted-Python] Support for ICMP / traceroute ?
In-Reply-To: <20030813223450.23824.qmail@green.zadka.com>
References: <1060767769.3f3a08190933f@imp.pro.proxad.net> <20030813223450.23824.qmail@green.zadka.com>
Message-ID: <20030814145429.GA9223@lapdog>

On Wed, Aug 13, 2003 at 10:34:50PM -0000, Moshe Zadka wrote:
> > 	Parts of it may require you to extend Twisted, but that
> > 	doesn't mean it would be impossible, or even hard.
> To clarify what Tommi said: few things [except actual bugs, which
> hopefully we don't have] will force you to actually *modify*
> Twisted. You may need to write new network code, but stuff like
> reactor.{listen,connect}With will hopefully save you from having
> to actually modify Twisted.

	Yes, the use of the word extend was meant exactly in that
	way.

-- 
:(){ :|:&};:



From itamar at itamarst.org  Thu Aug 14 09:05:07 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 14 Aug 2003 11:05:07 -0400
Subject: [Twisted-Python] Deleting packages from Twisted and breaking
 all your code (THIS MEANS YOU)
In-Reply-To: <85D21C65-CE3E-11D7-B69D-000393C9700E@twistedmatrix.com>
References: <85D21C65-CE3E-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <20030814110507.7b176090.itamar@itamarst.org>

On Thu, 14 Aug 2003 05:03:15 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> I would like to remove some of the more incendiary modules from
> Twisted and put them either into their own repositories for the
> duration or just put them into my directory in sandbox rather than
> distributing with the tarball proper.

We also ought to have some sort of policy that all new module and
package development should start in the sandbox. I really like the way
the application refactor has been going on in the sandbox, for example.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From bob at redivi.com  Thu Aug 14 09:21:13 2003
From: bob at redivi.com (Bob Ippolito)
Date: Thu, 14 Aug 2003 11:21:13 -0400
Subject: [Twisted-Python] Deleting packages from Twisted and breaking all your code (THIS MEANS YOU)
In-Reply-To: <20030814110507.7b176090.itamar@itamarst.org>
Message-ID: <F118C3C9-CE6A-11D7-AB6E-000A95686CD8@redivi.com>

On Thursday, Aug 14, 2003, at 11:05 America/New_York, Itamar 
Shtull-Trauring wrote:

> On Thu, 14 Aug 2003 05:03:15 -0500
> Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:
>
>> I would like to remove some of the more incendiary modules from
>> Twisted and put them either into their own repositories for the
>> duration or just put them into my directory in sandbox rather than
>> distributing with the tarball proper.
>
> We also ought to have some sort of policy that all new module and
> package development should start in the sandbox. I really like the way
> the application refactor has been going on in the sandbox, for example.

I agree with this as well, my CFReactor is sitting in the sandbox too.

-bob




From mkimpenhaus at plus.de  Thu Aug 14 11:35:27 2003
From: mkimpenhaus at plus.de (mkimpenhaus at plus.de)
Date: Thu, 14 Aug 2003 19:35:27 +0200
Subject: [Twisted-Python] [twisted-conch] Building own Channels
Message-ID: <OF599B7EA9.DCDBD270-ONC1256D82.005F0595@uz.tengelmann.de>

Hi @all

i am fairly new to twisted conch an connecting per ssh to servers.

I took a look at the sample and everything was working fine. Then I tried 
to derive from the SSHChannel and gave that channel a new name.
F*ck - that seemed to be the wrong way, no connection could be 
established. I searched the code for some hints and found that there are 
already some channels (session, forward-tcp and direct-tcp) implemented 
which seem to work. I was wondering that the derived channel was working 
when naming it by the name of one of those already implemented 
channles(session, forward-tcp and direct-tcp).

Therefore my question:

How do I implement own channels with own names?

Best regards and respect,
Marcus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20030814/6de990e2/attachment.html>

From z3p at twistedmatrix.com  Thu Aug 14 12:21:09 2003
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Thu, 14 Aug 2003 13:21:09 -0500
Subject: [Twisted-Python] [twisted-conch] Building own Channels
In-Reply-To: <OF599B7EA9.DCDBD270-ONC1256D82.005F0595@uz.tengelmann.de>
References: <OF599B7EA9.DCDBD270-ONC1256D82.005F0595@uz.tengelmann.de>
Message-ID: <20030814182109.GA12125@pyramid.twistedmatrix.com>

On Thu, Aug 14, 2003 at 07:35:27PM +0200, mkimpenhaus at plus.de wrote:
> How do I implement own channels with own names?

If you want to use a channel with a different name, you need to tell the
server and the client that it's a valid channel-name.  Currently, the
only valid ones are session (executing a shell or a command), direct-tcp
(local->remote TCP forwarding) and forward-tcp (remote->local TCP
forwarding.  If you want to implement a different type of channel, the
method you'll want to look at it is
twisted.conch.ssh.connection.SSHConnection.getChannel, and the channel_*
methods.  You probably should take a look at the SSH Connection Protocol
I-D as well.

-p
-- 
       Paul Swartz
(o_    http://www.twistedmatrix.com/users/z3p.twistd/  _o)
//\    z3p at twistedmatrix.com                           /\\
V_/_   AIM: z3penguin                                 _\_V->



From maoy at cis.upenn.edu  Thu Aug 14 12:39:11 2003
From: maoy at cis.upenn.edu (Yun Mao)
Date: Thu, 14 Aug 2003 14:39:11 -0400
Subject: [Twisted-Python] where is the log message
References: <OF599B7EA9.DCDBD270-ONC1256D82.005F0595@uz.tengelmann.de> <20030814182109.GA12125@pyramid.twistedmatrix.com>
Message-ID: <016c01c36293$5e769490$bf00a8c0@evolution>

Hi,
  When I run an application by twistd -y xxx.py --logfile -, I can get all
the log information on the screen. How to get the log info if I only do
python xxx.py ??
Thanks!
Yun




From glyph at twistedmatrix.com  Thu Aug 14 17:21:22 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 14 Aug 2003 18:21:22 -0500
Subject: [Twisted-Python] Problems installing Quotient
In-Reply-To: <20030814131834.838CC3807A@www.fastmail.fm>
Message-ID: <04483A2C-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>

On Thursday, August 14, 2003, at 08:18 AM, Justin Johnson wrote:

> After installing Quotient, Lupy, and Reverend, I get the following 
> error
> trying to run mktap.  Do I need to be running from CVS or something?  
> The
> instructions said 1.0.7alpha1 or greater was okay.  IMessage is not
> defined in twisted.protocols.imap4.py.

Thanks for your interest ;).  Try getting alpha4.  We are trying to 
make sure that Quotient releases do not require Twisted from CVS, but 
they typically *will* require the latest (even alpha) release.

Sorry about the incorrect README.




From glyph at twistedmatrix.com  Thu Aug 14 17:22:31 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 14 Aug 2003 18:22:31 -0500
Subject: [Twisted-Python] Documentation about form, guard and *coduicts
In-Reply-To: <1060873261.3f3ba42d6b740@webmail.sld.cu>
Message-ID: <2D7A311E-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>

On Thursday, August 14, 2003, at 10:01 AM, Ali wrote:

> I'm very new to twisted, i read the howtos and i found little info on
> form, guard

There are some examples in sandbox/glyph in CVS, and looking over 
recent mailing list archives should give you some clues.

> and livepage.

Without a direct neural interface to dp's brain this may be a bit 
challenging.

> where can i find more info on those topics???





From glyph at twistedmatrix.com  Thu Aug 14 17:24:17 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 14 Aug 2003 18:24:17 -0500
Subject: [Twisted-Python] where is the log message
In-Reply-To: <016c01c36293$5e769490$bf00a8c0@evolution>
Message-ID: <6CE75B6E-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>

On Thursday, August 14, 2003, at 01:39 PM, Yun Mao wrote:

>   When I run an application by twistd -y xxx.py --logfile -, I can get 
> all
> the log information on the screen. How to get the log info if I only do
> python xxx.py ??

@see C{twisted.python.log.startLogging}




From andrew-twisted at puzzling.org  Thu Aug 14 19:32:27 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Fri, 15 Aug 2003 11:32:27 +1000
Subject: [Twisted-Python] where is the log message
In-Reply-To: <6CE75B6E-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>
References: <016c01c36293$5e769490$bf00a8c0@evolution> <6CE75B6E-CEAE-11D7-B69D-000393C9700E@twistedmatrix.com>
Message-ID: <20030815013227.GA5127@frobozz>

On Thu, Aug 14, 2003 at 06:24:17PM -0500, Glyph Lefkowitz wrote:
> 
> @see C{twisted.python.log.startLogging}

I think the correct epytext for that is:
    @see L{twisted.python.log.startLogging}

</nitpick>

-Andrew.




From Dave at centralmanclc.com  Fri Aug 15 05:00:53 2003
From: Dave at centralmanclc.com (Dave Thorne)
Date: Fri, 15 Aug 2003 12:00:53 +0100
Subject: [Twisted-Python] Newbie here - question about Guard
Message-ID: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>

Hi,

My name is Dave Thorne, I am a developer at the Central Manchester City
Learning Centre in England, and I have joined this list because I am hoping
to use Twisted for a couple of projects I am working on.

I have just set up a woven application and I am thoroughly getting into the
code and setting everything up, but the one element I am missing is user
authentication. I have found twisted.web.woven.guard and think that this is
what I want, but I may be wrong. All I need is a way of authenticating my
woven application ( my user list is in a database I have - ZODB) so that
users can log in and get access to their information. Unfortunately I can't
seem to find any information about authentication using the guard classes,
and I wondered if anyone could help me. The documentation I have downloaded
is incomplete and I can't find anything on the web about it. I'm not too
bothered about how the authentication works (i.e. basic authentication of
the web browser or a more application driven authentication).

If anyone has any documentation, or even a simple example so I can get
started that would be a great help. Failing that, does anyone have any
experience using the guard classes that would be willing to help me?

Of course, if guard is not the method I need, and there is any other way of
authentication that I don't know about, it would be nice to be pointed in
the right direction.

yours Hopefully,
Dave



From itamar at itamarst.org  Fri Aug 15 06:01:04 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 15 Aug 2003 08:01:04 -0400
Subject: [Twisted-Python] Newbie here - question about Guard
In-Reply-To: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>
References: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>
Message-ID: <20030815080104.35755c4e.itamar@itamarst.org>

On Fri, 15 Aug 2003 12:00:53 +0100
Dave Thorne <Dave at centralmanclc.com> wrote:

> If anyone has any documentation, or even a simple example so I can get
> started that would be a great help. Failing that, does anyone have any
> experience using the guard classes that would be willing to help me?

Look at twisted/web/woven/simpleguard.py and sandbox/glyph/dynademo/
(1.0.7alpha4 or later, probably.)

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Fri Aug 15 11:56:30 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Fri, 15 Aug 2003 11:56:30 -0600
Subject: [Twisted-Python] twistedmatrix.com minor correction
Message-ID: <20030815175630.8CDF538800@www.fastmail.fm>

At http://twistedmatrix.com/products/download. the 1.07 alpha is listed,
but the info below refers to 1.06 which already released.


-----
Twisted 1.0.7alpha4 - Release Candidate

This is an Alpha of Twisted. It is not an official release: there may be
a number of alphas and RCs before *1.0.6* is considered a candidate for
full release. Until then, use this in production at your own risk. If you
want the latest stable release of Twisted, see Twisted 1.0.6, below.



From khowe at perfnet.ca  Fri Aug 15 12:36:00 2003
From: khowe at perfnet.ca (Kevin Howe)
Date: Fri, 15 Aug 2003 14:36:00 -0400
Subject: [Twisted-Python] Using users/roles with Woven
Message-ID: <000301c3635c$165dc150$1a00000a@KHOWE>

Hi,

I've been examining /sandbox/glyph/dynademo in order to learn about guard,
and have a question about where to store login information.

NOTE: I am ultra-new to twisted, so please correct me if I am totally off
base here :)

User accounts stored in RDBMS:

  User table (user information)
      user_id, first_name, last_name, email

  Roles table (actions the user is allowed to perform)
      user_id, role

  A user may have multiple roles.

Once a user is logged in their profile is fetched from the "User" table and
their permissions are fetched from the "Roles" table. This needs to be
stored for the session so that all pages have access to it. Views are then
customized based on the roles, something like the following:

  class LoggedIn(BasePage):

      def wvupdate_info(self, request, widget, data):

          prefs = request.getSession(IPreferences)
          roles = getattr(prefs, 'roles', [])
          if 'View Info' in roles:
              return 'Information'
          else:
              return ''

Should the login profile/roles be stored somewhere other than Session? The
Twisted.Cred documentation seems to suggest that it should be stored in
either an Indentity or a Perspective:

  In order to simplify integration of services that come from lots of
different places,
  Twisted.Cred presents user-account related information in two different
ways.
  Application-independent user information, such as passwords, public keys,
and
  other things related to the existence and authentication of a particular
person
  should reside in an Identity. Information related to a particular service,
such as
  e-mail messages, high scores, or to-do lists should be represented by a
Perspective.

Could someone explain what a more twisted-style approach might be?

- Kevin





From itamar at itamarst.org  Fri Aug 15 13:09:23 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 15 Aug 2003 15:09:23 -0400
Subject: [Twisted-Python] Using users/roles with Woven
In-Reply-To: <000301c3635c$165dc150$1a00000a@KHOWE>
References: <000301c3635c$165dc150$1a00000a@KHOWE>
Message-ID: <20030815150923.57c2bb91.itamar@itamarst.org>

On Fri, 15 Aug 2003 14:36:00 -0400
"Kevin Howe" <khowe at perfnet.ca> wrote:

> Should the login profile/roles be stored somewhere other than Session?
> The Twisted.Cred documentation seems to suggest that it should be
> stored in either an Indentity or a Perspective:

Argh. Those are both deprecated. I'll update the docs to note this, but
we really need docs of the new system...

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From radix at twistedmatrix.com  Fri Aug 15 12:12:06 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 15 Aug 2003 14:12:06 -0400
Subject: [Twisted-Python] Newbie here - question about Guard
In-Reply-To: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>
References: <03Aug15.115527bst.119049@harry.trinity.manchester.sch.uk>
Message-ID: <20030815181206.GB946@radii>

On Fri, Aug 15, 2003 at 12:00:53PM +0100, Dave Thorne wrote:

> All I need is a way of authenticating my woven application ( my user
> list is in a database I have - ZODB) so that users can log in and
> get access to their information.

You're going to need to create a Credentials Checker to look into ZODB
to get the information. See twisted.cred.checkers.FilePasswordDB for
an example of how to do this -- that one reads a file that has
"username:password" lines and authenticates against
it. `requestAvatarID' is the only public interface that it must
implement.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From radix at twistedmatrix.com  Fri Aug 15 12:14:44 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 15 Aug 2003 14:14:44 -0400
Subject: [Twisted-Python] twistedmatrix.com minor correction
In-Reply-To: <20030815175630.8CDF538800@www.fastmail.fm>
References: <20030815175630.8CDF538800@www.fastmail.fm>
Message-ID: <20030815181444.GC946@radii>

On Fri, Aug 15, 2003 at 11:56:30AM -0600, Justin Johnson wrote:
> At http://twistedmatrix.com/products/download. the 1.07 alpha is listed,
> but the info below refers to 1.06 which already released.

woops, i'll fix it

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From rprice at collegenet.com  Fri Aug 15 15:09:13 2003
From: rprice at collegenet.com (Ray Price)
Date: 15 Aug 2003 14:09:13 -0700
Subject: [Twisted-Python] zserver to twisted migration
Message-ID: <1060981753.17149.267.camel@hotpepper.unival.com>

I am new to Twisted and I'd like to move a few applications from the
Zope Zserver to Twisted.

It is easy to install code within Zserver by adding the following lines
to z2.py:

            #install my own handler
            sys.path.insert(0,"/usr/local/mycode")
            theModule=zhttp_handler('moduleName',"/cgi-bin/")
            hs.install_handler(theModule)

What would be involved in running the above module in twisted?

Thanks,
Ray






From fcolaco at demnet.ubi.pt  Sat Aug 16 14:43:08 2003
From: fcolaco at demnet.ubi.pt (Francisco Miguel =?ISO-8859-1?Q?Cola=E7o?=)
Date: Sat, 16 Aug 2003 21:43:08 +0100
Subject: [Twisted-Python] Some doubts abot guard.
Message-ID: <1061066546.3563.8.camel@homebase.frisco.pt>

  Dear friends,

  Somehow I have managed to put the site authentication to work.  I
still have some doubs about guard:

  1.  If I try to run the site off index.rpy, I am redirected to
'host:port/session-init', which has no resource.  I have to put
'http://hostname:port:file.rpy' in order for the site to load
correctely.  How can I correct this behaviour?

  2.  How can I enter a custom page upon login failure?

  3.  How should I access the session and the user information using
newcred, since 'cred' is (according to this own mailing list) being
deprecated?

  4.  I wish to do a slashdot/plone type of site on woven.  Is anybody
doing the same.  I can offer to help out.  Please reply to the mailing
list so that everyone can know about it and join in.

  Thanks in advance,

     Francisco Colaço




From screwtape at froup.com  Sun Aug 17 09:21:42 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Mon, 18 Aug 2003 01:21:42 +1000
Subject: [Twisted-Python] Twisted and curses
Message-ID: <20030817152142.GA28629@ferd2.thristian.org>

I've been toying with the idea of writing a GUI toolkit in Python with
the curses library. Obviously such a thing would have to be
event-driven, and if I ever wanted any network connectivity I'd want
to use Twisted.

Twisted does not come with a curses reactor, but with a little
experimentation I found out how to make the reactor's .listenWith()
method do more or less what I wanted.

Code is here (5KB tarball):

	http://members.optusnet.com.au/thristian/curses.tar.gz

You get cursesapp.py, a thin wrapper around curses setup, teardown,
and the eventloop, and test.py, a very simple demonstration program.
There's lots of comments and docstrings.

What do you think?

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _    _
|
| "Screwtape: the Hippocrates of Large Animal Transport"
|



From fcolaco at demnet.ubi.pt  Sun Aug 17 10:36:28 2003
From: fcolaco at demnet.ubi.pt (Francisco Miguel =?ISO-8859-1?Q?Cola=E7o?=)
Date: Sun, 17 Aug 2003 17:36:28 +0100
Subject: [Twisted-Python] Encoding patch for twisted.web.microdom.Document
Message-ID: <1061138187.3747.9.camel@homebase.frisco.pt>

  I have patched that class, in order to make the xml opening as:
 
  <?xml version="1.0" encoding="utf-8" ?>

  One may choose the encoding by passing the encoding="my-encoding" as
an additional argument to Document.

  This is the only way I have for the site I do (in continental
portuguese, if that matters) in Galeon and Mozilla.
Here is the diff (I have renamed the original microdom.py to
microdom-old.py in order to test the server.


CUT HERE-------------
198c198
<     def __init__(self, documentElement=None):
---
>     def __init__(self, documentElement=None, encoding='utf-8'):
202a203,205
>         ## Add a default encoding.
>         self.encoding = encoding
>
227c230
<         stream.write('<?xml version="1.0"?>' + newl)
---
>         stream.write('<?xml version="1.0" encoding="' + self.encoding
+ '" ?>' + newl)
CUT HERE-------------

  Maybe the same thing dould be applied in xmlrpc.py, since the <?xml?>
string is also hardwired.  Is this patch useful?

    Francisco Colaço




From twistedmail at filosi.com  Sun Aug 17 10:43:53 2003
From: twistedmail at filosi.com (Alex May)
Date: Sun, 17 Aug 2003 12:43:53 -0400
Subject: [Twisted-Python] Newbie trying to figure out cred
Message-ID: <200308171243.53458.twistedmail@filosi.com>

Hello All,

I am new to the twisted framework.  After some searching through the docs, I 
finally found the howtos and examples that let me grok the basic twisted 
concepts.  Since then I've been successful putting together a basic web 
application with twisted.

Now I am trying to add credential functionality and I am completely lost.  
Initially I read all the API docs, and could not make much sense of how to 
stitch everything together.  Nor could I find any web based credential 
examples.  Finally I found the mailing list thread titled "lies, damn lies, 
and interfaces", which outlined a new cred interface and gave an example 
file.

I upgraded to twisted 1.0.6 and downloaded sandbox/webhappyrealm.py.  When I 
run it and attempt to access /site1 I get the following:

-----
web.Server Traceback (most recent call last):  

twisted.cred.error.UnhandledCredentials: No checker for 
twisted.cred.credentials.IAnonymous ,twisted.cred.credentials.ICredentials

twisted.cred.error.UnhandledCredentials: No checker for 
twisted.cred.credentials.IAnonymous ,twisted.cred.credentials.ICredentials
-----
 
Are these new interfaces mature enough to use?  Should I instead use the CVS 
version of twisted?  Or am I just being stupid and doing something wrong?

Please help!

Thanks,
Alex

PS: I'm running python 2.2.2.





From glyph at twistedmatrix.com  Sun Aug 17 12:16:07 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 17 Aug 2003 13:16:07 -0500
Subject: [Twisted-Python] Newbie trying to figure out cred
In-Reply-To: <200308171243.53458.twistedmail@filosi.com>
Message-ID: <DF298CA8-D0DE-11D7-92D5-000393C9700E@twistedmatrix.com>

On Sunday, August 17, 2003, at 11:43 AM, Alex May wrote:

> I upgraded to twisted 1.0.6 and downloaded sandbox/webhappyrealm.py.  
> When I
> run it and attempt to access /site1 I get the following:

If you are using new cred, please upgrade to the latest alpha.  (There 
should be another one coming out tonight.)  It is new code, and while 
the core isn't changing very much, a lot of other systems that use it 
are being updated, and new examples are being added.

Also, please check out Quotient (www.divmod.org) for a more complete 
example.

I have noticed that about 1/3 of the traffic on this mailing list is 
now "I am trying to understand  cred (usually in the context of 
woven.guard) and the docs seem incomplete.  Help!".  It's is my fault 
that it's so badly documented, and I am duly apologetic, but I simply 
don't have the time to fix this in the near term, and we need a 
solution in the near term.

Thankfully, Travis has agreed to take over the issue for me for a 
while.  I'd like it if some of you that are having problems with the 
state of the documentation could coordinate with him to produce a 
sensible tutorial (and probably some patches to guard!) that will 
reduce the future volume of these questions :)




From wari at home.wari.org  Mon Aug 18 04:56:13 2003
From: wari at home.wari.org (Wari Wahab)
Date: 18 Aug 2003 18:56:13 +0800
Subject: [Twisted-Python] IMAP4Client barfed with cyrus-imap
Message-ID: <1061204173.12582.58.camel@minisync>

Hi there, I was trying out IMAP4Client subclass (is that the correct
way?), and I did a simple 10 liner program that lists out available
folders in an IMAP box, things worked fine with the courier imap server,
but when I tried it with a cyrus imapd, this error occurred on
IMAP4Client.login()

2003/08/18 18:33 SGT [MailClient,client] Capabilities problem: [Failure
instance: Traceback: twisted.protocols.imap4.IMAP4Exception, Unexpected
extra arguments to Capability

So, the difference between these two servers are:
[mailstuff]# telnet courierhost 143
Trying 202.172.46.73...
Connected to courierhost.
Escape character is '^]'.
* OK Courier-IMAP ready. Copyright 1998-2000 Double Precision, Inc.  See
COPYING for distribution information.
A01 CAPABILITY
* CAPABILITY IMAP4rev1 CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT
THREAD=REFERENCES SORT STARTTLS
A01 OK CAPABILITY completed
A02 LOGOUT
* BYE Courier-IMAP server shutting down
A02 OK LOGOUT completed
Connection closed by foreign host.

[mailstuff]# telnet cyrushost 143
Trying 65.200.24.205...
Connected to cyrushost.
Escape character is '^]'.
* OK cyrushost Cyrus IMAP4 v2.1.13 server ready
A01 CAPABILITY
* CAPABILITY IMAP4 IMAP4rev1 ACL QUOTA LITERAL+ MAILBOX-REFERRALS
NAMESPACE UIDPLUS ID NO_ATOMIC_RENAME UNSELECT CHILDREN MULTIAPPEND SORT
THREAD=ORDEREDSUBJECT THREAD=REFERENCES IDLE STARTTLS AUTH=DIGEST-MD5
AUTH=CRAM-MD5
A01 OK Completed
A02 LOGOUT
* BYE LOGOUT received
A02 OK Completed
Connection closed by foreign host.

Is this a bug?



From exarkun at intarweb.us  Mon Aug 18 08:19:12 2003
From: exarkun at intarweb.us (Jp Calderone)
Date: Mon, 18 Aug 2003 10:19:12 -0400
Subject: [Twisted-Python] IMAP4Client barfed with cyrus-imap
In-Reply-To: <1061204173.12582.58.camel@minisync>
References: <1061204173.12582.58.camel@minisync>
Message-ID: <20030818141912.GA30824@intarweb.us>

On Mon, Aug 18, 2003 at 06:56:13PM +0800, Wari Wahab wrote:
> Hi there, I was trying out IMAP4Client subclass (is that the correct
> way?), and I did a simple 10 liner program that lists out available
> folders in an IMAP box, things worked fine with the courier imap server,
> but when I tried it with a cyrus imapd, this error occurred on
> IMAP4Client.login()
> 
> 2003/08/18 18:33 SGT [MailClient,client] Capabilities problem: [Failure
> instance: Traceback: twisted.protocols.imap4.IMAP4Exception, Unexpected
> extra arguments to Capability
> 
> [snip transcript]
> 
> Is this a bug?
> 

  Probably!  Could you create an issue at http://twistedmatrix.com/bugs/ and
attach the full traceback, as well as a log of the actual transcript
(capture with a logger, such as ethereal, or debug output from the server
(uncomment some of the prints that are already there)) if possible?

  Jp

-- 
"There is no reason for any individual to have a computer in their
home."
                -- Ken Olson, President of DEC, World Future Society
                   Convention, 1977
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030818/a3229235/attachment.sig>

From corydodt at yahoo.com  Mon Aug 18 10:14:20 2003
From: corydodt at yahoo.com (Cory Dodt)
Date: Mon, 18 Aug 2003 09:14:20 -0700
Subject: [Twisted-Python] Encoding patch for twisted.web.microdom.Document
In-Reply-To: <1061138187.3747.9.camel@homebase.frisco.pt>
References: <1061138187.3747.9.camel@homebase.frisco.pt>
Message-ID: <3F40FB5C.6040909@yahoo.com>

Francisco Miguel Colaço wrote:

>  I have patched that class, in order to make the xml opening as:
>
>
>  <?xml version="1.0" encoding="utf-8" ?>
>
>  
>
This patch addresses the header without checking the actual character 
encoding of the document, which basically turns inside-out the current 
problem (character encoding can be utf-8 but header doesn't say so).  
Microdom does support utf-8 output, by checking if the strings it 
contains are UnicodeType.  This leaks all over the place, and you would 
get into trouble with your patch if you passed in encoding='utf-8' and 
then provided microdom with an 8-bit string.

There's a few ways to make this less leaky:

- if encoding parameter is something unicodey, make sure self.data is 
UnicodeType anywhere it is written to (i.e. anywhere it appears on the 
left side of an assignment) by raising an exception if it's not
*and*
- make sure you can't change encoding to a non-unicode encoding or pass 
a non-unicode encoding to any methods once the document has nodes

or

- internally convert everything to Unicode even if it is passed in as 
8-bit string, and then use only the encoding parameter to determine how 
writexml should work.

As it happens, there's already a bug open on this issue.  Please sign up 
on roundup and continue discussion of this issue here:

http://twistedmatrix.com/users/roundup.twistd/twisted/issue149

Thanks!  I have already pasted your original email and my reply there.

Cory




From wari at home.wari.org  Mon Aug 18 10:17:16 2003
From: wari at home.wari.org (Wari Wahab)
Date: Tue, 19 Aug 2003 00:17:16 +0800
Subject: [Twisted-Python] IMAP4Client barfed with cyrus-imap
In-Reply-To: <20030818141912.GA30824@intarweb.us>
References: <1061204173.12582.58.camel@minisync> <20030818141912.GA30824@intarweb.us>
Message-ID: <20030818161716.GA30478@celestix.com>

* Jp Calderone <exarkun at intarweb.us> [030818 22:32]:
> On Mon, Aug 18, 2003 at 06:56:13PM +0800, Wari Wahab wrote:
> > Is this a bug?
> Probably!  Could you create an issue at
> http://twistedmatrix.com/bugs/ and attach the full traceback, as
> well as a log of the actual transcript (capture with a logger, such
> as ethereal, or debug output from the server (uncomment some of the
> prints that are already there)) if possible?

Ah, ethereal made the conversation so much clearer now:

-----------------------------------------
0001 CAPABILITY .
* OK cyrushost Cyrus IMAP4 v2.1.13 server ready.
0001 BAD Unexpected extra arguments to Capability.
-----------------------------------------

And that's it. The extra dot killed it. It's now registered with issues
as msg606.



From twistedmail at filosi.com  Mon Aug 18 13:14:24 2003
From: twistedmail at filosi.com (Alex May)
Date: Mon, 18 Aug 2003 15:14:24 -0400
Subject: [Twisted-Python] Newbie trying to figure out cred
In-Reply-To: <DF298CA8-D0DE-11D7-92D5-000393C9700E@twistedmatrix.com>
References: <DF298CA8-D0DE-11D7-92D5-000393C9700E@twistedmatrix.com>
Message-ID: <200308181514.24060.twistedmail@filosi.com>

> If you are using new cred, please upgrade to the latest alpha.  (There
> should be another one coming out tonight.)  It is new code, and while
> the core isn't changing very much, a lot of other systems that use it
> are being updated, and new examples are being added.

Honestly, I don't care which cred I use, I just want to get something working.  
I chose new cred only because webhappyrealm.py was available too look at.  If 
new cred is too unstable, I'll happily use old cred - if I can ever figure 
out how to get it to work.

Anyway I updated to the latest alpha (1.0.7aplha4) and webhappyrealm.py still 
failed (even worse as I was unable to access /site2 either).

> Also, please check out Quotient (www.divmod.org) for a more complete
> example.

They require Python 2.3.  Unfortunately, because I'm using gentoo, it will be 
a real pain in the ass to upgrade.  I'll certainly take a look at the source 
code though.  Thanks.

Alex

On Sunday 17 August 2003 02:16 pm, Glyph Lefkowitz wrote:
> On Sunday, August 17, 2003, at 11:43 AM, Alex May wrote:
> > I upgraded to twisted 1.0.6 and downloaded sandbox/webhappyrealm.py.
> > When I
> > run it and attempt to access /site1 I get the following:
>
> If you are using new cred, please upgrade to the latest alpha.  (There
> should be another one coming out tonight.)  It is new code, and while
> the core isn't changing very much, a lot of other systems that use it
> are being updated, and new examples are being added.
>
> Also, please check out Quotient (www.divmod.org) for a more complete
> example.
>
> I have noticed that about 1/3 of the traffic on this mailing list is
> now "I am trying to understand  cred (usually in the context of
> woven.guard) and the docs seem incomplete.  Help!".  It's is my fault
> that it's so badly documented, and I am duly apologetic, but I simply
> don't have the time to fix this in the near term, and we need a
> solution in the near term.
>
> Thankfully, Travis has agreed to take over the issue for me for a
> while.  I'd like it if some of you that are having problems with the
> state of the documentation could coordinate with him to produce a
> sensible tutorial (and probably some patches to guard!) that will
> reduce the future volume of these questions :)
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From andrew-twisted at puzzling.org  Mon Aug 18 19:42:07 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue, 19 Aug 2003 11:42:07 +1000
Subject: [Twisted-Python] Twisted and curses
In-Reply-To: <20030817152142.GA28629@ferd2.thristian.org>
References: <20030817152142.GA28629@ferd2.thristian.org>
Message-ID: <20030819014207.GC472@frobozz>

On Mon, Aug 18, 2003 at 01:21:42AM +1000, screwtape at froup.com wrote:
[...]
> Twisted does not come with a curses reactor, but with a little
> experimentation I found out how to make the reactor's .listenWith()
> method do more or less what I wanted.

Have you seen doc/examples/cursesclient.py ?

> Code is here (5KB tarball):
> 
> 	http://members.optusnet.com.au/thristian/curses.tar.gz
> 
> You get cursesapp.py, a thin wrapper around curses setup, teardown,
> and the eventloop, and test.py, a very simple demonstration program.
> There's lots of comments and docstrings.
> 
> What do you think?

I'm no curses expert, but I'd be interested to see if your cursesapp can
simplify doc/examples/cursesclient.py... ;)

I think proper curses support in Twisted is a good idea though...

-Andrew.




From rtjohan at syspres.com  Mon Aug 18 22:30:56 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Mon, 18 Aug 2003 21:30:56 -0700
Subject: [Twisted-Python] Twisted Install Bug or doing something stupid [newbie]
In-Reply-To: <20030819014207.GC472@frobozz>
Message-ID: <000001c3660a$af776750$3d01a8c0@rjc800>

Just trying twisted for 1st time.

I'm very impressed with what I've read and seen so far.

Did a long evaluation of the different web platforms and twisted has just
about won. Just need to develop some simple stuff for sanity test.

Since I wanted to develop on Python 2.3, I installed Twisted 1.0.7alpha4.

When running pydoc and doing search for twisted - get lot's of docs listed.
Any of the twisted documetnation produces the following error in the web
browser: "problem in C:\Python23\lib\site-packages\twisted\__init__.pyc -
ImportError: cannot import name compat".

Is there something special that needs to be done before documentation is
available or is this just a bug with this alpha release?

Thanks,
Richard





From rtjohan at syspres.com  Mon Aug 18 22:40:06 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Mon, 18 Aug 2003 21:40:06 -0700
Subject: [Twisted-Python] Benchmark/performance of Twisted vs. the Cheetah/Webware/Apache/mod_webkit combo? [newbie]
Message-ID: <000101c3660b$f7a51350$3d01a8c0@rjc800>

Just curious about if there is some general feeling about how Twisted
performs. Would be good to know for estimating the server hardware
requirements.

Is there some dicussion / paper that coves how best to configure
Twisted/Woven for maxium performance? Not needed at the moment, but been
reading the Apache load balancing features. Would be nice to know that this
is available when required.

What does the asynchronous implementation mean in terms of performance. How
much does that give. Primarily looking at Twisted/Woven at the moment for
creating web apps using postgresql DB backend.

If there is some other group I should be posting these newbie questions to,
please let me know.

Thanks,
Richard





From screwtape at froup.com  Tue Aug 19 00:01:56 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Tue, 19 Aug 2003 16:01:56 +1000
Subject: [Twisted-Python] Twisted and curses
In-Reply-To: <20030819014207.GC472@frobozz>
References: <20030817152142.GA28629@ferd2.thristian.org> <20030819014207.GC472@frobozz>
Message-ID: <20030819060156.GA2335@ferd2.thristian.org>

On Tue, Aug 19, 2003 at 11:42:07AM +1000, Andrew Bennetts wrote:
> On Mon, Aug 18, 2003 at 01:21:42AM +1000, screwtape at froup.com wrote:
> [...]
> > Twisted does not come with a curses reactor, but with a little
> > experimentation I found out how to make the reactor's .listenWith()
> > method do more or less what I wanted.
> 
> Have you seen doc/examples/cursesclient.py ?

Uh... no. Bugger, I thought I searched the docs before starting.
Evidently, I wasn't thorough enough.

As it turns out, the idea I eventually hit upon is exactly the method
that example uses. Oh well, I guess I learned more about the internals
of the reactor than I otherwise would have. :)

> > Code is here (5KB tarball):
> > 
> > 	http://members.optusnet.com.au/thristian/curses.tar.gz
> > 
> > You get cursesapp.py, a thin wrapper around curses setup, teardown,
> > and the eventloop, and test.py, a very simple demonstration program.
> > There's lots of comments and docstrings.
> > 
> > What do you think?
> 
> I'm no curses expert, but I'd be interested to see if your cursesapp can
> simplify doc/examples/cursesclient.py... ;)

Hmm.. I don't know about simplify, but beautify, sure.

Also, my code handles terminal resizing, which the example code
doesn't.

I'll take a closer look at cursesclient.py tonight or tomorrow and see
if I can (a) figure out exactly what it's doing, and (b) write an
equivalent program that uses my curses module.

> I think proper curses support in Twisted is a good idea though...

Me too, surprisingly. :)

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _
|
| This empty tagline? It's where my conversation piece used to be.
|



From alienoid at is.lg.ua  Tue Aug 19 01:49:19 2003
From: alienoid at is.lg.ua (Ruslan Spivak)
Date: Tue, 19 Aug 2003 10:49:19 +0300
Subject: [Twisted-Python] wxpython + twisted: how to call method on app start up
Message-ID: <3F41D67F.9040104@is.lg.ua>

Hello.

Can you help me with the following:

I have wxpython + twisted application, i have button event handler - 
when button is pressed client connects to twisted server via ssl.


class MyFrame(wxFrame, TaskBarApp):
     ....
     ....

     def OnConnect(self, event=None):
         # Called when 'connect' button is pressed
         bf = pb.PBClientFactory()
         from twisted.internet import ssl
         contextFactory = ssl.ClientContextFactory()
         reactor.connectSSL("localhost", 33333, bf, contextFactory, 30)
         d = bf.getRootObject()

         d.addCallbacks(self.gotObject, self.gotError)


class MyApp(wxApp):
     def OnInit(self):
         frame = MyFrame(NULL, -1, "Infoservice HomeLAN")
         frame.Show(true)
         self.SetTopWindow(frame)
         return true

app = MyApp(0)
wxsupport.install(app)
reactor.run()

In my case user has option - 'autoconnect', so when application is 
launched and autoconnect is true, it will automatically connect to 
server. So i need to call OnConnect, but where is the right place where 
i need to put call to OnConnect? Should i do it with reactor callLater 
or somehow else?

Your help is very, very appreciated.
Thanks in advance.

Best regards,
Ruslan




From mkimpenhaus at plus.de  Tue Aug 19 06:20:01 2003
From: mkimpenhaus at plus.de (mkimpenhaus at plus.de)
Date: Tue, 19 Aug 2003 14:20:01 +0200
Subject: [Twisted-Python] [twisted-conch] Using flow package to control workflow
Message-ID: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>

Hi @all,

I am very sorry, but again I need some advice using the conch package, 
better in this case using the flow package together with conch.

Problem is -> I am using conch to connect per ssh to an server -> execute 
some scripts on the ssh-server -> got the callback and process the result.
For now this is working fine, but there's the problem when triggering the 
connection this method is used to give an resultset. Therefore I thought 
to use the flow package to block the triggering method until the result 
comes.

First, is this attempt ok ? Is it possible to use flow to synchronize that 
async thingie??
Next, what should I use -> I tried to use flow.Block() but now the whole 
script seem to hang?

I would like to give an example but this would go beyond the scope...

Any help is very appreciated.

Best regards and respect,
Marcus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20030819/4601316e/attachment.html>

From bob at redivi.com  Tue Aug 19 08:06:42 2003
From: bob at redivi.com (Bob Ippolito)
Date: Tue, 19 Aug 2003 10:06:42 -0400
Subject: [Twisted-Python] Re: [Pyobjc-dev] Re: pdb in PyObjC apps?
In-Reply-To: <2m8ypqm14l.fsf@starship.python.net>
Message-ID: <5BD9297E-D24E-11D7-AA43-000A95686CD8@redivi.com>

On Tuesday, Aug 19, 2003, at 05:45 America/New_York, Michael Hudson 
wrote:

> Zachery Bir <zbir at urbanape.com> writes:
>
>> Note to self: Don't use pdb and try to catch it through
>> double-clicking  the app :)
>
> :-)
>
> It shouldn't be *too* outrageously hard to teach my pyrepl interactive
> tool how to cooperate with the Cocoa run loop (you need a way to give
> an fd to Cocoa and say "give me control when there's something to read
> on this" and I'm sure I saw one of them somewhere) in which case you
> could have an interactive session running alongside your
> application... Hmm, where's that can of tuits?

I've developed a CoreFoundation reactor for Twisted that would 
facilitate this sort of thing.  It's not mainline yet because I haven't 
had time to fully test and write enough examples -- it does work, but 
I'm not currently comfortable putting it in the rest of Twisted yet 
(especially due to the Pyrex build dependency).

Here's what you would do (this obviously needs Developer Tools 
installed):

Download Pyrex 0.8.2

Modify Pyrex/Compiler/Nodes.py .. change the block starting on line 160 
to this (small fix to allow system includes):
     for filename in env.include_files:
       if not (filename.startswith('<') and filename.endswith('>')):
         filename = '"%s"' % filename
       code.putln('#include %s' % filename)

Install Pyrex

Checkout CVS HEAD of Twisted

Build and install Twisted (or put twisted into your PYTHONPATH, I have 
a symlink of ~/src/Twisted/twisted at 
~/Library/Python/2.3/site-packages/twisted)

Go into Twisted/sandbox/etrepum/cfsupport

python setup.py build_ext -i

cd TWISTEDPACKAGE/internet
ln -s TWISTEDCVS/sandbox/etrepum/cfreactor.py .
ln -s TWISTEDCVS/sandbox/etrepum/cfsupport/cfsupport.so .

That should work, to test it check out the examples in 
TWISTEDCVS/sandbox/etrepum/examples/PyObjC (which obviously require 
PyObjC, you can get that from PackageManager)

Also note that the cfsupport module is enough to just get notifications 
on the fd, but I recommend using Twisted for anything that talks 
sockets anyway.

-bob




From mkimpenhaus at plus.de  Tue Aug 19 08:19:01 2003
From: mkimpenhaus at plus.de (mkimpenhaus at plus.de)
Date: Tue, 19 Aug 2003 16:19:01 +0200
Subject: [Twisted-Python] [twisted-conch] Executing .profile after login
Message-ID: <OF1B9F8E84.2292C96A-ONC1256D87.004E7029@uz.tengelmann.de>

Hi @all,

me again with some problems :-)

When I login on the ssh-server I want the .profile to be executed. There 
are some special scripts setting the environment for the user.
Is there a simple way to do so??

Best regards and respect,
Marcus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20030819/80eee740/attachment.html>

From z3p at twistedmatrix.com  Tue Aug 19 08:50:53 2003
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Tue, 19 Aug 2003 09:50:53 -0500
Subject: [Twisted-Python] [twisted-conch] Using flow package to control workflow
In-Reply-To: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>
References: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>
Message-ID: <20030819145053.GA11565@pyramid.twistedmatrix.com>

On Tue, Aug 19, 2003 at 02:20:01PM +0200, mkimpenhaus at plus.de wrote:
> Hi @all,
> 
> I am very sorry, but again I need some advice using the conch package, 
> better in this case using the flow package together with conch.

I know nothing  about flow, but I'll try to answer your questions.

> Problem is -> I am using conch to connect per ssh to an server -> execute 
> some scripts on the ssh-server -> got the callback and process the result.
> For now this is working fine, but there's the problem when triggering the 
> connection this method is used to give an resultset. Therefore I thought 
> to use the flow package to block the triggering method until the result 
> comes.

The last part of that paragraph made no sense.  "triggering the
connection this method is used to give a result set"?  Does that mean
the client class has a function you call with the result?  In general,
the way to "block" on a method is to have that method return a Deferred,
which is called back with the results.  Actual blocking methods will
hang the reactor as it will have to wait for your method to return as
well.

> First, is this attempt ok ? Is it possible to use flow to synchronize that 
> async thingie??

> Next, what should I use -> I tried to use flow.Block() but now the whole 
> script seem to hang?

These are both flow questions, so hopefully someone else can answer
them.

-p
-- 
       Paul Swartz
(o_    http://www.twistedmatrix.com/users/z3p.twistd/  _o)
//\    z3p at twistedmatrix.com                           /\\
V_/_   AIM: z3penguin                                 _\_V->



From z3p at twistedmatrix.com  Tue Aug 19 08:54:00 2003
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Tue, 19 Aug 2003 09:54:00 -0500
Subject: [Twisted-Python] [twisted-conch] Executing .profile after login
In-Reply-To: <OF1B9F8E84.2292C96A-ONC1256D87.004E7029@uz.tengelmann.de>
References: <OF1B9F8E84.2292C96A-ONC1256D87.004E7029@uz.tengelmann.de>
Message-ID: <20030819145400.GB11565@pyramid.twistedmatrix.com>

On Tue, Aug 19, 2003 at 04:19:01PM +0200, mkimpenhaus at plus.de wrote:
> Hi @all,
> 
> me again with some problems :-)
> 
> When I login on the ssh-server I want the .profile to be executed. There 
> are some special scripts setting the environment for the user.
> Is there a simple way to do so??

Which part of the connection is conch?  Server, client, or both?

-p
-- 
       Paul Swartz
(o_    http://www.twistedmatrix.com/users/z3p.twistd/  _o)
//\    z3p at twistedmatrix.com                           /\\
V_/_   AIM: z3penguin                                 _\_V->



From mkimpenhaus at plus.de  Tue Aug 19 09:33:53 2003
From: mkimpenhaus at plus.de (mkimpenhaus at plus.de)
Date: Tue, 19 Aug 2003 17:33:53 +0200
Subject: Antwort: Re: [Twisted-Python] [twisted-conch] Executing .profile after
 login
Message-ID: <OF346454EC.0AF30C6E-ONC1256D87.00551B0C@uz.tengelmann.de>

Hi Paul,

sorry for giving not all informations.
The conch part is the client which connects to an AIX server with sshd.

I tried to place a file called rc into the users home/.ssh directory but 
it wasn't executed anyway.
Also using the command argument in the authorized_keys gave no success.

source: http://www.oreilly.com/catalog/sshtdg/chapter/ch08.html

Best regards and respect
Marcus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20030819/51d933b5/attachment.html>

From z3p at twistedmatrix.com  Tue Aug 19 09:51:25 2003
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Tue, 19 Aug 2003 10:51:25 -0500
Subject: [Twisted-Python] [twisted-conch] Executing .profile after login
In-Reply-To: <OF346454EC.0AF30C6E-ONC1256D87.00551B0C@uz.tengelmann.de>
References: <OF346454EC.0AF30C6E-ONC1256D87.00551B0C@uz.tengelmann.de>
Message-ID: <20030819155125.GC11565@pyramid.twistedmatrix.com>

On Tue, Aug 19, 2003 at 05:33:53PM +0200, mkimpenhaus at plus.de wrote:
> Hi Paul,
> 
> sorry for giving not all informations.
> The conch part is the client which connects to an AIX server with sshd.

Then it's not really a conch problem.  The server is in charge of
running all the necessary programs.  I'd suggest checking the sshd
and/or bash documentation.

-p
--
Paul Swartz
(o_    http://www.twistedmatrix.com/users/z3p.twistd/  _o)
//\    z3p at twistedmatrix.com                           /\\
V_/_   AIM: z3penguin                                 _\_V->



From cce at clarkevans.com  Tue Aug 19 13:46:55 2003
From: cce at clarkevans.com (Clark C. Evans)
Date: Tue, 19 Aug 2003 19:46:55 +0000
Subject: [Twisted-Python] Using flow package to control workflow
In-Reply-To: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>
References: <OF41F5E1B5.C84C4D7B-ONC1256D87.0042DEBA@uz.tengelmann.de>
Message-ID: <20030819194655.GA21407@polya.axista.com>

On Tue, Aug 19, 2003 at 02:20:01PM +0200, mkimpenhaus at plus.de wrote:
| Is it possible to use flow to synchronize that async thingie??

You can use Deferreds within a 'flow' generator, here is an example...

    from __future__ import generators
    from twisted.internet import defer, reactor
    from twisted.flow import flow
    
    def funcThatReturnsDeferred(immediate):
        d = defer.Deferred()
        if immediate:
            d.callback("immediate value")
        else:
            reactor.callLater(1, lambda: d.callback("delayed value"))
        return d 
    
    def myflow():
        #
        # To use a 'deferred' within a generator, it must first
        # be wrapped, then yield, and then use next() on the wrapper.
        #
        immediate = flow.wrap(funcThatReturnsDeferred(True))
        yield immediate
        print immediate.next()
    
        delayed = flow.wrap(funcThatReturnsDeferred(False))
        yield delayed
        print delayed.next()
   
    d = flow.Deferred(myflow)
    d.addCallback(lambda _: reactor.stop())
    reactor.run()

| Next, what should I use -> I tried to use flow.Block() but now
| the whole script seem to hang?

Use flow.Deferred() instead, which in effect takes the results
yielded by the flow and returns them in a list.

| I would like to give an example but this would go beyond the scope...

I hope the above can help.  

Best,

Clark



From oussoren at cistron.nl  Wed Aug 20 00:25:02 2003
From: oussoren at cistron.nl (Ronald Oussoren)
Date: Wed, 20 Aug 2003 08:25:02 +0200
Subject: [Twisted-Python] Re: [Pyobjc-dev] Re: pdb in PyObjC apps?
In-Reply-To: <5BD9297E-D24E-11D7-AA43-000A95686CD8@redivi.com>
References: <5BD9297E-D24E-11D7-AA43-000A95686CD8@redivi.com>
Message-ID: <07E29F7D-D2D7-11D7-BE1F-0003931CFE24@cistron.nl>

On Tuesday, 19 August, 2003, at 16:06, Bob Ippolito wrote:

> On Tuesday, Aug 19, 2003, at 05:45 America/New_York, Michael Hudson 
> wrote:
>
>> Zachery Bir <zbir at urbanape.com> writes:
>>
>>> Note to self: Don't use pdb and try to catch it through
>>> double-clicking  the app :)
>>
>> :-)
>>
>> It shouldn't be *too* outrageously hard to teach my pyrepl interactive
>> tool how to cooperate with the Cocoa run loop (you need a way to give
>> an fd to Cocoa and say "give me control when there's something to read
>> on this" and I'm sure I saw one of them somewhere) in which case you
>> could have an interactive session running alongside your
>> application... Hmm, where's that can of tuits?
>
> I've developed a CoreFoundation reactor for Twisted that would 
> facilitate this sort of thing.  It's not mainline yet because I 
> haven't had time to fully test and write enough examples -- it does 
> work, but I'm not currently comfortable putting it in the rest of 
> Twisted yet (especially due to the Pyrex build dependency).
>
> Here's what you would do (this obviously needs Developer Tools 
> installed):
>
> Download Pyrex 0.8.2
>
> Modify Pyrex/Compiler/Nodes.py .. change the block starting on line 
> 160 to this (small fix to allow system includes):
>     for filename in env.include_files:
>       if not (filename.startswith('<') and filename.endswith('>')):
>         filename = '"%s"' % filename
>       code.putln('#include %s' % filename)
>
> Install Pyrex
>
> Checkout CVS HEAD of Twisted
>
> Build and install Twisted (or put twisted into your PYTHONPATH, I have 
> a symlink of ~/src/Twisted/twisted at 
> ~/Library/Python/2.3/site-packages/twisted)
>
> Go into Twisted/sandbox/etrepum/cfsupport
>
> python setup.py build_ext -i
>
> cd TWISTEDPACKAGE/internet
> ln -s TWISTEDCVS/sandbox/etrepum/cfreactor.py .
> ln -s TWISTEDCVS/sandbox/etrepum/cfsupport/cfsupport.so .
>
> That should work, to test it check out the examples in 
> TWISTEDCVS/sandbox/etrepum/examples/PyObjC (which obviously require 
> PyObjC, you can get that from PackageManager)
>
> Also note that the cfsupport module is enough to just get 
> notifications on the fd, but I recommend using Twisted for anything 
> that talks sockets anyway.

Why didn't you use PyObjC? Is there functionality in CoreFoundation 
that is not in Cocoa or are there other reasons?

Ronald




From lafou at wanadoo.fr  Wed Aug 20 01:50:49 2003
From: lafou at wanadoo.fr (Philippe =?ISO-8859-1?Q?Lafoucri=E8re?=)
Date: 20 Aug 2003 09:50:49 +0200
Subject: [Twisted-Python] IBM developer works
Message-ID: <1061365849.29822.12.camel@biproc>

How to use Twisted.web to serve pages like PHP :

http://www-106.ibm.com/developerworks/linux/library/l-twist3.html






From m at moshez.org  Wed Aug 20 03:25:50 2003
From: m at moshez.org (Moshe Zadka)
Date: 20 Aug 2003 09:25:50 -0000
Subject: [Twisted-Python] IBM developer works
In-Reply-To: <1061365849.29822.12.camel@biproc>
References: <1061365849.29822.12.camel@biproc>
Message-ID: <20030820092550.19084.qmail@green.zadka.com>

On 20 Aug 2003, Philippe =?ISO-8859-1?Q?Lafoucri=E8re?= <lafou at wanadoo.fr> wrote:

> How to use Twisted.web to serve pages like PHP :

Yes, indeed.
That's exactly what it shows. We have already explained why
this is not a good idea.
-- 
Moshe Zadka -- http://moshez.org/
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- http://www.python.org/



From lafou at wanadoo.fr  Wed Aug 20 03:51:51 2003
From: lafou at wanadoo.fr (Philippe =?ISO-8859-1?Q?Lafoucri=E8re?=)
Date: 20 Aug 2003 11:51:51 +0200
Subject: [Twisted-Python] IBM developer works
In-Reply-To: <20030820092550.19084.qmail@green.zadka.com>
References: <1061365849.29822.12.camel@biproc>
	 <20030820092550.19084.qmail@green.zadka.com>
Message-ID: <1061373111.29825.33.camel@biproc>

> Yes, indeed.
> That's exactly what it shows. We have already explained why
> this is not a good idea.

I know ! I just it's a bad idea to let such article on Internet. Newbies
would always make the same mistake :(




From rtjohan at syspres.com  Wed Aug 20 04:54:57 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Wed, 20 Aug 2003 03:54:57 -0700
Subject: [Twisted-Python] IBM developer works
In-Reply-To: <1061373111.29825.33.camel@biproc>
Message-ID: <004b01c36709$7f4fd210$4601a8c0@rjc800>

I just saw the arcticles on IBM, but have not had
a chance to go through them yet. Just started looking
at Twisted. If there are any well known gotchas I would
be very grateful for any heads-up.

Is there a good article on how to use Twisted for doing
web applications for instance? Is Twisted / Woven a good
way to go for web applications?

Forced to do some .Net/C# for some customers at the moment.
Would prefer to use Python.

Thanks,
Richard

>-----Original Message-----
>From: twisted-python-admin at twistedmatrix.com
>[mailto:twisted-python-admin at twistedmatrix.com] On Behalf Of
>Philippe Lafoucri�re
>Sent: Wednesday, August 20, 2003 2:52 AM
>To: twisted-python at twistedmatrix.com
>Subject: Re: [Twisted-Python] IBM developer works
>
>
>> Yes, indeed.
>> That's exactly what it shows. We have already explained why
>> this is not a good idea.
>
>I know ! I just it's a bad idea to let such article on
>Internet. Newbies
>would always make the same mistake :(
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>





From glyph at twistedmatrix.com  Wed Aug 20 07:18:44 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 20 Aug 2003 08:18:44 -0500
Subject: [Twisted-Python] IBM developer works
In-Reply-To: <004b01c36709$7f4fd210$4601a8c0@rjc800>
Message-ID: <D2ECBB21-D310-11D7-92D5-000393C9700E@twistedmatrix.com>

On Wednesday, August 20, 2003, at 05:54 AM, Richard Johannesson wrote:

> Is there a good article on how to use Twisted for doing
> web applications for instance? Is Twisted / Woven a good
> way to go for web applications?

This article is not particularly bad, as far as that goes; (aside from 
the minor gaffe of defining a class in an RPY file which is mislabeled 
".py") I think it's unfair to say it's "like PHP".  That said, the 
article is about writing a web application, and Twisted works best when 
you reconfigure the sub-atomic particles in your brain to completely 
disassociate the concepts of "web" and "application".

Woven encourages you to develop a completely separate, 
separately-testable abstraction of your application, then wrap that 
with web-specific code.  David's article is just showing you the 
web-specific code part of that, and his "application objects" are lists 
of dictionaries of strings; nothing too sophisticated.

The trouble with documenting such a system is that it's geared towards 
doing non-trivial things.  If your example is non-trivial, then you can 
get carried away with explaining the example rather than explaining 
what the example is supposed to demonstrate.  If it's trivial, then you 
end up with abbreviated versions of things which are intended for more 
sophisticated use-cases, and so they don't always make sense.

For what it's worth, I think David's articles are doing a good job of 
finding that balance.  I'm sure that we'll need a lot more 
documentation before it's clear, though.

Maybe this should be Twisted's motto: "Making theoretically impossible 
things easy, and easy things theoretically possible."




From screwtape at froup.com  Wed Aug 20 08:53:59 2003
From: screwtape at froup.com (screwtape at froup.com)
Date: Thu, 21 Aug 2003 00:53:59 +1000
Subject: [Twisted-Python] Twisted and curses
In-Reply-To: <20030819014207.GC472@frobozz>
References: <20030817152142.GA28629@ferd2.thristian.org> <20030819014207.GC472@frobozz>
Message-ID: <20030820145358.GA10188@ferd2.thristian.org>

On Tue, Aug 19, 2003 at 11:42:07AM +1000, Andrew Bennetts wrote:
> I'm no curses expert, but I'd be interested to see if your cursesapp can
> simplify doc/examples/cursesclient.py... ;)

Meh. I spent an evening on it, and I'm still not sure exactly what
cursesclient.py does (other than 'demonstrate that curses and twisted
work together').

On the other hand, I *do* now have a semi-functional IRC client
written for curses that redraws properly when the window is resized
and everything.

I also have a much better understanding of why some oddities of the
Twisted API are the way they are, and a better understanding of why my
curses API sucks.

I guess I'll have a ponder and get back to it if I think of something.
*sigh*

-- 
 ___________ ___________________________________
| Screwtape | http://livejournal.com/~thristian |______ _____ ___ __ _  _   _
|
| "IMHO, we are a rhombus." -- DrnknMnky
|



From mailinglists at aguete.org  Wed Aug 20 12:12:55 2003
From: mailinglists at aguete.org (Manuel Duran Aguete)
Date: Wed, 20 Aug 2003 20:12:55 +0200
Subject: [Twisted-Python] Transactions with SQLReflector.
Message-ID: <1061403175.31151.26.camel@aguete.dyndns.org>

Hello,
	I need transactions usign SQLReflector. How can I ativate this ?
Basically I have an array of rowObjects  and I want to insert all of
them in a database table, but all in a transaction, and rollback if an
error occurrs.

							Thanks.




From dave at krondo.com  Wed Aug 20 12:51:45 2003
From: dave at krondo.com (Dave Peticolas)
Date: 20 Aug 2003 11:51:45 -0700
Subject: [Twisted-Python] Transactions with SQLReflector.
In-Reply-To: <1061403175.31151.26.camel@aguete.dyndns.org>
References: <1061403175.31151.26.camel@aguete.dyndns.org>
Message-ID: <1061405504.1071.558.camel@oneiros>

On Wed, 2003-08-20 at 11:12, Manuel Duran Aguete wrote:
> Hello,
> 	I need transactions usign SQLReflector. How can I ativate this ?
> Basically I have an array of rowObjects  and I want to insert all of
> them in a database table, but all in a transaction, and rollback if an
> error occurrs.

There isn't an automatic way to do this, but what you can
do is, instead of using sqlreflector.InsertRow(...), use
sqlreflector.InsertRowSQL(...) to build the sql calls to
do this, and then execute them all with the same cursor
using the connection pool's runInteraction method.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20030820/362fc801/attachment.sig>

From bob at redivi.com  Wed Aug 20 16:18:54 2003
From: bob at redivi.com (Bob Ippolito)
Date: Wed, 20 Aug 2003 18:18:54 -0400
Subject: [Twisted-Python] Re: [Pyobjc-dev] Re: pdb in PyObjC apps?
In-Reply-To: <07E29F7D-D2D7-11D7-BE1F-0003931CFE24@cistron.nl>
Message-ID: <48E96202-D35C-11D7-A5A9-000A95686CD8@redivi.com>

On Wednesday, Aug 20, 2003, at 02:25 America/New_York, Ronald Oussoren 
wrote:

> Why didn't you use PyObjC? Is there functionality in CoreFoundation 
> that is not in Cocoa or are there other reasons?

CFSocket notifications, (theoretical) Carbon runloop support, etc.  I 
wrote it in Pyrex after a huge waste of time trying to get it to work 
reliably in ctypes (callbacks would eventually start jumping to random 
locations in memory under load, core dump on uncaught exceptions, 
etc... I think it could be a libffi issue), and I didn't want to go 
through the same ordeal with PyObjC's callbacks after my last failed 
attempt to do Rendezvous callbacks with it.  The Pyrex module was not 
hard to write, and my wrapper does take a  CFRunLoopRef from a PyObjC 
NSRunLoop if you're trying to integrate it with Cocoa or whatever.

-bob




From rtjohan at syspres.com  Thu Aug 21 18:12:37 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Thu, 21 Aug 2003 17:12:37 -0700
Subject: [Twisted-Python] Where to report twistedmatrix.com website errors?
In-Reply-To: <48E96202-D35C-11D7-A5A9-000A95686CD8@redivi.com>
Message-ID: <004501c36842$186eca30$4601a8c0@rjc800>

Noticing a few broken links on the twistedmatrix.com website. Didn't find
any mention of where to email such bug to. Probably not to this list. Anyone
know?





From bob at redivi.com  Thu Aug 21 19:44:55 2003
From: bob at redivi.com (Bob Ippolito)
Date: Thu, 21 Aug 2003 21:44:55 -0400
Subject: [Twisted-Python] Where to report twistedmatrix.com website errors?
In-Reply-To: <004501c36842$186eca30$4601a8c0@rjc800>
Message-ID: <3AF4ECAA-D442-11D7-AFB0-000A95686CD8@redivi.com>

On Thursday, Aug 21, 2003, at 20:12 America/New_York, Richard 
Johannesson wrote:

> Noticing a few broken links on the twistedmatrix.com website. Didn't 
> find
> any mention of where to email such bug to. Probably not to this list. 
> Anyone
> know?

http://www.twistedmatrix.com/bugs/

Create yourself an account

And post issues with the Topics field filled out as "website", sans 
quotes.

-bob




From paul.rudin at ntlworld.com  Fri Aug 22 04:48:31 2003
From: paul.rudin at ntlworld.com (Paul Rudin)
Date: 22 Aug 2003 11:48:31 +0100
Subject: [Twisted-Python] Internet services for online gaming teams.
In-Reply-To: <20030822063901.8702.5871.Mailman@pyramid.twistedmatrix.com>
Message-ID: <m3k796otmo.fsf@ntlworld.com>

Greetings Twisted people (Twisters? :-)),

I recently stumbled over twisted and I thought it might be an
appropriate base for an idea I had.

This message outlines what I have in mind, and I'm hoping that people
will provide some insight into whether Twisted would be likely to
be of significant assistance in implementing such an idea.

This message is possibly only marginally on topic for this list -
please forgive me if you feel it's inappropriate content. If I proceed
with this idea rest assured I will be back with many specific
technical queries :-)

Background
----------

Competitive gaming over the internet has been around for about a
decade, and today is a hobby for millions (and a living for a
few). Teams - in this context traditionally called "clans" compete
against in other in online leagues and ladders, as well as sending
teams to compete in LAN tournaments. Popular games are Quake3, Unreal
Tournament, CounterStrike... (there are hundreds if not thousands).

Clans are notable in that they exist almost exclusively in the
internet. The vast majority of clan members will never meet their
teammates in real life - although as noted above some teams will
attend LAN events. Hence nearly all the organisation and social
interaction happens over the net.

Clans typically will have a number of online services to facilitate
this. Examples:

- irc channels - usually a private one and a public one, normally on
  quakenet (in Europe at least)

- One or more web servers.  Often incorporating some kind of "web
  forum" - phpbb or similar. Clan web servers often have similar
  functionality - access to rosters, game strategies, upcoming
  events, team lists for particular events... result history -
  standing in various leagues and ladders and so forth.

- One or more ftp servers. For hosting recording of prior games; and
  miscellaneous useful files for members.

- A nntp server.

- A voice comms server. E.g. teamspeak or similar.

- One or more game servers. 

- A mail server.


These servers may interact with each other in an ad hoc way. For
example web severs may use scripts to query or control game
servers. Bots in irc channels might provide access to some information
on game servers. However in general these services will not be well
integrated - it is necessary for members to have accounts on each
different server these accounts need to be managed as people join or
leave the clan or change their roles with the clan.


These servers are often hosted in fairly unreliable
environments. Many clan members will have broadband connections at
home and some of the services will be hosted on these. Some services
might be hosted using machines and bandwidth provided by people's
employers or place of study. Those administering the services will
often not be experienced system administrators and will be using
platforms not necessarily ideal for such operations. Often there maybe
be external factors controlling when machines will be up; the
availability of bandwith; and firewalls limiting the types of packets
the machines can send and receive.

Game servers tend to be the exception where the clan will pay a
hosting company to provide a server on fast hardware with a high
bandwith, low latency net connection.

The idea.
---------


I am aware of a number of projects attempting to provide an off the
shelf web server for clans; but it strikes me that it would be a fun
and potentially useful project to have an integrated system across
web, ftp, irc, game servers, voice comms servers etc.

Such a system would have a number of features.

- A repository of all information relating to the clan. This
  repository of information should be stored redundantly and it should
  be easy to propagate across the internet.

- Authentication and sophisticated authorisation mechanism the work
  across all the services

- Access to information information using a variety of standard net
  protocols using familiar software.

- The ability to host services on a variety of different platforms and
  to share the hosting among different servers which may not be very
  reliable.

- Some "off the shelf" utilities to provide the kinds of thing likely
  to be common to most clans.

- Customisable and extensible.

- Very easy to install, so that people without technical expertise can
  contribute CPU cycles and bandwidth to providing services.


A prototype
-----------

As a starting point a web server and an irc bot providing access to
the same distributed persistent information would be a good starting
point for a kind of proof of concept.

Twisted.
--------

I hope the above gives you the flavour of the kind of thing I have in
mind. It's not a detailed or well thought out plan - just something
that occurred to me the other day. I don't know much about Twisted -
but on looking through the web site it seems like it would be a good
tool kit for building such a system. Is this impression accurate?

Part of my motivation for contemplating this is simply to gain some
experience of network programming. I have considerable programming
experience, but mostly large desktop applications.




From andrew-twisted at puzzling.org  Fri Aug 22 05:38:16 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Fri, 22 Aug 2003 21:38:16 +1000
Subject: [Twisted-Python] Internet services for online gaming teams.
In-Reply-To: <m3k796otmo.fsf@ntlworld.com>
References: <20030822063901.8702.5871.Mailman@pyramid.twistedmatrix.com> <m3k796otmo.fsf@ntlworld.com>
Message-ID: <20030822113815.GA9606@frobozz>

On Fri, Aug 22, 2003 at 11:48:31AM +0100, Paul Rudin wrote:
[...]
> The idea.
> ---------
> 
> 
> I am aware of a number of projects attempting to provide an off the
> shelf web server for clans; but it strikes me that it would be a fun
> and potentially useful project to have an integrated system across
> web, ftp, irc, game servers, voice comms servers etc.
[...]

[In short, lots of different protocols integrated into one convenient
bundle]

> Twisted.
> --------
> 
> I hope the above gives you the flavour of the kind of thing I have in
> mind. It's not a detailed or well thought out plan - just something
> that occurred to me the other day. I don't know much about Twisted -
> but on looking through the web site it seems like it would be a good
> tool kit for building such a system. Is this impression accurate?

Yes, I think Twisted would be an excellent fit for this -- multi-protocol
servers are something it excels at.

-Andrew.




From rtjohan at syspres.com  Fri Aug 22 15:31:25 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Fri, 22 Aug 2003 14:31:25 -0700
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <000101c3660b$f7a51350$3d01a8c0@rjc800>
Message-ID: <005e01c368f4$be2c2960$4601a8c0@rjc800>

It seems the twistedmatrix.com website tends to be pretty slow.
What hardware is the twistedmatrix.com website being run on?
Where is it hosted? I'm in California.

Is Twisted + Woven ready for production web apps?
 - Is Woven API stable?
 - Good HTML / XHTML support
 - Scales to multiple web servers / load balancing

Just seems from what I've read twisted is supposed to be pretty close to
Apache + mod_python in terms of performance. Would be nice to find out the
limitation of the platform before hiring and training developers to build
web apps on this platform. Knowing the major limitations can start planning
for it and add that to the head count so those fixes or needed development
gets done.

Any feedback would be appreciated,
Richard





From dp at twistedmatrix.com  Fri Aug 22 16:01:30 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Fri, 22 Aug 2003 15:01:30 -0700
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <005e01c368f4$be2c2960$4601a8c0@rjc800>
References: <005e01c368f4$be2c2960$4601a8c0@rjc800>
Message-ID: <2FCC4150-D4EC-11D7-B76C-000A95864FC4@twistedmatrix.com>

On Friday, August 22, 2003, at 2:31 PM, Richard Johannesson wrote:

> It seems the twistedmatrix.com website tends to be pretty slow.
> What hardware is the twistedmatrix.com website being run on?
> Where is it hosted? I'm in California.

The problem with twistedmatrix.com is that it is currently hosted on
768kbit/sec SDSL...

>
> Is Twisted + Woven ready for production web apps?
>  - Is Woven API stable?

Woven's API is approaching stability. LivePage is currently the only
portion of the API which will still be changing significantly, and it is
possible to make complex apps without even knowing what LivePage is.

>  - Good HTML / XHTML support

Woven templates are XML and woven itself outputs XML.

>  - Scales to multiple web servers / load balancing

Whether this works is really up to how you design your app. Is your 
back-end
data store designed to support scaling across multiple machines?

> Just seems from what I've read twisted is supposed to be pretty close 
> to
> Apache + mod_python in terms of performance. Would be nice to find out 
> the
> limitation of the platform before hiring and training developers to 
> build
> web apps on this platform. Knowing the major limitations can start 
> planning
> for it and add that to the head count so those fixes or needed 
> development
> gets done.

Apache will be faster for serving static files because that is what it 
is designed
for; twisted + woven will be faster for large, very complex, very 
dynamic web
applications because that is what it is designed for. Really, the 
biggest
increase you will see is in programmer and designer productivity; woven
is engineered to cleanly separate the template from the code so that 
skinning
becomes trivial; and to support compositing of small components into 
large,
complex components so that your programmers focus on the functionality
of the app, not the complexities inherit in generating HTML and handling
form input.

dp




From rtjohan at syspres.com  Fri Aug 22 17:12:53 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Fri, 22 Aug 2003 16:12:53 -0700
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <2FCC4150-D4EC-11D7-B76C-000A95864FC4@twistedmatrix.com>
Message-ID: <006901c36902$eb2509b0$4601a8c0@rjc800>

Thanks dp,

>> It seems the twistedmatrix.com website tends to be pretty slow.
>The problem with twistedmatrix.com is that it is currently hosted on
>768kbit/sec SDSL...

Ok - makes sense.

>> Is Twisted + Woven ready for production web apps?
>>  - Is Woven API stable?
>Woven's API is approaching stability. LivePage is currently the only
>portion of the API which will still be changing significantly,
>and it is
>possible to make complex apps without even knowing what LivePage is.
>
>>  - Good HTML / XHTML support
>Woven templates are XML and woven itself outputs XML.

Is there anyone doing XSLT in Twisted? Any xml comparison to say 4suite?

>>  - Scales to multiple web servers / load balancing
>Whether this works is really up to how you design your app. Is your
>back-end data store designed to support scaling across multiple machines?

I was thinking in comparison to using Apache loadbalancing - mod_proxy?

>Apache will be faster for serving static files because that is what it
>is designed
>for; twisted + woven will be faster for large, very complex, very
>dynamic web
>applications because that is what it is designed for. Really, the
>biggest increase you will see is in programmer and designer productivity;
woven
>is engineered to cleanly separate the template from the code so that
>skinning becomes trivial; and to support compositing of small components
into
>large, complex components so that your programmers focus on the
functionality
>of the app, not the complexities inherit in generating HTML and handling
form input.

How would you compare getting web programmers up to speed on twisted vs with
.Net, webware, and zope.

My impression with zope seems to have everything, but also a mess.

Developed using .Net - pretty easy, but buggy.

Webware, seems simple and has a similar clean style to twisted. But, twisted
seems more capable / flexible.

Richard





From bob at redivi.com  Fri Aug 22 18:50:51 2003
From: bob at redivi.com (Bob Ippolito)
Date: Fri, 22 Aug 2003 20:50:51 -0400
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <2FCC4150-D4EC-11D7-B76C-000A95864FC4@twistedmatrix.com>
Message-ID: <D80E508C-D503-11D7-B83B-000A95686CD8@redivi.com>

On Friday, Aug 22, 2003, at 18:01 America/New_York, Donovan Preston 
wrote:

>> Just seems from what I've read twisted is supposed to be pretty close 
>> to
>> Apache + mod_python in terms of performance. Would be nice to find 
>> out the
>> limitation of the platform before hiring and training developers to 
>> build
>> web apps on this platform. Knowing the major limitations can start 
>> planning
>> for it and add that to the head count so those fixes or needed 
>> development
>> gets done.
>
> Apache will be faster for serving static files because that is what it 
> is designed
> for; twisted + woven will be faster for large, very complex, very 
> dynamic web
> applications because that is what it is designed for. Really, the 
> biggest
> increase you will see is in programmer and designer productivity; woven
> is engineered to cleanly separate the template from the code so that 
> skinning
> becomes trivial; and to support compositing of small components into 
> large,
> complex components so that your programmers focus on the functionality
> of the app, not the complexities inherit in generating HTML and 
> handling
> form input.

And this is, of course, why we have squid, because that is what it is 
designed for :)

-bob




From bob at redivi.com  Fri Aug 22 19:01:26 2003
From: bob at redivi.com (Bob Ippolito)
Date: Fri, 22 Aug 2003 21:01:26 -0400
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <006901c36902$eb2509b0$4601a8c0@rjc800>
Message-ID: <522082A5-D505-11D7-B83B-000A95686CD8@redivi.com>

On Friday, Aug 22, 2003, at 19:12 America/New_York, Richard Johannesson 
wrote:

>>>  - Good HTML / XHTML support
>> Woven templates are XML and woven itself outputs XML.
>
> Is there anyone doing XSLT in Twisted? Any xml comparison to say 
> 4suite?

I don't think so, but there isn't any reason why you can't use the 
4suite modules (they're in python, right?).

>
>>>  - Scales to multiple web servers / load balancing
>> Whether this works is really up to how you design your app. Is your
>> back-end data store designed to support scaling across multiple 
>> machines?
>
> I was thinking in comparison to using Apache loadbalancing - mod_proxy?

Theoretically, you would want to do backend load balancing with Twisted 
in a different way, because it has really convenient ways to talk over 
a network (perspective broker, primarily).  If you're just doing round 
robin load balancing or something you might as well use squid on the 
front end or something of that sort.  Unless the application is CPU 
dependent you can probably get away with one or more squid servers and 
a single Twisted server.  It's been a long time since I've seen a site 
/ load that really crawls because of CPU reasons though, it's usually 
the database's fault or just a bandwidth issue.

>
>> Apache will be faster for serving static files because that is what it
>> is designed
>> for; twisted + woven will be faster for large, very complex, very
>> dynamic web
>> applications because that is what it is designed for. Really, the
>> biggest increase you will see is in programmer and designer 
>> productivity;
> woven
>> is engineered to cleanly separate the template from the code so that
>> skinning becomes trivial; and to support compositing of small 
>> components
> into
>> large, complex components so that your programmers focus on the
> functionality
>> of the app, not the complexities inherit in generating HTML and 
>> handling
> form input.
>
> How would you compare getting web programmers up to speed on twisted 
> vs with
> .Net, webware, and zope.
>
> My impression with zope seems to have everything, but also a mess.

I couldn't really find a reason to use Zope, unless it was just to make 
a Plone site ;)  I tried though, but it's just too awkward for me.  
Maybe someone who wasn't used to programming "real" python would have a 
better time with Zope.

>
> Developed using .Net - pretty easy, but buggy.
>

C# is probably one of the most painful web languages I've ever 
developed with for oh so many reasons.   Microsoft really designed some 
horrible to use APIs.  They all seem pretty much ok theoretically, but 
the syntax you end up writing is god awful and long.

> Webware, seems simple and has a similar clean style to twisted. But, 
> twisted
> seems more capable / flexible.

No experience with it..

-bob




From glyph at twistedmatrix.com  Fri Aug 22 13:12:43 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 22 Aug 2003 14:12:43 -0500
Subject: [Twisted-Python] Internet services for online gaming teams.
In-Reply-To: <m3k796otmo.fsf@ntlworld.com>
Message-ID: <9B50FD4C-D4D4-11D7-A143-000393C9700E@twistedmatrix.com>

I'm curious how you're planning to do the integration with existing 
game servers, since those tend to be pretty tricky to communicate with.

And, I'll plug it again: many of the features you're describing are 
already on the timetable for Quotient: http://www.divmod.org/ .  I'm 
spending a lot of time on that these days :).

Twisted is an excellent toolkit for building these sorts of apps, but 
don't underestimate the difficulty of the problem.  Especially, it 
sounds like you need a loosely coupled, wide-area distributed, 
peer-to-peer persistence system (or possibly, object database).  This 
problem can be as hard as you want to make it, so you probably want to 
have a slightly better idea of what services you want to provide beyond 
"providing access to the same distributed persistent information".

I know because I've been thinking about this problem for the past 4 
years or so and I haven't really come up with anything yet :).




From rtjohan at syspres.com  Fri Aug 22 21:31:55 2003
From: rtjohan at syspres.com (Richard Johannesson)
Date: Fri, 22 Aug 2003 20:31:55 -0700
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <522082A5-D505-11D7-B83B-000A95686CD8@redivi.com>
Message-ID: <000b01c36927$1b0158e0$4601a8c0@rjc800>

Good input bob,

>> My impression with zope seems to have everything, but also a mess.
>I couldn't really find a reason to use Zope, unless it was just to make
>a Plone site ;)  I tried though, but it's just too awkward for me.
>Maybe someone who wasn't used to programming "real" python
>would have a better time with Zope.

That's the impression I got.

>> Developed using .Net - pretty easy, but buggy.
>C# is probably one of the most painful web languages I've ever
>developed with for oh so many reasons.   Microsoft really
>designed some horrible to use APIs.  They all seem pretty much ok
theoretically, but
>the syntax you end up writing is god awful and long.

.Net seems like a big improvement over ASP/PHP, but prefer Python easily
over .Net. If you've done .Net and Twisted - how would you compare the
learning curve for a typical web programmer using either .Net or
Twisted/Woven platform?

Richard





From paul.rudin at ntlworld.com  Sat Aug 23 01:57:12 2003
From: paul.rudin at ntlworld.com (Paul Rudin)
Date: 23 Aug 2003 08:57:12 +0100
Subject: [Twisted-Python] Internet services for online gaming teams.
In-Reply-To: <9B50FD4C-D4D4-11D7-A143-000393C9700E@twistedmatrix.com>
References: <9B50FD4C-D4D4-11D7-A143-000393C9700E@twistedmatrix.com>
Message-ID: <m3fzjsvmav.fsf@ntlworld.com>

Glyph Lefkowitz <glyph at twistedmatrix.com> writes:

> I'm curious how you're planning to do the integration with existing
> game servers, since those tend to be pretty tricky to communicate with.

I think I have to be realistic in that some existing software - the
game server and the voice comms server might be hard to integrate
fully. Nevertheless many game servers provide have things like the
ability to administer them remotely; a fairly rich scripting language;
built in web servers for remote administration and in game irc
clients.

I suppose that for each game it might be necessary to write a proxy
that knew how to talk to the game server on one side and the rest of
the system on the other. For games with rich scripting languages it
might be possible to have scripts running both client and server side
for games that were able to integrate with the rest of the system.

The trouble is that (even to the extent it's possible) you need to
code something for each game.

However many games do provide a consistent mechanism for querying them
about the current gamestate. So in the first instance one could simply
provide web forms and functionality in irc bots that allows you to
find out where team mates are playing, and what's happening on the
game servers that you control.

> 
> And, I'll plug it again: many of the features you're describing are
> already on the timetable for Quotient: http://www.divmod.org/ .  I'm
> spending a lot of time on that these days :).
> 

Thanks - I'll take a look.

> Twisted is an excellent toolkit for building these sorts of apps, but
> don't underestimate the difficulty of the problem.  Especially, it
> sounds like you need a loosely coupled, wide-area distributed,
> peer-to-peer persistence system (or possibly, object database).  This
> problem can be as hard as you want to make it, so you probably want to
> have a slightly better idea of what services you want to provide
> beyond "providing access to the same distributed persistent
> information".
> 

Yes - I think some reading up on peer-to-peer systems would do me some
good. 



> I know because I've been thinking about this problem for the past 4
> years or so and I haven't really come up with anything yet :).


I have an advantage: being almost completely ignorant of this area I
don't realise how hard the problem is :-)



Anyway in the short term I think I should do two things - I'll sit
down and write a better description of of what I'd like to produce
without worrying too much how it'll be achieved, and I'll start
writing little some very little programs just to gain some familiarity
with twisted,




From washort at twistedmatrix.com  Sat Aug 23 03:15:44 2003
From: washort at twistedmatrix.com (Allen Short)
Date: Sat, 23 Aug 2003 04:15:44 -0500 (CDT)
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <000b01c36927$1b0158e0$4601a8c0@rjc800>
References: <522082A5-D505-11D7-B83B-000A95686CD8@redivi.com>
	<000b01c36927$1b0158e0$4601a8c0@rjc800>
Message-ID: <20030823.041544.501808932.washort@twistedmatrix.com>

>>>>> "Richard" == Richard Johannesson <rtjohan at syspres.com> writes:


    > .Net seems like a big improvement over ASP/PHP, but prefer
    > Python easily over .Net. If you've done .Net and Twisted - how
    > would you compare the learning curve for a typical web
    > programmer using either .Net or Twisted/Woven platform?


I haven't used any of the dotnet stuff, but the small bits I've seen
have indicated it's not very different in philosophy from the
ASP/PHP/CGI/etc way of doing things. I'm not sure there's really a
"curve" for learning woven; for me, after a few years of dealing with
the prevailing models of webpage generation, Woven came as a breath of
fresh air: it's the only web framework I've used that I haven't come
to hate. However, as glyph pointed out recently, you have to
"reconfigure the sub-atomic particles in your brain to completely
disassociate the concepts of 'web' and 'application'." Some people
will be ready to do this, some won't. Once you've made the mental leap
to treating webpage generation as structure-based and not
string-based, you're most of the way there. 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030823/92af74d9/attachment.sig>

From douglas at paradise.net.nz  Sat Aug 23 08:43:33 2003
From: douglas at paradise.net.nz (Douglas Bagnall)
Date: Sun, 24 Aug 2003 02:43:33 +1200
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <000b01c36927$1b0158e0$4601a8c0@rjc800>
References: <000b01c36927$1b0158e0$4601a8c0@rjc800>
Message-ID: <3F477D95.2090003@paradise.net.nz>


Richard Johannesson wrote:

> .Net seems like a big improvement over ASP/PHP, but prefer Python easily
> over .Net. If you've done .Net and Twisted - how would you compare the
> learning curve for a typical web programmer using either .Net or
> Twisted/Woven platform?
> 

I don't know .Net, but from experience and months of lurking, I would 
say the Twisted newbie experience is characterised by waves of confusion 
and euphoria.  The learning curve is juddery, but generally enjoyable.

The closest thing to Woven I have used is Axkit (perl warning: 
http://axkit.org/), but of course Twisted as a whole is deeper and 
wider.  If you can take advantage of that, and if you have a bit of 
time, then I would recommend Twisted.  But if you have just a few weeks 
to make a boring web app, you might be better off with any old *SP.


douglas






From bob at redivi.com  Sat Aug 23 10:29:52 2003
From: bob at redivi.com (Bob Ippolito)
Date: Sat, 23 Aug 2003 12:29:52 -0400
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <20030823.041544.501808932.washort@twistedmatrix.com>
Message-ID: <05F9DACC-D587-11D7-B83B-000A95686CD8@redivi.com>

On Saturday, Aug 23, 2003, at 05:15 America/New_York, Allen Short wrote:

>>>>>> "Richard" == Richard Johannesson <rtjohan at syspres.com> writes:
>
>
>> .Net seems like a big improvement over ASP/PHP, but prefer
>> Python easily over .Net. If you've done .Net and Twisted - how
>> would you compare the learning curve for a typical web
>> programmer using either .Net or Twisted/Woven platform?
>
>
> I haven't used any of the dotnet stuff, but the small bits I've seen
> have indicated it's not very different in philosophy from the
> ASP/PHP/CGI/etc way of doing things. I'm not sure there's really a
> "curve" for learning woven; for me, after a few years of dealing with
> the prevailing models of webpage generation, Woven came as a breath of
> fresh air: it's the only web framework I've used that I haven't come
> to hate. However, as glyph pointed out recently, you have to
> "reconfigure the sub-atomic particles in your brain to completely
> disassociate the concepts of 'web' and 'application'." Some people
> will be ready to do this, some won't. Once you've made the mental leap
> to treating webpage generation as structure-based and not
> string-based, you're most of the way there.

There is a big difference between ASP/PHP/CGI/etc and ASP.NET: it tries 
to be pseudo-event-driven.  In the Page class you have methods that you 
can override, such as when a page loads, a session starts, the page 
ends, etc.  This is because caching is emphasized EVERYWHERE.  The 
ASP.NET and ADO.NET as a whole are built specifically to be cached.

-bob




From glyph at twistedmatrix.com  Sat Aug 23 19:32:51 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 23 Aug 2003 20:32:51 -0500
Subject: [Twisted-Python] Twisted Slow? Woven - Production Ready?
In-Reply-To: <2FCC4150-D4EC-11D7-B76C-000A95864FC4@twistedmatrix.com>
Message-ID: <E07CD6A2-D5D2-11D7-A143-000393C9700E@twistedmatrix.com>

On Friday, August 22, 2003, at 05:01 PM, Donovan Preston wrote:

> 768kbit/sec SDSL...

ADSL, actually: 384k down, 256k up.  This is being fixed soon.




From radix at twistedmatrix.com  Sat Aug 23 20:18:21 2003
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Sat, 23 Aug 2003 22:18:21 -0400
Subject: [Twisted-Python] twistedmatrix.com downtime!
Message-ID: <20030824021821.GI1508@twistedmatrix.com>

Twistedmatrix.com is going to be down while glyph moves to Boston --
probably a couple of days. We have set up a secondary MX for email, so
messages to people @ twistedmatrix.com will not be lost. Also, of
course, the web site, CVS, and all other services will be down. Thank
you for your patience in the matter!

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     http://twistedmatrix.com/users/radix.twistd/



From sflist at ihonk.com  Sat Aug 23 22:57:07 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Sat, 23 Aug 2003 21:57:07 -0700
Subject: [Twisted-Python] XML-RPC: Why encapsulate in a list?
Message-ID: <BB6D93B3.BB30%sflist@ihonk.com>

Hi all,

If I try this code:

def xmlrpc_blah(self):
    return { 'x': "yadda" }

What I get back through Python's xmlrpclib client is...

[{'x':"yadda"}]

Why does my dictionary (ergo struct) get encapsulated in a list (ergo
array)? What should I do if I just want to return a struct?

Thanks!

Steve Freitas




From itamar at itamarst.org  Sun Aug 24 07:45:03 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 24 Aug 2003 09:45:03 -0400
Subject: [Twisted-Python] XML-RPC: Why encapsulate in a list?
In-Reply-To: <BB6D93B3.BB30%sflist@ihonk.com>
References: <BB6D93B3.BB30%sflist@ihonk.com>
Message-ID: <20030824094503.41a5a09d.itamar@itamarst.org>

On Sat, 23 Aug 2003 21:57:07 -0700
Steve Freitas <sflist at ihonk.com> wrote:

> Why does my dictionary (ergo struct) get encapsulated in a list (ergo
> array)? What should I do if I just want to return a struct?

I can't reproduce this issue (twisted 1.0.7a5, python 2.2). Perhaps
there's a bug in your code somewhere - try with a simple test case and
see if it still happens? If it does, please add a bug report in our
issue tracker with minimal example code for the bug so we can fix it.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From typo at soniq.net  Sun Aug 24 19:15:12 2003
From: typo at soniq.net (Paul Boehm)
Date: Mon, 25 Aug 2003 03:15:12 +0200
Subject: [Twisted-Python] bug in conch tutorial
Message-ID: <20030825011512.GB28467@soniq.net>

class CatChannel(channel.SSHChannel):
    name = 'session'
    def channelOpen(self, data):
        d = self.conn.sendRequest(self, 'exec', common.NS('cat'),
                                  wantReply = 1)
        d.addCallback(self._cbSendRequest)
        self.catData = ''

imho self.catData should be cleared before it's possible for the
deferred to fire, and append to catData.

    def _cbSendRequest(self, ignored):
        self.write('This data will be echoed back to us by "cat."\r\n')
        self.conn.sendEOF(self)
        self.loseConnection()
    def dataReceived(self, data):
        self.catData += data
    def closed(self):
        print 'We got this from "cat":', self.catData



From sgillies at frii.com  Mon Aug 25 14:30:30 2003
From: sgillies at frii.com (Sean Gillies)
Date: Mon, 25 Aug 2003 14:30:30 -0600
Subject: [Twisted-Python] timeout using LivePage
Message-ID: <F8103AB0-D73A-11D7-8128-000393B98B56@frii.com>

Hi,

Am very new to Twisted but am quickly finding that I like
it.  All my questions and comments involve Twisted 1.0.6
in combo with Python 2.3 on OS X.

I've run into a problem while making a rough .rpy prototype of
a mapping application (ala MapQuest) using the U of Minnesota
MapServer's Python interface.

I will need to have server-side handlers for javascript events
to allow map zooming, panning, &c and so have been experimenting
with LivePage.  I intend that the code should render a map image,
and upon clicking the image, we zoom into the map (changing model
data), and redraw the map image.  Unfortunately, browsers are
unable to load the

mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1

URL that is generated by my instance of LivePage, and so the map
is never redrawn as it should.  The model data does get changed
successfully, and when I manually reload the page, I do see
the zoomed map image as I expect.

What is this 'woven_hookupOutputConduitToThisFrame' all about?
Do I need to set up another method to handle this URL?

I know that it's not recommended to put so much logic in the .rpy
file, but as I said, a quick and dirty prototype is what I'm after.
Am attaching the source of mapserv.rpy here:

--------------------------------------------------------------------
import os
import time
from twisted.web.woven import page, widgets, controller, model
from mapscript import *

base_mapfile = 'navtech_std.map'

# Get map object from the session data if we can
class MapModel(model.MethodModel):
     def wmfactory_mapobj(self, request):
         session_obj = request.getSession()
         try:
             session_mapobj = session_obj.mapobj
         except AttributeError:
             session_mapobj = mapObj(base_mapfile)
             session_obj.mapobj = session_mapobj
         return session_mapobj

# Widget for creating a temp map image and a tag linking to it
class MapImage(widgets.Widget):
     def setUp(self, request, node, data):
         mapobj = data
         node.tagName = "img"
         imgobj = mapobj.draw()
         tmp_file = '%s_%d_%d.%s' \
                  % (mapobj.name, time.time(), os.getpid(),
                     imgobj.format.extension )
         imgobj.save(os.path.join('/tmp', tmp_file))
         map_url = os.path.join('/tmp', tmp_file)
         node.setAttribute('src', map_url)
         node.setAttribute('height', str(mapobj.height))
         node.setAttribute('width', str(mapobj.width))
         node.setAttribute('border', '1')

# Widget for displaying the current scale of the map
class MapScale(widgets.Widget):
     def setUp(self, request, node, data):
         text = 'Scale: 1:%d' % (data.scale)
         newNode = request.d.createTextNode(text)
         node.appendChild(newNode)

# Template, using the web conduit glue
template = """<html>
   <body>
     <img model="mapobj" view="map_image" controller="map_ctrl"/>
     <p model="mapobj" view="map_scale" />
     <div view="webConduitGlue" />
   </body>
</html>
"""

# Zoom into the map in the event of a javascript onclick
class MyEventHandler(controller.Controller):
     def handle(self, request):
         self.view.addEventHandler("onclick", self.onClick)

     def onClick(self, request, widget):
         # Get session map object (layers and spatial extents)
         session_obj = request.getSession()
         try:
             session_mapobj = session_obj.mapobj
         except AttributeError:
             session_mapobj = mapObj(base_mapfile)
             session_obj.mapobj = session_mapob

         # zoom in on the map
         w = session_mapobj.width
         h = session_mapobj.height
         pt = pointObj()
         pt.x, pt.y = w/2, h/2
         session_mapobj.zoomPoint(2, pt, w, h, session_mapobj.extent, 
None)
         print session_mapobj.extent.minx, session_mapobj.extent.maxx
         print self, "Zoomed!!!"

         # There is a better way to redraw the map, certainly
         request.redirect('http://localhost:8084/mapserv.rpy/')
         request.finish()

# Page class
class MyPage(page.LivePage):
     def wcfactory_map_ctrl(self, request, node, model):
         return MyEventHandler(model)

# Resource
resource = MyPage(MapModel(), template=template)
resource.setSubviewFactory("map_image", MapImage)
resource.setSubviewFactory("map_scale", MapScale)
-----------------------------------------------------------------------

looking forward to any insights into LivePage and also looking forward
to getting enough experience with Twisted that I can begin to contribute
to the list discussions.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies




From maxk at touro.edu  Mon Aug 25 14:46:32 2003
From: maxk at touro.edu (Max Khesin)
Date: Mon, 25 Aug 2003 16:46:32 -0400 (EDT)
Subject: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <20030825134901.25074.49920.Mailman@pyramid.twistedmatrix.com>
Message-ID: <Pine.A41.4.10.10308251644120.2576-100000@academic.touro.edu>

Hi all,
I am trying to get twisted working on an RH7.1 box (in order to run
buildbot). As 7.1 comes with (and relies on) python 1.5 I had to install
parallel version 2.2 as python2. How do I configure twisted to run with
this setup?
thanks,
max.





From developer at csrules.dyndns.org  Mon Aug 25 14:52:06 2003
From: developer at csrules.dyndns.org (darryl)
Date: Mon, 25 Aug 2003 15:52:06 -0500 (CDT)
Subject: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <Pine.A41.4.10.10308251644120.2576-100000@academic.touro.edu>
References: <20030825134901.25074.49920.Mailman@pyramid.twistedmatrix.com>
        <Pine.A41.4.10.10308251644120.2576-100000@academic.touro.edu>
Message-ID: <10870.209.5.247.105.1061844726.squirrel@home.vandorp.ca>

You can just do:

python2 setup.py install

-D

> Hi all,
> I am trying to get twisted working on an RH7.1 box (in order to run
> buildbot). As 7.1 comes with (and relies on) python 1.5 I had to install
> parallel version 2.2 as python2. How do I configure twisted to run with
> this setup?
> thanks,
> max.
>
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python






From Martin.Moellenbeck at t-online.de  Mon Aug 25 14:59:18 2003
From: Martin.Moellenbeck at t-online.de (=?iso-8859-1?Q?Martin_M=F6llenbeck?=)
Date: Mon, 25 Aug 2003 22:59:18 +0200
Subject: AW: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <Pine.A41.4.10.10308251644120.2576-100000@academic.touro.edu>
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAARFFe7Wq86Uqt5quoDxSVd8KAAAAQAAAAHqQDJCiac0OM30azfWcsGAEAAAAA@t-online.de>

hi,

download the tar.gz and go to the twisted root.

Then type:

<path_to_python2.2>/python setup.py build

 and if not error occurs

<path_to_python2.2>/python setup.py install

greeting
	Martin

-----Ursprüngliche Nachricht-----
Von: twisted-python-admin at twistedmatrix.com
[mailto:twisted-python-admin at twistedmatrix.com] Im Auftrag von Max
Khesin
Gesendet: Montag, 25. August 2003 22:47
An: twisted-python at twistedmatrix.com
Betreff: [Twisted-Python] twisted installation (new to list)


Hi all,
I am trying to get twisted working on an RH7.1 box (in order to run
buildbot). As 7.1 comes with (and relies on) python 1.5 I had to install
parallel version 2.2 as python2. How do I configure twisted to run with
this setup? thanks, max.



_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From 2002 at weholt.org  Mon Aug 25 16:39:24 2003
From: 2002 at weholt.org (Thomas Weholt)
Date: Tue, 26 Aug 2003 00:39:24 +0200
Subject: [Twisted-Python] Question about multiple XML-RPC handlers
Message-ID: <007101c36b59$bcab7340$0401a8c0@razor>

>From the docs I see this example on how to implement a XML-RPC service :

from twisted.web import xmlrpc, server

class Example(xmlrpc.XMLRPC):
    """An example object to be published."""

    def xmlrpc_echo(self, x):
        """Return all passed args."""
        return x

    def xmlrpc_add(self, a, b):
        """Return sum of arguments."""
        return a + b


def main():
    from twisted.internet.app import Application
    app = Application("xmlrpc")
    r = Example()
    app.listenTCP(7080, server.Site(r))
    return app

application = main()

if __name__ == '__main__':
    application.run(save=0)

Test it with :

>>> import xmlrpclib
>>> s = xmlrpclib.Server('http://localhost:7080/')
>>> s.echo("lala")
'lala'

All is well and fine. But I need to differentiate abit, more like :

>>> import xmlrpclib
>>> s = xmlrpclib.Server('http://localhost:7080/')
>>> s.Example.echo("lala")
'lala'

For instance, if I create another XML-RPC-handler:

class Dummy(xmlrpc.XMLRPC):

    def xmlrpc_subtract(self, x, y):
        return x - y

I want someway to register it with the server and be able to call :

>>> import xmlrpclib
>>> s = xmlrpclib.Server('http://localhost:7080/')
>>> s.Example.echo("lala")
'lala'
>>> s.Example.add(1,2)
3
>>> s.Dummy.subtract(1,2)
-1

I've hacked the current XML-RPC code in Twisted abit to fit my needs, but
I'd like to be able to use the standard Twisted framework for this, not some
ad-hoc/mediocre/experimental thingy. Can I create a root-request which
somehow redirects the call to the correct instance/method if found or give a
proper failure-result if nothing is found?

Any clue or hint would be highly appreciated.

Best regards,
Thomas Weholt





From itamar at itamarst.org  Mon Aug 25 16:43:58 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 25 Aug 2003 18:43:58 -0400
Subject: [Twisted-Python] Question about multiple XML-RPC handlers
In-Reply-To: <007101c36b59$bcab7340$0401a8c0@razor>
References: <007101c36b59$bcab7340$0401a8c0@razor>
Message-ID: <20030825184358.1f15f1f9.itamar@itamarst.org>

On Tue, 26 Aug 2003 00:39:24 +0200
"Thomas Weholt" <2002 at weholt.org> wrote:

> I've hacked the current XML-RPC code in Twisted abit to fit my needs,
> but I'd like to be able to use the standard Twisted framework for
> this, not some ad-hoc/mediocre/experimental thingy. Can I create a
> root-request which somehow redirects the call to the correct
> instance/method if found or give a proper failure-result if nothing is
> found?

Dave Peticolas has some code in the issue tracker that  does this. It'll
be integrated into CVS sooner or later.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From dp at twistedmatrix.com  Mon Aug 25 17:45:20 2003
From: dp at twistedmatrix.com (Donovan Preston)
Date: Mon, 25 Aug 2003 16:45:20 -0700
Subject: [Twisted-Python] timeout using LivePage
In-Reply-To: <F8103AB0-D73A-11D7-8128-000393B98B56@frii.com>
References: <F8103AB0-D73A-11D7-8128-000393B98B56@frii.com>
Message-ID: <2FF8F04E-D756-11D7-9014-000A95864FC4@twistedmatrix.com>

On Monday, August 25, 2003, at 1:30 PM, Sean Gillies wrote:

> Hi,
>
> Am very new to Twisted but am quickly finding that I like
> it.  All my questions and comments involve Twisted 1.0.6
> in combo with Python 2.3 on OS X.

Great! Always glad to have more users giving me feedback.

If you are going to be using LivePage, you should probably
track CVS instead of using a release, since LivePage is the
one major area of woven I am still doing major work on.

First, I want to clarify some terminology. LivePage is designed
to allow two things:

Client-To-Server Events: A JavaScript event handler in the
browser is routed to the Twisted server and causes some code
to run. This uses a channel I am calling the "InputConduit"

Server-To-Client Events: Some event happened on the server
(For example, new mail arrived, another player entered the room)
and the server wants to "Push" some new HTML to the client.
This uses a channel I am calling the "OutputConduit"

> I've run into a problem while making a rough .rpy prototype of
> a mapping application (ala MapQuest) using the U of Minnesota
> MapServer's Python interface.
>
> I will need to have server-side handlers for javascript events
> to allow map zooming, panning, &c and so have been experimenting
> with LivePage.  I intend that the code should render a map image,
> and upon clicking the image, we zoom into the map (changing model
> data), and redraw the map image.  Unfortunately, browsers are
> unable to load the
>
> mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1
>
> URL that is generated by my instance of LivePage, and so the map
> is never redrawn as it should.

There are actually two unrelated issues here. The first is that the
current implementation of LivePage in the Twisted CVS is geared
towards the NewReality web client (NewReality is a multiuser text
environment (game) written in Twisted) and thus the ability for
the server to send events to the client is pretty important.
You are connected and logged in using the web client, and
someone else enters the room -- you want the web browser to
display a notice about someone entering the room without having
to refresh the browser manually or set up continual reloading.

The output conduit is implemented in certain browsers (those
lacking Flash and LiveConnect) by embedding an <iframe>
tag whose src="?woven_hookupOutputConduitToThisFrame=1"
in the page. When the browser attempts to load this iframe, it
makes a request to the server, and twisted notices that the
browser "wants to hook up the output conduit to this frame",
and *never finishes sending this page to the client*. The
Twisted server just holds this connection open forever, so
that it can write data to the client on demand in response
to events on the server, and this is why it appears your
browser is unable to load this URL.

Since with your application it sounds like you only want
client-to-server events, you need to do a little bit of
hacking to prevent Woven from including the output
conduit HTML in your pages. This will get easier in future
releases of Twisted; I just haven't had time to enumerate
the possible ways people will want to use LivePage and
come up with an easy way for the programmer to specify
the features they want.

If you look at the HTML fragment woven includes in your
page when you specify the view directive "webConduitGlue"
you will see it includes the following parts:

   <div>
    <script src="WebConduit2_js" language="javascript"></script>
    <iframe src="input_html"
         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
    <iframe
         src="?woven_hookupOutputConduitToThisFrame=1"
         style="width: 100%" id="woven_outputConduit"></iframe>
   </div>

Simply replace the view="webConduitGlue" node with the above
fragment, sans the output conduit frame:

   <div>
    <script src="WebConduit2_js" language="javascript"></script>
    <iframe src="input_html"
         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
   </div>

After you have done this, your pages will actually appear to fully
load and you should feel happier.

> The model data does get changed
> successfully, and when I manually reload the page, I do see
> the zoomed map image as I expect.

The second issue is that you are not notifying your models
properly to tell them that they have changed. When a
client-to-server event is sent from the browser to the server,
the current version of Woven only sends the portions of the
page which have actually changed, not the entire page,
back to the browser. Again, this is something I would like
the programmer to be able to control, because sometimes
the changes are extensive enough that it makes more sense
to send the entire page back.

Your redirect hack is not a terrible solution, actually. I have
used it before.

See below for an example of how you can make your current
controller code notify the model properly.

> What is this 'woven_hookupOutputConduitToThisFrame' all about?
> Do I need to set up another method to handle this URL?
>
> I know that it's not recommended to put so much logic in the .rpy
> file, but as I said, a quick and dirty prototype is what I'm after.
> Am attaching the source of mapserv.rpy here:
>
> --------------------------------------------------------------------
> import os
> import time
> from twisted.web.woven import page, widgets, controller, model
> from mapscript import *
>
> base_mapfile = 'navtech_std.map'
>
> # Get map object from the session data if we can
> class MapModel(model.MethodModel):
>     def wmfactory_mapobj(self, request):
>         session_obj = request.getSession()
>         try:
>             session_mapobj = session_obj.mapobj
>         except AttributeError:
>             session_mapobj = mapObj(base_mapfile)
>             session_obj.mapobj = session_mapobj
>         return session_mapobj
>
> # Widget for creating a temp map image and a tag linking to it
> class MapImage(widgets.Widget):
>     def setUp(self, request, node, data):
>         mapobj = data
>         node.tagName = "img"
>         imgobj = mapobj.draw()
>         tmp_file = '%s_%d_%d.%s' \
>                  % (mapobj.name, time.time(), os.getpid(),
>                     imgobj.format.extension )
>         imgobj.save(os.path.join('/tmp', tmp_file))
>         map_url = os.path.join('/tmp', tmp_file)
>         node.setAttribute('src', map_url)
>         node.setAttribute('height', str(mapobj.height))
>         node.setAttribute('width', str(mapobj.width))
>         node.setAttribute('border', '1')
>
> # Widget for displaying the current scale of the map
> class MapScale(widgets.Widget):
>     def setUp(self, request, node, data):
>         text = 'Scale: 1:%d' % (data.scale)
>         newNode = request.d.createTextNode(text)
>         node.appendChild(newNode)
>
> # Template, using the web conduit glue
> template = """<html>
>   <body>
>     <img model="mapobj" view="map_image" controller="map_ctrl"/>
>     <p model="mapobj" view="map_scale" />
>     <div view="webConduitGlue" />
>   </body>
> </html>
> """
>
> # Zoom into the map in the event of a javascript onclick
> class MyEventHandler(controller.Controller):
>     def handle(self, request):
>         self.view.addEventHandler("onclick", self.onClick)
>
>     def onClick(self, request, widget):
>         # Get session map object (layers and spatial extents)
>         session_obj = request.getSession()
>         try:
>             session_mapobj = session_obj.mapobj
>         except AttributeError:
>             session_mapobj = mapObj(base_mapfile)
>             session_obj.mapobj = session_mapob
>
>         # zoom in on the map
>         w = session_mapobj.width
>         h = session_mapobj.height
>         pt = pointObj()
>         pt.x, pt.y = w/2, h/2
>         session_mapobj.zoomPoint(2, pt, w, h, session_mapobj.extent, 
> None)
>         print session_mapobj.extent.minx, session_mapobj.extent.maxx
>         print self, "Zoomed!!!"

            # Tell the browser that the model has changed, and
            # any widgets which rely on this model will have to be
            # rerendered, and the HTML sent to the browser
	 widget.model.notify({'request': request})

            # Delete the next three lines
>         # There is a better way to redraw the map, certainly
>         request.redirect('http://localhost:8084/mapserv.rpy/')
>         request.finish()
>
> # Page class
> class MyPage(page.LivePage):
>     def wcfactory_map_ctrl(self, request, node, model):
>         return MyEventHandler(model)
>
> # Resource
> resource = MyPage(MapModel(), template=template)
> resource.setSubviewFactory("map_image", MapImage)
> resource.setSubviewFactory("map_scale", MapScale)
> -----------------------------------------------------------------------
>
> looking forward to any insights into LivePage and also looking forward
> to getting enough experience with Twisted that I can begin to 
> contribute
> to the list discussions.

By the way, addEventHandler takes additional arguments
which are javascript strings which will be evaluated within the
context of the browser, and the results will be sent as additional
arguments to the server-side event handler.

To take advantage of this, you have to know a bit about
JavaScript, but for example, if you know about the IE global
"event" object, you could use it to pass the current x, y
position of the mouse to the server with something like
this:

self.view.addEventHandler("onclick", self.onClick, 'event.x', 'event.y')

Then defining the event handler like this:

def addEventHandler(self, request, widget, x, y):
	print "x, y", x, y

Of course, doing this means knowing enough about javascript to do
this properly, but those are problems with JavaScript and not Woven.
I think Mozilla has different semantics for getting at the event object
which may require changes in WebConduit2_js. I would consider it a
bug if changes are required.

I hope this helps!

Donovan




From maxk at touro.edu  Mon Aug 25 18:04:39 2003
From: maxk at touro.edu (Max Khesin)
Date: Mon, 25 Aug 2003 20:04:39 -0400 (EDT)
Subject: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <10870.209.5.247.105.1061844726.squirrel@home.vandorp.ca>
Message-ID: <Pine.A41.4.10.10308252003050.14190-100000@academic.touro.edu>

I tried python2 setup.py install, as daryl suggested. got this stuff:

bash-2.05$ python2 setup.py install
running install
Traceback (most recent call last):
  File "setup.py", line 331, in ?
    setup(**setup_args)
  File "/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/core.py",
line 138, in setup
  File "/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/dist.py",
line 902, in run_commands
  File "/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/dist.py",
line 921, in run_command
  File "/usr/lib/python2.2/cmd.py", line 112, in ensure_finalized
    except EOFError:
  File
"/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/command/install.py",
line 267, in finalize_options
  File
"/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/sysconfig.py",
line 417, in get_config_vars
  File
"/var/tmp/python2-2.2.3-root/usr/lib/python2.2/distutils/sysconfig.py",
line 322, in _init_posix
distutils.errors.DistutilsPlatformError: invalid Python installation:
unable to open /usr/lib/python2.2/config/Makefile (No such file or
directory)

Any ideas?
thanks,
max.




From itamar at itamarst.org  Mon Aug 25 18:11:28 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Mon, 25 Aug 2003 20:11:28 -0400
Subject: [Twisted-Python] twisted installation (new to list)
In-Reply-To: <Pine.A41.4.10.10308252003050.14190-100000@academic.touro.edu>
References: <10870.209.5.247.105.1061844726.squirrel@home.vandorp.ca>
	<Pine.A41.4.10.10308252003050.14190-100000@academic.touro.edu>
Message-ID: <20030825201128.18efa944.itamar@itamarst.org>

On Mon, 25 Aug 2003 20:04:39 -0400 (EDT)
Max Khesin <maxk at touro.edu> wrote:

> I tried python2 setup.py install, as daryl suggested. got this stuff:

Install python2-dev rpm or whatever it's called (-devel?). What're you
using buildbot for, by the way?

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From sflist at ihonk.com  Mon Aug 25 21:50:03 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Mon, 25 Aug 2003 20:50:03 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
Message-ID: <200308252045.59176.sflist@ihonk.com>

Hi all,

This is maybe just a Python library question, but I'm not sure.

I'd like to set up an XML-RPC server function to accept a dictionary/struct. 
So I thought I'd do this...

def xmlrpc_foo(self, **mydict):

But when I send it a struct, it throws an error of '0 args expected, 1 given,' 
much like...

>>> def blah(**myDict):
>>>   return myDict['x']
>>>
>>> print blah({'x':42, 'y':3})

...does. So under regular Python, the way to make this work fine is:

>>> def blah(myDict):
>>>   return myDict['x']
>>>
>>> print blah({'x':42, 'y':3})

But when I try this under twisted...

def xmlrpc_foo(self, myDict):
        return myDict['x']

I get a key error, saying strings are not callable.

So how do I get a twisted xmlrpc function to accept a struct? I assume I have 
to take it into a string and somehow serialize it into a dictionary using 
XML-RPC magic I haven't learned about, as in...

def xmlrpc_foo(self, myDict):
        ...magically transform myDict (a string) into myNewDict (a dict!)...
        return myNewDict['x']

Any help is appreciated! Thanks!

Steve



From dave at krondo.com  Mon Aug 25 22:25:28 2003
From: dave at krondo.com (Dave Peticolas)
Date: 25 Aug 2003 21:25:28 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <200308252045.59176.sflist@ihonk.com>
References: <200308252045.59176.sflist@ihonk.com>
Message-ID: <1061871928.2133.47.camel@oneiros>

On Mon, 2003-08-25 at 20:50, Steve Freitas wrote:
> Hi all,
> 
> This is maybe just a Python library question, but I'm not sure.
> 
> I'd like to set up an XML-RPC server function to accept a dictionary/struct. 
> So I thought I'd do this...
> 
> def xmlrpc_foo(self, **mydict):
>
> But when I send it a struct, it throws an error of '0 args expected, 1 given,' 
> much like...

This will never work since XML-RPC doesn't support **kw arguments.


> >>> def blah(**myDict):
> >>>   return myDict['x']
> >>>
> >>> print blah({'x':42, 'y':3})
> 
> ...does. So under regular Python, the way to make this work fine is:
>
> >>> def blah(myDict):
> >>>   return myDict['x']
> >>>
> >>> print blah({'x':42, 'y':3})
> 
> But when I try this under twisted...
> 
> def xmlrpc_foo(self, myDict):
>         return myDict['x']
> 
> I get a key error, saying strings are not callable.
> 
> So how do I get a twisted xmlrpc function to accept a struct? I assume I have 
> to take it into a string and somehow serialize it into a dictionary using 
> XML-RPC magic I haven't learned about, as in...
> 
> def xmlrpc_foo(self, myDict):
>         ...magically transform myDict (a string) into myNewDict (a dict!)...
>         return myNewDict['x']
> 
> Any help is appreciated! Thanks!

No, you just send a python dictionary. XML-RPC will serialize
it as a struct and it will be converted back to a Python dict
before it is passed to your handler.

If you're using Twisted on the client side as well:

  proxy.callRemote('foo', {'x':42})

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20030825/b51c9f48/attachment.sig>

From golux at comcast.net  Tue Aug 26 01:29:06 2003
From: golux at comcast.net (Steve Waterbury)
Date: Tue, 26 Aug 2003 03:29:06 -0400
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <1061871928.2133.47.camel@oneiros>
References: <200308252045.59176.sflist@ihonk.com> <1061871928.2133.47.camel@oneiros>
Message-ID: <3F4B0C42.6080407@comcast.net>

Dave Peticolas wrote:
> On Mon, 2003-08-25 at 20:50, Steve Freitas wrote:

>>So how do I get a twisted xmlrpc function to accept a struct? I assume I have 
>>to take it into a string and somehow serialize it into a dictionary using 
>>XML-RPC magic I haven't learned about, as in...
>>
>>def xmlrpc_foo(self, myDict):
>>        ...magically transform myDict (a string) into myNewDict (a dict!)...
>>        return myNewDict['x']
>>
>>Any help is appreciated! Thanks!
> 
> 
> No, you just send a python dictionary. XML-RPC will serialize
> it as a struct and it will be converted back to a Python dict
> before it is passed to your handler.
> 
> If you're using Twisted on the client side as well:
> 
>   proxy.callRemote('foo', {'x':42})

Or you can use objects instead of structs, jelly them,
and send the jellied objects over xmlrpc -- xmlrpc has
no problem with nested lists, which is what jelly
produces.  Good ol' jelly!  Caveat:  the objects'
attributes have to be jellyable (some types aren't).
This is analogous to the PB "copyable" paradigm.

- Steve.




From sgillies at frii.com  Tue Aug 26 07:48:12 2003
From: sgillies at frii.com (Sean Gillies)
Date: Tue, 26 Aug 2003 07:48:12 -0600
Subject: [Twisted-Python] timeout using LivePage
In-Reply-To: <2FF8F04E-D756-11D7-9014-000A95864FC4@twistedmatrix.com>
Message-ID: <EF75DB24-D7CB-11D7-8128-000393B98B56@frii.com>

On Monday, August 25, 2003, at 05:45  PM, Donovan Preston wrote:

>
> On Monday, August 25, 2003, at 1:30 PM, Sean Gillies wrote:
>
>> Hi,
>>
>> Am very new to Twisted but am quickly finding that I like
>> it.  All my questions and comments involve Twisted 1.0.6
>> in combo with Python 2.3 on OS X.
>
> Great! Always glad to have more users giving me feedback.
>
> If you are going to be using LivePage, you should probably
> track CVS instead of using a release, since LivePage is the
> one major area of woven I am still doing major work on.
>
> First, I want to clarify some terminology. LivePage is designed
> to allow two things:
>
> Client-To-Server Events: A JavaScript event handler in the
> browser is routed to the Twisted server and causes some code
> to run. This uses a channel I am calling the "InputConduit"
>
> Server-To-Client Events: Some event happened on the server
> (For example, new mail arrived, another player entered the room)
> and the server wants to "Push" some new HTML to the client.
> This uses a channel I am calling the "OutputConduit"
>
>> I've run into a problem while making a rough .rpy prototype of
>> a mapping application (ala MapQuest) using the U of Minnesota
>> MapServer's Python interface.
>>
>> I will need to have server-side handlers for javascript events
>> to allow map zooming, panning, &c and so have been experimenting
>> with LivePage.  I intend that the code should render a map image,
>> and upon clicking the image, we zoom into the map (changing model
>> data), and redraw the map image.  Unfortunately, browsers are
>> unable to load the
>>
>> mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1
>>
>> URL that is generated by my instance of LivePage, and so the map
>> is never redrawn as it should.
>
> There are actually two unrelated issues here. The first is that the
> current implementation of LivePage in the Twisted CVS is geared
> towards the NewReality web client (NewReality is a multiuser text
> environment (game) written in Twisted) and thus the ability for
> the server to send events to the client is pretty important.
> You are connected and logged in using the web client, and
> someone else enters the room -- you want the web browser to
> display a notice about someone entering the room without having
> to refresh the browser manually or set up continual reloading.
>
> The output conduit is implemented in certain browsers (those
> lacking Flash and LiveConnect) by embedding an <iframe>
> tag whose src="?woven_hookupOutputConduitToThisFrame=1"
> in the page. When the browser attempts to load this iframe, it
> makes a request to the server, and twisted notices that the
> browser "wants to hook up the output conduit to this frame",
> and *never finishes sending this page to the client*. The
> Twisted server just holds this connection open forever, so
> that it can write data to the client on demand in response
> to events on the server, and this is why it appears your
> browser is unable to load this URL.
>
> Since with your application it sounds like you only want
> client-to-server events, you need to do a little bit of
> hacking to prevent Woven from including the output
> conduit HTML in your pages. This will get easier in future
> releases of Twisted; I just haven't had time to enumerate
> the possible ways people will want to use LivePage and
> come up with an easy way for the programmer to specify
> the features they want.
>
> If you look at the HTML fragment woven includes in your
> page when you specify the view directive "webConduitGlue"
> you will see it includes the following parts:
>
>   <div>
>    <script src="WebConduit2_js" language="javascript"></script>
>    <iframe src="input_html"
>         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
>    <iframe
>         src="?woven_hookupOutputConduitToThisFrame=1"
>         style="width: 100%" id="woven_outputConduit"></iframe>
>   </div>
>
> Simply replace the view="webConduitGlue" node with the above
> fragment, sans the output conduit frame:
>
>   <div>
>    <script src="WebConduit2_js" language="javascript"></script>
>    <iframe src="input_html"
>         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
>   </div>
>
> After you have done this, your pages will actually appear to fully
> load and you should feel happier.
>
>> The model data does get changed
>> successfully, and when I manually reload the page, I do see
>> the zoomed map image as I expect.
>
> The second issue is that you are not notifying your models
> properly to tell them that they have changed. When a
> client-to-server event is sent from the browser to the server,
> the current version of Woven only sends the portions of the
> page which have actually changed, not the entire page,
> back to the browser. Again, this is something I would like
> the programmer to be able to control, because sometimes
> the changes are extensive enough that it makes more sense
> to send the entire page back.
>
> Your redirect hack is not a terrible solution, actually. I have
> used it before.
>
> See below for an example of how you can make your current
> controller code notify the model properly.
>
>> What is this 'woven_hookupOutputConduitToThisFrame' all about?
>> Do I need to set up another method to handle this URL?
>>
>> I know that it's not recommended to put so much logic in the .rpy
>> file, but as I said, a quick and dirty prototype is what I'm after.
>> Am attaching the source of mapserv.rpy here:
>>
>> --------------------------------------------------------------------
>> import os
>> import time
>> from twisted.web.woven import page, widgets, controller, model
>> from mapscript import *
>>
>> base_mapfile = 'navtech_std.map'
>>
>> # Get map object from the session data if we can
>> class MapModel(model.MethodModel):
>>     def wmfactory_mapobj(self, request):
>>         session_obj = request.getSession()
>>         try:
>>             session_mapobj = session_obj.mapobj
>>         except AttributeError:
>>             session_mapobj = mapObj(base_mapfile)
>>             session_obj.mapobj = session_mapobj
>>         return session_mapobj
>>
>> # Widget for creating a temp map image and a tag linking to it
>> class MapImage(widgets.Widget):
>>     def setUp(self, request, node, data):
>>         mapobj = data
>>         node.tagName = "img"
>>         imgobj = mapobj.draw()
>>         tmp_file = '%s_%d_%d.%s' \
>>                  % (mapobj.name, time.time(), os.getpid(),
>>                     imgobj.format.extension )
>>         imgobj.save(os.path.join('/tmp', tmp_file))
>>         map_url = os.path.join('/tmp', tmp_file)
>>         node.setAttribute('src', map_url)
>>         node.setAttribute('height', str(mapobj.height))
>>         node.setAttribute('width', str(mapobj.width))
>>         node.setAttribute('border', '1')
>>
>> # Widget for displaying the current scale of the map
>> class MapScale(widgets.Widget):
>>     def setUp(self, request, node, data):
>>         text = 'Scale: 1:%d' % (data.scale)
>>         newNode = request.d.createTextNode(text)
>>         node.appendChild(newNode)
>>
>> # Template, using the web conduit glue
>> template = """<html>
>>   <body>
>>     <img model="mapobj" view="map_image" controller="map_ctrl"/>
>>     <p model="mapobj" view="map_scale" />
>>     <div view="webConduitGlue" />
>>   </body>
>> </html>
>> """
>>
>> # Zoom into the map in the event of a javascript onclick
>> class MyEventHandler(controller.Controller):
>>     def handle(self, request):
>>         self.view.addEventHandler("onclick", self.onClick)
>>
>>     def onClick(self, request, widget):
>>         # Get session map object (layers and spatial extents)
>>         session_obj = request.getSession()
>>         try:
>>             session_mapobj = session_obj.mapobj
>>         except AttributeError:
>>             session_mapobj = mapObj(base_mapfile)
>>             session_obj.mapobj = session_mapob
>>
>>         # zoom in on the map
>>         w = session_mapobj.width
>>         h = session_mapobj.height
>>         pt = pointObj()
>>         pt.x, pt.y = w/2, h/2
>>         session_mapobj.zoomPoint(2, pt, w, h, session_mapobj.extent,  
>> None)
>>         print session_mapobj.extent.minx, session_mapobj.extent.maxx
>>         print self, "Zoomed!!!"
>
>            # Tell the browser that the model has changed, and
>            # any widgets which rely on this model will have to be
>            # rerendered, and the HTML sent to the browser
> 	 widget.model.notify({'request': request})
>
>            # Delete the next three lines
>>         # There is a better way to redraw the map, certainly
>>         request.redirect('http://localhost:8084/mapserv.rpy/')
>>         request.finish()
>>
>> # Page class
>> class MyPage(page.LivePage):
>>     def wcfactory_map_ctrl(self, request, node, model):
>>         return MyEventHandler(model)
>>
>> # Resource
>> resource = MyPage(MapModel(), template=template)
>> resource.setSubviewFactory("map_image", MapImage)
>> resource.setSubviewFactory("map_scale", MapScale)
>> ---------------------------------------------------------------------- 
>> -
>>
>> looking forward to any insights into LivePage and also looking forward
>> to getting enough experience with Twisted that I can begin to  
>> contribute
>> to the list discussions.
>
> By the way, addEventHandler takes additional arguments
> which are javascript strings which will be evaluated within the
> context of the browser, and the results will be sent as additional
> arguments to the server-side event handler.
>
> To take advantage of this, you have to know a bit about
> JavaScript, but for example, if you know about the IE global
> "event" object, you could use it to pass the current x, y
> position of the mouse to the server with something like
> this:
>
> self.view.addEventHandler("onclick", self.onClick, 'event.x',  
> 'event.y')
>
> Then defining the event handler like this:
>
> def addEventHandler(self, request, widget, x, y):
> 	print "x, y", x, y
>
> Of course, doing this means knowing enough about javascript to do
> this properly, but those are problems with JavaScript and not Woven.
> I think Mozilla has different semantics for getting at the event object
> which may require changes in WebConduit2_js. I would consider it a
> bug if changes are required.
>
> I hope this helps!
>
> Donovan
>

Hi Donovan,

Thanks for the reply.  I can't wait to try out your recommendations.

I had read in the docs about the extra args to addEventHandler, but
appreciate seeing an example that's so close to my particular need.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies




From justinjohnson at fastmail.fm  Tue Aug 26 07:48:02 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Tue, 26 Aug 2003 07:48:02 -0600
Subject: [Twisted-Python] Progressbar via curses for cmdline, LivePage for web
Message-ID: <20030826134802.C9EEE39DB2@www.fastmail.fm>

I have some questions about displaying console output using curses for
unix and Console or some other module for windows.  I did see posts
earlier about curses and have read the example cursesclient.py file in
cvs, but I still have some questions.

I have several methods in a PB server that do things with DeferredLists. 
I want progress on the overall task to be reported as each of the
callbacks get called.  The way I have been doing this is having my client
subclass pb.Referenceable, defining remote_print on the client, and then
passing the client as an argument to the server's remote calls.  Then
each callback prints a "." when they complete and an "F" upon failure,
thus sort of simulating a progress bar.

This doesn't work when I have multiple tasks going at once whose progress
I want to report separately.  So it seems to me that I need to start
using curses or some other such module.  I would have to define tasks
(something that has its own progress bar) and pass the task or the id to
the task to the callbacks so they would update the appropriate progress
bar.

Additionally, I would like to provide similar functionality for a web
interface to the server, using woven, and probably LivePage so that
progress could be communicated back appropriately.

So... I'm going to start digging into this, but I am wondering, has
anyone done this before?  Do you have any pointers for me?

Thanks.
-Justin



From 2002 at weholt.org  Tue Aug 26 10:58:16 2003
From: 2002 at weholt.org (Thomas Weholt)
Date: Tue, 26 Aug 2003 18:58:16 +0200
Subject: [Twisted-Python] Forms-handling in Twisted
Message-ID: <001201c36bf3$3f154790$0401a8c0@razor>

Can anybody provide a simple example on how to use the form-widget in
Twisted? I need something that sets datatype and some form of validation on
post, server-side.

Somethinglike the Guard-example in the latest alpha would be great.

Best regards,
Thomas Weholt




From sgillies at frii.com  Tue Aug 26 11:11:37 2003
From: sgillies at frii.com (Sean Gillies)
Date: Tue, 26 Aug 2003 11:11:37 -0600
Subject: [Twisted-Python] timeout using LivePage
In-Reply-To: <2FF8F04E-D756-11D7-9014-000A95864FC4@twistedmatrix.com>
Message-ID: <5A567B3E-D7E8-11D7-8128-000393B98B56@frii.com>

On Monday, August 25, 2003, at 05:45  PM, Donovan Preston wrote:

> On Monday, August 25, 2003, at 1:30 PM, Sean Gillies wrote:
>
>> Hi,
>>
>> Am very new to Twisted but am quickly finding that I like
>> it.  All my questions and comments involve Twisted 1.0.6
>> in combo with Python 2.3 on OS X.
>
> Great! Always glad to have more users giving me feedback.
>
> If you are going to be using LivePage, you should probably
> track CVS instead of using a release, since LivePage is the
> one major area of woven I am still doing major work on.
>
> First, I want to clarify some terminology. LivePage is designed
> to allow two things:
>
> Client-To-Server Events: A JavaScript event handler in the
> browser is routed to the Twisted server and causes some code
> to run. This uses a channel I am calling the "InputConduit"
>
> Server-To-Client Events: Some event happened on the server
> (For example, new mail arrived, another player entered the room)
> and the server wants to "Push" some new HTML to the client.
> This uses a channel I am calling the "OutputConduit"
>
>> I've run into a problem while making a rough .rpy prototype of
>> a mapping application (ala MapQuest) using the U of Minnesota
>> MapServer's Python interface.
>>
>> I will need to have server-side handlers for javascript events
>> to allow map zooming, panning, &c and so have been experimenting
>> with LivePage.  I intend that the code should render a map image,
>> and upon clicking the image, we zoom into the map (changing model
>> data), and redraw the map image.  Unfortunately, browsers are
>> unable to load the
>>
>> mapserv.rpy/?woven_hookupOutputConduitToThisFrame=1
>>
>> URL that is generated by my instance of LivePage, and so the map
>> is never redrawn as it should.
>
> There are actually two unrelated issues here. The first is that the
> current implementation of LivePage in the Twisted CVS is geared
> towards the NewReality web client (NewReality is a multiuser text
> environment (game) written in Twisted) and thus the ability for
> the server to send events to the client is pretty important.
> You are connected and logged in using the web client, and
> someone else enters the room -- you want the web browser to
> display a notice about someone entering the room without having
> to refresh the browser manually or set up continual reloading.
>
> The output conduit is implemented in certain browsers (those
> lacking Flash and LiveConnect) by embedding an <iframe>
> tag whose src="?woven_hookupOutputConduitToThisFrame=1"
> in the page. When the browser attempts to load this iframe, it
> makes a request to the server, and twisted notices that the
> browser "wants to hook up the output conduit to this frame",
> and *never finishes sending this page to the client*. The
> Twisted server just holds this connection open forever, so
> that it can write data to the client on demand in response
> to events on the server, and this is why it appears your
> browser is unable to load this URL.
>
> Since with your application it sounds like you only want
> client-to-server events, you need to do a little bit of
> hacking to prevent Woven from including the output
> conduit HTML in your pages. This will get easier in future
> releases of Twisted; I just haven't had time to enumerate
> the possible ways people will want to use LivePage and
> come up with an easy way for the programmer to specify
> the features they want.
>
> If you look at the HTML fragment woven includes in your
> page when you specify the view directive "webConduitGlue"
> you will see it includes the following parts:
>
>   <div>
>    <script src="WebConduit2_js" language="javascript"></script>
>    <iframe src="input_html"
>         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
>    <iframe
>         src="?woven_hookupOutputConduitToThisFrame=1"
>         style="width: 100%" id="woven_outputConduit"></iframe>
>   </div>
>
> Simply replace the view="webConduitGlue" node with the above
> fragment, sans the output conduit frame:
>
>   <div>
>    <script src="WebConduit2_js" language="javascript"></script>
>    <iframe src="input_html"
>         style="width: 0; height: 0" id="woven_inputConduit"></iframe>
>   </div>
>
> After you have done this, your pages will actually appear to fully
> load and you should feel happier.
>
>> The model data does get changed
>> successfully, and when I manually reload the page, I do see
>> the zoomed map image as I expect.
>
> The second issue is that you are not notifying your models
> properly to tell them that they have changed. When a
> client-to-server event is sent from the browser to the server,
> the current version of Woven only sends the portions of the
> page which have actually changed, not the entire page,
> back to the browser. Again, this is something I would like
> the programmer to be able to control, because sometimes
> the changes are extensive enough that it makes more sense
> to send the entire page back.
>
> Your redirect hack is not a terrible solution, actually. I have
> used it before.
>
> See below for an example of how you can make your current
> controller code notify the model properly.
>
Donovan,

I am now using Twisted from CVS and have made the change to my
template so that the webConduitGlue is not used.  Have also
made the change to my onclick event handler so that
widget.model.notify is called.

So far so good ... the model is being notified and the code in
my custom MapImage widget's setUp medthod is being executed.
I can tell because it is creating new map images in the app's
temporary location and these new images are exactly as I expect.

However, the document is not being rerendered properly: the HTML
returned to my browser is unchanged, the <img /> tag still points
to the old map image location.

FWIW, I'm using Mozilla, Safari, and IE 5 on OS X and see the same
issue with each of these.  Will I need to edit WebConduit2_js?  If
so, can you suggest where I would start?

cheers,
Sean



--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies




From abe at fettig.net  Tue Aug 26 11:21:50 2003
From: abe at fettig.net (Abe Fettig)
Date: 26 Aug 2003 13:21:50 -0400
Subject: [Twisted-Python] Forms-handling in Twisted
In-Reply-To: <001201c36bf3$3f154790$0401a8c0@razor>
References: <001201c36bf3$3f154790$0401a8c0@razor>
Message-ID: <1061918509.594.6.camel@mingus>

On Tue, 2003-08-26 at 12:58, Thomas Weholt wrote:
> Can anybody provide a simple example on how to use the form-widget in
> Twisted?

I've been working on understanding this myself.  Attached is an
incomplete example, but it does illustrate how to set up a form and use
it within a woven template. 

Notable points:

* the same template is used both for the form and the error page
* view is left blank in the template; woven sees that the model is a
FormMethod object and automatically selects the correct View.

Abe
-------------- next part --------------
A non-text attachment was scrubbed...
Name: twisted-form-demo.py
Type: text/x-python
Size: 1300 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030826/1949efa4/attachment-0002.py>

From sflist at ihonk.com  Tue Aug 26 14:51:36 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Tue, 26 Aug 2003 13:51:36 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <1061871928.2133.47.camel@oneiros>
References: <200308252045.59176.sflist@ihonk.com> <1061871928.2133.47.camel@oneiros>
Message-ID: <200308261351.36319.sflist@ihonk.com>

Hi Dave,

Thanks for your reply!

> No, you just send a python dictionary. XML-RPC will serialize
> it as a struct and it will be converted back to a Python dict
> before it is passed to your handler.
>
> If you're using Twisted on the client side as well:
>
>   proxy.callRemote('foo', {'x':42})

Unfortunately I'm using C++ on the client side, with XmlRpc++ as my library 
(http://xmlrpcpp.sourceforge.net/). I'd like to avoid putting Python in that 
mix, as I wasn't planning on using it on the client at all. 

Besides, I thought this was what I was doing when I sent my Twisted server a 
simple struct. If XML-RPC serializes it as a struct (which was what I was 
sending), what am I doing wrong to prevent it from working as you describe?

Thanks!

Steve



From sflist at ihonk.com  Tue Aug 26 14:52:00 2003
From: sflist at ihonk.com (Steve Freitas)
Date: Tue, 26 Aug 2003 13:52:00 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <3F4B0C42.6080407@comcast.net>
References: <200308252045.59176.sflist@ihonk.com> <1061871928.2133.47.camel@oneiros> <3F4B0C42.6080407@comcast.net>
Message-ID: <200308261352.00527.sflist@ihonk.com>

Hi Steve,

> Or you can use objects instead of structs, jelly them,
> and send the jellied objects over xmlrpc -- xmlrpc has
> no problem with nested lists, which is what jelly
> produces.  Good ol' jelly!  Caveat:  the objects'
> attributes have to be jellyable (some types aren't).
> This is analogous to the PB "copyable" paradigm.

As I noted in my other reply, I'm unfortunately using C++ on the client side. 
Any other ideas on how I get Twisted to turn my struct into a dictionary?

Steve



From dave at krondo.com  Tue Aug 26 15:47:07 2003
From: dave at krondo.com (Dave Peticolas)
Date: 26 Aug 2003 14:47:07 -0700
Subject: [Twisted-Python] Another silly XML-RPC question
In-Reply-To: <200308261351.36319.sflist@ihonk.com>
References: <200308252045.59176.sflist@ihonk.com>
	 <1061871928.2133.47.camel@oneiros>  <200308261351.36319.sflist@ihonk.com>
Message-ID: <1061934427.2133.59.camel@oneiros>

On Tue, 2003-08-26 at 13:51, Steve Freitas wrote:
> Hi Dave,
> 
> Thanks for your reply!
> 
> > No, you just send a python dictionary. XML-RPC will serialize
> > it as a struct and it will be converted back to a Python dict
> > before it is passed to your handler.
> >
> > If you're using Twisted on the client side as well:
> >
> >   proxy.callRemote('foo', {'x':42})
> 
> Unfortunately I'm using C++ on the client side, with XmlRpc++ as my library 
> (http://xmlrpcpp.sourceforge.net/). I'd like to avoid putting Python in that 
> mix, as I wasn't planning on using it on the client at all. 
> 
> Besides, I thought this was what I was doing when I sent my Twisted server a 
> simple struct. If XML-RPC serializes it as a struct (which was what I was 
> sending), what am I doing wrong to prevent it from working as you describe?

A struct should be unserialized to a Python dict no problem.

It's hard to say from here what is going on, but Twisted's
XMLRPC class is so simple it should be easy to add a few
print statements to find out what is happening. Check out
the XMLRPC.render(...) function. You might want to print
the request content and unserialized arguments as a starting
point.

dave

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20030826/c0c378ef/attachment.sig>

From sgillies at frii.com  Tue Aug 26 16:42:48 2003
From: sgillies at frii.com (Sean Gillies)
Date: Tue, 26 Aug 2003 16:42:48 -0600
Subject: Fixed (Re: [Twisted-Python] timeout using LivePage)
In-Reply-To: <5A567B3E-D7E8-11D7-8128-000393B98B56@frii.com>
Message-ID: <9DFB3412-D816-11D7-8128-000393B98B56@frii.com>

On Tuesday, August 26, 2003, at 11:11  AM, Sean Gillies wrote:

> ...
>
> So far so good ... the model is being notified and the code in
> my custom MapImage widget's setUp medthod is being executed.
> I can tell because it is creating new map images in the app's
> temporary location and these new images are exactly as I expect.
>
> However, the document is not being rerendered properly: the HTML
> returned to my browser is unchanged, the <img /> tag still points
> to the old map image location.
>
> FWIW, I'm using Mozilla, Safari, and IE 5 on OS X and see the same
> issue with each of these.  Will I need to edit WebConduit2_js?  If
> so, can you suggest where I would start?
>
> cheers,
> Sean
>

No problem with LivePage or the javascript in WebConduit2_js after
all.

After I changed my MapImage widget class to extend widget.Image,
and wrote a proper setUp method, I get map zooming just as I
need.

Slick stuff, Donovan!

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies




From glyph at twistedmatrix.com  Thu Aug 28 18:16:09 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 28 Aug 2003 19:16:09 -0500
Subject: [Twisted-Python] Re: [Twisted-commits] log stderr and non-zero exit code in CGIs, don't show info to users as it is a security risk (closes issue #241)
In-Reply-To: <E19sOlM-0000eO-00@pyramid.twistedmatrix.com>
Message-ID: <FD55CF30-D9B5-11D7-96C4-000393C9700E@twistedmatrix.com>

On Thursday, August 28, 2003, at 10:32 AM, itamarst CVS wrote:

> log stderr and non-zero exit code in CGIs, don't show info to users as 
> it is a security risk (closes issue #241)

We shouldn't swallow errors in these situations.  If it's a security 
risk, provide a way for the server administrator to turn it off, but 
this is a _bad_ default.

If you doubt the wisdom of making this default, please consult any 
number of Perl FAQs of the form:

	Q. "I wrote a CGI and it works perfectly, but now I moved it to 
another server and I get nothing but a "500 Internal Server Error" 
page.  How do I tell what went wrong!?!?!?"

	A. Look in your apache logs.

	---

	Q. "I looked at my apache logs and nothing makes sense!  How do I tell 
what the error was??!"

	A. ...

Also, could you clarify the security risk of displaying stderr from CGI 
scripts?  I've never heard of a CGI that puts security-critical 
information on stderr rather than stdout and makes it a risk to display 
to users.




From itamar at itamarst.org  Thu Aug 28 18:50:05 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 28 Aug 2003 20:50:05 -0400
Subject: [Twisted-Python] Re: [Twisted-commits] log stderr and non-zero
 exit code in CGIs, don't show info to users as it is a security risk
 (closes issue #241)
In-Reply-To: <FD55CF30-D9B5-11D7-96C4-000393C9700E@twistedmatrix.com>
References: <E19sOlM-0000eO-00@pyramid.twistedmatrix.com>
	<FD55CF30-D9B5-11D7-96C4-000393C9700E@twistedmatrix.com>
Message-ID: <20030828205005.05371e43.itamar@itamarst.org>

On Thu, 28 Aug 2003 19:16:09 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> Also, could you clarify the security risk of displaying stderr from
> CGI scripts?  I've never heard of a CGI that puts security-critical 
> information on stderr rather than stdout and makes it a risk to
> display to users.

If it's a python script it's probably going to be a traceback.

Also, I don't care about the Perl FAQ :) If you can't figure out how to
read the exact same info out of a logfile, you shouldn't be trying to
debug a CGI script.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From glyph at twistedmatrix.com  Thu Aug 28 18:59:37 2003
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 28 Aug 2003 19:59:37 -0500
Subject: [Twisted-Python] Re: [Twisted-commits] log stderr and non-zero exit code in CGIs, don't show info to users as it is a security risk (closes issue #241)
In-Reply-To: <20030828205005.05371e43.itamar@itamarst.org>
Message-ID: <0FC6C27C-D9BC-11D7-96C4-000393C9700E@twistedmatrix.com>

On Thursday, August 28, 2003, at 07:50 PM, Itamar Shtull-Trauring wrote:

> Also, I don't care about the Perl FAQ :) If you can't figure out how to
> read the exact same info out of a logfile, you shouldn't be trying to
> debug a CGI script.

Well, I'll defer to a poll, here, if anyone is interested in this 
issue.  In the absence of more than one user's feedback putting it one 
way or the other, I will revert this change.




From itamar at itamarst.org  Thu Aug 28 19:26:42 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 28 Aug 2003 21:26:42 -0400
Subject: [Twisted-Python] Re: [Twisted-commits] log stderr and non-zero
 exit code in CGIs, don't show info to users as it is a security risk
 (closes issue #241)
In-Reply-To: <0FC6C27C-D9BC-11D7-96C4-000393C9700E@twistedmatrix.com>
References: <20030828205005.05371e43.itamar@itamarst.org>
	<0FC6C27C-D9BC-11D7-96C4-000393C9700E@twistedmatrix.com>
Message-ID: <20030828212642.7529d345.itamar@itamarst.org>

On Thu, 28 Aug 2003 19:59:37 -0500
Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> Well, I'll defer to a poll, here, if anyone is interested in this 
> issue.  In the absence of more than one user's feedback putting it one
> 
> way or the other, I will revert this change.

Only revert the removed HTML output - it should be logged to the log
file regardless.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From syver at inout.no  Fri Aug 29 02:00:36 2003
From: syver at inout.no (Syver Enstad)
Date: 29 Aug 2003 10:00:36 +0200
Subject: [Twisted-Python] Woven dynamic table, patterns and idioms wanted.
Message-ID: <ud6eodhaz.fsf@inout.no>

I am finally beginning to grasp woven, but I have a bit of code in my
woven application that seems to reimplement views and would like some
advice on how to avoid that.

The scenerio is as follows: I have a table with a header and a rows
where each row present an object. I use view="List" but I can't
specify each attribute in the object as a column in the table with
model and view because these are dynamic.

In a static solution this would look something like this:
<table model="myModel" view="List">
  <tr pattern="listItem">
    <td model="anAttribute" view="Text" />
    <td model="anotherAttribute" view="Date" />
    <td model="aThirdAttribute" view="Money" />
  </tr>
</table>

The solution that I use now which works okay is to just specify a
custom view on the whole object (for each row) and use that view to
generate the xml, including custom formatting and so on. This means
that I basically reimplement the woven view functionality. 

What I have now is something like this:
<table model="myModel" view="List">
  <tr pattern="listItem" view="myCustomTableRowView"/>
</table>

Where myCustomTableRowView basically loops through a table listing the
required fields and formatting for this kind of object, creates a td
for each of them, formats the data.

My naive take on this would be to be able to specify model and view
attributes on the xml I generate, but when I tried this it wouldn't
work, I guess it is to late in the process to do so. 

If anyone has any ideas on woven idioms/patterns for this type of
application, I would be glad to hear of it.




From Matt.Boersma at arraybiopharma.com  Fri Aug 29 11:27:44 2003
From: Matt.Boersma at arraybiopharma.com (Boersma, Matt)
Date: Fri, 29 Aug 2003 11:27:44 -0600
Subject: [Twisted-Python] New PB API example?
Message-ID: <59213C5E21925E4FB4335B1AF601C2230213AB@fiji.arraybp.com>

Howdy twisters,

I'm writing a Perspective Broker client-server app.  Things have been working fine, but as of recent Twisted builds (1.07 alpha 5?), my server code warns me that code like this:
    app = Application('myserver')
    app.listenTCP(8789, BrokerFactory(MyServer()))
    app.run()
is deprecated.  Specifically, that I should replace BrokerFactory with PBServerFactory.

So I have plunged into catching up with this new API.  And I'm heavily confused.  All the existing HOWTOs and pbxxxx.py examples still use (deprecated) code as above.  And even after searching the mailing list and re-reading the PB tutorials, I'm not getting it.

I'd like my client to use PBClientFactory.login, and for the server to authorize the client by logging in to an Oracle database and running a test query.  (Credentials in this case map directly to Oracle username/passwords--don't flame me, I inherited this system.)  Then the client receives a remotely callable Perspective specific to his or her role in this system.

I'm specifically unclear as to how to use my Authorizer subclass, and if I need to create a Portal subclass and plug it in to PBServerFactory.

If anyone has even a trivial example of how to use the new PB cred APIs, I'd be very grateful if you could share it with me.

This electronic message transmission is a PRIVATE communication which contains
information which may be confidential or privileged. The information is intended 
to be for the use of the individual or entity named above. If you are not the 
intended recipient, please be aware that any disclosure, copying, distribution 
or use of the contents of this information is prohibited. Please notify the
sender  of the delivery error by replying to this message, or notify us by
telephone (877-633-2436, ext. 0), and then delete it from your system.




From itamar at itamarst.org  Fri Aug 29 12:00:04 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 29 Aug 2003 14:00:04 -0400
Subject: [Twisted-Python] New PB API example?
In-Reply-To: <59213C5E21925E4FB4335B1AF601C2230213AB@fiji.arraybp.com>
References: <59213C5E21925E4FB4335B1AF601C2230213AB@fiji.arraybp.com>
Message-ID: <20030829140004.190a2b74.itamar@itamarst.org>

On Fri, 29 Aug 2003 11:27:44 -0600
"Boersma, Matt" <Matt.Boersma at arraybiopharma.com> wrote:

> If anyone has even a trivial example of how to use the new PB cred
> APIs, I'd be very grateful if you could share it with me.

Look at twisted.test.test_pb, the last few classes. You don't use an
Authorizer at all.

-- 
Itamar Shtull-Trauring    http://itamarst.org/
Available for Python & Twisted consulting



From justinjohnson at fastmail.fm  Fri Aug 29 14:41:26 2003
From: justinjohnson at fastmail.fm (Justin Johnson)
Date: Fri, 29 Aug 2003 14:41:26 -0600
Subject: [Twisted-Python] DeferredList failure accumulation
Message-ID: <20030829204126.2EF673A3BB@www.fastmail.fm>

I've been doing a lot with DeferredList's lately and just want to make
sure I'm doing things the "right" way.  There a couple different
situations where I want to report errors in Deferred's that are added to
a DeferredList.

1)  I define a remote_status method on the PB client that initiates the
request.  The PB server calls the remote_status method on the client to
update the status for the particular task and redisplay the grid below,
and if the status if a failure, passes the failure as an argument which
gets added to an overall list of failures that are displayed nicely when
all tasks are complete.

      | 1 | 2 | 3 | 4 | status
----------------------------------
job1  | S | S | S | S | success
----------------------------------
job2  | S | F | S | F | failure
----------------------------------

Failures
----------------------------------
Task: job2
Step: step2
Failure: blah blah blah

Task: job2
Step: step4
Failure: blah blah blah

2)  If the DeferredList is used in a general class that represents some
data type worked on by the PB server, have each Deferred have an errback
that adds its errors into a list of errors.  Then add a callback to the
entire DeferredList that checks to see if there are any accumulated
failures.  If it finds failures, it errback's with a list of the failure
objects represented as strings so we don't have to deal with
InsecureJelly problems.

Does this sound like an alright way to do this?  Anyone have any
suggestions at improving this?

Thanks.
-Justin



From Matt.Boersma at arraybiopharma.com  Fri Aug 29 16:02:38 2003
From: Matt.Boersma at arraybiopharma.com (Boersma, Matt)
Date: Fri, 29 Aug 2003 16:02:38 -0600
Subject: [Twisted-Python] Plain text password with PB authentication?
Message-ID: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>

First, thanks to Itamar for nudging me in the right direction.  I never thought of looking at the unit tests for documentation, but so far that's the clearest explanation of the new PBServerFactory stuff I've seen.

Here's my problem.  I have a PB client that calls login against the server, with a UsernamePassword object as credentials.  PB sets up for me nice default implementations of the authentication mechanisms, but refuses to send the actual password to the server, only a doubly MD5-hashed version of same.

No!  Stop your flames!  Trading only hashes across the wire makes perfect sense--in most cases.  I fully understand, and I've written nearly identical Java code recently to do the same.

But...in this case I want simply to delegate the actual authentication on the server side to an Oracle login.  That is, if I can get a SQLConnectionPool with the given username and password and execute a test query, then the user is considered authenticated.  This requires that the server have the actual password, not its hash.  (Oracle doesn't appear to support anything besides clear text login, at least through the cx_Oracle and DCOracle2 APIs.)

So my options are:
- Create subclasses of PBClientFactory, CredentialsChecker, perhaps others, purely to undo the strict md5-hashing behavior of PB instead supply the clear text password.
- Leave the existing authentication as-is and create a dummy CredentialsChecker that always allows login.  Then do the "real" authentication in a secondary method the client is required to call.

Which of these two ugly approaches is more Twisted?

This electronic message transmission is a PRIVATE communication which contains
information which may be confidential or privileged. The information is intended 
to be for the use of the individual or entity named above. If you are not the 
intended recipient, please be aware that any disclosure, copying, distribution 
or use of the contents of this information is prohibited. Please notify the
sender  of the delivery error by replying to this message, or notify us by
telephone (877-633-2436, ext. 0), and then delete it from your system.




From exarkun at intarweb.us  Fri Aug 29 21:47:17 2003
From: exarkun at intarweb.us (Jp Calderone)
Date: Fri, 29 Aug 2003 23:47:17 -0400
Subject: [Twisted-Python] Plain text password with PB authentication?
In-Reply-To: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>
References: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>
Message-ID: <20030830034717.GA3400@intarweb.us>

On Fri, Aug 29, 2003 at 04:02:38PM -0600, Boersma, Matt wrote:
> First, thanks to Itamar for nudging me in the right direction.  I never
> thought of looking at the unit tests for documentation, but so far that's
> the clearest explanation of the new PBServerFactory stuff I've seen.
> 
> Here's my problem.  I have a PB client that calls login against the
> server, with a UsernamePassword object as credentials.  PB sets up for me
> nice default implementations of the authentication mechanisms, but refuses
> to send the actual password to the server, only a doubly MD5-hashed
> version of same.
> 
> No!  Stop your flames!  Trading only hashes across the wire makes perfect
> sense--in most cases.  I fully understand, and I've written nearly
> identical Java code recently to do the same.

  No need to flame.  Authenticating against plaintext passwords is fine --
as long as your transport is secure.

  Make sure your server uses listenSSL() and your client uses connectSSL().

> 
> But...in this case I want simply to delegate the actual authentication on
> the server side to an Oracle login.  That is, if I can get a
> SQLConnectionPool with the given username and password and execute a test
> query, then the user is considered authenticated.  This requires that the
> server have the actual password, not its hash.  (Oracle doesn't appear to
> support anything besides clear text login, at least through the cx_Oracle
> and DCOracle2 APIs.)
> 

  Disappointed.  Maybe some of the enterprise fell out of the box during
shipping.

> So my options are:
> - Create subclasses of PBClientFactory, CredentialsChecker, perhaps
>   others, purely to undo the strict md5-hashing behavior of PB instead
>   supply the clear text password.

  You only need to subclass PBClientFactory and PBServerFactory, nothing
else.

  Override PBServerFactory.buildProtocol() and set a different root object,
one that implements remote_login() that takes both the plaintext username
and password as arguments and returns the avatar right away (or a deferred
that is called back with the avatar eventually).

  Then override PBClientFactory.login() to send both the username and
password to the server's login() method.


> - Leave the existing authentication as-is and create a dummy
>   CredentialsChecker that always allows login.  Then do the "real"
>   authentication in a secondary method the client is required to call.

  Don't do this.

> 
> Which of these two ugly approaches is more Twisted?
> 

  The former approach isn't ugly at all.  The latter is pretty hackish.

  Once again, for emphasis: don't do this unless your transport is secure.

  Jp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030829/b96f8ba4/attachment.sig>

From itamar at itamarst.org  Sat Aug 30 01:22:04 2003
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sat, 30 Aug 2003 03:22:04 -0400
Subject: [Twisted-Python] Plain text password with PB authentication?
In-Reply-To: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>
References: <59213C5E21925E4FB4335B1AF601C2230213AD@fiji.arraybp.com>
Message-ID: <20030830032204.3dcabd45.itamar@itamarst.org>

On Fri, 29 Aug 2003 16:02:38 -0600
"Boersma, Matt" <Matt.Boersma at arraybiopharma.com> wrote:

> Here's my problem.  I have a PB client that calls login against the
> server, with a UsernamePassword object as credentials.  PB sets up for
> me nice default implementations of the authentication mechanisms, but
> refuses to send the actual password to the server, only a doubly
> MD5-hashed version of same.

Pluggable credential types for PB logins, which will eventually be
supported, would allow this. Until then do what Jean-Paul said, make
your own custom login method.



From jjanecek at telusplanet.net  Sat Aug 30 04:34:58 2003
From: jjanecek at telusplanet.net (John Janecek)
Date: Sat, 30 Aug 2003 04:34:58 -0600
Subject: [Twisted-Python] Twisted sure is Twisted :)
In-Reply-To: <20030829113955.4009.30646.Mailman@pyramid.twistedmatrix.co
 m>
Message-ID: <5.1.0.14.2.20030830040248.00b59830@pop.telusplanet.net>

Twisted once u get a grip on it sure is pretty impressive.
I used twisted to forward UDP packets as a relay. Take one
UDP packet and then retrans it to many other clients. On
a FreeBSD box P3 750 the delay in retrans on packet to
like 5 clients was less then 1ms which was very impressive.

In using twisted i know the reactor is broken in wxpython.

What would happen if u ran a normal reactor in a seperate thread,
and then passed the info from twisted into wxpython using an event
handler similar to the wxpython thread demo ??

The only problem with that is i can not see how u would pass info
from wxpython back into twisted. Hmmmm maybe if u made a queue,
and then passed the commands onto a queue and then the reactor would
pull them off. Something to ponder :). Solution on ActiveState cookbook
will work, but i do not like timers.

The idea behind deferred is intresting. The defered call back does not seem
to fire until it is added. How the heck does that work ? I am refering to the
database example. Hmmmm not really important but kinda neat.

def getAge(user):
     return dbpool.runQuery("SELECT age FROM users WHERE name = ?", user)

def printResult(l):
     if l:
         print l[0][0], "years old"
     else:
         print "No such user"

d=getAge("joe")
d.addCallback(printResult)

like here d is the function getAge. My gut instict tell me the moment I 
call getAge
the database query should be run. But yet it is not run till u add the 
callback.
and if i add an errorback after it, it is not run till it has been added 
also, I can
not see how it works :)). Hmmmm must be part of the magic :))

Starting to look into woven. Basic examples are impressive. It is a real
object oriented web design. In the sandbox on CVS in the directory glyph
there is an example on forms. I am unable to get it to work. It runs but 
eveytime
I try and make it work I get in my browser the error no such child 
resource. I guess
I have to keep pluggin away at it :). My limited experience shows i need to 
change
my thinking, since twisted is not a "API" system like PHP, but more of a 
framework.
Maybe it would help if i drank a bottle of vodka first :)

I guess the only complaint i have about twisted is lack of woven examples, 
like for
forms and guard. But heya it is opensource and free, so if i do not like it 
I can
use some crappy comercial product :)).

Anyways Twisted is really cool. A lot of it seems to be very magical :). 
Pondering whether
I should get rid of my apache server and run a twisted one :)).

Anyway this is the crap i ramble off at 4 am :)
Just basically wanted to say twisted is cool.





From andrew-twisted at puzzling.org  Sat Aug 30 19:53:35 2003
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Sun, 31 Aug 2003 11:53:35 +1000
Subject: [Twisted-Python] Twisted sure is Twisted :)
In-Reply-To: <5.1.0.14.2.20030830040248.00b59830@pop.telusplanet.net>
References: <20030829113955.4009.30646.Mailman@pyramid.twistedmatrix.com> <5.1.0.14.2.20030830040248.00b59830@pop.telusplanet.net>
Message-ID: <20030831015335.GA2722@frobozz>

On Sat, Aug 30, 2003 at 04:34:58AM -0600, John Janecek wrote:
> Twisted once u get a grip on it sure is pretty impressive.
> I used twisted to forward UDP packets as a relay. Take one
> UDP packet and then retrans it to many other clients. On
> a FreeBSD box P3 750 the delay in retrans on packet to
> like 5 clients was less then 1ms which was very impressive.
> 
> In using twisted i know the reactor is broken in wxpython.
> 
> What would happen if u ran a normal reactor in a seperate thread,
> and then passed the info from twisted into wxpython using an event
> handler similar to the wxpython thread demo ??

You could use reactor.callInThread(myWxMainLoop), I guess -- but last time I
looked at wxpython, it *had* to be run in the main thread, so this might get
slightly messy (I'm pretty sure the Twisted reactor doesn't mind being run
in a non-main thread, so this shouldn't be insurmountable).  Of course, it's
been quite a while since I've used wxpython, so this might not be an issue
anymore.

> The only problem with that is i can not see how u would pass info
> from wxpython back into twisted. Hmmmm maybe if u made a queue,

Just use reactor.callFromThread -- a thread can call this to safely schedule a
function to be run in the main event loop.  See
http://twistedmatrix.com/documents/howto/threading.  

> The idea behind deferred is intresting. The defered call back does not
> seem to fire until it is added. How the heck does that work ? I am
> refering to the database example. Hmmmm not really important but kinda
> neat.

Deferred callbacks obviously can't fire until they're added to the deferred,
but of course they might not fire immediately upon addCallback, though --
because the deferred might not have been called yet.

> def getAge(user):
>     return dbpool.runQuery("SELECT age FROM users WHERE name = ?", user)
> 
> def printResult(l):
>     if l:
>         print l[0][0], "years old"
>     else:
>         print "No such user"
> 
> d=getAge("joe")
> d.addCallback(printResult)
> 
> like here d is the function getAge. My gut instict tell me the moment I

No, here 'd' is a deferred result from the function 'getAge'.  A deferred is
simply an object that represents a result that probably hasn't arrived yet.

> call getAge the database query should be run. But yet it is not run till u
> add the callback.  and if i add an errorback after it, it is not run till
> it has been added also, I can not see how it works :)). Hmmmm must be part
> of the magic :))

So, in this case, dbpool.runQuery ducks off and runs the database query in a
thread behind the scenes, and returns immediately without waiting for the
result to arrive -- because databases can take an arbitrarily long time to
return a result.  In the meantime, the code that called runQuery can add
callbacks and errbacks to the deferred result from runQuery, and the
deferred will see to it that those are run when the result does arrive (if
the result has already arrived by the time you add a callback, it will be
run immediately).

The running of the callback is completely independent to the running of the
query.  If you never add any callbacks or errbacks and just discard the
deferred from dbpool.runQuery immediately, the query is still run on the
database -- it's just that when the twisted.enterprise.adbapi code gets the
result back from the database, it will fire the deferred (using
Deferred.callback or Deferred.errback), and the deferred will find it has no
callbacks to trigger, which is fine.

If you haven't already, read http://twistedmatrix.com/documents/howto/defer.

[...]
> Anyway this is the crap i ramble off at 4 am :)
> Just basically wanted to say twisted is cool.

Thanks!  :)

-Andrew.




From ecn at metaslash.com  Sun Aug 31 14:48:47 2003
From: ecn at metaslash.com (Eric C. Newton)
Date: Sun, 31 Aug 2003 16:48:47 -0400
Subject: [Twisted-Python] error in pollreactor.py
Message-ID: <20030831204847.GA8139@localhost.localdomain>

Method _dictRemove of pollreactor.py:

    def _dictRemove(self, selectable, mdict):
        try:
            # the easy way
            fd = reader.fileno()
        except:
            # the hard way: necessary because fileno() may disappear at any
            # moment, thanks to python's underlying sockets impl
            for fd, fdes in selectables.items():
                if selectable is fdes:
                    break
            else:
                # Hmm, maybe not the right course of action?  This method can't
                # fail, because it happens inside error detection...
                return
        if mdict.has_key(fd):
            del mdict[fd]
            self._updateRegistration(fd)

First, "reader.fileno()" is just not going to work because there is no
variable "reader" in the scope.  This error is hidden by the
all-encompassing except clause.  Second, this comment about fileno()
disappearing... I don't believe it.  Does anyone know if this is
really true?

Code works (in my limited tests) if changed to:

    def _dictRemove(self, selectable, mdict):
        fd = selectable.fileno()
        if mdict.has_key(fd):
            del mdict[fd]
            self._updateRegistration(fd)

-Eric



From exarkun at intarweb.us  Sun Aug 31 15:16:28 2003
From: exarkun at intarweb.us (Jp Calderone)
Date: Sun, 31 Aug 2003 17:16:28 -0400
Subject: [Twisted-Python] error in pollreactor.py
In-Reply-To: <20030831204847.GA8139@localhost.localdomain>
References: <20030831204847.GA8139@localhost.localdomain>
Message-ID: <20030831211628.GA15991@intarweb.us>

On Sun, Aug 31, 2003 at 04:48:47PM -0400, Eric C. Newton wrote:
> Method _dictRemove of pollreactor.py:
> 
>     def _dictRemove(self, selectable, mdict):
>         try:
>             # the easy way
>             fd = reader.fileno()
>         except:
>             # the hard way: necessary because fileno() may disappear at any
>             # moment, thanks to python's underlying sockets impl
>             for fd, fdes in selectables.items():
>                 if selectable is fdes:
>                     break
>             else:
>                 # Hmm, maybe not the right course of action?  This method can't
>                 # fail, because it happens inside error detection...
>                 return
>         if mdict.has_key(fd):
>             del mdict[fd]
>             self._updateRegistration(fd)
> 
> First, "reader.fileno()" is just not going to work because there is no
> variable "reader" in the scope.  This error is hidden by the
> all-encompassing except clause.  Second, this comment about fileno()
> disappearing... I don't believe it.  Does anyone know if this is
> really true?

  What the comment really means, I believe, is that fileno() may return -1
at any time, without warning.  -1 will never be in the dict, so a lookup for
what the file descriptor used to be must be done.

> 
> Code works (in my limited tests) if changed to:
> 
>     def _dictRemove(self, selectable, mdict):
>         fd = selectable.fileno()
>         if mdict.has_key(fd):
>             del mdict[fd]
>             self._updateRegistration(fd)
> 

  I think you're on the right track, but would use this instead:

    def _dictRemove(self, selectable, mdict):
        fd = selectable.fileno()
        if fd == -1:
            for fd, fdes in selectables.iteritems():
                if fdes is selectable:
                    break
            else:
                # This should probably be reported.  It should
                # never happen.
                return
        try:
            del mdict[fd]
        except KeyError:
            pass
        else:
            self._updateRegistration(fd)

  Jp

-- 
http://catandgirl.com/view.cgi?44
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20030831/ebfbde78/attachment.sig>

From jjanecek at telusplanet.net  Sun Aug 31 21:27:39 2003
From: jjanecek at telusplanet.net (John Janecek)
Date: Sun, 31 Aug 2003 21:27:39 -0600
Subject: [Twisted-Python] Form Processor hmmmm looks cool what does it do :)
In-Reply-To: <20030831114047.12805.97073.Mailman@pyramid.twistedmatrix.c
 om>
Message-ID: <5.1.0.14.2.20030831211027.00bbb788@pop.telusplanet.net>

Thanx to the dude who answered my last post :)
When i get some time i have to try and put into practive wxpython suggestions

I took the form processor example from the sandbox and made it do something.
What it is doing i am not quite sure :)

#form_input.py
#simple proggie to test how to handle forms
#hacked together from myformstuf which is in the glyph directory in the sandbox
#not really sure if this is done right

from twisted.web.woven import page
#this module is required for the method def wmfactory_form(self, request): 
to work
from twisted.web.woven.form import FormProcessor
from twisted.python import formmethod as fm

class FormPage(page.Page) :

     template = '''
     <html>
     <head><title>a form page</title>
     </head>
     <body>
     <form action="post" model="form" />
     </body>
     </html>
     '''

     formSignature = fm.MethodSignature(
             fm.String("username","","User Name : ","Enter a user name"),
             fm.Password("password","","Password : ","Enter a password")
             )

     def proc(self,**kw) :
         print "proc : ",kw

     def wmfactory_form(self, request):
         print "factory form"
         return self.formSignature.method(self.proc)

     def wchild_post(self,request) :
         print "child post ",request.args
         return FormProcessor(self.formSignature.method(self.proc))



#the test throttle code
def main() :
     print "Main Loop"
     from twisted.web.server import Site
     from twisted.internet import reactor

     reactor.listenTCP(9999,Site(FormPage()))
     reactor.run()

main()

self.proc is a required arguement.
It returns a dictionary with all the form variables in it when form is posted.
I am not really sure what am i supposed to do in this function. Like in 
this instance
would this be where i could stick variables into a data base ?

The method FormProcessor(self.formSignature.method(self.proc)) appears from 
the code
to be able to take a second arguement where i can add my own view. If no 
view is added
it uses the view that is provided by default. It would be kinda nice to 
have my own view,
how would my own view be able to access the variables that are posted from 
the form.

FormProcessor also appears to be able to take a 3rd arguement that is some 
sort of error view,
what type of errors would happen, and how will they be triggered.

FormProcessor looks like the smart way to handle forms. Unfortunately I 
seem to be missing a few pieces.

Well i will keep on plugging away at it :)
Hmmmm well anyways i am kinda lost i will think about being lost some more :))


Thanx

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20030831/00bcce84/attachment.html>

