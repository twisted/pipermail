<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Unable%20to%20start%20twistd%20service%20on%20Ubuntu%2010.04%0A%09when%20using%20pseudo%20terminal&In-Reply-To=%3CAANLkTinAooUorJq7rw0riHnptDAN%3DB1%2B0mXmiz4%3Dwi3C%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055420.html">
   <LINK REL="Next"  HREF="055432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal</H1>
    <B>Garret Heaton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Unable%20to%20start%20twistd%20service%20on%20Ubuntu%2010.04%0A%09when%20using%20pseudo%20terminal&In-Reply-To=%3CAANLkTinAooUorJq7rw0riHnptDAN%3DB1%2B0mXmiz4%3Dwi3C%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal">powdahound at gmail.com
       </A><BR>
    <I>Mon Sep 27 21:15:15 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055420.html">[Twisted-Python] Handling too many open file descriptors
</A></li>
        <LI>Next message (by thread): <A HREF="055432.html">[Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55421">[ date ]</a>
              <a href="thread.html#55421">[ thread ]</a>
              <a href="subject.html#55421">[ subject ]</a>
              <a href="author.html#55421">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To me this seems like a very strange problem and I've tried to debug it best
I can but I don't know much about many of the components at work. Here's
what happened:

I've been happily using Capistrano to deploy many twistd services to Ubuntu
9.04 machines. It restarts them via an init.d script based off this
template: <A HREF="http://twistedmatrix.com/trac/attachment/ticket/3434/twistdplugin.">http://twistedmatrix.com/trac/attachment/ticket/3434/twistdplugin.</A>
I'm running a self-installed Twisted 8.2.0 on both systems with some small
tweaks to logging.

On newer Ubuntu 10.04 machines I've been deploying to the twistd services
don't restart properly. There are no errors in the log. The only log lines
I'd get were:
[-] Log opened.
[-] twistd 8.2.0 (/usr/bin/python 2.6.5) starting up.
[-] reactor class: twisted.internet.epollreactor.EPollReactor.

But they were only failing to restart when run via Capistrano. I realized
that the only difference was that Capistrano was using a pseudo terminal
when it issued its commands. To recreate the problem without Capistrano I
can run:
&gt;<i> ssh -t <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">user at host</A> &quot;/etc/init.d/service start&quot;
</I>
But it works fine when I run:
&gt;<i> ssh <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">user at host</A> &quot;/etc/init.d/service start&quot;
</I>
The 3 log lines I see in the failed case are written by twistd before it
forks (clone() syscall) to create the daemon process. The strace dump of
twistd when run with and without pseudo terminal were identical. I tried
running strace with the -f option to get some info about the child process
but it didn't fail in that case since I guess it doesn't actually fork.
Running in a pseudo terminal with --nodaemon passed to twistd also works
fine.

I've tested this with multiple twistd services and am having the same issue
with all of them.

Any ideas? Did I completely misdiagnose the problem? Has there been some
change in this area between Twisted 8.2.0 and 10.x? I'm certainly confused.
:<i>)
</I>
- Garret
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20100927/9e6867ef/attachment-0001.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055420.html">[Twisted-Python] Handling too many open file descriptors
</A></li>
	<LI>Next message (by thread): <A HREF="055432.html">[Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55421">[ date ]</a>
              <a href="thread.html#55421">[ thread ]</a>
              <a href="subject.html#55421">[ subject ]</a>
              <a href="author.html#55421">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
