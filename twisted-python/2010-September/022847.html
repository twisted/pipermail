<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted cred: why does avatarId need to be a	str?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20cred%3A%20why%20does%20avatarId%20need%20to%20be%20a%0A%09str%3F&In-Reply-To=8217BC64-88A8-4839-A611-244C25316A14%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022837.html">
   <LINK REL="Next"  HREF="022851.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted cred: why does avatarId need to be a	str?</H1>
    <B>Laurens Van Houtven</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20cred%3A%20why%20does%20avatarId%20need%20to%20be%20a%0A%09str%3F&In-Reply-To=8217BC64-88A8-4839-A611-244C25316A14%40twistedmatrix.com"
       TITLE="[Twisted-Python] twisted cred: why does avatarId need to be a	str?">lvh at laurensvh.be
       </A><BR>
    <I>Fri Sep 10 13:01:41 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022837.html">[Twisted-Python] twisted cred: why does avatarId need to be a	str?
</A></li>
        <LI>Next message: <A HREF="022851.html">[Twisted-Python] twisted cred: why does avatarId need to be a	str?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22847">[ date ]</a>
              <a href="thread.html#22847">[ thread ]</a>
              <a href="subject.html#22847">[ subject ]</a>
              <a href="author.html#22847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'll give a very practical example of an example request + response, because
I'm not entirely sure I communicated that properly. The code we're
discussing is part of a TokenEndpoint, which is an IResource. Something (a
client, in OAuth terminology) makes a request that looks like this:

---
POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=password&amp;client_id=s6BhdRkqt3&amp;client_secret=47HDu8s&amp;username=johndoe&amp;password=A3ddj3w
---

And hopefully the code we're discussing answers with a request that looks
like this:

---
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store

{
&quot;access_token&quot;:&quot;SlAV32hkKG&quot;,
&quot;expires_in&quot;:3600,
 &quot;refresh_token&quot;:&quot;8xLOxBtZp8&quot;
&quot;scope&quot;: &quot;tummies cookies parrots&quot;
}
---

Where, as mentioned before, everything besides &quot;access_token&quot; is not always
required (but it must be possible to set them, because occasionally they are
required).

On Fri, Sep 10, 2010 at 2:34 AM, Glyph Lefkowitz &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;wrote:

&gt;<i> for any given cred implementation, there are two key questions:
</I>&gt;<i>
</I>&gt;<i>    1. What is the avatar interface?
</I>&gt;<i>    2. What is the associated mind interface?
</I>&gt;<i>
</I>&gt;<i> If we're not talking about a system where the avatar interface (the one
</I>&gt;<i> passed to 'login', the one that the realm must return something that gets
</I>&gt;<i> implemented) is IResource, then that's the problem.  What *is* that
</I>&gt;<i> interface that you're talking about?  Be very specific: what methods does it
</I>&gt;<i> have and why?
</I>&gt;<i>
</I>
Okay, to be specific: I believe the appropriate interface is IResource. This
is in line with t.web's general way of interacting with cred: you give me
credentials, I give you a protected IResource.


&gt;<i> It sounds like OAuth is very precisely implementing something that maps
</I>&gt;<i> almost exactly onto the *checker* part of cred, but you're doing it by
</I>&gt;<i> implementing a realm to allow applications to provide their own logic.  This
</I>&gt;<i> might not be the wrong idea, but it needs to be spelled out very clearly.
</I>&gt;<i>
</I>
Doing everything in the checker probably might make more sense. The reason I
originally thought to do this in the IRealm is that I figured credentials
checkers should just check credentials, and creating a new credential (the
access token) wasn't part of ICredentialsChecker's job (more like IRealm's
job). Apparently I was mistaken.


&gt;<i> As you describe it:
</I>&gt;<i>
</I>&gt;<i> token endpoints let you trade in some credentials that prove you're
</I>&gt;<i> supposed to have access for a token that actually *gives* you that access
</I>&gt;<i>
</I>&gt;<i> In cred-ese, that would be &quot;checkers let you trade in some credentials that
</I>&gt;<i> prove you're supposed to have access for an &lt;avatar ID, which you give to a
</I>&gt;<i> Realm&gt; that actually *gives* you that access&quot;.  As far as the OAuth response
</I>&gt;<i> is concerned, it's like a checker.  Looking at the individual parts,
</I>&gt;<i> assuming that the avatar interface for the purposes of this discussion is
</I>&gt;<i> IResource, it breaks down like this in my mind:
</I>&gt;<i>
</I>&gt;<i>     - the access token (an ascii string, mandatory)
</I>&gt;<i>
</I>&gt;<i> Avatar ID.  (See, it's a str!)
</I>&gt;<i>
</I>
Heh, okay; as long as there's a plausible way to get the other important
information (see rest of email) into the HTTP response, I'll believe you.

&gt;<i>     - the expiration time (optional)
</I>&gt;<i>
</I>&gt;<i> Implementation detail of the session.  Avatars are actually sessions, which
</I>&gt;<i> expire: sometimes (as with POP) at the end of a connection, sometimes (as
</I>&gt;<i> with nevow.guard's HTTP support) with a session timeout.
</I>&gt;<i>
</I>
Right, but:
a) The avatar needs to know about this timeout, since the timeout
information needs to be able to make it into the HTTP response.
b) The expiration time is only known to the thing that creates the access
token (obviously). From the previous discussion, this is apparently
ICredentialsChecker.

c) (From (a, b)) The ICredentialsChecker needs to be able to communicate the
expiration to the avatar.
d) The ICredentialsChecker and IRealm can only communicate through the
avatarId.

Conclusion (from c,d): The expiration time needs to be in the avatarId?

&gt;<i>     - the refresh token (another ascii string, similar to the access token,
</I>&gt;<i> optional)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Implementation detail of the authentication protocol.  The client library
</I>&gt;<i> and server library should be transparently refreshing this without telling
</I>&gt;<i> either the client application code or server application code, right?
</I>&gt;<i>
</I>
Sure, but we're still writing library code here.

If the avatar interface isn't actually IResource, but a new interface
IAccessToken, getting the refresh token later might be feasible. (It should
be a different interface, because in order to create a refresh token outside
of this entire cred cycle, I need to know about the thing it's refreshing --
so, the information in the response needs to be easily accessible and not
just an opaque IResource).

I agree entirely that clever client library code would abstract this mess
away from application code. However, right now this code still needs to
somehow be able to eventually produce HTTP responses that don't abstract
anything yet and just contain all the appropriate data, because that's just
what the OAuth spec says it needs to be able to do. There isn't any real
application code in the token endpoint; they're pretty similar for all OAuth
setups, and customization would typically happen through implementing the
appropriate ICredentialsChecker.

    - scope (an ascii string consisting of a set of space-separated words,
&gt;<i> optional)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This part doesn't quite fit, but could be expressed in one of two ways: a
</I>&gt;<i> modification to the avatar ID, or as some extra structure on the Mind that
</I>&gt;<i> modifies what functionality the Realm bundles in to your avatar
</I>&gt;<i> implementation (without changing the interface provided by that object, of
</I>&gt;<i> course).
</I>&gt;<i>
</I>
Unfortunately I don't believe this can be done through the mind. Again
working under the previous assumption that ICredentialsChecker and not the
IRealm is responsible for creating the access token, and scope is known to
the thing that makes the access token, the ICredentialsChecker knows about
the scope. Unfortunately the only way to pass stuff  between the
ICredentialsChecker and the IRealm is the avatar ID, so you don't have a
choice.


thanks for your infinite patience,
Laurens
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/76080471/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/76080471/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022837.html">[Twisted-Python] twisted cred: why does avatarId need to be a	str?
</A></li>
	<LI>Next message: <A HREF="022851.html">[Twisted-Python] twisted cred: why does avatarId need to be a	str?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22847">[ date ]</a>
              <a href="thread.html#22847">[ thread ]</a>
              <a href="subject.html#22847">[ subject ]</a>
              <a href="author.html#22847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
