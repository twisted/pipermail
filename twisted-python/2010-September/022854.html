<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Strange error: SQL-Server tries to rollback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20error%3A%20SQL-Server%20tries%20to%20rollback&In-Reply-To=AANLkTikT8jRpBNBUdEGPJGDOZmMp-_d6dNZKXvp-6S2J%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022850.html">
   <LINK REL="Next"  HREF="022840.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Strange error: SQL-Server tries to rollback</H1>
    <B>Tim Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20error%3A%20SQL-Server%20tries%20to%20rollback&In-Reply-To=AANLkTikT8jRpBNBUdEGPJGDOZmMp-_d6dNZKXvp-6S2J%40mail.gmail.com"
       TITLE="[Twisted-Python] Strange error: SQL-Server tries to rollback">screwtape at froup.com
       </A><BR>
    <I>Fri Sep 10 21:21:14 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022850.html">[Twisted-Python] Strange error: SQL-Server tries to rollback
</A></li>
        <LI>Next message: <A HREF="022840.html">[Twisted-Python] conchoctopus: APIs for working with multiple SSH	servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22854">[ date ]</a>
              <a href="thread.html#22854">[ thread ]</a>
              <a href="subject.html#22854">[ subject ]</a>
              <a href="author.html#22854">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Sep 10, 2010 at 06:54:34PM +0300, Pantelis Theodosiou wrote:
&gt;<i>         sql = ''.join(
</I>&gt;<i>             [
</I>&gt;<i>              &quot;INSERT INTO fts_data VALUES (&quot;
</I>&gt;<i>                     ,  &quot;'&quot; , serialNumber , &quot;'&quot;
</I>&gt;<i>             , &quot;,&quot; , &quot;'&quot; , customerAccount , &quot;'&quot;
</I>&gt;<i>             , &quot;,&quot; , &quot;'&quot; , dateAndTime , &quot;'&quot;
</I>&gt;<i>             , &quot;,&quot; , camcount
</I>&gt;<i>             , &quot;,&quot; , fpv
</I>&gt;<i>             , &quot;,&quot; , &quot;'&quot; , reff , &quot;'&quot;
</I>&gt;<i>             , &quot;,&quot; , &quot;'&quot; , restOfFrame , &quot;'&quot;
</I>&gt;<i>             , &quot;) &quot;
</I>&gt;<i>             ] )
</I>
This is unrelated to your Twisted problem, but *please* tell me you are
not building SQL like this in production code.

If you need a reminder, the best possible way to do this in Python[1]
is:

    sqlPattern = &quot;&quot;&quot;
	INSERT INTO fts_data VALUES (
	    %s, %s, %s, %s, %s, %s, %s
	);
	&quot;&quot;&quot;

    # if you're using a DB-API module directly:
    cursor.execute(sqlPattern, [serialNumber, customerAccount,
	    dateAndTime, camcount, fpv, reff, restOfFrame])

    # if you're using ADBAPI:
    deferred = pool.runOperation(sqlPattern, [serialNumber,
	    customerAccount, dateAndTime, camcount, fpv, reff,
	    restOfFrame])

Note that there's no &quot;%&quot; formatting operator between sqlPattern and the
list of values to be substituted in; the substitution is done with all
the proper quoting and escaping, not with Python's na&#239;ve formatting
operator.

Apologies if you already knew this, but apart from correctness it's one
of the few security issues where doing things the safe way is actually
easier than doing it the unsafe way - for a start, the SQL is all
together in one string. :)

[1]: The examples here use what DB-API calls the &quot;format&quot; quoting
style. Not all DB-API modules use it, but pymssql and psycopg2 do.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022850.html">[Twisted-Python] Strange error: SQL-Server tries to rollback
</A></li>
	<LI>Next message: <A HREF="022840.html">[Twisted-Python] conchoctopus: APIs for working with multiple SSH	servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22854">[ date ]</a>
              <a href="thread.html#22854">[ thread ]</a>
              <a href="subject.html#22854">[ subject ]</a>
              <a href="author.html#22854">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
