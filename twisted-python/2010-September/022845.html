<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Strange error: SQL-Server tries to rollback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20error%3A%20SQL-Server%20tries%20to%20rollback&In-Reply-To=AANLkTikT8jRpBNBUdEGPJGDOZmMp-_d6dNZKXvp-6S2J%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022844.html">
   <LINK REL="Next"  HREF="022850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Strange error: SQL-Server tries to rollback</H1>
    <B>Paul Goins</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20error%3A%20SQL-Server%20tries%20to%20rollback&In-Reply-To=AANLkTikT8jRpBNBUdEGPJGDOZmMp-_d6dNZKXvp-6S2J%40mail.gmail.com"
       TITLE="[Twisted-Python] Strange error: SQL-Server tries to rollback">general at vultaire.net
       </A><BR>
    <I>Fri Sep 10 12:39:13 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022844.html">[Twisted-Python] Strange error: SQL-Server tries to rollback
</A></li>
        <LI>Next message: <A HREF="022850.html">[Twisted-Python] Strange error: SQL-Server tries to rollback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22845">[ date ]</a>
              <a href="thread.html#22845">[ thread ]</a>
              <a href="subject.html#22845">[ subject ]</a>
              <a href="author.html#22845">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the code example.

I can't offer to take this work over, but maybe I can make a comment. 
There's one part that stands out to me.

&gt;<i>          try:
</I>&gt;<i>              deferred = self.dbpool.runOperation(sql)
</I>&gt;<i>              #print(&quot;DATA sent&quot;)
</I>&gt;<i>          except Exception as e:
</I>&gt;<i>              print(&quot;error in insertDATA&quot;)
</I>&gt;<i>              print(e)
</I>&gt;<i>              return
</I>&gt;<i>          return deferred
</I>
It seems like maybe you have a misunderstanding about how Deferreds 
generally work in Twisted.  (Been there myself.)  Basically, the above 
try/except block won't work to catch errors from most Deferreds... well, 
at least not without some extra magic.

You really should read the Deferred section of the Twisted documentation 
to understand how errors are handled.

Docs are here: 
<A HREF="http://twistedmatrix.com/documents/current/core/howto/defer.html">http://twistedmatrix.com/documents/current/core/howto/defer.html</A>

----

Basically, to &quot;fix&quot; the above code's error catching, you have two choices:

1. You can add an errback to the deferred.  This is the &quot;standard&quot; 
Twisted way, and would replace the try/except block entirely.

2. You can use the @inlineCallbacks decorator (from 
twisted.internet.defer), and yield on the Deferred.  This is easier, and 
it allows try/except blocks, but there's some gotchas.

inlineCallbacks is what I used when I was learning Twisted, and you may 
want to try that for now.  But please understand that it hides details 
about how Deferreds and callbacks really work.  When you find time, read 
the Deferred docs.

----

Best of luck,

- Paul Goins

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022844.html">[Twisted-Python] Strange error: SQL-Server tries to rollback
</A></li>
	<LI>Next message: <A HREF="022850.html">[Twisted-Python] Strange error: SQL-Server tries to rollback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22845">[ date ]</a>
              <a href="thread.html#22845">[ thread ]</a>
              <a href="subject.html#22845">[ subject ]</a>
              <a href="author.html#22845">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
