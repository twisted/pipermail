<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Unable%20to%20start%20twistd%20service%20on%20Ubuntu%2010.04%0A%09when%20using%20pseudo%20terminal&In-Reply-To=AANLkTinAooUorJq7rw0riHnptDAN%3DB1%2B0mXmiz4%3Dwi3C%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022929.html">
   <LINK REL="Next"  HREF="022965.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal</H1>
    <B>Garret Heaton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Unable%20to%20start%20twistd%20service%20on%20Ubuntu%2010.04%0A%09when%20using%20pseudo%20terminal&In-Reply-To=AANLkTinAooUorJq7rw0riHnptDAN%3DB1%2B0mXmiz4%3Dwi3C%40mail.gmail.com"
       TITLE="[Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal">powdahound at gmail.com
       </A><BR>
    <I>Wed Sep 29 13:48:30 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022929.html">[Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal
</A></li>
        <LI>Next message: <A HREF="022965.html">[Twisted-Python] Unable to start twistd service on Ubuntu 10.04 when using pseudo terminal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22940">[ date ]</a>
              <a href="thread.html#22940">[ thread ]</a>
              <a href="subject.html#22940">[ subject ]</a>
              <a href="author.html#22940">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've simplified this issue down and am able to reproduce it without
Twisted: <A HREF="http://gist.github.com/603154">http://gist.github.com/603154</A>

Still not sure what the cause is, so if anyone has any ideas I'd love to
hear them. Thanks!

On Mon, Sep 27, 2010 at 8:15 PM, Garret Heaton &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">powdahound at gmail.com</A>&gt; wrote:

&gt;<i> To me this seems like a very strange problem and I've tried to debug it
</I>&gt;<i> best I can but I don't know much about many of the components at work.
</I>&gt;<i> Here's what happened:
</I>&gt;<i>
</I>&gt;<i> I've been happily using Capistrano to deploy many twistd services to Ubuntu
</I>&gt;<i> 9.04 machines. It restarts them via an init.d script based off this
</I>&gt;<i> template:
</I>&gt;<i> <A HREF="http://twistedmatrix.com/trac/attachment/ticket/3434/twistdplugin.">http://twistedmatrix.com/trac/attachment/ticket/3434/twistdplugin.</A> I'm
</I>&gt;<i> running a self-installed Twisted 8.2.0 on both systems with some small
</I>&gt;<i> tweaks to logging.
</I>&gt;<i>
</I>&gt;<i> On newer Ubuntu 10.04 machines I've been deploying to the twistd services
</I>&gt;<i> don't restart properly. There are no errors in the log. The only log lines
</I>&gt;<i> I'd get were:
</I>&gt;<i> [-] Log opened.
</I>&gt;<i> [-] twistd 8.2.0 (/usr/bin/python 2.6.5) starting up.
</I>&gt;<i> [-] reactor class: twisted.internet.epollreactor.EPollReactor.
</I>&gt;<i>
</I>&gt;<i> But they were only failing to restart when run via Capistrano. I realized
</I>&gt;<i> that the only difference was that Capistrano was using a pseudo terminal
</I>&gt;<i> when it issued its commands. To recreate the problem without Capistrano I
</I>&gt;<i> can run:
</I>&gt;<i> &gt; ssh -t <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">user at host</A> &quot;/etc/init.d/service start&quot;
</I>&gt;<i>
</I>&gt;<i> But it works fine when I run:
</I>&gt;<i> &gt; ssh <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">user at host</A> &quot;/etc/init.d/service start&quot;
</I>&gt;<i>
</I>&gt;<i> The 3 log lines I see in the failed case are written by twistd before it
</I>&gt;<i> forks (clone() syscall) to create the daemon process. The strace dump of
</I>&gt;<i> twistd when run with and without pseudo terminal were identical. I tried
</I>&gt;<i> running strace with the -f option to get some info about the child process
</I>&gt;<i> but it didn't fail in that case since I guess it doesn't actually fork.
</I>&gt;<i> Running in a pseudo terminal with --nodaemon passed to twistd also works
</I>&gt;<i> fine.
</I>&gt;<i>
</I>&gt;<i> I've tested this with multiple twistd services and am having the same issue
</I>&gt;<i> with all of them.
</I>&gt;<i>
</I>&gt;<i> Any ideas? Did I completely misdiagnose the problem? Has there been some
</I>&gt;<i> change in this area between Twisted 8.2.0 and 10.x? I'm certainly confused.
</I>&gt;<i> :)
</I>&gt;<i>
</I>&gt;<i> - Garret
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100929/1c52aeca/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100929/1c52aeca/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022929.html">[Twisted-Python] Unable to start twistd service on Ubuntu 10.04	when using pseudo terminal
</A></li>
	<LI>Next message: <A HREF="022965.html">[Twisted-Python] Unable to start twistd service on Ubuntu 10.04 when using pseudo terminal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22940">[ date ]</a>
              <a href="thread.html#22940">[ thread ]</a>
              <a href="subject.html#22940">[ subject ]</a>
              <a href="author.html#22940">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
