<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted-Python Digest, Vol 78, Issue 15
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%0A%09%3D%3Futf-8%3Fq%3FTwisted-Python_Digest%3D2C_Vol_78%3D2C_Iss%3F%3D%20%3D%3Futf-8%3Fq%3Fue_15%3F%3D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022849.html">
   <LINK REL="Next"  HREF="022855.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted-Python Digest, Vol 78, Issue 15</H1>
    <B>lance.barisdale@gmail.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%0A%09%3D%3Futf-8%3Fq%3FTwisted-Python_Digest%3D2C_Vol_78%3D2C_Iss%3F%3D%20%3D%3Futf-8%3Fq%3Fue_15%3F%3D&In-Reply-To="
       TITLE="[Twisted-Python] Twisted-Python Digest, Vol 78, Issue 15">lance.barisdale at gmail.com
       </A><BR>
    <I>Fri Sep 10 17:32:54 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022849.html">[Twisted-Python] reactor for both udp and tcp/ timer issue
</A></li>
        <LI>Next message: <A HREF="022855.html">[Twisted-Python] Announcing Twisted 10.1.0pre2!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22853">[ date ]</a>
              <a href="thread.html#22853">[ thread ]</a>
              <a href="subject.html#22853">[ subject ]</a>
              <a href="author.html#22853">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Sent from my HTC on the Now Network from Sprint!

----- Reply message -----
From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-request at twistedmatrix.com</A>
Date: Fri, Sep 10, 2010 12:09 pm
Subject: Twisted-Python Digest, Vol 78, Issue 15
To: &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;

Send Twisted-Python mailing list submissions to
	<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>

To subscribe or unsubscribe via the World Wide Web, visit
	<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
or, via email, send a message with subject or body 'help' to
	<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-request at twistedmatrix.com</A>

You can reach the person managing the list at
	<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-owner at twistedmatrix.com</A>

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of Twisted-Python digest...&quot;


Today's Topics:

   1. Re: Strange error: SQL-Server tries to rollback (Paul Goins)
   2. reactor for both udp and tcp/ timer issue (belk Dj)
   3. Re: twisted cred: why does avatarId need to be a	str?
      (Laurens Van Houtven)
   4. Re: reactor for both udp and tcp/ timer issue
      (Pantelis Theodosiou)


----------------------------------------------------------------------

Message: 1
Date: Sat, 11 Sep 2010 01:39:13 +0900
From: Paul Goins &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">general at vultaire.net</A>&gt;
Subject: Re: [Twisted-Python] Strange error: SQL-Server tries to
	rollback
To: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Message-ID: &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">4C8A5F31.8020305 at vultaire.net</A>&gt;
Content-Type: text/plain; charset=UTF-8; format=flowed

Thanks for the code example.

I can't offer to take this work over, but maybe I can make a comment. 
There's one part that stands out to me.

&gt;<i>          try:
</I>&gt;<i>              deferred = self.dbpool.runOperation(sql)
</I>&gt;<i>              #print(&quot;DATA sent&quot;)
</I>&gt;<i>          except Exception as e:
</I>&gt;<i>              print(&quot;error in insertDATA&quot;)
</I>&gt;<i>              print(e)
</I>&gt;<i>              return
</I>&gt;<i>          return deferred
</I>
It seems like maybe you have a misunderstanding about how Deferreds 
generally work in Twisted.  (Been there myself.)  Basically, the above 
try/except block won't work to catch errors from most Deferreds... well, 
at least not without some extra magic.

You really should read the Deferred section of the Twisted documentation 
to understand how errors are handled.

Docs are here: 
<A HREF="http://twistedmatrix.com/documents/current/core/howto/defer.html">http://twistedmatrix.com/documents/current/core/howto/defer.html</A>

----

Basically, to &quot;fix&quot; the above code's error catching, you have two choices:

1. You can add an errback to the deferred.  This is the &quot;standard&quot; 
Twisted way, and would replace the try/except block entirely.

2. You can use the @inlineCallbacks decorator (from 
twisted.internet.defer), and yield on the Deferred.  This is easier, and 
it allows try/except blocks, but there's some gotchas.

inlineCallbacks is what I used when I was learning Twisted, and you may 
want to try that for now.  But please understand that it hides details 
about how Deferreds and callbacks really work.  When you find time, read 
the Deferred docs.

----

Best of luck,

- Paul Goins



------------------------------

Message: 2
Date: Fri, 10 Sep 2010 16:55:01 +0000 (GMT)
From: belk Dj &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">d_belkhiter at yahoo.fr</A>&gt;
Subject: [Twisted-Python] reactor for both udp and tcp/ timer issue
To: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Message-ID: &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">228404.72208.qm at web24406.mail.ird.yahoo.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

I need to communicate with servers over tcp and also communicate with other servers over udp.
It seems not possible to launch two reactor objects one for tcp and one for udp.
The code after a reactor.run is not called.
How can this can be solved ?

One more thing that deals with timer.
When i send a message to a server if after some time i don't get an acknowledge i re send the message. 
And that x times.
To do that i use Timer. When i send the message i start the timer if the acknowledge comes before the timeout i cancel the timer.
If i don't receive this acknwledge in time i cancel the timer i re send the previous message and i re start the timer.

In this two cases the program fails with the message the timer is still started.
What is the issue ? 

Regards


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/2b939a7f/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/2b939a7f/attachment-0001.htm</A> 

------------------------------

Message: 3
Date: Fri, 10 Sep 2010 19:01:41 +0200
From: Laurens Van Houtven &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">lvh at laurensvh.be</A>&gt;
Subject: Re: [Twisted-Python] twisted cred: why does avatarId need to
	be a	str?
To: Twisted general discussion &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Message-ID:
	&lt;AANLkTimugXx6Fp588+MPyGc8Ws31S316W8Mbg=<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">i9dQ-3 at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

I'll give a very practical example of an example request + response, because
I'm not entirely sure I communicated that properly. The code we're
discussing is part of a TokenEndpoint, which is an IResource. Something (a
client, in OAuth terminology) makes a request that looks like this:

---
POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=password&amp;client_id=s6BhdRkqt3&amp;client_secret=47HDu8s&amp;username=johndoe&amp;password=A3ddj3w
---

And hopefully the code we're discussing answers with a request that looks
like this:

---
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store

{
&quot;access_token&quot;:&quot;SlAV32hkKG&quot;,
&quot;expires_in&quot;:3600,
 &quot;refresh_token&quot;:&quot;8xLOxBtZp8&quot;
&quot;scope&quot;: &quot;tummies cookies parrots&quot;
}
---

Where, as mentioned before, everything besides &quot;access_token&quot; is not always
required (but it must be possible to set them, because occasionally they are
required).

On Fri, Sep 10, 2010 at 2:34 AM, Glyph Lefkowitz &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;wrote:

&gt;<i> for any given cred implementation, there are two key questions:
</I>&gt;<i>
</I>&gt;<i>    1. What is the avatar interface?
</I>&gt;<i>    2. What is the associated mind interface?
</I>&gt;<i>
</I>&gt;<i> If we're not talking about a system where the avatar interface (the one
</I>&gt;<i> passed to 'login', the one that the realm must return something that gets
</I>&gt;<i> implemented) is IResource, then that's the problem.  What *is* that
</I>&gt;<i> interface that you're talking about?  Be very specific: what methods does it
</I>&gt;<i> have and why?
</I>&gt;<i>
</I>
Okay, to be specific: I believe the appropriate interface is IResource. This
is in line with t.web's general way of interacting with cred: you give me
credentials, I give you a protected IResource.


&gt;<i> It sounds like OAuth is very precisely implementing something that maps
</I>&gt;<i> almost exactly onto the *checker* part of cred, but you're doing it by
</I>&gt;<i> implementing a realm to allow applications to provide their own logic.  This
</I>&gt;<i> might not be the wrong idea, but it needs to be spelled out very clearly.
</I>&gt;<i>
</I>
Doing everything in the checker probably might make more sense. The reason I
originally thought to do this in the IRealm is that I figured credentials
checkers should just check credentials, and creating a new credential (the
access token) wasn't part of ICredentialsChecker's job (more like IRealm's
job). Apparently I was mistaken.


&gt;<i> As you describe it:
</I>&gt;<i>
</I>&gt;<i> token endpoints let you trade in some credentials that prove you're
</I>&gt;<i> supposed to have access for a token that actually *gives* you that access
</I>&gt;<i>
</I>&gt;<i> In cred-ese, that would be &quot;checkers let you trade in some credentials that
</I>&gt;<i> prove you're supposed to have access for an &lt;avatar ID, which you give to a
</I>&gt;<i> Realm&gt; that actually *gives* you that access&quot;.  As far as the OAuth response
</I>&gt;<i> is concerned, it's like a checker.  Looking at the individual parts,
</I>&gt;<i> assuming that the avatar interface for the purposes of this discussion is
</I>&gt;<i> IResource, it breaks down like this in my mind:
</I>&gt;<i>
</I>&gt;<i>     - the access token (an ascii string, mandatory)
</I>&gt;<i>
</I>&gt;<i> Avatar ID.  (See, it's a str!)
</I>&gt;<i>
</I>
Heh, okay; as long as there's a plausible way to get the other important
information (see rest of email) into the HTTP response, I'll believe you.

&gt;<i>     - the expiration time (optional)
</I>&gt;<i>
</I>&gt;<i> Implementation detail of the session.  Avatars are actually sessions, which
</I>&gt;<i> expire: sometimes (as with POP) at the end of a connection, sometimes (as
</I>&gt;<i> with nevow.guard's HTTP support) with a session timeout.
</I>&gt;<i>
</I>
Right, but:
a) The avatar needs to know about this timeout, since the timeout
information needs to be able to make it into the HTTP response.
b) The expiration time is only known to the thing that creates the access
token (obviously). From the previous discussion, this is apparently
ICredentialsChecker.

c) (From (a, b)) The ICredentialsChecker needs to be able to communicate the
expiration to the avatar.
d) The ICredentialsChecker and IRealm can only communicate through the
avatarId.

Conclusion (from c,d): The expiration time needs to be in the avatarId?

&gt;<i>     - the refresh token (another ascii string, similar to the access token,
</I>&gt;<i> optional)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Implementation detail of the authentication protocol.  The client library
</I>&gt;<i> and server library should be transparently refreshing this without telling
</I>&gt;<i> either the client application code or server application code, right?
</I>&gt;<i>
</I>
Sure, but we're still writing library code here.

If the avatar interface isn't actually IResource, but a new interface
IAccessToken, getting the refresh token later might be feasible. (It should
be a different interface, because in order to create a refresh token outside
of this entire cred cycle, I need to know about the thing it's refreshing --
so, the information in the response needs to be easily accessible and not
just an opaque IResource).

I agree entirely that clever client library code would abstract this mess
away from application code. However, right now this code still needs to
somehow be able to eventually produce HTTP responses that don't abstract
anything yet and just contain all the appropriate data, because that's just
what the OAuth spec says it needs to be able to do. There isn't any real
application code in the token endpoint; they're pretty similar for all OAuth
setups, and customization would typically happen through implementing the
appropriate ICredentialsChecker.

    - scope (an ascii string consisting of a set of space-separated words,
&gt;<i> optional)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This part doesn't quite fit, but could be expressed in one of two ways: a
</I>&gt;<i> modification to the avatar ID, or as some extra structure on the Mind that
</I>&gt;<i> modifies what functionality the Realm bundles in to your avatar
</I>&gt;<i> implementation (without changing the interface provided by that object, of
</I>&gt;<i> course).
</I>&gt;<i>
</I>
Unfortunately I don't believe this can be done through the mind. Again
working under the previous assumption that ICredentialsChecker and not the
IRealm is responsible for creating the access token, and scope is known to
the thing that makes the access token, the ICredentialsChecker knows about
the scope. Unfortunately the only way to pass stuff  between the
ICredentialsChecker and the IRealm is the avatar ID, so you don't have a
choice.


thanks for your infinite patience,
Laurens
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/76080471/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/76080471/attachment-0001.htm</A> 

------------------------------

Message: 4
Date: Fri, 10 Sep 2010 22:09:17 +0300
From: Pantelis Theodosiou &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ypercube at gmail.com</A>&gt;
Subject: Re: [Twisted-Python] reactor for both udp and tcp/ timer
	issue
To: Twisted general discussion &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Message-ID:
	&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">AANLkTikcuEW-pGSVPy+fs9A2crKmF5HBBrXOymif7N+Z at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

On Fri, Sep 10, 2010 at 7:55 PM, belk Dj &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">d_belkhiter at yahoo.fr</A>&gt; wrote:

&gt;<i> I need to communicate with servers over tcp and also communicate with other
</I>&gt;<i> servers over udp.
</I>&gt;<i> It seems not possible to launch two reactor objects one for tcp and one for
</I>&gt;<i> udp.
</I>&gt;<i> The code after a reactor.run is not called.
</I>&gt;<i> How can this can be solved ?
</I>&gt;<i>
</I>&gt;<i>
</I>I'm not an expert in any way, but I've made something similar using 2
factories.

I think that it is also possible with one factory that uses 2 protocols.

The code after reactor.run() will be invoked only after the reactor stops.
So, you can have 2 factories, each with a different protocol (1 tcp, 1 udp)
and then start the reactor.

Pandelis


&gt;<i> One more thing that deals with timer.
</I>&gt;<i> When i send a message to a server if after some time i don't get an
</I>&gt;<i> acknowledge i re send the message.
</I>&gt;<i> And that x times.
</I>&gt;<i> To do that i use Timer. When i send the message i start the timer if the
</I>&gt;<i> acknowledge comes before the timeout i cancel the timer.
</I>&gt;<i> If i don't receive this acknwledge in time i cancel the timer i re send the
</I>&gt;<i> previous message and i re start the timer.
</I>&gt;<i>
</I>&gt;<i> In this two cases the program fails with the message the timer is still
</I>&gt;<i> started.
</I>&gt;<i> What is the issue ?
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/7848c316/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/7848c316/attachment.htm</A> 

------------------------------

_______________________________________________
Twisted-Python mailing list
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>


End of Twisted-Python Digest, Vol 78, Issue 15
**********************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/ec484e26/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100910/ec484e26/attachment-0001.htm</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022849.html">[Twisted-Python] reactor for both udp and tcp/ timer issue
</A></li>
	<LI>Next message: <A HREF="022855.html">[Twisted-Python] Announcing Twisted 10.1.0pre2!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22853">[ date ]</a>
              <a href="thread.html#22853">[ thread ]</a>
              <a href="subject.html#22853">[ subject ]</a>
              <a href="author.html#22853">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
