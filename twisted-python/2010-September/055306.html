<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] multiple workers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20multiple%20workers&In-Reply-To=%3C20100902201218.2058.2013892391.divmod.xquotient.404%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055305.html">
   <LINK REL="Next"  HREF="055302.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] multiple workers</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20multiple%20workers&In-Reply-To=%3C20100902201218.2058.2013892391.divmod.xquotient.404%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] multiple workers">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Sep  2 14:12:18 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055305.html">[Twisted-Python] multiple workers
</A></li>
        <LI>Next message (by thread): <A HREF="055302.html">[Twisted-Python] Ldaptor: [PATCH] Extend test driver send_multiResponse() to return deferred and throw errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55306">[ date ]</a>
              <a href="thread.html#55306">[ thread ]</a>
              <a href="subject.html#55306">[ subject ]</a>
              <a href="author.html#55306">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05:26 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ruslan.usifov at gmail.com</A> wrote:
&gt;<i>Why it is not supported?
</I>
&quot;Why&quot; it is not supported is that no one has decided to implement and 
support it.  If it's interesting behavior for you, then we would 
completely welcome you implementing it, and we'll even maintain the 
support for it once you've done that. :)

If you were asking about what specific implementation details cause it 
not to work now (more of a &quot;how&quot; question, sort of), then the answer to 
that probably varies from reactor to reactor, but it is all about how 
things end up being shared across the multiple processes created by 
fork.

I want behaviour like nginx <A HREF="http://nginx.org/,">http://nginx.org/,</A> and
&gt;<i>misunderstand why i can't implemented it throw twisted. Its' so easy. 
</I>&gt;<i>Every
</I>&gt;<i>process have it's own set sockets, and they doesn't share  this sockets
</I>&gt;<i>between each other. &quot;OnConnect&quot; event happens only once and which 
</I>&gt;<i>process
</I>&gt;<i>handle this event depend on operation system(select epoll, kqueue), in 
</I>&gt;<i>my
</I>&gt;<i>case this happens like round robin(FreeBSD 7.2-RELEASE-p8). Where here 
</I>&gt;<i>is
</I>&gt;<i>unsupported behaviour?
</I>
So, for example, epoll descriptors do survive fork().  However, kqueue 
descriptors don't.  So one necessary change for kqueue reactor to 
support this kind of behavior is to have the reactor somehow re- 
initialize itself after the fork.

Another problem is that certain resources are not simply duplicated by a 
fork().  A specific example is the one you brought up in your earlier 
post.  A unix socket only has one entity corresponding to it in the 
filesystem.  Twisted takes responsibility for cleaning these up, but 
after you fork(), there are two unix sockets and still only one 
filesystem entity.  This confuses one of the processes, since it 
believes it needs to delete the file.  Hardly rocket science to fix, but 
it's a specific case which needs to be handled.

And I'm sure you'll come across quite a few more specific cases which 
need to be handled.  This might get us back to the &quot;why&quot; a little - 
actually ensuring that everything will work properly when arbitrary 
forks are added is a major challenge.  I don't see any way to do it 
comprehensively, really.  That would leave you with a long, long 
adventure of fixing one little issue at a time for months or even years 
to come.  And each problem would only become evident after it bit you 
somehow.

That's probably why we have a ticket for an explicit file descriptor 
passing API, rather than a ticket for supporting arbitrary fork calls. 
The former is easier to test and be confident in than the latter.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055305.html">[Twisted-Python] multiple workers
</A></li>
	<LI>Next message (by thread): <A HREF="055302.html">[Twisted-Python] Ldaptor: [PATCH] Extend test driver send_multiResponse() to return deferred and throw errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55306">[ date ]</a>
              <a href="thread.html#55306">[ thread ]</a>
              <a href="subject.html#55306">[ subject ]</a>
              <a href="author.html#55306">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
