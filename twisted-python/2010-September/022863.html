<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Just curious about EINTR in socket.recv()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Just%20curious%20about%20EINTR%20in%20socket.recv%28%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022865.html">
   <LINK REL="Next"  HREF="022864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Just curious about EINTR in socket.recv()</H1>
    <B>Alexey</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Just%20curious%20about%20EINTR%20in%20socket.recv%28%29&In-Reply-To="
       TITLE="[Twisted-Python] Just curious about EINTR in socket.recv()">twisted-web at udmvt.ru
       </A><BR>
    <I>Tue Sep 14 08:29:34 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022865.html">[Twisted-Python] Selectable SerialPort Windows/Linux
</A></li>
        <LI>Next message: <A HREF="022864.html">[Twisted-Python] Just curious about EINTR in socket.recv()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22863">[ date ]</a>
              <a href="thread.html#22863">[ thread ]</a>
              <a href="subject.html#22863">[ subject ]</a>
              <a href="author.html#22863">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As far as I know, socket.recv() may raise socket.error exception
in case of error return from recv(2) system call. My system's (Linux i386 2.6.32)
man page say there could be these error values:

       EAGAIN or EWOULDBLOCK
       EBADF
       ECONNREFUSED
       EFAULT
       EINTR
       EINVAL
       ENOMEM
       ENOTCONN
       ENOTSOCK

Now, looking into twisted.internet.tcp, method doRead() on line 443, (twisted 10.1.0)
we may find, that code:
        try:
            data = self.socket.recv(self.bufferSize)
        except socket.error, se:
            if se.args[0] == EWOULDBLOCK:
                return
            else:
                return main.CONNECTION_LOST
        if not data:
            return main.CONNECTION_DONE
        return self.protocol.dataReceived(data)

This is the point in the twisted framework, that decides how TCP socket
will get closed, whether that be in &quot;clean&quot; or &quot;non clean&quot; fashion.

But some error codes, besides EWOULDBLOCK, are not in any way related
to reporting a permanent error, that deserves closing the socket.

Question to Python system library gurus: is socket.recv() supposed to raise socket.error with EINTR code ?
In that case we should return None too, since that operation should be restarted,
and reporting main.CONNECTION_LOST is a bug.

What about ENOMEM case? Is system supposed to have destroyed the socket after that event,
or it can safely recover later, so there is no sense in closing the socket in twisted either?

Sorry, if that is a non-issue, or already tracked, I'm just curious.

-- 
Alexey.

</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022865.html">[Twisted-Python] Selectable SerialPort Windows/Linux
</A></li>
	<LI>Next message: <A HREF="022864.html">[Twisted-Python] Just curious about EINTR in socket.recv()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22863">[ date ]</a>
              <a href="thread.html#22863">[ thread ]</a>
              <a href="subject.html#22863">[ subject ]</a>
              <a href="author.html#22863">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
