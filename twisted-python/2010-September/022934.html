<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] how to write a safe catch-all
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20how%20to%20write%20a%20safe%20catch-all&In-Reply-To=4CA1F212.9040305%40simplistix.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022933.html">
   <LINK REL="Next"  HREF="022935.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] how to write a safe catch-all</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20how%20to%20write%20a%20safe%20catch-all&In-Reply-To=4CA1F212.9040305%40simplistix.co.uk"
       TITLE="[Twisted-Python] how to write a safe catch-all">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Sep 28 10:21:51 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022933.html">[Twisted-Python] how to write a safe catch-all
</A></li>
        <LI>Next message: <A HREF="022935.html">[Twisted-Python] how to write a safe catch-all
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22934">[ date ]</a>
              <a href="thread.html#22934">[ thread ]</a>
              <a href="subject.html#22934">[ subject ]</a>
              <a href="author.html#22934">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01:48 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris at simplistix.co.uk</A> wrote:
&gt;<i>Hi All,
</I>&gt;<i>
</I>&gt;<i>The attached .py file demonstrates a problem I'm having with a little 
</I>&gt;<i>scheduler I need to maintain.
</I>&gt;<i>
</I>&gt;<i>The loop() function is supposed to be a &quot;catch all and report&quot; error 
</I>&gt;<i>handler. However, when the async code initiated by doStuff throws the 
</I>&gt;<i>AttributeError, what actually gets logged is:
</I>&gt;<i>
</I>&gt;<i>2010-09-28 14:41:15,706 ERROR   : log         (14757|7f691ba676e0): 
</I>&gt;<i>Unhandled Error
</I>&gt;<i>   File &quot;test_looping.py&quot;, line 24, in __call__
</I>&gt;<i>     del self.connector
</I>&gt;<i>exceptions.AttributeError: Break instance has no attribute 'connector'
</I>&gt;<i>
</I>&gt;<i>2010-09-28 14:41:15,707 ERROR   : log         (14757|7f691ba676e0): 
</I>&gt;<i>Unhandled scheduled exception
</I>&gt;<i>   File &quot;test_looping.py&quot;, line 35, in loop
</I>&gt;<i>     yield doStuff()
</I>&gt;<i>exceptions.GeneratorExit:
</I>&gt;<i>
</I>&gt;<i>But, more crucially, the looping call then appears to stop.
</I>
The function you're looping over returns a Deferred that never fires. 
The LoopingCall isn't stopped, it's waiting for the Deferred.
&gt;<i>What can I do to get the exception logged and then everything handled 
</I>&gt;<i>sanely such that the looping call can continue and my lopp function 
</I>&gt;<i>will keep getting called once every second rather than stopping?
</I>
When you do reactor.callLater(n, f), you put f into an execution context 
where the only thing that will happen to exceptions it raises is that 
they will be logged.  If you want something else to happen to the 
exception, then you have to arrange for that.  You can do this by 
wrapping f with another function that handles the exception and sends it 
where you want.  Or you can use twisted.internet.task.deferLater, which 
probably does something pretty close to what you want.

Jean-Paul

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022933.html">[Twisted-Python] how to write a safe catch-all
</A></li>
	<LI>Next message: <A HREF="022935.html">[Twisted-Python] how to write a safe catch-all
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22934">[ date ]</a>
              <a href="thread.html#22934">[ thread ]</a>
              <a href="subject.html#22934">[ subject ]</a>
              <a href="author.html#22934">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
