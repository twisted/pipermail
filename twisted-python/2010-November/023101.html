<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] connectionLost never reached after calling	loseConnection: stuck in CLOSE_WAIT forever
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20connectionLost%20never%20reached%20after%0A%20calling%09loseConnection%3A%20stuck%20in%20CLOSE_WAIT%20forever&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="023100.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] connectionLost never reached after calling	loseConnection: stuck in CLOSE_WAIT forever</H1>
    <B>Stefano Debenedetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20connectionLost%20never%20reached%20after%0A%20calling%09loseConnection%3A%20stuck%20in%20CLOSE_WAIT%20forever&In-Reply-To="
       TITLE="[Twisted-Python] connectionLost never reached after calling	loseConnection: stuck in CLOSE_WAIT forever">ste at demaledetti.net
       </A><BR>
    <I>Mon Nov  1 08:42:15 EDT 2010</I>
    <P><UL>
        
        <LI>Next message: <A HREF="023100.html">[Twisted-Python] Immediate removal of cfreactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23101">[ date ]</a>
              <a href="thread.html#23101">[ thread ]</a>
              <a href="subject.html#23101">[ subject ]</a>
              <a href="author.html#23101">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph wrote:
&gt;<i> Stefano, this looks like a great contribution: a serious bug fix in a bit of core functionality, with a test.  Thanks so much!
</I>

Thank you! It's a pleasure to have one's code be called by code in
the Twisted framework and to get stuff done with it! And it's an
honor to receive support from such a wonderful community, already
ever so enjoyable and enlightening even when just lurking among it!


&gt;<i> I'll try to do a complete review soon, but my immediate impression is that test_disconnectEvent needs a better docstring.  The word 'correctly' in a docstring is always a clue that the writer gave up and stopped trying to describe what 'correct' behavior is :).
</I>

Good point, I totally agree with you. &quot;correctly&quot; is most often the
wrong word and a shortcut which leads to unpleasant consequences
once what is &quot;correct&quot; gets better defined later by explicitly
broken behavior.

BTW that line was actually shamelessly copy-pasted from the previous
test's docstring ;P


&gt;<i> if you could try to rephrase it as &quot;When a transport is (...) and then (...), (...) should be called on (...)&quot;.
</I>&gt;<i> 
</I>&gt;<i> (I will have a more concrete suggestion, with fewer &quot;...&quot;s when I have time to go through the ticket history and review the patch in detail.)
</I>

OK, take two:

This test checks that a protocol gets notified of a lost connection
when its transport has a registered producer writing more than 64KB
to it and is then asked to stopProducing without any more data being
written to it. This ought to prevent that sockets get stuck in
CLOSE_WAIT state when these peculiar conditions occur. See #4719.


Another thing I'm not too sure about is if TCPClientTestsBuilder
(&quot;Builder defining tests relating to L{IReactorTCP.connectTCP}.&quot;) is
the right class for holding such a test, which is not very related
to connectTCP.


ciao thanks
ste



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="023100.html">[Twisted-Python] Immediate removal of cfreactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23101">[ date ]</a>
              <a href="thread.html#23101">[ thread ]</a>
              <a href="subject.html#23101">[ subject ]</a>
              <a href="author.html#23101">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
