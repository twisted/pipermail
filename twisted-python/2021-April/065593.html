<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Does anyone know why trunk is failing CI on PyPy 7.3.4?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Does%20anyone%20know%20why%20trunk%20is%20failing%20CI%20on%20PyPy%0A%207.3.4%3F&In-Reply-To=%3C20210427071252.GA432778%40kosmos.hhhh.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065590.html">
   <LINK REL="Next"  HREF="065597.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Does anyone know why trunk is failing CI on PyPy 7.3.4?</H1>
    <B>Wim Lewis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Does%20anyone%20know%20why%20trunk%20is%20failing%20CI%20on%20PyPy%0A%207.3.4%3F&In-Reply-To=%3C20210427071252.GA432778%40kosmos.hhhh.org%3E"
       TITLE="[Twisted-Python] Does anyone know why trunk is failing CI on PyPy 7.3.4?">wiml at hhhh.org
       </A><BR>
    <I>Tue Apr 27 01:12:52 MDT 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065590.html">[Twisted-Python] Codecov.io security incident
</A></li>
        <LI>Next message (by thread): <A HREF="065597.html">[Twisted-Python] Does anyone know why trunk is failing CI on PyPy 7.3.4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65593">[ date ]</a>
              <a href="thread.html#65593">[ thread ]</a>
              <a href="subject.html#65593">[ subject ]</a>
              <a href="author.html#65593">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>TLDR: Twisted appears broken on PyPy 7.3.4 (aka &quot;3.7.10&quot;)?

I don't have time right now to set up a PyPy-capable environment and try 
to reproduce this, but perhaps someone does?

Long version:

Trunk has been broken since the last merge a week or so ago, but I 
don't think the breakage is due to that merge.  As an experiment I made 
a PR based off the last successful version of trunk, with a whitespace 
change, and it now fails CI as well. So I think the failure must be due 
to some change that isn't in Twisted or controlled-for by tox.

The failure in all cases is in the pypy-3.7-alldeps-nocov-posix task. 
Unlike our usual CI problems it doesn't seem to be a random failure: it 
fails all the time in the same place. But the place doesn't make sense 
to me. It's in the IRC CTCP tests, and they fail in the same ways each 
time (an expected response is not received).

The pair of CI runs closest to the change are these:

run 5793: <A HREF="https://github.com/twisted/twisted/runs/2328450554">https://github.com/twisted/twisted/runs/2328450554</A>
run 5809: <A HREF="https://github.com/twisted/twisted/runs/2360415474">https://github.com/twisted/twisted/runs/2360415474</A>

There are a lot of differences, but sys.version went from 3.7.9 to 
3.7.10 between those runs, so that seems like the most likely culprit.

Last working:
&gt;<i>  sys.version              : 3.7.9 (7e6e2bb30ac5, Nov 18 2020, 10:55:52)
</I>&gt;<i>  [PyPy 7.3.3-beta0 with GCC 7.3.1 20180303 (Red Hat 7.3.1-5)]
</I>&gt;<i>  sys.prefix               : /opt/hostedtoolcache/PyPy/3.7.9/x64
</I>&gt;<i>  sys.exec_prefix          : /opt/hostedtoolcache/PyPy/3.7.9/x64
</I>&gt;<i>  sys.executable           : /opt/hostedtoolcache/PyPy/3.7.9/x64/bin/python
</I>
First broken:
&gt;<i>  sys.version              : 3.7.10 (51efa818fd9b, Apr 04 2021, 11:22:34)
</I>&gt;<i>  [PyPy 7.3.4 with GCC 7.3.1 20180303 (Red Hat 7.3.1-5)]
</I>&gt;<i>  sys.prefix               : /opt/hostedtoolcache/PyPy/3.7.10/x64
</I>&gt;<i>  sys.exec_prefix          : /opt/hostedtoolcache/PyPy/3.7.10/x64
</I>&gt;<i>  sys.executable           : /opt/hostedtoolcache/PyPy/3.7.10/x64/bin/python
</I>
PyPy's release notes for 7.3.4 don't list anything that jumps out at me:

<A HREF="https://doc.pypy.org/en/latest/whatsnew-pypy3-7.3.4.html">https://doc.pypy.org/en/latest/whatsnew-pypy3-7.3.4.html</A>

My guess would be some latent timing bug in Twisted that was uncovered 
by pypy execution time changes (I don't imagine that the CTCP code gets 
exercised very heavily these days) or perhaps PyPy got a bug.


Wim.

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065590.html">[Twisted-Python] Codecov.io security incident
</A></li>
	<LI>Next message (by thread): <A HREF="065597.html">[Twisted-Python] Does anyone know why trunk is failing CI on PyPy 7.3.4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65593">[ date ]</a>
              <a href="thread.html#65593">[ thread ]</a>
              <a href="subject.html#65593">[ subject ]</a>
              <a href="author.html#65593">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
