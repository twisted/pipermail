<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] IDNA problem in twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20IDNA%20problem%20in%20twisted&In-Reply-To=%3Cfd785022-130e-4f6e-a8c7-957ee59cc9a5%40hhhh.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065583.html">
   <LINK REL="Next"  HREF="065595.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] IDNA problem in twisted</H1>
    <B>Wim Lewis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20IDNA%20problem%20in%20twisted&In-Reply-To=%3Cfd785022-130e-4f6e-a8c7-957ee59cc9a5%40hhhh.org%3E"
       TITLE="[Twisted-Python] IDNA problem in twisted">wiml at hhhh.org
       </A><BR>
    <I>Tue Apr 27 21:58:44 MDT 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065583.html">[Twisted-Python] IDNA problem in twisted
</A></li>
        <LI>Next message (by thread): <A HREF="065595.html">[Twisted-Python] IDNA problem in twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65594">[ date ]</a>
              <a href="thread.html#65594">[ thread ]</a>
              <a href="subject.html#65594">[ subject ]</a>
              <a href="author.html#65594">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thursday, April 8, 2021 8:43:35 AM PDT, Barry Scott wrote:
&gt;<i> We just added a patch to our twisted to prevent twisted from 
</I>&gt;<i> doing idna validation.
</I>&gt;<i> _idnaBytes and _idnaText not convert from bytes to unicode 
</I>&gt;<i> based on the type of
</I>&gt;<i> the provided arg.
</I>&gt;<i>
</I>&gt;<i> We had to do this because there are domain names that 
</I>&gt;<i> youtube.com uses that are
</I>&gt;<i> not valid under IDNA-2008 
</I>&gt;<i> <A HREF="https://tools.ietf.org/html/rfc5891#section-4.2.3.1">https://tools.ietf.org/html/rfc5891#section-4.2.3.1</A>
</I>
My reading of the RFC is that the YouTube domain you mention 
(r2---sn-aigzrn7e.googlevideo.com) is an invalid &quot;U-Label&quot;, but that 
doesn't mean it's an entirely invaid domain label. It just means you can't 
legally run it through IDNA and turn it into &quot;xn--r2---sn-aigzrn7e-&quot;. The 
intent, as I understand it, is to forbid any possibility of double-encoding 
or double-decoding a label, not to forbid the possibility of using labels 
like the one you mention.

&gt;<i> I can see why a UI would need to do IDNA-2008 converts and validation
</I>&gt;<i> but I'm not clear why its of value deep in the guts of twisted.
</I>
My guess is that this is just an accident of the way that the 
bytes/characters distinction and the IDNA features were added to Twisted, 
and is probably a bug.

&gt;<i> Why is this code needed at all in twisted?
</I>&gt;<i> If its for a high level API then why isn't it being called at the
</I>&gt;<i> edge of the high level API calls?
</I>
I'd argue that resolving URLs is in fact a high level API (from the point 
of view of the name resoution system) but even so, it seems to me that 
Twisted is doing the wrong thing here. The format of that label should 
prevent it from ever being transformed by IDNA, but shouldn't prevent it 
from being passed through unchanged, since it doesn't contain any 
codepoints outside of the usual ASCII range.

&gt;<i> The key idea here is that its human input that will be converted.
</I>&gt;<i> But the code is used deep in the _sslverify.py where no human
</I>&gt;<i> input is entered.
</I>
_sslverify has to check whether the information in the server's certificate 
matches the URL that the user supplied. Certificates can contain Unicode 
text — at least in the (completely obsolete) CN-as-domain-name situation — 
so _sslverify probably picked up the requirement for IDNA transformations 
from that. (I don't remember whether dNSName SANs can contain unicode.)

What is the patch you decided to add to your version? Where in _sslverify 
did the problem surface?


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065583.html">[Twisted-Python] IDNA problem in twisted
</A></li>
	<LI>Next message (by thread): <A HREF="065595.html">[Twisted-Python] IDNA problem in twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65594">[ date ]</a>
              <a href="thread.html#65594">[ thread ]</a>
              <a href="subject.html#65594">[ subject ]</a>
              <a href="author.html#65594">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
