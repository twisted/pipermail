<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A few comments on deferreds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20few%20comments%20on%20deferreds&In-Reply-To=%3C18865.8570.558666.360596%40jon.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051809.html">
   <LINK REL="Next"  HREF="051816.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A few comments on deferreds</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20few%20comments%20on%20deferreds&In-Reply-To=%3C18865.8570.558666.360596%40jon.es%3E"
       TITLE="[Twisted-Python] A few comments on deferreds">terry at jon.es
       </A><BR>
    <I>Fri Mar  6 06:13:30 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051809.html">[Twisted-Python] A few comments on deferreds
</A></li>
        <LI>Next message (by thread): <A HREF="051816.html">[Twisted-Python] StandardIO flush'n
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51812">[ date ]</a>
              <a href="thread.html#51812">[ thread ]</a>
              <a href="subject.html#51812">[ subject ]</a>
              <a href="author.html#51812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi JP

&gt;&gt;&gt;&gt;&gt;<i> &quot;JP&quot; == Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; writes:
</I>JP&gt; On Fri, 6 Mar 2009 12:10:55 +0100, Terry Jones &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">terry at jon.es</A>&gt; wrote:

&gt;&gt;<i> 1. If you have a deferred d1, and you call d1.chainDeferred(d2) I think
</I>&gt;&gt;<i> it makes sense for there to be a flag inside the deferred class that
</I>&gt;&gt;<i> warns you if you later call d1.addCallbacks. That's because adding more
</I>&gt;&gt;<i> functions to d1's callback/errback chain is probably not useful. (It
</I>&gt;&gt;<i> might conceivably be useful, e.g., to let you know that d1 has been
</I>&gt;&gt;<i> called). The result of d1 has been passed to d2, and because d2.callback
</I>&gt;&gt;<i> and d2.errback don't return it (see point 2 below), it is not passed
</I>&gt;&gt;<i> further down d1's chain. So it's most likely that someone adding a
</I>&gt;&gt;<i> callback to d1 after calling d1.chainDeferred doesn't really know what
</I>&gt;&gt;<i> they're doing.
</I>
JP&gt; Indeed.  I can't think of any case where I've wanted to add more
JP&gt; callbacks to a Deferred after chaining it to (from?  with?) another
JP&gt; Deferred.

Right.

&gt;&gt;<i> 2. Deferred.callback and Deferred.errback currently (implicitly) return
</I>&gt;&gt;<i> None.  They could be changed to return their passed argument.  That
</I>&gt;&gt;<i> would make a call to d1.chainDeferred act like a deferred fork - the
</I>&gt;&gt;<i> result would go down d2's callback chain, but also continue down the
</I>&gt;&gt;<i> callback/errback chain of d1.
</I>
JP&gt; But it would be catastrophic for error handling.  Suddenly all of your
JP&gt; errors on d1 which are handled perfectly correctly with an errback on
JP&gt; d2 would become unhandled failures.

Ah yes :-)  Oops.

If you really wanted to do this, you could use another helper function
(e.g., Deferred.forkDeferred) which created and added a call/errback
functions to d1 that called d2 call/errback and then returned its arg). I
don't have a use case for that, so I'm not suggesting adding it to Twisted.
Anyone who wanted that kind of deferred forking functionality could write
it for themselves in a few lines.

&gt;&gt;<i> 3. There's also the possibility of adding a function to the Deferred class:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> def incorporateDeferred(self, d2):
</I>&gt;&gt;<i> self.callbacks.extend(d2.callbacks)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> which might be what a naive reader might expect chainDeferred to do.
</I>&gt;&gt;<i> This raises the question of what you might later do with d2 (probably
</I>&gt;&gt;<i> nothing), but that's just like what happens with d1: if you call
</I>&gt;&gt;<i> d1.chainDeferred you're probably not going to return d1 to anyone. All
</I>&gt;&gt;<i> you can usefully do is fire it.
</I>
JP&gt; If this accounted for future changes to d2, it would make more sense.

Yes. But as I mentioned, this mirrors the situation with d1.chainDeferred
in which future changes to d1 are also probably useless. It feels to me
like extending callbacks might be what people are expecting, as d1 then
remains useful.  (This leads to thoughts of a Deferred class that can't be
fired, just used to accumulate callbacks that are solely used to extend
other deferreds, but I guess deferreds are already abstract enough without
going there...)

JP&gt; I think the correct direction to go in is to prevent people from trying
JP&gt; to add more callbacks to d1.

Agreed. It's a simple change and it almost certainly flags a misunderstanding.
I can open an issue and submit a patch if you like.

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051809.html">[Twisted-Python] A few comments on deferreds
</A></li>
	<LI>Next message (by thread): <A HREF="051816.html">[Twisted-Python] StandardIO flush'n
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51812">[ date ]</a>
              <a href="thread.html#51812">[ thread ]</a>
              <a href="subject.html#51812">[ subject ]</a>
              <a href="author.html#51812">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
