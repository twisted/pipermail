<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Novice question on twisted framework
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Novice%20question%20on%20twisted%20framework&In-Reply-To=1BE49492956ECA42BEB0D78F67665E1FA96DBE%40exchange.wdg">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019354.html">
   <LINK REL="Next"  HREF="019356.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Novice question on twisted framework</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Novice%20question%20on%20twisted%20framework&In-Reply-To=1BE49492956ECA42BEB0D78F67665E1FA96DBE%40exchange.wdg"
       TITLE="[Twisted-Python] Novice question on twisted framework">exarkun at divmod.com
       </A><BR>
    <I>Tue Mar 17 09:54:50 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019354.html">[Twisted-Python] Novice question on twisted framework
</A></li>
        <LI>Next message: <A HREF="019356.html">[Twisted-Python] So how does everyone use an ORM in twisted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19355">[ date ]</a>
              <a href="thread.html#19355">[ thread ]</a>
              <a href="subject.html#19355">[ subject ]</a>
              <a href="author.html#19355">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 17 Mar 2009 15:18:31 +1100, Sury Soni &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ssoni at nextdigital.com</A>&gt; wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I have an existing application, written using Ice Middleware
</I>&gt;<i>(www.zeroc.com)
</I>&gt;<i>
</I>&gt;<i>This application is my source of infinite queue (server)
</I>&gt;<i>
</I>&gt;<i>Following is my application (processing client to my infinite queue
</I>&gt;<i>server) idea to be implemented using Twisted Framework.
</I>&gt;<i>
</I>&gt;<i>I can loop through my infinite queue and receive email data (Using
</I>&gt;<i>.next() kind of function)
</I>&gt;<i>
</I>&gt;<i>Using this email data object, I need to trigger event to send email
</I>&gt;<i>using ESMTPSenderFactory and ESMTPSender. As, later I would be extending
</I>&gt;<i>ESMTP* classes to do my little funky stuff.
</I>&gt;<i>
</I>&gt;<i>What is the best code design I can use to implement this stuff.
</I>
Your code looks close.  The biggest issue is the loop over the queue.
Instead, you need to handle items from the queue without blocking.

&gt;<i>
</I>&gt;<i>Following is basic algorithm kind of code I am doing right now, but I
</I>&gt;<i>feel I am missing something.
</I>&gt;<i>
</I>&gt;<i>#================
</I>&gt;<i>
</I>&gt;<i>#Code Begins Here: .tac file
</I>&gt;<i>
</I>&gt;<i>#================
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>import StringIO
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>from twisted.application import service
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>from twisted.application import internet
</I>&gt;<i>
</I>&gt;<i>from twisted.internet import protocol, defer
</I>&gt;<i>
</I>&gt;<i>from twisted.mail import smtp, relaymanager
</I>&gt;<i>
</I>&gt;<i>from twisted.internet import reactor
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Def process_queue:
</I>&gt;<i>
</I>
The following loop:

&gt;<i>    While True:
</I>&gt;<i>
</I>&gt;<i>         Try:
</I>&gt;<i>
</I>&gt;<i>                Data = my_queue.next()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>                getMailExchange('localhost).addCallback(cbMailExchange,
</I>&gt;<i>data)
</I>&gt;<i>
</I>&gt;<i>       Except:
</I>&gt;<i>
</I>&gt;<i>                Break
</I>&gt;<i>
</I>
Needs to be replaced.  I'm not sure what my_queue is, but you need to
replace it with something which will call your code when there is an
item to process.  Then you can get rid of the loop and define a callback
which looks up a mail exchange and sends a message to it.

You may also want to use twisted.mail.smtp.sendmail rather than the
factories.  It's a bit higher-level and simpler.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019354.html">[Twisted-Python] Novice question on twisted framework
</A></li>
	<LI>Next message: <A HREF="019356.html">[Twisted-Python] So how does everyone use an ORM in twisted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19355">[ date ]</a>
              <a href="thread.html#19355">[ thread ]</a>
              <a href="subject.html#19355">[ subject ]</a>
              <a href="author.html#19355">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
