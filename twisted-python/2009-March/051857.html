<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Noob Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Noob%20Question&In-Reply-To=%3C35b355e90903150655j2afe48d0l4cd5f166148c3c44%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051854.html">
   <LINK REL="Next"  HREF="051858.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Noob Question</H1>
    <B>Shelby Ramsey</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Noob%20Question&In-Reply-To=%3C35b355e90903150655j2afe48d0l4cd5f166148c3c44%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Noob Question">sicfslist at gmail.com
       </A><BR>
    <I>Sun Mar 15 07:55:25 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051854.html">[Twisted-Python] Noob Question
</A></li>
        <LI>Next message (by thread): <A HREF="051858.html">[Twisted-Python] Noob Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51857">[ date ]</a>
              <a href="thread.html#51857">[ thread ]</a>
              <a href="subject.html#51857">[ subject ]</a>
              <a href="author.html#51857">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Peter,

Thanks for the assistance.  I think you and David have me on the right
path.  Just to clarify the protocol looks like this:

Content-Length: 984
Content-Type: text/event-xml

&lt;event&gt;
  &lt;headers&gt;
   $bunchofinfo ...
  &lt;/headers&gt;
&lt;/event&gt;

Where the body (and the content length) start and stop with the &lt;event&gt; ...
&lt;/event&gt;.

Here is what I've done so far:

from twisted.internet import reactor, protocol
from twisted.protocols import basic
from re import compile, findall

bl_p = compile('Content-Length:\s(\d+)')

class My_Client(basic.LineReceiver):
    def __init__(self):
        self.body_length = None

    def connectionMade(self):
        self.transport.write(&quot;login \r\n\r\n&quot;)
        self.transport.write(&quot;sendevents\r\n\r\n&quot;)

    def lineReceived(self, line):
        print line
        bl_m = bl_p.findall(line)
        if bl_m:
            print 'Match:'
            self.body_length = int(bl_m[0]) - len(line) # this doesn't
really work because it doesn't factor in the len of the next line
            self.setRawMode()

    def rawDataReceived(self, data):
       datalen = len(data)
       if self.body_length &gt; datalen:
           self.body_length -= datalen
           print data
       else:
           part = data[:self.body_length]
           extra = data[self.body_length:]
           print 'Left Over\n:'
           print extra
           self.setLineMode(extra=extra)

    def connectionLost(self, reason):
        print &quot;%s&quot; % (reason)

class My_Factory(protocol.ClientFactory):
    protocol = My_Client

    def clientConnectionFailed(self, connector, reason):
        print &quot;Connection failed - goodbye!&quot;
        reactor.stop()

    def clientConnectionLost(self, connector, reason):
        print &quot;Connection lost - goodbye!&quot;
        reactor.stop()

def main():
    f = FS_Factory()
    reactor.connectTCP(&quot;$IP&quot;, $PORT, f)
    reactor.run()

# this only runs if the module was *not* imported
if __name__ == '__main__':
    main()

To me ... this looks somewhat correct ... but it doesn't seem to actually
ever use the line received method (note the print statement ...).  For
instance upon logging in it should respond with a +OK Logged In ... but it
never prints that.

And then when it receives an &quot;&lt;event&gt;...&quot; it actually dies with this error:

[Failure instance: Traceback (failure with no frames): &lt;class
'twisted.internet.error.ConnectionDone'&gt;: Connection was closed cleanly.
]
Connection lost - goodbye!

So I'm a bit lost as to what the impact of adding the rawDataReceived method
has done.

Thanks!

SDR
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20090315/3f86d08b/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051854.html">[Twisted-Python] Noob Question
</A></li>
	<LI>Next message (by thread): <A HREF="051858.html">[Twisted-Python] Noob Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51857">[ date ]</a>
              <a href="thread.html#51857">[ thread ]</a>
              <a href="subject.html#51857">[ subject ]</a>
              <a href="author.html#51857">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
