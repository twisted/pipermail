<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to use defer.fail better...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20use%20defer.fail%20better...&In-Reply-To=%3C49D12098.9090907%40omiha.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051918.html">
   <LINK REL="Next"  HREF="051920.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to use defer.fail better...</H1>
    <B>Jan Bakuwel</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20use%20defer.fail%20better...&In-Reply-To=%3C49D12098.9090907%40omiha.com%3E"
       TITLE="[Twisted-Python] How to use defer.fail better...">jan.bakuwel at omiha.com
       </A><BR>
    <I>Mon Mar 30 13:42:16 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051918.html">[Twisted-Python] How to use defer.fail better...
</A></li>
        <LI>Next message (by thread): <A HREF="051920.html">[Twisted-Python] What kind of throughput can we expect to achieve when using DatagramProtocol (UDP)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51919">[ date ]</a>
              <a href="thread.html#51919">[ thread ]</a>
              <a href="subject.html#51919">[ subject ]</a>
              <a href="author.html#51919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Glyph,

&gt;&gt;<i> I'm writing a twisted/python SMTP server that accepts emails from a MTA
</I>&gt;&gt;<i> using twisted. All works well, except that when I return a
</I>&gt;&gt;<i> defer.fail(None) from processEmail to messageHandler.eomReceived (see
</I>&gt;&gt;<i> below), twisted dumps the trace back of the last exception on stdout. Is
</I>&gt;&gt;<i> there a way to avoid this? I would like to handle the exception
</I>&gt;&gt;<i> gracefully (with an exception handler) and would not like to see any
</I>&gt;&gt;<i> trace back from it in my logs. I've read that using None as the
</I>&gt;&gt;<i> parameter to defer.fail does exactly that... what should I use instead?
</I>&gt;<i>
</I>&gt;<i> By the time you return, you need to have handled any exceptions.
</I>
I have...

My processEmail returns either defer.succeed(None) or return
defer.fail(None) based on some criteria. defer.succeed(None) translates
into telling the MTA that I've accepted the email (250);
defer.fail(None) translates into telling the MTA that I've not accepted
the email this time (421) but please try again later.

So... all is working as I would like it to work... except that twisted
dumps the exception trace back of the exception that occurred last on
stdout. There is no need for that... the exception has been handled already.

Can I make twisted not do that dump by passing another parameter
(instead of None) to defer.fail?

&gt;<i> If you want to separate exception handling into a separate function,
</I>&gt;<i> use addErrback on the Deferred you have created.
</I>
I am not using call backs explicitly.... I am returning either
defer.succeed(None) or defer.fail(None) based on some criteria.

&gt;&gt;<i> The other thing I would like to do better is to have a way to return
</I>&gt;&gt;<i> smtp code 421 (service temporarily unavailable) rather than 550 (fatal)
</I>&gt;&gt;<i> in those cases where I would like to indicate a (temporary) failure to
</I>&gt;&gt;<i> receive the email. I've patched smtp.py (replace 550 -&gt; 421) for this
</I>&gt;&gt;<i> but would gladly hear about a way to do this without patching a standard
</I>&gt;&gt;<i> component on my system.
</I>&gt;<i>
</I>&gt;<i> This is what twisted.python.failure.Failure.trap is for; you can catch
</I>&gt;<i> specific exception types in your errbacks.
</I>
Would you be able to give me an example how I can do this? I was
thinking about somehow (?) overriding _messageHandled? Is that not the
right way to go about it?

&gt;<i> Please feel free to ask more specifically if this doesn't answer your
</I>&gt;<i> question :).
</I>
Thanks! Please see above :-)

Jan



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051918.html">[Twisted-Python] How to use defer.fail better...
</A></li>
	<LI>Next message (by thread): <A HREF="051920.html">[Twisted-Python] What kind of throughput can we expect to achieve when using DatagramProtocol (UDP)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51919">[ date ]</a>
              <a href="thread.html#51919">[ thread ]</a>
              <a href="subject.html#51919">[ subject ]</a>
              <a href="author.html#51919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
