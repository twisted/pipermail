<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] sending large files from web2 http server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20sending%20large%20files%20from%20web2%20http%20server&In-Reply-To=%3C20090305154549.12853.624525997.divmod.quotient.18633%40henry.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051800.html">
   <LINK REL="Next"  HREF="051813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] sending large files from web2 http server</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20sending%20large%20files%20from%20web2%20http%20server&In-Reply-To=%3C20090305154549.12853.624525997.divmod.quotient.18633%40henry.divmod.com%3E"
       TITLE="[Twisted-Python] sending large files from web2 http server">exarkun at divmod.com
       </A><BR>
    <I>Thu Mar  5 08:45:49 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051800.html">[Twisted-Python] sending large files from web2 http server
</A></li>
        <LI>Next message (by thread): <A HREF="051813.html">[Twisted-Python] sending large files from web2 http server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51801">[ date ]</a>
              <a href="thread.html#51801">[ thread ]</a>
              <a href="subject.html#51801">[ subject ]</a>
              <a href="author.html#51801">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 05 Mar 2009 16:20:27 +0100, Markus Wanner &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">markus at bluegap.ch</A>&gt; wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I'm trying to stream longish data via web2, but experience sudden stalls
</I>&gt;<i>in data transfer, followed by a connection abort after a certain
</I>&gt;<i>timeout. I can't completely reproduce the issue, yet, but figured that
</I>&gt;<i>the size of the blocks I'm returning via the stream's read method
</I>&gt;<i>affects the failure rate (an stream.IByteStream implementation).
</I>&gt;<i>
</I>&gt;<i>I've tried with chunk sizes between 1 MiB down to 256 bytes. At that
</I>&gt;<i>rate, I suddenly get the following unhandled errors, which don't seem to
</I>&gt;<i>have to do much with my code.
</I>
I haven't looked at how web2 handles IByteStream providers, but my first
guess would be that this is an example of a somewhat common bug where
Deferreds are chained to an arbitrary length based on application data
and when there's too much application data, the chain gets too long (a
limit imposed by how much recursion is possible when unwinding the chain),
and you get this failure.

Alternatively, the bug I describe above might somehow have gotten into
your application code, rather than into Web2.  As you say, the stack
trace doesn't point to your code, but it doesn't point to Web2 code
either, and it's common in cases like this for the traceback to just
point at the implementation of Deferred, since that's where the bug
(or lack of feature, whatever) *really* is.

The main focus of web development in Twisted now is Twisted Web, not
Twisted Web2.  However, if you can supply a patch which fixes this
(along with unit tests, please :), then we'd be happy to apply it.

James Knight or David Reid might have a suggestion about where in the
code to start looking for the problem.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051800.html">[Twisted-Python] sending large files from web2 http server
</A></li>
	<LI>Next message (by thread): <A HREF="051813.html">[Twisted-Python] sending large files from web2 http server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51801">[ date ]</a>
              <a href="thread.html#51801">[ thread ]</a>
              <a href="subject.html#51801">[ subject ]</a>
              <a href="author.html#51801">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
