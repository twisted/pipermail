<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] pb and deferToThread for geographic data services	- Newbie woes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20pb%20and%20deferToThread%20for%20geographic%20data%20services%0A%09-%20Newbie%20woes&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019401.html">
   <LINK REL="Next"  HREF="019400.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] pb and deferToThread for geographic data services	- Newbie woes</H1>
    <B>Jeff Cavner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20pb%20and%20deferToThread%20for%20geographic%20data%20services%0A%09-%20Newbie%20woes&In-Reply-To="
       TITLE="[Twisted-Python] pb and deferToThread for geographic data services	- Newbie woes">jcavner at edac.unm.edu
       </A><BR>
    <I>Thu Mar 26 15:51:16 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019401.html">[Twisted-Python] how to create state machines?
</A></li>
        <LI>Next message: <A HREF="019400.html">[Twisted-Python] Re: Twisted-Python] how to create state machines?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19399">[ date ]</a>
              <a href="thread.html#19399">[ thread ]</a>
              <a href="subject.html#19399">[ subject ]</a>
              <a href="author.html#19399">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am trying to use Twisted to provide a high volume (with lots of
simultaneous requests) set of services that process and deliver several
different types of geographic data.  I am brand new to Twisted.  But a user
would come into the system through a Turbogears controller, where I intend
to write a Twisted perspective broker client to a pb server.  The server
will have different functions that ideally would operate in an asynchronous
fashion.   That is, the client would make a request for some processing on
one portion of the problem, while returning control and then another remote
function would be called to work on another part of the problem.  My
thinking was that I would have to use pb with deferToThread.  But I am
having a hard time finding any good examples that use both pb and
deferToThread.  In other words for a simple pb example like the following I
am unsure of where to add the deferToThread bits.

 

from twisted.spread import pb
from twisted.internet import reactor
from twisted.python import util
 
factory = pb.PBClientFactory()
reactor.connectTCP(&quot;localhost&quot;, 8789, factory)
d = factory.getRootObject()
d.addCallback(lambda object: object.callRemote(&quot;echo&quot;, &quot;hello network&quot;))
d.addCallback(lambda echo: 'server echoed: '+echo)
d.addErrback(lambda reason: 'error: '+str(reason.value))
d.addCallback(util.println)
d.addCallback(lambda _: reactor.stop())
reactor.run()

 

 

My attempt to modify the code above to take advantage of two remote function
calls (one long, and one short) to emulate longer processing times by a
function that should run while control is returned and the another function
called is woefully synchronous.

 

Here is that code:

 

from twisted.spread import pb

from twisted.internet import reactor

from twisted.python import util

from twisted.internet import threads

 

 

def getWMS():

    d.addCallback(lambda object: object.callRemote(&quot;long&quot;, &quot;hello long&quot;))

    d.addCallback(lambda long: 'server echoed: '+long)

    d.addErrback(lambda reason: 'error: '+str(reason.value))

    

 

def gotWMS(someobject):

    

    d.addCallback(util.println)

 

    

 

def getShort():

   e.addCallback(lambda object: object.callRemote(&quot;short&quot;, &quot;hello short&quot;))

   e.addCallback(lambda echo: 'server echoed: '+echo)

   e.addErrback(lambda reason: 'error: '+str(reason.value))

 

def gotShort(someobject):

 

   e.addCallback(util.println)

 

  

factory = pb.PBClientFactory()

reactor.connectTCP(&quot;localhost&quot;, 8789, factory)   

   

d = factory.getRootObject()

mythread = threads.deferToThread(getWMS)

mythread.addCallback(gotWMS)

 

e = factory.getRootObject()

mythread2 = threads.deferToThread(getShort)

mythread2.addCallback(gotShort)

 

reactor.run()

 

The long call always returns first and therefore stalls the return from the
short function. I was hoping, expecting to get the short call response back
before the long.  I am sure I am not thinking about any of this correctly.
Any pointers?????  Additionally does one have to get the rootObject for each
function call as I have done here?

 

Jeff Cavner

<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jcavner at edac.unm.edu</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20090326/2c2e846d/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20090326/2c2e846d/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019401.html">[Twisted-Python] how to create state machines?
</A></li>
	<LI>Next message: <A HREF="019400.html">[Twisted-Python] Re: Twisted-Python] how to create state machines?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19399">[ date ]</a>
              <a href="thread.html#19399">[ thread ]</a>
              <a href="subject.html#19399">[ subject ]</a>
              <a href="author.html#19399">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
