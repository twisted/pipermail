<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Using sqlalchemy in twisted.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Using%20sqlalchemy%20in%20twisted.&In-Reply-To=%3C1E93D9FE-316A-460B-8069-4865A53D52F8%40oda.state.or.us%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051791.html">
   <LINK REL="Next"  HREF="051793.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Using sqlalchemy in twisted.</H1>
    <B>Chris Foster</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Using%20sqlalchemy%20in%20twisted.&In-Reply-To=%3C1E93D9FE-316A-460B-8069-4865A53D52F8%40oda.state.or.us%3E"
       TITLE="[Twisted-Python] Using sqlalchemy in twisted.">cfoster at oda.state.or.us
       </A><BR>
    <I>Wed Mar  4 12:15:00 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051791.html">[Twisted-Python] Using sqlalchemy in twisted.
</A></li>
        <LI>Next message (by thread): <A HREF="051793.html">[Twisted-Python] Using sqlalchemy in twisted.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51792">[ date ]</a>
              <a href="thread.html#51792">[ thread ]</a>
              <a href="subject.html#51792">[ subject ]</a>
              <a href="author.html#51792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think SQLAlchemy's ORM might work fine with Twisted.  Check out <A HREF="http://foss.eepatents.com/sAsync/">http://foss.eepatents.com/sAsync/</A> 
  .  sAsync doesn't appear to be widely used, but I got the examples  
to run with some minor changes to the sqlite connection.  I'm hoping  
to try something useful in the next week or two.

On Mar 4, 2009, at 11:04 AM, Valentino Volonghi wrote:

&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mar 4, 2009, at 3:28 AM, Peter Cai wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> The code doesn't work.   When I limit the thread numbers to 1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   reactor.suggestThreadPoolSize(1)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Everything goes fine.  Other wise the server would be blocked and  
</I>&gt;&gt;<i> must
</I>&gt;&gt;<i> be killed by &quot;kill 9 ...&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The result conflicts with my understanding of sqlalchemy.  Since I
</I>&gt;&gt;<i> don't share any object between threads, there should be no problem!
</I>&gt;<i>
</I>&gt;<i> I'm pretty sure you can't say this with full certainty and actually  
</I>&gt;<i> you are
</I>&gt;<i> just wrong based on the code you showed. deferToThread doesn't use
</I>&gt;<i> the same thread every time you call it, there's absolutely no  
</I>&gt;<i> guarantee
</I>&gt;<i> in that and sqlalchemy keeps state around in that thread related to  
</I>&gt;<i> that
</I>&gt;<i> object it returned. If you want to do any operations you need either  
</I>&gt;<i> to
</I>&gt;<i> detach the object from the session before returning it and do any  
</I>&gt;<i> modification
</I>&gt;<i> on the same object in another thread after reattaching it (pretty  
</I>&gt;<i> cumbersome).
</I>&gt;<i>
</I>&gt;<i> Or write your own threadpool that gives names to threads so that you  
</I>&gt;<i> can
</I>&gt;<i> have a guarantee that you always call the same thread when working  
</I>&gt;<i> with
</I>&gt;<i> a bunch of objects.
</I>&gt;<i>
</I>&gt;<i> Nonetheless though sqlalchemy is a huge project and I'm pretty sure  
</I>&gt;<i> it has
</I>&gt;<i> some deadlocks and race conditions around which means that even taking
</I>&gt;<i> care of these issues you'll have other problems when dealing with  
</I>&gt;<i> the orm.
</I>&gt;<i>
</I>&gt;<i> If you want to use sqlalchemy don't use its orm but just the query  
</I>&gt;<i> builder,
</I>&gt;<i> it's the only sane way to integrate with twisted. Which anyway IMHO  
</I>&gt;<i> is the
</I>&gt;<i> best way to use it anyway because it uses a lot less memory since it  
</I>&gt;<i> doesn't
</I>&gt;<i> have to always cache objects because you control everything and can  
</I>&gt;<i> make
</I>&gt;<i> that call when you really need it.
</I>&gt;<i>
</I>&gt;&gt;<i> Ah....  It always have risk to use something you haven't tried
</I>&gt;&gt;<i> before ....
</I>&gt;&gt;<i> I think I have no choice but always set thread pool size to 1 ...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Not entirely true.
</I>&gt;<i>
</I>&gt;<i> - --
</I>&gt;<i> Valentino Volonghi aka Dialtone
</I>&gt;<i> Now running MacOS X 10.5
</I>&gt;<i> Home Page: <A HREF="http://www.twisted.it">http://www.twisted.it</A>
</I>&gt;<i> <A HREF="http://www.adroll.com">http://www.adroll.com</A>
</I>&gt;<i>
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v1.4.9 (Darwin)
</I>&gt;<i>
</I>&gt;<i> iEYEARECAAYFAkmu0NoACgkQ9Llz28widGXBawCg32svBsLqsIRLzvzOThgR4sA0
</I>&gt;<i> 5UkAoIgNfyUDPl9c0nwSud0sem3aKjz5
</I>&gt;<i> =2XIX
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051791.html">[Twisted-Python] Using sqlalchemy in twisted.
</A></li>
	<LI>Next message (by thread): <A HREF="051793.html">[Twisted-Python] Using sqlalchemy in twisted.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51792">[ date ]</a>
              <a href="thread.html#51792">[ thread ]</a>
              <a href="subject.html#51792">[ subject ]</a>
              <a href="author.html#51792">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
