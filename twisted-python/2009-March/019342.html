<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Noob Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Noob%20Question&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019353.html">
   <LINK REL="Next"  HREF="019344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Noob Question</H1>
    <B>David Bolen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Noob%20Question&In-Reply-To="
       TITLE="[Twisted-Python] Re: Noob Question">db3l.net at gmail.com
       </A><BR>
    <I>Sat Mar 14 15:36:56 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019353.html">[Twisted-Python] Noob Question
</A></li>
        <LI>Next message: <A HREF="019344.html">[Twisted-Python] Re: Noob Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19342">[ date ]</a>
              <a href="thread.html#19342">[ thread ]</a>
              <a href="subject.html#19342">[ subject ]</a>
              <a href="author.html#19342">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Shelby Ramsey &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sicfslist at gmail.com</A>&gt; writes:

&gt;<i> The events have a Content-Length: \d+ as the protocol for determining the
</I>&gt;<i> length of the message.  What I'm struggling with is how to parse that and
</I>&gt;<i> then receive just that length as an individual message ...
</I>
It would probably help to see the general framework of your server
class to be more specific, but in general, try implementing a
LineReceiver protocol that starts in line mode and then switches to
raw mode after receiving the event header, switching back after
receiving the appropriate amount of raw information.

You don't mention if the Content-Length header ends with a CRLF or
not, but if it doesn't and you have control of the protocol, I'd
suggest making it do so.  If you can't control that you'll have to do
your own protocol to identify when the header is actually done - using
LineReceiver as a model would probably be helpful.

Here's an old post of mine showing something an approach I use in one of
my applications that receives a binary file after a short header with some
identification and length information.

<A HREF="http://www.twistedmatrix.com/pipermail/twisted-python/2007-July/015738.html">http://www.twistedmatrix.com/pipermail/twisted-python/2007-July/015738.html</A>

You'll have some additional complexity in that you will have to manually
observe the transition between any final raw data from the last event and
the beginning of the next event.  But that's not too bad - just identify
when your remaining raw bytes hits zero, and anything else you have left
in that callback is for the subsequent event.

Luckily, Twisted's LineReceiver also anticipated this use case.  When
your raw data receiver switches back to line mode with setLineMode,
you can pass in the extra data, and it will automatically be reparsed,
calling lineReceived() if appropriate or else holding on for the rest
of the upcoming event header.

-- David



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019353.html">[Twisted-Python] Noob Question
</A></li>
	<LI>Next message: <A HREF="019344.html">[Twisted-Python] Re: Noob Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19342">[ date ]</a>
              <a href="thread.html#19342">[ thread ]</a>
              <a href="subject.html#19342">[ subject ]</a>
              <a href="author.html#19342">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
