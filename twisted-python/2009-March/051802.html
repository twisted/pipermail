<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] _Win32Waker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20_Win32Waker&In-Reply-To=%3C34457a4c0903051449m7b4845e1yd402d7287773fd2e%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] _Win32Waker</H1>
    <B>Aron Bierbaum</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20_Win32Waker&In-Reply-To=%3C34457a4c0903051449m7b4845e1yd402d7287773fd2e%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] _Win32Waker">aronbierbaum at gmail.com
       </A><BR>
    <I>Thu Mar  5 15:49:15 MST 2009</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51802">[ date ]</a>
              <a href="thread.html#51802">[ thread ]</a>
              <a href="subject.html#51802">[ subject ]</a>
              <a href="author.html#51802">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have been using a custom Qt4 reactor that derives from
PosixReactorBase. As a result it creates a _Win32Waker to allow
threads and signals to wake up the IO thread. It seems though that the
current implementation only works about half of the time. The other
half it exists with :

  File &quot;...\Lib\python2.6\site-packages\twisted\internet\posixbase.py&quot;,
line 170, in __init__
    ReactorBase.__init__(self)
  File &quot;...\Lib\python2.6\site-packages\twisted\internet\base.py&quot;,
line 424, in __init__
    self._initThreads()
  File &quot;...\Lib\python2.6\site-packages\twisted\internet\base.py&quot;,
line 813, in _initThreads
    self.installWaker()
  File &quot;...\Lib\python2.6\site-packages\twisted\internet\posixbase.py&quot;,
line 206, in installWaker
    self.waker = _Waker(self)
  File &quot;...\Lib\python2.6\site-packages\twisted\internet\posixbase.py&quot;,
line 77, in __init__
    client.connect(server.getsockname())
  File &quot;&lt;string&gt;&quot;, line 1, in connect
socket.error: [Errno 10049] The requested address is not valid in its context

I have attached a simple test that shows that the following code does
not always return &quot;127.0.0.1&quot;, but sometimes returns &quot;0.0.0.0&quot; as the
IP address.

        # Following select_trigger (from asyncore)'s example;
        server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        client.setsockopt(socket.IPPROTO_TCP, 1, 1)
        server.bind(('127.0.0.1', 0))
        server.listen(1)
        client.connect(server.getsockname())

My current workaround just calls the following instead:

        client.connect(('127.0.0.1', server.getsockname()[1]))

Any ideas on what is really causing the error? If there is not a
better solution can this be added to trunk for future releases?

Thanks,
Aron
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test.py
Type: application/octet-stream
Size: 188 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20090305/b5f626f4/attachment-0002.obj&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51802">[ date ]</a>
              <a href="thread.html#51802">[ thread ]</a>
              <a href="subject.html#51802">[ subject ]</a>
              <a href="author.html#51802">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
