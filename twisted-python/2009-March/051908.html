<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Twisted-Python] how to create state machines?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Twisted-Python%5D%20how%20to%20create%20state%20machines%3F&In-Reply-To=%3C823535.95708.qm%40web34206.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051907.html">
   <LINK REL="Next"  HREF="051914.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Twisted-Python] how to create state machines?</H1>
    <B>Andrew Francis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Twisted-Python%5D%20how%20to%20create%20state%20machines%3F&In-Reply-To=%3C823535.95708.qm%40web34206.mail.mud.yahoo.com%3E"
       TITLE="[Twisted-Python] Re: Twisted-Python] how to create state machines?">andrewfr_ice at yahoo.com
       </A><BR>
    <I>Thu Mar 26 22:48:48 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051907.html">[Twisted-Python] pb and deferToThread for geographic data services	- Newbie woes
</A></li>
        <LI>Next message (by thread): <A HREF="051914.html">[Twisted-Python] Mac-owning Twisted programmer(s) wanted for	interactive museum project
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51908">[ date ]</a>
              <a href="thread.html#51908">[ thread ]</a>
              <a href="subject.html#51908">[ subject ]</a>
              <a href="author.html#51908">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Doug:

&gt;<i>Message: 1
</I>&gt;<i>Date: Thu, 26 Mar 2009 14:26:17 -0400
</I>&gt;<i>From: &quot;Doug Farrell&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dfarrell at mypublisher.com</A>&gt;
</I>&gt;<i>Subject: [Twisted-Python] how to create state machines?
</I>&gt;<i>To: &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
</I>&gt;<i>Message-ID:
</I>    &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">318F79422ADC5041A93343721F84474D01A8BB43 at exchange.mypublisher.local</A>&gt;
&gt;<i>Content-Type: text/plain; charset=&quot;us-ascii&quot;
</I>
&gt;<i>This state machine initializes a system, issues an asynchronous command
</I>&gt;<i>that takes time to complete (say a motor move command) and then waits
</I>&gt;<i>for that command to be done before exiting. In the context of a
</I>&gt;<i>framework that is calling this state machine, the WAITCMD1 is executed
</I>&gt;<i>repeatedly (polling) while the asynchronous command completes. A system
</I>&gt;<i>can be constructed with lots of little state machines like this and be
</I>&gt;<i>made to look like it is doing many things at once even though the
</I>&gt;<i>execution of the program is single threaded.
</I>
&gt;<i>I understand (pretty much) the Twisted framework is like this and
</I>&gt;<i>implmenting event handlers like connectionMade(), etc., is a state
</I>&gt;<i>machine, but I'm wondering how to implement what I've outlined above in
</I>&gt;<i>one of Twisted's state event handlers, or inside something like
</I>&gt;<i>callLater(). For example, let's say I want to use Twisted to run a long
</I>&gt;<i>running daemon process that has an XMLRPC interface. That XMLRPC
</I>&gt;<i>interface is an interface to a state machine inside Twisted that allows
</I>&gt;<i>the caller to change state, or start new state machines, or get the
</I>&gt;<i>status of a running state machine. In that case I'm thinking I want a
</I>&gt;<i>state machine the runs continuously in the Twisted loop, structured like
</I>&gt;<i>the example above; co-operatively yielding back to Twisted, but running
</I>&gt;<i>non-stop. Something like callLater(1, stateMachine), but non-stop,
</I>&gt;<i>without even the 1 second call loop.
</I>
If I understand your correctly, I don't think you need to implement a state machine to simulate concurrency with Twisted - Twisted does a lot of that for you. You can think of a Twisted application as a state machine - the callback being the state and the completion of the operation and the calling of the callback is the transition. These callbacks at runtime act like a thread of execution. 

def Initialize(...):
    # do something
    deferred = someFunctionThatReturnsADeferred()
    deferred.addCallback(State2)

def State2(...):
    # do something
    deferred = someFunctionThatReturnsADeferred()
    deferred.addCallback(State3)

def State3(someData):
    # do something 
    if someData == 'State4':
       deferred = someFunctionThatReturnsADeferred()
       func = State4
    elif someData == 'State5':
       deferred = someOtherFunctionThatReturnsADeferred()
       func = State5
    ...
    deferred.addCallback(func)

if __name__ = &quot;__main__&quot;:
   initialize()
   reactor.run()

As for the Twisted loop. Well, you don't really see the Twisted loop since that is hidden in the reactor. Also you should distinguish between writing a new protocol and using an existing one. 

In the case of XMLRPC, creating the server isn't the problem. 

<A HREF="http://twistedmatrix.com/projects/web/documentation/howto/xmlrpc.html">http://twistedmatrix.com/projects/web/documentation/howto/xmlrpc.html</A>

Once a XMLRPC server is created, Twisted will take responsibility for creating new instances (or threads if you want to see it that way). If you still need a state machine, then the only hiccup I can see is sharing  state machine (if you really need one) between XMLRPC method invocations.

Cheers,
Andrew









      


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051907.html">[Twisted-Python] pb and deferToThread for geographic data services	- Newbie woes
</A></li>
	<LI>Next message (by thread): <A HREF="051914.html">[Twisted-Python] Mac-owning Twisted programmer(s) wanted for	interactive museum project
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51908">[ date ]</a>
              <a href="thread.html#51908">[ thread ]</a>
              <a href="subject.html#51908">[ subject ]</a>
              <a href="author.html#51908">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
