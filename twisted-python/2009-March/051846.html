<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Using sqlalchemy in twisted.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Using%20sqlalchemy%20in%20twisted.&In-Reply-To=%3C4e0636f40903130400u1c1b6975tae85d81ccedc2952%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051842.html">
   <LINK REL="Next"  HREF="051796.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Using sqlalchemy in twisted.</H1>
    <B>luper rouch</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Using%20sqlalchemy%20in%20twisted.&In-Reply-To=%3C4e0636f40903130400u1c1b6975tae85d81ccedc2952%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Using sqlalchemy in twisted.">luper.rouch at gmail.com
       </A><BR>
    <I>Fri Mar 13 05:00:37 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051842.html">[Twisted-Python] Using sqlalchemy in twisted.
</A></li>
        <LI>Next message (by thread): <A HREF="051796.html">[Twisted-Python] Using sqlalchemy in twisted.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51846">[ date ]</a>
              <a href="thread.html#51846">[ thread ]</a>
              <a href="subject.html#51846">[ subject ]</a>
              <a href="author.html#51846">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/3/12 Peter Cai &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">newptcai at gmail.com</A>&gt;:
&gt;<i> Hi,
</I>&gt;<i> I've read some mails in this list that recommend use sqlalchemy in separate
</I>&gt;<i> processes.
</I>&gt;<i> But if u use multiprocessing which provides only synchronous API, doesn't
</I>&gt;<i> you have to use deferToThread also?
</I>&gt;<i> Another way would be using &quot;twisted.internet.protocol.ProcessProtocol&quot;,
</I>&gt;<i> which use pipes.  But can we pass SA Objects through pipes?
</I>&gt;<i> If you can write a little code to describe how you use multiprocessing,  I
</I>&gt;<i> will be very thankful!
</I>
multiprocessing [1] works like the threading module, except that it
runs callables in subprocesses instead of threads.

To pass python objects to your process you can use the primitives
offered by the modules (Queue, Pipe, Connection...). Here is a minimal
example using Queue :

Child process implementation (let's call it my_twisted_module.py):
--------------------------
from twisted.internet import reactor, task

dispatch_task = None
in_queue = None
out_queue = None

def recv():
    obj = in_queue.get_nowait()
    [do whatever you want with obj]

def send(obj):
    out_queue.put_nowait(obj)

def twisted_process(inq, outq):
    global dispatch_task, in_queue, out_queue
    in_queue = inq
    out_queue = outq
    dispatch_task = task.LoopingCall(recv)
    dispatch_task.start(0.1)
    reactor.run()
--------------------------

On the parent process side:
--------------------------
from my_twisted_module import twisted_process

[something similar to the child process implementation for communications]

# Note that out_queue in this side is passed as in_queue to the other
side and vice versa
in_queue = Queue()
out_queue = Queue()
p = multiprocessing.Process(target=twisted_process, args=(out_queue, in_queue))
p.start()
--------------------------

You can pass any python object through the queues as long as it is
picklabe. Passing SA objects is probably not a good idea though as
this whole mess is about isolating Twisted from SA :) In my project I
organized the communications with a dispatcher (louie [2]), and I pass
signals through the queues. This way I have a well defined protocol to
communicate with the sub process(es).

Although I did not do any timing I think the communications between
the processes must introduce some significant overhead, so it is
probably not a good idea to do this if you pass objects all the time.
In my case, the communications are limited to initialization calls,
status keeping, etc...

Luper

[1]<A HREF="http://docs.python.org/library/multiprocessing.html">http://docs.python.org/library/multiprocessing.html</A>
[2]<A HREF="http://pylouie.org/">http://pylouie.org/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051842.html">[Twisted-Python] Using sqlalchemy in twisted.
</A></li>
	<LI>Next message (by thread): <A HREF="051796.html">[Twisted-Python] Using sqlalchemy in twisted.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51846">[ date ]</a>
              <a href="thread.html#51846">[ thread ]</a>
              <a href="subject.html#51846">[ subject ]</a>
              <a href="author.html#51846">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
