<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lore%20and%20generating%20reStructuredText%0A%09%28Lore2Sphinx%29&In-Reply-To=4804AB74-C814-4306-89F0-E381E34E248D%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026730.html">
   <LINK REL="Next"  HREF="026743.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)</H1>
    <B>Kevin Horn</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lore%20and%20generating%20reStructuredText%0A%09%28Lore2Sphinx%29&In-Reply-To=4804AB74-C814-4306-89F0-E381E34E248D%40twistedmatrix.com"
       TITLE="[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)">kevin.horn at gmail.com
       </A><BR>
    <I>Tue Mar 26 10:03:58 EDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026730.html">[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)
</A></li>
        <LI>Next message: <A HREF="026743.html">[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26735">[ date ]</a>
              <a href="thread.html#26735">[ thread ]</a>
              <a href="subject.html#26735">[ subject ]</a>
              <a href="author.html#26735">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Mar 25, 2013 at 6:29 PM, Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On Mar 25, 2013, at 9:16 AM, Kevin Horn &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.horn at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> How can you tell that this was created by a directive?  You can't, because
</I>&gt;<i> it could just as easily have been a list full of links to begin with.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> But, I don't care if it was created by a directive or not.
</I>&gt;<i>
</I>&gt;<i> I think we're talking about two different things.
</I>&gt;<i>
</I>&gt;<i> What you seem to be talking about is using Sphinx to do source-to-source
</I>&gt;<i> Lore-to-ReST transformation.  In that case, you're (sort of) right, in that
</I>&gt;<i> information is lost when you invoke directives.  If we did this, and it
</I>&gt;<i> worked, it would just be a slightly better way to implement lore2sphinx;
</I>&gt;<i> we'd still need to manage the transition in largely the same way.
</I>&gt;<i>
</I>&gt;<i> What *I'm* talking about is just using Lore source as an input to Sphinx,
</I>&gt;<i> and going straight to the output HTML.  In order to do this, we just need
</I>&gt;<i> to construct the right tree and actually *invoke* the directive callables
</I>&gt;<i> at the right time.  They produce whatever output they want to produce, and
</I>&gt;<i> we hand that back to Sphinx, and it outputs some docs.  With this strategy,
</I>&gt;<i> we just switch to sphinx by switching our build process; we don't switch
</I>&gt;<i> input formats.  Then, if someone wants to use Lore they can, if they want
</I>&gt;<i> to use ReST they can, and we can migrate on an as-needed basis; there's no
</I>&gt;<i> need for a single big format migration for us to start using Sphinx.
</I>&gt;<i>
</I>&gt;<i>
</I>Hmmm.  We are indeed talking about two different things.

What you describe is probably technically possible, but I still don't think
it's a very good approach.  It seems to me that it would be very brittle
and error prone.  You'd need to:
- figure out the node output of every directive you were trying to
replicate, with every type of (tedious in the best case, possibly very
tricky for some directives, but maybe not too bad)
- figure out a system to &quot;inject&quot; those nodes at the right time (not sure
how difficult this would be)
- figure out how Sphinx modifies the doctrees to do all it's linking, index
generation, toctree handling, etc. (I think this is the hardest part)
- figure out a way to get Sphinx to take doctrees as input (I'm guessing
you'd serialize them in whatever way Sphinx does when it does it's caching,
stick them in the cache, and then get Sphinx to build from the cache?)

What about changing the build process to use some kind of tool that goes
over the doc files, and if a source file is in lore format, it translates
it using rstgen, and if it's already a rst file, it just copies it into the
Sphinx project as-is?  Then just build the Sphinx project.  I think this
would be a lot less hassle than trying to decipher and replicate a bunch of
docutils and Sphinx internals, and would really only be a minor change to
the way that the lore2sphinx command line tool already works.  It just
processes each lore file and sends the output to an output directory, so
you'd just need to modify it to skip the processing and only copy rst files.

With the new refactoring of lore2sphinx into lore2sphinx-ng, I think this
is possible and would yield acceptable results.  Of course someone still
would need to finish lore2sphinx-ng and rstgen, but that's either going to
have to happen anyway, or some other tool would have to be built that mucks
with doctrees.

Thoughts?

--
Kevin Horn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130326/46223bda/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130326/46223bda/attachment.htm</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026730.html">[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)
</A></li>
	<LI>Next message: <A HREF="026743.html">[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26735">[ date ]</a>
              <a href="thread.html#26735">[ thread ]</a>
              <a href="subject.html#26735">[ subject ]</a>
              <a href="author.html#26735">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
