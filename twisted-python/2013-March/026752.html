<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Problems with TLS connection not shutting down.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problems%20with%20TLS%20connection%20not%20shutting%20down.&In-Reply-To=CA%2BbfVEj6ez8HLNHKKg-WoXoNTN7LYhAg-J8w6z%2Bag9wABF2SLw%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026750.html">
   <LINK REL="Next"  HREF="026753.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Problems with TLS connection not shutting down.</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problems%20with%20TLS%20connection%20not%20shutting%20down.&In-Reply-To=CA%2BbfVEj6ez8HLNHKKg-WoXoNTN7LYhAg-J8w6z%2Bag9wABF2SLw%40mail.gmail.com"
       TITLE="[Twisted-Python] Problems with TLS connection not shutting down.">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Mar 28 18:36:22 EDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026750.html">[Twisted-Python] Problems with TLS connection not shutting down.
</A></li>
        <LI>Next message: <A HREF="026753.html">[Twisted-Python] Problems with TLS connection not shutting down.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26752">[ date ]</a>
              <a href="thread.html#26752">[ thread ]</a>
              <a href="subject.html#26752">[ subject ]</a>
              <a href="author.html#26752">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Mar 28, 2013, at 9:24 AM, Michael Williamson &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">williamson.michaelr at gmail.com</A>&gt; wrote:

&gt;<i> Hi, I'm having an issue where a tls connection never seems to shutdown properly, and as a result, all the associated cleanup never happens.
</I>&gt;<i> 
</I>&gt;<i> Basically we're trying to implement a jabber client and allow the user to sign out and then re-sign back in without completely quitting the program.  When the user tries to sign back in, Twisted goes nuts because the original connection was never shutdown properly.
</I>&gt;<i> 
</I>&gt;<i> So, I traced through the code with the debugger and I came to the _shutdownTLS() function in tls.py.  I believe that what's supposed to happen is that the first time through, the self._tlsConnection.shutdown() returns False because the shutdown is initiated.  Then, when the 2nd part of the shutdown handshake comes back from the server, dataReceived is called, which calls shutdownTLS again, and then the cleanup can continue.
</I>&gt;<i> 
</I>&gt;<i> The problem is that after the initial call to shutdownTLS, I never see anymore data from the server.  I'm not sure if it's a server issue (we're just connecting to the Google jabber servers) where they don't close down their SSL connections correctly, or if I'm just doing something silly.  So anyway, I could solve this by overriding a bunch of stuff and ensuring that self.transport.loseConnection() gets called no matter what, even when the server doesn't respond with the second part of the close handshake, but I figured I'd ask here first.
</I>&gt;<i> 
</I>&gt;<i> So, any TLS experts out there?  Thanks for any help or information - I really appreciate it,
</I>
Sadly I don't know enough about TLS specifics to tell you for sure.

It sounds like you may have spotted a bug.  More investigation is required though.  Does .abortConnection() do what you expect?  In your current problematic scenario, does the TCP connection to your peer stay alive?

-glyph



</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026750.html">[Twisted-Python] Problems with TLS connection not shutting down.
</A></li>
	<LI>Next message: <A HREF="026753.html">[Twisted-Python] Problems with TLS connection not shutting down.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26752">[ date ]</a>
              <a href="thread.html#26752">[ thread ]</a>
              <a href="subject.html#26752">[ subject ]</a>
              <a href="author.html#26752">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
