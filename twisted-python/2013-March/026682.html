<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lore%2C%20Sphinx%2C%0A%20and%20getting%20to%20the%20finish%20line%20%28was%3A%20re%3A%20lore%20and%20tickets%20and%20other%0A%20stuff%29&In-Reply-To=CA%2BU%3DzK178dwz6A_%2BV1cy60rK0O-b3KC01dzjEQkdKj82iXB_sw%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026647.html">
   <LINK REL="Next"  HREF="026583.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)</H1>
    <B>Abdul Rauf</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lore%2C%20Sphinx%2C%0A%20and%20getting%20to%20the%20finish%20line%20%28was%3A%20re%3A%20lore%20and%20tickets%20and%20other%0A%20stuff%29&In-Reply-To=CA%2BU%3DzK178dwz6A_%2BV1cy60rK0O-b3KC01dzjEQkdKj82iXB_sw%40mail.gmail.com"
       TITLE="[Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)">abdulraufhaseeb at gmail.com
       </A><BR>
    <I>Sat Mar 16 06:22:47 EDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026647.html">[Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)
</A></li>
        <LI>Next message: <A HREF="026583.html">[Twisted-Python] Need help regarding Gsoc 2013
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26682">[ date ]</a>
              <a href="thread.html#26682">[ thread ]</a>
              <a href="subject.html#26682">[ subject ]</a>
              <a href="author.html#26682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I am very much interested to complete this project, i did apply to
Gsoc last time with this project and was rejected (however there were
better students). And i would be happy if i can take this time. Let me
know your thoughts.


On 3/7/13, Kevin Horn &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.horn at gmail.com</A>&gt; wrote:
&gt;<i> Sorry it's taken me so long to get back to this.  But it's gotten to be a
</I>&gt;<i> Looong email.
</I>&gt;<i>
</I>&gt;<i> On Sat, Mar 2, 2013 at 3:14 AM, Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mar 1, 2013, at 9:35 PM, Kevin Horn &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.horn at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That &quot;never-ending&quot; series of Lore source fixes took place over the
</I>&gt;&gt;<i> course
</I>&gt;&gt;<i> of a couple of weeks.  Doing things that way was not my idea, though it
</I>&gt;&gt;<i> seemed reasonable at the time because  the idea was that we would do the
</I>&gt;&gt;<i> cutover at the end of it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Well, let's go to the video tape. Based on this comment -  &lt;
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/trac/ticket/4500#comment:12">http://twistedmatrix.com/trac/ticket/4500#comment:12</A>&gt; - these tickets
</I>&gt;&gt;<i> were closed over a period ranging from 2010/07 to 2011/03. 6 months isn't
</I>&gt;&gt;<i> quite &quot;weeks&quot;, but okay I guess it wasn't &quot;never-ending&quot; either :).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> Hmmm.  I recall it as being much shorter.  Probably most of the work took
</I>&gt;<i> place it two &quot;spurts&quot; around the beginning and end of that time, and that's
</I>&gt;<i> why I remember it that way.  But I'm not interested in digging through a
</I>&gt;<i> bunch of old dates to find out for sure.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> (As an aside, lore2sphinx is in no way a &quot;broken pile of regexes&quot;.  Not
</I>&gt;&gt;<i> to
</I>&gt;&gt;<i> say that it isn't broken in some really significant ways, because it is,
</I>&gt;&gt;<i> but it doesn't use regexes at all.  Just sayin'.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Actually yeah, &quot;regex&quot; is just a curse-word here :).  It's the emitter
</I>&gt;&gt;<i> I'm
</I>&gt;&gt;<i> complaining about, anyway, not the parser, so deriding it as a &quot;regex&quot; is
</I>&gt;&gt;<i> in no way accurate.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I figured that was the case, I just wanted to say something so others
</I>&gt;<i> reading this didn't get the wrong impression about how lore2sphinx is
</I>&gt;<i> implemented.  I mean it's not code I'm very proud of, but it's not _that_
</I>&gt;<i> bad :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;&lt;&lt; snip a bunch of stuff about who said what when, why I thought what I
</I>&gt;<i> thought, etc. &gt;&gt;&gt;
</I>&gt;<i>
</I>&gt;<i> It boils down to the fact that a bunch of the conversations happened either
</I>&gt;<i> in person or on IRC.  This was mostly because I was in a hurry at the time,
</I>&gt;<i> usually because I wanted to do something before additions were made to the
</I>&gt;<i> documentation, which was in a somewhat &quot;known&quot; state (as in I knew how it
</I>&gt;<i> was going to behave when run through lore2sphinx) at the time.
</I>&gt;<i>
</I>&gt;<i> Also, please elaborate on what you mean  by &quot;do *everything* in one big
</I>&gt;&gt;<i> bang.  My intention was never to do anything but get the SphinxBuilder
</I>&gt;&gt;<i> working on that branch.  Was there something else you thought I was
</I>&gt;&gt;<i> doing?
</I>&gt;&gt;<i>  Was there something else I should (or should not) have been doing?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My reasoning goes like this: the ticket for the release tools is still
</I>&gt;&gt;<i> not
</I>&gt;&gt;<i> in review, so you must be waiting for something to re-submit it.  It
</I>&gt;&gt;<i> looks
</I>&gt;&gt;<i> like you responded to the code, so the only thing I could think you were
</I>&gt;&gt;<i> still waiting for would be for the lore sources themselves to be ready.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> It's been long enough that I can't fully recall my reasoning on this.  But
</I>&gt;<i> _probably_ I decided that if I finished the release tools ticket, someone
</I>&gt;<i> might use it.  Which would be great, except that I think I had decided that
</I>&gt;<i> before that actually happened I needed to figure out a way to emit nicer
</I>&gt;<i> output from lore2sphinx.  So I left it alone until I had figured out how to
</I>&gt;<i> do that.
</I>&gt;<i>
</I>&gt;<i> At least, that _might_ have been part of my thought process.  It really was
</I>&gt;<i> ages ago.
</I>&gt;<i>
</I>&gt;<i> [the fixed-up Lore sources] got left alone because of the release tools
</I>&gt;&gt;<i> hangup.  Ideally the release tools would have been done before the whole
</I>&gt;&gt;<i> lore-source-tweaking process, but they weren't.  I'll admit my
</I>&gt;&gt;<i> frustration
</I>&gt;&gt;<i> played a part in this, but so did the deafening silence I got when I
</I>&gt;&gt;<i> asked
</I>&gt;&gt;<i> for anyone to comment on the ticket.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Where and how did you ask people to comment on the ticket?  I don't
</I>&gt;&gt;<i> recall
</I>&gt;&gt;<i> being asked, and I tend to be pretty good about leaving prompts like that
</I>&gt;&gt;<i> in my inbox until I've done what was asked.  (Not *perfect*, of course,
</I>&gt;&gt;<i> and
</I>&gt;&gt;<i> if you asked a list then there might have been some bystander effect.)
</I>&gt;&gt;<i> It
</I>&gt;&gt;<i> seems like we might have avoided this whole mess if you had just attached
</I>&gt;&gt;<i> the 'review' keyword :).
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On IRC.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My perception has been that I would say &quot;what do we need to do to make
</I>&gt;&gt;<i> this happen&quot;?  There would be some hemming and hawing (and at least
</I>&gt;&gt;<i> several
</I>&gt;&gt;<i> times long discussions about how documentation didn't really fit the
</I>&gt;&gt;<i> regular UQDS process) and a sort of plan would be invented.  I would
</I>&gt;&gt;<i> proceed according to the plan as I understood it.  I would then say &quot;OK,
</I>&gt;&gt;<i> we're ready&quot;!  And then be told that some other thing not in the plan
</I>&gt;&gt;<i> needed to be done.  The cycle would then repeat.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The only &quot;cycle&quot; I can either see on the tickets or recall here is where
</I>&gt;&gt;<i> the release tools didn't come in to the initial plan.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This was the latest of several (3 or 4) according to my
</I>&gt;<i> recollection/perception.  It doesn't really matter now.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> No [the need for release automation] was not brought up until well into
</I>&gt;&gt;<i> the process. I (sort of) understand the desire for this, but it seems
</I>&gt;&gt;<i> pretty weird to be building what is essentially a wrapper for an existing
</I>&gt;&gt;<i> tool, along with tests for said wrapper,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> OK.  I can believe that this did not happen.  One problem is that we (the
</I>&gt;&gt;<i> inner-circle old-school Twisted developers) tend to engage in
</I>&gt;&gt;<i> conversations
</I>&gt;&gt;<i> about how a thing might be done while at the same time we discuss what
</I>&gt;&gt;<i> must
</I>&gt;&gt;<i> be done.  And we also tend to discuss what policy is (or what all or some
</I>&gt;&gt;<i> of us believe it *ought to be* in some case, further confusing the issue)
</I>&gt;&gt;<i> without making explicit what the *purpose* of that requirement is.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would ask the community to help us with this by doing a couple of
</I>&gt;&gt;<i> things.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If somebody says &quot;X is policy&quot;, always ask for a link to it.  If there is
</I>&gt;&gt;<i> a link, it'll help you understand it better.  If there *isn't* a link,
</I>&gt;&gt;<i> then the authority telling you it's &quot;policy&quot; might just be remembering
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i> it's the way we've done things since forever and of course it's a good
</I>&gt;&gt;<i> idea.  There are definitely things that I have thought were in the coding
</I>&gt;&gt;<i> standard that are not actually written down anywhere, on more than one
</I>&gt;&gt;<i> occasion.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If a meandering discussion is happening - here, on the mailing list, on
</I>&gt;&gt;<i> the ticket - never be afraid to break it up and separate out the
</I>&gt;&gt;<i> different
</I>&gt;&gt;<i> concerns which are being discussed: what is necessary for compliance with
</I>&gt;&gt;<i> our development process, what would be a good idea from a design point of
</I>&gt;&gt;<i> view, how the work might be broken up to get through review more
</I>&gt;&gt;<i> manageably, what other concerns are in play.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Especially, if you ever see a code review where a reviewer says &quot;I
</I>&gt;&gt;<i> think...&quot; without making it clear what you should *do*, you should always
</I>&gt;&gt;<i> ask, 'is this a requirement of the review or just some thoughts you
</I>&gt;&gt;<i> have'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> And when we ask, we should ask on the ticket, and put it back into review,
</I>&gt;<i> yes?  Because I think this was the part (or at least _A_ part) I was really
</I>&gt;<i> missing here.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> There's also the problem of &quot;I think you should...&quot; being interpreted as
</I>&gt;&gt;<i> &quot;You must...&quot;.  It is *very* hard to consistently separate design
</I>&gt;&gt;<i> feedback from code review, although we try very hard; but, it's hard to
</I>&gt;&gt;<i> separate it out when reading it as well.  So one important point to keep
</I>&gt;&gt;<i> in
</I>&gt;&gt;<i> mind is that, as the author of a proposed change, outside the things that
</I>&gt;&gt;<i> are agreed upon policy consensus, you always have some degree of
</I>&gt;&gt;<i> discretion
</I>&gt;&gt;<i> to disagree with a reviewer.  And you should freely do so when submitting
</I>&gt;&gt;<i> anything for re-review.  It's best to just do this as quickly as
</I>&gt;&gt;<i> possible,
</I>&gt;&gt;<i> so that it gets back to the reviewer without a whole lot of delay, and
</I>&gt;&gt;<i> they
</I>&gt;&gt;<i> can respond with either &quot;I still disagree, but you're doing the work, so
</I>&gt;&gt;<i> OK
</I>&gt;&gt;<i> go ahead&quot; or &quot;No, you really have to do this, it's required by policy
</I>&gt;&gt;<i> document X, here's a link&quot; ;-).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    1. The documentation itself needs to be able to be generated from any
</I>&gt;&gt;&gt;<i>    version of trunk.  While one or two formatting snafus are acceptable
</I>&gt;&gt;&gt;<i> to be
</I>&gt;&gt;&gt;<i>    fixed after the fact, the documentation needs to be in a
</I>&gt;&gt;&gt;<i> comprehensible
</I>&gt;&gt;&gt;<i>    state in every revision of trunk, which means that in order to land
</I>&gt;&gt;&gt;<i> on
</I>&gt;&gt;&gt;<i>    trunk, the ReST output.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So...you didn't finish that sentence.  I realize you apologized for
</I>&gt;&gt;<i> errors at the end of your mail, but I have a feeling you were going to
</I>&gt;&gt;<i> say
</I>&gt;&gt;<i> something rather important there...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Well yes, that was the point of the apology.  That was a rather important
</I>&gt;&gt;<i> thing.  What I was probably going to say was just:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The ReST output needs to be in good enough shape to be generally
</I>&gt;&gt;<i> readable,
</I>&gt;&gt;<i> with a manageable number of errors.  But, we need to be able to *verify*
</I>&gt;&gt;<i> that it has not too many errors.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And I'd already discussed that somewhat above.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now that I've replied to all of that, let me give you a rundown of what
</I>&gt;&gt;<i> I've been thinking and planning, so that you have an idea of where I'm
</I>&gt;&gt;<i> coming from.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here are the various things that I have perceived to be
</I>&gt;&gt;<i> necessary/required
</I>&gt;&gt;<i> in order to get the conversion to happen:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> a) The conversion process needs to be able to be run concurrently with
</I>&gt;&gt;<i> Lore for an extended period of time.  In other words, Lore would be the
</I>&gt;&gt;<i> &quot;official&quot; version of the docs, and the Sphinx docs would be built in
</I>&gt;&gt;<i> some
</I>&gt;&gt;<i> form of automated fashion until everyone was happy with them and/or ready
</I>&gt;&gt;<i> to deprecate/abandon Lore.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Your understanding of this requirement is slightly off, I think, although
</I>&gt;&gt;<i> possibly the consequences are the same.  As per the difficulties I laid
</I>&gt;&gt;<i> out
</I>&gt;&gt;<i> above, about separating the requirements from the strategies for
</I>&gt;&gt;<i> satisfying
</I>&gt;&gt;<i> said requirements.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I've been told that almost verbatim, several times.  This is basically what
</I>&gt;<i> led to the Sphinx buildbot happening.  Perhaps I wasn't clear about what I
</I>&gt;<i> meant.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> The thing that we weren't going to tolerate was any message saying that
</I>&gt;&gt;<i> people should hold off on writing documentation, even for &quot;a little
</I>&gt;&gt;<i> while&quot;
</I>&gt;&gt;<i> while we fixed up the lore conversion, because without a contractual
</I>&gt;&gt;<i> obligation for someone to finish this work, there's really no telling how
</I>&gt;&gt;<i> long &quot;a little while&quot; would be :).
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well, when I originally was pushing it, my plan was for that little while
</I>&gt;<i> to be &quot;today&quot; (this was at PyCon during the only day of sprints I was able
</I>&gt;<i> to attend), and if it didn't get done, we'd abandon that particular
</I>&gt;<i> attempt.  You and exarkun managed to convince me that even this was
</I>&gt;<i> probably not a very good idea though.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Since the whole point of this sphinx conversion is to appeal to
</I>&gt;&gt;<i> documentation authors who prefer the ReST format as input (it's
</I>&gt;&gt;<i> definitely
</I>&gt;&gt;<i> not to make the docs look nicer, writing a new stylesheet for Lore would
</I>&gt;&gt;<i> have taken 1/100th of the effort and nobody has expressed interest in
</I>&gt;&gt;<i> doing
</I>&gt;&gt;<i> that), creating a period where things were even *less* appealing to
</I>&gt;&gt;<i> documentation authors would defeat the purpose.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I actually considered the stylesheet thing, but it was really only a
</I>&gt;<i> passing thought.  My personal motivation started with not being able to
</I>&gt;<i> find things in the documentation.  So I started looking at the various Lore
</I>&gt;<i> tickets to see whether there was something to clean up that would help.
</I>&gt;<i>  And a bunch of them seemed to be asking for things that Sphinx already
</I>&gt;<i> did.  Sphinx was starting to become a common tool, and I had used it on
</I>&gt;<i> several other projects, and found it pleasant to work with.  Also, when I
</I>&gt;<i> asked about Lore on IRC, I got a lot of &quot;I'm not sure anyone knows how that
</I>&gt;<i> works these days&quot; and &quot;oh man, I wish we didn't have to support that any
</I>&gt;<i> more&quot;, etc.  So I started looking into how to convert the docs over to use
</I>&gt;<i> Sphinx.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Another possible solution to this problem would be to modify Lore so it
</I>&gt;&gt;<i> could process ReST sources, so that we could convert the documentation
</I>&gt;&gt;<i> within the repository piecemeal, and start writing any new docs in ReST,
</I>&gt;&gt;<i> but still have a coherent whole of documentation produced, eventually
</I>&gt;&gt;<i> switching the documentation processor from Lore to Sphinx.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This would require someone smarter than me.  Or at least more versed in
</I>&gt;<i> formal parsing theory/techniques.  Or something.  And that would be just to
</I>&gt;<i> read the docutils sources.  I find them...alien. (though less so that when
</I>&gt;<i> I first started looking at them...I'm not sure if they've improved, or I
</I>&gt;<i> have)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Yet another possible solution would be to modify Sphinx, adding a plugin
</I>&gt;&gt;<i> to process the Lore sources.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is more reasonable, but still has problems.  Actually the reasonable
</I>&gt;<i> thing would be to create a docutils piece to process Lore sources, and then
</I>&gt;<i> maybe some Sphinx extensions on top of that.  Or something.  Still, it
</I>&gt;<i> might have been doable.  However, I think Lore would have had to be
</I>&gt;<i> modified as well, and possibly the Lore format expanded
</I>&gt;<i> to accommodate certain constructs that it just doesn't do right now (mostly
</I>&gt;<i> I'm thinking of the toctree directive and related stuff).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> As an aside: this is the part of the process which has been so
</I>&gt;&gt;<i> frustrating
</I>&gt;&gt;<i> to me, personally.  The two alternate solutions I proposed here (and have
</I>&gt;&gt;<i> proposed before) seem far saner and more manageable in terms of effort,
</I>&gt;&gt;<i> to
</I>&gt;&gt;<i> me.  But, everyone I have spoken to about docutils and ReST has told me
</I>&gt;&gt;<i> in
</I>&gt;&gt;<i> no uncertain terms that they are both a pile of heinous hacks that resist
</I>&gt;&gt;<i> any attempt at sensible software-engineering solutions to problems, so we
</I>&gt;&gt;<i> need to resort to hackish system-integration stuff like what we've done.
</I>&gt;&gt;<i>  This worries me.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ooookaaaaay....I don't know how to respond to that exactly.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> I know that Sphinx's output is well-loved by the Python community, but if
</I>&gt;&gt;<i> it's so hard to call into that we can't reasonably modify it to get an
</I>&gt;&gt;<i> XML
</I>&gt;&gt;<i> DOM that looks like Lore source to Lore, and it's so hard to plug in to
</I>&gt;&gt;<i> it
</I>&gt;&gt;<i> that we can't give it a data structure that it likes from Lore's XML DOM,
</I>&gt;&gt;<i> then how the heck is it being maintained?  And if it actually *isn't*
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i> bad, then why haven't I managed to find someone that knows its code well
</I>&gt;&gt;<i> enough to do one or the other of these things?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It would be possible to make Sphinx emit Lore sources, though I'm not sure
</I>&gt;<i> what that buys.  You could do this either through a custom Sphinx
</I>&gt;<i> &quot;builder&quot;, or possibly even just using a custom html template with the html
</I>&gt;<i> builder.  But you'd need ReST sources to feed into Sphinx, so...
</I>&gt;<i>
</I>&gt;<i> You could write a docutils &quot;parser&quot; which parses a document and returns a
</I>&gt;<i> &quot;nodetree&quot; data structure.  This would get you as far as docutils, but
</I>&gt;<i> AFAIK there is no existing way to get Sphinx to use any parser other than
</I>&gt;<i> the default ReST one.  You could probably create such a thing, which would
</I>&gt;<i> almost certainly involve modifications to Sphinx, though that's not
</I>&gt;<i> necessarily a big deal.  It might not even be hard.  I think this would
</I>&gt;<i> actually be a lot easier now than when I started down this path, mostly
</I>&gt;<i> because docutils seems to have better documentation on the nodes that can
</I>&gt;<i> go in the &quot;nodetree&quot; I mentioned above.  Note that I said &quot;seems&quot; because
</I>&gt;<i> I'm not sure if it's that docutils documentation has gotten more complete,
</I>&gt;<i> or just that I've bounced around in it enough times to find things.  The
</I>&gt;<i> Docutils docs have the same problem that the Twisted docs have, which is
</I>&gt;<i> that they are nigh un-navigable.  (I also think that the docutils docs
</I>&gt;<i> should start using Sphinx, but I'm not sure how well that would go over in
</I>&gt;<i> that camp...)
</I>&gt;<i>
</I>&gt;<i> The main problem with creating such a parser, is that Sphinx uses a bunch
</I>&gt;<i> of docutils extensions to tie together the disparate documents in your
</I>&gt;<i> project, and Lore, like vanilla docutils, doesn't have much of a concept of
</I>&gt;<i> being one document among many (at least not from within a document).  For
</I>&gt;<i> example, it has things to handle tables of contents, cross document links
</I>&gt;<i> (with the ability to link to a document section, rather than a specific
</I>&gt;<i> document, so if it gets moved to a different document, the link gets
</I>&gt;<i> adjusted), compilation for glossaries and index entries from across the
</I>&gt;<i> docs project, etc.  So you'd need to add some stuff to Lore to account for
</I>&gt;<i> this (some is already there).  And then we'd have to go through and modify
</I>&gt;<i> a bunch of the Lore sources anyway.
</I>&gt;<i>
</I>&gt;<i> Like I said, this looks a lot more feasible now than it did when I first
</I>&gt;<i> looked at it, though I'm not sure whether it's me or docutils/Sphinx that's
</I>&gt;<i> changed.  Probably some of each.
</I>&gt;<i>
</I>&gt;<i> At any rate, back then it seemed awfully difficult, and less interesting.
</I>&gt;<i>
</I>&gt;<i> Hmmm.  And you'd also need to make some changes to the way Sphinx picks up
</I>&gt;<i> files.  And probably some other stuff I haven't thought of.
</I>&gt;<i>
</I>&gt;<i> I have no direct knowledge of any of this stuff, because my main interest
</I>&gt;&gt;<i> here is improving the experience of working on Twisted, both for you,
</I>&gt;&gt;<i> Kevin, and for the people who will arguably be helped by the use of
</I>&gt;&gt;<i> Sphinx.
</I>&gt;&gt;<i>  Maybe I'm completely wrong and Sphinx is beautifully architected and we
</I>&gt;&gt;<i> could have done this from day 1.  But I faintly hope that some Docutils
</I>&gt;&gt;<i> and
</I>&gt;&gt;<i> Sphinx contributor hears that I said &quot;sphinx is garbage&quot; and makes a fool
</I>&gt;&gt;<i> of me by contributing either a lore modification or a sphinx plugin which
</I>&gt;&gt;<i> solves this whole problem so we can do the format or tool migration
</I>&gt;&gt;<i> incrementally :).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> b) Because of a), there needs to be tooling to run lore2sphinx (or
</I>&gt;&gt;<i> whatever) on a regular basis.  (This was sort of being done via the
</I>&gt;&gt;<i> Sphinx-building buildbot, but in a very ad-hockery sort of way, which was
</I>&gt;&gt;<i> brittle, broke a couple of times, and needed to be improved.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hmm. I wasn't aware of that. But it seems like it's running by a charm
</I>&gt;&gt;<i> now.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I think this is because a) exarkun fixed it a couple of times, and b) I
</I>&gt;<i> stopped making changes to the lore2sphinx repo (which the buildbot pulls
</I>&gt;<i> from).  I'm also referring here to something which is completely
</I>&gt;<i> non-obvious to anyone who hasn't actually run lore2sphinx by hand, which is
</I>&gt;<i> that the command line tool was fairly terrible in several ways.  This made
</I>&gt;<i> it harder to use for development than it should have been.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> c) There needs to be release management tooling to build the Sphinx docs
</I>&gt;&gt;<i> from ReST into whatever formats we want to publish (HTML and PDF to
</I>&gt;&gt;<i> start,
</I>&gt;&gt;<i> maybe others later on)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yup.  (ePub?  PDF is so last-century... :))
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> d) Convert the Lore sources to better ReST documents without all the
</I>&gt;&gt;<i> problems that the current lore2sphinx output has.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So, this wasn't *necessary*.  If we had gotten through the release
</I>&gt;&gt;<i> automation stuff - and I still don't understand why that's stuck - we
</I>&gt;&gt;<i> could
</I>&gt;&gt;<i> have merged it.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well, I decided it was.  Or at least really really desirable.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> I at one time thought this was pretty impractical.  My first attempt at a
</I>&gt;&gt;<i> conversion tool tried to use an intermediate object model, but I ran into
</I>&gt;&gt;<i> trouble when trying to combine the various objects.  So I abandoned the
</I>&gt;&gt;<i> effort and created what became lore2sphinx, which basically just combined
</I>&gt;&gt;<i> a
</I>&gt;&gt;<i> bunch of strings.  I then figured out a way of making the intermediate
</I>&gt;&gt;<i> object thing work, and that was lore2sphinx-ng.  Then it became
</I>&gt;&gt;<i> convenient
</I>&gt;&gt;<i> to split out the intermediate object model from the documetn processing
</I>&gt;&gt;<i> code, so I put all of that into a library and that became rstgen.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It seems the saving grace here is that rstgen might be a generally useful
</I>&gt;&gt;<i> tool in its own right, with more of a long-term future than lore2sphinx
</I>&gt;&gt;<i> would have had.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I admit that I have become more interested in the actual problem of
</I>&gt;<i> &quot;generating ReST&quot; than I once was.  And I hope that it will become a
</I>&gt;<i> generally useful tool.
</I>&gt;<i>
</I>&gt;<i> And probably one of the reasons I have been making such relatively slow
</I>&gt;<i> progress on it is is _because_ I'm trying to solve a more general problem
</I>&gt;<i> than I once was.  The original lore2sphinx (the one running on the buildbot
</I>&gt;<i> now) was very much a minimal-thing-that-could-possibly-work kind of
</I>&gt;<i> solution.  It tried to do just enough to get the job done.  It sort of did
</I>&gt;<i> get the job done, but I was never very satisfied with it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> (For anyone who is curious, the lore2sphinx-ng repo is forked off from
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> lore2sphinx repo, primarily because I didn't want to break the Sphinx
</I>&gt;&gt;<i> buildbot by making drastic changes.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Have a link?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I've posted it a couple of times in this thread, though I can hardly blame
</I>&gt;<i> you for either missing it or losing track of it.
</I>&gt;<i>
</I>&gt;<i> original: <A HREF="https://bitbucket.org/khorn/lore2sphinx">https://bitbucket.org/khorn/lore2sphinx</A>
</I>&gt;<i> extra-crispy: <A HREF="https://bitbucket.org/khorn/lore2sphinx-ng">https://bitbucket.org/khorn/lore2sphinx-ng</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here's what my plan was prior to this whole discussion getting started
</I>&gt;&gt;<i> again.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1) Finish rstgen, where &quot;finished&quot; in this instance is defined as &quot;is
</I>&gt;&gt;<i> capable of generating all the vanilla docutils and sphinx-specific ReST
</I>&gt;&gt;<i> elements that we need for converting the
</I>&gt;&gt;<i> Twisted documentation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sounds like a worthy goal, although I don't think this is necessarily
</I>&gt;&gt;<i> required.  Have you been working on it for the last 2 years?  Do you have
</I>&gt;&gt;<i> any idea when it might be done?  It might be worthwhile to write a
</I>&gt;&gt;<i> *smaller* .
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I started on rstgen a bit more than a year ago.  I was hung up on the
</I>&gt;<i> problem of how to combine various parts of a document for a while without
</I>&gt;<i> having the crazy space-handling issues.  And also I've been trying to come
</I>&gt;<i> up with a relatively friendly API, and enough generality that it will end
</I>&gt;<i> up useful outside of the lore2sphinx context.
</I>&gt;<i>
</I>&gt;<i> I really started on l2s-ng last July during &quot;Julython&quot;.  I've been working
</I>&gt;<i> on it in fits and starts a few times since then.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2) Finish lore2sphinx-ng (which would probably have ended with merging it
</I>&gt;&gt;<i> back into the lore2sphinx repo), where &quot;finished&quot; means that it would be
</I>&gt;&gt;<i> capable of processing all the XHTML Lore tags that were defined in the
</I>&gt;&gt;<i> Lore
</I>&gt;&gt;<i> documentation and used in the Twisted documentation, and generating a
</I>&gt;&gt;<i> tree
</I>&gt;&gt;<i> of rstgen elements, which could then be rendered into ReST.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cool.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> While this would be handy, especially for people working on documentation
</I>&gt;&gt;<i> branches, it's not necessarily necessary.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> (this would also serve to satisfy b) above, as the CLI in lore2sphinx-ng
</I>&gt;&gt;<i> is less...well, let's just call it broken than lore2sphinx's was/is.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> OK.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 3) Go back and finish SphinxBuilder (release tooling for building a
</I>&gt;&gt;<i> sphinx
</I>&gt;&gt;<i> project, which is basically a wrapper for sphinx-build, plus some vague
</I>&gt;&gt;<i> &quot;version feature&quot;).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is really the crux; this is the thing you should work on first, I
</I>&gt;&gt;<i> think, even if you're going to keep working on lore2sphinx-ng.  Basically
</I>&gt;&gt;<i> the only reason that I was keen to get the lore to sphinx conversion
</I>&gt;&gt;<i> improved in the first place was that creating this tool seemed to be
</I>&gt;&gt;<i> dragging on for quite a while after the &quot;chunk tickets&quot; were done.  But
</I>&gt;&gt;<i> now, this tool is almost done, and we could re-do the lore-source review
</I>&gt;&gt;<i> if
</I>&gt;&gt;<i> you wanted to do that.  The current lore2sphinx might well be good enough
</I>&gt;&gt;<i> to just go with, especially if the next-generation version is going to
</I>&gt;&gt;<i> take
</I>&gt;&gt;<i> another six months to finish.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'll take a look at this again soonish (a week?  this month? don't know.).
</I>&gt;<i>  Probably it's a matter of:
</I>&gt;<i>
</I>&gt;<i> - merge forward (it has been a while)
</I>&gt;<i> - figure out how the other tools guess/determine the Twisted version in the
</I>&gt;<i> checkout, and make SphinxBuilder do that.
</I>&gt;<i> - get it reveiewed
</I>&gt;<i> - commit
</I>&gt;<i>
</I>&gt;<i> But I'll have to remember how to use combinator again (which will be much
</I>&gt;<i> easier now that the combinator &quot;docs&quot; are on the Twisted wiki...thanks to
</I>&gt;<i> whomever did that!)
</I>&gt;<i>
</I>&gt;<i> Yes, I could probably use Bazaar, but so far every time I've tried that,
</I>&gt;<i> I've ended up spending waaaaaay too much time just on the VCS.  I guess I
</I>&gt;<i> have some kind of mental block with bzr.  I'll get over it someday I
</I>&gt;<i> suppose.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 4) Get someone to use something less hackish than what's currently
</I>&gt;&gt;<i> building the Sphinx docs on the buildbot, and preferably in such a way
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i> the results of those builds could be published somewhere and have
</I>&gt;&gt;<i> persistent links.  Currently the results of what the Sphinx buildbot does
</I>&gt;&gt;<i> are stored for a time, and then go away, so you'll see links to build
</I>&gt;&gt;<i> results in some trac tickets that go nowhere, which is decidedly
</I>&gt;&gt;<i> unhelpful.
</I>&gt;&gt;<i>  My plan was that we'd set up something where the Sphinx docs would get
</I>&gt;&gt;<i> generated and published someplace for every buildbot build so that we
</I>&gt;&gt;<i> could
</I>&gt;&gt;<i> always have the current results for the lore to sphinx conversion for the
</I>&gt;&gt;<i> tip of each branch.  I have no idea whether this is actually feasible or
</I>&gt;&gt;<i> practical, but it seemed like it would be useful.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> OK, *this* sounds like really unnecessary turd-polishing ;-).  This
</I>&gt;&gt;<i> builder is an interim step; the more interesting step is the builder that
</I>&gt;&gt;<i> just builds the sphinx docs, in the same way that the current builder
</I>&gt;&gt;<i> builds the lore docs.  Furthermore, it seems to be working fine.  Build
</I>&gt;&gt;<i> results links that go nowhere are a known problem with buildbot, since it
</I>&gt;&gt;<i> does eventually lose most history, and this type of history takes up a
</I>&gt;&gt;<i> fair
</I>&gt;&gt;<i> bit of disk space.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well, it was mostly motivated by the fact that we were doing a lot of
</I>&gt;<i> linking to build results that would then cease to exist for a while, and it
</I>&gt;<i> really annoyed me.  It doesn't seem nearly as &quot;necessary&quot; to me now as it
</I>&gt;<i> once did.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 5) Proceed with Sphinx docs being built from lore sources, making tweaks
</I>&gt;&gt;<i> as necessary to lore2sphinx(ng) for as long as it took for the generated
</I>&gt;&gt;<i> docs to be good enough to justify switching to Sphinx entirely.
</I>&gt;&gt;<i> 6) Switch to Sphinx entirely.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I really wasn't planning on trying to get people excited about switching
</I>&gt;&gt;<i> to Sphinx again until 1) and 2) were at least &quot;mostly&quot; done (for certain
</I>&gt;&gt;<i> values of done) and I had gone back to finish 3).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So.  I guess at this point the question is whether to try and go with
</I>&gt;&gt;<i> what's there (lore2sphinx) or finish up the &quot;new stuff&quot; (lore2sphinx-ng +
</I>&gt;&gt;<i> rstgen).  I think 3-6 in my above plan need to happen in any case, and I
</I>&gt;&gt;<i> think those will be much easier with lore2sphinx-ng+rstgen.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This decision is really determined by time estimates.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In any case, work out the sphinx release automation tool first, since we
</I>&gt;&gt;<i> need that regardless of how we switch over
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Got it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IIRC, rstgen has support for most of the vanilla docutils elements, with
</I>&gt;&gt;<i> the notable exception of tables (and maybe definition lists...can't
</I>&gt;&gt;<i> recall
</I>&gt;&gt;<i> whether I finished those).  It has a basic level of test coverage (of
</I>&gt;&gt;<i> course you can never have too many tests) for rendering the elements
</I>&gt;&gt;<i> individually, and some test for elements in combination (particularly
</I>&gt;&gt;<i> nested lists).  Footnotes and Citations I think also need some work,
</I>&gt;&gt;<i> which
</I>&gt;&gt;<i> I have a plan for, but haven't implemented yet (i don't think).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The &quot;new&quot; lore2sphinx CLI tool needs more work, but is relatively
</I>&gt;&gt;<i> straightforward.  Like the old tool, it's basically an elementtree
</I>&gt;&gt;<i> processor, except instead of spitting out strings that get joined
</I>&gt;&gt;<i> together
</I>&gt;&gt;<i> (which granted was an unholy mess), it generates rstgen elements, which
</I>&gt;&gt;<i> all
</I>&gt;&gt;<i> have a .render() method.  After processing a Lore document, you shoudl
</I>&gt;&gt;<i> end
</I>&gt;&gt;<i> up with a rstgen.Document object.  You call it's render() method, which
</I>&gt;&gt;<i> calls it's children's render() methods, etc. and it's turtles all the way
</I>&gt;&gt;<i> down.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The framework is there for the new CLI tool, it's mostly a matter of
</I>&gt;&gt;<i> writing a bunch of short methods that take elementtree elements as input
</I>&gt;&gt;<i> and return appropriate rstgen objects.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Obviously these tools aren't finished, but they produce much better
</I>&gt;&gt;<i> output
</I>&gt;&gt;<i> than the old version of lore2sphinx w.r.t. whitespace handling, paragraph
</I>&gt;&gt;<i> wrapping, etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Aesthetically, this appeals to me a lot more than going with the
</I>&gt;&gt;<i> messiness
</I>&gt;&gt;<i> of lore2sphinx.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Me too.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> But it is _not_ a requirement.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Understood.  Though I think it might be a practical requirement, even if it
</I>&gt;<i> isn't a policy requirement.  If that makes sense.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Some of the code is still pretty messy, but nowhere near the train wreck
</I>&gt;&gt;<i> that the current/old version of lore2sphinx is.  By which I mean it _can_
</I>&gt;&gt;<i> be cleaned up, it just hasn't been yet.  In particular there's some
</I>&gt;&gt;<i> places
</I>&gt;&gt;<i> in rstgen where the API is (to me at least) obviously awful, but I
</I>&gt;&gt;<i> haven't
</I>&gt;&gt;<i> gotten around to fixing it yet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please review the code.  Please feel free to ask questions if you're
</I>&gt;&gt;<i> interested.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Personally, I've gotten over being in a hurry about all this, and I think
</I>&gt;&gt;<i> a robust tool is more likely to succeed in the long run, though finishing
</I>&gt;&gt;<i> it may make the run a bit longer.  So I'm for finishing
</I>&gt;&gt;<i> lore2sphinx-ng+rstgen.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I think a little false urgency might not hurt here :-).  I'm not going to
</I>&gt;&gt;<i> work on the tool - just writing these emails probably blew my Twisted
</I>&gt;&gt;<i> development budget for the next two months ;-)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I can relate... :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> - but I will do my best to quickly clear up any procedural
</I>&gt;&gt;<i> what-needs-to-be-done questions unambiguously.  Please ping if anything
</I>&gt;&gt;<i> gets you stuck.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'll let you know.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Kevin Horn
</I>&gt;<i>
</I>

-- 
Cordially
Abdul Rauf (haseeb)

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026647.html">[Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)
</A></li>
	<LI>Next message: <A HREF="026583.html">[Twisted-Python] Need help regarding Gsoc 2013
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26682">[ date ]</a>
              <a href="thread.html#26682">[ thread ]</a>
              <a href="subject.html#26682">[ subject ]</a>
              <a href="author.html#26682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
