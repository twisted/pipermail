<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Jabber client, tls and iqauth
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Jabber%20client%2C%20tls%20and%20iqauth&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026692.html">
   <LINK REL="Next"  HREF="026693.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Jabber client, tls and iqauth</H1>
    <B>rakdeFR</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Jabber%20client%2C%20tls%20and%20iqauth&In-Reply-To="
       TITLE="[Twisted-Python] Jabber client, tls and iqauth">contact at rkade.fr
       </A><BR>
    <I>Fri Mar 15 11:32:12 EDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026692.html">[Twisted-Python] Final request URI from an Agent response
</A></li>
        <LI>Next message: <A HREF="026693.html">[Twisted-Python] Jabber client, tls and iqauth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26678">[ date ]</a>
              <a href="thread.html#26678">[ thread ]</a>
              <a href="subject.html#26678">[ subject ]</a>
              <a href="author.html#26678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

I did some searches about my problem and didn't find any thing that 
match in the archives.

I'm trying to do a simple jabber client with the twisted framework in 
order to automatically send messages.

The server is a prosody server, and enabled the tls and iq auth.

So far, I can connect to the server, and can't login.

If I'm doing a XmlStreamFactory with the basicClientFactory, I have 
these initializers/authenticator:
Initializers 
[&lt;twisted.words.protocols.jabber.xmlstream.TLSInitiatingInitializer 
object at 0x2c1ef50&gt;, 
&lt;twisted.words.protocols.jabber.client.IQAuthInitializer object at 
0x2c1ef90&gt;]
Authenticator &lt;twisted.words.protocols.jabber.client.BasicAuthenticator 
instance at 0x10f2320&gt;

And if I create a XMPPClientFactory, I have these:
Initializers 
[&lt;twisted.words.protocols.jabber.client.CheckVersionInitializer object 
at 0x2fe7f50&gt;, 
&lt;twisted.words.protocols.jabber.xmlstream.TLSInitiatingInitializer 
object at 0x2fe7fd0&gt;, 
&lt;twisted.words.protocols.jabber.sasl.SASLInitiatingInitializer object at 
0x2ff1050&gt;, &lt;twisted.words.protocols.jabber.client.BindInitializer 
object at 0x2ff1090&gt;, 
&lt;twisted.words.protocols.jabber.client.SessionInitializer object at 
0x2ff10d0&gt;]
Authenticator &lt;twisted.words.protocols.jabber.client.XMPPAuthenticator 
instance at 0x2fdd320&gt;

So I look up the SEND and RECV message between the client and server, 
and I notice that if I do a XMPPClientFactory, it's doing a tls 
connection, then say it doesn't have the feature for iq auth.
And if I'm doing a basicClientFactory, I don't have the tls, so when it 
tries to logon with iq, the server answers that it needs the tls.

After noticing that, I tried to change the initializers and the 
authenticator in the connected function.
But when I'm doing a XMPPClientFactory with a BasicAuthenticator, I 
don't have the tls anymore.

What do I need to change in order to have the tls and after the iq auth?

Thank you for your help.

rkadeFR

My current code:
19 class ClientXMPP(object):
  20     def __init__(self, jid_user, password_user):
  21         self.reactor = reactor
  22         XmlStreamFactory = client.basicClientFactory(jid_user, 
password_user)
  23         
XmlStreamFactory.addBootstrap(xmlstream.STREAM_CONNECTED_EVENT, 
self.connected)
  24         XmlStreamFactory.addBootstrap(xmlstream.STREAM_END_EVENT, 
self.disconnected)
  25         XmlStreamFactory.addBootstrap(xmlstream.STREAM_AUTHD_EVENT, 
self.authenticated)
  26         XmlStreamFactory.addBootstrap(xmlstream.INIT_FAILED_EVENT, 
self.init_failed)
  27         connector = SRVConnector(reactor, 'xmpp-client', 
jid_user.host, XmlStreamFactory)
  28         connector.connect()
  29         self.finished = Deferred()
  30
  31     def rawDataIn(self, buf):
  32         print &quot;RECV: %s&quot; % unicode(buf, 'utf-8').encode('ascii', 
'replace')
  33
  34     def rawDataOut(self, buf):
  35         print &quot;SEND: %s&quot; % unicode(buf, 'utf-8').encode('ascii', 
'replace')
  36
  37     def connected(self, xs):
  38         xs.rawDataInFn = self.rawDataIn
  39         xs.rawDataOutFn = self.rawDataOut
  40         print 'Connected.'
  41         self.xmlstream = xs
  42 #
  43         print 'Initializers', xs.initializers
  44         print 'Authenticator', xs.authenticator
  45         print 'Am I initialized?', xs.initiating
  46         # Log trafic out
  47
  48     def disconnected(self, xs):
  49         print 'Disconnected.'
  50         self.finished.callback(None)
  51
  52     def authenticated(self, xs):
  53         print &quot;Authenticated.&quot;
  54         presence = domish.Element((None, 'presence'))
  55         xs.send(presence)
  56         self.reactor.callLater(5, xs.sendFooter)
  57
  58     def send(self, message):
  59         print 'Send', message
  60
  61     def init_failed(self, failure):
  62         print &quot;Initialization failed. Failure:&quot;
  63         print failure
  64 #        self.xmlstream.sendFooter()
  65 #        self.xmlstream.authenticator.initializeStream()

</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026692.html">[Twisted-Python] Final request URI from an Agent response
</A></li>
	<LI>Next message: <A HREF="026693.html">[Twisted-Python] Jabber client, tls and iqauth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26678">[ date ]</a>
              <a href="thread.html#26678">[ thread ]</a>
              <a href="subject.html#26678">[ subject ]</a>
              <a href="author.html#26678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
