<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lore%20and%20generating%20reStructuredText%0A%09%28Lore2Sphinx%29&In-Reply-To=CA%2BU%3DzK1n7BDDEPjmkpS8hhS8jowGHTpHENG1iMRQ5p-KDHWEYw%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026713.html">
   <LINK REL="Next"  HREF="026715.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)</H1>
    <B>Kevin Horn</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lore%20and%20generating%20reStructuredText%0A%09%28Lore2Sphinx%29&In-Reply-To=CA%2BU%3DzK1n7BDDEPjmkpS8hhS8jowGHTpHENG1iMRQ5p-KDHWEYw%40mail.gmail.com"
       TITLE="[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)">kevin.horn at gmail.com
       </A><BR>
    <I>Thu Mar 21 11:52:17 EDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026713.html">[Twisted-Python] Lore and generating reStructuredText (Lore2Sphinx)
</A></li>
        <LI>Next message: <A HREF="026715.html">[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26714">[ date ]</a>
              <a href="thread.html#26714">[ thread ]</a>
              <a href="subject.html#26714">[ subject ]</a>
              <a href="author.html#26714">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Mar 21, 2013 at 9:17 AM, Kevin Horn &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.horn at gmail.com</A>&gt; wrote:

&gt;<i> tl;dr  A Lore plugin won't work for generating Sphinx source files, at
</I>&gt;<i> least not by itself.
</I>&gt;<i>
</I>&gt;<i> Itamar posted some notes from the Twisted BoF session that was held at
</I>&gt;<i> PyCon last weekend, and one of the things in it was the following line:
</I>&gt;<i>
</I>&gt;<i> - lore output plugin that generates ReST via docutils parse tree objects, then write code to run sphinx on this output
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I wasn't there, so I don't know the exact context that this was referring
</I>&gt;<i> to, but let me try to explain a little bit about why this won't work (at
</I>&gt;<i> least not as written).
</I>&gt;<i>
</I>&gt;<i> reStructuredText, as some of you may know, creates it's output by first
</I>&gt;<i> creating an intermediate representation of a document called a &quot;node tree&quot;,
</I>&gt;<i> which is a tree of &quot;nodes&quot; which represents the various elements in a
</I>&gt;<i> document (text, paragraphs, lists, list items, etc.).  reStructuredText
</I>&gt;<i> also has a construct called a &quot;directive&quot;, which is  some markup which
</I>&gt;<i> tells the docutils reST parser to create a bunch of these nodes.
</I>&gt;<i>
</I>&gt;<i> Directives are awesome and are a big reason why reStructuredText is so
</I>&gt;<i> much more powerful than other lightweight markup languages like markdown,
</I>&gt;<i> textile, etc.  They serve as extension point and allow users to create
</I>&gt;<i> their own markup constructs without changing the actual parser.
</I>&gt;<i>
</I>&gt;<i> The key thing is that a directive is not itself a type of node.  Rather it
</I>&gt;<i> 's just a markup construct.  This means that once a reStructuredText
</I>&gt;<i> document goes through the docutils parser, the information about the
</I>&gt;<i> directives is lost, because they have been transformed into a bunch of
</I>&gt;<i> nodes.
</I>&gt;<i>
</I>&gt;<i> For example there's a container directive, which looks like this:
</I>&gt;<i>
</I>&gt;<i> Title
</I>&gt;<i> =====
</I>&gt;<i>
</I>&gt;<i> .. container::
</I>&gt;<i>
</I>&gt;<i>     I'm a content paragraph!  Yay!
</I>&gt;<i>
</I>&gt;<i> When processed this creates a nodetree that looks something like this (in
</I>&gt;<i> docutils &quot;pseudoxml&quot; representation:
</I>&gt;<i>
</I>&gt;<i> &lt;document ids=&quot;title&quot; names=&quot;title&quot; source=&quot;test.rst&quot; title=&quot;Title&quot;&gt;
</I>&gt;<i>     &lt;title&gt;
</I>&gt;<i>         Title
</I>&gt;<i>     &lt;container&gt;
</I>&gt;<i>         &lt;paragraph&gt;
</I>&gt;<i>             I'm a content paragraph!  Yay!
</I>&gt;<i>
</I>&gt;<i> It is entirely coincidental that the container directive and the
</I>&gt;<i> &lt;container&gt; node are named the same thing.  Don't let this confuse you.
</I>&gt;<i>  The point is that the directive goes away and is replaced by a  bunch of
</I>&gt;<i> nodes (more specifically, the node tree is transformed in some way...I
</I>&gt;<i> suppose a directive could remove nodes, but I don't think I've ever seen
</I>&gt;<i> that done).
</I>&gt;<i>
</I>&gt;<i> We can see this using another example:
</I>&gt;<i>
</I>&gt;<i> Here's some markup:
</I>&gt;<i>
</I>&gt;<i> Title
</I>&gt;<i> =====
</I>&gt;<i>
</I>&gt;<i> .. warning::
</I>&gt;<i>
</I>&gt;<i>     I'm a content paragraph!  Yay!
</I>&gt;<i>
</I>&gt;<i> and here's the pseudoxml representation of the nodetree:
</I>&gt;<i>
</I>&gt;<i> &lt;document ids=&quot;title&quot; names=&quot;title&quot; source=&quot;test.rst&quot; title=&quot;Title&quot;&gt;
</I>&gt;<i>     &lt;title&gt;
</I>&gt;<i>         Title
</I>&gt;<i>     &lt;container&gt;
</I>&gt;<i>         &lt;paragraph&gt;
</I>&gt;<i>             I'm a content paragraph!  Yay!
</I>&gt;<i>
</I>&gt;<i> Notice that the node trees look exactly the same.  Now this is not quite
</I>&gt;<i> true, as there's probably some attributes on the actual Python nodes that
</I>&gt;<i> might be used to distinguish them when writing output which aren't
</I>&gt;<i> displayed here...they certainly get rendered into HTML differently.  But
</I>&gt;<i> the point is that the directive itself is GONE and you have no real way of
</I>&gt;<i> recreating it from the node tree.
</I>&gt;<i>
</I>&gt;<i> I think this problem also happens with custom text roles, which is another
</I>&gt;<i> extension mechanism in reST, but I haven't looked too deeply into that.
</I>&gt;<i>
</I>&gt;<i> Since you really, really want to have directives in your output (in fact
</I>&gt;<i> you have to have them if you want to use Sphinx, which makes heavy use of
</I>&gt;<i> them), you can't really generate Sphinx-capable source files using _only_
</I>&gt;<i> the nodetree representation.
</I>&gt;<i>
</I>&gt;<i> I suppose you might be able to do something where you try to detect where
</I>&gt;<i> the directive _should_ go and try to insert it during the rendering step,
</I>&gt;<i> but such a thing would be an egregious kludge,  would take a lot of effort,
</I>&gt;<i> and I can't imagine it would work very well, if at all.
</I>&gt;<i>
</I>&gt;<i> Another option would be to fork the distutils parser and change it so that
</I>&gt;<i> it could create &quot;directive nodes&quot; or something, but I certainly would not
</I>&gt;<i> recommend such a course. (If you think maintaining Lore is a pain, you
</I>&gt;<i> ain't seen nothin' yet.  And one thing this project has driven home to me
</I>&gt;<i> is that no software only needs to be maintained &quot;for a little while&quot;.)
</I>&gt;<i>
</I>&gt;<i> I'm not saying that the proposed plugin for lore is a bad idea...I think
</I>&gt;<i> it would be pretty cool.  You'd be able to send lore out to all of the
</I>&gt;<i> various formats supported by docutils, and who doesn't want to write their
</I>&gt;<i> next s5 presentaton in Lore, right? :)  But it won't do the job that it was
</I>&gt;<i> being put forward for in the note Itamar mentioned.
</I>&gt;<i>
</I>&gt;<i> So what about building some software that generates some other
</I>&gt;<i> representation of the source document, and then renders that as
</I>&gt;<i> reStructuredText?  Well this is the best idea I've come up with (or heard)
</I>&gt;<i> and is in fact exactly what lore2sphinx-ng_ (which is not intended to be a
</I>&gt;<i> separate thing, it's just an experimental fork of lore2sphinx) and rstgen_
</I>&gt;<i> do.  lore2spinx-ng creates the representation from lore sources (which is
</I>&gt;<i> also a tree of &quot;nodes&quot;, though they aren't called that), and rstgen defines
</I>&gt;<i> the nodes, and renders them into reStructuredText source.
</I>&gt;<i>
</I>&gt;<i> The only problem is that these aren't done yet, though the work done so
</I>&gt;<i> far looks very promising (in terms of actually being able to do the job
</I>&gt;<i> reliably someday).  If anyone has bothered to read this far and is
</I>&gt;<i> interested in helping out, please feel free to fork the repos and lend a
</I>&gt;<i> hand.  Also feel free to contact me either on this list or directly if you
</I>&gt;<i> have any questions.  I apologize in advance for the current state of the
</I>&gt;<i> code, which is a bit messy (especially lore2sphinx-ng, which still has a
</I>&gt;<i> bunch of cruft from the &quot;old&quot;/&quot;current&quot; version that I haven't gotten
</I>&gt;<i> around to removing yet).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> .. _lore2sphinx-ng: <A HREF="https://bitbucket.org/khorn/lore2sphinx-ng">https://bitbucket.org/khorn/lore2sphinx-ng</A>
</I>&gt;<i> .. _rstgen:<A HREF="https://bitbucket.org/khorn/rstgen">https://bitbucket.org/khorn/rstgen</A>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Kevin Horn
</I>&gt;<i>
</I>
I screwed up the example above, due to misnaming a file and running
rst2pseudoxml.py on the wrong thing.

It should actually look something like this:

&lt;document ids=&quot;title&quot; names=&quot;title&quot; source=&quot;test.rst&quot; title=&quot;Title&quot;&gt;
    &lt;title&gt;
        Title
    &lt;warning&gt;
        &lt;paragraph&gt;
            I'm a content paragraph!  Yay!

and this:

&lt;document ids=&quot;title&quot; names=&quot;title&quot; source=&quot;test.rst&quot; title=&quot;Title&quot;&gt;
    &lt;title&gt;
        Title
    &lt;admonition classes=&quot;admonition-hooray&quot;&gt;
        &lt;title&gt;
            hooray!
        &lt;paragraph&gt;
            I'm a content paragraph!  Yay!

But the point still holds.  Directive info goes away after parsing.

--
Kevin Horn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130321/b1f2db0e/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130321/b1f2db0e/attachment-0001.htm</A> 
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026713.html">[Twisted-Python] Lore and generating reStructuredText (Lore2Sphinx)
</A></li>
	<LI>Next message: <A HREF="026715.html">[Twisted-Python] Lore and generating reStructuredText	(Lore2Sphinx)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26714">[ date ]</a>
              <a href="thread.html#26714">[ thread ]</a>
              <a href="subject.html#26714">[ subject ]</a>
              <a href="author.html#26714">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
