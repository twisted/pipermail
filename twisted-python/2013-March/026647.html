<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lore%2C%20Sphinx%2C%0A%20and%20getting%20to%20the%20finish%20line%20%28was%3A%20re%3A%20lore%20and%20tickets%20and%20other%0A%20stuff%29&In-Reply-To=739CAE65-F29E-4FA8-96BF-A6C1548A9E02%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026600.html">
   <LINK REL="Next"  HREF="026682.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)</H1>
    <B>Kevin Horn</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lore%2C%20Sphinx%2C%0A%20and%20getting%20to%20the%20finish%20line%20%28was%3A%20re%3A%20lore%20and%20tickets%20and%20other%0A%20stuff%29&In-Reply-To=739CAE65-F29E-4FA8-96BF-A6C1548A9E02%40twistedmatrix.com"
       TITLE="[Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)">kevin.horn at gmail.com
       </A><BR>
    <I>Thu Mar  7 12:01:29 EST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026600.html">[Twisted-Python] Lore, Sphinx,	and getting to the finish line (was: re: lore and tickets and other	stuff)
</A></li>
        <LI>Next message: <A HREF="026682.html">[Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26647">[ date ]</a>
              <a href="thread.html#26647">[ thread ]</a>
              <a href="subject.html#26647">[ subject ]</a>
              <a href="author.html#26647">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry it's taken me so long to get back to this.  But it's gotten to be a
Looong email.

On Sat, Mar 2, 2013 at 3:14 AM, Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On Mar 1, 2013, at 9:35 PM, Kevin Horn &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.horn at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> That &quot;never-ending&quot; series of Lore source fixes took place over the course
</I>&gt;<i> of a couple of weeks.  Doing things that way was not my idea, though it
</I>&gt;<i> seemed reasonable at the time because  the idea was that we would do the
</I>&gt;<i> cutover at the end of it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well, let's go to the video tape. Based on this comment -  &lt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/trac/ticket/4500#comment:12">http://twistedmatrix.com/trac/ticket/4500#comment:12</A>&gt; - these tickets
</I>&gt;<i> were closed over a period ranging from 2010/07 to 2011/03. 6 months isn't
</I>&gt;<i> quite &quot;weeks&quot;, but okay I guess it wasn't &quot;never-ending&quot; either :).
</I>&gt;<i>
</I>&gt;<i>
</I>Hmmm.  I recall it as being much shorter.  Probably most of the work took
place it two &quot;spurts&quot; around the beginning and end of that time, and that's
why I remember it that way.  But I'm not interested in digging through a
bunch of old dates to find out for sure.


&gt;<i> (As an aside, lore2sphinx is in no way a &quot;broken pile of regexes&quot;.  Not to
</I>&gt;<i> say that it isn't broken in some really significant ways, because it is,
</I>&gt;<i> but it doesn't use regexes at all.  Just sayin'.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Actually yeah, &quot;regex&quot; is just a curse-word here :).  It's the emitter I'm
</I>&gt;<i> complaining about, anyway, not the parser, so deriding it as a &quot;regex&quot; is
</I>&gt;<i> in no way accurate.
</I>&gt;<i>
</I>
I figured that was the case, I just wanted to say something so others
reading this didn't get the wrong impression about how lore2sphinx is
implemented.  I mean it's not code I'm very proud of, but it's not _that_
bad :)


&lt;&lt;&lt; snip a bunch of stuff about who said what when, why I thought what I
thought, etc. &gt;&gt;&gt;

It boils down to the fact that a bunch of the conversations happened either
in person or on IRC.  This was mostly because I was in a hurry at the time,
usually because I wanted to do something before additions were made to the
documentation, which was in a somewhat &quot;known&quot; state (as in I knew how it
was going to behave when run through lore2sphinx) at the time.

Also, please elaborate on what you mean  by &quot;do *everything* in one big
&gt;<i> bang.  My intention was never to do anything but get the SphinxBuilder
</I>&gt;<i> working on that branch.  Was there something else you thought I was doing?
</I>&gt;<i>  Was there something else I should (or should not) have been doing?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My reasoning goes like this: the ticket for the release tools is still not
</I>&gt;<i> in review, so you must be waiting for something to re-submit it.  It looks
</I>&gt;<i> like you responded to the code, so the only thing I could think you were
</I>&gt;<i> still waiting for would be for the lore sources themselves to be ready.
</I>&gt;<i>
</I>&gt;<i>
</I>It's been long enough that I can't fully recall my reasoning on this.  But
_probably_ I decided that if I finished the release tools ticket, someone
might use it.  Which would be great, except that I think I had decided that
before that actually happened I needed to figure out a way to emit nicer
output from lore2sphinx.  So I left it alone until I had figured out how to
do that.

At least, that _might_ have been part of my thought process.  It really was
ages ago.

[the fixed-up Lore sources] got left alone because of the release tools
&gt;<i> hangup.  Ideally the release tools would have been done before the whole
</I>&gt;<i> lore-source-tweaking process, but they weren't.  I'll admit my frustration
</I>&gt;<i> played a part in this, but so did the deafening silence I got when I asked
</I>&gt;<i> for anyone to comment on the ticket.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Where and how did you ask people to comment on the ticket?  I don't recall
</I>&gt;<i> being asked, and I tend to be pretty good about leaving prompts like that
</I>&gt;<i> in my inbox until I've done what was asked.  (Not *perfect*, of course, and
</I>&gt;<i> if you asked a list then there might have been some bystander effect.)  It
</I>&gt;<i> seems like we might have avoided this whole mess if you had just attached
</I>&gt;<i> the 'review' keyword :).
</I>&gt;<i>
</I>
On IRC.


&gt;<i>
</I>&gt;<i> My perception has been that I would say &quot;what do we need to do to make
</I>&gt;<i> this happen&quot;?  There would be some hemming and hawing (and at least several
</I>&gt;<i> times long discussions about how documentation didn't really fit the
</I>&gt;<i> regular UQDS process) and a sort of plan would be invented.  I would
</I>&gt;<i> proceed according to the plan as I understood it.  I would then say &quot;OK,
</I>&gt;<i> we're ready&quot;!  And then be told that some other thing not in the plan
</I>&gt;<i> needed to be done.  The cycle would then repeat.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The only &quot;cycle&quot; I can either see on the tickets or recall here is where
</I>&gt;<i> the release tools didn't come in to the initial plan.
</I>&gt;<i>
</I>
This was the latest of several (3 or 4) according to my
recollection/perception.  It doesn't really matter now.


&gt;<i> No [the need for release automation] was not brought up until well into
</I>&gt;<i> the process. I (sort of) understand the desire for this, but it seems
</I>&gt;<i> pretty weird to be building what is essentially a wrapper for an existing
</I>&gt;<i> tool, along with tests for said wrapper,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> OK.  I can believe that this did not happen.  One problem is that we (the
</I>&gt;<i> inner-circle old-school Twisted developers) tend to engage in conversations
</I>&gt;<i> about how a thing might be done while at the same time we discuss what must
</I>&gt;<i> be done.  And we also tend to discuss what policy is (or what all or some
</I>&gt;<i> of us believe it *ought to be* in some case, further confusing the issue)
</I>&gt;<i> without making explicit what the *purpose* of that requirement is.
</I>&gt;<i>
</I>&gt;<i> I would ask the community to help us with this by doing a couple of things.
</I>&gt;<i>
</I>&gt;<i> If somebody says &quot;X is policy&quot;, always ask for a link to it.  If there is
</I>&gt;<i> a link, it'll help you understand it better.  If there *isn't* a link,
</I>&gt;<i> then the authority telling you it's &quot;policy&quot; might just be remembering that
</I>&gt;<i> it's the way we've done things since forever and of course it's a good
</I>&gt;<i> idea.  There are definitely things that I have thought were in the coding
</I>&gt;<i> standard that are not actually written down anywhere, on more than one
</I>&gt;<i> occasion.
</I>&gt;<i>
</I>&gt;<i> If a meandering discussion is happening - here, on the mailing list, on
</I>&gt;<i> the ticket - never be afraid to break it up and separate out the different
</I>&gt;<i> concerns which are being discussed: what is necessary for compliance with
</I>&gt;<i> our development process, what would be a good idea from a design point of
</I>&gt;<i> view, how the work might be broken up to get through review more
</I>&gt;<i> manageably, what other concerns are in play.
</I>&gt;<i>
</I>&gt;<i> Especially, if you ever see a code review where a reviewer says &quot;I
</I>&gt;<i> think...&quot; without making it clear what you should *do*, you should always
</I>&gt;<i> ask, 'is this a requirement of the review or just some thoughts you have'.
</I>&gt;<i>
</I>&gt;<i>
</I>And when we ask, we should ask on the ticket, and put it back into review,
yes?  Because I think this was the part (or at least _A_ part) I was really
missing here.


&gt;<i> There's also the problem of &quot;I think you should...&quot; being interpreted as
</I>&gt;<i> &quot;You must...&quot;.  It is *very* hard to consistently separate design
</I>&gt;<i> feedback from code review, although we try very hard; but, it's hard to
</I>&gt;<i> separate it out when reading it as well.  So one important point to keep in
</I>&gt;<i> mind is that, as the author of a proposed change, outside the things that
</I>&gt;<i> are agreed upon policy consensus, you always have some degree of discretion
</I>&gt;<i> to disagree with a reviewer.  And you should freely do so when submitting
</I>&gt;<i> anything for re-review.  It's best to just do this as quickly as possible,
</I>&gt;<i> so that it gets back to the reviewer without a whole lot of delay, and they
</I>&gt;<i> can respond with either &quot;I still disagree, but you're doing the work, so OK
</I>&gt;<i> go ahead&quot; or &quot;No, you really have to do this, it's required by policy
</I>&gt;<i> document X, here's a link&quot; ;-).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>    1. The documentation itself needs to be able to be generated from any
</I>&gt;&gt;<i>    version of trunk.  While one or two formatting snafus are acceptable to be
</I>&gt;&gt;<i>    fixed after the fact, the documentation needs to be in a comprehensible
</I>&gt;&gt;<i>    state in every revision of trunk, which means that in order to land on
</I>&gt;&gt;<i>    trunk, the ReST output.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So...you didn't finish that sentence.  I realize you apologized for
</I>&gt;<i> errors at the end of your mail, but I have a feeling you were going to say
</I>&gt;<i> something rather important there...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well yes, that was the point of the apology.  That was a rather important
</I>&gt;<i> thing.  What I was probably going to say was just:
</I>&gt;<i>
</I>&gt;<i> The ReST output needs to be in good enough shape to be generally readable,
</I>&gt;<i> with a manageable number of errors.  But, we need to be able to *verify*
</I>&gt;<i> that it has not too many errors.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> And I'd already discussed that somewhat above.
</I>&gt;<i>
</I>&gt;<i> Now that I've replied to all of that, let me give you a rundown of what
</I>&gt;<i> I've been thinking and planning, so that you have an idea of where I'm
</I>&gt;<i> coming from.
</I>&gt;<i>
</I>&gt;<i> Here are the various things that I have perceived to be necessary/required
</I>&gt;<i> in order to get the conversion to happen:
</I>&gt;<i>
</I>&gt;<i> a) The conversion process needs to be able to be run concurrently with
</I>&gt;<i> Lore for an extended period of time.  In other words, Lore would be the
</I>&gt;<i> &quot;official&quot; version of the docs, and the Sphinx docs would be built in some
</I>&gt;<i> form of automated fashion until everyone was happy with them and/or ready
</I>&gt;<i> to deprecate/abandon Lore.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Your understanding of this requirement is slightly off, I think, although
</I>&gt;<i> possibly the consequences are the same.  As per the difficulties I laid out
</I>&gt;<i> above, about separating the requirements from the strategies for satisfying
</I>&gt;<i> said requirements.
</I>&gt;<i>
</I>
I've been told that almost verbatim, several times.  This is basically what
led to the Sphinx buildbot happening.  Perhaps I wasn't clear about what I
meant.


&gt;<i> The thing that we weren't going to tolerate was any message saying that
</I>&gt;<i> people should hold off on writing documentation, even for &quot;a little while&quot;
</I>&gt;<i> while we fixed up the lore conversion, because without a contractual
</I>&gt;<i> obligation for someone to finish this work, there's really no telling how
</I>&gt;<i> long &quot;a little while&quot; would be :).
</I>&gt;<i>
</I>
Well, when I originally was pushing it, my plan was for that little while
to be &quot;today&quot; (this was at PyCon during the only day of sprints I was able
to attend), and if it didn't get done, we'd abandon that particular
attempt.  You and exarkun managed to convince me that even this was
probably not a very good idea though.


&gt;<i> Since the whole point of this sphinx conversion is to appeal to
</I>&gt;<i> documentation authors who prefer the ReST format as input (it's definitely
</I>&gt;<i> not to make the docs look nicer, writing a new stylesheet for Lore would
</I>&gt;<i> have taken 1/100th of the effort and nobody has expressed interest in doing
</I>&gt;<i> that), creating a period where things were even *less* appealing to
</I>&gt;<i> documentation authors would defeat the purpose.
</I>&gt;<i>
</I>
I actually considered the stylesheet thing, but it was really only a
passing thought.  My personal motivation started with not being able to
find things in the documentation.  So I started looking at the various Lore
tickets to see whether there was something to clean up that would help.
 And a bunch of them seemed to be asking for things that Sphinx already
did.  Sphinx was starting to become a common tool, and I had used it on
several other projects, and found it pleasant to work with.  Also, when I
asked about Lore on IRC, I got a lot of &quot;I'm not sure anyone knows how that
works these days&quot; and &quot;oh man, I wish we didn't have to support that any
more&quot;, etc.  So I started looking into how to convert the docs over to use
Sphinx.


&gt;<i> Another possible solution to this problem would be to modify Lore so it
</I>&gt;<i> could process ReST sources, so that we could convert the documentation
</I>&gt;<i> within the repository piecemeal, and start writing any new docs in ReST,
</I>&gt;<i> but still have a coherent whole of documentation produced, eventually
</I>&gt;<i> switching the documentation processor from Lore to Sphinx.
</I>&gt;<i>
</I>
This would require someone smarter than me.  Or at least more versed in
formal parsing theory/techniques.  Or something.  And that would be just to
read the docutils sources.  I find them...alien. (though less so that when
I first started looking at them...I'm not sure if they've improved, or I
have)


&gt;<i> Yet another possible solution would be to modify Sphinx, adding a plugin
</I>&gt;<i> to process the Lore sources.
</I>&gt;<i>
</I>
This is more reasonable, but still has problems.  Actually the reasonable
thing would be to create a docutils piece to process Lore sources, and then
maybe some Sphinx extensions on top of that.  Or something.  Still, it
might have been doable.  However, I think Lore would have had to be
modified as well, and possibly the Lore format expanded
to accommodate certain constructs that it just doesn't do right now (mostly
I'm thinking of the toctree directive and related stuff).


&gt;<i> As an aside: this is the part of the process which has been so frustrating
</I>&gt;<i> to me, personally.  The two alternate solutions I proposed here (and have
</I>&gt;<i> proposed before) seem far saner and more manageable in terms of effort, to
</I>&gt;<i> me.  But, everyone I have spoken to about docutils and ReST has told me in
</I>&gt;<i> no uncertain terms that they are both a pile of heinous hacks that resist
</I>&gt;<i> any attempt at sensible software-engineering solutions to problems, so we
</I>&gt;<i> need to resort to hackish system-integration stuff like what we've done.
</I>&gt;<i>  This worries me.
</I>&gt;<i>
</I>
Ooookaaaaay....I don't know how to respond to that exactly.


&gt;<i> I know that Sphinx's output is well-loved by the Python community, but if
</I>&gt;<i> it's so hard to call into that we can't reasonably modify it to get an XML
</I>&gt;<i> DOM that looks like Lore source to Lore, and it's so hard to plug in to it
</I>&gt;<i> that we can't give it a data structure that it likes from Lore's XML DOM,
</I>&gt;<i> then how the heck is it being maintained?  And if it actually *isn't* that
</I>&gt;<i> bad, then why haven't I managed to find someone that knows its code well
</I>&gt;<i> enough to do one or the other of these things?
</I>&gt;<i>
</I>
It would be possible to make Sphinx emit Lore sources, though I'm not sure
what that buys.  You could do this either through a custom Sphinx
&quot;builder&quot;, or possibly even just using a custom html template with the html
builder.  But you'd need ReST sources to feed into Sphinx, so...

You could write a docutils &quot;parser&quot; which parses a document and returns a
&quot;nodetree&quot; data structure.  This would get you as far as docutils, but
AFAIK there is no existing way to get Sphinx to use any parser other than
the default ReST one.  You could probably create such a thing, which would
almost certainly involve modifications to Sphinx, though that's not
necessarily a big deal.  It might not even be hard.  I think this would
actually be a lot easier now than when I started down this path, mostly
because docutils seems to have better documentation on the nodes that can
go in the &quot;nodetree&quot; I mentioned above.  Note that I said &quot;seems&quot; because
I'm not sure if it's that docutils documentation has gotten more complete,
or just that I've bounced around in it enough times to find things.  The
Docutils docs have the same problem that the Twisted docs have, which is
that they are nigh un-navigable.  (I also think that the docutils docs
should start using Sphinx, but I'm not sure how well that would go over in
that camp...)

The main problem with creating such a parser, is that Sphinx uses a bunch
of docutils extensions to tie together the disparate documents in your
project, and Lore, like vanilla docutils, doesn't have much of a concept of
being one document among many (at least not from within a document).  For
example, it has things to handle tables of contents, cross document links
(with the ability to link to a document section, rather than a specific
document, so if it gets moved to a different document, the link gets
adjusted), compilation for glossaries and index entries from across the
docs project, etc.  So you'd need to add some stuff to Lore to account for
this (some is already there).  And then we'd have to go through and modify
a bunch of the Lore sources anyway.

Like I said, this looks a lot more feasible now than it did when I first
looked at it, though I'm not sure whether it's me or docutils/Sphinx that's
changed.  Probably some of each.

At any rate, back then it seemed awfully difficult, and less interesting.

Hmmm.  And you'd also need to make some changes to the way Sphinx picks up
files.  And probably some other stuff I haven't thought of.

I have no direct knowledge of any of this stuff, because my main interest
&gt;<i> here is improving the experience of working on Twisted, both for you,
</I>&gt;<i> Kevin, and for the people who will arguably be helped by the use of Sphinx.
</I>&gt;<i>  Maybe I'm completely wrong and Sphinx is beautifully architected and we
</I>&gt;<i> could have done this from day 1.  But I faintly hope that some Docutils and
</I>&gt;<i> Sphinx contributor hears that I said &quot;sphinx is garbage&quot; and makes a fool
</I>&gt;<i> of me by contributing either a lore modification or a sphinx plugin which
</I>&gt;<i> solves this whole problem so we can do the format or tool migration
</I>&gt;<i> incrementally :).
</I>&gt;<i>
</I>&gt;<i> b) Because of a), there needs to be tooling to run lore2sphinx (or
</I>&gt;<i> whatever) on a regular basis.  (This was sort of being done via the
</I>&gt;<i> Sphinx-building buildbot, but in a very ad-hockery sort of way, which was
</I>&gt;<i> brittle, broke a couple of times, and needed to be improved.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hmm. I wasn't aware of that. But it seems like it's running by a charm now.
</I>&gt;<i>
</I>
I think this is because a) exarkun fixed it a couple of times, and b) I
stopped making changes to the lore2sphinx repo (which the buildbot pulls
from).  I'm also referring here to something which is completely
non-obvious to anyone who hasn't actually run lore2sphinx by hand, which is
that the command line tool was fairly terrible in several ways.  This made
it harder to use for development than it should have been.


&gt;<i>
</I>&gt;<i> c) There needs to be release management tooling to build the Sphinx docs
</I>&gt;<i> from ReST into whatever formats we want to publish (HTML and PDF to start,
</I>&gt;<i> maybe others later on)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yup.  (ePub?  PDF is so last-century... :))
</I>&gt;<i>
</I>&gt;<i> d) Convert the Lore sources to better ReST documents without all the
</I>&gt;<i> problems that the current lore2sphinx output has.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So, this wasn't *necessary*.  If we had gotten through the release
</I>&gt;<i> automation stuff - and I still don't understand why that's stuck - we could
</I>&gt;<i> have merged it.
</I>&gt;<i>
</I>
Well, I decided it was.  Or at least really really desirable.


&gt;<i> I at one time thought this was pretty impractical.  My first attempt at a
</I>&gt;<i> conversion tool tried to use an intermediate object model, but I ran into
</I>&gt;<i> trouble when trying to combine the various objects.  So I abandoned the
</I>&gt;<i> effort and created what became lore2sphinx, which basically just combined a
</I>&gt;<i> bunch of strings.  I then figured out a way of making the intermediate
</I>&gt;<i> object thing work, and that was lore2sphinx-ng.  Then it became convenient
</I>&gt;<i> to split out the intermediate object model from the documetn processing
</I>&gt;<i> code, so I put all of that into a library and that became rstgen.
</I>&gt;<i>
</I>&gt;<i> It seems the saving grace here is that rstgen might be a generally useful
</I>&gt;<i> tool in its own right, with more of a long-term future than lore2sphinx
</I>&gt;<i> would have had.
</I>&gt;<i>
</I>
I admit that I have become more interested in the actual problem of
&quot;generating ReST&quot; than I once was.  And I hope that it will become a
generally useful tool.

And probably one of the reasons I have been making such relatively slow
progress on it is is _because_ I'm trying to solve a more general problem
than I once was.  The original lore2sphinx (the one running on the buildbot
now) was very much a minimal-thing-that-could-possibly-work kind of
solution.  It tried to do just enough to get the job done.  It sort of did
get the job done, but I was never very satisfied with it.


&gt;<i> (For anyone who is curious, the lore2sphinx-ng repo is forked off from the
</I>&gt;<i> lore2sphinx repo, primarily because I didn't want to break the Sphinx
</I>&gt;<i> buildbot by making drastic changes.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Have a link?
</I>&gt;<i>
</I>
I've posted it a couple of times in this thread, though I can hardly blame
you for either missing it or losing track of it.

original: <A HREF="https://bitbucket.org/khorn/lore2sphinx">https://bitbucket.org/khorn/lore2sphinx</A>
extra-crispy: <A HREF="https://bitbucket.org/khorn/lore2sphinx-ng">https://bitbucket.org/khorn/lore2sphinx-ng</A>


&gt;<i>
</I>&gt;<i> Here's what my plan was prior to this whole discussion getting started
</I>&gt;<i> again.
</I>&gt;<i>
</I>&gt;<i> 1) Finish rstgen, where &quot;finished&quot; in this instance is defined as &quot;is
</I>&gt;<i> capable of generating all the vanilla docutils and sphinx-specific ReST
</I>&gt;<i> elements that we need for converting the
</I>&gt;<i> Twisted documentation.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sounds like a worthy goal, although I don't think this is necessarily
</I>&gt;<i> required.  Have you been working on it for the last 2 years?  Do you have
</I>&gt;<i> any idea when it might be done?  It might be worthwhile to write a
</I>&gt;<i> *smaller* .
</I>&gt;<i>
</I>
I started on rstgen a bit more than a year ago.  I was hung up on the
problem of how to combine various parts of a document for a while without
having the crazy space-handling issues.  And also I've been trying to come
up with a relatively friendly API, and enough generality that it will end
up useful outside of the lore2sphinx context.

I really started on l2s-ng last July during &quot;Julython&quot;.  I've been working
on it in fits and starts a few times since then.


&gt;<i>
</I>&gt;<i> 2) Finish lore2sphinx-ng (which would probably have ended with merging it
</I>&gt;<i> back into the lore2sphinx repo), where &quot;finished&quot; means that it would be
</I>&gt;<i> capable of processing all the XHTML Lore tags that were defined in the Lore
</I>&gt;<i> documentation and used in the Twisted documentation, and generating a tree
</I>&gt;<i> of rstgen elements, which could then be rendered into ReST.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cool.
</I>&gt;<i>
</I>&gt;<i> While this would be handy, especially for people working on documentation
</I>&gt;<i> branches, it's not necessarily necessary.
</I>&gt;<i>
</I>&gt;<i> (this would also serve to satisfy b) above, as the CLI in lore2sphinx-ng
</I>&gt;<i> is less...well, let's just call it broken than lore2sphinx's was/is.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> OK.
</I>&gt;<i>
</I>&gt;<i> 3) Go back and finish SphinxBuilder (release tooling for building a sphinx
</I>&gt;<i> project, which is basically a wrapper for sphinx-build, plus some vague
</I>&gt;<i> &quot;version feature&quot;).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is really the crux; this is the thing you should work on first, I
</I>&gt;<i> think, even if you're going to keep working on lore2sphinx-ng.  Basically
</I>&gt;<i> the only reason that I was keen to get the lore to sphinx conversion
</I>&gt;<i> improved in the first place was that creating this tool seemed to be
</I>&gt;<i> dragging on for quite a while after the &quot;chunk tickets&quot; were done.  But
</I>&gt;<i> now, this tool is almost done, and we could re-do the lore-source review if
</I>&gt;<i> you wanted to do that.  The current lore2sphinx might well be good enough
</I>&gt;<i> to just go with, especially if the next-generation version is going to take
</I>&gt;<i> another six months to finish.
</I>&gt;<i>
</I>
I'll take a look at this again soonish (a week?  this month? don't know.).
 Probably it's a matter of:

- merge forward (it has been a while)
- figure out how the other tools guess/determine the Twisted version in the
checkout, and make SphinxBuilder do that.
- get it reveiewed
- commit

But I'll have to remember how to use combinator again (which will be much
easier now that the combinator &quot;docs&quot; are on the Twisted wiki...thanks to
whomever did that!)

Yes, I could probably use Bazaar, but so far every time I've tried that,
I've ended up spending waaaaaay too much time just on the VCS.  I guess I
have some kind of mental block with bzr.  I'll get over it someday I
suppose.


&gt;<i>
</I>&gt;<i> 4) Get someone to use something less hackish than what's currently
</I>&gt;<i> building the Sphinx docs on the buildbot, and preferably in such a way that
</I>&gt;<i> the results of those builds could be published somewhere and have
</I>&gt;<i> persistent links.  Currently the results of what the Sphinx buildbot does
</I>&gt;<i> are stored for a time, and then go away, so you'll see links to build
</I>&gt;<i> results in some trac tickets that go nowhere, which is decidedly unhelpful.
</I>&gt;<i>  My plan was that we'd set up something where the Sphinx docs would get
</I>&gt;<i> generated and published someplace for every buildbot build so that we could
</I>&gt;<i> always have the current results for the lore to sphinx conversion for the
</I>&gt;<i> tip of each branch.  I have no idea whether this is actually feasible or
</I>&gt;<i> practical, but it seemed like it would be useful.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> OK, *this* sounds like really unnecessary turd-polishing ;-).  This
</I>&gt;<i> builder is an interim step; the more interesting step is the builder that
</I>&gt;<i> just builds the sphinx docs, in the same way that the current builder
</I>&gt;<i> builds the lore docs.  Furthermore, it seems to be working fine.  Build
</I>&gt;<i> results links that go nowhere are a known problem with buildbot, since it
</I>&gt;<i> does eventually lose most history, and this type of history takes up a fair
</I>&gt;<i> bit of disk space.
</I>&gt;<i>
</I>
Well, it was mostly motivated by the fact that we were doing a lot of
linking to build results that would then cease to exist for a while, and it
really annoyed me.  It doesn't seem nearly as &quot;necessary&quot; to me now as it
once did.


&gt;<i>
</I>&gt;<i> 5) Proceed with Sphinx docs being built from lore sources, making tweaks
</I>&gt;<i> as necessary to lore2sphinx(ng) for as long as it took for the generated
</I>&gt;<i> docs to be good enough to justify switching to Sphinx entirely.
</I>&gt;<i> 6) Switch to Sphinx entirely.
</I>&gt;<i>
</I>&gt;<i> I really wasn't planning on trying to get people excited about switching
</I>&gt;<i> to Sphinx again until 1) and 2) were at least &quot;mostly&quot; done (for certain
</I>&gt;<i> values of done) and I had gone back to finish 3).
</I>&gt;<i>
</I>&gt;<i> So.  I guess at this point the question is whether to try and go with
</I>&gt;<i> what's there (lore2sphinx) or finish up the &quot;new stuff&quot; (lore2sphinx-ng +
</I>&gt;<i> rstgen).  I think 3-6 in my above plan need to happen in any case, and I
</I>&gt;<i> think those will be much easier with lore2sphinx-ng+rstgen.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This decision is really determined by time estimates.
</I>&gt;<i>
</I>&gt;<i> In any case, work out the sphinx release automation tool first, since we
</I>&gt;<i> need that regardless of how we switch over
</I>&gt;<i>
</I>
Got it.


&gt;<i>
</I>&gt;<i> IIRC, rstgen has support for most of the vanilla docutils elements, with
</I>&gt;<i> the notable exception of tables (and maybe definition lists...can't recall
</I>&gt;<i> whether I finished those).  It has a basic level of test coverage (of
</I>&gt;<i> course you can never have too many tests) for rendering the elements
</I>&gt;<i> individually, and some test for elements in combination (particularly
</I>&gt;<i> nested lists).  Footnotes and Citations I think also need some work, which
</I>&gt;<i> I have a plan for, but haven't implemented yet (i don't think).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The &quot;new&quot; lore2sphinx CLI tool needs more work, but is relatively
</I>&gt;<i> straightforward.  Like the old tool, it's basically an elementtree
</I>&gt;<i> processor, except instead of spitting out strings that get joined together
</I>&gt;<i> (which granted was an unholy mess), it generates rstgen elements, which all
</I>&gt;<i> have a .render() method.  After processing a Lore document, you shoudl end
</I>&gt;<i> up with a rstgen.Document object.  You call it's render() method, which
</I>&gt;<i> calls it's children's render() methods, etc. and it's turtles all the way
</I>&gt;<i> down.
</I>&gt;<i>
</I>&gt;<i> The framework is there for the new CLI tool, it's mostly a matter of
</I>&gt;<i> writing a bunch of short methods that take elementtree elements as input
</I>&gt;<i> and return appropriate rstgen objects.
</I>&gt;<i>
</I>&gt;<i> Obviously these tools aren't finished, but they produce much better output
</I>&gt;<i> than the old version of lore2sphinx w.r.t. whitespace handling, paragraph
</I>&gt;<i> wrapping, etc.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Aesthetically, this appeals to me a lot more than going with the messiness
</I>&gt;<i> of lore2sphinx.
</I>&gt;<i>
</I>
Me too.



&gt;<i> But it is _not_ a requirement.
</I>&gt;<i>
</I>
Understood.  Though I think it might be a practical requirement, even if it
isn't a policy requirement.  If that makes sense.



&gt;<i> Some of the code is still pretty messy, but nowhere near the train wreck
</I>&gt;<i> that the current/old version of lore2sphinx is.  By which I mean it _can_
</I>&gt;<i> be cleaned up, it just hasn't been yet.  In particular there's some places
</I>&gt;<i> in rstgen where the API is (to me at least) obviously awful, but I haven't
</I>&gt;<i> gotten around to fixing it yet.
</I>&gt;<i>
</I>&gt;<i> Please review the code.  Please feel free to ask questions if you're
</I>&gt;<i> interested.
</I>&gt;<i>
</I>&gt;<i> Personally, I've gotten over being in a hurry about all this, and I think
</I>&gt;<i> a robust tool is more likely to succeed in the long run, though finishing
</I>&gt;<i> it may make the run a bit longer.  So I'm for finishing
</I>&gt;<i> lore2sphinx-ng+rstgen.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I think a little false urgency might not hurt here :-).  I'm not going to
</I>&gt;<i> work on the tool - just writing these emails probably blew my Twisted
</I>&gt;<i> development budget for the next two months ;-)
</I>&gt;<i>
</I>
I can relate... :)


&gt;<i> - but I will do my best to quickly clear up any procedural
</I>&gt;<i> what-needs-to-be-done questions unambiguously.  Please ping if anything
</I>&gt;<i> gets you stuck.
</I>&gt;<i>
</I>
I'll let you know.

--
Kevin Horn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130307/af379fec/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130307/af379fec/attachment-0001.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026600.html">[Twisted-Python] Lore, Sphinx,	and getting to the finish line (was: re: lore and tickets and other	stuff)
</A></li>
	<LI>Next message: <A HREF="026682.html">[Twisted-Python] Lore, Sphinx, and getting to the finish line (was: re: lore and tickets and other stuff)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26647">[ date ]</a>
              <a href="thread.html#26647">[ thread ]</a>
              <a href="subject.html#26647">[ subject ]</a>
              <a href="author.html#26647">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
