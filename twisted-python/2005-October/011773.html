<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Thoughts about testing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Thoughts%20about%20testing&In-Reply-To=20051025121943.431.qmail%40web33909.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011761.html">
   <LINK REL="Next"  HREF="011777.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Thoughts about testing</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Thoughts%20about%20testing&In-Reply-To=20051025121943.431.qmail%40web33909.mail.mud.yahoo.com"
       TITLE="[Twisted-Python] Thoughts about testing">exarkun at divmod.com
       </A><BR>
    <I>Tue Oct 25 12:59:24 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011761.html">[Twisted-Python] Thoughts about testing
</A></li>
        <LI>Next message: <A HREF="011777.html">[Twisted-Python] Thoughts about testing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11773">[ date ]</a>
              <a href="thread.html#11773">[ thread ]</a>
              <a href="subject.html#11773">[ subject ]</a>
              <a href="author.html#11773">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 25 Oct 2005 05:19:43 -0700 (PDT), Antony Kummel &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">antonykummel at yahoo.com</A>&gt; wrote:
&gt;<i>Hi all,
</I>&gt;<i>
</I>&gt;<i>I just want to share some ideas that I have had.
</I>&gt;<i>
</I>&gt;&gt;<i>From my experience, testing with Trial is too hard. My
</I>&gt;<i>problems can be divided into three categories: 1.
</I>&gt;<i>obscure error reporting, 2. unclean reactor 3. whoop
</I>&gt;<i>whoop whoop.
</I>&gt;<i>
</I>&gt;<i>I am also pretty sure that I'm doing things that Trial
</I>&gt;<i>does not want me to do, such as actually opening
</I>&gt;<i>sockets and communication over the network. I'm saying
</I>&gt;<i>this because it does not seem to happen in the Twisted
</I>&gt;<i>test-suite. But I don't think there is a good reason
</I>&gt;<i>for this limitation.
</I>
The network is a source of unpredictability.  Unit tests 
that rely on it fail intermittently, mysteriously, and 
with no clear course of action for reproducing the failure, 
making debugging the problem extremely difficult, and reduces 
the overall utility of the test suite by introduces failures 
that aren't really failures, but which nevertheless must be 
investigated to determine whether they represent a real problem.

So, there's a pretty good reason, I think.  However, trial 
doesn't prevent you from doing this, so I'm not sure what 
the objection is.

&gt;<i>
</I>&gt;<i>Actually, in sum, I think there are too many
</I>&gt;<i>limitations on writing tests with Trial, and they all
</I>&gt;<i>boil down to the unclean reactor problem (or at least
</I>&gt;<i>most of them). I want to suggest an alternative
</I>&gt;<i>approach.
</I>
If tests are allowed to leave things like connections and timers 
(in general, event sources) lying around, subsequent tests can 
fail through no fault of their own when one of these event sources 
misbehaves.  If, for example, one causes an exception to be logged, 
trial will notice this and attribute it to some other hapless test, 
causing it to fail.  These problems are even more difficult to
track down than the ones I mentioned above, since it is not even 
clear in these cases _which_ test is /really/ failing.

&gt;<i>
</I>&gt;<i>How about not requiring the reactor to be clean at the
</I>&gt;<i>end of a test? If anyone wants to make sure that
</I>&gt;<i>anything they do leaves the reactor in a clean state,
</I>&gt;<i>they can test for it themselves. This seems to me more
</I>&gt;<i>like a constraint imposed by the implementation of
</I>&gt;<i>Trial rather than a useful feature.
</I>
I think it's a good idea.  I don't know that, in its current form, 
it is complete.  There are probably some improvements that could 
be made to ease the process of tracking down the sources of 
various problems it reports.  I don't think that means the entire 
feature should be scrapped.

&gt;<i>Also, parts of
</I>&gt;<i>Twisted itself are practically unusable inside a test
</I>&gt;<i>because they leave the reactor dirty (such as threaded
</I>&gt;<i>address resolution).
</I>
This should be addressed, certainly.  However, I don't often 
find myself resolving names using the system resolver in unit 
tests.  What if the system resolver is buggy?  What if the 
system is misconfigured?  What if there is a transient DNS 
failure?  What if the DNS server for the host you are interested 
in is temporarily offline?  These are not conditions I am happy 
to allow to cause my unit tests to fail.

&gt;<i>An alternative feature could be
</I>&gt;<i>enabling the user to specify that a certain delayed
</I>&gt;<i>call or thread is allowed to remain after the test,
</I>&gt;<i>and then Trial won't complain. The only question
</I>&gt;<i>remaining is how to do it. Simple: use a different
</I>&gt;<i>process. Run the tests in a different process, and
</I>&gt;<i>create a new one each time the reactor is dirtied.
</I>&gt;<i>py.execnet is a nice example of this concept.
</I>
Running tests in a child process is an interesting idea.  It 
provides a much greater degree of isolation between tests than 
essentially any other approach, which is great.  Isolation is 
great for unit tests.  Unfortunately, it comes with a lot of 
overhead.  While there are techniques for optimizing the 
implementation of such a feature, running each test method in a
different process would probably add at least 4 minutes to 
Twisted's test suite.  This is basically unacceptable (Twisted's 
suite takes way too long to run already).

Beyond performance problems, there's also the issue of debugging.
As in, how do you?  I'm aware of remote debuggers for Python, but
they're all third-party.  This is not necessarily a killer
drawback, but it is definitely a downside.

&gt;<i>The second thought is this: there seem to be popping
</I>&gt;<i>up different testing toolkits each with their own very
</I>&gt;<i>nice extensions and features
</I>&gt;<i>(<A HREF="http://testoob.sourceforge.net/,">http://testoob.sourceforge.net/,</A>
</I>&gt;<i><A HREF="http://codespeak.net/py/current/doc/test.html">http://codespeak.net/py/current/doc/test.html</A>). Trial
</I>&gt;<i>cannot benefit from this, having branched away at the
</I>&gt;<i>pyUnit level. I think Trial's special features can be
</I>&gt;<i>relatively easily formulated as plugins to a
</I>&gt;<i>plugin-oriented testing framework (especially if the
</I>&gt;<i>clean reactor requirement is relieved), and so can the
</I>&gt;<i>other testing packages. What this means, is that the
</I>&gt;<i>best thing anyone who wants the world of unit testing
</I>&gt;<i>to develop, and to benefit from it, is to push for a
</I>&gt;<i>plugin-oriented pyUnit, and for an implementation of
</I>&gt;<i>Trial (and the other tools) as a plugin for that
</I>&gt;<i>framework. I think.
</I>
Rather than hearing about the plethora of new testing libraries 
appearing, I'd like to hear about features they provide that are
valuable for writing tests.  I would certainly like to borrow 
py.test's magical assert.  What other features are test authors 
finding useful in some of these projects?

Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011761.html">[Twisted-Python] Thoughts about testing
</A></li>
	<LI>Next message: <A HREF="011777.html">[Twisted-Python] Thoughts about testing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11773">[ date ]</a>
              <a href="thread.html#11773">[ thread ]</a>
              <a href="subject.html#11773">[ subject ]</a>
              <a href="author.html#11773">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
