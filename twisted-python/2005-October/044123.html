<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r14683 - Make	thetoMainThread Queue unlimited in size, instead of max size 1. 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r14683%20-%20Make%0A%09thetoMainThread%20Queue%20unlimited%20in%20size%2C%20instead%20of%20max%20size%201.%20&In-Reply-To=%3C20051008023050.3914.1977843664.divmod.quotient.25552%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044122.html">
   <LINK REL="Next"  HREF="044130.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r14683 - Make	thetoMainThread Queue unlimited in size, instead of max size 1. </H1>
    <B>Stephen Thorne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r14683%20-%20Make%0A%09thetoMainThread%20Queue%20unlimited%20in%20size%2C%20instead%20of%20max%20size%201.%20&In-Reply-To=%3C20051008023050.3914.1977843664.divmod.quotient.25552%40ohm%3E"
       TITLE="[Twisted-Python] Re: [Twisted-commits] r14683 - Make	thetoMainThread Queue unlimited in size, instead of max size 1. ">stephen at thorne.id.au
       </A><BR>
    <I>Fri Oct  7 20:30:50 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044122.html">[Twisted-Python] Re: [Twisted-commits] r14683 - Make the	toMainThread Queue unlimited in size, instead of max size 1. 
</A></li>
        <LI>Next message (by thread): <A HREF="044130.html">[Twisted-Python] Re: [Twisted-commits] r14683 - Make	thetoMainThread Queue unlimited in size, instead of max size 1. 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44123">[ date ]</a>
              <a href="thread.html#44123">[ thread ]</a>
              <a href="subject.html#44123">[ subject ]</a>
              <a href="author.html#44123">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 7 Oct 2005 13:31:02 -0400, James Y Knight &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">foom at fuhm.net</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>On Oct 7, 2005, at 11:05 AM, Stephen Thorne wrote:
</I>&gt;&gt;<i>Make the toMainThread Queue unlimited in size, instead of max size 1.
</I>&gt;&gt;<i>This can cause deadlocks.
</I>&gt;<i>
</I>&gt;<i>Why does it cause deadlocks? That queue should be the only lock the  tsr 
</I>&gt;<i>thread blocks upon, besides the GIL. Making the queue infinite  means the 
</I>&gt;<i>tsr thread could sit there generating large amounts of  events before the 
</I>&gt;<i>main thread gets around to reading any of them,  getting in a state of 
</I>&gt;<i>continuous backlog and badness. From what I can  see, the select thread 
</I>&gt;<i>*should* block until the main thread has read  the data.
</I>
I'm not exactly sure, but it was deterministic. test_internet.InterfaceTestCase.testWakeUp would cause the reactor to stop dead.

It seems there are significant memory consumption issues, i'm in the process of figuring out if putting a sane upper limit on the queue (suggestions have ranged from 100's to 100,000's) will stop my poor powermac from being brought to its knees by threadedselectreactor.

There are quite a few more failures in threadedselectreactor, I'm seeing non-deterministic behaviour, things like tcp.Client using reactor.callLater(0, self.failIfNotConnected, error) being a problem - because if the fork in the code is taken that goes to that state, self.socket doesn't get defined, and code can end up trying to write to that socket and getting an AttributeError......

Suffice it to say, I'm working on the issues here, and I want my buidslave all green and pretty, I'll see about getting this resolved before the end of the weekend.

Stephen.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044122.html">[Twisted-Python] Re: [Twisted-commits] r14683 - Make the	toMainThread Queue unlimited in size, instead of max size 1. 
</A></li>
	<LI>Next message (by thread): <A HREF="044130.html">[Twisted-Python] Re: [Twisted-commits] r14683 - Make	thetoMainThread Queue unlimited in size, instead of max size 1. 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44123">[ date ]</a>
              <a href="thread.html#44123">[ thread ]</a>
              <a href="subject.html#44123">[ subject ]</a>
              <a href="author.html#44123">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
