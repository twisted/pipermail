<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] flow example doesn't appear to be 'flowing'
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20flow%20example%20doesn%27t%20appear%20to%20be%20%27flowing%27&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011577.html">
   <LINK REL="Next"  HREF="011589.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] flow example doesn't appear to be 'flowing'</H1>
    <B>Todd Greenwood</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20flow%20example%20doesn%27t%20appear%20to%20be%20%27flowing%27&In-Reply-To="
       TITLE="[Twisted-Python] flow example doesn't appear to be 'flowing'">tgreenwoodgeer at yahoo.com
       </A><BR>
    <I>Tue Oct  4 20:08:14 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011577.html">[Twisted-Python] conch.forwarding tutorial
</A></li>
        <LI>Next message: <A HREF="011589.html">[Twisted-Python] flow example doesn't appear to be 'flowing'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11588">[ date ]</a>
              <a href="thread.html#11588">[ thread ]</a>
              <a href="subject.html#11588">[ subject ]</a>
              <a href="author.html#11588">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>First, thanks for creating this cool tool!

I tried the following example (<A HREF="http://twistedmatrix.com/projects/flow/documentation/howto/flow.html">http://twistedmatrix.com/projects/flow/documentation/howto/flow.html</A>
) ...and what I saw doesn't match the documentation. The docs state that if you launch two browsers 
pointed at this url, that both pages will be built simultaneously, due to the flow/generator 
constructs. However, when I tried this, I saw the web pages being generated sequentially. The second 
page blocked until the first page finished. Is this simply my misunderstanding of the docs, or is 
this page outdated?

REPRO:
$ twistd --version
twistd (the Twisted daemon) 2.0.1
Copyright (c) 2001-2004 Twisted Matrix Laboratories.

$ python flow-demo.py
visit <A HREF="http://localhost:8081/">http://localhost:8081/</A> to view the example

#mozilla browser tab #1 =&gt; <A HREF="http://localhost:8081">http://localhost:8081</A>
  30 Random numbers:

    1. 46905
    2. 17955
    3. 62281
    4. 99248
    5. 73635

#mozilla browser tab #2 =&gt; <A HREF="http://localhost:8081">http://localhost:8081</A>
  blank until tab #1 has finished (has 30 random numbers)

DETAILS:
<A HREF="http://twistedmatrix.com/projects/flow/documentation/howto/flow.html">http://twistedmatrix.com/projects/flow/documentation/howto/flow.html</A>

Flow Resources

By using flow.Deferred it is easy to make up a web resource which is both long running, but also can 
serve more than one customer at a time. Run the example below, and with two browsers, view the 
webpage. Notice that both web pages are being created at the same time.

from __future__ import generators
from twisted.internet import reactor
from twisted.web import server, resource
from twisted.flow import flow

def cooperative(count):
     &quot;&quot;&quot; simulate a cooperative resource, that not block &quot;&quot;&quot;
     from random import random
     idx = 0
     while idx &lt; count:
         val = random()
         yield flow.Cooperate(val)
         yield str(val)[-5:]
         idx += 1

def flowRender(req):
     count = int(req.args.get(&quot;count&quot;,[&quot;30&quot;])[0])
     req.write(&quot;&lt;html&gt;&lt;body&gt;&quot;)
     req.write(&quot; %s Random numbers: &lt;ol&gt;\n&quot; % count)
     source = flow.wrap(cooperative(count))
     yield source
     for itm in source:
         req.write(&quot;&lt;li&gt;%s&lt;/li&gt;\n&quot; % itm)
         yield source
     req.write(&quot;&lt;/ol&gt;&lt;/body&gt;&lt;/html&gt;\n&quot;)

class FlowResource(resource.Resource):
     def __init__(self, gen):
         resource.Resource.__init__(self)
         self.gen = gen
     def isLeaf(self): return true
     def render(self, req):
         self.d = flow.Deferred(self.gen(req))
         self.d.addCallback(lambda _: req.finish())
         return server.NOT_DONE_YET

print &quot;visit <A HREF="http://localhost:8081/">http://localhost:8081/</A> to view the example&quot;
root = FlowResource(flowRender)
site = server.Site(root)
reactor.listenTCP(8081,site)
reactor.run()


-- 
Todd Greenwood-Geer
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tgreenwoodgeer at yahoo.com</A>
________________________________________________________________________________
BEAWorld 2005: coming to a city near you.  Everything you need for SOA and enterprise infrastructure success.

 
Register now at <A HREF="http://www.bea.com/4beaworld">http://www.bea.com/4beaworld</A>

 
London 11-12 Oct| Paris13-14 Oct| Prague18-19 Oct |Tokyo 25-26 Oct| Beijing 7-8 Dec


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011577.html">[Twisted-Python] conch.forwarding tutorial
</A></li>
	<LI>Next message: <A HREF="011589.html">[Twisted-Python] flow example doesn't appear to be 'flowing'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11588">[ date ]</a>
              <a href="thread.html#11588">[ thread ]</a>
              <a href="subject.html#11588">[ subject ]</a>
              <a href="author.html#11588">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
