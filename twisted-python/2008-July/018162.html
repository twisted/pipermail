<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Possible bug on twisted.conch.ssh.keys?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Possible%20bug%20on%20twisted.conch.ssh.keys%3F&In-Reply-To=29ec21540807280629y7852498blac2119ac986c43f2%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018163.html">
   <LINK REL="Next"  HREF="018166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Possible bug on twisted.conch.ssh.keys?</H1>
    <B>Adriano Marques</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Possible%20bug%20on%20twisted.conch.ssh.keys%3F&In-Reply-To=29ec21540807280629y7852498blac2119ac986c43f2%40mail.gmail.com"
       TITLE="[Twisted-Python] Re: Possible bug on twisted.conch.ssh.keys?">py.adriano at gmail.com
       </A><BR>
    <I>Mon Jul 28 11:04:49 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018163.html">[Twisted-Python] Possible bug on twisted.conch.ssh.keys?
</A></li>
        <LI>Next message: <A HREF="018166.html">[Twisted-Python] Re: Possible bug on twisted.conch.ssh.keys?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18162">[ date ]</a>
              <a href="thread.html#18162">[ thread ]</a>
              <a href="subject.html#18162">[ subject ]</a>
              <a href="author.html#18162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Folks,

While I was trying to find why the verify method was returning False,
I discovered that inside the _verify method, at RSA.py, there was the
following code:

&lt;RSA_code&gt;
def _verify(self, M, sig):
    m2=self._encrypt(sig[0])
    if m2[0]==M:
        return 1
    else: return 0
&lt;/RSA_code&gt;

Using the live debug of wingide, I checked the values, and here is the result:

&lt;debug&gt;
&gt;&gt;&gt;<i> print m2[0] == M
</I>False
&gt;&gt;&gt;<i> print m2[0]
</I>5486124068793688683255936251187209270074392635932332070112001988456197381759672947165175699536362793613284725337872111744958183862744647903224103718245670299614498700710006264535590197791934024641512541262359795191593456970905950167587431434979106624455856690274067852326335446193014962274187407641892263
&gt;&gt;&gt;<i> print M
</I>5486124068793688683255936251187209270074392635932332070112001988456197381759672947165175699536362793613284725337872111744958183862744647903224103718245670299614498700710006264535590197791934024641512541262359795191593456970905950167587431434979106624455857062955565129940502062033292313613058888050118445
&gt;&gt;&gt;<i> print type(m2[0]), type(M)
</I>&lt;type 'long'&gt; &lt;type 'long'&gt;
&lt;/debug&gt;

So, m2[0] is really different from M, but why if I'm using the same
keys from the same place?

Hope this helps to clear the issue.


Kind Regards,

On Mon, Jul 28, 2008 at 10:29 AM, Adriano Marques &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">py.adriano at gmail.com</A>&gt; wrote:
&gt;<i> Hello folks,
</I>&gt;<i>
</I>&gt;<i> I'm facing a problem here while trying to implement a ssh server and
</I>&gt;<i> client using twisted. There are some deprecated functions that are
</I>&gt;<i> pointing me to use new ones, which in turn doesn't seem to work fine.
</I>&gt;<i> I'm not sure if it is the case, mainly because the deprecated
</I>&gt;<i> functions are calling the new ones, but while debuging the code I
</I>&gt;<i> found that something there is wrong, and that can potentially be
</I>&gt;<i> hapenning because of the changes recently made to that module. As I'm
</I>&gt;<i> somehow new to twisted I'm not sure about my statements arround the
</I>&gt;<i> problem. Here follows the codes and exceptions I'm getting:
</I>&gt;<i>
</I>&gt;<i> &lt;client_code&gt;
</I>&gt;<i> #!/usr/bin/env python
</I>&gt;<i>
</I>&gt;<i> # This code was based on an example from twisted website
</I>&gt;<i>
</I>&gt;<i> from twisted.conch.ssh import transport, userauth, connection
</I>&gt;<i> from twisted.conch.ssh import common, keys, channel
</I>&gt;<i> from twisted.internet import defer, protocol, reactor
</I>&gt;<i> from twisted.python import log
</I>&gt;<i> import struct, sys, getpass, os
</I>&gt;<i>
</I>&gt;<i> USER = 'ssh'
</I>&gt;<i> HOST = 'localhost'
</I>&gt;<i> PORT = 2222
</I>&gt;<i> PUBKEY = &quot;ssh-rsa
</I>&gt;<i> AAAAB3NzaC1yc2EAAAADAQABAAAAgQD3n4sYqbdnlVyvy2SRUmQ5HJg2NDHyC0m4FIykDygXW2PTcSHU/Jany95D54qAEkUra0KHk94KvyGhNVYXqPmzPLu4onlr0Y/gQzEsIy15jDGjMWVCX/8+PQJxMYObSKs8U1o/h5fDNeKQs4bZbrm+35eT/Kvyerqa6ab5OsIEnQ==&quot;
</I>&gt;<i> PRIVKEY = &quot;&quot;&quot;-----BEGIN RSA PRIVATE KEY-----
</I>&gt;<i> MIICXAIBAAKBgQD3n4sYqbdnlVyvy2SRUmQ5HJg2NDHyC0m4FIykDygXW2PTcSHU
</I>&gt;<i> /Jany95D54qAEkUra0KHk94KvyGhNVYXqPmzPLu4onlr0Y/gQzEsIy15jDGjMWVC
</I>&gt;<i> X/8+PQJxMYObSKs8U1o/h5fDNeKQs4bZbrm+35eT/Kvyerqa6ab5OsIEnQIDAQAB
</I>&gt;<i> AoGAK2MWASVDkG+4RMkTfu77xpH/DYhJtApMSWe4WMqbELSfoh2xetsjHpV3BVjd
</I>&gt;<i> iKEq43ewuYasIh/pKZDp281sqqXdg9VI9ZW7kB00FhO2wA4emCIVj6CHMl1K9NrU
</I>&gt;<i> 9Spy40garaYnDdud79SnKtxlKQEALOwCpTEcrjGOLBTbirUCQQD/FkP1zhpOSaOy
</I>&gt;<i> B32CiC13W5fFfREzBxzQ3Med1i1OYtFfBEdJqv/Z7APadNN8ySI3r+UAfGatTzJI
</I>&gt;<i> zbiSZ2fHAkEA+IJwWpw6d8R3t7+8UgTrqdsZhLRdidO0cHcIFcnU/QYZg+iw3F+q
</I>&gt;<i> Tuz/mngpfb5214r8zwcwlNzsC4+fyOOYewJBAMPstRw6Rog1FW8rQ6Kbt9hCWItO
</I>&gt;<i> aYR5BRADU6sOk1PuoIPLhHm3xrX6CmejbcEdt5NwHYNHCZI6DxRONmL024cCQBky
</I>&gt;<i> eJvnXVJJfG4IJdsXHqIBUiwPcbCI47HHj+1NoqfpF2s1i8E8ffM0upH5/xL93eTq
</I>&gt;<i> 9ck0DGv7nn9pl6Tx1sMCQCWZbWDnmEdsSoNUQZ8fyQEDoZ/2gUP+R2/WpLikwmSA
</I>&gt;<i> 41n7cUONVthIYOZw0qQPP//PyPtMVxcYT76D5QACEK8=
</I>&gt;<i> -----END RSA PRIVATE KEY-----&quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i> class ClientTransport(transport.SSHClientTransport):
</I>&gt;<i>    def connectionMade(self):
</I>&gt;<i>        transport.SSHClientTransport.connectionMade(self)
</I>&gt;<i>
</I>&gt;<i>    def verifyHostKey(self, hostKey, fingerprint):
</I>&gt;<i>        return defer.succeed(1)
</I>&gt;<i>
</I>&gt;<i>    def connectionSecure(self):
</I>&gt;<i>        self.requestService(ClientUserAuth(USER, ClientConnection()))
</I>&gt;<i>
</I>&gt;<i> class ClientUserAuth(userauth.SSHUserAuthClient):
</I>&gt;<i>    def getPublicKey(self):
</I>&gt;<i>        # Issue 1
</I>&gt;<i>        return PUBKEY.encode(&quot;ascii&quot;)
</I>&gt;<i>
</I>&gt;<i>    def getPrivateKey(self):
</I>&gt;<i>        # Issue 2
</I>&gt;<i>        return defer.succeed(keys.getPrivateKeyObject(data=PRIVKEY))
</I>&gt;<i>
</I>&gt;<i>    def getPassword(self):
</I>&gt;<i>        return defer.succeed(getpass.getpass(&quot;%s@%s's password: &quot; %
</I>&gt;<i> (USER, HOST)))
</I>&gt;<i>
</I>&gt;<i>    def getGenericAnswers(self, name, instruction, questions):
</I>&gt;<i>        import pdb; pdb.set_trace()
</I>&gt;<i>        log.debug(&quot;Get Generic answers: %s, %s, %s&quot; % (name,
</I>&gt;<i>                                                       instruction,
</I>&gt;<i>                                                       questions))
</I>&gt;<i>
</I>&gt;<i>        answers = []
</I>&gt;<i>        for prompt, echo in questions:
</I>&gt;<i>            if echo:
</I>&gt;<i>                answer = raw_input(prompt)
</I>&gt;<i>            else:
</I>&gt;<i>                answer = getpass.getpass(prompt)
</I>&gt;<i>            answers.append(answer)
</I>&gt;<i>        return defer.succeed(answers)
</I>&gt;<i>
</I>&gt;<i>    def tryAuth(self, kind):
</I>&gt;<i>        kind = &quot;publickey&quot;
</I>&gt;<i>        log.debug(&quot;tryAuth: %s&quot; % kind)
</I>&gt;<i>        log.debug(&quot;Public Key: %s&quot; % self.getPublicKey())
</I>&gt;<i>        return userauth.SSHUserAuthClient.tryAuth(self, kind)
</I>&gt;<i>
</I>&gt;<i>    def signData(self, publicKey, signData):
</I>&gt;<i>        log.debug(&quot;Ran signData with %s and %s&quot; % (publicKey, signData))
</I>&gt;<i>        import pdb; pdb.set_trace()
</I>&gt;<i>        signed = userauth.SSHUserAuthClient.signData(self, publicKey, signData)
</I>&gt;<i>
</I>&gt;<i>        return signed
</I>&gt;<i>
</I>&gt;<i>    def auth_publickey(self):
</I>&gt;<i>        log.debug(&quot;Trying Auth Method: Public Key&quot;)
</I>&gt;<i>        return userauth.SSHUserAuthClient.auth_publickey(self)
</I>&gt;<i>
</I>&gt;<i> class ClientConnection(connection.SSHConnection):
</I>&gt;<i>    def serviceStarted(self):
</I>&gt;<i>        log.debug(&quot;Service started&quot;)
</I>&gt;<i>        self.openChannel(TrueChannel(2**16, 2**15, self))
</I>&gt;<i>        self.openChannel(FalseChannel(2**16, 2**15, self))
</I>&gt;<i>        self.openChannel(CatChannel(2**16, 2**15, self))
</I>&gt;<i>
</I>&gt;<i> class TrueChannel(channel.SSHChannel):
</I>&gt;<i>    name = 'session'
</I>&gt;<i>
</I>&gt;<i>    def openFailed(self, reason):
</I>&gt;<i>        print 'true failed', reason
</I>&gt;<i>
</I>&gt;<i>    def channelOpen(self, ignoredData):
</I>&gt;<i>        self.conn.sendRequest(self, 'exec', common.NS('true'))
</I>&gt;<i>
</I>&gt;<i>    def request_exit_status(self, data):
</I>&gt;<i>        status = struct.unpack('&gt;L', data)[0]
</I>&gt;<i>        print 'true status was: %s' % status
</I>&gt;<i>        self.loseConnection()
</I>&gt;<i>
</I>&gt;<i> class FalseChannel(channel.SSHChannel):
</I>&gt;<i>    name = 'session'
</I>&gt;<i>
</I>&gt;<i>    def openFailed(self, reason):
</I>&gt;<i>        print 'false failed', reason
</I>&gt;<i>
</I>&gt;<i>    def channelOpen(self, ignoredData):
</I>&gt;<i>        self.conn.sendRequest(self, 'exec', common.NS('false'))
</I>&gt;<i>
</I>&gt;<i>    def request_exit_status(self, data):
</I>&gt;<i>        status = struct.unpack('&gt;L', data)[0]
</I>&gt;<i>        print 'false status was: %s' % status
</I>&gt;<i>        self.loseConnection()
</I>&gt;<i>
</I>&gt;<i> class CatChannel(channel.SSHChannel):
</I>&gt;<i>    name = 'session'
</I>&gt;<i>
</I>&gt;<i>    def openFailed(self, reason):
</I>&gt;<i>        print 'echo failed', reason
</I>&gt;<i>
</I>&gt;<i>    def channelOpen(self, ignoredData):
</I>&gt;<i>        self.data = ''
</I>&gt;<i>        d = self.conn.sendRequest(self, 'exec', common.NS('cat'), wantReply = 1)
</I>&gt;<i>        d.addCallback(self._cbRequest)
</I>&gt;<i>
</I>&gt;<i>    def _cbRequest(self, ignored):
</I>&gt;<i>        self.write('hello conch\n')
</I>&gt;<i>        self.conn.sendEOF(self)
</I>&gt;<i>
</I>&gt;<i>    def dataReceived(self, data):
</I>&gt;<i>        self.data += data
</I>&gt;<i>
</I>&gt;<i>    def closed(self):
</I>&gt;<i>        print 'got data from cat: %s' % repr(self.data)
</I>&gt;<i>        self.loseConnection()
</I>&gt;<i>        reactor.stop()
</I>&gt;<i>
</I>&gt;<i> protocol.ClientCreator(reactor, ClientTransport).connectTCP(HOST, 2222)
</I>&gt;<i> reactor.run()
</I>&gt;<i> &lt;/client_code&gt;
</I>&gt;<i>
</I>&gt;<i> The issues:
</I>&gt;<i>
</I>&gt;<i> 1 - I had to encode the public key to ascii prior to using it. I don't
</I>&gt;<i> know why, but the struct was raising an exception telling that one of
</I>&gt;<i> the chars where out of the ascii range. But it doesn't look to have
</I>&gt;<i> any character outside the ascii range, AFAIK. Anyway, it worked when I
</I>&gt;<i> did the conversion to ascii.
</I>&gt;<i>
</I>&gt;<i> 2 - When I use: keys.Key.fromString(data=PRIVKEY) instead of the
</I>&gt;<i> deprecated keys.getPrivateKeyObject(data=PRIVKEY), I get this error
</I>&gt;<i> while trying to authenticate:
</I>&gt;<i>
</I>&gt;<i> &lt;error&gt;
</I>&gt;<i> # This was caught directly from pdb prompt:
</I>&gt;&gt;<i> connectSSH.py(77)signData()
</I>&gt;<i> -&gt; signed = userauth.SSHUserAuthClient.signData(self, publicKey, signData)
</I>&gt;<i> (Pdb) n
</I>&gt;&gt;<i> site-packages/twisted/conch/ssh/userauth.py:374: DeprecationWarning: signData is deprecated since Twisted Conch 0.9.  Use Key(obj).sign(data).
</I>&gt;<i>  return keys.signData(privateKey, signData)
</I>&gt;&gt;<i> connectSSH.py(79)signData()
</I>&gt;<i> -&gt; return signed
</I>&gt;<i> (Pdb) p signed
</I>&gt;<i> &lt;Deferred at 0x12a1760  current result:
</I>&gt;<i> &lt;twisted.python.failure.Failure &lt;type 'exceptions.RuntimeError'&gt;&gt;&gt;
</I>&gt;<i> (Pdb) p signed.result
</I>&gt;<i> &lt;twisted.python.failure.Failure &lt;type 'exceptions.RuntimeError'&gt;&gt;
</I>&gt;<i> (Pdb) p signed.result.getErrorMessage()
</I>&gt;<i> 'unknown type of object: &lt;RSA Private Key (1023 bits)\nattr
</I>&gt;<i> e:\n\t01:00:01\nattr
</I>&gt;<i> d:\n\t2b:63:16:01:25:43:90:6f:b8:44:c9:13:7e:ee:fb:\n\tc6:91:ff:0d:88:49:b4:0a:4c:49:67:b8:58:ca:9b:\n\t10:b4:9f:a2:1d:b1:7a:db:23:1e:95:77:05:58:dd:\n\t88:a1:2a:e3:77:b0:b9:86:ac:22:1f:e9:29:90:e9:\n\tdb:cd:6c:aa:a5:dd:83:d5:48:f5:95:bb:90:1d:34:\n\t16:13:b6:c0:0e:1e:98:22:15:8f:a0:87:32:5d:4a:\n\tf4:da:d4:f5:2a:72:e3:48:1a:ad:a6:27:0d:db:9d:\n\tef:d4:a7:2a:dc:65:29:01:00:2c:ec:02:a5:31:1c:\n\tae:31:8e:2c:14:db:8a:b5\nattr
</I>&gt;<i> n:\n\t00:f7:9f:8b:18:a9:b7:67:95:5c:af:cb:64:91:52:\n\t64:39:1c:98:36:34:31:f2:0b:49:b8:14:8c:a4:0f:\n\t28:17:5b:63:d3:71:21:d4:fc:96:a7:cb:de:43:e7:\n\t8a:80:12:45:2b:6b:42:87:93:de:0a:bf:21:a1:35:\n\t56:17:a8:f9:b3:3c:bb:b8:a2:79:6b:d1:8f:e0:43:\n\t31:2c:23:2d:79:8c:31:a3:31:65:42:5f:ff:3e:3d:\n\t02:71:31:83:9b:48:ab:3c:53:5a:3f:87:97:c3:35:\n\te2:90:b3:86:d9:6e:b9:be:df:97:93:fc:ab:f2:7a:\n\tba:9a:e9:a6:f9:3a:c2:04:9d\nattr
</I>&gt;<i> q:\n\t00:ff:16:43:f5:ce:1a:4e:49:a3:b2:07:7d:82:88:\n\t2d:77:5b:97:c5:7d:11:33:07:1c:d0:dc:c7:9d:d6:\n\t2d:4e:62:d1:5f:04:47:49:aa:ff:d9:ec:03:da:74:\n\td3:7c:c9:22:37:af:e5:00:7c:66:ad:4f:32:48:cd:\n\tb8:92:67:67:c7\nattr
</I>&gt;<i> p:\n\t00:f8:82:70:5a:9c:3a:77:c4:77:b7:bf:bc:52:04:\n\teb:a9:db:19:84:b4:5d:89:d3:b4:70:77:08:15:c9:\n\td4:fd:06:19:83:e8:b0:dc:5f:aa:4e:ec:ff:9a:78:\n\t29:7d:be:76:d7:8a:fc:cf:07:30:94:dc:ec:0b:8f:\n\t9f:c8:e3:98:7b\nattr
</I>&gt;<i> u:\n\t25:99:6d:60:e7:98:47:6c:4a:83:54:41:9f:1f:c9:\n\t01:03:a1:9f:f6:81:43:fe:47:6f:d6:a4:b8:a4:c2:\n\t64:80:e3:59:fb:71:43:8d:56:d8:48:60:e6:70:d2:\n\ta4:0f:3f:ff:cf:c8:fb:4c:57:17:18:4f:be:83:e5:\n\t00:02:10:af&gt;'
</I>&gt;<i> &lt;/error&gt;
</I>&gt;<i>
</I>&gt;<i> This is the function that raised that exception:
</I>&gt;<i> <A HREF="http://twistedmatrix.com/trac/browser/tags/releases/twisted-8.1.0/twisted/conch/ssh/keys.py#L387">http://twistedmatrix.com/trac/browser/tags/releases/twisted-8.1.0/twisted/conch/ssh/keys.py#L387</A>
</I>&gt;<i> It looks like the problem is that the class name doesn't start with
</I>&gt;<i> Crypto.PublicKey. Then, when I use the deprecated method, this is what
</I>&gt;<i> I have:
</I>&gt;<i>
</I>&gt;<i> &lt;not_an_error&gt;
</I>&gt;&gt;<i> connectSSH.py(77)signData()
</I>&gt;<i> -&gt; signed = userauth.SSHUserAuthClient.signData(self, publicKey, signData)
</I>&gt;<i> (Pdb) n
</I>&gt;<i> tests/connectSSH.py:48: DeprecationWarning: getPrivateKeyObject is
</I>&gt;<i> deprecated since Twisted Conch 0.9.  Use Key.fromString().
</I>&gt;<i>  return defer.succeed(keys.getPrivateKeyObject(data=PRIVKEY))
</I>&gt;<i> site-packages/twisted/conch/ssh/userauth.py:374: DeprecationWarning:
</I>&gt;<i> signData is deprecated since Twisted Conch 0.9.  Use
</I>&gt;<i> Key(obj).sign(data).
</I>&gt;<i>  return keys.signData(privateKey, signData)
</I>&gt;&gt;<i> connectSSH.py(79)signData()
</I>&gt;<i> -&gt; return signed
</I>&gt;<i> (Pdb) p signed
</I>&gt;<i> &lt;Deferred at 0x12a1760  current result:
</I>&gt;<i> '\x00\x00\x00\x07ssh-rsa\x00\x00\x00\x80\xa9w-\x0c\x9e\xc3\xe8\xd0\xff\xb8\xf0\xbbi*\xecJ\x8e5\xac\x0e(@\x18\x81\x11\xf4\xff\xda\xde\xd6\x9b\xbe\xef\\\xc2\xd0F8Q\x15\xd0A\xa1!$\xe2\xe5\xa0\xf8\x12O\xa0*4\xe1)\xc2:\xbf\x16\x0b\x8a\xd2J\xa8D\x01\xdd\x10\xe3\xeb\x8b*9,\xf3#b\xff\xbf\xc9\xe9\xdc\x81\xa4B\x88$\r\x8b\xef|y\x80\r\x08\x8a*\x08x:\x0c{\xcf\x97\xb7&quot;\xe19\x1f\xa2_wV4\xfa\x19&quot;Vf\xcf\x80\xa7i\x98\xfa\xefM'&gt;
</I>&gt;<i> &lt;/not_an_error&gt;
</I>&gt;<i>
</I>&gt;<i> After moving to the deprecated method, everything seems to work ok
</I>&gt;<i> with the client, but then I started to have a similar problem at the
</I>&gt;<i> server side, while verifying client's signature. Here is the relevant
</I>&gt;<i> part of the server code, which is the method requestAvatarId of the
</I>&gt;<i> Credential Checker I implemented:
</I>&gt;<i>
</I>&gt;<i> &lt;server_code&gt;
</I>&gt;<i> # This code is based in an example that I caught from twisted website
</I>&gt;<i> class PublicKeyChecker():
</I>&gt;<i>    implements(checkers.ICredentialsChecker)
</I>&gt;<i>    credentialInterfaces = (credentials.ISSHPrivateKey, )
</I>&gt;<i>
</I>&gt;<i>    def requestAvatarId(self, credentials):
</I>&gt;<i>        # I removed here the code that verified if the user is
</I>&gt;<i> registered in our database, to easy for you guys to understand the
</I>&gt;<i> relevant part of the code. Just consider that the variable user
</I>&gt;<i> contains the found user object.
</I>&gt;<i>
</I>&gt;<i>        user_key = user.key.public_key
</I>&gt;<i>        if not credentials.blob == user_key:
</I>&gt;<i>            raise failure.Failure(error.ConchError(&quot;Wrong key.&quot;))
</I>&gt;<i>        if not credentials.signature:
</I>&gt;<i>            return failure.Failure(error.ValidPublicKey())
</I>&gt;<i>
</I>&gt;<i>        pub_key = Key.fromString(data=credentials.blob)
</I>&gt;<i>        # Issue 3
</I>&gt;<i>        if verifySignature(pub_key,
</I>&gt;<i>                           credentials.signature,
</I>&gt;<i>                           credentials.sigData):
</I>&gt;<i>            return credentials.username
</I>&gt;<i>        else:
</I>&gt;<i>            return failure.Failure(error.ConchError(&quot;Incorrect Signature.&quot;))
</I>&gt;<i>    else:
</I>&gt;<i>        return failure.Failure(error.ConchError(&quot;Authentication Failed.&quot;))
</I>&gt;<i> &lt;/server_code&gt;
</I>&gt;<i>
</I>&gt;<i> 3 - Then, while I get to the verifySignature method, I get the following error:
</I>&gt;<i>
</I>&gt;<i> &lt;error&gt;
</I>&gt;<i> RuntimeError: unknown type of object: &lt;RSA Public Key (1023 bits)
</I>&gt;<i> attr e:
</I>&gt;<i>        01:00:01
</I>&gt;<i> attr n:
</I>&gt;<i>        00:f7:9f:8b:18:a9:b7:67:95:5c:af:cb:64:91:52:
</I>&gt;<i>        64:39:1c:98:36:34:31:f2:0b:49:b8:14:8c:a4:0f:
</I>&gt;<i>        28:17:5b:63:d3:71:21:d4:fc:96:a7:cb:de:43:e7:
</I>&gt;<i>        8a:80:12:45:2b:6b:42:87:93:de:0a:bf:21:a1:35:
</I>&gt;<i>        56:17:a8:f9:b3:3c:bb:b8:a2:79:6b:d1:8f:e0:43:
</I>&gt;<i>        31:2c:23:2d:79:8c:31:a3:31:65:42:5f:ff:3e:3d:...
</I>&gt;<i> &lt;/error&gt;
</I>&gt;<i>
</I>&gt;<i> Which is the same exception raised by the key.type() function that
</I>&gt;<i> have put us at the same trouble in the client. Then, at the debuger, I
</I>&gt;<i> found that the correct key (which is a class with name starting with
</I>&gt;<i> Crypto.PublicKey) is right inside this &quot;unknown&quot; object, which is a
</I>&gt;<i> RSA Public Key in object.keyObject.keyObject! I ran the WingIDE
</I>&gt;<i> debugger and simply saw that, as you can see in this screenshot:
</I>&gt;<i> <A HREF="http://www.imageno.com/z99azx3v7qnzpic.html">http://www.imageno.com/z99azx3v7qnzpic.html</A>
</I>&gt;<i>
</I>&gt;<i> Ok, I also get the deprecated warning while using the verifySignature
</I>&gt;<i> method instead of Key(obj).verify(sig, data), then I decided to test
</I>&gt;<i> it also just to don't make you guys wast your time with me for
</I>&gt;<i> nothing. I called pub_key.verify(credentials.signature,
</I>&gt;<i> credentials.sigData) instead of that verifySignature call, and it
</I>&gt;<i> returned False instead leading to a failure in authentication.
</I>&gt;<i>
</I>&gt;<i> Both apps (client and server) are running inside the same machine,
</I>&gt;<i> consulting the same database, the same keys and user, so there it is
</I>&gt;<i> not reasonable to be failing if my code is correct. Maybe I missed
</I>&gt;<i> something. Can you guys help me?
</I>&gt;<i>
</I>&gt;<i> Sorry about the very long email, but I tried to be as much verbose as
</I>&gt;<i> I could in order to help you guys help me.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Kind Regards,
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Adriano Monteiro Marques
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://adriano-marques.blogspot.com">http://adriano-marques.blogspot.com</A>
</I>&gt;<i> <A HREF="http://umit.sourceforge.net">http://umit.sourceforge.net</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">py.adriano at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> &quot;Don't stay in bed, unless you can make money in bed.&quot; - George Burns
</I>&gt;<i>
</I>


-- 
Adriano Monteiro Marques

<A HREF="http://adriano-marques.blogspot.com">http://adriano-marques.blogspot.com</A>
<A HREF="http://umit.sourceforge.net">http://umit.sourceforge.net</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">py.adriano at gmail.com</A>

&quot;Don't stay in bed, unless you can make money in bed.&quot; - George Burns


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018163.html">[Twisted-Python] Possible bug on twisted.conch.ssh.keys?
</A></li>
	<LI>Next message: <A HREF="018166.html">[Twisted-Python] Re: Possible bug on twisted.conch.ssh.keys?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18162">[ date ]</a>
              <a href="thread.html#18162">[ thread ]</a>
              <a href="subject.html#18162">[ subject ]</a>
              <a href="author.html#18162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
