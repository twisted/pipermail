<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deferred.setTimeout is deprecated,	replacement ideas?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred.setTimeout%20is%20deprecated%2C%0A%09replacement%20ideas%3F&In-Reply-To=487DB89B.6040204%40arimaz.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018105.html">
   <LINK REL="Next"  HREF="018107.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deferred.setTimeout is deprecated,	replacement ideas?</H1>
    <B>Tim Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred.setTimeout%20is%20deprecated%2C%0A%09replacement%20ideas%3F&In-Reply-To=487DB89B.6040204%40arimaz.com"
       TITLE="[Twisted-Python] Deferred.setTimeout is deprecated,	replacement ideas?">screwtape at froup.com
       </A><BR>
    <I>Wed Jul 16 08:03:49 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018105.html">[Twisted-Python] Deferred.setTimeout is deprecated,	replacement	ideas?
</A></li>
        <LI>Next message: <A HREF="018107.html">[Twisted-Python] Deferred.setTimeout is deprecated,	replacement	ideas?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18106">[ date ]</a>
              <a href="thread.html#18106">[ thread ]</a>
              <a href="subject.html#18106">[ subject ]</a>
              <a href="author.html#18106">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jul 16, 2008 at 11:00:11AM +0200, Gabriel Rossetti wrote:
&gt;<i> Hello everyone,
</I>&gt;<i>
</I>&gt;<i> I was going to use Deferred.setTimeout until I saw that it was  
</I>&gt;<i> deprecated. Does anyone know why? I found it handy and I find that  
</I>&gt;<i> case-per-case replacements tend to be complicated. Does anyone have any  
</I>&gt;<i> ideas on how to replace it?
</I>
This has (unsurprisingly) come up on the list many times before. Here's
a reasonable representative sample:

    <A HREF="http://thread.gmane.org/gmane.comp.python.twisted/8490">http://thread.gmane.org/gmane.comp.python.twisted/8490</A>

In short, the problem with .setTimeout is that it's a little bit like
shooting the messenger. Imagine you have a script that generates
a report from a long and complicated database query; the code flow might
run something like this:

 - Script asks the database to run its query.
 - Database returns a deferred promising a result.
 - Script calls .setTimeout() on the deferred.
 - The timeout fires, the script gives up and logs an error.
 - Database continues processing, using up CPU and IO resources even
   though the script no longer cares about the result.
 - Database finishes, calls .callback() on the deferred and winds up
   with an AlreadyCalled exception.

The preferred situation is something more like this:

 - Script asks the database to run its query with a particular timeout.
 - Database returns a deferred promising a result.
 - The timeout period elapses, the database realises it hasn't finished
   in time, and so shuts down its query processing and calls .errback()
   on the deferred.
 - Script receives the timeout notification, gives up and logs an error.

The difference is that the thing that returns the deferred is the only
thing that can possibly know how to cancel an operation-in-progress, and
therefore the only thing that can reasonably implement timeout
functionality - deferreds are just the wrong place to put that method.

&gt;<i> I was thinking of doing something like this, if data isn't present in  
</I>&gt;<i> the data internal list:
</I>&gt;<i>
</I>&gt;<i> d = Deferred()
</I>&gt;<i> dc = reactor.callLater(self.timeout, self.__timeoutCallback, d)
</I>
[line deleted as per follow-up mail]

&gt;<i> Then a tuple containing the Deferred (&quot;d&quot;), the DelayedCall (&quot;dc&quot;) is  
</I>&gt;<i> then put in the internal waiting list. If the timeout doesn't expire  
</I>&gt;<i> before the data arrives, then the DelayedCall is canceled, if it does  
</I>&gt;<i> expire then the tuple is removed from the queue (potentially slow) and  
</I>&gt;<i> an exception is raised.
</I>&gt;<i>
</I>&gt;<i> Is there a better way of doing this? Any ideas?
</I>
What you suggest sounds pretty reasonable to me.

Tim Allen


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018105.html">[Twisted-Python] Deferred.setTimeout is deprecated,	replacement	ideas?
</A></li>
	<LI>Next message: <A HREF="018107.html">[Twisted-Python] Deferred.setTimeout is deprecated,	replacement	ideas?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18106">[ date ]</a>
              <a href="thread.html#18106">[ thread ]</a>
              <a href="subject.html#18106">[ subject ]</a>
              <a href="author.html#18106">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
