<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Converting async to sync code (blocking until	deferreds fire)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Converting%20async%20to%20sync%20code%20%28blocking%20until%0A%09deferreds%20fire%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018123.html">
   <LINK REL="Next"  HREF="018119.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Converting async to sync code (blocking until	deferreds fire)</H1>
    <B>Jack Whitham</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Converting%20async%20to%20sync%20code%20%28blocking%20until%0A%09deferreds%20fire%29&In-Reply-To="
       TITLE="[Twisted-Python] Converting async to sync code (blocking until	deferreds fire)">jack-tp at cs.york.ac.uk
       </A><BR>
    <I>Mon Jul 21 06:19:23 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018123.html">[Twisted-Python] Please recommend a RPC system working with	twisted.
</A></li>
        <LI>Next message: <A HREF="018119.html">[Twisted-Python] Re: Converting async to sync code (blocking until	deferreds fire)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18118">[ date ]</a>
              <a href="thread.html#18118">[ thread ]</a>
              <a href="subject.html#18118">[ subject ]</a>
              <a href="author.html#18118">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

What is the best way to convert asynchronous code (non-blocking,
returning deferreds) to synchronous code (blocking)? 

I have a client that is written using Twisted. Most of the methods
within the client object return Deferreds because they send messages
to a server and replies may take some time. This is ideal for the 
wxwidgets GUI that was originally intended to use the client. But
now I want to write test scripts for the server that are synchronous.

For example, the client provides the method &quot;GetBitInfo&quot; which returns
a deferred. The deferred is called back with a list as its parameter
after the server responds to a request. I would like to be able to 
do something like this:

&gt;<i> def GotBitInfo(l): pass
</I>&gt;<i> 
</I>&gt;<i> if __name__ == &quot;__main__&quot;:
</I>&gt;<i>     c = Client()
</I>&gt;<i> 
</I>&gt;<i>     d = c.GetBitInfo()
</I>&gt;<i>     d.addCallback(GotBitInfo)
</I>&gt;<i>     waitForDeferred(d)
</I>&gt;<i> 
</I>&gt;<i>     d = c.DoSomethingElse()
</I>
In other words, how do I waitForDeferred(), i.e. block until a Deferred fires?

Of course I could rewrite my script as asynchronous code; but what I
really want is a simple Python-like interface for the client code
in order to make things as simple as possible for other users. I don't
want them to *have* to learn how to write asynchronous code - I want
it to be optional. If the snippet of code listed above is possible,
then I can wrap the client methods with code that waits for deferreds
to fire, then returns the values they were called with. Then the users
will have two ways to use the code: asynchronous (for GUIs, proxy
servers, etc.) and synchronous (for test scripts). 

I noticed that there is a _wait method in your trial code that seems to
do what I want, but it looks complicated and I'm not sure it is the
right answer. Its predecessor was also deprecated, which is a bad
sign (looks like &quot;do not do this!!&quot;). Hence I am looking for expert 
advice.

Thanks.


-- 
Jack Whitham
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jack at cs.york.ac.uk</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018123.html">[Twisted-Python] Please recommend a RPC system working with	twisted.
</A></li>
	<LI>Next message: <A HREF="018119.html">[Twisted-Python] Re: Converting async to sync code (blocking until	deferreds fire)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18118">[ date ]</a>
              <a href="thread.html#18118">[ thread ]</a>
              <a href="subject.html#18118">[ subject ]</a>
              <a href="author.html#18118">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
