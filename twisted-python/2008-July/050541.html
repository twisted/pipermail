<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] unblocking smtp send?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20unblocking%20smtp%20send%3F&In-Reply-To=%3C20080703204545.25821.1861290463.divmod.xquotient.12072%40joule.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050537.html">
   <LINK REL="Next"  HREF="050538.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] unblocking smtp send?</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20unblocking%20smtp%20send%3F&In-Reply-To=%3C20080703204545.25821.1861290463.divmod.xquotient.12072%40joule.divmod.com%3E"
       TITLE="[Twisted-Python] unblocking smtp send?">glyph at divmod.com
       </A><BR>
    <I>Thu Jul  3 14:45:45 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050537.html">[Twisted-Python] unblocking smtp send?
</A></li>
        <LI>Next message (by thread): <A HREF="050538.html">[Twisted-Python] email addresses with display names in Twisted Mail?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50541">[ date ]</a>
              <a href="thread.html#50541">[ thread ]</a>
              <a href="subject.html#50541">[ subject ]</a>
              <a href="author.html#50541">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06:01 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">k7lim at cs.stanford.edu</A> wrote:
&gt;<i>My webapp is blocking on this sendmail code that I wrote:
</I>    .
    .
    .
&gt;<i>        reactor.run(installSignalHandlers=0)
</I>
&gt;<i>Is there any way I can allow the UI to continue, without blocking on
</I>&gt;<i>this code?  According to the logs, there was a 30second cap between
</I>&gt;<i>starting factory and stopping:
</I>
Answering this question correctly will depend a great deal on the 
specifics of your web application's architecture and deployment.

If your web application is itself a twisted application (i.e. you are 
using twisted.web) then the reactor should already be running, and you 
shouldn't start it up.  The send won't block.

If you're using a multi-threaded deployment environment, then you can't 
safely use Twisted APIs, let alone run the reactor, from multiple 
threads, so you need to investigate some other way of sending mail from 
your application.  Having one thread run the twisted loop and doing a 
callFromThread with the function which sends mail might be the right 
thing to do.

If you're running in a CGI-style execution environment, where there are 
multiple processes but one thread per process... depending on the 
specifics of your server environment you might be able to spawn a 
subprocess to do the Twisted work and wait for it at the very end of 
your script rather than blocking in the middle, or even leave it to run 
past the end of your script.  Reporting errors to the user would be 
pretty tricky in this case though.

Whatever your decision, you should try to move the call to reactor.run() 
as far away from application code as possible.  You should not have a 
function which sends mail and then immediately calls reactor.run() 
because then it won't work in a running reactor, which should be the 
&quot;normal&quot; case for pretty much any code which uses Twisted.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050537.html">[Twisted-Python] unblocking smtp send?
</A></li>
	<LI>Next message (by thread): <A HREF="050538.html">[Twisted-Python] email addresses with display names in Twisted Mail?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50541">[ date ]</a>
              <a href="thread.html#50541">[ thread ]</a>
              <a href="subject.html#50541">[ subject ]</a>
              <a href="author.html#50541">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
