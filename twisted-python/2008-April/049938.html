<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Performance issues of twisted.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Performance%20issues%20of%20twisted.&In-Reply-To=%3Cbefee6d80804131102u6c5ffe6as567a0645c437c972%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049937.html">
   <LINK REL="Next"  HREF="049941.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Performance issues of twisted.</H1>
    <B>Peter Cai</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Performance%20issues%20of%20twisted.&In-Reply-To=%3Cbefee6d80804131102u6c5ffe6as567a0645c437c972%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Performance issues of twisted.">newptcai at gmail.com
       </A><BR>
    <I>Sun Apr 13 12:02:36 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049937.html">[Twisted-Python] Performance issues of twisted.
</A></li>
        <LI>Next message (by thread): <A HREF="049941.html">[Twisted-Python] Performance issues of twisted.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49938">[ date ]</a>
              <a href="thread.html#49938">[ thread ]</a>
              <a href="subject.html#49938">[ subject ]</a>
              <a href="author.html#49938">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks a lot Andy for your explation.  I am sorry for my poor English and I
shall try to make it clearer this time.

1. UDP or TCP &#161;&#170;&#161;&#170; I could understood that implementing a strategy for
retrying failures better than TCP is very unlikely.
But I think maintaining about 3000 tcp connections at the same time might be
quite hard too.
That's exactly why we use UDP in the last version written in C.
We have to write a lot of codes to handle retranmission and we have to send
KEEP Alive Message to make sure that if the client program is still working.

Web server doesn't have this problem because they needn't keep every tcp
connections.

2 and 3 &#161;&#170;&#161;&#170; memcached looks promising,  I will read more about it.

4.  But if we choose TCP or we cache any data in memory, the bussiness shall
be cut off for a short moment and all clients have to relogin?
All data cached in memory shall be lost any the client might feel like that
they lost some time in the game. Is that true?

5.  Have you heard of BEA?  Which was sold to Oracle in March.   One of
their main products is Java Application Server, WebLogic.   I've talked with
their engineer when considerring using Java to write our server.  He showed
me some diagrams and told me that a sharp performance decrease was
unavoidable when gc happened in any gc enabled system.  (Of course he said
Weblogic could do much better than any other systems ^_^)

6.  I want to know the difference between synchronised and asynchronised,
block and unblocked APIs.  I want to know the differences in fundamental
level.
I know that twisted uses &quot;epoll&quot;, but why it's more efficient?

8. Your advice sound very helpful!

Thanks again!

2008/4/14 Andy Fundinger &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Andy at newworldelectric.com</A>&gt;:

&gt;<i> I'm not sure about books, but the questions seemed fun.  I'm curious how
</I>&gt;<i> my answers measure up to the rest of the list here.
</I>&gt;<i>
</I>&gt;<i> 2008/4/13 Peter Cai &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">newptcai at gmail.com</A>&gt;:
</I>&gt;<i>
</I>&gt;<i> &gt; Hi all!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I am preparing to write a server application (you may think of it as an
</I>&gt;<i> &gt; online game server) with twisted, but I am worrying about it's performance
</I>&gt;<i> &gt; and how to do it correctly.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; For example..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. UDP or TCP&#163;&#172;which should I choose to gain higher performance?
</I>&gt;<i> &gt;
</I>&gt;<i> If you want the data to get there even if it's late use TCP, if late data
</I>&gt;<i> is not useful to you or needs to be handled some special way use UDP which
</I>&gt;<i> will simply lose packets if they happen to not go through.  It is possible
</I>&gt;<i> but rather unlikely that you can implement a strategy for retrying failures
</I>&gt;<i> better than TCP unless you relax the constraint of eventually getting the
</I>&gt;<i> data through.
</I>&gt;<i>
</I>&gt;<i> 2. Should I catch data in memory instead of write it to db immediately?
</I>&gt;<i> &gt;
</I>&gt;<i>  I wouldn't for local mysql databases.  For a more distributed setup you
</I>&gt;<i> might consider memcached.
</I>&gt;<i>
</I>&gt;<i> 3. Could I make it run on cluster if cache data in memory &#168;D&#168;D I think it
</I>&gt;<i> &gt; might be quit hard to exchange data between instances of the server if I
</I>&gt;<i> &gt; cache data in memory.
</I>&gt;<i> &gt;
</I>&gt;<i> that's exactly what memcached will take care of for you.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; 4. How to make hot backup?
</I>&gt;<i> &gt;
</I>&gt;<i> for maximum performance use a replicated pair of database servers and take
</I>&gt;<i> the spare offline for backups.  You could also bring the spare up only to
</I>&gt;<i> capture the backup, though it will slow down the primary as it plays
</I>&gt;<i> catchup.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; 5. Garbage collection might make the server halt for a moment
</I>&gt;<i> &gt;
</I>&gt;<i> I think this should be less than the latency of a publicly routed IP
</I>&gt;<i> network, anyone have figures for gc and twisted?
</I>&gt;<i>
</I>&gt;<i> 6. What is happening in a computer when an IP package received?
</I>&gt;<i> &gt;
</I>&gt;<i> What do you mean?  What specifically do you need to know?
</I>&gt;<i>
</I>&gt;<i> 7. Could I get some inspiration from how people write web server?
</I>&gt;<i> &gt;
</I>&gt;<i> this one I can suggest a book for, the twisted book
</I>&gt;<i> <A HREF="http://www.oreilly.com/catalog/twistedadn/">http://www.oreilly.com/catalog/twistedadn/</A> , or if you're considering
</I>&gt;<i> something other than twisted any reasonably thick python book will have an
</I>&gt;<i> example web server.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; 8. If i use an separate physical server to deploy the database, could I
</I>&gt;<i> &gt; gain some performance improvement?  Or the cost of communication between the
</I>&gt;<i> &gt; db and the server could hurt the total performance?
</I>&gt;<i> &gt;
</I>&gt;<i> could go either way.  With the effects of Python's GIL I'd expect a
</I>&gt;<i> multi-core server with database and game server on one box would be fine
</I>&gt;<i> until you hit a scaling limit and your server is eating a whole core.  At
</I>&gt;<i> that point you need to develop a distributed application model and probably
</I>&gt;<i> use multiple servers.  If you hit that before you're running 200 users
</I>&gt;<i> recheck your business model, if you hit it before 20 users recheck your
</I>&gt;<i> architecture.
</I>&gt;<i>
</I>&gt;<i> Andy Fundinger
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Blog: <A HREF="http://channel3b.wordpress.com">http://channel3b.wordpress.com</A>
</I>&gt;<i> Second Life Name: Ciemaar Flintoff
</I>&gt;<i>
</I>&gt;<i> I am a sig Virus. Please put me in your sig so that I can continue to
</I>&gt;<i> replicate.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
&#181;&#177;&#214;&#187;&#211;&#208;&#210;&#187;&#213;&#197;&#214;&#189;&#186;&#205;&#210;&#187;&#214;&#167;&#177;&#202;&#181;&#196;&#202;&#177;&#186;&#242;, &#206;&#210;&#207;&#224;&#208;&#197;&#196;&#227;&#208;&#180;&#207;&#194;&#181;&#196;&#182;&#171;&#206;&#247;&#182;&#212;&#196;&#227;&#192;&#180;&#203;&#181;&#190;&#205;&#202;&#199;&#213;&#230;&#202;&#181;&#181;&#196;, &#178;&#187;&#185;&#220;&#203;&#251;&#195;&#199;&#181;&#189;&#181;&#215;&#202;&#199;&#178;&#187;&#202;&#199;&#213;&#230;&#181;&#196;&#161;&#163;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20080414/35dc5264/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049937.html">[Twisted-Python] Performance issues of twisted.
</A></li>
	<LI>Next message (by thread): <A HREF="049941.html">[Twisted-Python] Performance issues of twisted.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49938">[ date ]</a>
              <a href="thread.html#49938">[ thread ]</a>
              <a href="subject.html#49938">[ subject ]</a>
              <a href="author.html#49938">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
