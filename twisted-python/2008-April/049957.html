<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] about smtp client auth problem.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20about%20smtp%20client%20auth%20problem.&In-Reply-To=%3C20080415120113.6859.490721552.divmod.quotient.30011%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049955.html">
   <LINK REL="Next"  HREF="049963.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] about smtp client auth problem.</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20about%20smtp%20client%20auth%20problem.&In-Reply-To=%3C20080415120113.6859.490721552.divmod.quotient.30011%40ohm%3E"
       TITLE="[Twisted-Python] about smtp client auth problem.">exarkun at divmod.com
       </A><BR>
    <I>Tue Apr 15 06:01:13 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049955.html">[Twisted-Python] about smtp client auth problem.
</A></li>
        <LI>Next message (by thread): <A HREF="049963.html">[Twisted-Python] Re: about smtp client auth problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49957">[ date ]</a>
              <a href="thread.html#49957">[ thread ]</a>
              <a href="subject.html#49957">[ subject ]</a>
              <a href="author.html#49957">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 15 Apr 2008 18:38:28 +0800, Chris &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.yan at saybot.com</A>&gt; wrote:
&gt;<i>Hi,
</I>&gt;<i>I am trying to use twisted to implement a script to send the email,I got
</I>&gt;<i>some problem.here is the script:
</I>&gt;<i>####################
</I>&gt;<i> [snip]
</I>&gt;<i>
</I>&gt;<i>&lt;&lt;&lt; 250-AUTH
</I>&gt;<i>&lt;&lt;&lt; 250-AUTH=PLAIN LOGIN LOGIN
</I>&gt;<i>&lt;&lt;&lt; 250-XXXXXXXA
</I>&gt;<i>&lt;&lt;&lt; 250 XXXB
</I>&gt;<i>
</I>&gt;<i> [snip]
</I>&gt;<i>
</I>&gt;<i>some guy said,this script force to use the LOGIN auth,because something
</I>&gt;<i>wrong with the server,is it true?I don't know very much about the mail
</I>&gt;<i>server,does any one can tell me if I can make my twisted script work?I
</I>&gt;<i>really like to implement a twisted one.
</I>
Indeed, the ESMTP server is not correctly advertising its support for the
AUTH extension.  

You can hack around this by going up to the ESMTP protocol implementation
in Twisted and tweaking its behavior a bit with a subclass (untested):

  from twisted.mail.smtp import ESMTPClient

  class ForceLOGINESMTPClient(ESMTPClient):
      def authenticate(self, code, resp, items):
          if 'AUTH=PLAIN' in items:
              items['AUTH'] = 'PLAIN ' + items['AUTH=PLAIN']
          return ESMTPClient.authenticate(self, code, resp, items)

Then, use this protocol with your ESMTPSenderFactory.  The idea here is
that this subclass notices the particular kind of malformed response this
server sends and adjusts it slightly.  This is a bit better than the other
version you gave which just hard-coded LOGIN, since it should manage to
actually correctly interpret the mechanisms the server is advertising.  Of
course, it may be a bit more fragile too, since it depends on the exact
kind of misformatting the server is doing.  If you want to avoid that,
you can hard-code LOGIN by just setting items['AUTH'] = 'LOGIN'.

Hope this helps,

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049955.html">[Twisted-Python] about smtp client auth problem.
</A></li>
	<LI>Next message (by thread): <A HREF="049963.html">[Twisted-Python] Re: about smtp client auth problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49957">[ date ]</a>
              <a href="thread.html#49957">[ thread ]</a>
              <a href="subject.html#49957">[ subject ]</a>
              <a href="author.html#49957">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
