<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Strange behavior when transferring large strings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20behavior%20when%20transferring%20large%20strings&In-Reply-To=20080423102627.6859.1577299059.divmod.quotient.33980%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017570.html">
   <LINK REL="Next"  HREF="017574.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Strange behavior when transferring large strings</H1>
    <B>Gabriel Rossetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20behavior%20when%20transferring%20large%20strings&In-Reply-To=20080423102627.6859.1577299059.divmod.quotient.33980%40ohm"
       TITLE="[Twisted-Python] Strange behavior when transferring large strings">mailing_lists at evotex.ch
       </A><BR>
    <I>Wed Apr 23 07:11:21 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017570.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
        <LI>Next message: <A HREF="017574.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17571">[ date ]</a>
              <a href="thread.html#17571">[ thread ]</a>
              <a href="subject.html#17571">[ subject ]</a>
              <a href="author.html#17571">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jean-Paul Calderone wrote:
&gt;<i> On Wed, 23 Apr 2008 10:41:29 +0200, Gabriel Rossetti 
</I>&gt;<i> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mailing_lists at evotex.ch</A>&gt; wrote:
</I>&gt;&gt;<i> [snip]
</I>&gt;&gt;<i> Ok, so apparently it (Twisted, Python, the OS?) can buffer and send 
</I>&gt;&gt;<i> up to 16k, after that it splits the message up, thus this would 
</I>&gt;&gt;<i> explain the lockup, since the app expects a whole XML message and 
</I>&gt;&gt;<i> can't process the second part correctly. So if I understand it 
</I>&gt;&gt;<i> correctly, even when I use the P/C paradigm, it waits until the 
</I>&gt;&gt;<i> buffer is full before sending the message, so when I get the message 
</I>&gt;&gt;<i> on the other side, I only get part of it, the other half is a new 
</I>&gt;&gt;<i> message/data arrival, and thus like I said above, the XML is not 
</I>&gt;&gt;<i> correct.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does anyone have an idea of how to solve this?
</I>&gt;<i>
</I>&gt;<i> This can't be solved.  From the way you describe it, the software on the
</I>&gt;<i> receiving end is simply broken.  TCP provides no guarantees about how 
</I>&gt;<i> much
</I>&gt;<i> data will be delivered to the recipient at a time, regardless of how much
</I>&gt;<i> is sent at a time.  Every participant along the delivery path between the
</I>&gt;<i> sender and the recipient is allowed to break packets into smaller pieces
</I>&gt;<i> or coalesce packets into larger pieces.  The recipient *must* be able to
</I>&gt;<i> handle incomplete messages by waiting for more bytes.  It must also be 
</I>&gt;<i> able
</I>&gt;<i> to handle packets which contain bytes from more than one message.
</I>&gt;<i>
</I>&gt;<i> There are a number of ways to address this.  Almost all of them involve
</I>&gt;<i> changing the software running on the peer you're sending messages to and
</I>&gt;<i> the protocol the two programs are using to talk to each other.  For
</I>&gt;<i> example, you can send a length prefix before each message allowing the
</I>&gt;<i> recipient to buffer up the correct number of bytes before trying to deal
</I>&gt;<i> with them.
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>&gt;<i>
</I>Thank you Jean-Paul, I'll do something like that then and fix the peer, 
I didn't realize that and thought I could get the message as a whole 
somehow. At lease I know my P/C is working :-)

Gabriel


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017570.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
	<LI>Next message: <A HREF="017574.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17571">[ date ]</a>
              <a href="thread.html#17571">[ thread ]</a>
              <a href="subject.html#17571">[ subject ]</a>
              <a href="author.html#17571">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
