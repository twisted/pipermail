<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] about smtp client auth problem.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20about%20smtp%20client%20auth%20problem.&In-Reply-To=%3C480485A4.6060808%40saybot.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049958.html">
   <LINK REL="Next"  HREF="049957.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] about smtp client auth problem.</H1>
    <B>Chris</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20about%20smtp%20client%20auth%20problem.&In-Reply-To=%3C480485A4.6060808%40saybot.com%3E"
       TITLE="[Twisted-Python] about smtp client auth problem.">chris.yan at saybot.com
       </A><BR>
    <I>Tue Apr 15 04:38:28 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049958.html">[Twisted-Python] twistd plugin documentation
</A></li>
        <LI>Next message (by thread): <A HREF="049957.html">[Twisted-Python] about smtp client auth problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49955">[ date ]</a>
              <a href="thread.html#49955">[ thread ]</a>
              <a href="subject.html#49955">[ subject ]</a>
              <a href="author.html#49955">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I am trying to use twisted to implement a script to send the email,I got
some problem.here is the script:
####################
import StringIO

from twisted.application import service

application = service.Application(&quot;SMTP Client Tutorial&quot;)

from twisted.application import internet
from twisted.python import log
from twisted.internet import defer, reactor
from twisted.mail import smtp

mailFrom = &quot;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.yan at xxxx.com</A>&quot;
mailTo = [&quot;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chrisyan81 at gmail.com</A>&quot;,]
mail = StringIO.StringIO(&quot;&quot;&quot;Date: Fri, 3 Nov 2006 230:14:39 +0000
From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.yan at xxxx.com</A>
To: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chrisyan81 at gmail.com</A>
Subject: Tutorate!

Hello, how are you, goodbye.
&quot;&quot;&quot;)

whenDone = defer.Deferred()

def send(r):
print &quot;message sent:&quot;, r

whenDone.addCallbacks(send, log.err)

def done(d):
from twisted.internet import reactor
reactor.callLater(1, reactor.stop)

whenDone.addBoth(done)


sender = smtp.ESMTPSenderFactory(
'chris.yan',
'xxxxxx',
mailFrom,
mailTo,
mail,
whenDone,
requireTransportSecurity=False
)

smtpClientService = internet.TCPClient('smtp.xxxx.com', 25, sender)
smtpClientService.setServiceParent(application)

in fact the script from
<A HREF="http://twistedmatrix.com/pipermail/twisted-python/2006-November/014299.html,and">http://twistedmatrix.com/pipermail/twisted-python/2006-November/014299.html,and</A>
I didn't modify anything except my own information.Because the smtp
server doesn't support SSL,so I use requireTransportSecurity=False.

here is the output:

2008/04/15 17:56 +0800 [-] Log opened.
2008/04/15 17:56 +0800 [-] twistd 2.5.0 (C:\Python25\python.exe 2.5.2)
starting up
2008/04/15 17:56 +0800 [-] reactor class: &lt;class
'twisted.internet.selectreactor.SelectReactor'&gt;
2008/04/15 17:56 +0800 [-] Loading smtpclient_tls_001.py...
2008/04/15 17:56 +0800 [-] Loaded.
2008/04/15 17:56 +0800 [-] Starting factory
&lt;twisted.mail.smtp.ESMTPSenderFactory instance at 0x01347878&gt;
2008/04/15 17:56 +0800 [ESMTPSender,client] Unhandled Error
Traceback (most recent call last):
Failure: twisted.mail.smtp.AUTHRequiredError: 502 Server does not
support Client Authentication schemes [CRAM-MD
5, LOGIN, PLAIN]

&lt;&lt;&lt; 250-AUTH
&lt;&lt;&lt; 250-AUTH=PLAIN LOGIN LOGIN
&lt;&lt;&lt; 250-XXXXXXXA
&lt;&lt;&lt; 250 XXXB

2008/04/15 17:56 +0800 [ESMTPSender,client] Stopping factory
&lt;twisted.mail.smtp.ESMTPSenderFactory instance at 0x0134787
8&gt;
2008/04/15 17:56 +0800 [-] Main loop terminated.
2008/04/15 17:56 +0800 [-] Server Shut Down.

but when I use another script which uses smtplib:
SMTP_server='smtp.xxxx.com'
SMTP_user='chris.yan'
SMTP_passwd='xxxxx'

def
send_email(Subject,From,To,Attachment,Body,SMTP_server,SMTP_user,SMTP_passwd):
msg = MIMEMultipart()
msg['Subject'] = Subject
msg['From'] = From
msg['To'] = To


txt = MIMEText(Body,_charset='utf-8')
msg.attach(txt)

filename = Attachment
if not os.path.isfile(filename):
print 'Can not find file %s,please check!' % filename
sys.exit(1)

fp = open(filename,'rb')
ctype,encoding = mimetypes.guess_type(filename)
if ctype is None or encoding is not None:
ctype = 'application/octet-stream'
maintype,subtype = ctype.split('/',1)
m = MIMEBase(maintype,subtype)
m.set_payload(fp.read())
fp.close()
Encoders.encode_base64(m)
m.add_header('Content-disposition','attachment',filename=filename)
msg.attach(m)

s = smtplib.SMTP(SMTP_server)
s.debuglevel = 5
s.ehlo()
s.esmtp_features[&quot;auth&quot;] = &quot;LOGIN&quot;

s.login(SMTP_user,SMTP_passwd)
s.sendmail(From,To,msg.as_string())
s.close()

I can get the output:
send: 'ehlo chris.shuobaotang.com\r\n'
reply: '250-mail.saybot.com Hello chris.shuobaotang.com [218.79.132.2]\r\n'
reply: '250-SIZE 52428800\r\n'
reply: '250-PIPELINING\r\n'
reply: '250-AUTH \r\n'
reply: '250-AUTH=PLAIN LOGIN LOGIN\r\n'
reply: '250-XXXXXXXA\r\n'
reply: '250 XXXB\r\n'
reply: retcode (250); Msg: mail.saybot.com Hello chris.shuobaotang.com
[218.79.132.2]
SIZE 52428800
PIPELINING
AUTH
AUTH=PLAIN LOGIN LOGIN
XXXXXXXA
XXXB
send: 'AUTH LOGIN Y2hyaXMueWFu\r\n'
reply: '334 UGFzc3dvcmQ6\r\n'
reply: retcode (334); Msg: UGFzc3dvcmQ6
send: 'd3JpbHV5Yg==\r\n'
reply: '235 Authentication succeeded\r\n'
reply: retcode (235); Msg: Authentication succeeded
send: 'mail FROM:&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.yan at saybot.com</A>&gt; size=668\r\n'
reply: '250 OK\r\n'
reply: retcode (250); Msg: OK
send: 'rcpt TO:&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chrisyan81 at gmail.com</A>&gt;\r\n'
reply: '250 Accepted\r\n'
reply: retcode (250); Msg: Accepted
send: 'data\r\n'
reply: '354 Enter message, ending with &quot;.&quot; on a line by itself\r\n'
reply: retcode (354); Msg: Enter message, ending with &quot;.&quot; on a line by
itself
data: (354, 'Enter message, ending with &quot;.&quot; on a line by itself')
send: 'Content-Type: multipart/mixed;
boundary=&quot;===============1595669237==&quot;\r\nMIME-Version: 1.0\r\nSubject:
scores fro
m saybot rater.\r\nFrom: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.yan at saybot.com</A>\r\nTo:
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chrisyan81 at gmail.com</A>\r\n\r\n--===============1595669237==\r\nConten
t-Type: text/plain; charset=&quot;utf-8&quot;\r\nMIME-Version:
1.0\r\nContent-Transfer-Encoding: base64\r\n\r\nSGksCiAgICBUaGlzIGl
zIHRoZSBzY29yZXMgd2hpY2ggZ2VuZXJhdGVkIGJ5IHNheWJvdCByYXRl\r\ncixwbGVhc2UgY2hlY2sgdGhlIGF0dGFjaG1lbnQhCgpCZXN0UmVnYXJkCkN
ocmlzCg==\r\n\r\n--===============1595669237==\r\nContent-Type:
text/plain\r\nMIME-Version: 1.0\r\nContent-Transfer-Enco
ding: base64\r\nContent-disposition: attachment;
filename=&quot;scores.txt&quot;\r\n\r\nMTM4MTMwMzE0NzUg17/Hvw0K\r\n\r\n--========
=======1595669237==--\r\n.\r\n'
reply: '250 OK id=1Jlhvl-00071w-1f\r\n'
reply: retcode (250); Msg: OK id=1Jlhvl-00071w-1f
data: (250, 'OK id=1Jlhvl-00071w-1f')
Done.

some guy said,this script force to use the LOGIN auth,because something
wrong with the server,is it true?I don't know very much about the mail
server,does any one can tell me if I can make my twisted script work?I
really like to implement a twisted one.

BestWishes
Chris





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049958.html">[Twisted-Python] twistd plugin documentation
</A></li>
	<LI>Next message (by thread): <A HREF="049957.html">[Twisted-Python] about smtp client auth problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49955">[ date ]</a>
              <a href="thread.html#49955">[ thread ]</a>
              <a href="subject.html#49955">[ subject ]</a>
              <a href="author.html#49955">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
