<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Question on push/pull producers inter-workings, 	was : &quot;Is there a simple Producer/Consumer example or tutorial?&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20on%20push/pull%20producers%20inter-workings%2C%20%0A%09was%20%3A%20%22Is%20there%20a%20simple%20Producer/Consumer%20example%20or%20tutorial%3F%22&In-Reply-To=20080421144119.6859.1707401578.divmod.quotient.33112%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017532.html">
   <LINK REL="Next"  HREF="017507.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Question on push/pull producers inter-workings, 	was : &quot;Is there a simple Producer/Consumer example or tutorial?&quot;</H1>
    <B>Gabriel Rossetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20on%20push/pull%20producers%20inter-workings%2C%20%0A%09was%20%3A%20%22Is%20there%20a%20simple%20Producer/Consumer%20example%20or%20tutorial%3F%22&In-Reply-To=20080421144119.6859.1707401578.divmod.quotient.33112%40ohm"
       TITLE="[Twisted-Python] Question on push/pull producers inter-workings, 	was : &quot;Is there a simple Producer/Consumer example or tutorial?&quot;">mailing_lists at evotex.ch
       </A><BR>
    <I>Mon Apr 21 12:06:58 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017532.html">[Twisted-Python] Question on push/pull producers inter-workings, 	was : &quot;Is there a simple Producer/Consumer example or tutorial?&quot;
</A></li>
        <LI>Next message: <A HREF="017507.html">[Twisted-Python] Twisted.web2 or Nevow?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17536">[ date ]</a>
              <a href="thread.html#17536">[ thread ]</a>
              <a href="subject.html#17536">[ subject ]</a>
              <a href="author.html#17536">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jean-Paul Calderone wrote:
&gt;<i> On Mon, 21 Apr 2008 09:52:56 +0200, Gabriel Rossetti 
</I>&gt;<i> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mailing_lists at evotex.ch</A>&gt; wrote:
</I>&gt;&gt;<i> Jean-Paul Calderone wrote:
</I>&gt;&gt;&gt;<i> On Fri, 18 Apr 2008 09:57:35 +0200, Gabriel Rossetti 
</I>&gt;&gt;<i> [snip]
</I>&gt;&gt;<i> What exactly do you mean by :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;there's no events which will signal that you can send some more of 
</I>&gt;&gt;<i> the string *except* for
</I>&gt;&gt;<i> the reactor deciding that it is ready for some more&quot;?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When I looked at Twisted's code, the difference that I saw was that 
</I>&gt;&gt;<i> if a push producer is used, and if the data to be sent is bigger than 
</I>&gt;&gt;<i> a certain length, it calls producer.pauseProducing()
</I>&gt;<i>
</I>&gt;<i> This is true.  Let's back up for a moment, though.
</I>&gt;<i>
</I>&gt;<i> A pull producer is one which only produces data when it is asked for 
</I>&gt;<i> data.
</I>&gt;<i> The ask-for-data API is resumeProducing.  This means that a consumer 
</I>&gt;<i> which
</I>&gt;<i> is given a pull producer must ask it for data repeatedly until there is
</I>&gt;<i> none left.  The consumer is free to do this in its own pace, and a 
</I>&gt;<i> typical
</I>&gt;<i> efficient way to do this is to ask for more data each time the 
</I>&gt;<i> application
</I>&gt;<i> buffer is empty.
</I>&gt;<i>
</I>&gt;<i> A push producer produces data all the time, until it is asked to 
</I>&gt;<i> stop.  It
</I>&gt;<i> does this at whatever pace it wishes; it might produce a byte each second
</I>&gt;<i> or it might produce a chunk of bytes each time a user interacts with a UI
</I>&gt;<i> somehow or it might produce whatever it reads out of some socket whenever
</I>&gt;<i> it happens to do that.  The consumer is free to ask it to stop at any 
</I>&gt;<i> time
</I>&gt;<i> though.  The API for that is pauseProducing, and in this circumstance,
</I>&gt;<i> resumeProducing delivers the opposite message: it tells the producer that
</I>&gt;<i> it can go back to whatever it was doing.
</I>&gt;<i>
</I>&gt;<i> Does it make sense why only the push producer case has a pauseProducing
</I>&gt;<i> call in it?
</I>yes
&gt;<i>
</I>&gt;&gt;&gt;<i> So that's how you
</I>&gt;&gt;&gt;<i> should decide which of these you want to write - if the consumer is the
</I>&gt;&gt;&gt;<i> only event source involved, as in the large string case, then you 
</I>&gt;&gt;&gt;<i> want a
</I>&gt;&gt;&gt;<i> pull producer (streaming = False);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How can the consumer be an event source? The producer is the one 
</I>&gt;&gt;<i> sending the data, maybe I don't get what you mean by &quot;event source&quot;.
</I>&gt;<i>
</I>&gt;<i> For example, if the consumer is a socket, then there are at least two 
</I>&gt;<i> events
</I>&gt;<i> which it can generate which are potentially interesting: 
</I>&gt;<i> application-level
</I>&gt;<i> buffer empty and application-level buffer full.  These are good 
</I>&gt;<i> indicators
</I>&gt;<i> that more data should be produced and that no more data should be 
</I>&gt;<i> produced
</I>&gt;<i> (for a while), respectively.
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> if the producer itself is event-driven
</I>&gt;&gt;&gt;<i> in its ability to provide data, then you want a push producer.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I thought the push producer worked like this : if the data is too 
</I>&gt;&gt;<i> big, send part of it and pause the rest, let the reactor breath some, 
</I>&gt;&gt;<i> and repeat. I thought the pull producer was basically like if no 
</I>&gt;&gt;<i> producer was used, one has to take care of any data splitting and 
</I>&gt;&gt;<i> send small parts when the consumer is ready. Is this not correct?
</I>&gt;<i>
</I>&gt;<i> It's often the case that a producer doesn't have all of the data it is 
</I>&gt;<i> going
</I>&gt;<i> to produce when it is first registered with the consumer.  In these 
</I>&gt;<i> cases,
</I>&gt;<i> it is less a matter if splitting up the data and more a matter of knowing
</I>&gt;<i> whether to keep trying to gather more data to give to the consumer.  
</I>&gt;<i> If the
</I>&gt;<i> consumer has indicated that it wants no more data (via 
</I>&gt;<i> pauseProducing), then
</I>&gt;<i> the producer can chill out for a while.  Only when the consumer issues 
</I>&gt;<i> the
</I>&gt;<i> resumeProducing call does the producer need to start getting data 
</I>&gt;<i> again.  For
</I>&gt;<i> TCP connections, this is a pretty good reflection of what goes on at a 
</I>&gt;<i> lower
</I>&gt;<i> level.  If you stop reading from a TCP socket, the remote side has to 
</I>&gt;<i> stop
</I>&gt;<i> sending shortly afterwards.  This is more efficient than letting an 
</I>&gt;<i> unbounded
</I>&gt;<i> amount of data pile up in memory.
</I>&gt;<i>
</I>&gt;<i> If you _do_ already have all of the data that is going to be produced 
</I>&gt;<i> (that
</I>&gt;<i> is, in-memory and as a Python string or other byte buffer object which 
</I>&gt;<i> can
</I>&gt;<i> be used with socket.send), then the only reasons to use a producer are 
</I>&gt;<i> that
</I>&gt;<i> some object that you want to give the data to only supports the producer/
</I>&gt;<i> consumer API so you have no choice but to use a producer, or that you 
</I>&gt;<i> want
</I>&gt;<i> to know when the data has been cleared out of the application-level 
</I>&gt;<i> buffer
</I>&gt;<i> (not necessarily sent over the network, and certainly not necessarily
</I>&gt;<i> received by the peer, but at least no longer buffered in your userspace
</I>&gt;<i> process).  If neither of these apply, you may as well just write the one
</I>&gt;<i> string to the transport all at once.  Since you already had all the data
</I>&gt;<i> in memory, you already payed the resource allocation penalty, so there's
</I>&gt;<i> not really much lost by ignoring P/C.
</I>&gt;<i>
</I>&gt;<i> Hope this helps,
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>&gt;<i>
</I>Thank you Jean-Paul, yes it helps a lot.

In my application, I send xml strings through a server, some may have 
rather large data embedded in them, so the idea for using the 
producer/consumer paradigm was to not congest the server as it acts like 
a proxy if you wish. I though that if I did that, then other clients may 
send data through it while the producer pauses. The server and the 
clients are both using server factories (see 
<A HREF="http://twistedmatrix.com/pipermail/twisted-python/2008-February/016879.html">http://twistedmatrix.com/pipermail/twisted-python/2008-February/016879.html</A>), 
since the client-to-client communication isn't direct, the server needs 
to be able to connect to the end/destination client. To send data, I use 
single-use clients, like described in the twisted documentation. In this 
case, my producer was supposed to be the single-use client and the 
consumer the server factory's protocol instance's (whether it being the 
server or the clients), transport (tcp/ip).

I guess the problem is that like you said, I already have all the data 
in the source client and thus there is no need to use the p/c paradigm. 
I must ask though, when I do transfer large amounts of data, if I 
understood correctly the reactor is busy doing that, and thus no other 
clients can send data until it is done, correct? How must one correctly 
deal with this problem? What happens to the other clients' data that 
they try to send?

Thank you,
Gabriel


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017532.html">[Twisted-Python] Question on push/pull producers inter-workings, 	was : &quot;Is there a simple Producer/Consumer example or tutorial?&quot;
</A></li>
	<LI>Next message: <A HREF="017507.html">[Twisted-Python] Twisted.web2 or Nevow?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17536">[ date ]</a>
              <a href="thread.html#17536">[ thread ]</a>
              <a href="subject.html#17536">[ subject ]</a>
              <a href="author.html#17536">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
