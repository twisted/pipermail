<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Performance issues of twisted.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Performance%20issues%20of%20twisted.&In-Reply-To=befee6d80804131102u6c5ffe6as567a0645c437c972%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017430.html">
   <LINK REL="Next"  HREF="017431.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Performance issues of twisted.</H1>
    <B>Andy Fundinger</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Performance%20issues%20of%20twisted.&In-Reply-To=befee6d80804131102u6c5ffe6as567a0645c437c972%40mail.gmail.com"
       TITLE="[Twisted-Python] Performance issues of twisted.">Andy at NewWorldElectric.com
       </A><BR>
    <I>Mon Apr 14 00:10:52 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017430.html">[Twisted-Python] Performance issues of twisted.
</A></li>
        <LI>Next message: <A HREF="017431.html">[Twisted-Python] Performance issues of twisted.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17433">[ date ]</a>
              <a href="thread.html#17433">[ thread ]</a>
              <a href="subject.html#17433">[ subject ]</a>
              <a href="author.html#17433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2008/4/13 Peter Cai &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">newptcai at gmail.com</A>&gt;:

&gt;<i> Thanks a lot Andy for your explation.  I am sorry for my poor English and
</I>&gt;<i> I shall try to make it clearer this time.
</I>&gt;<i>
</I>&gt;<i> 1. UDP or TCP &#161;&#170;&#161;&#170; I could understood that implementing a strategy for
</I>&gt;<i> retrying failures better than TCP is very unlikely.
</I>&gt;<i> But I think maintaining about 3000 tcp connections at the same time might
</I>&gt;<i> be quite hard too.
</I>&gt;<i> That's exactly why we use UDP in the last version written in C.
</I>&gt;<i> We have to write a lot of codes to handle retranmission and we have to
</I>&gt;<i> send KEEP Alive Message to make sure that if the client program is still
</I>&gt;<i> working.
</I>&gt;<i>
</I>&gt;<i> Web server doesn't have this problem because they needn't keep every tcp
</I>&gt;<i> connections.
</I>&gt;<i>
</I>
well, at a glance 3000 TCP connections should be similarly resource
intensive than 3000 simulated connection over UDP, but you have a working
app to compare with.  I would however consider adopting the strategy from
web servers and not keeping tcp connections either.  I'd take their whole
strategy and use http wherever possible even, twisted makes that easy.

4.  But if we choose TCP or we cache any data in memory, the bussiness shall
&gt;<i> be cut off for a short moment and all clients have to relogin?
</I>&gt;<i> All data cached in memory shall be lost any the client might feel like
</I>&gt;<i> that they lost some time in the game. Is that true?
</I>&gt;<i>
</I>With the two servers and backing up the mirror you wouldn't interrupt
business.  Similarly, it data shouldn't be particularly affected by backup
operations.


&gt;<i> 5.  Have you heard of BEA?  Which was sold to Oracle in March.   One of
</I>&gt;<i> their main products is Java Application Server, WebLogic.   I've talked with
</I>&gt;<i> their engineer when considerring using Java to write our server.  He showed
</I>&gt;<i> me some diagrams and told me that a sharp performance decrease was
</I>&gt;<i> unavoidable when gc happened in any gc enabled system.  (Of course he said
</I>&gt;<i> Weblogic could do much better than any other systems ^_^)
</I>&gt;<i>
</I>Maarten has spoken more directly to this point, but I cry foul anyway.  Java
GC *can* but shouldn't be run manually, and you can use multiple processes
or servers to ensure that though a process is slowed down the system as a
whole is unaffected.


&gt;<i> 6.  I want to know the difference between synchronised and asynchronised,
</I>&gt;<i> block and unblocked APIs.  I want to know the differences in fundamental
</I>&gt;<i> level.
</I>&gt;<i> I know that twisted uses &quot;epoll&quot;, but why it's more efficient?
</I>&gt;<i>
</I>Everything has tradeoffs, and you probably can't get a real answer without
describing your use case in rather more detail, but part of it is about
control and being able to make certain optimizations.  An async server lets
your code explicitly yield control when it's going to be waiting for a I/O
and resume again at a point and time when that I/O is complete.  A threaded
server runs threads in parallel hoping that some of them will not be blocked
and thus the server will be able to cut through the total workload.  I'm
sure someone else can explain further, for my own use I prefer it for a nice
side effect.  Async servers bypass the concept of threadsafe and
synchronized sections since there can't be two live pieces of code in the
whole server at any given time.  Of course waiting for a synchronized
section can be a performance issue too, but I mostly just don't like to
write them.


&gt;<i> 8. Your advice sound very helpful!
</I>
consulting rates available upon request :-) seriously, glad I could help, if
you come to any interesting conclusions, won't you write them up in a blog
somewhere?

Andy Fundinger

2008/4/14 Andy Fundinger &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Andy at newworldelectric.com</A>&gt;:
&gt;<i>
</I>I'm not sure about books, but the questions seemed fun.  I'm curious how my
&gt;<i> &gt; answers measure up to the rest of the list here.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2008/4/13 Peter Cai &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">newptcai at gmail.com</A>&gt;:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Hi all!
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I am preparing to write a server application (you may think of it as
</I>&gt;<i> &gt; &gt; an online game server) with twisted, but I am worrying about it's
</I>&gt;<i> &gt; &gt; performance and how to do it correctly.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; For example..
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 1. UDP or TCP&#163;&#172;which should I choose to gain higher performance?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; If you want the data to get there even if it's late use TCP, if late
</I>&gt;<i> &gt; data is not useful to you or needs to be handled some special way use UDP
</I>&gt;<i> &gt; which will simply lose packets if they happen to not go through.  It is
</I>&gt;<i> &gt; possible but rather unlikely that you can implement a strategy for retrying
</I>&gt;<i> &gt; failures better than TCP unless you relax the constraint of eventually
</I>&gt;<i> &gt; getting the data through.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2. Should I catch data in memory instead of write it to db immediately?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;  I wouldn't for local mysql databases.  For a more distributed setup you
</I>&gt;<i> &gt; might consider memcached.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3. Could I make it run on cluster if cache data in memory &#168;D&#168;D I think it
</I>&gt;<i> &gt; &gt; might be quit hard to exchange data between instances of the server if I
</I>&gt;<i> &gt; &gt; cache data in memory.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; that's exactly what memcached will take care of for you.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; 4. How to make hot backup?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; for maximum performance use a replicated pair of database servers and
</I>&gt;<i> &gt; take the spare offline for backups.  You could also bring the spare up only
</I>&gt;<i> &gt; to capture the backup, though it will slow down the primary as it plays
</I>&gt;<i> &gt; catchup.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; 5. Garbage collection might make the server halt for a moment
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; I think this should be less than the latency of a publicly routed IP
</I>&gt;<i> &gt; network, anyone have figures for gc and twisted?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 6. What is happening in a computer when an IP package received?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; What do you mean?  What specifically do you need to know?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 7. Could I get some inspiration from how people write web server?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; this one I can suggest a book for, the twisted book
</I>&gt;<i> &gt; <A HREF="http://www.oreilly.com/catalog/twistedadn/">http://www.oreilly.com/catalog/twistedadn/</A> , or if you're considering
</I>&gt;<i> &gt; something other than twisted any reasonably thick python book will have an
</I>&gt;<i> &gt; example web server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; 8. If i use an separate physical server to deploy the database, could
</I>&gt;<i> &gt; &gt; I gain some performance improvement?  Or the cost of communication between
</I>&gt;<i> &gt; &gt; the db and the server could hurt the total performance?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; could go either way.  With the effects of Python's GIL I'd expect a
</I>&gt;<i> &gt; multi-core server with database and game server on one box would be fine
</I>&gt;<i> &gt; until you hit a scaling limit and your server is eating a whole core.  At
</I>&gt;<i> &gt; that point you need to develop a distributed application model and probably
</I>&gt;<i> &gt; use multiple servers.  If you hit that before you're running 200 users
</I>&gt;<i> &gt; recheck your business model, if you hit it before 20 users recheck your
</I>&gt;<i> &gt; architecture.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Andy Fundinger
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Blog: <A HREF="http://channel3b.wordpress.com">http://channel3b.wordpress.com</A>
</I>&gt;<i> &gt; Second Life Name: Ciemaar Flintoff
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I am a sig Virus. Please put me in your sig so that I can continue to
</I>&gt;<i> &gt; replicate.
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> &#181;&#177;&#214;&#187;&#211;&#208;&#210;&#187;&#213;&#197;&#214;&#189;&#186;&#205;&#210;&#187;&#214;&#167;&#177;&#202;&#181;&#196;&#202;&#177;&#186;&#242;, &#206;&#210;&#207;&#224;&#208;&#197;&#196;&#227;&#208;&#180;&#207;&#194;&#181;&#196;&#182;&#171;&#206;&#247;&#182;&#212;&#196;&#227;&#192;&#180;&#203;&#181;&#190;&#205;&#202;&#199;&#213;&#230;&#202;&#181;&#181;&#196;, &#178;&#187;&#185;&#220;&#203;&#251;&#195;&#199;&#181;&#189;&#181;&#215;&#202;&#199;&#178;&#187;&#202;&#199;&#213;&#230;&#181;&#196;&#161;&#163;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Blog: <A HREF="http://channel3b.wordpress.com">http://channel3b.wordpress.com</A>
Second Life Name: Ciemaar Flintoff

I am a sig Virus. Please put me in your sig so that I can continue to
replicate.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20080414/25d7b8d4/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20080414/25d7b8d4/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017430.html">[Twisted-Python] Performance issues of twisted.
</A></li>
	<LI>Next message: <A HREF="017431.html">[Twisted-Python] Performance issues of twisted.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17433">[ date ]</a>
              <a href="thread.html#17433">[ thread ]</a>
              <a href="subject.html#17433">[ subject ]</a>
              <a href="author.html#17433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
