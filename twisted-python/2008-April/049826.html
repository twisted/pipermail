<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Other ways to integrate foreign event loops?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Other%20ways%20to%20integrate%20foreign%20event%20loops%3F&In-Reply-To=%3Cm2bq4qoho7.fsf%40valheru.db3l.homeip.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049799.html">
   <LINK REL="Next"  HREF="049827.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Other ways to integrate foreign event loops?</H1>
    <B>David Bolen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Other%20ways%20to%20integrate%20foreign%20event%20loops%3F&In-Reply-To=%3Cm2bq4qoho7.fsf%40valheru.db3l.homeip.net%3E"
       TITLE="[Twisted-Python] Re: Other ways to integrate foreign event loops?">db3l.net at gmail.com
       </A><BR>
    <I>Thu Apr  3 13:35:36 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049799.html">[Twisted-Python] Other ways to integrate foreign event loops?
</A></li>
        <LI>Next message (by thread): <A HREF="049827.html">[Twisted-Python] Re: Other ways to integrate foreign event loops?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49826">[ date ]</a>
              <a href="thread.html#49826">[ thread ]</a>
              <a href="subject.html#49826">[ subject ]</a>
              <a href="author.html#49826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Nathan &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nathan.stocks at gmail.com</A>&gt; writes:

&gt;<i> On Mon, Mar 31, 2008 at 8:17 PM,  &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>&gt; wrote:
</I>&gt;&gt;<i>  Twisted's job is to run the main loop; it's best just to let it do that.
</I>&gt;&gt;<i>  If Pyglet slowed down, it would be best to examine what's gone wrong
</I>&gt;&gt;<i>  with Pyglet and simply submit a fix for that.
</I>&gt;<i>
</I>&gt;<i> Understood.  Thanks for the guidance.  I'm working on example code
</I>&gt;<i> that reproduces the problem.
</I>
While in general I'm always in favor of letting Twisted own the main
loop, I've also had quite good success in the past not doing so, even
without multiple threads, primarily in cases where networking was a
secondary function (e.g., GUI applications) and less time crucial than
the primary UI interaction.

In our case, with wxPython based applications, things worked great
just having wxPython handle a timer that triggered reactor iterations.
It involved:

* During initialization, start reactor with reactor.startRunning()
* At some periodic frequency, run reactor.iterate(0)
* During termination, set up a reactor.callLater for reactor.stop, and
  then call reactor.mainLoop().  This was the cleanest way we found to
  permit all reactor finalization (events, final I/O, etc...).

Note that the first point violates the IReactorCore interface
(startRunning() should only be accessed through run()).  I don't
consider running mainLoop() at the end a violation since it's the only
time it is called.

Yes, the above means that Twisted's loop might incur higher latency
(we ran the timer at about 150ms) than it might be if in control, but
it worked very well for us, including during times when the
win32/wxPython reactors weren't particularly stable, and
_threadedselect wasn't yet an option.  And even if in control, once
Twisted calls out to pump GUI messages, large latency is still
theoretically possible until it regains control.

So while I wouldn't usually suggest making Twisted's main loop
subservient to some other loop (and trying to identify the issue in
Pyglet would be a good thing), it's also something I'm not averse to
doing when needed.

It might be worth experimenting with using Pyglet's main loop, and
pyglet.clock.schedule or pyglet.clock.schedule_interval to iterate
Twisted's reactor.

-- David



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049799.html">[Twisted-Python] Other ways to integrate foreign event loops?
</A></li>
	<LI>Next message (by thread): <A HREF="049827.html">[Twisted-Python] Re: Other ways to integrate foreign event loops?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49826">[ date ]</a>
              <a href="thread.html#49826">[ thread ]</a>
              <a href="subject.html#49826">[ subject ]</a>
              <a href="author.html#49826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
