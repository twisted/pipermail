<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] shared list in factory, mutexes?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20shared%20list%20in%20factory%2C%20mutexes%3F&In-Reply-To=%3C20080415085026.GD15066%40steerpike.home.puzzling.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049956.html">
   <LINK REL="Next"  HREF="049953.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] shared list in factory, mutexes?</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20shared%20list%20in%20factory%2C%20mutexes%3F&In-Reply-To=%3C20080415085026.GD15066%40steerpike.home.puzzling.org%3E"
       TITLE="[Twisted-Python] shared list in factory, mutexes?">andrew-twisted at puzzling.org
       </A><BR>
    <I>Tue Apr 15 02:50:26 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049956.html">[Twisted-Python] shared list in factory, mutexes?
</A></li>
        <LI>Next message (by thread): <A HREF="049953.html">[Twisted-Python] shared list in factory, mutexes?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49952">[ date ]</a>
              <a href="thread.html#49952">[ thread ]</a>
              <a href="subject.html#49952">[ subject ]</a>
              <a href="author.html#49952">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gabriel Rossetti wrote:
[...]
&gt;<i> think what I don't get is that with thread network code, each thread is  
</I>&gt;<i> an individual self-contained unit that does whatever processing it needs  
</I>&gt;<i> to do however long it may need to take, and the OS takes care of  
</I>&gt;<i> scheduling each thread, but with twisted, the main thread executes each  
</I>&gt;<i> connection one by one sequentially and thus if one of them needs to to  
</I>&gt;<i> some lengthy processing, it will block all other connections from being  
</I>&gt;<i> processed, so you have to use threads to keep it from blocking, but  
</I>&gt;<i> somehow the active connection should become inactive while the  
</I>&gt;<i> processing thread does it's work, so that another connection can be  
</I>&gt;<i> processed in the meantime. Is that how it works? So twisted's event loop  
</I>&gt;<i> (reactor) does the same work as the OS's scheduler?
</I>
In Twisted, code all runs in the main thread, so the way handling multiple
connections works is that control is frequently returned to the reactor.

So if a new connection is received, a protocol instance is made and its
&quot;connectionMade&quot; method called, and as soon as that is done the reactor goes on
to the next thing.  That might be another connectionMade for a new connection,
or it might be delivering a few bytes to a protocol (via calling dataReceived on
it).  So there a lots of events, but the event handlers (i.e. things like
methods on Protocol subclasses) don't block, so they return control very
quickly.

In threaded network code typically you frequently do &quot;sock.recv()&quot; and similar,
to block.  In Twisted you just omit that; your protocol's dataReceived will be
called whenever there's some data.  This frees up the main thread to be doing
other work when there's nothing happening on an individual connection.  So
that's how multiple connections can be handled concurrently in a single thread
in Twisted.

The only rule is that you cannot block in the main thread.  If you want to do
something blocking, find a different way to do it (or if you have to, do it in a
thread and let the main thread continue, but at least for network I/O that's
never necessary in Twisted).

Does that help?

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049956.html">[Twisted-Python] shared list in factory, mutexes?
</A></li>
	<LI>Next message (by thread): <A HREF="049953.html">[Twisted-Python] shared list in factory, mutexes?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49952">[ date ]</a>
              <a href="thread.html#49952">[ thread ]</a>
              <a href="subject.html#49952">[ subject ]</a>
              <a href="author.html#49952">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
