<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Strange behavior when transferring large strings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20behavior%20when%20transferring%20large%20strings&In-Reply-To=480E377B.9080903%40evotex.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017561.html">
   <LINK REL="Next"  HREF="017568.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Strange behavior when transferring large strings</H1>
    <B>Gabriel Rossetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20behavior%20when%20transferring%20large%20strings&In-Reply-To=480E377B.9080903%40evotex.ch"
       TITLE="[Twisted-Python] Strange behavior when transferring large strings">mailing_lists at evotex.ch
       </A><BR>
    <I>Wed Apr 23 03:23:01 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017561.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
        <LI>Next message: <A HREF="017568.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17567">[ date ]</a>
              <a href="thread.html#17567">[ thread ]</a>
              <a href="subject.html#17567">[ subject ]</a>
              <a href="author.html#17567">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gabriel Rossetti wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I have been trying to use the producer/consumer paradigm to transfer 
</I>&gt;<i> large strings. I've been having trouble because I have strange things 
</I>&gt;<i> going on, but I now suspect it isn't the P/C that's not working, 
</I>&gt;<i> because it works fine with smaller strings than the ones I'm having 
</I>&gt;<i> trouble with, so I suspect the problem comes from elsewhere. What 
</I>&gt;<i> happens is it starts off fine, but then the destination at some point 
</I>&gt;<i> only gets part of the string but the source has already sent 
</I>&gt;<i> everything, closed it's transport and called stopProducing(). Could 
</I>&gt;<i> there be some internal buffering problem, like I'm sending too much 
</I>&gt;<i> data at too high of a throughput, or maybe something like some sort of 
</I>&gt;<i> max time a socket can stay open or something? If I tell it to split 
</I>&gt;<i> the string up into smaller parts, it doesn't change anything, if I 
</I>&gt;<i> make the string smaller, whatever the size of each chunk, it transfers 
</I>&gt;<i> fine.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Gabriel
</I>&gt;<i>
</I>I removed the P/C code and used the previous version and the problem 
persists, if I send a XML msg (very small XML part) with a data payload 
containing a string generated like this :

    initialMsg = &quot;&quot;.join([str(x) for x in range(5000)])


which is 10374 bytes of data (including the XML), this makes me suspect 
that there is maybe some sort of buffer or something that is full and 
doesn't have the time to empty and twisted stops working or something. 
I'm using the 2.5 version since Ubuntu hasn't upgraded (and apparently 
won't upgrade until the lenny) their version yet and I can't get it to 
compile from source (yes, I installed python-dev and build-essentials), 
so maybe it's a problem only to this version. Does anyone have an Idea 
of what the problem is? I'm using the following code to send messages, I 
don't think that's the problem but you never know :

    def sendMessage(address, port, message, needAnswer=False):

        d = defer.Deferred() if needAnswer else None
       
        class MessageSender(Protocol):

            def sendMessage(self, msg):
                if domish.IElement.providedBy(msg):
                    msg = msg.toXml()
        
                if isinstance(msg, unicode):
                    msg = msg.encode('utf-8')
                   
                self.transport.write(msg)
               
            def dataReceived(self, data):
                d.callback(data)
           
        def gotProtocol(proto):
            proto.sendMessage(message)
            if(not needAnswer):
                proto.transport.loseConnection()

        c = ClientCreator(reactor, MessageSender)
        c.connectTCP(address, port).addCallback(gotProtocol)
        return d

   
Gabriel




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017561.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
	<LI>Next message: <A HREF="017568.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17567">[ date ]</a>
              <a href="thread.html#17567">[ thread ]</a>
              <a href="subject.html#17567">[ subject ]</a>
              <a href="author.html#17567">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
