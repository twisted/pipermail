<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Problem with unittesting HTTP POST resource
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problem%20with%20unittesting%20HTTP%20POST%20resource&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017362.html">
   <LINK REL="Next"  HREF="017378.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Problem with unittesting HTTP POST resource</H1>
    <B>Teemu Harju</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problem%20with%20unittesting%20HTTP%20POST%20resource&In-Reply-To="
       TITLE="[Twisted-Python] Problem with unittesting HTTP POST resource">teemu.harju at gmail.com
       </A><BR>
    <I>Tue Apr  8 07:28:45 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017362.html">[Twisted-Python] April 20 Sprint
</A></li>
        <LI>Next message: <A HREF="017378.html">[Twisted-Python] Problem with unittesting HTTP POST resource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17373">[ date ]</a>
              <a href="thread.html#17373">[ thread ]</a>
              <a href="subject.html#17373">[ subject ]</a>
              <a href="author.html#17373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I'm kind of a newbie in what comes to using Twisted and I'm stuck with a
problem that I cannot seem to solve.

My problem is that I'm experimenting with &quot;trial&quot; to be able to test my
code. (I've heard that it is a wise thing to do ;-)). What I have is a
simple HTTP resource that allows POSTing data. I made this example to
illustrate my problem...

import urllib

from twisted.internet import reactor
from twisted.web import resource, server, client, error
from twisted.trial import unittest

class TestResource(resource.Resource):

    def render_POST(self, request):
        return str(request.args)


class SimpleResourceTest(unittest.TestCase):

    def _listen(self, site):
        return reactor.listenTCP(0, site, interface=&quot;127.0.0.1&quot;)

    def setUp(self):
        r = resource.Resource()
        r.putChild(&quot;test&quot;, TestResource())
        site = server.Site(r, timeout=None)
        self.port = self._listen(site)
        self.portno = self.port.getHost().port

    def tearDown(self):
        if self.port:
            return self.port.stopListening()

    def getURL(self, path):
        return &quot;<A HREF="http://127.0.0.1:%d/%s&quot;">http://127.0.0.1:%d/%s&quot;</A> % (self.portno, path)

    def test_postdata(self):
        d = client.getPage(self.getURL(&quot;test&quot;), method=&quot;POST&quot;,
                           postdata=urllib.urlencode({&quot;test&quot;: &quot;data&quot;}))
        d.addCallback(self.failIfEqual, &quot;{}&quot;)
        return d


I used some of the unittests in Twisted Web as an example and at least I
think I've got this right. However, as you can see if you run this, the test
fails. Which means that the request.args dictionary is empty. However, there
should be something since I've set the postdata parameter on the
client.getPage() method. I would really appreciate all the help here since I
cannot figure out where the postdata disappears.

Regards,

Teemu

-- 
Teemu Harju

email/jabber: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">teemu.harju at gmail.com</A>
blog: <A HREF="http://www.teemuharju.net">http://www.teemuharju.net</A>

~~ &quot;A computer is like air conditioning: it becomes useless when you open
windows.&quot; ~~
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20080408/e20d9ec3/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20080408/e20d9ec3/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017362.html">[Twisted-Python] April 20 Sprint
</A></li>
	<LI>Next message: <A HREF="017378.html">[Twisted-Python] Problem with unittesting HTTP POST resource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17373">[ date ]</a>
              <a href="thread.html#17373">[ thread ]</a>
              <a href="subject.html#17373">[ subject ]</a>
              <a href="author.html#17373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
