<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Strange behavior when transferring large strings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20behavior%20when%20transferring%20large%20strings&In-Reply-To=480EF639.3010008%40evotex.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017568.html">
   <LINK REL="Next"  HREF="017571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Strange behavior when transferring large strings</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Strange%20behavior%20when%20transferring%20large%20strings&In-Reply-To=480EF639.3010008%40evotex.ch"
       TITLE="[Twisted-Python] Strange behavior when transferring large strings">exarkun at divmod.com
       </A><BR>
    <I>Wed Apr 23 06:26:27 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017568.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
        <LI>Next message: <A HREF="017571.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17570">[ date ]</a>
              <a href="thread.html#17570">[ thread ]</a>
              <a href="subject.html#17570">[ subject ]</a>
              <a href="author.html#17570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 23 Apr 2008 10:41:29 +0200, Gabriel Rossetti &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mailing_lists at evotex.ch</A>&gt; wrote:
&gt;<i> [snip]
</I>&gt;<i>Ok, so apparently it (Twisted, Python, the OS?) can buffer and send up to 
</I>&gt;<i>16k, after that it splits the message up, thus this would explain the 
</I>&gt;<i>lockup, since the app expects a whole XML message and can't process the 
</I>&gt;<i>second part correctly. So if I understand it correctly, even when I use the 
</I>&gt;<i>P/C paradigm, it waits until the buffer is full before sending the message, 
</I>&gt;<i>so when I get the message on the other side, I only get part of it, the 
</I>&gt;<i>other half is a new message/data arrival, and thus like I said above, the 
</I>&gt;<i>XML is not correct.
</I>&gt;<i>
</I>&gt;<i>Does anyone have an idea of how to solve this?
</I>
This can't be solved.  From the way you describe it, the software on the
receiving end is simply broken.  TCP provides no guarantees about how much
data will be delivered to the recipient at a time, regardless of how much
is sent at a time.  Every participant along the delivery path between the
sender and the recipient is allowed to break packets into smaller pieces
or coalesce packets into larger pieces.  The recipient *must* be able to
handle incomplete messages by waiting for more bytes.  It must also be able
to handle packets which contain bytes from more than one message.

There are a number of ways to address this.  Almost all of them involve
changing the software running on the peer you're sending messages to and
the protocol the two programs are using to talk to each other.  For
example, you can send a length prefix before each message allowing the
recipient to buffer up the correct number of bytes before trying to deal
with them.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017568.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
	<LI>Next message: <A HREF="017571.html">[Twisted-Python] Strange behavior when transferring large strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17570">[ date ]</a>
              <a href="thread.html#17570">[ thread ]</a>
              <a href="subject.html#17570">[ subject ]</a>
              <a href="author.html#17570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
