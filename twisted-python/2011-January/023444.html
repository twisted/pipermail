<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A Python enum library with a Twist
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20Python%20enum%20library%20with%20a%20Twist&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023441.html">
   <LINK REL="Next"  HREF="023445.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A Python enum library with a Twist</H1>
    <B>Jonathan Jacobs</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20Python%20enum%20library%20with%20a%20Twist&In-Reply-To="
       TITLE="[Twisted-Python] A Python enum library with a Twist">jonathan+twisted at jsphere.com
       </A><BR>
    <I>Mon Jan 31 05:31:17 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023441.html">[Twisted-Python] Weekly Bug Summary
</A></li>
        <LI>Next message: <A HREF="023445.html">[Twisted-Python] A Python enum library with a Twist
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23444">[ date ]</a>
              <a href="thread.html#23444">[ thread ]</a>
              <a href="subject.html#23444">[ subject ]</a>
              <a href="author.html#23444">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

First off there isn't actually a twist, it's just for Twisted
addressing the points in #4671 [1]. Sorry to disappoint. Secondly I
realise there are already at least a thousand Python enum libraries,
most of which I haven't explored, feel free to mention these with
supporting arguments.

My point of view is that a great many number of these enum libraries
go to long lengths to make stuff too &quot;cute&quot;. While having less
not-networking-related code in Twisted may be a more desirable route,
Twisted makes enough use of enum-esque things in the current code base
that it may be easier (maybe even warranted)  to have our own
implementation that can cater directly to the needs of Twisted without
being subjected to the usual irritations of third-party software; also
Twisted's high-qualilty coding and testing standards are only a good
thing.

The current code is hosted on Launchpad [2] and the source code is
viewable on the web [3]. I am aware that there are currently no
unittests or any kind of useful documentation, hopefully the examples
are good enough for now. I'm hoping for some feedback to decide
whether to press ahead or turn back. I've tried to look at as many
Twisted enum use-cases as possible, without trying to cater to every
one individually, however I do still have a few questions:

1. #4671 uses an &quot;asInt&quot; method in the examples, this is obviously
going to require changing all code that uses these enums (of which
there is plenty.) Is this a good idea? It seems easy to forget that
&quot;F_FOO | F_BAR&quot; is not giving you a number.

2. I use &quot;__int__&quot;, I don't know if this is horrible or not and
whether I should just use the &quot;asInt&quot; method proposed in the ticket.

3. It seems to me that there are two general cases:
   1. The enum just holds values that have an interesting meaning on
their own (e.g. AMP special keys (ASK, ANSWER, etc.), IRC status codes
(RPL_WHOIS, etc.)) and combining them makes no sense.
   2. The enum holds values that are intended to be combined. i.e. flags.

   Does it make sense to try and combine this behaviour into the same
type? Currently it is and you get an exception when doing certain
things (none of which make any sense, in this context):

&gt;&gt;&gt;<i> (Words.AYE | Words.BEE)
</I>&lt;EnumValueGroup '|': [&lt;EnumValue Words.AYE: 'a'&gt;, &lt;EnumValue Words.BEE: 'b'&gt;]&gt;
&gt;&gt;&gt;<i> (Words.AYE | Words.BEE).value
</I>Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;enum.py&quot;, line 77, in value
    return reduce(self.op, values)
TypeError: unsupported operand type(s) for |: 'str' and 'str'

&gt;&gt;&gt;<i> Words.fromValue('a')
</I>&lt;EnumValue Words.AYE: 'a'&gt;
&gt;&gt;&gt;<i> Words.fromValue('c') # This value is not in the enumeration and ORing values to get it is impossible.
</I>Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;enum.py&quot;, line 133, in fromValue
    if target - v &lt; 0:
TypeError: unsupported operand type(s) for -: 'str' and 'str'

Comments appreciated.

[1] &lt;<A HREF="http://twistedmatrix.com/trac/ticket/4671">http://twistedmatrix.com/trac/ticket/4671</A>&gt;
[2] &lt;<A HREF="http://code.launchpad.net/~jjacobs/+junk/twistedenum">http://code.launchpad.net/~jjacobs/+junk/twistedenum</A>&gt;
[3] &lt;<A HREF="http://bazaar.launchpad.net/~jjacobs/+junk/twistedenum/view/head:/enum.py">http://bazaar.launchpad.net/~jjacobs/+junk/twistedenum/view/head:/enum.py</A>&gt;

-- 
Jonathan

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023441.html">[Twisted-Python] Weekly Bug Summary
</A></li>
	<LI>Next message: <A HREF="023445.html">[Twisted-Python] A Python enum library with a Twist
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23444">[ date ]</a>
              <a href="thread.html#23444">[ thread ]</a>
              <a href="subject.html#23444">[ subject ]</a>
              <a href="author.html#23444">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
