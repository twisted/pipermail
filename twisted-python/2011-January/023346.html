<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted and ipython
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20and%20ipython&In-Reply-To=20110116231237.GB19973%40ubuntu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023344.html">
   <LINK REL="Next"  HREF="023347.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted and ipython</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20and%20ipython&In-Reply-To=20110116231237.GB19973%40ubuntu"
       TITLE="[Twisted-Python] Twisted and ipython">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Jan 17 00:07:42 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023344.html">[Twisted-Python] Twisted and ipython
</A></li>
        <LI>Next message: <A HREF="023347.html">[Twisted-Python] Twisted and ipython
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23346">[ date ]</a>
              <a href="thread.html#23346">[ thread ]</a>
              <a href="subject.html#23346">[ subject ]</a>
              <a href="author.html#23346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jan 16, 2011, at 6:12 PM, Alessandro Dentella wrote:

&gt;<i> thanks Jean-Paul for the hints,
</I>&gt;<i> 
</I>&gt;<i> On Sun, Jan 16, 2011 at 12:50:05AM -0000, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i> On 13 Jan, 11:43 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sandro at e-den.it</A> wrote:
</I>&gt;&gt;&gt;<i> thanks,
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> short abstact: manhole is very good, thanks. But I'd need to add 
</I>&gt;&gt;&gt;<i> readline to
</I>&gt;&gt;&gt;<i> make it usable and I'd need tab-completion too.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If by &quot;add readline&quot; you mean handle input using the stdlib readline 
</I>&gt;&gt;<i> module, you can't really do this (or, I'm sure you can, but it would 
</I>&gt;&gt;<i> involve a ton of coding).  If you only mean &quot;have some commonly useful 
</I>&gt;&gt;<i> line editing features&quot; then you have at least a couple options:
</I>&gt;<i> 
</I>&gt;<i> Well, in fact I intended mainly up/down arrows *and* tab-completion, like
</I>&gt;<i> ipython have. 
</I>&gt;<i> 
</I>&gt;&gt;<i>  * invective includes a fully unit-tested line input widget (for the 
</I>&gt;&gt;<i> insults widget library).  This really belongs somewhere other than 
</I>&gt;&gt;<i> invective, it'd be nice if someone pushed it back into Twisted. 
</I>&gt;&gt;<i> However, you can find invective at 
</I>&gt;&gt;<i> <A HREF="svn://svn.twistedmatrix.com/svn/Twisted/sandbox/exarkun/invective/trunk">svn://svn.twistedmatrix.com/svn/Twisted/sandbox/exarkun/invective/trunk</A> 
</I>&gt;&gt;<i> until that happens.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>  * urwid supports Twisted and has lots of fancy things, including an 
</I>&gt;&gt;<i> input editing widget.
</I>&gt;<i> 
</I>&gt;<i> From what you say I don't know if completion is something I'd
</I>&gt;<i> get with invective of urwid.
</I>
Invective is an IRC client (with a useful text-editing widget for Twisted's &quot;insults&quot; module).  urwid is a client library.  Completion is something that you'd need to implement yourself with either of these (as is a functional Python interpreter...)

&gt;&gt;<i> Also, we really should get rid of twisted.manhole, because these days 
</I>&gt;&gt;<i> manhole is supposed to refer to the stuff in twisted.conch.  I'm not 
</I>&gt;&gt;<i> sure if you found the latter, but from the warning you got about 
</I>&gt;&gt;<i> twisted.protocols.telnet it seems like you may have only found the 
</I>&gt;&gt;<i> former.
</I>&gt;<i> 
</I>&gt;<i> I was able to use only manhole.telnet. I wan't able to understand how to
</I>&gt;<i> make twisted.protocols.telnet work in the same way and was not able to fine
</I>&gt;<i> a demo snippet (more for completeness that else I'm still interested in
</I>&gt;<i> this).
</I>
twisted.protocols.telnet is old and really should not be used.  The new, good telnet implementation is in twisted.conch.telnet.  You can find code that uses this (both a runnable application and an instructive example) in twisted.conch.manhole_tap, which also happens to include a python interpreter as its application.

&gt;<i> On the other hand I managed to use ipython and twisted as I wanted and
</I>&gt;<i> everitying is working like a charm (but I still have a question that I'll
</I>&gt;<i> leave for next chapter).
</I>&gt;<i> 
</I>&gt;<i> Twisted in a thread - working setup
</I>&gt;<i> -----------------------------------
</I>&gt;<i> 
</I>&gt;<i> Following a hint in the ipython ml I started a second thread for twisted and
</I>&gt;<i> I'm using blockingcallFromThread to dispatch commands to the reactor:
</I>
You can do this in pretty much any interactive Python interpreter, including the default one.  It's not very convenient, though :).

&gt;<i> What I can't understand is why I can't put &quot;q.discover_modules()&quot; inside
</I>&gt;<i> callWhenRunning() command: if I do that it just blocks at the first
</I>&gt;<i> iteration of the 'for' loop.
</I>
Because callWhenRunning will schedule start_command to be run on the main (reactor) thread.  (callWhenRunning may only be called _from_ the main thread, too, which it seems like you might not be doing).

Since start_command is running on the main thread, when it gets around to blockingCallFromThread, it puts some work into the queue for the reactor to do, then goes to sleep forever, trusting that the main thread will do the work and then wake it up.  Except - oops! - it just put the main thread to sleep forever, so it will never wake up.

If you'd like, you can file a ticket for blockingCallFromThread to raise a loud, angry exception if it is invoked from the reactor thread.

(Also, in the simple example you gave, you're invoking blockingCallFromThread with the wrong signature; the first argument must be a reactor.  The rest of my explanation was based on the assumption that this is not the exact code you're running, since that would log a traceback immediately.  Or, perhaps the fact that you're calling callWhenRunning from a non-main thread is blowing up in some more insidious way and that's the real problem.)

Hope this helps,

-glyph
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023344.html">[Twisted-Python] Twisted and ipython
</A></li>
	<LI>Next message: <A HREF="023347.html">[Twisted-Python] Twisted and ipython
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23346">[ date ]</a>
              <a href="thread.html#23346">[ thread ]</a>
              <a href="subject.html#23346">[ subject ]</a>
              <a href="author.html#23346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
