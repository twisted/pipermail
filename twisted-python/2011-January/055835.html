<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted and ipython
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20and%20ipython&In-Reply-To=%3C20110117093121.GA22374%40ubuntu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055834.html">
   <LINK REL="Next"  HREF="055789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted and ipython</H1>
    <B>Alessandro Dentella</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20and%20ipython&In-Reply-To=%3C20110117093121.GA22374%40ubuntu%3E"
       TITLE="[Twisted-Python] Twisted and ipython">sandro at e-den.it
       </A><BR>
    <I>Mon Jan 17 02:31:21 MST 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055834.html">[Twisted-Python] Twisted and ipython
</A></li>
        <LI>Next message (by thread): <A HREF="055789.html">[Twisted-Python] client connecting to 2 servers (non simultaneously)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55835">[ date ]</a>
              <a href="thread.html#55835">[ thread ]</a>
              <a href="subject.html#55835">[ subject ]</a>
              <a href="author.html#55835">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Glyph,

On Mon, Jan 17, 2011 at 12:07:42AM -0500, Glyph Lefkowitz wrote:
&gt;<i> &gt; From what you say I don't know if completion is something I'd
</I>&gt;<i> &gt; get with invective of urwid.
</I>&gt;<i> 
</I>&gt;<i> Invective is an IRC client (with a useful text-editing widget for Twisted's &quot;insults&quot; module).  urwid is a client library.  Completion is something that you'd need to implement yourself with either of these (as is a functional Python interpreter...)
</I>
ok, clear.

&gt;<i> twisted.protocols.telnet is old and really should not be used.  The new,
</I>&gt;<i> good telnet implementation is in twisted.conch.telnet.  You can find code
</I>&gt;<i> that uses this (both a runnable application and an instructive example) in
</I>&gt;<i> twisted.conch.manhole_tap, which also happens to include a python
</I>&gt;<i> interpreter as its application.
</I>
ok, I found demo.tac and demo_manhole.tac and will have a deeper look at them.

&gt;<i> &gt; Twisted in a thread - working setup
</I>&gt;<i> &gt; -----------------------------------
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Following a hint in the ipython ml I started a second thread for twisted and
</I>&gt;<i> &gt; I'm using blockingcallFromThread to dispatch commands to the reactor:
</I>&gt;<i> 
</I>&gt;<i> You can do this in pretty much any interactive Python interpreter, including the default one.  It's not very convenient, though :).
</I>&gt;<i> 
</I>&gt;<i> &gt; What I can't understand is why I can't put &quot;q.discover_modules()&quot; inside
</I>&gt;<i> &gt; callWhenRunning() command: if I do that it just blocks at the first
</I>&gt;<i> &gt; iteration of the 'for' loop.
</I>
&gt;<i> Because callWhenRunning will schedule start_command to be run on the main
</I>&gt;<i> (reactor) thread.  
</I>
mmh.... in my case the reactor thread in not the main one!
IPython.twistedutil.ReactorInThread does that for me

I'm calling it from the main thread, that is not the reactor's thread in my case

    rit = twistedutil.ReactorInThread()
    rit.setDaemon(True)
    rit.start()

&gt;<i> (callWhenRunning may only be called _from_ the main thread, too, which it
</I>&gt;<i> seems like you might not be doing).
</I>

&gt;<i> Since start_command is running on the main thread, when it gets around to
</I>&gt;<i> blockingCallFromThread, it puts some work into the queue for the reactor
</I>&gt;<i> to do, then goes to sleep forever, trusting that the main thread will do
</I>&gt;<i> the work and then wake it up.  Except - oops! - it just put the main
</I>&gt;<i> thread to sleep forever, so it will never wake up.
</I>&gt;<i> 
</I>&gt;<i> If you'd like, you can file a ticket for blockingCallFromThread to raise a
</I>&gt;<i> loud, angry exception if it is invoked from the reactor thread.
</I>
Ok I think this is the turning key. I imagine that if I start the reactor in
a separate secondary thread, calling reactor.callWhenRunnning(start_command)
from the main thread makes 'start_command' be run in the reactor's
thread. At that point I can't call blockingCallFromThread from that thread,
as you pointed out. If this assumption is wrong, please let me know and I'll
go to study threads.


&gt;<i> (Also, in the simple example you gave, you're invoking
</I>&gt;<i> blockingCallFromThread with the wrong signature; the first argument must
</I>&gt;<i> be a reactor.  The rest of my explanation was based on the assumption that
</I>&gt;<i> this is not the exact code you're running, since that would log a
</I>&gt;<i> traceback immediately.  Or, perhaps the fact that you're calling
</I>&gt;<i> callWhenRunning from a non-main thread is blowing up in some more
</I>&gt;<i> insidious way and that's the real problem.)
</I>
Sorry for the confusion. This *is* the correct code but blockingCallFromThread is
really IPython.twsitedutil.blockingCallFromThread that wraps
twisted.internet.threads.blockingCallFromThread passing the reactor as first arg.

thanks again for the valuable explanation

sandro
*:-)


-- 
Sandro Dentella  *:-)
<A HREF="http://www.reteisi.org">http://www.reteisi.org</A>             Soluzioni libere per le scuole
<A HREF="http://sqlkit.argolinux.org">http://sqlkit.argolinux.org</A>        SQLkit home page - PyGTK/python/sqlalchemy


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055834.html">[Twisted-Python] Twisted and ipython
</A></li>
	<LI>Next message (by thread): <A HREF="055789.html">[Twisted-Python] client connecting to 2 servers (non simultaneously)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55835">[ date ]</a>
              <a href="thread.html#55835">[ thread ]</a>
              <a href="subject.html#55835">[ subject ]</a>
              <a href="author.html#55835">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
