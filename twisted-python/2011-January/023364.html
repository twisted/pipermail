<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Question about SerialPort
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20about%20SerialPort&In-Reply-To=CEB2B268-90DA-4861-9B00-F792E4B10C0C%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023363.html">
   <LINK REL="Next"  HREF="023388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Question about SerialPort</H1>
    <B>Jason Valenzuela</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20about%20SerialPort&In-Reply-To=CEB2B268-90DA-4861-9B00-F792E4B10C0C%40fuhm.net"
       TITLE="[Twisted-Python] Question about SerialPort">jvalenzuela1977 at gmail.com
       </A><BR>
    <I>Thu Jan 20 11:34:52 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023363.html">[Twisted-Python] Question about SerialPort
</A></li>
        <LI>Next message: <A HREF="023388.html">[Twisted-Python] Fingering Finger
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23364">[ date ]</a>
              <a href="thread.html#23364">[ thread ]</a>
              <a href="subject.html#23364">[ subject ]</a>
              <a href="author.html#23364">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/20/2011 9:42 PM, James Y Knight wrote:
&gt;<i> On Jan 20, 2011, at 6:32 AM, Albert Brandl wrote:
</I>&gt;&gt;<i> The main problem seems to be the specification of Modbus RTU. RTU
</I>&gt;&gt;<i> messages are separated by time gaps that are at least 3.5 characters
</I>&gt;&gt;<i> long. Unfortunately, this is the only reliable way for separating
</I>&gt;&gt;<i> messages - there is no length header or something similar. The
</I>&gt;&gt;<i> specification does define a trailing CRC, though.
</I>&gt;<i>
</I>&gt;<i> I don't think you'll ever be able to do this reliably in Python. At 9600 baud, 3.5 characters is just about 275hz (9600/10/3.5). Linux schedules process at around 500hz. So, unless you use real-time scheduling, I think you have no guarantee that you'll be able to detect such a gap at all -- some other process may be running and you may completely miss it. And you can't reasonably use real-time scheduling in python...
</I>&gt;<i>
</I>&gt;<i> On the other hand, are you sure you need this? <A HREF="http://www.libmodbus.org/">http://www.libmodbus.org/</A> seems to have code which figures out what length packets should be, and no code to detect a 3.5char delay between packets. That seems much more reliable.
</I>&gt;<i>
</I>&gt;<i> It also doesn't seem to have any code to ensure a 3.5char between sent packets, which indicates to me that either it's totally brokem or else that not even the hardware end actually uses a 3.5char delay to determine packet boundaries...I'd guess the second, since even on an embedded CPU, it's much trickier to ensure the appropriate serial port timing than to simply count the correct number of bytes.
</I>

Building upon James' reply a little further, I recently did a ModBus RTU 
implementation on a microcontroller and you need both a 1.5 and 3.5 
character timer for correct operation. With the micro, I used hardware 
timers with uS resolution synchronized to incoming characters via the 
UART interrupt. As James mentions, user-space Python is simply too far 
from the hardware to do this sort of thing. You'd probably have to write 
a custom UART driver and run it on a RTOS to get correct timing. That 
being said, you can probably write something that will work 99.9% of the 
time, but may not respond correctly for some weird corner case scenarios.


Jason Valenzuela

</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023363.html">[Twisted-Python] Question about SerialPort
</A></li>
	<LI>Next message: <A HREF="023388.html">[Twisted-Python] Fingering Finger
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23364">[ date ]</a>
              <a href="thread.html#23364">[ thread ]</a>
              <a href="subject.html#23364">[ subject ]</a>
              <a href="author.html#23364">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
