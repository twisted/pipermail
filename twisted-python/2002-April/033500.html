<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Yet another coil refactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Yet%20another%20coil%20refactor&In-Reply-To=%3C3CB0819B.6090509%40itamarst.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="033501.html">
   <LINK REL="Next"  HREF="033505.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Yet another coil refactor</H1>
    <B>Itamar Shtull-Trauring</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Yet%20another%20coil%20refactor&In-Reply-To=%3C3CB0819B.6090509%40itamarst.org%3E"
       TITLE="[Twisted-Python] Yet another coil refactor">twisted at itamarst.org
       </A><BR>
    <I>Sun Apr  7 11:27:55 MDT 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="033501.html">[Twisted-Python] First pass of components/adapters stuff now in	CVS
</A></li>
        <LI>Next message (by thread): <A HREF="033505.html">[Twisted-Python] Yet another coil refactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33500">[ date ]</a>
              <a href="thread.html#33500">[ thread ]</a>
              <a href="subject.html#33500">[ subject ]</a>
              <a href="author.html#33500">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As I said in my previous email - coil will now use components.

What this means:

Collections used by coil are collections of Interfaces objects. That means 
you need an Interface for anything that is addable in a coil collection.

I needed to add about 4 interface classes to the non-coil parts of Twisted 
for coil to work: protocol factory, service, web resource, dns domain. 
That's it. So I don't think this is such a bother.

In fact. it's much cleaner for things like DNS domains where there wasn't a 
base class for all Domains (same goes for mail domains.) Which is after all 
the purpose of interfaces. It does mean extra typing of __implements__ in 
certain cases, but all in all it's more flexible, and webcoil is cleaner.

I have this all working now - not I just need to clean up.

Here's an example of the different sort of things you can do now - notice 
how static.Files allow you to configure mime-types and resources.

=============================================
class SiteConfigurator(coil.Configurator):
     &quot;&quot;&quot;Configurator for web sites.&quot;&quot;&quot;

     __implements__ = [coil.IConfigurator, coil.IStaticCollection]

     configurableClass = server.Site
     configTypes = {'resource': [resource.IResource, &quot;Resource&quot;,
                    &quot;The resource at the site's root.&quot;] }
     configName = 'HTTP Web Site'

     def listStaticEntities(self):
         return [['resource', self.instance.resource]]

     def getStaticEntity(self, name):
         if name == 'resource':
             return self.instance.resource

components.registerAdapter(SiteConfigurator, server.Site, coil.ICollection)


# ... deleted from example ...


class MimeTypeCollection(coil.ConfigCollection):

     entityType = types.StringType

class ResourceCollection:
     &quot;&quot;&quot;Wrap an existing Resource as a ConfigCollection.&quot;&quot;&quot;

     __implements__ = [coil.IConfigCollection]

     def __init__(self, resource):
         self._resource = resource

     def __getattr__(self, attr):
         return getattr(self._resource, attr)


class StaticConfigurator(coil.Configurator, coil.StaticCollection):

     __implements__ = [coil.IConfigurator, coil.IStaticCollection]

     configurableClass = static.File

     configTypes = {'path': [types.StringType, &quot;Path&quot;, &quot;The path in the 
filesystem to be served.&quot;],
          'execCGI': ['boolean', &quot;Execute CGIs&quot;, &quot;Support running CGI&quot;],
          'execEPY': ['boolean', &quot;Execute EPYs&quot;, &quot;Support running EPY&quot;],
          'defaultType': [types.StringType, &quot;Default MIME Type&quot;,&quot;&quot;]
                   }

     configName = 'Web Filesystem Access'

     def __init__(self, instance):
         coil.Configurator.__init__(self, instance)
         coil.StaticCollection.__init__(self)
         self.putEntity(&quot;Mime-types&quot;, \
            MimeTypeCollection(self.instance.contentTypes))
         self.putEntity(&quot;Resources&quot;, ResourceCollection(self.instance))
         self.lock()

     # ... deleted, the config interfce is unchanged from CVS ...

def staticFactory(container, name):
     return static.File(&quot;somewhere/outthere&quot;)

coil.registerConfigurator(StaticConfigurator, staticFactory)
components.registerAdapter(StaticConfigurator, static.File,coil.ICollection)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="033501.html">[Twisted-Python] First pass of components/adapters stuff now in	CVS
</A></li>
	<LI>Next message (by thread): <A HREF="033505.html">[Twisted-Python] Yet another coil refactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33500">[ date ]</a>
              <a href="thread.html#33500">[ thread ]</a>
              <a href="subject.html#33500">[ subject ]</a>
              <a href="author.html#33500">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
