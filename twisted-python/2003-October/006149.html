<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] authentification from a database
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20authentification%20from%20a%20database&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006146.html">
   <LINK REL="Next"  HREF="006151.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] authentification from a database</H1>
    <B>vicky lupien</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20authentification%20from%20a%20database&In-Reply-To="
       TITLE="[Twisted-Python] authentification from a database">vlupien at drummonddesigns.com
       </A><BR>
    <I>Mon Oct 27 09:17:08 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006146.html">[Twisted-Python] Picture_Pile broken?
</A></li>
        <LI>Next message: <A HREF="006151.html">[Twisted-Python] authentification from a database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6149">[ date ]</a>
              <a href="thread.html#6149">[ thread ]</a>
              <a href="subject.html#6149">[ subject ]</a>
              <a href="author.html#6149">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a program that needs authentification from a database.  For now,
it's working fine but I'm using
checkers.InMemoryUsernamePasswordDatabaseDontUse(test=&quot;test&quot;) (I want
many users not only &quot;test&quot;).   
 
Here's my code:
 
class RootPage(pages.BasePage):
    templateFile = &quot;main.html&quot;
    
    def initialize(self, dbpool=None):
        self.dbpool = dbpool
 
    def wchild_login(self, request):
        a=request.getComponent(simpleguard.Authenticated)
        if not request.getComponent(simpleguard.Authenticated):
            return InfiniChild(login.LoginPage())
        return Authenticated()
 
class Authenticated(page.Page):
    isLeaf = 1
    template='''&lt;html&gt;&lt;h1&gt;Hello &lt;span model=&quot;name&quot;/&gt;!&lt;/h1&gt;&lt;/html&gt;'''
 
    def wmfactory_name(self, request):
        return request.getComponent(simpleguard.Authenticated).name
    
class IRedirectAfterLogin(components.Interface):
    &quot;&quot;&quot;The URLPath to which we will redirect after successful login.
    &quot;&quot;&quot;
 
class Here(resource.Resource):
    def render(self, request):
        existing =
request.getSession().getComponent(IRedirectAfterLogin, None)
        if existing is not None:
            request.redirect(str(existing))
            request.getSession().setComponent(IRedirectAfterLogin, None)
            return &quot;&lt;html&gt;&lt;/html&gt;&quot;
        else:
            return util.redirectTo('.', request)
        
def callback(model):
    return Here()
 
class FullURLRequest:
    def __init__(self, request):
        self.request = request
 
    def prePathURL(self):
        r = self.request
        prepath = r.prepath
        r.prepath = r.prepath + r.postpath
        rv = r.prePathURL()
        r.prepath = prepath
        return rv
    
class InfiniChild(resource.Resource):
    def __init__(self, r):
        resource.Resource.__init__(self)
        self.r = r
 
    def getChild(self, name, request):
        return self
 
    def render(self, request):
        request.getSession().setComponent(
            IRedirectAfterLogin,
            urlpath.URLPath.fromRequest(FullURLRequest(request))
            )
        return self.r.render(request)
    
def createResource():
    dbpool = database.DataBase().getConnection()
    return simpleguard.guardResource(
        RootPage(dbpool=dbpool),
 
[checkers.InMemoryUsernamePasswordDatabaseDontUse(vicky=&quot;lupien&quot;)],
        callback=callback)    
 
 
 
#In an other module:
 
class LoginPage(pages.BasePage):
    templateFile = &quot;login.html&quot;
    
    def initialize(self):
        self.title = &quot;Login&quot;
   
    def wmfactory_title(self, request):
        return self.title
            
    def wchild_index(self, request):
        return self
    
    def wvupdate_loginform(self, request, widget, model):
        root = request.getRootURL()
        if root is None:
            root=request.prePathURL()
        url = urlpath.URLPath.fromString(root)
        lmx(widget.node).form(
            action=str(url.sibling(guard.INIT_PERSPECTIVE)),
            model=&quot;form&quot;)
 
    def wmfactory_form(self, request):
        return guard.newLoginSignature.method(None)
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031027/dbc4bd92/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031027/dbc4bd92/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006146.html">[Twisted-Python] Picture_Pile broken?
</A></li>
	<LI>Next message: <A HREF="006151.html">[Twisted-Python] authentification from a database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6149">[ date ]</a>
              <a href="thread.html#6149">[ thread ]</a>
              <a href="subject.html#6149">[ subject ]</a>
              <a href="author.html#6149">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
