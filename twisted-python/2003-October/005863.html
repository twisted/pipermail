<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] smtp.SMTP help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20smtp.SMTP%20help&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005861.html">
   <LINK REL="Next"  HREF="005864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] smtp.SMTP help</H1>
    <B>Greg</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20smtp.SMTP%20help&In-Reply-To="
       TITLE="[Twisted-Python] smtp.SMTP help">greg at digitalinfo.net
       </A><BR>
    <I>Wed Oct  1 17:20:17 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="005861.html">[Twisted-Python] Re: [Twisted-commits] Implement ReconnectingPBClientFactory, please review
</A></li>
        <LI>Next message: <A HREF="005864.html">[Twisted-Python] smtp.SMTP help 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5863">[ date ]</a>
              <a href="thread.html#5863">[ thread ]</a>
              <a href="subject.html#5863">[ subject ]</a>
              <a href="author.html#5863">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Working on an SMTP filter (consisting of an SMTP server that receives 
messages, some code that mangles them, then and SMTP client that forwards 
them along). The first step is to get a functioning SMTP server working, and 
I'm having some trouble with SMTPFactory / SMTP. I've overloaded the validate 
methods in an attempt accept emails to and from any domain, but I can't 
figure out how to hook in a class that implements IMessageDelivery:

-----------------------------------------------------------
class MySMTPFactory(SMTPFactory):
	def buildProtocol(self, addr):
		self.protocol = MySMTPProtocol
		return SMTPFactory.buildProtocol(self, addr)

class MySMTPProtocol(SMTP):
		
	def validateFrom(self, helo, origin):
		return origin
		
	def validateTo(self, user):
		d = defer.Deferred()
		reactor.callLater(0, self.fakeSucceed())
		return d
		
	def fakeSucceed(self):
		return MyIMessage
			
class MyIMessage:
	__implements__ = (smtp.IMessageDelivery)
	
	def __init__(self):
		print &quot;MyIMessage.__init__ got called....&quot;
	
	def validateTo(self, user):
		print &quot;MyIMessage.validateTo got called...&quot;
		return user

	def validateFrom(self, helo, origin):
		print &quot;MyIMessage.validateFrom got called...&quot;
		return origin

	def receivedHeader(self, helo, origin, recipients):
		print &quot;MyIMessage.receivedHeader got called...&quot;
		return None
-----------------------------------------------------------

I gleaned most of this from looking at the testing code. The SMTP server 
reports &quot;503 Must have valid receiver and originator&quot; after the client issues 
the DATA command, and none of the methods in MyIMessage (except for __INIT__) 
ever get called. Any tips as to what I'm doing wrong? Thanks. 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005861.html">[Twisted-Python] Re: [Twisted-commits] Implement ReconnectingPBClientFactory, please review
</A></li>
	<LI>Next message: <A HREF="005864.html">[Twisted-Python] smtp.SMTP help 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5863">[ date ]</a>
              <a href="thread.html#5863">[ thread ]</a>
              <a href="subject.html#5863">[ subject ]</a>
              <a href="author.html#5863">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
