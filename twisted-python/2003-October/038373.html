<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Writing unit tests with Trial for Twisted Applications
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Writing%20unit%20tests%20with%20Trial%20for%20Twisted%20Applications&In-Reply-To=%3C87zngkwf4s.fsf%40lutya.travishartwell.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="038400.html">
   <LINK REL="Next"  HREF="038374.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Writing unit tests with Trial for Twisted Applications</H1>
    <B>Travis B. Hartwell</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Writing%20unit%20tests%20with%20Trial%20for%20Twisted%20Applications&In-Reply-To=%3C87zngkwf4s.fsf%40lutya.travishartwell.net%3E"
       TITLE="[Twisted-Python] Writing unit tests with Trial for Twisted Applications">slt5v at cc.usu.edu
       </A><BR>
    <I>Wed Oct  1 20:24:35 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="038400.html">[Twisted-Python] smtp.SMTP help
</A></li>
        <LI>Next message (by thread): <A HREF="038374.html">[Twisted-Python] Writing unit tests with Trial for Twisted Applications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38373">[ date ]</a>
              <a href="thread.html#38373">[ thread ]</a>
              <a href="subject.html#38373">[ subject ]</a>
              <a href="author.html#38373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey all,

In my recent efforts to update the Beyond code base to use recent,
preferred, and non-deprecated Twisted developments such as new cred, I
have encountered a few problems in updating the unit tests to match my
changes.  The unit tests as they stood before my changes used the old
pyunit module.  After successfully converting the tests on the old
code base to use twisted.trial (and fixing a probable bug in the
process that pyunit didn't expose), I attempted to get them to work
with my changes.  That's where the problems started happening.  From
my experience and looking through the unit tests written for Twisted,
I have come up with the following questions.  As a background, the
client and server that I am testing in Beyond is implemented using PB.

1.  Does proper testing necessitate or at least include actually
    communicating over a port for the client and server?  I see this
    is done for the PB tests and several others, but not for many.
    
2.  Closely related, what is the proper way to connect the client and
    server?  When I made changes, the t.test.test_pb.IOPump that the
    tests were using didn't seem to work.  According to spiv, this may
    not be the preferred connecting method to use anymore.
    
3.  From that, if I use the twisted.protocols.loopback module, how do
    I set up callbacks for events such as logging in?  As I am using
    it now, it appears that things just hang and nothing is ever
    completed.  For example, in one of my tests, I have this code,
    with self.p being my portal and self.c being an instance of my PB
    client:

        accum = []
        factory = pb.PBClientFactory()
        deferred = factory.login(UsernamePassword(&quot;guest&quot;, &quot;guest&quot;), client=self.c)
        deferred.addCallbacks(accum.append, self.errorReceived)
        loopback.loopbackTCP(self.p, self.c)

    It just sits there, not advancing beyond the loopbackTCP call.
    
4.  Regardless of the method used, what is the proper way to have the
    reactor keep going until there are no more events?  I need
    something analogous to test_pb.IOPump.pump() or flush(), if IOPump
    is not to be used.

    trial.unittest.TestCase.runReactor()?
    
5.  When is the proper time to use unittest.deferredResult?  I see it
    used in some cases, yet in other cases regular callbacks and
    errbacks are used.

6.  Realted to that, when I added callbacks and errbacks, they didn't
    seem to get executed.  Yet looking at test_newcred.py, on line 89
    for example, they are added and then immediately the result is
    checked.  Does this work because I am listening on a port?  Or was
    my doing this not working originally because the client and server
    were not connected?  Later in the same file deferredResult is used.
    I'm not understanding what the expected behavior is then.

7.  Is it preferred to use unittest.TestCase.assertEqual to the plain
    assert?  I see both used in various places in the Twisted tests.


I hope these questions make sense.  I felt the mailing list was a
better forum for this than IRC because I had detailed questions.
Also, would it be appropriate for general cases of answers to these
questions (especially ones like #5 and #7) to be added to the &quot;Unit
Tests in Twisted&quot; howto?  I would be willing to put those appropriate
into there after someone answers my questions. :)

Thanks a million,
and slowly learning,

Travis


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="038400.html">[Twisted-Python] smtp.SMTP help
</A></li>
	<LI>Next message (by thread): <A HREF="038374.html">[Twisted-Python] Writing unit tests with Trial for Twisted Applications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38373">[ date ]</a>
              <a href="thread.html#38373">[ thread ]</a>
              <a href="subject.html#38373">[ subject ]</a>
              <a href="author.html#38373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
