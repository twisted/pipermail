<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] smtp.SMTP help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20smtp.SMTP%20help&In-Reply-To=3F7D613C.5020609%40digitalinfo.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005885.html">
   <LINK REL="Next"  HREF="005891.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] smtp.SMTP help</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20smtp.SMTP%20help&In-Reply-To=3F7D613C.5020609%40digitalinfo.net"
       TITLE="[Twisted-Python] smtp.SMTP help">exarkun at intarweb.us
       </A><BR>
    <I>Fri Oct  3 12:43:50 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="005885.html">[Twisted-Python] smtp.SMTP help
</A></li>
        <LI>Next message: <A HREF="005891.html">[Twisted-Python] smtp.SMTP help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5887">[ date ]</a>
              <a href="thread.html#5887">[ thread ]</a>
              <a href="subject.html#5887">[ subject ]</a>
              <a href="author.html#5887">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Oct 03, 2003 at 07:45:00AM -0400, Greg wrote:
&gt;<i> Thanks! In order to help others like me who were struggling with this, 
</I>&gt;<i> here's the working code. Please let me know if I did anything 
</I>&gt;<i> egregiously stupid here.
</I>&gt;<i> 
</I>&gt;<i> #!/usr/bin/env python
</I>&gt;<i> # Simple SMTP server shell
</I>&gt;<i> 
</I>&gt;<i> from twisted.internet import reactor, protocol, defer
</I>&gt;<i> from twisted.protocols import smtp
</I>&gt;<i> 
</I>&gt;<i> class MyMessage:
</I>&gt;<i>    __implements__ = (smtp.IMessage)
</I>&gt;<i>       
</I>&gt;<i>    def __init__(self):
</I>&gt;<i>        self.msg = []
</I>&gt;<i> 
</I>&gt;<i>    def lineReceived(self, line):
</I>&gt;<i>        self.msg.append(line)
</I>&gt;<i> 
</I>&gt;<i>    def eomReceived(self):
</I>&gt;<i>        # Handle message here
</I>&gt;<i>        for line in self.msg:
</I>&gt;<i>            print line
</I>&gt;<i>        self.msg = []
</I>&gt;<i>        return defer.succeed('&lt;Whatever&gt;')
</I>&gt;<i>   
</I>&gt;<i> class MyMessageDelivery:
</I>&gt;<i>    __implements__ = (smtp.IMessageDelivery)
</I>&gt;<i>   
</I>&gt;<i>    def validateFrom(self, helo, origin):
</I>&gt;<i>        return origin
</I>&gt;<i>       
</I>&gt;<i>    def validateTo(self, user):
</I>&gt;<i>        return MyMessage
</I>
  You need to return an *instance* here.  You probably also want to
associate the user with the instance, too, since you won't be told again who
you're delivering for.  Changing MyMessage.__init__ to take a user argument
and returning &quot;MyMessage(user)&quot; might be a good way to go.

  The validateTo and validateFrom methods are your chance to refuse this
message.  &quot;helo&quot; and &quot;origin&quot; identify the source of the message.  &quot;user&quot;
identifies the destination.  If any of them are not to your liking, you
should raise smtp.SMTPBadRcpt or smtp.SMTPBadSender.

&gt;<i>       
</I>&gt;<i>    def receivedHeader(self, helo, origin, recipients):
</I>&gt;<i>        return None
</I>&gt;<i> 
</I>&gt;<i> class MySMTPFactory(smtp.SMTPFactory):
</I>&gt;<i>    def buildProtocol(self, addr):
</I>&gt;<i>        p = self.protocol(MyMessageDelivery())
</I>&gt;<i>        p.factory = self
</I>&gt;<i>        p.portal = self.portal
</I>&gt;<i>        p.host = &quot;somedomain.com&quot;
</I>&gt;<i>        return p   
</I>&gt;<i>       
</I>&gt;<i> factory = MySMTPFactory()
</I>&gt;<i> factory.protocol = smtp.SMTP
</I>&gt;<i> reactor.listenTCP(25, factory)
</I>&gt;<i> reactor.run()
</I>&gt;<i> 
</I>
  Jp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031003/7af48339/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031003/7af48339/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005885.html">[Twisted-Python] smtp.SMTP help
</A></li>
	<LI>Next message: <A HREF="005891.html">[Twisted-Python] smtp.SMTP help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5887">[ date ]</a>
              <a href="thread.html#5887">[ thread ]</a>
              <a href="subject.html#5887">[ subject ]</a>
              <a href="author.html#5887">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
