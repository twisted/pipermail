<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Writing unit tests with Trial for Twisted Applications
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Writing%20unit%20tests%20with%20Trial%20for%20Twisted%20Applications&In-Reply-To=%3C20031002024405.GK1515%40radii%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="038373.html">
   <LINK REL="Next"  HREF="038375.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Writing unit tests with Trial for Twisted Applications</H1>
    <B>Christopher Armstrong</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Writing%20unit%20tests%20with%20Trial%20for%20Twisted%20Applications&In-Reply-To=%3C20031002024405.GK1515%40radii%3E"
       TITLE="[Twisted-Python] Writing unit tests with Trial for Twisted Applications">radix at twistedmatrix.com
       </A><BR>
    <I>Wed Oct  1 20:44:05 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="038373.html">[Twisted-Python] Writing unit tests with Trial for Twisted Applications
</A></li>
        <LI>Next message (by thread): <A HREF="038375.html">[Twisted-Python] Writing unit tests with Trial for Twisted Applications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38374">[ date ]</a>
              <a href="thread.html#38374">[ thread ]</a>
              <a href="subject.html#38374">[ subject ]</a>
              <a href="author.html#38374">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Oct 01, 2003 at 08:24:35PM -0600, Travis B. Hartwell wrote:
&gt;<i> 1.  Does proper testing necessitate or at least include actually
</I>&gt;<i>     communicating over a port for the client and server?  I see this
</I>&gt;<i>     is done for the PB tests and several others, but not for many.
</I>
Well, this is actually usually the easiest way to test your code;
otherwise, you need to deal with crap like fake transports, etc. If
you do test over the network, make sure you listen on a local-only
interface (i.e., '127.0.0.1') and use a portno of 0. e.g.:

        self.port = reactor.listenTCP(0, self.svr, interface=&quot;127.0.0.1&quot;)
        self.portno = self.port.getHost()[-1]

&gt;<i> 2.  Closely related, what is the proper way to connect the client and
</I>&gt;<i>     server?  When I made changes, the t.test.test_pb.IOPump that the
</I>&gt;<i>     tests were using didn't seem to work.  According to spiv, this may
</I>&gt;<i>     not be the preferred connecting method to use anymore.
</I>
Well, if you do what I said above, then you just need to use regular
connectTCP(self.portno, fac).

&gt;<i> 3.  [moot question deleted]
</I>&gt;<i>
</I>&gt;<i> 4.  Regardless of the method used, what is the proper way to have the
</I>&gt;<i>     reactor keep going until there are no more events?  I need
</I>&gt;<i>     something analogous to test_pb.IOPump.pump() or flush(), if IOPump
</I>&gt;<i>     is not to be used.
</I>&gt;<i> 
</I>&gt;<i>     trial.unittest.TestCase.runReactor()?
</I>
Well, you don't really need &quot;until there are no more events&quot; --
usually, you just run the reactor until some state is reached, e.g.:

        while not l:
            reactor.iterate()

assuming that something triggered by running the reactor will
eventually make `l' True (e.g., if l started as an empty list, by
appending something to it). runReactor is only useful for
timing-related tests.

&gt;<i> 5.  When is the proper time to use unittest.deferredResult?  I see it
</I>&gt;<i>     used in some cases, yet in other cases regular callbacks and
</I>&gt;<i>     errbacks are used.
</I>
Well, any time you just want to get the result of a Deferred and don't
want to add a callback, you can use deferredResult. Some people
writing tests that use callbacks might not have known about
deferredResult, or don't like it, or needed to take advantage of
callback chaining, or whatever.

&gt;<i> 6.  Realted to that, when I added callbacks and errbacks, they didn't
</I>&gt;<i>     seem to get executed.  Yet looking at test_newcred.py, on line 89
</I>&gt;<i>     for example, they are added and then immediately the result is
</I>&gt;<i>     checked.  Does this work because I am listening on a port?  Or was
</I>&gt;<i>     my doing this not working originally because the client and server
</I>&gt;<i>     were not connected?  Later in the same file deferredResult is used.
</I>&gt;<i>     I'm not understanding what the expected behavior is then.
</I>
Well, it's probably because you're not running the reactor properly,
or something. I can't say more without seeing the code :)

&gt;<i> 7.  Is it preferred to use unittest.TestCase.assertEqual to the plain
</I>&gt;<i>     assert?  I see both used in various places in the Twisted tests.
</I>
Well, when you use the self.assert* methods, trial marks the tests as
&quot;Failures&quot;, rather than &quot;Errors&quot;, which occur when any other exception
is raised from the test. Not a really big difference. Also, assert
statements don't get run when python -O is used.


-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     <A HREF="http://twistedmatrix.com/users/radix.twistd/">http://twistedmatrix.com/users/radix.twistd/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="038373.html">[Twisted-Python] Writing unit tests with Trial for Twisted Applications
</A></li>
	<LI>Next message (by thread): <A HREF="038375.html">[Twisted-Python] Writing unit tests with Trial for Twisted Applications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38374">[ date ]</a>
              <a href="thread.html#38374">[ thread ]</a>
              <a href="subject.html#38374">[ subject ]</a>
              <a href="author.html#38374">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
