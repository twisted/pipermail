<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] FTPClient storeFile help.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20FTPClient%20storeFile%20help.&In-Reply-To=20031003165923.GB6738%40intarweb.us">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005890.html">
   <LINK REL="Next"  HREF="005940.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] FTPClient storeFile help.</H1>
    <B>Oisin Mulvihill</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20FTPClient%20storeFile%20help.&In-Reply-To=20031003165923.GB6738%40intarweb.us"
       TITLE="[Twisted-Python] FTPClient storeFile help.">oisin at enginesofcreation.ie
       </A><BR>
    <I>Tue Oct  7 08:20:06 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="005890.html">[Twisted-Python] FTPClient storeFile help.
</A></li>
        <LI>Next message: <A HREF="005940.html">[Twisted-Python] FTPClient storeFile help.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5936">[ date ]</a>
              <a href="thread.html#5936">[ thread ]</a>
              <a href="subject.html#5936">[ subject ]</a>
              <a href="author.html#5936">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jp Calderone wrote:

&gt;<i>On Fri, Oct 03, 2003 at 11:18:28AM +0100, Oisin Mulvihill wrote:
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>[snip]
</I>&gt;&gt;<i>Why are there two deferred objects returned by storeFile? The documentation
</I>&gt;&gt;<i>says:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>storeFile (self ,path ):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Store a file at the given path.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   This method issues the 'STOR' FTP command.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Returns:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   A tuple of two Deferreds:
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>   * Deferred IFinishableConsumer . You must call the finish method on the
</I>&gt;&gt;<i>       IFinishableConsumer when the file is completely transferred.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   * Deferred list of  control-connection responses.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>This really doesn't help me much. I get the impression that storeFile
</I>&gt;&gt;<i>isn't sending the contents of file, because its waiting for me to stream
</I>&gt;&gt;<i>the file contents somehow. Maybe via IFinishableConsumer?
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Correct, I believe.  It looks like you can use FileSender (from t.p.basic)
</I>&gt;<i>if you're just sending something off disk (or from any file object, really)
</I>&gt;<i>here.
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>In my current program, using ftplib, I do the following to upload a file:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   :
</I>&gt;&gt;<i>   ftp.storbinary('STOR %s' % (filename), fp)
</I>&gt;&gt;<i>   :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>This has the filename and a file descriptor passed to it. Is something
</I>&gt;&gt;<i>like this needed with storeFile?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Please can someone give me an answer to this, as looking at the code for
</I>&gt;&gt;<i>twisted.protocols.ftp isn't helping much either. This function seems to be
</I>&gt;&gt;<i>a mystery to me and I want to understand how to use it properly.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Try...
</I>&gt;<i>
</I>&gt;<i>    from twisted.protocols.basic import FileSender
</I>&gt;<i>
</I>&gt;<i>    def sendfile(consumer, fileObj):
</I>&gt;<i>        s = FileSender()
</I>&gt;<i>        return s.beginFileTransfer(fileObj, consumer
</I>&gt;<i>            ).addCallback(lambda _: consumer.finish()
</I>&gt;<i>            )
</I>&gt;<i>
</I>&gt;<i>    dC, dL = p.storeFile(&quot;path&quot;)
</I>&gt;<i>    dC.addCallback(sendfile, fileObj)
</I>&gt;<i>
</I>&gt;<i>  Jp
</I>&gt;<i>  
</I>&gt;<i>
</I>Thanks for replying. I've tried what you've suggested, however I'm
still getting the code &quot;waiting&quot; when the transfer is supposed to happen.
The follow is the code I added based on your suggestion (attached
is the complete source):

&lt;snip&gt;
:<i>
</I>:<i>
</I>
def sendfile(consumer, fileObj):
    &quot;&quot;&quot;
    &quot;&quot;&quot;
    print &quot;2.1 consumer, fileObject -&quot;, consumer, fileObj
    s = FileSender()
    print &quot;2.2&quot;
    d = s.beginFileTransfer(fileObj, consumer)
    print &quot;2.3&quot;
    d.addCallback(lambda _: consumer.finish())
    print &quot;2.4&quot;
    return d


def connectionMade(ftpClient):
    &quot;&quot;&quot;
    &quot;&quot;&quot;
    try:
        print &quot;1.0&quot;
        my_file = StringIO(&quot;Hello! Did this get sent to the remote side?&quot;)
        print &quot;1.1&quot;
        my_filename = 'myfile.txt'   
        print &quot;1.2&quot;
        ftpClient.pwd().addCallbacks(success, fail)
        print &quot;1.3&quot;
        dC, dL = ftpClient.storeFile(my_filename)
        print &quot;1.4&quot;
        dC.addCallback(sendfile, my_file)
        print &quot;1.5&quot;
        dL.addCallbacks(success, fail)
        print &quot;1.6&quot;
       
    except:
        print &quot;Exception -&quot;, sys.exc_value
        reactor.stop()

:<i>
</I>:<i>
</I>&lt;/snip&gt;

When I run this I get as far as the line:

    d = s.beginFileTransfer(fileObj, consumer)

This is where it now seems to be hanginig. The file transfer doesn't appear
to be happening. I noticed from the docs on beginFileTransfer(), that
it takes 3 args: file object, consumer &amp; transform function. I tried 
adding a
transform function to see it gets called with the data, read from the file,
however this never occured.

I'm not really sure where to go from here. Any suggestions?

Thanks,

om

-- 
Oisin Mulvihill
Engines Of Creation

Email: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">oisin at enginesofcreation.ie</A>
Work: +353 1 6791602
Mobile: +353 868191540


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ftpclient.py
Url: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031007/f4b57d5c/attachment.txt">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031007/f4b57d5c/attachment.txt</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005890.html">[Twisted-Python] FTPClient storeFile help.
</A></li>
	<LI>Next message: <A HREF="005940.html">[Twisted-Python] FTPClient storeFile help.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5936">[ date ]</a>
              <a href="thread.html#5936">[ thread ]</a>
              <a href="subject.html#5936">[ subject ]</a>
              <a href="author.html#5936">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
