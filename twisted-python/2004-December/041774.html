<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ludicrous timeouts in protocols.http.HTTPFactory	and web.server.Site
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ludicrous%20timeouts%20in%20protocols.http.HTTPFactory%0A%09and%20web.server.Site&In-Reply-To=%3C1104417872.2684.14.camel%40p-dhcp-333-72.rd.francetelecom.fr%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041766.html">
   <LINK REL="Next"  HREF="041781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ludicrous timeouts in protocols.http.HTTPFactory	and web.server.Site</H1>
    <B>Antoine Pitrou</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ludicrous%20timeouts%20in%20protocols.http.HTTPFactory%0A%09and%20web.server.Site&In-Reply-To=%3C1104417872.2684.14.camel%40p-dhcp-333-72.rd.francetelecom.fr%3E"
       TITLE="[Twisted-Python] ludicrous timeouts in protocols.http.HTTPFactory	and web.server.Site">solipsis at pitrou.net
       </A><BR>
    <I>Thu Dec 30 07:44:32 MST 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041766.html">[Twisted-Python] access an XMLRPC service through an HTTP proxy
</A></li>
        <LI>Next message (by thread): <A HREF="041781.html">[Twisted-Python] ludicrous timeouts in protocols.http.HTTPFactory	and web.server.Site
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41774">[ date ]</a>
              <a href="thread.html#41774">[ thread ]</a>
              <a href="subject.html#41774">[ subject ]</a>
              <a href="author.html#41774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

I'm accessing a twisted-based XMLRPC server through an HTTP proxy which
seems to leave outgoing connections open for a very long time (I think
it waits for the server to close them on its own). This means that after
a handful of remote method calls through this proxy, my server runs into
file descriptor limits:

Traceback (most recent call last):
  File &quot;/usr/lib/python2.3/site-packages/twisted/python/log.py&quot;, line 65, in callWithLogger
  File &quot;/usr/lib/python2.3/site-packages/twisted/python/log.py&quot;, line 52, in callWithContext
  File &quot;/usr/lib/python2.3/site-packages/twisted/python/context.py&quot;, line 43, in callWithContext
  File &quot;/usr/lib/python2.3/site-packages/twisted/internet/default.py&quot;, line 535, in _doReadOrWrite
--- &lt;exception caught here&gt; ---
  File &quot;/usr/lib/python2.3/site-packages/twisted/internet/tcp.py&quot;, line 625, in doRead
  File &quot;/usr/src/build/475206-i386/install/usr/lib/python2.3/socket.py&quot;, line 167, in accept
socket.error: (24, 'Too many open files')

Which is easily checked by a netstat dump :

$ netstat --inet --tcp -n -p | grep :8550
tcp        0      0 192.33.178.29:8550          193.49.124.107:30839        ESTABLISHED 3076/python 
tcp        0      0 192.33.178.29:8550          193.49.124.107:25463        ESTABLISHED 3076/python 
tcp        0      0 192.33.178.29:8550          193.49.124.107:37494        ESTABLISHED 3076/python 
tcp        0      0 192.33.178.29:8550          193.49.124.107:33910        ESTABLISHED 3076/python 
tcp        0      0 192.33.178.29:8550          193.49.124.107:20854        ESTABLISHED 3076/python 
...
... and so on for exactly 998 lines


Looking at the Twisted code, I see that very long timeouts have been
defined for both protocols.http.HTTPFactory and web.server.Site
(60*60*12, that is 12 hours!). If I override the &quot;timeout&quot; parameter
when constructing the Site receiving XMLRPC connections, then the
problem disappears:
        reactor.listenTCP(xmlrpc_port, server.Site(self, timeout=30), interface=xmlrpc_host)

I think the default values in Twisted are quite bogus and should be
changed to more sensible ones. 30 or 60 seconds is ok in the context of
an HTTP connection. Very long timeouts on the other hand make the server
very vulnerable.

Regards

Antoine.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041766.html">[Twisted-Python] access an XMLRPC service through an HTTP proxy
</A></li>
	<LI>Next message (by thread): <A HREF="041781.html">[Twisted-Python] ludicrous timeouts in protocols.http.HTTPFactory	and web.server.Site
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41774">[ date ]</a>
              <a href="thread.html#41774">[ thread ]</a>
              <a href="subject.html#41774">[ subject ]</a>
              <a href="author.html#41774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
