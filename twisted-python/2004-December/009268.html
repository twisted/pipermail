<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: More on PB Copyable Errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20More%20on%20PB%20Copyable%20Errors&In-Reply-To=94a776e7041230074867d17cc6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009267.html">
   <LINK REL="Next"  HREF="009269.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: More on PB Copyable Errors</H1>
    <B>Justin Johnson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20More%20on%20PB%20Copyable%20Errors&In-Reply-To=94a776e7041230074867d17cc6%40mail.gmail.com"
       TITLE="[Twisted-Python] Re: More on PB Copyable Errors">justinjohnson at gmail.com
       </A><BR>
    <I>Thu Dec 30 10:57:49 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009267.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
        <LI>Next message: <A HREF="009269.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9268">[ date ]</a>
              <a href="thread.html#9268">[ thread ]</a>
              <a href="subject.html#9268">[ subject ]</a>
              <a href="author.html#9268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Option 1 is also most like the way things work today for sending
anything that isn't an error.  The only reason CopyableFailure exists
is because you HAVE to send a failure.  Whether it is
jelly/unjellyable or not, the other end must be informed of errors. 
But as soon as a developer decides to make their errors copyable, they
have in effect agreed that they are responsible for testing the
unjellying on the other end.


On Thu, 30 Dec 2004 09:48:17 -0600, Justin Johnson
&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; wrote:
&gt;<i> I agree.  I did some testing to verify what you were saying.  So this
</I>&gt;<i> is basically reiterating everything you just said, but just for
</I>&gt;<i> clarification for myself... in the current non-patched code the
</I>&gt;<i> following happens:
</I>&gt;<i> 
</I>&gt;<i> When the server encounters an error while calling a method that was
</I>&gt;<i> invoked from a remote client, it will...
</I>&gt;<i>   1) Wrap all subclasses of pb.Error in a pb.CopyableFailure, thus
</I>&gt;<i> replacing actual pb.Error instances with a string representation of
</I>&gt;<i> them.
</I>&gt;<i>   2) Return a new (non-wrapping) pb.CopyableFailure for all other
</I>&gt;<i> errors, thus including stack trace, etc.
</I>&gt;<i> 
</I>&gt;<i> When the server needs to send anything else back to the client, if it
</I>&gt;<i> is a subclass of flavors.Jellyable it sends it back.  Otherwise it
</I>&gt;<i> raises InsecureJelly on the server side.
</I>&gt;<i> 
</I>&gt;<i> On the client side it will unjelly the thing sent across if it can
</I>&gt;<i> (i.e. if setUnjellyableForClass was called).  Otherwise it raises an
</I>&gt;<i> InsecureJelly on the client side.
</I>&gt;<i> 
</I>&gt;<i> So it seems like these are our options:
</I>&gt;<i> 
</I>&gt;<i> 1) If an error is Jellyable, send it and assume the client will either
</I>&gt;<i> unjelly it or deal with unjellying errors.
</I>&gt;<i> 
</I>&gt;<i> 2) If an error is Jellyable, send it.  If the client fails to unjelly
</I>&gt;<i> it, communicate back to the server who then sends a CopyableFailure
</I>&gt;<i> wrapping the original error.
</I>&gt;<i> 
</I>&gt;<i> 3) If an error is Jellyable, send both it and a CopyableFailure
</I>&gt;<i> wrapping the original error.  The client can then first try to unjelly
</I>&gt;<i> the error and fall back to the CopyableFailure that was passed along.
</I>&gt;<i> 
</I>&gt;<i> I vote for option 1.  Options 2 and 3 seem somewhat hacky to me.
</I>&gt;<i> 
</I>&gt;<i> -Justin
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 29 Dec 2004 21:31:17 -0500, David Bolen &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">db3l at fitlinxx.com</A>&gt; wrote:
</I>&gt;<i> &gt; Justin Johnson &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; writes:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; In my testing it seemed that I would get an InsecureJelly error on the
</I>&gt;<i> &gt; &gt; sending side if I tried to send back an object that I hadn't called
</I>&gt;<i> &gt; &gt; pb.setUnjellyableForClass on the sending side for.  In other words,
</I>&gt;<i> &gt; &gt; calling setUnjellyableForClass on the sending side was a way of saying
</I>&gt;<i> &gt; &gt; that it was okay to send over the wire, and also a way of registering
</I>&gt;<i> &gt; &gt; what class to use when unjellying it if it were received.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Is this not correct?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I believe the only purpose of setUnjellyableForClass is to establish
</I>&gt;<i> &gt; what to do for unjellying.  While it does also impact the global
</I>&gt;<i> &gt; security options (which do get checked during jellying) the way it
</I>&gt;<i> &gt; stores type information in there is only matched during unjellying, at
</I>&gt;<i> &gt; least in my experience (it adds permission for the type but not the
</I>&gt;<i> &gt; instance).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I believe the only (typical) requirement to support jellying an object
</I>&gt;<i> &gt; is that it be a class that is a jelly.Jellyable subclass (such as any
</I>&gt;<i> &gt; of the remoteable flavors like Copyable, Referenceable, etc...).  Nothing
</I>&gt;<i> &gt; else should be needed on the server side.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I just tried a quick tweak to your s/e/c.py modules so that s.py
</I>&gt;<i> &gt; returned an instance of a dummy class defined in e.py instead of an
</I>&gt;<i> &gt; error, and it seems to work fine even if the server side (s) hasn't
</I>&gt;<i> &gt; issued the setUnjellyableForClass call.  Without that call, the client
</I>&gt;<i> &gt; will raise the error after receiving the object.  And even if the
</I>&gt;<i> &gt; server does issue that call, if the dummy class isn't inheriting from
</I>&gt;<i> &gt; Copyable, the insecure error is generated on the transmitting side.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It is, however, possible to insert additional types/classes/modules
</I>&gt;<i> &gt; into the global security options independent of class inheritance from
</I>&gt;<i> &gt; Jellyable.  This is how all the basic Python types are handled, but it
</I>&gt;<i> &gt; can be extended to support your own classes (although I had a problem
</I>&gt;<i> &gt; with extension classes/types, since I originally tried to use this to
</I>&gt;<i> &gt; support mxDateTime objects without modifying jelly).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So for example, if I have my test class &quot;MyObject&quot; in e.py, and
</I>&gt;<i> &gt; instead of setUnjellyableForClass, I use something like
</I>&gt;<i> &gt; &quot;jelly.globalSecurity.allowInstancesOf(MyObject)&quot;, then the object
</I>&gt;<i> &gt; will still be successfully sent and received (providing the instance
</I>&gt;<i> &gt; data can also be jellied).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So after writing this, the fact that the security options could get
</I>&gt;<i> &gt; used to permit an instance (that isn't of a subclass of Jellyable) to
</I>&gt;<i> &gt; be encoded might mean that just verifying Jellyable (ala my last
</I>&gt;<i> &gt; response to Christopher) is insufficient, at least technically.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Perhaps the only true way to determine if something is jellyable is to
</I>&gt;<i> &gt; try to jelly it (heck, that's probably more Pythonic anyway), and just
</I>&gt;<i> &gt; handle an exception as a fallback to the string representation.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -- David
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009267.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
	<LI>Next message: <A HREF="009269.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9268">[ date ]</a>
              <a href="thread.html#9268">[ thread ]</a>
              <a href="subject.html#9268">[ subject ]</a>
              <a href="author.html#9268">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
