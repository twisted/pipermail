<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: More on PB Copyable Errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20More%20on%20PB%20Copyable%20Errors&In-Reply-To=%3C94a776e7041230074867d17cc6%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041773.html">
   <LINK REL="Next"  HREF="041776.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: More on PB Copyable Errors</H1>
    <B>Justin Johnson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20More%20on%20PB%20Copyable%20Errors&In-Reply-To=%3C94a776e7041230074867d17cc6%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Re: More on PB Copyable Errors">justinjohnson at gmail.com
       </A><BR>
    <I>Thu Dec 30 08:48:17 MST 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041773.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
        <LI>Next message (by thread): <A HREF="041776.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41775">[ date ]</a>
              <a href="thread.html#41775">[ thread ]</a>
              <a href="subject.html#41775">[ subject ]</a>
              <a href="author.html#41775">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I agree.  I did some testing to verify what you were saying.  So this
is basically reiterating everything you just said, but just for
clarification for myself... in the current non-patched code the
following happens:

When the server encounters an error while calling a method that was
invoked from a remote client, it will...
   1) Wrap all subclasses of pb.Error in a pb.CopyableFailure, thus
replacing actual pb.Error instances with a string representation of
them.
   2) Return a new (non-wrapping) pb.CopyableFailure for all other
errors, thus including stack trace, etc.

When the server needs to send anything else back to the client, if it
is a subclass of flavors.Jellyable it sends it back.  Otherwise it
raises InsecureJelly on the server side.

On the client side it will unjelly the thing sent across if it can
(i.e. if setUnjellyableForClass was called).  Otherwise it raises an
InsecureJelly on the client side.

So it seems like these are our options:

1) If an error is Jellyable, send it and assume the client will either
unjelly it or deal with unjellying errors.

2) If an error is Jellyable, send it.  If the client fails to unjelly
it, communicate back to the server who then sends a CopyableFailure
wrapping the original error.

3) If an error is Jellyable, send both it and a CopyableFailure
wrapping the original error.  The client can then first try to unjelly
the error and fall back to the CopyableFailure that was passed along.


I vote for option 1.  Options 2 and 3 seem somewhat hacky to me.

-Justin


On 29 Dec 2004 21:31:17 -0500, David Bolen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">db3l at fitlinxx.com</A>&gt; wrote:
&gt;<i> Justin Johnson &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; writes:
</I>&gt;<i> 
</I>&gt;<i> &gt; In my testing it seemed that I would get an InsecureJelly error on the
</I>&gt;<i> &gt; sending side if I tried to send back an object that I hadn't called
</I>&gt;<i> &gt; pb.setUnjellyableForClass on the sending side for.  In other words,
</I>&gt;<i> &gt; calling setUnjellyableForClass on the sending side was a way of saying
</I>&gt;<i> &gt; that it was okay to send over the wire, and also a way of registering
</I>&gt;<i> &gt; what class to use when unjellying it if it were received.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is this not correct?
</I>&gt;<i> 
</I>&gt;<i> I believe the only purpose of setUnjellyableForClass is to establish
</I>&gt;<i> what to do for unjellying.  While it does also impact the global
</I>&gt;<i> security options (which do get checked during jellying) the way it
</I>&gt;<i> stores type information in there is only matched during unjellying, at
</I>&gt;<i> least in my experience (it adds permission for the type but not the
</I>&gt;<i> instance).
</I>&gt;<i> 
</I>&gt;<i> I believe the only (typical) requirement to support jellying an object
</I>&gt;<i> is that it be a class that is a jelly.Jellyable subclass (such as any
</I>&gt;<i> of the remoteable flavors like Copyable, Referenceable, etc...).  Nothing
</I>&gt;<i> else should be needed on the server side.
</I>&gt;<i> 
</I>&gt;<i> I just tried a quick tweak to your s/e/c.py modules so that s.py
</I>&gt;<i> returned an instance of a dummy class defined in e.py instead of an
</I>&gt;<i> error, and it seems to work fine even if the server side (s) hasn't
</I>&gt;<i> issued the setUnjellyableForClass call.  Without that call, the client
</I>&gt;<i> will raise the error after receiving the object.  And even if the
</I>&gt;<i> server does issue that call, if the dummy class isn't inheriting from
</I>&gt;<i> Copyable, the insecure error is generated on the transmitting side.
</I>&gt;<i> 
</I>&gt;<i> It is, however, possible to insert additional types/classes/modules
</I>&gt;<i> into the global security options independent of class inheritance from
</I>&gt;<i> Jellyable.  This is how all the basic Python types are handled, but it
</I>&gt;<i> can be extended to support your own classes (although I had a problem
</I>&gt;<i> with extension classes/types, since I originally tried to use this to
</I>&gt;<i> support mxDateTime objects without modifying jelly).
</I>&gt;<i> 
</I>&gt;<i> So for example, if I have my test class &quot;MyObject&quot; in e.py, and
</I>&gt;<i> instead of setUnjellyableForClass, I use something like
</I>&gt;<i> &quot;jelly.globalSecurity.allowInstancesOf(MyObject)&quot;, then the object
</I>&gt;<i> will still be successfully sent and received (providing the instance
</I>&gt;<i> data can also be jellied).
</I>&gt;<i> 
</I>&gt;<i> So after writing this, the fact that the security options could get
</I>&gt;<i> used to permit an instance (that isn't of a subclass of Jellyable) to
</I>&gt;<i> be encoded might mean that just verifying Jellyable (ala my last
</I>&gt;<i> response to Christopher) is insufficient, at least technically.
</I>&gt;<i> 
</I>&gt;<i> Perhaps the only true way to determine if something is jellyable is to
</I>&gt;<i> try to jelly it (heck, that's probably more Pythonic anyway), and just
</I>&gt;<i> handle an exception as a fallback to the string representation.
</I>&gt;<i> 
</I>&gt;<i> -- David
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041773.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
	<LI>Next message (by thread): <A HREF="041776.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41775">[ date ]</a>
              <a href="thread.html#41775">[ thread ]</a>
              <a href="subject.html#41775">[ subject ]</a>
              <a href="author.html#41775">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
