<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: More on PB Copyable Errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20More%20on%20PB%20Copyable%20Errors&In-Reply-To=%3C94a776e70412300827a0ec69d%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041776.html">
   <LINK REL="Next"  HREF="041778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: More on PB Copyable Errors</H1>
    <B>Justin Johnson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20More%20on%20PB%20Copyable%20Errors&In-Reply-To=%3C94a776e70412300827a0ec69d%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Re: More on PB Copyable Errors">justinjohnson at gmail.com
       </A><BR>
    <I>Thu Dec 30 09:27:26 MST 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041776.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
        <LI>Next message (by thread): <A HREF="041778.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41777">[ date ]</a>
              <a href="thread.html#41777">[ thread ]</a>
              <a href="subject.html#41777">[ subject ]</a>
              <a href="author.html#41777">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A new patch is attached.


On Thu, 30 Dec 2004 09:57:49 -0600, Justin Johnson
&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; wrote:
&gt;<i> Option 1 is also most like the way things work today for sending
</I>&gt;<i> anything that isn't an error.  The only reason CopyableFailure exists
</I>&gt;<i> is because you HAVE to send a failure.  Whether it is
</I>&gt;<i> jelly/unjellyable or not, the other end must be informed of errors.
</I>&gt;<i> But as soon as a developer decides to make their errors copyable, they
</I>&gt;<i> have in effect agreed that they are responsible for testing the
</I>&gt;<i> unjellying on the other end.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Thu, 30 Dec 2004 09:48:17 -0600, Justin Johnson
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; I agree.  I did some testing to verify what you were saying.  So this
</I>&gt;<i> &gt; is basically reiterating everything you just said, but just for
</I>&gt;<i> &gt; clarification for myself... in the current non-patched code the
</I>&gt;<i> &gt; following happens:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When the server encounters an error while calling a method that was
</I>&gt;<i> &gt; invoked from a remote client, it will...
</I>&gt;<i> &gt;   1) Wrap all subclasses of pb.Error in a pb.CopyableFailure, thus
</I>&gt;<i> &gt; replacing actual pb.Error instances with a string representation of
</I>&gt;<i> &gt; them.
</I>&gt;<i> &gt;   2) Return a new (non-wrapping) pb.CopyableFailure for all other
</I>&gt;<i> &gt; errors, thus including stack trace, etc.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When the server needs to send anything else back to the client, if it
</I>&gt;<i> &gt; is a subclass of flavors.Jellyable it sends it back.  Otherwise it
</I>&gt;<i> &gt; raises InsecureJelly on the server side.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On the client side it will unjelly the thing sent across if it can
</I>&gt;<i> &gt; (i.e. if setUnjellyableForClass was called).  Otherwise it raises an
</I>&gt;<i> &gt; InsecureJelly on the client side.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So it seems like these are our options:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1) If an error is Jellyable, send it and assume the client will either
</I>&gt;<i> &gt; unjelly it or deal with unjellying errors.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2) If an error is Jellyable, send it.  If the client fails to unjelly
</I>&gt;<i> &gt; it, communicate back to the server who then sends a CopyableFailure
</I>&gt;<i> &gt; wrapping the original error.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3) If an error is Jellyable, send both it and a CopyableFailure
</I>&gt;<i> &gt; wrapping the original error.  The client can then first try to unjelly
</I>&gt;<i> &gt; the error and fall back to the CopyableFailure that was passed along.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I vote for option 1.  Options 2 and 3 seem somewhat hacky to me.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -Justin
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 29 Dec 2004 21:31:17 -0500, David Bolen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">db3l at fitlinxx.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; Justin Johnson &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; writes:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; In my testing it seemed that I would get an InsecureJelly error on the
</I>&gt;<i> &gt; &gt; &gt; sending side if I tried to send back an object that I hadn't called
</I>&gt;<i> &gt; &gt; &gt; pb.setUnjellyableForClass on the sending side for.  In other words,
</I>&gt;<i> &gt; &gt; &gt; calling setUnjellyableForClass on the sending side was a way of saying
</I>&gt;<i> &gt; &gt; &gt; that it was okay to send over the wire, and also a way of registering
</I>&gt;<i> &gt; &gt; &gt; what class to use when unjellying it if it were received.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Is this not correct?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I believe the only purpose of setUnjellyableForClass is to establish
</I>&gt;<i> &gt; &gt; what to do for unjellying.  While it does also impact the global
</I>&gt;<i> &gt; &gt; security options (which do get checked during jellying) the way it
</I>&gt;<i> &gt; &gt; stores type information in there is only matched during unjellying, at
</I>&gt;<i> &gt; &gt; least in my experience (it adds permission for the type but not the
</I>&gt;<i> &gt; &gt; instance).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I believe the only (typical) requirement to support jellying an object
</I>&gt;<i> &gt; &gt; is that it be a class that is a jelly.Jellyable subclass (such as any
</I>&gt;<i> &gt; &gt; of the remoteable flavors like Copyable, Referenceable, etc...).  Nothing
</I>&gt;<i> &gt; &gt; else should be needed on the server side.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I just tried a quick tweak to your s/e/c.py modules so that s.py
</I>&gt;<i> &gt; &gt; returned an instance of a dummy class defined in e.py instead of an
</I>&gt;<i> &gt; &gt; error, and it seems to work fine even if the server side (s) hasn't
</I>&gt;<i> &gt; &gt; issued the setUnjellyableForClass call.  Without that call, the client
</I>&gt;<i> &gt; &gt; will raise the error after receiving the object.  And even if the
</I>&gt;<i> &gt; &gt; server does issue that call, if the dummy class isn't inheriting from
</I>&gt;<i> &gt; &gt; Copyable, the insecure error is generated on the transmitting side.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; It is, however, possible to insert additional types/classes/modules
</I>&gt;<i> &gt; &gt; into the global security options independent of class inheritance from
</I>&gt;<i> &gt; &gt; Jellyable.  This is how all the basic Python types are handled, but it
</I>&gt;<i> &gt; &gt; can be extended to support your own classes (although I had a problem
</I>&gt;<i> &gt; &gt; with extension classes/types, since I originally tried to use this to
</I>&gt;<i> &gt; &gt; support mxDateTime objects without modifying jelly).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; So for example, if I have my test class &quot;MyObject&quot; in e.py, and
</I>&gt;<i> &gt; &gt; instead of setUnjellyableForClass, I use something like
</I>&gt;<i> &gt; &gt; &quot;jelly.globalSecurity.allowInstancesOf(MyObject)&quot;, then the object
</I>&gt;<i> &gt; &gt; will still be successfully sent and received (providing the instance
</I>&gt;<i> &gt; &gt; data can also be jellied).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; So after writing this, the fact that the security options could get
</I>&gt;<i> &gt; &gt; used to permit an instance (that isn't of a subclass of Jellyable) to
</I>&gt;<i> &gt; &gt; be encoded might mean that just verifying Jellyable (ala my last
</I>&gt;<i> &gt; &gt; response to Christopher) is insufficient, at least technically.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Perhaps the only true way to determine if something is jellyable is to
</I>&gt;<i> &gt; &gt; try to jelly it (heck, that's probably more Pythonic anyway), and just
</I>&gt;<i> &gt; &gt; handle an exception as a fallback to the string representation.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; -- David
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: patch.txt
URL: &lt;/pipermail/twisted-python/attachments/20041230/057bd89d/attachment-0002.txt&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041776.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
	<LI>Next message (by thread): <A HREF="041778.html">[Twisted-Python] Re: More on PB Copyable Errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41777">[ date ]</a>
              <a href="thread.html#41777">[ thread ]</a>
              <a href="subject.html#41777">[ subject ]</a>
              <a href="author.html#41777">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
