<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] waitForDeferred Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20waitForDeferred%20Question&In-Reply-To=%3Cfa8579a40603102044r51bdcee0v4eb1067310d305fb%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045173.html">
   <LINK REL="Next"  HREF="045176.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] waitForDeferred Question</H1>
    <B>Brian Granger</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20waitForDeferred%20Question&In-Reply-To=%3Cfa8579a40603102044r51bdcee0v4eb1067310d305fb%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] waitForDeferred Question">bgranger at scu.edu
       </A><BR>
    <I>Fri Mar 10 21:44:26 MST 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045173.html">[Twisted-Python] waitForDeferred Question
</A></li>
        <LI>Next message (by thread): <A HREF="045176.html">[Twisted-Python] waitForDeferred Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45175">[ date ]</a>
              <a href="thread.html#45175">[ thread ]</a>
              <a href="subject.html#45175">[ subject ]</a>
              <a href="author.html#45175">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I probably should have given more details about what I am trying to
do.  Before I get going, I should mention that I have been using
Twisted heavily for 1.5 years and I have, for the most part, learned
to play the &quot;Twisted Game.&quot;

So here is what I am working on:

I am developing objects (for scientific computing) that 1) use Twisted
to talk over the network and 2) need to be used interactively from a
python prompt.  This second point is really where the difficult and
interesting things are.

To allow Twisted-things to be used interactively I have built a
version of PyCrust/PyShell that is &quot;Twisted enabled.&quot;  We have used
the standard threadedselectreactor to interleave the Twisted event
loop with that of PyShell.  We also inject the reactor into the users
interactive namespace.  Thus, you can use all of Twisted's
capabilities from an interactive python prompt.

As a side note, this situation is extremely nice for playing around
with Twisted and doing interactive debugging of Twisted-using
applications.

Here is a typical (madeup) usage case:

&gt;&gt;&gt;<i> a = TwistedEnabledObject()
</I>&gt;&gt;&gt;<i> a.connect(addr)                # This uses reactor.connectTCP to
</I>connect to a server
&gt;&gt;&gt;<i> myresult = a.computeSomethingUsingTwisted(args)     # This should block!!!
</I>...and maybe...
&gt;&gt;&gt;<i> y = f(myresult)
</I>&gt;&gt;&gt;<i> plot(y)
</I>
The key point is that the user will want to direclty use myresult
interactively.  Also they won't know ahead of time what actions they
will want to do.  Anyone who has used Matlab or Mathematica
(scientists) will find this way of working extremely familiar.  There
is simply no way that users will want to get a Deferred() and add
callbacks to trigger actions.  Thus I would argue that I DO want to
make my properly written asynchronous code blocking.

The implementation of computeSomethingUsingTwisted() is the difficult part:

class TwistedEnabledObject():

  def connect(addr):
    self.factory = MyClientFactory()
    self.connector = reactor.connectTCP(addr[0],addr[1],self.factory)

  def computeSomethingUsingTwisted(args):
    d = self.connector.transport.protocol.computeAndReturnDeferred(args)
    # Now I have a Deferred that will have the result, but I want to wait until
    # the result or an error is ready and then decide what the result should be
    result = # what to put here?
    return result

I don't think what I am doing goes against the &quot;Twisted-way.&quot;  And my
needs are not coming from any inability on my part to write proper
asynchronous code.  The high level stuff here is really bbeing driven
by the need to use these object interactively.

On 3/10/06, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>&gt; wrote:

&gt;<i> If you don't mind some vitriol, there is more information here, on my blog: <A HREF="http://glyf.livejournal.com/40037.html">http://glyf.livejournal.com/40037.html</A>
</I>
I am familiar with this and other similar &quot;vitriols.&quot;  I fully agree
with most of what you say about threads.  But what does my usage case
have to do with threads?

cheers,

Brian

Brian Granger
Santa Clara University
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ellisonbg at gmail.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045173.html">[Twisted-Python] waitForDeferred Question
</A></li>
	<LI>Next message (by thread): <A HREF="045176.html">[Twisted-Python] waitForDeferred Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45175">[ date ]</a>
              <a href="thread.html#45175">[ thread ]</a>
              <a href="subject.html#45175">[ subject ]</a>
              <a href="author.html#45175">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
