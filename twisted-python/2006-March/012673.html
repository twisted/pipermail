<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] waitForDeferred Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20waitForDeferred%20Question&In-Reply-To=fa8579a40603102308r43f7cc23w161327116aeb6835%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012672.html">
   <LINK REL="Next"  HREF="012677.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] waitForDeferred Question</H1>
    <B>Moof</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20waitForDeferred%20Question&In-Reply-To=fa8579a40603102308r43f7cc23w161327116aeb6835%40mail.gmail.com"
       TITLE="[Twisted-Python] waitForDeferred Question">moof at metamoof.net
       </A><BR>
    <I>Sat Mar 11 07:37:43 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012672.html">[Twisted-Python] waitForDeferred Question
</A></li>
        <LI>Next message: <A HREF="012677.html">[Twisted-Python] waitForDeferred Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12673">[ date ]</a>
              <a href="thread.html#12673">[ thread ]</a>
              <a href="subject.html#12673">[ subject ]</a>
              <a href="author.html#12673">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> I am not super familiar with PyShell/PyCrust, but I think everything
</I>&gt;<i> (including the prompt generation) is done asynchronously.  The only
</I>&gt;<i> thing that could really block would be long running python code
</I>&gt;<i> executed in the users namespace in PyShell.  But, I do like the idea
</I>&gt;<i> of having immediate results return directly, but have everything else
</I>&gt;<i> become a background job.  But, the question still remains - how do you
</I>&gt;<i> convert a Deferred() to a blocking, directly returned result?
</I>
You could use something like
<A HREF="http://svn.twistedmatrix.com/cvs/sandbox/exarkun/threadwrapper.py?view=markup&amp;rev=12804">http://svn.twistedmatrix.com/cvs/sandbox/exarkun/threadwrapper.py?view=markup&amp;rev=12804</A>
but I really dont' reccommend it. I think redefining the way the
interpreter works is the way ahead.

One way to do it would be to think of the space between the last &gt;&gt;&gt;
prompt and the current one as &quot;flexible&quot;. How about this for an
example session:

&gt;&gt;&gt;<i> somethingThatReturnsADeferred()
</I>
this will return a deferred, so natually the first thing you do is
attach callbacks and errbacks to it to know when the deferred has
finished. You display some indication of this:

&lt;Deferred 1 at 0x12345678. Currently: Running&gt;
&gt;&gt;&gt;<i>
</I>
You even make a nice coloured &quot;running&quot; icon to put on one side, if
you want. When it stops, you change &quot;Running&quot; to &quot;Completed&quot;, in the
same line. Assuming nothing has been done yet, you either raise the
exception (or, I'd prefer printing out the traceback and putting the
Failure in a special variable, called, say _f, it's more flexible) or
print out repr(d.result) before putting d.result in _ and the deferred
in, say, d. The important thing here is to print out the result in the
space between the two &gt;&gt;&gt;, expanding it as necessary. Thus the screen
ends up looking like this:

&gt;&gt;&gt;<i>  somethingThatReturnsADeferred()
</I>&lt;Deferred 1 at 0x12345678. Currently: Completed&gt;
Result from Deferred 1:
['this', 'is', 'a', 'result']
&gt;&gt;&gt;<i>
</I>
If someone has already executed a new command, you display *which*
deferred the result comes form and skip the _ and d assignemnt step,
maybe assiging it to another special variable.

Other enhancement would be to add currently pending deferreds to a
variable or command you can quickly use to check the status, eg:

&gt;&gt;&gt;<i> jobs
</I>1. &lt;Deferred 1 at 0x12345678: Running, Next callback: somefunc(result,
arg1, arg2, kw1=val1&gt;
2. &lt;Deferred 2 at 0x12345679: Running, Next callback: somefunc(result,
arg1, arg2, kw1=val4&gt;
3. &lt;Deferred 3 at 0x12345680: Running, Next callback: somefunc(result,
arg1, arg2, kw1=val3&gt;
&gt;&gt;&gt;<i> important_deferred = jobs[1] #so that deferred will not be garbage
</I>collected once it falls out of scope

You might also want to add a convenience function result() which takes
a deferred and does the whole putting of the result in _ and the
deferred in d.

There are plenty of ways to do it. Trying to make it look blocking is
the wrong way to go about it, IMO.

Also, I'd be quite interested to see a twisted-compatible PyCrust.
Maybe even adding the twisted log to a tab in the bottom pane of the
window. I'd be happy to lend a hand in coding such a beast, if you'd
like one.

It'd be especilly nice if it could do something manhole-compatible, so
pycrust could attach to remote twisted processes...

Moof


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012672.html">[Twisted-Python] waitForDeferred Question
</A></li>
	<LI>Next message: <A HREF="012677.html">[Twisted-Python] waitForDeferred Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12673">[ date ]</a>
              <a href="thread.html#12673">[ thread ]</a>
              <a href="subject.html#12673">[ subject ]</a>
              <a href="author.html#12673">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
