<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Degrading under load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Degrading%20under%20load&In-Reply-To=1141943495.9187.9.camel%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012654.html">
   <LINK REL="Next"  HREF="012768.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Degrading under load</H1>
    <B>Alec Matusis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Degrading%20under%20load&In-Reply-To=1141943495.9187.9.camel%40localhost.localdomain"
       TITLE="[Twisted-Python] Degrading under load">matusis at matusis.com
       </A><BR>
    <I>Sat Mar 25 01:36:13 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012654.html">[Twisted-Python] Degrading under load
</A></li>
        <LI>Next message: <A HREF="012768.html">[Twisted-Python] Degrading under load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12766">[ date ]</a>
              <a href="thread.html#12766">[ thread ]</a>
              <a href="subject.html#12766">[ subject ]</a>
              <a href="author.html#12766">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We finally upgraded 1.3 to 2.2 without changing the code. The load shown by
'top' for that twistd process may have dropped form 98-99% to 96-98%,
although this is not clear. In any case, the load reduction was marginal, if
any. 
 
Even though the main source of load is OS poll(), we did expect some
improvement from the different scheduler algorithm in 2.2: we have
setTimeout() on each new connection and resetTimeout() every 90 sec on each
connection when keep-alives from the clients arrive.


-----Original Message-----
From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>
[mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of Itamar
Shtull-Trauring
Sent: Thursday, March 09, 2006 2:32 PM
To: Twisted general discussion
Subject: RE: [Twisted-Python] Degrading under load

On Thu, 2006-03-09 at 13:49 -0800, Alec Matusis wrote:

&gt;<i> I should add here that in our case, the load was driven not by
</I>&gt;<i> connection/disconnection events, but by the number of established
</I>&gt;<i> connections. When that number was in the vicinity of 5000, system poll()
</I>&gt;<i> became very slow (we run poll reactor).
</I>
An epoll-based reactor would probably help significantly in this case.
Also note that Twisted 2.x had some algorithmic speed improvements over
1.3 and should scale better (though that doesn't help with poll() being
a bottleneck).


[Twisted-Python] twisted performance
Itamar Shtull-Trauring itamar at itamarst.org 
Wed Dec 7 10:15:43 MST 2005 

Previous message: [Twisted-Python] twisted performance 
Next message: [Twisted-Python] twisted performance 
Messages sorted by: [ date ] [ thread ] [ subject ] [ author ] 

----------------------------------------------------------------------------
----

On Wed, 2005-12-07 at 02:04 -0800, Alec Matusis wrote:
&gt;<i> I am running Twisted 1.3 server with a fairly large number of clients.
</I>&gt;<i> The hardware is two 64 bit 3.0 GHz Xeons with HT, 4GB RAM, and it's on
</I>&gt;<i> 2.6.11 kernel.
</I>&gt;<i> I am using poll reactor.
</I>&gt;<i> Currently, when the number of clients approaches 5000, the &quot;top&quot; shows
</I>&gt;<i> 99% CPU load for twistd process, the event loop slows down and weird
</I>&gt;<i> racing conditions show up. 
</I>
Could you try this experiment with Twisted 2.1, ideally with the latest
version of Python? There were a number of algorithmic improvements since
1.3 (the one that comes to mind in this case is the scheduler.)

One way to discover if the OS-level poll() is the problem is to use
oprofile; you should be able to use it to see how much time is spent in
there. Before that however, you'd want to use the Python profiler to
figure out if there's any obvious hotspots.






</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012654.html">[Twisted-Python] Degrading under load
</A></li>
	<LI>Next message: <A HREF="012768.html">[Twisted-Python] Degrading under load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12766">[ date ]</a>
              <a href="thread.html#12766">[ thread ]</a>
              <a href="subject.html#12766">[ subject ]</a>
              <a href="author.html#12766">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
