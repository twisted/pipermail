<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] waitForDeferred Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20waitForDeferred%20Question&In-Reply-To=bff8eeef0603110437k79d55741i88951ec0f54ea9f5%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012673.html">
   <LINK REL="Next"  HREF="012682.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] waitForDeferred Question</H1>
    <B>Brian Granger</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20waitForDeferred%20Question&In-Reply-To=bff8eeef0603110437k79d55741i88951ec0f54ea9f5%40mail.gmail.com"
       TITLE="[Twisted-Python] waitForDeferred Question">bgranger at scu.edu
       </A><BR>
    <I>Sat Mar 11 13:10:38 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012673.html">[Twisted-Python] waitForDeferred Question
</A></li>
        <LI>Next message: <A HREF="012682.html">[Twisted-Python] waitForDeferred Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12677">[ date ]</a>
              <a href="thread.html#12677">[ thread ]</a>
              <a href="subject.html#12677">[ subject ]</a>
              <a href="author.html#12677">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/11/06, Moof &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">moof at metamoof.net</A>&gt; wrote:
&gt;<i> &gt; I am not super familiar with PyShell/PyCrust, but I think everything
</I>&gt;<i> &gt; (including the prompt generation) is done asynchronously.  The only
</I>&gt;<i> &gt; thing that could really block would be long running python code
</I>&gt;<i> &gt; executed in the users namespace in PyShell.  But, I do like the idea
</I>&gt;<i> &gt; of having immediate results return directly, but have everything else
</I>&gt;<i> &gt; become a background job.  But, the question still remains - how do you
</I>&gt;<i> &gt; convert a Deferred() to a blocking, directly returned result?
</I>&gt;<i>
</I>&gt;<i> You could use something like
</I>&gt;<i> <A HREF="http://svn.twistedmatrix.com/cvs/sandbox/exarkun/threadwrapper.py?view=markup&amp;rev=12804">http://svn.twistedmatrix.com/cvs/sandbox/exarkun/threadwrapper.py?view=markup&amp;rev=12804</A>
</I>&gt;<i> but I really dont' reccommend it. I think redefining the way the
</I>&gt;<i> interpreter works is the way ahead.
</I>&gt;<i>
</I>&gt;<i> One way to do it would be to think of the space between the last &gt;&gt;&gt;
</I>&gt;<i> prompt and the current one as &quot;flexible&quot;. How about this for an
</I>&gt;<i> example session:
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; somethingThatReturnsADeferred()
</I>&gt;<i>
</I>&gt;<i> this will return a deferred, so natually the first thing you do is
</I>&gt;<i> attach callbacks and errbacks to it to know when the deferred has
</I>&gt;<i> finished. You display some indication of this:
</I>&gt;<i>
</I>&gt;<i> &lt;Deferred 1 at 0x12345678. Currently: Running&gt;
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i>
</I>&gt;<i> You even make a nice coloured &quot;running&quot; icon to put on one side, if
</I>&gt;<i> you want. When it stops, you change &quot;Running&quot; to &quot;Completed&quot;, in the
</I>&gt;<i> same line. Assuming nothing has been done yet, you either raise the
</I>&gt;<i> exception (or, I'd prefer printing out the traceback and putting the
</I>&gt;<i> Failure in a special variable, called, say _f, it's more flexible) or
</I>&gt;<i> print out repr(d.result) before putting d.result in _ and the deferred
</I>&gt;<i> in, say, d. The important thing here is to print out the result in the
</I>&gt;<i> space between the two &gt;&gt;&gt;, expanding it as necessary. Thus the screen
</I>&gt;<i> ends up looking like this:
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt;  somethingThatReturnsADeferred()
</I>&gt;<i> &lt;Deferred 1 at 0x12345678. Currently: Completed&gt;
</I>&gt;<i> Result from Deferred 1:
</I>&gt;<i> ['this', 'is', 'a', 'result']
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i>
</I>&gt;<i> If someone has already executed a new command, you display *which*
</I>&gt;<i> deferred the result comes form and skip the _ and d assignemnt step,
</I>&gt;<i> maybe assiging it to another special variable.
</I>&gt;<i>
</I>
The problem is that the user will want to do:

&gt;&gt;&gt;<i> result = computeSomething()
</I>
OR

&gt;&gt;&gt;<i> result = 2.0*computeOneThing()*math.sin(computeAnother())
</I>
What should happen in these cases?  Ideally, the _entire_ command
should become a &quot;job&quot; that evaluates in a &quot;smart&quot; manner.  That is,
the final result shouldn't be computed until all other results are
available.  Meanwhile, the prompt should retrn to the user so they can
continue working.  But, I don't think this is possible w/o making
changes to CPython itself.  The alternative is to simply make each
command appear to block.

&gt;<i> Other enhancement would be to add currently pending deferreds to a
</I>&gt;<i> variable or command you can quickly use to check the status, eg:
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; jobs
</I>&gt;<i> 1. &lt;Deferred 1 at 0x12345678: Running, Next callback: somefunc(result,
</I>&gt;<i> arg1, arg2, kw1=val1&gt;
</I>&gt;<i> 2. &lt;Deferred 2 at 0x12345679: Running, Next callback: somefunc(result,
</I>&gt;<i> arg1, arg2, kw1=val4&gt;
</I>&gt;<i> 3. &lt;Deferred 3 at 0x12345680: Running, Next callback: somefunc(result,
</I>&gt;<i> arg1, arg2, kw1=val3&gt;
</I>&gt;<i> &gt;&gt;&gt; important_deferred = jobs[1] #so that deferred will not be garbage
</I>&gt;<i> collected once it falls out of scope
</I>&gt;<i>
</I>&gt;<i> You might also want to add a convenience function result() which takes
</I>&gt;<i> a deferred and does the whole putting of the result in _ and the
</I>&gt;<i> deferred in d.
</I>&gt;<i>
</I>&gt;<i> There are plenty of ways to do it. Trying to make it look blocking is
</I>&gt;<i> the wrong way to go about it, IMO.
</I>&gt;<i>
</I>
For long running commands I completely agree.  But for commands that
complete quickly (unless they fail in which case an exception should
be raised) I disagree.  For example:

&gt;&gt;&gt;<i> a = getPreComputedVariable('a')
</I>
Ib this case the onject 'a' on some server needs to be serialized and
brought back to the local machine.  There is no reason to mess with
Deferrreds in this case.

&gt;<i> Also, I'd be quite interested to see a twisted-compatible PyCrust.
</I>&gt;<i> Maybe even adding the twisted log to a tab in the bottom pane of the
</I>&gt;<i> window. I'd be happy to lend a hand in coding such a beast, if you'd
</I>&gt;<i> like one.
</I>&gt;<i>
</I>&gt;<i> It'd be especilly nice if it could do something manhole-compatible, so
</I>&gt;<i> pycrust could attach to remote twisted processes...
</I>&gt;<i>
</I>&gt;<i> Moof
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>

--
Brian Granger
Santa Clara University
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ellisonbg at gmail.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012673.html">[Twisted-Python] waitForDeferred Question
</A></li>
	<LI>Next message: <A HREF="012682.html">[Twisted-Python] waitForDeferred Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12677">[ date ]</a>
              <a href="thread.html#12677">[ thread ]</a>
              <a href="subject.html#12677">[ subject ]</a>
              <a href="author.html#12677">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
