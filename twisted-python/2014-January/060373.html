<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted names client.getHostbyName dual-stack	operation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20names%20client.getHostbyName%20dual-stack%0A%09operation&In-Reply-To=%3CE9651256-F9F4-4A56-B75F-88C15F01266D%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060369.html">
   <LINK REL="Next"  HREF="060375.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted names client.getHostbyName dual-stack	operation</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20names%20client.getHostbyName%20dual-stack%0A%09operation&In-Reply-To=%3CE9651256-F9F4-4A56-B75F-88C15F01266D%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Twisted names client.getHostbyName dual-stack	operation">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Jan  8 16:05:48 MST 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060369.html">[Twisted-Python] Twisted names client.getHostbyName dual-stack	operation
</A></li>
        <LI>Next message (by thread): <A HREF="060375.html">[Twisted-Python] Twisted names client.getHostbyName dual-stack operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60373">[ date ]</a>
              <a href="thread.html#60373">[ thread ]</a>
              <a href="subject.html#60373">[ subject ]</a>
              <a href="author.html#60373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jan 6, 2014, at 3:47 AM, Phil Mayers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">p.mayers at imperial.ac.uk</A>&gt; wrote:

&gt;<i> On 06/01/14 08:26, Maciej Wasilak wrote:
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've tried to use Twisted names.client.getHostByName() method to resolve
</I>&gt;&gt;<i> some addresses for my UDP based app. By default getHostByName() always
</I>&gt;&gt;<i> returns IPv6 address. I don't always have end-to-end IPv6 connectivity,
</I>&gt;<i> 
</I>&gt;<i> I'm not sure if t.n.client implements the same stuff that getaddrinfo does, namely RFC 6724 address selection rules and behaviour, and in particular if it has an equivalent of the AI_ADDRCONFIG flag.
</I>&gt;<i> 
</I>&gt;&gt;<i> After Twisted 13.2 announcement I've checked the new HostnameEndpoint
</I>&gt;&gt;<i> implementation to find possible solution (it seems to be dedicated to
</I>&gt;&gt;<i> solve similar problems, but for TCP-based protocols). However it seems
</I>&gt;&gt;<i> to use deferToThread(), and built-in Python getaddrinfo().
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> My questions:
</I>&gt;&gt;<i> 1. Is using deferToThread() a preferred solution?
</I>&gt;<i> 
</I>&gt;<i> IMO *all* applications should *always* use getaddrinfo() for resolution of user-supplied names. It really really annoys me when people decide to re-invent it - this is hard to get right, and apps like Chrome having their own implementation precludes things like DHCP-based 6724 tables in the future.
</I>&gt;<i> 
</I>&gt;<i> So yes, use &quot;deferToThread&quot; and &quot;getaddrinfo&quot;. Note that you should not, in general, specify the address family; let the AI_ADDRCONFIG flag sort that out for you.
</I>
I have a minor quibble - all applications deployed to other people’s hardware ought to always use getaddrinfo, because the essence of GAI is that it respects local configuration of the platform.  No matter how “hard” you try to get it “right”, you can’t ever know what the platform is doing with hostname resolution because it simply isn’t exposed any other way, let alone any asynchronous way.[1]

However, if you’re building a big service to run in the cloud, or on a VPN, on specially-tuned machines that you configured, using twisted.names can be more scalable and allow you to react more reasonably to high load situations.  Or, at least, it will give you a level of control so that you can tune it, since just doing potentially blocking platform stuff in a thread is not amenable to tuning.

-glyph

[1]: Actually it is sometimes exposed, for example with platform-specific APIs like &lt;<A HREF="https://developer.apple.com/library/mac/documentation/CoreFoundation/Reference/CFHostRef/Reference/reference.html">https://developer.apple.com/library/mac/documentation/CoreFoundation/Reference/CFHostRef/Reference/reference.html</A>&gt; and &lt;<A HREF="http://msdn.microsoft.com/en-us/library/windows/desktop/ms741522(v=vs.85">http://msdn.microsoft.com/en-us/library/windows/desktop/ms741522(v=vs.85</A>).aspx&gt;.  But you know, not on, like, Linux.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20140108/6622508c/attachment-0002.html&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4124 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20140108/6622508c/attachment-0002.bin&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060369.html">[Twisted-Python] Twisted names client.getHostbyName dual-stack	operation
</A></li>
	<LI>Next message (by thread): <A HREF="060375.html">[Twisted-Python] Twisted names client.getHostbyName dual-stack operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60373">[ date ]</a>
              <a href="thread.html#60373">[ thread ]</a>
              <a href="subject.html#60373">[ subject ]</a>
              <a href="author.html#60373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
