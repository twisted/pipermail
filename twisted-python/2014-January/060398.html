<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Exit all threads upon KeyboardInterrupt
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Exit%20all%20threads%20upon%20KeyboardInterrupt&In-Reply-To=%3CA21318A0-2959-4B10-A9C3-258448FC176A%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060397.html">
   <LINK REL="Next"  HREF="060399.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Exit all threads upon KeyboardInterrupt</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Exit%20all%20threads%20upon%20KeyboardInterrupt&In-Reply-To=%3CA21318A0-2959-4B10-A9C3-258448FC176A%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Exit all threads upon KeyboardInterrupt">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Jan 14 12:06:35 MST 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060397.html">[Twisted-Python] Exit all threads upon KeyboardInterrupt
</A></li>
        <LI>Next message (by thread): <A HREF="060399.html">[Twisted-Python] Exit all threads upon KeyboardInterrupt
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60398">[ date ]</a>
              <a href="thread.html#60398">[ thread ]</a>
              <a href="subject.html#60398">[ subject ]</a>
              <a href="author.html#60398">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 14, 2014, at 6:27 AM, Dustin J. Mitchell &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dustin at v.igoro.us</A>&gt; wrote:

&gt;<i> Second, this has nothing whatsoever to do with whether the I/O is
</I>&gt;<i> blocking or not.  Twisted apps can and, believe me from experience, do
</I>&gt;<i> suffer from stuck TCP connections.  Sure, the wasted resources in this
</I>&gt;<i> case are smaller (just a file descriptor, not a thread), but the user
</I>&gt;<i> experience is the same (part of the application hangs irreversibly).
</I>&gt;<i> In fact, this is about the only thing the manhole is used for at
</I>&gt;<i> Mozilla: running `os.close` on stuck fd's.
</I>
The lack of 'abortConnection' was a pretty serious design flaw in Twisted's transport interface initially, but that's been resolved for quite some time now.  It should be possible to handle this at the application level on a per-connection basis quite gracefully now.

I mean, your point is correct; you can certainly have &quot;stuck&quot; event sources in Twisted too, without any threads.  And without any intervention it results in exactly the same bad user experience.  I've certainly seen it myself.

However, intervention is easier than with a stuck thread.  You can't interrupt an arbitrary thread; you don't know and can't tell what it is doing without pretty invasive debugging instrumentation.  And, as you note, even before the advent of abortConnection, an os.close() could easily deal with a stuck async FD on a per-connection basis, without need to bring the entire process down.

Finally, we have abortConnection now, so my main point stands; the point was not &quot;never call os._exit&quot; but rather &quot;if you have to call os._exit, there's a bug&quot;.  The same is true here: if you have to manhole into your server to call os.close, there's a bug in your application where it's not timing something out and freeing a resource it otherwise could be freeing.

Unless your contention is that there are no bugs in buildbot? ;-)

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20140114/bb6fc3ce/attachment-0002.html&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4124 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20140114/bb6fc3ce/attachment-0002.bin&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060397.html">[Twisted-Python] Exit all threads upon KeyboardInterrupt
</A></li>
	<LI>Next message (by thread): <A HREF="060399.html">[Twisted-Python] Exit all threads upon KeyboardInterrupt
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60398">[ date ]</a>
              <a href="thread.html#60398">[ thread ]</a>
              <a href="subject.html#60398">[ subject ]</a>
              <a href="author.html#60398">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
