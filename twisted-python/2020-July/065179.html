<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Check of command leads to Traceback in http.py
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Check%20of%20command%20leads%20to%20Traceback%20in%20http.py&In-Reply-To=%3C2038744.Mh6RI2rZIc%40fpbarry%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065177.html">
   <LINK REL="Next"  HREF="065180.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Check of command leads to Traceback in http.py</H1>
    <B>Barry Scott</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Check%20of%20command%20leads%20to%20Traceback%20in%20http.py&In-Reply-To=%3C2038744.Mh6RI2rZIc%40fpbarry%3E"
       TITLE="[Twisted-Python] Check of command leads to Traceback in http.py">barry.scott at forcepoint.com
       </A><BR>
    <I>Wed Jul 29 10:15:57 MDT 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065177.html">[Twisted-Python] Semi-OT: hyperlink/twisted.python.url style package for Go
</A></li>
        <LI>Next message (by thread): <A HREF="065180.html">[Twisted-Python] Management of PyPI maintainers (as related to qt5reactor)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65179">[ date ]</a>
              <a href="thread.html#65179">[ thread ]</a>
              <a href="subject.html#65179">[ subject ]</a>
              <a href="author.html#65179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm seeing a Traceback in twisted/web/http.py and that lead me to read some of the code.

First question in this code from HTTPChannel.lineReceived() at line 2103 why only
check that the command is ASCII? By spec the whole line must be a subset of ASCII,
is there a good reason to not check that the request and version are ASCII?

We see requests where the first line is binary data in production.

            parts = line.split()
            if len(parts) != 3:
                self._respondToBadRequestAndDisconnect()
                return
            command, request, version = parts
            try:
                command.decode(&quot;ascii&quot;)
            except UnicodeDecodeError:
                self._respondToBadRequestAndDisconnect()
                return

If the code calls self._respondToBadRequestAndDisconnect()
It does not set self._version.

Next there is a call to lineReceived('') and the code Tracebacks when it
access self._version in this code at line 2293:

    def allHeadersReceived(self):
        req = self.requests[-1]
        req.parseCookies()
        self.persistent = self.checkPersistence(req, self._version)

Does this look wrong to you?

Also why do you del self._version as an idiom and not set it to None?

Barry



</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065177.html">[Twisted-Python] Semi-OT: hyperlink/twisted.python.url style package for Go
</A></li>
	<LI>Next message (by thread): <A HREF="065180.html">[Twisted-Python] Management of PyPI maintainers (as related to qt5reactor)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65179">[ date ]</a>
              <a href="thread.html#65179">[ thread ]</a>
              <a href="subject.html#65179">[ subject ]</a>
              <a href="author.html#65179">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
