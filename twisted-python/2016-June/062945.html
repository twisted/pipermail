<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Style/testing for log-related changes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Style/testing%20for%20log-related%20changes&In-Reply-To=%3CCADzPF4tHXfE3qzn4fKOqk4NSEKvh8z_zfdi-YLx4v7-sOp73eA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062882.html">
   <LINK REL="Next"  HREF="030422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Style/testing for log-related changes</H1>
    <B>Daniel Sutcliffe</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Style/testing%20for%20log-related%20changes&In-Reply-To=%3CCADzPF4tHXfE3qzn4fKOqk4NSEKvh8z_zfdi-YLx4v7-sOp73eA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Style/testing for log-related changes">dansut at gmail.com
       </A><BR>
    <I>Tue Jun 28 11:49:05 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062882.html">[Twisted-Python] Style/testing for log-related changes
</A></li>
        <LI>Next message (by thread): <A HREF="030422.html">[Twisted-Python] buildbot is back
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62945">[ date ]</a>
              <a href="thread.html#62945">[ thread ]</a>
              <a href="subject.html#62945">[ subject ]</a>
              <a href="author.html#62945">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm also finding myself looking at doing some of this so thought it
might be worth rejuvenating this thread...

On Jun 6, 2016, at 04:21, Phil Mayers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">p.mayers at imperial.ac.uk</A>&gt; wrote:
&gt;<i> &gt; I'd like to submit a patch to convert t.conch.ssh to the new logging. The
</I>&gt;<i> &gt; main reason is that the conch code logs a *lot* of really, really, really
</I>&gt;<i> &gt; boring crap that I want to throw away because it just clutters up the logs
</I>&gt;<i> &gt; e.g.
</I>&gt;<i> &gt; <A HREF="https://github.com/twisted/twisted/blob/twisted-16.2.0/twisted/conch/ssh/connection.py#L454">https://github.com/twisted/twisted/blob/twisted-16.2.0/twisted/conch/ssh/connection.py#L454</A>
</I>
On Mon, Jun 6, 2016 at 4:40 PM, Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
&gt;<i> No need to justify it - any work to move us internally to new APIs so we can
</I>&gt;<i> finally get to the business of deprecating the old ones would be great!
</I>
Looking through the code it doesn't actually seem like there's that
much work to get there, but as someone who is new to this project I
feel a bit more guidance would be useful. There seems to be little in
the way of examples of this being done, and when it has been done
there seem to be 2 approaches:

- one with a style similar to the examples in the docs:
    _log = twisted.logger.Logger()
    self._log.emit()
    <A HREF="https://github.com/twisted/twisted/commit/ff7a05da">https://github.com/twisted/twisted/commit/ff7a05da</A>

- and a more recent one that uses this style:
    twisted.logger._loggerFor(self).emit()
    <A HREF="https://github.com/twisted/twisted/commit/c575f1d">https://github.com/twisted/twisted/commit/c575f1d</A>

Appreciating consistancy is important and not wanting to waste time
doing the former when the latter is now thought of as a better idea

&gt;<i> &gt; Moving it to the new logging would, at very least, let me trivially write an
</I>&gt;<i> &gt; observer which throws away these by module.
</I>&gt;<i>
</I>&gt;<i> No need to write one!  This is an explicit use-case for new logging: see
</I>&gt;<i> <A HREF="https://twistedmatrix.com/documents/16.2.0/api/twisted.logger.LogLevelFilterPredicate.html">https://twistedmatrix.com/documents/16.2.0/api/twisted.logger.LogLevelFilterPredicate.html</A>
</I>&gt;<i> and
</I>&gt;<i> <A HREF="https://twistedmatrix.com/documents/16.2.0/api/twisted.logger.FilteringLogObserver.html">https://twistedmatrix.com/documents/16.2.0/api/twisted.logger.FilteringLogObserver.html</A>
</I>&gt;<i>
</I>&gt;<i> (You may also be interested in figuring out a solution to
</I>&gt;<i> <A HREF="https://twistedmatrix.com/trac/ticket/7969">https://twistedmatrix.com/trac/ticket/7969</A> )
</I>
That looks like an interesting and worthwhile challenge, but first a
little practice porting the basics to the new logger

&gt;<i> Does anyone have an example ticket/commit for a conversion to the new
</I>&gt;<i> logging showing the general style, and the technique used for writing tests
</I>&gt;<i> for that?
</I>
This is what I came up with while trying to get twistd related
messages all emitted through new logger and thus not have [-] in
standard textual log:
  <A HREF="https://github.com/twisted/twisted/compare/bb0d1d67...dansut:logger-update">https://github.com/twisted/twisted/compare/bb0d1d67...dansut:logger-update</A>
Probably did some really daft stuff here but comments appreciated on
my forks branch to get me working in a way which will be acceptable
for PRs in future.

&gt;<i> twistd itself was converted over -
</I>&gt;<i> <A HREF="https://twistedmatrix.com/trac/ticket/8235">https://twistedmatrix.com/trac/ticket/8235</A> - but of course that's mostly
</I>&gt;<i> from the consumer side rather than emitting logs.
</I>
That's where I found use of _loggerFor ...

&gt;<i> It shouldn't be too complex, honestly; just get rid of all manual string
</I>&gt;<i> formatting, and convert any %()s format strings to {}.
</I>
That side of things is pretty clear, there are a few places where
longer strings are being logged that might be questionable, and a
bunch of places where utility function log.callWithLogger is used that
I'm not sure how to handle.

&gt;<i> The testing support is the same as for the old logging system (add a global
</I>&gt;<i> observer, remove it in an addCleanup, assert about the things it caught)
</I>&gt;<i> because it's still just key-value pairs, they're just better-defined now.
</I>
Any chance of a pointer to a good clear example to emulate?

Also still trying to get my head around whether there should be one
Trac ticket to cover all logger porting effort, or individual tickets
for each porting effort.

Sorry for being such a newb, all help and pointers appreciated.
Cheers
/dan
-- 
Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062882.html">[Twisted-Python] Style/testing for log-related changes
</A></li>
	<LI>Next message (by thread): <A HREF="030422.html">[Twisted-Python] buildbot is back
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62945">[ date ]</a>
              <a href="thread.html#62945">[ thread ]</a>
              <a href="subject.html#62945">[ subject ]</a>
              <a href="author.html#62945">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
