<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] R: Re: smtp-server: issue with checkers.FilePasswordDB and hash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20R%3A%20Re%3A%20smtp-server%3A%20issue%20with%0A%20checkers.FilePasswordDB%20and%20hash&In-Reply-To=2762000.301081270473739324.JavaMail.defaultUser%40defaultHost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021968.html">
   <LINK REL="Next"  HREF="021973.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] R: Re: smtp-server: issue with checkers.FilePasswordDB and hash</H1>
    <B>Lucas Taylor</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20R%3A%20Re%3A%20smtp-server%3A%20issue%20with%0A%20checkers.FilePasswordDB%20and%20hash&In-Reply-To=2762000.301081270473739324.JavaMail.defaultUser%40defaultHost"
       TITLE="[Twisted-Python] R: Re: smtp-server: issue with checkers.FilePasswordDB and hash">ltaylor.volks at gmail.com
       </A><BR>
    <I>Tue Apr  6 05:31:36 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021968.html">[Twisted-Python] R: Re: smtp-server: issue with checkers.FilePasswordDB and hash
</A></li>
        <LI>Next message: <A HREF="021973.html">[Twisted-Python] R: Re: smtp-server: issue	with	checkers.FilePasswordDB and hash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21970">[ date ]</a>
              <a href="thread.html#21970">[ thread ]</a>
              <a href="subject.html#21970">[ subject ]</a>
              <a href="author.html#21970">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/5/10 6:22 AM, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">aleuser at inwind.it</A> wrote:
&gt;<i> 
</I>&gt;&gt;<i> If your passwords are already hashed before they are sent to the server
</I>&gt;&gt;<i> for authentication, then there is no need for a hash function.
</I>&gt;&gt;<i> FilePasswordDB will accept either IUsernamePassword or
</I>&gt;&gt;<i> IUsernameHashedPassword credentials.
</I>&gt;<i> 
</I>&gt;<i> I want to hash the password on the server; can't I? How I can decide to use a 
</I>&gt;<i> simple IUsernamePassword?
</I>&gt;<i> 
</I>&gt;<i> however If I don't use the hash function the connection still continue to use 
</I>&gt;<i> an IUsernameHashedPassword.
</I>&gt;<i> Probably the smtp connection is not made for a plain-text password, isn't it?
</I>&gt;<i> 
</I>
It sounds to me like you want the server to support PLAIN auth but still
compare against a hashed password file? The ESMTP factory you are using
only provides CRAM-MD5 auth via credentials.

<A HREF="http://twistedmatrix.com/trac/browser/trunk/twisted/mail/protocols.py#L132">http://twistedmatrix.com/trac/browser/trunk/twisted/mail/protocols.py#L132</A>

CramMD5Credentials implements IUsernameHashedPassword, so it won't work
with a FilePasswordDB checker that has a hash function. This is the
source of your error message.

You can add PLAIN support by adding credentials that provide
IUsernamePassword. The imap4 implementation has one (PLAINCredentials):

...
from twisted.mail import imap4
smtpserver = mailservice.getESMTPFactory()
smtpserver.challengers['PLAIN'] = imap4.PLAINCredentials
application = service.Application(&quot;Console SMTP Server&quot;)
...

Clients using CRAM-MD5 will still fail with the same error, though. You
could create your own checker which differentiates how it checks based
on the provided credentials interface. You would start by subclassing
FilePasswordDB and override the requestAvatarId method. If the
credentials interface is IUsernameHashedPassword, just skip over the
hash function. Here's an example based on yours:
<A HREF="http://gist.github.com/357396">http://gist.github.com/357396</A>





</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021968.html">[Twisted-Python] R: Re: smtp-server: issue with checkers.FilePasswordDB and hash
</A></li>
	<LI>Next message: <A HREF="021973.html">[Twisted-Python] R: Re: smtp-server: issue	with	checkers.FilePasswordDB and hash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21970">[ date ]</a>
              <a href="thread.html#21970">[ thread ]</a>
              <a href="subject.html#21970">[ subject ]</a>
              <a href="author.html#21970">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
