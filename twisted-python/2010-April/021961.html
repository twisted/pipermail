<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] FUSE
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20FUSE&In-Reply-To=h2u634095dc1004032021rdc403864v74c236f7487203c1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021959.html">
   <LINK REL="Next"  HREF="021962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] FUSE</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20FUSE&In-Reply-To=h2u634095dc1004032021rdc403864v74c236f7487203c1%40mail.gmail.com"
       TITLE="[Twisted-Python] FUSE">exarkun at twistedmatrix.com
       </A><BR>
    <I>Sun Apr  4 08:46:39 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021959.html">[Twisted-Python] FUSE
</A></li>
        <LI>Next message: <A HREF="021962.html">[Twisted-Python] FUSE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21961">[ date ]</a>
              <a href="thread.html#21961">[ thread ]</a>
              <a href="subject.html#21961">[ subject ]</a>
              <a href="author.html#21961">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03:21 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">donal.mcmullan at gmail.com</A> wrote:
&gt;<i>I'm interested in doing some FUSE stuff with Twisted, mostly to
</I>&gt;<i>prototype some ideas for profiling. Can anyone expand on Glyph's
</I>&gt;<i>comment [1]:
</I>&gt;<i>
</I>&gt;<i>8&lt; - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</I>&gt;<i>The Python FUSE bindings obscure the issue because, unlike the C
</I>&gt;<i>libfuse, they assume that your filesystem I/O is blocking, which
</I>&gt;<i>severely limits the performance of python-based filesystems. &#160;(You
</I>&gt;<i>cannot receive more requests for I/O in your filesystem until the
</I>&gt;<i>previous one has been completed with the pyfuse bindings, but you can 
</I>&gt;<i>in
</I>&gt;<i>C.)
</I>&gt;<i>8&lt; - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</I>&gt;<i>
</I>&gt;<i>I guess I'd like to know before I sink too much time into this, if
</I>&gt;<i>there's an approach to Fuse/Twisted that would not have this
</I>&gt;<i>limitation. This is a bit confused by the fact that there are three
</I>&gt;<i>Fuse/Python bindings that I'm aware of: FusePython, FusePy, and S3QL
</I>&gt;<i>[2].
</I>&gt;<i>
</I>&gt;<i><A HREF="http://sourceforge.net/apps/mediawiki/fuse/index.php?title=FusePython">http://sourceforge.net/apps/mediawiki/fuse/index.php?title=FusePython</A>
</I>&gt;<i><A HREF="http://code.google.com/p/fusepy/">http://code.google.com/p/fusepy/</A>
</I>&gt;<i><A HREF="http://code.google.com/p/s3ql/">http://code.google.com/p/s3ql/</A>
</I>&gt;<i>
</I>&gt;<i>If you've already been down this road, it'd be good to hear from you.
</I>
So, sitting at the bottom of libfuse is a file descriptor.  The kernel 
asks your process to service some filesystem operation by putting bytes 
into it that your process can read.  Your process services the requests 
by putting bytes into it that the kernel can read.

Each request/response pair is tagged, so there's no requirement that 
requests be responded to in the same order they're received.

A good Twisted-based solution would use the reactor to read and write 
that file descriptor (alongside anything else going on in the process) 
and support Deferreds (or at least asynchronous responses) to allow out- 
of-order responses and concurrent request handling.

I played around with fuse a little bit to implement something like sshfs 
a while ago.  I did _not_ use the approach described above, because it 
was easier to use something from Armin Rigo's sandbox in a thread, 
dispatching request handling into Twisted, to achieve the necessary 
concurrency and so forth.  You can find that code here:

<A HREF="http://twistedmatrix.com/trac/browser/sandbox/exarkun/sshfs.py?rev=26941">http://twistedmatrix.com/trac/browser/sandbox/exarkun/sshfs.py?rev=26941</A>

It's just something I was messing around with.  I'm sure you'll find 
lots of problems with it (I know of at least one).  It might help with 
part of the general idea, though.  To get rid of the use of threads 
(which is a good idea for a real tool), you just need to port Armin's 
parsing code into a Twisted Protocol class and hook it up to a 
FileDescriptor of some sort that reads and writes the fuse fd.

Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021959.html">[Twisted-Python] FUSE
</A></li>
	<LI>Next message: <A HREF="021962.html">[Twisted-Python] FUSE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21961">[ date ]</a>
              <a href="thread.html#21961">[ thread ]</a>
              <a href="subject.html#21961">[ subject ]</a>
              <a href="author.html#21961">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
