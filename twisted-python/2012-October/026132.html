<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] getpeername from verify callback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20getpeername%20from%20verify%20callback&In-Reply-To=E4153B5C-F891-4F7A-9614-B1F4A43C059C%40securitymetrics.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026131.html">
   <LINK REL="Next"  HREF="026135.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] getpeername from verify callback</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20getpeername%20from%20verify%20callback&In-Reply-To=E4153B5C-F891-4F7A-9614-B1F4A43C059C%40securitymetrics.com"
       TITLE="[Twisted-Python] getpeername from verify callback">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Oct 19 02:28:53 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="026131.html">[Twisted-Python] getpeername from verify callback
</A></li>
        <LI>Next message: <A HREF="026135.html">[Twisted-Python] getpeername from verify callback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26132">[ date ]</a>
              <a href="thread.html#26132">[ thread ]</a>
              <a href="subject.html#26132">[ subject ]</a>
              <a href="author.html#26132">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Oct 18, 2012, at 9:41 PM, Nathan Mower &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nathanm at securitymetrics.com</A>&gt; wrote:

&gt;<i> The following sample code worked until Twisted began to prefer memory BIOs over socket BIOs.  Now it produces this error...
</I>&gt;<i> 
</I>&gt;<i> exceptions.AttributeError: 'NoneType' object has no attribute 'getpeername'
</I>&gt;<i> 
</I>&gt;<i> ...on line 9 where getpeername() is called by the verify() callback.
</I>&gt;<i> 
</I>&gt;<i> Is there any way to obtain the peer name, given the OpenSSL.SSL.Connection object passed into verify()?  Anything that surfaces the underlying socket?  (Perhaps something similar to what is done in connectionMade(), which does work.)  Or alternatively, is there a way to tell the reactor to employ socket BIOs?
</I>
The 'socket' attribute that you're accessing is not a documented attribute of ITransport, so in a way I'm glad that your code broke - this wasn't a valid way to use Twisted in the first place :).  See &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITransport.html">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITransport.html</A>&gt;.

Now, as it happens, &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.protocols.tls.TLSMemoryBIOProtocol.html">http://twistedmatrix.com/documents/current/api/twisted.protocols.tls.TLSMemoryBIOProtocol.html</A>&gt; implements &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ISSLTransport.html">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ISSLTransport.html</A>&gt; which is a subinterface of &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITCPTransport.html">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITCPTransport.html</A>&gt;, which is therefore guaranteed to have a getPeer method &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITCPTransport.html#getPeer">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITCPTransport.html#getPeer</A>&gt; that returns an IPv4Address &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.address.IPv4Address.html">http://twistedmatrix.com/documents/current/api/twisted.internet.address.IPv4Address.html</A>&gt; or IPv6Address &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.address.IPv6Address.html">http://twistedmatrix.com/documents/current/api/twisted.internet.address.IPv6Address.html</A>&gt;, both of which have a 'host' attribute that is the hostname.

So, in short, substitute &quot;self.transport.getPeer().host&quot; and your code should work again.

-glyph


</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026131.html">[Twisted-Python] getpeername from verify callback
</A></li>
	<LI>Next message: <A HREF="026135.html">[Twisted-Python] getpeername from verify callback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26132">[ date ]</a>
              <a href="thread.html#26132">[ thread ]</a>
              <a href="subject.html#26132">[ subject ]</a>
              <a href="author.html#26132">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
