<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Running twistd and tac files as Windows service
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Running%20twistd%20and%20tac%20files%20as%20Windows%20service&In-Reply-To=%3C20121023114119.4518.813400477.divmod.xquotient.28%40localhost6.localdomain6%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058660.html">
   <LINK REL="Next"  HREF="058671.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Running twistd and tac files as Windows service</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Running%20twistd%20and%20tac%20files%20as%20Windows%20service&In-Reply-To=%3C20121023114119.4518.813400477.divmod.xquotient.28%40localhost6.localdomain6%3E"
       TITLE="[Twisted-Python] Running twistd and tac files as Windows service">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Oct 23 05:41:19 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058660.html">[Twisted-Python] Running twistd and tac files as Windows service
</A></li>
        <LI>Next message (by thread): <A HREF="058671.html">[Twisted-Python] Running twistd and tac files as Windows service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58665">[ date ]</a>
              <a href="thread.html#58665">[ thread ]</a>
              <a href="subject.html#58665">[ subject ]</a>
              <a href="author.html#58665">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08:23 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">johnaherne at rocs.co.uk</A> wrote:
&gt;<i>I have been looking at running some twisted programs as a windows 
</I>&gt;<i>service.
</I>&gt;<i>
</I>&gt;<i>So in the end I took a copy of twistd.py and adapted it to load my tac 
</I>&gt;<i>file
</I>&gt;<i>and run it as a windows service.
</I>&gt;<i>
</I>&gt;<i>Of course the windows service will run it in a separate thread.
</I>&gt;<i>
</I>&gt;<i>I now have it running on XP, 2003 Server Twisted 10 and 12 and it all
</I>&gt;<i>seemed fine.
</I>
To start off with, I'll point out that this isn't a supported mode of 
running Twisted (which I'm sure you noticed already :).

This feature has been requested several times and worked on by a couple 
people, but not quite to the point of completion.

Here's a related ticket:

    <A HREF="http://twistedmatrix.com/trac/ticket/4073">http://twistedmatrix.com/trac/ticket/4073</A>

There's also some more code in the sandbox:

    <A HREF="http://twistedmatrix.com/trac/browser/sandbox/moonfallen">http://twistedmatrix.com/trac/browser/sandbox/moonfallen</A>

BuildBot also has some code, though I'm not exactly sure where it is. 
It would be really great for someone to actually complete and generalize 
one or more of these initial attempts so that Windows service 
integration could be a real, working feature. :)
&gt;<i>However when I install it on Windows 7 I get an error
</I>&gt;<i>
</I>&gt;<i>2012-10-23 07:54:49+0100 [-] Unhandled Error
</I>&gt;<i>Traceback (most recent call last):
</I>&gt;<i>  File &quot;C:\Python27\lib\site-packages\twisted\internet\base.py&quot;, line 
</I>&gt;<i>413,
</I>&gt;<i>in fireEvent
</I>&gt;<i>    DeferredList(beforeResults).addCallback(self._continueFiring)
</I>&gt;<i>  File &quot;C:\Python27\lib\site-packages\twisted\internet\defer.py&quot;, line 
</I>&gt;<i>297,
</I>&gt;<i>in addCallback
</I>&gt;<i>    callbackKeywords=kw)
</I>&gt;<i>  File &quot;C:\Python27\lib\site-packages\twisted\internet\defer.py&quot;, line 
</I>&gt;<i>286,
</I>&gt;<i>in addCallbacks
</I>&gt;<i>    self._runCallbacks()
</I>&gt;<i>  File &quot;C:\Python27\lib\site-packages\twisted\internet\defer.py&quot;, line 
</I>&gt;<i>542,
</I>&gt;<i>in _runCallbacks
</I>&gt;<i>    current.result = callback(current.result, *args, **kw)
</I>&gt;<i>--- &lt;exception caught here&gt; ---
</I>&gt;<i>  File &quot;C:\Python27\lib\site-packages\twisted\internet\base.py&quot;, line 
</I>&gt;<i>426,
</I>&gt;<i>in _continueFiring
</I>&gt;<i>    callable(*args, **kwargs)
</I>&gt;<i>  File &quot;C:\Python27\lib\site-packages\twisted\internet\base.py&quot;, line 
</I>&gt;<i>1153,
</I>&gt;<i>in _reallyStartRunning
</I>&gt;<i>    self._handleSignals()
</I>&gt;<i>  File &quot;C:\Python27\lib\site-packages\twisted\internet\posixbase.py&quot;, 
</I>&gt;<i>line
</I>&gt;<i>277, in _handleSignals
</I>&gt;<i>    _SignalReactorMixin._handleSignals(self)
</I>&gt;<i>  File &quot;C:\Python27\lib\site-packages\twisted\internet\base.py&quot;, line 
</I>&gt;<i>1118,
</I>&gt;<i>in _handleSignals
</I>&gt;<i>    signal.signal(signal.SIGINT, self.sigInt)
</I>&gt;<i>exceptions.ValueError: signal only works in main thread
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Looking around it would seem I need to tell the reactor
</I>&gt;<i>'installsignalhandlers=0'. I am not sure if I should do this with 
</I>&gt;<i>windows
</I>&gt;<i>or not.
</I>
Yes, you'll need to do that.  It probably won't even break child process 
support (although other aspects of Windows services probably will). 
Notice it's failing on installing a SIGINT handler - ie, a Control-C 
handler.  Since you want the thing to run as a service, you probably 
aren't very interested in having Control-C do anything.

Jean-Paul
&gt;<i>Has anyone got twistd.py to run as a service on windows because I would 
</I>&gt;<i>be
</I>&gt;<i>glad to know what other people have done to solve the problem.
</I>&gt;<i>
</I>&gt;<i>Thanks for any info.
</I>&gt;<i>
</I>&gt;<i>*John Aherne*
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058660.html">[Twisted-Python] Running twistd and tac files as Windows service
</A></li>
	<LI>Next message (by thread): <A HREF="058671.html">[Twisted-Python] Running twistd and tac files as Windows service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58665">[ date ]</a>
              <a href="thread.html#58665">[ thread ]</a>
              <a href="subject.html#58665">[ subject ]</a>
              <a href="author.html#58665">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
