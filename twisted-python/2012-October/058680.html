<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] a possible solution for ticket 5562
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20a%20possible%20solution%20for%20ticket%205562&In-Reply-To=%3CCABkOF6ROagF682mg-4eRCge-XiLY7HuZrRcby-AEFZChTstLow%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058631.html">
   <LINK REL="Next"  HREF="058681.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] a possible solution for ticket 5562</H1>
    <B>gelin yan</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20a%20possible%20solution%20for%20ticket%205562&In-Reply-To=%3CCABkOF6ROagF682mg-4eRCge-XiLY7HuZrRcby-AEFZChTstLow%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] a possible solution for ticket 5562">dynamicgl at gmail.com
       </A><BR>
    <I>Wed Oct 24 21:48:31 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058631.html">[Twisted-Python] a possible solution for ticket 5562
</A></li>
        <LI>Next message (by thread): <A HREF="058681.html">[Twisted-Python] a possible solution for ticket 5562
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58680">[ date ]</a>
              <a href="thread.html#58680">[ thread ]</a>
              <a href="subject.html#58680">[ subject ]</a>
              <a href="author.html#58680">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Oct 22, 2012 at 12:06 PM, Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On Oct 20, 2012, at 7:56 PM, gelin yan &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dynamicgl at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &quot;A pending operation is indicated when the function that started the
</I>&gt;<i> operation returns *FALSE*, and the *GetLastError*&lt;<A HREF="http://msdn.microsoft.com/en-us/library/windows/desktop/ms679360(v=vs.85">http://msdn.microsoft.com/en-us/library/windows/desktop/ms679360(v=vs.85</A>).aspx&gt; function
</I>&gt;<i> returns *ERROR_IO_PENDING*. When an I/O operation is pending, the
</I>&gt;<i> function that started the operation resets the *hEvent* member of the *
</I>&gt;<i> OVERLAPPED* structure to the nonsignaled state. Then when the pending
</I>&gt;<i> operation has been completed, the system sets the event object to the
</I>&gt;<i> signaled state.&quot;
</I>&gt;<i>
</I>&gt;<i>   If we can know when event object is in the signaled state we definitely
</I>&gt;<i> can use a queue directly. Any idea?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sounds like you're at the point where you should just try doing an
</I>&gt;<i> implementation, and if it works and passes all the tests you can think of
</I>&gt;<i> for it, submit it for code review.  Much more speculation without testing
</I>&gt;<i> wouldn't be useful.
</I>&gt;<i>
</I>&gt;<i> Thanks for working on this!
</I>&gt;<i>
</I>&gt;<i> -glyph
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>Hi All

   Sorry for coming late. The day before yesterday, I dig out what happen
in that code. Actually, ERROR_IO_PENDING isn't the root of problem. The
problem is doWrite method might be triggered twice instead of once; in
particular, when trying to send a large chunks data whose size is bigger
then SEND_LIMIT, it will always happen.

    When doWrite being invoked twice, it means the same buffer data will be
sent twice. It is for sure that PB is unable to deserialize  these data and
finally it raise an exception, now, we can see connection lost.

    The solution is to make sure doWrite calling in order; hence I
introduce a new field named _doWriteCalling to detect whether doWrite call
is completed. (due to doWrite always post an event to IOCP, so once
_cbWrite get called, it means we can schedule another doWrite). If _cbWrite
isn't called, we simply re-schedule the doWrite by reactor.callLater.

    I attach a modified abstract.py here. You may put it in
 Path\twisted\internet\iocpreactor
and give it a try.

Regards

gelin yan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20121025/2733f86f/attachment.html&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: abstract.py
Type: application/octet-stream
Size: 13358 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20121025/2733f86f/attachment-0002.obj&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058631.html">[Twisted-Python] a possible solution for ticket 5562
</A></li>
	<LI>Next message (by thread): <A HREF="058681.html">[Twisted-Python] a possible solution for ticket 5562
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58680">[ date ]</a>
              <a href="thread.html#58680">[ thread ]</a>
              <a href="subject.html#58680">[ subject ]</a>
              <a href="author.html#58680">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
