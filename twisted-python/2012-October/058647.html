<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Adding mock as a test suite dependency
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Adding%20mock%20as%20a%20test%20suite%20dependency&In-Reply-To=%3CCABJQSknsdS9G36_rhi%2B3VyRaTaogjYtaMaOAhJhtPORUCpDjtg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058643.html">
   <LINK REL="Next"  HREF="058635.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Adding mock as a test suite dependency</H1>
    <B>Julian Berman</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Adding%20mock%20as%20a%20test%20suite%20dependency&In-Reply-To=%3CCABJQSknsdS9G36_rhi%2B3VyRaTaogjYtaMaOAhJhtPORUCpDjtg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Adding mock as a test suite dependency">julian at grayvines.com
       </A><BR>
    <I>Mon Oct 22 12:58:52 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058643.html">[Twisted-Python] Adding mock as a test suite dependency
</A></li>
        <LI>Next message (by thread): <A HREF="058635.html">[Twisted-Python] Managing twisted application as init service.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58647">[ date ]</a>
              <a href="thread.html#58647">[ thread ]</a>
              <a href="subject.html#58647">[ subject ]</a>
              <a href="author.html#58647">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>

&gt;<i> Subject: Re: [Twisted-Python] Adding mock as a test suite dependency
</I>&gt;<i>
</I>&gt;<i> On 03:00 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
</I>&gt;<i> &gt;Also I don't particularly like the testing style associated with Mock.
</I>&gt;<i> &gt;I think it might discourage us yet further from writing verified fakes,
</I>&gt;<i> &gt;i.e. supported in-memory implementations of things like IReactorTCP,
</I>&gt;<i> &gt;that have somewhat intricate behavior that's tedious to emulate with
</I>&gt;<i> &gt;Mock.
</I>&gt;<i>
</I>&gt;<i> I'm also not a huge fan of the *unverified* mock style of testing.  I
</I>&gt;<i> don't think anything says that mocks *have* to be unverified, though it
</I>&gt;<i> seems they're often used that way.
</I>&gt;<i>
</I>&gt;<i> The mock library that got added to the stdlib has the notion of
</I>&gt;<i> constructing a mock using another object as a template.  I haven't used
</I>&gt;<i> this feature, but it seems like the intent is to at least take a step
</I>&gt;<i> towards verification.  It'd be nice if someone who knows more about the
</I>&gt;<i> features of this library could give some examples.
</I>&gt;<i>
</I>&gt;<i> In case anyone isn't clear, the problem with unverified fakes is that
</I>&gt;<i> they either start out incompatible with the objects they're fakes of, or
</I>&gt;<i> else they become incompatible with them over time.  Once they're
</I>&gt;<i> incompatible, the tests that use them become significantly less useful,
</I>&gt;<i> since they demonstrate little or nothing about what will happen when you
</I>&gt;<i> try to use the code for real.
</I>&gt;<i>
</I>&gt;<i> Verified fakes solve this problem by adding assertions that objects and
</I>&gt;<i> their fakes have the necessary overlap in either interface or
</I>&gt;<i> functionality in order for the tests using them to be valid.
</I>&gt;<i>
</I>&gt;<i> Beyond that, considering the particular example presented, I wouldn't
</I>&gt;<i> actually use mocks to test this.  The real object, the debugger, should
</I>&gt;<i> be perfectly usable in unit tests.  It doesn't allocate or depend on
</I>&gt;<i> expensive resources, it doesn't do network I/O, etc.  Mocks are perhaps
</I>&gt;<i> an attractive nuisance that distract from coming up with a better test.
</I>&gt;<i>
</I>&gt;<i>
</I>Well it seems I sidestepped behavior vs. state but fell into isolationist
vs integration :).

The reason I think even this was a reasonable example is because in the
code that this
will test, there is no dependence on an actual debugger whatsoever. What
this test should
be testing is that an object whose interface is irrelevant for the purpose
of the test was
handed off to another method in the case that that is expected.

In short, the isolationist view as I understand and have come to appreciate
says that
mocks (in a broader sense here since these aren't true mocks I guess)
aren't just for
cases where the real object is expensive or annoying to create â€“ they also
remove
irrelevant details from the body of the test.

That being said though, I'm still looking (read: I have not yet looked but
will do so when I
get home) for actual examples in the test suite I can point to and say that
real, actual mocks
would have helped if that's what you'd be looking for.

To go back to your first point about verification, mock has a bunch of
things there of which
if I'm truthful I only use some of them with any regularity. The thing that
sounds like what
you're referring to is likely the `spec` argument, which will do something
like:

&gt;&gt;&gt;<i> import mock
</I>&gt;&gt;&gt;<i> from twisted.trial.itrial import ITestCase
</I>&gt;&gt;&gt;<i> testCase = mock.Mock(spec=ITestCase.names())
</I>&gt;&gt;&gt;<i> testCase.run
</I>&lt;Mock name='mock.run' id='4319309392'&gt;
&gt;&gt;&gt;<i> testCase.jump
</I>Traceback (most recent call last):
  File &quot;&lt;input&gt;&quot;, line 1, in &lt;module&gt;
  File
&quot;/usr/local/Cellar/python/2.7.3/lib/python2.7/site-packages/mock.py&quot;, line
647, in __getattr__
    raise AttributeError(&quot;Mock object has no attribute %r&quot; % name)
AttributeError: Mock object has no attribute 'jump'


As someone mentioned you also can hand it an implementor of ITestCase too
but it will then pull
off all attributes that that object has.

There's plenty more granularity, but like anything else the design of the
test requires common sense.
If the test is meant to test how a specific method on the testCase mock is
being used then assertions
on how it was called generally seem most natural.

As an alternate approach, I've learned (from a few places I think) that in
cases where I want to verify
that the places I've mocked are being used in a way that isn't going to
differ from their actual use in the
code, that a much wider scoped test that does integrate but doesn't need to
be a unit test can be helpful,
such that there are a whole bunch of isolated tests for each piece of logic
and then one integrated test
that actually does push the real object through such that anyone who does
change the way that the two
objects interacts still will have something telling them that the tests
need updating as they would if all of
the tests integrated.

Jean-Paul
&gt;<i> &gt;Personally I'm -0.  Don't let that stop you from cooking up a patch
</I>&gt;<i> &gt;that would include it though, I might be in the minority here.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;-glyph
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20121022/da9e244d/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058643.html">[Twisted-Python] Adding mock as a test suite dependency
</A></li>
	<LI>Next message (by thread): <A HREF="058635.html">[Twisted-Python] Managing twisted application as init service.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58647">[ date ]</a>
              <a href="thread.html#58647">[ thread ]</a>
              <a href="subject.html#58647">[ subject ]</a>
              <a href="author.html#58647">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
