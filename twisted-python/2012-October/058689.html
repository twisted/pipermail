<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Avoiding network when testing Perspective	Broker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Avoiding%20network%20when%20testing%20Perspective%0A%09Broker&In-Reply-To=%3CBEE992E2-058B-4307-9A36-07364E8F626B%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058688.html">
   <LINK REL="Next"  HREF="058690.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Avoiding network when testing Perspective	Broker</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Avoiding%20network%20when%20testing%20Perspective%0A%09Broker&In-Reply-To=%3CBEE992E2-058B-4307-9A36-07364E8F626B%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Avoiding network when testing Perspective	Broker">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Oct 25 16:32:30 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058688.html">[Twisted-Python] Avoiding network when testing Perspective	Broker
</A></li>
        <LI>Next message (by thread): <A HREF="058690.html">[Twisted-Python] Avoiding network when testing Perspective	Broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58689">[ date ]</a>
              <a href="thread.html#58689">[ thread ]</a>
              <a href="subject.html#58689">[ subject ]</a>
              <a href="author.html#58689">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 25, 2012, at 2:22 PM, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:

&gt;<i> On 09:18 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">lacrima.maxim at gmail.com</A> wrote:
</I>&gt;&gt;<i> Hi!
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I am learning to develop TDD way. I want to create a server that
</I>&gt;<i> 
</I>&gt;<i> Hooray!
</I>
Yes, hooray!  I wish that everyone did this.  Sorry that you've encountered trouble; I very much hope you will stick with this and help us make the process for doing TDD on PB (and generally, Twisted) applications much easier.

&gt;&gt;<i> understands PB protocol. Initially I thought it would be a good idea to
</I>&gt;&gt;<i> avoid real network connections in my tests, so I tried to use
</I>&gt;<i> 
</I>&gt;<i> Yes, that's definitely what you want to do.
</I>&gt;&gt;<i> `proto_helpers.StringTransport`:
</I>&gt;<i> 
</I>&gt;<i> StringTransport is frequently what you want in order to test a protocol 
</I>&gt;<i> implementation, so you're on the right track.
</I>&gt;<i> 
</I>&gt;<i> Except... actually you're not implementing a protocol.  You're *using* a 
</I>&gt;<i> protocol implementation that exists already and has its own unit tests.
</I>&gt;<i> 
</I>&gt;<i> It would be better if you found a way to test your code without 
</I>&gt;<i> involving the PB protocol implementation or StringTransport.  However, I 
</I>&gt;<i> admit that the tools for doing this with PB are almost non-existent.  On 
</I>&gt;<i> the other hand, application code written for use with AMP is much more 
</I>&gt;<i> amenable to testing.
</I>&gt;<i> 
</I>&gt;<i> Just something to think about.
</I>
While I agree with everything exarkun has said here, I think we should note that using StringTransport is basically the state of the art in protocol testing at this point.  It's unfortunate that we don't have anything better, but you shouldn't feel the need to go scouring the code base for a good example or a testing utility that you've missed; unless it's immediately obvious to you how to remove byte-level parsing from the equation, this is just an area that Twisted needs to work on.

&gt;<i> So far so good.  You made a factory, got it to make you a protocol, and 
</I>&gt;<i> hooked the protocol up to a StringTransport you made.  That's all good 
</I>&gt;<i> stuff.
</I>
I'm curious, since we rarely get to see the positive impact of documentation, and only hear about it when it didn't exist - did you discover this testing style from <A HREF="http://twistedmatrix.com/documents/current/core/howto/trial.html#auto5">http://twistedmatrix.com/documents/current/core/howto/trial.html#auto5</A> ? :)

&gt;<i> Instead, you should probably use the PB client API (ie, PBClientFactory 
</I>&gt;<i> and what comes out of it) to interact with this server.  Let the PB 
</I>&gt;<i> client implementation figure out what bytes to &quot;send&quot; to your server.
</I>
To be clear, you should use PBClientFactory in the same way you've been these other abstractions: create it with a string transport, don't hook it up to any sockets or anything.

There are three (count them, three!) classes called &quot;IOPump&quot; in various Twisted test-support modules.  Please note that unlike the stuff in proto_helpers these are not supported and will likely go away in a future version of Twisted.  However, they do provide a simple demonstration of how to hook up a client and server (calling dataReceived() with what transport.write() produced).

If you'd like to help Twisted itself, we could really use a patch that cleans up all three of those implementations of IOPump, tests them, documents them, and exposes them in a way that would be beneficial to those writing tests like yours.

Thanks for doing TDD,

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20121025/609f6436/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058688.html">[Twisted-Python] Avoiding network when testing Perspective	Broker
</A></li>
	<LI>Next message (by thread): <A HREF="058690.html">[Twisted-Python] Avoiding network when testing Perspective	Broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58689">[ date ]</a>
              <a href="thread.html#58689">[ thread ]</a>
              <a href="subject.html#58689">[ subject ]</a>
              <a href="author.html#58689">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
