<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] getpeername from verify callback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20getpeername%20from%20verify%20callback&In-Reply-To=2250F78E-EF68-475E-8F62-0C319B67CB54%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026139.html">
   <LINK REL="Next"  HREF="026133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] getpeername from verify callback</H1>
    <B>Nathan Mower</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20getpeername%20from%20verify%20callback&In-Reply-To=2250F78E-EF68-475E-8F62-0C319B67CB54%40twistedmatrix.com"
       TITLE="[Twisted-Python] getpeername from verify callback">nathanm at securitymetrics.com
       </A><BR>
    <I>Fri Oct 19 03:00:24 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="026139.html">[Twisted-Python] getpeername from verify callback
</A></li>
        <LI>Next message: <A HREF="026133.html">[Twisted-Python] getpeername from verify callback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26137">[ date ]</a>
              <a href="thread.html#26137">[ thread ]</a>
              <a href="subject.html#26137">[ subject ]</a>
              <a href="author.html#26137">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 19, 2012, at 12:28 AM, Glyph wrote:

&gt;<i> On Oct 18, 2012, at 9:41 PM, Nathan Mower &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nathanm at securitymetrics.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> The following sample code worked until Twisted began to prefer memory BIOs over socket BIOs.  Now it produces this error...
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> exceptions.AttributeError: 'NoneType' object has no attribute 'getpeername'
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ...on line 9 where getpeername() is called by the verify() callback.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Is there any way to obtain the peer name, given the OpenSSL.SSL.Connection object passed into verify()?  Anything that surfaces the underlying socket?  (Perhaps something similar to what is done in connectionMade(), which does work.)  Or alternatively, is there a way to tell the reactor to employ socket BIOs?
</I>&gt;<i> 
</I>&gt;<i> The 'socket' attribute that you're accessing is not a documented attribute of ITransport, so in a way I'm glad that your code broke - this wasn't a valid way to use Twisted in the first place :).  See &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITransport.html">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITransport.html</A>&gt;.
</I>&gt;<i> 
</I>&gt;<i> Now, as it happens, &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.protocols.tls.TLSMemoryBIOProtocol.html">http://twistedmatrix.com/documents/current/api/twisted.protocols.tls.TLSMemoryBIOProtocol.html</A>&gt; implements &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ISSLTransport.html">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ISSLTransport.html</A>&gt; which is a subinterface of &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITCPTransport.html">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITCPTransport.html</A>&gt;, which is therefore guaranteed to have a getPeer method &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITCPTransport.html#getPeer">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITCPTransport.html#getPeer</A>&gt; that returns an IPv4Address &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.address.IPv4Address.html">http://twistedmatrix.com/documents/current/api/twisted.internet.address.IPv4Address.html</A>&gt; or IPv6Address &lt;<A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.address.IPv6Address.html">http://twistedmatrix.com/documents/current/api/twisted.internet.address.IPv6Address.html</A>&gt;, both of which have a 'host' attribute that is the hostname.
</I>&gt;<i> 
</I>&gt;<i> So, in short, substitute &quot;self.transport.getPeer().host&quot; and your code should work again.
</I>
Remember, the real question is what to use in the verify() callback, where self is an instance of VerifyContextFactory, and connection is an instance of OpenSSL.SSL.Connection.  Any way to get the transport from there?

Nathan
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026139.html">[Twisted-Python] getpeername from verify callback
</A></li>
	<LI>Next message: <A HREF="026133.html">[Twisted-Python] getpeername from verify callback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26137">[ date ]</a>
              <a href="thread.html#26137">[ thread ]</a>
              <a href="subject.html#26137">[ subject ]</a>
              <a href="author.html#26137">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
