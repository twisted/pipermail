<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Consensus on how to handle &quot;MySQL server has	gone away&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Consensus%20on%20how%20to%20handle%20%22MySQL%20server%20has%0A%09gone%20away%22&In-Reply-To=CAMwUOs2V5N%3DT2GNrTkLfAVmsD6i4N6J3Mv2EryXYz49kpa7-TQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026112.html">
   <LINK REL="Next"  HREF="026110.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Consensus on how to handle &quot;MySQL server has	gone away&quot;</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Consensus%20on%20how%20to%20handle%20%22MySQL%20server%20has%0A%09gone%20away%22&In-Reply-To=CAMwUOs2V5N%3DT2GNrTkLfAVmsD6i4N6J3Mv2EryXYz49kpa7-TQ%40mail.gmail.com"
       TITLE="[Twisted-Python] Consensus on how to handle &quot;MySQL server has	gone away&quot;">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Oct  5 04:30:04 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="026112.html">[Twisted-Python] Consensus on how to handle &quot;MySQL server has gone away&quot;
</A></li>
        <LI>Next message: <A HREF="026110.html">[Twisted-Python] Consensus on how to handle &quot;MySQL server has gone away&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26115">[ date ]</a>
              <a href="thread.html#26115">[ thread ]</a>
              <a href="subject.html#26115">[ subject ]</a>
              <a href="author.html#26115">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Le Oct 4, 2012 &#224; 12:26 PM, E S &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">electric.or.sharp at gmail.com</A>&gt; a &#233;crit :

&gt;<i> On Wed, Oct 3, 2012 at 3:39 PM, Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Le Oct 3, 2012 &#224; 6:36 AM, Augusto Mecking Caringi &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">augustocaringi at gmail.com</A>&gt; a &#233;crit :
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Wed, Oct 3, 2012 at 8:27 AM, Itamar Turner-Trauring
</I>&gt;&gt;&gt;<i> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> On 10/03/2012 04:28 AM, Phil Mayers wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> I think the behaviour it should be aiming for is clear:
</I>&gt;&gt;&gt;&gt;&gt;<i> 1. Test each connection with &quot;good_sql&quot; before beginning the user
</I>&gt;&gt;&gt;&gt;&gt;<i> interaction/query
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> The problem is that this adds latency; this can add up to quite a
</I>&gt;&gt;&gt;&gt;<i> slowdown if your database server is on a remote server and you're doing
</I>&gt;&gt;&gt;&gt;<i> lots of single queries (as opposed to runInteraction).
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Hi!
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Sometime ago I faced some related problems and I found this code,
</I>&gt;&gt;&gt;<i> &quot;ReconnectingConnectionPool&quot;:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> <A HREF="http://www.gelens.org/2009/09/13/twisted-connectionpool-revisited/">http://www.gelens.org/2009/09/13/twisted-connectionpool-revisited/</A>
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> What are your opinion about it?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If there are bugs in Twisted, or important missing features, step 1 should be to file a bug &#8211; first, of course, searching for duplicates &#8211; at &lt;<A HREF="http://twistedmatrix.com/trac/newticket">http://twistedmatrix.com/trac/newticket</A>&gt;.  Especially if the workaround involves calling or overriding some private, internal implementation detail.  If you're going to blog about a hack that fixes the problem for you, that post should link to the ticket, so that Twisted can move forward and provide a good experience for people getting started with it.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I hate the idea that step 1 for some poor new Twisted user would be to go searching around a couple dozen external websites to apply undocumented hacks to try to just get something basic, like relational database communication, to work acceptably for their application.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> So, my opinion is that either this isn't a real problem, in which case you shouldn't use it, or it is a real problem, in which case Jeffrey Gelens and powdahound should open a ticket and explain why it's necessary :).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> -glyph
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>&gt;<i> Well, I did reference two bugs already in the twisted bug tracker that
</I>&gt;<i> I believe are related to this issue (4964 definitely is anyway).
</I>
Aah, I'm terribly sorry.  #4964 is indeed this exact issue; I missed the link.

&gt;<i> These issues have been in the bug tracking system for years now so I'm not holding my breath on fixes any time soon.
</I>
Well, someone who cares will then need to fix the issue for real :).

&gt;<i> I appreciate your desire to make twisted as good as it can be, but we all have schedules to meet and hacks, documented or not, are sometimes necessary to move the project along. So I definitely will consider input from people who have run into this situation and found a solution that has worked for them.
</I>
Of course.  But you should be aware that this is how issues remain open in the bug tracker for years - they only get fixed when people fix them :).

&gt;<i> If you're not convinced it's a real problem, it's pretty easy to recreate. Assuming your MySQL wait_timeout = 2, you can run the following code and get the (2006, 'MySQL server has gone away') error:
</I>
No, I'm perfectly convinced it's a real problem.  The description on #4964 was very helpful.

&gt;<i> 4. Man up and fix adbapi myself
</I>
While I might disagree with the wording, this is what I'd suggest :).

&gt;<i> I'm leaning towards #1 since it seems to be least invasive, but I am open to other opinions.
</I>
I think you may be overestimating the difficulty involved in just fixing the bug for real.  The conflict between schedule and fixing bugs in the right place - i.e. in Twisted - is that there is some waiting involved, not that fixing the bug is super hard.  You have to wait for a code review, then wait for a release.  But, assuming your fix is not terribly invasive, you can just do this:

Fix the bug.
Submit your fix for review.
While you're waiting, of course, you need to ship some software, so ship a modified copy of the modified module with your package and hot-patch it at runtime, assuming the fix is not already applied.  You can see examples of other projects (that I've worked on) doing that here:&lt;<A HREF="http://bazaar.launchpad.net/~divmod-dev/divmod.org/trunk/view/head:/Epsilon/epsilon/hotfix.py">http://bazaar.launchpad.net/~divmod-dev/divmod.org/trunk/view/head:/Epsilon/epsilon/hotfix.py</A>&gt; and here:&lt;<A HREF="http://trac.calendarserver.org/browser/CalendarServer/trunk/twext/patches.py">http://trac.calendarserver.org/browser/CalendarServer/trunk/twext/patches.py</A>&gt;.
Respond promptly to any review feedback, when it becomes available, and update your local copy.

When a new version of Twisted ships with the bug fixed, and you can update to depend on it, just delete your local copy.  Assuming that the final fix is reasonably close to the one that you implemented previously, even older versions of your software should keep working.

I hope you do elect to help out with this, we can always use more contributors :).

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20121005/b068496c/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20121005/b068496c/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026112.html">[Twisted-Python] Consensus on how to handle &quot;MySQL server has gone away&quot;
</A></li>
	<LI>Next message: <A HREF="026110.html">[Twisted-Python] Consensus on how to handle &quot;MySQL server has gone away&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26115">[ date ]</a>
              <a href="thread.html#26115">[ thread ]</a>
              <a href="subject.html#26115">[ subject ]</a>
              <a href="author.html#26115">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
