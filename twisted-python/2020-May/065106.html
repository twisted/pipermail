<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted and Thread, thread not running when twisted app is running as service
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20and%20Thread%2C%0A%20thread%20not%20running%20when%20twisted%20app%20is%20running%20as%20service&In-Reply-To=%3CCAEeXt4Py-vS9jU2rGASZyx2d2FQaSZmrDcsyBQNjuJEZPQZ%2BPQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065105.html">
   <LINK REL="Next"  HREF="065107.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted and Thread, thread not running when twisted app is running as service</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20and%20Thread%2C%0A%20thread%20not%20running%20when%20twisted%20app%20is%20running%20as%20service&In-Reply-To=%3CCAEeXt4Py-vS9jU2rGASZyx2d2FQaSZmrDcsyBQNjuJEZPQZ%2BPQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Twisted and Thread, thread not running when twisted app is running as service">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu May 21 14:19:15 MDT 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065105.html">[Twisted-Python] Twisted and Thread, thread not running when twisted app is running as service
</A></li>
        <LI>Next message (by thread): <A HREF="065107.html">[Twisted-Python] Twisted and Thread, thread not running when twisted app is running as service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65106">[ date ]</a>
              <a href="thread.html#65106">[ thread ]</a>
              <a href="subject.html#65106">[ subject ]</a>
              <a href="author.html#65106">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, May 21, 2020 at 3:56 PM Sereysethy TOUCH &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">touch.sereysethy at gmail.com</A>&gt;
wrote:

&gt;<i> Hi Jean-Paul,
</I>&gt;<i>
</I>&gt;<i> I found the error after working on a short, self contained, correcte
</I>&gt;<i> example. It is not about twisted and normal thread in general, but
</I>&gt;<i> something else.
</I>&gt;<i>
</I>&gt;<i> After more tests, I come to realise that whenever I instantiate this class
</I>&gt;<i> PolicyClient from this library
</I>&gt;<i> <A HREF="https://github.com/ray-project/ray/blob/master/rllib/env/policy_client.py">https://github.com/ray-project/ray/blob/master/rllib/env/policy_client.py</A> in
</I>&gt;<i> my protocol or just anywhere, twisted app either freezes or terminates, and
</I>&gt;<i> this *only* happens when the app runs as a daemon, created using a
</I>&gt;<i> service (.tac file).
</I>&gt;<i>
</I>&gt;<i> I hope you can take a look at the class PolicyClient, why it causes
</I>&gt;<i> problem to reactor main loop. Please point me to where the idea might come
</I>&gt;<i> from.
</I>&gt;<i>
</I>&gt;<i> I can give you the example but not sure if it is enough, as the client
</I>&gt;<i> needs to connect to a server.
</I>&gt;<i>
</I>
It looks like PolicyClient does a blocking HTTP request in __init__.  Since
PolicyClient is instantiated in the reactor thread, this will block the
reactor.  Perhaps this call is hanging for some reason when the process has
daemonized?  This would be unusual but not unheard of.  For example, there
are macOS environments where a process does not have access to the network
if it is not associated with a windowing session.

What platform do you observe the problem on, and what more can you learn
about what the process does on its way to hanging (eg can you run strace on
it)?

Jean-Paul


&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i> TS
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, May 21, 2020 at 5:23 PM Jean-Paul Calderone &lt;
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Thu, May 21, 2020 at 10:58 AM Sereysethy TOUCH &lt;
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">touch.sereysethy at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hello,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I am developing a twisted app, and it runs as a service using twistd -y
</I>&gt;&gt;&gt;<i> to start the app.
</I>&gt;&gt;&gt;<i> I am having a problem of running a thread. I know it is not recommended
</I>&gt;&gt;&gt;<i> to use thread, but the library that I use, the object created is running in
</I>&gt;&gt;&gt;<i> a thread.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Here is the problem:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1) if I start reactor by running reactor.run() directly, thread is
</I>&gt;&gt;&gt;<i> running fine
</I>&gt;&gt;&gt;<i> 2) if I run it as a service using twisted, the thread is not running, it
</I>&gt;&gt;&gt;<i> runs but it seems to be blocked, because I tried to write something to file
</I>&gt;&gt;&gt;<i> using time.sleep(), but file is empty.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is there something that I miss? How can I debug this?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A good next step would be to create at Short, Self Contained, Correct
</I>&gt;&gt;<i> (Compilable), Example &lt;<A HREF="http://sscce.org/">http://sscce.org/</A>&gt; and share it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Jean-Paul
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thank you,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> TS
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20200521/521451c6/attachment.htm&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065105.html">[Twisted-Python] Twisted and Thread, thread not running when twisted app is running as service
</A></li>
	<LI>Next message (by thread): <A HREF="065107.html">[Twisted-Python] Twisted and Thread, thread not running when twisted app is running as service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65106">[ date ]</a>
              <a href="thread.html#65106">[ thread ]</a>
              <a href="subject.html#65106">[ subject ]</a>
              <a href="author.html#65106">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
