<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Creating a new selectable (for Pg async interface)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Creating%20a%20new%20selectable%20%28for%20Pg%20async%20interface%29&In-Reply-To=%3C20021215161349.GA2658%40lilith.ghaering.test%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034926.html">
   <LINK REL="Next"  HREF="034928.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Creating a new selectable (for Pg async interface)</H1>
    <B>Gerhard HÃ¤ring</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Creating%20a%20new%20selectable%20%28for%20Pg%20async%20interface%29&In-Reply-To=%3C20021215161349.GA2658%40lilith.ghaering.test%3E"
       TITLE="[Twisted-Python] Creating a new selectable (for Pg async interface)">haering_python at gmx.de
       </A><BR>
    <I>Sun Dec 15 09:13:49 MST 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034926.html">[Twisted-Python] Web proxy docstrings
</A></li>
        <LI>Next message (by thread): <A HREF="034928.html">[Twisted-Python] Creating a new selectable (for Pg async interface)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34927">[ date ]</a>
              <a href="thread.html#34927">[ thread ]</a>
              <a href="subject.html#34927">[ subject ]</a>
              <a href="author.html#34927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I'd like to learn asynchronuous programming with Twisted, because I
think this will make me a better programmer, no matter if I'll use this
paradigma in the end or not.

So I thought about wrapping PostgreSQL's asynchronous interface to be
usable from a Twisted app. I did once chat a little with Itamar about
this on #twisted, and now I finally got around starting this.

I don't really know much about twisted, so please correct me if this is
wrong:

    A reactor is the Twisted main loop, which selects on selectables,
    and invokes doRead() on them when data is available.

Itamar told me I'd need to implement
twisted.internet.abstract.FileDescriptor, so this is what I did (very
incomplete code):

#v+
from twisted.internet import abstract
from pyPgSQL import libpq

class PgAsyncConn(abstract.FileDescriptor):
    def __init__(self):
        abstract.FileDescriptor.__init__(self)

        # PostgreSQL stuff
        self.conn = libpq.PQconnectdb(&quot;host=gargamel dbname=gerhard&quot;)
        self.fileno = self.conn.socket.fileno
        self.startReading()

    def write(self, data):
        print &quot;writing&quot;

    def query(self, callback, errback, *args, **kwargs):
        print &quot;sending query ...&quot;
        self.conn.sendQuery(*args)
        self.callback, self.errback = callback, errback
        print &quot;query sent.&quot;

    def operation(self, callback, errback, *args, **kwargs):
        print &quot;operation&quot;
        
    def doRead(self):
        self.conn.consumeInput()
        if not self.conn.isBusy:
            print &quot;data available&quot;
            res = self.conn.getResult()
            print &quot;got result.&quot;

            bla = self.conn.getResult()
            assert bla is None
            print &quot;query sucessfully processed.&quot;

            # call callback here
            self.callback(res)

    def connectionLost(self, reason):
        &quot;&quot;&quot;The connection was lost.
        &quot;&quot;&quot;
        self.conn.finish()
#v-

Now I'm at the point where I'd like to try this code out. *But*
obviously something is still missing. I believe my PgAsyncConn would
need to be registered with the reactor?! Is this true and if yes, how do
I do it?

Btw. I'll try to keep my new baby interface-compatible with
twisted.enterprise.adbapi as much as possible.

Next question: I'd like to try my code out. Is there a good way to test
this under Twisted, apart from writing a little server like the Echo
example of the docs, and trying to call PgAsyncConn from it?

TIA,

Gerhard
-- 
Favourite database:             <A HREF="http://www.postgresql.org/">http://www.postgresql.org/</A>
Favourite programming language: <A HREF="http://www.python.org/">http://www.python.org/</A>
Combine the two:                <A HREF="http://pypgsql.sf.net/">http://pypgsql.sf.net/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034926.html">[Twisted-Python] Web proxy docstrings
</A></li>
	<LI>Next message (by thread): <A HREF="034928.html">[Twisted-Python] Creating a new selectable (for Pg async interface)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34927">[ date ]</a>
              <a href="thread.html#34927">[ thread ]</a>
              <a href="subject.html#34927">[ subject ]</a>
              <a href="author.html#34927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
