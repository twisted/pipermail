<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] POP3 improvements
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20POP3%20improvements&In-Reply-To=%3C1041265642.640.30.camel%40mingus%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034997.html">
   <LINK REL="Next"  HREF="034999.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] POP3 improvements</H1>
    <B>Abe Fettig</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20POP3%20improvements&In-Reply-To=%3C1041265642.640.30.camel%40mingus%3E"
       TITLE="[Twisted-Python] POP3 improvements">abe at fettig.net
       </A><BR>
    <I>Mon Dec 30 09:27:23 MST 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034997.html">[Twisted-Python] DNS changes
</A></li>
        <LI>Next message (by thread): <A HREF="034999.html">[Twisted-Python] POP3 improvements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34998">[ date ]</a>
              <a href="thread.html#34998">[ thread ]</a>
              <a href="subject.html#34998">[ subject ]</a>
              <a href="author.html#34998">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Over the weekend I was working on adding POP3 support to the messaging
library I'm working on.  I noticed that while downloading large messages
from a POP3 server on my local network my test app would use 100% CPU,
and would stop responding to events until it finished downloading the
message.  

Looking at the twisted.protocols.pop3.POP3Client code I saw that it was
handling downloaded messages by concatenating a string, adding one line
at a time.  This seemed like an inefficient way to do it, so I modified
the code to use a file-like object instead.  The result is much faster,
and gives you the option of writing a downloading message to a file as
it comes in rather than keeping it all in memory.

The modified POP3Client (attached) still has some work to be done, but I
was hoping to get some comments from the list first.  

Currently it works like this:  When you send a command that returns a
multi-line response (LIST or RETR), you pass an optional file-like
object that the response should be written to.  If no file argument is
supplied a StringIO is used.  When the server is finished sending the
response, handle_COMMANDNAME is called, passing back the file object
containing the downloaded response.

At this point I'm still not correcting byte-stuffed lines in downloaded
messages, so I need to do that.  Also, if it would be OK with everyone,
I think it might be nice to make POP3Client a little higher-level, so
that LIST, for example, would return an actual list instead of a file
(or, in the current implementation, a string) that the implementer has
to parse.  And it might be good to offer support for more POP3 commands
like TOP.

If somebody could take a look at my code and tell me what I'd need to do
to make it meet the Twisted standards I'd appreciate it.

(There are also some improvements that could probably be made to the
POP3 server code, but I thought those could wait 'till later).

Abe

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pop3support.py
Type: text/x-python
Size: 7903 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20021230/7c92bc9e/attachment-0002.py&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034997.html">[Twisted-Python] DNS changes
</A></li>
	<LI>Next message (by thread): <A HREF="034999.html">[Twisted-Python] POP3 improvements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34998">[ date ]</a>
              <a href="thread.html#34998">[ thread ]</a>
              <a href="subject.html#34998">[ subject ]</a>
              <a href="author.html#34998">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
