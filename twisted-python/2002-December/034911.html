<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] t.p.rebuild
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20t.p.rebuild&In-Reply-To=%3C20021212075703.GA19604%40meson.dyndns.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] t.p.rebuild</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20t.p.rebuild&In-Reply-To=%3C20021212075703.GA19604%40meson.dyndns.org%3E"
       TITLE="[Twisted-Python] t.p.rebuild">exarkun at meson.dyndns.org
       </A><BR>
    <I>Thu Dec 12 00:57:03 MST 2002</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34911">[ date ]</a>
              <a href="thread.html#34911">[ thread ]</a>
              <a href="subject.html#34911">[ subject ]</a>
              <a href="author.html#34911">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>  twisted.python.rebuild.rebuild() currently breaks in some bizarre
circumstances (which I still cannot really say I understand completely),
however, the below fixes it.  

  The drawbacks: greater up-front costs for rebuilding (whereas the old
behavior spread the costs out over time); doesn't work with Python 2.1
(oops); imho is less desirable, for depending on gc.get_referrers().

  Advantages: -12 lines, +1 line; it works; it unifies one old/new style
class conditional.

  I'm not sure what my point is, except, here's the fix.  If it isn't
appropriate for it to go in for another few months (or however long we go
before deciding 2.1 support is no longer important) I probably don't mind,
I'll just use a locally modified version.

  Jp

===================================================================
RCS file: /cvs/Twisted/twisted/python/rebuild.py,v
retrieving revision 1.14
diff -u -r1.14 rebuild.py
--- rebuild.py  20 Sep 2002 20:29:41 -0000      1.14
+++ rebuild.py  12 Dec 2002 07:36:34 -0000
@@ -193,18 +193,19 @@
     if doLog:
         log.msg('  (cleaning %s): ' % str(module.__name__))
 
-    for clazz in classes:
-        if getattr(module, clazz.__name__) is clazz:
-            log.msg(&quot;WARNING: class %s not replaced by reload!&quot; % reflect.qual(clazz))
-        else:
-            if doLog:
-                log.logfile.write(&quot;x&quot;)
-                log.logfile.flush()
-            clazz.__bases__ = ()
-            clazz.__dict__.clear()
-            clazz.__getattr__ = __getattr__
-            clazz.__module__ = module.__name__
-    for nclass in newclasses:
+    for nclass in classes + newclasses:
         ga = getattr(module, nclass.__name__)
         if ga is nclass:
             log.msg(&quot;WARNING: new-class %s not replaced by reload!&quot; % reflect.qual(nclass))
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20021212/e7d972e4/attachment.sig&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34911">[ date ]</a>
              <a href="thread.html#34911">[ thread ]</a>
              <a href="subject.html#34911">[ subject ]</a>
              <a href="author.html#34911">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
