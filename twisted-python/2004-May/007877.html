<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] service takedown (one newbie to other newbies,	methinks)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20service%20takedown%20%28one%20newbie%20to%20other%20newbies%2C%0A%09methinks%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007876.html">
   <LINK REL="Next"  HREF="007878.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] service takedown (one newbie to other newbies,	methinks)</H1>
    <B>Bill la Forge</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20service%20takedown%20%28one%20newbie%20to%20other%20newbies%2C%0A%09methinks%29&In-Reply-To="
       TITLE="[Twisted-Python] service takedown (one newbie to other newbies,	methinks)">laforge49 at yahoo.co.in
       </A><BR>
    <I>Fri May 21 12:12:18 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007876.html">[Twisted-Python] Win32 files uploaded
</A></li>
        <LI>Next message: <A HREF="007878.html">[Twisted-Python] service takedown (one newbie to other	newbies, methinks)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7877">[ date ]</a>
              <a href="thread.html#7877">[ thread ]</a>
              <a href="subject.html#7877">[ subject ]</a>
              <a href="author.html#7877">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If a service starts successfully, once initialization completes 
successfully, it's stopService will be called for proper cleanup.
 
However, if another service fails to successfully initialize, and it
is kind enough to call reactor.stop() rather than throw an exception,
then the first service can, at the end of its initialization, call
reactor.addSystemEventTrigger('before','shutdown',self.failedStartup),
then failedStartup() will be called and there is STILL a chance to
cleanup.
 
Here's the code, the script, and the twistd output:
 
from twisted.application import service
from twisted.internet import reactor
class SimpleService(service.Service):
    def startService(self):
        service.Service.startService(self)
        reactor.addSystemEventTrigger('before','shutdown',self.failedStartup)
        print '&gt;&gt;&gt;start'
    def stopService(self):
        print '&gt;&gt;&gt;stop'
        service.Service.stopService(self)
    def failedStartup(self):
        print 'Oh!!!!!!!!!!!!!!!!!!!!!'
        
class FailService(service.Service):
    def startService(self):
        reactor.stop()

from twisted.application import service
from twisted.internet import reactor
import simpleService
application = service.Application('testServer')
serviceCollection=service.IServiceCollection(application)
ss=simpleService.SimpleService()
ss.setServiceParent(serviceCollection)
fs=simpleService.FailService()
fs.setServiceParent(serviceCollection)

C:\other\Bill\compstrm\compstrm\twbsd&gt;twistd -noy testService.py
2004/05/21 21:39 India Standard Time [-] Log opened.
2004/05/21 21:39 India Standard Time [-] twistd 1.2.0 (C:\Python23\python.exe 2.
3.3) starting up
2004/05/21 21:39 India Standard Time [-] reactor class: twisted.internet.default
.SelectReactor
2004/05/21 21:39 India Standard Time [-] &gt;&gt;&gt;start
2004/05/21 21:39 India Standard Time [-] Oh!!!!!!!!!!!!!!!!!!!!!
2004/05/21 21:39 India Standard Time [-] Main loop terminated.
2004/05/21 21:39 India Standard Time [-] Server Shut Down.
C:\other\Bill\compstrm\compstrm\twbsd&gt;


Bill la Forge
<A HREF="http://www.geocities.com/laforge49/">http://www.geocities.com/laforge49/</A>
Yahoo! India Matrimony: Find your partner online.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20040521/f61c4ff4/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20040521/f61c4ff4/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007876.html">[Twisted-Python] Win32 files uploaded
</A></li>
	<LI>Next message: <A HREF="007878.html">[Twisted-Python] service takedown (one newbie to other	newbies, methinks)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7877">[ date ]</a>
              <a href="thread.html#7877">[ thread ]</a>
              <a href="subject.html#7877">[ subject ]</a>
              <a href="author.html#7877">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
