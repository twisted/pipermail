<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Missing something basic on defer and postgresql
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Missing%20something%20basic%20on%20defer%20and%20postgresql&In-Reply-To=%3C1084201982.26071.90.camel%40localhost%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040233.html">
   <LINK REL="Next"  HREF="040236.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Missing something basic on defer and postgresql</H1>
    <B>James R. Saker Jr.</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Missing%20something%20basic%20on%20defer%20and%20postgresql&In-Reply-To=%3C1084201982.26071.90.camel%40localhost%3E"
       TITLE="[Twisted-Python] Missing something basic on defer and postgresql">jsaker at americanrelay.com
       </A><BR>
    <I>Mon May 10 09:13:02 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040233.html">[Twisted-Python] You also want to read this
</A></li>
        <LI>Next message (by thread): <A HREF="040236.html">[Twisted-Python] Missing something basic on defer and postgresql
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40235">[ date ]</a>
              <a href="thread.html#40235">[ thread ]</a>
              <a href="subject.html#40235">[ subject ]</a>
              <a href="author.html#40235">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think I'm missing something rather basic and would greatly appreciate
any suggestions.

After working through the Twisted RDBMS example (with no luck - the
second RDBMS example gets a deferred but fails to run
.addCallback(printResult), I thought I'd read more about deferreds in
its own section and made a simple postgresql example using the third
example in the Deferreds section. 

When I run this (with database = postgresql, dbname = mydb, table =
myuser), it yields the following:

Got to getData
got to gotResults with name = Joe

...but never runs addCallback(self, _toHTML). Apparently I'm missing
something pretty obvious about callbacks - and may be the same issue I
dealt with in the RDBMS example. Any suggestions? 

jamie


##~ begin dbserver.py
from twisted.enterprise import adbapi
from twisted.internet import reactor, defer
                                                                                                                    
dbpool = adbapi.ConnectionPool(&quot;psycopg&quot;, 'dbname=mydb user=postgres')
                                                                                                                    
class Getter:
   def gotResults(self, name):
      print &quot;got to gotResults with name = %s&quot; % name
      return dbpool.runQuery(&quot;SELECT age FROM myuser WHERE name = '%s'&quot;
% name)
                                                                                                                    
   def _toHTML(self, r):
      print &quot;Got to _toHTML&quot;
      print &quot;Result is: %s&quot; % r
                                                                                                                    
   def getData(self, x):
      self.d = defer.Deferred()
      print &quot;Got to getData&quot;
      reactor.callLater(2, self.gotResults, x)
      self.d.addCallback(self._toHTML)
      return self.d
                                                                                                                    
def printData(d):
      &quot;Got to printData&quot;
      print d
                                                                                                                    
def printError(failure):
      import sys
      sys.stderr.write(str(failure))
                                                                                                                    
if __name__ == '__main__':
                                                                                                                    
      g = Getter()
      d = g.getData('Joe')
      d.addCallback(printData)
      d.addErrback(printError)
                                                                                                                    
reactor.callLater(4, reactor.stop); reactor.run()



##------------postgresql database table info----------------------------

mydb=# select * from myuser;
 pkid |  name  | age
------+--------+-----
    1 | Joe    |  36
    2 | Sally  |  15
    3 | Peanut |   5
(3 rows)

mydb=# SELECT age FROM myuser WHERE name = 'Joe';
 age
-----
  36
(1 row)






</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040233.html">[Twisted-Python] You also want to read this
</A></li>
	<LI>Next message (by thread): <A HREF="040236.html">[Twisted-Python] Missing something basic on defer and postgresql
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40235">[ date ]</a>
              <a href="thread.html#40235">[ thread ]</a>
              <a href="subject.html#40235">[ subject ]</a>
              <a href="author.html#40235">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
