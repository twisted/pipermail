<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] service takedown (one newbie to other newbies,	methinks)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20service%20takedown%20%28one%20newbie%20to%20other%20newbies%2C%0A%09methinks%29&In-Reply-To=%3C40AE34D0.7090606%40divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040386.html">
   <LINK REL="Next"  HREF="040388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] service takedown (one newbie to other newbies,	methinks)</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20service%20takedown%20%28one%20newbie%20to%20other%20newbies%2C%0A%09methinks%29&In-Reply-To=%3C40AE34D0.7090606%40divmod.com%3E"
       TITLE="[Twisted-Python] service takedown (one newbie to other newbies,	methinks)">exarkun at divmod.com
       </A><BR>
    <I>Fri May 21 10:56:48 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040386.html">[Twisted-Python] service takedown (one newbie to other	newbies, methinks)
</A></li>
        <LI>Next message (by thread): <A HREF="040388.html">[Twisted-Python] service takedown (one newbie to other newbies,	methinks)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40387">[ date ]</a>
              <a href="thread.html#40387">[ thread ]</a>
              <a href="subject.html#40387">[ subject ]</a>
              <a href="author.html#40387">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Bill la Forge wrote:
&gt;<i> If a service starts successfully, once initialization completes
</I>&gt;<i> successfully, it's stopService will be called for proper cleanup.
</I>&gt;<i>  
</I>&gt;<i> However, if another service fails to successfully initialize, and it
</I>&gt;<i> is kind enough to call reactor.stop() rather than throw an exception,
</I>&gt;<i> then the first service can, at the end of its initialization, call
</I>&gt;<i> reactor.addSystemEventTrigger('before','shutdown',self.failedStartup),
</I>&gt;<i> then failedStartup() will be called and there is STILL a chance to
</I>&gt;<i> cleanup.
</I>&gt;<i>  
</I>
   I think a better solution would be to write an IServiceCollection 
(MultiService subclass, probably) that knows how to deal with exceptions 
raised from child services' startService methods.

   The idea is the same, but the framework gets to handle more of the 
redundant boilerplate (untested):

     class BlahMultiService(MultiService):
         def startService(self):
             self.running = True
             started = []
             for svc in self:
                 try:
                     svc.startService()
                 except:
                     err = Failure()
                     for svc in started[::-1]:
                         try:
                             svc.stopService()
                         except:
                             log.err()
                     self.startupHadError(err)

                 else:
                     started.append(svc)

         def startupHadError(self, failure):
             # Could raise an exception here, or log it, or
             # shut down the reactor, or whatever is appropriate

   Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040386.html">[Twisted-Python] service takedown (one newbie to other	newbies, methinks)
</A></li>
	<LI>Next message (by thread): <A HREF="040388.html">[Twisted-Python] service takedown (one newbie to other newbies,	methinks)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40387">[ date ]</a>
              <a href="thread.html#40387">[ thread ]</a>
              <a href="subject.html#40387">[ subject ]</a>
              <a href="author.html#40387">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
