<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] pb.Copyable, round trip objects,	and untrusted	clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20pb.Copyable%2C%20round%20trip%20objects%2C%09and%20untrusted%0A%09clients&In-Reply-To=40AFD50B.9060704%40ripton.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007887.html">
   <LINK REL="Next"  HREF="007843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] pb.Copyable, round trip objects,	and untrusted	clients</H1>
    <B>Jasper Phillips</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20pb.Copyable%2C%20round%20trip%20objects%2C%09and%20untrusted%0A%09clients&In-Reply-To=40AFD50B.9060704%40ripton.net"
       TITLE="[Twisted-Python] pb.Copyable, round trip objects,	and untrusted	clients">jasper at peak.org
       </A><BR>
    <I>Sun May 23 00:36:42 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007887.html">[Twisted-Python] pb.Copyable, round trip objects,	and untrusted	clients
</A></li>
        <LI>Next message: <A HREF="007843.html">[Twisted-Python] Invalid 'reason' info - possible cause
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7889">[ date ]</a>
              <a href="thread.html#7889">[ thread ]</a>
              <a href="subject.html#7889">[ subject ]</a>
              <a href="author.html#7889">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Sat, 22 May 2004, David Ripton wrote:

&gt;<i> Jasper Phillips wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; I'm treating event history as game state, although I haven't implemented it
</I>&gt;<i> &gt; yet.  Not so much for the AIs use, but to model it's effects on future
</I>&gt;<i> &gt; events.  IMHO treating it as game state is also a simpler model.
</I>&gt;<i> 
</I>&gt;<i> So future events depend on the exact sequence of events used to reach 
</I>&gt;<i> the current state, not just the current state?  That sounds expensive.
</I>
Well, in theory they could, but in practice they can depend upon simpler
things, such as if two nations have ever been at war, how long ago was the
war, and how was it resolved.  I'm considering filtering past events and
Just storing those aspects that events switch on in a condensed format; e.g.
storing time since last war instead of whether there was war for each turn.

However, even this simpler approach is fairly complex, and is a prime target
for the feature axe...


&gt;<i> &gt; IMHO this seems overly complex.  I don't like maintaining parallel objects
</I>&gt;<i> &gt; or parallel calculation, as it smells like ClientGame/ServerGame...
</I>
[snip]
&gt;<i> Having separate *objects* of the same classes on the two sides is fine, 
</I>&gt;<i> though.  In fact, in a game with hidden information, it's inevitable. 
</I>&gt;<i> The server Game object will hold the full state, and each client's Game 
</I>&gt;<i> object will hold a subset.  This is true whether the server sends 
</I>&gt;<i> censored copies of its state to clients, or whether it sends them 
</I>&gt;<i> subsets of the full event stream and lets clients generate their own 
</I>&gt;<i> censored copies.
</I>
True, so long as they're the same objects.  I still don't like
reconstructing them in parallel.  It seems error prone when combined with
hidden state, and doesn't allow for outcomes based upon hidden state
(although this is not a problem for Titan).


&gt;<i> &gt; I disagree that sending objects isn't practical, IMHO it just helps to
</I>&gt;<i> &gt; approach it slightly differently.  I'll try to explain what I mean by
</I>&gt;<i> &gt; roughly describing my game as an example;  if my design is crappy please
</I>&gt;<i> &gt; feel free to shoot holes in it! :-)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Much of my game's logic is based upon Copyable Actions which are used by
</I>&gt;<i> &gt; both Server and Client, e.g. MoveAction.  These have a .__call__(state)
</I>&gt;<i> &gt; which modifies the passed state as they see fit, as well as a
</I>&gt;<i> &gt; .validate(state) to ensure a move is legal.  Players create a list of such
</I>&gt;<i> &gt; Actions, and pass them to the Game server as their turn.  
</I>&gt;<i> 
</I>&gt;<i> Standard command pattern, but cleaner in Python because of __call__.
</I>&gt;<i> 
</I>&gt;<i> Do your turns have phases, requiring certain actions to occur at certain 
</I>&gt;<i> times?
</I>
There is a distinct sequence of events, with certain types of actions being
resolved before others.  This is handled by a TurnTask, who's job it is to
run all the Actions, and resolved conflicts between them.  It embodies the
customary phase order of boardgames.

&gt;<i> Can other players interrupt your turn with actions, or are their replies 
</I>&gt;<i> (e.g. strikebacks to your attacks) completely automated or deferred 
</I>&gt;<i> until their turns?
</I>
My game has simultaneous turns, classical Diplomacy style.  There are some
twists that allow reactions, but these are simultaneous as well.

&gt;<i> &gt; With only literal args these Action objects can be passed safely to the
</I>&gt;<i> &gt; game, which will reconstitue it's own versions, validate them, then
</I>&gt;<i> &gt; invoke them by passing in it's True State.  Players are given their own
</I>&gt;<i> &gt; PlayerState view of TrueState each turn, with real (copies of) objects
</I>&gt;<i> &gt; they can use for display, UI and validation.
</I>&gt;<i> 
</I>&gt;<i> It seems that only sending game state updates once per turn would reduce 
</I>&gt;<i> interactivity too much.  I want to see my opponents' (visible) moves as 
</I>&gt;<i> they happen, not batched up at the end of his turn.  Beware of 
</I>&gt;<i> sequential solitaire.
</I>
This is just a matter of semantics.  A Turn in my engine can be whatever you
want, for example each of a players moves in Titan could be a &quot;Turn&quot;, with
updated state passed to all players after each one.  I prototyped the
Boardgame Binfa, which worked just like this.

&gt;<i> PlayerState / TrueState sounds like the ClientGame / ServerGame problem 
</I>&gt;<i> I was warning about.  It's not necessarily bad if they have the same 
</I>&gt;<i> interface and PlayerState just has a subset of the data, but look out 
</I>&gt;<i> for duplicate code.
</I>
PlayerState is just a subset of TrueState, but with methods for determining
just what subset.  Methods that accept one accept the other, most notably
Action.validate().


&gt;<i> &gt; IMHO Making all of this essentially part of the API is cleaner than having
</I>&gt;<i> &gt; bulk &quot;Reconsitute Objects&quot; methods.
</I>&gt;<i> 
</I>&gt;<i> Yes.  Having direct support in PB for the idea of const (copy this 
</I>&gt;<i> object when I send it, but ignore any changes that were made to it on 
</I>&gt;<i> the other side if I get it back), so that you don't have to do any of 
</I>&gt;<i> this, would be even cleaner.  I don't know if there's much demand for 
</I>&gt;<i> this feature from other people, though.
</I>
I suspect the mechanism necessary to specify the key field for these &quot;const&quot;
objects and where to find them would be as complex as just having clients
reference them by id, yet perhaps less clear.


&gt;<i> Anyway, I'm looking forward to seeing your game at some point.
</I>
I've got most of the core work done along with much of the game mechanics
and GUI, but not much game specific content.  I'll be done some time next
year, hopefully earlier than later.  When I have enough to start contracting
artists I'll start a website and stick it in my .sig, probably sometime in
the next several months.

I'm pondering LGPL'ing the underlying game framework (based on Twisted and
Pyui) at this time as well, although this is a fair amount of hassle and I'm
not sure anyone's interested.

-Jasper



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007887.html">[Twisted-Python] pb.Copyable, round trip objects,	and untrusted	clients
</A></li>
	<LI>Next message: <A HREF="007843.html">[Twisted-Python] Invalid 'reason' info - possible cause
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7889">[ date ]</a>
              <a href="thread.html#7889">[ thread ]</a>
              <a href="subject.html#7889">[ subject ]</a>
              <a href="author.html#7889">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
