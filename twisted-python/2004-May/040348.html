<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] pb.Copyable, round trip objects,	and untrusted clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20pb.Copyable%2C%20round%20trip%20objects%2C%0A%09and%20untrusted%20clients&In-Reply-To=%3C40AC2C0F.40300%40ripton.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040345.html">
   <LINK REL="Next"  HREF="040349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] pb.Copyable, round trip objects,	and untrusted clients</H1>
    <B>David Ripton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20pb.Copyable%2C%20round%20trip%20objects%2C%0A%09and%20untrusted%20clients&In-Reply-To=%3C40AC2C0F.40300%40ripton.net%3E"
       TITLE="[Twisted-Python] pb.Copyable, round trip objects,	and untrusted clients">dripton at ripton.net
       </A><BR>
    <I>Wed May 19 21:54:55 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040345.html">[Twisted-Python] Twisted 1.3.0 Windows installers
</A></li>
        <LI>Next message (by thread): <A HREF="040349.html">[Twisted-Python] pb.Copyable, round trip objects, and	untrusted clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40348">[ date ]</a>
              <a href="thread.html#40348">[ thread ]</a>
              <a href="subject.html#40348">[ subject ]</a>
              <a href="author.html#40348">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm working on a client-server game, with hidden information, using PB. 
  I don't want to trust the clients.

Because there is hidden information, it's important not to send anything 
to the client that it's player shouldn't see.  Doing that with PB is 
pretty straightforward.  If a class's data is always secret, don't make 
it Copyable.  If parts of a class are secret, censor them in getStateToCopy.

Obviously, the client should only be able to change the server's game 
state via a well-defined error-checked interface.  Also fairly 
straightforward, though error-prone since you need to forsee and test 
against every way to cheat.

There's a third hole to plug, which is passing an object from the server 
to the client as an argument of a client-side remote_* method, and later 
getting it back as an argument to a server-side perspective_* method. 
(e.g. the server passes the client a list of games in progress, and 
later the client passes back the game it wants to join.)  If the client 
changes the object before passing it back, it might trick the server 
into doing the wrong thing with it.

Anyway, it seems easy enough to avoid this problem, by just rewinding 
any changes the client has made to such objects.  At some point before 
sending an object to the client side, add it to a dict, keyed by its id. 
  When an object comes back from the client as an argument in a 
perspective_* call, use its id to lookup the server's copy of the object 
in the dict, and then reassign the current name to the good version of 
the object, losing any changes the client may have made.  In other 
words, the client is treated as if it only passed the object's id back, 
not its __dict__.  But the interface is simpler.

e.g.:

in Server
def __init__:
     self._paranoia = {}  # Maybe a weak dict instead
     #....

def paranoid_add(self, obj):
     self._paranoia[id(obj)] = obj
def paranoid_get(self, obj):
     return self._paranoia[id(obj)]

def form_game(self, whatever):
     game = Game.Game(args)
     self.paranoia_add(game)

Then in User (a pb.Avatar):
def perspective_join_game(self, game):
     game = self.server.paranoid_get(game)
     self.server.join_game(self.name, game)


This is simple and works, but it's annoyingly repetitive.  And plumbing 
code is infecting the application level.  And I know there are other 
object vs. id caches inside PB, so this feels redundant.  What's the 
right way to do this with Copyable?

Thanks.

-- 
David Ripton    <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dripton at ripton.net</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040345.html">[Twisted-Python] Twisted 1.3.0 Windows installers
</A></li>
	<LI>Next message (by thread): <A HREF="040349.html">[Twisted-Python] pb.Copyable, round trip objects, and	untrusted clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40348">[ date ]</a>
              <a href="thread.html#40348">[ thread ]</a>
              <a href="subject.html#40348">[ subject ]</a>
              <a href="author.html#40348">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
