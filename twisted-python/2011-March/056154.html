<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] UDP Logging Server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20UDP%20Logging%20Server&In-Reply-To=%3CAANLkTikgHs7%3DbUJe3sLomsmsRTKDkFicF%2Bc41hzjc8sQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056193.html">
   <LINK REL="Next"  HREF="056157.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] UDP Logging Server</H1>
    <B>SIC FS LIST</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20UDP%20Logging%20Server&In-Reply-To=%3CAANLkTikgHs7%3DbUJe3sLomsmsRTKDkFicF%2Bc41hzjc8sQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] UDP Logging Server">sicfslist at gmail.com
       </A><BR>
    <I>Fri Mar 11 12:15:47 MST 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056193.html">[Twisted-Python] Best strategies for pb Referenceables	running	long methods from callRemote
</A></li>
        <LI>Next message (by thread): <A HREF="056157.html">[Twisted-Python] UDP Logging Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56154">[ date ]</a>
              <a href="thread.html#56154">[ thread ]</a>
              <a href="subject.html#56154">[ subject ]</a>
              <a href="author.html#56154">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I am trying to write a UDP based logging server.

Generically speaking it looks somewhat like syslog except I needed a bit
more flexibility that syslog can provide (or at least that I think it can
provide).

What I'm trying to accomplish is:
-- receive UDP packet
-- parse UDP packet
-- write output to a log file
-- have the log files rotated on a periodic basis

So far I have a &quot;working&quot; implementation ... but I'm noticing that if I do
the following:
-- log when a message is received
-- that for that message it &quot;might&quot; show up in the file a pretty lengthy
period of time later

The actual UDP protocol:

class VocsLogger(DatagramProtocol):
    def datagramReceived(self, data, (host, port)):
        _proc_msg(self.transport, data, (host,
port))._new_msg().addCallback(handler)

The _proc_msg class:

class _proc_msg:
    def __init__(self, sck, data, (host, port)):
        self._sck = sck
        self._data = data
        self._host = host
        self._port = port

    def _new_msg(self):
        d, _ = LogMsg().ParseSocketMsg(self._data)
        if d.type.upper() == DISKINFO[0]:
            DISKINFO[1].write(d.ToString() + &quot;\n%s\n&quot; % (LOG_DELIM))
        elif d.type.upper() == LOADAVG[0]:
            LOADAVG[1].write(d.ToString() + &quot;\n%s\n&quot; % (LOG_DELIM))
        elif d.type.upper() == MEMINFO[0]:
            MEMINFO[1].write(d.ToString() + &quot;\n%s\n&quot; % (LOG_DELIM))
        elif d.type.upper() == NETDEV[0]:
            NETDEV[1].write(d.ToString() + &quot;\n%s\n&quot; % (LOG_DELIM))
        elif d.type.upper() == PSAUX[0]:
            PSAUX[1].write(d.ToString() + &quot;\n%s\n&quot; % (LOG_DELIM))
        elif d.type.upper() == WHOINFO[0]:
            WHOINFO[1].write(d.ToString() + &quot;\n%s\n&quot; % (LOG_DELIM))
        else:
            DEFAULT[1].write(d.ToString() + &quot;\n%s\n&quot; % (LOG_DELIM))

And I have a log rotate service that looks like this:

class LogRotateService(TimerService):
    def __init__(self):
        TimerService.__init__(self, 60 * 5, LogRotate)

And then I'm using twistd to actually make it work:

LogRotate()
application = service.Application(&quot;vocs-logger&quot;)
rotateLogService = LogRotateService()
rotateLogService.setServiceParent(application)
loggerService = internet.UDPServer(int(config['port']), VocsLogger(),
interface=config['host'])
loggerService.setServiceParent(application)


I'm probably approaching this the wrong way and not sure if I sure really
worry about deferring the actual process of writing to the log file or if
there was a better way altogether.

Thanks for any guidance.

SDR
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20110311/c8807889/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056193.html">[Twisted-Python] Best strategies for pb Referenceables	running	long methods from callRemote
</A></li>
	<LI>Next message (by thread): <A HREF="056157.html">[Twisted-Python] UDP Logging Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56154">[ date ]</a>
              <a href="thread.html#56154">[ thread ]</a>
              <a href="subject.html#56154">[ subject ]</a>
              <a href="author.html#56154">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
