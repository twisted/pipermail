<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Failing tests in trunk
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Failing%20tests%20in%20trunk&In-Reply-To=%3CAANLkTik4evU732Pe7_4PtsLTZjLpsNnp%3D1jo-deqMFAJ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056130.html">
   <LINK REL="Next"  HREF="056149.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Failing tests in trunk</H1>
    <B>Facundo Batista</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Failing%20tests%20in%20trunk&In-Reply-To=%3CAANLkTik4evU732Pe7_4PtsLTZjLpsNnp%3D1jo-deqMFAJ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Failing tests in trunk">facundobatista at gmail.com
       </A><BR>
    <I>Thu Mar 10 12:39:58 MST 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056130.html">[Twisted-Python] Failing tests in trunk
</A></li>
        <LI>Next message (by thread): <A HREF="056149.html">[Twisted-Python] Failing tests in trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56143">[ date ]</a>
              <a href="thread.html#56143">[ thread ]</a>
              <a href="subject.html#56143">[ subject ]</a>
              <a href="author.html#56143">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Mar 8, 2011 at 7:04 AM, Facundo Batista
&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">facundobatista at gmail.com</A>&gt; wrote:

&gt;&gt;<i> None of these are known failures:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    <A HREF="http://buildbot.twistedmatrix.com/boxes-supported">http://buildbot.twistedmatrix.com/boxes-supported</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Just looking at the list of failing tests, I would make a small bet that
</I>&gt;&gt;<i> the failures are caused by your locale setting somehow.
</I>&gt;<i>
</I>&gt;<i> I thought of that, but why would the test pass when running alone?
</I>&gt;<i>
</I>&gt;<i> I'll debug this.
</I>
Ok, found it.

See one example of the test that failed,
twisted.mail.test.test_imap.NewFetchTestCase.testFetchInternalDate:

    twisted.trial.unittest.FailTest: not equal:
    a = {0: {'INTERNALDATE': '02-nov-2003 21:25:10 +0000'},
     1: {'INTERNALDATE': '29-dic-2013 11:31:52 -0500'},
     2: {'INTERNALDATE': '10-mar-1992 02:44:30 -0600'},
     3: {'INTERNALDATE': '11-ene-2000 14:40:24 -0800'}}
    b = {0: {'INTERNALDATE': '02-Nov-2003 21:25:10 +0000'},
     1: {'INTERNALDATE': '29-Dec-2013 11:31:52 -0500'},
     2: {'INTERNALDATE': '10-Mar-1992 02:44:30 -0600'},
     3: {'INTERNALDATE': '11-Jan-2000 14:40:24 -0800'}}

See the difference? &quot;nov&quot; instead of &quot;Nov&quot;, etc. &quot;dic&quot; instead of
&quot;Dec&quot;. Yes, in Spanish December is 'diciembre'.

So, funny 'locale' issue, confirmed by showing getlocale() in the
test... when running the whole suite, the locale is ('es_AR', 'UTF8'),
and when running twisted.mail the locale is (None, None).

Weird, specially taking into account that 'locale' is not used in the
whole twisted project.

But I tracked it down.

In twisted/manhole/ui/test/test_gtk2manhole.py, gtk is imported, and
that changes the locale [0].

So, how this can be fixed?

Is ok for the IMAP4Server to spew the message internal date according
to the locale in which it's being run? Or it should always format the
dates in an specific way, because some definition somewhere? (I don't
know much about IMAP)

If it's ok for the server to format the dates according to the locale,
I should make the test more robust. If not, the server should set the
locale to (None, None) for the date formatting, or just set it at
__init__ and leave it there, or use other formatting (not
time.strftime, I prefer this solution).

Ideas? Opinions?

Thanks!

(BTW, I'm already at PyCon :D )


[0] Which I easily tested in a clean Python interpreter:

    &gt;&gt;&gt; import locale
    &gt;&gt;&gt; locale.getlocale()
    (None, None)
    &gt;&gt;&gt; import gtk
    &gt;&gt;&gt; locale.getlocale()
    ('es_AR', 'UTF8')

-- 
.    Facundo

Blog: <A HREF="http://www.taniquetil.com.ar/plog/">http://www.taniquetil.com.ar/plog/</A>
PyAr: <A HREF="http://www.python.org/ar/">http://www.python.org/ar/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056130.html">[Twisted-Python] Failing tests in trunk
</A></li>
	<LI>Next message (by thread): <A HREF="056149.html">[Twisted-Python] Failing tests in trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56143">[ date ]</a>
              <a href="thread.html#56143">[ thread ]</a>
              <a href="subject.html#56143">[ subject ]</a>
              <a href="author.html#56143">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
