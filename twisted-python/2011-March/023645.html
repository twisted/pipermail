<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Slow data transfer with Twisted + socat +	Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Slow%20data%20transfer%20with%20Twisted%20%2B%20socat%20%2B%0A%09Windows&In-Reply-To=AANLkTinobtkCT9uv4VVXHr0t4OQ5S-ph%2BTx2Yn66T3bZ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023641.html">
   <LINK REL="Next"  HREF="023646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Slow data transfer with Twisted + socat +	Windows</H1>
    <B>Michael Thompson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Slow%20data%20transfer%20with%20Twisted%20%2B%20socat%20%2B%0A%09Windows&In-Reply-To=AANLkTinobtkCT9uv4VVXHr0t4OQ5S-ph%2BTx2Yn66T3bZ%40mail.gmail.com"
       TITLE="[Twisted-Python] Slow data transfer with Twisted + socat +	Windows">michaelnt at gmail.com
       </A><BR>
    <I>Tue Mar  8 14:49:16 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023641.html">[Twisted-Python] Slow data transfer with Twisted + socat + Windows
</A></li>
        <LI>Next message: <A HREF="023646.html">[Twisted-Python] Slow data transfer with Twisted + socat +	Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23645">[ date ]</a>
              <a href="thread.html#23645">[ thread ]</a>
              <a href="subject.html#23645">[ subject ]</a>
              <a href="author.html#23645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8 March 2011 08:38, Jason Heeris &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jason.heeris at gmail.com</A>&gt; wrote:
&gt;<i> I'm writing an application with Twisted/GTK to manage a serial device,
</I>&gt;<i> for use on both Windows and Linux. Unfortunately I can't use serial
</I>&gt;<i> comms directly under Windows[1], so my workaround is to launch
</I>&gt;<i> socat[2] in a subprocess to relay data between a local TCP port and
</I>&gt;<i> the serial port. The socat command I use is:
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;socat TCP4-LISTEN:31415 /dev/com4,raw,echo=0,b57600
</I>&gt;<i>
</I>&gt;<i> I can then send and receive data over localhost:31415 same as I would
</I>&gt;<i> for a serial port.
</I>&gt;<i>
</I>&gt;<i> The trouble is, a transaction that takes a minute under Linux (using
</I>&gt;<i> *either* direct serial comms or the same socat subprocess approach)
</I>&gt;<i> now takes more than 50 times as long under Windows.
</I>&gt;<i>
</I>&gt;<i> I've attached the script I'm using to test, mainly so it's clear what
</I>&gt;<i> I'm doing &#8212; although it's useless unless you happen to have a serial
</I>&gt;<i> device using a protocol you can shoehorn into that script. I've also
</I>&gt;<i> attached the output where you can see the difference between different
</I>&gt;<i> reactors on different platforms. (In my app I use
</I>&gt;<i> reactor.spawnProcess(...), but I'm not doing that here.)
</I>&gt;<i>
</I>&gt;<i> Basically, under Linux either approach takes 4 seconds; under Windows
</I>&gt;<i> the SelectReactor takes 30s, and the gtk2reactor takes 220s!
</I>&gt;<i>
</I>&gt;<i> Profiling the &quot;reactor.run()&quot; call on the different platforms (both
</I>&gt;<i> for the select reactor) showed that (a) most time was spent in the
</I>&gt;<i> select.select call, and (b) the time spent in select was 8 times more
</I>&gt;<i> under Windows than Linux. I have no idea if this is useful information
</I>&gt;<i> or not.
</I>&gt;<i>
</I>&gt;<i> I'm pretty sure it's not a socat-specific issue, because I get the
</I>&gt;<i> same problem if I use com2tcp[3]. It could be Cygwin related, but I
</I>&gt;<i> don't know how determine that for sure. Also, the fact that it runs
</I>&gt;<i> slower using the gtk2reactor (vs. selectreactor) suggests to me that
</I>&gt;<i> it could be my code, not theirs.
</I>&gt;<i>
</I>&gt;<i> I found an old Cygwin thread[4] that claimed setting NODELAY on the
</I>&gt;<i> listening socket helped with a similar problem, but using
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;&gt; socat TCP4-LISTEN:31415,nodelay [etc]
</I>&gt;<i>
</I>&gt;<i> ...made no difference.
</I>&gt;<i>
</I>&gt;<i> So I'm a bit stuck. Does anyone know how I can narrow it down further?
</I>&gt;<i> Has someone else noticed slow TCP behaviour under Windows? Or Cygwin
</I>&gt;<i> utilities? Have I made some glaringly obvious mistake in my script
</I>&gt;<i> there?
</I>
Does you program just write via TCP to this serial device, it doesn't
do anything else that could block?

Have you tried running this under different reactors?

Running the windows program against the Linux socat device might help
to reduce the number of variables.

Michael

</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023641.html">[Twisted-Python] Slow data transfer with Twisted + socat + Windows
</A></li>
	<LI>Next message: <A HREF="023646.html">[Twisted-Python] Slow data transfer with Twisted + socat +	Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23645">[ date ]</a>
              <a href="thread.html#23645">[ thread ]</a>
              <a href="subject.html#23645">[ subject ]</a>
              <a href="author.html#23645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
