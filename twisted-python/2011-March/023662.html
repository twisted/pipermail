<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Best strategies for pb Referenceables running long	methods from callRemote
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Best%20strategies%20for%20pb%20Referenceables%20running%20long%0A%09methods%20from%20callRemote&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023670.html">
   <LINK REL="Next"  HREF="023698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Best strategies for pb Referenceables running long	methods from callRemote</H1>
    <B>Charles Solar</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Best%20strategies%20for%20pb%20Referenceables%20running%20long%0A%09methods%20from%20callRemote&In-Reply-To="
       TITLE="[Twisted-Python] Best strategies for pb Referenceables running long	methods from callRemote">charlessolar at gmail.com
       </A><BR>
    <I>Thu Mar 10 18:08:03 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023670.html">[Twisted-Python] twisted.web.error.Error &amp;	BaseException.message deprecation
</A></li>
        <LI>Next message: <A HREF="023698.html">[Twisted-Python] Best strategies for pb Referenceables	running	long methods from callRemote
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23662">[ date ]</a>
              <a href="thread.html#23662">[ thread ]</a>
              <a href="subject.html#23662">[ subject ]</a>
              <a href="author.html#23662">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am using PB to run remote methods in a testing system at my company.  The
code works very well but breaks down when I start running multiple tests at
once.  I have tracked this down to overflowing the thread pool on the remote
machines.  I am wondering if anyone might have better suggestions for
running long methods from a remote method.

I coded up a sample of what I am seeing here: <A HREF="http://pastebin.com/rBPp20Ms">http://pastebin.com/rBPp20Ms</A>

Basically I have 1 server that calls remote_execute on many clients on a
remote server.  This remote_execute method starts a new method using
threads.deferToThread and returns the defer to make the server's callRemote
defer wait until the remote long method end.
What I do in those methods is run test code that waits, blocks, sleeps, and
all sorts of nasty things that make the thread take a while.  In the example
code I simply sleep for 20 seconds.

The problem I see with this code specifically is that I run out of threads
on the pool and even though I wanted all execute methods to run at the same
time, I see 10 run, then 10 more, then 10 more.. etc.  The testing depends
on all these methods being run at the same time as they run mechanisms that
depend on each other and need everyone running.  When I overflow the thread
pool some methods do not run until other methods stop, which makes the whole
test fail.

I am not holding the GIL or blocking the reactor, which was the first thing
I checked.

Setting reactor.suggestThreadPoolSize(50) does help, but I do not think its
the best solution, and does not work very well on our slow and older
machines.

Any feedback is appreciated
Charles
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20110310/44e4a32d/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20110310/44e4a32d/attachment.htm</A> 
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023670.html">[Twisted-Python] twisted.web.error.Error &amp;	BaseException.message deprecation
</A></li>
	<LI>Next message: <A HREF="023698.html">[Twisted-Python] Best strategies for pb Referenceables	running	long methods from callRemote
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23662">[ date ]</a>
              <a href="thread.html#23662">[ thread ]</a>
              <a href="subject.html#23662">[ subject ]</a>
              <a href="author.html#23662">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
