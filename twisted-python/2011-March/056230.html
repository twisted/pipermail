<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deferred documentation.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deferred%20documentation.&In-Reply-To=%3C4C606D48-E571-46E9-B621-E9DE21E76210%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056220.html">
   <LINK REL="Next"  HREF="056236.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deferred documentation.</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deferred%20documentation.&In-Reply-To=%3C4C606D48-E571-46E9-B621-E9DE21E76210%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Deferred documentation.">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Mar 27 19:54:15 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056220.html">[Twisted-Python] Deferred documentation.
</A></li>
        <LI>Next message (by thread): <A HREF="056236.html">[Twisted-Python] Deferred documentation.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56230">[ date ]</a>
              <a href="thread.html#56230">[ thread ]</a>
              <a href="subject.html#56230">[ subject ]</a>
              <a href="author.html#56230">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Mar 25, 2011, at 7:28 AM, Jasper St. Pierre wrote:

&gt;<i> Big wall of text incoming. If you're going to read any part of this
</I>&gt;<i> email, search for *IMPORTANT* and read that part.
</I>&gt;<i> 
</I>&gt;<i> Right now I'm stuck at creating a simple example for &quot;deferred dependencies&quot;.
</I>&gt;<i> 
</I>&gt;<i> On Tue, Mar 22, 2011 at 10:03 PM, Glyph Lefkowitz
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i> On Mar 21, 2011, at 9:30 PM, Jasper St. Pierre wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On IRC, exarkun, glyph, spiv and idnar encouraged me to do a bit of
</I>&gt;&gt;&gt;<i> work on the Defer documentation.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Yay!  This documentation could definitely use some work.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I kept get confused between the things like returning a Deferred from a
</I>&gt;&gt;&gt;<i> callback and chainDeferred, which I found out wasn't that useful:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Yeah, chainDeferred is not a great method.  Now that Deferreds are
</I>&gt;&gt;<i> non-recursive, I think it's purely worse than inserting an additional
</I>&gt;&gt;<i> Deferred as a result from a callback.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> My eventual goal is to reduce the number of documentation about defer
</I>&gt;&gt;<i> down to a near-impossible two documents. I'm hoping to merge some of
</I>&gt;&gt;<i> the good stuff of the other thousands of documents.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> That would be absolutely great.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Thoughts so far?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> While I applaud your intent, these drafts look quite rough.  The random
</I>&gt;&gt;<i> interjections and asides in
</I>&gt;&gt;<i> &lt;<A HREF="http://magcius.mecheye.net/twisted/DeferHowTo-Fixup.html">http://magcius.mecheye.net/twisted/DeferHowTo-Fixup.html</A>&gt; seem distracting
</I>&gt;&gt;<i> and confusing to me.  Trying to put myself in the mind of a newcomer, I find
</I>&gt;&gt;<i> myself asking many questions which are irrelevant to what I'm trying to
</I>&gt;&gt;<i> learn:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What's &quot;async&quot;?  Why is it hard?  (The original document mentions
</I>&gt;&gt;<i> asynchronous stuff, but in the context of full english sentences.)
</I>&gt;<i> 
</I>&gt;<i> Should I mention blocking with something like urllib, then showcase
</I>&gt;<i> another example library that uses regular callbacks?
</I>
That sounds like a good idea, actually.  Start by looking at it blocking, explain the problem with that; then demonstrate the one-callback-when-you're-done approach and explain some issues with that, and then move on to Deferreds.

&gt;&gt;<i> Where are we going shopping?  What does shopping have to do with this?
</I>&gt;<i> 
</I>&gt;<i> Pop culture reference. Killed.
</I>
To be clear: I did get that reference, actually, and in another context it would be pretty funny :).  Just not in these docs that are supposed to be universally accessible.

&gt;&gt;<i> What's gevent?  Does this have something to do with Twisted?
</I>&gt;&gt;<i> What's node.js?  This looks like Javascript, what does it have to do with
</I>&gt;&gt;<i> Twisted, which I thought was in Python?
</I>&gt;<i> 
</I>&gt;<i> Placeholders.
</I>
Placeholders for what, though?

&gt;&gt;<i> (Now I've gotten distracted and I'm reading about gevent and node.js rather
</I>&gt;&gt;<i> than making my Twisted application work and completing the Deferred
</I>&gt;&gt;<i> tutorial.  Epic fail.  But, if I were to continue...)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What's &quot;this pattern&quot;?  Functions?  Don't lots of programs use functions?
</I>&gt;<i> 
</I>&gt;<i> I guess this is a bit obvious when you have first-class-functions as a
</I>&gt;<i> language feature, but it's still a &quot;pattern.&quot;
</I>
My point was that the antecedents get a little ambiguous by that point in the text.

&gt;&gt;<i> How do they use it?  Why is it relevant?
</I>&gt;<i> 
</I>&gt;<i> I guess I'm stupid or slow, but it took a while for me to realize that
</I>&gt;<i> Deferreds were basically a standardized callback mechanism. It's not
</I>&gt;<i> really written anywhere on the tin: Deferred was to me a bit of an
</I>&gt;<i> unobvious name for what it does, and before recently I've always
</I>&gt;<i> associated it tightly to scheduling and the reactor.
</I>
No, this is a common problem.  I think it would be great to address the definition a bit more comprehensively.

&gt;&gt;<i> Why is the first explanation of what a Deferred is referred to as &quot;technical
</I>&gt;&gt;<i> mumbo-jumbo&quot;? Is this really complicated?  If I am not super good at
</I>&gt;&gt;<i> programming already, should I not be reading this?
</I>&gt;<i> 
</I>&gt;<i> It was prefixed with &quot;The abstract&quot; before. I put it back to &quot;The
</I>&gt;<i> abstract&quot;. To me, it seems like it's written in a way that makes sense
</I>&gt;<i> only if you understand what a Deferred is, but it was useful, so I
</I>&gt;<i> didn't rip it out. I see it as a paragraph that will make more sense
</I>&gt;<i> as you're reading the article, and once you go back and understand it,
</I>&gt;<i> there's that happy &quot;snap&quot; feeling as you get the concept.
</I>
It does seem to be a bit disconnected from the flow of the regular text.  Perhaps it would be better if it were laid out as a paragraph, and then each sentence, or clause, were examined more closely, perhaps with an accompanying code snippet to clarify it.

&gt;&gt;<i> What's an &quot;operation&quot;?  Does that mean 'function' or 'method' or some other
</I>&gt;&gt;<i> special thing?  It says &quot;most operations in Twisted return a Deferred&quot;; but
</I>&gt;&gt;<i> I've called lots of functions in Twisted which returned other objects before
</I>&gt;&gt;<i> reading this tutorial, or returned None.  Were those actually Deferreds?
</I>&gt;<i> 
</I>&gt;<i> Yeah, I need to reword that. How about, &quot;because Deferreds are a core
</I>&gt;<i> part of Twisted, a lot of functions return them&quot;? No... that's not
</I>&gt;<i> good either.
</I>
That's closer, but it should be something more specific than &quot;a lot&quot;.
&gt;<i> 
</I>&gt;&gt;<i> Instead, the &quot;fixup&quot; changes the first example to rely on a fake library,
</I>&gt;&gt;<i> which will raise exceptions if I try to run it, but doesn't actually explain
</I>&gt;&gt;<i> that 'magiclib' isn't real.  This isn't a huge problem in and of itself (it
</I>&gt;&gt;<i> is trying to demonstrate the &quot;wrong&quot; way to do things, after all) but it
</I>&gt;&gt;<i> sets up the expectation that the rest of the examples are fake, too, and I
</I>&gt;&gt;<i> shouldn't bother to run them.
</I>&gt;<i> 
</I>&gt;<i> Right now, it's a placeholder for that magic library that I haven't found yet.
</I>
I can see why you might want to do that.  In the narrative flow between urllib and Deferreds, there is a missing step; you may need to fake that out.  I'm just saying that you should be very clear and say &quot;this is a fake example, merely for the purpose of illustration&quot;.  I think that Tornado has some ugly callback-based stuff, but it would be better to leave this example fake than to try to teach users how to use that.

&gt;&gt;<i> I think the original document has plenty of issues, but these changes look
</I>&gt;&gt;<i> like they've been written for people who already mostly understand
</I>&gt;&gt;<i> Deferreds, but are having trouble catching some of the nuances, and need
</I>&gt;&gt;<i> humor to diffuse their frustration and more examples to illustrate different
</I>&gt;&gt;<i> usage patterns, rather than a fundamentally clearer or better explanation
</I>&gt;&gt;<i> than what was offered before.
</I>&gt;<i> 
</I>&gt;<i> *IMPORTANT*
</I>&gt;<i> 
</I>&gt;<i> Are there specific changes you find that could make it harder to read
</I>&gt;<i> for newcomers?
</I>
I thought my previous message was a list of those :-(

&gt;<i> The concept of Deferreds isn't hard at all, once you understand what
</I>&gt;<i> they are. The subtle nuances and bits of glue code that Twisted are
</I>&gt;<i> the things that can trip someone up, and what I'm still learning. A
</I>&gt;<i> small amount of very specific use cases for Deferreds happen in
</I>&gt;<i> real-world code and I'd like to show the support that Twisted has for
</I>&gt;<i> them built-in.
</I>&gt;<i> 
</I>&gt;<i> My goals for this document are:
</I>&gt;<i> 
</I>&gt;<i>  1) A list of guaranteed rules about Deferreds for reference at any time.
</I>&gt;<i>  2) An introduction to those rules in a format that doesn't require
</I>&gt;<i> knowledge of others.
</I>&gt;<i>  3) Showing techniques or tricks that you can play by &quot;exploiting&quot;
</I>&gt;<i> parts of those rules in the context of a contrived problem.
</I>&gt;<i>  4) Showing the built-in support for it.
</I>
My first goal for this document would be a clear, concise explanation of what a Deferred is and why you need it.

&gt;<i> This should help clear up my writing style a bit. I think in terms of
</I>&gt;<i> separating abstraction layers; I always try separate a fact or rule
</I>&gt;<i> from logic or a technique that can follow when you can exploit that
</I>&gt;<i> fact (feel free to ask the people about 'evolution' in
</I>&gt;<i> #python-offtopic). I also try to think of the code being very linear
</I>&gt;<i> when it evolves: a new rule is added, you have a problem, you can
</I>&gt;<i> exploit that rule with a specific technique, the technique is
</I>&gt;<i> standardized.
</I>&gt;<i> 
</I>&gt;<i> Example A:
</I>&gt;<i>  PROBLEM: You need to create a Deferred with a known result
</I>&gt;<i>  RULE: Callbacks will continue running after you've called &quot;callback&quot;
</I>&gt;<i> or &quot;errback&quot;
</I>&gt;<i>  TECHNIQUE: You can create a Deferred, call 'callback' on it and
</I>&gt;<i> return it, without any tricky business
</I>&gt;<i>  STANDARDIZED: twisted.internet.defer.success
</I>&gt;<i> 
</I>&gt;<i> Example B:
</I>&gt;<i>  PROBLEM: You need to get the results from multiple Deferreds without
</I>&gt;<i> blocking or too much linearity
</I>&gt;<i>  RULE: More than one Deferred can be created and 'run' at the same time
</I>&gt;<i>  TECHNIQUE: You can add a callback to a Deferred, take the result you
</I>&gt;<i> get and save it in a list or dictionary
</I>&gt;<i>  STANDARDIZED: DeferredList, gatherResults
</I>
These seem more like recipes to me than introductory documentation.  Maybe they should be really close together, to try to drive the concept home, but it would be good to really get it clear in the reader's mind why they fundamentally need Deferreds, then to cover all the subtle different ways you might need them and how you could use them.

&gt;<i> The hardest part is creating simple, short, runnable code that
</I>&gt;<i> introduces: a problem that doesn't seem silly, a rule that guides
</I>&gt;<i> toward the solution, the technique that uses the rule to solve it. It
</I>&gt;<i> was much easier when I could contrive examples of a network-enabled
</I>&gt;<i> kitchen: recipes map pretty well to code, especially Twisted async:
</I>&gt;<i> 
</I>&gt;<i>  1) Melt butter in a saucepan. When the butter is finished melting,
</I>&gt;<i> put cocoa powder in.
</I>&gt;<i>  2) Meanwhile, beat egg whites and sugar, and cream of tartar.
</I>&gt;<i>  3) When both are done, put the chocolate mix in a Cuisinart, and
</I>&gt;<i> fold in the egg whites.
</I>&gt;<i> 
</I>&gt;<i> Here you have dependencies (butter needs to be melted before cocoa
</I>&gt;<i> powder), multi-tasking (you don't want to wait for the butter while
</I>&gt;<i> beating the eggs), and a way of knowing when things are done (so you
</I>&gt;<i> can fold them into the cuisinart).
</I>&gt;<i> 
</I>&gt;<i> ( Also, this is a real recipe, ableit simplified and it makes really
</I>&gt;<i> easy, delicious chocolate mousse:
</I>&gt;<i> <A HREF="http://articles.latimes.com/2008/feb/13/food/la-fo-watch13recafeb13">http://articles.latimes.com/2008/feb/13/food/la-fo-watch13recafeb13</A> )
</I>
This looks like a fantastic example.  It's comprehensible, concrete, not too long, and involves a strict metaphor for a real world situation, without mixing in any obscure technology.  I would be happy if the entire Deferred tutorial were to be structured around it.

You could also tweak it to introduce additional concepts.  For example, errbacks: &quot;If the butter burns...&quot;.

&gt;&gt;<i> That makes sense, since based on what you've
</I>&gt;&gt;<i> said on #twisted, that's basically the position you find yourself in :).
</I>&gt;&gt;<i>  This document is supposed to be a tutorial though, explaining how to use
</I>&gt;&gt;<i> Deferreds to users who really have no idea what they are (despite its
</I>&gt;&gt;<i> unfortunate name, &quot;Deferred Reference&quot; - that should probably be changed).
</I>&gt;&gt;<i> One thing I think is very good about this attempted rework, though, is the
</I>&gt;&gt;<i> explanation of the motivation for having Deferreds at all, before explaining
</I>&gt;&gt;<i> how they work.  In the current documentation, it's very unclear why we have
</I>&gt;&gt;<i> such an object in the first place, or what the alternatives to it are.
</I>&gt;<i> 
</I>&gt;<i> Once I *knew* what a Deferred was, the other pieces started snapping into place.
</I>
So it sounds like we're in agreement here: the existing document isn't clear enough about exactly what a Deferred is, it's described too formally and its uses aren't clear enough before we start diving into the technical specifics.  Any modification should strive to make it super clear what it is and why you use it.

&gt;&gt;<i> However, the example presented makes it seem as though you really don't
</I>&gt;&gt;<i> need Deferreds, because the only problem with the single-callback approach
</I>&gt;&gt;<i> is handling errors. Another major motivation is the ability to return a
</I>&gt;&gt;<i> Deferred through a system with several layers, changing the return value at
</I>&gt;&gt;<i> each layer by post-processing it a bit.  (One possible example: a REST API
</I>&gt;&gt;<i> that wants to deal with objects, and goes via a translation of [bytes from
</I>&gt;&gt;<i> HTTP]-&gt;[JSON dicts/lists from parsing those bytes]-&gt;[domain-specific objects
</I>&gt;&gt;<i> by converting JSON objects according to the particular API's spec].)
</I>&gt;<i> 
</I>&gt;<i> I never really thought about it before. I just realized right now,
</I>&gt;<i> writing this email, that things like DeferredList aren't cleanly
</I>&gt;<i> possible if the callback is tied to the request.
</I>&gt;<i> 
</I>&gt;<i> Additionally, is the showcase of this in the fixup with &quot;Multiple
</I>&gt;<i> Callbacks&quot; I did fine? The SQL to HTML example that was there before
</I>&gt;<i> seemed a bit contrived, and I wanted to showcase it in a runnable
</I>&gt;<i> snippet that required Twisted. We can't have them install a SQL
</I>&gt;<i> server, so I used xml.minidom instead of lxml, even though know it's
</I>&gt;<i> complete crap. When I'm done, I should replace the www.example.com
</I>&gt;<i> URLs with files hosted on the Twisted doc site. Is there a way to
</I>&gt;<i> point to generate a URL like that with Lore?
</I>
Use 'localhost' URLs and have the user run a 'twistd web' command line for their server; that should be simple enough :).

&gt;&gt;<i> However, I think the need would be better illustrated with examples that can
</I>&gt;&gt;<i> actually be run than with fake examples where we assume that the user knows
</I>&gt;&gt;<i> how something like gevent works.  (Also: gevent doesn't actually work this
</I>&gt;&gt;<i> way, for fetching web pages at least, so your example is wrong.  See
</I>&gt;&gt;<i> &lt;<A HREF="http://www.gevent.org/intro.html#monkey-patching">http://www.gevent.org/intro.html#monkey-patching</A>&gt;.)
</I>&gt;<i> 
</I>&gt;<i> I've replaced them with &quot;Library A&quot; and &quot;Library B&quot; placeholders. :)
</I>
I'm still not really sure you need to talk about other libraries at all, especially not this early in the document.

&gt;&gt;<i> It's pretty easy to write a fake implementation of 'fetchWebPageAsync' which
</I>&gt;&gt;<i> squirrels away the callback somewhere that the example can call it later,
</I>&gt;&gt;<i> and explain that with some handwaving where we say &quot;and pretend that was
</I>&gt;&gt;<i> actually some networking code fetching it&quot;.  For that matter, the reactor is
</I>&gt;&gt;<i> introduced too early in the existing docs; we should demonstrate calling the
</I>&gt;&gt;<i> callback synchronously, and then only later introduce a callLater.
</I>&gt;<i> 
</I>&gt;<i> I ripped out all the reactor code in the starting sections of the
</I>&gt;<i> fixup on purpose, and showcased it with what I think is a clear
</I>&gt;<i> example. When introducing the techniques afterwards, I'm going to
</I>&gt;<i> gently ramp up the reactor code to be a bit more real-world.
</I>&gt;<i> 
</I>&gt;&gt;<i> Anyway I hope this wall of text did not discourage you - I just think you
</I>&gt;&gt;<i> need some clearer goals for improving specific aspects of the documentation,
</I>&gt;&gt;<i> and you should write those down first before trying to actually address them
</I>&gt;&gt;<i> with more docs.
</I>&gt;<i> 
</I>&gt;<i> This email did exactly that. Thanks so much!
</I>&gt;<i> 
</I>&gt;<i> P.S. I still have a *lot* to learn. Some tutoring on the subtleties of
</I>&gt;<i> LoopingCall and coiterator/cooperator would be nice. I'm not going to
</I>&gt;<i> even bother to try to explain how inlineCallbacks works to my brain
</I>&gt;<i> right now. I've said enough erroneous fact in IRC. I'm going to need a
</I>&gt;<i> lot more help in the future.
</I>
Great.  I look forward to it :).

&gt;&gt;<i> Thanks for your time,
</I>&gt;<i> 
</I>&gt;<i> I appreciate your time a lot more. You have things to do. I don't.
</I>
I am a pretty busy guy, but Twisted is open source and community driven: you've got just as many bugs to fix in it as I do ;-).

Please feel free to snip heavily in any replies; anywhere that you feel we've reached an agreement doesn't need more quoting.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20110327/cd03bf3a/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056220.html">[Twisted-Python] Deferred documentation.
</A></li>
	<LI>Next message (by thread): <A HREF="056236.html">[Twisted-Python] Deferred documentation.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56230">[ date ]</a>
              <a href="thread.html#56230">[ thread ]</a>
              <a href="subject.html#56230">[ subject ]</a>
              <a href="author.html#56230">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
