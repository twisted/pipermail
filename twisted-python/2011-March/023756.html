<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Failure is O(state) vs Exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Failure%20is%20O%28state%29%20vs%20Exception&In-Reply-To=4D909ED2.1010300%40arbash-meinel.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023755.html">
   <LINK REL="Next"  HREF="023757.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Failure is O(state) vs Exception</H1>
    <B>Christopher Armstrong</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Failure%20is%20O%28state%29%20vs%20Exception&In-Reply-To=4D909ED2.1010300%40arbash-meinel.com"
       TITLE="[Twisted-Python] Failure is O(state) vs Exception">radix at twistedmatrix.com
       </A><BR>
    <I>Mon Mar 28 11:02:15 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023755.html">[Twisted-Python] Failure is O(state) vs Exception
</A></li>
        <LI>Next message: <A HREF="023757.html">[Twisted-Python] Failure is O(state) vs Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23756">[ date ]</a>
              <a href="thread.html#23756">[ thread ]</a>
              <a href="subject.html#23756">[ subject ]</a>
              <a href="author.html#23756">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Mar 28, 2011 at 9:44 AM, John Arbash Meinel
&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">john at arbash-meinel.com</A>&gt;wrote:

&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> I'm doing some performance testing of one of our Twisted applications.
</I>&gt;<i> And what I came across was a surprising amount of time being spent in
</I>&gt;<i> twisted.python.failure.Failure.__getstate__
</I>&gt;<i>
</I>&gt;<i> So under profiling, we spent 408ms in __getstate__. I then changed
</I>&gt;<i> Failure.cleanFailure to just 'return', and I saw a real-world
</I>&gt;<i> improvement of ~480ms down to about 240ms. I then restored cleanFailure,
</I>&gt;<i> but changed Failure.__init__ to always set 'tb=None' before it does
</I>&gt;<i> anything. And in that case the time went down to 180ms. (And when I dug
</I>&gt;<i> into it, 150ms of that is time spent waiting for an XMLRPC response.)
</I>&gt;<i>
</I>&gt;<i>
</I>Just for the record, changing cleanFailure to not do its operation is likely
to lead to big memory leaks. The second thing you did, setting self.tb to
None, makes more sense to speed things up.



&gt;<i> I'm wondering if there is a tasteful way to disable Traceback processing
</I>&gt;<i> in a production machine. I realize you never know when you are going to
</I>&gt;<i> need the state in order to figure out what went wrong. But it is costing
</I>&gt;<i> 2-5x runtime speed. (The other answer is to write all of our code to
</I>&gt;<i> avoid Deferred.addErrback...)
</I>&gt;<i>
</I>

I hate to mention it (since it's unlikely I'd be able to work on it), but I
wonder how much a C extension would improve this without going the full step
of throwing out the debug data.

-- 
Christopher Armstrong
<A HREF="http://radix.twistedmatrix.com/">http://radix.twistedmatrix.com/</A>
<A HREF="http://planet-if.com/">http://planet-if.com/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20110328/73e41df0/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20110328/73e41df0/attachment.htm</A> 
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023755.html">[Twisted-Python] Failure is O(state) vs Exception
</A></li>
	<LI>Next message: <A HREF="023757.html">[Twisted-Python] Failure is O(state) vs Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23756">[ date ]</a>
              <a href="thread.html#23756">[ thread ]</a>
              <a href="subject.html#23756">[ subject ]</a>
              <a href="author.html#23756">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
