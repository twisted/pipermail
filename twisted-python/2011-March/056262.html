<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Failure is O(state) vs Exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Failure%20is%20O%28state%29%20vs%20Exception&In-Reply-To=%3C20110330091411.GE2777%40aihal.home.puzzling.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056261.html">
   <LINK REL="Next"  HREF="056273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Failure is O(state) vs Exception</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Failure%20is%20O%28state%29%20vs%20Exception&In-Reply-To=%3C20110330091411.GE2777%40aihal.home.puzzling.org%3E"
       TITLE="[Twisted-Python] Failure is O(state) vs Exception">andrew at bemusement.org
       </A><BR>
    <I>Wed Mar 30 03:14:11 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056261.html">[Twisted-Python] Failure is O(state) vs Exception
</A></li>
        <LI>Next message (by thread): <A HREF="056273.html">[Twisted-Python] Failure is O(state) vs Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56262">[ date ]</a>
              <a href="thread.html#56262">[ thread ]</a>
              <a href="subject.html#56262">[ subject ]</a>
              <a href="author.html#56262">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>John Arbash Meinel wrote:
[…]
&gt;<i> I think walking the frames and copying the dicts is also expensive. That
</I>&gt;<i> is what the bug you linked to me was about. (First, walking everything
</I>&gt;<i> and using __dict__.copy() was a bit expensive, and second that the
</I>&gt;<i> safe_repr() calls were turning 1GB strings into a new 1GB+ string.)
</I>
Well, if we take my proposal to not (by default at least) capture the
frames in the first place this isn't an issue is it?  The only other
copy done in Failure is the copy of self.__dict__ in __getstate__, which
is just a shallow copy of one dict, so fairly cheap.

&gt;<i> The one other step that I think we need, is that 'maybeDeferred' also
</I>&gt;<i> always traps into a Failure object, and we'd want that to check
</I>&gt;<i> Deferred.debug first.
</I>
Good point!

&gt;<i> I do wonder if Failure should just be checking Deferred.debug before
</I>&gt;<i> automatically including a traceback. I'm not really sure about logical
</I>&gt;<i> layering of twisted modules, though. Certainly 'twisted.python.failure'
</I>&gt;<i> seems a lower layer than 'twisted.internet.defer'.
</I>
Yes, checking Deferred.debug in twisted.python.failure would be bad
layering.  twisted.internet.defer only invokes Failure in a couple of
places, so it's not so onerous to make sure it invokes it to avoid
capturing tracebacks unless it means to.

That said, it might be a good idea to change Failure to *not* capture
tracebacks by default when invoked as Failure().  Perhaps add a
setDebugging toggle to twisted.python.failure too.  If an explicit
traceback is passed to the constructor it would still be captured, and
perhaps provide an alternative constructor for the current “capture
everything” behaviour (perhaps via a new optional flag for __init__,
perhaps via a new name DetailedFailure(), perhaps via a classmethod
except failure is not a new-style class and can't be one without
changing to subclass Exception…) for the rare cases when people want
that.  It's a pity you can't just use Failure(*sys.exc_info()) because
the parameters are in the wrong order.

Certainly the current behaviour of doing a costly capturing of traceback
and frame contents seems like the wrong default, given how rarely I've
seen anyone use Failure.printDetailedTraceback.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056261.html">[Twisted-Python] Failure is O(state) vs Exception
</A></li>
	<LI>Next message (by thread): <A HREF="056273.html">[Twisted-Python] Failure is O(state) vs Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56262">[ date ]</a>
              <a href="thread.html#56262">[ thread ]</a>
              <a href="subject.html#56262">[ subject ]</a>
              <a href="author.html#56262">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
