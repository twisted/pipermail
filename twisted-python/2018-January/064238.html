<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] logObservers and syslog proposal
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20logObservers%20and%20syslog%20proposal&In-Reply-To=%3CF5DC9817-9154-43CA-9152-3E4CA4238FBD%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031776.html">
   <LINK REL="Next"  HREF="031779.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] logObservers and syslog proposal</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20logObservers%20and%20syslog%20proposal&In-Reply-To=%3CF5DC9817-9154-43CA-9152-3E4CA4238FBD%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] logObservers and syslog proposal">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Jan  4 23:21:16 MST 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031776.html">[Twisted-Python] logObservers and syslog proposal
</A></li>
        <LI>Next message (by thread): <A HREF="031779.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64238">[ date ]</a>
              <a href="thread.html#64238">[ thread ]</a>
              <a href="subject.html#64238">[ subject ]</a>
              <a href="author.html#64238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> On Jan 4, 2018, at 11:07 AM, Svein Seldal &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sveinse at seldal.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I'm currently working on understanding the twister.logger scheme with the purpose of getting proper logging in my end-user application.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://gist.github.com/sveinse/041c69b6bbdde83cf5b00fecae3dcd50">https://gist.github.com/sveinse/041c69b6bbdde83cf5b00fecae3dcd50</A>
</I>&gt;<i> 
</I>&gt;<i> It took me a while to get my head around the difference in using
</I>&gt;<i> twisted.logger.globalLogBeginner.beginLoggingTo() vs using twisted.logger.globalLogPublisher.addObserver(). Neither of the methods behave precisely as I'd like them to. See <A HREF="https://gist.github.com/sveinse/041c69b6bbdde83cf5b00fecae3dcd50#file-log-py-L99">https://gist.github.com/sveinse/041c69b6bbdde83cf5b00fecae3dcd50#file-log-py-L99</A> &lt;<A HREF="https://gist.github.com/sveinse/041c69b6bbdde83cf5b00fecae3dcd50#file-log-py-L99">https://gist.github.com/sveinse/041c69b6bbdde83cf5b00fecae3dcd50#file-log-py-L99</A>&gt;
</I>
The comment here:

&gt;&gt;<i> any errors in the observers will be silently ignored because the observers are no longer run through the LogPublisher()
</I>
is incorrect.  If you're seeing errors being ignored, it's a bug.  However, the specific claim that &quot;the observers are no longer run through the LogPublisher&quot; is definitely wrong.  See the implementation here: <A HREF="https://github.com/twisted/twisted/blob/8b5865cda742b7d727f97cdec4b9e83974d57c94/src/twisted/logger/_global.py#L142">https://github.com/twisted/twisted/blob/8b5865cda742b7d727f97cdec4b9e83974d57c94/src/twisted/logger/_global.py#L142</A> &lt;<A HREF="https://github.com/twisted/twisted/blob/8b5865cda742b7d727f97cdec4b9e83974d57c94/src/twisted/logger/_global.py#L142">https://github.com/twisted/twisted/blob/8b5865cda742b7d727f97cdec4b9e83974d57c94/src/twisted/logger/_global.py#L142</A>&gt;

Note in that implementation that the `self._publisher` being replayed to is precisely the LogPublisher, with all the new observers added to it.  Errors should be handled as normal.

Perhaps this is not happening in the correct order with the LoggingFile replacements for stdin/stdout/stderr, and should be taking place later?

&gt;<i> 1)
</I>&gt;<i> What are the intended difference between these two ways of installing a logobserver?
</I>
beginLoggingTo is meant to be the thing that you do at program start-up to take over from the boot-time buffering log observer.

addObserver is meant to be the thing that you do at any time during a program's run to add an observer for whatever other reason.

While the exact difference depends upon your application, in general, if you're setting up the &quot;main&quot; log observer for your process, you should probably be doing it with beginLoggingTo.

&gt;<i> 2)
</I>&gt;<i> I'd like to contribute a SyslogObserver for the new twister.logger scheme. See the _syslog.py file in the gist. It has been ported from the old logging scheme. Would this be useful to Twisted?
</I>
Absolutely!

&gt;<i> I was uncertain what to do with log_failures in the observer. I see that dumping of log_failures has been removed from t.l.FileLogObserver(). What is the appropriate way to deal with log_failures?
</I>
Given that syslog is ultimately an unstructured / text-based format, you probably want to do something similar to what formatEventAsClassicLogText does here: <A HREF="https://github.com/twisted/twisted/blob/8b5865cda742b7d727f97cdec4b9e83974d57c94/src/twisted/logger/_format.py#L192-L198">https://github.com/twisted/twisted/blob/8b5865cda742b7d727f97cdec4b9e83974d57c94/src/twisted/logger/_format.py#L192-L198</A> &lt;<A HREF="https://github.com/twisted/twisted/blob/8b5865cda742b7d727f97cdec4b9e83974d57c94/src/twisted/logger/_format.py#L192-L198">https://github.com/twisted/twisted/blob/8b5865cda742b7d727f97cdec4b9e83974d57c94/src/twisted/logger/_format.py#L192-L198</A>&gt;.

&gt;<i> In the proposal of SyslogObserver I addded a dumpTraceback option to the constructor to select if the tb should go to the syslog or not. (My application shall have tb to syslog.)
</I>
And, now that I look at your code, I can see that it's almost doing more or less exactly what I suggested with respect to log_failure, so, there you go, you're already doing it right :-).  I'd probably default dumpTraceback to true - you probably do want to see tracebacks, if they're happening, and syslog is your primary log observer.

Thanks for using Twisted and thanks even more for your interest in improving our log tooling!

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20180104/523961fa/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031776.html">[Twisted-Python] logObservers and syslog proposal
</A></li>
	<LI>Next message (by thread): <A HREF="031779.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64238">[ date ]</a>
              <a href="thread.html#64238">[ thread ]</a>
              <a href="subject.html#64238">[ subject ]</a>
              <a href="author.html#64238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
