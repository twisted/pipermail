<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stdlib logger, loggerFor and filtering events
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stdlib%20logger%2C%20loggerFor%20and%20filtering%20events&In-Reply-To=%3C3637E91C-9EDF-48B1-AA90-F8A21F71F084%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031779.html">
   <LINK REL="Next"  HREF="064257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stdlib logger, loggerFor and filtering events</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stdlib%20logger%2C%20loggerFor%20and%20filtering%20events&In-Reply-To=%3C3637E91C-9EDF-48B1-AA90-F8A21F71F084%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] stdlib logger, loggerFor and filtering events">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Jan  5 22:00:41 MST 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031779.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
        <LI>Next message (by thread): <A HREF="064257.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64242">[ date ]</a>
              <a href="thread.html#64242">[ thread ]</a>
              <a href="subject.html#64242">[ subject ]</a>
              <a href="author.html#64242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> On Jan 5, 2018, at 7:11 PM, Felipe Dau &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dau at riseup.net</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> As the logger has been brought up, I'd like to ask a couple things:
</I>

Just for the record, you don't need to wait for it to be brought up before asking other questions ;-).

&gt;<i> 1) When I was working on adding logs to an application, I wanted it to
</I>&gt;<i> use both the `textFileLogObserver` and the `STDLibLogObserver`. As the
</I>&gt;<i> application could be used either with its CLI or GUI, it seemed
</I>&gt;<i> interesting to have both these loggers available. I was able to do
</I>&gt;<i> that but I wanted them to have the same format - specifically, I
</I>&gt;<i> wanted to use the file's format (which is awesome btw) - and had to
</I>&gt;<i> override some parts of the `STDLibLogObserver`. It would have made
</I>&gt;<i> things a lot simpler if that observer accepted a function to format
</I>&gt;<i> events like the `FileLogObserver`.
</I>
It might be cool to add that, but, if you don't want the standard library's log format, why are you using the standard library log observer?  And wouldn't this be a job for a <A HREF="https://docs.python.org/3.6/library/logging.html#logging.Formatter">https://docs.python.org/3.6/library/logging.html#logging.Formatter</A> &lt;<A HREF="https://docs.python.org/3.6/library/logging.html#logging.Formatter">https://docs.python.org/3.6/library/logging.html#logging.Formatter</A>&gt; object in any case; what Twisted should be doing is sending the logs on in a more structured format that works with that?

&gt;<i> 2) Why is `_loggerFor` &quot;private/hidden&quot;? That is a great factory which
</I>&gt;<i> imo should have more visibility - and also works great with attrs!:
</I>&gt;<i> 
</I>&gt;<i>     attr.ib(default=attr.Factory(_loggerFor, takes_self=True))
</I>
I'm honestly not sure why this exists at all.  It seems like a terrible mistake has happened here, since `_loggerFor` is actually exported in __all__, which should never ever happen.

From what I can tell, it should be removed, since rather than creating that fairly noisy attr.ib() definition, you could do this:

    _log = Logger()

which is a lot more succinct, and has exactly the same effect (do `self._log.info &lt;<A HREF="http://log.info/">http://log.info/</A>&gt;(...)`) and there you have it.

If you could explain why it's great, then maybe we could remove the underscore and add it to the docs.

&gt;<i> 3) Is there a way to suppress logs from libs or any other code that
</I>&gt;<i> is not your own? In my case, I had to manually set which namespaces
</I>&gt;<i> I wanted to filter but, for example, when you subclass a third-party's
</I>&gt;<i> class which logs something, that will pass because now it belongs to
</I>&gt;<i> one of your namespaces. I know it sounds crazy but wanted to know what
</I>&gt;<i> other people think.
</I>
Absolutely!  Super glad you brought this up. This was a major part of the design of the new logging system, both to do this, and to also do as little work as possible with messages that were ultimately caught by such filters.

Here's a quick example program demonstrating the combination of <A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html</A>&gt; and <A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html</A>&gt;.

import sys
from twisted.logger import (Logger, FilteringLogObserver,
                            LogLevelFilterPredicate, globalLogBeginner,
                            LogLevel, textFileLogObserver)

alog = Logger(namespace=&quot;a&quot;)
blog = Logger(namespace=&quot;b&quot;)

predicate = LogLevelFilterPredicate()
predicate.setLogLevelForNamespace(&quot;a&quot;, LogLevel.debug)
predicate.setLogLevelForNamespace(&quot;b&quot;, LogLevel.warn)

globalLogBeginner.beginLoggingTo(
    [FilteringLogObserver(textFileLogObserver(sys.stdout), [predicate])]
)

alog.info(&quot;one&quot;)
blog.info(&quot;two&quot;)
alog.critical(&quot;three&quot;)
blog.critical(&quot;four&quot;)


&gt;<i> If any of these changes sound like they would be useful apart from the
</I>&gt;<i> specific requirements of that application, I could help implement
</I>&gt;<i> something based on what I wrote [0].
</I>
We'd certainly be interested in contributions to the logging subsystem!  But I'd probably want to hear a little more about how and why you thought these things were useful first.

-g

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20180105/edaab9dc/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031779.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
	<LI>Next message (by thread): <A HREF="064257.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64242">[ date ]</a>
              <a href="thread.html#64242">[ thread ]</a>
              <a href="subject.html#64242">[ subject ]</a>
              <a href="author.html#64242">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
