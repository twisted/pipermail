<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stdlib logger, loggerFor and filtering events
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stdlib%20logger%2C%20loggerFor%20and%20filtering%20events&In-Reply-To=%3C20180115003417.GA10333%40host.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031781.html">
   <LINK REL="Next"  HREF="031797.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stdlib logger, loggerFor and filtering events</H1>
    <B>Felipe Dau</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stdlib%20logger%2C%20loggerFor%20and%20filtering%20events&In-Reply-To=%3C20180115003417.GA10333%40host.localdomain%3E"
       TITLE="[Twisted-Python] stdlib logger, loggerFor and filtering events">dau at riseup.net
       </A><BR>
    <I>Sun Jan 14 17:34:23 MST 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031781.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
        <LI>Next message (by thread): <A HREF="031797.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31796">[ date ]</a>
              <a href="thread.html#31796">[ thread ]</a>
              <a href="subject.html#31796">[ subject ]</a>
              <a href="author.html#31796">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Jan 05, 2018 at 09:00:41PM -0800, Glyph wrote:
&gt;<i> Just for the record, you don't need to wait for it to be brought up before asking other questions ;-).
</I>
Thanks Glyph, I should have asked these a while ago.

&gt;<i> It might be cool to add that, but, if you don't want the standard library's log format, why are you using the standard library log observer?  And wouldn't this be a job for a <A HREF="https://docs.python.org/3.6/library/logging.html#logging.Formatter">https://docs.python.org/3.6/library/logging.html#logging.Formatter</A> &lt;<A HREF="https://docs.python.org/3.6/library/logging.html#logging.Formatter">https://docs.python.org/3.6/library/logging.html#logging.Formatter</A>&gt; object in any case; what Twisted should be doing is sending the logs on in a more structured format that works with that?
</I>
Honestly, I just wanted to display something to stdout (when using the
GUI) and using stdlib's looked like the right way to do that, but
using sys.stdout directly like in your example below would work as
well. And now that I am looking again at what I did, it is probably
the worst thing to do if you are trying to integrate something: set
the message text to the actual formatted text and set the format to
just '%(message)s'. Anything else that used stdlib's would only
contain the message, losing all the rest of the info.

Considering that I just really wanted to display the logs, is there
any advantage on using stdlib's? If so, I would then use the Formatter
as you pointed out, otherwise, I would just pass it to sys.stdout. In
both cases, there wouldn't be a need to pass an event formatter like I
wanted to. Thanks!

&gt;<i> I'm honestly not sure why this exists at all.  It seems like a terrible mistake has happened here, since `_loggerFor` is actually exported in __all__, which should never ever happen.
</I>&gt;<i> 
</I>&gt;<i> From what I can tell, it should be removed, since rather than creating that fairly noisy attr.ib() definition, you could do this:
</I>&gt;<i> 
</I>&gt;<i>     _log = Logger()
</I>&gt;<i> 
</I>&gt;<i> which is a lot more succinct, and has exactly the same effect (do `self._log.info &lt;<A HREF="http://log.info/">http://log.info/</A>&gt;(...)`) and there you have it.
</I>&gt;<i> 
</I>&gt;<i> If you could explain why it's great, then maybe we could remove the underscore and add it to the docs.
</I>
It is indeed a lot more succinct! The reason I used _loggerFor is that
it creates a logger for any instance it receives. That way, it can
set the namespace automatically when instantiated inside any method of
a class - the constructor, for example. I just do not remember why
creating a separate logger for each instance instead of sharing the
class'. Would there be a reason for that?

But I do think that if you would like to log something but not keep
the instance around, _loggerFor may be useful, as Logger would only
set the namespace based on the module when called from a method.

&gt;<i> Absolutely!  Super glad you brought this up. This was a major part of the design of the new logging system, both to do this, and to also do as little work as possible with messages that were ultimately caught by such filters.
</I>&gt;<i> 
</I>&gt;<i> Here's a quick example program demonstrating the combination of <A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html</A>&gt; and <A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html</A>&gt;.
</I>
Thanks for the example! Unfortunately I think that is different from
what I tried to describe. Here is an example:

    class ThirdPartyClass:
        a_log = Logger()

        def method_a(self):
            self.a_log.info('Log I want to supress')

            self.a_log.warn('Log I do not want to supress')

    class MyClass(ThirdPartyClass):
        b_log = Logger()

        def method_b(self):
            self.method_a()

            self.b_log.info('Log I do not want to supress')


    MyClass().method_b()

Considering that the class definitions would be in separate files,
they would still have the same namespaces. This would be a case where
the libraries you are using are a bit noisy and you would just want to
display warnings+.

I believe that as there is a reference to a_log, it would be possible
to change the namespace, but if the third party class used
_loggerFor().info() instead, then that would not be possible, right?

This actually happens with Factory.doStart() [0] once that is
subclassed, you cannot differ its  namespace from your class'.

These would be situations where very few people would come across or
maybe I still have to learn more about the logging system, but I
thought it would be worth to be discussed.

Thanks,
-Felipe

[0]: <A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/internet/protocol.py#L75">https://github.com/twisted/twisted/blob/trunk/src/twisted/internet/protocol.py#L75</A>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031781.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
	<LI>Next message (by thread): <A HREF="031797.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31796">[ date ]</a>
              <a href="thread.html#31796">[ thread ]</a>
              <a href="subject.html#31796">[ subject ]</a>
              <a href="author.html#31796">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
