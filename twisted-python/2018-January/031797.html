<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stdlib logger, loggerFor and filtering events
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stdlib%20logger%2C%20loggerFor%20and%20filtering%20events&In-Reply-To=%3CEB16F593-FC25-4F0A-8BB6-4374ABD0FB99%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031796.html">
   <LINK REL="Next"  HREF="031782.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stdlib logger, loggerFor and filtering events</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stdlib%20logger%2C%20loggerFor%20and%20filtering%20events&In-Reply-To=%3CEB16F593-FC25-4F0A-8BB6-4374ABD0FB99%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] stdlib logger, loggerFor and filtering events">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Jan 14 23:07:46 MST 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031796.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
        <LI>Next message (by thread): <A HREF="031782.html">[Twisted-Python] Twisted.logger on windows max recursion depth	exceeded
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31797">[ date ]</a>
              <a href="thread.html#31797">[ thread ]</a>
              <a href="subject.html#31797">[ subject ]</a>
              <a href="author.html#31797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> On Jan 14, 2018, at 4:34 PM, Felipe Dau &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dau at riseup.net</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Fri, Jan 05, 2018 at 09:00:41PM -0800, Glyph wrote:
</I>&gt;&gt;<i> Just for the record, you don't need to wait for it to be brought up before asking other questions ;-).
</I>&gt;<i> 
</I>&gt;<i> Thanks Glyph, I should have asked these a while ago.
</I>&gt;<i> 
</I>&gt;&gt;<i> It might be cool to add that, but, if you don't want the standard library's log format, why are you using the standard library log observer?  And wouldn't this be a job for a <A HREF="https://docs.python.org/3.6/library/logging.html#logging.Formatter">https://docs.python.org/3.6/library/logging.html#logging.Formatter</A> &lt;<A HREF="https://docs.python.org/3.6/library/logging.html#logging.Formatter">https://docs.python.org/3.6/library/logging.html#logging.Formatter</A>&gt; object in any case; what Twisted should be doing is sending the logs on in a more structured format that works with that?
</I>&gt;<i> 
</I>&gt;<i> Honestly, I just wanted to display something to stdout (when using the
</I>&gt;<i> GUI) and using stdlib's looked like the right way to do that, but
</I>&gt;<i> using sys.stdout directly like in your example below would work as
</I>&gt;<i> well. And now that I am looking again at what I did, it is probably
</I>&gt;<i> the worst thing to do if you are trying to integrate something: set
</I>&gt;<i> the message text to the actual formatted text and set the format to
</I>&gt;<i> just '%(message)s'. Anything else that used stdlib's would only
</I>&gt;<i> contain the message, losing all the rest of the info.
</I>
Yep.

&gt;<i> Considering that I just really wanted to display the logs, is there
</I>&gt;<i> any advantage on using stdlib's? If so, I would then use the Formatter
</I>&gt;<i> as you pointed out, otherwise, I would just pass it to sys.stdout. In
</I>&gt;<i> both cases, there wouldn't be a need to pass an event formatter like I
</I>&gt;<i> wanted to. Thanks!
</I>
I don't think so.  Twisted's will do this just fine (and in fact does it automatically if you're using `twist`, or the older `twistd`).

&gt;<i> 
</I>&gt;&gt;<i> I'm honestly not sure why this exists at all.  It seems like a terrible mistake has happened here, since `_loggerFor` is actually exported in __all__, which should never ever happen.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> From what I can tell, it should be removed, since rather than creating that fairly noisy attr.ib() definition, you could do this:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>    _log = Logger()
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> which is a lot more succinct, and has exactly the same effect (do `self._log.info &lt;<A HREF="http://log.info/">http://log.info/</A>&gt;(...)`) and there you have it.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If you could explain why it's great, then maybe we could remove the underscore and add it to the docs.
</I>&gt;<i> 
</I>&gt;<i> It is indeed a lot more succinct! The reason I used _loggerFor is that
</I>&gt;<i> it creates a logger for any instance it receives. That way, it can
</I>&gt;<i> set the namespace automatically when instantiated inside any method of
</I>&gt;<i> a class - the constructor, for example. I just do not remember why
</I>&gt;<i> creating a separate logger for each instance instead of sharing the
</I>&gt;<i> class'. Would there be a reason for that?
</I>
None that I can think of.

&gt;<i> But I do think that if you would like to log something but not keep
</I>&gt;<i> the instance around, _loggerFor may be useful, as Logger would only
</I>&gt;<i> set the namespace based on the module when called from a method.
</I>&gt;<i> 
</I>&gt;&gt;<i> Absolutely!  Super glad you brought this up. This was a major part of the design of the new logging system, both to do this, and to also do as little work as possible with messages that were ultimately caught by such filters.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Here's a quick example program demonstrating the combination of <A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.LogLevelFilterPredicate.html</A>&gt; and <A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html">https://twistedmatrix.com/documents/17.9.0/api/twisted.logger.FilteringLogObserver.html</A>&gt;.
</I>&gt;<i> 
</I>&gt;<i> Thanks for the example! Unfortunately I think that is different from
</I>&gt;<i> what I tried to describe. Here is an example:
</I>&gt;<i> 
</I>&gt;<i>    class ThirdPartyClass:
</I>&gt;<i>        a_log = Logger()
</I>&gt;<i> 
</I>&gt;<i>        def method_a(self):
</I>&gt;<i>            self.a_log.info('Log I want to supress')
</I>&gt;<i> 
</I>&gt;<i>            self.a_log.warn('Log I do not want to supress')
</I>&gt;<i> 
</I>&gt;<i>    class MyClass(ThirdPartyClass):
</I>&gt;<i>        b_log = Logger()
</I>&gt;<i> 
</I>&gt;<i>        def method_b(self):
</I>&gt;<i>            self.method_a()
</I>&gt;<i> 
</I>&gt;<i>            self.b_log.info('Log I do not want to supress')
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>    MyClass().method_b()
</I>&gt;<i> 
</I>&gt;<i> Considering that the class definitions would be in separate files,
</I>&gt;<i> they would still have the same namespaces. This would be a case where
</I>&gt;<i> the libraries you are using are a bit noisy and you would just want to
</I>&gt;<i> display warnings+.
</I>
Oh, ugh. This is a bug that should be fixed.  a_log really ought to have its namespace set to ThirdPartyClass's namespace, not MyClass.

&gt;<i> I believe that as there is a reference to a_log, it would be possible
</I>&gt;<i> to change the namespace, but if the third party class used
</I>&gt;<i> _loggerFor().info() instead, then that would not be possible, right?
</I>
With the example here, it's at least possible to fix the bug, since the logger can identify where in the MRO it lives.  With _loggerFor, it would not be possible.

&gt;<i> This actually happens with Factory.doStart() [0] once that is
</I>&gt;<i> subclassed, you cannot differ its  namespace from your class'.
</I>
Yeah, let's fix taht.

&gt;<i> These would be situations where very few people would come across or
</I>&gt;<i> maybe I still have to learn more about the logging system, but I
</I>&gt;<i> thought it would be worth to be discussed.
</I>
They absolutely should be discussed!  These types of issues are very important when doing log analysis, which is often a long time after the code is written to emit the messages.

&gt;<i> Thanks,
</I>&gt;<i> -Felipe
</I>&gt;<i> 
</I>&gt;<i> [0]: <A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/internet/protocol.py#L75">https://github.com/twisted/twisted/blob/trunk/src/twisted/internet/protocol.py#L75</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031796.html">[Twisted-Python] stdlib logger, loggerFor and filtering events
</A></li>
	<LI>Next message (by thread): <A HREF="031782.html">[Twisted-Python] Twisted.logger on windows max recursion depth	exceeded
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31797">[ date ]</a>
              <a href="thread.html#31797">[ thread ]</a>
              <a href="subject.html#31797">[ subject ]</a>
              <a href="author.html#31797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
