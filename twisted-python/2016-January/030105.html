<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Stdout from child of ProcessProtocol not	propogating
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Stdout%20from%20child%20of%20ProcessProtocol%20not%0A%09propogating&In-Reply-To=%3Cm2a8o7wheq.fsf%40valheru.db3l.homeip.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030104.html">
   <LINK REL="Next"  HREF="030106.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Stdout from child of ProcessProtocol not	propogating</H1>
    <B>David Bolen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Stdout%20from%20child%20of%20ProcessProtocol%20not%0A%09propogating&In-Reply-To=%3Cm2a8o7wheq.fsf%40valheru.db3l.homeip.net%3E"
       TITLE="[Twisted-Python] Stdout from child of ProcessProtocol not	propogating">db3l.net at gmail.com
       </A><BR>
    <I>Thu Jan 14 22:17:17 MST 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="030104.html">[Twisted-Python] Stdout from child of ProcessProtocol not	propogating
</A></li>
        <LI>Next message: <A HREF="030106.html">[Twisted-Python] Kafka Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30105">[ date ]</a>
              <a href="thread.html#30105">[ thread ]</a>
              <a href="subject.html#30105">[ subject ]</a>
              <a href="author.html#30105">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&quot;Jim Carroll&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jim at carroll.com</A>&gt; writes:

&gt;<i> After you get the CMD.exe prompt, try to launch python.  This is what you'll
</I>&gt;<i>
</I>&gt;<i> see:
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>     Microsoft Windows [Version 6.3.9600]
</I>&gt;<i>
</I>&gt;<i>     (c) 2013 Microsoft Corporation. All rights reserved.
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>     C:\Temp&gt;python
</I>&gt;<i>
</I>&gt;<i>     python
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i> That's it. Hitting enter just drops down to another next blank line. 
</I>
I suspect it's not a Twisted issue as much as a common risk running
programs in a child process under Windows, especially executables using
the standard C RTL with its default stdout buffering behavior.

Do the built-in commands like DIR work ok?  If so, then it's likely that
it isn't that stdout isn't making it back to the client; rather it isn't
even making it to your parent Twisted process.  Usually it's a buffering
or tty detection issue since a Windows child shell won't appear to be a
tty.  I'll note that python behaves the same way you describe when run
from within a cmd shell under Cygwin's ssh server for example.

In python's case, the C RTL is going into fully buffered mode.  You
should eventually get output once enough is generated (~8K) or the
process exits.  You can't control how the child executable will buffer
from the parent unless the executable provides a way.  So how you work
around the issue depends on the actual command being run.

Assuming this is the issue you're running into, using either &quot;python -u&quot;
(if you just need output as it occurs) or &quot;python -i&quot; (for interactive
use) should be a workaround.  Or if you want to avoid clients having to
remember the options, you can install appropriate environment variables
(PYTHONUNBUFFERED or PYTHONINSPECT respectively) into the child process.
But that's Python specific - there's no general solution for all
executables, and there will be some for which you simply can't disable
the buffering.

The other thing you have to watch out for are executables you may run
that actually use the Win32 console API rather than interact with
stdin/stdout.  Or certain methods of character inputs (like Python's
msvcrt.getch).  Again, not a Twisted issue, but you can't interact with
that (unless you jump through some significant hoops).  This shows up
often with password prompts (which want to prevent echoing), curses like
applications, or even in unexpected places for Y/N prompts in some
utilities (like SC's default help, or NET TIME /SET's confirmation).

Of course if you're just implementing the ssh server portion, you should
be able to pretty much punt on it and leave it up to the user to
determine how to best run whatever commands they are using.  The
behavior with your shell should be similar to other remote shell
approaches.

-- David


</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030104.html">[Twisted-Python] Stdout from child of ProcessProtocol not	propogating
</A></li>
	<LI>Next message: <A HREF="030106.html">[Twisted-Python] Kafka Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30105">[ date ]</a>
              <a href="thread.html#30105">[ thread ]</a>
              <a href="subject.html#30105">[ subject ]</a>
              <a href="author.html#30105">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
