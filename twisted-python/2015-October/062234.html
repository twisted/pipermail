<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Testing function with delayed calls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Testing%20function%20with%20delayed%20calls&In-Reply-To=%3CCAOfeCWWTn%3DNRhw0OsC9Fs%3DL8vpyu7rH-qJ0f0fORsSs4QYJgqA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062233.html">
   <LINK REL="Next"  HREF="062235.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Testing function with delayed calls</H1>
    <B>Mashiat Sarker Shakkhar</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Testing%20function%20with%20delayed%20calls&In-Reply-To=%3CCAOfeCWWTn%3DNRhw0OsC9Fs%3DL8vpyu7rH-qJ0f0fORsSs4QYJgqA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Testing function with delayed calls">mashiat.sarker at gmail.com
       </A><BR>
    <I>Fri Oct  2 08:33:53 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062233.html">[Twisted-Python] Testing function with delayed calls
</A></li>
        <LI>Next message (by thread): <A HREF="062235.html">[Twisted-Python] Testing function with delayed calls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62234">[ date ]</a>
              <a href="thread.html#62234">[ thread ]</a>
              <a href="subject.html#62234">[ subject ]</a>
              <a href="author.html#62234">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Oct 1, 2015 at 5:46 PM, Ashwini Oruganti &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ashfall at twistedmatrix.com</A>&gt;
wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Oct 1, 2015 at 1:40 PM, Mashiat Sarker Shakkhar &lt;
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mashiat.sarker at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have a function that uses callLater extensively to schedule a number of
</I>&gt;&gt;<i> different tasks. I don't want to get into the rationale behind such a
</I>&gt;&gt;<i> design, but here is a contrived example which will help me explain my
</I>&gt;&gt;<i> problem:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     def b():
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         '''Do some work'''
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     def c():
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         '''Do some more work'''
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     def a(flag):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         if flag:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>             return Reactor.callLater(300, b)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         else:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>             return Reactor. callLater(100, c)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now I want to test this function. Of course I can't wait for 5 minutes to
</I>&gt;&gt;<i> ensure that `b` or `c` will indeed be called. What I need is some sort of
</I>&gt;&gt;<i> mock clock which lets me fast forward time. Does any such thing exist in
</I>&gt;&gt;<i> Twisted / Trial?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes there is! `MemoryReactorClock.advance`
</I>&gt;<i> <A HREF="https://twistedmatrix.com/documents/current/api/twisted.test.proto_helpers.MemoryReactorClock.html">https://twistedmatrix.com/documents/current/api/twisted.test.proto_helpers.MemoryReactorClock.html</A>
</I>&gt;<i> does this for you.
</I>&gt;<i>
</I>&gt;<i>
</I>HI Ashwini

 Thanks a lot for your response. I did come across MemoryReactorClock
before, but I could not figure out how to use it to test my code. I am
using trial as the test runner, which allows me to pass the name of the
reactor to be used in command line. But MemoryReactorClock is not
available, because it is not in twisted.internet.

The code that I am testing imports reactor from twisted.internet in the
global scope. Do I have to change that and pass a reactor explicitly (say,
as a function parameter) where it is needed? Is there any other way to
change the default reactor to MemoryReactorClock just for running tests?

Going with my previous example, do I have to rewrite the code like
following or is there a better way?

    def b():

        '''Do some work'''


    def c():

        '''Do some more work'''


    def a(myreactor, flag):

        if flag:

            return myreactor.callLater(300, b)

        else:

            return myeactor. callLater(100, c)


I do see this in the documentation:

&gt;<i> New application code should prefer to pass and accept the reactor as a
</I>parameter where it is needed, rather than relying on being able to import
this module to get a reference. This simplifies unit testing ...


But I'd prefer not to change the signature of existing functions.


Regards

Shakkhar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20151002/9fcd1849/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062233.html">[Twisted-Python] Testing function with delayed calls
</A></li>
	<LI>Next message (by thread): <A HREF="062235.html">[Twisted-Python] Testing function with delayed calls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62234">[ date ]</a>
              <a href="thread.html#62234">[ thread ]</a>
              <a href="subject.html#62234">[ subject ]</a>
              <a href="author.html#62234">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
