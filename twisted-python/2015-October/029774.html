<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Testing function with delayed calls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Testing%20function%20with%20delayed%20calls&In-Reply-To=%3C0519CC59-72D9-4613-9300-33839335E3C1%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029773.html">
   <LINK REL="Next"  HREF="029775.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Testing function with delayed calls</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Testing%20function%20with%20delayed%20calls&In-Reply-To=%3C0519CC59-72D9-4613-9300-33839335E3C1%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Testing function with delayed calls">glyph at twistedmatrix.com
       </A><BR>
    <I>Sat Oct  3 04:49:16 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029773.html">[Twisted-Python] Testing function with delayed calls
</A></li>
        <LI>Next message: <A HREF="029775.html">[Twisted-Python] twisted compatibility with multiprocessing	module in fork+execv mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29774">[ date ]</a>
              <a href="thread.html#29774">[ thread ]</a>
              <a href="subject.html#29774">[ subject ]</a>
              <a href="author.html#29774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Oct 2, 2015, at 7:33 AM, Mashiat Sarker Shakkhar &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mashiat.sarker at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Thu, Oct 1, 2015 at 5:46 PM, Ashwini Oruganti &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ashfall at twistedmatrix.com</A> &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ashfall at twistedmatrix.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Thu, Oct 1, 2015 at 1:40 PM, Mashiat Sarker Shakkhar &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mashiat.sarker at gmail.com</A> &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mashiat.sarker at gmail.com</A>&gt;&gt;wrote:
</I>&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I have a function that uses callLater extensively to schedule a number of different tasks. I don't want to get into the rationale behind such a design, but here is a contrived example which will help me explain my problem: 
</I>&gt;<i> 
</I>&gt;<i>     def b():
</I>&gt;<i>         '''Do some work'''
</I>&gt;<i> 
</I>&gt;<i>     def c():
</I>&gt;<i>         '''Do some more work'''
</I>&gt;<i> 
</I>&gt;<i>     def a(flag):
</I>&gt;<i>         if flag:
</I>&gt;<i>             return Reactor.callLater(300, b)
</I>&gt;<i>         else:
</I>&gt;<i>             return Reactor. callLater(100, c)
</I>&gt;<i> 
</I>&gt;<i> Now I want to test this function. Of course I can't wait for 5 minutes to ensure that `b` or `c` will indeed be called. What I need is some sort of mock clock which lets me fast forward time. Does any such thing exist in Twisted / Trial? 
</I>&gt;<i> 
</I>&gt;<i> Yes there is! `MemoryReactorClock.advance` <A HREF="https://twistedmatrix.com/documents/current/api/twisted.test.proto_helpers.MemoryReactorClock.html">https://twistedmatrix.com/documents/current/api/twisted.test.proto_helpers.MemoryReactorClock.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/current/api/twisted.test.proto_helpers.MemoryReactorClock.html">https://twistedmatrix.com/documents/current/api/twisted.test.proto_helpers.MemoryReactorClock.html</A>&gt; does this for you.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HI Ashwini
</I>&gt;<i> 
</I>&gt;<i>  Thanks a lot for your response. I did come across MemoryReactorClock before, but I could not figure out how to use it to test my code. I am using trial as the test runner, which allows me to pass the name of the reactor to be used in command line. But MemoryReactorClock is not available, because it is not in twisted.internet.
</I>
Indeed, the MemoryReactorClock reactor is not suitable for installation in a global reactor.

&gt;<i> The code that I am testing imports reactor from twisted.internet in the global scope. Do I have to change that and pass a reactor explicitly (say, as a function parameter) where it is needed?
</I>
Yes.

&gt;<i> Is there any other way to change the default reactor to MemoryReactorClock just for running tests?
</I>
You can hack it using patch &lt;<A HREF="http://twistedmatrix.com/documents/15.2.0/api/twisted.trial.unittest.SynchronousTestCase.html#patch">http://twistedmatrix.com/documents/15.2.0/api/twisted.trial.unittest.SynchronousTestCase.html#patch</A> &lt;<A HREF="http://twistedmatrix.com/documents/15.2.0/api/twisted.trial.unittest.SynchronousTestCase.html#patch">http://twistedmatrix.com/documents/15.2.0/api/twisted.trial.unittest.SynchronousTestCase.html#patch</A>&gt;&gt;, by replacing the &quot;reactor&quot; attribute on your module.  But this is much worse than passing a parameter, and should only be used if you _really_ can't change the signature of your code for some reason.

&gt;<i> Going with my previous example, do I have to rewrite the code like following or is there a better way?
</I>
You should rewrite code like the following, it would be better :).  But hey, this is Python, nobody can stop you from doing anything you want :).

&gt;<i>     def b():
</I>&gt;<i>         '''Do some work'''
</I>&gt;<i> 
</I>&gt;<i>     def c():
</I>&gt;<i>         '''Do some more work'''
</I>&gt;<i> 
</I>&gt;<i>     def a(myreactor, flag):
</I>&gt;<i>         if flag:
</I>&gt;<i>             return myreactor.callLater(300, b)
</I>&gt;<i>         else:
</I>&gt;<i>             return myeactor. callLater(100, c)
</I>&gt;<i> 
</I>&gt;<i> I do see this in the documentation:
</I>&gt;<i> &gt; New application code should prefer to pass and accept the reactor as a parameter where it is needed, rather than relying on being able to import this module to get a reference. This simplifies unit testing ...
</I>&gt;<i> 
</I>&gt;<i> But I'd prefer not to change the signature of existing functions.
</I>
Passing parameters to functions that need them is not a bad thing.  You should generally prefer that.  It seems a lot of Python programmers are very resistant to passing arguments, and would instead prefer that everything be a global variable.  I am honestly somewhat confused as to why :-).  But it's a bad habit and you should try to shake it.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20151003/a47517d8/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20151003/a47517d8/attachment.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029773.html">[Twisted-Python] Testing function with delayed calls
</A></li>
	<LI>Next message: <A HREF="029775.html">[Twisted-Python] twisted compatibility with multiprocessing	module in fork+execv mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29774">[ date ]</a>
              <a href="thread.html#29774">[ thread ]</a>
              <a href="subject.html#29774">[ subject ]</a>
              <a href="author.html#29774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
