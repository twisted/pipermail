<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] irc bot,	reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor	was started
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20irc%20bot%2C%0A%09reacting%20to%3A%20irc_ERR_NOSUCHNICK.%20after%20the%20code%20where%20the%20reactor%0A%09was%20started&In-Reply-To=%3CF7A9083A-A312-4962-9232-D278A37C4640%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062247.html">
   <LINK REL="Next"  HREF="062249.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] irc bot,	reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor	was started</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20irc%20bot%2C%0A%09reacting%20to%3A%20irc_ERR_NOSUCHNICK.%20after%20the%20code%20where%20the%20reactor%0A%09was%20started&In-Reply-To=%3CF7A9083A-A312-4962-9232-D278A37C4640%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] irc bot,	reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor	was started">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Oct  7 01:49:45 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062247.html">[Twisted-Python] irc bot, reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor was started
</A></li>
        <LI>Next message (by thread): <A HREF="062249.html">[Twisted-Python] irc bot, reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor was started
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62248">[ date ]</a>
              <a href="thread.html#62248">[ thread ]</a>
              <a href="subject.html#62248">[ subject ]</a>
              <a href="author.html#62248">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Oct 6, 2015, at 11:38 PM, peter &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">commercials24 at yahoo.de</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> im sure youre solution is just fine, could you show me how you would contruct isBotOnline?
</I>&gt;<i> im assuming that code would go into the class &quot;mybot&quot;, next to irc_ERR_NOSUCKNICK?
</I>

The problem with just doing that is that there is no affirmative response that a message was sent, so there's no way to fire the deferred successfully if that's all you're doing.  Instead, you can use the ISON command to determine if the bot is online (and of course, the bot might go offline between the check and sending the message, so you will need to handle that case somehow too).

Since doing this is somewhat obscure, here's a working script that just checks if a nick specified on the command line is online on freenode:

from __future__ import print_function
from twisted.internet.defer import Deferred, inlineCallbacks
from twisted.words.protocols.irc import IRCClient
from twisted.internet.endpoints import clientFromString
from twisted.internet.protocol import Factory

class mybot(IRCClient, object):
    def __init__(self):
        self._isonQueue = []
        self.motdReceived = Deferred()

    def irc_RPL_ISON(self, prefix, params):
        username, d = self._isonQueue.pop(0)
        d.callback((username in params[1]))

    def isOnline(self, username):
        d = Deferred()
        self.sendLine(&quot;ISON &quot; + username)
        self._isonQueue.append((username, d))
        return d

    def irc_RPL_ENDOFMOTD(self, prefix, params):
        self.motdReceived.callback(None)

@inlineCallbacks
def main(reactor, nick):
    endpoint = clientFromString(reactor, &quot;tcp:chat.freenode.net:6667&quot;)
    proto = yield endpoint.connect(Factory.forProtocol(mybot))
    print(&quot;Waiting for MOTD...&quot;)
    yield proto.motdReceived
    print(&quot;Querying...&quot;)
    isOnline = yield proto.isOnline(nick)
    if isOnline:
        print(nick, &quot;is online!&quot;)
    else:
        print(nick, &quot;is *NOT* online!&quot;)

from twisted.internet.task import react
from sys import argv
react(main, argv[1:])


-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20151007/80a41b80/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062247.html">[Twisted-Python] irc bot, reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor was started
</A></li>
	<LI>Next message (by thread): <A HREF="062249.html">[Twisted-Python] irc bot, reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor was started
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62248">[ date ]</a>
              <a href="thread.html#62248">[ thread ]</a>
              <a href="subject.html#62248">[ subject ]</a>
              <a href="author.html#62248">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
