<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.mail.imap4.IMAP4Client.fetchMessage	always throws exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.mail.imap4.IMAP4Client.fetchMessage%0A%09always%20throws%20exception&In-Reply-To=%3C81D21A89-A4CA-4942-A75F-9C07284293F2%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062249.html">
   <LINK REL="Next"  HREF="029791.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.mail.imap4.IMAP4Client.fetchMessage	always throws exception</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.mail.imap4.IMAP4Client.fetchMessage%0A%09always%20throws%20exception&In-Reply-To=%3C81D21A89-A4CA-4942-A75F-9C07284293F2%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] twisted.mail.imap4.IMAP4Client.fetchMessage	always throws exception">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Oct  5 15:28:25 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062249.html">[Twisted-Python] irc bot, reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor was started
</A></li>
        <LI>Next message (by thread): <A HREF="029791.html">[Twisted-Python] txmongo vs. pymongo + callInThread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29782">[ date ]</a>
              <a href="thread.html#29782">[ thread ]</a>
              <a href="subject.html#29782">[ subject ]</a>
              <a href="author.html#29782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Sep 3, 2015, at 7:55 AM, Wang Yan &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">snailcoder at 163.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I've installed Twisted 15.3.0 on Ubuntu 14.04LTS. Excellent work but there's one problem bothering me for a long time: twisted.mail.imap4.IMAP4Client.fetchMessage always throws exception and the exception occured at random, e.g. somtimes the exception occured when the program read the 120th mail, sometimes it occured at the 150th or 200th mail. The traceback of the exception is as follows:
</I>&gt;<i> 
</I>&gt;<i> Unhandled Error
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/python/log.py&quot;, line 101, in callWithLogger
</I>&gt;<i>     return callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/python/log.py&quot;, line 84, in callWithContext
</I>&gt;<i>     return context.call({ILogContext: newCtx}, func, *args, **kw)
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/python/context.py&quot;, line 118, in callWithContext
</I>&gt;<i>     return self.currentContext().callWithContext(ctx, func, *args, **kw)
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/python/context.py&quot;, line 81, in callWithContext
</I>&gt;<i>     return func(*args,**kw)
</I>&gt;<i> --- &lt;exception caught here&gt; ---
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/internet/posixbase.py&quot;, line 597, in _doReadOrWrite
</I>&gt;<i>     why = selectable.doRead()
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/internet/tcp.py&quot;, line 209, in doRead
</I>&gt;<i>     return self._dataReceived(data)
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/internet/tcp.py&quot;, line 215, in _dataReceived
</I>&gt;<i>     rval = self.protocol.dataReceived(data)
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/protocols/basic.py&quot;, line 571, in dataReceived
</I>&gt;<i>     why = self.lineReceived(line)
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/mail/imap4.py&quot;, line 2356, in lineReceived
</I>&gt;<i>     self._regularDispatch(line)
</I>&gt;<i>   File &quot;/usr/local/lib/python2.7/dist-packages/Twisted-15.3.0-py2.7-linux-i686.egg/twisted/mail/imap4.py&quot;, line 2383, in _regularDispatch
</I>&gt;<i>     tag, rest = parts
</I>&gt;<i> exceptions.ValueError: need more than 1 value to unpack
</I>&gt;<i> 
</I>&gt;<i> My code is as simple as possible and the exception is thrown by the following codes:
</I>&gt;<i> 
</I>&gt;<i> dlist = []
</I>&gt;<i> for msg in messages:    # use message number, not UID
</I>&gt;<i>     d = self.fetchMessage(msg, uid=False)
</I>&gt;<i>     d.addCallback(cbGetAttachment)
</I>&gt;<i>     dlist.append(d)
</I>&gt;<i> dl = defer.DeferredList(dlist)
</I>&gt;<i> return dl.addCallback(cbLogout)
</I>&gt;<i> 
</I>&gt;<i> Is there anybody know about this issue?
</I>

Hi Wang,

Sorry it took some time to get back to you.  What kind of mail server are you talking to?  This looks like a protocol error - perhaps a bug in the server you're talking to, perhaps a bug in Twisted's handling of a valid response - but it's hard to say more without looking at the traffic and the intended behavior.  (I am no longer well-versed enough in the IMAP protocol to guess what is going on at a glance).  Is there any chance you have ever managed to reproduce this on a small set of data?

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20151005/e347350e/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20151005/e347350e/attachment.html</A>&gt;
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062249.html">[Twisted-Python] irc bot, reacting to: irc_ERR_NOSUCHNICK. after the code where the reactor was started
</A></li>
	<LI>Next message (by thread): <A HREF="029791.html">[Twisted-Python] txmongo vs. pymongo + callInThread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29782">[ date ]</a>
              <a href="thread.html#29782">[ thread ]</a>
              <a href="subject.html#29782">[ subject ]</a>
              <a href="author.html#29782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
