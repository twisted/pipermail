<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] dcc, idea for file resume
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20dcc%2C%20idea%20for%20file%20resume&In-Reply-To=%3C561BF55C.6060900%40yahoo.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] dcc, idea for file resume</H1>
    <B>peter</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20dcc%2C%20idea%20for%20file%20resume&In-Reply-To=%3C561BF55C.6060900%40yahoo.de%3E"
       TITLE="[Twisted-Python] dcc, idea for file resume">commercials24 at yahoo.de
       </A><BR>
    <I>Mon Oct 12 12:01:00 MDT 2015</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62268">[ date ]</a>
              <a href="thread.html#62268">[ thread ]</a>
              <a href="subject.html#62268">[ subject ]</a>
              <a href="author.html#62268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi,


the way file resume is implemented in DccFileReceive requires to user to 
determine the file size manually and set _resumeOffset.
wouldnt it make sene to just kill the last few bytes of the file and 
resume it?

below is the current connectionMade method from:
<A HREF="http://twistedmatrix.com/trac/browser/tags/releases/twisted-15.4.0/twisted/words/protocols/irc.py#L3013">http://twistedmatrix.com/trac/browser/tags/releases/twisted-15.4.0/twisted/words/protocols/irc.py#L3013</A>


replace this line:
self.file.seek(self._resumeOffset)

with:
self.file.seek(-3,2)


which removes the last 3 bytes from the file end, 3 is just a guess.


def connectionMade(self):
         dst = path.abspath(path.join(self.destDir,self.filename))
         exists = path.exists(dst)
         if self.resume and exists:
             print &quot;yes i want to resume and the file is there&quot;
             # I have been told I want to resume, and a file already
             # exists - Here we go
             self.file = open(dst, 'rb+')
             self.file.seek(-3,2)
             self.file.truncate()
             log.msg(&quot;Attempting to resume %s - starting from %d bytes&quot; %
                     (self.file, self.file.tell()))
         elif self.resume and not exists:
             raise OSError(errno.ENOENT,
                           &quot;You cannot resume writing to a file &quot;
                           &quot;that does not exist!&quot;,
                           dst)
         elif self.overwrite or not exists:
             self.file = open(dst, 'wb')
         else:
             raise OSError(errno.EEXIST,
                           &quot;There's a file in the way.  &quot;
                           &quot;Perhaps that's why you cannot open it.&quot;,
                           dst)



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62268">[ date ]</a>
              <a href="thread.html#62268">[ thread ]</a>
              <a href="subject.html#62268">[ subject ]</a>
              <a href="author.html#62268">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
