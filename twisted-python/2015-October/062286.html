<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] questions about deferreds and code structure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20questions%20about%20deferreds%20and%20code%20structure&In-Reply-To=%3C5628A0A2.9070109%40yahoo.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] questions about deferreds and code structure</H1>
    <B>peter</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20questions%20about%20deferreds%20and%20code%20structure&In-Reply-To=%3C5628A0A2.9070109%40yahoo.de%3E"
       TITLE="[Twisted-Python] questions about deferreds and code structure">commercials24 at yahoo.de
       </A><BR>
    <I>Thu Oct 22 02:38:58 MDT 2015</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62286">[ date ]</a>
              <a href="thread.html#62286">[ thread ]</a>
              <a href="subject.html#62286">[ subject ]</a>
              <a href="author.html#62286">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi,


i would like todo a few operations for a bunch of irc servers, basically 
all thats done in main for a list of ips.
heres what i came up with (this does not contain the actual class that 
inherits from  irc.IRCClient code)


questions (i will refer to the pb.codehash.net for line numbers)
1) when not adding printError at the end of the code (line 101) i dont 
see error messages for operations in main.
why is that?

printError is also added on line 33 and 36. why wont they produce errors 
from main?



2) does this overall structure look like a good idea?
intention: connect to a bunch of servers and do stuff. but not in parrallel.


heres the code nicely formatted
<A HREF="https://pb.codehash.net/760c30b217964139be82930899ba4b49">https://pb.codehash.net/760c30b217964139be82930899ba4b49</A>



def printResult(result):
     print result


def printError(failure):
     print &quot;\tprintError()&quot;
     print str(failure)



downloadFinished = False

def startNewDownload(unused):

     global downloadFinished

     new_data = get_some_bot()

     server = new_data[&quot;server&quot;]
     xdccbot = new_data[&quot;xdccbot&quot;]
     pack = new_data[&quot;pack&quot;]
     channel = new_data[&quot;channel&quot;]


     if not downloadFinished:
         point = TCP4ClientEndpoint(reactor, server, 6667)
         d = connectProtocol(point, XdccBot())
         d.addCallback(main, server, xdccbot, pack, channel)
         d.addErrback(printError)

         #if this succeeds, or if it fails. do the same: remove old bot 
from data and start with the next one
         d.addCallback(lambda r: maybeDeferred(remove_bot_from_data, 
xdccbot, server, new_data[&quot;filename&quot;]))
         d.addErrback(printError, &quot;inside main&quot;)

         d.addCallback(startNewDownload)
         d.addErrback(printError)


     else:

         print &quot;we are done!&quot;
     return d






@inlineCallbacks
def main(proto, server, xdccbot, pack, channel):
     print &quot;main()&quot;
     print &quot;server, bot, pack&quot;, server, xdccbot, pack


     #this can backfire:
     #irc_unknwon: prefix, command, params Helheim.SceneP2P.net 
ERR_NOMOTD ['lalala12324', 'MOTD File is missing']
     print(&quot;Waiting for MOTD...&quot;)
     yield proto.motdReceived

     print(&quot;Querying...&quot;)
     isOnline = yield proto.isOnline(xdccbot)
     if isOnline:
         print(xdccbot, &quot;is online!&quot;)
     else:
         print(xdccbot, &quot;is *NOT* online!&quot;)


     joinChannel = yield proto.join_channel(channel)
     if joinChannel:
         print &quot;we joined some creepy channel&quot;
     else:
         print &quot;joining didnt work out&quot;



     print &quot;sending message&quot;
     try:
         lala = yield proto.msg_CTCP(xdccbot, pack)
         print(&quot;lala:&quot;, lala)
     except lazyBotException as e:
         print(e)
         #reactor.stop()


     #wait for download finish
     try:
         result = yield proto.downloadFinished
         print(&quot;result:&quot;, result)
     except Exception as e:
         print(&quot;finish:&quot;, e)


     print(&quot;end of code&quot;)





d = startNewDownload(&quot;lalalal&quot;)
d.addCallback(printResult)
d.addErrback(printError)

reactor.run()








</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62286">[ date ]</a>
              <a href="thread.html#62286">[ thread ]</a>
              <a href="subject.html#62286">[ subject ]</a>
              <a href="author.html#62286">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
