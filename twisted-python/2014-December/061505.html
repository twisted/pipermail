<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Scrapy spiders waiting in reactor thread when callFromThread gets call repeatedly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scrapy%20spiders%20waiting%20in%20reactor%20thread%20when%0A%20callFromThread%20gets%20call%20repeatedly&In-Reply-To=%3CCAJtE5vQT66fVk%3DUuadH_H%3DfwJYaLUvYAfmVgm0918LFfBpsvJg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="029041.html">
   <LINK REL="Next"  HREF="029042.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Scrapy spiders waiting in reactor thread when callFromThread gets call repeatedly</H1>
    <B>Dustin J. Mitchell</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scrapy%20spiders%20waiting%20in%20reactor%20thread%20when%0A%20callFromThread%20gets%20call%20repeatedly&In-Reply-To=%3CCAJtE5vQT66fVk%3DUuadH_H%3DfwJYaLUvYAfmVgm0918LFfBpsvJg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Scrapy spiders waiting in reactor thread when callFromThread gets call repeatedly">dustin at v.igoro.us
       </A><BR>
    <I>Tue Dec 23 08:49:47 MST 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="029041.html">[Twisted-Python] Scrapy spiders waiting in reactor thread when callFromThread gets call repeatedly
</A></li>
        <LI>Next message (by thread): <A HREF="029042.html">[Twisted-Python] txmongo vs. pymongo + callInThread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61505">[ date ]</a>
              <a href="thread.html#61505">[ thread ]</a>
              <a href="subject.html#61505">[ subject ]</a>
              <a href="author.html#61505">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What *is* happening?  Underneath, callFromThread is basically just
setting a flag and writing to a file descriptor or some similar thing
to wake the reactor from its polling sleep.  Even at very high load,
the reactor should be multiplexing reads from that file descriptor
(which can act as a form of batching) with actual scraping.

Dustin

On Sun, Dec 21, 2014 at 6:47 AM, Adi Lavi &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi.lavi at cortica.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i> I am using Pika's asynchronous consumer implementation with Scrapy and
</I>&gt;<i> Twisted. I have twisted reactor running on the main thread, and Rabbit
</I>&gt;<i> consumer running on a background thread. When I get a message and want to
</I>&gt;<i> start my spider, I use 'callFromThread' to wake the reactor thread, init the
</I>&gt;<i> spider and start crawling.
</I>&gt;<i>
</I>&gt;<i> Alas, on high load of Q messages, I find that because 'callFromThread' is
</I>&gt;<i> called all the time, Scrapy does not start downloading until there is some
</I>&gt;<i> 'break' in these calls.
</I>&gt;<i>
</I>&gt;<i> I am wondering what is the best approach to gain high scale with Scrapy,
</I>&gt;<i> Twisted and RabbitMQ. Should I continue using the current design, and simply
</I>&gt;<i> do some buffering or batching to reduce the 'callFromThread' frequency?
</I>&gt;<i> Perhaps I should use a synchronous design?
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="029041.html">[Twisted-Python] Scrapy spiders waiting in reactor thread when callFromThread gets call repeatedly
</A></li>
	<LI>Next message (by thread): <A HREF="029042.html">[Twisted-Python] txmongo vs. pymongo + callInThread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61505">[ date ]</a>
              <a href="thread.html#61505">[ thread ]</a>
              <a href="subject.html#61505">[ subject ]</a>
              <a href="author.html#61505">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
