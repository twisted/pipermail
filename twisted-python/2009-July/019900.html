<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Perspective broker remote calls to multiple servers seem to run sequentially
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Perspective%20broker%20remote%20calls%20to%20multiple%0A%20servers%20seem%20to%20run%20sequentially&In-Reply-To=66dccc4d0907021313s168c448bx9a12ba551e94f942%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019897.html">
   <LINK REL="Next"  HREF="019901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Perspective broker remote calls to multiple servers seem to run sequentially</H1>
    <B>Johann Borck</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Perspective%20broker%20remote%20calls%20to%20multiple%0A%20servers%20seem%20to%20run%20sequentially&In-Reply-To=66dccc4d0907021313s168c448bx9a12ba551e94f942%40mail.gmail.com"
       TITLE="[Twisted-Python] Perspective broker remote calls to multiple servers seem to run sequentially">johann.borck at densedata.com
       </A><BR>
    <I>Fri Jul  3 07:52:37 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019897.html">[Twisted-Python] Perspective broker remote calls to multiple	servers seem to run sequentially
</A></li>
        <LI>Next message: <A HREF="019901.html">[Twisted-Python] Perspective broker remote calls to multiple	servers seem to run sequentially
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19900">[ date ]</a>
              <a href="thread.html#19900">[ thread ]</a>
              <a href="subject.html#19900">[ subject ]</a>
              <a href="author.html#19900">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sean Hollingsworth wrote:
&gt;<i> Let me start off by warning everyone that I am extremely new to 
</I>&gt;<i> twisted (I've been using it maybe a week) and it's highly likely some 
</I>&gt;<i> things don't work the way I think they should. Or, I'm just using them 
</I>&gt;<i> incorrectly.
</I>&gt;<i>
</I>&gt;<i> [..]
</I>&gt;<i>
</I>&gt;<i> The problems:
</I>&gt;<i>
</I>&gt;<i> Right now, for development and testing, I have three servers running 
</I>&gt;<i> on localhost on three ports. 
</I>Are you running them in a single process?
&gt;<i> When I run my test code, it seems that each Perspective Broker runs 
</I>&gt;<i> sequentially, rather than concurrently. For example, if i watch the 
</I>&gt;<i> debugging output from the server, I see the following:
</I>&gt;<i>
</I>&gt;<i> server 0 processing dataval1
</I>&gt;<i> server 0 processing dataval2
</I>&gt;<i> server 0 processing dataval3
</I>&gt;<i> server 0 processing dataval4
</I>&gt;<i> server 1 processing dataval*5*
</I>&gt;<i> server 1 processing dataval6
</I>&gt;<i> server 1 processing dataval7
</I>&gt;<i> server 2 processing dataval8
</I>&gt;<i> server 2 processing dataval9
</I>&gt;<i> server 2 processing dataval10
</I>&gt;<i>
</I>&gt;<i> My understanding is that the perspective brokers would work 
</I>&gt;<i> concurrently. Is that incorrect? My guess is that they should work 
</I>&gt;<i> concurrently and I am just doing something wrong in my code, due to my 
</I>&gt;<i> very, very limited understanding of how they work. Well, how much of 
</I>&gt;<i> twisted works, really.
</I>&gt;<i>
</I>
&gt;<i> Below is my the relevant code for the client (I've taken out code that 
</I>&gt;<i> just deals with prepping data or debugging). Please keep in mind that 
</I>&gt;<i> this is mostly testing code, while I get a better understanding of how 
</I>&gt;<i> perspective brokers work and was cobbled together from examples and 
</I>&gt;<i> docs found online.
</I>&gt;<i>
</I>
[...]

With the client code, nothing seems wrong, since it doesn't enforce one 
job to be finished before starting the next one - the problem has to be 
on the server side. Actually I suspect you're running the same service 
on 3 ports but within one process, right?. If this is the case it's no 
wonder the order of jobs completed matches exactly the order they're 
arriving in  because it all happens in a single thread. If you want 
parallel processing you will have to use multiple processes. As a side 
note (which doesn't seem to apply here): if the work they're doing is 
not CPU-bound, but IO-bound (meaning the work is nothing but waiting for 
something to complete, which for some reason can't be done in an 
asynchronous manner, the most prominent examples being blocking database 
interfaces), you also have the alternative of using threads.

I think the basic problem is you're assuming twisted to somehow schedule 
the work to different cores/cpus, which it doesn't do by default. You 
might want to look at ampoule <A HREF="https://launchpad.net/ampoule,">https://launchpad.net/ampoule,</A> which is a 
process pool, there was another similar thing called AsynQueue, but the 
site is down atm: <A HREF="http://foss.eepatents.com/AsynQueue.">http://foss.eepatents.com/AsynQueue.</A>

hth,
Johann





</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019897.html">[Twisted-Python] Perspective broker remote calls to multiple	servers seem to run sequentially
</A></li>
	<LI>Next message: <A HREF="019901.html">[Twisted-Python] Perspective broker remote calls to multiple	servers seem to run sequentially
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19900">[ date ]</a>
              <a href="thread.html#19900">[ thread ]</a>
              <a href="subject.html#19900">[ subject ]</a>
              <a href="author.html#19900">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
