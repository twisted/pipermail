<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20OT%20-%20adbapi%2C%20connection%20timeouts%2C%20mysql%20-%20OT&In-Reply-To=812f32000907212014j1aff797ye497a955b3e531b3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020022.html">
   <LINK REL="Next"  HREF="020028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT</H1>
    <B>Gabriel Rossetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20OT%20-%20adbapi%2C%20connection%20timeouts%2C%20mysql%20-%20OT&In-Reply-To=812f32000907212014j1aff797ye497a955b3e531b3%40mail.gmail.com"
       TITLE="[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT">gabriel.rossetti at arimaz.com
       </A><BR>
    <I>Wed Jul 22 02:34:21 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020022.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
        <LI>Next message: <A HREF="020028.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20025">[ date ]</a>
              <a href="thread.html#20025">[ thread ]</a>
              <a href="subject.html#20025">[ subject ]</a>
              <a href="author.html#20025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Garret,

yes, I finally did did something like that, I am currently testing the code.

Thanks,
Gabriel

Garret Heaton wrote:
&gt;<i> Instead of trying to keep the connection alive you can also just 
</I>&gt;<i> reconnect when necessary. Example code here: 
</I>&gt;<i> <A HREF="http://stackoverflow.com/questions/207981/how-to-enable-mysql-client-auto-re-connect-with-mysqldb/982873#982873">http://stackoverflow.com/questions/207981/how-to-enable-mysql-client-auto-re-connect-with-mysqldb/982873#982873</A>
</I>&gt;<i>
</I>&gt;<i> On Tue, Jul 21, 2009 at 2:18 PM, Clay Gerrard 
</I>&gt;<i> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">clay.gerrard at rackspace.com</A> &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">clay.gerrard at rackspace.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Regarding the original question:
</I>&gt;<i>     &quot;how to make mysql's idle timeouts shorter so that I can debug my
</I>&gt;<i>     code?&quot;
</I>&gt;<i>
</I>&gt;<i>     You should be able to do that in the mysql shell:
</I>&gt;<i>     mysql&gt; show variables like '%timeout%';
</I>&gt;<i>     +----------------------------+-------+
</I>&gt;<i>     | Variable_name              | Value |
</I>&gt;<i>     +----------------------------+-------+
</I>&gt;<i>     | connect_timeout            | 5     |
</I>&gt;<i>     | delayed_insert_timeout     | 300   |
</I>&gt;<i>     | innodb_lock_wait_timeout   | 50    |
</I>&gt;<i>     | innodb_rollback_on_timeout | OFF   |
</I>&gt;<i>     | interactive_timeout        | 600   |
</I>&gt;<i>     | net_read_timeout           | 30    |
</I>&gt;<i>     | net_write_timeout          | 60    |
</I>&gt;<i>     | slave_net_timeout          | 3600  |
</I>&gt;<i>     | table_lock_wait_timeout    | 50    |
</I>&gt;<i>     | wait_timeout               | 600   |
</I>&gt;<i>     +----------------------------+-------+
</I>&gt;<i>     10 rows in set (0.00 sec)
</I>&gt;<i>
</I>&gt;<i>     &gt; set global variable interactive_timeout = 5;
</I>&gt;<i>
</I>&gt;<i>     But in my experience MySQLdb makes the idle connection timeout
</I>&gt;<i>     very difficult to debug effectively.
</I>&gt;<i>
</I>&gt;<i>     Will twisted.adbapi.ConnectionPool ever offer a pool_recycle kw
</I>&gt;<i>     like sqlalchemy?
</I>&gt;<i>
</I>&gt;<i>     Clay Gerrard
</I>&gt;<i>     Office: 210-312-3443
</I>&gt;<i>     Mobile: 210-788-9431
</I>&gt;<i>     -----Original Message-----
</I>&gt;<i>     From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>&gt;
</I>&gt;<i>     [mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>&gt;] On Behalf Of
</I>&gt;<i>     Werner Thie
</I>&gt;<i>     Sent: Tuesday, July 21, 2009 4:05 PM
</I>&gt;<i>     To: Twisted general discussion
</I>&gt;<i>     Subject: Re: [Twisted-Python] OT - adbapi, connection timeouts,
</I>&gt;<i>     mysql - OT
</I>&gt;<i>
</I>&gt;<i>     Hi Gabriel
</I>&gt;<i>
</I>&gt;<i>     had the same problem, solved it by having keepalive() called in a
</I>&gt;<i>     LoopingCall(), MySQL sitting at defaults timingwise.
</I>&gt;<i>
</I>&gt;<i>     DB_DRIVER = &quot;MySQLdb&quot;
</I>&gt;<i>
</I>&gt;<i>     USERDB_ARGS = {
</I>&gt;<i>       'host': '',
</I>&gt;<i>       'db': '',
</I>&gt;<i>       'user': '',
</I>&gt;<i>       'passwd': '',
</I>&gt;<i>       'cp_reconnect': True
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>     storekeeper = StoreKeeper(DB_DRIVER, **USERDB_ARGS)
</I>&gt;<i>
</I>&gt;<i>     ka = task.LoopingCall(storekeeper.store.keepAlive)
</I>&gt;<i>     ka.start(300)
</I>&gt;<i>
</I>&gt;<i>     class StoreKeeper(object):
</I>&gt;<i>       def __init__(self, dbapiName, **params):
</I>&gt;<i>         self.store = Store(dbapiName, **params)
</I>&gt;<i>
</I>&gt;<i>       def dbdisconn(self, reason):
</I>&gt;<i>         print 'db disconnected for ', reason
</I>&gt;<i>
</I>&gt;<i>       def keepAlive(self):
</I>&gt;<i>         d = self.store.runQuery('SELECT 1')
</I>&gt;<i>         d.addErrback(self.dbdisconn)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     #with store being something like:
</I>&gt;<i>
</I>&gt;<i>     class Store(object):
</I>&gt;<i>       def __init__(self, dbapiName, **params):
</I>&gt;<i>         self.__pool   = adbapi.ConnectionPool(dbapiName, **params)
</I>&gt;<i>         print self.__pool.__getstate__()
</I>&gt;<i>         self.runOperation('SET autocommit = %s', 1)
</I>&gt;<i>
</I>&gt;<i>       def runQuery(self, query, *args):
</I>&gt;<i>         d = self.__pool.runInteraction(self.mapQuery, query, args)
</I>&gt;<i>         return d
</I>&gt;<i>
</I>&gt;<i>       def mapQuery(self, curs, query, *args):
</I>&gt;<i>         try:
</I>&gt;<i>           curs.execute(query, *args)
</I>&gt;<i>         except adbapi.ConnectionLost:
</I>&gt;<i>           print
</I>&gt;<i>           print '++++++++++++ rerunning query'
</I>&gt;<i>           print
</I>&gt;<i>           curs.execute(query, *args)                    #simply resend
</I>&gt;<i>     query, assuming cp_reconnect=True
</I>&gt;<i>         result = curs.fetchall()
</I>&gt;<i>         columns = [d[0] for d in curs.description]
</I>&gt;<i>         return [dict(zip(columns, r)) for r in result]
</I>&gt;<i>
</I>&gt;<i>       def runOperation(self, query, *args):
</I>&gt;<i>         d = self.__pool.runOperation(query, args)
</I>&gt;<i>         return d
</I>&gt;<i>
</I>&gt;<i>       def runInteraction(self, fun, queries=(), args=()):
</I>&gt;<i>         d = self.__pool.runInteraction(fun, queries, args)
</I>&gt;<i>         return d
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     HTH, Werner
</I>&gt;<i>
</I>&gt;<i>     Gabriel Rossetti wrote:
</I>&gt;<i>     &gt; Hello everyone,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; I have been experiencing the ConnectionError with adbapi &amp;
</I>&gt;<i>     &gt; cp_reconnect=True. I know that because of the cp_reconnect=True
</I>&gt;<i>     param
</I>&gt;<i>     &gt; tha is reconnects and that the query is not re-run. I have
</I>&gt;<i>     written some
</I>&gt;<i>     &gt; code that should re-run the query in that case (if I get a
</I>&gt;<i>     Failure back
</I>&gt;<i>     &gt; because of a ConnectionError), but it doesn't seem to work. My
</I>&gt;<i>     question
</I>&gt;<i>     &gt; is if anyone knows how to make mysql's idle timeouts shorter so
</I>&gt;<i>     that I
</I>&gt;<i>     &gt; can debug my code? I searched google and the mysql site with no
</I>&gt;<i>     luck.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; thank you,
</I>&gt;<i>     &gt; Gabriel
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; _______________________________________________
</I>&gt;<i>     &gt; Twisted-Python mailing list
</I>&gt;<i>     &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;<i>     &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     Twisted-Python mailing list
</I>&gt;<i>     <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;<i>     <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Confidentiality Notice: This e-mail message (including any attached or
</I>&gt;<i>     embedded documents) is intended for the exclusive and confidential
</I>&gt;<i>     use of the
</I>&gt;<i>     individual or entity to which this message is addressed, and
</I>&gt;<i>     unless otherwise
</I>&gt;<i>     expressly indicated, is confidential and privileged information of
</I>&gt;<i>     Rackspace.
</I>&gt;<i>     Any dissemination, distribution or copying of the enclosed
</I>&gt;<i>     material is prohibited.
</I>&gt;<i>     If you receive this transmission in error, please notify us
</I>&gt;<i>     immediately by e-mail
</I>&gt;<i>     at <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">abuse at rackspace.com</A> &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">abuse at rackspace.com</A>&gt;, and delete
</I>&gt;<i>     the original message.
</I>&gt;<i>     Your cooperation is appreciated.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     Twisted-Python mailing list
</I>&gt;<i>     <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;<i>     <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>   
</I>
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020022.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
	<LI>Next message: <A HREF="020028.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20025">[ date ]</a>
              <a href="thread.html#20025">[ thread ]</a>
              <a href="subject.html#20025">[ subject ]</a>
              <a href="author.html#20025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
