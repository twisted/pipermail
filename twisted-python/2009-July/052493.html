<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] LoopingCall at a non-idling reactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20LoopingCall%20at%20a%20non-idling%20reactor&In-Reply-To=%3Calpine.LNX.2.00.0907190045560.16904%40cray.glas.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052492.html">
   <LINK REL="Next"  HREF="052494.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] LoopingCall at a non-idling reactor</H1>
    <B>Ilya Etingof</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20LoopingCall%20at%20a%20non-idling%20reactor&In-Reply-To=%3Calpine.LNX.2.00.0907190045560.16904%40cray.glas.net%3E"
       TITLE="[Twisted-Python] LoopingCall at a non-idling reactor">ilya at glas.net
       </A><BR>
    <I>Sat Jul 18 15:04:25 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052492.html">[Twisted-Python] LoopingCall at a non-idling reactor
</A></li>
        <LI>Next message (by thread): <A HREF="052494.html">[Twisted-Python] LoopingCall at a non-idling reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52493">[ date ]</a>
              <a href="thread.html#52493">[ thread ]</a>
              <a href="subject.html#52493">[ subject ]</a>
              <a href="author.html#52493">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
After doing some more research, I've realised that my previous 
conclusion and complaint was indeed inaccurate. Sorry for that!

Now it looks to me that if my datagram receiver function takes some
time for data processing, rapidly coming datagrams tend to stack up and
my timer function is not getting called at time.

Here's example code:

from time import time, sleep
from twisted.internet import reactor, task
from twisted.internet.protocol import DatagramProtocol

def timerCbFun():
   print 'timer called', time()

loopingCall = task.LoopingCall(timerCbFun)
loopingCall.start(1, False)

class MyProtocol(DatagramProtocol):
   def datagramReceived(self, datagram, address):
     print 'datagramReceived', time()
     sleep(0.2) # simulate data processing

reactor.listenUDP(1024, MyProtocol(), '127.0.0.1')

reactor.run()

and here's its test run under relatively high incoming datagrams rate:

timer called 1247949866.62
timer called 1247949867.62
timer called 1247949868.62
datagramReceived 1247949869.16
datagramReceived 1247949869.36
datagramReceived 1247949869.56
datagramReceived 1247949869.76
datagramReceived 1247949869.96
.... no timer calls here ...
datagramReceived 1247949877.56
datagramReceived 1247949877.76
timer called 1247949877.96
timer called 1247949878.62
timer called 1247949879.62

So we missed eight timer calls in a row in the course of this run. What 
I need is that reactor would call my timer function at scheduled times
regardless of pending datagrams.

I do not think I'm using threads here.

thanks,
ilya

On Sat, 18 Jul 2009, Glyph Lefkowitz wrote:

&gt;<i> On Sat, Jul 18, 2009 at 3:33 PM, Ilya Etingof&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ilya at glas.net</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I can't get Twisted reactor calling my function in a more or less
</I>&gt;&gt;<i> periodic fashion with the LoopingCall mechanics.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> With select()-based reactor, the LoopingCall object seems to call back my
</I>&gt;&gt;<i> timer function only on select() timeout. If I/O pace does not allow
</I>&gt;&gt;<i> select() to time out, LoopingCall never calls my function.
</I>&gt;<i>
</I>&gt;<i> This doesn't sound accurate to me.  If your reactor is constantly
</I>&gt;<i> doing I/O, the timed call in question will be called when the
</I>&gt;<i> appropriate amount of time has passed.
</I>&gt;<i>
</I>&gt;<i> Select does not &quot;time out&quot;; it just returns some result.  If it is
</I>&gt;<i> returning purely do to the passage of time, then the result will be
</I>&gt;<i> empty, but Twisted doesn't treat that type of result specially.
</I>&gt;<i>
</I>&gt;<i> Can you provide a short, sample program which demonstrates the
</I>&gt;<i> behavior you're talking about?
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052492.html">[Twisted-Python] LoopingCall at a non-idling reactor
</A></li>
	<LI>Next message (by thread): <A HREF="052494.html">[Twisted-Python] LoopingCall at a non-idling reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52493">[ date ]</a>
              <a href="thread.html#52493">[ thread ]</a>
              <a href="subject.html#52493">[ subject ]</a>
              <a href="author.html#52493">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
