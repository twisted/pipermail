<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] LoopingCall at a non-idling reactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20LoopingCall%20at%20a%20non-idling%20reactor&In-Reply-To=%3C20090718224913.2543.1268327525.divmod.quotient.3426%40henry.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052493.html">
   <LINK REL="Next"  HREF="052497.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] LoopingCall at a non-idling reactor</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20LoopingCall%20at%20a%20non-idling%20reactor&In-Reply-To=%3C20090718224913.2543.1268327525.divmod.quotient.3426%40henry.divmod.com%3E"
       TITLE="[Twisted-Python] LoopingCall at a non-idling reactor">exarkun at divmod.com
       </A><BR>
    <I>Sat Jul 18 16:49:13 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052493.html">[Twisted-Python] LoopingCall at a non-idling reactor
</A></li>
        <LI>Next message (by thread): <A HREF="052497.html">[Twisted-Python] LoopingCall at a non-idling reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52494">[ date ]</a>
              <a href="thread.html#52494">[ thread ]</a>
              <a href="subject.html#52494">[ subject ]</a>
              <a href="author.html#52494">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 19 Jul 2009 01:04:25 +0400 (MSD), Ilya Etingof &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ilya at glas.net</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>After doing some more research, I've realised that my previous
</I>&gt;<i>conclusion and complaint was indeed inaccurate. Sorry for that!
</I>&gt;<i>
</I>&gt;<i>Now it looks to me that if my datagram receiver function takes some
</I>&gt;<i>time for data processing, rapidly coming datagrams tend to stack up and
</I>&gt;<i>my timer function is not getting called at time.
</I>
Ah, it looks like Terry probably guessed the cause of your difficulties
correctly.

&gt;<i>
</I>&gt;<i>Here's example code:
</I>&gt;<i>
</I>&gt;<i>from time import time, sleep
</I>&gt;<i>from twisted.internet import reactor, task
</I>&gt;<i>from twisted.internet.protocol import DatagramProtocol
</I>&gt;<i>
</I>&gt;<i>def timerCbFun():
</I>&gt;<i>   print 'timer called', time()
</I>&gt;<i>
</I>&gt;<i>loopingCall = task.LoopingCall(timerCbFun)
</I>&gt;<i>loopingCall.start(1, False)
</I>&gt;<i>
</I>&gt;<i>class MyProtocol(DatagramProtocol):
</I>&gt;<i>   def datagramReceived(self, datagram, address):
</I>&gt;<i>     print 'datagramReceived', time()
</I>&gt;<i>     sleep(0.2) # simulate data processing
</I>
The above is something which you're more or less not allowed to do in a
Twisted application.  That simulated data processing is blocking the
main event loop.  Nothing else happens until it finishes - that includes
handling more UDP packets and it includes running timed events like the
ones LoopingCall sets up.

You need to find another way to do your data processing if this behavior
isn't acceptable.  You can use Twisted's thread pool, if the data processing
is thread safe, or you could try Ampoule to distribute the processing to a
process pool instead of a thread pool, or if the data processing involves a
blocking operation which can be be handled asynchronously somehow, there
might be another Twisted API which can help you out.

Also, aside from that, LoopingCall is designed to handle missed intervals
gracefully.  It will skip calls which cannot be made because the process
was too busy doing something else.  For a 1 second looping call, once you
fix your data processing code, this probably won't happen very often, but
it may happen.  There's some work in progress to make it possible to at
least learn when a call has been skipped, but short of a real time platform
(which Twisted is certainly not), you can't get a 100% guarantee.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052493.html">[Twisted-Python] LoopingCall at a non-idling reactor
</A></li>
	<LI>Next message (by thread): <A HREF="052497.html">[Twisted-Python] LoopingCall at a non-idling reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52494">[ date ]</a>
              <a href="thread.html#52494">[ thread ]</a>
              <a href="subject.html#52494">[ subject ]</a>
              <a href="author.html#52494">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
