<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.positioning: status report and request	for comments/feedback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.positioning%3A%20status%20report%20and%20request%0A%09for%20comments/feedback&In-Reply-To=%3Cd9047f780907291801md4bf029s567bba6e8ce69f57%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052566.html">
   <LINK REL="Next"  HREF="052571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.positioning: status report and request	for comments/feedback</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.positioning%3A%20status%20report%20and%20request%0A%09for%20comments/feedback&In-Reply-To=%3Cd9047f780907291801md4bf029s567bba6e8ce69f57%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] twisted.positioning: status report and request	for comments/feedback">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Jul 29 19:01:42 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052566.html">[Twisted-Python] twisted.positioning: status report and request for	comments/feedback
</A></li>
        <LI>Next message (by thread): <A HREF="052571.html">[Twisted-Python] twisted.positioning: status report and request	for comments/feedback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52570">[ date ]</a>
              <a href="thread.html#52570">[ thread ]</a>
              <a href="subject.html#52570">[ subject ]</a>
              <a href="author.html#52570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jul 29, 2009 at 6:08 PM, Laurens Van Houtven &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">lvh at laurensvh.be</A>&gt;wrote:

&gt;<i> As you might remember, we (thanks to the adhoc code reviews from
</I>&gt;<i> glyph, tazle, dash andexarkun) decided on an implementation slightly
</I>&gt;<i> different from the original one, using:
</I>&gt;<i>    - an NMEAReceiver class, which *only* does the receiving bit and
</I>&gt;<i> is perfectly stateless: this does things like unpacking the sentence
</I>&gt;<i> and checking the checksum
</I>&gt;<i>    - an IPositioningReceiver (now renamed IPositioningProvider, but
</I>&gt;<i> I'm not sure that's the right name yet) interface that has a bunch of
</I>&gt;<i> *sane* callbacks -- ones you actually want instead of ones that are
</I>&gt;<i> directly a consequence of NMEA being a steaming pile of dung
</I>

Presumably the future plan is to have IPositioningProvider that receives
data from something other than NMEA, as well?  (Other GPS protocols,
whatever cell phones give you for triangulation, skyhook, etc.)


&gt;<i>    - an NMEAAdapter that would adapt the receiver and keep as much
</I>&gt;<i> state as necessary internally to produce the meaningful callbacks as
</I>&gt;<i> defined in the interface
</I>&gt;<i>
</I>
This all sounds good.

Here's the code right now: <A HREF="http://bit.ly/1azA5q">http://bit.ly/1azA5q</A>
&gt;<i> The interface lives in this file: <A HREF="http://bit.ly/3wWL2c">http://bit.ly/3wWL2c</A>
</I>&gt;<i>
</I>
I think you mean the interface lives in this file: <A HREF="http://bit.ly/5Jc7p">http://bit.ly/5Jc7p</A>
(Your second link was to a directory.)

A minor nit here, would you put the interfaces in their own module,
'twisted.position.ipositioning'?  There are use-cases where one may want to
import interfaces, but not actually load any of the code from a package, so
in new code we try to segregate them out into their own modules.

I originally thought that the NMEAAdapter (which adapts an
&gt;<i> NMEAReceiver to the  IPositioningReceiver interface) was really an
</I>&gt;<i> adapter in the twisted.python.components sense of the word, so that
</I>&gt;<i> you could do something like PositioningReceiver(NMEAReceiver()) and
</I>&gt;<i> you'd get and NMEAAdapter object, as described in the Twisted
</I>&gt;<i> components howto.
</I>&gt;<i>
</I>
This is the relationship, but it's backwards :).


&gt;<i> The problem is attaching the method stubs in NMEAReceiver (nmea_GPGGA,
</I>&gt;<i> nmea_GPRMC, nmea_GPGSV) to the methods in the NMEAAdapter that
</I>&gt;<i> actually interpret these sentences. Ordinarily, you'd subclass that
</I>&gt;<i> class to override those stubs. How do you feel this should be done
</I>&gt;<i> while keeping the adapter? Should we keep the adapter at all?
</I>

There are multiple layers here.  Let's have an object for each layer.  The
NMEA protocol parser object should send NMEA-sentence events to a sentence
receiver object, then there should be an implementation of the
sentence-receiver interface which generates positioning events and sends
them on to a positioning-receiver interface.

The dispatch from the nmea-sentence-received method to the nmea_-prefixed
methods is an internal implementation detail of the specific implementation
of the NMEA-event-to-positioning-event object, which users can subclass if
they want to get the same dispatch.

I've attached a sketch, but it elides certain details like set-up and
tear-down; there should be methods which allow users to tell when sentences
and positions start and stop arriving.  The gist would be to have a
connectionMade and connectionLost invoke startReceivingNMEA,
stopReceivingNMEA, which in turn would invoke startReceivingPositions, and
stopReceivingPositions.

There should also be a factory which nicely hooks everything together and
takes only a factory for your IPositioningProvider, so that users can
quickly get started with a positioning provider.

Of course, I could do ugly things in the adapters' __init__ like:
&gt;<i>
</I>
Let's please not do that; there's no reason to.

But that looks like a really bad idea: it's like I'm subverting
&gt;<i> inheritance. Instead, I'm currently doing this by subclassing the
</I>&gt;<i> receiver (thanks to exarkun for this suggestion):
</I>


&gt;<i> class NMEAAdapter(NMEAReceiver):
</I>&gt;<i>
</I>

&gt;<i> This fixes the method stubs being correctly assigned (I suppose the
</I>&gt;<i> correct term would be overriding, through plain old inheritance). The
</I>&gt;<i> problem is that neither the interface nor components/adapters are
</I>&gt;<i> involved in any way, so I feel like I'm missing something important.
</I>&gt;<i>
</I>
This is an OK approach, convenient, and less code than what I'm proposing,
but it means that users need to subclass something to get the functionality
they want, and there's no nice, clean interface that just describes what
your application needs to do at each level.

That might be fine if you really want to punt on allowing anyone to deal
with NMEA data directly, but given that the object is going to be public and
subclassing is going to be possible anyway, I'd rather that it be nice and
clean.  When we did twisted.words for example, I assumed that everyone would
want the nice, &quot;high level&quot; interface that abstractly defined chat events,
but instead users want to write XMPP and IRC bots directly, dealing with
gross protocol implementation details in their applications.  I suspect that
will be less common in the world of positioning data, but I certainly don't
know for sure, and it would be nice to avoid having to suppot a grotty
subclassing interface in the future, since the whole point of this nice new
system is to get rid of our old grotty interfaces :).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20090729/7e690e48/attachment.html&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: positioning-sketch.py
Type: application/x-python
Size: 2323 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20090729/7e690e48/attachment-0002.bin&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052566.html">[Twisted-Python] twisted.positioning: status report and request for	comments/feedback
</A></li>
	<LI>Next message (by thread): <A HREF="052571.html">[Twisted-Python] twisted.positioning: status report and request	for comments/feedback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52570">[ date ]</a>
              <a href="thread.html#52570">[ thread ]</a>
              <a href="subject.html#52570">[ subject ]</a>
              <a href="author.html#52570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
