<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Perspective broker remote calls to multiple	servers seem to run sequentially
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Perspective%20broker%20remote%20calls%20to%20multiple%0A%09servers%20seem%20to%20run%20sequentially&In-Reply-To=4A4DF105.9010000%40densedata.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019900.html">
   <LINK REL="Next"  HREF="019902.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Perspective broker remote calls to multiple	servers seem to run sequentially</H1>
    <B>Sean Hollingsworth</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Perspective%20broker%20remote%20calls%20to%20multiple%0A%09servers%20seem%20to%20run%20sequentially&In-Reply-To=4A4DF105.9010000%40densedata.com"
       TITLE="[Twisted-Python] Perspective broker remote calls to multiple	servers seem to run sequentially">smhollingsworth at gmail.com
       </A><BR>
    <I>Fri Jul  3 09:34:53 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019900.html">[Twisted-Python] Perspective broker remote calls to multiple servers seem to run sequentially
</A></li>
        <LI>Next message: <A HREF="019902.html">[Twisted-Python] Twisted Trial changes working directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19901">[ date ]</a>
              <a href="thread.html#19901">[ thread ]</a>
              <a href="subject.html#19901">[ subject ]</a>
              <a href="author.html#19901">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Geez .... what a HUGE duh moment. This will ultimately run on multiple
remote servers, but, while doing initial testing, I have been running it on
just my dev box. And, of course, I keep forgetting that twisted (well,
python) doesn't make use of multiple cores. I wasted all yesterday trying to
figure out why this was running the way it was.....
A million thanks.

Sean

On Fri, Jul 3, 2009 at 7:52 AM, Johann Borck &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">johann.borck at densedata.com</A>&gt;wrote:

&gt;<i> Sean Hollingsworth wrote:
</I>&gt;<i> &gt; Let me start off by warning everyone that I am extremely new to
</I>&gt;<i> &gt; twisted (I've been using it maybe a week) and it's highly likely some
</I>&gt;<i> &gt; things don't work the way I think they should. Or, I'm just using them
</I>&gt;<i> &gt; incorrectly.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [..]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The problems:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Right now, for development and testing, I have three servers running
</I>&gt;<i> &gt; on localhost on three ports.
</I>&gt;<i> Are you running them in a single process?
</I>&gt;<i> &gt; When I run my test code, it seems that each Perspective Broker runs
</I>&gt;<i> &gt; sequentially, rather than concurrently. For example, if i watch the
</I>&gt;<i> &gt; debugging output from the server, I see the following:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; server 0 processing dataval1
</I>&gt;<i> &gt; server 0 processing dataval2
</I>&gt;<i> &gt; server 0 processing dataval3
</I>&gt;<i> &gt; server 0 processing dataval4
</I>&gt;<i> &gt; server 1 processing dataval*5*
</I>&gt;<i> &gt; server 1 processing dataval6
</I>&gt;<i> &gt; server 1 processing dataval7
</I>&gt;<i> &gt; server 2 processing dataval8
</I>&gt;<i> &gt; server 2 processing dataval9
</I>&gt;<i> &gt; server 2 processing dataval10
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My understanding is that the perspective brokers would work
</I>&gt;<i> &gt; concurrently. Is that incorrect? My guess is that they should work
</I>&gt;<i> &gt; concurrently and I am just doing something wrong in my code, due to my
</I>&gt;<i> &gt; very, very limited understanding of how they work. Well, how much of
</I>&gt;<i> &gt; twisted works, really.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> &gt; Below is my the relevant code for the client (I've taken out code that
</I>&gt;<i> &gt; just deals with prepping data or debugging). Please keep in mind that
</I>&gt;<i> &gt; this is mostly testing code, while I get a better understanding of how
</I>&gt;<i> &gt; perspective brokers work and was cobbled together from examples and
</I>&gt;<i> &gt; docs found online.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> With the client code, nothing seems wrong, since it doesn't enforce one
</I>&gt;<i> job to be finished before starting the next one - the problem has to be
</I>&gt;<i> on the server side. Actually I suspect you're running the same service
</I>&gt;<i> on 3 ports but within one process, right?. If this is the case it's no
</I>&gt;<i> wonder the order of jobs completed matches exactly the order they're
</I>&gt;<i> arriving in  because it all happens in a single thread. If you want
</I>&gt;<i> parallel processing you will have to use multiple processes. As a side
</I>&gt;<i> note (which doesn't seem to apply here): if the work they're doing is
</I>&gt;<i> not CPU-bound, but IO-bound (meaning the work is nothing but waiting for
</I>&gt;<i> something to complete, which for some reason can't be done in an
</I>&gt;<i> asynchronous manner, the most prominent examples being blocking database
</I>&gt;<i> interfaces), you also have the alternative of using threads.
</I>&gt;<i>
</I>&gt;<i> I think the basic problem is you're assuming twisted to somehow schedule
</I>&gt;<i> the work to different cores/cpus, which it doesn't do by default. You
</I>&gt;<i> might want to look at ampoule <A HREF="https://launchpad.net/ampoule,">https://launchpad.net/ampoule,</A> which is a
</I>&gt;<i> process pool, there was another similar thing called AsynQueue, but the
</I>&gt;<i> site is down atm: <A HREF="http://foss.eepatents.com/AsynQueue.">http://foss.eepatents.com/AsynQueue.</A>
</I>&gt;<i>
</I>&gt;<i> hth,
</I>&gt;<i> Johann
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20090703/4d481e25/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20090703/4d481e25/attachment.htm</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019900.html">[Twisted-Python] Perspective broker remote calls to multiple servers seem to run sequentially
</A></li>
	<LI>Next message: <A HREF="019902.html">[Twisted-Python] Twisted Trial changes working directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19901">[ date ]</a>
              <a href="thread.html#19901">[ thread ]</a>
              <a href="subject.html#19901">[ subject ]</a>
              <a href="author.html#19901">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
