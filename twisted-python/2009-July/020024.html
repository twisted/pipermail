<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20OT%20-%20adbapi%2C%20connection%20timeouts%2C%20mysql%20-%20OT&In-Reply-To=30946_1248211099_n6LLIEqJ002980_5DA4635225CBE24FB33D34EFB6C5304714AEC9000A%40DFW1MXM01.RACKSPACE.CORP">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020028.html">
   <LINK REL="Next"  HREF="020023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT</H1>
    <B>Gabriel Rossetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20OT%20-%20adbapi%2C%20connection%20timeouts%2C%20mysql%20-%20OT&In-Reply-To=30946_1248211099_n6LLIEqJ002980_5DA4635225CBE24FB33D34EFB6C5304714AEC9000A%40DFW1MXM01.RACKSPACE.CORP"
       TITLE="[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT">gabriel.rossetti at arimaz.com
       </A><BR>
    <I>Wed Jul 22 02:33:11 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020028.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
        <LI>Next message: <A HREF="020023.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20024">[ date ]</a>
              <a href="thread.html#20024">[ thread ]</a>
              <a href="subject.html#20024">[ subject ]</a>
              <a href="author.html#20024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Clay,

thanks! It will help me debug my code by setting a low timout.

Gabriel

Clay Gerrard wrote:
&gt;<i> Regarding the original question:
</I>&gt;<i> &quot;how to make mysql's idle timeouts shorter so that I can debug my code?&quot;
</I>&gt;<i>
</I>&gt;<i> You should be able to do that in the mysql shell:
</I>&gt;<i> mysql&gt; show variables like '%timeout%';
</I>&gt;<i> +----------------------------+-------+
</I>&gt;<i> | Variable_name              | Value |
</I>&gt;<i> +----------------------------+-------+
</I>&gt;<i> | connect_timeout            | 5     |
</I>&gt;<i> | delayed_insert_timeout     | 300   |
</I>&gt;<i> | innodb_lock_wait_timeout   | 50    |
</I>&gt;<i> | innodb_rollback_on_timeout | OFF   |
</I>&gt;<i> | interactive_timeout        | 600   |
</I>&gt;<i> | net_read_timeout           | 30    |
</I>&gt;<i> | net_write_timeout          | 60    |
</I>&gt;<i> | slave_net_timeout          | 3600  |
</I>&gt;<i> | table_lock_wait_timeout    | 50    |
</I>&gt;<i> | wait_timeout               | 600   |
</I>&gt;<i> +----------------------------+-------+
</I>&gt;<i> 10 rows in set (0.00 sec)
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> set global variable interactive_timeout = 5;
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> But in my experience MySQLdb makes the idle connection timeout very difficult to debug effectively.
</I>&gt;<i>
</I>&gt;<i> Will twisted.adbapi.ConnectionPool ever offer a pool_recycle kw like sqlalchemy?
</I>&gt;<i>
</I>&gt;<i> Clay Gerrard
</I>&gt;<i> Office: 210-312-3443
</I>&gt;<i> Mobile: 210-788-9431
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of Werner Thie
</I>&gt;<i> Sent: Tuesday, July 21, 2009 4:05 PM
</I>&gt;<i> To: Twisted general discussion
</I>&gt;<i> Subject: Re: [Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</I>&gt;<i>
</I>&gt;<i> Hi Gabriel
</I>&gt;<i>
</I>&gt;<i> had the same problem, solved it by having keepalive() called in a
</I>&gt;<i> LoopingCall(), MySQL sitting at defaults timingwise.
</I>&gt;<i>
</I>&gt;<i> DB_DRIVER = &quot;MySQLdb&quot;
</I>&gt;<i>
</I>&gt;<i> USERDB_ARGS = {
</I>&gt;<i>    'host': '',
</I>&gt;<i>    'db': '',
</I>&gt;<i>    'user': '',
</I>&gt;<i>    'passwd': '',
</I>&gt;<i>    'cp_reconnect': True
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> storekeeper = StoreKeeper(DB_DRIVER, **USERDB_ARGS)
</I>&gt;<i>
</I>&gt;<i> ka = task.LoopingCall(storekeeper.store.keepAlive)
</I>&gt;<i> ka.start(300)
</I>&gt;<i>
</I>&gt;<i> class StoreKeeper(object):
</I>&gt;<i>    def __init__(self, dbapiName, **params):
</I>&gt;<i>      self.store = Store(dbapiName, **params)
</I>&gt;<i>
</I>&gt;<i>    def dbdisconn(self, reason):
</I>&gt;<i>      print 'db disconnected for ', reason
</I>&gt;<i>
</I>&gt;<i>    def keepAlive(self):
</I>&gt;<i>      d = self.store.runQuery('SELECT 1')
</I>&gt;<i>      d.addErrback(self.dbdisconn)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #with store being something like:
</I>&gt;<i>
</I>&gt;<i> class Store(object):
</I>&gt;<i>    def __init__(self, dbapiName, **params):
</I>&gt;<i>      self.__pool   = adbapi.ConnectionPool(dbapiName, **params)
</I>&gt;<i>      print self.__pool.__getstate__()
</I>&gt;<i>      self.runOperation('SET autocommit = %s', 1)
</I>&gt;<i>
</I>&gt;<i>    def runQuery(self, query, *args):
</I>&gt;<i>      d = self.__pool.runInteraction(self.mapQuery, query, args)
</I>&gt;<i>      return d
</I>&gt;<i>
</I>&gt;<i>    def mapQuery(self, curs, query, *args):
</I>&gt;<i>      try:
</I>&gt;<i>        curs.execute(query, *args)
</I>&gt;<i>      except adbapi.ConnectionLost:
</I>&gt;<i>        print
</I>&gt;<i>        print '++++++++++++ rerunning query'
</I>&gt;<i>        print
</I>&gt;<i>        curs.execute(query, *args)                    #simply resend
</I>&gt;<i> query, assuming cp_reconnect=True
</I>&gt;<i>      result = curs.fetchall()
</I>&gt;<i>      columns = [d[0] for d in curs.description]
</I>&gt;<i>      return [dict(zip(columns, r)) for r in result]
</I>&gt;<i>
</I>&gt;<i>    def runOperation(self, query, *args):
</I>&gt;<i>      d = self.__pool.runOperation(query, args)
</I>&gt;<i>      return d
</I>&gt;<i>
</I>&gt;<i>    def runInteraction(self, fun, queries=(), args=()):
</I>&gt;<i>      d = self.__pool.runInteraction(fun, queries, args)
</I>&gt;<i>      return d
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH, Werner
</I>&gt;<i>
</I>&gt;<i> Gabriel Rossetti wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> Hello everyone,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have been experiencing the ConnectionError with adbapi &amp;
</I>&gt;&gt;<i> cp_reconnect=True. I know that because of the cp_reconnect=True param
</I>&gt;&gt;<i> tha is reconnects and that the query is not re-run. I have written some
</I>&gt;&gt;<i> code that should re-run the query in that case (if I get a Failure back
</I>&gt;&gt;<i> because of a ConnectionError), but it doesn't seem to work. My question
</I>&gt;&gt;<i> is if anyone knows how to make mysql's idle timeouts shorter so that I
</I>&gt;&gt;<i> can debug my code? I searched google and the mysql site with no luck.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> thank you,
</I>&gt;&gt;<i> Gabriel
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Confidentiality Notice: This e-mail message (including any attached or
</I>&gt;<i> embedded documents) is intended for the exclusive and confidential use of the
</I>&gt;<i> individual or entity to which this message is addressed, and unless otherwise
</I>&gt;<i> expressly indicated, is confidential and privileged information of Rackspace. 
</I>&gt;<i> Any dissemination, distribution or copying of the enclosed material is prohibited.
</I>&gt;<i> If you receive this transmission in error, please notify us immediately by e-mail
</I>&gt;<i> at <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">abuse at rackspace.com</A>, and delete the original message. 
</I>&gt;<i> Your cooperation is appreciated.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>   
</I>
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020028.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
	<LI>Next message: <A HREF="020023.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20024">[ date ]</a>
              <a href="thread.html#20024">[ thread ]</a>
              <a href="subject.html#20024">[ subject ]</a>
              <a href="author.html#20024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
