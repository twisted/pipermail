<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] imap and noop
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20imap%20and%20noop&In-Reply-To=%3C20090708145846.2543.1812967854.divmod.quotient.285%40henry.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052444.html">
   <LINK REL="Next"  HREF="052446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] imap and noop</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20imap%20and%20noop&In-Reply-To=%3C20090708145846.2543.1812967854.divmod.quotient.285%40henry.divmod.com%3E"
       TITLE="[Twisted-Python] imap and noop">exarkun at divmod.com
       </A><BR>
    <I>Wed Jul  8 08:58:46 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052444.html">[Twisted-Python] imap and noop
</A></li>
        <LI>Next message (by thread): <A HREF="052446.html">[Twisted-Python] imap and noop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52445">[ date ]</a>
              <a href="thread.html#52445">[ thread ]</a>
              <a href="subject.html#52445">[ subject ]</a>
              <a href="author.html#52445">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 08 Jul 2009 15:33:49 +0100, Darren Syzling &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dsyzling at gmail.com</A>&gt; wrote:
&gt;<i>I'm new to twisted and was experimenting trying to create an imap server
</I>&gt;<i>based on the example within Twisted Network Programming Essentials. My
</I>&gt;<i>test client is Thunderbird.
</I>&gt;<i>
</I>&gt;<i>I'm wondering if anyone has had any experience handling the 'noop'
</I>&gt;<i>command here's my scenario:
</I>&gt;<i>- I have two unread messages in a folder, I open thunderbird, select
</I>&gt;<i>this folder and then select trash - trash has no messages.
</I>&gt;<i>- Each folder is selected and fetched with a uid:*
</I>&gt;<i>- My server correctly responds.
</I>&gt;<i>- Each time I now select the trash folder since it didn't have any
</I>&gt;<i>messages to start with Thunderbird continues to send noops. I think it's
</I>&gt;<i>waiting for my server to respond with exists or recent.
</I>&gt;<i>- Ok so I continue, I read and delete the two messages in my folder,
</I>&gt;<i>Thunderbird issues copy commands, I dutifully flag the messages in the
</I>&gt;<i>folder as \Deleted and the messages are added (via addMessage) to the
</I>&gt;<i>Trash folder with the correct flags - \Seen.
</I>&gt;<i>- But now if I select the Trash folder thunderbird just sends noop -
</I>&gt;<i>again it looks like it wants the server to send back exists or recent to
</I>&gt;<i>indicate there are now messages in that folder - even though it's just
</I>&gt;<i>copied stuff to the folder.
</I>&gt;<i>
</I>&gt;<i>If in the above scenario I don't select the trash folder first and
</I>&gt;<i>messages are deleted everything works fine - but in that case the client
</I>&gt;<i>is sending fetch uid:*. It seems that if Thunderbird detects no messages
</I>&gt;<i>in a folder it will noop until the server responds with an update.
</I>&gt;<i>
</I>&gt;<i>Anyone seen or worked around this? Are there hooks in the imap framework
</I>&gt;<i>to allow a mailbox or my mailserver to respond to noops? I don't appear
</I>&gt;<i>to have any mailbox listeners subscribed and I tried overriding the noop
</I>&gt;<i>for my derived IMAP4Server protocol derived class - but to no avail.
</I>&gt;<i>
</I>
You may want to use the IMailboxListener implementation on IMAP4Server to
handle this case (IMAP4's complicated, I'm not sure this is the right
direction to pursue, but it's *a* direction :).

The modeChanged, flagsChanged, and newMessages methods on IMAP4Server are
intended for use by your mailbox implementation.  In this case, it sounds
like you want to have your trash mailbox call newMessages when the messages
are copied into it.  This requires a bit of legwork on your part, keeping
track of the IMAP4Server protocol (or possibly more than one!) from the
mailbox code, but the result should be that when Thunderbird sends those
NOOPs, the server responds with one or both of EXISTS or RECENT (untagged).

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052444.html">[Twisted-Python] imap and noop
</A></li>
	<LI>Next message (by thread): <A HREF="052446.html">[Twisted-Python] imap and noop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52445">[ date ]</a>
              <a href="thread.html#52445">[ thread ]</a>
              <a href="subject.html#52445">[ subject ]</a>
              <a href="author.html#52445">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
