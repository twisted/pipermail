<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Socket%20error%2022%2C%0A%09Invalid%20Argument%20in%20twisted/internet/tcp.py&In-Reply-To=20081007190918.29191.1277749036.divmod.quotient.35224%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018488.html">
   <LINK REL="Next"  HREF="018490.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py</H1>
    <B>Werner Thie</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Socket%20error%2022%2C%0A%09Invalid%20Argument%20in%20twisted/internet/tcp.py&In-Reply-To=20081007190918.29191.1277749036.divmod.quotient.35224%40ohm"
       TITLE="[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py">wthie at thiengineering.ch
       </A><BR>
    <I>Wed Oct  8 12:57:51 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018488.html">[Twisted-Python] Buildbot history
</A></li>
        <LI>Next message: <A HREF="018490.html">[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18489">[ date ]</a>
              <a href="thread.html#18489">[ thread ]</a>
              <a href="subject.html#18489">[ subject ]</a>
              <a href="author.html#18489">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As I wrote in post 
<A HREF="http://www.mail-archive.com/twisted-web@twistedmatrix.com/msg01701.html">http://www.mail-archive.com/twisted-web@twistedmatrix.com/msg01701.html</A>
I'm still observing this socket error 22 problem but was not able to dig 
into it any further until now.

I found the following post from the python mailing list, which seems 
related to my problem:

<A HREF="http://mail.python.org/pipermail/python-bugs-list/2006-August/034667.html">http://mail.python.org/pipermail/python-bugs-list/2006-August/034667.html</A>

Attchached to this post is a small script, which I extended somehow and 
tried out on various platforms:

import socket

socket.setdefaulttimeout(30)
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

#nothing is listening on port 9999
try:
   s.connect(('127.0.0.1', 9999))
except socket.error, msg:
   print msg
   print s.getsockname()

Win32 XP &amp; VISTA:
(10061, 'Connection refused')
('0.0.0.0', 2071)  &lt;&lt; socket# seems to be random

Linux Fedora 9:
(111, 'Connection refused')
('0.0.0.0', 47521)  &lt;&lt; socket# counting up when script run again

Mac OSX 10.5:
(61, 'Connection refused')
('127.0.0.1', 49169)  &lt;&lt; socket# counting up when script run again

FreeBSD 7.0:
(61, 'Connection refused')
('127.0.0.1', 0)  &lt;&lt; socket# remains 0 when script run again

OpenBSD 4.3:
(61, 'Connection refused')
Traceback (most recent call last):
   File &quot;socket22error.py&quot;, line 8, in &lt;module&gt;
     print s.getsockname()
   File &quot;&lt;string&gt;&quot;, line 1, in getsockname
socket.error: (22, 'Invalid argument')

All the OS's seem to agree more or less how this particular situation 
should be handled except OpenBSD.

I agree that this is an Python/OS related question, but what happens 
with the reactor when such an error is thrown?

Is it harmless or does the system loose resources, wait for timeouts?

Is a try/except with a normalized answer in the embracing function in 
twisted/internet/tcp.py a possible cure?

I ask because I experience an unexplainable 'hickup' behavior where the 
odd request which usually triggers an instantaneous response takes up to 
30secs until a response is seen on the client in a local and clean net 
enviroment.

Thxs, Werner

PS:
- Yes, I know trial.
- Yes, I am able to set up a build slave for OpenBSD and in fact did so.
- Yes, I requested the creds from <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A> for connecting this 
buildslave on 03.July 2008 17:37 but got no answer
- Yes, I'm willing to recreate the bot which was in the meantime used in 
another project
- No, I don't know if there exists an automated test case for the 
problem given above



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018488.html">[Twisted-Python] Buildbot history
</A></li>
	<LI>Next message: <A HREF="018490.html">[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18489">[ date ]</a>
              <a href="thread.html#18489">[ thread ]</a>
              <a href="subject.html#18489">[ subject ]</a>
              <a href="author.html#18489">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
