<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] waiting for results from tcp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20waiting%20for%20results%20from%20tcp&In-Reply-To=178342.57812.qm%40web88101.mail.re2.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018541.html">
   <LINK REL="Next"  HREF="018548.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] waiting for results from tcp</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20waiting%20for%20results%20from%20tcp&In-Reply-To=178342.57812.qm%40web88101.mail.re2.yahoo.com"
       TITLE="[Twisted-Python] waiting for results from tcp">exarkun at divmod.com
       </A><BR>
    <I>Thu Oct 16 14:02:01 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018541.html">[Twisted-Python] waiting for results from tcp
</A></li>
        <LI>Next message: <A HREF="018548.html">[Twisted-Python] Deferred in C++
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18542">[ date ]</a>
              <a href="thread.html#18542">[ thread ]</a>
              <a href="subject.html#18542">[ subject ]</a>
              <a href="author.html#18542">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 16 Oct 2008 10:47:59 -0700 (PDT), Nima Ghanavatian &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nimag at rogers.com</A>&gt; wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I have a server which can handle multiple connections.  At any given time, I want to send out a ping to see who is still listening to this server.
</I>&gt;<i>
</I>&gt;<i>For this I scan through my list of ip's and send out a msg with
</I>&gt;<i>
</I>&gt;<i>     factory = ClientFactory()
</I>&gt;<i>     factory.protocol = caller
</I>&gt;<i>     factory.message = self.message
</I>&gt;<i>     factory.alive = 0
</I>&gt;<i>     reactor.connectTCP(self.ip, self.port, factory)
</I>&gt;<i>
</I>&gt;<i>and wait on the response.  This is done from within an application daemon, so no reactor.run() is required.
</I>
I'm not sure I understand.  You have a server, but you're making outgoing
connects from it to other servers.  This will tell you what other servers
are still listening.  Is that what &quot;to see who is still listening to this
server&quot; means?

&gt;<i>
</I>&gt;<i>How can I send a message out and wait for the response before proceeding?  I tried using deferreds a bunch of different ways but I can't seem to get it going.
</I>&gt;<i>Oh and I should clarify I want the response to be in the original stream, not in the thread created by connectTCP/dataReceived/etc...
</I>&gt;<i>
</I>
There are only two or three APIs in Twisted which will run your code in a
thread other than the reactor thread.  None of the connection setup APIs
or the network event APIs do this.  However, I'm confused by your comparison
of &quot;the original stream&quot; to &quot;the thread created ...&quot;.  These aren't really
comparable things.

When you set up a TCP connection with reactor.connectTCP, data received
via the resulting connection is passed to the dataReceived method of the
protocol instance returned by the factory's buildProtocol method.  If you
want the data, that's how you get it: implement dataReceived to handle it
in the manner you wish.  For example, you could create a Deferred which
fires with all the data received over a single connection after that
connection closes:

    from twisted.internet.protocol import Protocol, ClientFactory
    from twisted.internet.defer import Deferred
    from twisted.python.log import err

    class GatherOutput(Protocol):
        def connectionMade(self):
            self.output = []
        def dataReceived(self, data):
            self.output.append(data)
        def connectionLost(self, reason):
            self.factory.dataDeferred.callback(self.output)

    f = ClientFactory()
    f.dataDeferred = Deferred()
    f.protocol = GatherOutput
    reactor.connectTCP(host, port, f)
    def gotData(data):
        print 'Got data', data
    f.dataDeferred.addCallback(gotData)
    f.dataDeferred.addErrback(err)
    reactor.run()

Deferreds are the most common way for dealing with potentially long-running
(or long-waiting) operations in Twisted.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018541.html">[Twisted-Python] waiting for results from tcp
</A></li>
	<LI>Next message: <A HREF="018548.html">[Twisted-Python] Deferred in C++
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18542">[ date ]</a>
              <a href="thread.html#18542">[ thread ]</a>
              <a href="subject.html#18542">[ subject ]</a>
              <a href="author.html#18542">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
