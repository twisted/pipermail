<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Event notification and general RPC in Twisted...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Event%20notification%20and%20general%20RPC%20in%20Twisted...&In-Reply-To=ab42a7c0810302252k576137d1ub2a39246ef6cdac4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018590.html">
   <LINK REL="Next"  HREF="018591.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Event notification and general RPC in Twisted...</H1>
    <B>David Ripton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Event%20notification%20and%20general%20RPC%20in%20Twisted...&In-Reply-To=ab42a7c0810302252k576137d1ub2a39246ef6cdac4%40mail.gmail.com"
       TITLE="[Twisted-Python] Event notification and general RPC in Twisted...">dripton at ripton.net
       </A><BR>
    <I>Fri Oct 31 12:14:10 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018590.html">[Twisted-Python] Event notification and general RPC in Twisted...
</A></li>
        <LI>Next message: <A HREF="018591.html">[Twisted-Python] Passing arguments while running a twistd	application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18594">[ date ]</a>
              <a href="thread.html#18594">[ thread ]</a>
              <a href="subject.html#18594">[ subject ]</a>
              <a href="author.html#18594">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2008.10.31 16:52:26 +1100, Blair Bethwaite wrote:
&gt;<i> I'm thinking about using Twisted to rewrite some communications in a
</I>&gt;<i> Grid computing application.
</I>&gt;<i> E.g.:
</I>&gt;<i> 
</I>&gt;<i> [JobServer]1 ---------- *[Proxy]1 ----------- *[Agents]
</I>&gt;<i> 
</I>&gt;<i> Agents get jobs, report status, results, etc through Proxy to
</I>&gt;<i> JobServer. Agents are often distributed across a private network that
</I>&gt;<i> has no external interface, hence the proxy, which is run on a machine
</I>&gt;<i> between the private network and internet. Also, the proxy may do some
</I>&gt;<i> caching/queuing of particular messages - especially where the number
</I>&gt;<i> of agents behind it is large.
</I>&gt;<i> 
</I>&gt;<i> What we have at present is a TCP socket server however we're starting
</I>&gt;<i> to hit scalability issues and on top of that our future plans
</I>&gt;<i> necessitate a notification framework. I've been digging around on
</I>&gt;<i> twistedmatrix.com and in the book but so far am having trouble finding
</I>&gt;<i> any guidance or the level of detail that tells me whether Twisted has
</I>&gt;<i> what we need, some bits of which are:
</I>&gt;<i> 
</I>&gt;<i> - we'd like to use a persistent stream/connection, at least between
</I>&gt;<i> the JobServer and Proxy (traffic frequency will be reasonably high)
</I>&gt;<i> - it needs to be interoperable with java (is there PB for java?)
</I>
There is a Java version of PB.  <A HREF="http://itamarst.org/software/twistedjava/">http://itamarst.org/software/twistedjava/</A>

I've never used the Java version, so I can't say whether it works well.
The Python version is excellent.

&gt;<i> - each end of the connection should be able to register for and get
</I>&gt;<i> notifications from the other (e.g. Agent gives a heartbeat, JobServer
</I>&gt;<i> tells Agent to stop)
</I>&gt;<i> - sometimes the Proxy might be behind a firewall and only able to
</I>&gt;<i> connect out, we need to be able to use that connection to go back as
</I>&gt;<i> above
</I>
PB allows both ends of the connection to send and receive at any time,
over a single connection.  I use it for a game where multiple clients
connect via TCP to a server, and then the clients send messages to the
server whenever they want, and the server sends messages to one or more
clients whenever it wants (over the original connections initiated by
the clients, so the clients don't need to open any holes in their
firewalls), and everything just stinking works.

&gt;<i> - we want to dynamically configure streaming connections between Proxies
</I>
Yes, you can add more connections at any time.  You have to write your
own simple routing code.

&gt;<i> Hopefully that's enough context for you to point at modules and tell
</I>&gt;<i> whether these are appropriate questions:
</I>&gt;<i> Can I re-use a TCP stream for multiple XML-RPC or PB operations?
</I>
PB, yes.

That's not the way XML-RPC is typically done.  Clearly you could make a
protocol that uses XML-RPC payload over a persistent connection.  But
you'd lose the ability to use arbitrary XML-RPC libraries unmodified,
which is probably the main benefit of choosing XML-RPC.

Also, XML-RPC is an inherently rigid request/response protocol and thus
fails some of your other requirements.  If the client and server are
both asynchronously initiating requests over the same connection, you
need additional information to distinguish a new request from a response
to the other side's last request.  And if you send multiple requests
over the same connection without waiting for a response to the first,
you need to send more information correlating requests with responses.
All doable, but not XML-RPC anymore.

&gt;<i> If so, would it make sense to have the client (e.g. Proxy or Agent)
</I>&gt;<i> initiate the connection and then make a rpc (e.g. &quot;notify me of
</I>&gt;<i> anything relevant&quot;) to the server which would eventually return when
</I>&gt;<i> something relevant came along - triggering a callback in the client...
</I>&gt;<i> wash, rinse, repeat?
</I>
Yes, you make a remote call which returns a deferred.  You attach
a callback and an errback to the deferred.  When the remote call
finishes, either your callback or your errback fires, with your return
value or exception information.

I recommend writing something like a small chat system first, using the
exact protocol you're considering, before tackling your real problem.
If you can get Java clients and Python clients chatting through a chat
proxy that can forward through other chat proxies, then you know you can
make it work.  When you write a little chatbot and run lots of instances
in parallel and nothing chokes, then you know you can make it scale.

If not for the Java requirement, I would say that Twisted is a good fit,
and that you could use either PB or AMP, depending on whether you want
to pass around complex types or simple ones.  But if you need Java,
I don't know.

-- 
David Ripton    <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dripton at ripton.net</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018590.html">[Twisted-Python] Event notification and general RPC in Twisted...
</A></li>
	<LI>Next message: <A HREF="018591.html">[Twisted-Python] Passing arguments while running a twistd	application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18594">[ date ]</a>
              <a href="thread.html#18594">[ thread ]</a>
              <a href="subject.html#18594">[ subject ]</a>
              <a href="author.html#18594">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
