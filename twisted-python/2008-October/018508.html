<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Using deferreds when writing across unreliable	network
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Using%20deferreds%20when%20writing%20across%20unreliable%0A%09network&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018507.html">
   <LINK REL="Next"  HREF="018510.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Using deferreds when writing across unreliable	network</H1>
    <B>John Aherne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Using%20deferreds%20when%20writing%20across%20unreliable%0A%09network&In-Reply-To="
       TITLE="[Twisted-Python] Using deferreds when writing across unreliable	network">johnaherne at rocs.co.uk
       </A><BR>
    <I>Fri Oct 10 08:48:21 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018507.html">[Twisted-Python] Re: Using deferreds when writing across unreliable	network
</A></li>
        <LI>Next message: <A HREF="018510.html">[Twisted-Python] ANN: starpy-1.0.0a13
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18508">[ date ]</a>
              <a href="thread.html#18508">[ thread ]</a>
              <a href="subject.html#18508">[ subject ]</a>
              <a href="author.html#18508">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think so -- you wont be told when the actual bytes have been pushed
onto the network, nor when they have arrived succesfully at their
destination. You have to add such logic yourself, maybe by having the
recepient send back a confirmation.

So one way to structure this is to let the code that calls
transport.write return a Deferred, call it d. Before returning it, the
code stores d in a well-known place, something like

 transport.write(...)
 d = Deferred()
 outstanding requests[some_id] = d
 return d

The code that handles incoming data will then have to recognize the
confirmation and will invoke the callback method on d:

 def dataReceived(self, data):
     id, payload = unpack(data)
     d = outstanding_requests[id]
     d.callback(payload)

This is sort of how my code works in the VIFF project.

&gt;<i> By the way I did find your example, but I could not reconcile why
</I>&gt;<i> some deferred examples had 'automatic' callbacks and other fired
</I>&gt;<i> their own.
</I>
That is because of the different ways they are used: Defered is the
basic building block, but DeferredList combines several Deferreds into
one.

Martin

Thankyou very much for your replies.

I have a feeling that I now know what I am doing or going to do.

I also think your min-deferred example will be very useful.

Thanks once again.

John Aherne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20081010/71c0f76d/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20081010/71c0f76d/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018507.html">[Twisted-Python] Re: Using deferreds when writing across unreliable	network
</A></li>
	<LI>Next message: <A HREF="018510.html">[Twisted-Python] ANN: starpy-1.0.0a13
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18508">[ date ]</a>
              <a href="thread.html#18508">[ thread ]</a>
              <a href="subject.html#18508">[ subject ]</a>
              <a href="author.html#18508">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
