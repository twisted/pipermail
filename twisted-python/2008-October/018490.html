<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Socket%20error%2022%2C%0A%09Invalid%20Argument%20in%20twisted/internet/tcp.py&In-Reply-To=48ECE68F.4040705%40thiengineering.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018489.html">
   <LINK REL="Next"  HREF="018503.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Socket%20error%2022%2C%0A%09Invalid%20Argument%20in%20twisted/internet/tcp.py&In-Reply-To=48ECE68F.4040705%40thiengineering.ch"
       TITLE="[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py">exarkun at divmod.com
       </A><BR>
    <I>Wed Oct  8 13:59:01 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018489.html">[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py
</A></li>
        <LI>Next message: <A HREF="018503.html">[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18490">[ date ]</a>
              <a href="thread.html#18490">[ thread ]</a>
              <a href="subject.html#18490">[ subject ]</a>
              <a href="author.html#18490">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 08 Oct 2008 18:57:51 +0200, Werner Thie &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wthie at thiengineering.ch</A>&gt; wrote:
&gt;<i>As I wrote in post <A HREF="http://www.mail-archive.com/twisted-">http://www.mail-archive.com/twisted-</A> 
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">web at twistedmatrix.com</A>/msg01701.html
</I>&gt;<i>I'm still observing this socket error 22 problem but was not able to dig 
</I>&gt;<i>into it any further until now.
</I>&gt;<i>
</I>&gt;<i>I found the following post from the python mailing list, which seems related 
</I>&gt;<i>to my problem:
</I>&gt;<i>
</I>&gt;<i><A HREF="http://mail.python.org/pipermail/python-bugs-list/2006-August/034667.html">http://mail.python.org/pipermail/python-bugs-list/2006-August/034667.html</A>
</I>&gt;<i>
</I>&gt;<i>Attchached to this post is a small script, which I extended somehow and 
</I>&gt;<i>tried out on various platforms:
</I>&gt;<i>
</I>&gt;<i> [snip]
</I>&gt;<i>
</I>
It looks like these are slightly different cases.  The traceback from
Twisted Web comes from using getsockname on a connection the server
accepted.  The script you attached calls getsockname on a socket which
has failed to make an outgoing connection.  Perhaps they are demonstrating
the same feature/behavior/bug of OpenBSD, but not necessarily.  I vaguely
recall trying to investigate the Twisted Web case when you initially raised
it, but I can't remember if I learned anything (I think I recall that I was
not able to reproduce it).

&gt;<i> [snip]
</I>&gt;<i>
</I>&gt;<i>I agree that this is an Python/OS related question, but what happens with 
</I>&gt;<i>the reactor when such an error is thrown?
</I>&gt;<i>
</I>&gt;<i>Is it harmless or does the system loose resources, wait for timeouts?
</I>
When a protocol's dataReceived method raises an exception, the connection
is closed.  It seems that this exception is getting all the way from the
request handling code up to beyond the HTTP protocol implementation's
dataReceived method, so that should be what happens for this case. That
means it's probably harmless, but since I don't actually understand the
circumstances under which it happens, I can't say for sure.

&gt;<i>
</I>&gt;<i>Is a try/except with a normalized answer in the embracing function in 
</I>&gt;<i>twisted/internet/tcp.py a possible cure?
</I>
You mean in the implementation of getHost()?  Maybe, maybe not.  I'd like
to understand what OpenBSD thinks it is telling us when it returns EINVAL
here.

&gt;<i>
</I>&gt;<i>I ask because I experience an unexplainable 'hickup' behavior where the odd 
</I>&gt;<i>request which usually triggers an instantaneous response takes up to 30secs 
</I>&gt;<i>until a response is seen on the client in a local and clean net enviroment.
</I>
It could be that this exception is preventing a request from being processed,
or there could be some other problem, I don't know.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018489.html">[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py
</A></li>
	<LI>Next message: <A HREF="018503.html">[Twisted-Python] Socket error 22,	Invalid Argument in twisted/internet/tcp.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18490">[ date ]</a>
              <a href="thread.html#18490">[ thread ]</a>
              <a href="subject.html#18490">[ subject ]</a>
              <a href="author.html#18490">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
