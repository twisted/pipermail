<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Using deferreds when writing across unreliable	network
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Using%20deferreds%20when%20writing%20across%20unreliable%0A%09network&In-Reply-To=faf2d7810810100500k5761c9a4s8671aa8b9e920054%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018506.html">
   <LINK REL="Next"  HREF="018508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Using deferreds when writing across unreliable	network</H1>
    <B>Martin Geisler</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Using%20deferreds%20when%20writing%20across%20unreliable%0A%09network&In-Reply-To=faf2d7810810100500k5761c9a4s8671aa8b9e920054%40mail.gmail.com"
       TITLE="[Twisted-Python] Re: Using deferreds when writing across unreliable	network">mg at daimi.au.dk
       </A><BR>
    <I>Fri Oct 10 08:32:09 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018506.html">[Twisted-Python] Using deferreds when writing across unreliable	network
</A></li>
        <LI>Next message: <A HREF="018508.html">[Twisted-Python] Using deferreds when writing across unreliable	network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18507">[ date ]</a>
              <a href="thread.html#18507">[ thread ]</a>
              <a href="subject.html#18507">[ subject ]</a>
              <a href="author.html#18507">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&quot;John Aherne&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">johnaherne at rocs.co.uk</A>&gt; writes:

&gt;<i> Martin
</I>&gt;<i>
</I>&gt;<i> Thanks for the reply.
</I>&gt;<i>
</I>&gt;<i> That does clarify that I need to fire off my own deferreds.
</I>
Excellent! :-)

&gt;<i> The problem it leaves me at the moment is:
</I>&gt;<i>
</I>&gt;<i> How do I tell when my transport.write has completed. The ACKs for my
</I>&gt;<i> messages happen at the TCP level. Does this mean that for writes and
</I>&gt;<i> reads I have to work at the application level to register when the
</I>&gt;<i> write has been successful and fire my callback then.
</I>
I think so -- you wont be told when the actual bytes have been pushed
onto the network, nor when they have arrived succesfully at their
destination. You have to add such logic yourself, maybe by having the
recepient send back a confirmation.

So one way to structure this is to let the code that calls
transport.write return a Deferred, call it d. Before returning it, the
code stores d in a well-known place, something like

  transport.write(...)
  d = Deferred()
  outstanding requests[some_id] = d
  return d

The code that handles incoming data will then have to recognize the
confirmation and will invoke the callback method on d:

  def dataReceived(self, data):
      id, payload = unpack(data)
      d = outstanding_requests[id]
      d.callback(payload)

This is sort of how my code works in the VIFF project.

&gt;<i> By the way I did find your example, but I could not reconcile why
</I>&gt;<i> some deferred examples had 'automatic' callbacks and other fired
</I>&gt;<i> their own.
</I>
That is because of the different ways they are used: Defered is the
basic building block, but DeferredList combines several Deferreds into
one.

-- 
Martin Geisler

VIFF (Virtual Ideal Functionality Framework) brings easy and efficient
SMPC (Secure Multiparty Computation) to Python. See: <A HREF="http://viff.dk/.">http://viff.dk/.</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018506.html">[Twisted-Python] Using deferreds when writing across unreliable	network
</A></li>
	<LI>Next message: <A HREF="018508.html">[Twisted-Python] Using deferreds when writing across unreliable	network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18507">[ date ]</a>
              <a href="thread.html#18507">[ thread ]</a>
              <a href="subject.html#18507">[ subject ]</a>
              <a href="author.html#18507">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
