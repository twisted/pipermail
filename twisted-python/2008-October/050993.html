<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] alternative to tac
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20alternative%20to%20tac&In-Reply-To=%3C48EB2964.2000108%40thiengineering.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050992.html">
   <LINK REL="Next"  HREF="050994.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] alternative to tac</H1>
    <B>Werner Thie</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20alternative%20to%20tac&In-Reply-To=%3C48EB2964.2000108%40thiengineering.ch%3E"
       TITLE="[Twisted-Python] alternative to tac">wthie at thiengineering.ch
       </A><BR>
    <I>Tue Oct  7 03:18:28 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050992.html">[Twisted-Python] alternative to tac
</A></li>
        <LI>Next message (by thread): <A HREF="050994.html">[Twisted-Python] alternative to tac
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50993">[ date ]</a>
              <a href="thread.html#50993">[ thread ]</a>
              <a href="subject.html#50993">[ subject ]</a>
              <a href="author.html#50993">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Vasil

I use something along the code below whoch serves dual purpose, use it 
with twistd -noy xxx.tac and also python xxx.tac.

I was undecided almost a year ago whether I should use config files too, 
but then found that the .tac files work great as config files too.

I mainly develop on MSW XP and Vista and routinely deploy to OpenBSD.

HTH, Werner

PS: some refs in the code are generalized

import sys, os, gc

from twisted.enterprise import adbapi

from twisted.application import service, strports, internet
from twisted.cred import portal, credentials, checkers
from twisted.internet import protocol, reactor
#from twisted.conch import manhole, manhole_ssh
from twisted.python import log

from nevow import appserver, inevow

from theproject import web, i18n, plugin, ourguard

if sys.platform != 'win32':
   import psyco
   psyco.full()

   UID = 67
   GID = 67
   os.environ['PYTHON_EGG_CACHE'] = '/tmp'

DB_DRIVER = &quot;MySQLdb&quot;
DB_ARGS = {
     'host': 'xxx.xxx.xxx.xxx',
     'db': 'somedb',
     'user': 'someuser',
     'passwd': 'somepwd',
     'cp_reconnect': True
     }

application = service.Application(&quot;appname&quot;)

print
print 'available userstores:'
for userstore in plugin.userstores():
   print userstore.name

UserstoreName  = 'dbonly'
#UserstoreName  = 'memonly'
[Userstore] = [x for x in plugin.userstores() if x.name == UserstoreName]
print 'selected: %s' % Userstore.name

userstore = Userstore(DB_DRIVER, **DB_ARGS)

#additional style locations to be put into second arg, third arg is 
#redirect to in case of not knowing where to go
theportal = portal.Portal(web.Realm(web.Root('style_loc', [], 
'www.google.com'), userstore))

theportal.registerChecker(checkers.AllowAnonymousAccess(), 
credentials.IAnonymous)

thersrc = ourguard.TheSessionWrapper(theportal, mindFactory=web.Mind)
site = appserver.NevowSite(thersrc)

webserver = strports.service(&quot;tcp:7999&quot;, site)
webserver.setServiceParent(application)

def main():
   log.startLogging(sys.stdout)
   reactor.listenTCP(7999, site) #start only the web svc when debugging
   reactor.run()
##  print gc.get_objects()

if __name__ == '__main__':
   main()
##  import cProfile, pstats
##  p = cProfile.Profile()
##  p.run('main()')
##  s = pstats.Stats(p)
##  s.strip_dirs()
##  s.sort_stats('call', 'cum', 'name').print_stats().print_callers()



Vasil Vangelovski wrote:
&gt;<i> Which is the simplest way to put a service under and application to
</I>&gt;<i> listen on a port and behave similarly to the way it behaves when run
</I>&gt;<i> with twistd -noy script.tac but directly from a standard python
</I>&gt;<i> module? Lets assume I don't have access to the tac command and want to
</I>&gt;<i> emulate the behaveour.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050992.html">[Twisted-Python] alternative to tac
</A></li>
	<LI>Next message (by thread): <A HREF="050994.html">[Twisted-Python] alternative to tac
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50993">[ date ]</a>
              <a href="thread.html#50993">[ thread ]</a>
              <a href="subject.html#50993">[ subject ]</a>
              <a href="author.html#50993">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
