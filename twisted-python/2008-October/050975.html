<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] CONNECTION_LOST not an integer (docstring error?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20CONNECTION_LOST%20not%20an%20integer%20%28docstring%20error%3F%29&In-Reply-To=%3C6EE85919-4455-4B36-86F9-3E032CCFF0D8%40physics.ubc.ca%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050974.html">
   <LINK REL="Next"  HREF="050983.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] CONNECTION_LOST not an integer (docstring error?)</H1>
    <B>Michael McNeil Forbes</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20CONNECTION_LOST%20not%20an%20integer%20%28docstring%20error%3F%29&In-Reply-To=%3C6EE85919-4455-4B36-86F9-3E032CCFF0D8%40physics.ubc.ca%3E"
       TITLE="[Twisted-Python] CONNECTION_LOST not an integer (docstring error?)">mforbes at physics.ubc.ca
       </A><BR>
    <I>Wed Oct  1 16:37:47 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050974.html">[Twisted-Python] CONNECTION_LOST not an integer (docstring error?)
</A></li>
        <LI>Next message (by thread): <A HREF="050983.html">[Twisted-Python] CONNECTION_LOST not an integer (docstring error?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50975">[ date ]</a>
              <a href="thread.html#50975">[ thread ]</a>
              <a href="subject.html#50975">[ subject ]</a>
              <a href="author.html#50975">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> On Oct 1, 2008, at 3:44 PM, Jean-Paul Calderone wrote:
</I>...
&gt;&gt;<i> Why does writeSomeData not simply raise CONNECTION_LOST as an   
</I>&gt;&gt;<i> exception? Checking return values is quite un-pythonic.  Is there  
</I>&gt;&gt;<i> a  deep reason for this?
</I>&gt;<i>
</I>&gt;<i> The reason is probably that whoever wrote it thought that raising an
</I>&gt;<i> exception would be enough slower than returning a special value that
</I>&gt;<i> it would be worth doing something slightly unusual.  Compared to
</I>&gt;<i> returning a value, raising an exception is expensive in CPython, but
</I>&gt;<i> I doubt there is any surviving benchmark which demonstrates that it
</I>&gt;<i> makes a difference here.
</I>&gt;<i>
</I>&gt;<i> However, it's a very low-level API and since it isn't intended to be
</I>&gt;<i> used by application code, it doesn't seem like a very high priority
</I>&gt;<i> to make it less confusing.
</I>
By the way, is there any convention by which &quot;high level&quot; API  
routines are distinguished from &quot;low level&quot; routines?  It is really  
not that clear from the docs... (writeSomeData comes first in the  
listing etc.)

&gt;&gt;<i> P.S. I came across this because I was trying to use twisted  
</I>&gt;&gt;<i> running  in a thread to write data resulting from a long  
</I>&gt;&gt;<i> computation that I  have not yet turned into a producer.  The more  
</I>&gt;&gt;<i> conventional &quot;write&quot;  method was failing if the socket backed up,  
</I>&gt;&gt;<i> and provided no simple  way of determining if data was being  
</I>&gt;&gt;<i> dropped.  My solution was to  used writeSomeData, and then have  
</I>&gt;&gt;<i> the computation decide to throw out  some of the data if it is  
</I>&gt;&gt;<i> being produced too rapidly, but I need to  know how much has been  
</I>&gt;&gt;<i> sent so I can decide what to throw away...
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This seems more interesting than the main point of your email. :) You
</I>&gt;<i> should probably just do the work to turn the computation into a  
</I>&gt;<i> producer.
</I>&gt;<i> This because:
</I>&gt;<i>
</I>&gt;<i>  * writeSomeData is low level and crufty, as you've discovered
</I>&gt;<i>  * Not all reactors have this API, so your program will break based on
</I>&gt;<i>    the reactor selected to run it
</I>&gt;<i>  * producers give you all the same information
</I>&gt;<i>
</I>&gt;<i> Since you mentioned threads, I'll also point out that Twisted APIs  
</I>&gt;<i> are not
</I>&gt;<i> safe to use from non-reactor threads without  
</I>&gt;<i> reactor.callFromThread.  If
</I>&gt;<i> you aren't using callFromThread, that would explain bad behavior  
</I>&gt;<i> from the
</I>&gt;<i> write method.
</I>
I know that and am using callFromThread: The reason I am having bad  
behavior is because the socket is backing up.  Once I put in the  
logic to throw out data, it works fine... but the lack of reactor  
support concerns me somewhat.  I don't want the computation to stop,  
but think I could put an intermediate &quot;push producer&quot; that stops by  
discarding the data.

I am threading because the computation is the main task, and the  
network stuff is simply a window into the state of the computation.   
I want the computation to run continually, and it needs to do so in a  
blocking sort of way, periodically checking and pushing the partial  
results (like once every 30 minutes or so).

I want the calculation code to function on its own, with or without  
the twisted components and I don't see a simple way of doing this if  
twisted is in complete control without some type of threading.

My current design is to write my calculation as if twisted did not  
exist, and just push the current results onto a Queue periodically.   
Then I run twisted in a separate thread with clients that  
periodically check the queue, pop stuff off and dispatch it to any  
clients who happen to connect and want the data.

Is there a simpler way to do this all with twisted without using  
threads?  (The main goal is having an extremely minimal set of hooks  
for the people writing the computational code, and having the  
computational code run as fast as possible.)

Thanks for all of the suggestions and prompt comments!  (And for one  
very &quot;twisted&quot; library;-)
Michael.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050974.html">[Twisted-Python] CONNECTION_LOST not an integer (docstring error?)
</A></li>
	<LI>Next message (by thread): <A HREF="050983.html">[Twisted-Python] CONNECTION_LOST not an integer (docstring error?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50975">[ date ]</a>
              <a href="thread.html#50975">[ thread ]</a>
              <a href="subject.html#50975">[ subject ]</a>
              <a href="author.html#50975">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
