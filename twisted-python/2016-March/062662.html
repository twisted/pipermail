<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Sending disconnect messages to clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Sending%20disconnect%20messages%20to%20clients&In-Reply-To=%3CetPan.56f1a1da.2d623f43.9f5b%40dzur.corp.wargaming.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="030200.html">
   <LINK REL="Next"  HREF="062663.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Sending disconnect messages to clients</H1>
    <B>L. Daniel Burr</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Sending%20disconnect%20messages%20to%20clients&In-Reply-To=%3CetPan.56f1a1da.2d623f43.9f5b%40dzur.corp.wargaming.local%3E"
       TITLE="[Twisted-Python] Sending disconnect messages to clients">ldanielburr at me.com
       </A><BR>
    <I>Tue Mar 22 13:49:46 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="030200.html">[Twisted-Python] Sending disconnect messages to clients
</A></li>
        <LI>Next message (by thread): <A HREF="062663.html">[Twisted-Python] Sending disconnect messages to clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62662">[ date ]</a>
              <a href="thread.html#62662">[ thread ]</a>
              <a href="subject.html#62662">[ subject ]</a>
              <a href="author.html#62662">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chris,

On March 22, 2016 at 2:42:14 PM, Chris Norman (<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A>) wrote:

Hi all, 
I'm sure I asked this question before, but I can't find any answers on 
google, and I've changed my work flow a bit now, so thought it was worth 
re-asking. 

So on my server's protocol, I have a send method. This allows me to pass 
arguments which get sent off to the client in the right format. The send 
method looks something like this: 

def send(self, command, **kwargs): 
&quot;&quot;&quot;Cause the client to issue getattr(connection, command)(**kwargs). 
If disconnect evaluates to True, disconnect the client after the message 
is sent.&quot;&quot;&quot; 
disconnect = kwargs.get('disconnect', False) 
try: 
del kwargs['disconnect'] 
except KeyError: 
pass # Argument not found. 
d = defer.Deferred() 
d.addCallback(self.prepare_command) Convert the command and kwargs to 
json. 
d.addCallback(self.deferred_write) # Write the json to the transport. 
if disconnect: 
d.addCallback(self.deferred_disconnect) # Issue 
self.transport.loseConnection(). 
You are disconnecting right here, without waiting for your Deferred to fire.  It might make better sense to add the call the self.transport.loseConnection() to your Deferred’s callback chain.

Hope this helps,

Daniel
--
L. Daniel Burr
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ldanielburr at me.com</A>
(312) 656-8387
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20160322/1995721b/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="030200.html">[Twisted-Python] Sending disconnect messages to clients
</A></li>
	<LI>Next message (by thread): <A HREF="062663.html">[Twisted-Python] Sending disconnect messages to clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62662">[ date ]</a>
              <a href="thread.html#62662">[ thread ]</a>
              <a href="subject.html#62662">[ subject ]</a>
              <a href="author.html#62662">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
