<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Ticket #8244 (old-style decorator)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Ticket%20%238244%20%28old-style%20decorator%29&In-Reply-To=%3CetPan.56f30632.7b925ab4.a47e%40dzur.corp.wargaming.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062669.html">
   <LINK REL="Next"  HREF="062671.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Ticket #8244 (old-style decorator)</H1>
    <B>L. Daniel Burr</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Ticket%20%238244%20%28old-style%20decorator%29&In-Reply-To=%3CetPan.56f30632.7b925ab4.a47e%40dzur.corp.wargaming.local%3E"
       TITLE="[Twisted-Python] Ticket #8244 (old-style decorator)">ldanielburr at me.com
       </A><BR>
    <I>Wed Mar 23 15:10:10 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062669.html">[Twisted-Python] Ticket #8244 (old-style decorator)
</A></li>
        <LI>Next message (by thread): <A HREF="062671.html">[Twisted-Python] Ticket #8244 (old-style decorator)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62670">[ date ]</a>
              <a href="thread.html#62670">[ thread ]</a>
              <a href="subject.html#62670">[ subject ]</a>
              <a href="author.html#62670">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Glyph,
On March 23, 2016 at 1:39:53 PM, Glyph (<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>) wrote:


On Mar 23, 2016, at 9:22 AM, L. Daniel Burr &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ldanielburr at me.com</A>&gt; wrote:

My concern is that, should these classes be converted into hybrids via the @oldStyle decorator, my service may experience some reduction in the number of requests per second that it handles

If oldStyle converts the classes into hybrids, then it's broken.  Hybrids don't follow the semantics of old-style classes.  So this won't happen.

 I should definitely test the results to see if there *is* a performance regression in my case.

My guess is that this is an insignificant micro-optimization and that pypy has gotten better at optimizing hybrids since that caution was written.  That said, we're really bad at paying attention to speed.twistedmatrix.com and we really need a way to see pre-merge performance metrics rather than just a graph over time.


In the interest of putting my money where my mouth is, I’ve tested a very simple case, where I create a class inheriting from twisted.web.resource.Resource, and a subclass which mixes in “object”:

from twisted.application import internet, service
from twisted.internet import endpoints, reactor
from twisted.web import resource, server


class MyResource(resource.Resource):
    isLeaf = True

    def render_GET(self, request):
        return 'Hello, World!'

class FrankenStyle(MyResource, object):
    pass

print type(MyResource)
print type(FrankenStyle)

application = service.Application(‘test')
root = FrankenStyle()
s = server.Site(root)
ep = endpoints.serverFromString(reactor, 'tcp:8080')
svc = internet.StreamServerEndpointService(ep, s)
svc.setName(‘hybridtest')
svc.setServiceParent(application)

Running siege --benchmark --concurrent=10 --reps=1000 &quot;<A HREF="http://127.0.0.1:8080/&#226;&#128;&#156;">http://127.0.0.1:8080/“</A> against the “MyResource” version gets me 5714.29 requests per second across 3 runs.
Running siege --benchmark --concurrent=10 --reps=1000 &quot;<A HREF="http://127.0.0.1:8080/&#226;&#128;&#156;">http://127.0.0.1:8080/“</A> against the “FrankenStyle” version gets me an average of 5671.61 requests per second across 3 runs.
So, not a huge difference, overall, and it might not even be visible over a long enough period of time.
Thanks,
Daniel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20160323/9c832ea8/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062669.html">[Twisted-Python] Ticket #8244 (old-style decorator)
</A></li>
	<LI>Next message (by thread): <A HREF="062671.html">[Twisted-Python] Ticket #8244 (old-style decorator)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62670">[ date ]</a>
              <a href="thread.html#62670">[ thread ]</a>
              <a href="subject.html#62670">[ subject ]</a>
              <a href="author.html#62670">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
