<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Windows spawnProcess - Child process inherits	files and sockets (POSIX does not)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Windows%20spawnProcess%20-%20Child%20process%20inherits%0A%09files%20and%20sockets%20%28POSIX%20does%20not%29&In-Reply-To=%3CDE300510-5DB5-446D-8DF8-F1404FC69B32%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062691.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Windows spawnProcess - Child process inherits	files and sockets (POSIX does not)</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Windows%20spawnProcess%20-%20Child%20process%20inherits%0A%09files%20and%20sockets%20%28POSIX%20does%20not%29&In-Reply-To=%3CDE300510-5DB5-446D-8DF8-F1404FC69B32%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Windows spawnProcess - Child process inherits	files and sockets (POSIX does not)">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Mar 31 15:27:08 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062691.html">[Twisted-Python] ANN: txJSON-RPC 0.5 released
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30232">[ date ]</a>
              <a href="thread.html#30232">[ thread ]</a>
              <a href="subject.html#30232">[ subject ]</a>
              <a href="author.html#30232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 21, 2016, at 7:14 PM, exvito here &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ex.vitorino at gmail.com</A>&gt; wrote:
&gt;<i> 
</I>&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> I filed <A HREF="https://twistedmatrix.com/trac/ticket/7970">https://twistedmatrix.com/trac/ticket/7970</A> &lt;<A HREF="https://twistedmatrix.com/trac/ticket/7970">https://twistedmatrix.com/trac/ticket/7970</A>&gt; last summer while focused on a particular project that was hit by it. Since then I had to attend to other things and I'm now back to refocusing on that project.
</I>
Thanks for following up.  Sorry I've taken so long to respond; this is a highly complex issue that is tempting to just punt on thinking about.  But we really should address it, and thank you for writing a great bug report.

&gt;<i> Before submitting a patch for review, I'm looking for preliminary feedback, assuming you agree that the Windows vs POSIX semantics should be the same (if not, why?).
</I>
After much thought: Yes.  They should be the same.  The reason they're not is largely ignorance of the relevant APIs and abstractions on Windows, not any desire that they differ.  The one place they have to differ a little bit is handle inheritance: we need to figure out some way to express the 'childFDs' mapping in terms of both file descriptors and handles.

&gt;<i> My patch calls a few Windows APIs via ctypes, however, as far as I can tell, Twisted on Windows requires pywin32 and, recently, there has been some discussion around dropping that dependency and moving towards something based on cffi.
</I>
ctypes is dangerous and error-prone.  If you screw up the bit-width of a type, or the type in a header changes on some future version, ctypes gives you no way of finding out until some poor user's process segfaults, and usually not at the relevant call site.  So we'd prefer not to maintain more ctypes-using code.

The APIs in pywin32 very closely mirror the underlying Windows API, so for addressing this issue, please just go ahead and use pywin32 APIs; porting them to a new API along with everything else should be relatively straightforward.

If we do move forward with that change, we will probably use <A HREF="https://pypi.python.org/pypi/pywincffi">https://pypi.python.org/pypi/pywincffi</A> and not move anything within Twisted.

&gt;<i> What would you say the way forward is? Should I submit the patch for review anyway? Is there any other work that needs to be done first that I may contribute to?
</I>
Yes, just go ahead and write the patch.

&gt;<i> Thanks in advance for Twisted and for your feedback,
</I>
Thanks for using Twisted, thanks doubly for trying to contribute, and very sorry for the slow response.

-glyph


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20160331/cf4a2c4e/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20160331/cf4a2c4e/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062691.html">[Twisted-Python] ANN: txJSON-RPC 0.5 released
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30232">[ date ]</a>
              <a href="thread.html#30232">[ thread ]</a>
              <a href="subject.html#30232">[ subject ]</a>
              <a href="author.html#30232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
