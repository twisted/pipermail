<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ENOBUF and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ENOBUF%20and%20Twisted&In-Reply-To=20040819064810.GA2522%40ferd2.thristian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008437.html">
   <LINK REL="Next"  HREF="008452.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ENOBUF and Twisted</H1>
    <B>Jon Dyte</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ENOBUF%20and%20Twisted&In-Reply-To=20040819064810.GA2522%40ferd2.thristian.org"
       TITLE="[Twisted-Python] ENOBUF and Twisted">jon at totient.demon.co.uk
       </A><BR>
    <I>Thu Aug 19 06:50:36 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008437.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
        <LI>Next message: <A HREF="008452.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8434">[ date ]</a>
              <a href="thread.html#8434">[ thread ]</a>
              <a href="subject.html#8434">[ subject ]</a>
              <a href="author.html#8434">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This problem looks similar to this that some CORBA folk are seeing with 
Windows and large requests
<A HREF="http://www.omniorb-support.com/pipermail/omniorb-list/2004-August/025775.html">http://www.omniorb-support.com/pipermail/omniorb-list/2004-August/025775.html</A>

There are some links and suggested fixes in there, I'm not sure how relevant, 
but I thought it worth posting.


Jon


On Thursday 19 August 2004 07:48, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">screwtape at froup.com</A> wrote:
&gt;<i> A colleague of mine was working with a server written in Twisted
</I>&gt;<i> today, and he ran into a problem involving Twisted. He called me over
</I>&gt;<i> (since I'm supposed to be the Python Guru here, which just means I'm
</I>&gt;<i> slightly less ignorant than everybody else :) and we tracked the
</I>&gt;<i> behaviour in question all the way down to twisted.internet.tcp.
</I>&gt;<i>
</I>&gt;<i> The situation is this: we have an upstream data provider who sends us
</I>&gt;<i> data intermittently, all day. We have downstream clients on less
</I>&gt;<i> reliable connections who want to recieve it. We have a sort of caching
</I>&gt;<i> proxy in the middle that keeps track of all the data sent so far
</I>&gt;<i> today, and every time a client connects we send them the total record
</I>&gt;<i> of the day's events, and then send them new updates as they arrive.
</I>&gt;<i>
</I>&gt;<i> The problem occurred one day when we had a higher-than-usual amount of
</I>&gt;<i> data incoming. The symptom was that any client attempting to connect
</I>&gt;<i> would be immediately disconnected for No Obvious Reason. After some
</I>&gt;<i> ferretting about through the codebase, we discovered that the
</I>&gt;<i> 'writeSomeData' method of twisted.internet.tcp.Connection was getting
</I>&gt;<i> an error it couldn't handle and dropping the connection.
</I>&gt;<i>
</I>&gt;<i> The swift insertion of a debugging printf showed that the error
</I>&gt;<i> generated was ENOBUFS (Well, WSAENOBUFS, since it was running on
</I>&gt;<i> Windows 2000), which made the Connection drop the, uh, connection
</I>&gt;<i> immediately.
</I>&gt;<i>
</I>&gt;<i> Now, it occurs to me that ENOBUFS does not necessarily mean that the
</I>&gt;<i> connection is irretrievably lost, it should be treated more like
</I>&gt;<i> EWOULDBLOCK, except that buffers over a certain size will never, ever
</I>&gt;<i> fit. I don't know whether special handling of ENOBUFS should happen in
</I>&gt;<i> Twisted (to match its already-existing special handling of
</I>&gt;<i> EWOULDBLOCK), or whether it should happen in the application (proper
</I>&gt;<i> buffer-size autodetection might be a little intricate for a class like
</I>&gt;<i> Connection that's supposed to be simple). But either way, just
</I>&gt;<i> dropping the connection immediately is probably a Bad Thing.
</I>&gt;<i>
</I>&gt;<i> (for the record, the buffer we were trying to send was about 5MB, but
</I>&gt;<i> I assume people trying to send, say CD or DVD disk images via
</I>&gt;<i> twisted.web may well run into similar issues)
</I>&gt;<i>
</I>&gt;<i> Is there some clever way to get around this with the current version
</I>&gt;<i> of Twisted? If I were to write a patch, how should I best attack the
</I>&gt;<i> problem? Are there any other questions I should be asking? :)
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008437.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
	<LI>Next message: <A HREF="008452.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8434">[ date ]</a>
              <a href="thread.html#8434">[ thread ]</a>
              <a href="subject.html#8434">[ subject ]</a>
              <a href="author.html#8434">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
