<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Service as a daemon
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Service%20as%20a%20daemon&In-Reply-To=%3CCA7580A1-ED31-11D8-B75D-000A95AE562E%40parspro.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040875.html">
   <LINK REL="Next"  HREF="040881.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Service as a daemon</H1>
    <B>John Toohey</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Service%20as%20a%20daemon&In-Reply-To=%3CCA7580A1-ED31-11D8-B75D-000A95AE562E%40parspro.com%3E"
       TITLE="[Twisted-Python] Service as a daemon">jt at parspro.com
       </A><BR>
    <I>Fri Aug 13 08:05:11 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040875.html">[Twisted-Python] Service as a daemon
</A></li>
        <LI>Next message (by thread): <A HREF="040881.html">[Twisted-Python] Service as a daemon
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40878">[ date ]</a>
              <a href="thread.html#40878">[ thread ]</a>
              <a href="subject.html#40878">[ subject ]</a>
              <a href="author.html#40878">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The .tap file is now as follows :-
def makeService(config):
     pbport = int(config[&quot;pbport&quot;])

     application = service.Application('feedserver', uid=1, gid=1)
     f = FeedService('feedserver')
     reactor.connectTCP('localhost',8002,f.getFactory())

     f.setServiceParent(service.IServiceCollection(application))

The server starts fine with twistd -f feedserver.tap, but the 
startService method is not called, so the server just sits there. Is 
there any reason why twisted would not call the startService method?

John

On Aug 12, 2004, at 7:49 PM, Jp Calderone wrote:

&gt;<i> John Toohey wrote:
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i> I have a twisted server which can be started with the following code 
</I>&gt;&gt;<i> :-
</I>&gt;&gt;<i> if __name__==&quot;__main__&quot;:
</I>&gt;&gt;<i>     application = service.Application('feedserver', uid=1, gid=1)
</I>&gt;&gt;<i>     f = FeedService('feedserver')
</I>&gt;&gt;<i>     reactor.connectTCP('localhost',8002,f.getFactory())
</I>&gt;&gt;<i>     f.setServiceParent(service.IServiceCollection(application))
</I>&gt;&gt;<i>     f.startService()
</I>&gt;&gt;<i>     reactor.run()
</I>&gt;<i>
</I>&gt;<i>   There's little point in using service.Application, if it is used as 
</I>&gt;<i> above.  A better way to do this would be to put the above code into a 
</I>&gt;<i> .tac file (adding the appropriate imports), remove the last two lines, 
</I>&gt;<i> and run it with &quot;twistd -y &lt;filename.tac&gt;&quot;.
</I>&gt;<i>
</I>&gt;&gt;<i> The f.startService method makes a call to a database and using the PB 
</I>&gt;&gt;<i> layer, sends data to another twisted server every 5 minutes. However, 
</I>&gt;&gt;<i> when I try to create a .tap file and run it as a daemon with this 
</I>&gt;&gt;<i> code :-
</I>&gt;&gt;<i> def makeService(config):
</I>&gt;&gt;<i>     pbport = int(config[&quot;pbport&quot;])
</I>&gt;&gt;<i>     application = service.Application('feedserver', uid=1, gid=1)
</I>&gt;&gt;<i>     f = FeedService('feedserver')
</I>&gt;&gt;<i>     serviceCollection = service.IServiceCollection(application)
</I>&gt;&gt;<i>     internet.TCPClient(&quot;localhost&quot;,pbport, 
</I>&gt;&gt;<i> f.getFactory()).setServiceParent(serviceCollection)
</I>&gt;&gt;<i>     f.startService()
</I>&gt;&gt;<i>     return serviceCollection
</I>&gt;&gt;<i> The f.startService method is not called, and the data is not sent to 
</I>&gt;&gt;<i> the other server. What am I missing here?
</I>&gt;<i>
</I>&gt;<i>   makeService is run when the .tap file is written.  That means 
</I>&gt;<i> f.startService() is called when the .tap file is written.  Since the 
</I>&gt;<i> reactor isn't running at this point, the connection will never happen. 
</I>&gt;<i> When you later run this .tap file with &quot;twistd -f &lt;filename.tap&gt;&quot;, I 
</I>&gt;<i> would expect the connection to occur.  Are you running the resulting 
</I>&gt;<i> tap file with &quot;twistd -f&quot;?
</I>&gt;<i>
</I>&gt;<i>   Jp
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040875.html">[Twisted-Python] Service as a daemon
</A></li>
	<LI>Next message (by thread): <A HREF="040881.html">[Twisted-Python] Service as a daemon
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40878">[ date ]</a>
              <a href="thread.html#40878">[ thread ]</a>
              <a href="subject.html#40878">[ subject ]</a>
              <a href="author.html#40878">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
