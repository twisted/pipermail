<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ENOBUF and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ENOBUF%20and%20Twisted&In-Reply-To=1093127668.16560.7.camel%40localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008455.html">
   <LINK REL="Next"  HREF="008461.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ENOBUF and Twisted</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ENOBUF%20and%20Twisted&In-Reply-To=1093127668.16560.7.camel%40localhost"
       TITLE="[Twisted-Python] ENOBUF and Twisted">foom at fuhm.net
       </A><BR>
    <I>Sun Aug 22 11:14:56 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008455.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
        <LI>Next message: <A HREF="008461.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8457">[ date ]</a>
              <a href="thread.html#8457">[ thread ]</a>
              <a href="subject.html#8457">[ subject ]</a>
              <a href="author.html#8457">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 21, 2004, at 5:59 PM, Jp Calderone wrote:

&gt;<i>   I'm not sure I like this :/  How about attempting a length-limited  
</I>&gt;<i> write only on ENOBUFS (assuming we can confirm the meaning of  
</I>&gt;<i> WSAENOBUFS)?  It'd be nice to leave the common code path alone, as it  
</I>&gt;<i> is a pretty darn common code path.
</I>&gt;<i>
</I>&gt;<i>   Jp
</I>
Assuming the construction of a buffer object is not high (from what I  
know it is not), this should not really be a problem. It would be very  
rare to be able to write more than 65K. On linux, at least, the buffer  
size is between 4K and 128K (if set by the application), and the  
default is either 16K or 64K.

It seems other people run into a very similar bug:
<A HREF="http://www.omniorb-support.com/pipermail/omniorb-list/2002-September/">http://www.omniorb-support.com/pipermail/omniorb-list/2002-September/</A> 
021742.html
<A HREF="http://mail.ooc.nf.ca/pipermail/ob-users/1999-April/004989.html">http://mail.ooc.nf.ca/pipermail/ob-users/1999-April/004989.html</A>

Microsoft even has a KB article on something sounding quite similar:
<A HREF="http://support.microsoft.com/default.aspx?scid=http://">http://support.microsoft.com/default.aspx?scid=http://</A> 
support.microsoft.com:80/support/kb/articles/q201/2/ 
13.asp&amp;NoWebContent=1

Here's what they suggest. Do one of:
(a) Use the socket in nonblocking or asynchronous mode.
(b) Break large-size data blocks into small ones and specify a  
relatively small buffer in send for blocking sockets, preferably no  
larger than 64K.
(c) Set the SO_SNDBUF socket option to 0 (zero) to allow the stack to  
send from your application buffer directly.

Well, we've got (a) down... (c) is a bad idea, it will likely kill  
performance. That leaves (b). Sounds good, if it works.

James



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008455.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
	<LI>Next message: <A HREF="008461.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8457">[ date ]</a>
              <a href="thread.html#8457">[ thread ]</a>
              <a href="subject.html#8457">[ subject ]</a>
              <a href="author.html#8457">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
