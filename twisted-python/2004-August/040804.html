<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] module interface checking tool
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20module%20interface%20checking%20tool&In-Reply-To=%3C054E4632-E6AE-11D8-8D12-000A95A50FB2%40fuhm.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040803.html">
   <LINK REL="Next"  HREF="040805.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] module interface checking tool</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20module%20interface%20checking%20tool&In-Reply-To=%3C054E4632-E6AE-11D8-8D12-000A95A50FB2%40fuhm.net%3E"
       TITLE="[Twisted-Python] module interface checking tool">foom at fuhm.net
       </A><BR>
    <I>Thu Aug  5 01:06:49 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040803.html">[Twisted-Python] Starting a Twisted client
</A></li>
        <LI>Next message (by thread): <A HREF="040805.html">[Twisted-Python] module interface checking tool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40804">[ date ]</a>
              <a href="thread.html#40804">[ thread ]</a>
              <a href="subject.html#40804">[ subject ]</a>
              <a href="author.html#40804">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So, I was a bit irritated recently because there is no way to test for 
private name usage in a module's namespace. '__all__' is a good start, 
but it is somewhat poor for a few reasons:
1) it doesn't affect import modname; modname.someprivatename at all so 
you may be using private interfaces without having any way of knowing.
2) Because it doesn't actually affect code people write, it often 
doesn't get updated when new public interfaces get added.
3) until recently it didn't even affect help(module), so users don't 
even know they're using a private name.

So, I wrote a tool to do the access checking. My goal is to have it 
used for testing (solving problems 1&amp;2 *within* twisted, at least), not 
as something that you'd run your production server under.

sandbox/foom/private.py. Currently, it just spits out warnings because 
that way I can actually run through all the twisted tests, but that's 
controllable as a flag. Ideally every module in twisted would define 
__all__ and we could run the entire testsuite with access control 
enabled without raising illegal access exceptions.

To run the twisted tests with this, I temporarily stuck the following 
in twisted/__init__.py:
import private
private.privatizeModulesWithPrefix('twisted')

Much of the output (attached at the end) is from the IMAP tests trying 
to access private bits in order to test them. I'm not sure exactly what 
to do about that -- tests _should_ sometimes be able to access private 
parts, but they should also be restricted, normally, because you want 
to test against the public interface as well. So I may have to create a 
way to annotate some tests as being able to access private attributes 
while disallowing it by default.

Also, rebuild accesses private classes, and it is supposed to, so 
should be given special dispensation.

Besides those, the other things that show up currently are:
twisted.internet.abstract.isIPAddress from 
twisted.internet.iocpreactor.tcp (?)
twisted.internet.protocol.ConsumerToProtocolAdapter from 
twisted.protocols.ftp (?)
twisted.internet.threads._putResultInDeferred from 
twisted.enterprise.adbapi (_deferToThread)

Some of those perhaps should be public (?), but _putResultInDeferred, 
probably should not. IMO these are bugs, either of omission in __all__ 
or access from an inappropriate place. I dunno which.

Also, only 35 out of 559 modules in twisted use __all__. That's sad, 
and should be fixed. I'm sure if that was done, more of these kinds of 
things would show up.

Here's the full list of accesses to private names (I took the output 
and sort|uniq'd it). '=&gt; Yes' means access was granted based on the two 
modules living in the same package. '=&gt; No' means it would have raised 
an exception if I had that enabled.

&lt;= private twisted.internet.abstract.isIPAddress from 
twisted.internet.iocpreactor.tcp (?): =&gt; No
&lt;= private twisted.internet.protocol.BaseProtocol from 
twisted.python.rebuild (latestClass): =&gt; No
&lt;= private twisted.internet.protocol.ConsumerToProtocolAdapter from 
twisted.protocols.ftp (?): =&gt; No
&lt;= private twisted.internet.threads._putResultInDeferred from 
twisted.enterprise.adbapi (_deferToThread): =&gt; No
&lt;= private twisted.mail.imap4.Command from twisted.mail.test.test_imap 
(append): =&gt; No
&lt;= private twisted.mail.imap4.DontQuoteMe from 
twisted.mail.test.test_imap (testQuoteAvoider): =&gt; No
&lt;= private twisted.mail.imap4.FileProducer from 
twisted.mail.test.test_imap (testFileProducer): =&gt; No
&lt;= private twisted.mail.imap4.MessageProducer from 
twisted.mail.test.test_imap (testMultipleMultiPart): =&gt; No
&lt;= private twisted.mail.imap4.MessageProducer from 
twisted.mail.test.test_imap (testSingleMultiPart): =&gt; No
&lt;= private twisted.mail.imap4.MessageProducer from 
twisted.mail.test.test_imap (testSinglePart): =&gt; No
&lt;= private twisted.mail.imap4.MessageSet from 
twisted.mail.test.test_imap (?): =&gt; No
&lt;= private twisted.mail.imap4.MessageSet from 
twisted.mail.test.test_imap (testSetFlags): =&gt; No
&lt;= private twisted.mail.imap4._FetchParser from 
twisted.mail.test.test_imap (testFetchParserBody): =&gt; No
&lt;= private twisted.mail.imap4._FetchParser from 
twisted.mail.test.test_imap (testFetchParserMacros): =&gt; No
&lt;= private twisted.mail.imap4._FetchParser from 
twisted.mail.test.test_imap (testFetchParserSimple): =&gt; No
&lt;= private twisted.mail.imap4._formatHeaders from 
twisted.mail.test.test_imap (testFetchHeaders): =&gt; No
&lt;= private twisted.mail.imap4._formatHeaders from 
twisted.mail.test.test_imap (testHeaderFormatter): =&gt; No
&lt;= private twisted.mail.imap4.collapseNestedLists from 
twisted.mail.test.test_imap (testFiles): =&gt; No
&lt;= private twisted.mail.imap4.collapseNestedLists from 
twisted.mail.test.test_imap (testQuoteAvoider): =&gt; No
&lt;= private twisted.mail.imap4.collapseStrings from 
twisted.mail.test.test_imap (testStringCollapser): =&gt; No
&lt;= private twisted.mail.imap4.decoder from twisted.mail.test.test_imap 
(testDecode): =&gt; No
&lt;= private twisted.mail.imap4.parseIdList from 
twisted.mail.test.test_imap (testIdListParser): =&gt; No
&lt;= private twisted.mail.imap4.parseNestedParens from 
twisted.mail.test.test_imap (_searchWork): =&gt; No
&lt;= private twisted.mail.imap4.parseNestedParens from 
twisted.mail.test.test_imap (testLiterals): =&gt; No
&lt;= private twisted.mail.imap4.parseNestedParens from 
twisted.mail.test.test_imap (testParenParser): =&gt; No
&lt;= private twisted.mail.imap4.splitQuoted from 
twisted.mail.test.test_imap (testQuotedSplitter): =&gt; No
&lt;= private twisted.mail.imap4.wildcardToRegexp from 
twisted.mail.test.test_imap (testWildcard): =&gt; No
&lt;= private twisted.mail.imap4.wildcardToRegexp from 
twisted.mail.test.test_imap (testWildcardNoDelim): =&gt; No
&lt;= private twisted.persisted.dirdbm.ALLOW_TWISTED_REBUILD from 
twisted.python.rebuild (rebuild): =&gt; No
&lt;= private twisted.web.xmlrpc.addIntrospection from 
twisted.web.test.test_xmlrpc (?): =&gt; No

&lt;= private twisted.internet.abstract.isIPAddress from 
twisted.internet.base (resolve): =&gt; Yes
&lt;= private twisted.internet.abstract.isIPAddress from 
twisted.internet.tcp (resolveAddress): =&gt; Yes
&lt;= private twisted.internet.abstract.isIPAddress from 
twisted.internet.udp (connect): =&gt; Yes
&lt;= private twisted.internet.abstract.isIPAddress from 
twisted.internet.udp (startListening): =&gt; Yes
&lt;= private twisted.internet.base.BaseConnector from 
twisted.internet.ssl (?): =&gt; Yes
&lt;= private twisted.internet.base.BaseConnector from 
twisted.internet.ssl (__init__): =&gt; Yes
&lt;= private twisted.internet.base.BaseConnector from 
twisted.internet.tcp (?): =&gt; Yes

James



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040803.html">[Twisted-Python] Starting a Twisted client
</A></li>
	<LI>Next message (by thread): <A HREF="040805.html">[Twisted-Python] module interface checking tool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40804">[ date ]</a>
              <a href="thread.html#40804">[ thread ]</a>
              <a href="subject.html#40804">[ subject ]</a>
              <a href="author.html#40804">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
