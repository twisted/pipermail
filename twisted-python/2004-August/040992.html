<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Adding callback to a Deferred that's already	running?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Adding%20callback%20to%20a%20Deferred%20that%27s%20already%0A%09running%3F&In-Reply-To=%3C412D71E1.30502%40rogers.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040991.html">
   <LINK REL="Next"  HREF="040993.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Adding callback to a Deferred that's already	running?</H1>
    <B>Mike C. Fletcher</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Adding%20callback%20to%20a%20Deferred%20that%27s%20already%0A%09running%3F&In-Reply-To=%3C412D71E1.30502%40rogers.com%3E"
       TITLE="[Twisted-Python] Adding callback to a Deferred that's already	running?">mcfletch at rogers.com
       </A><BR>
    <I>Wed Aug 25 23:15:13 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040991.html">[Twisted-Python] Adding callback to a Deferred that's already	running?
</A></li>
        <LI>Next message (by thread): <A HREF="040993.html">[Twisted-Python] Adding callback to a Deferred that's already	running?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40992">[ date ]</a>
              <a href="thread.html#40992">[ thread ]</a>
              <a href="subject.html#40992">[ subject ]</a>
              <a href="author.html#40992">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Steve Freitas wrote:

&gt;<i>Hi all,
</I>&gt;<i>
</I>&gt;<i>I've got an XML-RPC app that has to grab some data from a SQL database, then 
</I>&gt;<i>depending on the results, make some more SQL calls, make some more decisions, 
</I>&gt;<i>then finally return a result. So, I'm hip-deep in Deferreds. So, here's the 
</I>&gt;<i>idiom I've come up with, and I'm running into a limitation with it, namely 
</I>&gt;<i>that I can't seem to add callbacks to a Deferred after it has started 
</I>&gt;<i>running. Here's what I'm doing in abbreviated form, and it's an idiom I'd 
</I>&gt;<i>like to stick with, if possible:
</I>&gt;<i>  
</I>&gt;<i>
</I>This wasn't spectacularly obvious to me the first time either, but I 
think it's covered somewhere in the deferred execution howto; in your 
callback/errback, return a new deferred and the processing of the 
deferred chain will pause until that new deferred fires.  Here's an 
example of code that does that...

            df = self.shouldRetrieve( urlRecord )
            def ifWeShould( judgement, urlRecord ):
                if judgement:
                    df = urlRecord.retrieve( self.timeout, self.userAgent )
                    df.addCallback( self.onSuccess, urlRecord = urlRecord )
                    df.addErrback( self.onFailure, urlRecord = urlRecord )
                    return df
                else:
                    return self.onFailure(
                        failure.Failure( RobotDenied(urlRecord)),
                        urlRecord = urlRecord
                    )
            df.addCallback( ifWeShould, urlRecord=urlRecord )

In the one branch, we return the result of a call, in the other, we 
return a new Deferred.  Note that the new deferred shows up between the 
current callback and any Deferred higher up in the chain, so the 
Deferred's higher up the chain will get the result of the new Deferred.  
If that's not desirable, you can define a handler for the new deferred 
that returns the original result.

Hope I understood the question properly and that this helped,
Mike

________________________________________________
  Mike C. Fletcher
  Designer, VR Plumber, Coder
  <A HREF="http://www.vrplumber.com">http://www.vrplumber.com</A>
  <A HREF="http://blog.vrplumber.com">http://blog.vrplumber.com</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040991.html">[Twisted-Python] Adding callback to a Deferred that's already	running?
</A></li>
	<LI>Next message (by thread): <A HREF="040993.html">[Twisted-Python] Adding callback to a Deferred that's already	running?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40992">[ date ]</a>
              <a href="thread.html#40992">[ thread ]</a>
              <a href="subject.html#40992">[ subject ]</a>
              <a href="author.html#40992">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
