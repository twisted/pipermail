<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ENOBUF and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ENOBUF%20and%20Twisted&In-Reply-To=%3C20040819130202.GI23028%40frobozz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040946.html">
   <LINK REL="Next"  HREF="040950.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ENOBUF and Twisted</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ENOBUF%20and%20Twisted&In-Reply-To=%3C20040819130202.GI23028%40frobozz%3E"
       TITLE="[Twisted-Python] ENOBUF and Twisted">andrew-twisted at puzzling.org
       </A><BR>
    <I>Thu Aug 19 07:02:02 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040946.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
        <LI>Next message (by thread): <A HREF="040950.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40949">[ date ]</a>
              <a href="thread.html#40949">[ thread ]</a>
              <a href="subject.html#40949">[ subject ]</a>
              <a href="author.html#40949">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Aug 19, 2004 at 10:01:59PM +1000, Tim Allen wrote:
&gt;<i> On 19 Aug 2004, at 19:10, Andrew Bennetts wrote:
</I>&gt;<i> &gt;&gt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">screwtape at froup.com</A> wrote:
</I>&gt;<i> &gt;&gt;&gt;A colleague of mine was working with a server written in Twisted
</I>&gt;<i> &gt;&gt;&gt;today, and he ran into a problem involving Twisted. He called me over
</I>&gt;<i> &gt;&gt;&gt;(since I'm supposed to be the Python Guru here, which just means I'm
</I>&gt;<i> &gt;&gt;&gt;slightly less ignorant than everybody else :) and we tracked the
</I>&gt;<i> &gt;&gt;&gt;behaviour in question all the way down to twisted.internet.tcp.
</I>&gt;<i> &gt;I wonder if the win32reactor or iocpreactor get more useful 
</I>&gt;<i> &gt;information than
</I>&gt;<i> &gt;select and so can handle this better?
</I>&gt;<i> 
</I>&gt;<i> It's not so much that the default select reactor makes information 
</I>&gt;<i> unavailable.. as far as I can tell, the Python socket object is 
</I>&gt;<i> correctly raising ENOBUFS, and t.i.tcp.Connection is very deliberately 
</I>&gt;<i> throwing that information away rather than handling properly.
</I>
Well, the problem is that currently the select reactor assumes that if
select says a socket is writeable, then it is writeable, i.e it is safe to
attempt to write any amount of data to it (with the understanding that being
non-blocking it might only be able to accept some of that data immediately).
Apparently this assumption is not quite accurate.

So far in this thread I've seen two theories about what the exact problem
is, and I think the correct fix depends on which is actually the cause.

Theory 1: Writing large (i.e. 5MB) chunks to sockets in a single send call
will always fail, and should.  The fix for this would be to make sure that
no more than 64kB (or whatever) is passed to send at a time, regardless of
what is passed to transport.write.

Theory 2: Writing lots and lots of data very fast can cause the network
hardware's/device driver's internal buffers to fill up, thus making it
impossible to write even though select claims it is.  If this is the case,
the socket needs to be ignored for a moment to give those buffers a chance
to flush.

A test case proving which is actually the case would be most welcome :)

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040946.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
	<LI>Next message (by thread): <A HREF="040950.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40949">[ date ]</a>
              <a href="thread.html#40949">[ thread ]</a>
              <a href="subject.html#40949">[ subject ]</a>
              <a href="author.html#40949">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
