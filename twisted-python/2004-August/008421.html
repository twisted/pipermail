<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted and threading
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20and%20threading&In-Reply-To=20040818021851.GA18404%40mit.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008420.html">
   <LINK REL="Next"  HREF="008423.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted and threading</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20and%20threading&In-Reply-To=20040818021851.GA18404%40mit.edu"
       TITLE="[Twisted-Python] twisted and threading">exarkun at divmod.com
       </A><BR>
    <I>Tue Aug 17 23:18:59 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008420.html">[Twisted-Python] twisted and threading
</A></li>
        <LI>Next message: <A HREF="008423.html">[Twisted-Python] twisted and threading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8421">[ date ]</a>
              <a href="thread.html#8421">[ thread ]</a>
              <a href="subject.html#8421">[ subject ]</a>
              <a href="author.html#8421">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-10152003 at atlas.lcs.mit.edu</A> wrote:
&gt;<i> Christopher Armstrong [<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">radeex at gmail.com</A>] wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>On Tue, 17 Aug 2004 20:34:44 -0400, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-10152003 at atlas.lcs.mit.edu</A>
</I>&gt;&gt;<i>&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-10152003 at atlas.lcs.mit.edu</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I wrapped a c library using swig and was hoping to make use of it in
</I>&gt;&gt;&gt;<i>a twisted server I am writing.  The issue is that the c library
</I>&gt;&gt;&gt;<i>fundamentally blocks waiting for input that may never come.  Is
</I>&gt;&gt;&gt;<i>there a way from twisted to deal with this cleanly within the
</I>&gt;&gt;&gt;<i>framework?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I.e. some combination of adding a reactor.addSystemEventTrigger event
</I>&gt;&gt;&gt;<i>and calling reactor.threadpool.stop seem like it should work but
</I>&gt;&gt;&gt;<i>I haven't had any luck yet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Try twisted.internet.threads.deferToThread(myBlockingCall) --&gt;
</I>&gt;&gt;<i>Deferred.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Ah, but that doesn't work.  As I stated the c library (not mine) calls
</I>&gt;<i> potentially block forever (or at least longer than I want to wait to
</I>&gt;<i> shutdown the twisted server).  The thread created by deferTothread may
</I>&gt;<i> never complete which makes shutting down the server gracefully
</I>&gt;<i> impossible (or so I thought?).
</I>&gt;<i> 
</I>
   There is no portable way to terminate a thread without its 
assistance.  Python supports no API for this - save one, the 
ridiculously named &quot;setDaemon&quot; Thread method.  Twisted doesn't expose 
this, nor call it internally, as it can lead to segfaults.

   Perhaps this should be parameterizable (defaulting to the current 
behavior, of course), so that poorly behaved libraries can be dealt with?

   Alternatively, since daemonized threads might lead to this anyway, 
perhaps you should just add a shutdown event os.kill(os.getpid(), 9) 
&lt;wwinkink&gt;.

   Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008420.html">[Twisted-Python] twisted and threading
</A></li>
	<LI>Next message: <A HREF="008423.html">[Twisted-Python] twisted and threading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8421">[ date ]</a>
              <a href="thread.html#8421">[ thread ]</a>
              <a href="subject.html#8421">[ subject ]</a>
              <a href="author.html#8421">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
