<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Understanding the role of .tap files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Understanding%20the%20role%20of%20.tap%20files&In-Reply-To=%3C411C35CA.7010704%40comcast.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="040874.html">
   <LINK REL="Next"  HREF="040883.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Understanding the role of .tap files</H1>
    <B>Stephen Waterbury</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Understanding%20the%20role%20of%20.tap%20files&In-Reply-To=%3C411C35CA.7010704%40comcast.net%3E"
       TITLE="[Twisted-Python] Understanding the role of .tap files">golux at comcast.net
       </A><BR>
    <I>Thu Aug 12 21:30:18 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="040874.html">[Twisted-Python] Understanding the role of .tap files
</A></li>
        <LI>Next message (by thread): <A HREF="040883.html">[Twisted-Python] Understanding the role of .tap files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40876">[ date ]</a>
              <a href="thread.html#40876">[ thread ]</a>
              <a href="subject.html#40876">[ subject ]</a>
              <a href="author.html#40876">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Abe Fettig wrote:
&gt;<i> Hi folks,
</I>&gt;<i> 
</I>&gt;<i> I'm looking for help understanding how .tap files are meant to be used 
</I>&gt;<i> in production.  ...
</I>
Hi Abe,

I thought I'd respond even though I'm not a guru and my
method (which hasn't yet been used in *real* production,
but I plan to use it unless someone suggests something
better ;) may not be the orthodox way.

Real twisted gurus:  I trust you will set me straight if
necessary -- comments welcome!  ;)

For my app, I have created a shell script that generates
the tap every time the application is started up.  The
configuration options are given as arguments that are
passed thru to the tap builder (&quot;pgertap.py&quot;, in my case).
I've included my shell script below.  It's intended to be
usable as an /etc/init.d script (I'll add the functions
and runlevels when I go production).

I'll send pgertap.py if you like, but it's modeled exactly
after the example in the howto:  &quot;Writing a New Plug-In for
mktap&quot;, so if you read that you'll know all you need to know
about tap generators.

#! /bin/sh

usage='Usage:  pgerd [start|startsecure|restart|restartsecure|stop]'

if [[ -z $1 ]]; then
    echo $usage
    exit 1
fi
if [[ -z $PGERHOME ]]; then
    echo 'env var PGERHOME must be defined.'
    exit 1
fi

cd $PGERHOME/logs

case $1 in
    start)
        # start pgerd on <A HREF="http://[hostname">http://[hostname</A>]:8080
        mktap --appname=pgerd \
              pger --domains=PanGalactic,NARS \
                   --home=$PGERHOME
        twistd --no_save -l $PGERHOME/logs/pgerd.log \
                         -f $PGERHOME/logs/pger.tap
        ;;
    startsecure)
        # start pgerd on <A HREF="https://[hostname">https://[hostname</A>]:8080
        mktap --appname=pgerd \
              pger --domains=PanGalactic,NARS \
                   --home=$PGERHOME \
                   --encrypted=1
        twistd --no_save -l $PGERHOME/logs/pgerd.log \
                         -f $PGERHOME/logs/pger.tap
        ;;
    restart)
        # restart pgerd on <A HREF="http://[hostname">http://[hostname</A>]:8080
        kill `cat $PGERHOME/logs/twistd.pid`
        mv $PGERHOME/logs/pgerd.log \
           $PGERHOME/logs/archive/log.`date +%Y%m%d.%H.%M`
        sleep 1
        rm $PGERHOME/logs/*.tap
        mktap --appname=pgerd \
              pger --domains=PanGalactic,NARS \
                   --home=$PGERHOME
        twistd --no_save -l $PGERHOME/logs/pgerd.log \
                         -f $PGERHOME/logs/pger.tap
        ;;
    restartsecure)
        # restart pgerd on <A HREF="https://[hostname">https://[hostname</A>]:8080
        kill `cat $PGERHOME/logs/twistd.pid`
        mv $PGERHOME/logs/pgerd.log \
           $PGERHOME/logs/archive/log.`date +%Y%m%d.%H.%M`
        sleep 1
        rm $PGERHOME/logs/*.tap
        mktap --appname=pgerd \
              pger --domains=PanGalactic,NARS \
                   --home=$PGERHOME \
                   --encrypted=1
        twistd --no_save -l $PGERHOME/logs/pgerd.log \
                         -f $PGERHOME/logs/pger.tap
        ;;
    stop)
        # stop pgerd and archive its log
        kill `cat $PGERHOME/logs/twistd.pid`
        mv $PGERHOME/logs/pgerd.log \
           $PGERHOME/logs/archive/log.`date +%Y%m%d.%H.%M`
        sleep 1
        rm $PGERHOME/logs/*.tap
        ;;
    *)
        # print help and exit
        echo &quot;argument \&quot;$1\&quot; not recognized.&quot;
        echo $usage
        exit 1
        ;;
esac
exit 0


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="040874.html">[Twisted-Python] Understanding the role of .tap files
</A></li>
	<LI>Next message (by thread): <A HREF="040883.html">[Twisted-Python] Understanding the role of .tap files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40876">[ date ]</a>
              <a href="thread.html#40876">[ thread ]</a>
              <a href="subject.html#40876">[ subject ]</a>
              <a href="author.html#40876">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
