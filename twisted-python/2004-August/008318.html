<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Problem with SYN_SENT's under SCO
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problem%20with%20SYN_SENT%27s%20under%20SCO&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008317.html">
   <LINK REL="Next"  HREF="008319.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Problem with SYN_SENT's under SCO</H1>
    <B>Richard Sharp</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problem%20with%20SYN_SENT%27s%20under%20SCO&In-Reply-To="
       TITLE="[Twisted-Python] Problem with SYN_SENT's under SCO">Richard.Sharp at t-online.de
       </A><BR>
    <I>Mon Aug  9 09:16:46 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008317.html">[Twisted-Python] How to write to log in the context of a	tap-builder?
</A></li>
        <LI>Next message: <A HREF="008319.html">[Twisted-Python] &quot;Twisted Web&quot; Book
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8318">[ date ]</a>
              <a href="thread.html#8318">[ thread ]</a>
              <a href="subject.html#8318">[ subject ]</a>
              <a href="author.html#8318">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
I recently had a problem under SCO that I had to solve. The program was 
piling up open socket objects all hanging in the state of SYN_SENT. 
Eventually the maximum number of open files was exceeded and the 
application hung badly.

I eventually narrowed the problem down with a perfectly normal python 
program to trying to connect as a client to a server that is not 
listening. The first connect returns the error EINPROGRESS, the second 
connect then returns the error &quot;Connection refused&quot;. Running a simple 
program that repeatedly tried to connect, I could use &quot;netstat -a&quot; to 
watch the SYN_SENT's increasing. This only appears to happen under SCO 
and even here I am not sure whether it is not version specific.

I discovered that closing the socket object after the &quot;connection 
refused&quot; seemed to release any open objects and removed the SYN_SENTS, 
so I changed failIfNotConnected to what you see below. There may be a 
better or more appropriate solution but this has at least got rid of my 
problem.

Version 1.3.0 internet/tcp.py from line 355:

def failIfNotConnected(self, err):
        if sys.platform[0:3] != 'sco':
            if (self.connected or
                self.disconnected or
                not (hasattr(self, &quot;connector&quot;))):
                return
        else:
            self.socket.close()
            if not (hasattr(self,&quot;connector&quot;)):
                return
        self.connector.connectionFailed(failure.Failure(err))
        if hasattr(self, &quot;reactor&quot;):
            # this doesn't happens if we failed in __init__
            self.stopReading()
            self.stopWriting()
            del self.connector

greetings,

Richard Sharp



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008317.html">[Twisted-Python] How to write to log in the context of a	tap-builder?
</A></li>
	<LI>Next message: <A HREF="008319.html">[Twisted-Python] &quot;Twisted Web&quot; Book
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8318">[ date ]</a>
              <a href="thread.html#8318">[ thread ]</a>
              <a href="subject.html#8318">[ subject ]</a>
              <a href="author.html#8318">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
