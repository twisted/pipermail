<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ENOBUF and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ENOBUF%20and%20Twisted&In-Reply-To=41245753.6010008%40trisoft.com.pl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008430.html">
   <LINK REL="Next"  HREF="008432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ENOBUF and Twisted</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20ENOBUF%20and%20Twisted&In-Reply-To=41245753.6010008%40trisoft.com.pl"
       TITLE="[Twisted-Python] ENOBUF and Twisted">andrew-twisted at puzzling.org
       </A><BR>
    <I>Thu Aug 19 05:10:07 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008430.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
        <LI>Next message: <A HREF="008432.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8431">[ date ]</a>
              <a href="thread.html#8431">[ thread ]</a>
              <a href="subject.html#8431">[ subject ]</a>
              <a href="author.html#8431">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Aug 19, 2004 at 09:31:31AM +0200, Grzegorz Makarewicz wrote:
&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">screwtape at froup.com</A> wrote:
</I>&gt;<i> &gt;A colleague of mine was working with a server written in Twisted
</I>&gt;<i> &gt;today, and he ran into a problem involving Twisted. He called me over
</I>&gt;<i> &gt;(since I'm supposed to be the Python Guru here, which just means I'm
</I>&gt;<i> &gt;slightly less ignorant than everybody else :) and we tracked the
</I>&gt;<i> &gt;behaviour in question all the way down to twisted.internet.tcp.
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> This is not a bug
</I>&gt;<i> 
</I>&gt;<i> select says &quot;yes there is room inm the socket buffer&quot;
</I>&gt;<i> however datagram protocols do not store anythign in the outgoing socket
</I>&gt;<i> buffer, but, instead hand the packets directly to the driver for the
</I>&gt;<i> NIC.
</I>&gt;<i> 
</I>&gt;<i> when the NIC fils up it returns ENOBUFS
</I>&gt;<i> 
</I>&gt;<i> use sleep(0.01) between calls to socket.send
</I>
Using sleep in Twisted would be a bad idea -- if you have other sockets on
other network cards, you should just work on servicing them rather than
stopping everything.  It's possible there's other work to do other than
socket operations, too, e.g. servicing any pendingTimedCalls (created by
reactor.callLater).  In short, time.sleep should not be used in the Twisted
main thread, let alone the reactor itself.

If the only sane way to deal with this is to wait 100ms and try again, then
I'd try this:

    [ ... caught ENOBUFS ... ]
    reactor.removeReader(sock)
    reactor.callLater(0.1, reactor.addReader, sock)

This might interact badly with other systems that try to add/remove that
reader (consumers/producers maybe?), but is probably good enough for
screwtape's particular case.

I wonder if the win32reactor or iocpreactor get more useful information than
select and so can handle this better?
    
-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008430.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
	<LI>Next message: <A HREF="008432.html">[Twisted-Python] ENOBUF and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8431">[ date ]</a>
              <a href="thread.html#8431">[ thread ]</a>
              <a href="subject.html#8431">[ subject ]</a>
              <a href="author.html#8431">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
