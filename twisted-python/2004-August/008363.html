<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Service as a daemon
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Service%20as%20a%20daemon&In-Reply-To=3C132D6A-EC83-11D8-B75D-000A95AE562E%40parspro.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008355.html">
   <LINK REL="Next"  HREF="008367.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Service as a daemon</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Service%20as%20a%20daemon&In-Reply-To=3C132D6A-EC83-11D8-B75D-000A95AE562E%40parspro.com"
       TITLE="[Twisted-Python] Service as a daemon">exarkun at divmod.com
       </A><BR>
    <I>Thu Aug 12 19:49:21 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008355.html">[Twisted-Python] Service as a daemon
</A></li>
        <LI>Next message: <A HREF="008367.html">[Twisted-Python] Service as a daemon
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8363">[ date ]</a>
              <a href="thread.html#8363">[ thread ]</a>
              <a href="subject.html#8363">[ subject ]</a>
              <a href="author.html#8363">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>John Toohey wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> I have a twisted server which can be started with the following code :-
</I>&gt;<i> 
</I>&gt;<i> if __name__==&quot;__main__&quot;:
</I>&gt;<i> 
</I>&gt;<i>     application = service.Application('feedserver', uid=1, gid=1)
</I>&gt;<i>     f = FeedService('feedserver')
</I>&gt;<i>     reactor.connectTCP('localhost',8002,f.getFactory())
</I>&gt;<i> 
</I>&gt;<i>     f.setServiceParent(service.IServiceCollection(application))
</I>&gt;<i>     f.startService()
</I>&gt;<i>     reactor.run()
</I>
   There's little point in using service.Application, if it is used as 
above.  A better way to do this would be to put the above code into a 
.tac file (adding the appropriate imports), remove the last two lines, 
and run it with &quot;twistd -y &lt;filename.tac&gt;&quot;.

&gt;<i> 
</I>&gt;<i> The f.startService method makes a call to a database and using the PB 
</I>&gt;<i> layer, sends data to another twisted server every 5 minutes. However, 
</I>&gt;<i> when I try to create a .tap file and run it as a daemon with this code :-
</I>&gt;<i> 
</I>&gt;<i> def makeService(config):
</I>&gt;<i>     pbport = int(config[&quot;pbport&quot;])
</I>&gt;<i> 
</I>&gt;<i>     application = service.Application('feedserver', uid=1, gid=1)
</I>&gt;<i>     f = FeedService('feedserver')
</I>&gt;<i>     serviceCollection = service.IServiceCollection(application)
</I>&gt;<i>     internet.TCPClient(&quot;localhost&quot;,pbport, 
</I>&gt;<i> f.getFactory()).setServiceParent(serviceCollection)
</I>&gt;<i>     f.startService()
</I>&gt;<i> 
</I>&gt;<i>     return serviceCollection
</I>&gt;<i> 
</I>&gt;<i> The f.startService method is not called, and the data is not sent to the 
</I>&gt;<i> other server. What am I missing here?
</I>&gt;<i> 
</I>
   makeService is run when the .tap file is written.  That means 
f.startService() is called when the .tap file is written.  Since the 
reactor isn't running at this point, the connection will never happen. 
When you later run this .tap file with &quot;twistd -f &lt;filename.tap&gt;&quot;, I 
would expect the connection to occur.  Are you running the resulting tap 
file with &quot;twistd -f&quot;?

   Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008355.html">[Twisted-Python] Service as a daemon
</A></li>
	<LI>Next message: <A HREF="008367.html">[Twisted-Python] Service as a daemon
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8363">[ date ]</a>
              <a href="thread.html#8363">[ thread ]</a>
              <a href="subject.html#8363">[ subject ]</a>
              <a href="author.html#8363">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
