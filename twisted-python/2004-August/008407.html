<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] including plugins.tml in a package
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20including%20plugins.tml%20in%20a%20package&In-Reply-To=1092674597.31921.126.camel%40harold">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008406.html">
   <LINK REL="Next"  HREF="008408.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] including plugins.tml in a package</H1>
    <B>Abe Fettig</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20including%20plugins.tml%20in%20a%20package&In-Reply-To=1092674597.31921.126.camel%40harold"
       TITLE="[Twisted-Python] including plugins.tml in a package">abe at fettig.net
       </A><BR>
    <I>Mon Aug 16 14:00:17 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008406.html">[Twisted-Python] including plugins.tml in a package
</A></li>
        <LI>Next message: <A HREF="008408.html">[Distutils] Re: [Twisted-Python] including plugins.tml in a	package
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8407">[ date ]</a>
              <a href="thread.html#8407">[ thread ]</a>
              <a href="subject.html#8407">[ subject ]</a>
              <a href="author.html#8407">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>OK, I've come up with a hack that seems to accomplish putting data files 
in with python files in bdist_wininst.  This is a hack, folks - I'm not 
a distutils expert, and I'm really hoping someone is going to chime in 
with a better way.

Basically, I'm checking to see if the build command is bdist_wininst, 
and if so, prepending /PURELIB/ to the path of data files.  This has the 
effect of putting these files in the installer zip under 
PURELIB/file/name, rather than DATA/file/name.  I can't offer a good 
explanation for why this works, though.

Here's my setup.py file:

from distutils.core import setup
from distutils.command import install
import os, sys

data_files = [['hep', ['hep/plugins.tml']],
               ['hep/web/static', ['hep/web/static/hep.css']],
               ]

# hack to put data files in same basedir as python code
for scheme in install.INSTALL_SCHEMES.values():
     scheme['data'] = scheme['purelib']

# another hack to accomplish the same thing for windows builds
if sys.argv[1] == 'bdist_wininst':
     for fileInfo in data_files:
         fileInfo[0] = '/PURELIB/%s' % fileInfo[0]

setup(name='hep',
       version='0.6.1',
       description='Hep, a multiprotocol message server.',
       author='Abe Fettig',
       author_email='<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">xxx at xxxxx.xxx</A>',
       url='<A HREF="http://www.fettig.net/projects/hep',">http://www.fettig.net/projects/hep',</A>
       packages=['hep', 'hep.services', 'hep.tests'],
       data_files=data_files,
       )

-- EOF --

I'm cross-posting this to distutils-sig in case someone there has a 
better solution.

Abe

Matt Goodall wrote:

&gt;<i> On Mon, 2004-08-16 at 17:28, Abe Fettig wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>Matt Goodall wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Nevow tinkers with distutils to install a .css in amongst the Python
</I>&gt;&gt;&gt;<i>modules. Here's the config:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>[snip]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        for scheme in install.INSTALL_SCHEMES.values():
</I>&gt;&gt;&gt;<i>            scheme['data'] = scheme['purelib']
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I've tried that approach, but as far as I can see it doesn't work for 
</I>&gt;&gt;<i>bdist_wininst.  I just checked nevow out of cvs, ran &quot;python setup.py 
</I>&gt;&gt;<i>bdist_wininst&quot;, and installed the package.  Rather than putting 
</I>&gt;&gt;<i>formless/freeform-default.css in c:\Python23\Lib\site-packages\formless, 
</I>&gt;&gt;<i>it put it in C:\Python23\formless, which I'm pretty sure is wrong.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Oh ... erm ... damn ;-). Thanks for pointing the error out.
</I>&gt;<i> 
</I>&gt;<i> Cheers, Matt
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008406.html">[Twisted-Python] including plugins.tml in a package
</A></li>
	<LI>Next message: <A HREF="008408.html">[Distutils] Re: [Twisted-Python] including plugins.tml in a	package
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8407">[ date ]</a>
              <a href="thread.html#8407">[ thread ]</a>
              <a href="subject.html#8407">[ subject ]</a>
              <a href="author.html#8407">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
