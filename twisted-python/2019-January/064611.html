<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Negative error code breaks twisted.conch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Negative%20error%20code%20breaks%20twisted.conch&In-Reply-To=%3C1547479408.2459764.1634165776.62199E68%40webmail.messagingengine.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Negative error code breaks twisted.conch</H1>
    <B>Peter Westlake</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Negative%20error%20code%20breaks%20twisted.conch&In-Reply-To=%3C1547479408.2459764.1634165776.62199E68%40webmail.messagingengine.com%3E"
       TITLE="[Twisted-Python] Negative error code breaks twisted.conch">peter.westlake at pobox.com
       </A><BR>
    <I>Mon Jan 14 08:23:28 MST 2019</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64611">[ date ]</a>
              <a href="thread.html#64611">[ thread ]</a>
              <a href="subject.html#64611">[ subject ]</a>
              <a href="author.html#64611">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>An SSCCE:

from twisted.internet import error
from twisted.python import failure
from twisted.conch.ssh.session import SSHSessionProcessProtocol
from mock import MagicMock

err = error.ProcessTerminated(-1)
fail = failure.Failure(err)
session = MagicMock()
proto = SSHSessionProcessProtocol(session)
proto.processEnded(fail)


That fails with:

Traceback (most recent call last):
  File &quot;.../negexit.py&quot;, line 10, in &lt;module&gt;
    proto.processEnded(fail)
  File &quot;/usr/lib64/python2.7/site-
  packages/twisted/conch/ssh/session.py&quot;, line 279, in processEnded    struct.pack('&gt;L', err.exitCode))
struct.error: integer out of range for 'L' format code

I'm running an SSH server on Windows, where negative exit codes
can happen.
Passing negative numbers to a &quot;&gt;L&quot; format was allowed in Python before
2.6, where the number was treated as an unsigned int of the same bit
pattern. It was deprecated in 2.6, and became an error in 2.7. It's only
just become a problem for me because I'm updating a 10 year old SSH
server that has been running under 2.4 all this time.
Presumably the fix is to bit-mask the exitCode? I was able to work
around the error by doing that in a copy of _dumbwin32proc.py which was
copied into the project (historical reasons, don't ask) but it would be
nice to have a proper upstream fix. Not least because I want to purge
the copied-in file, as you can imagine.
Peter.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20190114/85622298/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64611">[ date ]</a>
              <a href="thread.html#64611">[ thread ]</a>
              <a href="subject.html#64611">[ subject ]</a>
              <a href="author.html#64611">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
