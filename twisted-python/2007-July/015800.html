<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] potential connectSSH workflow
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20potential%20connectSSH%20workflow&In-Reply-To=324cfb540707261447q240cc4b0ve340fed2148a3fe8%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015798.html">
   <LINK REL="Next"  HREF="015801.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] potential connectSSH workflow</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20potential%20connectSSH%20workflow&In-Reply-To=324cfb540707261447q240cc4b0ve340fed2148a3fe8%40mail.gmail.com"
       TITLE="[Twisted-Python] potential connectSSH workflow">glyph at divmod.com
       </A><BR>
    <I>Thu Jul 26 21:50:04 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015798.html">[Twisted-Python] potential connectSSH workflow
</A></li>
        <LI>Next message: <A HREF="015801.html">[Twisted-Python] potential connectSSH workflow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15800">[ date ]</a>
              <a href="thread.html#15800">[ thread ]</a>
              <a href="subject.html#15800">[ subject ]</a>
              <a href="author.html#15800">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26 Jul, 09:47 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">paulswartz at gmail.com</A> wrote:
&gt;<i>On 7/26/07, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>&gt; wrote:
</I>&gt;&gt;<i>On 09:14 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">paulswartz at gmail.com</A> wrote:
</I>
Let me quote this point from the end first, because it is the central 
point of agreement, and basically the specification for this feature:
&gt;<i>This would make the default .connect(hostname) work equivalently to
</I>&gt;<i>the default 'ssh hostname' but still give options for the other
</I>&gt;<i>overrides.
</I>
I don't think, however, that the distinction being proposed (function 
arguments vs. defaults) is quite the right way to go about it, though.
&gt;&gt;<i> &gt;That makes sense: a ConchConnection object (snip)
</I>
&gt;&gt;<i>&quot;Connection&quot; seems like a weird name for that to me, as it applies it 
</I>&gt;&gt;<i>is
</I>&gt;&gt;<i>attached to a particular ... well, connection.  Connector, maybe?
</I>
&gt;<i>I actually meant Connector :) There's also Creator (in comparison with
</I>&gt;<i>t.i.protocol.ClientCreator).
</I>
Let's call it ConchEndpoint for the moment.  Hopefully why I say that 
will become clear in a moment.
&gt;&gt;<i> &gt;I still think that passing
</I>&gt;&gt;<i> &gt;authentication data in connect() is the right idea, but it can 
</I>&gt;&gt;<i>default
</I>&gt;&gt;<i> &gt;to using the keys that it finds in ~/.ssh or in a key agent.
</I>
&gt;&gt;<i>I agree emphatically, but both the default and non-default cases are
</I>&gt;&gt;<i>equally important.
</I>
&gt;<i>class IConch&lt;C word&gt;(Interface):
</I>&gt;<i>    def connect(host, port=22, user=None, knownHosts=None,
</I>&gt;<i>authentications=None):
</I>
I think the interface here is probably superfluous.  The interface 
definition, when there is one, should really just be an endpoint.  These 
may make sense as constructor arguments or arguments to a method that 
builds an endpoint though.  (More below...)
&gt;<i>To keep the current use case of verifying a host key with a function,
</I>&gt;<i>knownHosts could be a filename string, in which case it would be read
</I>&gt;<i>for host keys, or a function in which case it is called with the key
</I>&gt;<i>and fingerprint.  authentications would be a list functioning the same
</I>&gt;<i>was as in my initial outline.
</I>
OK, let's have a bit more depth.  This interface isn't quite right.

Starting at the bottom, &quot;knownHosts&quot; is the wrong name for this object. 
It should be &quot;hostVerifier&quot; and it should be an object with a method to 
verify the host.  It should definitely _not_ accept a filename string; 
in the filename case, it should look something like this:

    OpenSSHFormatVerifier(FilePath(&quot;my-ssh-hosts-file&quot;)
                          ui=GuiPasswordDialog())

In general, I think passing filenames around should be deprecated within 
Twisted; FilePath provides lots more flexibility, especially with a real 
interface to unify it with ZipPath.  (A marginal benefit of this is that 
your tests can avoid a whole bunch of file I/O because you can have a 
mock memory-backed FilePath.  This benefit becomes less marginal as more 
and more tests use it and the whole suite speeds up, though.)

As far as object-vs-function, passing functions around is always 
tempting, but it tends to mean &quot;This is an object with only one obvious 
method that I've thought of so far, which I'll call '__call__'&quot;.  There 
are lots of places I've used this idiom and found that it falls down and 
gets ugly when it ends up that you actually want _two_ methods instead.

To retain compatibility with the existing use-a-function-to-verify path, 
it would of course be trivial to have a SimpleFunctionVerifier.

This might seem like a lot of typing, so to help with abbreviation, a 
higher-level object could roll them together:

    altdotssh = DotSSH(FilePath(&quot;my-dot-ssh-dir&quot;))

And this leads in to my idea for subtly changing the design.  Instead of 
modifying stuff with arguments to the function:

    defaultConnector.connectSSH(
        factory, hostname, hostVerifier=altdotssh.hostVerifier)

Building a different object takes roughly the same amount of work and 
does roughly the same thing, but yields a result which can be passed 
around and used as a connector:

    endpt = defaultConfig.endpointSSH(
        hostname, hostVerifier=altdotssh.hostVerifier)
    endpt.connect(factory)

To push this flexibility even further, you could make the configuration 
object cloneable.

    cfg2 = defaultConfig.copy(hostVerifier=altdotssh.hostVerifier)
    endpt = cfg2.endpointSSH(hostname)
    endpt.connect(factory)

although whether this last additional level of flexibility is worth it 
or not probably depends on all of the things that a &quot;configuration&quot; 
object can contain.

Thoughts?


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015798.html">[Twisted-Python] potential connectSSH workflow
</A></li>
	<LI>Next message: <A HREF="015801.html">[Twisted-Python] potential connectSSH workflow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15800">[ date ]</a>
              <a href="thread.html#15800">[ thread ]</a>
              <a href="subject.html#15800">[ subject ]</a>
              <a href="author.html#15800">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
