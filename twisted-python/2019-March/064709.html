<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop/start%20client%20connections%20with%0A%20loseConnection%20in%20ReconnectingClientFactory&In-Reply-To=%3C3cae0c94-971b-c0b7-d1f0-b56968029282%40crossbario.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064708.html">
   <LINK REL="Next"  HREF="032216.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory</H1>
    <B>Tobias Oberstein</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop/start%20client%20connections%20with%0A%20loseConnection%20in%20ReconnectingClientFactory&In-Reply-To=%3C3cae0c94-971b-c0b7-d1f0-b56968029282%40crossbario.com%3E"
       TITLE="[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory">tobias.oberstein at crossbario.com
       </A><BR>
    <I>Tue Mar 26 03:53:07 MDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064708.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
        <LI>Next message (by thread): <A HREF="032216.html">[Twisted-Python] txsni + alpn + acme (letsencrypt)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64709">[ date ]</a>
              <a href="thread.html#64709">[ thread ]</a>
              <a href="subject.html#64709">[ subject ]</a>
              <a href="author.html#64709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i> The Autobahn guys still show ReconnectingClientFactory in their docs, 
</I>
Where did you find that? That would be a doc bug, but in the _docs_, 
there is no reference to ReconnectingClientFactory

(cpy372_3) <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">oberstet at intel-nuci7</A>:~$ find 
~/scm/crossbario/autobahn-python/docs/ -type f -exec grep -Hi 
&quot;ReconnectingClientFactory&quot; {} \;
(cpy372_3) <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">oberstet at intel-nuci7</A>:~$

We do have some example code using ReconnectingClientFactory though:

(cpy372_3) <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">oberstet at intel-nuci7</A>:~$ find 
~/scm/crossbario/autobahn-python/examples/ -type f -exec grep -Hi 
&quot;ReconnectingClientFactory&quot; {} \; | wc -l
8

&gt;&gt;<i> and I remember looking at this before and ending up going with 
</I>&gt;&gt;<i> ReconnectingClientFactory because it works and didn't look like it'd 
</I>&gt;&gt;<i> need much effort to integrated into an existing code base.
</I>&gt;<i> 
</I>&gt;<i> Let me count the ways.
</I>&gt;<i> 
</I>&gt;<i>  1. ReconnectingClientFactory is destined for deprecation, eventually.
</I>&gt;<i>       You should just adopt the &quot;new&quot; thing now so that if we get more
</I>&gt;<i>     energy to cycle the APIs and delete the old stuff, you'll have less
</I>&gt;<i>     hassle to deal with.  (&quot;New&quot; is in quotes here since it's been
</I>&gt;<i>     around for well over 3 years at this point; Autobahn should update
</I>&gt;<i>     too, not just you.)
</I>
Autobahn will automatically use

twisted.application.internet.ClientService

for auto-reconnect when on Twisted 16.1.0+

<A HREF="https://github.com/crossbario/autobahn-python/blob/master/autobahn/twisted/wamp.py#L349">https://github.com/crossbario/autobahn-python/blob/master/autobahn/twisted/wamp.py#L349</A>

&gt;<i>  2. ClientService works with endpoints, which means you can use it with
</I>&gt;<i>     /any/ kind of transport, like SSH transports, subprocesses, etc.
</I>&gt;<i>       Most practically, it works with HostnameEndpoint which is a much
</I>&gt;<i>     better way to get TLS than connectSSL; ReconnectingClientFactory
</I>&gt;<i>     works, kind of accidentally, with TLS since connectSSL is on the
</I>&gt;<i>     reactor, but it won't use happy eyeballs and it won't connect over
</I>&gt;<i>     IPv6, so connections will be slower and less reliable.
</I>&gt;<i>  3. Conceptually, ClientService has a much clearer and more useful
</I>&gt;<i>     responsibility: its job is to /maintain a state/ (i.e.: that there
</I>&gt;<i>     is a single connection, that it is connected) rather than to /do a
</I>&gt;<i>     thing/.  For example,
</I>&gt;<i>      1. if you want to shut down a ReconnectingClientFactory:
</I>&gt;<i>          1. you have to call stopTrying, then uh...
</I>&gt;<i>          2. find the last protocol it built with buildProtocol, then
</I>&gt;<i>          3. grab its transport (hope it's saving that transport as
</I>&gt;<i>             '.transport', because it doesn't actually have to)
</I>&gt;<i>          4. call loseConnection
</I>&gt;<i>          5. remember to trap connectionLost so you can see when its done.
</I>&gt;<i>      2. if you want to shut down a ClientService
</I>&gt;<i>          1. call stopService
</I>&gt;<i>          2. wait for the Deferred that it returned to fire
</I>&gt;<i>  4. ClientService is (mostly) implemented using composition rather than
</I>&gt;<i>     inheritance, so much less of the guts of the internal implementation
</I>&gt;<i>     is hanging around where you might accidentally twiddle it and break
</I>&gt;<i>     its assumptions, so you can trust its guarantees more.
</I>
++1

(note: Autobahn is a culprit to the overuse of inheritance vs 
composition too .. but the so-called &quot;new API&quot; (for WAMP) is following 
composition + observer pattern, while the &quot;old API&quot; (that is inheriting 
from ApplicationSession) is still pretty much around. we have some 
legacy already ..)

&gt;<i>      1. other benefits of composition: you don't have to override
</I>&gt;<i>         attributes of your Protocol and thereby indulge in subclassing
</I>&gt;<i>         yourself to get notifications; consider 'prepareConnection',
</I>&gt;<i>         'whenConnected'.
</I>&gt;<i>      2. the retry policy mechanics are better documented and much easier
</I>&gt;<i>         to customize
</I>&gt;<i>      3. it's backed by a formal state machine - not that I'm aware of
</I>&gt;<i>         any specific bugs in ReconnectingClientFactory but do you think
</I>&gt;<i>         it got /all/ of these state transitions correct:
</I>&gt;<i>         <A HREF="https://gist.github.com/glyph/614be03151556333efe04b849fa05930">https://gist.github.com/glyph/614be03151556333efe04b849fa05930</A>
</I>&gt;<i>  5. It's more testable because it just takes its clock and reactor as
</I>&gt;<i>     constructor parameters, rather than requiring post-hoc
</I>&gt;<i>     poorly-documented attribute patching to become testable.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hopefully at least some of this is convincing :)
</I>
all and each of them is convincing;)

&gt;<i> 
</I>&gt;<i> -g
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>

-- 

Tobias Oberstein - phone +49 176 2375 2055 - <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tobias.oberstein at crossbario.com</A>
Crossbar.io GmbH - Waldstrasse 18 - 91054 Erlangen
HRB 15870 - Amtsgericht Fuerth - Geschäftsfuehrer/CEO - Tobias Oberstein

<A HREF="https://crossbar.io">https://crossbar.io</A>
<A HREF="https://crossbario.com">https://crossbario.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064708.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
	<LI>Next message (by thread): <A HREF="032216.html">[Twisted-Python] txsni + alpn + acme (letsencrypt)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64709">[ date ]</a>
              <a href="thread.html#64709">[ thread ]</a>
              <a href="subject.html#64709">[ subject ]</a>
              <a href="author.html#64709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
