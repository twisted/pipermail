<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop/start%20client%20connections%20with%0A%20loseConnection%20in%20ReconnectingClientFactory&In-Reply-To=%3CFEDD705C-1549-455C-B34F-F032564AA9F9%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="032245.html">
   <LINK REL="Next"  HREF="032248.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop/start%20client%20connections%20with%0A%20loseConnection%20in%20ReconnectingClientFactory&In-Reply-To=%3CFEDD705C-1549-455C-B34F-F032564AA9F9%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Mar 26 02:32:36 MDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="032245.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
        <LI>Next message (by thread): <A HREF="032248.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32247">[ date ]</a>
              <a href="thread.html#32247">[ thread ]</a>
              <a href="subject.html#32247">[ subject ]</a>
              <a href="author.html#32247">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> On Mar 26, 2019, at 12:14 AM, Chris Withers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris at withers.org</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On 24/03/2019 04:30, Glyph wrote:
</I>&gt;&gt;<i> I'd further note that ClientService is /generally/ the new, good way to do things and ReconnectingClientFactory is the old, bad way.  Our hope is to eventually deprecate ReconnectingClientFactory and most of the APIs that it uses, but this is a big project that we have not been able to make much progress on in the last, ahem, decade or so.
</I>&gt;<i> 
</I>&gt;<i> What's the big advantage(s) of ClientService over ReconnectingClientFactory?
</I>&gt;<i> 
</I>&gt;<i> The Autobahn guys still show ReconnectingClientFactory in their docs, and I remember looking at this before and ending up going with ReconnectingClientFactory because it works and didn't look like it'd need much effort to integrated into an existing code base.
</I>
Let me count the ways.

ReconnectingClientFactory is destined for deprecation, eventually.  You should just adopt the &quot;new&quot; thing now so that if we get more energy to cycle the APIs and delete the old stuff, you'll have less hassle to deal with.  (&quot;New&quot; is in quotes here since it's been around for well over 3 years at this point; Autobahn should update too, not just you.)
ClientService works with endpoints, which means you can use it with any kind of transport, like SSH transports, subprocesses, etc.  Most practically, it works with HostnameEndpoint which is a much better way to get TLS than connectSSL; ReconnectingClientFactory works, kind of accidentally, with TLS since connectSSL is on the reactor, but it won't use happy eyeballs and it won't connect over IPv6, so connections will be slower and less reliable.
Conceptually, ClientService has a much clearer and more useful responsibility: its job is to maintain a state (i.e.: that there is a single connection, that it is connected) rather than to do a thing.  For example, 
if you want to shut down a ReconnectingClientFactory:
you have to call stopTrying, then uh...
find the last protocol it built with buildProtocol, then
grab its transport (hope it's saving that transport as '.transport', because it doesn't actually have to) 
call loseConnection
remember to trap connectionLost so you can see when its done.
if you want to shut down a ClientService
call stopService
wait for the Deferred that it returned to fire
ClientService is (mostly) implemented using composition rather than inheritance, so much less of the guts of the internal implementation is hanging around where you might accidentally twiddle it and break its assumptions, so you can trust its guarantees more.
other benefits of composition: you don't have to override attributes of your Protocol and thereby indulge in subclassing yourself to get notifications; consider 'prepareConnection', 'whenConnected'.
the retry policy mechanics are better documented and much easier to customize
it's backed by a formal state machine - not that I'm aware of any specific bugs in ReconnectingClientFactory but do you think it got all of these state transitions correct: <A HREF="https://gist.github.com/glyph/614be03151556333efe04b849fa05930">https://gist.github.com/glyph/614be03151556333efe04b849fa05930</A> &lt;<A HREF="https://gist.github.com/glyph/614be03151556333efe04b849fa05930">https://gist.github.com/glyph/614be03151556333efe04b849fa05930</A>&gt;
It's more testable because it just takes its clock and reactor as constructor parameters, rather than requiring post-hoc poorly-documented attribute patching to become testable.

Hopefully at least some of this is convincing :)

-g
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20190326/143f0701/attachment.html&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="032245.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
	<LI>Next message (by thread): <A HREF="032248.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32247">[ date ]</a>
              <a href="thread.html#32247">[ thread ]</a>
              <a href="subject.html#32247">[ subject ]</a>
              <a href="author.html#32247">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
