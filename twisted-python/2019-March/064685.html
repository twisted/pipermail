<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] txsni + alpn + acme (letsencrypt)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20txsni%20%2B%20alpn%20%2B%20acme%20%28letsencrypt%29&In-Reply-To=%3CCAG8k2%2B5mksA1QLXBx_7f%2BkCAFyS6Kksued7YAqW_X4WsvUyS8A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064682.html">
   <LINK REL="Next"  HREF="064687.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] txsni + alpn + acme (letsencrypt)</H1>
    <B>Daniel Holth</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20txsni%20%2B%20alpn%20%2B%20acme%20%28letsencrypt%29&In-Reply-To=%3CCAG8k2%2B5mksA1QLXBx_7f%2BkCAFyS6Kksued7YAqW_X4WsvUyS8A%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] txsni + alpn + acme (letsencrypt)">dholth at gmail.com
       </A><BR>
    <I>Sat Mar 23 22:20:53 MDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064682.html">[Twisted-Python] txsni + alpn + acme (letsencrypt)
</A></li>
        <LI>Next message (by thread): <A HREF="064687.html">[Twisted-Python] txsni + alpn + acme (letsencrypt)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64685">[ date ]</a>
              <a href="thread.html#64685">[ thread ]</a>
              <a href="subject.html#64685">[ subject ]</a>
              <a href="author.html#64685">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>All we have to do is have some kind of per connection certificate store or
flag. If acme is in the first packet and the special certificate exists,
send it. Otherwise send the normal certificate, for a very short window of
possible brokenness. Letsencrypt may or may not require correct alpn
negotiation. Should be simple.

I'm happy running the acme client separately and listing my domain instead
of doing it all on demand inside twisted.


On Sat, Mar 23, 2019, 23:59 Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; On Mar 23, 2019, at 4:06 PM, Daniel Holth &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dholth at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; HOLY REGEX BATMAN
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; class _ConnectionProxy(object):
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    def bio_write(self, buf):
</I>&gt;<i> &gt;        if ACME_TLS_1 in buf:
</I>&gt;<i> &gt;            self.acme_tls_1 = True
</I>&gt;<i> &gt;        self.bio_write = self._obj.bio_write
</I>&gt;<i> &gt;        return self._obj.bio_write(buf)
</I>&gt;<i> &gt; Now we can choose the acme certificate store in the sni callback and
</I>&gt;<i> &gt; make letsencrypt happy!
</I>&gt;<i>
</I>&gt;<i> 1. Gross
</I>&gt;<i> 2. Hooray!
</I>&gt;<i>
</I>&gt;<i> -g
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20190324/ff338129/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064682.html">[Twisted-Python] txsni + alpn + acme (letsencrypt)
</A></li>
	<LI>Next message (by thread): <A HREF="064687.html">[Twisted-Python] txsni + alpn + acme (letsencrypt)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64685">[ date ]</a>
              <a href="thread.html#64685">[ thread ]</a>
              <a href="subject.html#64685">[ subject ]</a>
              <a href="author.html#64685">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
