<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop/start%20client%20connections%20with%0A%20loseConnection%20in%20ReconnectingClientFactory&In-Reply-To=%3C664a2b76-656a-333e-49d5-bcdd32cec4eb%40withers.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="032214.html">
   <LINK REL="Next"  HREF="032249.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory</H1>
    <B>Chris Withers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop/start%20client%20connections%20with%0A%20loseConnection%20in%20ReconnectingClientFactory&In-Reply-To=%3C664a2b76-656a-333e-49d5-bcdd32cec4eb%40withers.org%3E"
       TITLE="[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory">chris at withers.org
       </A><BR>
    <I>Tue Mar 26 01:28:26 MDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="032214.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
        <LI>Next message (by thread): <A HREF="032249.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32246">[ date ]</a>
              <a href="thread.html#32246">[ thread ]</a>
              <a href="subject.html#32246">[ subject ]</a>
              <a href="author.html#32246">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/03/2019 23:26, Chris Satterthwaite wrote:
&gt;<i> Hi Chris,
</I>&gt;<i> 
</I>&gt;<i> The files I attached (with the full classes) made it through to my email, but I wondered if they would they go through to everyone.
</I>&gt;<i> 
</I>&gt;<i> Here's a gist with the same scripts:
</I>&gt;<i> <A HREF="https://gist.github.com/codingadvocate/f732da79ddf6cef4b7a0b6b3679f519f">https://gist.github.com/codingadvocate/f732da79ddf6cef4b7a0b6b3679f519f</A>
</I>&gt;<i> 
</I>&gt;<i> And yep, as you mentioned, a 'sleep' is definitely blocking.  That's not in the production version; I just dropped it in here for the test script to simulate something.
</I>
Observations:

- Your super call at 
<A HREF="https://gist.github.com/codingadvocate/f732da79ddf6cef4b7a0b6b3679f519f#file-testclient-py-L46,">https://gist.github.com/codingadvocate/f732da79ddf6cef4b7a0b6b3679f519f#file-testclient-py-L46,</A> 
I'd expect that to be super(ServiceClientFactory, self).__init__(), but 
your spelling may be a python 3 only thing that works?

- Those sleeps are going to cause you more problems than they solve.

- What does this seek to achieve? 
<A HREF="https://gist.github.com/codingadvocate/f732da79ddf6cef4b7a0b6b3679f519f#file-testclient-py-L88-L89">https://gist.github.com/codingadvocate/f732da79ddf6cef4b7a0b6b3679f519f#file-testclient-py-L88-L89</A>

- Why not use twisted logging instead of print? By setting it to debug, 
you'll get lots of into about what twisted is doing, and by using 
logging you won't need to do all that manual traceback printing.

- when you say &quot;When the client hits a problem, it calls 
transport.loseConnection()&quot;, where is that call to transport.loseConnection?

- when you noticed some Twisted source code that works off 
factory.numPorts, where is that code? Can you provide a link? This 
doesn't sound right...

Now, as to what your problem is, I suspect it's this call to stopTrying:
<A HREF="https://gist.github.com/codingadvocate/f732da79ddf6cef4b7a0b6b3679f519f#file-testclient-py-L87">https://gist.github.com/codingadvocate/f732da79ddf6cef4b7a0b6b3679f519f#file-testclient-py-L87</A>

The factory is stopped and started again by ReconnectingClientFactory, 
so you don't want that there as it means you stop trying every time 
there's a disconnection.

cheers,

Chris

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="032214.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
	<LI>Next message (by thread): <A HREF="032249.html">[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32246">[ date ]</a>
              <a href="thread.html#32246">[ thread ]</a>
              <a href="subject.html#32246">[ subject ]</a>
              <a href="author.html#32246">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
