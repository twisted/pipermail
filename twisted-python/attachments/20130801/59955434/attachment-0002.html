<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&#39;m&nbsp;a Google Summer&nbsp;of&nbsp;Code&nbsp;intern&nbsp;working&nbsp;on&nbsp;&quot;Deferred&nbsp;Cancellation&quot;&nbsp;project.&nbsp;I&#39;m&nbsp;recently&nbsp;working&nbsp;on&nbsp;adding&nbsp;cancellation&nbsp;support&nbsp;to&nbsp;twisted.internet.task.LoopingCall.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;However,&nbsp;after&nbsp;I&nbsp;added&nbsp;the&nbsp;canceller&nbsp;to&nbsp;LoopingCall.deferred,&nbsp;the twisted.test.test_application.TestInternet2.testPickledTimer&nbsp;failed&nbsp;due&nbsp;to&nbsp;a&nbsp;PicklingError.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
My&nbsp;branch&nbsp;is&nbsp;loopingcall-deferred-cancellation-6656.&nbsp;Here&nbsp;is&nbsp;the&nbsp;diff&nbsp;of&nbsp;my&nbsp;code: &lt;a&nbsp;href=&quot;http://twistedmatrix.com/~diffresource.twistd/6656&quot;&gt;http://twistedmatrix.com/~diffresource.twistd/6656&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;Here&nbsp;is&nbsp;the&nbsp;error&nbsp;message:&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;div&gt;===============================================================================&lt;/div&gt;&lt;div&gt;[ERROR]&lt;/div&gt;&lt;div&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&quot;/home/kai/Projects/GSoC/DeferredCancellation/Twisted/branches/loopingcall-deferred-cancellation-6656/twisted/test/test_application.py&quot;,&nbsp;line&nbsp;487,&nbsp;in&nbsp;testPickledTimer&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;s&nbsp;=&nbsp;pickle.dumps(t0)&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;1374,&nbsp;in&nbsp;dumps&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Pickler(file,&nbsp;protocol).dump(obj)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;224,&nbsp;in&nbsp;dump&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;self.save(obj)&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;725,&nbsp;in&nbsp;save_inst&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;save(stuff)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;649,&nbsp;in&nbsp;save_dict&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;self._batch_setitems(obj.iteritems())&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;663,&nbsp;in&nbsp;_batch_setitems&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;save(v)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;725,&nbsp;in&nbsp;save_inst&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;save(stuff)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;649,&nbsp;in&nbsp;save_dict&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;self._batch_setitems(obj.iteritems())&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;663,&nbsp;in&nbsp;_batch_setitems&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;save(v)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;331,&nbsp;in&nbsp;save&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;self.save_reduce(obj=obj,&nbsp;*rv)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;401,&nbsp;in&nbsp;save_reduce&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;save(args)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;562,&nbsp;in&nbsp;save_tuple&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;save(element)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;331,&nbsp;in&nbsp;save&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;self.save_reduce(obj=obj,&nbsp;*rv)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;419,&nbsp;in&nbsp;save_reduce&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;save(state)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;649,&nbsp;in&nbsp;save_dict&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;self._batch_setitems(obj.iteritems())&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;663,&nbsp;in&nbsp;_batch_setitems&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;save(v)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;331,&nbsp;in&nbsp;save&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;self.save_reduce(obj=obj,&nbsp;*rv)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;419,&nbsp;in&nbsp;save_reduce&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;save(state)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;649,&nbsp;in&nbsp;save_dict&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;self._batch_setitems(obj.iteritems())&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;663,&nbsp;in&nbsp;_batch_setitems&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;save(v)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;331,&nbsp;in&nbsp;save&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;self.save_reduce(obj=obj,&nbsp;*rv)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;419,&nbsp;in&nbsp;save_reduce&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;save(state)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;649,&nbsp;in&nbsp;save_dict&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;self._batch_setitems(obj.iteritems())&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;663,&nbsp;in&nbsp;_batch_setitems&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;save(v)&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;286,&nbsp;in&nbsp;save&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;f(self,&nbsp;obj)&nbsp;#&nbsp;Call&nbsp;unbound&nbsp;method&nbsp;with&nbsp;explicit&nbsp;self&lt;/div&gt;&lt;div&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.7/pickle.py&quot;,&nbsp;line&nbsp;748,&nbsp;in&nbsp;save_global&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;(obj,&nbsp;module,&nbsp;name))&lt;/div&gt;&lt;div&gt;pickle.PicklingError:&nbsp;Can&#39;t&nbsp;pickle&nbsp;&lt;function&nbsp;&lt;lambda&gt;&nbsp;at&nbsp;0x8f1fb8c&gt;:&nbsp;it&#39;s&nbsp;not&nbsp;found&nbsp;as&nbsp;twisted.internet.posixbase.&lt;lambda&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;twisted.test.test_application.TestInternet2.testPickledTimer&lt;/div&gt;&lt;div&gt;===============================================================================&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&nbsp;thought&nbsp;the&nbsp;reason&nbsp;was&nbsp;the&nbsp;circular&nbsp;references.&nbsp;However&nbsp;I&nbsp;searched&nbsp;about&nbsp;it&nbsp;and&nbsp;found&nbsp;that&nbsp;pickle&nbsp;could&nbsp;handle&nbsp;the&nbsp;circular&nbsp;reference&nbsp;cases.&nbsp;But&nbsp;the&nbsp;only&nbsp;significant&nbsp;change&nbsp;is&nbsp;that&nbsp;after&nbsp;I&nbsp;added&nbsp;the&nbsp;canceller,&nbsp;there&nbsp;is&nbsp;a&nbsp;circular&nbsp;reference&nbsp;between&nbsp;LoopingCall&nbsp;and&nbsp;LoopingCall.deferred.&nbsp;So&nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;what&#39;s&nbsp;the&nbsp;problem.&nbsp;How&nbsp;can&nbsp;I&nbsp;fix&nbsp;this?&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thanks,&lt;/div&gt;&lt;div&nbsp;style&gt;-Kai&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
