<tt>
Hi,&nbsp;all<br>
&lt;br&gt;&nbsp;&lt;p&gt;I&nbsp;am&nbsp;using&nbsp;sqlalchemy&nbsp;in&nbsp;twisted&nbsp;in&nbsp;my&nbsp;project&nbsp;in&nbsp;the&nbsp;way&nbsp;below.<br>
&lt;br&gt;&nbsp;Defer&nbsp;any&nbsp;database&nbsp;operation&nbsp;so&nbsp;the&nbsp;twisted&#39;s&nbsp;main&nbsp;thread&nbsp;won&#39;t&nbsp;be<br>
&lt;br&gt;&nbsp;blocked.<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;And&nbsp;I&nbsp;use&nbsp;scoped_session,&nbsp;so&nbsp;that&nbsp;sessions&nbsp;won&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;created<br>
&lt;br&gt;&nbsp;again&nbsp;and&nbsp;again.<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;======================================<br>
&lt;br&gt;&nbsp;class&nbsp;Database()<br>
&lt;br&gt;&nbsp; &nbsp; &nbsp;def&nbsp;__init__(self,&nbsp;conn_str):<br>
&lt;br&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.conn_str&nbsp;=&nbsp;conn_str<br>
&lt;br&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.engine&nbsp;=&nbsp;create_engine(self.conn_str,&nbsp;echo=False)<br>
&lt;br&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.Session&nbsp;=&nbsp;scoped_session(sessionmaker(bind&nbsp;=&nbsp;self.engine,<br>
&lt;br&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; expire_on_commit=False))<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt; &nbsp; &nbsp;def&nbsp;getObjectById(self,&nbsp;klass,&nbsp;id):<br>
&lt;br&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;threads.deferToThread(self._getObjectById,&nbsp;klass,&nbsp;id)<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt; &nbsp; &nbsp;def&nbsp;_getObjectById(self,&nbsp;klass,&nbsp;id):<br>
&lt;br&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sess&nbsp;=&nbsp;self.Session()<br>
&lt;br&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;sess.query(klass).get(id)<br>
&lt;br&gt;&nbsp;======================================<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;The&nbsp;code&nbsp;doesn&#39;t&nbsp;work.&nbsp; &nbsp;When&nbsp;I&nbsp;limit&nbsp;the&nbsp;thread&nbsp;numbers&nbsp;to&nbsp;1<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt; &nbsp; &nbsp;reactor.suggestThreadPoolSize(1)<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;Everything&nbsp;goes&nbsp;fine.&nbsp; Other&nbsp;wise&nbsp;the&nbsp;server&nbsp;would&nbsp;be&nbsp;blocked&nbsp;and&nbsp;must<br>
&lt;br&gt;&nbsp;be&nbsp;killed&nbsp;by&nbsp;&quot;kill&nbsp;9&nbsp;...&quot;.<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;The&nbsp;result&nbsp;conflicts&nbsp;with&nbsp;my&nbsp;understanding&nbsp;of&nbsp;sqlalchemy.&nbsp; Since&nbsp;I<br>
&lt;br&gt;&nbsp;don&#39;t&nbsp;share&nbsp;any&nbsp;object&nbsp;between&nbsp;threads,&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;problem!<br>
&lt;br&gt;&nbsp;&lt;/p&gt;&lt;p&gt;Ah....&nbsp; It&nbsp;always&nbsp;have&nbsp;risk&nbsp;to&nbsp;use&nbsp;something&nbsp;you&nbsp;haven&#39;t&nbsp;tried<br>
&lt;br&gt;&nbsp;before&nbsp;....<br>
&nbsp;&nbsp;&lt;/p&gt;I&nbsp;think&nbsp;I&nbsp;have&nbsp;no&nbsp;choice&nbsp;but&nbsp;always&nbsp;set&nbsp;thread&nbsp;pool&nbsp;size&nbsp;to&nbsp;1&nbsp;...&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;look&nbsp;to&nbsp;the&nbsp;things&nbsp;around&nbsp;you,the&nbsp;immediate&nbsp;world&nbsp;around&nbsp;you,&nbsp;if&nbsp;you&nbsp;are&nbsp;alive,it&nbsp;will&nbsp;mean&nbsp;something&nbsp;to&nbsp;you&nbsp;——Paul&nbsp;Strand&lt;br&gt;<br>
<br>

</tt>
