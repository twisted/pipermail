<tt>
&lt;!DOCTYPE&nbsp;html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;&lt;/title&gt;&lt;style&nbsp;type=&quot;text/css&quot;&gt;p.MsoNormal,p.MsoNoSpacing{margin:0}<br>
p.MsoNormal,p.MsoNoSpacing{margin:0}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;are&nbsp;likely&nbsp;a&nbsp;few&nbsp;things&nbsp;wrong&nbsp;here.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;You&nbsp;are&nbsp;using&nbsp;requests.get()&nbsp;to&nbsp;make&nbsp;a&nbsp;HTTP&nbsp;request.&nbsp;This&nbsp;is&nbsp;blocking.&nbsp;You&nbsp;might&nbsp;consider&nbsp;using&nbsp;Twisted's&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/current/api/twisted.web.client.Agent.html&quot;&gt;Agent&lt;/a&gt;&nbsp;API&nbsp;instead&nbsp;(or&nbsp;&lt;a&nbsp;href=&quot;https://github.com/twisted/treq&quot;&gt;treq&lt;/a&gt;,&nbsp;which&nbsp;puts&nbsp;a&nbsp;requests-like&nbsp;API&nbsp;atop&nbsp;Agent).&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;As&nbsp;you&nbsp;add&nbsp;load&nbsp;your&nbsp;long&nbsp;computations&nbsp;will&nbsp;be&nbsp;queued.&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/current/api/twisted.internet.threads.html#deferToThread&quot;&gt;deferToThread&lt;/a&gt;&nbsp;dispatches&nbsp;the&nbsp;long_computation&nbsp;to&nbsp;the&nbsp;reactor's&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorThreads.html&quot;&gt;default&nbsp;thread&nbsp;pool&lt;/a&gt;.&nbsp;This&nbsp;poll&nbsp;has&nbsp;a&nbsp;maximum&nbsp;size&nbsp;and&nbsp;will&nbsp;queue&nbsp;work&nbsp;once&nbsp;it&nbsp;has&nbsp;spun&nbsp;up&nbsp;that&nbsp;many&nbsp;threads.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Rather&nbsp;than&nbsp;using&nbsp;deferToThread&nbsp;(which&nbsp;we&nbsp;should&nbsp;really&nbsp;deprecate&nbsp;as&nbsp;it&nbsp;doesn't&nbsp;accept&nbsp;a&nbsp;reactor&nbsp;parameter...)&nbsp;I'd&nbsp;recommend&nbsp;instantiating&nbsp;your&nbsp;own&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/current/api/twisted.python.threadpool.ThreadPool.html&quot;&gt;ThreadPool&lt;/a&gt;&nbsp;and&nbsp;using&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/current/api/twisted.internet.threads.html#deferToThreadPool&quot;&gt;deferToThreadPool&lt;/a&gt;.&nbsp;The&nbsp;reactor's&nbsp;own&nbsp;thread&nbsp;pool&nbsp;is&nbsp;really&nbsp;for&nbsp;DNS&nbsp;resolution.&nbsp;You&nbsp;risk&nbsp;deadlocks&nbsp;in&nbsp;a&nbsp;system&nbsp;that&nbsp;ThreadPoolThreadPoolThreadPool&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.&nbsp;The&nbsp;specifics&nbsp;of&nbsp;what&nbsp;long_computation&nbsp;are&nbsp;also&nbsp;important.&nbsp;If&nbsp;it&nbsp;doesn't&nbsp;release&nbsp;the&nbsp;GIL&nbsp;you&nbsp;won't&nbsp;get&nbsp;real&nbsp;parallelism&nbsp;(this&nbsp;is&nbsp;a&nbsp;Python&nbsp;thing,&nbsp;not&nbsp;a&nbsp;Twisted&nbsp;thing).&nbsp;See&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/pipermail/twisted-python/2019-June/032371.html&quot;&gt;this&nbsp;recent&nbsp;thread&nbsp;on&nbsp;the&nbsp;topic&lt;/a&gt;.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Though&nbsp;the&nbsp;mechanisms&nbsp;differ&nbsp;athis&nbsp;thread&nbsp;on&nbsp;the&nbsp;topicny&nbsp;of&nbsp;the&nbsp;above&nbsp;would&nbsp;cause&nbsp;the&nbsp;response&nbsp;time&nbsp;to&nbsp;increase&nbsp;as&nbsp;you&nbsp;add&nbsp;load.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Good&nbsp;luck,&lt;br&gt;&lt;/div&gt;&lt;div&gt;Tom&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;Tue,&nbsp;Jun&nbsp;25,&nbsp;2019,&nbsp;at&nbsp;11:51&nbsp;PM,&nbsp;Waqar&nbsp;Khan&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;id=&quot;qt&quot;&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sorry&nbsp;I&nbsp;had&nbsp;a&nbsp;typo&nbsp;in&nbsp;twisted&nbsp;program&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255);color:rgb(0,&nbsp;0,&nbsp;0);font-family:Menlo;font-size:9pt;&quot;&gt;&lt;b&gt;&lt;a&nbsp;class=&quot;qt-gmail_plusreply&quot;&nbsp;id=&quot;qt-gmail-m_696722601013816822plusReplyChip-3&quot;&gt;@defer.inlinecallbacks&lt;/a&gt;&lt;/b&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255);color:rgb(0,&nbsp;0,&nbsp;0);font-family:Menlo;font-size:9pt;&quot;&gt;&lt;b&gt;def&nbsp;&lt;/b&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;long_computation&lt;/b&gt;&lt;/span&gt;(&lt;span&nbsp;style=&quot;background-color:rgb(255,&nbsp;216,&nbsp;236)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;rec_type,&nbsp;data&lt;/span&gt;&lt;/span&gt;)&lt;b&gt;:&lt;br&gt;&lt;/b&gt;&lt;b&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/b&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;153,&nbsp;136)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;i&gt;#&nbsp;some&nbsp;long&nbsp;computation&lt;br&gt;&lt;/i&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;153,&nbsp;136)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;defer.returnValue(recs)&lt;/b&gt;&lt;/i&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;@defer.inlinecallbacks&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;fetch_data(user_id):&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(255,&nbsp;216,&nbsp;236)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;r&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;&nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;=&nbsp;yield&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;json.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;loads&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;(requests.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;get&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(247,&nbsp;231,&nbsp;241)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(221,&nbsp;17,&nbsp;68)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;'url/to/fetch/%s'&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;%&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;user_id&lt;/span&gt;&lt;/span&gt;&lt;/i&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;).text)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer.returnValue(r)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;@defer.inlinecallbacks&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;fetch_recs(user_id):&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;yield&nbsp;fetch_data(user_id)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recs&nbsp;=&nbsp;{}&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;stype&nbsp;in&nbsp;similar_types:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;d&nbsp;=&nbsp;defer.ToThread(&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;long_computation&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;,&nbsp;*(stype,&nbsp;data))&nbsp;//&nbsp;typo&nbsp;was&nbsp;here&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rec&nbsp;=&nbsp;yield&nbsp;d&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recs[stype]&nbsp;=&nbsp;rec&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer.returnValue(recs)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;qt-gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;qt-gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;Jun&nbsp;25,&nbsp;2019&nbsp;at&nbsp;11:48&nbsp;PM&nbsp;Waqar&nbsp;Khan&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:wk80333@gmail.com&quot;&gt;wk80333@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;qt-gmail_quote&quot;&nbsp;style=&quot;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0.8ex;border-left-color:rgb(204,&nbsp;204,&nbsp;204);border-left-style:solid;border-left-width:1px;padding-left:1ex;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hello&nbsp;folks,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;I&nbsp;recently&nbsp;stumbled&nbsp;upon&nbsp;twisted&nbsp;and&nbsp;was&nbsp;wondering&nbsp;if&nbsp;it&nbsp;could&nbsp;suit&nbsp;my&nbsp;needs.&nbsp;On&nbsp;one&nbsp;hand,&nbsp;I&nbsp;want&nbsp;to&nbsp;use&nbsp;python&nbsp;but&nbsp;on&nbsp;another&nbsp;hand&nbsp;there&nbsp;are&nbsp;all&nbsp;these&nbsp;scalability&nbsp;concerns&nbsp;with&nbsp;this&nbsp;language&nbsp;so,&nbsp;I&nbsp;though&nbsp;I&nbsp;would&nbsp;pick&nbsp;the&nbsp;brains&nbsp;of&nbsp;the&nbsp;community.&nbsp;So..&nbsp;a&nbsp;flask&nbsp;based&nbsp;app&nbsp;would&nbsp;look&nbsp;something&nbsp;like&nbsp;this.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255);color:rgb(0,&nbsp;0,&nbsp;0);font-family:Menlo;font-size:9pt;&quot;&gt;&lt;div&gt;similar_types&nbsp;&lt;b&gt;=&nbsp;&lt;/b&gt;[&lt;span&nbsp;style=&quot;background-color:rgb(247,&nbsp;231,&nbsp;241)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(221,&nbsp;17,&nbsp;68)&quot;&nbsp;class=&quot;colour&quot;&gt;'foo'&lt;/span&gt;&lt;/span&gt;,&nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(247,&nbsp;231,&nbsp;241)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(221,&nbsp;17,&nbsp;68)&quot;&nbsp;class=&quot;colour&quot;&gt;'bar'&lt;/span&gt;&lt;/span&gt;,&nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(247,&nbsp;231,&nbsp;241)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(221,&nbsp;17,&nbsp;68)&quot;&nbsp;class=&quot;colour&quot;&gt;'baz'&lt;/span&gt;&lt;/span&gt;]&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;def&nbsp;&lt;/b&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;long_computation&lt;/b&gt;&lt;/span&gt;(&lt;span&nbsp;style=&quot;background-color:rgb(255,&nbsp;216,&nbsp;236)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;rec_type&lt;/span&gt;&lt;/span&gt;)&lt;b&gt;:&lt;br&gt;&lt;/b&gt;&lt;b&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/b&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;153,&nbsp;136)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;i&gt;#&nbsp;some&nbsp;long&nbsp;computation&lt;br&gt;&lt;/i&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;153,&nbsp;136)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;/span&gt;&lt;b&gt;return&nbsp;&lt;/b&gt;recs&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;@app.route&lt;/b&gt;&lt;/span&gt;(&lt;span&nbsp;style=&quot;background-color:rgb(247,&nbsp;231,&nbsp;241)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(221,&nbsp;17,&nbsp;68)&quot;&nbsp;class=&quot;colour&quot;&gt;'/fetch_similar_users/&lt;user_id&gt;'&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(221,&nbsp;17,&nbsp;68)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;b&gt;def&nbsp;&lt;/b&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;fetch_similar_users&lt;/b&gt;&lt;/span&gt;(&lt;i&gt;user_id&lt;/i&gt;)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(255,&nbsp;216,&nbsp;236)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;r&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;&nbsp;&lt;/span&gt;&lt;b&gt;=&nbsp;&lt;/b&gt;json.&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;loads&lt;/b&gt;&lt;/span&gt;(requests.&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;get&lt;/b&gt;&lt;/span&gt;(&lt;span&nbsp;style=&quot;background-color:rgb(247,&nbsp;231,&nbsp;241)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(221,&nbsp;17,&nbsp;68)&quot;&nbsp;class=&quot;colour&quot;&gt;'url/to/fetch/%s'&lt;/span&gt;&lt;/span&gt;&lt;b&gt;%&lt;/b&gt;&lt;i&gt;user_id&lt;/i&gt;).text)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recs&nbsp;&lt;b&gt;=&nbsp;&lt;/b&gt;{}&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;for&nbsp;&lt;/b&gt;stype&nbsp;&lt;b&gt;in&nbsp;&lt;/b&gt;similar_types&lt;b&gt;:&lt;br&gt;&lt;/b&gt;&lt;b&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/b&gt;recs[stype]&nbsp;&lt;b&gt;=&nbsp;&lt;/b&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;long_computation&lt;/b&gt;&lt;/span&gt;(rec_type)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;return&nbsp;&lt;/b&gt;recs&lt;br&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Now,&nbsp;I&nbsp;tried&nbsp;to&nbsp;&quot;twistify&quot;&nbsp;but&nbsp;it&nbsp;failed.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255);color:rgb(0,&nbsp;0,&nbsp;0);font-family:Menlo;font-size:9pt;&quot;&gt;&lt;b&gt;&lt;a&nbsp;class=&quot;qt-gmail_plusreply&quot;&nbsp;id=&quot;qt-gmail-m_696722601013816822plusReplyChip-3&quot;&gt;@defer.inlinecallbacks&lt;/a&gt;&lt;/b&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255);color:rgb(0,&nbsp;0,&nbsp;0);font-family:Menlo;font-size:9pt;&quot;&gt;&lt;b&gt;def&nbsp;&lt;/b&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;long_computation&lt;/b&gt;&lt;/span&gt;(&lt;span&nbsp;style=&quot;background-color:rgb(255,&nbsp;216,&nbsp;236)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;rec_type&lt;/span&gt;&lt;/span&gt;)&lt;b&gt;:&lt;br&gt;&lt;/b&gt;&lt;b&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/b&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;153,&nbsp;136)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;i&gt;#&nbsp;some&nbsp;long&nbsp;computation&lt;br&gt;&lt;/i&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;153,&nbsp;136)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;defer.returnValue(recs)&lt;/b&gt;&lt;/i&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;@defer.inlinecallbacks&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;fetch_data(user_id):&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(255,&nbsp;216,&nbsp;236)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;r&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(128,&nbsp;128,&nbsp;128)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;&nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;=&nbsp;yield&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;json.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;loads&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;(requests.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(153,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;get&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(247,&nbsp;231,&nbsp;241)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(221,&nbsp;17,&nbsp;68)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;'url/to/fetch/%s'&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;%&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;user_id&lt;/span&gt;&lt;/span&gt;&lt;/i&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(248,&nbsp;248,&nbsp;255)&quot;&nbsp;class=&quot;highlight&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,&nbsp;0,&nbsp;0)&quot;&nbsp;class=&quot;colour&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Menlo&quot;&nbsp;class=&quot;font&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&nbsp;class=&quot;size&quot;&gt;).text)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer.returnValue(r)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;@defer.inlinecallbacks&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;fetch_recs(user_id):&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;yield&nbsp;fetch_data(user_id)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recs&nbsp;=&nbsp;{}&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;stype&nbsp;in&nbsp;similar_types:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;defer.ToThread(fetch_data,&nbsp;*(stype))&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rec&nbsp;=&nbsp;yield&nbsp;d&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recs[stype]&nbsp;=&nbsp;rec&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer.returnValue(recs)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;wrapped&nbsp;all&nbsp;the&nbsp;above&nbsp;in&nbsp;twisted&nbsp;render_Get&nbsp;method..&nbsp;but&nbsp;then&nbsp;I&nbsp;did&nbsp;a&nbsp;load&nbsp;test&nbsp;with&nbsp;locust&nbsp;(&lt;a&nbsp;href=&quot;https://docs.locust.io/en/latest/what-is-locust.html&quot;&gt;https://docs.locust.io/en/latest/what-is-locust.html&lt;/a&gt;)&nbsp;framework.&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;choked.&nbsp;As&nbsp;the&nbsp;time&nbsp;progressed,&nbsp;the&nbsp;response&nbsp;time&nbsp;increased.&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;guessing,&nbsp;things&nbsp;are&nbsp;still&nbsp;blocking.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can&nbsp;you&nbsp;please&nbsp;help&nbsp;me&nbsp;look&nbsp;into&nbsp;the&nbsp;right&nbsp;place.&nbsp;Why&nbsp;exactly&nbsp;am&nbsp;I&nbsp;seeing&nbsp;increase&nbsp;in&nbsp;response&nbsp;time&nbsp;as&nbsp;the&nbsp;time&nbsp;progresses.&nbsp;I&nbsp;am&nbsp;guessing&nbsp;things&nbsp;are&nbsp;still&nbsp;working&nbsp;in&nbsp;&quot;blocking&quot;&nbsp;fashion&nbsp;but&nbsp;i&nbsp;thought&nbsp;the&nbsp;above&nbsp;should&nbsp;run&nbsp;things&nbsp;in&nbsp;async.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;_______________________________________________&lt;br&gt;&lt;/div&gt;&lt;div&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;&lt;/div&gt;&lt;div&gt;Twisted-Python@twistedmatrix.com&lt;br&gt;&lt;/div&gt;&lt;div&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
