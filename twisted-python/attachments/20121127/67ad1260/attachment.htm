<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=windows-1252&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&nbsp;&quot;&gt;I&nbsp;have&nbsp;a&nbsp;really&nbsp;bad&nbsp;time&nbsp;with&nbsp;the&nbsp;combination&nbsp;of&nbsp;a&nbsp;low-volume&nbsp;service&nbsp;&amp;nbsp;and&nbsp;adbapi.ConnectionPool,&nbsp;pyodbc,&nbsp;FreeTDS&nbsp;and&nbsp;Sybase.&lt;br&gt;<br>
&lt;br&gt;<br>
Basically&nbsp;my&nbsp;connections&nbsp;just&nbsp;time&nbsp;out&nbsp;and&nbsp;fail&nbsp;in&nbsp;weird,&nbsp;generic&nbsp;ways&nbsp;like:&lt;br&gt;<br>
&lt;br&gt;<br>
Error:&nbsp;('01000',&nbsp;'[01000]&nbsp;[FreeTDS][SQL&nbsp;Server]Unexpected&nbsp;EOF&nbsp;from&nbsp;the&nbsp;server&nbsp;(20017)&nbsp;(SQLEndTran)')&lt;br&gt;<br>
&lt;br&gt;<br>
(but&nbsp;in&nbsp;many&nbsp;others&nbsp;too,&nbsp;there&nbsp;is&nbsp;no&nbsp;real&nbsp;pattern)&lt;/blockquote&gt;&lt;div&gt;Have&nbsp;you&nbsp;tried&nbsp;enabling&nbsp;reconnects&nbsp;(cp_reconnect=True)?&nbsp;If&nbsp;&quot;select&nbsp;1&quot;&nbsp;doesn't&nbsp;work&nbsp;with&nbsp;your&nbsp;database&nbsp;you&nbsp;may&nbsp;also&nbsp;have&nbsp;to&nbsp;pass&nbsp;in&nbsp;custom&nbsp;cp_good_sql.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yep,&nbsp;and&nbsp;the&nbsp;connections&nbsp;*do*&nbsp;heal&nbsp;after&nbsp;dying.&nbsp;I&nbsp;don't&nbsp;have&nbsp;to&nbsp;restart&nbsp;twistd,&nbsp;it&nbsp;just&nbsp;takes&nbsp;a&nbsp;few&nbsp;failed&nbsp;requests&nbsp;to&nbsp;warm&nbsp;up&nbsp;again.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;tried&nbsp;to&nbsp;do&nbsp;a&nbsp;for&nbsp;loop&nbsp;like:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;succ&nbsp;=&nbsp;False&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;for&nbsp;_&nbsp;in&nbsp;range(self.dbpool.max&nbsp;+&nbsp;1):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;try:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;yield&nbsp;self.dbpool.runOperation(self.dbpool.good_sql)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;succ&nbsp;=&nbsp;True&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;except&nbsp;Exception:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;pass&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;not&nbsp;succ:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;raise&nbsp;pyodbc.Error(b'Found&nbsp;no&nbsp;healthy&nbsp;connection.')&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;…for&nbsp;new&nbsp;connections,&nbsp;but&nbsp;that&nbsp;helped&nbsp;only&nbsp;a&nbsp;bit.&nbsp;I&nbsp;presume&nbsp;once&nbsp;it&nbsp;finds&nbsp;a&nbsp;working&nbsp;connection,&nbsp;it&nbsp;keeps&nbsp;using&nbsp;it.&nbsp;But&nbsp;I&nbsp;still&nbsp;had&nbsp;failure&nbsp;within&nbsp;the&nbsp;session&nbsp;later.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&nbsp;&quot;&gt;<br>
In&nbsp;my&nbsp;desperation,&nbsp;I’m&nbsp;employing&nbsp;for-loops&nbsp;for&nbsp;the&nbsp;SQL&nbsp;queries&nbsp;now.&nbsp;:(&lt;br&gt;<br>
&lt;br&gt;<br>
Since&nbsp;there&nbsp;isn’t&nbsp;much&nbsp;traffic&nbsp;(yet)&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;just&nbsp;make&nbsp;ConnectionPool&nbsp;close&nbsp;the&nbsp;connections&nbsp;and&nbsp;re-open&nbsp;fresh&nbsp;ones,&nbsp;as&nbsp;soon&nbsp;as&nbsp;they&nbsp;are&nbsp;necessary.&lt;br&gt;<br>
&lt;br&gt;<br>
Is&nbsp;there&nbsp;some&nbsp;straight-forward&nbsp;way&nbsp;to&nbsp;do&nbsp;that?&nbsp;Or&nbsp;any&nbsp;better&nbsp;approach&nbsp;I’ve&nbsp;overlooked?&lt;/blockquote&gt;&lt;div&gt;Don't&nbsp;use&nbsp;ConnectionPool&nbsp;at&nbsp;all.&nbsp;Just&nbsp;have&nbsp;a&nbsp;function&nbsp;that&nbsp;does&nbsp;the&nbsp;SQL&nbsp;connect&nbsp;etc&nbsp;usually&nbsp;normal&nbsp;DB-API,&nbsp;and&nbsp;call&nbsp;it&nbsp;with&nbsp;twisted.internet.threads.deferToThread:&lt;br&gt;<br>
&lt;br&gt;&lt;div&nbsp;style=&quot;margin-left:40px&quot;&gt;&amp;nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,monospace&quot;&gt;def&nbsp;dbTxn(x):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;conn&nbsp;=&nbsp;db.connect(...)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cursor&nbsp;=&nbsp;conn.cursor()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cursor.execute()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;result&nbsp;=&nbsp;cursor.fetchall()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;conn.close()&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;result&lt;br&gt;&lt;br&gt;deferredResult&nbsp;=&nbsp;deferToThread(dbtxn,&nbsp;argForX)&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sounds&nbsp;like&nbsp;a&nbsp;solid&nbsp;backup&nbsp;plan,&nbsp;thanks!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;only&nbsp;reason&nbsp;I’d&nbsp;prefer&nbsp;to&nbsp;stay&nbsp;with&nbsp;pooling&nbsp;is&nbsp;that&nbsp;I&nbsp;very&nbsp;much&nbsp;expect&nbsp;the&nbsp;traffic&nbsp;to&nbsp;rise&nbsp;and&nbsp;wouldn’t&nbsp;really&nbsp;want&nbsp;to&nbsp;change&nbsp;away&nbsp;and&nbsp;go&nbsp;back&nbsp;later.&nbsp;:(&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Hynek&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
