<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Tue,&nbsp;Jul&nbsp;26,&nbsp;2016&nbsp;at&nbsp;8:47&nbsp;AM,&nbsp;Matěj&nbsp;Cepl&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:mcepl@cepl.eu&quot;&nbsp;target=&quot;_blank&quot;&gt;mcepl@cepl.eu&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;&lt;/span&gt;<br>
I&nbsp;believe&nbsp;I&nbsp;have&nbsp;fixed&nbsp;all&nbsp;I&nbsp;can&nbsp;do&nbsp;without&nbsp;actually&nbsp;understanding&nbsp;Twisted&nbsp;in&nbsp;&lt;a&nbsp;href=&quot;https://gitlab.com/mcepl/m2crypto/commit/6cd5f87b31e50016ebb7e44f3f2ae46610bc24e0&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://gitlab.com/mcepl/m2crypto/commit/6cd5f87b31e50016ebb7e44f3f2ae46610bc24e0&lt;/a&gt;. &nbsp;So&nbsp;now,&nbsp;if&nbsp;Twisted&nbsp;is&nbsp;so&nbsp;transparent&nbsp;and&nbsp;perfectly&nbsp;understandable,&nbsp;could&nbsp;you&nbsp;please&nbsp;suggest,&nbsp;what&nbsp;I&nbsp;do&nbsp;wrong,&nbsp;that&nbsp;the&nbsp;test&nbsp;ends&nbsp;in&nbsp;the&nbsp;endless&nbsp;loop&nbsp;(&lt;a&nbsp;href=&quot;https://travis-ci.org/mcepl/M2Crypto/builds/147175901&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://travis-ci.org/mcepl/M2Crypto/builds/147175901&lt;/a&gt;)?&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;your&nbsp;initial&nbsp;e-mail,&nbsp;it&nbsp;would&nbsp;have&nbsp;been&nbsp;useful&nbsp;if&nbsp;you&nbsp;could&nbsp;have&nbsp;provided&nbsp;reproduction&nbsp;steps&lt;br&gt;&lt;/div&gt;&lt;div&gt;for&nbsp;your&nbsp;problem.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can&nbsp;you&nbsp;provide&nbsp;reproduction&nbsp;steps?&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Since&nbsp;I&nbsp;wasn&#39;t&nbsp;sure,&nbsp;I&nbsp;took&nbsp;a&nbsp;guess.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;did&nbsp;the&nbsp;following&nbsp;inside&nbsp;a&nbsp;Python&nbsp;3.6&nbsp;virtual&nbsp;environment&nbsp;under&nbsp;OS&nbsp;X:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;git&nbsp;clone&nbsp;&lt;a&nbsp;href=&quot;https://gitlab.com/mcepl/m2crypto.git&quot;&gt;https://gitlab.com/mcepl/m2crypto.git&lt;/a&gt;&nbsp;m2crypto_test&lt;br&gt;&lt;/div&gt;&lt;div&gt;cd&nbsp;m2crypto_test&lt;br&gt;&lt;/div&gt;&lt;div&gt;git&nbsp;checkout&nbsp;python3&lt;br&gt;&lt;/div&gt;&lt;div&gt;python&nbsp;setup.py&nbsp;build&nbsp;--openssl=/usr/local/opt/openssl&lt;br&gt;&lt;/div&gt;&lt;div&gt;python&nbsp;setup.py&nbsp;bdist&lt;br&gt;&lt;/div&gt;&lt;div&gt;python&nbsp;setup.py&nbsp;develop&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;py.test&nbsp;-v&nbsp;-s&nbsp;-k&nbsp;test_twisted_wrapper&nbsp;tests/test_ssl.py&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;was&nbsp;able&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;problem&nbsp;with&nbsp;something&nbsp;looping&nbsp;around:&lt;br&gt;&lt;br&gt;DEBUG:_encrypt:self.data&nbsp;=&nbsp;&quot;b&#39;GET&nbsp;/&nbsp;HTTP/1.0\n\n\r\n&#39;&quot;&lt;br&gt;DEBUG:_decrypt:self.encrypted&nbsp;=&nbsp;&quot;b&#39;&#39;&quot;&lt;br&gt;DEBUG:_encrypt:self.data&nbsp;=&nbsp;&quot;b&#39;GET&nbsp;/&nbsp;HTTP/1.0\n\n\r\n&#39;&quot;&lt;br&gt;DEBUG:_decrypt:self.encrypted&nbsp;=&nbsp;&quot;b&#39;&#39;&quot;&lt;br&gt;DEBUG:_encrypt:self.data&nbsp;=&nbsp;&quot;b&#39;GET&nbsp;/&nbsp;HTTP/1.0\n\n\r\n&#39;&quot;&lt;br&gt;DEBUG:_decrypt:self.encrypted&nbsp;=&nbsp;&quot;b&#39;&#39;&quot;&lt;br&gt;DEBUG:_encrypt:self.data&nbsp;=&nbsp;&quot;b&#39;GET&nbsp;/&nbsp;HTTP/1.0\n\n\r\n&#39;&quot;&lt;br&gt;DEBUG:_decrypt:self.encrypted&nbsp;=&nbsp;&quot;b&#39;&#39;&quot;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;took&nbsp;a&nbsp;look&nbsp;in&nbsp;the&nbsp;M2Crypto&nbsp;code&nbsp;which&nbsp;interfaces&nbsp;with&lt;br&gt;&lt;/div&gt;&lt;div&gt;Twisted,&nbsp;and&nbsp;found&nbsp;that&nbsp;the&nbsp;dataReceived()&nbsp;loop&nbsp;was&nbsp;never&nbsp;terminating&lt;br&gt;&lt;/div&gt;&lt;div&gt;because&nbsp;dataReceived()&nbsp;takes&nbsp;bytes,&nbsp;but&nbsp;the&nbsp;code&nbsp;was&lt;br&gt;&lt;/div&gt;&lt;div&gt;comparing&nbsp;to&nbsp;an&nbsp;emptry&nbsp;str. &nbsp;So,&nbsp;the&nbsp;loop&nbsp;was&nbsp;never&nbsp;terminating.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;fixed&nbsp;this&nbsp;and&nbsp;other&nbsp;problems,&nbsp;and&nbsp;now&nbsp;the&nbsp;test_twisted_wrapper&lt;br&gt;&lt;/div&gt;&lt;div&gt;passes&nbsp;on&nbsp;Python&nbsp;3. &nbsp;I&nbsp;submitted&nbsp;this&nbsp;merge&nbsp;request:&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://gitlab.com/mcepl/m2crypto/merge_requests/3/commits&quot;&gt;https://gitlab.com/mcepl/m2crypto/merge_requests/3/commits&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;While&nbsp;I&nbsp;was&nbsp;looking&nbsp;at&nbsp;the&nbsp;code,&nbsp;I&nbsp;also&nbsp;saw&nbsp;that&nbsp;the&nbsp;make_certs.py&lt;br&gt;&lt;/div&gt;&lt;div&gt;utility&nbsp;does&nbsp;not&nbsp;work&nbsp;on&nbsp;Python&nbsp;3.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;fixed&nbsp;that,&nbsp;and&nbsp;submitted&nbsp;this&nbsp;merge&nbsp;request:&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://gitlab.com/mcepl/m2crypto/merge_requests/4/commits&quot;&gt;https://gitlab.com/mcepl/m2crypto/merge_requests/4/commits&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&lt;br&gt;&lt;/div&gt;&lt;div&gt;Craig&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
