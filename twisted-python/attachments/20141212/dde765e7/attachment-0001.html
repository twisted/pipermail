<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Jul&nbsp;10,&nbsp;2014,&nbsp;at&nbsp;21:32,&nbsp;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&nbsp;class=&quot;&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&nbsp;wrote:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Tubes&nbsp;have&nbsp;been&nbsp;largely&nbsp;Glyph's&nbsp;effort&nbsp;(though&nbsp;a&nbsp;lot&nbsp;of&nbsp;people&nbsp;have&nbsp;contributed&nbsp;in&nbsp;one&nbsp;way&nbsp;or&nbsp;another).&nbsp;&nbsp;And&nbsp;a&nbsp;large&nbsp;effort&nbsp;it's&nbsp;been.&nbsp;Development&nbsp;is&nbsp;proceeding&nbsp;in&nbsp;a&nbsp;Twisted&nbsp;branch&nbsp;and&nbsp;comes&nbsp;to&nbsp;over&nbsp;three&nbsp;thousand&nbsp;lines&nbsp;of&nbsp;additions&nbsp;so&nbsp;far.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Given&nbsp;the&nbsp;large&nbsp;size&nbsp;of&nbsp;the&nbsp;implementation&nbsp;and&nbsp;the&nbsp;long&nbsp;time&nbsp;that&nbsp;this&nbsp;effort&nbsp;has&nbsp;been&nbsp;underway&nbsp;(I&nbsp;remember&nbsp;the&nbsp;Twisted&nbsp;meetup&nbsp;at&nbsp;the&nbsp;Rackspace&nbsp;offices&nbsp;that&nbsp;*I*&nbsp;attended&nbsp;when&nbsp;I&nbsp;was&nbsp;visiting&nbsp;SF...&nbsp;a&nbsp;year&nbsp;and&nbsp;a&nbsp;half&nbsp;ago...&nbsp;at&nbsp;which&nbsp;point&nbsp;tubes&nbsp;wasn't&nbsp;exactly&nbsp;a&nbsp;brand&nbsp;new&nbsp;project)&nbsp;I'd&nbsp;like&nbsp;to&nbsp;re-raise&nbsp;the&nbsp;idea&nbsp;that&nbsp;the&nbsp;best&nbsp;next&nbsp;step&nbsp;for&nbsp;the&nbsp;project&nbsp;is&nbsp;to&nbsp;see&nbsp;some&nbsp;distribution&nbsp;in&nbsp;its&nbsp;*current*&nbsp;state.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;Jean-Paul&nbsp;originally&nbsp;wrote&nbsp;this&nbsp;message,&nbsp;I&nbsp;strongly&nbsp;disagreed.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;the&nbsp;intervening&nbsp;six&nbsp;months,&nbsp;I've&nbsp;been&nbsp;working&nbsp;on&nbsp;Tubes&nbsp;on&nbsp;and&nbsp;off.&nbsp;&nbsp;In&nbsp;the&nbsp;last&nbsp;couple&nbsp;of&nbsp;weeks,&nbsp;I've&nbsp;had&nbsp;a&nbsp;bit&nbsp;of&nbsp;time&nbsp;to&nbsp;make&nbsp;a&nbsp;concerted&nbsp;effort&nbsp;to&nbsp;improve&nbsp;the&nbsp;branch,&nbsp;and&nbsp;it&nbsp;is&nbsp;starting&nbsp;to&nbsp;approach&nbsp;something&nbsp;like&nbsp;a&nbsp;finished&nbsp;state:&nbsp;there&nbsp;is&nbsp;still&nbsp;a&nbsp;lot&nbsp;of&nbsp;polish&nbsp;necessary,&nbsp;but&nbsp;as&nbsp;I've&nbsp;tested&nbsp;them&nbsp;against&nbsp;more&nbsp;and&nbsp;more&nbsp;use-cases,&nbsp;the&nbsp;core&nbsp;abstractions&nbsp;seem&nbsp;to&nbsp;be&nbsp;holding&nbsp;up&nbsp;rather&nbsp;well,&nbsp;and&nbsp;several&nbsp;rounds&nbsp;of&nbsp;increasingly&nbsp;elaborate&nbsp;use-cases&nbsp;did&nbsp;not&nbsp;result&nbsp;in&nbsp;any&nbsp;big&nbsp;rewrites&nbsp;or&nbsp;mystifying&nbsp;un-debuggable&nbsp;re-entrancy&nbsp;scenarios&nbsp;in&nbsp;the&nbsp;implementation.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;One&nbsp;change&nbsp;Thomas&nbsp;Herv√©&nbsp;assisted&nbsp;me&nbsp;in&nbsp;making&nbsp;today&nbsp;was&nbsp;to&nbsp;remove&nbsp;Deferred&nbsp;support&nbsp;from&nbsp;the&nbsp;core&nbsp;of&nbsp;&quot;tube&quot;&nbsp;itself,&nbsp;and&nbsp;instead&nbsp;factor&nbsp;it&nbsp;out&nbsp;into&nbsp;a&nbsp;separate&nbsp;module.&nbsp;&nbsp;Interested&nbsp;readers&nbsp;may&nbsp;find&nbsp;that&nbsp;module&nbsp;here:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;&lt;a&nbsp;href=&quot;https://github.com/twisted/twisted/blob/tubes-1956-8/twisted/tubes/undefer.py&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/twisted/twisted/blob/tubes-1956-8/twisted/tubes/undefer.py&lt;/a&gt;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;It's&nbsp;not&nbsp;finished&nbsp;(mostly&nbsp;it&nbsp;needs&nbsp;testing&nbsp;for&nbsp;errbacks&nbsp;and&nbsp;the&nbsp;addition&nbsp;of&nbsp;yielding&nbsp;non-Deferred&nbsp;values).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;change&nbsp;radically&nbsp;simplifies&nbsp;the&nbsp;conceptual&nbsp;model&nbsp;around&nbsp;consuming&nbsp;asynchronous&nbsp;results&nbsp;within&nbsp;the&nbsp;implementation.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;deal&nbsp;with&nbsp;results&nbsp;instead&nbsp;of&nbsp;Deferreds,&nbsp;you&nbsp;just&nbsp;create&nbsp;this&nbsp;tube&nbsp;that&nbsp;turns&nbsp;Deferreds&nbsp;into&nbsp;their&nbsp;results&nbsp;-&nbsp;the&nbsp;only&nbsp;special-casing&nbsp;inside&nbsp;tube&nbsp;itself&nbsp;is&nbsp;a&nbsp;special&nbsp;value&nbsp;that&nbsp;says&nbsp;&quot;when&nbsp;you&nbsp;yield&nbsp;this,&nbsp;don't&nbsp;actually&nbsp;emit&nbsp;an&nbsp;output&nbsp;to&nbsp;the&nbsp;next&nbsp;drain&nbsp;in&nbsp;the&nbsp;series&quot;.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Another&nbsp;thing&nbsp;that&nbsp;this&nbsp;change&nbsp;does&nbsp;is&nbsp;illustrate&nbsp;the&nbsp;fact&nbsp;that&nbsp;literally&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;nothing&lt;/i&gt;&nbsp;in&nbsp;the&nbsp;core&nbsp;part&nbsp;of&nbsp;Tubes&nbsp;has&nbsp;come&nbsp;to&nbsp;depend&nbsp;on&nbsp;Twisted&nbsp;-&nbsp;and&nbsp;indeed,&nbsp;as&nbsp;the&nbsp;factoring&nbsp;has&nbsp;improved&nbsp;over&nbsp;time,&nbsp;the&nbsp;coupling&nbsp;between&nbsp;Twisted&nbsp;and&nbsp;the&nbsp;core&nbsp;Tubes&nbsp;abstraction&nbsp;has&nbsp;become&nbsp;looser&nbsp;and&nbsp;looser.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;very&nbsp;good&nbsp;thing&nbsp;architecturally.&nbsp;&nbsp;Examining&nbsp;the&nbsp;few&nbsp;remaining&nbsp;points&nbsp;of&nbsp;coupling,&nbsp;there&nbsp;are&nbsp;pretty&nbsp;much&nbsp;only&nbsp;two:&nbsp;twisted's&nbsp;logging&nbsp;serves&nbsp;as&nbsp;the&nbsp;global&nbsp;error-handler&nbsp;hook&nbsp;(which&nbsp;can&nbsp;be&nbsp;easily&nbsp;changed&nbsp;to&nbsp;a&nbsp;simple&nbsp;bootstrapping&nbsp;API)&nbsp;and&nbsp;the&nbsp;use&nbsp;of&nbsp;Failure&nbsp;as&nbsp;the&nbsp;&quot;reason&quot;&nbsp;parameter&nbsp;to&nbsp;the&nbsp;.flowStopped&nbsp;and&nbsp;.stopped&nbsp;methods.&nbsp;&nbsp;This&nbsp;was&nbsp;copied&nbsp;from&nbsp;IProtocol,&nbsp;of&nbsp;course,&nbsp;but&nbsp;I&nbsp;think&nbsp;that&nbsp;upon&nbsp;reflection&nbsp;it&nbsp;is&nbsp;a&nbsp;bad&nbsp;idea.&nbsp;&nbsp;Failure,&nbsp;even&nbsp;at&nbsp;its&nbsp;best,&nbsp;is&nbsp;simply&nbsp;an&nbsp;abstraction&nbsp;over&nbsp;exception-as-raised.&nbsp;&nbsp;For&nbsp;Deferreds,&nbsp;this&nbsp;makes&nbsp;sense;&nbsp;asynchronous&nbsp;errors&nbsp;are&nbsp;similar&nbsp;to,&nbsp;and&nbsp;may&nbsp;be&nbsp;directly&nbsp;caused&nbsp;by,&nbsp;code&nbsp;raising&nbsp;an&nbsp;unexpected&nbsp;exception.&nbsp;&nbsp;However,&nbsp;although&nbsp;Tubes&nbsp;are&nbsp;analogous,&nbsp;a&nbsp;raised&nbsp;exception&nbsp;is&nbsp;an&nbsp;anomalous&nbsp;way&nbsp;for&nbsp;a&nbsp;flow&nbsp;to&nbsp;terminate,&nbsp;and&nbsp;I&nbsp;think&nbsp;the&nbsp;right&nbsp;thing&nbsp;to&nbsp;do&nbsp;there&nbsp;is&nbsp;actually&nbsp;to&nbsp;unconditionally&nbsp;log&nbsp;the&nbsp;exception,&nbsp;passing&nbsp;only&nbsp;a&nbsp;token&nbsp;value&nbsp;saying&nbsp;&quot;application&nbsp;error&quot;&nbsp;into&nbsp;the&nbsp;flowStopped&nbsp;method&nbsp;itself;&nbsp;the&nbsp;main&nbsp;use-case&nbsp;for&nbsp;the&nbsp;&quot;reason&quot;&nbsp;parameter&nbsp;is&nbsp;to&nbsp;distinguish&nbsp;between&nbsp;subtly&nbsp;different&nbsp;protocol&nbsp;conditions&nbsp;which&nbsp;may&nbsp;cause&nbsp;a&nbsp;connection&nbsp;termination;&nbsp;it's&nbsp;not&nbsp;an&nbsp;appropriate&nbsp;place&nbsp;to&nbsp;start&nbsp;handling&nbsp;unexpected&nbsp;exceptions.&nbsp;&nbsp;(When&nbsp;I&nbsp;have&nbsp;written&nbsp;code&nbsp;that&nbsp;does&nbsp;this&nbsp;using&nbsp;Twisted&nbsp;the&nbsp;inevitable&nbsp;result&nbsp;is&nbsp;an&nbsp;exception&nbsp;whose&nbsp;traceback&nbsp;disappears&nbsp;mysteriously&nbsp;and&nbsp;makes&nbsp;debugging&nbsp;a&nbsp;pain.)&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;sum&nbsp;up,&nbsp;the&nbsp;more&nbsp;this&nbsp;abstraction&nbsp;decouples&nbsp;from&nbsp;other&nbsp;things&nbsp;within&nbsp;Twisted,&nbsp;the&nbsp;more&nbsp;it&nbsp;becomes&nbsp;depended&nbsp;upon&nbsp;rather&nbsp;than&nbsp;itself&nbsp;doing&nbsp;the&nbsp;depending,&nbsp;the&nbsp;cleaner,&nbsp;simpler,&nbsp;and&nbsp;easier&nbsp;to&nbsp;use&nbsp;it&nbsp;gets.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;now&nbsp;I&nbsp;think&nbsp;I&nbsp;was&nbsp;wrong.&nbsp;&nbsp;I&nbsp;now&nbsp;agree&nbsp;with&nbsp;Jean-Paul,&nbsp;and&nbsp;in&nbsp;fact&nbsp;the&nbsp;pendulum&nbsp;of&nbsp;my&nbsp;opinion&nbsp;has&nbsp;swung&nbsp;a&nbsp;bit&nbsp;farther&nbsp;in&nbsp;the&nbsp;other&nbsp;direction.&nbsp;&nbsp;Not&nbsp;only&nbsp;should&nbsp;Tubes&nbsp;be&nbsp;released&nbsp;independently,&nbsp;I&nbsp;think&nbsp;they&nbsp;are&nbsp;a&nbsp;lower-level&nbsp;library&nbsp;that&nbsp;Twisted&nbsp;should&nbsp;eventually&nbsp;depend&nbsp;on.&nbsp;&nbsp;This&nbsp;library&nbsp;could&nbsp;just&nbsp;as&nbsp;easily&nbsp;have&nbsp;adapters&nbsp;for&nbsp;other&nbsp;loops,&nbsp;like&nbsp;tornado&nbsp;and&nbsp;asyncio,&nbsp;as&nbsp;well&nbsp;as&nbsp;providing&nbsp;potentially&nbsp;interesting&nbsp;support&nbsp;for&nbsp;doing&nbsp;things&nbsp;like&nbsp;eventually&nbsp;replacing&nbsp;Deferreds&nbsp;-&nbsp;see&nbsp;for&nbsp;example&nbsp;&lt;&lt;a&nbsp;href=&quot;https://pypi.python.org/pypi/effect&quot;&nbsp;class=&quot;&quot;&gt;https://pypi.python.org/pypi/effect&lt;/a&gt;&gt;.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;rather&nbsp;than&nbsp;have&nbsp;a&nbsp;single&nbsp;&quot;tubes&quot;&nbsp;package,&nbsp;I&nbsp;think&nbsp;I&nbsp;will&nbsp;break&nbsp;the&nbsp;branch&nbsp;into&nbsp;two&nbsp;pieces:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;&quot;tubes&quot;&nbsp;package&nbsp;itself,&nbsp;which&nbsp;will&nbsp;have&nbsp;no&nbsp;external&nbsp;dependencies&nbsp;and&nbsp;will&nbsp;pretty&nbsp;much&nbsp;just&nbsp;be&nbsp;buffer-management,&nbsp;fan-in,&nbsp;fan-out,&nbsp;buffering,&nbsp;throttling,&nbsp;filtering,&nbsp;routing,&nbsp;and&nbsp;framing-protocol&nbsp;code,&nbsp;intended&nbsp;to&nbsp;remain&nbsp;separate&nbsp;for&nbsp;the&nbsp;long&nbsp;term.&nbsp;&nbsp;This&nbsp;will&nbsp;probably&nbsp;mean&nbsp;some&nbsp;small&nbsp;amount&nbsp;of&nbsp;code&nbsp;duplication&nbsp;between&nbsp;LineReceiver&nbsp;et.&nbsp;al.&nbsp;and&nbsp;tubes.framing,&nbsp;but&nbsp;that&nbsp;seems&nbsp;fine&nbsp;to&nbsp;me.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;&quot;twisted+tubes&quot;&nbsp;package,&nbsp;perhaps&nbsp;named&nbsp;&quot;helical&quot;&nbsp;(since&nbsp;that&nbsp;is&nbsp;(A)&nbsp;an&nbsp;adjective&nbsp;that&nbsp;describes&nbsp;something&nbsp;which&nbsp;is&nbsp;(B)&nbsp;twisted&nbsp;and&nbsp;(C)&nbsp;also&nbsp;a&nbsp;tube),&nbsp;that&nbsp;depends&nbsp;on&nbsp;tubes&nbsp;and&nbsp;twisted,&nbsp;includes&nbsp;the&nbsp;integration&nbsp;points&nbsp;for&nbsp;endpoint,&nbsp;deferreds,&nbsp;and&nbsp;protocol,&nbsp;and&nbsp;which&nbsp;may&nbsp;be&nbsp;suitable&nbsp;for&nbsp;merging&nbsp;into&nbsp;Twisted&nbsp;later.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;traveling&nbsp;at&nbsp;the&nbsp;moment&nbsp;and&nbsp;might&nbsp;not&nbsp;have&nbsp;much&nbsp;time&nbsp;to&nbsp;work&nbsp;on&nbsp;this&nbsp;in&nbsp;the&nbsp;coming&nbsp;week,&nbsp;so&nbsp;if&nbsp;anyone&nbsp;wants&nbsp;to&nbsp;comment&nbsp;on&nbsp;these&nbsp;plans&nbsp;you&nbsp;have&nbsp;plenty&nbsp;of&nbsp;time&nbsp;:-).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
