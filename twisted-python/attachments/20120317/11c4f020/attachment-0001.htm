<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Mar&nbsp;13,&nbsp;2012,&nbsp;at&nbsp;10:44&nbsp;PM,&nbsp;Itamar&nbsp;Turner-Trauring&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;&gt;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&lt;div&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;twisted.internet.test.reactormixins&nbsp;says:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&gt;CFReactor&nbsp;uses&nbsp;APIs&nbsp;which&nbsp;manipulate&nbsp;global&nbsp;state,&nbsp;so<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it's&nbsp;not&nbsp;safe&nbsp;to&nbsp;run&nbsp;its&nbsp;own&nbsp;reactor-builder&nbsp;tests&nbsp;under&nbsp;itself.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;also&nbsp;don't&nbsp;have&nbsp;a&nbsp;buildslave&nbsp;running&nbsp;under&nbsp;cfreactor.&nbsp;Which&nbsp;means<br>
&nbsp;&nbsp;&nbsp;&nbsp;it's&nbsp;currently&nbsp;completely&nbsp;untested.&nbsp;I&nbsp;filed&nbsp;a&nbsp;ticket&nbsp;to&nbsp;fix&nbsp;that&nbsp;-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://bugs.launchpad.net/twisted-buildbot-configuration/+bug/954680&quot;&gt;https://bugs.launchpad.net/twisted-buildbot-configuration/+bug/954680&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Not&nbsp;&lt;i&gt;completely&lt;/i&gt;&amp;nbsp;untested.&nbsp;If&nbsp;you&nbsp;search&nbsp;a&nbsp;recent&nbsp;OS&nbsp;X&nbsp;build&nbsp;log,&nbsp;for&nbsp;example&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;http://buildbot.twistedmatrix.com/builders/osx10.6-py2.6-select/builds/1952/steps/select/logs/stdio&quot;&gt;http://buildbot.twistedmatrix.com/builders/osx10.6-py2.6-select/builds/1952/steps/select/logs/stdio&lt;/a&gt;&amp;gt;,&nbsp;you&nbsp;will&nbsp;see&nbsp;lots&nbsp;of&nbsp;&quot;_CFReactor&quot;&nbsp;tests&nbsp;that&nbsp;pass.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ironically&nbsp;a&nbsp;builder&nbsp;run&nbsp;under&nbsp;CFReactor&nbsp;itself&nbsp;will&nbsp;test&nbsp;&lt;i&gt;less&lt;/i&gt;&amp;nbsp;code&nbsp;related&nbsp;to&nbsp;the&nbsp;CFReactor,&nbsp;because&nbsp;it&nbsp;will&nbsp;only&nbsp;run&nbsp;the&nbsp;haphazard&nbsp;tests&nbsp;that&nbsp;test&nbsp;the&nbsp;global&nbsp;reactor&nbsp;by&nbsp;returning&nbsp;Deferreds&nbsp;rather&nbsp;than&nbsp;running&nbsp;the&nbsp;reactor.&nbsp;&amp;nbsp;But&nbsp;it&nbsp;does&nbsp;test&nbsp;different&nbsp;stuff,&nbsp;so&nbsp;there's&nbsp;value&nbsp;in&nbsp;having&nbsp;it&nbsp;run&nbsp;both&nbsp;ways.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;That&nbsp;still&nbsp;leaves&nbsp;the&nbsp;problem&nbsp;with&nbsp;global&nbsp;state&nbsp;though.&nbsp;Since&nbsp;we<br>
&nbsp;&nbsp;&nbsp;&nbsp;want&nbsp;to&nbsp;move&nbsp;towards&nbsp;having&nbsp;tests&nbsp;create&nbsp;new&nbsp;reactors,&nbsp;that's<br>
&nbsp;&nbsp;&nbsp;&nbsp;problematic.&nbsp;What&nbsp;global&nbsp;state&nbsp;does&nbsp;it&nbsp;manipulate,&nbsp;and&nbsp;what&nbsp;can&nbsp;we<br>
&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;about&nbsp;it?&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;manipulates&nbsp;the&nbsp;CoreFoundation&nbsp;run&nbsp;loop&nbsp;for&nbsp;its&nbsp;thread.&nbsp;&amp;nbsp;Ironically,&nbsp;the&nbsp;reason&nbsp;that&nbsp;this&nbsp;is&nbsp;the&nbsp;case&nbsp;is&nbsp;that&nbsp;CF's&nbsp;API,&nbsp;much&nbsp;like&nbsp;Twisted&nbsp;itself,&nbsp;is&nbsp;not&nbsp;reentrant.&nbsp;&amp;nbsp;If&nbsp;you're&nbsp;interested,&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;http://developer.apple.com/library/mac/#documentation/CoreFoundation/Reference/CFRunLoopRef/Reference/reference.html&quot;&gt;http://developer.apple.com/library/mac/#documentation/CoreFoundation/Reference/CFRunLoopRef/Reference/reference.html&lt;/a&gt;&amp;gt;&nbsp;is&nbsp;a&nbsp;pretty&nbsp;comprehensive&nbsp;reference.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;can't&nbsp;really&nbsp;do&nbsp;anything&nbsp;about&nbsp;it&nbsp;unless&nbsp;we&nbsp;can&nbsp;make&nbsp;Twisted&nbsp;start&nbsp;a&nbsp;new&nbsp;thread&nbsp;for&nbsp;each&nbsp;reactorbuilder&nbsp;test&nbsp;and&nbsp;then&nbsp;destroy&nbsp;the&nbsp;thread&nbsp;at&nbsp;the&nbsp;end.&nbsp;&amp;nbsp;Or,&nbsp;unless&nbsp;we&nbsp;mock&nbsp;the&nbsp;whole&nbsp;CF&nbsp;API&nbsp;-&nbsp;which,&nbsp;honestly,&nbsp;isn't&nbsp;that&nbsp;hard,&nbsp;there&nbsp;aren't&nbsp;a&nbsp;ton&nbsp;of&nbsp;functions&nbsp;and&nbsp;they&nbsp;do&nbsp;pretty&nbsp;straightforward&nbsp;stuff.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
