<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;div&gt;You&nbsp;might&nbsp;want&nbsp;to&nbsp;just&nbsp;try&nbsp;using&nbsp;SQLAlchemy&nbsp;via&nbsp;&lt;&lt;a&nbsp;href=&quot;https://pypi.python.org/pypi/alchimia&quot;&gt;https://pypi.python.org/pypi/alchimia&lt;/a&gt;&gt;&nbsp;if&nbsp;you&nbsp;don't&nbsp;want&nbsp;to&nbsp;do&nbsp;your&nbsp;own&nbsp;thread-pool&nbsp;management&nbsp;as&nbsp;buildbot&nbsp;appears&nbsp;to&nbsp;be.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Jun&nbsp;10,&nbsp;2014,&nbsp;at&nbsp;6:02&nbsp;PM,&nbsp;Dustin&nbsp;J.&nbsp;Mitchell&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dustin@v.igoro.us&quot;&gt;dustin@v.igoro.us&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;SQLAlchemy&nbsp;makes&nbsp;this&nbsp;kind&nbsp;of&nbsp;pessimistic&nbsp;reconnection&nbsp;pretty&nbsp;easy;&nbsp;we&lt;br&gt;do&nbsp;it&nbsp;for&nbsp;MySQL&nbsp;in&lt;br&gt;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://github.com/buildbot/buildbot/blob/master/master/buildbot/db/enginestrategy.py&quot;&gt;https://github.com/buildbot/buildbot/blob/master/master/buildbot/db/enginestrategy.py&lt;/a&gt;&lt;br&gt;I'm&nbsp;not&nbsp;sure&nbsp;why&nbsp;we&nbsp;don't&nbsp;do&nbsp;it&nbsp;for&nbsp;Postgres,&nbsp;but&nbsp;we've&nbsp;never&nbsp;heard&nbsp;a&lt;br&gt;complaint&nbsp;from&nbsp;a&nbsp;postgres&nbsp;user,&nbsp;so&nbsp;perhaps&nbsp;other&nbsp;layers&nbsp;are&nbsp;handling&lt;br&gt;it.&lt;br&gt;&lt;br&gt;In&nbsp;general,&nbsp;I&nbsp;consider&nbsp;this&nbsp;a&nbsp;requirement&nbsp;for&nbsp;a&nbsp;production-ready&lt;br&gt;database&nbsp;layer,&nbsp;along&nbsp;with&nbsp;correctly&nbsp;setting&nbsp;SO_KEEPALIVE.&lt;br&gt;&lt;br&gt;Dustin&lt;br&gt;&lt;br&gt;On&nbsp;Tue,&nbsp;Jun&nbsp;10,&nbsp;2014&nbsp;at&nbsp;3:02&nbsp;PM,&nbsp;Phil&nbsp;Mayers&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:p.mayers@imperial.ac.uk&quot;&gt;p.mayers@imperial.ac.uk&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;10/06/2014&nbsp;19:24,&nbsp;Jonathan&nbsp;Vanasco&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;br&gt;I&nbsp;had&nbsp;to&nbsp;restart&nbsp;postgresql&nbsp;,&nbsp;and&nbsp;that&nbsp;triggered&nbsp;some&nbsp;endless&nbsp;errors&nbsp;in&nbsp;my&lt;br&gt;logs.&lt;br&gt;&lt;br&gt;i&nbsp;don't&nbsp;have&nbsp;anything&nbsp;that&nbsp;can&nbsp;handle&nbsp;a&nbsp;suddenly&nbsp;dropped&nbsp;/&nbsp;resumed&lt;br&gt;connection.&lt;br&gt;&lt;br&gt;does&nbsp;anyone&nbsp;have&nbsp;a&nbsp;recommendation&nbsp;for&nbsp;trying&nbsp;to&nbsp;reconnect&nbsp;or&nbsp;handle&nbsp;this&lt;br&gt;in&nbsp;general&lt;br&gt;&lt;br&gt;from&nbsp;what&nbsp;I&nbsp;can&nbsp;tell&nbsp;from&nbsp;my&nbsp;logs...&lt;br&gt;&lt;br&gt;When&nbsp;I&nbsp;catch&nbsp;an&nbsp;error,&nbsp;my&nbsp;cleanup&nbsp;code&nbsp;tries&nbsp;to&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._connection.rollback()&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;raises&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;psycopg2.InterfaceError:&nbsp;connection&nbsp;already&nbsp;closed&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;br&gt;Yes,&nbsp;this&nbsp;is&nbsp;irritating.&lt;br&gt;&lt;br&gt;Related&nbsp;tickets&nbsp;see:&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/trac/ticket/4404&quot;&gt;http://twistedmatrix.com/trac/ticket/4404&lt;/a&gt;&lt;br&gt;http://twistedmatrix.com/trac/ticket/4964&lt;br&gt;&lt;br&gt;You&nbsp;absolutely&nbsp;want&nbsp;to&nbsp;be&nbsp;setting&nbsp;cp_reconnect=1&nbsp;on&nbsp;ConnectionPool.&nbsp;Anything&lt;br&gt;else&nbsp;is&nbsp;asking&nbsp;for&nbsp;major&nbsp;trouble,&nbsp;and&nbsp;I&nbsp;really&nbsp;think&nbsp;this&nbsp;should&nbsp;be&nbsp;the&lt;br&gt;default.&lt;br&gt;&lt;br&gt;cp_reconnect&nbsp;will&nbsp;not&nbsp;avoid&nbsp;all&nbsp;problems&nbsp;-&nbsp;for&nbsp;a&nbsp;thread&nbsp;pool&nbsp;of&nbsp;size&nbsp;N,&nbsp;the&lt;br&gt;next&nbsp;N&nbsp;transactions&nbsp;will&nbsp;have&nbsp;to&nbsp;fail&nbsp;to&nbsp;throw&nbsp;away&nbsp;all&nbsp;the&nbsp;dead&nbsp;connections&lt;br&gt;-&nbsp;but&nbsp;it&nbsp;might&nbsp;stop&nbsp;them&nbsp;happing&nbsp;forever.&lt;br&gt;&lt;br&gt;In&nbsp;some&nbsp;other,&nbsp;non-Twisted&nbsp;contexts,&nbsp;people&nbsp;have&nbsp;had&nbsp;problem&nbsp;even&nbsp;with&lt;br&gt;reconnecting,&nbsp;because&nbsp;some&nbsp;versions&nbsp;of&nbsp;some&nbsp;DBAPI&nbsp;drivers&nbsp;emit&nbsp;a&nbsp;connection&lt;br&gt;from&nbsp;.close()&nbsp;if&nbsp;it's&nbsp;already&nbsp;closed,&nbsp;which&nbsp;interrupts&nbsp;the&nbsp;reconnection&lt;br&gt;logic&nbsp;:o(&lt;br&gt;&lt;br&gt;It&nbsp;seems&nbsp;your&nbsp;version&nbsp;of&nbsp;psycopg&nbsp;is&nbsp;doing&nbsp;this&nbsp;-&nbsp;how&nbsp;old&nbsp;is&nbsp;it?&nbsp;I&nbsp;thought&lt;br&gt;that&nbsp;was&nbsp;fixed&nbsp;these&nbsp;days?&lt;br&gt;&lt;br&gt;You&nbsp;might&nbsp;also&nbsp;look&nbsp;at&nbsp;something&nbsp;like&nbsp;pgbouncer,&nbsp;which&nbsp;you&nbsp;can&nbsp;configure&nbsp;to&lt;br&gt;try&nbsp;a&nbsp;&quot;good&quot;&nbsp;SQL&nbsp;query&nbsp;on&nbsp;the&nbsp;outbound&nbsp;connections&nbsp;before&nbsp;handing&nbsp;to&nbsp;an&lt;br&gt;inbound&nbsp;client;&nbsp;this&nbsp;probes&nbsp;the&nbsp;connections.&nbsp;It&nbsp;adds&nbsp;latency,&nbsp;but&nbsp;personally&lt;br&gt;I&nbsp;would&nbsp;far&nbsp;rather&nbsp;pay&nbsp;the&nbsp;small&nbsp;number&nbsp;of&nbsp;milliseconds&nbsp;on&nbsp;&quot;select&nbsp;1&quot;&nbsp;than&lt;br&gt;bomb&nbsp;out&nbsp;to&nbsp;the&nbsp;upper&nbsp;layers.&lt;br&gt;&lt;br&gt;An&nbsp;annoying&nbsp;problem.&lt;br&gt;&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;Twisted-Python@twistedmatrix.com&lt;br&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
