<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Dec&nbsp;13,&nbsp;2015,&nbsp;at&nbsp;7:50&nbsp;AM,&nbsp;Wang&nbsp;Yan&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:snailcoder@163.com&quot;&nbsp;class=&quot;&quot;&gt;snailcoder@163.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;style=&quot;line-height:&nbsp;1.7;&nbsp;font-size:&nbsp;14px;&nbsp;font-family:&nbsp;Arial;&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I'm&nbsp;trying&nbsp;to&nbsp;use&nbsp;Twisted's&nbsp;&lt;span&nbsp;style=&quot;font-family:&nbsp;'trebuchet&nbsp;ms',&nbsp;verdana,&nbsp;arial,&nbsp;'Bitstream&nbsp;Vera&nbsp;Sans',&nbsp;helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;13px;&nbsp;line-height:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;HTTP&nbsp;basic&nbsp;authentication&nbsp;to&nbsp;control&nbsp;access&nbsp;to&nbsp;some&nbsp;protected&nbsp;resources.&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;'trebuchet&nbsp;ms',&nbsp;verdana,&nbsp;arial,&nbsp;'Bitstream&nbsp;Vera&nbsp;Sans',&nbsp;helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;13px;&nbsp;line-height:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;'trebuchet&nbsp;ms',&nbsp;verdana,&nbsp;arial,&nbsp;'Bitstream&nbsp;Vera&nbsp;Sans',&nbsp;helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;13px;&nbsp;line-height:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;According&nbsp;to&nbsp;some&nbsp;articles,&nbsp;it&nbsp;is&nbsp;necessary&nbsp;to&nbsp;use&nbsp;three&nbsp;important&nbsp;concepts:&nbsp;Realm,&nbsp;Portal&nbsp;and&nbsp;avatar.&nbsp;Now&nbsp;I'm&nbsp;wondering&nbsp;if&nbsp;the&nbsp;Realm&nbsp;and&nbsp;avatar&nbsp;is&nbsp;one&nbsp;to&nbsp;one&nbsp;correspondence.&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;idea&nbsp;is&nbsp;that&nbsp;a&nbsp;Realm&nbsp;represents&nbsp;an&nbsp;application,&nbsp;and&nbsp;an&nbsp;Avatar&nbsp;represents&nbsp;a&nbsp;single&nbsp;user's&nbsp;data&nbsp;within&nbsp;that&nbsp;application.&nbsp;&nbsp;This&nbsp;example&nbsp;is&nbsp;a&nbsp;bit&nbsp;oversimplified,&nbsp;since&nbsp;it&nbsp;doesn't&nbsp;provide&nbsp;any&nbsp;inputs&nbsp;to&nbsp;the&nbsp;user's&nbsp;data;&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;you'd&nbsp;want&nbsp;to&nbsp;retrieve&nbsp;a&nbsp;session&nbsp;or&nbsp;something&nbsp;based&nbsp;on&nbsp;the&nbsp;avatarID.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;style=&quot;line-height:&nbsp;1.7;&nbsp;font-size:&nbsp;14px;&nbsp;font-family:&nbsp;Arial;&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,&nbsp;verdana,&nbsp;arial,&nbsp;Bitstream&nbsp;Vera&nbsp;Sans,&nbsp;helvetica,&nbsp;sans-serif&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;13px;&nbsp;line-height:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;Let's&nbsp;look&nbsp;at&nbsp;an&nbsp;example(&lt;a&nbsp;href=&quot;http://www.red-bean.com/doc/python-twisted-web/examples/webguard.py&quot;&nbsp;class=&quot;&quot;&gt;http://www.red-bean.com/doc/python-twisted-web/examples/webguard.py&lt;/a&gt;&lt;/span&gt;&lt;/font&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;13px;&nbsp;line-height:&nbsp;normal;&nbsp;font-family:&nbsp;'trebuchet&nbsp;ms',&nbsp;verdana,&nbsp;arial,&nbsp;'Bitstream&nbsp;Vera&nbsp;Sans',&nbsp;helvetica,&nbsp;sans-serif;&quot;&nbsp;class=&quot;&quot;&gt;):&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,&nbsp;verdana,&nbsp;arial,&nbsp;Bitstream&nbsp;Vera&nbsp;Sans,&nbsp;helvetica,&nbsp;sans-serif&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;13px;&nbsp;line-height:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;pre&nbsp;style=&quot;line-height:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;import&nbsp;sys<br>
<br>
from&nbsp;zope.interface&nbsp;import&nbsp;implements<br>
<br>
from&nbsp;twisted.python&nbsp;import&nbsp;log<br>
from&nbsp;twisted.internet&nbsp;import&nbsp;reactor<br>
from&nbsp;twisted.web&nbsp;import&nbsp;server,&nbsp;resource,&nbsp;guard<br>
from&nbsp;twisted.cred.portal&nbsp;import&nbsp;IRealm,&nbsp;Portal<br>
from&nbsp;twisted.cred.checkers&nbsp;import&nbsp;InMemoryUsernamePasswordDatabaseDontUse<br>
<br>
<br>
class&nbsp;GuardedResource(resource.Resource):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;resource&nbsp;which&nbsp;is&nbsp;protected&nbsp;by&nbsp;guard&nbsp;and&nbsp;requires&nbsp;authentication&nbsp;in&nbsp;order<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;access.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;getChild(self,&nbsp;path,&nbsp;request):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;render(self,&nbsp;request):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;Authorized!&quot;<br>
<br>
<br>
<br>
class&nbsp;SimpleRealm(object):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;realm&nbsp;which&nbsp;gives&nbsp;out&nbsp;L{GuardedResource}&nbsp;instances&nbsp;for&nbsp;authenticated<br>
&nbsp;&nbsp;&nbsp;&nbsp;users.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;implements(IRealm)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;requestAvatar(self,&nbsp;avatarId,&nbsp;mind,&nbsp;*interfaces):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;resource.IResource&nbsp;in&nbsp;interfaces:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;resource.IResource,&nbsp;GuardedResource(),&nbsp;lambda:&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;NotImplementedError()<br>
<br>
<br>
<br>
def&nbsp;main():<br>
&nbsp;&nbsp;&nbsp;&nbsp;log.startLogging(sys.stdout)<br>
&nbsp;&nbsp;&nbsp;&nbsp;checkers&nbsp;=&nbsp;[InMemoryUsernamePasswordDatabaseDontUse(joe='blow')]<br>
&nbsp;&nbsp;&nbsp;&nbsp;wrapper&nbsp;=&nbsp;guard.HTTPAuthSessionWrapper(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Portal(SimpleRealm(),&nbsp;checkers),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[guard.DigestCredentialFactory('md5',&nbsp;'&lt;a&nbsp;href=&quot;http://example.com&quot;&nbsp;class=&quot;&quot;&gt;example.com&lt;/a&gt;')])<br>
&nbsp;&nbsp;&nbsp;&nbsp;reactor.listenTCP(8889,&nbsp;server.Site(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resource&nbsp;=&nbsp;wrapper))<br>
&nbsp;&nbsp;&nbsp;&nbsp;reactor.run()<br>
<br>
if&nbsp;__name__&nbsp;==&nbsp;'__main__':<br>
&nbsp;&nbsp;&nbsp;&nbsp;main()&lt;/pre&gt;&lt;pre&nbsp;style=&quot;line-height:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/pre&gt;&lt;pre&nbsp;style=&quot;line-height:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;Of&nbsp;course&nbsp;I&nbsp;know&nbsp;the&nbsp;SimpleRealm&nbsp;is&nbsp;used&nbsp;to&nbsp;return&nbsp;the&nbsp;corresponding&nbsp;resource,&nbsp;e.g.&nbsp;GuardedResource&nbsp;in&nbsp;above&nbsp;example.&nbsp;However,&nbsp;I&nbsp;don't&nbsp;know&nbsp;what&nbsp;to&nbsp;do&nbsp;when&nbsp;there&nbsp;lots&nbsp;of&nbsp;resources&nbsp;to&nbsp;be&nbsp;guarded.&nbsp;For&nbsp;example,&nbsp;I&nbsp;have&nbsp;GuardedResource1,&nbsp;GuardedResource2&nbsp;and&nbsp;GuardedResource3,&nbsp;maybe&nbsp;they&nbsp;need&nbsp;the&nbsp;same&nbsp;or&nbsp;different&nbsp;number&nbsp;of&nbsp;parameters&nbsp;when&nbsp;they&nbsp;are&nbsp;initialized;&nbsp;If&nbsp;so,&nbsp;is&nbsp;it&nbsp;necessary&nbsp;to&nbsp;implement&nbsp;SimpleRealm1,&nbsp;SimpleRealm2&nbsp;and&nbsp;SimpleRealm3,&nbsp;respectively?&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;Rather&nbsp;than&nbsp;thinking&nbsp;of&nbsp;a&nbsp;resource&nbsp;as&nbsp;always&nbsp;existing&nbsp;and&nbsp;just&nbsp;needing&nbsp;to&nbsp;have&nbsp;a&nbsp;lock&nbsp;on&nbsp;it&nbsp;or&nbsp;not,&nbsp;consider&nbsp;the&nbsp;more&nbsp;flexible&nbsp;model&nbsp;(the&nbsp;one&nbsp;that&nbsp;cred&nbsp;actually&nbsp;implements)&nbsp;where&nbsp;a&nbsp;single&nbsp;Avatar&nbsp;object&nbsp;(in&nbsp;this&nbsp;case:&nbsp;the&nbsp;top&nbsp;IResource&nbsp;returned&nbsp;from&nbsp;SimpleRealm)&nbsp;is&nbsp;the&nbsp;top&nbsp;level&nbsp;of&nbsp;&quot;everything&nbsp;the&nbsp;user&nbsp;has&nbsp;access&nbsp;to&quot;.&nbsp;&nbsp;In&nbsp;other&nbsp;words,&nbsp;'GuardedResource'&nbsp;should&nbsp;have&nbsp;a&nbsp;'getChild'&nbsp;method&nbsp;which&nbsp;makes&nbsp;the&nbsp;determination&nbsp;if&nbsp;the&nbsp;user&nbsp;they&nbsp;represent&nbsp;(really,&nbsp;at&nbsp;least&nbsp;the&nbsp;avatarId&nbsp;should&nbsp;be&nbsp;supplied&nbsp;to&nbsp;GuardedResource.__init__)&nbsp;has&nbsp;access&nbsp;to&nbsp;other&nbsp;resources,&nbsp;and&nbsp;return&nbsp;them&nbsp;if&nbsp;so,&nbsp;and&nbsp;appropriate&nbsp;errors&nbsp;if&nbsp;not.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Even&nbsp;the&nbsp;resources&nbsp;available&nbsp;to&nbsp;a&nbsp;not-logged-in&nbsp;user&nbsp;(see&nbsp;twisted.cred.credentials.Anonymous)&nbsp;is&nbsp;just&nbsp;another&nbsp;avatar,&nbsp;the&nbsp;one&nbsp;served&nbsp;up&nbsp;to&nbsp;unauthenticated&nbsp;people.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;if&nbsp;you&nbsp;have&nbsp;&lt;a&nbsp;href=&quot;https://myapp.example.com/a/b/secure/c/d&quot;&nbsp;class=&quot;&quot;&gt;https://myapp.example.com/a/b/secure/c/d&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=&quot;https://myapp.example.com/a/b/secure&quot;&nbsp;class=&quot;&quot;&gt;https://myapp.example.com/a/b/secure&lt;/a&gt;&nbsp;would&nbsp;be&nbsp;the&nbsp;guarded&nbsp;resource,&nbsp;and&nbsp;then&nbsp;SecureResource.getChild(&quot;c&quot;,&nbsp;...)&nbsp;would&nbsp;return&nbsp;&quot;c&quot;,&nbsp;which&nbsp;would&nbsp;in&nbsp;turn&nbsp;return&nbsp;&quot;d&quot;&nbsp;if&nbsp;the&nbsp;logged-in&nbsp;user&nbsp;has&nbsp;access&nbsp;to&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;this&nbsp;make&nbsp;sense?&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;using&nbsp;Twisted,&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
