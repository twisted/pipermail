<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Dec&nbsp;16,&nbsp;2015,&nbsp;at&nbsp;9:25&nbsp;AM,&nbsp;Chris&nbsp;Norman&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:chris.norman2@googlemail.com&quot;&nbsp;class=&quot;&quot;&gt;chris.norman2@googlemail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Hi&nbsp;all,&lt;br&nbsp;class=&quot;&quot;&gt;I'm&nbsp;writing&nbsp;a&nbsp;MUD&nbsp;server,&nbsp;and&nbsp;I&nbsp;want&nbsp;a&nbsp;way&nbsp;for&nbsp;transports&nbsp;to&nbsp;be&nbsp;notified&nbsp;ofa&nbsp;shutdown&nbsp;before&nbsp;being&nbsp;disconnected,&nbsp;and&nbsp;the&nbsp;reactor&nbsp;being&nbsp;stopped.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I've&nbsp;tried:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;for&nbsp;t&nbsp;in&nbsp;transports:&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;t.write('Shutting&nbsp;down.\r\n')&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;t.loseConnection()&lt;br&nbsp;class=&quot;&quot;&gt;reactor.stop()&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;This&nbsp;doesn't&nbsp;seem&nbsp;to&nbsp;notify&nbsp;the&nbsp;transports.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I&nbsp;also&nbsp;tried:&lt;br&nbsp;class=&quot;&quot;&gt;for&nbsp;t&nbsp;in&nbsp;transports:&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;t.write('Shutting&nbsp;down.\r\n')&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;t.loseConnection()&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;while&nbsp;t.connected:&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;pass&lt;br&nbsp;class=&quot;&quot;&gt;reactor.stop()&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;That&nbsp;just&nbsp;blocked&nbsp;and&nbsp;did&nbsp;nothing,&nbsp;presumably&nbsp;something&nbsp;do&nbsp;with&nbsp;my&nbsp;while&nbsp;loop.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Is&nbsp;there&nbsp;a&nbsp;stopWhenEmpty&nbsp;function&nbsp;on&nbsp;the&nbsp;somewhere?&nbsp;I&nbsp;did&nbsp;look&nbsp;over&nbsp;the&nbsp;methods,&nbsp;and&nbsp;I&nbsp;couldn't&nbsp;find&nbsp;anything&nbsp;promising.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I'm&nbsp;just&nbsp;using&nbsp;the&nbsp;standard&nbsp;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&nbsp;reactor,&nbsp;so&nbsp;no&nbsp;special&nbsp;cases&nbsp;here.&nbsp;In&nbsp;case&nbsp;it&nbsp;matters&nbsp;the&nbsp;transports&nbsp;I'm&nbsp;using&nbsp;are&nbsp;twisted.protocols.basic.LineReceiver,&nbsp;and&nbsp;everything&nbsp;else&nbsp;works&nbsp;with&nbsp;them.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Cheers&nbsp;in&nbsp;advance&nbsp;for&nbsp;the&nbsp;help.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;definitely&nbsp;doable,&nbsp;but&nbsp;before&nbsp;I&nbsp;explain&nbsp;it&nbsp;would&nbsp;help&nbsp;to&nbsp;know&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;why&lt;/i&gt;&nbsp;you&nbsp;want&nbsp;to&nbsp;do&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;reason&nbsp;I&nbsp;ask&nbsp;is:&nbsp;servers&nbsp;crash;&nbsp;hardware&nbsp;fails.&nbsp;&nbsp;The&nbsp;falcon&nbsp;cannot&nbsp;hear&nbsp;the&nbsp;falconer;&nbsp;things&nbsp;fall&nbsp;apart;&nbsp;the&nbsp;centre&nbsp;cannot&nbsp;hold.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;those&nbsp;servers&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;do&lt;/i&gt;&nbsp;crash&nbsp;(and&nbsp;they&nbsp;will),&nbsp;you&nbsp;don't&nbsp;get&nbsp;a&nbsp;clean&nbsp;notification&nbsp;of&nbsp;disconnects.&nbsp;&nbsp;So&nbsp;if&nbsp;you're&nbsp;writing&nbsp;your&nbsp;application&nbsp;to&nbsp;rely&nbsp;very&nbsp;heavily&nbsp;on&nbsp;the&nbsp;ability&nbsp;to&nbsp;do&nbsp;a&nbsp;clean&nbsp;shutdown&nbsp;and&nbsp;get&nbsp;notifications&nbsp;of&nbsp;every&nbsp;disconnect&nbsp;at&nbsp;the&nbsp;time&nbsp;you&nbsp;expect&nbsp;reactor.stop()&nbsp;to&nbsp;be&nbsp;running,&nbsp;you&nbsp;are&nbsp;probably&nbsp;designing&nbsp;your&nbsp;system&nbsp;in&nbsp;a&nbsp;way&nbsp;that&nbsp;will&nbsp;be&nbsp;very&nbsp;fragile&nbsp;and&nbsp;prone&nbsp;to&nbsp;data&nbsp;loss.&nbsp;&nbsp;I&nbsp;know,&nbsp;I&nbsp;have&nbsp;made&nbsp;this&nbsp;mistake&nbsp;more&nbsp;than&nbsp;once&nbsp;myself&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;before&nbsp;you&nbsp;continue:&nbsp;do&nbsp;you&nbsp;actually&nbsp;need&nbsp;to&nbsp;do&nbsp;this?&nbsp;&nbsp;Could&nbsp;you&nbsp;just&nbsp;ignore&nbsp;the&nbsp;notification&nbsp;of&nbsp;the&nbsp;connection&nbsp;drop&nbsp;and&nbsp;exit&nbsp;gracefully,&nbsp;perhaps&nbsp;properly&nbsp;cleaning&nbsp;up&nbsp;whatever&nbsp;state&nbsp;is&nbsp;left&nbsp;over&nbsp;at&nbsp;next&nbsp;startup?&nbsp;&nbsp;If&nbsp;you&nbsp;really&nbsp;need&nbsp;this,&nbsp;understanding&nbsp;why&nbsp;you&nbsp;need&nbsp;it&nbsp;would&nbsp;also&nbsp;help&nbsp;in&nbsp;determining&nbsp;which&nbsp;implementation&nbsp;technique&nbsp;to&nbsp;suggest&nbsp;(there&nbsp;are&nbsp;a&nbsp;few).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
