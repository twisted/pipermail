<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;I&#39;m&nbsp;trying&nbsp;to&nbsp;understand&nbsp;why&nbsp;a&nbsp;chain&nbsp;of&nbsp;Deferreds&nbsp;I&#39;m&nbsp;dealing&nbsp;with&nbsp;hangs&nbsp;and&nbsp;why&nbsp;return&nbsp;values&nbsp;from&nbsp;some&nbsp;callbacks&nbsp;are&nbsp;not&nbsp;always&nbsp;making&nbsp;it&nbsp;to&nbsp;other&nbsp;callbacks&nbsp;down&nbsp;the&nbsp;chain&nbsp;of&nbsp;Deferreds.&lt;/span&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;Is&nbsp;it&nbsp;possible&nbsp;that&nbsp;there&nbsp;could&nbsp;be&nbsp;a&nbsp;race&nbsp;condition&nbsp;between &lt;a&nbsp;href=&quot;http://twistedmatrix.com/documents/current/core/howto/defer.html&quot;&nbsp;target=&quot;_blank&quot;&gt;Deferred&nbsp;chaining&nbsp;and&nbsp;Deferred&nbsp;result&nbsp;gathering&lt;/a&gt;?&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;I.e., &lt;a&nbsp;href=&quot;http://twistedmatrix.com/documents/current/core/howto/defer.html#auto13&quot;&nbsp;target=&quot;_blank&quot;&gt;Chaining&nbsp;Deferreds&lt;/a&gt; says&nbsp;that&nbsp;&quot;&lt;i&gt;If&nbsp;you&nbsp;need&nbsp;one&nbsp;Deferred&nbsp;to&nbsp;wait&nbsp;on&nbsp;another,&nbsp;all&nbsp;you&nbsp;need&nbsp;to&nbsp;do&nbsp;is&nbsp;return&nbsp;a&nbsp;Deferred&nbsp;from&nbsp;a&nbsp;method&nbsp;added&nbsp;to&nbsp;addCallbacks.&nbsp;Specifically,&nbsp;if&nbsp;you&nbsp;return&nbsp;Deferred&nbsp;B&nbsp;from&nbsp;a&nbsp;method&nbsp;added&nbsp;to&nbsp;Deferred&nbsp;A&nbsp;using&nbsp;A.addCallbacks,&nbsp;Deferred&nbsp;A&#39;s&nbsp;processing&nbsp;chain&nbsp;will&nbsp;stop&nbsp;until&nbsp;Deferred&nbsp;B&#39;s&nbsp;.callback()&nbsp;method&nbsp;is&nbsp;called;&nbsp;at&nbsp;that&nbsp;point,&nbsp;the&nbsp;next&nbsp;callback&nbsp;in&nbsp;A&nbsp;will&nbsp;be&nbsp;passed&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;last&nbsp;callback&nbsp;in&nbsp;Deferred&nbsp;B&#39;s&nbsp;processing&nbsp;chain&nbsp;at&nbsp;the&nbsp;time&lt;/i&gt;.&quot; &lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;Now&nbsp;at&nbsp;the&nbsp;same&nbsp;time, &lt;/span&gt;&lt;font&nbsp;size=&quot;3&quot;&nbsp;style=&quot;font-family:arial,sans-serif&quot;&gt;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/documents/current/core/howto/defer.html#auto8&quot;&nbsp;target=&quot;_blank&quot;&gt;DeferredList&lt;/a&gt; &lt;/font&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;(on&nbsp;top&nbsp;of&nbsp;which&nbsp;gatherResults&nbsp;is&nbsp;built)&nbsp;warns&nbsp;that &quot;&lt;/span&gt;&lt;i&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;If&nbsp;you want&nbsp;to&nbsp;apply&nbsp;callbacks&nbsp;to&nbsp;the&nbsp;individual&nbsp;Deferreds&nbsp;that&nbsp;go&nbsp;into&nbsp;the&nbsp;DeferredList,&nbsp;you&nbsp;should&nbsp;be&nbsp;careful&nbsp;about&nbsp;when&nbsp;those&nbsp;callbacks&nbsp;are&nbsp;added.&nbsp;The&nbsp;act&nbsp;of&nbsp;adding&nbsp;a&nbsp;Deferred&nbsp;to&nbsp;a DeferredList&nbsp;inserts&nbsp;a&nbsp;callback&nbsp;into&nbsp;that&nbsp;Deferred&nbsp;...&nbsp;The&nbsp;important&nbsp;thing&nbsp;to&nbsp;remember&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;this&nbsp;callback&nbsp;which&nbsp;records&nbsp;the&nbsp;value&nbsp;that&nbsp;goes&nbsp;into&nbsp;the&nbsp;result&nbsp;list&nbsp;handed&nbsp;to&nbsp;the&nbsp;DeferredList&#39;s&nbsp;callback.&lt;/i&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;<br>
<br>
&lt;i&gt;Therefore,&nbsp;if&nbsp;you&nbsp;add&nbsp;a&nbsp;callback&nbsp;to&nbsp;the&nbsp;Deferred&nbsp;after&nbsp;adding&nbsp;the&nbsp;Deferred&nbsp;to&nbsp;the&nbsp;DeferredList,&nbsp;the&nbsp;value&nbsp;returned&nbsp;by&nbsp;that&nbsp;callback&nbsp;will&nbsp;not&nbsp;be&nbsp;given&nbsp;to&nbsp;the&nbsp;DeferredList&#39;s&nbsp;callback.&nbsp;To&nbsp;avoid&nbsp;confusion, &lt;b&gt;we&nbsp;recommend&nbsp;not&nbsp;adding&nbsp;callbacks&nbsp;to&nbsp;a&nbsp;Deferred&nbsp;once&nbsp;it&nbsp;has&nbsp;been&nbsp;used&nbsp;in&nbsp;a&nbsp;DeferredList&lt;/b&gt;&lt;/i&gt;&quot;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;Given&nbsp;these&nbsp;two&nbsp;explanations,&nbsp;say&nbsp;I&nbsp;have&nbsp;something&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;<br>
<br>
---------------------------------------------------------------------------&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;def&nbsp;slowFuncReturningDeferred_A():&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt; &nbsp;...&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;def&nbsp;slowFuncReturningDeferred_B():&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt; &nbsp;...&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;d&nbsp;=&nbsp;defer.Deferred()&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;d.addCallback(labmda&nbsp;_:&nbsp;slowFuncReturningDeferred_A())&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;d.addCallback(labmda&nbsp;_: slowFuncReturningDeferred_B())&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;defer.gatherResults([d])&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;---------------------------------------------------------------------------&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;<br>
<br>
Wouldn&#39;t&nbsp;it&nbsp;be&nbsp;possible&nbsp;that &lt;span&nbsp;style=&quot;font-family:&#39;courier&nbsp;new&#39;,monospace&quot;&gt;defer.gatherResults&lt;/span&gt; inserts&nbsp;its&nbsp;callback&nbsp;into &lt;span&nbsp;style=&quot;font-family:&#39;courier&nbsp;new&#39;,monospace&quot;&gt;d&lt;/span&gt; before&nbsp;say &lt;span&nbsp;style=&quot;font-family:&#39;courier&nbsp;new&#39;,monospace&quot;&gt;slowFuncReturningDeferred_B&lt;/span&gt; gets&nbsp;to&nbsp;run&nbsp;and&nbsp;return&nbsp;its&nbsp;own&nbsp;Deferred&nbsp;(and&nbsp;therefore&nbsp;chain&nbsp;it&nbsp;to&nbsp;what&nbsp;gatherRestults&nbsp;is&nbsp;ultimately&nbsp;waiting&nbsp;for?).&nbsp;If&nbsp;so,&nbsp;wouldn&#39;t&nbsp;the&nbsp;results&nbsp;returned&nbsp;by &lt;span&nbsp;style=&quot;font-family:&#39;courier&nbsp;new&#39;,monospace&quot;&gt;slowFuncReturningDeferred_B&lt;/span&gt; never&nbsp;make&nbsp;it&nbsp;to&nbsp;the&nbsp;results&nbsp;gathered&nbsp;by &lt;span&nbsp;style=&quot;font-family:&#39;courier&nbsp;new&#39;,monospace&quot;&gt;defer.gatherResults&lt;/span&gt;?&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;Thanks,&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:arial,sans-serif;font-size:14px&quot;&gt;Jorge&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
