<tt>
&lt;div&gt;This&nbsp;isn't&nbsp;the&nbsp;best&nbsp;solution,&nbsp;but&nbsp;I've&amp;nbsp;been&nbsp;using&amp;nbsp;a&nbsp;semaphore&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;&amp;quot;tasks&amp;quot;&nbsp;that&nbsp;take&nbsp;place&nbsp;at&nbsp;a&nbsp;time.&amp;nbsp;&nbsp;I've&nbsp;also&nbsp;been&nbsp;doing&nbsp;some&nbsp;research&nbsp;on&nbsp;IOCP&nbsp;and&nbsp;plan&nbsp;on&nbsp;adding&nbsp;some&nbsp;missing&nbsp;functionality&nbsp;to&nbsp;the&nbsp;IOCP&nbsp;reactor&nbsp;so&nbsp;I&nbsp;don't&nbsp;have&nbsp;to&nbsp;use&nbsp;the&nbsp;win32eventreactor&nbsp;anymore.<br>
&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;p&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;defer&lt;/p&gt;<br>
&lt;p&gt;class&nbsp;Semaphore:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;A&nbsp;semaphore&nbsp;for&nbsp;event&nbsp;driven&nbsp;systems.&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;tokens):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.waiting&nbsp;=&nbsp;[]&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.tokens&amp;nbsp;&nbsp;=&nbsp;tokens&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.limit&amp;nbsp;&amp;nbsp;&nbsp;=&nbsp;tokens<br>
&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;acquire(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;Attempt&nbsp;to&nbsp;acquire&nbsp;the&nbsp;token.&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;@return&nbsp;Deferred&nbsp;which&nbsp;returns&nbsp;on&nbsp;token&nbsp;acquisition.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;assert&nbsp;self.tokens&nbsp;&amp;gt;=&nbsp;0&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d&nbsp;=&nbsp;defer.Deferred()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;not&nbsp;self.tokens:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.waiting.append<br>
(d)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.tokens&nbsp;=&nbsp;self.tokens&nbsp;-&nbsp;1&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d.callback(self)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;d&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;release(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;Release&nbsp;the&nbsp;token.&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Should&nbsp;be&nbsp;called&nbsp;by&nbsp;whoever&nbsp;did&nbsp;the&nbsp;acquire()&nbsp;when&nbsp;the&nbsp;shared&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;resource&nbsp;is&nbsp;free.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;assert&nbsp;self.tokens&nbsp;&amp;lt;&nbsp;self.limit&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.tokens&nbsp;=&nbsp;self.tokens&nbsp;+&nbsp;1&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;self.waiting:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;someone&nbsp;is&nbsp;waiting&nbsp;to&nbsp;acquire&nbsp;token&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.tokens&nbsp;=&nbsp;self.tokens&nbsp;-&nbsp;1&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d&nbsp;=&nbsp;self.waiting.pop(0)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d.callback(self)&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;_releaseAndReturn(self,&nbsp;r):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.release()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;r&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;run(self,&nbsp;f,&nbsp;*args,&nbsp;**kwargs):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;Acquire&nbsp;token,&nbsp;run&nbsp;function,&nbsp;release&nbsp;token.&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;@return&nbsp;Deferred&nbsp;of&nbsp;function&nbsp;result.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d&nbsp;=&nbsp;self.acquire()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d.addCallback(lambda&nbsp;r:&nbsp;defer.maybeDeferred(f,&nbsp;*args,&nbsp;**kwargs).addBoth(self._releaseAndReturn))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;d<br>
&lt;br&gt;&lt;/p&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;br&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;6/28/05,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Toby&nbsp;Dickenson&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tdickenson@devmail.geminidataloggers.co.uk&quot;&gt;tdickenson@devmail.geminidataloggers.co.uk&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&nbsp;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;PADDING-LEFT:&nbsp;1ex;&nbsp;MARGIN:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;BORDER-LEFT:&nbsp;#ccc&nbsp;1px&nbsp;solid&quot;&gt;Im&nbsp;finding&nbsp;that&nbsp;Win32Reactor&nbsp;raises&nbsp;an&nbsp;exception&nbsp;on&nbsp;every&nbsp;iteration&nbsp;of&nbsp;the&lt;br&gt;main&nbsp;loop&nbsp;if&nbsp;I&nbsp;exceed&nbsp;the&nbsp;limit&nbsp;of&nbsp;64&nbsp;WaitForMultipleObjects.<br>
&lt;br&gt;&lt;br&gt;I&nbsp;would&nbsp;prefer&nbsp;to&nbsp;avoid&nbsp;this&nbsp;fairly&nbsp;obvious&nbsp;denial-of-service&nbsp;problem&nbsp;by&lt;br&gt;limiting&nbsp;the&nbsp;number&nbsp;of&nbsp;concurrent&nbsp;client&nbsp;connections.&nbsp;Is&nbsp;there&nbsp;a&nbsp;standard&lt;br&gt;solution&nbsp;for&nbsp;this?&lt;br&gt;&lt;br&gt;Thanks&nbsp;in&nbsp;advance,&lt;br&gt;&lt;br&gt;--&lt;br&gt;Toby&nbsp;Dickenson<br>
&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&gt;<br>
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
