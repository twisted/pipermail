<tt>
Hello&nbsp;Everyone!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;name&nbsp;is&nbsp;Dirk&nbsp;Moors,&nbsp;and&nbsp;since&nbsp;4&nbsp;years&nbsp;now,&nbsp;I&#39;ve&nbsp;been&nbsp;involved&nbsp;in&nbsp;developing&nbsp;a&nbsp;cloud&nbsp;computing&nbsp;platform,&nbsp;using&nbsp;Python&nbsp;as&nbsp;the&nbsp;programming&nbsp;language.&nbsp;A&nbsp;year&nbsp;ago&nbsp;I&nbsp;discovered&nbsp;Twisted&nbsp;Python,&nbsp;and&nbsp;it&nbsp;got&nbsp;me&nbsp;very&nbsp;interested,&nbsp;upto&nbsp;the&nbsp;point&nbsp;where&nbsp;I&nbsp;made&nbsp;the&nbsp;decision&nbsp;to&nbsp;convert&nbsp;our&nbsp;platform&nbsp;(in&nbsp;progress)&nbsp;to&nbsp;a&nbsp;Twisted&nbsp;platform.&nbsp;One&nbsp;year&nbsp;later&nbsp;I&#39;m&nbsp;still&nbsp;very&nbsp;enthousiastic&nbsp;about&nbsp;the&nbsp;overal&nbsp;performance&nbsp;and&nbsp;stability,&nbsp;but&nbsp;last&nbsp;week&nbsp;I&nbsp;encountered&nbsp;something&nbsp;I&nbsp;did&#39;t&nbsp;expect;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;appeared&nbsp;that&nbsp;it&nbsp;was&nbsp;less&nbsp;efficient&nbsp;to&nbsp;run&nbsp;small&nbsp;&quot;atomic&quot;&nbsp;operations&nbsp;in&nbsp;different&nbsp;deferred-callbacks,&nbsp;when&nbsp;compared&nbsp;to&nbsp;running&nbsp;these&nbsp;&quot;atomic&quot;&nbsp;operations&nbsp;together&nbsp;in&nbsp;&quot;blocking&quot;&nbsp;mode.&nbsp;Am&nbsp;I&nbsp;doing&nbsp;something&nbsp;wrong&nbsp;here?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;prove&nbsp;the&nbsp;problem&nbsp;to&nbsp;myself,&nbsp;I&nbsp;created&nbsp;the&nbsp;following&nbsp;example&nbsp;(Full&nbsp;source-&nbsp;and&nbsp;test&nbsp;code&nbsp;is&nbsp;attached):&lt;/div&gt;&lt;div&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/div&gt;<br>
&lt;div&gt;import&nbsp;struct&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;def&nbsp;int2binAsync(anInteger):&lt;/div&gt;&lt;div&gt;  &nbsp; def&nbsp;packStruct(i):&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; #Packs&nbsp;an&nbsp;integer,&nbsp;result&nbsp;is&nbsp;4&nbsp;bytes&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; return&nbsp;struct.pack(&quot;i&quot;,&nbsp;i)&nbsp; &nbsp; &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; d&nbsp;=&nbsp;defer.Deferred()&lt;/div&gt;&lt;div&gt;  &nbsp; d.addCallback(packStruct)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; reactor.callLater(0,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d.callback,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anInteger)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; return&nbsp;d&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;bin2intAsync(aBin):   &lt;/div&gt;&lt;div&gt;  &nbsp; def&nbsp;unpackStruct(p):&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; #Unpacks&nbsp;a&nbsp;bytestring&nbsp;into&nbsp;an&nbsp;integer&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; return&nbsp;struct.unpack(&quot;i&quot;,&nbsp;p)[0]&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; d&nbsp;=&nbsp;defer.Deferred()&lt;/div&gt;&lt;div&gt;  &nbsp; d.addCallback(unpackStruct)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; reactor.callLater(0,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d.callback,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aBin)&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; return&nbsp;d&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;int2binSync(anInteger):&lt;/div&gt;&lt;div&gt;  &nbsp; #Packs&nbsp;an&nbsp;integer,&nbsp;result&nbsp;is&nbsp;4&nbsp;bytes&lt;/div&gt;&lt;div&gt;  &nbsp; return&nbsp;struct.pack(&quot;i&quot;,&nbsp;anInteger)&nbsp; &nbsp; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;bin2intSync(aBin):&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; #Unpacks&nbsp;a&nbsp;bytestring&nbsp;into&nbsp;an&nbsp;integer&lt;/div&gt;&lt;div&gt;  &nbsp; return&nbsp;struct.unpack(&quot;i&quot;,&nbsp;aBin)[0]&nbsp; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;While&nbsp;running&nbsp;the&nbsp;testcode&nbsp;I&nbsp;got&nbsp;the&nbsp;following&nbsp;results:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;(1&nbsp;run&nbsp;=&nbsp;converting&nbsp;an&nbsp;integer&nbsp;to&nbsp;a&nbsp;byte&nbsp;string,&nbsp;converting&nbsp;that&nbsp;byte&nbsp;string&nbsp;back&nbsp;to&nbsp;an&nbsp;integer,&nbsp;and&nbsp;finally&nbsp;checking&nbsp;whether&nbsp;that&nbsp;last&nbsp;integer&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;input&nbsp;integer.)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;***&nbsp;Starting&nbsp;Synchronous&nbsp;Benchmarks.&nbsp;&lt;b&gt;(No&nbsp;Twisted&nbsp;=&gt;&nbsp;&quot;blocking&quot;&nbsp;code)&lt;/b&gt;&lt;/div&gt;&lt;div&gt;  -&gt;&nbsp;Synchronous&nbsp;Benchmark&nbsp;(1&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;0.0&nbsp;seconds.&lt;/div&gt;&lt;div&gt;  -&gt;&nbsp;Synchronous&nbsp;Benchmark&nbsp;(10&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;0.0&nbsp;seconds.&lt;/div&gt;<br>
&lt;div&gt;  -&gt;&nbsp;Synchronous&nbsp;Benchmark&nbsp;(100&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;0.0&nbsp;seconds.&lt;/div&gt;&lt;div&gt;  -&gt;&nbsp;Synchronous&nbsp;Benchmark&nbsp;(1000&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;0.00399994850159&nbsp;seconds.&lt;/div&gt;&lt;div&gt;  -&gt;&nbsp;Synchronous&nbsp;Benchmark&nbsp;(10000&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;0.0369999408722&nbsp;seconds.&lt;/div&gt;<br>
&lt;div&gt;  -&gt;&nbsp;Synchronous&nbsp;Benchmark&nbsp;(100000&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;0.362999916077&nbsp;seconds.&lt;/div&gt;&lt;div&gt;***&nbsp;Synchronous&nbsp;Benchmarks&nbsp;Completed&nbsp;in&lt;b&gt;&nbsp;0.406000137329&lt;/b&gt;&nbsp;seconds.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;***&nbsp;Starting&nbsp;Asynchronous&nbsp;Benchmarks&nbsp;. &lt;b&gt;(Twisted&nbsp;=&gt;&nbsp;&quot;non-blocking&quot;&nbsp;code)&lt;/b&gt;&lt;/div&gt;<br>
&lt;div&gt;  -&gt;&nbsp;Asynchronous&nbsp;Benchmark&nbsp;(1&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;34.5090000629&nbsp;seconds.&lt;/div&gt;&lt;div&gt;  -&gt;&nbsp;Asynchronous&nbsp;Benchmark&nbsp;(10&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;34.5099999905&nbsp;seconds.&lt;/div&gt;&lt;div&gt;  -&gt;&nbsp;Asynchronous&nbsp;Benchmark&nbsp;(100&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;34.5130000114&nbsp;seconds.&lt;/div&gt;<br>
&lt;div&gt;  -&gt;&nbsp;Asynchronous&nbsp;Benchmark&nbsp;(1000&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;34.5859999657&nbsp;seconds.&lt;/div&gt;&lt;div&gt;  -&gt;&nbsp;Asynchronous&nbsp;Benchmark&nbsp;(10000&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;35.2829999924&nbsp;seconds.&lt;/div&gt;&lt;div&gt;  -&gt;&nbsp;Asynchronous&nbsp;Benchmark&nbsp;(100000&nbsp;runs)&nbsp;Completed&nbsp;in&nbsp;41.492000103&nbsp;seconds.&lt;/div&gt;<br>
&lt;div&gt;***&nbsp;Asynchronous&nbsp;Benchmarks&nbsp;Completed&nbsp;in&nbsp;&lt;b&gt;42.1460001469&lt;/b&gt;&nbsp;seconds.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Am&nbsp;I&nbsp;really&nbsp;seeing&nbsp;factor&nbsp;100x??&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;really&nbsp;hope&nbsp;that&nbsp;I&nbsp;made&nbsp;a&nbsp;huge&nbsp;reasoning&nbsp;error&nbsp;here&nbsp;but&nbsp;I&nbsp;just&nbsp;can&#39;t&nbsp;find&nbsp;it.&nbsp;If&nbsp;my&nbsp;results&nbsp;are&nbsp;correct&nbsp;then&nbsp;I&nbsp;really&nbsp;need&nbsp;to&nbsp;go&nbsp;and&nbsp;check&nbsp;my&nbsp;entire&nbsp;cloud&nbsp;platform&nbsp;for&nbsp;the&nbsp;places&nbsp;where&nbsp;I&nbsp;decided&nbsp;to&nbsp;split&nbsp;functions&nbsp;into&nbsp;atomic&nbsp;operations&nbsp;while&nbsp;thinking&nbsp;that&nbsp;it&nbsp;would&nbsp;actually&nbsp;improve&nbsp;the&nbsp;performance&nbsp;while&nbsp;on&nbsp;the&nbsp;contrary&nbsp;it&nbsp;did&nbsp;the&nbsp;opposit.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;personaly&nbsp;suspect&nbsp;that&nbsp;I&nbsp;lose&nbsp;my&nbsp;cpu-cycles&nbsp;to&nbsp;the&nbsp;reactor&nbsp;scheduling&nbsp;the&nbsp;deferred-callbacks.&nbsp;Would&nbsp;that&nbsp;assumption&nbsp;make&nbsp;any&nbsp;sense?&lt;/div&gt;&lt;div&gt;The&nbsp;part&nbsp;where&nbsp;I&nbsp;need&nbsp;these&nbsp;conversion&nbsp;functions&nbsp;is&nbsp;in&nbsp;marshalling/protocol&nbsp;reading&nbsp;and&nbsp;writing&nbsp;throughout&nbsp;the&nbsp;cloud&nbsp;platform,&nbsp;which&nbsp;implies&nbsp;that&nbsp;these&nbsp;functions&nbsp;will&nbsp;be&nbsp;called&nbsp;constantly&nbsp;so&nbsp;I&nbsp;need&nbsp;them&nbsp;to&nbsp;be&nbsp;superfast.&nbsp;I&nbsp;always&nbsp;though&nbsp;I&nbsp;had&nbsp;to&nbsp;split&nbsp;the&nbsp;entire&nbsp;marshalling&nbsp;process&nbsp;into&nbsp;small&nbsp;atomic&nbsp;(deferred-callback)&nbsp;functions&nbsp;to&nbsp;be&nbsp;efficient,&nbsp;but&nbsp;these&nbsp;figures&nbsp;tell&nbsp;me&nbsp;otherwise.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;really&nbsp;hope&nbsp;someone&nbsp;can&nbsp;help&nbsp;me&nbsp;out&nbsp;here.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance,&lt;/div&gt;&lt;div&gt;Best&nbsp;regards,&lt;/div&gt;&lt;div&gt;Dirk&nbsp;Moors&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
