<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Tom,&lt;br&gt;&lt;br&gt;I&nbsp;guess&nbsp;LineReceiver&nbsp;can&nbsp;help&nbsp;you&nbsp;with&nbsp;that,&nbsp;it&#39;s&nbsp;a&nbsp;matter&nbsp;of&nbsp;using&nbsp;a&nbsp;different&nbsp;delimiter.&nbsp;Here&nbsp;is&nbsp;a&nbsp;rough&nbsp;sketch&nbsp;of&nbsp;something&nbsp;you&nbsp;can&nbsp;start&nbsp;exploring:&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;from&nbsp;__future__&nbsp;import&nbsp;print_function&lt;br&gt;&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor,&nbsp;protocol,&nbsp;endpoints,&nbsp;defer&lt;br&gt;from&nbsp;twisted.protocols&nbsp;import&nbsp;basic&lt;br&gt;&lt;br&gt;&lt;br&gt;class&nbsp;PostfixProtocol(basic.LineReceiver):&lt;br&gt;&lt;br&gt; &nbsp; &nbsp;#&nbsp;Assuming&nbsp;Postfix&nbsp;sends&nbsp;&#39;\r\n&#39;&nbsp;line&nbsp;breaks&nbsp;(does&nbsp;it?)&lt;br&gt; &nbsp; &nbsp;delimiter&nbsp;=&nbsp;&#39;\r\n\r\n&#39;&lt;br&gt;&lt;br&gt; &nbsp; &nbsp;def&nbsp;lineReceived(self,&nbsp;multi_line):&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;input_dict&nbsp;=&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;k:&nbsp;v&nbsp;for&nbsp;k,&nbsp;v&nbsp;in&nbsp;(&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line.split(&#39;=&#39;)&nbsp;for&nbsp;line&nbsp;in&nbsp;multi_line.split(&#39;\r\n&#39;)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.gotPostfixRequest(input_dict)&lt;br&gt;&lt;br&gt; &nbsp; &nbsp;def&nbsp;gotPostfixRequest(self,&nbsp;request_dict):&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;Silly&nbsp;deferred-based&nbsp;implementation.&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;d&nbsp;=&nbsp;defer.Deferred()&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;d.addCallback(self.sendPostfixAction)&lt;/span&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;Simulate&nbsp;a&nbsp;deferred&nbsp;being&nbsp;fired&nbsp;with&nbsp;success.&lt;br&gt;&lt;/span&gt; &nbsp; &nbsp; &nbsp; &nbsp;reactor.callLater(1,&nbsp;d.callback,&nbsp;&#39;OK&#39;)&lt;br&gt;&lt;br&gt; &nbsp; &nbsp;def&nbsp;sendPostfixAction(self,&nbsp;response):&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;NOTE:&nbsp;Sends&nbsp;self.delimiter&nbsp;after&nbsp;the&nbsp;payload.&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; &nbsp; &nbsp; &nbsp;Use&nbsp;self.tranport.write&nbsp;if&nbsp;you&nbsp;don&#39;t&nbsp;want&nbsp;it.&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.sendLine(&#39;action={}&#39;.format(response))&lt;br&gt;&lt;br&gt;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;&#39;__main__&#39;:&lt;br&gt;&lt;br&gt; &nbsp; &nbsp;ep&nbsp;=&nbsp;endpoints.serverFromString(reactor,&nbsp;&#39;tcp:10000&#39;)&lt;br&gt; &nbsp; &nbsp;f&nbsp;=&nbsp;protocol.Factory()&lt;br&gt; &nbsp; &nbsp;f.protocol&nbsp;=&nbsp;PostfixProtocol&lt;br&gt; &nbsp; &nbsp;ep.listen(f)&lt;br&gt; &nbsp; &nbsp;reactor.run()&lt;br&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;Key&nbsp;ideas:&lt;br&gt;-&nbsp;PostfixProtocol&nbsp;overrides&nbsp;LineReceiver&#39;s&nbsp;delimiter&nbsp;(setting&nbsp;it&nbsp;to&nbsp;&#39;\r\n\r\n&#39;)&lt;br&gt;&lt;/div&gt;-&nbsp;lineReceived&nbsp;parses&nbsp;the&nbsp;muti_line&nbsp;and&nbsp;calls&nbsp;gotPostfixRequest.&lt;br&gt;&lt;/div&gt;-&nbsp;gotPostfixRequest&nbsp;should&nbsp;decide&nbsp;(or&nbsp;delegate,&nbsp;you&nbsp;choice)&nbsp;what&nbsp;kind&nbsp;of&nbsp;response&nbsp;to&nbsp;send&nbsp;back.&lt;br&gt;&lt;/div&gt;-&nbsp;sendPostfixAction&nbsp;sends&nbsp;a&nbsp;response&nbsp;back&nbsp;to&nbsp;Postfix.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Notes:&lt;br&gt;&lt;/div&gt;-&nbsp;The&nbsp;multi_line&nbsp;parsing&nbsp;code&nbsp;is&nbsp;short(ish)&nbsp;but&nbsp;not&nbsp;very&nbsp;robust.&nbsp;It&nbsp;may&nbsp;fail&nbsp;in&nbsp;bad&nbsp;ways&nbsp;with&nbsp;invalid&nbsp;input.&lt;br&gt;&lt;/div&gt;-&nbsp;The&nbsp;gotPostfixRequest&nbsp;implementation&nbsp;is&nbsp;written&nbsp;for&nbsp;the&nbsp;sake&nbsp;of&nbsp;a&nbsp;deferred-based&nbsp;example.&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Does&nbsp;this&nbsp;help&nbsp;you&nbsp;in&nbsp;any&nbsp;way?&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;br&gt;--&lt;br&gt;&lt;/div&gt;&lt;div&gt;exvito&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;On&nbsp;Tue,&nbsp;Nov&nbsp;17,&nbsp;2015&nbsp;at&nbsp;4:56&nbsp;PM,&nbsp;Tom&nbsp;Boland&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:tom@t0mb.net&quot;&gt;tom@t0mb.net&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&gt;&nbsp;Greetings&nbsp;all.&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;This&nbsp;may&nbsp;be&nbsp;a&nbsp;very&nbsp;basic&nbsp;question. &nbsp;I&#39;m&nbsp;hoping&nbsp;to&nbsp;implement&nbsp;a&nbsp;postfix&lt;br&gt;&gt;&nbsp;policy&nbsp;check&nbsp;client&nbsp;in&nbsp;twisted. &nbsp;It&#39;s&nbsp;a&nbsp;simple&nbsp;protocol. &nbsp;You&nbsp;send&lt;br&gt;&gt;&nbsp;newline&nbsp;separated&nbsp;key&nbsp;value&nbsp;pairs&nbsp;like:&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;recipient=email@ddr.ess&lt;br&gt;&gt;&nbsp;sender=another@ddr.ess&lt;br&gt;&gt;&nbsp;size=1024&lt;br&gt;&gt;&nbsp;helo_name=mail.server&lt;br&gt;&gt;&nbsp;etc..&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;you&nbsp;terminate&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;additional&nbsp;newline. &nbsp;The&nbsp;response&lt;br&gt;&gt;&nbsp;comes&nbsp;back&nbsp;like&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;action=OK&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;You&nbsp;can&nbsp;send&nbsp;mutliple&nbsp;requests&nbsp;in&nbsp;the&nbsp;same&nbsp;connection. &nbsp;What&nbsp;I&#39;m&lt;br&gt;&gt;&nbsp;envisaging&nbsp;is&nbsp;a&nbsp;module&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;provide&nbsp;a&nbsp;deferred&lt;br&gt;&gt;&nbsp;request/response&nbsp;pairing&nbsp;to&nbsp;my&nbsp;calling&nbsp;application. &nbsp;The&nbsp;module&nbsp;class&lt;br&gt;&gt;&nbsp;will&nbsp;manage&nbsp;the&nbsp;single&nbsp;connection&nbsp;to&nbsp;the&nbsp;postfix&nbsp;policy&nbsp;daemon&nbsp;(I&#39;m&lt;br&gt;&gt;&nbsp;actually&nbsp;going&nbsp;to&nbsp;have&nbsp;persistent&nbsp;connections&nbsp;to&nbsp;a&nbsp;few&nbsp;daemons),&nbsp;and&lt;br&gt;&gt;&nbsp;reconnect&nbsp;when&nbsp;necessary&nbsp;etc. &nbsp;Any&nbsp;requests&nbsp;will&nbsp;return&nbsp;a&nbsp;deferred&nbsp;that&lt;br&gt;&gt;&nbsp;I&nbsp;can&nbsp;add&nbsp;callbacks&nbsp;to. &nbsp;How&nbsp;would&nbsp;you&nbsp;design&nbsp;this&nbsp;with&nbsp;twisted? &nbsp;I&nbsp;can&lt;br&gt;&gt;&nbsp;easily&nbsp;envisage&nbsp;a&nbsp;way&nbsp;of&nbsp;using&nbsp;a&nbsp;clientfactory&nbsp;to&nbsp;instantiate&nbsp;separate&lt;br&gt;&gt;&nbsp;connections&nbsp;for&nbsp;each&nbsp;request/response,&nbsp;but&nbsp;actually&nbsp;being&nbsp;able&nbsp;to&nbsp;simply&lt;br&gt;&gt;&nbsp;send&nbsp;a&nbsp;request&nbsp;and&nbsp;receive&nbsp;the&nbsp;single&nbsp;response&nbsp;for&nbsp;that&nbsp;request&nbsp;is&lt;br&gt;&gt;&nbsp;something&nbsp;I&#39;m&nbsp;struggling&nbsp;to&nbsp;do&nbsp;within&nbsp;a&nbsp;LineReceiver&nbsp;instance&nbsp;(for&lt;br&gt;&gt;&nbsp;instance). &nbsp;Would&nbsp;the&nbsp;twisted.protocols.amp&nbsp;module&nbsp;help&nbsp;given&nbsp;that&nbsp;I&lt;br&gt;&gt;&nbsp;can&#39;t&nbsp;change&nbsp;the&nbsp;server-side&nbsp;protocol?&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;Any&nbsp;advice&nbsp;much&nbsp;appreciated!&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;Thanks. &nbsp;Tom.&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;&gt;&nbsp;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;--&nbsp;&lt;br&gt;--&lt;br&gt; &nbsp;exvito&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
