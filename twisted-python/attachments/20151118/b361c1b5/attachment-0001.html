<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Nov&nbsp;13,&nbsp;2015,&nbsp;at&nbsp;4:36&nbsp;AM,&nbsp;Cory&nbsp;Benfield&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:cory@lukasa.co.uk&quot;&nbsp;class=&quot;&quot;&gt;cory@lukasa.co.uk&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Folks,&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;#&nbsp;Problem&nbsp;Statement&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Thanks&nbsp;for&nbsp;your&nbsp;feedback&nbsp;on&nbsp;my&nbsp;HTTP/2&nbsp;questions.&nbsp;I’ve&nbsp;started&nbsp;work&nbsp;implementing&nbsp;a&nbsp;spike&nbsp;of&nbsp;a&nbsp;HTTP/2&nbsp;protocol&nbsp;for&nbsp;twisted.web.&nbsp;I’m&nbsp;aiming&nbsp;to&nbsp;have&nbsp;something&nbsp;that&nbsp;works&nbsp;in&nbsp;at&nbsp;least&nbsp;some&nbsp;cases&nbsp;by&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;day.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Hooray!&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;As&nbsp;part&nbsp;of&nbsp;my&nbsp;dive&nbsp;into&nbsp;twisted.web,&nbsp;I&nbsp;noticed&nbsp;something&nbsp;that&nbsp;surprised&nbsp;me:&nbsp;it&nbsp;seems&nbsp;to&nbsp;have&nbsp;no&nbsp;support&nbsp;for&nbsp;‘streaming’&nbsp;request&nbsp;bodies.&nbsp;By&nbsp;this&nbsp;I&nbsp;mean&nbsp;that&nbsp;the&nbsp;Request.requestReceived()&nbsp;method&nbsp;is&nbsp;not&nbsp;actually&nbsp;called&nbsp;until&nbsp;the&nbsp;complete&nbsp;request&nbsp;body&nbsp;has&nbsp;been&nbsp;received.&nbsp;This&nbsp;is&nbsp;a&nbsp;somewhat&nbsp;unexpected&nbsp;limitation&nbsp;for&nbsp;Twisted:&nbsp;why&nbsp;should&nbsp;I&nbsp;have&nbsp;to&nbsp;wait&nbsp;until&nbsp;the&nbsp;entire&nbsp;body&nbsp;has&nbsp;been&nbsp;uploaded&nbsp;to&nbsp;start&nbsp;doing&nbsp;things&nbsp;with&nbsp;it?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;exactly&nbsp;what&nbsp;&lt;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/trac/ticket/288&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/trac/ticket/288&lt;/a&gt;&gt;&nbsp;is&nbsp;about&nbsp;(as&nbsp;you&nbsp;note).&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;This&nbsp;problem&nbsp;is&nbsp;thrown&nbsp;into&nbsp;sharp&nbsp;relief&nbsp;with&nbsp;HTTP/2,&nbsp;which&nbsp;essentially&nbsp;always&nbsp;chunks&nbsp;the&nbsp;body,&nbsp;even&nbsp;if&nbsp;a&nbsp;content-length&nbsp;is&nbsp;provided.&nbsp;This&nbsp;means&nbsp;that&nbsp;it&nbsp;is&nbsp;now&nbsp;very&nbsp;easy&nbsp;to&nbsp;receive&nbsp;data&nbsp;in&nbsp;delimited&nbsp;chunks,&nbsp;which&nbsp;an&nbsp;implementation&nbsp;may&nbsp;want&nbsp;to&nbsp;have&nbsp;semantic&nbsp;meaning.&nbsp;However,&nbsp;the&nbsp;request&nbsp;is&nbsp;unable&nbsp;to&nbsp;access&nbsp;this&nbsp;data&nbsp;in&nbsp;this&nbsp;way.&nbsp;It&nbsp;also&nbsp;makes&nbsp;it&nbsp;impossible&nbsp;to&nbsp;use&nbsp;a&nbsp;HTTP/2&nbsp;request/response&nbsp;pair&nbsp;as&nbsp;a&nbsp;long-running&nbsp;communication&nbsp;channel,&nbsp;as&nbsp;we&nbsp;cannot&nbsp;safely&nbsp;call&nbsp;requestReceived&nbsp;until&nbsp;the&nbsp;response&nbsp;is&nbsp;terminated&nbsp;(which&nbsp;also&nbsp;terminates&nbsp;the&nbsp;HTTP/2&nbsp;stream).&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Adi&nbsp;pointed&nbsp;me&nbsp;at&nbsp;a&nbsp;related&nbsp;issue,&nbsp;#6928[0],&nbsp;which&nbsp;itself&nbsp;points&nbsp;at&nbsp;what&nbsp;appears&nbsp;to&nbsp;be&nbsp;an&nbsp;issue&nbsp;tracking&nbsp;exactly&nbsp;this&nbsp;request.&nbsp;That&nbsp;issue&nbsp;is&nbsp;issue&nbsp;#288[1],&nbsp;which&nbsp;is&nbsp;12&nbsp;years&nbsp;old(!).&nbsp;This&nbsp;has&nbsp;clearly&nbsp;been&nbsp;a&nbsp;pain&nbsp;point&nbsp;for&nbsp;quite&nbsp;some&nbsp;time.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Issue&nbsp;#6928&nbsp;has&nbsp;glyph&nbsp;suggesting&nbsp;that&nbsp;we&nbsp;come&nbsp;to&nbsp;the&nbsp;mailing&nbsp;list&nbsp;to&nbsp;discuss&nbsp;this,&nbsp;but&nbsp;the&nbsp;last&nbsp;time&nbsp;it&nbsp;was&nbsp;raised&nbsp;no&nbsp;responses&nbsp;were&nbsp;received[2].&nbsp;I&nbsp;believe&nbsp;that&nbsp;with&nbsp;HTTP/2&nbsp;on&nbsp;the&nbsp;horizon,&nbsp;this&nbsp;issue&nbsp;is&nbsp;more&nbsp;acute&nbsp;than&nbsp;it&nbsp;was&nbsp;before,&nbsp;and&nbsp;needs&nbsp;solving&nbsp;if&nbsp;Twisted&nbsp;is&nbsp;going&nbsp;to&nbsp;continue&nbsp;to&nbsp;remain&nbsp;relevant&nbsp;for&nbsp;the&nbsp;web.&nbsp;It&nbsp;should&nbsp;also&nbsp;allow&nbsp;people&nbsp;to&nbsp;build&nbsp;more&nbsp;performant&nbsp;web&nbsp;applications,&nbsp;as&nbsp;they&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;handle&nbsp;how&nbsp;the&nbsp;data&nbsp;queues&nbsp;up&nbsp;in&nbsp;their&nbsp;apps.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;This&nbsp;does&nbsp;not&nbsp;immediately&nbsp;block&nbsp;my&nbsp;HTTP/2&nbsp;work,&nbsp;so&nbsp;we&nbsp;can&nbsp;take&nbsp;some&nbsp;time&nbsp;and&nbsp;get&nbsp;this&nbsp;right.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;very&nbsp;glad&nbsp;to&nbsp;hear&nbsp;you&nbsp;say&nbsp;this,&nbsp;because:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;(A)&nbsp;we&nbsp;should&nbsp;absolutely&nbsp;make&nbsp;progress&nbsp;on&nbsp;this&nbsp;ticket&nbsp;now&nbsp;that&nbsp;there&nbsp;is&nbsp;some&nbsp;impetus&nbsp;to&nbsp;do&nbsp;so,&nbsp;but,&lt;/div&gt;&lt;div&gt;(B)&nbsp;we&nbsp;should&nbsp;absolutely&nbsp;NOT&nbsp;let&nbsp;this&nbsp;new&nbsp;API&nbsp;block&nbsp;any&nbsp;purely&nbsp;protocol-level&nbsp;HTTP2&nbsp;work&nbsp;that&nbsp;needs&nbsp;to&nbsp;proceed&nbsp;(I&nbsp;say&nbsp;&quot;protocol&nbsp;level&quot;&nbsp;as&nbsp;a&nbsp;contrast&nbsp;to&nbsp;&quot;feature&nbsp;level&quot;&nbsp;because&nbsp;we&nbsp;could&nbsp;totally&nbsp;implement&nbsp;a&nbsp;thing&nbsp;that&nbsp;speaks&nbsp;HTTP&nbsp;2&nbsp;against&nbsp;the&nbsp;current&nbsp;API,&nbsp;although&nbsp;it&nbsp;might&nbsp;be&nbsp;awkward&nbsp;to&nbsp;expose&nbsp;the&nbsp;advantageous&nbsp;parts&nbsp;of&nbsp;the&nbsp;protocol&nbsp;as&nbsp;API&nbsp;features&nbsp;until&nbsp;we&nbsp;do&nbsp;some&nbsp;cleanup)&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;#&nbsp;Proposed&nbsp;Solution&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;To&nbsp;help&nbsp;us&nbsp;move&nbsp;forward,&nbsp;I’m&nbsp;providing&nbsp;a&nbsp;proposal&nbsp;for&nbsp;how&nbsp;I’d&nbsp;solve&nbsp;this&nbsp;problem.&nbsp;This&nbsp;is&nbsp;not&nbsp;necessarily&nbsp;going&nbsp;to&nbsp;be&nbsp;the&nbsp;final&nbsp;approach,&nbsp;but&nbsp;is&nbsp;instead&nbsp;a&nbsp;straw-man&nbsp;we&nbsp;can&nbsp;use&nbsp;to&nbsp;form&nbsp;the&nbsp;basis&nbsp;of&nbsp;a&nbsp;discussion&nbsp;about&nbsp;what&nbsp;the&nbsp;correct&nbsp;fix&nbsp;should&nbsp;be.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;My&nbsp;proposal&nbsp;is&nbsp;to&nbsp;deprecate&nbsp;the&nbsp;current&nbsp;Request/Resource&nbsp;model.&nbsp;It&nbsp;currently&nbsp;functions&nbsp;and&nbsp;should&nbsp;continue&nbsp;to&nbsp;function,&nbsp;but&nbsp;as&nbsp;of&nbsp;this&nbsp;point&nbsp;we&nbsp;should&nbsp;consider&nbsp;it&nbsp;a&nbsp;bad&nbsp;way&nbsp;to&nbsp;do&nbsp;things,&nbsp;and&nbsp;we&nbsp;should&nbsp;push&nbsp;people&nbsp;to&nbsp;move&nbsp;to&nbsp;a&nbsp;fully&nbsp;asynchronous&nbsp;model.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;considered&nbsp;it&nbsp;a&nbsp;bad&nbsp;way&nbsp;to&nbsp;do&nbsp;things&nbsp;for&nbsp;a&nbsp;long&nbsp;time.&nbsp;&nbsp;There&nbsp;have&nbsp;been&nbsp;several&nbsp;attempts&nbsp;to&nbsp;rewrite&nbsp;it&nbsp;(Nevow's&nbsp;request&nbsp;model,&nbsp;web2)&nbsp;but&nbsp;none&nbsp;of&nbsp;them&nbsp;have&nbsp;really&nbsp;been&nbsp;the&nbsp;comprehensive&nbsp;re-design&nbsp;we&nbsp;need.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;We&nbsp;should&nbsp;then&nbsp;move&nbsp;to&nbsp;an&nbsp;API&nbsp;that&nbsp;is&nbsp;much&nbsp;more&nbsp;like&nbsp;the&nbsp;one&nbsp;used&nbsp;by&nbsp;Go:&nbsp;specifically,&nbsp;that&nbsp;by&nbsp;default&nbsp;all&nbsp;requests/responses&nbsp;are&nbsp;streamed.&nbsp;Request&nbsp;objects&nbsp;(and,&nbsp;logically,&nbsp;any&nbsp;other&nbsp;object&nbsp;that&nbsp;handles&nbsp;requests/responses,&nbsp;such&nbsp;as&nbsp;Resource)&nbsp;should&nbsp;be&nbsp;extended&nbsp;to&nbsp;have&nbsp;a&nbsp;chunkReceived&nbsp;method&nbsp;that&nbsp;can&nbsp;be&nbsp;overridden&nbsp;by&nbsp;users.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;No.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Let&nbsp;me&nbsp;elaborate&nbsp;:-).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;First&nbsp;of&nbsp;all,&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;this&nbsp;is&nbsp;already&nbsp;the&nbsp;case&lt;/i&gt;&nbsp;(sort&nbsp;of).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;twisted.web.server.Request&nbsp;inherits&nbsp;from&nbsp;twisted.web.http.Request;&nbsp;as&nbsp;you&nbsp;can&nbsp;see&nbsp;in&nbsp;http.Request,&nbsp;there&nbsp;is&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;already&lt;/i&gt;&nbsp;a&nbsp;method&nbsp;called&nbsp;handleContentChunk,&nbsp;which&nbsp;is&nbsp;called&nbsp;by&nbsp;HTTPChannel.&nbsp;By&nbsp;overriding&nbsp;this&nbsp;method,&nbsp;you&nbsp;can&nbsp;already&nbsp;handle&nbsp;request&nbsp;data&nbsp;streaming&nbsp;in&nbsp;from&nbsp;off&nbsp;the&nbsp;wire.&nbsp;&nbsp;This&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;reasons&nbsp;that&nbsp;#288&nbsp;is&nbsp;so&nbsp;interminable:&nbsp;using&nbsp;Twisted's&nbsp;public&nbsp;API,&nbsp;today,&nbsp;you&nbsp;can&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;totally&lt;/i&gt;&nbsp;write&nbsp;an&nbsp;HTTP-based&nbsp;application&nbsp;that&nbsp;happily&nbsp;streams&nbsp;data&nbsp;from&nbsp;the&nbsp;wire.&nbsp;&nbsp;The&nbsp;only&nbsp;problem&nbsp;is&nbsp;that&nbsp;this&nbsp;API&nbsp;does&nbsp;not&nbsp;propagate&nbsp;up&nbsp;to&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;Resource&lt;/i&gt;&nbsp;objects,&nbsp;because&nbsp;Resource&nbsp;objects&nbsp;can&nbsp;expect&nbsp;the&nbsp;(still,&nbsp;as&nbsp;of&nbsp;this&nbsp;writing,&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;undocumented&lt;/i&gt;)&nbsp;&quot;content&quot;&nbsp;attribute&nbsp;to&nbsp;have&nbsp;been&nbsp;filled&nbsp;out&nbsp;in&nbsp;getChild.&nbsp;&nbsp;Mostly,&nbsp;they&nbsp;don't,&nbsp;actually!&nbsp;&nbsp;But&nbsp;it's&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;if&nbsp;they&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;might&lt;/i&gt;&nbsp;in&nbsp;the&nbsp;general&nbsp;case.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;can&nbsp;(and&nbsp;many&nbsp;applications&nbsp;have)&nbsp;just&nbsp;broken&nbsp;the&nbsp;technical&nbsp;compatibility&nbsp;contract&nbsp;with&nbsp;Resource,&nbsp;and&nbsp;written&nbsp;a&nbsp;subclass&nbsp;of&nbsp;twisted.web.server.Site&nbsp;that&nbsp;has&nbsp;a&nbsp;custom&nbsp;requestFactory&nbsp;method&nbsp;that&nbsp;returns&nbsp;a&nbsp;'streamed'&nbsp;resource.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;if&nbsp;we're&nbsp;already&nbsp;doing&nbsp;this,&nbsp;why&nbsp;&quot;no&quot;?&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Superclasses&nbsp;with&nbsp;overridable&nbsp;methods&nbsp;are&nbsp;a&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;terrible&lt;/i&gt;&nbsp;mechanism&nbsp;for&nbsp;exposing&nbsp;extensibility.&nbsp;&nbsp;These&nbsp;are&nbsp;used&nbsp;extensively&nbsp;throughout&nbsp;Twisted,&nbsp;the&nbsp;older&nbsp;the&nbsp;API&nbsp;the&nbsp;more&nbsp;inheritance&nbsp;it&nbsp;uses.&nbsp;&nbsp;Newer&nbsp;code,&nbsp;you&nbsp;may&nbsp;notice,&nbsp;is&nbsp;generally&nbsp;written&nbsp;much&nbsp;more&nbsp;in&nbsp;a&nbsp;pattern&nbsp;of&nbsp;delegation&nbsp;to&nbsp;formal&nbsp;interfaces.&nbsp;&nbsp;So&nbsp;we&nbsp;have&nbsp;tried&nbsp;to&nbsp;learn&nbsp;our&nbsp;lesson&nbsp;here.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;If&nbsp;a&nbsp;user&nbsp;chooses&nbsp;not&nbsp;to&nbsp;override&nbsp;that&nbsp;method,&nbsp;the&nbsp;default&nbsp;implementation&nbsp;would&nbsp;continue&nbsp;to&nbsp;do&nbsp;what&nbsp;is&nbsp;done&nbsp;now&nbsp;(save&nbsp;to&nbsp;a&nbsp;buffer).&nbsp;Once&nbsp;the&nbsp;request/response&nbsp;is&nbsp;complete&nbsp;(marked&nbsp;by&nbsp;receipt&nbsp;of&nbsp;a&nbsp;zero-length&nbsp;chunk,&nbsp;or&nbsp;a&nbsp;frame&nbsp;with&nbsp;END_STREAM&nbsp;set,&nbsp;or&nbsp;when&nbsp;the&nbsp;remaining&nbsp;content-length&nbsp;is&nbsp;0),&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;what&nbsp;it's&nbsp;worth,&nbsp;I&nbsp;hope&nbsp;that&nbsp;all&nbsp;of&nbsp;these&nbsp;will&nbsp;be&nbsp;exposed&nbsp;as&nbsp;the&nbsp;same&nbsp;event&nbsp;to&nbsp;applications,&nbsp;since&nbsp;the&nbsp;fact&nbsp;that&nbsp;these&nbsp;differ&nbsp;on&nbsp;the&nbsp;wire&nbsp;is&nbsp;entirely&nbsp;an&nbsp;implementation&nbsp;detail?&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;request/responseComplete&nbsp;would&nbsp;be&nbsp;called.&nbsp;For&nbsp;users&nbsp;that&nbsp;did&nbsp;not&nbsp;override&nbsp;chunkReceived&nbsp;can&nbsp;now&nbsp;safely&nbsp;access&nbsp;the&nbsp;content&nbsp;buffer:&nbsp;other&nbsp;users&nbsp;can&nbsp;do&nbsp;whatever&nbsp;they&nbsp;see&nbsp;fit.&nbsp;We’d&nbsp;also&nbsp;update&nbsp;requestReceived&nbsp;to&nbsp;ensure&nbsp;that&nbsp;it’s&nbsp;called&nbsp;when&nbsp;all&nbsp;the&nbsp;*headers*&nbsp;are&nbsp;received,&nbsp;rather&nbsp;than&nbsp;waiting&nbsp;for&nbsp;the&nbsp;body.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Again,&nbsp;this&nbsp;is&nbsp;very&nbsp;similar&nbsp;to&nbsp;what&nbsp;already&nbsp;happens,&nbsp;at&nbsp;the&nbsp;layer&nbsp;of&nbsp;the&nbsp;HTTP&nbsp;protocol.&nbsp;&nbsp;The&nbsp;question&nbsp;is,&nbsp;how&nbsp;do&nbsp;you&nbsp;indicate&nbsp;that&nbsp;you're&nbsp;delegating&nbsp;to&nbsp;a&nbsp;Resource&nbsp;object&nbsp;which&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;may&nbsp;expect&nbsp;the&nbsp;.content&nbsp;attribute&nbsp;to&nbsp;already&nbsp;be&nbsp;populated&nbsp;during&nbsp;.getChild&lt;/i&gt;?&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;A&nbsp;similar&nbsp;approach&nbsp;should&nbsp;be&nbsp;taken&nbsp;with&nbsp;sending&nbsp;data:&nbsp;we&nbsp;should&nbsp;assume&nbsp;that&nbsp;users&nbsp;want&nbsp;to&nbsp;chunk&nbsp;it&nbsp;if&nbsp;they&nbsp;do&nbsp;not&nbsp;provide&nbsp;a&nbsp;content-length.&nbsp;An&nbsp;extreme&nbsp;position&nbsp;to&nbsp;take&nbsp;(and&nbsp;I&nbsp;do)&nbsp;is&nbsp;that&nbsp;this&nbsp;should&nbsp;be&nbsp;sufficiently&nbsp;easy&nbsp;that&nbsp;most&nbsp;users&nbsp;actually&nbsp;*accidentally*&nbsp;end&nbsp;up&nbsp;chunking&nbsp;their&nbsp;data:&nbsp;that&nbsp;is,&nbsp;we&nbsp;do&nbsp;not&nbsp;provide&nbsp;special&nbsp;helpers&nbsp;to&nbsp;set&nbsp;content-length,&nbsp;instead&nbsp;just&nbsp;checking&nbsp;whether&nbsp;that’s&nbsp;a&nbsp;header&nbsp;users&nbsp;actually&nbsp;send,&nbsp;and&nbsp;if&nbsp;they&nbsp;don’t&nbsp;we&nbsp;chunk&nbsp;the&nbsp;data.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;request.write()&nbsp;already&nbsp;basically&nbsp;does&nbsp;this,&nbsp;I&nbsp;think?&nbsp;&nbsp;Here,&nbsp;at&nbsp;least,&nbsp;we&nbsp;have&nbsp;lots&nbsp;of&nbsp;opportunity&nbsp;to&nbsp;make&nbsp;the&nbsp;implementation&nbsp;do&nbsp;smarter&nbsp;things&nbsp;(better&nbsp;error&nbsp;checking&nbsp;regarding&nbsp;content-length,&nbsp;for&nbsp;example)&nbsp;without&nbsp;changing&nbsp;the&nbsp;interface&nbsp;at&nbsp;all.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;This&nbsp;logic&nbsp;would&nbsp;make&nbsp;it&nbsp;much&nbsp;easier&nbsp;to&nbsp;work&nbsp;with&nbsp;HTTP/2&nbsp;*and*&nbsp;with&nbsp;WebSockets,&nbsp;requiring&nbsp;substantially&nbsp;less&nbsp;special-case&nbsp;code&nbsp;to&nbsp;handle&nbsp;the&nbsp;WebSocket&nbsp;upgrade&nbsp;(when&nbsp;the&nbsp;headers&nbsp;are&nbsp;complete,&nbsp;we&nbsp;can&nbsp;spot&nbsp;the&nbsp;upgrade&nbsp;easily).&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;What&nbsp;do&nbsp;people&nbsp;think&nbsp;of&nbsp;this&nbsp;approach?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;I&nbsp;think&nbsp;you're&nbsp;roughly&nbsp;on&nbsp;the&nbsp;right&nbsp;track&nbsp;but&nbsp;there&nbsp;are&nbsp;probably&nbsp;some&nbsp;Twisted-level&nbsp;gaps&nbsp;to&nbsp;fill&nbsp;in.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I've&nbsp;already&nbsp;gestured&nbsp;in&nbsp;the&nbsp;direction&nbsp;of&nbsp;Tubes&nbsp;(as&nbsp;have&nbsp;others)&nbsp;and&nbsp;it's&nbsp;something&nbsp;to&nbsp;think&nbsp;about.&nbsp;&nbsp;But&nbsp;before&nbsp;we&nbsp;get&nbsp;to&nbsp;that,&nbsp;let's&nbsp;talk&nbsp;about&nbsp;a&nbsp;much&nbsp;more&nbsp;basic&nbsp;deficiency&nbsp;in&nbsp;the&nbsp;API:&nbsp;although&nbsp;there's&nbsp;an&nbsp;&quot;IRequest&quot;,&nbsp;and&nbsp;an&nbsp;&quot;IResource&quot;,&nbsp;there's&nbsp;no&nbsp;such&nbsp;thing&nbsp;as&nbsp;an&nbsp;&quot;IResponse&quot;.&nbsp;&nbsp;Instead,&nbsp;&quot;IRequest&quot;&nbsp;stands&nbsp;in&nbsp;for&nbsp;both&nbsp;the&nbsp;request&nbsp;and&nbsp;the&nbsp;response,&nbsp;because&nbsp;you&nbsp;write&nbsp;directly&nbsp;to&nbsp;a&nbsp;request&nbsp;(implicitly&nbsp;filling&nbsp;out&nbsp;its&nbsp;response&nbsp;as&nbsp;you&nbsp;do&nbsp;so).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Luckily&nbsp;we&nbsp;have&nbsp;an&nbsp;existing&nbsp;interface&nbsp;that&nbsp;might&nbsp;point&nbsp;the&nbsp;way&nbsp;to&nbsp;a&nbsp;better&nbsp;solution,&nbsp;both&nbsp;for&nbsp;requests&nbsp;and&nbsp;responses:&nbsp;specifically,&nbsp;the&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;client&lt;/i&gt;&nbsp;IResponse:&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/15.4.0/api/twisted.web.iweb.IResponse.html&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/documents/15.4.0/api/twisted.web.iweb.IResponse.html&lt;/a&gt;.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;interface&nbsp;is&nbsp;actually&nbsp;pretty&nbsp;close&nbsp;to&nbsp;what&nbsp;we&nbsp;want&nbsp;for&nbsp;a&nbsp;server&nbsp;IResponse&nbsp;as&nbsp;well.&nbsp;&nbsp;Perhaps&nbsp;even&nbsp;identical.&nbsp;&nbsp;Its&nbsp;static&nbsp;data&nbsp;is&nbsp;all&nbsp;exposed&nbsp;as&nbsp;attributes&nbsp;which&nbsp;can&nbsp;be&nbsp;relatively&nbsp;simply&nbsp;inspected,&nbsp;and&nbsp;the&nbsp;way&nbsp;it&nbsp;delivers&nbsp;a&nbsp;streaming&nbsp;response&nbsp;is&nbsp;that&nbsp;it&nbsp;delivers&nbsp;its&nbsp;body&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;to&lt;/i&gt;&nbsp;an&nbsp;IProtocol&nbsp;implementation&nbsp;(via&nbsp;.deliverBody(aProtocol)).&nbsp;&nbsp;This&nbsp;is&nbsp;not&nbsp;quite&nbsp;as&nbsp;graceful&nbsp;as&nbsp;having&nbsp;a&nbsp;.bodyFount()&nbsp;method&nbsp;that&nbsp;returns&nbsp;an&nbsp;IFount&nbsp;from&nbsp;the&nbsp;tubes&nbsp;package;&nbsp;however,&nbsp;the&nbsp;tubes&nbsp;package&nbsp;is&nbsp;still&nbsp;not&nbsp;exactly&nbsp;mature&nbsp;software,&nbsp;so&nbsp;we&nbsp;may&nbsp;not&nbsp;want&nbsp;to&nbsp;block&nbsp;on&nbsp;depending&nbsp;on&nbsp;it.&nbsp;&nbsp;Importantly&nbsp;though,&nbsp;this&nbsp;delivers&nbsp;all&nbsp;the&nbsp;events&nbsp;you&nbsp;need&nbsp;as&nbsp;a&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;primitive&lt;/i&gt;&nbsp;for&nbsp;interfacing&nbsp;with&nbsp;such&nbsp;a&nbsp;high-level&nbsp;interface;&nbsp;it&nbsp;would&nbsp;definitely&nbsp;be&nbsp;better&nbsp;to&nbsp;add&nbsp;this&nbsp;sort&nbsp;of&nbsp;interface&nbsp;Real&nbsp;Soon&nbsp;Now,&nbsp;because&nbsp;then&nbsp;the&nbsp;tubes&nbsp;package&nbsp;could&nbsp;simply&nbsp;have&nbsp;a&nbsp;method,&nbsp;responseToFount&nbsp;(which&nbsp;it&nbsp;will&nbsp;need&nbsp;anyway&nbsp;to&nbsp;work&nbsp;with&nbsp;Agent)&nbsp;that&nbsp;calls&nbsp;deliverBody&nbsp;internally.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;works&nbsp;as&nbsp;a&nbsp;primitive&nbsp;because&nbsp;you&nbsp;have&nbsp;all&nbsp;the&nbsp;hooks&nbsp;you&nbsp;need&nbsp;for&nbsp;flow-control.&nbsp;&nbsp;This&nbsp;protocol&nbsp;receives,&nbsp;to&nbsp;its&nbsp;'makeConnection'&nbsp;method,&nbsp;an&nbsp;ITransport&nbsp;which&nbsp;can&nbsp;provide&nbsp;the&nbsp;IProducer&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/15.4.0/api/twisted.internet.interfaces.IProducer.html&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/documents/15.4.0/api/twisted.internet.interfaces.IProducer.html&lt;/a&gt;&nbsp;and&nbsp;IConsumer&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/15.4.0/api/twisted.internet.interfaces.IConsumer.html&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/documents/15.4.0/api/twisted.internet.interfaces.IConsumer.html&lt;/a&gt;&nbsp;interfaces&nbsp;for&nbsp;flow-control.&nbsp;&nbsp;It&nbsp;receives&nbsp;dataReceived&nbsp;to&nbsp;tell&nbsp;it&nbsp;a&nbsp;chunk&nbsp;has&nbsp;arrived&nbsp;and&nbsp;connectionLost&nbsp;to&nbsp;tell&nbsp;it&nbsp;the&nbsp;stream&nbsp;has&nbsp;terminated.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Unfortunately&nbsp;the&nbsp;client&nbsp;IRequest&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/15.4.0/api/twisted.web.iweb.IClientRequest.html&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/documents/15.4.0/api/twisted.web.iweb.IClientRequest.html&lt;/a&gt;&nbsp;isn't&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;quite&lt;/i&gt;&nbsp;as&nbsp;useful&nbsp;(although&nbsp;its&nbsp;relative&nbsp;minimalism&nbsp;should&nbsp;be&nbsp;an&nbsp;inspiration&nbsp;to&nbsp;anyone&nbsp;designing&nbsp;a&nbsp;next-generation&nbsp;IRequest&nbsp;more&nbsp;than&nbsp;the&nbsp;current&nbsp;IRequest's&nbsp;sprawling&nbsp;kitchen-sink&nbsp;aesthetic).&nbsp;&nbsp;However,&nbsp;IResponse.deliverBody&nbsp;could&nbsp;be&nbsp;applied&nbsp;to&nbsp;IGoodRequest&nbsp;as&nbsp;well.&nbsp;&nbsp;If&nbsp;we&nbsp;have&nbsp;a&nbsp;very&nbsp;similar-to-IResponse&nbsp;shaped&nbsp;IRequest&nbsp;object,&nbsp;say&nbsp;with&nbsp;'method',&nbsp;'uri'&nbsp;and&nbsp;'headers',&nbsp;and&nbsp;then&nbsp;a&nbsp;'deliverBody'&nbsp;that&nbsp;delivers&nbsp;the&nbsp;request&nbsp;body&nbsp;in&nbsp;much&nbsp;the&nbsp;same&nbsp;way,&nbsp;we&nbsp;could&nbsp;get&nbsp;a&nbsp;gracefully&nbsp;structured&nbsp;streaming&nbsp;request&nbsp;with&nbsp;works&nbsp;with&nbsp;a&nbsp;lot&nbsp;of&nbsp;existing&nbsp;code&nbsp;within&nbsp;Twisted.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Then&nbsp;the&nbsp;question&nbsp;is:&nbsp;what&nbsp;to&nbsp;do&nbsp;with&nbsp;IResource?&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Right&nbsp;now&nbsp;the&nbsp;flow&nbsp;of&nbsp;processing&nbsp;a&nbsp;request&nbsp;is,&nbsp;roughly:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;-&gt;&nbsp;wait&nbsp;for&nbsp;full&nbsp;request&nbsp;to&nbsp;arrive&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;-&gt;&nbsp;have&nbsp;HTTPChannel&nbsp;fill&nbsp;out&nbsp;IRequest&nbsp;object&lt;/div&gt;&lt;div&gt;-&gt;&nbsp;look&nbsp;at&nbsp;request.site.resource&nbsp;for&nbsp;the&nbsp;root&lt;/div&gt;&lt;div&gt;&nbsp;*-&gt;&nbsp;call&nbsp;getChildWithDefault&nbsp;repeatedly,&nbsp;mutating&nbsp;&quot;cursor&quot;&nbsp;state&nbsp;on&nbsp;the&nbsp;IRequest&nbsp;as&nbsp;you&nbsp;move&nbsp;(specifically:&nbsp;&quot;prepath&quot;&nbsp;and&nbsp;&quot;postpath&quot;&nbsp;attributes)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;-&gt;&nbsp;eventually&nbsp;reach&nbsp;the&nbsp;leaf&nbsp;Resource,&nbsp;or&nbsp;one&nbsp;with&nbsp;'isLeaf'&nbsp;set&nbsp;on&nbsp;it,&nbsp;and&nbsp;delegate&nbsp;producing&nbsp;the&nbsp;response&nbsp;to&nbsp;that&nbsp;resource&lt;/div&gt;&lt;div&gt;*-&gt;&nbsp;call&nbsp;resource.render(request)&lt;/div&gt;&lt;div&gt;-&gt;&nbsp;examine&nbsp;the&nbsp;return&nbsp;value;&nbsp;if&nbsp;it's&nbsp;bytes,&nbsp;deliver&nbsp;them&nbsp;and&nbsp;close&nbsp;the&nbsp;connection;&nbsp;NOT_DONE_YET,&nbsp;just&nbsp;leave&nbsp;the&nbsp;connection&nbsp;open,&nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Instead,&nbsp;I&nbsp;think&nbsp;a&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;good&lt;/i&gt;&nbsp;flow&nbsp;would&nbsp;be:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-&gt;&nbsp;receive&nbsp;method/headers&nbsp;from&nbsp;request&lt;/div&gt;&lt;div&gt;-&gt;&nbsp;recurse&nbsp;down&nbsp;from&nbsp;request.site.resource,&nbsp;calling&nbsp;something&nbsp;like&nbsp;nevow's&nbsp;or&nbsp;web2's&nbsp;locateChild,&nbsp;but&nbsp;not&nbsp;modifying&nbsp;'request'&nbsp;at&nbsp;each&nbsp;stage;&nbsp;instead,&nbsp;pass&nbsp;a&nbsp;&quot;cursor&quot;&nbsp;object&nbsp;-&nbsp;perhaps&nbsp;indeed&nbsp;just&nbsp;a&nbsp;twisted.python.url.URL&nbsp;-&nbsp;indicating&nbsp;where&nbsp;we&nbsp;are&nbsp;in&nbsp;the&nbsp;resource&nbsp;traversal&nbsp;hierarchy.&nbsp;&nbsp;the&nbsp;reason&nbsp;the&nbsp;request.prepath&nbsp;and&nbsp;request.postpath&nbsp;attributes&nbsp;exist&nbsp;is&nbsp;mainly&nbsp;for&nbsp;Resource&nbsp;objects&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;orient&nbsp;themselves&nbsp;within&nbsp;a&nbsp;resource&nbsp;tree&nbsp;and&nbsp;generate&nbsp;links.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;also,&nbsp;it&nbsp;probably&nbsp;bears&nbsp;some&nbsp;explanation;&nbsp;the&nbsp;signature&nbsp;of&nbsp;the&nbsp;current&nbsp;&quot;get&nbsp;the&nbsp;next&nbsp;resource&quot;&nbsp;call&nbsp;is&nbsp;resource.getChildWithDefault(onePathSegment,&nbsp;request)&nbsp;-&gt;&nbsp;resource.&nbsp;This&nbsp;is&nbsp;somewhat&nbsp;limiting&nbsp;as&nbsp;it&nbsp;requires&nbsp;you&nbsp;to&nbsp;consume&nbsp;only&nbsp;an&nbsp;individual&nbsp;path&nbsp;segment&nbsp;at&nbsp;a&nbsp;time,&nbsp;which&nbsp;can&nbsp;be&nbsp;highly&nbsp;awkward&nbsp;for&nbsp;implementing&nbsp;sites&nbsp;that&nbsp;have&nbsp;a&nbsp;URL&nbsp;structure&nbsp;that&nbsp;is,&nbsp;for&nbsp;example,&nbsp;/YYYY/MM/DD/HH/MM/index.html.&nbsp;&nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Instead,&nbsp;locateChild&nbsp;took&nbsp;the&nbsp;entire&nbsp;remaining&nbsp;path,&nbsp;and&nbsp;returned&nbsp;a&nbsp;2-tuple&nbsp;of&nbsp;a&nbsp;resource,&nbsp;and&nbsp;the&nbsp;_still_&nbsp;remaining&nbsp;path.&nbsp;&nbsp;So&nbsp;for&nbsp;the&nbsp;above,&nbsp;you&nbsp;could&nbsp;do:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;locateChild(self,&nbsp;request,&nbsp;path):&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;y,&nbsp;m,&nbsp;d&nbsp;=&nbsp;path[:3]&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ymdresource(y,&nbsp;m,&nbsp;d),&nbsp;path[3:]&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;that&nbsp;2-tuple&nbsp;instructs&nbsp;the&nbsp;traversal&nbsp;machinery,&nbsp;&quot;keep&nbsp;going&quot;.&nbsp;&nbsp;One&nbsp;alternative&nbsp;that&nbsp;we&nbsp;toyed&nbsp;with&nbsp;for&nbsp;this&nbsp;was&nbsp;to&nbsp;make&nbsp;consuming&nbsp;the&nbsp;path&nbsp;destructive,&nbsp;since&nbsp;that&nbsp;made&nbsp;it&nbsp;a&nbsp;lot&nbsp;easier&nbsp;to&nbsp;tell&nbsp;what&nbsp;resource&nbsp;you&nbsp;were&nbsp;&quot;looking&nbsp;at&quot;:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;def&nbsp;locateChild(self,&nbsp;request,&nbsp;path):&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;y,&nbsp;m,&nbsp;d&nbsp;=&nbsp;path.consume(3)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ymdresource(y,&nbsp;m,&nbsp;d)&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Either&nbsp;of&nbsp;these&nbsp;approaches&nbsp;also&nbsp;let&nbsp;you&nbsp;implement&nbsp;'isLeaf'&nbsp;attribute&nbsp;without&nbsp;special&nbsp;support&nbsp;from&nbsp;the&nbsp;framework;&nbsp;you&nbsp;simply&nbsp;return&nbsp;leaf(),&nbsp;()&nbsp;or&nbsp;path.consume(path.length)&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-&gt;&nbsp;finally,&nbsp;call&nbsp;.responseForRequest(request)&nbsp;-&gt;&nbsp;IResponse&nbsp;on&nbsp;the&nbsp;final&nbsp;Resource&nbsp;and&nbsp;deliver&nbsp;the&nbsp;IResponse&nbsp;to&nbsp;the&nbsp;network.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;way&nbsp;compatibility&nbsp;could&nbsp;be&nbsp;achieved&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;a&nbsp;wrapper&nbsp;that&nbsp;would&nbsp;implement&nbsp;.responseForRequest&nbsp;to&nbsp;first&nbsp;collect&nbsp;the&nbsp;entire&nbsp;body,&nbsp;then&nbsp;synthesize&nbsp;a&nbsp;gross&nbsp;old-style-IRequest-like&nbsp;object&nbsp;out&nbsp;of&nbsp;the&nbsp;combination&nbsp;of&nbsp;that&nbsp;body&nbsp;and&nbsp;the&nbsp;other&nbsp;information&nbsp;about&nbsp;the&nbsp;resource,&nbsp;then&nbsp;call&nbsp;.getChildWithDefault&nbsp;on&nbsp;it&nbsp;a&nbsp;few&nbsp;times,&nbsp;then&nbsp;call&nbsp;the&nbsp;old-style&nbsp;.render_GET,&nbsp;et.&nbsp;al.&nbsp;&nbsp;The&nbsp;IResponse&nbsp;returned&nbsp;from&nbsp;this&nbsp;compatibility&nbsp;.responseForRequest&nbsp;would&nbsp;wrap&nbsp;up&nbsp;calls&nbsp;like&nbsp;request.write&nbsp;and&nbsp;turn&nbsp;them&nbsp;into&nbsp;write()&nbsp;calls.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;long&nbsp;and&nbsp;increasingly&nbsp;rambly,&nbsp;so&nbsp;I&nbsp;should&nbsp;probably&nbsp;stop&nbsp;now,&nbsp;send&nbsp;it,&nbsp;and&nbsp;get&nbsp;your&nbsp;feedback.&nbsp;&nbsp;Does&nbsp;the&nbsp;strategy&nbsp;I'm&nbsp;proposing&nbsp;make&nbsp;sense?&nbsp;&nbsp;I'm&nbsp;sure&nbsp;I'm&nbsp;leaving&nbsp;a&nbsp;ton&nbsp;out&nbsp;so&nbsp;feel&nbsp;free&nbsp;to&nbsp;ask&nbsp;for&nbsp;clarification.&nbsp;&nbsp;Hopefully&nbsp;I&nbsp;didn't&nbsp;leave&nbsp;too&nbsp;many&nbsp;incomplete&nbsp;sentences&nbsp;in&nbsp;the&nbsp;middle.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
