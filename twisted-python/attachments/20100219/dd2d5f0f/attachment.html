<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/3.28.1&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
Hi&nbsp;again,&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;Ok,&nbsp;so&nbsp;now&nbsp;it&nbsp;seems&nbsp;the&nbsp;Int32StringReceiver&nbsp;does&nbsp;not&nbsp;receive&nbsp;&quot;stringReceived&quot;&nbsp;events&nbsp;if&nbsp;the&nbsp;sent&nbsp;bytes&lt;BR&gt;<br>
exceed&nbsp;a&nbsp;certain&nbsp;amount.&nbsp;If&nbsp;I&nbsp;send&nbsp;from&nbsp;the&nbsp;client,&nbsp;say&nbsp;5000&nbsp;bytes.&nbsp;It&nbsp;receives&nbsp;it.&lt;BR&gt;<br>
&lt;BR&gt;<br>
But&nbsp;when&nbsp;i&nbsp;send&nbsp;7376896&nbsp;bytes&nbsp;at&nbsp;a&nbsp;time,&nbsp;the&nbsp;client&nbsp;indicates&nbsp;it&nbsp;wrote&nbsp;the&nbsp;bytes,&nbsp;but&nbsp;there&nbsp;is&nbsp;not&nbsp;one&lt;BR&gt;<br>
stringReceived&nbsp;callback&nbsp;on&nbsp;the&nbsp;server&nbsp;side&nbsp;of&nbsp;the&nbsp;protocol.&nbsp;No&nbsp;error&nbsp;or&nbsp;exception.&nbsp;nothing.&nbsp;&lt;BR&gt;<br>
Is&nbsp;this&nbsp;normal&nbsp;behavior?&lt;BR&gt;<br>
&lt;BR&gt;<br>
thanks,&lt;BR&gt;<br>
Darren&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;Sat,&nbsp;2010-02-13&nbsp;at&nbsp;20:22&nbsp;-0500,&nbsp;David&nbsp;Bolen&nbsp;wrote:<br>
&lt;BLOCKQUOTE&nbsp;TYPE=CITE&gt;<br>
&lt;PRE&gt;<br>
Darren&nbsp;Govoni&nbsp;&lt;&lt;A&nbsp;HREF=&quot;mailto:darren@ontrenet.com&quot;&gt;darren@ontrenet.com&lt;/A&gt;&gt;&nbsp;writes:<br>
<br>
&gt;&nbsp;I&nbsp;spoke&nbsp;too&nbsp;fast.&nbsp;But&nbsp;pardon&nbsp;my&nbsp;noobiness.<br>
&gt;<br>
&gt;&nbsp;Ok,&nbsp;so&nbsp;I&nbsp;am&nbsp;using&nbsp;a&nbsp;simple&nbsp;protocol&nbsp;that&nbsp;is&nbsp;listening&nbsp;on&nbsp;a&nbsp;TCP&nbsp;port.<br>
&gt;<br>
&gt;&nbsp;One&nbsp;the&nbsp;client&nbsp;side,&nbsp;I&nbsp;write&nbsp;4096&nbsp;bytes&nbsp;using<br>
&gt;&nbsp;self.transport.write(bytes)<br>
&gt;<br>
&gt;&nbsp;on&nbsp;dataReceived&nbsp;side,&nbsp;I&nbsp;get&nbsp;only&nbsp;1448.&nbsp;<br>
<br>
Quite&nbsp;possible,&nbsp;and&nbsp;even&nbsp;likely&nbsp;with&nbsp;a&nbsp;chunk&nbsp;of&nbsp;4096,&nbsp;given&nbsp;likely<br>
network&nbsp;latencies&nbsp;and&nbsp;the&nbsp;physical&nbsp;packet&nbsp;sizes&nbsp;at&nbsp;each&nbsp;network&nbsp;hop<br>
along&nbsp;the&nbsp;way.<br>
<br>
However,&nbsp;dataReceived&nbsp;will&nbsp;eventually&nbsp;be&nbsp;called&nbsp;additional&nbsp;times&nbsp;until<br>
all&nbsp;of&nbsp;the&nbsp;4096&nbsp;bytes&nbsp;that&nbsp;was&nbsp;transmitted&nbsp;and&nbsp;received&nbsp;over&nbsp;the<br>
socket&nbsp;connection&nbsp;have&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;your&nbsp;protocol.&nbsp;&nbsp;That's&nbsp;just<br>
the&nbsp;nature&nbsp;of&nbsp;a&nbsp;stream&nbsp;protocol&nbsp;-&nbsp;it's&nbsp;a&nbsp;constant&nbsp;stream&nbsp;of&nbsp;data&nbsp;being<br>
fed&nbsp;by&nbsp;one&nbsp;end&nbsp;and&nbsp;drained&nbsp;on&nbsp;the&nbsp;other,&nbsp;without&nbsp;any&nbsp;natural<br>
boundaries&nbsp;or&nbsp;structures&nbsp;within&nbsp;(other&nbsp;than,&nbsp;I&nbsp;suppose,&nbsp;the&nbsp;boundary<br>
of&nbsp;an&nbsp;octet&nbsp;since&nbsp;you&nbsp;can't&nbsp;receive&nbsp;a&nbsp;partial&nbsp;octet).<br>
<br>
The&nbsp;alternative&nbsp;is&nbsp;to&nbsp;use&nbsp;a&nbsp;datagram&nbsp;protocol&nbsp;like&nbsp;UDP,&nbsp;but&nbsp;then&nbsp;you<br>
have&nbsp;all&nbsp;the&nbsp;negatives&nbsp;of&nbsp;no&nbsp;guaranteed&nbsp;delivery,&nbsp;out&nbsp;of&nbsp;order<br>
delivery,&nbsp;completely&nbsp;impossible&nbsp;delivery&nbsp;(when&nbsp;trying&nbsp;a&nbsp;datagram<br>
larger&nbsp;than&nbsp;the&nbsp;UDP&nbsp;limit),&nbsp;etc...<br>
<br>
Far&nbsp;easier&nbsp;to&nbsp;just&nbsp;handle&nbsp;the&nbsp;TCP&nbsp;stream&nbsp;properly.<br>
<br>
&gt;&nbsp;Now,&nbsp;what&nbsp;I&nbsp;&quot;want&quot;&nbsp;to&nbsp;happen&nbsp;is&nbsp;when&nbsp;I&nbsp;issue&nbsp;a&nbsp;write&nbsp;of&nbsp;a&nbsp;known<br>
&gt;&nbsp;number&nbsp;of&nbsp;bytes.&nbsp;I&nbsp;&quot;want&quot;&nbsp;those&nbsp;bytes&nbsp;to&nbsp;arrive&nbsp;in&nbsp;total&nbsp;because<br>
&gt;&nbsp;they&nbsp;represent&nbsp;a&nbsp;pickled&nbsp;object.&nbsp;&nbsp;The&nbsp;server&nbsp;has&nbsp;no&nbsp;idea&nbsp;if&nbsp;the<br>
&gt;&nbsp;bytes&nbsp;are&nbsp;split&nbsp;and&nbsp;scattered&nbsp;(again,&nbsp;I&nbsp;want&nbsp;the&nbsp;control&nbsp;protocol&nbsp;to<br>
&gt;&nbsp;take&nbsp;affect).<br>
<br>
I&nbsp;suspect&nbsp;it&nbsp;may&nbsp;just&nbsp;be&nbsp;a&nbsp;difference&nbsp;in&nbsp;phrasing,&nbsp;but&nbsp;note&nbsp;that&nbsp;I<br>
consider&nbsp;&quot;arrive&nbsp;in&nbsp;total&quot;&nbsp;to&nbsp;be&nbsp;different&nbsp;from&nbsp;&quot;arrive&nbsp;in&nbsp;the&nbsp;same<br>
number&nbsp;of&nbsp;I/O&nbsp;operations&quot;.&nbsp;&nbsp;TCP&nbsp;guarantees&nbsp;the&nbsp;former&nbsp;(sans&nbsp;dropped<br>
connections)&nbsp;but&nbsp;not&nbsp;the&nbsp;latter.&nbsp;&nbsp;It's&nbsp;a&nbsp;trade-off&nbsp;that&nbsp;you&nbsp;make&nbsp;in<br>
order&nbsp;to&nbsp;get&nbsp;the&nbsp;other&nbsp;benefits&nbsp;of&nbsp;guaranteed&nbsp;delivery&nbsp;with&nbsp;TCP,<br>
regardless&nbsp;of&nbsp;network&nbsp;disruptions,&nbsp;latency,&nbsp;etc...<br>
<br>
You're&nbsp;fine&nbsp;as&nbsp;long&nbsp;as&nbsp;you&nbsp;just&nbsp;accept&nbsp;up&nbsp;front&nbsp;that&nbsp;you&nbsp;can't&nbsp;make<br>
any&nbsp;assumptions&nbsp;as&nbsp;to&nbsp;how&nbsp;the&nbsp;data&nbsp;will&nbsp;arrive&nbsp;at&nbsp;the&nbsp;receiving&nbsp;end.<br>
So&nbsp;combine&nbsp;the&nbsp;data&nbsp;in&nbsp;whatever&nbsp;sizes&nbsp;it&nbsp;is&nbsp;received&nbsp;(and&nbsp;any&nbsp;number<br>
of&nbsp;received&nbsp;chunks)&nbsp;until&nbsp;you&nbsp;have&nbsp;it&nbsp;all.&nbsp;&nbsp;You&nbsp;can&nbsp;then&nbsp;de-pickle&nbsp;it<br>
or&nbsp;do&nbsp;anything&nbsp;else&nbsp;with&nbsp;it.&nbsp;&nbsp;As&nbsp;a&nbsp;comparison,&nbsp;that's&nbsp;really&nbsp;all&nbsp;PB&nbsp;is<br>
doing,&nbsp;although&nbsp;it's&nbsp;banana-encoding&nbsp;the&nbsp;object&nbsp;on&nbsp;the&nbsp;wire&nbsp;rather<br>
than&nbsp;pickling.<br>
<br>
Depending&nbsp;on&nbsp;the&nbsp;client/server&nbsp;interaction,&nbsp;you&nbsp;may&nbsp;also&nbsp;have&nbsp;the<br>
opposite&nbsp;problem&nbsp;-&nbsp;the&nbsp;final&nbsp;chunk&nbsp;of&nbsp;data&nbsp;received&nbsp;may&nbsp;cover&nbsp;more<br>
than&nbsp;one&nbsp;client&nbsp;transmission,&nbsp;and&nbsp;you'll&nbsp;have&nbsp;to&nbsp;split&nbsp;it&nbsp;up<br>
appropriately.<br>
<br>
That's&nbsp;why&nbsp;if&nbsp;you&nbsp;will&nbsp;be&nbsp;transmitting&nbsp;multiple&nbsp;sets&nbsp;of&nbsp;data&nbsp;over&nbsp;a<br>
single&nbsp;connection,&nbsp;you'll&nbsp;want&nbsp;some&nbsp;structure&nbsp;(unique&nbsp;boundary&nbsp;codes,<br>
encoded&nbsp;length&nbsp;information,&nbsp;parseable&nbsp;data&nbsp;like&nbsp;XML,&nbsp;etc...)&nbsp;in&nbsp;the&nbsp;wire<br>
protocol&nbsp;so&nbsp;your&nbsp;server&nbsp;knows&nbsp;when&nbsp;it&nbsp;is&nbsp;done.<br>
<br>
&gt;&nbsp;1)&nbsp;Am&nbsp;I&nbsp;doing&nbsp;something&nbsp;wrong&nbsp;here?<br>
<br>
Not&nbsp;so&nbsp;much&nbsp;wrong,&nbsp;as&nbsp;perhaps&nbsp;a&nbsp;little&nbsp;misguided&nbsp;in&nbsp;terms&nbsp;of&nbsp;trying&nbsp;to<br>
have&nbsp;a&nbsp;stream&nbsp;protocol&nbsp;work&nbsp;less&nbsp;as&nbsp;a&nbsp;stream&nbsp;than&nbsp;it&nbsp;does.<br>
<br>
I&nbsp;suspect&nbsp;you&nbsp;may&nbsp;also&nbsp;be&nbsp;over-estimating&nbsp;a&nbsp;little&nbsp;the&nbsp;complexity&nbsp;of<br>
handling&nbsp;this&nbsp;aspect&nbsp;of&nbsp;TCP&nbsp;in&nbsp;your&nbsp;own&nbsp;code.<br>
<br>
&gt;&nbsp;2)&nbsp;Can&nbsp;I&nbsp;force&nbsp;twisted&nbsp;to&nbsp;send&nbsp;ALL&nbsp;the&nbsp;bytes&nbsp;I&nbsp;issue&nbsp;in&nbsp;the&nbsp;write<br>
&gt;&nbsp;without&nbsp;re-thinking&nbsp;TCP&nbsp;or&nbsp;forcing&nbsp;me&nbsp;to&nbsp;re-implement&nbsp;TCP?<br>
<br>
Again,&nbsp;distinguish&nbsp;between&nbsp;&quot;send&nbsp;ALL&nbsp;the&nbsp;bytes&quot;&nbsp;which&nbsp;*does*&nbsp;in&nbsp;fact<br>
happen,&nbsp;versus&nbsp;&quot;receive&nbsp;bytes&nbsp;in&nbsp;identically&nbsp;sized&nbsp;chunks&quot;&nbsp;which&nbsp;will<br>
not&nbsp;happen.&nbsp;&nbsp;Though&nbsp;I&nbsp;seriously&nbsp;doubt&nbsp;that&nbsp;your&nbsp;demands&nbsp;are&nbsp;such&nbsp;that<br>
it&nbsp;requires&nbsp;&quot;re-thinking&quot;&nbsp;or&nbsp;&quot;re-implement[ing]&quot;&nbsp;TCP.<br>
<br>
Much&nbsp;easier&nbsp;to&nbsp;stick&nbsp;with&nbsp;the&nbsp;TCP&nbsp;base&nbsp;(loads&nbsp;of&nbsp;benefits),&nbsp;and&nbsp;just<br>
encode&nbsp;enough&nbsp;structure&nbsp;into&nbsp;your&nbsp;stream&nbsp;to&nbsp;permit&nbsp;the&nbsp;server&nbsp;to<br>
identify&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;requests.&nbsp;&nbsp;Then,&nbsp;code&nbsp;the&nbsp;server&nbsp;to<br>
look&nbsp;for&nbsp;such&nbsp;boundaries&nbsp;while&nbsp;accepting&nbsp;data&nbsp;in&nbsp;any&nbsp;size&nbsp;chunks,&nbsp;and<br>
you're&nbsp;done.&nbsp;&nbsp;It's&nbsp;pretty&nbsp;much&nbsp;what&nbsp;every&nbsp;other&nbsp;TCP&nbsp;protocol&nbsp;that&nbsp;has<br>
structure&nbsp;to&nbsp;its&nbsp;data&nbsp;does,&nbsp;whether&nbsp;that's&nbsp;length&nbsp;counted,&nbsp;flag&nbsp;bytes,<br>
specific&nbsp;textual&nbsp;content&nbsp;(such&nbsp;as&nbsp;the&nbsp;final&nbsp;empty&nbsp;line&nbsp;in&nbsp;an&nbsp;HTTP<br>
request),&nbsp;etc...<br>
<br>
As&nbsp;has&nbsp;been&nbsp;posted&nbsp;in&nbsp;another&nbsp;response,&nbsp;you&nbsp;may&nbsp;find&nbsp;some&nbsp;of&nbsp;the<br>
existing&nbsp;protocols&nbsp;in&nbsp;twisted.protocol.basic&nbsp;to&nbsp;be&nbsp;helpful&nbsp;for&nbsp;this.<br>
The&nbsp;older&nbsp;posting&nbsp;of&nbsp;mine&nbsp;that&nbsp;you&nbsp;referenced&nbsp;used&nbsp;a&nbsp;subclass&nbsp;of<br>
LineReceiver&nbsp;to&nbsp;encode&nbsp;the&nbsp;length&nbsp;in&nbsp;ASCII&nbsp;as&nbsp;part&nbsp;of&nbsp;an&nbsp;initial<br>
header,&nbsp;for&nbsp;example,&nbsp;though&nbsp;it&nbsp;closed&nbsp;the&nbsp;connection&nbsp;when&nbsp;done.&nbsp;&nbsp;And,<br>
for&nbsp;example,&nbsp;Netstring&nbsp;or&nbsp;the&nbsp;Int##String&nbsp;classes&nbsp;takes&nbsp;care&nbsp;of&nbsp;the<br>
counting&nbsp;on&nbsp;your&nbsp;behalf,&nbsp;and&nbsp;even&nbsp;give&nbsp;subclasses&nbsp;a&nbsp;nice&nbsp;single&nbsp;entry<br>
point&nbsp;(stringReceived)&nbsp;to&nbsp;use&nbsp;instead&nbsp;of&nbsp;dataReceived,&nbsp;so&nbsp;your&nbsp;server<br>
need&nbsp;not&nbsp;think&nbsp;about&nbsp;the&nbsp;aggregation&nbsp;or&nbsp;splitting&nbsp;of&nbsp;chunks.<br>
<br>
If&nbsp;nothing&nbsp;else,&nbsp;reading&nbsp;the&nbsp;source&nbsp;to&nbsp;one&nbsp;of&nbsp;those&nbsp;receiver&nbsp;classes<br>
might&nbsp;help&nbsp;provide&nbsp;a&nbsp;concrete&nbsp;example&nbsp;of&nbsp;the&nbsp;aggregation&nbsp;(or<br>
splitting)&nbsp;of&nbsp;the&nbsp;stream&nbsp;data&nbsp;that&nbsp;I&nbsp;mention&nbsp;above.<br>
<br>
--&nbsp;David<br>
<br>
<br>
_______________________________________________<br>
Twisted-Python&nbsp;mailing&nbsp;list<br>
&lt;A&nbsp;HREF=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/A&gt;<br>
&lt;A&nbsp;HREF=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/A&gt;<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
&lt;BR&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
