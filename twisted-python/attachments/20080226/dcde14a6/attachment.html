<tt>
Greetings,&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;a&nbsp;problem&nbsp;I&nbsp;hope&nbsp;someone&nbsp;here&nbsp;can&nbsp;assist&nbsp;with.&nbsp;I&#39;m&nbsp;using&nbsp;TwistedSNMP&nbsp;to&nbsp;query&nbsp;a&nbsp;bunch&nbsp;of&nbsp;SNMP&nbsp;devices&nbsp;asynchronously.&nbsp;The&nbsp;behavior&nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;get&nbsp;is&nbsp;to&nbsp;get&nbsp;is&nbsp;to&nbsp;query&nbsp;all&nbsp;the&nbsp;devices&nbsp;via&nbsp;SNMP,&nbsp;each&nbsp;query&nbsp;returns&nbsp;a&nbsp;deferred,&nbsp;and&nbsp;when&nbsp;all&nbsp;their&nbsp;callbacks&nbsp;have&nbsp;been&nbsp;fired&nbsp;then&nbsp;I&nbsp;want&nbsp;to&nbsp;stop&nbsp;the&nbsp;reactor&nbsp;and&nbsp;thereby&nbsp;exit&nbsp;the&nbsp;program.&nbsp;I&nbsp;thought&nbsp;perhaps&nbsp;I&nbsp;could&nbsp;put&nbsp;each&nbsp;of&nbsp;these&nbsp;SNMP&nbsp;deferreds&nbsp;in&nbsp;a&nbsp;DeferredList&nbsp;and&nbsp;add&nbsp;a&nbsp;callback&nbsp;to&nbsp;the&nbsp;DeferredList&nbsp;that&nbsp;would&nbsp;stop&nbsp;the&nbsp;reactor&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;do&nbsp;that.&nbsp;Enclosed&nbsp;is&nbsp;a&nbsp;code&nbsp;sample.&nbsp;Am&nbsp;I&nbsp;doing&nbsp;something&nbsp;incorrectly,&nbsp;or&nbsp;should&nbsp;I&nbsp;do&nbsp;something&nbsp;different?&lt;br&gt;<br>
&lt;br&gt;Thanks!&nbsp;-Don&lt;br&gt;&lt;br&gt;&quot;&quot;&quot;Trivial&nbsp;example&nbsp;to&nbsp;retrieve&nbsp;an&nbsp;OID&nbsp;from&nbsp;a&nbsp;remote&nbsp;Agent&quot;&quot;&quot;&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;from&nbsp;twistedsnmp&nbsp;import&nbsp;snmpprotocol,&nbsp;agentproxy&lt;br&gt;from&nbsp;twisted.enterprise&nbsp;import&nbsp;adbapi&lt;br&gt;<br>
from&nbsp;twisted.internet&nbsp;import&nbsp;defer&lt;br&gt;import&nbsp;os&lt;br&gt;&lt;br&gt;APPNAME&nbsp;=&nbsp;&#39;ClearSNMP&#39;&lt;br&gt;d_results&nbsp;=&nbsp;{}&nbsp;#dictionary&nbsp;to&nbsp;store&nbsp;results&lt;br&gt;device_name&nbsp;=&nbsp;&#39;Unknown&#39;&lt;br&gt;&lt;br&gt;db_conn&nbsp;=&nbsp;{&#39;user&#39;:&#39;sa&#39;,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;password&#39;:&#39;password&#39;,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;host&#39;:&#39;localhost&#39;,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;database&#39;:&#39;ClearSNMP&#39;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;community_string&nbsp;=&nbsp;&#39;public&#39;&lt;br&gt;&lt;br&gt;deferred_list&nbsp;=&nbsp;[]&nbsp;#list&nbsp;to&nbsp;help&nbsp;group&nbsp;the&nbsp;snmp&nbsp;requests&lt;br&gt;<br>
&lt;br&gt;outfile&nbsp;=&nbsp;open(&#39;outfile.csv&#39;,&#39;wb&#39;,0)&lt;br&gt;#add&nbsp;headers&nbsp;to&nbsp;the&nbsp;outfile&lt;br&gt;outfile.write(&quot;device_name,link_oid,link_name,link_capacity_oid,link_capacity,traffic_in_oid,traffic_in,traffic_out_oid,traffic_out&quot;)&lt;br&gt;<br>
&lt;br&gt;#create&nbsp;the&nbsp;database&nbsp;connection&nbsp;pool&lt;br&gt;dbpool&nbsp;=&nbsp;adbapi.ConnectionPool(&quot;pymssql&quot;,&nbsp;user=db_conn[&#39;user&#39;],&nbsp;password=db_conn[&#39;password&#39;],&nbsp;host=db_conn[&#39;host&#39;],&nbsp;database=db_conn[&#39;database&#39;])&lt;br&gt;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;def&nbsp;main(&nbsp;class_handler,&nbsp;proxy,&nbsp;oids&nbsp;):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Do&nbsp;a&nbsp;getTable&nbsp;on&nbsp;proxy&nbsp;for&nbsp;OIDs&nbsp;and&nbsp;store&nbsp;in&nbsp;oidStore&quot;&quot;&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;df&nbsp;=&nbsp;proxy.getTable(&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oids,&nbsp;timeout=.25,&nbsp;retryCount=5&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_handler&nbsp;==&nbsp;&#39;tasman&#39;:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;df.addCallback(&nbsp;tasmanResults&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;else:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;df.addCallback(&nbsp;results&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#df.addCallback(&nbsp;exiter&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;df.addErrback(&nbsp;errorReporter,&nbsp;proxy&nbsp;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#df.addErrback(&nbsp;exiter&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;df&lt;br&gt;&lt;br&gt;&lt;br&gt;def&nbsp;tasmanResults(&nbsp;result&nbsp;):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Results&nbsp;&#39;appear&#39;&nbsp;to&nbsp;be&nbsp;a&nbsp;nested&nbsp;dictionary,&nbsp;but&nbsp;it&nbsp;is&nbsp;really&nbsp;an&nbsp;object&nbsp;of&nbsp;OIDs.&nbsp;I&nbsp;figured&nbsp;out&nbsp;how&nbsp;to&nbsp;get&nbsp;to&nbsp;the&nbsp;OIDs&nbsp;by&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;casting&nbsp;them&nbsp;as&nbsp;a&nbsp;dictionary&nbsp;using&nbsp;the&nbsp;built_in&nbsp;dict()&nbsp;function.&nbsp;Now&nbsp;I&nbsp;can&nbsp;iterate&nbsp;over&nbsp;all&nbsp;the&nbsp;OIDs.&quot;&quot;&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;&#39;Results:&#39;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;d_table_key&nbsp;=&nbsp;{}&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;table_key&nbsp;in&nbsp;result.keys():&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#get&nbsp;the&nbsp;device&nbsp;name.&nbsp;for&nbsp;some&nbsp;reason&nbsp;i&nbsp;have&nbsp;to&nbsp;do&nbsp;this&nbsp;in&nbsp;a&nbsp;loop&nbsp;as&nbsp;just&nbsp;saying&nbsp;dict(result[table_key])[&#39;.1.3.6.1.2.1.1.5.0&#39;]&nbsp;doesn&#39;t&nbsp;work&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;oid&nbsp;in&nbsp;dict(result[table_key]).keys():&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;oid==&#39;.1.3.6.1.2.1.1.5.0&#39;:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device_name=str(dict(result[table_key])[oid])&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_oid&nbsp;=&nbsp;{}&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;oid&nbsp;in&nbsp;dict(result[table_key]).keys():&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_oid[str(oid)]=dict(result[table_key])[oid]&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_table_key[str(table_key)]&nbsp;=&nbsp;d_oid&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;d_results[device_name]=d_table_key&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#specify&nbsp;the&nbsp;table&nbsp;oids&nbsp;so&nbsp;we&nbsp;can&nbsp;match&nbsp;them&nbsp;appropriately&nbsp;later&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;link_name_table&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&quot;.1.3.6.1.2.1.2.2.1.2&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;link_capacity_table&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&quot;.1.3.6.1.2.1.2.2.1.5&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;traffic_in_table&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&quot;.1.3.6.1.2.1.2.2.1.10&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;traffic_out_table&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&quot;.1.3.6.1.2.1.2.2.1.16&quot;&lt;br&gt;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;For&nbsp;each&nbsp;link&nbsp;name&nbsp;in&nbsp;the&nbsp;table&nbsp;I&nbsp;need&nbsp;to&nbsp;get&nbsp;the&nbsp;values&nbsp;from&nbsp;the&nbsp;link_capacity,&nbsp;traffic_in&nbsp;and&nbsp;traffic_out&nbsp;tables&nbsp;and&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;same&nbsp;line&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;d_results.keys():&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row&nbsp;=&nbsp;{}&nbsp;#holds&nbsp;the&nbsp;column&nbsp;values&nbsp;for&nbsp;a&nbsp;row&lt;br&gt;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#set&nbsp;device_name&nbsp;in&nbsp;Row&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;device_name&#39;]&nbsp;=&nbsp;device_name&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;k&nbsp;in&nbsp;d_results[i][link_name_table]:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#set&nbsp;link_oid&nbsp;and&nbsp;link_name&nbsp;in&nbsp;Row&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;link_oid&#39;]&nbsp;=&nbsp;k&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;link_name&#39;]&nbsp;=&nbsp;d_results[i][link_name_table][d_row[&#39;link_oid&#39;]]&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#lookup&nbsp;the&nbsp;capacity&nbsp;metric&nbsp;for&nbsp;this&nbsp;link_oid&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#create&nbsp;the&nbsp;oid&nbsp;to&nbsp;lookup&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;link_capacity_oid&#39;]&nbsp;=&nbsp;d_row[&#39;link_oid&#39;].replace(link_name_table,link_capacity_table)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;link_capacity&#39;]&nbsp;=&nbsp;d_results[i][link_capacity_table][d_row[&#39;link_capacity_oid&#39;]]&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#lookup&nbsp;the&nbsp;traffic_in&nbsp;metric&nbsp;for&nbsp;this&nbsp;link_oid&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#create&nbsp;the&nbsp;oid&nbsp;to&nbsp;lookup&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;traffic_in_oid&#39;]&nbsp;=&nbsp;d_row[&#39;link_oid&#39;].replace(link_name_table,traffic_in_table)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;traffic_in&#39;]&nbsp;=&nbsp;d_results[i][traffic_in_table][d_row[&#39;traffic_in_oid&#39;]]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#lookup&nbsp;the&nbsp;traffic_out&nbsp;metric&nbsp;for&nbsp;this&nbsp;link_oid&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#create&nbsp;the&nbsp;oid&nbsp;to&nbsp;lookup&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;traffic_out_oid&#39;]&nbsp;=&nbsp;d_row[&#39;link_oid&#39;].replace(link_name_table,traffic_out_table)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_row[&#39;traffic_out&#39;]&nbsp;=&nbsp;d_results[i][traffic_out_table][d_row[&#39;traffic_out_oid&#39;]]&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Calculate&nbsp;Utilization&nbsp;-&nbsp;if&nbsp;we&nbsp;can&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;d_row&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;=&nbsp;d_row[&#39;device_name&#39;]+&quot;,&quot;+d_row[&#39;link_oid&#39;]+&quot;,&quot;+d_row[&#39;link_name&#39;]+&quot;,&quot;+d_row[&#39;link_capacity_oid&#39;]+&quot;,&quot;+str(d_row[&#39;link_capacity&#39;])+&quot;,&quot;+d_row[&#39;traffic_in_oid&#39;]+&quot;,&quot;+str(d_row[&#39;traffic_in&#39;])+&quot;,&quot;+d_row[&#39;traffic_out_oid&#39;]+&quot;,&quot;+str(d_row[&#39;traffic_out&#39;])+&#39;\r\n&#39;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;out&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outfile.write(out)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result&lt;br&gt;&lt;br&gt;&lt;br&gt;def&nbsp;errorReporter(&nbsp;err,&nbsp;proxy&nbsp;):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;&#39;ERROR&#39;,&nbsp;err.getTraceback()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#log&nbsp;the&nbsp;failed&nbsp;snmp&nbsp;query&nbsp;attempt&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&#39;Failed&nbsp;to&nbsp;retrieve&nbsp;SNMP&nbsp;counters&nbsp;from&nbsp;agent:&#39;,proxy&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;err&lt;br&gt;&lt;br&gt;def&nbsp;exiter(&nbsp;value&nbsp;):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;reactor.stop()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;outfile.close()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;value&lt;br&gt;&lt;br&gt;&lt;br&gt;def&nbsp;getNetworkElements():&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;dbpool.runQuery(&quot;select&nbsp;top&nbsp;10&nbsp;ip,&nbsp;mkt,&nbsp;dns_name,&nbsp;dns_fqdn&nbsp;from&nbsp;dns&nbsp;where&nbsp;dns_type=&#39;TASMAN&#39;&quot;)&lt;br&gt;<br>
&lt;br&gt;def&nbsp;printResult(l):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;item&nbsp;in&nbsp;l:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Fetching&nbsp;counters&nbsp;for&nbsp;&quot;+item[2]&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#deferred_list.append(snmpSetup(item[0],&nbsp;161,&nbsp;&#39;ctipublic&#39;,&#39;tasman&#39;))&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;ipAddress&nbsp;=&nbsp;item[0]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;portno&nbsp;=&nbsp;161&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;community&nbsp;=&nbsp;community_string&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;class_handler&nbsp;=&nbsp;&#39;tasman&#39;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;ipAddress,portno&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;choose&nbsp;random&nbsp;port&nbsp;in&nbsp;range&nbsp;25000&nbsp;to&nbsp;30000&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port&nbsp;=&nbsp;snmpprotocol.port()&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;targetPort&nbsp;=&nbsp;int(portno)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy&nbsp;=&nbsp;agentproxy.AgentProxy(ipAddress,&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;targetPort,&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;community&nbsp;=&nbsp;community,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;snmpVersion&nbsp;=&nbsp;&#39;v1&#39;,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protocol&nbsp;=&nbsp;port.protocol,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_oids&nbsp;=&nbsp;{&#39;.1.3.6.1.2.1.1&#39;:&quot;System&nbsp;Tables&quot;,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;.1.3.6.1.2.1.2.2.1.2&#39;:&quot;Circuit&nbsp;Name&quot;,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;.1.3.6.1.2.1.2.2.1.5&#39;:&quot;Capacity&quot;,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;.1.3.6.1.2.1.2.2.1.10&#39;:&quot;Traffic&nbsp;In&quot;,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;.1.3.6.1.2.1.2.2.1.16&#39;:&quot;Traffic&nbsp;Out&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Do&nbsp;a&nbsp;getTable&nbsp;on&nbsp;proxy&nbsp;for&nbsp;OIDs&nbsp;and&nbsp;store&nbsp;in&nbsp;oidStore&quot;&quot;&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;df&nbsp;=&nbsp;proxy.getTable(&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_oids,&nbsp;timeout=.25,&nbsp;retryCount=5&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_handler&nbsp;==&nbsp;&#39;tasman&#39;:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;df.addCallback(&nbsp;tasmanResults&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;else:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;df.addCallback(&nbsp;results&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;df.addErrback(&nbsp;errorReporter,&nbsp;proxy&nbsp;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;deferred_list.append(df)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;sys&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#start&nbsp;the&nbsp;log&nbsp;service&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;twisted.python&nbsp;import&nbsp;log&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;twisted.python&nbsp;import&nbsp;logfile&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rotate&nbsp;every&nbsp;100000000&nbsp;bytes&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;logfile.LogFile(APPNAME+str(os.getpid())+&quot;.log&quot;,&nbsp;&quot;Logs&quot;,&nbsp;rotateLength=100000000)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;setup&nbsp;logging&nbsp;to&nbsp;use&nbsp;our&nbsp;new&nbsp;logfile&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#log.startLogging(f)&lt;br&gt;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;=&nbsp;getNetworkElements().addCallback(printResult)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;dl&nbsp;=&nbsp;defer.DeferredList(deferred_list,&nbsp;0,&nbsp;0,&nbsp;1&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;dir(dl)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;dl.addCallback(exiter)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;reactor.run()&lt;br&gt;<br>

</tt>
