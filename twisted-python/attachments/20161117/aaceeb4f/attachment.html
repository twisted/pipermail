<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Nov&nbsp;17,&nbsp;2016,&nbsp;at&nbsp;6:43&nbsp;AM,&nbsp;Mark&nbsp;Williams&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:markrwilliams@gmail.com&quot;&nbsp;class=&quot;&quot;&gt;markrwilliams@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Wed,&nbsp;Nov&nbsp;16,&nbsp;2016&nbsp;at&nbsp;11:22:49PM&nbsp;-0800,&nbsp;Glyph&nbsp;Lefkowitz&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;However;&nbsp;is&nbsp;it&nbsp;really&nbsp;a&nbsp;regression&nbsp;to&nbsp;have&nbsp;py3&nbsp;support&nbsp;for&nbsp;Words&nbsp;that&nbsp;just&nbsp;doesn't&nbsp;support&nbsp;other&nbsp;encodings&nbsp;yet?&nbsp;&nbsp;It&nbsp;strikes&nbsp;me&nbsp;that&nbsp;this&nbsp;is&nbsp;just&nbsp;a&nbsp;bug,&nbsp;and&nbsp;that&nbsp;we&nbsp;should&nbsp;just&nbsp;fall&nbsp;back&nbsp;from&nbsp;UTF-8&nbsp;to&nbsp;latin-1&nbsp;in&nbsp;this&nbsp;scenario.&nbsp;&nbsp;But&nbsp;adding&nbsp;that&nbsp;fallback&nbsp;is&nbsp;a&nbsp;small&nbsp;additional&nbsp;fix&nbsp;(perhaps&nbsp;one&nbsp;that&nbsp;should&nbsp;be&nbsp;slated&nbsp;for&nbsp;16.6.0&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;make&nbsp;it).&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Falling&nbsp;back&nbsp;to&nbsp;latin-1&nbsp;will&nbsp;address&nbsp;the&nbsp;most&nbsp;obvious&nbsp;issue&nbsp;exposed&nbsp;by&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;client&nbsp;in&nbsp;the&nbsp;re-opened&nbsp;ticket.&nbsp;&nbsp;It&nbsp;will&nbsp;not&nbsp;fix&nbsp;the&nbsp;general&nbsp;issue.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;doesn't&nbsp;appear&nbsp;to&nbsp;be&nbsp;an&nbsp;answer&nbsp;to&nbsp;the&nbsp;&quot;is&nbsp;it&nbsp;a&nbsp;regression&quot;&nbsp;question&nbsp;though&nbsp;;-).&nbsp;&nbsp;I'm&nbsp;still&nbsp;curious&nbsp;what&nbsp;you&nbsp;think&nbsp;there.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;_general_&nbsp;issue&nbsp;is&nbsp;unfixable,&nbsp;except&nbsp;to&nbsp;use&nbsp;chardet&nbsp;upon&nbsp;encoding&nbsp;errors.&nbsp;&nbsp;As&nbsp;far&nbsp;as&nbsp;I'm&nbsp;aware,&nbsp;IRC&nbsp;simply&nbsp;doesn't&nbsp;have&nbsp;the&nbsp;ability&nbsp;to&nbsp;specify&nbsp;an&nbsp;encoding.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;More&nbsp;importantly,&nbsp;IRC&nbsp;doesn't&nbsp;specify&nbsp;an&nbsp;encoding&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;and&nbsp;it&nbsp;is&nbsp;also&nbsp;responsible&nbsp;for&nbsp;transmitting&nbsp;textual&nbsp;data&nbsp;intended&nbsp;to&nbsp;be&nbsp;input&nbsp;and&nbsp;consumed&nbsp;by&nbsp;humans&lt;/i&gt;.&nbsp;&nbsp;If&nbsp;you&nbsp;can't&nbsp;decode&nbsp;it,&nbsp;faithfully&nbsp;replicating&nbsp;the&nbsp;on-the-wire&nbsp;encoding&nbsp;is&nbsp;of&nbsp;limited&nbsp;utility.&nbsp;&nbsp;You&nbsp;can't&nbsp;write&nbsp;any&nbsp;code&nbsp;to&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;process&lt;/i&gt;&nbsp;the&nbsp;data.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Note&nbsp;that&nbsp;my&nbsp;sample&nbsp;was&nbsp;heavily&nbsp;biased&nbsp;towards&nbsp;European&nbsp;servers.&lt;br&nbsp;class=&quot;&quot;&gt;Other&nbsp;IRC&nbsp;servers&nbsp;in&nbsp;other&nbsp;regions&nbsp;might&nbsp;prefer&nbsp;a&nbsp;different&nbsp;8-bit&lt;br&nbsp;class=&quot;&quot;&gt;encoding,&nbsp;like&nbsp;windows-1251&nbsp;or&nbsp;Big5.&nbsp;&nbsp;And&nbsp;often&nbsp;a&nbsp;single&nbsp;server&nbsp;will&lt;br&nbsp;class=&quot;&quot;&gt;see&nbsp;a&nbsp;long&nbsp;tail&nbsp;(or&nbsp;at&nbsp;least&nbsp;a&nbsp;tail)&nbsp;of&nbsp;different&nbsp;8-bit&nbsp;encodings.&lt;br&nbsp;class=&quot;&quot;&gt;Listing&nbsp;all&nbsp;channels&nbsp;on&nbsp;a&nbsp;server,&nbsp;as&nbsp;the&nbsp;example&nbsp;script&nbsp;does,&nbsp;cannot&lt;br&nbsp;class=&quot;&quot;&gt;be&nbsp;done&nbsp;with&nbsp;an&nbsp;implementation&nbsp;that&nbsp;decodes&nbsp;input&nbsp;as&nbsp;text&nbsp;prior&nbsp;to&lt;br&nbsp;class=&quot;&quot;&gt;parsing&nbsp;it.&nbsp;&nbsp;It's&nbsp;even&nbsp;possible&nbsp;to&nbsp;use&nbsp;chardet&nbsp;to&nbsp;detect&nbsp;encodings.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;chardet&nbsp;is&nbsp;installed,&nbsp;can&nbsp;it&nbsp;be&nbsp;specified&nbsp;as&nbsp;an&nbsp;encoding&nbsp;itself?&nbsp;&nbsp;Like,&nbsp;b&quot;garbage&nbsp;garbage&quot;.decode(&quot;chardet&quot;)?&nbsp;&nbsp;This&nbsp;would&nbsp;make&nbsp;it&nbsp;possible&nbsp;to&nbsp;use&nbsp;without&nbsp;binding&nbsp;to&nbsp;the&nbsp;library;&nbsp;you&nbsp;just&nbsp;specify&nbsp;an&nbsp;encoding.&nbsp;&nbsp;(The&nbsp;library&nbsp;is&nbsp;LGPL2.1&nbsp;which&nbsp;makes&nbsp;it&nbsp;a&nbsp;problematic&nbsp;dependency&nbsp;for&nbsp;Twisted,&nbsp;even&nbsp;optionally.)&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;IRC's&nbsp;encoding&nbsp;situation&nbsp;mirrors&nbsp;file&nbsp;systems'&nbsp;one&nbsp;on&nbsp;POSIX.&nbsp;&nbsp;A&nbsp;given&lt;br&nbsp;class=&quot;&quot;&gt;path's&nbsp;components&nbsp;can&nbsp;be&nbsp;in&nbsp;multiple&nbsp;encodings.&nbsp;&nbsp;I&nbsp;believe&nbsp;at&nbsp;least&lt;br&nbsp;class=&quot;&quot;&gt;part&nbsp;of&nbsp;the&nbsp;reason&nbsp;FilePath's&nbsp;paths&nbsp;are&nbsp;bytes,&nbsp;even&nbsp;when&lt;br&nbsp;class=&quot;&quot;&gt;surrogateescape&nbsp;exists,&nbsp;is&nbsp;that&nbsp;Unicode&nbsp;paths&nbsp;on&nbsp;POSIX&nbsp;systems&nbsp;would&lt;br&nbsp;class=&quot;&quot;&gt;make&nbsp;FilePath&nbsp;unusable&nbsp;for&nbsp;perfectly&nbsp;valid&nbsp;use&nbsp;cases.&nbsp;&nbsp;We&nbsp;can&nbsp;pretend&lt;br&nbsp;class=&quot;&quot;&gt;that&nbsp;IRC&nbsp;has&nbsp;a&nbsp;defined&nbsp;encoding,&nbsp;but&nbsp;doing&nbsp;so&nbsp;will&nbsp;make&nbsp;unusable&nbsp;for&lt;br&nbsp;class=&quot;&quot;&gt;perfectly&nbsp;valid&nbsp;use&nbsp;cases.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Here&nbsp;we&nbsp;go&nbsp;:-).&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;POSIX&nbsp;has&nbsp;an&nbsp;internally&nbsp;inconsistent&nbsp;model&nbsp;of&nbsp;how&nbsp;encodings&nbsp;work;&nbsp;they&nbsp;cannot&nbsp;possibly&nbsp;function&nbsp;correctly.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;First&nbsp;off,&nbsp;let&nbsp;me&nbsp;put&nbsp;to&nbsp;rest&nbsp;the&nbsp;lie&nbsp;that&nbsp;paths&nbsp;are&nbsp;&quot;really&quot;&nbsp;bytes.&nbsp;&nbsp;Paths&nbsp;are&nbsp;text.&nbsp;&nbsp;They&nbsp;must&nbsp;be&nbsp;text&nbsp;because&nbsp;they&nbsp;have&nbsp;to&nbsp;transit&nbsp;through&nbsp;text-processing&nbsp;systems,&nbsp;such&nbsp;as&nbsp;windowing&nbsp;systems&nbsp;and&nbsp;and&nbsp;terminal&nbsp;programs.&nbsp;&nbsp;Users&nbsp;must&nbsp;be&nbsp;able&nbsp;to&nbsp;visually&nbsp;identify&nbsp;and&nbsp;select&nbsp;them,&nbsp;as&nbsp;text.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;This&nbsp;is&nbsp;significant&nbsp;because&nbsp;certain&nbsp;operations&nbsp;on&nbsp;paths-as-bytes&nbsp;will&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;inevitably&lt;/i&gt;&nbsp;fail.&nbsp;&nbsp;You&nbsp;can't&nbsp;type&nbsp;an&nbsp;invalidly-encoded&nbsp;pathname&nbsp;in&nbsp;your&nbsp;shell.&nbsp;&nbsp;If&nbsp;two&nbsp;paths&nbsp;differ&nbsp;by&nbsp;an&nbsp;incorrectly-encoded&nbsp;character&nbsp;you&nbsp;won't&nbsp;be&nbsp;able&nbsp;to&nbsp;visually&nbsp;distinguish&nbsp;between&nbsp;them&nbsp;without&nbsp;inspecting&nbsp;their&nbsp;contents.&nbsp;&nbsp;This&nbsp;is&nbsp;why&nbsp;OS&nbsp;X&nbsp;forces&nbsp;all&nbsp;paths&nbsp;to&nbsp;be&nbsp;UTF-8,&nbsp;and&nbsp;why&nbsp;paths&nbsp;are&nbsp;&quot;really&quot;&nbsp;unicode&nbsp;(UCS-2,&nbsp;precisely)&nbsp;on&nbsp;Windows.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;There's&nbsp;POSIX&nbsp;metadata&nbsp;which&nbsp;allows&nbsp;you&nbsp;to&nbsp;select&nbsp;an&nbsp;encoding;&nbsp;locale.&nbsp;&nbsp;But,&nbsp;locale&nbsp;is&nbsp;per-process&nbsp;state,&nbsp;and,&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;you&nbsp;can&nbsp;have&nbsp;multiple&nbsp;filesystems&nbsp;mounted&nbsp;simultaneously,&nbsp;it's&nbsp;impossible&nbsp;for&nbsp;this&nbsp;metadata&nbsp;to&nbsp;fully&nbsp;describe&nbsp;the&nbsp;state&nbsp;of&nbsp;any&nbsp;arbitrary&nbsp;path.&nbsp;&nbsp;The&nbsp;standard&nbsp;metadata&nbsp;is&nbsp;insufficient.&nbsp;&nbsp;This&nbsp;is&nbsp;why&nbsp;UI&nbsp;toolkits&nbsp;like&nbsp;GTK+&nbsp;have&nbsp;adopted&nbsp;the&nbsp;policy&nbsp;of&nbsp;&quot;ignore&nbsp;the&nbsp;locale,&nbsp;paths&nbsp;are&nbsp;UTF-8,&nbsp;deal&nbsp;with&nbsp;it&nbsp;ðŸ•¶&quot;.&nbsp;&nbsp;As&nbsp;far&nbsp;back&nbsp;as&nbsp;GTK2,&nbsp;non-utf-8&nbsp;path&nbsp;selection&nbsp;has&nbsp;been&nbsp;deprecated:&nbsp;&lt;&lt;a&nbsp;href=&quot;https://developer.gnome.org/gtk2/stable/GtkFileSelection.html#gtk-file-selection-set-filename&quot;&nbsp;class=&quot;&quot;&gt;https://developer.gnome.org/gtk2/stable/GtkFileSelection.html#gtk-file-selection-set-filename&lt;/a&gt;&gt;.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;While&nbsp;a&nbsp;mis-encoded&nbsp;path&nbsp;is&nbsp;a&nbsp;failure,&nbsp;there&nbsp;are&nbsp;ways&nbsp;to&nbsp;treat&nbsp;paths&nbsp;as&nbsp;a&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;data&nbsp;structure&lt;/i&gt;&nbsp;to&nbsp;allow&nbsp;for&nbsp;only&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;partial&lt;/i&gt;&nbsp;failure.&nbsp;&nbsp;They're&nbsp;a&nbsp;data&nbsp;structure&nbsp;because&nbsp;they&nbsp;must&nbsp;be&nbsp;in&nbsp;an&nbsp;encoding&nbsp;with&nbsp;no&nbsp;NULLs,&nbsp;which&nbsp;encode&nbsp;SOLIDUS&nbsp;as&nbsp;the&nbsp;octet&nbsp;0x2F,&nbsp;and&nbsp;so&nbsp;you&nbsp;can&nbsp;fail&nbsp;on&nbsp;each&nbsp;individual&nbsp;path&nbsp;component;&nbsp;if&nbsp;you're&nbsp;lucky&nbsp;you&nbsp;don't&nbsp;need&nbsp;to&nbsp;present&nbsp;all&nbsp;the&nbsp;components&nbsp;in&nbsp;the&nbsp;path&nbsp;to&nbsp;manipulate&nbsp;it.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;We&nbsp;don't&nbsp;do&nbsp;this&nbsp;in&nbsp;Twisted&nbsp;right&nbsp;now&nbsp;(as&nbsp;I&nbsp;was&nbsp;somewhat&nbsp;disappointed&nbsp;to&nbsp;discover&nbsp;while&nbsp;writing&nbsp;this),&nbsp;but&nbsp;we&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;should&lt;/i&gt;,&nbsp;and&nbsp;more&nbsp;importantly&nbsp;we&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;could;&lt;/i&gt;&nbsp;FilePath(b&quot;\xff&quot;).child(&quot;valid&quot;).asTextMode().basename()&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;could&lt;/i&gt;&nbsp;return&nbsp;u&quot;valid&quot;&nbsp;rather&nbsp;than&nbsp;returning&nbsp;an&nbsp;encoding&nbsp;error.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;To&nbsp;bring&nbsp;all&nbsp;this&nbsp;back&nbsp;to&nbsp;IRC&nbsp;though:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Mis-encoded&nbsp;IRC&nbsp;messages&nbsp;are&nbsp;not&nbsp;data&nbsp;structures;&nbsp;they're&nbsp;just&nbsp;strings.&nbsp;&nbsp;There's&nbsp;no&nbsp;opportunity&nbsp;for&nbsp;partial&nbsp;recovery&nbsp;beyond&nbsp;chardet&nbsp;and&nbsp;mojibake.&nbsp;&nbsp;In&nbsp;most&nbsp;cases,&nbsp;partial&nbsp;recovery&nbsp;requires&nbsp;configuration.&nbsp;&nbsp;Per-channel&nbsp;encodings,&nbsp;for&nbsp;example,&nbsp;or&nbsp;per-user,&nbsp;which&nbsp;have&nbsp;to&nbsp;be&nbsp;agreed&nbsp;upon&nbsp;out&nbsp;of&nbsp;band,&nbsp;in&nbsp;ways&nbsp;that&nbsp;IRC&nbsp;does&nbsp;not&nbsp;expose&nbsp;as&nbsp;metadata.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Given&nbsp;this&nbsp;situation,&nbsp;the&nbsp;only&nbsp;reasonable&nbsp;way&nbsp;forward&nbsp;as&nbsp;a&nbsp;community&nbsp;is&nbsp;to&nbsp;tell&nbsp;users&nbsp;that&nbsp;using&nbsp;anything&nbsp;other&nbsp;than&nbsp;UTF-8&nbsp;is&nbsp;a&nbsp;misconfiguration&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;be&nbsp;getting&nbsp;all&nbsp;those&nbsp;out-of-band&nbsp;agreements&nbsp;to&nbsp;switch&nbsp;to&nbsp;it.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-glyph&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
