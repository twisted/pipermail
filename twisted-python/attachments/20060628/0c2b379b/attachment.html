<tt>
&lt;div&gt;Hi,&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;I&nbsp;have&nbsp;been&nbsp;follow&nbsp;twisted&nbsp;for&nbsp;like&nbsp;half&nbsp;a&nbsp;year&nbsp;now,&nbsp;I&nbsp;have&nbsp;read&nbsp;the&nbsp;doc&nbsp;and&nbsp;the&nbsp;oreilly&nbsp;book,&nbsp;but&nbsp;i&nbsp;still&nbsp;cann't&nbsp;do&nbsp;some&nbsp;simple&nbsp;work&nbsp;in&nbsp;the&nbsp;twisted&nbsp;way.&nbsp;Could&nbsp;someone&nbsp;give&nbsp;me&nbsp;a&nbsp;hint?&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;Like&nbsp;today,&nbsp;i&nbsp;write&nbsp;this&nbsp;little&nbsp;code&nbsp;to&nbsp;follow&nbsp;my&nbsp;friends&nbsp;list&nbsp;on&nbsp;my&nbsp;msn&nbsp;space,&nbsp;and&nbsp;get&nbsp;their&nbsp;friends&nbsp;list,&nbsp;so&nbsp;on&nbsp;and&nbsp;so&nbsp;on,&nbsp;and&nbsp;maybe&nbsp;at&nbsp;last&nbsp;I&nbsp;can&nbsp;build&nbsp;a&nbsp;social&nbsp;relationship&nbsp;graph&nbsp;with&nbsp;it.&nbsp;The&nbsp;code&nbsp;is&nbsp;actually&nbsp;really&nbsp;navie,&nbsp;here&nbsp;it&nbsp;goes.&nbsp;Sorry&nbsp;for&nbsp;the&nbsp;ugliness&nbsp;of&nbsp;my&nbsp;code,&nbsp;please&nbsp;help&nbsp;me&nbsp;make&nbsp;it&nbsp;prettier:)<br>
&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;Thanks.&nbsp;Appologize&nbsp;for&nbsp;my&nbsp;poor&nbsp;English.&lt;/div&gt;<br>
&lt;div&gt;Jia&nbsp;Liu&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;p&gt;import&nbsp;re,&nbsp;sys,&nbsp;socket&lt;br&gt;import&nbsp;urllib&lt;br&gt;from&nbsp;sets&nbsp;import&nbsp;Set&lt;/p&gt;<br>
&lt;p&gt;socket.setdefaulttimeout&nbsp;=&nbsp;10&lt;br&gt;re_buddy_pre&nbsp;=&nbsp;re.compile(&quot;href=\&quot;(?:http://)?([^\.\&quot;]+)\.spaces.msn.com&quot;,&nbsp;re.IGNORECASE)&nbsp;&nbsp;#&nbsp;&lt;a&nbsp;href=&quot;http://nick.spaces.msn.com/&quot;&gt;http://nick.spaces.msn.com&lt;/a&gt;&lt;br&gt;<br>
re_buddy_post&nbsp;=&nbsp;re.compile(&quot;&lt;a&nbsp;href=&quot;http://spaces.msn.com/members/([^\&quot;&gt;spaces.msn.com/members/([^\&lt;/a&gt;&quot;\/]+)&quot;,&nbsp;re.IGNORECASE)&nbsp;#&nbsp;&lt;a&nbsp;href=&quot;http://spaces.msn.com/members/nick/&quot;&gt;http://spaces.msn.com/members/nick/<br>
&lt;/a&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&gt;all_buddies&nbsp;=&nbsp;Set()&lt;br&gt;relation_dict&nbsp;=&nbsp;{}&lt;/p&gt;<br>
&lt;p&gt;def&nbsp;get_buddy(page,&nbsp;buddy=None):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;page&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;buddy&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;all_buddies&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;buddies_of_this_page&nbsp;=&nbsp;Set()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;re_buddy&nbsp;in&nbsp;[re_buddy_pre,&nbsp;re_buddy_post]:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;m&nbsp;in&nbsp;re_buddy.finditer(page):<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buddies_of_this_page.add(m.group(1))&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;relation_dict[buddy]&nbsp;=&nbsp;buddies_of_this_page&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;buddies_of_this_page&lt;/p&gt;<br>
&lt;p&gt;def&nbsp;got(url,&nbsp;buddy=None):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;urllib.urlopen(url)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;f.read(),&nbsp;buddy&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;URL&nbsp;=&nbsp;&quot;&lt;a&nbsp;href=&quot;http://ayueer.spaces.msn.com/&quot;&gt;http://ayueer.spaces.msn.com/&lt;/a&gt;&quot;&lt;br&gt;(page,&nbsp;buddy)&nbsp;=&nbsp;got(URL,&nbsp;&quot;ayueer&quot;)<br>
&lt;/p&gt;<br>
&lt;p&gt;buddies_of_this_page&nbsp;=&nbsp;get_buddy(page,&nbsp;buddy)&lt;br&gt;all_buddies.add(&quot;ayueer&quot;)&lt;br&gt;next_to_visit&nbsp;=&nbsp;buddies_of_this_page.difference(all_buddies)&lt;/p&gt;<br>
&lt;p&gt;try:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;1:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#reactor.run()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#multi_buddy_factory(buddies_of_this_page)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;buddy&nbsp;in&nbsp;next_to_visit:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;&quot;&lt;a&nbsp;href=&quot;http://&quot;+buddy+&quot;.spaces.msn.com/&quot;&gt;<br>
http://&quot;+buddy+&quot;.spaces.msn.com/&lt;/a&gt;&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(page,&nbsp;buddy)&nbsp;=&nbsp;got(url,&nbsp;buddy)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buddies_of_this_page.update(get_buddy(page,&nbsp;buddy))&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all_buddies.update(next_to_visit)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next_to_visit&nbsp;=&nbsp;buddies_of_this_page.difference(all_buddies)&lt;br&gt;except&nbsp;KeyboardInterrupt:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;all_buddies&lt;/p&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;<br>
ÒøóÝÒ¹¾ÃÒóÇÚÅª£¬ÐÄÇÓ¿Õ·¿²»ÈÌ¹é&nbsp;&lt;/div&gt;<br>

</tt>
