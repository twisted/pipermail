<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Feb&nbsp;26,&nbsp;2010,&nbsp;at&nbsp;12:26&nbsp;AM,&nbsp;K.&nbsp;Richard&nbsp;Pixley&nbsp;wrote:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
Is&nbsp;it&nbsp;a&nbsp;reasonable&nbsp;workaround,&nbsp;or&nbsp;are&nbsp;there&nbsp;any&nbsp;nonobvious&nbsp;downsides&nbsp;to<br>
using&nbsp;&lt;tt&gt;reactor.waker.connectionLost(None)&lt;/tt&gt;&nbsp;&nbsp;either...&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Yes.&nbsp;&nbsp;Lots.&nbsp;&nbsp;This&nbsp;is&nbsp;an&nbsp;_extremely_&nbsp;hazardous&nbsp;area&nbsp;of&nbsp;Twisted&nbsp;to&nbsp;be&nbsp;mucking&nbsp;around&nbsp;with,&nbsp;as&nbsp;it&nbsp;may&nbsp;appear&nbsp;to&nbsp;work&nbsp;until&nbsp;it&nbsp;completely&nbsp;locks&nbsp;up&nbsp;your&nbsp;process.&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
a)&nbsp;immediately&nbsp;after&nbsp;instantiating&nbsp;my&nbsp;reactor,&nbsp;(assuming&nbsp;I&nbsp;don't&nbsp;need&nbsp;a<br>
waker),&nbsp;or...&lt;br&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;always&nbsp;need&nbsp;a&nbsp;waker.&nbsp;&nbsp;Twisted&nbsp;uses&nbsp;threads&nbsp;internally&nbsp;for&nbsp;several&nbsp;things:&nbsp;the&nbsp;two&nbsp;that&nbsp;come&nbsp;to&nbsp;mind&nbsp;immediately&nbsp;are&nbsp;name&nbsp;resolution&nbsp;and&nbsp;signal&nbsp;handling.&nbsp;&nbsp;If&nbsp;you&nbsp;remove&nbsp;the&nbsp;waker,&nbsp;you&nbsp;will&nbsp;get&nbsp;hangs&nbsp;and&nbsp;crashes.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;b)&nbsp;immediately&nbsp;before&nbsp;or&nbsp;after&nbsp;calling&nbsp;reactor.stop&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;need&nbsp;to&nbsp;wait&nbsp;for&nbsp;the&nbsp;reactor&nbsp;to&nbsp;fully&nbsp;shut&nbsp;down&nbsp;(i.e.&nbsp;'run'&nbsp;exits,&nbsp;not&nbsp;'stop'&nbsp;has&nbsp;been&nbsp;called)&nbsp;since&nbsp;service&nbsp;cleanup&nbsp;may&nbsp;be&nbsp;asynchronous&nbsp;and&nbsp;need&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;resolve&nbsp;DNS&nbsp;names&nbsp;and&nbsp;handle&nbsp;further&nbsp;signals&nbsp;during&nbsp;shutdown&nbsp;(especially&nbsp;SIGCHLD,&nbsp;as&nbsp;subprocesses&nbsp;will&nbsp;typically&nbsp;exit&nbsp;during&nbsp;shutdown).&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
I&nbsp;guess&nbsp;I'm&nbsp;asking&nbsp;why&nbsp;that&nbsp;hasn't&nbsp;been&nbsp;included&nbsp;in&nbsp;reactor.stop<br>
already.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;The&nbsp;implementation&nbsp;is&nbsp;tricky,&nbsp;and&nbsp;you&nbsp;have&nbsp;to&nbsp;audit&nbsp;all&nbsp;the&nbsp;internal&nbsp;state&nbsp;that&nbsp;the&nbsp;reactor&nbsp;keeps.&nbsp;&nbsp;To&nbsp;make&nbsp;matters&nbsp;worse,&nbsp;the&nbsp;test&nbsp;coverage&nbsp;for&nbsp;this&nbsp;area&nbsp;of&nbsp;Twisted&nbsp;is&nbsp;worse&nbsp;than&nbsp;others,&nbsp;because&nbsp;it's&nbsp;old&nbsp;code&nbsp;that&nbsp;works&nbsp;well&nbsp;enough&nbsp;and&nbsp;therefore&nbsp;(A)&nbsp;was&nbsp;written&nbsp;before&nbsp;Twisted&nbsp;had&nbsp;strong&nbsp;quality&nbsp;requirements&nbsp;such&nbsp;as&nbsp;complete&nbsp;test&nbsp;coverage,&nbsp;and&nbsp;(B)&nbsp;since&nbsp;it&nbsp;works&nbsp;well&nbsp;enough,&nbsp;it&nbsp;hasn't&nbsp;been&nbsp;extensively&nbsp;modified&nbsp;and&nbsp;therefore&nbsp;hasn't&nbsp;had&nbsp;to&nbsp;be&nbsp;re-examined&nbsp;to&nbsp;improve&nbsp;its&nbsp;test&nbsp;coverage&nbsp;to&nbsp;100%.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;please,&nbsp;contribute&nbsp;patches&nbsp;to&nbsp;fix&nbsp;it!&nbsp;&nbsp;It&nbsp;isn't&nbsp;*that*&nbsp;hard,&nbsp;mostly&nbsp;it's&nbsp;just&nbsp;that&nbsp;we've&nbsp;had&nbsp;lots&nbsp;of&nbsp;other&nbsp;stuff&nbsp;to&nbsp;do.&nbsp;&nbsp;(See&nbsp;the&nbsp;weekly&nbsp;emails&nbsp;from&nbsp;trac&nbsp;about&nbsp;how&nbsp;many&nbsp;open&nbsp;tickets&nbsp;there&nbsp;are!)&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
