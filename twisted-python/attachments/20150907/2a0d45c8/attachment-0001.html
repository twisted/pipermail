<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;Aug&nbsp;31,&nbsp;2015,&nbsp;at&nbsp;11:48&nbsp;PM,&nbsp;Zuhaib&nbsp;Siddique&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:zuhaib@hipchat.com&quot;&nbsp;class=&quot;&quot;&gt;zuhaib@hipchat.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Hey&nbsp;all,&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;Hi&nbsp;Zuhaib!&nbsp;&nbsp;Thanks&nbsp;for&nbsp;writing.&lt;/span&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;I&nbsp;am&nbsp;looking&nbsp;at&nbsp;using&nbsp;HAProxy&nbsp;in&nbsp;front&nbsp;of&nbsp;Twisted&nbsp;for&nbsp;TCP&nbsp;connection&nbsp;and&nbsp;need&nbsp;to&nbsp;pass&nbsp;the&nbsp;source&nbsp;IP&nbsp;along.&nbsp;&nbsp;We&nbsp;are&nbsp;currently&nbsp;looking&nbsp;at&nbsp;hacking&nbsp;tcp.py&nbsp;to&nbsp;add&nbsp;support&nbsp;for&nbsp;this:&nbsp;&lt;a&nbsp;href=&quot;http://www.haproxy.org/download/1.5/doc/proxy-&quot;&nbsp;class=&quot;&quot;&gt;http://www.haproxy.org/download/1.5/doc/proxy-&lt;/a&gt;protocol.txt&nbsp;but&nbsp;wondering&nbsp;if&nbsp;this&nbsp;is&nbsp;something&nbsp;someone&nbsp;is&nbsp;already&nbsp;working&nbsp;on&nbsp;for&nbsp;twisted&nbsp;or&nbsp;maybe&nbsp;I&nbsp;dont&nbsp;need&nbsp;to&nbsp;hack&nbsp;tcp.py.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;am&nbsp;not&nbsp;aware&nbsp;of&nbsp;an&nbsp;implementation&nbsp;of&nbsp;this&nbsp;protocol,&nbsp;but&nbsp;it&nbsp;looks&nbsp;very&nbsp;interesting!&nbsp;&nbsp;The&nbsp;usual&nbsp;argument&nbsp;I&nbsp;hear&nbsp;for&nbsp;load-balancing&nbsp;HTTP&nbsp;rather&nbsp;than&nbsp;TCP&nbsp;is&nbsp;that&nbsp;you&nbsp;lose&nbsp;information&nbsp;about&nbsp;the&nbsp;network&nbsp;protocol&nbsp;you're&nbsp;speaking&nbsp;that&nbsp;would&nbsp;be&nbsp;preserved&nbsp;by&nbsp;the&nbsp;&quot;Forwarded&quot;&nbsp;or&nbsp;&quot;X-Forwarded-For&quot;&nbsp;header.&nbsp;&nbsp;But&nbsp;if&nbsp;Twisted&nbsp;supported&nbsp;this&nbsp;protocol&nbsp;then&nbsp;it&nbsp;could&nbsp;live&nbsp;behind&nbsp;haproxy&nbsp;with&nbsp;no&nbsp;loss&nbsp;of&nbsp;information,&nbsp;regardless&nbsp;of&nbsp;protocol!&nbsp;&nbsp;And&nbsp;if&nbsp;it&nbsp;had&nbsp;a&nbsp;server-side&nbsp;version&nbsp;of&nbsp;this&nbsp;it&nbsp;could&nbsp;load-balance&nbsp;other&nbsp;similarly&nbsp;equipped&nbsp;software.&nbsp;&nbsp;Exciting&nbsp;possibilities&nbsp;all&nbsp;around.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Hacking&nbsp;tcp.py&nbsp;is&nbsp;definitely&nbsp;the&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;wrong&lt;/i&gt;&nbsp;way&nbsp;to&nbsp;go&nbsp;about&nbsp;implementing&nbsp;it,&nbsp;though.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;The&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;right&lt;/i&gt;&nbsp;way&nbsp;to&nbsp;go&nbsp;about&nbsp;this&nbsp;would&nbsp;be&nbsp;to&nbsp;implement&nbsp;a&nbsp;transceiver:&nbsp;something&nbsp;that&nbsp;implements&nbsp;a&nbsp;protocol&nbsp;for&nbsp;its&nbsp;transport,&nbsp;and&nbsp;implements&nbsp;a&nbsp;transport&nbsp;for&nbsp;another&nbsp;protocol.&nbsp;&nbsp;The&nbsp;best&nbsp;example&nbsp;of&nbsp;this&nbsp;within&nbsp;Twisted&nbsp;right&nbsp;now&nbsp;is&nbsp;twisted.protocols.tls,&nbsp;the&nbsp;OpenSSL&nbsp;integration&nbsp;that&nbsp;superseded&nbsp;our&nbsp;much&nbsp;grosser,&nbsp;less&nbsp;flexible&nbsp;hacking&nbsp;of&nbsp;tcp.py.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;So&nbsp;for&nbsp;this&nbsp;proxy&nbsp;protocol,&nbsp;you'd&nbsp;have&nbsp;a&nbsp;protocol&nbsp;that&nbsp;waited&nbsp;until&nbsp;it&nbsp;received&nbsp;the&nbsp;full&nbsp;PROXY&nbsp;protocol&nbsp;header&nbsp;(whether&nbsp;text-based&nbsp;or&nbsp;binary)&nbsp;and&nbsp;implement&nbsp;ITCPTransport&nbsp;to&nbsp;have&nbsp;values&nbsp;in&nbsp;getHost()&nbsp;and&nbsp;getPeer()&nbsp;that&nbsp;correspond&nbsp;to&nbsp;the&nbsp;values&nbsp;received&nbsp;from&nbsp;the&nbsp;PROXY&nbsp;message.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Does&nbsp;that&nbsp;make&nbsp;sense?&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;If&nbsp;I&nbsp;have&nbsp;an&nbsp;idle&nbsp;moment&nbsp;I&nbsp;might&nbsp;try&nbsp;my&nbsp;hand&nbsp;at&nbsp;an&nbsp;implementation&nbsp;myself,&nbsp;but&nbsp;I&nbsp;am&nbsp;not&nbsp;always&nbsp;super&nbsp;reliable&nbsp;;-).&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;Thanks&lt;br&nbsp;class=&quot;&quot;&gt;Zuhaib&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-glyph&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
