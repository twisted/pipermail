<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Jun&nbsp;5,&nbsp;2019,&nbsp;at&nbsp;4:52&nbsp;AM,&nbsp;Thomas&nbsp;Westfeld&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:thomas.westfeld@currenta.de&quot;&nbsp;class=&quot;&quot;&gt;thomas.westfeld@currenta.de&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Dear&nbsp;all,&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Hi&nbsp;Thomas!&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;am&nbsp;experiencing&nbsp;a&nbsp;problem&nbsp;with&nbsp;a&nbsp;custom&nbsp;credential&nbsp;checker&nbsp;for&nbsp;twisted&nbsp;cred&nbsp;based&nbsp;on&nbsp;an&nbsp;external&nbsp;server.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;My&nbsp;problem&nbsp;is,&nbsp;that&nbsp;the&nbsp;Failure&nbsp;in&nbsp;the&nbsp;last&nbsp;line&nbsp;does&nbsp;not&nbsp;trigger&nbsp;the&nbsp;Errback&nbsp;of&nbsp;the&nbsp;deferred&nbsp;of&nbsp;the&nbsp;calling&nbsp;method&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;login&nbsp;failed.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;surprising,&nbsp;because&nbsp;unless&nbsp;something&nbsp;else&nbsp;is&nbsp;broken,&nbsp;the&nbsp;example&nbsp;you&nbsp;gave&nbsp;definitely&nbsp;behaves&nbsp;like&nbsp;that.&nbsp;&nbsp;Which&nbsp;suggests&nbsp;to&nbsp;me&nbsp;that&nbsp;something&nbsp;else&nbsp;is&nbsp;broken.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;also&nbsp;tried&nbsp;to&nbsp;raise&nbsp;the&nbsp;error&nbsp;but&nbsp;this&nbsp;does&nbsp;not&nbsp;work&nbsp;for&nbsp;me.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;should&nbsp;also&nbsp;work.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;also&nbsp;tried&nbsp;to&nbsp;return&nbsp;a&nbsp;defer.fail(error.UnauthorizedLogin()).&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This,&nbsp;however,&nbsp;is&nbsp;a&nbsp;mistake;&nbsp;you&nbsp;can't&nbsp;returnValue(someDeferred())&nbsp;in&nbsp;inlineCallbacks;&nbsp;you&nbsp;have&nbsp;to&nbsp;wait&nbsp;for&nbsp;deferreds&nbsp;with&nbsp;'yield'.&nbsp;&nbsp;So&nbsp;this&nbsp;failing&nbsp;is&nbsp;expected.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;am&nbsp;now&nbsp;a&nbsp;bit&nbsp;puzzled&nbsp;that&nbsp;it&nbsp;could&nbsp;be&nbsp;problematic,&nbsp;because&nbsp;the&nbsp;@inlineCallbacks&nbsp;decorator&nbsp;makes&nbsp;the&nbsp;function&nbsp;itself&nbsp;return&nbsp;a&nbsp;deferred&nbsp;already.&nbsp;It&nbsp;would&nbsp;be&nbsp;great&nbsp;to&nbsp;have&nbsp;an&nbsp;inlineCallbacked&nbsp;method&nbsp;as&nbsp;getAvatarID&nbsp;method,&nbsp;because&nbsp;I&nbsp;am&nbsp;doing&nbsp;some&nbsp;networking&nbsp;calls&nbsp;in&nbsp;it&nbsp;which&nbsp;are&nbsp;all&nbsp;returning&nbsp;deferreds.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Do&nbsp;I&nbsp;have&nbsp;to&nbsp;rewrite&nbsp;the&nbsp;getAvatarID&nbsp;implementation&nbsp;to&nbsp;not&nbsp;use&nbsp;inlineCallbacks?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;No,&nbsp;this&nbsp;should&nbsp;indeed&nbsp;work&nbsp;as&nbsp;you&nbsp;describe.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;would&nbsp;be&nbsp;helpful&nbsp;if&nbsp;you&nbsp;could&nbsp;construct&nbsp;the&nbsp;most&nbsp;minimal&nbsp;possible&nbsp;example&nbsp;of&nbsp;your&nbsp;issue.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;example,&nbsp;here's&nbsp;a&nbsp;super&nbsp;minimal&nbsp;illustration&nbsp;of&nbsp;the&nbsp;fact&nbsp;that&nbsp;the&nbsp;two&nbsp;techniques&nbsp;that&nbsp;should&nbsp;work,&nbsp;do&nbsp;in&nbsp;fact&nbsp;work:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;from&nbsp;twisted.internet.defer&nbsp;import&nbsp;inlineCallbacks,&nbsp;returnValue,&nbsp;fail&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;from&nbsp;twisted.python.failure&nbsp;import&nbsp;Failure&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;from&nbsp;twisted.cred.error&nbsp;import&nbsp;UnauthorizedLogin&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;@inlineCallbacks&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;def&nbsp;returnFailure():&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;0:&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;returnValue(Failure(UnauthorizedLogin()))&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;@inlineCallbacks&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;def&nbsp;returnFailResult():&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;0:&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;returnValue(fail(UnauthorizedLogin()))&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;@inlineCallbacks&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;def&nbsp;raiseException():&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;0:&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;UnauthorizedLogin()&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;returnFailure().addErrback(lambda&nbsp;eb:&nbsp;print(eb))&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;#&nbsp;returnFailResult().addErrback(lambda&nbsp;eb:&nbsp;print(eb))&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;raiseException().addErrback(lambda&nbsp;eb:&nbsp;print(eb))&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Could&nbsp;you&nbsp;reduce&nbsp;your&nbsp;checker&nbsp;to&nbsp;something&nbsp;suitably&nbsp;minimal&nbsp;that&nbsp;can&nbsp;be&nbsp;run&nbsp;directly&nbsp;without&nbsp;actually&nbsp;talking&nbsp;to&nbsp;your&nbsp;auth&nbsp;backend?&nbsp;&nbsp;My&nbsp;guess&nbsp;is&nbsp;that&nbsp;you'll&nbsp;discover&nbsp;a&nbsp;bug&nbsp;as&nbsp;you're&nbsp;doing&nbsp;this,&nbsp;but&nbsp;the&nbsp;possibility&nbsp;definitely&nbsp;remains&nbsp;that&nbsp;there's&nbsp;an&nbsp;issue&nbsp;with&nbsp;Twisted;&nbsp;I&nbsp;just&nbsp;can't&nbsp;guess&nbsp;what&nbsp;it&nbsp;might&nbsp;be&nbsp;without&nbsp;more&nbsp;information.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Thanks&nbsp;for&nbsp;using&nbsp;Twisted,&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-g&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
