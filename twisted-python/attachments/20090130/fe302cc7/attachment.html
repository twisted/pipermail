<tt>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;C++&nbsp;library&nbsp;is&nbsp;completely&nbsp;independent&nbsp;of&nbsp;Python&nbsp;and&nbsp;Twisted&nbsp;but&nbsp;it&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;work&nbsp;with&nbsp;them.&nbsp;One&nbsp;of&nbsp;the&nbsp;initial&nbsp;uses&nbsp;of&nbsp;it,&nbsp;in&nbsp;fact,&nbsp;was&nbsp;to&nbsp;run&nbsp;a&nbsp;Python&nbsp;interpreter&nbsp;(using&nbsp;Twisted)&nbsp;in&nbsp;a&nbsp;dedicated&nbsp;C++&nbsp;thread&nbsp;and&nbsp;use&nbsp;it&nbsp;to&nbsp;direct&nbsp;the&nbsp;actions&nbsp;of&nbsp;all&nbsp;the&nbsp;other&nbsp;threads&nbsp;in&nbsp;the&nbsp;process.&nbsp;&lt;br&gt;<br>
&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;way&nbsp;I&nbsp;did&nbsp;it&nbsp;is&nbsp;this:&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Spawn&nbsp;a&nbsp;C++&nbsp;thread&nbsp;to&nbsp;run&nbsp;the&nbsp;Python&nbsp;interpreter&nbsp;inside&nbsp;of.&nbsp;All&nbsp;use&nbsp;of&nbsp;the&nbsp;Python&nbsp;C-API&nbsp;must&nbsp;be&nbsp;done&nbsp;from&nbsp;within&nbsp;this&nbsp;thread&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;avoid&nbsp;dealing&nbsp;with&nbsp;the&nbsp;Global&nbsp;Interpreter&nbsp;Lock&nbsp;(remember&nbsp;Python&nbsp;itself&nbsp;is&nbsp;a&nbsp;single-threaded&nbsp;application).&nbsp;Other&nbsp;C++&nbsp;threads&nbsp;needing&nbsp;to&nbsp;call&nbsp;a&nbsp;Python&nbsp;C-API&nbsp;function&nbsp;can&nbsp;do&nbsp;so&nbsp;using&nbsp;a&nbsp;DeferredCommand&nbsp;object&nbsp;that&nbsp;wraps&nbsp;the&nbsp;call&nbsp;they&nbsp;want&nbsp;to&nbsp;make.&nbsp;Hand&nbsp;this&nbsp;object&nbsp;to&nbsp;the&nbsp;Python&nbsp;thread&nbsp;for&nbsp;execution&nbsp;and&nbsp;use&nbsp;the&nbsp;Deferred&nbsp;mechanism&nbsp;to&nbsp;get&nbsp;the&nbsp;answer&nbsp;back&nbsp;to&nbsp;the&nbsp;original&nbsp;thread.....&nbsp;Basically,&nbsp;you&nbsp;turn&nbsp;the&nbsp;interpreter&nbsp;into&nbsp;one&nbsp;big&nbsp;Active&nbsp;Object&nbsp;as&nbsp;per&nbsp;the&nbsp;standard&nbsp;design&nbsp;pattern.&lt;br&gt;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Use&nbsp;the&nbsp;Python&nbsp;C-API&nbsp;to&nbsp;import&nbsp;a&nbsp;Python&nbsp;module&nbsp;you&nbsp;wrote&nbsp;that&nbsp;will&nbsp;initialize&nbsp;Twisted&nbsp;and&nbsp;create&nbsp;a&nbsp;pair&nbsp;of&nbsp;TCP&nbsp;sockets&nbsp;that&nbsp;are&nbsp;connected&nbsp;to&nbsp;each&nbsp;other.&nbsp;Then&nbsp;use&nbsp;the&nbsp;C-API&nbsp;to&nbsp;get&nbsp;the&nbsp;OS-level&nbsp;file&nbsp;descriptor&nbsp;to&nbsp;one&nbsp;of&nbsp;the&nbsp;sockets.&nbsp;The&nbsp;purpose&nbsp;of&nbsp;this&nbsp;is&nbsp;to&nbsp;provide&nbsp;a&nbsp;mechanism&nbsp;for&nbsp;other&nbsp;C++&nbsp;threads&nbsp;to&nbsp;inform&nbsp;the&nbsp;Twisted&nbsp;reactor&nbsp;that&nbsp;there&#39;s&nbsp;something&nbsp;in&nbsp;the&nbsp;C++&nbsp;world&nbsp;it&nbsp;needs&nbsp;to&nbsp;do.&nbsp;When&nbsp;one&nbsp;of&nbsp;those&nbsp;DeferredCommands&nbsp;in&nbsp;step&nbsp;one&nbsp;is&nbsp;given&nbsp;to&nbsp;the&nbsp;Python&nbsp;thread,&nbsp;the&nbsp;last&nbsp;thing&nbsp;the&nbsp;delivering&nbsp;thread&nbsp;needs&nbsp;to&nbsp;do&nbsp;is&nbsp;call&nbsp;a&nbsp;function&nbsp;that&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte&nbsp;to&nbsp;the&nbsp;TCP&nbsp;socket.&nbsp;This&nbsp;will&nbsp;cause&nbsp;the&nbsp;Twisted&nbsp;reactor&nbsp;in&nbsp;the&nbsp;Python&nbsp;thread&nbsp;to&nbsp;wake&nbsp;up&nbsp;from&nbsp;it&#39;s&nbsp;&#39;select&#39;&nbsp;call&nbsp;and&nbsp;dispatch&nbsp;a&nbsp;handler.&nbsp;This&nbsp;handler&nbsp;can&nbsp;then&nbsp;execute&nbsp;a&nbsp;C++&nbsp;function&nbsp;you&nbsp;registered&nbsp;with&nbsp;the&nbsp;C-API.&nbsp;Once&nbsp;back&nbsp;in&nbsp;the&nbsp;C++&nbsp;world&nbsp;and&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;Python&nbsp;thread,&nbsp;&nbsp;you&nbsp;can&nbsp;dispatch&nbsp;any&nbsp;of&nbsp;the&nbsp;DeferredCommands&nbsp;sitting&nbsp;in&nbsp;the&nbsp;thread&#39;s&nbsp;queue.&lt;br&gt;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;don&#39;t&nbsp;currently&nbsp;have&nbsp;a&nbsp;mechanism&nbsp;for&nbsp;tying&nbsp;a&nbsp;Twisted&nbsp;Deferred&nbsp;directly&nbsp;to&nbsp;one&nbsp;of&nbsp;the&nbsp;C++&nbsp;deferreds&nbsp;since&nbsp;I&nbsp;haven&#39;t&nbsp;yet&nbsp;found&nbsp;a&nbsp;use-case&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;do&nbsp;so.&nbsp;It&#39;s&nbsp;probably&nbsp;possible&nbsp;though.&lt;br&gt;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;As&nbsp;for&nbsp;using&nbsp;the&nbsp;C++&nbsp;deferreds&nbsp;with&nbsp;boost&#39;s&nbsp;asio...&nbsp;I&nbsp;haven&#39;t&nbsp;used&nbsp;asio&nbsp;yet&nbsp;but&nbsp;a&nbsp;quick&nbsp;read&nbsp;through&nbsp;the&nbsp;API&nbsp;makes&nbsp;it&nbsp;looks&nbsp;like&nbsp;an&nbsp;almost&nbsp;perfect&nbsp;match&nbsp;for&nbsp;these&nbsp;deferreds.&nbsp;In&nbsp;fact,&nbsp;I&#39;d&nbsp;like&nbsp;to&nbsp;eventually&nbsp;put&nbsp;this&nbsp;code&nbsp;up&nbsp;for&nbsp;consideration&nbsp;by&nbsp;the&nbsp;boost&nbsp;community&nbsp;for&nbsp;eventually&nbsp;including&nbsp;something&nbsp;like&nbsp;it&nbsp;in&nbsp;boost.&nbsp;I&nbsp;*highly*&nbsp;doubt&nbsp;they&#39;d&nbsp;want&nbsp;to&nbsp;use&nbsp;the&nbsp;code&nbsp;I&#39;ve&nbsp;written&nbsp;but&nbsp;it&nbsp;might&nbsp;serve&nbsp;as&nbsp;a&nbsp;good&nbsp;proof-of-concept&nbsp;at&nbsp;least.&lt;br&gt;<br>
&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;Tom&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Jan&nbsp;30,&nbsp;2009&nbsp;at&nbsp;12:09&nbsp;AM,&nbsp;V&nbsp;S&nbsp;P&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:toreason@fastmail.fm&quot;&gt;toreason@fastmail.fm&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Hi,&nbsp;this&nbsp;is&nbsp;very&nbsp;interesting&lt;br&gt;<br>
(&nbsp;am&nbsp;I&nbsp;currently&nbsp;testing&nbsp;out&nbsp;C++&nbsp;web&nbsp;server&nbsp;(using&nbsp;boost&nbsp;asio)&nbsp;called&lt;br&gt;<br>
pion&lt;br&gt;<br>
to&nbsp;see&nbsp;if&nbsp;can&nbsp;suit&nbsp;my&nbsp;needs&nbsp;(it&nbsp;is&nbsp;a&nbsp;multi-threaded&nbsp;async&nbsp;IO&nbsp;generic&lt;br&gt;<br>
server&nbsp;and&nbsp;boost&nbsp;asio&nbsp;uses&nbsp;the&nbsp;best&nbsp;async&nbsp;APIs&nbsp;for&nbsp;each&nbsp;OS&nbsp;(including&lt;br&gt;<br>
kques&nbsp;for&nbsp;freebsd&nbsp;for&nbsp;example).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;looked&nbsp;at&nbsp;the&nbsp;example&nbsp;threads.cpp&nbsp;--&nbsp;but&nbsp;could&nbsp;not&nbsp;figure&nbsp;out&nbsp;--&nbsp;how&lt;br&gt;<br>
would&nbsp;it&nbsp;integrate&nbsp;with&nbsp;Twisted&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
thanks&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;&lt;br&gt;<br>
On&nbsp;Thu,&nbsp;29&nbsp;Jan&nbsp;2009&nbsp;12:21:36&nbsp;-0800,&nbsp;&quot;Tom&nbsp;Cocagne&quot;&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;mailto:tom.cocagne@gmail.com&quot;&gt;tom.cocagne@gmail.com&lt;/a&gt;&gt;&nbsp;said:&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;question&nbsp;of&nbsp;whether&nbsp;anyone&nbsp;had&nbsp;developed&nbsp;a&nbsp;C++&nbsp;implementation&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;Twisted&#39;s&nbsp;Deferreds&nbsp;has&nbsp;cropped&nbsp;up&nbsp;on&nbsp;this&nbsp;list&nbsp;several&nbsp;times&nbsp;over&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;last&lt;br&gt;<br>
&gt;&nbsp;few&nbsp;years.&nbsp;To&nbsp;date,&nbsp;I&#39;ve&nbsp;unfortunately&nbsp;been&nbsp;forced&nbsp;to&nbsp;sit&nbsp;on&nbsp;an&lt;br&gt;<br>
&gt;&nbsp;implementation&nbsp;I&nbsp;developed&nbsp;several&nbsp;years&nbsp;ago&nbsp;for&nbsp;the&nbsp;Department&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;Defense.&lt;br&gt;<br>
&gt;&nbsp;Due&nbsp;to&nbsp;some&nbsp;rather&nbsp;draconian&nbsp;IP&nbsp;&amp;&nbsp;security&nbsp;policies,&nbsp;it&#39;s&nbsp;taken&nbsp;an&lt;br&gt;<br>
&gt;&nbsp;exceptionally&nbsp;long&nbsp;time&nbsp;to&nbsp;get&nbsp;the&nbsp;code&nbsp;released.&nbsp;I&#39;m&nbsp;happy&nbsp;to&nbsp;announce&lt;br&gt;<br>
&gt;&nbsp;though&nbsp;that&nbsp;I&nbsp;finally&nbsp;managed&nbsp;to&nbsp;obtain&nbsp;release&nbsp;authorization&nbsp;for&nbsp;it&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;that&nbsp;the&nbsp;code&nbsp;now&nbsp;has&nbsp;a&nbsp;new&nbsp;home&nbsp;on&nbsp;Sourceforge.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As&nbsp;C++&nbsp;has&nbsp;differing&nbsp;language&nbsp;features,&nbsp;the&nbsp;API&nbsp;of&nbsp;the&nbsp;C++&nbsp;deferreds&lt;br&gt;<br>
&gt;&nbsp;isn&#39;t&nbsp;identical&nbsp;to&nbsp;those&nbsp;of&nbsp;Twisted&#39;s&nbsp;but&nbsp;most&nbsp;of&nbsp;the&nbsp;key&nbsp;concepts&nbsp;mapped&lt;br&gt;<br>
&gt;&nbsp;over&nbsp;pretty&nbsp;well.&nbsp;Additionally,&nbsp;this&nbsp;implementation&nbsp;has&nbsp;a&nbsp;few&nbsp;design&lt;br&gt;<br>
&gt;&nbsp;extensions&nbsp;to&nbsp;facilitate&nbsp;the&nbsp;development&nbsp;multi-threaded&nbsp;C++&nbsp;applications.&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;multi-threaded&nbsp;aspect&nbsp;grew&nbsp;almost&nbsp;accidentally&nbsp;out&nbsp;of&nbsp;the&nbsp;original&lt;br&gt;<br>
&gt;&nbsp;single-threaded&nbsp;design&nbsp;but,&nbsp;since&nbsp;then,&nbsp;it&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&lt;br&gt;<br>
&gt;&nbsp;extraordinarily&lt;br&gt;<br>
&gt;&nbsp;useful&nbsp;for&nbsp;simplifying&nbsp;several&nbsp;multi-threaded&nbsp;applications&nbsp;I&#39;ve&nbsp;worked&lt;br&gt;<br>
&gt;&nbsp;on.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;library&nbsp;is,&nbsp;however,&nbsp;rather&nbsp;complex.&nbsp;In&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;large&lt;br&gt;<br>
&gt;&nbsp;part,&nbsp;this&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;effort&nbsp;required&nbsp;to&nbsp;work&nbsp;around&nbsp;the&nbsp;inherent&lt;br&gt;<br>
&gt;&nbsp;inflexibility&nbsp;of&nbsp;the&nbsp;C++&nbsp;type&nbsp;system.&nbsp;The&nbsp;Function,&nbsp;Bind,&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;Meta-Programming&nbsp;libraries&nbsp;found&nbsp;in&nbsp;Boost&nbsp;have&nbsp;gone&nbsp;a&nbsp;long&nbsp;way&nbsp;towards&lt;br&gt;<br>
&gt;&nbsp;simplify&nbsp;the&nbsp;implementation&nbsp;though&nbsp;(my&nbsp;original&nbsp;Loki-based&nbsp;attempt&nbsp;was&lt;br&gt;<br>
&gt;&nbsp;almost&nbsp;incomprehensible&nbsp;even&nbsp;to&nbsp;me&nbsp;;-).&nbsp;The&nbsp;library&nbsp;is&nbsp;fully&nbsp;documented&lt;br&gt;<br>
&gt;&nbsp;though&nbsp;so&nbsp;as&nbsp;long&nbsp;as&nbsp;you&#39;re&nbsp;reasonably&nbsp;comfortable&nbsp;with&nbsp;C++&nbsp;templates,&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;should&nbsp;be&nbsp;understandable.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;far,&nbsp;the&nbsp;library&nbsp;has&nbsp;only&nbsp;been&nbsp;exposed&nbsp;to&nbsp;a&nbsp;handful&nbsp;of&nbsp;individuals&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;review.&nbsp;I&#39;d&nbsp;be&nbsp;interested&nbsp;to&nbsp;hear&nbsp;the&nbsp;comments&nbsp;anyone&nbsp;has&nbsp;about&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;design&nbsp;and/or&nbsp;implementation&nbsp;approach.&nbsp;The&nbsp;code&nbsp;is&nbsp;available&nbsp;at:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://deferred.svn.sourceforge.net/viewvc/deferred/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://deferred.svn.sourceforge.net/viewvc/deferred/&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cheers,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tom&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;--&lt;br&gt;<br>
&nbsp;&nbsp;V&nbsp;S&nbsp;P&lt;br&gt;<br>
&nbsp;&nbsp;&lt;a&nbsp;href=&quot;mailto:toreason@fastmail.fm&quot;&gt;toreason@fastmail.fm&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.fastmail.fm&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.fastmail.fm&lt;/a&gt;&nbsp;-&nbsp;Accessible&nbsp;with&nbsp;your&nbsp;email&nbsp;software&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;over&nbsp;the&nbsp;web&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
