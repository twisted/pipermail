<tt>
Problem&nbsp;send&nbsp;email&nbsp;through&nbsp;gmail&nbsp;with&nbsp;an&nbsp;attachment&lt;br&gt;&lt;br&gt;Any&nbsp;help&nbsp;is&nbsp;appreciated&lt;br&gt;&lt;br&gt;Thanks&lt;br&gt;Alvin&lt;br&gt;&lt;br&gt;&quot;&quot;&quot;&nbsp;Does&nbsp;not&nbsp;work&lt;br&gt;&lt;br&gt;&quot;&quot;&quot;&lt;br&gt;from&nbsp;twisted.internet.ssl&nbsp;import&nbsp;ClientContextFactory&lt;br&gt;<br>
<br>
from&nbsp;twisted.internet.defer&nbsp;import&nbsp;Deferred&lt;br&gt;from&nbsp;twisted.mail.smtp&nbsp;import&nbsp;ESMTPSenderFactory&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;import&nbsp;smtplib,&nbsp;sys,&nbsp;MimeWriter,&nbsp;mimetypes,&nbsp;mimetools,&nbsp;base64&lt;br&gt;&lt;br&gt;import&nbsp;StringIO&lt;br&gt;<br>
<br>
import&nbsp;time&lt;br&gt;import&nbsp;os&lt;br&gt;&lt;br&gt;sender&nbsp;=&nbsp;&#39;&lt;a&nbsp;href=&quot;mailto:acct@gmail.com&quot;&gt;acct@gmail.com&lt;/a&gt;&#39;&lt;br&gt;senderpw&nbsp;=&nbsp;&#39;password&#39;&lt;br&gt;to&nbsp;=&nbsp;&#39;&lt;a&nbsp;href=&quot;mailto:alvinwang@gmail.org&quot;&gt;alvinwang@gmail.org&lt;/a&gt;&#39;&lt;br&gt;subject&nbsp;=&nbsp;&#39;gc&#39;&nbsp;+&nbsp;str(time.time())&lt;br&gt;<br>
<br>
text&nbsp;=&nbsp;&#39;Message&nbsp;Text&nbsp;Body&#39;&lt;br&gt;&lt;br&gt;attachments&nbsp;=&nbsp;[&quot;/home/alvin/Pictures/alvin.jpg&quot;,&nbsp;&quot;/home/alvin/Pictures/badlogo.gif&quot;]&lt;br&gt;&lt;br&gt;contextFactory&nbsp;=&nbsp;ClientContextFactory()&lt;br&gt;result&nbsp;=&nbsp;Deferred()&lt;br&gt;<br>
&lt;br&gt;<br>
message&nbsp;=&nbsp;StringIO.StringIO()&lt;br&gt;writer&nbsp;=&nbsp;MimeWriter.MimeWriter(message)&lt;br&gt;writer.addheader(&#39;To&#39;,&nbsp;to)&lt;br&gt;writer.addheader(&#39;From&#39;,&nbsp;sender)&lt;br&gt;writer.addheader(&#39;Subject&#39;,&nbsp;subject)&lt;br&gt;writer.addheader(&#39;MIME-Version&#39;,&nbsp;&#39;1.0&#39;)&lt;br&gt;<br>
<br>
writer.startmultipartbody(&#39;mixed&#39;)&lt;br&gt;&lt;br&gt;part&nbsp;=&nbsp;writer.nextpart()&lt;br&gt;body&nbsp;=&nbsp;part.startbody(&#39;text/plain&#39;)&lt;br&gt;part.flushheaders()&lt;br&gt;body.write(text)&lt;br&gt;&lt;br&gt;#&nbsp;now&nbsp;add&nbsp;the&nbsp;attachments&lt;br&gt;if&nbsp;attachments&nbsp;is&nbsp;not&nbsp;None:&lt;br&gt;<br>
<br>
   &nbsp;for&nbsp;a&nbsp;in&nbsp;attachments:&lt;br&gt;   &nbsp;   &nbsp;filename&nbsp;=&nbsp;os.path.basename(a)&lt;br&gt;   &nbsp;   &nbsp;ctype,&nbsp;encoding&nbsp;=&nbsp;mimetypes.guess_type(a)&lt;br&gt;   &nbsp;   &nbsp;if&nbsp;ctype&nbsp;is&nbsp;None:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;ctype&nbsp;=&nbsp;&#39;application/octet-stream&#39;&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;encoding&nbsp;=&nbsp;&#39;base64&#39;&lt;br&gt;<br>
<br>
   &nbsp;   &nbsp;elif&nbsp;ctype&nbsp;==&nbsp;&#39;text/plain&#39;:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;encoding&nbsp;=&nbsp;&#39;quoted-printable&#39;&lt;br&gt;   &nbsp;   &nbsp;else:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;encoding&nbsp;=&nbsp;&#39;base64&#39;&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;&lt;br&gt;   &nbsp;   &nbsp;part&nbsp;=&nbsp;writer.nextpart()&lt;br&gt;   &nbsp;   &nbsp;part.addheader(&#39;Content-Transfer-Encoding&#39;,&nbsp;encoding)&lt;br&gt;<br>
<br>
   &nbsp;   &nbsp;body&nbsp;=&nbsp;part.startbody(&quot;%s;&nbsp;name=%s&quot;&nbsp;%&nbsp;(ctype,&nbsp;filename))&lt;br&gt;   &nbsp;   &nbsp;mimetools.encode(open(a,&nbsp;&#39;rb&#39;),&nbsp;body,&nbsp;encoding)&lt;br&gt;&lt;br&gt;#&nbsp;that&#39;s&nbsp;all&nbsp;falks&lt;br&gt;writer.lastpart()&lt;br&gt;m&nbsp;=&nbsp;message.getvalue()&lt;br&gt;<br>
<br>
message.close()&lt;br&gt;&lt;br&gt;&lt;br&gt;factory&nbsp;=&nbsp;ESMTPSenderFactory(sender,&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;  &nbsp;senderpw,&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;  &nbsp;sender,&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;  &nbsp;to,&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;  &nbsp;m,&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;  &nbsp;result,&lt;br&gt;<br>
<br>
   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;  &nbsp;contextFactory=contextFactory)&lt;br&gt;reactor.connectTCP(&#39;&lt;a&nbsp;href=&quot;http://smtp.gmail.com&quot;&gt;smtp.gmail.com&lt;/a&gt;&#39;,&nbsp;25,&nbsp;factory)&lt;br&gt;result.addCallback(lambda&nbsp;ign:&nbsp;reactor.stop())&lt;br&gt;reactor.run()&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;/usr/lib/python2.6/dist-packages/twisted/mail/smtp.py:10:&nbsp;DeprecationWarning:&nbsp;the&nbsp;MimeWriter&nbsp;module&nbsp;is&nbsp;deprecated;&nbsp;use&nbsp;the&nbsp;email&nbsp;package&nbsp;instead&lt;br&gt; &nbsp;import&nbsp;MimeWriter,&nbsp;tempfile,&nbsp;rfc822&lt;br&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;<br>
<br>
 &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/python/log.py&quot;,&nbsp;line&nbsp;84,&nbsp;in&nbsp;callWithLogger&lt;br&gt;   &nbsp;return&nbsp;callWithContext({&quot;system&quot;:&nbsp;lp},&nbsp;func,&nbsp;*args,&nbsp;**kw)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/python/log.py&quot;,&nbsp;line&nbsp;69,&nbsp;in&nbsp;callWithContext&lt;br&gt;<br>
<br>
   &nbsp;return&nbsp;context.call({ILogContext:&nbsp;newCtx},&nbsp;func,&nbsp;*args,&nbsp;**kw)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/python/context.py&quot;,&nbsp;line&nbsp;59,&nbsp;in&nbsp;callWithContext&lt;br&gt;   &nbsp;return&nbsp;self.currentContext().callWithContext(ctx,&nbsp;func,&nbsp;*args,&nbsp;**kw)&lt;br&gt;<br>
<br>
 &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/python/context.py&quot;,&nbsp;line&nbsp;37,&nbsp;in&nbsp;callWithContext&lt;br&gt;   &nbsp;return&nbsp;func(*args,**kw)&lt;br&gt;---&nbsp;&lt;exception&nbsp;caught&nbsp;here&gt;&nbsp;---&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/selectreactor.py&quot;,&nbsp;line&nbsp;146,&nbsp;in&nbsp;_doReadOrWrite&lt;br&gt;<br>
<br>
   &nbsp;why&nbsp;=&nbsp;getattr(selectable,&nbsp;method)()&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/tcp.py&quot;,&nbsp;line&nbsp;137,&nbsp;in&nbsp;doRead&lt;br&gt;   &nbsp;return&nbsp;Connection.doRead(self)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/tcp.py&quot;,&nbsp;line&nbsp;460,&nbsp;in&nbsp;doRead&lt;br&gt;<br>
<br>
   &nbsp;return&nbsp;self.protocol.dataReceived(data)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/protocols/basic.py&quot;,&nbsp;line&nbsp;251,&nbsp;in&nbsp;dataReceived&lt;br&gt;   &nbsp;why&nbsp;=&nbsp;self.lineReceived(line)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/mail/smtp.py&quot;,&nbsp;line&nbsp;1069,&nbsp;in&nbsp;lineReceived&lt;br&gt;<br>
<br>
   &nbsp;why&nbsp;=&nbsp;self._okresponse(self.code,&#39;\n&#39;.join(self.resp))&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/mail/smtp.py&quot;,&nbsp;line&nbsp;1134,&nbsp;in&nbsp;smtpState_data&lt;br&gt;   &nbsp;self.getMailData(),&nbsp;self.transport,&nbsp;self.transformChunk)&lt;br&gt;<br>
<br>
 &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/protocols/basic.py&quot;,&nbsp;line&nbsp;493,&nbsp;in&nbsp;beginFileTransfer&lt;br&gt;   &nbsp;self.consumer.registerProducer(self,&nbsp;False)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/abstract.py&quot;,&nbsp;line&nbsp;313,&nbsp;in&nbsp;registerProducer&lt;br&gt;<br>
<br>
   &nbsp;producer.resumeProducing()&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/protocols/basic.py&quot;,&nbsp;line&nbsp;499,&nbsp;in&nbsp;resumeProducing&lt;br&gt;   &nbsp;chunk&nbsp;=&nbsp;self.file.read(self.CHUNK_SIZE)&lt;br&gt;exceptions.AttributeError:&nbsp;&#39;str&#39;&nbsp;object&nbsp;has&nbsp;no&nbsp;attribute&nbsp;&#39;read&#39;&lt;br&gt;<br>
<br>
Unhandled&nbsp;error&nbsp;in&nbsp;Deferred:&lt;br&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;Failure:&nbsp;exceptions.Exception:&nbsp;Consumer&nbsp;asked&nbsp;us&nbsp;to&nbsp;stop&nbsp;producing&lt;br&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt; &nbsp;File&nbsp;&quot;postprob.py&quot;,&nbsp;line&nbsp;71,&nbsp;in&nbsp;&lt;module&gt;&lt;br&gt;<br>
<br>
   &nbsp;reactor.run()&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/base.py&quot;,&nbsp;line&nbsp;1170,&nbsp;in&nbsp;run&lt;br&gt;   &nbsp;self.mainLoop()&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/base.py&quot;,&nbsp;line&nbsp;1182,&nbsp;in&nbsp;mainLoop&lt;br&gt;<br>
<br>
   &nbsp;self.doIteration(t)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/selectreactor.py&quot;,&nbsp;line&nbsp;140,&nbsp;in&nbsp;doSelect&lt;br&gt;   &nbsp;_logrun(selectable,&nbsp;_drdw,&nbsp;selectable,&nbsp;method,&nbsp;dict)&lt;br&gt;---&nbsp;&lt;exception&nbsp;caught&nbsp;here&gt;&nbsp;---&lt;br&gt;<br>
<br>
 &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/python/log.py&quot;,&nbsp;line&nbsp;84,&nbsp;in&nbsp;callWithLogger&lt;br&gt;   &nbsp;return&nbsp;callWithContext({&quot;system&quot;:&nbsp;lp},&nbsp;func,&nbsp;*args,&nbsp;**kw)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/python/log.py&quot;,&nbsp;line&nbsp;69,&nbsp;in&nbsp;callWithContext&lt;br&gt;<br>
<br>
   &nbsp;return&nbsp;context.call({ILogContext:&nbsp;newCtx},&nbsp;func,&nbsp;*args,&nbsp;**kw)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/python/context.py&quot;,&nbsp;line&nbsp;59,&nbsp;in&nbsp;callWithContext&lt;br&gt;   &nbsp;return&nbsp;self.currentContext().callWithContext(ctx,&nbsp;func,&nbsp;*args,&nbsp;**kw)&lt;br&gt;<br>
<br>
 &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/python/context.py&quot;,&nbsp;line&nbsp;37,&nbsp;in&nbsp;callWithContext&lt;br&gt;   &nbsp;return&nbsp;func(*args,**kw)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/selectreactor.py&quot;,&nbsp;line&nbsp;156,&nbsp;in&nbsp;_doReadOrWrite&lt;br&gt;<br>
<br>
   &nbsp;self._disconnectSelectable(selectable,&nbsp;why,&nbsp;method==&quot;doRead&quot;)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/posixbase.py&quot;,&nbsp;line&nbsp;197,&nbsp;in&nbsp;_disconnectSelectable&lt;br&gt;   &nbsp;selectable.connectionLost(failure.Failure(why))&lt;br&gt;<br>
<br>
 &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/tcp.py&quot;,&nbsp;line&nbsp;678,&nbsp;in&nbsp;connectionLost&lt;br&gt;   &nbsp;self.connector.connectionLost(reason)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/internet/base.py&quot;,&nbsp;line&nbsp;1039,&nbsp;in&nbsp;connectionLost&lt;br&gt;<br>
<br>
   &nbsp;self.factory.clientConnectionLost(self,&nbsp;reason)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/mail/smtp.py&quot;,&nbsp;line&nbsp;1713,&nbsp;in&nbsp;clientConnectionLost&lt;br&gt;   &nbsp;self._processConnectionError(connector,&nbsp;err)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/lib/python2.6/dist-packages/twisted/mail/smtp.py&quot;,&nbsp;line&nbsp;1721,&nbsp;in&nbsp;_processConnectionError&lt;br&gt;<br>
<br>
   &nbsp;self.file.seek(0,&nbsp;0)&lt;br&gt;exceptions.AttributeError:&nbsp;&#39;str&#39;&nbsp;object&nbsp;has&nbsp;no&nbsp;attribute&nbsp;&#39;seek&#39;&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>

</tt>
