<tt>
&lt;html&gt;&lt;body&gt;On&nbsp;11:14&nbsp;am,&nbsp;exarkun@divmod.com&nbsp;wrote:&lt;br&nbsp;/&gt;&amp;gt;On&nbsp;Mon,&nbsp;02&nbsp;Jul&nbsp;2007&nbsp;11:04:56&nbsp;+0200,&nbsp;Markus&nbsp;Schiltknecht&nbsp;&amp;lt;markus@bluegap.ch&amp;gt;&nbsp;&lt;br&nbsp;/&gt;&amp;gt;wrote:&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;[snip]&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;Anyway,&nbsp;with&nbsp;very&nbsp;simple&nbsp;timing&nbsp;measures&nbsp;within&nbsp;the&nbsp;twisted&nbsp;server&nbsp;itself,&nbsp;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;I've&nbsp;figured&nbsp;out&nbsp;what&nbsp;was&nbsp;causing&nbsp;the&nbsp;delays:&nbsp;reactor.spawnProcess()&nbsp;takes&nbsp;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;more&nbsp;than&nbsp;a&nbsp;second.&nbsp;&amp;#160;I&nbsp;knew&nbsp;that&nbsp;fork()&nbsp;was&nbsp;expensive,&nbsp;but&nbsp;that&nbsp;expensive?&lt;br&nbsp;/&gt;&amp;gt;&lt;br&nbsp;/&gt;&amp;gt;This&nbsp;isn't&nbsp;normal.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Markus,&nbsp;can&nbsp;you&nbsp;instrument&nbsp;spawnProcess&nbsp;and&nbsp;figure&nbsp;out&nbsp;which&nbsp;*part*&nbsp;of&nbsp;it&nbsp;is&nbsp;taking&nbsp;so&nbsp;long?&nbsp;&amp;#160;Like&nbsp;exarkun&nbsp;says:&nbsp;this&nbsp;is&nbsp;not&nbsp;normal.&nbsp;&amp;#160;(I&nbsp;wonder&nbsp;if&nbsp;we&nbsp;are&nbsp;unwittingly&nbsp;calling&nbsp;some&nbsp;blocking&nbsp;API&nbsp;in&nbsp;there?&nbsp;&amp;#160;I&nbsp;don't&nbsp;think&nbsp;so,&nbsp;but...)&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;What&nbsp;I'm&nbsp;doing&nbsp;now&nbsp;feels&nbsp;very&nbsp;dirty:&nbsp;I'm&nbsp;calling&nbsp;reactor.spawnProcess()&nbsp;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;from&nbsp;a&nbsp;thread.&nbsp;(Yes,&nbsp;I'm&nbsp;taking&nbsp;care&nbsp;that&nbsp;only&nbsp;one&nbsp;thread&nbsp;can&nbsp;spawn&nbsp;a&nbsp;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;process&nbsp;at&nbsp;any&nbsp;time.)&nbsp;At&nbsp;least&nbsp;on&nbsp;my&nbsp;Linux&nbsp;Dev-Box,&nbsp;that&nbsp;seems&nbsp;to&nbsp;work&nbsp;-&nbsp;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;and&nbsp;resolves&nbsp;my&nbsp;issue.&nbsp;But...&nbsp;calling&nbsp;fork()&nbsp;from&nbsp;a&nbsp;thread???&lt;br&nbsp;/&gt;&amp;gt;&lt;br&nbsp;/&gt;&amp;gt;Er.&nbsp;&amp;#160;That's&nbsp;not&nbsp;supported.&nbsp;&amp;#160;The&nbsp;only&nbsp;Twisted&nbsp;API&nbsp;you&nbsp;can&nbsp;call&nbsp;from&nbsp;a&nbsp;thread&lt;br&nbsp;/&gt;&amp;gt;is&nbsp;reactor.callFromThread.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;In&nbsp;other&nbsp;words,&nbsp;this&nbsp;may&nbsp;appear&nbsp;to&nbsp;work,&nbsp;but&nbsp;if&nbsp;you&nbsp;suddenly&nbsp;burst&nbsp;into&nbsp;flame&nbsp;unexpectedly,&nbsp;don't&nbsp;blame&nbsp;*us*.&nbsp;&amp;#160;And&nbsp;you&nbsp;probably&nbsp;will,&nbsp;eventually,&nbsp;if&nbsp;you&nbsp;keep&nbsp;doing&nbsp;that.&lt;br&nbsp;/&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
