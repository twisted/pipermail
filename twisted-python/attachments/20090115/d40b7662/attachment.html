<tt>
Hi,&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Jan&nbsp;15,&nbsp;2009&nbsp;at&nbsp;1:58&nbsp;PM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:exarkun@divmod.com&quot;&gt;exarkun@divmod.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;On&nbsp;Thu,&nbsp;15&nbsp;Jan&nbsp;2009&nbsp;11:44:44&nbsp;+0100,&nbsp;Alessio&nbsp;Pace&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:alessio.pace@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;alessio.pace@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;would&nbsp;like&nbsp;to&nbsp;have&nbsp;a&nbsp;client&nbsp;connect&nbsp;via&nbsp;TCP&nbsp;to&nbsp;a&nbsp;server&nbsp;(say,&nbsp;server&nbsp;&quot;A&quot;),&lt;br&gt;<br>
then&nbsp;the&nbsp;client&nbsp;close&nbsp;the&nbsp;connection&nbsp;and&nbsp;connect&nbsp;via&nbsp;TCP&nbsp;to&nbsp;another&nbsp;server&lt;br&gt;<br>
(say,&nbsp;server&nbsp;&quot;B&quot;)&nbsp;using&nbsp;the&nbsp;same&nbsp;TCP&nbsp;port&nbsp;that&nbsp;was&nbsp;bound&nbsp;locally&nbsp;while&lt;br&gt;<br>
connecting&nbsp;to&nbsp;&quot;A&quot;.&nbsp;And&nbsp;then&nbsp;this&nbsp;done&nbsp;over&nbsp;and&nbsp;over&nbsp;again&nbsp;switching&nbsp;from&nbsp;B&lt;br&gt;<br>
to&nbsp;A&nbsp;to&nbsp;B&nbsp;etc..&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;fact&nbsp;is&nbsp;that&nbsp;it&nbsp;all&nbsp;works&nbsp;if&nbsp;both&nbsp;the&nbsp;client&nbsp;and&nbsp;the&nbsp;server&nbsp;do&lt;br&gt;<br>
transport.loseConnection()&nbsp;before&nbsp;the&nbsp;client&nbsp;tries&nbsp;to&nbsp;connect&nbsp;to&nbsp;the&nbsp;other&lt;br&gt;<br>
server&nbsp;from&nbsp;the&nbsp;same&nbsp;local&nbsp;port,&nbsp;instead&nbsp;if&nbsp;*only*&nbsp;the&nbsp;client&nbsp;does&lt;br&gt;<br>
transport.loseConnection(),&nbsp;I&nbsp;obtain:&lt;br&gt;<br>
&lt;br&gt;<br>
[Failure&nbsp;instance:&nbsp;Traceback&nbsp;(failure&nbsp;with&nbsp;no&nbsp;frames):&nbsp;&lt;class&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&#39;twisted.internet.error.ConnectBindError&#39;&gt;:&nbsp;Couldn&#39;t&nbsp;bind:&nbsp;98:&nbsp;Address&lt;br&gt;<br>
already&nbsp;in&nbsp;use.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
which&nbsp;it&nbsp;is&nbsp;strange&nbsp;to&nbsp;me&nbsp;as&nbsp;the&nbsp;next&nbsp;connectTCP()&nbsp;attempt&nbsp;is&nbsp;called&nbsp;in&nbsp;the&lt;br&gt;<br>
connectionLost()&nbsp;method&nbsp;of&nbsp;the&nbsp;client,&nbsp;so&nbsp;the&nbsp;socket&nbsp;should&nbsp;be&nbsp;closed&lt;br&gt;<br>
already.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
This&nbsp;is&nbsp;because&nbsp;the&nbsp;client&nbsp;connection&nbsp;goes&nbsp;into&nbsp;the&nbsp;CLOSE_WAIT&nbsp;state&nbsp;instead&lt;br&gt;<br>
of&nbsp;really&nbsp;closing&nbsp;all&nbsp;the&nbsp;way&nbsp;right&nbsp;away.&nbsp;&nbsp;Google&nbsp;for&nbsp;&quot;tcp&nbsp;state&nbsp;diagram&quot;&lt;br&gt;<br>
and&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;how&nbsp;a&nbsp;socket&nbsp;can&nbsp;close&nbsp;-&nbsp;notice&nbsp;that&nbsp;of&nbsp;the&nbsp;two&nbsp;paths&lt;br&gt;<br>
there&nbsp;are&nbsp;to&nbsp;get&nbsp;to&nbsp;CLOSED,&nbsp;only&nbsp;one&nbsp;of&nbsp;them&nbsp;goes&nbsp;through&nbsp;CLOSE_WAIT.&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;are&nbsp;ways&nbsp;to&nbsp;change&nbsp;this&nbsp;(on&nbsp;most&nbsp;platforms,&nbsp;you&nbsp;can&nbsp;reduce&nbsp;the&nbsp;amount&lt;br&gt;<br>
of&nbsp;time&nbsp;a&nbsp;socket&nbsp;spends&nbsp;in&nbsp;CLOSE_WAIT&nbsp;before&nbsp;going&nbsp;to&nbsp;CLOSED),&nbsp;but&nbsp;it&nbsp;may&nbsp;not&lt;br&gt;<br>
be&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;use&nbsp;them.&nbsp;&nbsp;The&nbsp;CLOSE_WAIT&nbsp;state&nbsp;helps&nbsp;make&nbsp;sure&nbsp;that&nbsp;all&lt;br&gt;<br>
data&nbsp;is&nbsp;delivered&nbsp;to&nbsp;the&nbsp;right&nbsp;TCP&nbsp;connection&nbsp;and&nbsp;not&nbsp;a&nbsp;different,&nbsp;unrelated&lt;br&gt;<br>
TCP&nbsp;connection&nbsp;by&nbsp;accident.&lt;br&gt;<br>
&lt;br&gt;<br>
Jean-Paul&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Thank&nbsp;you&nbsp;very&nbsp;much&nbsp;Jean-Paul,&nbsp;this&nbsp;answer&nbsp;my&nbsp;issue.&nbsp;&lt;br&gt;&lt;br&gt;And&nbsp;sorry&nbsp;for&nbsp;having&nbsp;doubted&nbsp;of&nbsp;Twisted&nbsp;for&nbsp;a&nbsp;moment&nbsp;;-)&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Alessio&nbsp;Pace.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
