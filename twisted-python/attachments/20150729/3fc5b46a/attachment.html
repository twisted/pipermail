<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thans&nbsp;You!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;found&nbsp;same&nbsp;solution,&nbsp;but&nbsp;to&nbsp;another&nbsp;problem&nbsp;like&nbsp;this.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Channel&nbsp;class:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;style=&quot;background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:12,0pt;&quot;&gt;&lt;span&nbsp;style=&quot;color:#000080;font-weight:bold;&quot;&gt;class&nbsp;&lt;/span&gt;SFTPChannel(channel.SSHChannel):<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;'session'<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;_sftp&nbsp;=&nbsp;defer.Deferred()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;#&nbsp;defer&nbsp;=<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#000080;font-weight:bold;&quot;&gt;def&nbsp;&lt;/span&gt;channelOpen(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#cc7832;&quot;&gt;,&nbsp;&lt;/span&gt;_):&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;d&nbsp;=&nbsp;&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;.conn.sendRequest(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#cc7832;&quot;&gt;,&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;'subsystem'&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#cc7832;&quot;&gt;,&nbsp;&lt;/span&gt;common.NS(&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;'sftp'&lt;/span&gt;)&lt;span&nbsp;style=&quot;color:#cc7832;&quot;&gt;,&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#660099;&quot;&gt;wantReply&lt;/span&gt;=&lt;span&nbsp;style=&quot;color:#000080;&quot;&gt;True&lt;/span&gt;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;.conn.sftp_channel_defer&nbsp;=&nbsp;d.addCallbacks(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;._cbSFTP)&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;@&lt;span&nbsp;style=&quot;color:#0000b2;&quot;&gt;defer.inlineCallbacks<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#0000b2;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#000080;font-weight:bold;&quot;&gt;def&nbsp;&lt;/span&gt;_cbSFTP(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#cc7832;&quot;&gt;,&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#808080;&quot;&gt;result&lt;/span&gt;):&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;.client&nbsp;=&nbsp;FileTransferClient()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;.client.makeConnection(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;.dataReceived&nbsp;=&nbsp;&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;.client.dataReceived<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;._sftp.callback(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;.client)<br>
<br>
&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;span&nbsp;style=&quot;color:#000080;font-weight:bold;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;&lt;/span&gt;get_file(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#cc7832;&quot;&gt;,&nbsp;&lt;/span&gt;*args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;args<br>
&lt;pre&nbsp;style=&quot;background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:12,0pt;&quot;&gt;&lt;/pre&gt;<br>
Use&nbsp;in&nbsp;exteral&nbsp;module<br>
&lt;/span&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;m&nbsp;=&nbsp;connection.sftp_channel._sftp.addCallback(connection.sftp_channel.get_file&lt;span&nbsp;style=&quot;color:#cc7832;&quot;&gt;,&nbsp;&lt;/span&gt;*[&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;'./222/test.txt'&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#cc7832;&quot;&gt;,&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#008000;font-weight:bold;&quot;&gt;'/root/freeswitch_37_17.tar'&lt;/span&gt;])<br>
m.addCallback(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;._cbFileRCopy)<br>
m.addErrback(&lt;span&nbsp;style=&quot;color:#94558d;&quot;&gt;self&lt;/span&gt;._ebFileRCopy)<br>
&lt;/pre&gt;I&nbsp;think,&nbsp;if&nbsp;set&nbsp;some&nbsp;defer&nbsp;in&nbsp;SSHChannel&nbsp;in&nbsp;<br>
<br>
&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;pre&nbsp;style=&quot;background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:12,0pt;&quot;&gt;&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;channelOpen(self,&nbsp;data):<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.conn.sendRequest(self,&nbsp;'exec',&nbsp;common.NS(self.command),&nbsp;wantReply=True).addCallback(self._gotResponse)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._chennel_defer&nbsp;=&nbsp;Defered()<br>
&lt;/span&gt;&lt;/pre&gt;<br>
and&nbsp;in&nbsp;<br>
&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;pre&nbsp;style=&quot;background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:12,0pt;&quot;&gt;&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;dataReceived(self,&nbsp;data):<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;self._chennel_defer&lt;/span&gt;&nbsp;=&nbsp;some_def()&lt;/pre&gt;<br>
But&nbsp;in&nbsp;this&nbsp;case&nbsp;one&nbsp;channel&nbsp;=&nbsp;one&nbsp;command&nbsp;=&nbsp;one&nbsp;respons<br>
&lt;span&nbsp;style=&quot;color:#808080;font-style:italic;&quot;&gt;&lt;/span&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
29.07.15&nbsp;11:56,&nbsp;Glyph&nbsp;пишет:<br>
&lt;blockquote&nbsp;cite=&quot;mid:E52FADC1-B9A1-484D-9015-6CFD20FB1043@twistedmatrix.com&quot;&nbsp;type=&quot;cite&quot;&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Jul&nbsp;28,&nbsp;2015,&nbsp;at&nbsp;10:02&nbsp;PM,&nbsp;Alexey&nbsp;Panyovin&nbsp;&lt;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;&nbsp;href=&quot;mailto:a@runtel.ru&quot;&nbsp;class=&quot;&quot;&gt;a@runtel.ru&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;float:&nbsp;none;&nbsp;display:&nbsp;inline&nbsp;!important;&quot;&nbsp;class=&quot;&quot;&gt;I'm&nbsp;use&nbsp;self&nbsp;made&nbsp;queue&nbsp;for&nbsp;my&nbsp;task.&lt;/span&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;float:&nbsp;none;&nbsp;display:&nbsp;inline&nbsp;!important;&quot;&nbsp;class=&quot;&quot;&gt;I'll&nbsp;try&nbsp;to&nbsp;amp.&lt;/span&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;float:&nbsp;none;&nbsp;display:&nbsp;inline&nbsp;!important;&quot;&nbsp;class=&quot;&quot;&gt;Thanks&nbsp;glyph!&lt;/span&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;<br>
&lt;/div&gt;&lt;div&gt;Good&nbsp;luck&nbsp;Alexey!&nbsp; Thanks&nbsp;for&nbsp;using&nbsp;Twisted!&lt;/div&gt;&lt;div&gt;<br>
&lt;/div&gt;&lt;div&gt;Please&nbsp;feel&nbsp;free&nbsp;to&nbsp;ask&nbsp;any&nbsp;more&nbsp;questions&nbsp;you&nbsp;have&nbsp;about&nbsp;using&nbsp;AMP.&lt;/div&gt;&lt;div&gt;<br>
&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;div&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;fieldset&nbsp;class=&quot;mimeAttachmentHeader&quot;&gt;&lt;/fieldset&gt;<br>
&lt;pre&nbsp;wrap=&quot;&quot;&gt;_______________________________________________<br>
Twisted-Python&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;<br>
&lt;/pre&gt;<br>
<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;&lt;/html&gt;
</tt>
