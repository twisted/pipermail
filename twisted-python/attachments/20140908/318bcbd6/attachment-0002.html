<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=windows-1252&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Sep&nbsp;7,&nbsp;2014,&nbsp;at&nbsp;7:14&nbsp;PM,&nbsp;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;01:26&nbsp;am,&nbsp;&lt;a&nbsp;href=&quot;mailto:wolfgang.kde@rohdewald.de&quot;&gt;wolfgang.kde@rohdewald.de&lt;/a&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;The&nbsp;porting&nbsp;guide&nbsp;says&lt;br&gt;&lt;br&gt;No&nbsp;byte&nbsp;paths&nbsp;in&nbsp;sys.path.&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;What&nbsp;porting&nbsp;guide&nbsp;is&nbsp;that?&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;doc&nbsp;for&nbsp;FilePath&nbsp;says&lt;br&gt;&nbsp;&nbsp;&nbsp;On&nbsp;both&nbsp;Python&nbsp;2&nbsp;and&nbsp;Python&nbsp;3,&nbsp;paths&nbsp;can&nbsp;only&nbsp;be&nbsp;bytes.&lt;br&gt;&lt;br&gt;&lt;br&gt;I&nbsp;stumbled&nbsp;upon&nbsp;this&nbsp;while&nbsp;trying&nbsp;to&nbsp;find&nbsp;out&nbsp;how&nbsp;much&nbsp;work&nbsp;it&nbsp;might&nbsp;be&lt;br&gt;to&nbsp;make&nbsp;bin/trial&nbsp;run&nbsp;with&nbsp;python3&lt;br&gt;&lt;br&gt;admin/run-python3-tests&nbsp;already&nbsp;passes&nbsp;for&nbsp;all&nbsp;twisted.spread&nbsp;related&lt;br&gt;tests&nbsp;but&nbsp;I&nbsp;still&nbsp;need&nbsp;to&nbsp;clean&nbsp;up&nbsp;a&nbsp;lot.&lt;br&gt;&lt;br&gt;after&nbsp;adding&nbsp;an&nbsp;assert&nbsp;to&nbsp;FilePath.__init__,&nbsp;python3&nbsp;bin/trial&nbsp;...&nbsp;gives&lt;br&gt;&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;,&nbsp;line&nbsp;601,&nbsp;in&nbsp;run&lt;br&gt;&nbsp;&nbsp;&nbsp;config.parseOptions()&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/python/usage.py&quot;,&nbsp;line&nbsp;277,&nbsp;in&nbsp;parseOptions&lt;br&gt;&nbsp;&nbsp;&nbsp;self.postOptions()&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;,&nbsp;line&nbsp;472,&nbsp;in&nbsp;postOptions&lt;br&gt;&nbsp;&nbsp;&nbsp;_BasicOptions.postOptions(self)&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;,&nbsp;line&nbsp;382,&nbsp;in&nbsp;postOptions&lt;br&gt;&nbsp;&nbsp;&nbsp;self['reporter']&nbsp;=&nbsp;self._loadReporterByName(self['reporter'])&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;,&nbsp;line&nbsp;369,&nbsp;in&nbsp;_loadReporterByName&lt;br&gt;&nbsp;&nbsp;&nbsp;for&nbsp;p&nbsp;in&nbsp;plugin.getPlugins(itrial.IReporter):&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/plugin.py&quot;,&nbsp;line&nbsp;209,&nbsp;in&nbsp;getPlugins&lt;br&gt;&nbsp;&nbsp;&nbsp;allDropins&nbsp;=&nbsp;getCache(package)&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/plugin.py&quot;,&nbsp;line&nbsp;134,&nbsp;in&nbsp;getCache&lt;br&gt;&nbsp;&nbsp;&nbsp;mod&nbsp;=&nbsp;getModule(module.__name__)&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;,&nbsp;line&nbsp;781,&nbsp;in&nbsp;getModule&lt;br&gt;&nbsp;&nbsp;&nbsp;return&nbsp;theSystemPath[moduleName]&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;,&nbsp;line&nbsp;702,&nbsp;in&nbsp;__getitem__&lt;br&gt;&nbsp;&nbsp;&nbsp;self._findEntryPathString(moduleObject)),&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;,&nbsp;line&nbsp;627,&nbsp;in&nbsp;_findEntryPathString&lt;br&gt;&nbsp;&nbsp;&nbsp;if&nbsp;_isPackagePath(FilePath(topPackageObj.__file__)):&lt;br&gt;&nbsp;File&nbsp;&quot;/home/wr/ssdsrc/Twisted/twisted/python/filepath.py&quot;,&nbsp;line&nbsp;664,&nbsp;in&nbsp;__init__&lt;br&gt;&nbsp;&nbsp;&nbsp;assert&nbsp;isinstance(path,&nbsp;bytes),&nbsp;'path&nbsp;must&nbsp;be&nbsp;bytes:&nbsp;%r'&nbsp;%&nbsp;(path,)&lt;br&gt;AssertionError:&nbsp;path&nbsp;must&nbsp;be&nbsp;bytes:&nbsp;'/home/wr/ssdsrc/Twisted/twisted/__init__.py'&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;If&nbsp;paths&nbsp;are&nbsp;being&nbsp;represented&nbsp;using&nbsp;unicode&nbsp;somewhere&nbsp;and&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;them&nbsp;with&nbsp;FilePath&nbsp;then&nbsp;you&nbsp;have&nbsp;to&nbsp;encode&nbsp;them&nbsp;(or&nbsp;you&nbsp;have&nbsp;to&nbsp;add&nbsp;unicode&nbsp;path&nbsp;support&nbsp;to&nbsp;FilePath&nbsp;and&nbsp;let&nbsp;FilePath&nbsp;encode&nbsp;them).&lt;br&gt;&lt;br&gt;Unfortunately&nbsp;it's&nbsp;not&nbsp;entirely&nbsp;obvious&nbsp;how&nbsp;to&nbsp;make&nbsp;FilePath&nbsp;support&nbsp;unicode&nbsp;paths&nbsp;since&nbsp;not&nbsp;all&nbsp;platforms&nbsp;Twisted&nbsp;supports&nbsp;represent&nbsp;filesystem&nbsp;paths&nbsp;using&nbsp;unicode.&lt;br&gt;&lt;br&gt;The&nbsp;choice&nbsp;python-dev&nbsp;made&nbsp;to&nbsp;bridge&nbsp;this&nbsp;gap&nbsp;was&nbsp;the&nbsp;creation&nbsp;of&nbsp;the&nbsp;&quot;surrogateescape&quot;&nbsp;error&nbsp;handler&nbsp;for&nbsp;the&nbsp;UTC-8&nbsp;codec.&nbsp;&nbsp;This&nbsp;lets&nbsp;you&nbsp;pretend&nbsp;that&nbsp;any&nbsp;time&nbsp;you&nbsp;need&nbsp;to&nbsp;convert&nbsp;between&nbsp;bytes&nbsp;and&nbsp;unicode&nbsp;the&nbsp;correct&nbsp;codec&nbsp;is&nbsp;UTF-8&nbsp;(with&nbsp;this&nbsp;special&nbsp;error&nbsp;handler).&lt;br&gt;&lt;br&gt;It's&nbsp;not&nbsp;clear&nbsp;this&nbsp;was&nbsp;a&nbsp;good&nbsp;choice&nbsp;(since&nbsp;the&nbsp;result&nbsp;is&nbsp;unicode&nbsp;strings&nbsp;that&nbsp;may&nbsp;contain&nbsp;garbage&nbsp;which&nbsp;will&nbsp;confuse&nbsp;other&nbsp;software)&nbsp;but&nbsp;it's&nbsp;also&nbsp;not&nbsp;clear&nbsp;it's&nbsp;possible&nbsp;for&nbsp;Twisted&nbsp;to&nbsp;try&nbsp;to&nbsp;make&nbsp;any&nbsp;other&nbsp;choice&nbsp;(at&nbsp;some&nbsp;point&nbsp;Twisted&nbsp;has&nbsp;to&nbsp;interoperate&nbsp;with&nbsp;the&nbsp;path-related&nbsp;APIs&nbsp;in&nbsp;Python&nbsp;itself&nbsp;-&nbsp;`sys.path`,&nbsp;for&nbsp;example).&lt;br&gt;&lt;br&gt;Not&nbsp;sure&nbsp;if&nbsp;that&nbsp;helps&nbsp;you&nbsp;at&nbsp;all.&nbsp;&nbsp;Maybe&nbsp;it&nbsp;outlines&nbsp;the&nbsp;problem&nbsp;a&nbsp;little&nbsp;more&nbsp;clearly,&nbsp;at&nbsp;least.&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;The&nbsp;problem&nbsp;with&nbsp;making&nbsp;FilePath&nbsp;support&nbsp;unicode&nbsp;is&nbsp;that&nbsp;we&nbsp;want&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;that&nbsp;applications&nbsp;can&nbsp;rely&nbsp;upon,&nbsp;specified&nbsp;in&nbsp;terms&nbsp;of&nbsp;specific&nbsp;types&nbsp;(bytes&nbsp;or&nbsp;text)&nbsp;so&nbsp;that&nbsp;when&nbsp;you&nbsp;get&nbsp;an&nbsp;IFilePath&nbsp;you&nbsp;know&nbsp;what&nbsp;you&nbsp;can&nbsp;do&nbsp;with&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;it&nbsp;is&nbsp;currently&nbsp;implemented,&nbsp;FilePath&nbsp;exposes&nbsp;its&nbsp;internal&nbsp;representation&nbsp;fairly&nbsp;directly,&nbsp;most&nbsp;notably&nbsp;as&nbsp;the&nbsp;‘.path’&nbsp;attribute,&nbsp;but&nbsp;also&nbsp;in&nbsp;the&nbsp;return-type&nbsp;of&nbsp;methods&nbsp;like&nbsp;&quot;basename&quot;&nbsp;and&nbsp;&quot;segmentsFrom&quot;.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;FilePath&nbsp;doesn't&nbsp;exactly&nbsp;&quot;support&quot;&nbsp;unicode,&nbsp;in&nbsp;that&nbsp;it's&nbsp;specifically&nbsp;documented&nbsp;not&nbsp;to,&nbsp;but&nbsp;it's&nbsp;sort&nbsp;of&nbsp;hard&nbsp;to&nbsp;tell,&nbsp;since&nbsp;you&nbsp;can&nbsp;instantiate&nbsp;one&nbsp;with&nbsp;a&nbsp;unicode&nbsp;string&nbsp;in&nbsp;both&nbsp;python&nbsp;2&nbsp;and&nbsp;python&nbsp;3,&nbsp;and&nbsp;get&nbsp;(apparently)&nbsp;correct&nbsp;results&nbsp;out&nbsp;of&nbsp;it&nbsp;for&nbsp;some&nbsp;methods.&nbsp;&nbsp;However,&nbsp;methods&nbsp;that&nbsp;need&nbsp;a&nbsp;string&nbsp;constant&nbsp;as&nbsp;part&nbsp;of&nbsp;their&nbsp;implementation,&nbsp;like&nbsp;siblingExtensionSearch&nbsp;and&nbsp;globChildren,&nbsp;will&nbsp;break&nbsp;unceremoniously&nbsp;when&nbsp;presented&nbsp;with&nbsp;unicode.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Another&nbsp;decision&nbsp;that&nbsp;python-dev&nbsp;made&nbsp;to&nbsp;bridge&nbsp;the&nbsp;gap&nbsp;was&nbsp;to&nbsp;randomly&nbsp;allow&nbsp;different&nbsp;string&nbsp;types&nbsp;be&nbsp;passed&nbsp;to&nbsp;platform&nbsp;APIs,&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&gt;&gt;&gt;&nbsp;import&nbsp;os&lt;br&gt;&gt;&gt;&gt;&nbsp;os.listdir(u&quot;.&quot;)&lt;br&gt;['a',&nbsp;'b',&nbsp;'c']&lt;br&gt;&gt;&gt;&gt;&nbsp;os.listdir(b&quot;.&quot;)&lt;br&gt;[b'a',&nbsp;b'b',&nbsp;b'c']&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt;&gt;&gt;&nbsp;os.path.basename(b&quot;.&quot;)&lt;br&gt;b'.'&lt;br&gt;&gt;&gt;&gt;&nbsp;os.path.basename(&quot;.&quot;)&lt;br&gt;'.'&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;implies&nbsp;a&nbsp;parallel&nbsp;structure&nbsp;might&nbsp;be&nbsp;possible&nbsp;for&nbsp;FilePath:&nbsp;if&nbsp;you&nbsp;pass&nbsp;its&nbsp;constructor&nbsp;bytes,&nbsp;you&nbsp;get&nbsp;a&nbsp;BytesFilePath;&nbsp;if&nbsp;you&nbsp;pass&nbsp;it&nbsp;text,&nbsp;you&nbsp;get&nbsp;a&nbsp;TextFilePath.&nbsp;&nbsp;You&nbsp;can't&nbsp;mix&nbsp;the&nbsp;two,&nbsp;and&nbsp;once&nbsp;you've&nbsp;chosen&nbsp;a&nbsp;path&nbsp;you&nbsp;can't&nbsp;choose&nbsp;a&nbsp;different&nbsp;one.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;IFilePath&nbsp;could&nbsp;then&nbsp;document&nbsp;that&nbsp;all&nbsp;of&nbsp;its&nbsp;&lt;i&gt;existing&lt;/i&gt;&nbsp;methods&nbsp;have&nbsp;the&nbsp;return&nbsp;type&nbsp;of&nbsp;&quot;whatever&nbsp;got&nbsp;passed&nbsp;to&nbsp;__init__&quot;&nbsp;(which&nbsp;is&nbsp;what&nbsp;the&nbsp;current&nbsp;implementation&nbsp;does&nbsp;about&nbsp;2/3&nbsp;of&nbsp;the&nbsp;time&nbsp;anyway&nbsp;on&nbsp;py3,&nbsp;and&nbsp;about&nbsp;9/10&nbsp;of&nbsp;the&nbsp;time&nbsp;on&nbsp;py2;&nbsp;we&nbsp;would&nbsp;just&nbsp;be&nbsp;making&nbsp;it&nbsp;work&nbsp;intentionally,&nbsp;all&nbsp;the&nbsp;way).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But,&nbsp;it&nbsp;would&nbsp;then&nbsp;be&nbsp;possible&nbsp;to&nbsp;give&nbsp;BytesFilePath&nbsp;a&nbsp;&quot;asText()&quot;&nbsp;method&nbsp;and&nbsp;vice&nbsp;versa&nbsp;&quot;asBytes()&quot;&nbsp;-&nbsp;since&nbsp;it's&nbsp;the&nbsp;filesystem,&nbsp;metadata&nbsp;about&nbsp;encodings&nbsp;exists&nbsp;outside&nbsp;your&nbsp;program&nbsp;and&nbsp;you&nbsp;would&nbsp;not&nbsp;need&nbsp;to&nbsp;guess&nbsp;at&nbsp;encodings,&nbsp;you'd&nbsp;simply&nbsp;indicate&nbsp;what&nbsp;return&nbsp;value&nbsp;you'd&nbsp;like&nbsp;from&nbsp;methods&nbsp;like&nbsp;.basename()&nbsp;et.&nbsp;al.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;more&nbsp;I&nbsp;think&nbsp;about&nbsp;this,&nbsp;the&nbsp;more&nbsp;I&nbsp;like&nbsp;it&nbsp;-&nbsp;it's&nbsp;a&nbsp;bit&nbsp;of&nbsp;annoying&nbsp;and&nbsp;subtle&nbsp;implementation&nbsp;work,&nbsp;but&nbsp;I&nbsp;think&nbsp;it&nbsp;would&nbsp;supply&nbsp;the&nbsp;behavior&nbsp;that&nbsp;most&nbsp;people&nbsp;want,&nbsp;remain&nbsp;compatible&nbsp;with&nbsp;most&nbsp;of&nbsp;the&nbsp;existing&nbsp;unspecified&nbsp;behavior,&nbsp;and&nbsp;it&nbsp;would&nbsp;address&nbsp;clean&nbsp;text/bytes&nbsp;separation&nbsp;without&nbsp;having&nbsp;a&nbsp;giant&nbsp;deprecation&nbsp;cycle&nbsp;and&nbsp;inventing&nbsp;a&nbsp;new&nbsp;interface.&nbsp;&nbsp;It's&nbsp;also&nbsp;the&nbsp;sort&nbsp;of&nbsp;implementation&nbsp;work&nbsp;which,&nbsp;after&nbsp;some&nbsp;discussion&nbsp;and&nbsp;consideration,&nbsp;we&nbsp;could&nbsp;be&nbsp;reasonably&nbsp;sure&nbsp;is&nbsp;*correct*&nbsp;rather&nbsp;than&nbsp;guessing&nbsp;at&nbsp;things.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thoughts?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
