<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Dear&nbsp;list&lt;/font&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;I&nbsp;may&nbsp;need&nbsp;som&nbsp;advise&nbsp;to&nbsp;get&nbsp;som&nbsp;testing&nbsp;wokring.&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;I&nbsp;have&nbsp;a&nbsp;server&nbsp;for&nbsp;service&nbsp;a,&nbsp;which&nbsp;creates&nbsp;a&nbsp;client&nbsp;for&nbsp;service&nbsp;b&nbsp;to&nbsp;get&nbsp;som&nbsp;data:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&lt;br&gt;<br>
<br>
<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;class&nbsp;StateHandler(object):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;implements(State.Iface)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;def&nbsp;__init__(self):&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;#do&nbsp;stuff&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.loaddata()&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;@inlineCallbacks&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;def&nbsp;loaddata(self):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;try:&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;conn&nbsp;=&nbsp;yield&nbsp;ClientCreator(&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reactor,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTwisted.ThriftClientProtocol,&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dsClient,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TBinaryProtocol.TBinaryProtocolFactory()).connectTCP(&quot;10.70.10.30&quot;,&nbsp;7246)&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;data&nbsp;=&nbsp;yield&nbsp;conn.client.getAllAuthenticationData()&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#process&nbsp;data&lt;/font&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
<br>
&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;conn.transport.loseConnection()&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;I&nbsp;use&nbsp;trail&nbsp;to&nbsp;test&nbsp;this&nbsp;service,&nbsp;code&nbsp;is&nbsp;bolow:&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;class&nbsp;TestStateStore(unittest.TestCase):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;@defer.inlineCallbacks&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;def&nbsp;setUp(self):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.handler&nbsp;=&nbsp;StateHandler()&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.processor&nbsp;=&nbsp;State.Processor(self.handler)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.pfactory&nbsp;=&nbsp;TBinaryProtocol.TBinaryProtocolFactory()&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.server&nbsp;=&nbsp;reactor.listenTCP(&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTwisted.ThriftServerFactory(self.processor,&nbsp;self.pfactory),&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;interface=&quot;127.0.0.1&quot;)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.portNo&nbsp;=&nbsp;self.server.getHost().port&lt;/font&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&#39;courier&nbsp;new&#39;,monospace;font-size:x-small&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.txclient&nbsp;=&nbsp;yield&nbsp;ClientCreator(&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reactor,&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TTwisted.ThriftClientProtocol,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;State.Client,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.pfactory).connectTCP(&quot;127.0.0.1&quot;,&nbsp;self.portNo)&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&#39;courier&nbsp;new&#39;,monospace;font-size:x-small&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.client&nbsp;=&nbsp;self.txclient.client&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;@defer.inlineCallbacks&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;def&nbsp;tearDown(self):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.txclient.transport.loseConnection()&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;yield&nbsp;self.server.stopListening()&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp;def&nbsp;test_dummy(self):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.assertEquals(True,&nbsp;True)&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;run&nbsp;test&nbsp;it&nbsp;fails&nbsp;with&nbsp;the&nbsp;following&nbsp;error&nbsp;message.&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;ERROR]&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;Failure:&nbsp;twisted.trial.util.DirtyReactorAggregateError:&nbsp;Reactor&nbsp;was&nbsp;unclean.&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;DelayedCalls:&nbsp;(set&nbsp;twisted.internet.base.DelayedCall.debug&nbsp;=&nbsp;True&nbsp;to&nbsp;debug)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;DelayedCall&nbsp;0x29d99e0&nbsp;[29.9931809902s]&nbsp;called=0&nbsp;cancelled=0&nbsp;Client.failIfNotConnected(TimeoutError(&#39;&#39;,))&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;oc.tests.test_state_service.TestStateStore.test_dummy&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;===============================================================================&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;[ERROR]&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;Failure:&nbsp;twisted.trial.util.DirtyReactorAggregateError:&nbsp;Reactor&nbsp;was&nbsp;unclean.&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;Selectables:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;&lt;class&nbsp;&#39;twisted.internet.tcp.Client&#39;&gt;&nbsp;to&nbsp;(&#39;10.70.10.30&#39;,&nbsp;7246)&nbsp;at&nbsp;29d2c10&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;oc.tests.test_state_service.TestStateStore.test_dummy&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;-------------------------------------------------------------------------------&lt;/font&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&nbsp;size=&quot;1&quot;&gt;Ran&nbsp;1&nbsp;tests&nbsp;in&nbsp;0.010s&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;me&nbsp;it&nbsp;seems&nbsp;like&nbsp;Trail&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reactor&nbsp;and&nbsp;throws&nbsp;an&nbsp;error,&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;the&nbsp;reactor&nbsp;is&nbsp;unclean,&nbsp;because&nbsp;the&nbsp;server&nbsp;client&nbsp;is&nbsp;still&nbsp;active,&nbsp;or&nbsp;at&nbsp;least&nbsp;not&nbsp;cleaned&nbsp;up.&nbsp;How&nbsp;do&nbsp;I&nbsp;work&nbsp;around&nbsp;this&nbsp;problem,&nbsp;any&nbsp;help&nbsp;is&nbsp;very appreciated. &lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;Jonas&nbsp;Brunsgaard&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
