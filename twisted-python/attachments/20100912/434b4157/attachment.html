<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Sep&nbsp;10,&nbsp;2010,&nbsp;at&nbsp;1:01&nbsp;PM,&nbsp;Laurens&nbsp;Van&nbsp;Houtven&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;Okay,&nbsp;to&nbsp;be&nbsp;specific:&nbsp;I&nbsp;believe&nbsp;the&nbsp;appropriate&nbsp;interface&nbsp;is&nbsp;IResource.&nbsp;This&nbsp;is&nbsp;in&nbsp;line&nbsp;with&nbsp;t.web's&nbsp;general&nbsp;way&nbsp;of&nbsp;interacting&nbsp;with&nbsp;cred:&nbsp;you&nbsp;give&nbsp;me&nbsp;credentials,&nbsp;I&nbsp;give&nbsp;you&nbsp;a&nbsp;protected&nbsp;IResource.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;doesn't&nbsp;quite&nbsp;make&nbsp;sense&nbsp;to&nbsp;me.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Mostly,&nbsp;I&nbsp;don't&nbsp;understand&nbsp;what&nbsp;the&nbsp;moving&nbsp;pieces&nbsp;are&nbsp;here.&nbsp;&nbsp;If&nbsp;this&nbsp;is&nbsp;all&nbsp;to&nbsp;implement&nbsp;a&nbsp;&quot;token&nbsp;endpoint&quot;&nbsp;which&nbsp;doesn't&nbsp;&quot;actually&nbsp;serve&nbsp;protected&nbsp;resources&quot;,&nbsp;then&nbsp;what&nbsp;is&nbsp;the&nbsp;IResource&nbsp;being&nbsp;returned&nbsp;by&nbsp;the&nbsp;realm&nbsp;actually&nbsp;*doing*?&nbsp;&nbsp;If&nbsp;it&nbsp;is&nbsp;not,&nbsp;itself,&nbsp;a&nbsp;&quot;protected&nbsp;resource&quot;,&nbsp;then&nbsp;isn't&nbsp;the&nbsp;amount&nbsp;of&nbsp;stuff&nbsp;that&nbsp;its&nbsp;IResource&nbsp;can&nbsp;do&nbsp;severely&nbsp;restricted&nbsp;(i.e.&nbsp;restricted&nbsp;to&nbsp;doing&nbsp;a&nbsp;few&nbsp;OAuth-specific&nbsp;HTTP&nbsp;things)&nbsp;and&nbsp;therefore&nbsp;actually&nbsp;an&nbsp;avatar&nbsp;of&nbsp;a&nbsp;completely&nbsp;different,&nbsp;OAuth-specific&nbsp;interface,&nbsp;which&nbsp;just&nbsp;happens&nbsp;to&nbsp;be&nbsp;wrapped&nbsp;in&nbsp;an&nbsp;IResource&nbsp;by&nbsp;the&nbsp;OAuth&nbsp;implementation&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;formatting&nbsp;those&nbsp;OAuth-specific&nbsp;things&nbsp;over&nbsp;an&nbsp;HTTP&nbsp;channel?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Based&nbsp;on&nbsp;what&nbsp;you've&nbsp;said,&nbsp;I&nbsp;would&nbsp;expect&nbsp;the&nbsp;avatar&nbsp;interface&nbsp;to&nbsp;be&nbsp;'IToken',&nbsp;since&nbsp;the&nbsp;point&nbsp;of&nbsp;this&nbsp;authentication&nbsp;is&nbsp;to&nbsp;'generate&nbsp;tokens'.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&nbsp;&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;It&nbsp;sounds&nbsp;like&nbsp;OAuth&nbsp;is&nbsp;very&nbsp;precisely&nbsp;implementing&nbsp;something&nbsp;that&nbsp;maps&nbsp;almost&nbsp;exactly&nbsp;onto&nbsp;the&nbsp;&lt;i&gt;checker&lt;/i&gt;&nbsp;part&nbsp;of&nbsp;cred,&nbsp;but&nbsp;you're&nbsp;doing&nbsp;it&nbsp;by&nbsp;implementing&nbsp;a&nbsp;realm&nbsp;to&nbsp;allow&nbsp;applications&nbsp;to&nbsp;provide&nbsp;their&nbsp;own&nbsp;logic.&nbsp;&nbsp;This&nbsp;might&nbsp;not&nbsp;be&nbsp;the&nbsp;wrong&nbsp;idea,&nbsp;but&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;spelled&nbsp;out&nbsp;very&nbsp;clearly.&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Doing&nbsp;everything&nbsp;in&nbsp;the&nbsp;checker&nbsp;probably&nbsp;might&nbsp;make&nbsp;more&nbsp;sense.&nbsp;The&nbsp;reason&nbsp;I&nbsp;originally&nbsp;thought&nbsp;to&nbsp;do&nbsp;this&nbsp;in&nbsp;the&nbsp;IRealm&nbsp;is&nbsp;that&nbsp;I&nbsp;figured&nbsp;credentials&nbsp;checkers&nbsp;should&nbsp;just&nbsp;check&nbsp;credentials,&nbsp;and&nbsp;creating&nbsp;a&nbsp;new&nbsp;credential&nbsp;(the&nbsp;access&nbsp;token)&nbsp;wasn't&nbsp;part&nbsp;of&nbsp;ICredentialsChecker's&nbsp;job&nbsp;(more&nbsp;like&nbsp;IRealm's&nbsp;job).&nbsp;Apparently&nbsp;I&nbsp;was&nbsp;mistaken.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;I'm&nbsp;going&nbsp;to&nbsp;handwave&nbsp;a&nbsp;bit&nbsp;here&nbsp;and&nbsp;pretend&nbsp;we're&nbsp;talking&nbsp;about&nbsp;a&nbsp;thing&nbsp;that&nbsp;actually&nbsp;does&nbsp;serve&nbsp;arbitrary&nbsp;resources,&nbsp;so&nbsp;my&nbsp;answers&nbsp;may&nbsp;be&nbsp;slightly&nbsp;off.&nbsp;&nbsp;But&nbsp;I&nbsp;think&nbsp;they&nbsp;may&nbsp;be&nbsp;applicable&nbsp;either&nbsp;way.&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Speaking&nbsp;the&nbsp;authentication&nbsp;protocol&nbsp;is&nbsp;the&nbsp;authentication&nbsp;implementation's&nbsp;job,&nbsp;not&nbsp;the&nbsp;realm&nbsp;&lt;i&gt;or&lt;/i&gt;&nbsp;the&nbsp;checker.&nbsp;&nbsp;For&nbsp;example:&nbsp;if&nbsp;you&nbsp;need&nbsp;to&nbsp;generate&nbsp;a&nbsp;challenge&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;authentication&nbsp;process,&nbsp;the&nbsp;checker&nbsp;probably&nbsp;doesn't&nbsp;need&nbsp;to&nbsp;get&nbsp;involved&nbsp;there.&nbsp;&nbsp;If&nbsp;you&nbsp;need&nbsp;to&nbsp;ask&nbsp;the&nbsp;checker&nbsp;something&nbsp;about&nbsp;the&nbsp;challenge&nbsp;(let's&nbsp;say&nbsp;you&nbsp;have&nbsp;a&nbsp;list&nbsp;of&nbsp;persistent&nbsp;salts),&nbsp;then&nbsp;there&nbsp;needs&nbsp;to&nbsp;be&nbsp;a&nbsp;method&nbsp;on&nbsp;the&nbsp;credential&nbsp;interface&nbsp;to&nbsp;allow&nbsp;the&nbsp;checker&nbsp;to&nbsp;relay&nbsp;that&nbsp;information&nbsp;back.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;strikes&nbsp;me&nbsp;that&nbsp;creating&nbsp;a&nbsp;new&nbsp;access&nbsp;token&nbsp;is&nbsp;also&nbsp;an&nbsp;authentication&nbsp;feature.&nbsp;&nbsp;If&nbsp;it&nbsp;is,&nbsp;then&nbsp;it&nbsp;goes&nbsp;into&nbsp;the&nbsp;OAuth&nbsp;resource&nbsp;somewhere.&nbsp;&nbsp;If&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;&lt;i&gt;pluggable&lt;/i&gt;&nbsp;then&nbsp;it&nbsp;needs&nbsp;to&nbsp;go&nbsp;into&nbsp;the&nbsp;ICredentialsChecker&nbsp;or&nbsp;possibly&nbsp;the&nbsp;realm,&nbsp;but&nbsp;it's&nbsp;possible&nbsp;that&nbsp;this&nbsp;is&nbsp;just&nbsp;an&nbsp;OAuth&nbsp;specific&nbsp;interface&nbsp;that&nbsp;is&nbsp;plugged&nbsp;in&nbsp;to&nbsp;the&nbsp;OAuth-doing&nbsp;IResource&nbsp;separately,&nbsp;as&nbsp;a&nbsp;constructor&nbsp;argument&nbsp;that&nbsp;has&nbsp;nothing&nbsp;to&nbsp;do&nbsp;with&nbsp;cred.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&nbsp;&quot;&gt;<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;As&nbsp;you&nbsp;describe&nbsp;it:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;token&nbsp;endpoints&nbsp;let&nbsp;you&nbsp;trade&nbsp;in&nbsp;some&nbsp;credentials&nbsp;that&nbsp;prove&nbsp;you're&nbsp;supposed&nbsp;to&nbsp;have&nbsp;access&nbsp;for&nbsp;a&nbsp;token&nbsp;that&nbsp;actually&nbsp;*gives*&nbsp;you&nbsp;that&nbsp;access&lt;/blockquote&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;cred-ese,&nbsp;that&nbsp;would&nbsp;be&nbsp;&quot;checkers&nbsp;let&nbsp;you&nbsp;trade&nbsp;in&nbsp;some&nbsp;credentials&nbsp;that&nbsp;prove&nbsp;you're&nbsp;supposed&nbsp;to&nbsp;have&nbsp;access&nbsp;for&nbsp;an&nbsp;&lt;avatar&nbsp;ID,&nbsp;which&nbsp;you&nbsp;give&nbsp;to&nbsp;a&nbsp;Realm&gt;&nbsp;that&nbsp;actually&nbsp;*gives*&nbsp;you&nbsp;that&nbsp;access&quot;.&nbsp;&nbsp;As&nbsp;far&nbsp;as&nbsp;the&nbsp;OAuth&nbsp;response&nbsp;is&nbsp;concerned,&nbsp;it's&nbsp;like&nbsp;a&nbsp;checker.&nbsp;&nbsp;Looking&nbsp;at&nbsp;the&nbsp;individual&nbsp;parts,&nbsp;assuming&nbsp;that&nbsp;the&nbsp;avatar&nbsp;interface&nbsp;for&nbsp;the&nbsp;purposes&nbsp;of&nbsp;this&nbsp;discussion&nbsp;is&nbsp;IResource,&nbsp;it&nbsp;breaks&nbsp;down&nbsp;like&nbsp;this&nbsp;in&nbsp;my&nbsp;mind:&lt;/div&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;access&nbsp;token&nbsp;(an&nbsp;ascii&nbsp;string,&nbsp;mandatory)&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;Avatar&nbsp;ID.&nbsp;&nbsp;(See,&nbsp;it's&nbsp;a&nbsp;str!)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Heh,&nbsp;okay;&nbsp;as&nbsp;long&nbsp;as&nbsp;there's&nbsp;a&nbsp;plausible&nbsp;way&nbsp;to&nbsp;get&nbsp;the&nbsp;other&nbsp;important&nbsp;information&nbsp;(see&nbsp;rest&nbsp;of&nbsp;email)&nbsp;into&nbsp;the&nbsp;HTTP&nbsp;response,&nbsp;I'll&nbsp;believe&nbsp;you.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes.&nbsp;&nbsp;The&nbsp;way&nbsp;to&nbsp;get&nbsp;it&nbsp;into&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;is:&nbsp;put&nbsp;it&nbsp;into&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;:).&nbsp;&nbsp;You&nbsp;don't&nbsp;necessarily&nbsp;need&nbsp;to&nbsp;cram&nbsp;it&nbsp;into&nbsp;the&nbsp;realm.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&nbsp;&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;expiration&nbsp;time&nbsp;(optional)&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;Implementation&nbsp;detail&nbsp;of&nbsp;the&nbsp;session.&nbsp;&nbsp;Avatars&nbsp;are&nbsp;actually&nbsp;sessions,&nbsp;which&nbsp;expire:&nbsp;sometimes&nbsp;(as&nbsp;with&nbsp;POP)&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;connection,&nbsp;sometimes&nbsp;(as&nbsp;with&nbsp;nevow.guard's&nbsp;HTTP&nbsp;support)&nbsp;with&nbsp;a&nbsp;session&nbsp;timeout.&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Right,&nbsp;but:&lt;/div&gt;&lt;div&gt;a)&nbsp;The&nbsp;avatar&nbsp;needs&nbsp;to&nbsp;know&nbsp;about&nbsp;this&nbsp;timeout,&nbsp;since&nbsp;the&nbsp;timeout&nbsp;information&nbsp;needs&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;make&nbsp;it&nbsp;into&nbsp;the&nbsp;HTTP&nbsp;response.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'll&nbsp;stop&nbsp;you&nbsp;right&nbsp;there:&nbsp;No.&nbsp;&nbsp;(We&nbsp;can&nbsp;skip&nbsp;the&nbsp;rest&nbsp;of&nbsp;points&nbsp;b,&nbsp;c,&nbsp;and&nbsp;d,&nbsp;since&nbsp;they&nbsp;all&nbsp;apparently&nbsp;follow&nbsp;from&nbsp;this.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;avatar's&nbsp;job&nbsp;is&nbsp;to&nbsp;give&nbsp;you&nbsp;an&nbsp;IResource,&nbsp;but&nbsp;the&nbsp;OAuth&nbsp;implementation&nbsp;doesn't&nbsp;necessarily&nbsp;need&nbsp;to&nbsp;pass&nbsp;through&nbsp;either&nbsp;the&nbsp;arguments&nbsp;to&nbsp;that&nbsp;resource&nbsp;or&nbsp;that&nbsp;resource's&nbsp;return&nbsp;values&nbsp;(from&nbsp;getChild&nbsp;or&nbsp;render)&nbsp;exactly.&nbsp;&nbsp;If&nbsp;the&nbsp;timeout&nbsp;needs&nbsp;to&nbsp;be&nbsp;put&nbsp;into&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;as&nbsp;a&nbsp;header,&nbsp;the&nbsp;OAuth&nbsp;resource&nbsp;could&nbsp;wrap&nbsp;the&nbsp;IResource&nbsp;value&nbsp;that&nbsp;it&nbsp;gets&nbsp;from&nbsp;the&nbsp;realm&nbsp;and&nbsp;set&nbsp;the&nbsp;header&nbsp;before&nbsp;calling&nbsp;the&nbsp;ultimate&nbsp;resource's&nbsp;child.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Note&nbsp;that&nbsp;this&nbsp;isn't&nbsp;just&nbsp;the&nbsp;credentials&nbsp;checker:&nbsp;this&nbsp;is&nbsp;the&nbsp;OAuth&nbsp;implementation.&nbsp;&nbsp;Relaying&nbsp;information&nbsp;there&nbsp;is&nbsp;easy&nbsp;though:&nbsp;depending&nbsp;on&nbsp;how&nbsp;the&nbsp;checker&nbsp;itself&nbsp;gets&nbsp;created&nbsp;and&nbsp;parameterized,&nbsp;either&nbsp;you&nbsp;can&nbsp;have&nbsp;the&nbsp;checker&nbsp;simply&nbsp;have&nbsp;a&nbsp;reference&nbsp;back&nbsp;to&nbsp;the&nbsp;OAuth&nbsp;resource&nbsp;so&nbsp;it&nbsp;can&nbsp;call&nbsp;some&nbsp;methods,&nbsp;or&nbsp;you&nbsp;can&nbsp;expand&nbsp;the&nbsp;OAuth&nbsp;&lt;i&gt;credentials&lt;/i&gt;&nbsp;interface&nbsp;to&nbsp;have&nbsp;a&nbsp;method&nbsp;that&nbsp;the&nbsp;&lt;i&gt;checker&lt;/i&gt;&nbsp;uses&nbsp;to&nbsp;pass&nbsp;that&nbsp;information&nbsp;back&nbsp;along&nbsp;with&nbsp;the&nbsp;resource.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&nbsp;&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;refresh&nbsp;token&nbsp;(another&nbsp;ascii&nbsp;string,&nbsp;similar&nbsp;to&nbsp;the&nbsp;access&nbsp;token,&nbsp;optional)&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Implementation&nbsp;detail&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol.&nbsp;&nbsp;The&nbsp;client&nbsp;library&nbsp;and&nbsp;server&nbsp;library&nbsp;should&nbsp;be&nbsp;transparently&nbsp;refreshing&nbsp;this&nbsp;without&nbsp;telling&nbsp;either&nbsp;the&nbsp;client&nbsp;application&nbsp;code&nbsp;or&nbsp;server&nbsp;application&nbsp;code,&nbsp;right?&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sure,&nbsp;but&nbsp;we're&nbsp;still&nbsp;writing&nbsp;library&nbsp;code&nbsp;here.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;If&nbsp;the&nbsp;avatar&nbsp;interface&nbsp;isn't&nbsp;actually&nbsp;IResource,&nbsp;but&nbsp;a&nbsp;new&nbsp;interface&nbsp;IAccessToken,&nbsp;getting&nbsp;the&nbsp;refresh&nbsp;token&nbsp;later&nbsp;might&nbsp;be&nbsp;feasible.&nbsp;(It&nbsp;should&nbsp;be&nbsp;a&nbsp;different&nbsp;interface,&nbsp;because&nbsp;in&nbsp;order&nbsp;to&nbsp;create&nbsp;a&nbsp;refresh&nbsp;token&nbsp;outside&nbsp;of&nbsp;this&nbsp;entire&nbsp;cred&nbsp;cycle,&nbsp;I&nbsp;need&nbsp;to&nbsp;know&nbsp;about&nbsp;the&nbsp;thing&nbsp;it's&nbsp;refreshing&nbsp;--&nbsp;so,&nbsp;the&nbsp;information&nbsp;in&nbsp;the&nbsp;response&nbsp;needs&nbsp;to&nbsp;be&nbsp;easily&nbsp;accessible&nbsp;and&nbsp;not&nbsp;just&nbsp;an&nbsp;opaque&nbsp;IResource).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;agree&nbsp;entirely&nbsp;that&nbsp;clever&nbsp;client&nbsp;library&nbsp;code&nbsp;would&nbsp;abstract&nbsp;this&nbsp;mess&nbsp;away&nbsp;from&nbsp;application&nbsp;code.&nbsp;However,&nbsp;right&nbsp;now&nbsp;this&nbsp;code&nbsp;still&nbsp;needs&nbsp;to&nbsp;somehow&nbsp;be&nbsp;able&nbsp;to&nbsp;eventually&nbsp;produce&nbsp;HTTP&nbsp;responses&nbsp;that&nbsp;don't&nbsp;abstract&nbsp;anything&nbsp;yet&nbsp;and&nbsp;just&nbsp;contain&nbsp;all&nbsp;the&nbsp;appropriate&nbsp;data,&nbsp;because&nbsp;that's&nbsp;just&nbsp;what&nbsp;the&nbsp;OAuth&nbsp;spec&nbsp;says&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;do.&nbsp;There&nbsp;isn't&nbsp;any&nbsp;real&nbsp;application&nbsp;code&nbsp;in&nbsp;the&nbsp;token&nbsp;endpoint;&nbsp;they're&nbsp;pretty&nbsp;similar&nbsp;for&nbsp;all&nbsp;OAuth&nbsp;setups,&nbsp;and&nbsp;customization&nbsp;would&nbsp;typically&nbsp;happen&nbsp;through&nbsp;implementing&nbsp;the&nbsp;appropriate&nbsp;ICredentialsChecker.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Again:&nbsp;producing&nbsp;HTTP&nbsp;responses&nbsp;is&nbsp;not&nbsp;the&nbsp;same&nbsp;thing&nbsp;as&nbsp;producing&nbsp;IResource&nbsp;implementations.&nbsp;&nbsp;You&nbsp;can&nbsp;have&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;produced&nbsp;by&nbsp;an&nbsp;IResource&nbsp;that&nbsp;wraps&nbsp;another&nbsp;IResource&nbsp;and&nbsp;adds&nbsp;some&nbsp;special&nbsp;sauce&nbsp;to&nbsp;the&nbsp;response.&nbsp;&nbsp;So&nbsp;this&nbsp;information&nbsp;still&nbsp;never&nbsp;needs&nbsp;to&nbsp;make&nbsp;it&nbsp;to&nbsp;the&nbsp;realm.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&nbsp;&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;scope&nbsp;(an&nbsp;ascii&nbsp;string&nbsp;consisting&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;space-separated&nbsp;words,&nbsp;optional)&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;This&nbsp;part&nbsp;doesn't&nbsp;quite&nbsp;fit,&nbsp;but&nbsp;could&nbsp;be&nbsp;expressed&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;ways:&nbsp;a&nbsp;modification&nbsp;to&nbsp;the&nbsp;avatar&nbsp;ID,&nbsp;or&nbsp;as&nbsp;some&nbsp;extra&nbsp;structure&nbsp;on&nbsp;the&nbsp;Mind&nbsp;that&nbsp;modifies&nbsp;what&nbsp;functionality&nbsp;the&nbsp;Realm&nbsp;bundles&nbsp;in&nbsp;to&nbsp;your&nbsp;avatar&nbsp;implementation&nbsp;(without&nbsp;changing&nbsp;the&nbsp;interface&nbsp;provided&nbsp;by&nbsp;that&nbsp;object,&nbsp;of&nbsp;course).&lt;/div&gt;<br>
<br>
<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Unfortunately&nbsp;I&nbsp;don't&nbsp;believe&nbsp;this&nbsp;can&nbsp;be&nbsp;done&nbsp;through&nbsp;the&nbsp;mind.&nbsp;Again&nbsp;working&nbsp;under&nbsp;the&nbsp;previous&nbsp;assumption&nbsp;that&nbsp;ICredentialsChecker&nbsp;and&nbsp;not&nbsp;the&nbsp;IRealm&nbsp;is&nbsp;responsible&nbsp;for&nbsp;creating&nbsp;the&nbsp;access&nbsp;token,&nbsp;and&nbsp;scope&nbsp;is&nbsp;known&nbsp;to&nbsp;the&nbsp;thing&nbsp;that&nbsp;makes&nbsp;the&nbsp;access&nbsp;token,&nbsp;the&nbsp;ICredentialsChecker&nbsp;knows&nbsp;about&nbsp;the&nbsp;scope.&nbsp;Unfortunately&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;pass&nbsp;stuff&nbsp;&nbsp;between&nbsp;the&nbsp;ICredentialsChecker&nbsp;and&nbsp;the&nbsp;IRealm&nbsp;is&nbsp;the&nbsp;avatar&nbsp;ID,&nbsp;so&nbsp;you&nbsp;don't&nbsp;have&nbsp;a&nbsp;choice.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OK,&nbsp;I&nbsp;admit&nbsp;it,&nbsp;by&nbsp;the&nbsp;time&nbsp;I&nbsp;get&nbsp;here&nbsp;I'm&nbsp;lost.&nbsp;&nbsp;We&nbsp;should&nbsp;try&nbsp;to&nbsp;meet&nbsp;up&nbsp;and&nbsp;have&nbsp;an&nbsp;interactive&nbsp;conversation&nbsp;about&nbsp;this,&nbsp;because&nbsp;I&nbsp;have&nbsp;a&nbsp;ton&nbsp;of&nbsp;questions&nbsp;about&nbsp;this,&nbsp;and&nbsp;I&nbsp;don't&nbsp;understand&nbsp;who&nbsp;generates&nbsp;the&nbsp;scope&nbsp;ID&nbsp;and&nbsp;why,&nbsp;and&nbsp;why&nbsp;this&nbsp;bit&nbsp;of&nbsp;information&nbsp;would&nbsp;need&nbsp;to&nbsp;be&nbsp;relayed&nbsp;between&nbsp;the&nbsp;checker&nbsp;and&nbsp;the&nbsp;realm&nbsp;in&nbsp;the&nbsp;process&nbsp;of&nbsp;authentication.&nbsp;&nbsp;Basically&nbsp;this&nbsp;goes&nbsp;back&nbsp;to&nbsp;the&nbsp;first&nbsp;confusion&nbsp;I&nbsp;mentioned&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;this&nbsp;email:&nbsp;I&nbsp;don't&nbsp;understand&nbsp;why&nbsp;the&nbsp;realm&nbsp;is&nbsp;giving&nbsp;back&nbsp;an&nbsp;IResource&nbsp;if&nbsp;the&nbsp;whole&nbsp;purpose&nbsp;is&nbsp;to&nbsp;just&nbsp;generate&nbsp;tokens&nbsp;and&nbsp;return&nbsp;them.&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
