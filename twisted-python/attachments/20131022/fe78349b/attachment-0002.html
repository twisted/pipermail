<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;22&nbsp;Οκτ&nbsp;2013,&nbsp;at&nbsp;3:38&nbsp;μ.μ.,&nbsp;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;07:41&nbsp;am,&nbsp;&lt;a&nbsp;href=&quot;mailto:orestis@orestis.gr&quot;&gt;orestis@orestis.gr&lt;/a&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;21&nbsp;Οκτ&nbsp;2013,&nbsp;at&nbsp;10:32&nbsp;μ.μ.,&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;On&nbsp;Oct&nbsp;20,&nbsp;2013,&nbsp;at&nbsp;2:21&nbsp;AM,&nbsp;Orestis&nbsp;Markou&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:orestis@orestis.gr&quot;&gt;orestis@orestis.gr&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Hello,&lt;br&gt;&lt;br&gt;Short&nbsp;form&nbsp;of&nbsp;the&nbsp;question:&lt;br&gt;&lt;br&gt;Are&nbsp;people&nbsp;using&nbsp;Twisted&nbsp;to&nbsp;host&nbsp;WSGI&nbsp;applications&nbsp;AND&nbsp;serve&nbsp;static&nbsp;files&nbsp;AND&nbsp;replace&nbsp;celery/redis/other?&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;I'm&nbsp;not&nbsp;personally&nbsp;using&nbsp;it&nbsp;as&nbsp;a&nbsp;WSGI&nbsp;host,&nbsp;but&nbsp;otherwise,&nbsp;yes,&nbsp;a&nbsp;full-stack&nbsp;application&nbsp;container&nbsp;speaking&nbsp;multiple&nbsp;protocols.&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;Any&nbsp;pointers&nbsp;on&nbsp;how&nbsp;to&nbsp;best&nbsp;use&nbsp;this&nbsp;in&nbsp;combination&nbsp;with&nbsp;WSGI/Django?&nbsp;In&nbsp;the&nbsp;past&nbsp;I&nbsp;had&nbsp;a&nbsp;combination&nbsp;of&nbsp;twisted-web&nbsp;(for&nbsp;/static&nbsp;and&nbsp;/media)&nbsp;and&nbsp;wsgi&nbsp;host&nbsp;(for&nbsp;everything&nbsp;else),&nbsp;all&nbsp;running&nbsp;under&nbsp;the&nbsp;same&nbsp;Service.&nbsp;Essentially:&lt;br&gt;&lt;br&gt;os.environ['DJANGO_SETTINGS_MODULE']&nbsp;=&nbsp;'myproject.settings'&lt;br&gt;application&nbsp;=&nbsp;django.core.handlers.wsgi.WSGIHandler()&lt;br&gt;&lt;br&gt;wsgi_resource&nbsp;=&nbsp;WSGIResource(reactor,&nbsp;reactor.getThreadPool(),&nbsp;application)&lt;br&gt;resource&nbsp;=&nbsp;Root(wsgi_resource)&lt;br&gt;#&nbsp;this&nbsp;could&nbsp;probably&nbsp;be&nbsp;automatically&nbsp;inferred&nbsp;from&nbsp;settings.py&lt;br&gt;resource.putChild('static',&nbsp;File(...))&lt;br&gt;resource.putChild('uploaded',&nbsp;File(...))&lt;br&gt;#&nbsp;other&nbsp;stuff&lt;br&gt;site&nbsp;=&nbsp;server.Site(resource)&lt;br&gt;reactor.listenTCP(8000,&nbsp;site)&lt;br&gt;reactor.run()&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;This&nbsp;looks&nbsp;about&nbsp;like&nbsp;I'd&nbsp;expect&nbsp;(if&nbsp;my&nbsp;guess&nbsp;that&nbsp;`Root`&nbsp;is&nbsp;an&nbsp;`IResource`&nbsp;that&nbsp;knows&nbsp;how&nbsp;to&nbsp;split&nbsp;dispatch&nbsp;between&nbsp;the&nbsp;WSGI&nbsp;resource&nbsp;and&nbsp;its&nbsp;other&nbsp;children).&nbsp;&nbsp;If&nbsp;you&nbsp;have&nbsp;any&nbsp;suggestions&nbsp;for&nbsp;improving&nbsp;the&nbsp;experience&nbsp;please&nbsp;share&nbsp;them.&nbsp;:)&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;anyone&nbsp;following&nbsp;along:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;class&nbsp;Root(resource.Resource):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;wsgi_resource):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resource.Resource.__init__(self)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.wsgi_resource&nbsp;=&nbsp;wsgi_resource&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;getChild(self,&nbsp;path,&nbsp;request):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path0&nbsp;=&nbsp;request.prepath.pop(0)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.postpath.insert(0,&nbsp;path0)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.wsgi_resource&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don't&nbsp;remember&nbsp;now&nbsp;if&nbsp;I&nbsp;wrote&nbsp;this&nbsp;code&nbsp;or&nbsp;if&nbsp;I&nbsp;copied&nbsp;it&nbsp;from&nbsp;somewhere.&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;[snip]&lt;br&gt;&lt;br&gt;Here's&nbsp;a&nbsp;thought&nbsp;experiment&nbsp;-&nbsp;I'd&nbsp;like&nbsp;to&nbsp;keep&nbsp;URL&nbsp;routing&nbsp;100%&nbsp;in&nbsp;Django&nbsp;for&nbsp;anything&nbsp;that&nbsp;hits&nbsp;the&nbsp;DB.&nbsp;I&nbsp;have&nbsp;some&nbsp;code&nbsp;that&nbsp;needs&nbsp;to&nbsp;spawn&nbsp;an&nbsp;external&nbsp;process&nbsp;to&nbsp;generate&nbsp;an&nbsp;image&nbsp;on-demand&nbsp;(with&nbsp;a&nbsp;layer&nbsp;of&nbsp;caching&nbsp;on&nbsp;top).&nbsp;In&nbsp;the&nbsp;past&nbsp;I&nbsp;defined&nbsp;a&nbsp;Twisted.Web&nbsp;handler&nbsp;for&nbsp;that.&nbsp;Could&nbsp;I&nbsp;now&nbsp;expose&nbsp;an&nbsp;internal&nbsp;API&nbsp;that&nbsp;(through&nbsp;Crochet?)&nbsp;do&nbsp;the&nbsp;spawnProcess&nbsp;dance&nbsp;and&nbsp;come&nbsp;back&nbsp;with&nbsp;image&nbsp;data&nbsp;that&nbsp;Django&nbsp;could&nbsp;then&nbsp;handle&nbsp;internally&nbsp;(store&nbsp;in&nbsp;a&nbsp;file,&nbsp;whatever).&nbsp;How&nbsp;would&nbsp;the&nbsp;threaded&nbsp;WSGI&nbsp;container&nbsp;deal&nbsp;with&nbsp;the&nbsp;blocking&nbsp;request&nbsp;(not&nbsp;really&nbsp;blocking,&nbsp;but&nbsp;that&nbsp;request&nbsp;would&nbsp;stall&nbsp;until&nbsp;the&nbsp;Deferred&nbsp;would&nbsp;be&nbsp;fired).&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;It&nbsp;will&nbsp;produce&nbsp;roughly&nbsp;the&nbsp;same&nbsp;results&nbsp;as&nbsp;you'd&nbsp;get&nbsp;if&nbsp;you&nbsp;used&nbsp;any&nbsp;other&nbsp;WSGI&nbsp;container:&nbsp;one&nbsp;of&nbsp;the&nbsp;threads&nbsp;in&nbsp;the&nbsp;thread&nbsp;pool&nbsp;will&nbsp;be&nbsp;kept&nbsp;unavailable&nbsp;as&nbsp;it&nbsp;waits&nbsp;for&nbsp;the&nbsp;result.&nbsp;&nbsp;This&nbsp;will&nbsp;have&nbsp;the&nbsp;usual&nbsp;consequence:&nbsp;if&nbsp;your&nbsp;threadpool&nbsp;has&nbsp;a&nbsp;max&nbsp;of&nbsp;N&nbsp;threads&nbsp;and&nbsp;you&nbsp;receive&nbsp;N&nbsp;requests&nbsp;that&nbsp;need&nbsp;to&nbsp;do&nbsp;this,&nbsp;the&nbsp;N+1th&nbsp;request&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;handled&nbsp;by&nbsp;the&nbsp;WSGI&nbsp;part&nbsp;of&nbsp;your&nbsp;server&nbsp;won't&nbsp;be&nbsp;handled&nbsp;until&nbsp;one&nbsp;of&nbsp;the&nbsp;previous&nbsp;requests&nbsp;completes&nbsp;(completion&nbsp;frees&nbsp;up&nbsp;one&nbsp;thread&nbsp;which&nbsp;is&nbsp;then&nbsp;used&nbsp;to&nbsp;handle&nbsp;the&nbsp;N+1th&nbsp;request).&lt;br&gt;&lt;br&gt;The&nbsp;only&nbsp;difference&nbsp;might&nbsp;be&nbsp;that&nbsp;since&nbsp;you&nbsp;also&nbsp;have&nbsp;non-WSGI&nbsp;content&nbsp;(all&nbsp;of&nbsp;your&nbsp;static&nbsp;content)&nbsp;even&nbsp;when&nbsp;your&nbsp;thread&nbsp;pool&nbsp;is&nbsp;completely&nbsp;in&nbsp;use&nbsp;requests&nbsp;for&nbsp;static&nbsp;content&nbsp;will&nbsp;still&nbsp;be&nbsp;satisfied&nbsp;right&nbsp;away.&nbsp;However,&nbsp;if&nbsp;you&nbsp;previously&nbsp;had&nbsp;a&nbsp;WSGI+lighttpd/whatever&nbsp;then&nbsp;you&nbsp;probably&nbsp;already&nbsp;had&nbsp;this&nbsp;property&nbsp;as&nbsp;well.&lt;br&gt;&lt;br&gt;Put&nbsp;another&nbsp;way,&nbsp;Twisted's&nbsp;WSGI&nbsp;container&nbsp;is&nbsp;still&nbsp;just&nbsp;a&nbsp;WSGI&nbsp;container.&nbsp;&nbsp;Fortunately&nbsp;Twisted&nbsp;has&nbsp;other&nbsp;pieces&nbsp;aside&nbsp;from&nbsp;a&nbsp;WSGI&nbsp;container.&nbsp;:)&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;wonder&nbsp;if&nbsp;this&nbsp;could&nbsp;be&nbsp;turned&nbsp;on&nbsp;its&nbsp;head&nbsp;-&nbsp;instead&nbsp;of&nbsp;having&nbsp;the&nbsp;Django&nbsp;WSGI&nbsp;app&nbsp;blocking&nbsp;while&nbsp;waiting&nbsp;for&nbsp;a&nbsp;long&nbsp;running&nbsp;thing,&nbsp;field&nbsp;the&nbsp;request&nbsp;beforehand,&nbsp;do&nbsp;whatever&nbsp;long-running&nbsp;thing&nbsp;is&nbsp;required&nbsp;and&nbsp;only&nbsp;then&nbsp;hand&nbsp;over&nbsp;the&nbsp;to&nbsp;the&nbsp;WSGI&nbsp;app&nbsp;to&nbsp;proceed&nbsp;with&nbsp;the&nbsp;HTTP&nbsp;response.&nbsp;This&nbsp;obviously&nbsp;requires&nbsp;a&nbsp;level&nbsp;request&nbsp;processing&nbsp;in&nbsp;Twisted&nbsp;-&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;if&nbsp;it's&nbsp;worth&nbsp;the&nbsp;effort.&nbsp;It&nbsp;could&nbsp;be&nbsp;done&nbsp;by&nbsp;a&nbsp;Twisted-savvy&nbsp;WSGI&nbsp;middleware,&nbsp;perhaps.&nbsp;I'll&nbsp;try&nbsp;to&nbsp;see&nbsp;what&nbsp;I&nbsp;can&nbsp;come&nbsp;up&nbsp;with.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Orestis&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Jean-Paul&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
