<tt>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;TITLE&gt;Re:&nbsp;[Twisted-Python]&nbsp;Flow-control&nbsp;for&nbsp;Pipes&nbsp;/&nbsp;Unix&nbsp;Domains&nbsp;Sockets?&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;Hi&nbsp;Itamar,&lt;BR&gt;<br>
&lt;BR&gt;<br>
once&nbsp;again&nbsp;Twisted&nbsp;surprises&nbsp;me:&nbsp;it&nbsp;just&nbsp;works!&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;have&nbsp;tested&nbsp;a&nbsp;master/child&nbsp;combo&nbsp;over&nbsp;pipe&nbsp;(both&nbsp;Twisted)&nbsp;with&nbsp;a&nbsp;push&nbsp;producer&nbsp;on&nbsp;the&nbsp;sending&nbsp;leg.&lt;BR&gt;<br>
&lt;BR&gt;<br>
It&nbsp;can&nbsp;push&nbsp;around&nbsp;70MB/s&nbsp;raw&nbsp;binary&nbsp;(16k&nbsp;write&nbsp;size)&nbsp;to&nbsp;the&nbsp;child.&nbsp;Load&nbsp;is&nbsp;evenly&nbsp;on&nbsp;2&nbsp;CPU&nbsp;cores&nbsp;each&nbsp;at&nbsp;80%&nbsp;and&nbsp;stays&nbsp;roughly&nbsp;constant.&nbsp;Memory&nbsp;is&nbsp;flat&nbsp;for&nbsp;both.&lt;BR&gt;<br>
&lt;BR&gt;<br>
This&nbsp;is&nbsp;on&nbsp;some&nbsp;years&nbsp;old&nbsp;Macbook&nbsp;(kqueue&nbsp;reactor&nbsp;..&nbsp;a&nbsp;little&nbsp;faster&nbsp;than&nbsp;select)&nbsp;-&nbsp;tomorrow&nbsp;I&nbsp;repeat&nbsp;on&nbsp;a&nbsp;beefy&nbsp;system/OS.&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;will&nbsp;do&nbsp;more&nbsp;systematic&nbsp;throughput&nbsp;and&nbsp;also&nbsp;latency&nbsp;measurements&nbsp;..&nbsp;but&nbsp;this&nbsp;is&nbsp;already&nbsp;not&nbsp;bad&nbsp;at&nbsp;all.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Moreso:&nbsp;I&nbsp;really&nbsp;am&nbsp;curious&nbsp;now&nbsp;how&nbsp;that&nbsp;works&nbsp;under&nbsp;the&nbsp;hood,&nbsp;since&nbsp;the&nbsp;pausing/resuming&nbsp;seems&nbsp;to&nbsp;be&nbsp;upper/lower&nbsp;watermark&nbsp;controlled&nbsp;..&nbsp;it'll&nbsp;resume&nbsp;the&nbsp;producer&nbsp;before&nbsp;the&nbsp;consumer&nbsp;starves.&nbsp;As&nbsp;it&nbsp;should&nbsp;be;)&lt;BR&gt;<br>
&lt;BR&gt;<br>
Background:&nbsp;this&nbsp;is&nbsp;part&nbsp;of&nbsp;experiments&nbsp;in&nbsp;preparation&nbsp;for&nbsp;a&nbsp;multi-core&nbsp;capable&nbsp;Autobahn&nbsp;based&nbsp;message&nbsp;broker&nbsp;..&lt;BR&gt;<br>
&lt;BR&gt;<br>
Takeaway:&nbsp;Next&nbsp;time&nbsp;I&nbsp;don't&nbsp;waste&nbsp;time&nbsp;on&nbsp;the&nbsp;internet&nbsp;reading&nbsp;half-baked&nbsp;posts,&nbsp;but&nbsp;just&nbsp;hack&nbsp;away;)&lt;BR&gt;<br>
&lt;BR&gt;<br>
/Tobias&nbsp;&lt;BR&gt;<br>
&lt;BR&gt;<br>
PS:&nbsp;The&nbsp;following&nbsp;is&nbsp;actually&nbsp;slower&nbsp;than&nbsp;above&nbsp;master/slave&nbsp;pair&nbsp;..&nbsp;which&nbsp;I&nbsp;also&nbsp;didn't&nbsp;expect:&lt;BR&gt;<br>
&lt;BR&gt;<br>
tobias-obersteins-macbook-pro-2:masterchild&nbsp;oberstet$&nbsp;time&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1k&nbsp;count=1000000&nbsp;|&nbsp;wc&nbsp;-c&lt;BR&gt;<br>
1000000+0&nbsp;records&nbsp;in&lt;BR&gt;<br>
1000000+0&nbsp;records&nbsp;out&lt;BR&gt;<br>
1024000000&nbsp;bytes&nbsp;transferred&nbsp;in&nbsp;17.454178&nbsp;secs&nbsp;(58667902&nbsp;bytes/sec)&lt;BR&gt;<br>
&nbsp;1024000000&lt;BR&gt;<br>
&lt;BR&gt;<br>
real&nbsp;&nbsp;&nbsp;&nbsp;0m17.460s&lt;BR&gt;<br>
user&nbsp;&nbsp;&nbsp;&nbsp;0m18.389s&lt;BR&gt;<br>
sys&nbsp;&nbsp;&nbsp;&nbsp;0m7.729s&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;22.10.13&nbsp;02:00,&nbsp;&quot;Itamar&nbsp;Turner-Trauring&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;itamar@itamarst.org&quot;&gt;itamar@itamarst.org&lt;/a&gt;&gt;&nbsp;wrote:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;&nbsp;&nbsp;&nbsp;&lt;BR&gt;<br>
On&nbsp;10/21/2013&nbsp;04:48&nbsp;PM,&nbsp;Tobias&nbsp;Oberstein&nbsp;wrote:&lt;BR&gt;<br>
&nbsp;&lt;BR&gt;<br>
&nbsp;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;&nbsp;Flow-control&nbsp;for&nbsp;Pipes&nbsp;/&nbsp;Unix&nbsp;Domains&nbsp;Sockets?&nbsp;Hi,&lt;BR&gt;<br>
&nbsp;&lt;BR&gt;<br>
&nbsp;with&nbsp;TCP&nbsp;(either&nbsp;remote&nbsp;or&nbsp;loopback)&nbsp;I&nbsp;can&nbsp;have&nbsp;flow-control&nbsp;using&nbsp;the&nbsp;producer-consumer&nbsp;machinery&nbsp;that&nbsp;Twisted&nbsp;provides.&lt;BR&gt;<br>
&nbsp;&lt;BR&gt;<br>
&nbsp;Is&nbsp;that&nbsp;(flow-control&nbsp;/&nbsp;producer-consumer)&nbsp;also&nbsp;available&nbsp;(and&nbsp;practically&nbsp;usable/recommended)&nbsp;with:&lt;BR&gt;<br>
&nbsp;&lt;BR&gt;<br>
&nbsp;a)&nbsp;Unix&nbsp;Domain&nbsp;sockets&lt;BR&gt;<br>
&nbsp;b)&nbsp;Pipes&nbsp;(spawnProcess)&lt;BR&gt;<br>
&nbsp;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;&nbsp;&lt;BR&gt;<br>
&nbsp;I&nbsp;would&nbsp;expect&nbsp;transport.registerProducer&nbsp;to&nbsp;work&nbsp;with&nbsp;both.&lt;BR&gt;<br>
&nbsp;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/BLOCKQUOTE&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>
<br>

</tt>
