<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello,&lt;br&gt;&lt;br&gt;I&#39;ve&nbsp;got&nbsp;a&nbsp;problem&nbsp;when&nbsp;using&nbsp;Twisted&nbsp;UDP-based&nbsp;app&nbsp;with&nbsp;IPv6.&nbsp;I&nbsp;know&nbsp;UDP&nbsp;IPv6&nbsp;is&nbsp;not&nbsp;yet&nbsp;officially&nbsp;supported,&nbsp;I&nbsp;am&nbsp;using&nbsp;the&nbsp;unoffcial&nbsp;hack&nbsp;found&nbsp;somewhere&nbsp;on&nbsp;the&nbsp;net.&lt;br&gt;&lt;br&gt;----------------UNOFFICIAL&nbsp;HACK----------------------&lt;br&gt;<br>
In&nbsp;twisted/internet/udp.py:&lt;br&gt;&lt;br&gt;(...)&lt;br&gt;   &nbsp;def&nbsp;__init__(self,&nbsp;port,&nbsp;proto,&nbsp;interface=&#39;&#39;,&nbsp;maxPacketSize=8192,&nbsp;reactor=None):&lt;br&gt;       &nbsp;&quot;&quot;&quot;&lt;br&gt;       &nbsp;Initialize&nbsp;with&nbsp;a&nbsp;numeric&nbsp;port&nbsp;to&nbsp;listen&nbsp;on.&lt;br&gt;<br>
       &nbsp;&quot;&quot;&quot;&lt;br&gt;       &nbsp;base.BasePort.__init__(self,&nbsp;reactor)&lt;br&gt;       &nbsp;self.port&nbsp;=&nbsp;port&lt;br&gt;       &nbsp;self.protocol&nbsp;=&nbsp;proto&lt;br&gt;       &nbsp;self.maxPacketSize&nbsp;=&nbsp;maxPacketSize&lt;br&gt;       &nbsp;self.interface&nbsp;=&nbsp;interface&lt;br&gt;<br>
       &nbsp;self.setLogStr()&lt;br&gt;       &nbsp;self._connectedAddr&nbsp;=&nbsp;None&lt;br&gt;+      &nbsp;if&nbsp;interface&nbsp;and&nbsp;abstract.isIPv6Address(interface):&nbsp;###&lt;br&gt;+         &nbsp;self.addressFamily&nbsp;=&nbsp;socket.AF_INET6&nbsp;###&lt;br&gt;&lt;br&gt;(...)&lt;br&gt;   &nbsp;def&nbsp;doRead(self):&lt;br&gt;<br>
       &nbsp;&quot;&quot;&quot;&lt;br&gt;       &nbsp;Called&nbsp;when&nbsp;my&nbsp;socket&nbsp;is&nbsp;ready&nbsp;for&nbsp;reading.&lt;br&gt;       &nbsp;&quot;&quot;&quot;&lt;br&gt;       &nbsp;read&nbsp;=&nbsp;0&lt;br&gt;       &nbsp;while&nbsp;read&nbsp;&lt;&nbsp;self.maxThroughput:&lt;br&gt;           &nbsp;try:&lt;br&gt;               &nbsp;data,&nbsp;addr&nbsp;=&nbsp;self.socket.recvfrom(self.maxPacketSize)&lt;br&gt;<br>
           &nbsp;except&nbsp;socket.error&nbsp;as&nbsp;se:&lt;br&gt;               &nbsp;no&nbsp;=&nbsp;se.args[0]&lt;br&gt;               &nbsp;if&nbsp;no&nbsp;in&nbsp;_sockErrReadIgnore:&lt;br&gt;                   &nbsp;return&lt;br&gt;               &nbsp;if&nbsp;no&nbsp;in&nbsp;_sockErrReadRefuse:&lt;br&gt;                   &nbsp;if&nbsp;self._connectedAddr:&lt;br&gt;<br>
                       &nbsp;self.protocol.connectionRefused()&lt;br&gt;                   &nbsp;return&lt;br&gt;               &nbsp;raise&lt;br&gt;           &nbsp;else:&lt;br&gt;               &nbsp;read&nbsp;+=&nbsp;len(data)&lt;br&gt;               &nbsp;try:&lt;br&gt;+                &nbsp;addr&nbsp;=&nbsp;(addr[0],&nbsp;addr[1])&nbsp;###&lt;br&gt;<br>
                   &nbsp;self.protocol.datagramReceived(data,&nbsp;addr)&lt;br&gt;               &nbsp;except:&lt;br&gt;                   &nbsp;log.err()&lt;br&gt;--------------END&nbsp;OF&nbsp;UNOFFICIAL&nbsp;HACK------------------------&lt;br&gt;&lt;br&gt;I&nbsp;deploy&nbsp;my&nbsp;protocol&nbsp;like&nbsp;that:&lt;br&gt;<br>
&lt;br&gt;reactor.listenUDP(5683,&nbsp;myapp.MyProtocol(),&nbsp;interface=&quot;::&quot;)&lt;br&gt;reactor.run()&lt;br&gt;&lt;br&gt;The&nbsp;problem&nbsp;is:&nbsp;&lt;br&gt;1.&nbsp;My&nbsp;server&nbsp;receives&nbsp;a&nbsp;request&nbsp;from&nbsp;remote&nbsp;client&nbsp;(with&nbsp;destination&nbsp;address&nbsp;being&nbsp;valid&nbsp;global&nbsp;IPv6&nbsp;address)&lt;br&gt;<br>
2.&nbsp;The&nbsp;server&nbsp;sends&nbsp;a&nbsp;response,&nbsp;but&nbsp;uses&nbsp;different&nbsp;source&nbsp;address&nbsp;(which&nbsp;is&nbsp;also&nbsp;valid&nbsp;and&nbsp;assigned&nbsp;to&nbsp;local&nbsp;wlan0&nbsp;interface).&nbsp;&lt;br&gt;3.&nbsp;Remote&nbsp;host&nbsp;drops&nbsp;the&nbsp;response&nbsp;(destination&nbsp;address&nbsp;of&nbsp;the&nbsp;request&nbsp;and&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;response&nbsp;do&nbsp;not&nbsp;match).&lt;br&gt;<br>
&lt;br&gt;It&nbsp;is&nbsp;common&nbsp;for&nbsp;IPv6&nbsp;interfaces&nbsp;to&nbsp;have&nbsp;multiple&nbsp;global&nbsp;IPv6&nbsp;addresses&nbsp;-&nbsp;because&nbsp;of&nbsp;privacy&nbsp;reasons&nbsp;(both&nbsp;on&nbsp;Windows&nbsp;and&nbsp;Linux).&lt;br&gt;&lt;br&gt;My&nbsp;question&nbsp;is&nbsp;-&nbsp;can&nbsp;I&nbsp;read&nbsp;manually&nbsp;the&nbsp;destination&nbsp;address&nbsp;from&nbsp;the&nbsp;incoming&nbsp;request&nbsp;datagram,&nbsp;and&nbsp;set&nbsp;it&nbsp;as&nbsp;a&nbsp;source&nbsp;address&nbsp;manually&nbsp;in&nbsp;the&nbsp;outgoing&nbsp;response&nbsp;datagram?&lt;br&gt;<br>
&lt;br&gt;Best&nbsp;Regards&lt;br&gt;Maciej&nbsp;Wasilak&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
