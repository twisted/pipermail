<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Apr&nbsp;27,&nbsp;2021,&nbsp;at&nbsp;8:58&nbsp;PM,&nbsp;Wim&nbsp;Lewis&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:wiml@hhhh.org&quot;&nbsp;class=&quot;&quot;&gt;wiml@hhhh.org&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Thursday,&nbsp;April&nbsp;8,&nbsp;2021&nbsp;8:43:35&nbsp;AM&nbsp;PDT,&nbsp;Barry&nbsp;Scott&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;We&nbsp;just&nbsp;added&nbsp;a&nbsp;patch&nbsp;to&nbsp;our&nbsp;twisted&nbsp;to&nbsp;prevent&nbsp;twisted&nbsp;from&nbsp;doing&nbsp;idna&nbsp;validation.&lt;br&nbsp;class=&quot;&quot;&gt;_idnaBytes&nbsp;and&nbsp;_idnaText&nbsp;not&nbsp;convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;unicode&nbsp;based&nbsp;on&nbsp;the&nbsp;type&nbsp;of&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;provided&nbsp;arg.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;We&nbsp;had&nbsp;to&nbsp;do&nbsp;this&nbsp;because&nbsp;there&nbsp;are&nbsp;domain&nbsp;names&nbsp;that&nbsp;&lt;a&nbsp;href=&quot;http://youtube.com&quot;&nbsp;class=&quot;&quot;&gt;youtube.com&lt;/a&gt;&nbsp;uses&nbsp;that&nbsp;are&lt;br&nbsp;class=&quot;&quot;&gt;not&nbsp;valid&nbsp;under&nbsp;IDNA-2008&nbsp;&lt;a&nbsp;href=&quot;https://tools.ietf.org/html/rfc5891#section-4.2.3.1&quot;&nbsp;class=&quot;&quot;&gt;https://tools.ietf.org/html/rfc5891#section-4.2.3.1&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;My&nbsp;reading&nbsp;of&nbsp;the&nbsp;RFC&nbsp;is&nbsp;that&nbsp;the&nbsp;YouTube&nbsp;domain&nbsp;you&nbsp;mention&nbsp;(r2---&lt;a&nbsp;href=&quot;http://sn-aigzrn7e.googlevideo.com&quot;&nbsp;class=&quot;&quot;&gt;sn-aigzrn7e.googlevideo.com&lt;/a&gt;)&nbsp;is&nbsp;an&nbsp;invalid&nbsp;&quot;U-Label&quot;,&nbsp;but&nbsp;that&nbsp;doesn't&nbsp;mean&nbsp;it's&nbsp;an&nbsp;entirely&nbsp;invaid&nbsp;domain&nbsp;label.&nbsp;It&nbsp;just&nbsp;means&nbsp;you&nbsp;can't&nbsp;legally&nbsp;run&nbsp;it&nbsp;through&nbsp;IDNA&nbsp;and&nbsp;turn&nbsp;it&nbsp;into&nbsp;&quot;xn--r2---sn-aigzrn7e-&quot;.&nbsp;The&nbsp;intent,&nbsp;as&nbsp;I&nbsp;understand&nbsp;it,&nbsp;is&nbsp;to&nbsp;forbid&nbsp;any&nbsp;possibility&nbsp;of&nbsp;double-encoding&nbsp;or&nbsp;double-decoding&nbsp;a&nbsp;label,&nbsp;not&nbsp;to&nbsp;forbid&nbsp;the&nbsp;possibility&nbsp;of&nbsp;using&nbsp;labels&nbsp;like&nbsp;the&nbsp;one&nbsp;you&nbsp;mention.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;agree&nbsp;with&nbsp;this&nbsp;reading.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;I&nbsp;can&nbsp;see&nbsp;why&nbsp;a&nbsp;UI&nbsp;would&nbsp;need&nbsp;to&nbsp;do&nbsp;IDNA-2008&nbsp;converts&nbsp;and&nbsp;validation&lt;br&nbsp;class=&quot;&quot;&gt;but&nbsp;I'm&nbsp;not&nbsp;clear&nbsp;why&nbsp;its&nbsp;of&nbsp;value&nbsp;deep&nbsp;in&nbsp;the&nbsp;guts&nbsp;of&nbsp;twisted.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;My&nbsp;guess&nbsp;is&nbsp;that&nbsp;this&nbsp;is&nbsp;just&nbsp;an&nbsp;accident&nbsp;of&nbsp;the&nbsp;way&nbsp;that&nbsp;the&nbsp;bytes/characters&nbsp;distinction&nbsp;and&nbsp;the&nbsp;IDNA&nbsp;features&nbsp;were&nbsp;added&nbsp;to&nbsp;Twisted,&nbsp;and&nbsp;is&nbsp;probably&nbsp;a&nbsp;bug.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;+1.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;also&nbsp;have&nbsp;other&nbsp;issues&nbsp;with&nbsp;the&nbsp;Python&nbsp;IDNA&nbsp;library:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/kjd/idna/issues/18&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/kjd/idna/issues/18&lt;/a&gt;&nbsp;and&nbsp;would&nbsp;generally&nbsp;like&nbsp;to&nbsp;reduce&nbsp;our&nbsp;strictness&nbsp;via&nbsp;whatever&nbsp;mechanisms&nbsp;we&nbsp;can,&nbsp;even&nbsp;for&nbsp;things&nbsp;that&nbsp;genuinely&nbsp;require&nbsp;it&nbsp;(which&nbsp;this&nbsp;does&nbsp;not).&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;Why&nbsp;is&nbsp;this&nbsp;code&nbsp;needed&nbsp;at&nbsp;all&nbsp;in&nbsp;twisted?&lt;br&nbsp;class=&quot;&quot;&gt;If&nbsp;its&nbsp;for&nbsp;a&nbsp;high&nbsp;level&nbsp;API&nbsp;then&nbsp;why&nbsp;isn't&nbsp;it&nbsp;being&nbsp;called&nbsp;at&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;edge&nbsp;of&nbsp;the&nbsp;high&nbsp;level&nbsp;API&nbsp;calls?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I'd&nbsp;argue&nbsp;that&nbsp;resolving&nbsp;URLs&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;high&nbsp;level&nbsp;API&nbsp;(from&nbsp;the&nbsp;point&nbsp;of&nbsp;view&nbsp;of&nbsp;the&nbsp;name&nbsp;resoution&nbsp;system)&nbsp;but&nbsp;even&nbsp;so,&nbsp;it&nbsp;seems&nbsp;to&nbsp;me&nbsp;that&nbsp;Twisted&nbsp;is&nbsp;doing&nbsp;the&nbsp;wrong&nbsp;thing&nbsp;here.&nbsp;The&nbsp;format&nbsp;of&nbsp;that&nbsp;label&nbsp;should&nbsp;prevent&nbsp;it&nbsp;from&nbsp;ever&nbsp;being&nbsp;transformed&nbsp;by&nbsp;IDNA,&nbsp;but&nbsp;shouldn't&nbsp;prevent&nbsp;it&nbsp;from&nbsp;being&nbsp;passed&nbsp;through&nbsp;unchanged,&nbsp;since&nbsp;it&nbsp;doesn't&nbsp;contain&nbsp;any&nbsp;codepoints&nbsp;outside&nbsp;of&nbsp;the&nbsp;usual&nbsp;ASCII&nbsp;range.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Also&nbsp;agreed&nbsp;with&nbsp;all&nbsp;of&nbsp;this.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;The&nbsp;key&nbsp;idea&nbsp;here&nbsp;is&nbsp;that&nbsp;its&nbsp;human&nbsp;input&nbsp;that&nbsp;will&nbsp;be&nbsp;converted.&lt;br&nbsp;class=&quot;&quot;&gt;But&nbsp;the&nbsp;code&nbsp;is&nbsp;used&nbsp;deep&nbsp;in&nbsp;the&nbsp;_sslverify.py&nbsp;where&nbsp;no&nbsp;human&lt;br&nbsp;class=&quot;&quot;&gt;input&nbsp;is&nbsp;entered.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;_sslverify&nbsp;has&nbsp;to&nbsp;check&nbsp;whether&nbsp;the&nbsp;information&nbsp;in&nbsp;the&nbsp;server's&nbsp;certificate&nbsp;matches&nbsp;the&nbsp;URL&nbsp;that&nbsp;the&nbsp;user&nbsp;supplied.&nbsp;Certificates&nbsp;can&nbsp;contain&nbsp;Unicode&nbsp;text&nbsp;—&nbsp;at&nbsp;least&nbsp;in&nbsp;the&nbsp;(completely&nbsp;obsolete)&nbsp;CN-as-domain-name&nbsp;situation&nbsp;—&nbsp;so&nbsp;_sslverify&nbsp;probably&nbsp;picked&nbsp;up&nbsp;the&nbsp;requirement&nbsp;for&nbsp;IDNA&nbsp;transformations&nbsp;from&nbsp;that.&nbsp;(I&nbsp;don't&nbsp;remember&nbsp;whether&nbsp;dNSName&nbsp;SANs&nbsp;can&nbsp;contain&nbsp;unicode.)&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Yep.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;What&nbsp;is&nbsp;the&nbsp;patch&nbsp;you&nbsp;decided&nbsp;to&nbsp;add&nbsp;to&nbsp;your&nbsp;version?&nbsp;Where&nbsp;in&nbsp;_sslverify&nbsp;did&nbsp;the&nbsp;problem&nbsp;surface?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;am&nbsp;also&nbsp;very&nbsp;curious&nbsp;about&nbsp;this&nbsp;:).&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
