<tt>
Thanks&nbsp;for&nbsp;the&nbsp;detailed&nbsp;reply.&lt;br&gt;&lt;br&gt;1.&lt;br&gt;twistd.bat&nbsp;web&nbsp;-n&nbsp;--path=%path%&nbsp;--profile=stats_obj&nbsp;--profiler=cProfile&nbsp;--savestats&lt;br&gt;&lt;br&gt;is&nbsp;NOT&nbsp;working&nbsp;for&nbsp;twisted&nbsp;9.0,&nbsp;--profile&nbsp;and&nbsp;--profiler&nbsp;are&nbsp;both&nbsp;not&nbsp;recognized.&lt;br&gt;&lt;br&gt;<br>
<br>
2.&lt;br&gt;Sounds&nbsp;like&nbsp;I&nbsp;start&nbsp;to&nbsp;work&nbsp;until&nbsp;all&nbsp;the&nbsp;data&nbsp;are&nbsp;received,&nbsp;as&nbsp;the&nbsp;content&nbsp;are&nbsp;multipart/mixed&nbsp;typed&nbsp;pretty&nbsp;large&nbsp;content,&nbsp;I&nbsp;wanna&nbsp;start&nbsp;to&nbsp;find&nbsp;boundaries&nbsp;and&nbsp;save&nbsp;part&nbsp;of&nbsp;them&nbsp;ASAP.&nbsp;Any&nbsp;clue?&lt;br&gt;&lt;br&gt;3.&nbsp;&lt;br&gt;Not&nbsp;only&nbsp;one&nbsp;file,&nbsp;but&nbsp;many&nbsp;files&nbsp;in&nbsp;a&nbsp;multipart/mixed&nbsp;typed&nbsp;body&nbsp;which&nbsp;totally&nbsp;reach&nbsp;a&nbsp;50MB/s&nbsp;speed.&lt;br&gt;<br>
<br>
I&nbsp;made&nbsp;a&nbsp;tests&nbsp;which&nbsp;doing&nbsp;a&nbsp;multipart/mixed&nbsp;request,&nbsp;containing&nbsp;50000&nbsp;*&nbsp;1KB&nbsp;small&nbsp;files.&nbsp;Assume&nbsp;socket.sendall(data)&nbsp;is&nbsp;called&lt;br&gt;at&nbsp;00:00&lt;br&gt;render_POST&nbsp;start:&nbsp;00:03&lt;br&gt;process_multipart_content_start:&nbsp;00:03&lt;br&gt;process_multipart_content_done:00:11&lt;br&gt;<br>
<br>
write_all_small_files_in_one_file_start&nbsp;:00:11&lt;br&gt;write_all_small_files_in_one_file_done:00:13&lt;br&gt;respones_given:00:13&lt;br&gt;&lt;br&gt;Yes,&nbsp;it&nbsp;takes&nbsp;13s&nbsp;to&nbsp;get&nbsp;it&nbsp;done.&nbsp;I&nbsp;can&nbsp;only&nbsp;make&nbsp;the&nbsp;process_multipart_content&nbsp;spend&nbsp;less&nbsp;time&nbsp;by&nbsp;combining&nbsp;those&nbsp;small&nbsp;files&nbsp;in&nbsp;several&nbsp;larger&nbsp;files&nbsp;but&nbsp;I&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;why&nbsp;3s&nbsp;are&nbsp;spend&nbsp;before&nbsp;render_POST.&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Dec&nbsp;29,&nbsp;2009&nbsp;at&nbsp;2:02&nbsp;AM,&nbsp;Reza&nbsp;Lotun&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rlotun@gmail.com&quot;&gt;rlotun@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
Hi,&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;Currently&nbsp;I&#39;m&nbsp;running&nbsp;twisted&nbsp;web&nbsp;via&nbsp;this&nbsp;command&nbsp;line:&lt;br&gt;<br>
&gt;&nbsp;twistd.bat&nbsp;web&nbsp;-n&nbsp;--path=%path%&lt;br&gt;<br>
&lt;/div&gt;&gt;&nbsp;...&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&gt;&nbsp;1.&nbsp;How&nbsp;can&nbsp;I&nbsp;turn&nbsp;on&nbsp;the&nbsp;--profile&nbsp;option?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;You&nbsp;should&nbsp;just&nbsp;be&nbsp;able&nbsp;to&nbsp;do&nbsp;something&nbsp;like:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; twistd.bat&nbsp;web&nbsp;-n&nbsp;--path=%path%&nbsp;--profile=stats_obj&lt;br&gt;<br>
--profiler=cProfile&nbsp;--savestats&lt;br&gt;<br>
&lt;br&gt;<br>
Then&nbsp;after&nbsp;a&nbsp;duration&nbsp;of&nbsp;time&nbsp;pounding&nbsp;the&nbsp;server&nbsp;with&nbsp;requests&nbsp;you&nbsp;can&nbsp;stop&lt;br&gt;<br>
it&nbsp;and&nbsp;introspect&nbsp;the&nbsp;stats_obj&nbsp;file:&lt;br&gt;<br>
&lt;br&gt;<br>
python&lt;br&gt;<br>
&gt;&gt;&nbsp;import&nbsp;pstats&lt;br&gt;<br>
&gt;&gt;&nbsp;s&nbsp;=&nbsp;pstats.Stats(&#39;stats_obj&#39;)&lt;br&gt;<br>
&gt;&gt;&nbsp;s.sort_stats(&#39;time&#39;).print_stats()&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;will&nbsp;give&nbsp;you&nbsp;an&nbsp;ordered&nbsp;list&nbsp;of&nbsp;functions&nbsp;where&nbsp;the&nbsp;most&nbsp;time&nbsp;has&nbsp;been&lt;br&gt;<br>
spent.&nbsp;It&#39;s&nbsp;also&nbsp;useful&nbsp;to&nbsp;sort&nbsp;by&nbsp;cumulative&nbsp;time.&nbsp;For&nbsp;more&nbsp;information&nbsp;on&lt;br&gt;<br>
how&nbsp;to&nbsp;introspect&nbsp;stats&nbsp;objects&nbsp;see&nbsp;the&nbsp;Python&nbsp;documentation&nbsp;for&nbsp;the&nbsp;pstats&lt;br&gt;<br>
and&nbsp;cProfile&nbsp;module.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;2.&nbsp;Any&nbsp;way&nbsp;to&nbsp;know&nbsp;how&nbsp;many&nbsp;millisecond&nbsp;elapsed&nbsp;between&nbsp;&quot;request&nbsp;received&quot;&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;render_POST&nbsp;call?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;You&#39;ll&nbsp;have&nbsp;to&nbsp;measure&nbsp;this&nbsp;yourself&nbsp;I&nbsp;think.&nbsp;A&nbsp;glance&nbsp;at&nbsp;the&nbsp;twisted&lt;br&gt;<br>
codebase&nbsp;informs&nbsp;me:&lt;br&gt;<br>
-&nbsp;In&nbsp;twisted/web/http.py&nbsp;incoming&nbsp;requests&nbsp;are&nbsp;handled&nbsp;by&nbsp;an&lt;br&gt;<br>
HTTPChannel&nbsp;(the&nbsp;protocol&nbsp;from&nbsp;the&nbsp;http&nbsp;server&nbsp;factory)&lt;br&gt;<br>
-&nbsp;Incoming&nbsp;data&nbsp;is&nbsp;processed&nbsp;by&nbsp;the&nbsp;lineReceived&nbsp;method&nbsp;which&nbsp;creates&lt;br&gt;<br>
a&nbsp;Request&nbsp;object&lt;br&gt;<br>
-&nbsp;When&nbsp;all&nbsp;content&nbsp;for&nbsp;a&nbsp;request&nbsp;is&nbsp;received&nbsp;the&nbsp;allContentsReceived&lt;br&gt;<br>
method&nbsp;is&nbsp;invoked,&nbsp;which&nbsp;in&nbsp;turn&nbsp;calls&nbsp;the&nbsp;requestReceived&nbsp;method&nbsp;on&lt;br&gt;<br>
the&nbsp;Request&nbsp;object,&nbsp;which&nbsp;does&nbsp;some&nbsp;internal&nbsp;processing&nbsp;like&nbsp;parsing&nbsp;a&lt;br&gt;<br>
POST-encoded&nbsp;body&nbsp;if&nbsp;there&nbsp;is&nbsp;one.&nbsp;This&nbsp;then&nbsp;calls&nbsp;the&nbsp;process&nbsp;method&lt;br&gt;<br>
on&nbsp;the&nbsp;Request&nbsp;object&lt;br&gt;<br>
-&nbsp;In&nbsp;twisted/web/server.py&nbsp;the&nbsp;Request&nbsp;subclass&#39;&nbsp;process&nbsp;method&nbsp;then&lt;br&gt;<br>
finds&nbsp;the&nbsp;resource&nbsp;being&nbsp;requested&nbsp;and&nbsp;calls&nbsp;the&nbsp;render&nbsp;method&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;imagine&nbsp;you&nbsp;could&nbsp;modify&nbsp;the&nbsp;code&nbsp;in&nbsp;the&nbsp;above&nbsp;places&nbsp;to&nbsp;set&nbsp;global&lt;br&gt;<br>
variables&nbsp;by&nbsp;calling&nbsp;time.time(),&nbsp;and&nbsp;dumping&nbsp;them&nbsp;out&nbsp;at&nbsp;some&nbsp;point.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;3.&nbsp;If&nbsp;there&nbsp;are&nbsp;a&nbsp;bunch&nbsp;of&nbsp;files&nbsp;need&nbsp;to&nbsp;be&nbsp;uploaded&nbsp;(say&nbsp;at&nbsp;50MB/s&nbsp;speed&nbsp;)&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;save&nbsp;by&nbsp;server,&nbsp;Should&nbsp;I&nbsp;write&nbsp;the&nbsp;file&nbsp;directly&nbsp;in&nbsp;render_POST&nbsp;or&nbsp;using&lt;br&gt;<br>
&gt;&nbsp;deferred&nbsp;call?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Do&nbsp;you&nbsp;mean&nbsp;the&nbsp;server&nbsp;will&nbsp;be&nbsp;*receiving*&nbsp;a&nbsp;file&nbsp;in&nbsp;the&nbsp;HTTP&nbsp;request&lt;br&gt;<br>
body?&nbsp;You&nbsp;can&nbsp;access&nbsp;the&nbsp;request&nbsp;body&nbsp;by&nbsp;looking&nbsp;at&nbsp;request.content&lt;br&gt;<br>
which&nbsp;exposes&nbsp;a&nbsp;File-like&nbsp;API&nbsp;(that&nbsp;is,&nbsp;threat&nbsp;it&nbsp;like&nbsp;you&nbsp;would&nbsp;an&lt;br&gt;<br>
open&nbsp;file&nbsp;in&nbsp;Python).&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;want&nbsp;to&nbsp;*send*&nbsp;a&nbsp;file&nbsp;via&nbsp;Twisted,&nbsp;take&nbsp;a&nbsp;look&nbsp;at:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/documents/current/core/howto/producers.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/documents/current/core/howto/producers.html&lt;/a&gt;&lt;br&gt;<br>
and&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/documents/9.0.0/api/twisted.protocols.basic.FileSender.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/documents/9.0.0/api/twisted.protocols.basic.FileSender.html&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Reza&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
Reza&nbsp;Lotun&lt;br&gt;<br>
mobile:&nbsp;+44&nbsp;(0)7521&nbsp;310&nbsp;763&lt;br&gt;<br>
email:&nbsp; &lt;a&nbsp;href=&quot;mailto:rlotun@gmail.com&quot;&gt;rlotun@gmail.com&lt;/a&gt;&lt;br&gt;<br>
work:&nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:reza@tweetdeck.com&quot;&gt;reza@tweetdeck.com&lt;/a&gt;&lt;br&gt;<br>
twitter:&nbsp;@rlotun&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&gt;:&nbsp;~&lt;br&gt;<br>

</tt>
