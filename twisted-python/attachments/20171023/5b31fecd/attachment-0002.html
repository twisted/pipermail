<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Oct&nbsp;23,&nbsp;2017&nbsp;at&nbsp;8:10&nbsp;AM,&nbsp;Barry&nbsp;Scott&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:barry.scott@forcepoint.com&quot;&nbsp;target=&quot;_blank&quot;&gt;barry.scott@forcepoint.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;Saturday,&nbsp;14&nbsp;October&nbsp;2017&nbsp;07:44:12&nbsp;BST&nbsp;Glyph&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;On&nbsp;Oct&nbsp;13,&nbsp;2017,&nbsp;at&nbsp;5:47&nbsp;PM,&nbsp;Jean-Paul&nbsp;Calderone&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;On&nbsp;Fri,&nbsp;Oct&nbsp;13,&nbsp;2017&nbsp;at&nbsp;8:29&nbsp;AM,&nbsp;Barry&nbsp;Scott&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:barry.scott@forcepoint.com&quot;&gt;barry.scott@forcepoint.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:barry.scott@forcepoint.com&quot;&gt;barry.scott@&lt;wbr&gt;forcepoint.com&lt;/a&gt;&gt;&gt;&nbsp;wrote:&nbsp;I&nbsp;have&nbsp;a&nbsp;app&nbsp;that&nbsp;needs&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;send&nbsp;data&nbsp;as&nbsp;an&nbsp;http&nbsp;response.&nbsp;But&nbsp;the&nbsp;data&nbsp;is&nbsp;produced&nbsp;slowly.&nbsp;More&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;slowly&nbsp;then&nbsp;the&nbsp;time&nbsp;taken&nbsp;to&nbsp;transmit&nbsp;it.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;The&nbsp;consumer&nbsp;keeps&nbsp;calling&nbsp;resumeProducing,&nbsp;but&nbsp;there&nbsp;is&nbsp;no&nbsp;data&nbsp;to&nbsp;send&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;often.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;This&nbsp;sounds&nbsp;like&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;consumer. &nbsp;There&nbsp;are&nbsp;two&nbsp;cases.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;If&nbsp;the&nbsp;producer&nbsp;is&nbsp;&quot;streaming&quot;&nbsp;or&nbsp;&quot;push&quot;&nbsp;(two&nbsp;words,&nbsp;one&nbsp;meaning)&nbsp;then&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;consumer&nbsp;should&nbsp;call&nbsp;resumeProducing&nbsp;once&nbsp;and&nbsp;let&nbsp;data&nbsp;come. &nbsp;If&nbsp;it&nbsp;wants&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;to&nbsp;slow&nbsp;down&nbsp;the&nbsp;data,&nbsp;it&nbsp;can&nbsp;call&nbsp;pauseProducing. &nbsp;There&#39;s&nbsp;nothing&nbsp;else&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;it&nbsp;should&nbsp;be&nbsp;doing.&lt;br&gt;<br>
&gt;&nbsp;This&nbsp;is&nbsp;the&nbsp;good&nbsp;kind&nbsp;of&nbsp;producer.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;If&nbsp;the&nbsp;producer&nbsp;is&nbsp;&quot;not&nbsp;streaming&quot;&nbsp;or&nbsp;&quot;pull&quot;&nbsp;(again,&nbsp;one&nbsp;meaning)&nbsp;then&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;consumer&nbsp;should&nbsp;call&nbsp;resumeProducing&nbsp;and&nbsp;wait&nbsp;for&nbsp;a&nbsp;write&nbsp;call. &nbsp;Then&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;should&nbsp;call&nbsp;resumeProducing&nbsp;again&nbsp;(if&nbsp;it&nbsp;wants&nbsp;more&nbsp;data). &nbsp;It&nbsp;should&nbsp;not&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;call&nbsp;resumeProducing&nbsp;again&nbsp;while&nbsp;waiting&nbsp;for&nbsp;a&nbsp;write&nbsp;call.&lt;br&gt;<br>
&gt;&nbsp;This&nbsp;is&nbsp;the&nbsp;bad&nbsp;kind. &nbsp;It&nbsp;is&nbsp;basically&nbsp;pointless. &nbsp;It&nbsp;was&nbsp;a&nbsp;design&nbsp;error&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;include&nbsp;it&nbsp;and&nbsp;it&nbsp;should&nbsp;be&nbsp;removed&nbsp;from&nbsp;Twisted&nbsp;eventually.&lt;br&gt;<br>
&lt;br&gt;<br>
Oh.&nbsp;This&nbsp;is&nbsp;surprising&nbsp;to&nbsp;here&nbsp;what&nbsp;is&nbsp;the&nbsp;rational&nbsp;behind&nbsp;this&nbsp;&quot;good&quot;&nbsp;vs.&lt;br&gt;<br>
&quot;bad&quot;?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;makes&nbsp;it&nbsp;&quot;bad&quot;&nbsp;is&nbsp;that&nbsp;it&nbsp;creates&nbsp;extra&nbsp;work&nbsp;for&nbsp;every&nbsp;consumer&nbsp;implementation. &nbsp;The&nbsp;extra&nbsp;work&nbsp;is&nbsp;implementing&nbsp;largely&nbsp;the&nbsp;same&nbsp;thing&nbsp;every&nbsp;time&nbsp;so&nbsp;it&#39;s&nbsp;also&nbsp;redundant&nbsp;work. &nbsp;The&nbsp;logic&nbsp;for&nbsp;knowing&nbsp;when&nbsp;to&nbsp;call&nbsp;resumeProducing&nbsp;again&nbsp;is&nbsp;always&nbsp;exactly&nbsp;the&nbsp;same&nbsp;regardless&nbsp;of&nbsp;the&nbsp;consumer. &nbsp;It&nbsp;doesn&#39;t&nbsp;belong&nbsp;inside&nbsp;every&nbsp;consumer.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
My&nbsp;use&nbsp;case&nbsp;is&nbsp;that&nbsp;I&#39;m&nbsp;a&nbsp;proxy&nbsp;and&nbsp;I&nbsp;can&nbsp;only&nbsp;produce&nbsp;what&nbsp;has&nbsp;been&nbsp;received&lt;br&gt;<br>
from&nbsp;the&nbsp;other&nbsp;side.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;sounds&nbsp;like&nbsp;it&nbsp;should&nbsp;be&nbsp;a&nbsp;push&nbsp;producer&nbsp;to&nbsp;me.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
A&nbsp;hard&nbsp;CPU&nbsp;loop&nbsp;calling&nbsp;resumeProducing&nbsp;is&nbsp;not&nbsp;appropiate&nbsp;for&nbsp;this&nbsp;use&nbsp;case.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;appropriate&nbsp;behavior&nbsp;for&nbsp;neither&nbsp;kind&nbsp;of&nbsp;producer. &nbsp;As&nbsp;I&nbsp;wrote&nbsp;in&nbsp;my&nbsp;first&nbsp;reply,&nbsp;a&nbsp;consumer&nbsp;with&nbsp;a&nbsp;pull&nbsp;(&quot;not&nbsp;streaming&quot;,&nbsp;&quot;bad&quot;)&nbsp;producer&nbsp;should&nbsp;call&nbsp;resumeProducing&nbsp;once&nbsp;and&nbsp;then&nbsp;wait&nbsp;until&nbsp;write&nbsp;is&nbsp;called&nbsp;on&nbsp;it. &nbsp;After&nbsp;write&nbsp;is&nbsp;called&nbsp;on&nbsp;it,&nbsp;it&nbsp;may&nbsp;call&nbsp;resumeProducing&nbsp;again&nbsp;if&nbsp;it&nbsp;wants.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jean-Paul&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;had&nbsp;to&nbsp;work&nbsp;around&nbsp;what&nbsp;looked&nbsp;like&nbsp;a&nbsp;bug&nbsp;that&nbsp;the&nbsp;streaming&nbsp;parameter&nbsp;is&lt;br&gt;<br>
ignored&nbsp;and&nbsp;call&nbsp;unregisterProducer/&lt;wbr&gt;registedProduced&nbsp;to&nbsp;get&nbsp;back&nbsp;usable&lt;br&gt;<br>
behaviour.&lt;br&gt;<br>
&lt;br&gt;<br>
Barry&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;What&nbsp;is&nbsp;the&nbsp;correct&nbsp;way&nbsp;to&nbsp;pause&nbsp;the&nbsp;consumer&nbsp;so&nbsp;that&nbsp;it&nbsp;does&nbsp;not&nbsp;keep&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;calling&nbsp;resumeProducing?&nbsp;unregisterProducer?&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Probably&nbsp;just&nbsp;fix&nbsp;the&nbsp;consumer&nbsp;implementation&nbsp;to&nbsp;not&nbsp;be&nbsp;broken. &nbsp;Or&nbsp;switch&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;to&nbsp;tubes&nbsp;which&nbsp;has&nbsp;a&nbsp;simpler&nbsp;model&nbsp;and&nbsp;(in&nbsp;principle)&nbsp;fewer&nbsp;places&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;make&nbsp;mistakes.&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;guess&nbsp;is&nbsp;not&nbsp;that&nbsp;the&nbsp;consumer&nbsp;is&nbsp;broken,&nbsp;but&nbsp;rather,&nbsp;you&nbsp;registered&nbsp;your&lt;br&gt;<br>
&gt;&nbsp;producer&nbsp;as&nbsp;the&nbsp;bad&nbsp;kind&nbsp;of&nbsp;producer&nbsp;(&quot;pull&quot;)&nbsp;and&nbsp;it&#39;s&nbsp;just&nbsp;doing&nbsp;as&nbsp;it&nbsp;was&lt;br&gt;<br>
&gt;&nbsp;told,&nbsp;which&nbsp;is&nbsp;to&nbsp;keep&nbsp;calling&nbsp;resumeProducing&nbsp;over&nbsp;and&nbsp;over&nbsp;again&nbsp;every&lt;br&gt;<br>
&gt;&nbsp;time&nbsp;it&nbsp;wants&nbsp;data.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Let&nbsp;us&nbsp;know&nbsp;how&nbsp;it&nbsp;works&nbsp;out!&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Then&nbsp;when&nbsp;the&nbsp;next&nbsp;block&nbsp;of&nbsp;data&nbsp;is&nbsp;available&nbsp;what&nbsp;is&nbsp;the&nbsp;correct&nbsp;way&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;resume&nbsp;the&nbsp;consumer?&nbsp;registerProducer?&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Related&nbsp;to&nbsp;that&nbsp;why&nbsp;does&nbsp;HTTPChannel.registerProducer&nbsp;convert&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;IPullProducer&nbsp;into&nbsp;a&nbsp;IPushProducer&nbsp;using&nbsp;_PullToPush?&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Probably&nbsp;as&nbsp;an&nbsp;attempt&nbsp;to&nbsp;simplify&nbsp;the&nbsp;implementation&nbsp;-&nbsp;to&nbsp;make&nbsp;it&nbsp;so&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;consumer&nbsp;can&nbsp;pretend&nbsp;there&#39;s&nbsp;just&nbsp;one&nbsp;kind&nbsp;of&nbsp;producer&nbsp;instead&nbsp;of&nbsp;two&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;(which&nbsp;would&nbsp;be&nbsp;nice&nbsp;for&nbsp;everyone).&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Jean-Paul&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.&lt;wbr&gt;com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://twistedmatrix.com/cgi-&lt;wbr&gt;bin/mailman/listinfo/twisted-&lt;wbr&gt;python&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.&lt;wbr&gt;com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://twistedmatrix.com/cgi-&lt;wbr&gt;bin/mailman/listinfo/twisted-&lt;wbr&gt;python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
