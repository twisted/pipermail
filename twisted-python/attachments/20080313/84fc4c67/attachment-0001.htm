<tt>
Thanks&nbsp;for&nbsp;your&nbsp;reply.&amp;nbsp;&nbsp;I&nbsp;have&nbsp;tried&nbsp;setting&nbsp;answer&nbsp;to&nbsp;1.&amp;nbsp;&nbsp;I&nbsp;have&nbsp;included&nbsp;an&nbsp;amended&nbsp;version&nbsp;of&nbsp;my&nbsp;programme&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;this&nbsp;email.&lt;br&gt;&lt;br&gt;When&nbsp;I&nbsp;run&nbsp;this,&nbsp;the&nbsp;server&nbsp;reports&nbsp;no&nbsp;error.&amp;nbsp;&nbsp;When&nbsp;I&amp;nbsp;&nbsp;&amp;#39;dig&nbsp;@localhost&nbsp;foo.bar&amp;#39;&nbsp;I&nbsp;get&nbsp;the&nbsp;response:&lt;br&gt;<br>
&lt;br&gt;&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;;;&nbsp;Warning:&nbsp;Message&nbsp;parser&nbsp;reports&nbsp;malformed&nbsp;message&nbsp;packet.&lt;br&gt;&lt;br&gt;;&nbsp;&amp;lt;&amp;lt;&amp;gt;&amp;gt;&nbsp;DiG&nbsp;9.4.1&nbsp;&amp;lt;&amp;lt;&amp;gt;&amp;gt;&nbsp;@localhost&nbsp;foo.bar&lt;br&gt;;&nbsp;(1&nbsp;server&nbsp;found)&lt;br&gt;;;&nbsp;global&nbsp;options:&amp;nbsp;&nbsp;printcmd&lt;br&gt;;;&nbsp;Got&nbsp;answer:&lt;br&gt;<br>
;;&nbsp;-&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;-&nbsp;opcode:&nbsp;QUERY,&nbsp;status:&nbsp;NOERROR,&nbsp;id:&nbsp;18948&lt;br&gt;;;&nbsp;flags:&nbsp;qr&nbsp;rd;&nbsp;QUERY:&nbsp;1,&nbsp;ANSWER:&nbsp;1,&nbsp;AUTHORITY:&nbsp;0,&nbsp;ADDITIONAL:&nbsp;0&lt;br&gt;;;&nbsp;WARNING:&nbsp;recursion&nbsp;requested&nbsp;but&nbsp;not&nbsp;available&lt;br&gt;;;&nbsp;WARNING:&nbsp;Messages&nbsp;has&nbsp;4&nbsp;extra&nbsp;bytes&nbsp;at&nbsp;end&lt;br&gt;<br>
&lt;br&gt;;;&nbsp;QUESTION&nbsp;SECTION:&lt;br&gt;;foo.bar.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;IN&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;A&lt;br&gt;&lt;br&gt;;;&nbsp;Query&nbsp;time:&nbsp;1&nbsp;msec&lt;br&gt;;;&nbsp;SERVER:&nbsp;127.0.0.1#53(&lt;a&nbsp;href=&quot;http://127.0.0.1&quot;&gt;127.0.0.1&lt;/a&gt;)&lt;br&gt;;;&nbsp;WHEN:&nbsp;Thu&nbsp;Mar&nbsp;13&nbsp;07:37:50&nbsp;2008&lt;br&gt;;;&nbsp;MSG&nbsp;SIZE&amp;nbsp;&nbsp;rcvd:&nbsp;29&lt;br&gt;<br>
&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;&lt;br&gt;Wireshark&nbsp;also&nbsp;shows&nbsp;the&nbsp;reply&nbsp;packet&nbsp;to&nbsp;be&nbsp;malformed:&lt;br&gt;&lt;br&gt;0000&amp;nbsp;&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&amp;nbsp;&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;08&nbsp;00&nbsp;45&nbsp;00&amp;nbsp;&amp;nbsp;&nbsp;........&nbsp;......E.&lt;br&gt;0010&amp;nbsp;&nbsp;00&nbsp;39&nbsp;00&nbsp;00&nbsp;40&nbsp;00&nbsp;40&nbsp;11&amp;nbsp;&nbsp;3c&nbsp;b2&nbsp;7f&nbsp;00&nbsp;00&nbsp;01&nbsp;7f&nbsp;00&amp;nbsp;&amp;nbsp;&nbsp;.9..@.@.&nbsp;&amp;lt;.......&lt;br&gt;<br>
0020&amp;nbsp;&nbsp;00&nbsp;01&nbsp;00&nbsp;35&nbsp;82&nbsp;43&nbsp;00&nbsp;25&amp;nbsp;&nbsp;fe&nbsp;38&nbsp;51&nbsp;cf&nbsp;81&nbsp;00&nbsp;00&nbsp;01&amp;nbsp;&amp;nbsp;&nbsp;...5.C.%&nbsp;.8Q.....&lt;br&gt;0030&amp;nbsp;&nbsp;00&nbsp;01&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;03&nbsp;66&amp;nbsp;&nbsp;6f&nbsp;6f&nbsp;03&nbsp;62&nbsp;61&nbsp;72&nbsp;00&nbsp;00&amp;nbsp;&amp;nbsp;&nbsp;.......f&nbsp;oo.bar..&lt;br&gt;0040&amp;nbsp;&nbsp;01&nbsp;00&nbsp;01&nbsp;0a&nbsp;0b&nbsp;0c&nbsp;0d&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&lt;br&gt;You&amp;nbsp;&nbsp;can&nbsp;see&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://10.11.12.13&quot;&gt;10.11.12.13&lt;/a&gt;&nbsp;at&nbsp;the&nbsp;end&nbsp;(hex),&nbsp;but&nbsp;something&nbsp;about&nbsp;the&nbsp;packet&nbsp;is&nbsp;wrong.&lt;br&gt;<br>
&lt;br&gt;Could&nbsp;you&nbsp;point&nbsp;out&nbsp;my&nbsp;mistake?&amp;nbsp;&nbsp;If&nbsp;it&amp;#39;s&nbsp;a&nbsp;bug&nbsp;in&nbsp;twisted.names,&nbsp;I&amp;#39;m&nbsp;happy&nbsp;to&nbsp;look&nbsp;at&nbsp;fixing&nbsp;it&nbsp;(I&amp;#39;ve&nbsp;worked&nbsp;with&nbsp;the&nbsp;dns&nbsp;protocol&nbsp;at&nbsp;packet&nbsp;level&nbsp;before),&nbsp;but&nbsp;I&nbsp;first&nbsp;want&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;I&nbsp;am&nbsp;using&nbsp;the&nbsp;API&nbsp;correctly.&lt;br&gt;<br>
&lt;br&gt;Thanks,&lt;br&gt;&lt;br&gt;Chris.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;#!/usr/bin/python&lt;br&gt;&lt;br&gt;from&nbsp;twisted.internet.protocol&nbsp;import&nbsp;Protocol,&nbsp;Factory&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;from&nbsp;twisted.names.server&nbsp;import&nbsp;DNSServerFactory&lt;br&gt;<br>
from&nbsp;twisted.names.dns&nbsp;import&nbsp;Query,&nbsp;DNSDatagramProtocol,&nbsp;RRHeader,&nbsp;Record_CNAME,&nbsp;Record_A,&nbsp;Message&lt;br&gt;from&nbsp;twisted.names&nbsp;import&nbsp;dns&lt;br&gt;from&nbsp;twisted.internet.interfaces&nbsp;import&nbsp;IAddress&lt;br&gt;&lt;br&gt;class&nbsp;Controller(object):&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;messageReceived(self,&nbsp;m,&nbsp;protocol,&nbsp;addr):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;m,&nbsp;dir(m),&nbsp;m.queries,&nbsp;m.answers&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;this&nbsp;should&nbsp;always&nbsp;answer&nbsp;&lt;a&nbsp;href=&quot;http://10.11.12.13&quot;&gt;10.11.12.13&lt;/a&gt;,&nbsp;regardless&nbsp;of&nbsp;the&nbsp;query&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;m.answer&nbsp;=&nbsp;1&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;m.answers.append(Record_A(address=&amp;quot;&lt;a&nbsp;href=&quot;http://10.11.12.13&quot;&gt;10.11.12.13&lt;/a&gt;&amp;quot;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;protocol.transport.write(m.toStr(),&nbsp;addr)&lt;br&gt;&lt;br&gt;controller&nbsp;=&nbsp;Controller()&lt;br&gt;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;&amp;quot;__main__&amp;quot;:&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.listenUDP(53,&nbsp;DNSDatagramProtocol(controller))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.run()&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;12/03/2008,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Jean-Paul&nbsp;Calderone&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:exarkun@divmod.com&quot;&gt;exarkun@divmod.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
On&nbsp;Wed,&nbsp;12&nbsp;Mar&nbsp;2008&nbsp;08:04:21&nbsp;+0000,&nbsp;Chris&nbsp;Dew&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:chris@sidwells.com&quot;&gt;chris@sidwells.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&nbsp;&amp;gt;I&nbsp;have&nbsp;a&nbsp;small&nbsp;script&nbsp;which&nbsp;answers&nbsp;dns&nbsp;queries&nbsp;by&nbsp;returning&nbsp;the&nbsp;original&lt;br&gt;&nbsp;&amp;gt;message.&amp;nbsp;&amp;nbsp;I&nbsp;have&nbsp;spent&nbsp;a&nbsp;couple&nbsp;of&nbsp;hours&nbsp;RTFMing,&nbsp;but&nbsp;I&nbsp;still&nbsp;cannot&nbsp;find&lt;br&gt;<br>
&nbsp;&amp;gt;out&nbsp;how&nbsp;to&nbsp;correctly&nbsp;add&nbsp;answers&nbsp;to&nbsp;the&nbsp;message,&nbsp;before&nbsp;returning&nbsp;it.&lt;br&gt;&nbsp;&amp;gt;&lt;br&gt;&nbsp;&amp;gt;I&nbsp;want&nbsp;to&nbsp;add&nbsp;an&nbsp;answer,&nbsp;either&nbsp;a&nbsp;Record_CNAME&nbsp;or&nbsp;Record_A,&nbsp;so&nbsp;as&nbsp;to&nbsp;produce&lt;br&gt;&nbsp;&amp;gt;a&nbsp;trivial&nbsp;authoritative-only&nbsp;DNS&nbsp;server.&lt;br&gt;<br>
&nbsp;&amp;gt;&lt;br&gt;&nbsp;&amp;gt;Adding&nbsp;a&nbsp;Record_XXX&nbsp;object&nbsp;to&nbsp;message.answers&nbsp;using&nbsp;the&nbsp;Array&amp;#39;s&nbsp;&amp;#39;append&amp;#39;&lt;br&gt;&nbsp;&amp;gt;method&nbsp;produces&nbsp;a&nbsp;MalformedPacket&nbsp;(according&nbsp;to&nbsp;wireshark),&nbsp;though&nbsp;the&lt;br&gt;&nbsp;&amp;gt;server&nbsp;does&nbsp;not&nbsp;throw&nbsp;any&nbsp;exceptions.&amp;nbsp;&amp;nbsp;&nbsp;(In&nbsp;this&nbsp;situation,&nbsp;the&nbsp;answer&lt;br&gt;<br>
&nbsp;&amp;gt;count,&nbsp;as&nbsp;shown&nbsp;by&nbsp;dig,&nbsp;does&nbsp;rise&nbsp;to&nbsp;1,&nbsp;even&nbsp;though&nbsp;no&nbsp;answer&nbsp;is&nbsp;displayed&lt;br&gt;&nbsp;&amp;gt;[due&nbsp;to&nbsp;malformed&nbsp;packet?].)&lt;br&gt;&nbsp;&amp;gt;&lt;br&gt;&nbsp;&amp;gt;Perhaps&nbsp;there&nbsp;is&nbsp;a&nbsp;completely&nbsp;different&nbsp;way&nbsp;to&nbsp;do&nbsp;this?&amp;nbsp;&amp;nbsp;Could&nbsp;I&nbsp;craft&nbsp;a&lt;br&gt;&nbsp;&amp;gt;message&nbsp;with&nbsp;answers&nbsp;from&nbsp;scratch?&lt;br&gt;<br>
&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;Did&nbsp;you&nbsp;set&nbsp;`m.answer´&nbsp;to&nbsp;1?&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;Jean-Paul&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;_______________________________________________&lt;br&gt;&nbsp;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;&nbsp;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
