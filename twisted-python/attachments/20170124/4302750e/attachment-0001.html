<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Jan&nbsp;24,&nbsp;2017,&nbsp;at&nbsp;12:48&nbsp;PM,&nbsp;Craig&nbsp;Rodrigues&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rodrigc@crodrigues.org&quot;&nbsp;class=&quot;&quot;&gt;rodrigc@crodrigues.org&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;23,&nbsp;2017&nbsp;at&nbsp;5:10&nbsp;PM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;23,&nbsp;2017&nbsp;at&nbsp;7:08&nbsp;PM,&nbsp;Craig&nbsp;Rodrigues&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rodrigc@crodrigues.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;rodrigc@crodrigues.org&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail-m_-4866087461406899210gmail-h5&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;I&nbsp;did&nbsp;some&nbsp;more&nbsp;debugging.&nbsp;&nbsp;The&nbsp;callstack&nbsp;is&nbsp;quite&nbsp;deep.&nbsp;:/&lt;br&nbsp;class=&quot;&quot;&gt;I&nbsp;used&nbsp;this&nbsp;command&nbsp;to&nbsp;trigger&nbsp;the&nbsp;error:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;trial&nbsp;&nbsp;buildbot.test.unit.test_proce&lt;wbr&nbsp;class=&quot;&quot;&gt;ss_buildrequestdistributor.Tes&lt;wbr&nbsp;class=&quot;&quot;&gt;tMaybeStartBuilds.test_slow_db&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I&nbsp;found&nbsp;in&nbsp;this&nbsp;function&nbsp;in&nbsp;buildbot's&nbsp;BuildRequestsEndpoint.get()&nbsp;function&nbsp;(&nbsp;&lt;a&nbsp;href=&quot;https://github.com/buildbot/buildbot/blob/master/master/buildbot/data/buildrequests.py#L146&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/buildbot/bu&lt;wbr&nbsp;class=&quot;&quot;&gt;ildbot/blob/master/master/buil&lt;wbr&nbsp;class=&quot;&quot;&gt;dbot/data/buildrequests.py#&lt;wbr&nbsp;class=&quot;&quot;&gt;L146&lt;/a&gt;&nbsp;)&nbsp;there&nbsp;is&nbsp;this&nbsp;line:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;b&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer.returnValue(&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(yield&nbsp;self.db2data(br))&nbsp;for&nbsp;br&nbsp;in&nbsp;buildrequests])&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/b&gt;&lt;br&nbsp;class=&quot;&quot;&gt;On&nbsp;Python&nbsp;2,&nbsp;this&nbsp;line&nbsp;returns:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&nbsp;&nbsp;an&nbsp;object&nbsp;list&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&nbsp;&nbsp;each&nbsp;list&nbsp;entry&nbsp;is&nbsp;a&nbsp;dictionary&nbsp;of&nbsp;name/value&nbsp;pairs&nbsp;that&nbsp;looks&nbsp;like:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;p&nbsp;class=&quot;gmail-m_-4866087461406899210gmail-m_920830734858214402gmail-p1&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_-4866087461406899210gmail-m_920830734858214402gmail-s1&quot;&gt;[{'buildrequestid':&nbsp;10,&nbsp;'complete':&nbsp;False,&nbsp;'waited_for':&nbsp;False,&nbsp;'claimed_at':&nbsp;None,&nbsp;'results':&nbsp;-1,&nbsp;'claimed':&nbsp;False,&nbsp;'buildsetid':&nbsp;11,&nbsp;'complete_at':&nbsp;None,&nbsp;'submitted_at':&nbsp;datetime.datetime(1970,&nbsp;1,&nbsp;2,&nbsp;12,&nbsp;6,&nbsp;40,&nbsp;tzinfo=tzutc()),&nbsp;'builderid':&nbsp;77,&nbsp;'claimed_by_masterid':&nbsp;None,&nbsp;'priority':&nbsp;0},&nbsp;{'buildrequestid':&nbsp;11,&nbsp;'complete':&nbsp;False,&nbsp;'waited_for':&nbsp;False,&nbsp;'claimed_at':&nbsp;None,&nbsp;'results':&nbsp;-1,&nbsp;'claimed':&nbsp;False,&nbsp;'buildsetid':&nbsp;11,&nbsp;'complete_at':&nbsp;None,&nbsp;'submitted_at':&nbsp;datetime.datetime(1970,&nbsp;1,&nbsp;2,&nbsp;13,&nbsp;30,&nbsp;tzinfo=tzutc()),&nbsp;'builderid':&nbsp;77,&nbsp;'claimed_by_masterid':&nbsp;None,&nbsp;'priority':&nbsp;0}]&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Python&nbsp;3,&nbsp;this&nbsp;returns:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&nbsp;&nbsp;an&nbsp;object&nbsp;&lt;generator&nbsp;object&nbsp;BuildRequestsEndpoint.get.&lt;loc&lt;wbr&nbsp;class=&quot;&quot;&gt;als&gt;.&lt;listcomp&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&nbsp;&nbsp;of&nbsp;type&nbsp;&lt;class&nbsp;'generator'&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Yep.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Python&nbsp;2,&nbsp;[(yield&nbsp;self.db2data(br))&nbsp;for&nbsp;br&nbsp;in&nbsp;buildrequests]&nbsp;is&nbsp;a&nbsp;list&nbsp;comprehension.&nbsp;&nbsp;It&nbsp;will&nbsp;have&nbsp;len(buildrequests)&nbsp;elements&nbsp;and&nbsp;each&nbsp;will&nbsp;be&nbsp;the&nbsp;value&nbsp;sent&nbsp;back&nbsp;in&nbsp;to&nbsp;the&nbsp;generator&nbsp;via&nbsp;the&nbsp;yield&nbsp;expression.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Python&nbsp;3,&nbsp;the&nbsp;same&nbsp;expression&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;one&nbsp;element&nbsp;which&nbsp;is&nbsp;a&nbsp;generator&nbsp;expression.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;This&nbsp;form&nbsp;is&nbsp;much&nbsp;clearer,&nbsp;I&nbsp;think,&nbsp;and&nbsp;behaves&nbsp;as&nbsp;intended&nbsp;on&nbsp;both&nbsp;versions&nbsp;of&nbsp;Python:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;[]&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;br&nbsp;in&nbsp;buildrequests:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results.append((yield&nbsp;self.db2data(br)))&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;defer.returnValue(results)&lt;/div&gt;&lt;span&nbsp;class=&quot;gmail-HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Wow,&nbsp;thanks!&nbsp;&nbsp;That&nbsp;fixed&nbsp;it.&nbsp;&nbsp;I&nbsp;submitted&nbsp;those&nbsp;fixes&nbsp;upstream&nbsp;to&nbsp;buildbot.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;I'm&nbsp;not&nbsp;so&nbsp;familiar&nbsp;with&nbsp;generator&nbsp;expressions&nbsp;and&nbsp;Deferred's&nbsp;so&nbsp;have&nbsp;been&nbsp;playing&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;around&nbsp;with&nbsp;things&nbsp;to&nbsp;try&nbsp;to&nbsp;understand.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;went&nbsp;back&nbsp;to&nbsp;the&nbsp;problem&nbsp;code,&nbsp;and&nbsp;changed:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;b&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer.returnValue(&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(yield&nbsp;self.db2data(br))&nbsp;for&nbsp;br&nbsp;in&nbsp;buildrequests])&lt;/b&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;to:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;b&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer.returnValue(&lt;/b&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;b&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list([&lt;/b&gt;&lt;b&nbsp;class=&quot;&quot;&gt;(yield&nbsp;self.db2data(br))&nbsp;for&nbsp;br&nbsp;in&nbsp;buildrequests])&lt;/b&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;b&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;and&nbsp;ran&nbsp;the&nbsp;code&nbsp;under&nbsp;Python&nbsp;3&nbsp;and&nbsp;got&nbsp;a&nbsp;return&nbsp;value&nbsp;of:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;Deferred&nbsp;]&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;instead&nbsp;of:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;{......}&nbsp;]&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;where&nbsp;the&nbsp;Deferred.results&nbsp;value&nbsp;was&nbsp;the&nbsp;dictionary.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;How&nbsp;does&nbsp;Python&nbsp;2&nbsp;directly&nbsp;go&nbsp;to&nbsp;returning&nbsp;the&nbsp;dictionary&nbsp;out&nbsp;of&nbsp;the&nbsp;Deferred,&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;while&nbsp;Python&nbsp;3&nbsp;returns&nbsp;the&nbsp;Deferred&nbsp;inside&nbsp;the&nbsp;list?&nbsp;&nbsp;self.db2data()&nbsp;returns&nbsp;a&nbsp;Deferred.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I've&nbsp;encountered&nbsp;this&nbsp;before&nbsp;and&nbsp;quickly&nbsp;worked&nbsp;around&nbsp;it,&nbsp;but&nbsp;I&nbsp;think&nbsp;this&nbsp;might&nbsp;actually&nbsp;be&nbsp;a&nbsp;bug&nbsp;in&nbsp;python&nbsp;3,&nbsp;or&nbsp;at&nbsp;least&nbsp;its&nbsp;documentation.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;language&nbsp;docs&nbsp;officially&nbsp;say&nbsp;that&nbsp;a&nbsp;&quot;list&nbsp;display&quot;&nbsp;(which&nbsp;is&nbsp;what&nbsp;I&nbsp;believe&nbsp;we're&nbsp;looking&nbsp;at&nbsp;here)&nbsp;&quot;yields&nbsp;a&nbsp;new&nbsp;list&nbsp;object&quot;.&nbsp;&nbsp;But&nbsp;that&nbsp;is&nbsp;not&nbsp;what&nbsp;I&nbsp;see&nbsp;here:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&gt;&gt;&gt;&nbsp;[(yield&nbsp;1)&nbsp;for&nbsp;x&nbsp;in&nbsp;range(10)]&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;generator&nbsp;object&nbsp;&lt;listcomp&gt;&nbsp;at&nbsp;0x10cd210f8&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;is&nbsp;a&nbsp;comprehension&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;but&nbsp;I'm&nbsp;getting&nbsp;a&nbsp;generator&nbsp;object&nbsp;out&nbsp;rather&nbsp;than&nbsp;a&nbsp;list.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;a&nbsp;PEP&nbsp;for&nbsp;this&nbsp;that&nbsp;just&nbsp;hasn't&nbsp;updated&nbsp;the&nbsp;language&nbsp;reference?&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
