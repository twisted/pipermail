<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks!&nbsp;The&nbsp;trick&nbsp;will&nbsp;be&nbsp;figuring&nbsp;out&nbsp;how&nbsp;to&nbsp;handle&nbsp;Python&nbsp;exception&nbsp;vs werkzeug&nbsp;exception,&nbsp;and&nbsp;the&nbsp;branched,&nbsp;error&nbsp;handling&nbsp;routes&nbsp;etc.&nbsp;Currently&nbsp;this&nbsp;is&nbsp;the&nbsp;sort&nbsp;of&nbsp;data&nbsp;structure&nbsp;I&#39;m&nbsp;posting&nbsp;to&nbsp;Data&nbsp;Dog.&nbsp;But&nbsp;I&nbsp;can&nbsp;make&nbsp;it&nbsp;a&nbsp;pluggable&nbsp;observer-type&nbsp;idiom&nbsp;so&nbsp;anything can&nbsp;receive these&nbsp;metrics. &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(43,43,43);color:rgb(169,183,198);font-family:&quot;JetBrains&nbsp;Mono&quot;,monospace;font-size:9.8pt&quot;&gt;tags=[&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:rgb(165,194,97)&quot;&gt;&quot;path:{}.{}.{}&quot;&lt;/span&gt;.format(module&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;className&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;method)&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(165,194,97)&quot;&gt;&quot;blocking:{}&quot;&lt;/span&gt;.format(isBlocking)&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(165,194,97)&quot;&gt;&quot;module:{}&quot;&lt;/span&gt;.format(module)&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(165,194,97)&quot;&gt;&quot;class:{}&quot;&lt;/span&gt;.format(className)&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(165,194,97)&quot;&gt;&quot;method:{}&quot;&lt;/span&gt;.format(method)&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(165,194,97)&quot;&gt;&quot;status_code:{}&quot;&lt;/span&gt;.format(request_code)&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(165,194,97)&quot;&gt;&quot;status_code_class:{}xx&quot;&lt;/span&gt;.format(status_code_class)&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&lt;br&gt;&lt;/span&gt;]&lt;br&gt;metrics.timing(&lt;span&nbsp;style=&quot;color:rgb(165,194,97)&quot;&gt;&quot;my.rest.endpoint&quot;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;elapsed&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(170,73,38)&quot;&gt;tags&lt;/span&gt;=tags)&lt;br&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don&#39;t&nbsp;have&nbsp;it&nbsp;quite&nbsp;right&nbsp;yet.&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;get&nbsp;the&nbsp;status&nbsp;code,&nbsp;deal&nbsp;with&nbsp;unhandled&nbsp;exceptions,&nbsp;etc.&nbsp;But&nbsp;I&#39;ll&nbsp;post&nbsp;questions&nbsp;here&nbsp;when&nbsp;I&#39;m&nbsp;closer. &lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Wed,&nbsp;Mar&nbsp;3,&nbsp;2021&nbsp;at&nbsp;11:13&nbsp;PM&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;overflow-wrap:&nbsp;break-word;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;On&nbsp;Mar&nbsp;1,&nbsp;2021,&nbsp;at&nbsp;12:51&nbsp;PM,&nbsp;Robert&nbsp;DiFalco&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:robert.difalco@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;robert.difalco@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Is&nbsp;this&nbsp;the&nbsp;right&nbsp;place&nbsp;to&nbsp;ask&nbsp;klein&nbsp;questions?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Absolutely,&nbsp;it&#39;s&nbsp;a&nbsp;Twisted&nbsp;org&nbsp;project.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;writing a&nbsp;metrics&nbsp;plugin&nbsp;for&nbsp;Klein&nbsp;and&nbsp;I&nbsp;can&#39;t&nbsp;figure&nbsp;out&nbsp;how&nbsp;to&nbsp;inject&nbsp;a&nbsp;metrics&nbsp;handler&nbsp;so&nbsp;that&nbsp;I&nbsp;can&nbsp;get&nbsp;route,&nbsp;path,&nbsp;duration,&nbsp;and&nbsp;status&nbsp;code.&nbsp;What&nbsp;I&#39;m&nbsp;doing&nbsp;now&nbsp;sucks&nbsp;because&nbsp;Klein&nbsp;and&nbsp;twisted&nbsp;interact&nbsp;in&nbsp;complex&nbsp;ways&nbsp;on&nbsp;Failure&nbsp;and&nbsp;status&nbsp;codes. &lt;div&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(43,43,43);color:rgb(169,183,198);font-family:&quot;JetBrains&nbsp;Mono&quot;,monospace;font-size:9.8pt&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(128,128,128)&quot;&gt;#&nbsp;Replace&nbsp;the&nbsp;klein&nbsp;_call&nbsp;with&nbsp;the&nbsp;metrics&nbsp;generating&nbsp;call&lt;br&gt;&lt;/span&gt;_app._call&nbsp;=&nbsp;_callWithMetrics&lt;br&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;Rather&nbsp;than&nbsp;replace&nbsp;_call&nbsp;with&nbsp;my&nbsp;version&nbsp;of&nbsp;_call&nbsp;I&nbsp;was&nbsp;hoping&nbsp;there&nbsp;was&nbsp;a&nbsp;cleaner&nbsp;way&nbsp;to&nbsp;get&nbsp;the&nbsp;start&nbsp;and&nbsp;stop&nbsp;with&nbsp;the&nbsp;result&nbsp;code&nbsp;of&nbsp;a&nbsp;route&nbsp;invocation.&nbsp;Thoughts?&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;sounds&nbsp;like&nbsp;you&nbsp;should&nbsp;contribute&nbsp;a&nbsp;patch&nbsp;that&nbsp;makes&nbsp;this&nbsp;an&nbsp;explicitly-supported&nbsp;pluggable&nbsp;entrypoint,&nbsp;rather&nbsp;than&nbsp;relying&nbsp;on&nbsp;a&nbsp;hack. &nbsp;No&nbsp;need&nbsp;to&nbsp;figure&nbsp;out&nbsp;a&nbsp;way&nbsp;to&nbsp;make&nbsp;it&nbsp;work&nbsp;with&nbsp;existing&nbsp;versions,&nbsp;the&nbsp;magic&nbsp;of&nbsp;open&nbsp;source&nbsp;is&nbsp;that&nbsp;you&nbsp;can&nbsp;change&nbsp;it&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Feel&nbsp;free&nbsp;to&nbsp;ping&nbsp;here&nbsp;when&nbsp;it&#39;s&nbsp;done&nbsp;to&nbsp;remind&nbsp;folks&nbsp;to&nbsp;do&nbsp;a&nbsp;review.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-g&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
