<tt>
&lt;html&gt;&lt;body&gt;On&nbsp;04:53&nbsp;pm,&nbsp;matt@zgroupplc.com&nbsp;wrote:&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;I&nbsp;understand&nbsp;why&nbsp;this&nbsp;is&nbsp;occurring,&nbsp;its&nbsp;a&nbsp;simple&nbsp;matter&nbsp;of&nbsp;calling&nbsp;&lt;br&nbsp;/&gt;&gt;tcp.Port.stopListening()&nbsp;to&nbsp;suppress&nbsp;the&nbsp;error.&nbsp;However,&nbsp;I&nbsp;am&nbsp;more&nbsp;&lt;br&nbsp;/&gt;&gt;concerned&nbsp;with&nbsp;learning&nbsp;about&nbsp;where&nbsp;the&nbsp;most&nbsp;appropriate&nbsp;place&nbsp;to&nbsp;run&nbsp;&#160;this&nbsp;&lt;br&nbsp;/&gt;&gt;routine&nbsp;would&nbsp;be.&nbsp;I&nbsp;am&nbsp;not&nbsp;happy&nbsp;about&nbsp;running&nbsp;it&nbsp;in&nbsp;the&nbsp;unit&nbsp;&#160;test&nbsp;as&nbsp;it&nbsp;&lt;br&nbsp;/&gt;&gt;doesn't&nbsp;solve&nbsp;the&nbsp;problem,&nbsp;it&nbsp;just&nbsp;suppresses&nbsp;it.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Putting&nbsp;the&nbsp;stopListening&nbsp;call&nbsp;into&nbsp;the&nbsp;middle&nbsp;of&nbsp;the&nbsp;actual&nbsp;test&nbsp;method&nbsp;would&nbsp;definitely&nbsp;be&nbsp;wrong.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;However,&nbsp;putting&nbsp;the&nbsp;listenTCP&nbsp;in&nbsp;the&nbsp;setUp&nbsp;and&nbsp;the&nbsp;stopListening&nbsp;in&nbsp;the&nbsp;tearDown&nbsp;would&nbsp;be&nbsp;entirely&nbsp;appropriate.&nbsp;&#160;If&nbsp;the&nbsp;code&nbsp;under&nbsp;test&nbsp;dynamically&nbsp;calls&nbsp;stopListening&nbsp;and&nbsp;might&nbsp;fail&nbsp;before&nbsp;then,&nbsp;then&nbsp;a&nbsp;tearDown&nbsp;by&nbsp;itself&nbsp;might&nbsp;be&nbsp;appropriate.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;I&nbsp;can't&nbsp;&#160;seem&nbsp;to&nbsp;find&nbsp;an&nbsp;&lt;br&nbsp;/&gt;&gt;easy&nbsp;way&nbsp;to&nbsp;stop&nbsp;a&nbsp;port&nbsp;from&nbsp;listening&nbsp;from&nbsp;within&nbsp;a&nbsp;&#160;ServerFactory.&nbsp;Should&nbsp;&lt;br&nbsp;/&gt;&gt;I&nbsp;be&nbsp;writing&nbsp;a&nbsp;class&nbsp;that&nbsp;wraps&nbsp;the&nbsp;&#160;ServerFactory&nbsp;to&nbsp;run&nbsp;&lt;br&nbsp;/&gt;&gt;tcp.Port.stopListening()&nbsp;at&nbsp;the&nbsp;appropriate&nbsp;time?&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;This&nbsp;is,&nbsp;in&nbsp;part,&nbsp;a&nbsp;weakness&nbsp;of&nbsp;the&nbsp;IProtocolFactory&nbsp;interface.&nbsp;&#160;Calls&nbsp;to&nbsp;doStart&nbsp;and&nbsp;doStop&nbsp;should&nbsp;really&nbsp;receive&nbsp;an&nbsp;IListeningPort&nbsp;argument.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;However,&nbsp;this&nbsp;is&nbsp;a&nbsp;minor&nbsp;wart.&nbsp;&#160;listenTCP&nbsp;returns&nbsp;the&nbsp;Port,&nbsp;and&nbsp;hooking&nbsp;this&nbsp;up&nbsp;to&nbsp;your&nbsp;server&nbsp;factory&nbsp;in&nbsp;application&nbsp;code&nbsp;should&nbsp;be&nbsp;easy&nbsp;enough.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;Please&nbsp;bear&nbsp;in&nbsp;mind&nbsp;that&nbsp;I&nbsp;am&nbsp;creating&nbsp;multiple&nbsp;'one-shot'&nbsp;servers&nbsp;&#160;that&nbsp;are&nbsp;&lt;br&nbsp;/&gt;&gt;always&nbsp;shut&nbsp;down&nbsp;as&nbsp;soon&nbsp;as&nbsp;they&nbsp;have&nbsp;done&nbsp;their&nbsp;business.&nbsp;I&nbsp;&#160;am&nbsp;guessing&nbsp;&lt;br&nbsp;/&gt;&gt;that&nbsp;the&nbsp;stopService&nbsp;methods&nbsp;would&nbsp;be&nbsp;more&nbsp;appropriate&nbsp;&#160;for&nbsp;a&nbsp;conventional&nbsp;&lt;br&nbsp;/&gt;&gt;server&nbsp;that&nbsp;serves&nbsp;multiple&nbsp;clients&nbsp;/&nbsp;requests.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;If&nbsp;they&nbsp;are&nbsp;&quot;always&nbsp;shut&nbsp;down&quot;,&nbsp;what&nbsp;event&nbsp;currently&nbsp;shuts&nbsp;them&nbsp;down?&nbsp;&#160;Have&nbsp;your&nbsp;test&nbsp;trigger&nbsp;that&nbsp;event.&nbsp;&#160;If&nbsp;they're&nbsp;one-shot,&nbsp;then&nbsp;perhaps&nbsp;the&nbsp;method&nbsp;that&nbsp;calls&nbsp;listenTCP&nbsp;should&nbsp;be&nbsp;on&nbsp;the&nbsp;factory&nbsp;itself,&nbsp;making&nbsp;it&nbsp;even&nbsp;easier&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;the&nbsp;Port&nbsp;instance&nbsp;it&nbsp;is&nbsp;associated&nbsp;with.&lt;br&nbsp;/&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
