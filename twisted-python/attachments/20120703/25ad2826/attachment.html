<tt>
&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Jun&nbsp;28,&nbsp;2012&nbsp;at&nbsp;9:40&nbsp;PM,&nbsp;Dan&nbsp;Stromberg&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:drsalists@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;drsalists@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;style=&quot;margin-left:40px&quot;&gt;&lt;br&gt;&lt;/div&gt;Hi.&lt;br&gt;&lt;br&gt;I&#39;m&nbsp;a&nbsp;Twisted&nbsp;neophyte,&nbsp;but&nbsp;I&#39;ve&nbsp;been&nbsp;using&nbsp;Python&nbsp;a&nbsp;long&nbsp;time.&lt;br&gt;&lt;br&gt;My&nbsp;question:&lt;br&gt;<br>
&lt;div&nbsp;style=&quot;margin-left:40px&quot;&gt;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;of&nbsp;producing&nbsp;a&nbsp;deferred&nbsp;<br>
graph&nbsp;in&nbsp;a&nbsp;Python&nbsp;program&nbsp;at&nbsp;a&nbsp;given&nbsp;point&nbsp;in&nbsp;time?&nbsp; Perhaps&nbsp;something&nbsp;<br>
based&nbsp;on&nbsp;graphviz&nbsp;and&nbsp;objgraph.py?&nbsp; We&#39;re&nbsp;able&nbsp;to&nbsp;detect&nbsp;when&nbsp;we&#39;re&nbsp;<br>
having&nbsp;the&nbsp;problem,&nbsp;we&nbsp;just&nbsp;don&#39;t&nbsp;(yet)&nbsp;know&nbsp;its&nbsp;cause.&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;&lt;br&gt;Background:&lt;br&gt;&lt;div&nbsp;style=&quot;margin-left:40px&quot;&gt;I&#39;m&nbsp;looking&nbsp;at&nbsp;some&nbsp;code&nbsp;with&nbsp;a&nbsp;bit&nbsp;over&nbsp;200&nbsp;addCallback/addErrback/addCallbacks&nbsp;in&nbsp;it.&lt;br&gt;&lt;br&gt;It&#39;s&nbsp;got&nbsp;a&nbsp;problem&nbsp;where&nbsp;sometimes&nbsp;the&nbsp;deferreds&nbsp;seem&nbsp;to&nbsp;just&nbsp;stop&nbsp;executing.&nbsp; I&nbsp;see&nbsp;in&nbsp;the&nbsp;doc&nbsp;it&nbsp;says&nbsp;that&nbsp;this&nbsp;can&nbsp;happen&nbsp;if&nbsp;you&#39;ve&nbsp;neglected&nbsp;to&nbsp;add&nbsp;an&nbsp;errback&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;of&nbsp;your&nbsp;deferred&nbsp;chains.&lt;br&gt;<br>
<br>
&lt;br&gt;One&nbsp;of&nbsp;the&nbsp;people&nbsp;who&#39;s&nbsp;been&nbsp;here&nbsp;longer&nbsp;than&nbsp;me,&nbsp;indicated&nbsp;that&nbsp;he&#39;s&nbsp;gone&nbsp;through&nbsp;the&nbsp;code&nbsp;looking&nbsp;for&nbsp;such&nbsp;issues,&nbsp;and&nbsp;didn&#39;t&nbsp;find&nbsp;any.&nbsp; This&nbsp;suggests&nbsp;to&nbsp;me&nbsp;that&nbsp;either&nbsp;there&#39;s&nbsp;some&nbsp;other&nbsp;cause,&nbsp;or&nbsp;that&nbsp;it&nbsp;really&nbsp;is&nbsp;a&nbsp;deferred&nbsp;without&nbsp;a&nbsp;final&nbsp;errback,&nbsp;but&nbsp;it&#39;s&nbsp;hidden&nbsp;in&nbsp;a&nbsp;dark&nbsp;corner&nbsp;of&nbsp;the&nbsp;code&nbsp;somewhere.&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;br&gt;&lt;br&gt;Thanks!&lt;br&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;I&nbsp;put&nbsp;together&nbsp;something&nbsp;to&nbsp;do&nbsp;a&nbsp;single-point-in-time&nbsp;graph&nbsp;(as&nbsp;distorted/delayed&nbsp;by&nbsp;the&nbsp;time&nbsp;it&nbsp;takes&nbsp;to&nbsp;go&nbsp;through&nbsp;all&nbsp;the&nbsp;objects&nbsp;in&nbsp;the&nbsp;python&nbsp;interpreter)&nbsp;of&nbsp;deferreds. &nbsp;Please&nbsp;find&nbsp;it&nbsp;below&nbsp;as&nbsp;a&nbsp;shar&nbsp;archive&nbsp;(wow,&nbsp;someone&nbsp;still&nbsp;does&nbsp;those?  &nbsp;Yeah,&nbsp;sometimes) &nbsp;Anyway,&nbsp;given&nbsp;a&nbsp;tree&nbsp;of&nbsp;deferreds,&nbsp;this&nbsp;will&nbsp;produce&nbsp;a&nbsp;whatever.dot&nbsp;file,&nbsp;which&nbsp;can&nbsp;be&nbsp;fed&nbsp;to&nbsp;graphviz&#39;&nbsp;&quot;dot&nbsp;-Tpdf&nbsp;whatever.dot&nbsp;&gt;&nbsp;whatever.pdf&quot;,&nbsp;and&nbsp;the&nbsp;pdf&nbsp;has&nbsp;a&nbsp;rather&nbsp;nice-looking&nbsp;graph&nbsp;of&nbsp;the&nbsp;deferreds.&lt;br&gt;<br>
&lt;br&gt;#!/bin/sh&lt;br&gt;#&nbsp;This&nbsp;is&nbsp;a&nbsp;shell&nbsp;archive&nbsp;(produced&nbsp;by&nbsp;GNU&nbsp;sharutils&nbsp;4.11.1).&lt;br&gt;#&nbsp;To&nbsp;extract&nbsp;the&nbsp;files&nbsp;from&nbsp;this&nbsp;archive,&nbsp;save&nbsp;it&nbsp;to&nbsp;some&nbsp;FILE,&nbsp;remove&lt;br&gt;#&nbsp;everything&nbsp;before&nbsp;the&nbsp;`#!/bin/sh&#39;&nbsp;line&nbsp;above,&nbsp;then&nbsp;type&nbsp;`sh&nbsp;FILE&#39;.&lt;br&gt;<br>
#&lt;br&gt;lock_dir=_sh32156&lt;br&gt;#&nbsp;Made&nbsp;on&nbsp;2012-07-02&nbsp;21:48&nbsp;UTC&nbsp;by&nbsp;&lt;stromberg@aw50&gt;.&lt;br&gt;#&nbsp;Source&nbsp;directory&nbsp;was&nbsp;`/home/stromberg/src/twisted-experiments&#39;.&lt;br&gt;#&lt;br&gt;#&nbsp;Existing&nbsp;files&nbsp;will&nbsp;*not*&nbsp;be&nbsp;overwritten,&nbsp;unless&nbsp;`-c&#39;&nbsp;is&nbsp;specified.&lt;br&gt;<br>
#&lt;br&gt;#&nbsp;This&nbsp;shar&nbsp;contains:&lt;br&gt;#&nbsp;length&nbsp;mode      &nbsp;name&lt;br&gt;#&nbsp;------&nbsp;----------&nbsp;------------------------------------------&lt;br&gt;#  &nbsp;2181&nbsp;-rwxr-xr-x&nbsp;deferreddump.py&lt;br&gt;#  &nbsp;3174&nbsp;-rwxr-xr-x&nbsp;wedgedump&lt;br&gt;#&lt;br&gt;MD5SUM=${MD5SUM-md5sum}&lt;br&gt;<br>
f=`${MD5SUM}&nbsp;--version&nbsp;|&nbsp;egrep&nbsp;&#39;^md5sum&nbsp;.*(core|text)utils&#39;`&lt;br&gt;test&nbsp;-n&nbsp;&quot;${f}&quot;&nbsp;&amp;&amp;&nbsp;md5check=true&nbsp;||&nbsp;md5check=false&lt;br&gt;${md5check}&nbsp;||&nbsp;\&lt;br&gt; &nbsp;echo&nbsp;&#39;Note:&nbsp;not&nbsp;verifying&nbsp;md5sums. &nbsp;Consider&nbsp;installing&nbsp;GNU&nbsp;coreutils.&#39;&lt;br&gt;<br>
if&nbsp;test&nbsp;&quot;X$1&quot;&nbsp;=&nbsp;&quot;X-c&quot;&lt;br&gt;then&nbsp;keep_file=&#39;&#39;&lt;br&gt;else&nbsp;keep_file=true&lt;br&gt;fi&lt;br&gt;echo=echo&lt;br&gt;save_IFS=&quot;${IFS}&quot;&lt;br&gt;IFS=&quot;${IFS}:&quot;&lt;br&gt;gettext_dir=&lt;br&gt;locale_dir=&lt;br&gt;set_echo=false&lt;br&gt;<br>
&lt;br&gt;for&nbsp;dir&nbsp;in&nbsp;$PATH&lt;br&gt;do&lt;br&gt; &nbsp;if&nbsp;test&nbsp;-f&nbsp;$dir/gettext&nbsp;\&lt;br&gt;    &nbsp;&amp;&amp;&nbsp;($dir/gettext&nbsp;--version&nbsp;&gt;/dev/null&nbsp;2&gt;&amp;1)&lt;br&gt; &nbsp;then&lt;br&gt;   &nbsp;case&nbsp;`$dir/gettext&nbsp;--version&nbsp;2&gt;&amp;1&nbsp;|&nbsp;sed&nbsp;1q`&nbsp;in&lt;br&gt;     &nbsp;*GNU*)&nbsp;gettext_dir=$dir&lt;br&gt;<br>
     &nbsp;set_echo=true&lt;br&gt;     &nbsp;break&nbsp;;;&lt;br&gt;   &nbsp;esac&lt;br&gt; &nbsp;fi&lt;br&gt;done&lt;br&gt;&lt;br&gt;if&nbsp;${set_echo}&lt;br&gt;then&lt;br&gt; &nbsp;set_echo=false&lt;br&gt; &nbsp;for&nbsp;dir&nbsp;in&nbsp;$PATH&lt;br&gt; &nbsp;do&lt;br&gt;   &nbsp;if&nbsp;test&nbsp;-f&nbsp;$dir/shar&nbsp;\&lt;br&gt;      &nbsp;&amp;&amp;&nbsp;($dir/shar&nbsp;--print-text-domain-dir&nbsp;&gt;/dev/null&nbsp;2&gt;&amp;1)&lt;br&gt;<br>
   &nbsp;then&lt;br&gt;     &nbsp;locale_dir=`$dir/shar&nbsp;--print-text-domain-dir`&lt;br&gt;     &nbsp;set_echo=true&lt;br&gt;     &nbsp;break&lt;br&gt;   &nbsp;fi&lt;br&gt; &nbsp;done&lt;br&gt;&lt;br&gt; &nbsp;if&nbsp;${set_echo}&lt;br&gt; &nbsp;then&lt;br&gt;   &nbsp;TEXTDOMAINDIR=$locale_dir&lt;br&gt;   &nbsp;export&nbsp;TEXTDOMAINDIR&lt;br&gt;<br>
   &nbsp;TEXTDOMAIN=sharutils&lt;br&gt;   &nbsp;export&nbsp;TEXTDOMAIN&lt;br&gt;   &nbsp;echo=&quot;$gettext_dir/gettext&nbsp;-s&quot;&lt;br&gt; &nbsp;fi&lt;br&gt;fi&lt;br&gt;IFS=&quot;$save_IFS&quot;&lt;br&gt;if&nbsp;(echo&nbsp;&quot;testing\c&quot;;&nbsp;echo&nbsp;1,2,3)&nbsp;|&nbsp;grep&nbsp;c&nbsp;&gt;/dev/null&lt;br&gt;then&nbsp;if&nbsp;(echo&nbsp;-n&nbsp;test;&nbsp;echo&nbsp;1,2,3)&nbsp;|&nbsp;grep&nbsp;n&nbsp;&gt;/dev/null&lt;br&gt;<br>
    &nbsp;then&nbsp;shar_n=&nbsp;shar_c=&#39;&lt;br&gt;&#39;&lt;br&gt;    &nbsp;else&nbsp;shar_n=-n&nbsp;shar_c=&nbsp;;&nbsp;fi&lt;br&gt;else&nbsp;shar_n=&nbsp;shar_c=&#39;\c&#39;&nbsp;;&nbsp;fi&lt;br&gt;f=shar-touch.$$&lt;br&gt;st1=200112312359.59&lt;br&gt;st2=123123592001.59&lt;br&gt;st2tr=123123592001.5&nbsp;#&nbsp;old&nbsp;SysV&nbsp;14-char&nbsp;limit&lt;br&gt;<br>
st3=1231235901&lt;br&gt;&lt;br&gt;if&nbsp;touch&nbsp;-am&nbsp;-t&nbsp;${st1}&nbsp;${f}&nbsp;&gt;/dev/null&nbsp;2&gt;&amp;1&nbsp;&amp;&amp;&nbsp;\&lt;br&gt;  &nbsp;test&nbsp;!&nbsp;-f&nbsp;${st1}&nbsp;&amp;&amp;&nbsp;test&nbsp;-f&nbsp;${f};&nbsp;then&lt;br&gt; &nbsp;shar_touch=&#39;touch&nbsp;-am&nbsp;-t&nbsp;$1$2$3$4$5$6.$7&nbsp;&quot;$8&quot;&#39;&lt;br&gt;&lt;br&gt;elif&nbsp;touch&nbsp;-am&nbsp;${st2}&nbsp;${f}&nbsp;&gt;/dev/null&nbsp;2&gt;&amp;1&nbsp;&amp;&amp;&nbsp;\&lt;br&gt;<br>
  &nbsp;test&nbsp;!&nbsp;-f&nbsp;${st2}&nbsp;&amp;&amp;&nbsp;test&nbsp;!&nbsp;-f&nbsp;${st2tr}&nbsp;&amp;&amp;&nbsp;test&nbsp;-f&nbsp;${f};&nbsp;then&lt;br&gt; &nbsp;shar_touch=&#39;touch&nbsp;-am&nbsp;$3$4$5$6$1$2.$7&nbsp;&quot;$8&quot;&#39;&lt;br&gt;&lt;br&gt;elif&nbsp;touch&nbsp;-am&nbsp;${st3}&nbsp;${f}&nbsp;&gt;/dev/null&nbsp;2&gt;&amp;1&nbsp;&amp;&amp;&nbsp;\&lt;br&gt;<br>
  &nbsp;test&nbsp;!&nbsp;-f&nbsp;${st3}&nbsp;&amp;&amp;&nbsp;test&nbsp;-f&nbsp;${f};&nbsp;then&lt;br&gt; &nbsp;shar_touch=&#39;touch&nbsp;-am&nbsp;$3$4$5$6$2&nbsp;&quot;$8&quot;&#39;&lt;br&gt;&lt;br&gt;else&lt;br&gt; &nbsp;shar_touch=:&lt;br&gt; &nbsp;echo&lt;br&gt; &nbsp;${echo}&nbsp;&#39;WARNING:&nbsp;not&nbsp;restoring&nbsp;timestamps. &nbsp;Consider&nbsp;getting&nbsp;and&lt;br&gt;<br>
installing&nbsp;GNU&nbsp;`touch&#39;\&#39;&#39;,&nbsp;distributed&nbsp;in&nbsp;GNU&nbsp;coreutils...&#39;&lt;br&gt; &nbsp;echo&lt;br&gt;fi&lt;br&gt;rm&nbsp;-f&nbsp;${st1}&nbsp;${st2}&nbsp;${st2tr}&nbsp;${st3}&nbsp;${f}&lt;br&gt;#&lt;br&gt;if&nbsp;test&nbsp;!&nbsp;-d&nbsp;${lock_dir}&nbsp;;&nbsp;then&nbsp;:&lt;br&gt;else&nbsp;${echo}&nbsp;&quot;lock&nbsp;directory&nbsp;${lock_dir}&nbsp;exists&quot;&lt;br&gt;<br>
    &nbsp;exit&nbsp;1&lt;br&gt;fi&lt;br&gt;if&nbsp;mkdir&nbsp;${lock_dir}&lt;br&gt;then&nbsp;${echo}&nbsp;&quot;x&nbsp;-&nbsp;created&nbsp;lock&nbsp;directory&nbsp;${lock_dir}.&quot;&lt;br&gt;else&nbsp;${echo}&nbsp;&quot;x&nbsp;-&nbsp;failed&nbsp;to&nbsp;create&nbsp;lock&nbsp;directory&nbsp;${lock_dir}.&quot;&lt;br&gt;    &nbsp;exit&nbsp;1&lt;br&gt;fi&lt;br&gt;#&nbsp;=============&nbsp;deferreddump.py&nbsp;==============&lt;br&gt;<br>
if&nbsp;test&nbsp;-n&nbsp;&quot;${keep_file}&quot;&nbsp;&amp;&amp;&nbsp;test&nbsp;-f&nbsp;&#39;deferreddump.py&#39;&lt;br&gt;then&lt;br&gt;${echo}&nbsp;&quot;x&nbsp;-&nbsp;SKIPPING&nbsp;deferreddump.py&nbsp;(file&nbsp;already&nbsp;exists)&quot;&lt;br&gt;else&lt;br&gt;${echo}&nbsp;&quot;x&nbsp;-&nbsp;extracting&nbsp;deferreddump.py&nbsp;(text)&quot;&lt;br&gt;<br>
 &nbsp;sed&nbsp;&#39;s/^X//&#39;&nbsp;&lt;&lt;&nbsp;&#39;SHAR_EOF&#39;&nbsp;&gt;&nbsp;&#39;deferreddump.py&#39;&nbsp;&amp;&amp;&lt;br&gt;#!/usr/bin/python&lt;br&gt;X&lt;br&gt;#&nbsp;See&nbsp;also:&nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/trac/ticket/3858&quot;&gt;http://twistedmatrix.com/trac/ticket/3858&lt;/a&gt;&lt;br&gt;<br>
#&nbsp;and:     &nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/trac/ticket/1402&quot;&gt;http://twistedmatrix.com/trac/ticket/1402&lt;/a&gt;&lt;br&gt;#&nbsp;and:&lt;br&gt;#  &nbsp;twisted.internet.defer&nbsp;also&nbsp;exposes&nbsp;a&nbsp;setDebugging(bool)&nbsp;function&nbsp;to&lt;br&gt;#  &nbsp;store&nbsp;call&nbsp;stacks&nbsp;from&nbsp;creation&nbsp;and&nbsp;invocation&nbsp;in&nbsp;deferred&nbsp;objects,&lt;br&gt;<br>
#  &nbsp;it&#39;s&nbsp;what&nbsp;I&nbsp;was&nbsp;using&nbsp;to&nbsp;try&nbsp;and&nbsp;figure&nbsp;out&nbsp;what&nbsp;was&nbsp;going&nbsp;on,&nbsp;but&lt;br&gt;#  &nbsp;it&#39;s&nbsp;not&nbsp;nearly&nbsp;as&nbsp;at-a-glance&nbsp;as&nbsp;a&nbsp;graph&nbsp;is.&lt;br&gt;X&lt;br&gt;import&nbsp;gc&lt;br&gt;import&nbsp;sys&lt;br&gt;X&lt;br&gt;import&nbsp;twisted.internet.defer&lt;br&gt;X&lt;br&gt;def&nbsp;escape(callback_type,&nbsp;obj):&lt;br&gt;<br>
X   &nbsp;dummy&nbsp;=&nbsp;callback_type&lt;br&gt;X   &nbsp;return&nbsp;&#39;%s&#39;&nbsp;%&nbsp;(str(obj).replace(&#39;&nbsp;&#39;,&nbsp;&#39;_&#39;).replace(&#39;:&#39;,&nbsp;&#39;&#39;).replace(&#39;&lt;&#39;,&nbsp;&#39;&#39;).replace(&#39;&gt;&#39;,&nbsp;&#39;&#39;),&nbsp;)&lt;br&gt;X&lt;br&gt;def&nbsp;dump(outfile&nbsp;=&nbsp;sys.stdout):&lt;br&gt;<br>
X   &nbsp;outfile.write(&#39;digraph&nbsp;deferred_digraph&nbsp;{\n&#39;)&lt;br&gt;X   &nbsp;for&nbsp;obj&nbsp;in&nbsp;gc.get_objects():&lt;br&gt;X       &nbsp;if&nbsp;isinstance(obj,&nbsp;twisted.internet.defer.Deferred):&lt;br&gt;X           &nbsp;len_callbacks&nbsp;=&nbsp;len(obj.callbacks)&lt;br&gt;X           &nbsp;if&nbsp;obj.callbacks:&lt;br&gt;<br>
X               &nbsp;outfile.write(&#39;\t%s&nbsp;-&gt;&nbsp;%s\n&#39;&nbsp;%&nbsp;(escape(&#39;&#39;,&nbsp;obj),&nbsp;escape(&#39;&#39;,&nbsp;obj.callbacks[0][0][0])))&lt;br&gt;X               &nbsp;outfile.write(&#39;\t%s&nbsp;-&gt;&nbsp;%s\n&#39;&nbsp;%&nbsp;(escape(&#39;&#39;,&nbsp;obj),&nbsp;escape(&#39;&#39;,&nbsp;obj.callbacks[0][1][0])))&lt;br&gt;<br>
X           &nbsp;for&nbsp;callbackpairno&nbsp;in&nbsp;range(len_callbacks&nbsp;-&nbsp;1):&lt;br&gt;X               &nbsp;current_callback&nbsp;=&nbsp;obj.callbacks[callbackpairno][0]&lt;br&gt;X               &nbsp;current_errback&nbsp;=&nbsp;obj.callbacks[callbackpairno][1]&lt;br&gt;X               &nbsp;current_callback_desc&nbsp;=&nbsp;current_callback[0]&lt;br&gt;<br>
X               &nbsp;current_errback_desc&nbsp;=&nbsp;current_errback[0]&lt;br&gt;X&lt;br&gt;X               &nbsp;next_callback&nbsp;=&nbsp;obj.callbacks[callbackpairno&nbsp;+&nbsp;1][0]&lt;br&gt;X               &nbsp;next_errback&nbsp;=&nbsp;obj.callbacks[callbackpairno&nbsp;+&nbsp;1][1]&lt;br&gt;X               &nbsp;next_callback_desc&nbsp;=&nbsp;next_callback[0]&lt;br&gt;<br>
X               &nbsp;next_errback_desc&nbsp;=&nbsp;next_errback[0]&lt;br&gt;X&lt;br&gt;X               &nbsp;outfile.write(&#39;\t%s&nbsp;-&gt;&nbsp;%s;\n&#39;&nbsp;%&nbsp;(escape(&#39;callback&#39;,&nbsp;current_callback_desc),&nbsp;escape(&#39;callback&#39;,&nbsp;next_callback_desc)))&lt;br&gt;<br>
X               &nbsp;outfile.write(&#39;\t%s&nbsp;-&gt;&nbsp;%s;\n&#39;&nbsp;%&nbsp;(escape(&#39;errback&#39;,&nbsp;current_errback_desc),&nbsp;escape(&#39;errback&#39;,&nbsp;next_errback_desc)))&lt;br&gt;X&lt;br&gt;X               &nbsp;outfile.write(&#39;\t%s&nbsp;-&gt;&nbsp;%s;\n&#39;&nbsp;%&nbsp;(escape(&#39;callback&#39;,&nbsp;current_callback_desc),&nbsp;escape(&#39;errback&#39;,&nbsp;next_errback_desc)))&lt;br&gt;<br>
X               &nbsp;outfile.write(&#39;\t%s&nbsp;-&gt;&nbsp;%s;\n&#39;&nbsp;%&nbsp;(escape(&#39;errback&#39;,&nbsp;current_errback_desc),&nbsp;escape(&#39;callback&#39;,&nbsp;next_callback_desc)))&lt;br&gt;X&lt;br&gt;X   &nbsp;outfile.write(&#39;}\n&#39;)&lt;br&gt;X&lt;br&gt;X&lt;br&gt;SHAR_EOF&lt;br&gt;<br>
 &nbsp;(set&nbsp;20&nbsp;12&nbsp;06&nbsp;29&nbsp;18&nbsp;02&nbsp;00&nbsp;&#39;deferreddump.py&#39;&lt;br&gt;  &nbsp;eval&nbsp;&quot;${shar_touch}&quot;)&nbsp;&amp;&amp;&nbsp;\&lt;br&gt; &nbsp;chmod&nbsp;0755&nbsp;&#39;deferreddump.py&#39;&lt;br&gt;if&nbsp;test&nbsp;$?&nbsp;-ne&nbsp;0&lt;br&gt;then&nbsp;${echo}&nbsp;&quot;restore&nbsp;of&nbsp;deferreddump.py&nbsp;failed&quot;&lt;br&gt;<br>
fi&lt;br&gt; &nbsp;if&nbsp;${md5check}&lt;br&gt; &nbsp;then&nbsp;(&lt;br&gt;      &nbsp;${MD5SUM}&nbsp;-c&nbsp;&gt;/dev/null&nbsp;2&gt;&amp;1&nbsp;||&nbsp;${echo}&nbsp;&#39;deferreddump.py&#39;:&nbsp;&#39;MD5&nbsp;check&nbsp;failed&#39;&lt;br&gt;      &nbsp;)&nbsp;&lt;&lt;&nbsp;\SHAR_EOF&lt;br&gt;45b2aed37cc2e57bc58f46a42eb2a2d4 &nbsp;deferreddump.py&lt;br&gt;<br>
SHAR_EOF&lt;br&gt; &nbsp;else&lt;br&gt;test&nbsp;`LC_ALL=C&nbsp;wc&nbsp;-c&nbsp;&lt;&nbsp;&#39;deferreddump.py&#39;`&nbsp;-ne&nbsp;2181&nbsp;&amp;&amp;&nbsp;\&lt;br&gt; &nbsp;${echo}&nbsp;&quot;restoration&nbsp;warning: &nbsp;size&nbsp;of&nbsp;&#39;deferreddump.py&#39;&nbsp;is&nbsp;not&nbsp;2181&quot;&lt;br&gt; &nbsp;fi&lt;br&gt;fi&lt;br&gt;#&nbsp;=============&nbsp;wedgedump&nbsp;==============&lt;br&gt;<br>
if&nbsp;test&nbsp;-n&nbsp;&quot;${keep_file}&quot;&nbsp;&amp;&amp;&nbsp;test&nbsp;-f&nbsp;&#39;wedgedump&#39;&lt;br&gt;then&lt;br&gt;${echo}&nbsp;&quot;x&nbsp;-&nbsp;SKIPPING&nbsp;wedgedump&nbsp;(file&nbsp;already&nbsp;exists)&quot;&lt;br&gt;else&lt;br&gt;${echo}&nbsp;&quot;x&nbsp;-&nbsp;extracting&nbsp;wedgedump&nbsp;(text)&quot;&lt;br&gt; &nbsp;sed&nbsp;&#39;s/^X//&#39;&nbsp;&lt;&lt;&nbsp;&#39;SHAR_EOF&#39;&nbsp;&gt;&nbsp;&#39;wedgedump&#39;&nbsp;&amp;&amp;&lt;br&gt;<br>
#!/usr/bin/python&lt;br&gt;X&lt;br&gt;#&nbsp;Unhandled&nbsp;Errors&lt;br&gt;X&lt;br&gt;#&nbsp;From&nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/documents/current/core/howto/defer.html&quot;&gt;http://twistedmatrix.com/documents/current/core/howto/defer.html&lt;/a&gt;&nbsp;:&lt;br&gt;X&lt;br&gt;#  &nbsp;If&nbsp;a&nbsp;Deferred&nbsp;is&nbsp;garbage-collected&nbsp;with&nbsp;an&nbsp;unhandled&nbsp;error&nbsp;(i.e.&nbsp;it&lt;br&gt;<br>
#  &nbsp;would&nbsp;call&nbsp;the&nbsp;next&nbsp;errback&nbsp;if&nbsp;there&nbsp;was&nbsp;one),&nbsp;then&nbsp;Twisted&nbsp;will&nbsp;write&lt;br&gt;#  &nbsp;the&nbsp;error&#39;s&nbsp;traceback&nbsp;to&nbsp;the&nbsp;log&nbsp;file.&nbsp;This&nbsp;means&nbsp;that&nbsp;you&nbsp;can&lt;br&gt;#  &nbsp;typically&nbsp;get&nbsp;away&nbsp;with&nbsp;not&nbsp;adding&nbsp;errbacks&nbsp;and&nbsp;still&nbsp;get&nbsp;errors&lt;br&gt;<br>
#  &nbsp;logged.&nbsp;Be&nbsp;careful&nbsp;though;&nbsp;if&nbsp;you&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;Deferred&lt;br&gt;#  &nbsp;around,&nbsp;preventing&nbsp;it&nbsp;from&nbsp;being&nbsp;garbage-collected,&nbsp;then&nbsp;you&nbsp;may&nbsp;never&lt;br&gt;#  &nbsp;see&nbsp;the&nbsp;error&nbsp;(and&nbsp;your&nbsp;callbacks&nbsp;will&nbsp;mysteriously&nbsp;seem&nbsp;to&nbsp;have&nbsp;never&lt;br&gt;<br>
#  &nbsp;been&nbsp;called).&nbsp;If&nbsp;unsure,&nbsp;you&nbsp;should&nbsp;explicitly&nbsp;add&nbsp;an&nbsp;errback&nbsp;after&lt;br&gt;#  &nbsp;your&nbsp;callbacks,&nbsp;even&nbsp;if&nbsp;all&nbsp;you&nbsp;do&nbsp;is:&lt;br&gt;X&lt;br&gt;#      &nbsp;#&nbsp;Make&nbsp;sure&nbsp;errors&nbsp;get&nbsp;logged&lt;br&gt;#      &nbsp;from&nbsp;twisted.python&nbsp;import&nbsp;log&lt;br&gt;#      &nbsp;d.addErrback(log.err)&lt;br&gt;<br>
X&lt;br&gt;import&nbsp;sys&lt;br&gt;#mport&nbsp;time&lt;br&gt;X&lt;br&gt;import&nbsp;twisted.internet.defer&lt;br&gt;import&nbsp;twisted.python&lt;br&gt;X&lt;br&gt;import&nbsp;deferreddump&lt;br&gt;X&lt;br&gt;def&nbsp;get_deferred():&lt;br&gt;X   &nbsp;return&nbsp;twisted.internet.defer.succeed(1)&lt;br&gt;X&lt;br&gt;def&nbsp;cb1(value):&lt;br&gt;<br>
X   &nbsp;print&nbsp;value&lt;br&gt;X   &nbsp;return&nbsp;value&nbsp;*&nbsp;2&lt;br&gt;X&lt;br&gt;def&nbsp;cb2(value):&lt;br&gt;X   &nbsp;#raise&nbsp;ValueError&lt;br&gt;X   &nbsp;print&nbsp;value&lt;br&gt;X   &nbsp;return&nbsp;value&nbsp;*&nbsp;2&lt;br&gt;X&lt;br&gt;def&nbsp;cb3(value):&lt;br&gt;X   &nbsp;print&nbsp;value&lt;br&gt;X   &nbsp;return&nbsp;value&nbsp;*&nbsp;2&lt;br&gt;X&lt;br&gt;def&nbsp;cb4(value):&lt;br&gt;<br>
X   &nbsp;print&nbsp;value&lt;br&gt;X   &nbsp;return&nbsp;value&nbsp;*&nbsp;2&lt;br&gt;X&lt;br&gt;def&nbsp;cb5(value):&lt;br&gt;X   &nbsp;print&nbsp;value&lt;br&gt;X   &nbsp;return&nbsp;value&nbsp;*&nbsp;2&lt;br&gt;X&lt;br&gt;def&nbsp;cb6(value):&lt;br&gt;X   &nbsp;print&nbsp;value&lt;br&gt;X   &nbsp;return&nbsp;value&nbsp;*&nbsp;2&lt;br&gt;X&lt;br&gt;def&nbsp;cb7(value):&lt;br&gt;X   &nbsp;print&nbsp;value&lt;br&gt;<br>
X   &nbsp;return&nbsp;value&nbsp;*&nbsp;2&lt;br&gt;X&lt;br&gt;def&nbsp;cb8(value):&lt;br&gt;X   &nbsp;print&nbsp;value&lt;br&gt;X   &nbsp;return&nbsp;value&nbsp;*&nbsp;2&lt;br&gt;X&lt;br&gt;def&nbsp;eb1(value):&lt;br&gt;X   &nbsp;twisted.python.log.err()&lt;br&gt;X&lt;br&gt;def&nbsp;eb2(value):&lt;br&gt;X   &nbsp;twisted.python.log.err()&lt;br&gt;X&lt;br&gt;def&nbsp;eb3(value):&lt;br&gt;<br>
X   &nbsp;twisted.python.log.err()&lt;br&gt;X&lt;br&gt;def&nbsp;eb4(value):&lt;br&gt;X   &nbsp;twisted.python.log.err()&lt;br&gt;X&lt;br&gt;def&nbsp;eb5(value):&lt;br&gt;X   &nbsp;twisted.python.log.err()&lt;br&gt;X&lt;br&gt;def&nbsp;eb6(value):&lt;br&gt;X   &nbsp;twisted.python.log.err()&lt;br&gt;X&lt;br&gt;def&nbsp;eb7(value):&lt;br&gt;<br>
X   &nbsp;twisted.python.log.err()&lt;br&gt;X&lt;br&gt;def&nbsp;eb8(value):&lt;br&gt;X   &nbsp;twisted.python.log.err()&lt;br&gt;X&lt;br&gt;def&nbsp;arbitrary_function(add_final_log):&lt;br&gt;X   &nbsp;deferred&nbsp;=&nbsp;get_deferred()&lt;br&gt;X&lt;br&gt;X   &nbsp;#&nbsp;apparently&nbsp;we&nbsp;can&nbsp;use&nbsp;the&nbsp;same&nbsp;callback&nbsp;multiple&nbsp;times&nbsp;in&nbsp;the&nbsp;same&nbsp;deferred&lt;br&gt;<br>
X   &nbsp;first_deferred&nbsp;=&nbsp;deferred.addCallback(cb1)&lt;br&gt;X   &nbsp;first_deferred.pause()&lt;br&gt;X   &nbsp;deferred.addCallbacks(cb1,&nbsp;eb1)&lt;br&gt;X   &nbsp;deferred.addCallbacks(cb2,&nbsp;eb2)&lt;br&gt;X   &nbsp;deferred.addCallbacks(cb3,&nbsp;eb3)&lt;br&gt;X   &nbsp;deferred.addCallbacks(cb4,&nbsp;eb4)&lt;br&gt;<br>
X   &nbsp;deferred.addCallbacks(cb5,&nbsp;eb5)&lt;br&gt;X   &nbsp;deferred.addCallbacks(cb6,&nbsp;eb6)&lt;br&gt;X   &nbsp;deferred.addCallbacks(cb7,&nbsp;eb7)&lt;br&gt;X&lt;br&gt;X   &nbsp;with&nbsp;open(&#39;t.dot&#39;,&nbsp;&#39;w&#39;)&nbsp;as&nbsp;file_:&lt;br&gt;X       &nbsp;deferreddump.dump(file_)&lt;br&gt;X&lt;br&gt;<br>
X   &nbsp;first_deferred.unpause()&lt;br&gt;X   &nbsp;if&nbsp;add_final_log:&lt;br&gt;X       &nbsp;deferred.addCallbacks(cb4,&nbsp;twisted.python.log.err)&lt;br&gt;X   &nbsp;else:&lt;br&gt;X       &nbsp;deferred.addCallback(cb4)&lt;br&gt;X&lt;br&gt;X   &nbsp;return&nbsp;deferred&lt;br&gt;X&lt;br&gt;def&nbsp;usage(retval):&lt;br&gt;<br>
X   &nbsp;sys.stderr.write(&#39;Usage:&nbsp;%s&nbsp;--add-final-log\n&#39;&nbsp;%&nbsp;sys.argv[0])&lt;br&gt;X   &nbsp;sys.exit(retval)&lt;br&gt;X&lt;br&gt;def&nbsp;main():&lt;br&gt;X   &nbsp;add_final_log&nbsp;=&nbsp;False&lt;br&gt;X   &nbsp;while&nbsp;sys.argv[1:]:&lt;br&gt;X       &nbsp;if&nbsp;sys.argv[1]&nbsp;==&nbsp;&#39;--add-final-log&#39;:&lt;br&gt;<br>
X           &nbsp;add_final_log&nbsp;=&nbsp;True&lt;br&gt;X       &nbsp;elif&nbsp;sys.argv[1]&nbsp;in&nbsp;[&nbsp;&#39;-h&#39;,&nbsp;&#39;--help&#39;&nbsp;]:&lt;br&gt;X           &nbsp;usage(0)&lt;br&gt;X       &nbsp;else:&lt;br&gt;X           &nbsp;sys.stderr.write(&#39;%s:&nbsp;Unrecognized&nbsp;option:&nbsp;%s\n&#39;&nbsp;%&nbsp;(sys.argv[0],&nbsp;sys.argv[1]))&lt;br&gt;<br>
X           &nbsp;usage(1)&lt;br&gt;X       &nbsp;del&nbsp;sys.argv[1]&lt;br&gt;X&lt;br&gt;X   &nbsp;deferred&nbsp;=&nbsp;arbitrary_function(add_final_log)&lt;br&gt;X   &nbsp;with&nbsp;open(&#39;/dev/null&#39;,&nbsp;&#39;w&#39;)&nbsp;as&nbsp;file_:&lt;br&gt;X       &nbsp;file_.write(str(deferred))&lt;br&gt;X&lt;br&gt;X   &nbsp;sys.exit(0)&lt;br&gt;<br>
X&lt;br&gt;main()&lt;br&gt;X&lt;br&gt;SHAR_EOF&lt;br&gt; &nbsp;(set&nbsp;20&nbsp;12&nbsp;07&nbsp;02&nbsp;21&nbsp;46&nbsp;02&nbsp;&#39;wedgedump&#39;&lt;br&gt;  &nbsp;eval&nbsp;&quot;${shar_touch}&quot;)&nbsp;&amp;&amp;&nbsp;\&lt;br&gt; &nbsp;chmod&nbsp;0755&nbsp;&#39;wedgedump&#39;&lt;br&gt;if&nbsp;test&nbsp;$?&nbsp;-ne&nbsp;0&lt;br&gt;then&nbsp;${echo}&nbsp;&quot;restore&nbsp;of&nbsp;wedgedump&nbsp;failed&quot;&lt;br&gt;<br>
fi&lt;br&gt; &nbsp;if&nbsp;${md5check}&lt;br&gt; &nbsp;then&nbsp;(&lt;br&gt;      &nbsp;${MD5SUM}&nbsp;-c&nbsp;&gt;/dev/null&nbsp;2&gt;&amp;1&nbsp;||&nbsp;${echo}&nbsp;&#39;wedgedump&#39;:&nbsp;&#39;MD5&nbsp;check&nbsp;failed&#39;&lt;br&gt;      &nbsp;)&nbsp;&lt;&lt;&nbsp;\SHAR_EOF&lt;br&gt;d526664fcf63762f768303af91a74a5f &nbsp;wedgedump&lt;br&gt;<br>
SHAR_EOF&lt;br&gt; &nbsp;else&lt;br&gt;test&nbsp;`LC_ALL=C&nbsp;wc&nbsp;-c&nbsp;&lt;&nbsp;&#39;wedgedump&#39;`&nbsp;-ne&nbsp;3174&nbsp;&amp;&amp;&nbsp;\&lt;br&gt; &nbsp;${echo}&nbsp;&quot;restoration&nbsp;warning: &nbsp;size&nbsp;of&nbsp;&#39;wedgedump&#39;&nbsp;is&nbsp;not&nbsp;3174&quot;&lt;br&gt; &nbsp;fi&lt;br&gt;fi&lt;br&gt;if&nbsp;rm&nbsp;-fr&nbsp;${lock_dir}&lt;br&gt;then&nbsp;${echo}&nbsp;&quot;x&nbsp;-&nbsp;removed&nbsp;lock&nbsp;directory&nbsp;${lock_dir}.&quot;&lt;br&gt;<br>
else&nbsp;${echo}&nbsp;&quot;x&nbsp;-&nbsp;failed&nbsp;to&nbsp;remove&nbsp;lock&nbsp;directory&nbsp;${lock_dir}.&quot;&lt;br&gt;    &nbsp;exit&nbsp;1&lt;br&gt;fi&lt;br&gt;exit&nbsp;0&lt;br&gt;&lt;br&gt;<br>

</tt>
