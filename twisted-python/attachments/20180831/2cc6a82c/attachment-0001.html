<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Aug&nbsp;29,&nbsp;2018,&nbsp;at&nbsp;4:04&nbsp;AM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&nbsp;class=&quot;&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;Tue,&nbsp;Aug&nbsp;28,&nbsp;2018&nbsp;at&nbsp;5:54&nbsp;AM&nbsp;Richard&nbsp;Shea&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rshea@thecubagroup.com&quot;&nbsp;class=&quot;&quot;&gt;rshea@thecubagroup.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;With&nbsp;Apache&nbsp;the&nbsp;process&nbsp;starts&nbsp;as&nbsp;root,&nbsp;reads&nbsp;the&nbsp;key&nbsp;and&nbsp;then&nbsp;makes&nbsp;the&nbsp;apache&nbsp;process&nbsp;run&nbsp;as&nbsp;a&nbsp;different,&nbsp;less&nbsp;powerful,&nbsp;user&nbsp;&nbsp;but&nbsp;I&nbsp;can't&nbsp;see&nbsp;how&nbsp;you&nbsp;can&nbsp;do&nbsp;the&nbsp;equivalent&nbsp;for&nbsp;twistd&nbsp;?&nbsp;Am&nbsp;I&nbsp;overlooking&nbsp;something&nbsp;?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;twistd&nbsp;has&nbsp;`--uid`&nbsp;and&nbsp;`--gid`&nbsp;options&nbsp;for&nbsp;switching&nbsp;to&nbsp;another&nbsp;user&nbsp;after&nbsp;`privilegedStartService`&nbsp;runs.&nbsp;&nbsp;However,&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;how&nbsp;much&nbsp;help&nbsp;this&nbsp;will&nbsp;be&nbsp;since&nbsp;there&nbsp;is&nbsp;a&nbsp;strong&nbsp;desire&nbsp;to&nbsp;replace&nbsp;twistd&nbsp;with&nbsp;twist&nbsp;and&nbsp;twist&nbsp;does&nbsp;not&nbsp;have&nbsp;these&nbsp;features.&nbsp;&nbsp;Perhaps&nbsp;someone&nbsp;who&nbsp;has&nbsp;been&nbsp;working&nbsp;on&nbsp;twist&nbsp;can&nbsp;explain&nbsp;the&nbsp;preferred&nbsp;workflow&nbsp;using&nbsp;that&nbsp;tool.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;origin&nbsp;of&nbsp;the&nbsp;desire&nbsp;to&nbsp;replace&nbsp;twistd&nbsp;with&nbsp;twist&nbsp;is&nbsp;that&nbsp;twistd&nbsp;represents&nbsp;an&nbsp;older,&nbsp;and&nbsp;worse,&nbsp;generation&nbsp;of&nbsp;UNIX&nbsp;administration&nbsp;practices.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&nbsp;class=&quot;MailOutline&quot;&gt;&lt;li&nbsp;class=&quot;&quot;&gt;twistd&nbsp;assumes&nbsp;privilege&nbsp;separation&nbsp;is&nbsp;accomplished&nbsp;via&nbsp;daemons&nbsp;that&nbsp;start&nbsp;up&nbsp;(and,&nbsp;implicitly,&nbsp;import&nbsp;all&nbsp;their&nbsp;code)&nbsp;as&nbsp;root,&nbsp;and&nbsp;then&nbsp;carefully&nbsp;shed&nbsp;privileges&nbsp;on&nbsp;their&nbsp;own.&nbsp;&nbsp;this&nbsp;assumption&nbsp;was&nbsp;based&nbsp;in&nbsp;large&nbsp;part&nbsp;on&nbsp;the&nbsp;idea&nbsp;that&nbsp;twistd&nbsp;will&nbsp;want&nbsp;to&nbsp;bind&nbsp;privileged&nbsp;ports,&nbsp;and&nbsp;only&nbsp;root&nbsp;can&nbsp;bind&nbsp;privileged&nbsp;ports.&nbsp;&nbsp;twist&nbsp;assumes&nbsp;privilege&nbsp;separation&nbsp;is&nbsp;accomplished&nbsp;by&nbsp;starting&nbsp;your&nbsp;process&nbsp;in&nbsp;a&nbsp;container,&nbsp;or&nbsp;under&nbsp;a&nbsp;process&nbsp;supervision&nbsp;regime&nbsp;(such&nbsp;as&nbsp;systemd)&nbsp;which&nbsp;can&nbsp;hand&nbsp;it&nbsp;a&nbsp;privileged&nbsp;listening&nbsp;port.&lt;/li&gt;&lt;li&nbsp;class=&quot;&quot;&gt;twistd&nbsp;assumes&nbsp;that&nbsp;process&nbsp;supervision&nbsp;is&nbsp;accomplished&nbsp;by&nbsp;an&nbsp;elaborate&nbsp;and&nbsp;frankly&nbsp;never&nbsp;quite&nbsp;fully&nbsp;specified&nbsp;dance&nbsp;involving&nbsp;PID&nbsp;files,&nbsp;self-truncation&nbsp;of&nbsp;logs,&nbsp;signal&nbsp;handling,&nbsp;and&nbsp;thus,&nbsp;writes&nbsp;pidfiles&nbsp;and&nbsp;daemonizes&nbsp;by&nbsp;default.&nbsp;&nbsp;twist&nbsp;assumes&nbsp;that&nbsp;process&nbsp;supervision&nbsp;is&nbsp;accomplished&nbsp;by&nbsp;using&nbsp;a&nbsp;process&nbsp;supervisor;&nbsp;either&nbsp;a&nbsp;container&nbsp;runtime,&nbsp;or&nbsp;systemd,&nbsp;or&nbsp;something&nbsp;like&nbsp;supervisord&nbsp;or&nbsp;ncolony.&lt;/li&gt;&lt;/ol&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;However,&nbsp;use&nbsp;of&nbsp;`twist`&nbsp;is&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;gently&nbsp;encouraged&lt;/i&gt;,&nbsp;not&nbsp;mandated,&nbsp;as&nbsp;there&nbsp;are&nbsp;lots&nbsp;of&nbsp;old/bad&nbsp;systems&nbsp;where&nbsp;new&nbsp;versions&nbsp;of&nbsp;Twisted&nbsp;run,&nbsp;and&nbsp;will&nbsp;continue&nbsp;to&nbsp;run&nbsp;for&nbsp;some&nbsp;time.&nbsp;&nbsp;If&nbsp;your&nbsp;deployment&nbsp;constraints&nbsp;are&nbsp;better&nbsp;satisfied&nbsp;by&nbsp;twistd,&nbsp;by&nbsp;all&nbsp;means&nbsp;continue&nbsp;using&nbsp;it,&nbsp;report&nbsp;bugs&nbsp;in&nbsp;it,&nbsp;file&nbsp;PRs&nbsp;that&nbsp;fix&nbsp;those&nbsp;bugs.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;However,&nbsp;there&nbsp;are&nbsp;a&nbsp;long&nbsp;list&nbsp;of&nbsp;reasons&nbsp;why&nbsp;this&nbsp;new&nbsp;idiom&nbsp;is&nbsp;a&nbsp;lot&nbsp;better&nbsp;than&nbsp;the&nbsp;older&nbsp;one.&nbsp;&nbsp;One&nbsp;specific&nbsp;problem&nbsp;with&nbsp;read-certs-then-shed-privileges&nbsp;is&nbsp;that&nbsp;it&nbsp;means&nbsp;your&nbsp;process&nbsp;can&nbsp;never&nbsp;receive&nbsp;a&nbsp;new&nbsp;certificate&nbsp;without&nbsp;restarting;&nbsp;so&nbsp;no&nbsp;certificate&nbsp;rotation,&nbsp;no&nbsp;adding&nbsp;new&nbsp;subdomains&nbsp;on&nbsp;the&nbsp;fly.&nbsp;&nbsp;If&nbsp;your&nbsp;process&nbsp;has&nbsp;permissions&nbsp;to&nbsp;read&nbsp;and&nbsp;act&nbsp;on&nbsp;the&nbsp;certificate&nbsp;in&nbsp;memory,&nbsp;what&nbsp;benefit&nbsp;is&nbsp;there&nbsp;to&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;can't&nbsp;read&nbsp;it&nbsp;out&nbsp;of&nbsp;the&nbsp;filesystem&nbsp;a&nbsp;second&nbsp;time?&nbsp;&nbsp;If&nbsp;it's&nbsp;bound&nbsp;to&nbsp;a&nbsp;privileged&nbsp;port,&nbsp;a&nbsp;compromised&nbsp;node&nbsp;could&nbsp;provision&nbsp;its&nbsp;own&nbsp;certificate&nbsp;via&nbsp;Let's&nbsp;Encrypt&nbsp;anyway.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;So&nbsp;my&nbsp;suggestion&nbsp;would&nbsp;be&nbsp;to&nbsp;just&nbsp;provide&nbsp;the&nbsp;process&nbsp;long-lived&nbsp;read&nbsp;access&nbsp;to&nbsp;the&nbsp;certificates,&nbsp;via&nbsp;whatever&nbsp;access&nbsp;control&nbsp;mechanisms&nbsp;are&nbsp;available&nbsp;to&nbsp;you.&nbsp;&nbsp;If&nbsp;all&nbsp;you've&nbsp;got&nbsp;are&nbsp;filesystem&nbsp;permissions,&nbsp;u+rw&nbsp;g+r&nbsp;should&nbsp;do&nbsp;the&nbsp;trick,&nbsp;and&nbsp;then&nbsp;just&nbsp;put&nbsp;the&nbsp;user&nbsp;running&nbsp;`twistd`&nbsp;into&nbsp;the&nbsp;appropriate&nbsp;group.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-g&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
