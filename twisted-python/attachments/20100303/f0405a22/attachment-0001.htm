<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Mar&nbsp;3,&nbsp;2010&nbsp;at&nbsp;1:56&nbsp;PM,&nbsp;Werner&nbsp;Thie&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:wthie@thiengineering.ch&quot;&gt;wthie@thiengineering.ch&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
Hi&lt;br&gt;<br>
&lt;br&gt;<br>
Starting&nbsp;twistd&nbsp;xmpp-router&nbsp;and&nbsp;trying&nbsp;to&nbsp;connect&nbsp;to&nbsp;it&nbsp;with&nbsp;a&nbsp;component&lt;br&gt;<br>
from&nbsp;the&nbsp;wokkel&nbsp;examples&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;<br>
An&nbsp;XMPP&nbsp;Ping&nbsp;server&nbsp;as&nbsp;an&nbsp;external&nbsp;server-side&nbsp;component.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;ping&nbsp;server&nbsp;assumes&nbsp;the&nbsp;domain&nbsp;C{&amp;#39;ping&amp;#39;}.&lt;br&gt;<br>
&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;<br>
import&nbsp;sys&lt;br&gt;<br>
&lt;br&gt;<br>
from&nbsp;twisted.python&nbsp;import&nbsp;log&lt;br&gt;<br>
from&nbsp;twisted.application&nbsp;import&nbsp;app,&nbsp;service,&nbsp;internet&lt;br&gt;<br>
from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;<br>
&lt;br&gt;<br>
from&nbsp;wokkel&nbsp;import&nbsp;component&lt;br&gt;<br>
from&nbsp;wokkel.ping&nbsp;import&nbsp;PingHandler&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Configuration&nbsp;parameters&lt;br&gt;<br>
EXT_HOST&nbsp;=&nbsp;&amp;#39;localhost&amp;#39;&lt;br&gt;<br>
EXT_PORT&nbsp;=&nbsp;5347&lt;br&gt;<br>
SECRET&nbsp;=&nbsp;&amp;#39;secret&amp;#39;&lt;br&gt;<br>
DOMAIN&nbsp;=&nbsp;&amp;#39;ping&amp;#39;&lt;br&gt;<br>
LOG_TRAFFIC&nbsp;=&nbsp;True&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Set&nbsp;up&nbsp;the&nbsp;Twisted&nbsp;application&lt;br&gt;<br>
application&nbsp;=&nbsp;service.Application(&amp;quot;Ping&nbsp;Component&amp;quot;)&lt;br&gt;<br>
&lt;br&gt;<br>
router&nbsp;=&nbsp;component.Router()&lt;br&gt;<br>
pingComponent&nbsp;=&nbsp;component.Component(EXT_HOST,&nbsp;EXT_PORT,&nbsp;DOMAIN,&nbsp;SECRET)&lt;br&gt;<br>
pingComponent.logTraffic&nbsp;=&nbsp;LOG_TRAFFIC&lt;br&gt;<br>
pingComponent.setServiceParent(application)&lt;br&gt;<br>
&lt;br&gt;<br>
pingHandler&nbsp;=&nbsp;PingHandler()&lt;br&gt;<br>
pingHandler.setHandlerParent(pingComponent)&lt;br&gt;<br>
&lt;br&gt;<br>
produces&nbsp;the&nbsp;following&nbsp;traceback:&lt;br&gt;<br>
&lt;br&gt;<br>
2010-03-03&nbsp;19:24:28+0100&nbsp;[XmlStream,0,127.0.0.1]&nbsp;Unhandled&nbsp;Error&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&lt;br&gt;<br>
&amp;quot;\proj\Python-2.5.2\stackless-2.5.2-r63812\Modules\pyexpat.c&amp;quot;,&nbsp;line&nbsp;656,&lt;br&gt;<br>
in&nbsp;EndElement&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(&amp;quot;(N)&amp;quot;,&nbsp;string_intern(self,&nbsp;name)))&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&nbsp;&amp;quot;C:\proj\twisted\twisted\words\xish\domish.py&amp;quot;,&nbsp;line&lt;br&gt;<br>
797,&nbsp;in&nbsp;_onEndElement&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.ElementEvent(self.currElem)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&nbsp;&amp;quot;C:\proj\twisted\twisted\words\xish\xmlstream.py&amp;quot;,&nbsp;line&lt;br&gt;<br>
107,&nbsp;in&nbsp;onElement&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.dispatch(element)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&nbsp;&amp;quot;C:\proj\twisted\twisted\words\xish\utility.py&amp;quot;,&nbsp;line&lt;br&gt;<br>
317,&nbsp;in&nbsp;dispatch&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;callbacklist.callback(obj)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---&nbsp;&amp;lt;exception&nbsp;caught&nbsp;here&amp;gt;&nbsp;---&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&nbsp;&amp;quot;C:\proj\twisted\twisted\words\xish\utility.py&amp;quot;,&nbsp;line&lt;br&gt;<br>
107,&nbsp;in&nbsp;callback&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;methodwrapper(*args,&nbsp;**kwargs)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&nbsp;&amp;quot;C:\proj\twisted\twisted\words\xish\utility.py&amp;quot;,&nbsp;line&lt;br&gt;<br>
27,&nbsp;in&nbsp;__call__&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.method(*nargs,&nbsp;**nkwargs)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&lt;br&gt;<br>
&amp;quot;C:\proj\twisted\twisted\words\protocols\jabber\component.py&amp;quot;,&nbsp;line&nbsp;171,&lt;br&gt;<br>
in&nbsp;onElement&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.onHandshake(unicode(element))&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&lt;br&gt;<br>
&amp;quot;C:\proj\twisted\twisted\words\protocols\jabber\component.py&amp;quot;,&nbsp;line&nbsp;187,&lt;br&gt;<br>
in&nbsp;onHandshake&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unicode(self.secret))&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File&lt;br&gt;<br>
&amp;quot;C:\proj\twisted\twisted\words\protocols\jabber\xmlstream.py&amp;quot;,&nbsp;line&nbsp;52,&lt;br&gt;<br>
in&nbsp;hashPassword&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;raise&nbsp;TypeError(&amp;quot;The&nbsp;session&nbsp;identifier&nbsp;must&nbsp;be&nbsp;a&nbsp;unicode&lt;br&gt;<br>
object&amp;quot;)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exceptions.TypeError:&nbsp;The&nbsp;session&nbsp;identifier&nbsp;must&nbsp;be&nbsp;a&nbsp;unicode&lt;br&gt;<br>
object&lt;br&gt;<br>
&lt;br&gt;<br>
After&nbsp;some&nbsp;fiddling&nbsp;around&nbsp;it&nbsp;seems&nbsp;that&nbsp;the&nbsp;code&nbsp;at&nbsp;line&nbsp;282&nbsp;in&lt;br&gt;<br>
twisted\words\protocols\jabber\xmlstream.py&nbsp;presets&nbsp;the&nbsp;sid&nbsp;of&nbsp;the&lt;br&gt;<br>
stream&nbsp;to&nbsp;a&nbsp;str&nbsp;instead&nbsp;of&nbsp;a&nbsp;unicode(str).&nbsp;After&nbsp;changing&nbsp;line&nbsp;282&lt;br&gt;<br>
from&lt;br&gt;<br>
&lt;br&gt;<br>
self.xmlstream.sid&nbsp;=&nbsp;randbytes.secureRandom(8).encode(&amp;#39;hex&amp;#39;)&lt;br&gt;<br>
&lt;br&gt;<br>
to&lt;br&gt;<br>
&lt;br&gt;<br>
self.xmlstream.sid&nbsp;=&nbsp;unicode(randbytes.secureRandom(8).encode(&amp;#39;hex&amp;#39;))&lt;br&gt;<br>
&lt;br&gt;<br>
everything&nbsp;works&nbsp;as&nbsp;advertised.&lt;br&gt;<br>
&lt;br&gt;<br>
Is&nbsp;there&nbsp;somebody&nbsp;around&nbsp;who&nbsp;could&nbsp;tell&nbsp;me&nbsp;what&nbsp;to&nbsp;do&nbsp;with&nbsp;this&nbsp;fix,&nbsp;I&amp;#39;m&lt;br&gt;<br>
certainly&nbsp;a&nbsp;beginner&nbsp;diddling&nbsp;with&nbsp;XMPP.&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;a&nbsp;bunch,&nbsp;Werner&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;Hello&nbsp;Werner,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;do&nbsp;not&nbsp;know&nbsp;anything&nbsp;about&nbsp;twisted.words,&nbsp;but&nbsp;you&nbsp;should&nbsp;file&nbsp;a&nbsp;bug&nbsp;report&nbsp;in&nbsp;trac: &lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/trac/report&quot;&gt;http://twistedmatrix.com/trac/report&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;Just&nbsp;out&nbsp;of&nbsp;curiosity,&nbsp;I&nbsp;did&nbsp;look&nbsp;at&nbsp;xmlstream&nbsp;and&nbsp;the&nbsp;whole&nbsp;unicode&nbsp;type&nbsp;checking&nbsp;seems&nbsp;unnecessary&nbsp;considering&nbsp;how&nbsp;the&nbsp;values&nbsp;are&nbsp;used:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;input&nbsp;=&nbsp;u&amp;quot;%s%s&amp;quot;&nbsp;%&nbsp;(sid,&nbsp;password)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Why&nbsp;sid&nbsp;and&nbsp;password&nbsp;have&nbsp;to&nbsp;be&nbsp;unicode&nbsp;objects&nbsp;and&nbsp;not&nbsp;just&nbsp;basestring&nbsp;beats&nbsp;me.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Drew&lt;/div&gt;<br>

</tt>
