<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;Thanks!&nbsp;I&nbsp;put&nbsp;some&nbsp;review&nbsp;comments&nbsp;on&nbsp;it.&nbsp;&nbsp;I&nbsp;would&nbsp;encourage&nbsp;others&nbsp;with&nbsp;interest&nbsp;in&nbsp;this&nbsp;area&nbsp;to&nbsp;have&nbsp;a&nbsp;look;&nbsp;I&nbsp;might&nbsp;not&nbsp;get&nbsp;back&nbsp;to&nbsp;this&nbsp;for&nbsp;a&nbsp;couple&nbsp;of&nbsp;weeks,&nbsp;but&nbsp;I'd&nbsp;be&nbsp;happy&nbsp;to&nbsp;give&nbsp;people&nbsp;collaborator&nbsp;permissions&nbsp;on&nbsp;the&nbsp;repo&nbsp;if&nbsp;they'd&nbsp;like&nbsp;to&nbsp;help&nbsp;out.&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;(Frankly&nbsp;it's&nbsp;probably&nbsp;time&nbsp;that&nbsp;this&nbsp;project&nbsp;grew&nbsp;up&nbsp;and&nbsp;moved&nbsp;over&nbsp;to&nbsp;the&nbsp;Twisted&nbsp;org&nbsp;anyway,&nbsp;given&nbsp;that&nbsp;txacme&nbsp;depends&nbsp;on&nbsp;it...)&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-g&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Mar&nbsp;24,&nbsp;2019,&nbsp;at&nbsp;1:59&nbsp;PM,&nbsp;Daniel&nbsp;Holth&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dholth@gmail.com&quot;&nbsp;class=&quot;&quot;&gt;dholth@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;Pull&nbsp;request&nbsp;for&nbsp;txsni&nbsp;acme&nbsp;&lt;a&nbsp;href=&quot;https://github.com/glyph/txsni/pull/28&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/glyph/txsni/pull/28&lt;/a&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sun,&nbsp;Mar&nbsp;24,&nbsp;2019,&nbsp;16:33&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;class=&quot;&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word;line-break:after-white-space&quot;&nbsp;class=&quot;&quot;&gt;Any&nbsp;chance&nbsp;you&nbsp;could&nbsp;include&nbsp;a&nbsp;link&nbsp;to&nbsp;the&nbsp;relevant&nbsp;PR?&nbsp;&nbsp;Pulling&nbsp;this&nbsp;out&nbsp;of&nbsp;the&nbsp;raging&nbsp;tire-fire&nbsp;of&nbsp;my&nbsp;Github&nbsp;notifications&nbsp;would&nbsp;take&nbsp;an&nbsp;unfortunately&nbsp;non-trivial&nbsp;amount&nbsp;of&nbsp;time&nbsp;-&nbsp;and&nbsp;I&nbsp;imagine&nbsp;that&nbsp;not&nbsp;everyone&nbsp;subscribed&nbsp;might&nbsp;even&nbsp;be&nbsp;on&nbsp;the&nbsp;appropriate&nbsp;repos&nbsp;:).&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-g&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Mar&nbsp;24,&nbsp;2019,&nbsp;at&nbsp;9:26&nbsp;AM,&nbsp;Daniel&nbsp;Holth&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dholth@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;class=&quot;&quot;&gt;dholth@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;m_-7105518591241820052Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;The&nbsp;cleaned&nbsp;up&nbsp;pull&nbsp;request&nbsp;should&nbsp;be&nbsp;really&nbsp;easy&nbsp;to&nbsp;try,&nbsp;with&nbsp;a&nbsp;dehydrated:(basedir)&nbsp;string&nbsp;port.&nbsp;Go&nbsp;get&nbsp;some&nbsp;certs&nbsp;people!&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sun,&nbsp;Mar&nbsp;24,&nbsp;2019,&nbsp;00:55&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;class=&quot;&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word;line-break:after-white-space&quot;&nbsp;class=&quot;&quot;&gt;I&nbsp;think&nbsp;ACME_TLS_1&nbsp;is&nbsp;a&nbsp;sufficiently&nbsp;high-entropy&nbsp;string&nbsp;that&nbsp;the&nbsp;likelihood&nbsp;of&nbsp;brokenness&nbsp;from&nbsp;this&nbsp;approach&nbsp;is&nbsp;basically&nbsp;zero.&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-g&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Mar&nbsp;23,&nbsp;2019,&nbsp;at&nbsp;9:20&nbsp;PM,&nbsp;Daniel&nbsp;Holth&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dholth@gmail.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;dholth@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;m_-7105518591241820052m_3040031638727218729Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;All&nbsp;we&nbsp;have&nbsp;to&nbsp;do&nbsp;is&nbsp;have&nbsp;some&nbsp;kind&nbsp;of&nbsp;per&nbsp;connection&nbsp;certificate&nbsp;store&nbsp;or&nbsp;flag.&nbsp;If&nbsp;acme&nbsp;is&nbsp;in&nbsp;the&nbsp;first&nbsp;packet&nbsp;and&nbsp;the&nbsp;special&nbsp;certificate&nbsp;exists,&nbsp;send&nbsp;it.&nbsp;Otherwise&nbsp;send&nbsp;the&nbsp;normal&nbsp;certificate,&nbsp;for&nbsp;a&nbsp;very&nbsp;short&nbsp;window&nbsp;of&nbsp;possible&nbsp;brokenness.&nbsp;Letsencrypt&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;require&nbsp;correct&nbsp;alpn&nbsp;negotiation.&nbsp;Should&nbsp;be&nbsp;simple.&nbsp;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;I'm&nbsp;happy&nbsp;running&nbsp;the&nbsp;acme&nbsp;client&nbsp;separately&nbsp;and&nbsp;listing&nbsp;my&nbsp;domain&nbsp;instead&nbsp;of&nbsp;doing&nbsp;it&nbsp;all&nbsp;on&nbsp;demand&nbsp;inside&nbsp;twisted.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sat,&nbsp;Mar&nbsp;23,&nbsp;2019,&nbsp;23:59&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;On&nbsp;Mar&nbsp;23,&nbsp;2019,&nbsp;at&nbsp;4:06&nbsp;PM,&nbsp;Daniel&nbsp;Holth&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dholth@gmail.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;dholth@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;HOLY&nbsp;REGEX&nbsp;BATMAN&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;class&nbsp;_ConnectionProxy(object):&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;bio_write(self,&nbsp;buf):&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;ACME_TLS_1&nbsp;in&nbsp;buf:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.acme_tls_1&nbsp;=&nbsp;True&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.bio_write&nbsp;=&nbsp;self._obj.bio_write&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._obj.bio_write(buf)&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;Now&nbsp;we&nbsp;can&nbsp;choose&nbsp;the&nbsp;acme&nbsp;certificate&nbsp;store&nbsp;in&nbsp;the&nbsp;sni&nbsp;callback&nbsp;and&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;make&nbsp;letsencrypt&nbsp;happy!&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1.&nbsp;Gross&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2.&nbsp;Hooray!&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
-g&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>
_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;class=&quot;&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;class=&quot;&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;class=&quot;&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
