<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;div&gt;All&nbsp;we&nbsp;have&nbsp;to&nbsp;do&nbsp;is&nbsp;have&nbsp;some&nbsp;kind&nbsp;of&nbsp;per&nbsp;connection&nbsp;certificate&nbsp;store&nbsp;or&nbsp;flag.&nbsp;If&nbsp;acme&nbsp;is&nbsp;in&nbsp;the&nbsp;first&nbsp;packet&nbsp;and&nbsp;the&nbsp;special&nbsp;certificate&nbsp;exists,&nbsp;send&nbsp;it.&nbsp;Otherwise&nbsp;send&nbsp;the&nbsp;normal&nbsp;certificate,&nbsp;for&nbsp;a&nbsp;very&nbsp;short&nbsp;window&nbsp;of&nbsp;possible&nbsp;brokenness.&nbsp;Letsencrypt&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;require&nbsp;correct&nbsp;alpn&nbsp;negotiation.&nbsp;Should&nbsp;be&nbsp;simple. &lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;I&#39;m&nbsp;happy&nbsp;running&nbsp;the&nbsp;acme&nbsp;client&nbsp;separately&nbsp;and&nbsp;listing&nbsp;my&nbsp;domain&nbsp;instead&nbsp;of&nbsp;doing&nbsp;it&nbsp;all&nbsp;on&nbsp;demand&nbsp;inside&nbsp;twisted.&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sat,&nbsp;Mar&nbsp;23,&nbsp;2019,&nbsp;23:59&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Mar&nbsp;23,&nbsp;2019,&nbsp;at&nbsp;4:06&nbsp;PM,&nbsp;Daniel&nbsp;Holth&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dholth@gmail.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;dholth@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HOLY&nbsp;REGEX&nbsp;BATMAN&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;class&nbsp;_ConnectionProxy(object):&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp;def&nbsp;bio_write(self,&nbsp;buf):&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;ACME_TLS_1&nbsp;in&nbsp;buf:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.acme_tls_1&nbsp;=&nbsp;True&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.bio_write&nbsp;=&nbsp;self._obj.bio_write&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;self._obj.bio_write(buf)&lt;br&gt;<br>
&gt;&nbsp;Now&nbsp;we&nbsp;can&nbsp;choose&nbsp;the&nbsp;acme&nbsp;certificate&nbsp;store&nbsp;in&nbsp;the&nbsp;sni&nbsp;callback&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;make&nbsp;letsencrypt&nbsp;happy!&lt;br&gt;<br>
&lt;br&gt;<br>
1.&nbsp;Gross&lt;br&gt;<br>
2.&nbsp;Hooray!&lt;br&gt;<br>
&lt;br&gt;<br>
-g&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
