Index: guard.py
===================================================================
RCS file: /cvs/Twisted/twisted/web/woven/guard.py,v
retrieving revision 1.7
diff -u -r1.7 guard.py
--- guard.py	10 Jan 2003 09:23:39 -0000	1.7
+++ guard.py	10 Apr 2003 15:01:14 -0000
@@ -100,7 +100,7 @@
     def checkExpired(self):
         # If I haven't been touched in 15 minutes:
         if time.time() - self.lastModified > self.lifetime / 2:
-            if self.site.sessions.has_key(self.uid):
+            if self.guard.sessions.has_key(self.uid):
                 self.expire()
             else:
                 log.msg("no session to expire: %s" % self.uid)
@@ -232,10 +232,20 @@
                 idfr.addErrback(loginFailure)
                 return idfr
                 
-            return form.FormProcessor(loginSignature.method(loginMethod))
+            if request.args:
+                return self.getFormProcessorForLogin(request, loginMethod)
+            else:
+                return self.getResourceForLogin(request, loginMethod)
         else:
             sc = s.clientForService(self.service)
             if sc:
                 return sc.getChildWithDefault(path, request)
             return self.noAuthResource.getChildWithDefault(path, request)
 
+    def getResourceForLogin(self, request, loginMethod):
+        """override this to provide a different resource for a login form"""
+        return form.FormProcessor(loginSignature.method(loginMethod))
+    
+    def getFormProcessorForLogin(self, request, loginMethod):
+        """override this to provide a different form processor"""
+        return form.FormProcessor(loginSignature.method(loginMethod))
