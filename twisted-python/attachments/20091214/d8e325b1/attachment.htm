<tt>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;Arial,&nbsp;sans-serif&quot;&gt;&lt;div&gt;How&nbsp;does&nbsp;the&nbsp;below&nbsp;example<br>
look&nbsp;as&nbsp;a&nbsp;complete&nbsp;producer/consumer&nbsp;example? &nbsp;If&nbsp;it&amp;#39;s&nbsp;well&nbsp;received,&nbsp;perhaps&nbsp;we&nbsp;can&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;online<br>
documentation&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/documents/current/core/howto/producers.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/documents/current/core/howto/producers.html&lt;/a&gt;&nbsp;in&nbsp;the&nbsp;&amp;quot;&lt;span&gt;&lt;/span&gt;&lt;a&nbsp;name=&quot;auto11&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;&lt;a&nbsp;name=&quot;auto11&quot;&gt;Further&nbsp;Reading&amp;quot;&nbsp;section&lt;/a&gt;? &nbsp;I&nbsp;always&nbsp;felt&nbsp;that&nbsp;the&nbsp;producer/consumer&nbsp;(a.k.a.&nbsp;high<br>
volume&nbsp;streaming)&nbsp;docs&nbsp;lacked&nbsp;a&nbsp;real&nbsp;example&nbsp;that&nbsp;users&nbsp;could&nbsp;download<br>
and&nbsp;run.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;#!/sw/external/python-2.6.1/bin/python&lt;/div&gt;<br>
&lt;div&gt;&amp;quot;&amp;quot;&amp;quot;Serve&nbsp;as&nbsp;a&nbsp;sample&nbsp;implementation&nbsp;of&nbsp;a&nbsp;twisted&nbsp;producer/consumer&lt;/div&gt;<br>
&lt;div&gt;system,&nbsp;with&nbsp;a&nbsp;simple&nbsp;TCP&nbsp;server&nbsp;which&nbsp;asks&nbsp;the&nbsp;user&nbsp;how&nbsp;many&nbsp;random&lt;/div&gt;<br>
&lt;div&gt;integers&nbsp;they&nbsp;want,&nbsp;and&nbsp;it&nbsp;sends&nbsp;the&nbsp;result&nbsp;set&nbsp;back&nbsp;to&nbsp;the&nbsp;user,&nbsp;one&lt;/div&gt;<br>
&lt;div&gt;result&nbsp;per&nbsp;line.&amp;quot;&amp;quot;&amp;quot;&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;import&nbsp;random&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;from&nbsp;zope.interface&nbsp;import&nbsp;implements&lt;/div&gt;<br>
&lt;div&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;interfaces,&nbsp;reactor&lt;/div&gt;<br>
&lt;div&gt;from&nbsp;twisted.internet.protocol&nbsp;import&nbsp;Factory&lt;/div&gt;<br>
&lt;div&gt;from&nbsp;twisted.protocols.basic&nbsp;import&nbsp;LineReceiver&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;class&nbsp;Producer:&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;&amp;quot;&amp;quot;&amp;quot;Send&nbsp;back&nbsp;the&nbsp;requested&nbsp;number&nbsp;of&nbsp;random&nbsp;integers&nbsp;to&nbsp;the&nbsp;client.&amp;quot;&amp;quot;&amp;quot;&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;implements(interfaces.IPushProducer)&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;def&nbsp;__init__(self,&nbsp;proto,&nbsp;cnt):&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;self._proto&nbsp;=&nbsp;proto&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;self._goal&nbsp;=&nbsp;cnt&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;self._produced&nbsp;=&nbsp;0&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;self._paused&nbsp;=&nbsp;False&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;def&nbsp;pauseProducing(self):&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;&amp;quot;&amp;quot;&amp;quot;When&nbsp;we&amp;#39;ve&nbsp;produced&nbsp;data&nbsp;too&nbsp;fast,&nbsp;pauseProducing()&nbsp;will&nbsp;be&lt;/div&gt;<br>
&lt;div&gt;called&nbsp;(reentrantly&nbsp;from&nbsp;within&nbsp;resumeProducing&amp;#39;s&nbsp;transport.write&lt;/div&gt;<br>
&lt;div&gt;method,&nbsp;most&nbsp;likely),&nbsp;so&nbsp;set&nbsp;a&nbsp;flag&nbsp;that&nbsp;causes&nbsp;production&nbsp;to&nbsp;pause&lt;/div&gt;<br>
&lt;div&gt;temporarily.&amp;quot;&amp;quot;&amp;quot;&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;self._paused&nbsp;=&nbsp;True&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;print(&amp;#39;pausing&nbsp;connection&nbsp;from&nbsp;%s&amp;#39;&nbsp;%&nbsp;(self._proto.transport.getPeer()))&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;def&nbsp;resumeProducing(self):&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;self._paused&nbsp;=&nbsp;False&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;while&nbsp;not&nbsp;self._paused&nbsp;and&nbsp;self._produced&nbsp;&amp;lt;&nbsp;self._goal:&lt;/div&gt;<br>
&lt;div&gt;           &nbsp;next_int&nbsp;=&nbsp;random.randint(0,&nbsp;10000)&lt;/div&gt;<br>
&lt;div&gt;           &nbsp;self._proto.transport.write(&amp;#39;%d\r\n&amp;#39;&nbsp;%&nbsp;(next_int))&lt;/div&gt;<br>
&lt;div&gt;           &nbsp;self._produced&nbsp;+=&nbsp;1&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;if&nbsp;self._produced&nbsp;==&nbsp;self._goal:&lt;/div&gt;<br>
&lt;div&gt;           &nbsp;self._proto.transport.unregisterProducer()&lt;/div&gt;<br>
&lt;div&gt;           &nbsp;self._proto.transport.loseConnection()&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;def&nbsp;stopProducing(self):&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;pass&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;class&nbsp;ServeRandom(LineReceiver):&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;&amp;quot;&amp;quot;&amp;quot;Serve&nbsp;up&nbsp;random&nbsp;data.&amp;quot;&amp;quot;&amp;quot;&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;def&nbsp;connectionMade(self):&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;print(&amp;#39;connection&nbsp;made&nbsp;from&nbsp;%s&amp;#39;&nbsp;%&nbsp;(self.transport.getPeer()))&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;self.transport.write(&amp;#39;how&nbsp;many&nbsp;random&nbsp;integers&nbsp;do&nbsp;you&nbsp;want?\r\n&amp;#39;)&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;def&nbsp;lineReceived(self,&nbsp;line):&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;cnt&nbsp;=&nbsp;int(line.strip())&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;producer&nbsp;=&nbsp;Producer(self,&nbsp;cnt)&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;self.transport.registerProducer(producer,&nbsp;True)&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;producer.resumeProducing()&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;def&nbsp;connectionLost(self,&nbsp;reason):&lt;/div&gt;<br>
&lt;div&gt;       &nbsp;print(&amp;#39;connection&nbsp;lost&nbsp;from&nbsp;%s&amp;#39;&nbsp;%&nbsp;(self.transport.getPeer()))&lt;/div&gt;<br>
&lt;div&gt;factory&nbsp;=&nbsp;Factory()&lt;/div&gt;<br>
&lt;div&gt;factory.protocol&nbsp;=&nbsp;ServeRandom&lt;/div&gt;<br>
&lt;div&gt;reactor.listenTCP(1234,&nbsp;factory)&lt;/div&gt;<br>
&lt;div&gt;print(&amp;#39;listening&nbsp;on&nbsp;1234...&amp;#39;)&lt;/div&gt;<br>
&lt;div&gt;reactor.run()&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;Use&nbsp;on&nbsp;the&nbsp;client:&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;$&nbsp;telnet&nbsp;localhost&nbsp;1234&lt;/div&gt;<br>
&lt;div&gt;Trying&nbsp;127.0.0.1...&lt;/div&gt;<br>
&lt;div&gt;Connected&nbsp;to&nbsp;localhost.&lt;/div&gt;<br>
&lt;div&gt;Escape&nbsp;character&nbsp;is&nbsp;&amp;#39;^]&amp;#39;.&lt;/div&gt;<br>
&lt;div&gt;how&nbsp;many&nbsp;random&nbsp;integers&nbsp;do&nbsp;you&nbsp;want?&lt;/div&gt;<br>
&lt;div&gt;5&lt;/div&gt;<br>
&lt;div&gt;431&lt;/div&gt;<br>
&lt;div&gt;7201&lt;/div&gt;<br>
&lt;div&gt;3289&lt;/div&gt;<br>
&lt;div&gt;9604&lt;/div&gt;<br>
&lt;div&gt;6659&lt;/div&gt;<br>
&lt;div&gt;Connection&nbsp;closed&nbsp;by&nbsp;foreign&nbsp;host.&lt;/div&gt;<br>
&lt;div&gt;$&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;Use&nbsp;on&nbsp;the&nbsp;server&nbsp;(observe&nbsp;how&nbsp;the&nbsp;server&nbsp;pauses&nbsp;production<br>
sometimes&nbsp;-&nbsp;this&nbsp;happens&nbsp;when&nbsp;a&nbsp;large&nbsp;data&nbsp;set&nbsp;is&nbsp;requested&nbsp;by&nbsp;the<br>
client):&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;$&nbsp;./streaming.py&nbsp;&lt;/div&gt;<br>
&lt;div&gt;listening&nbsp;on&nbsp;1234...&lt;/div&gt;<br>
&lt;div&gt;connection&nbsp;made&nbsp;from&nbsp;IPv4Address(TCP,&nbsp;&amp;#39;127.0.0.1&amp;#39;,&nbsp;54859)&lt;/div&gt;<br>
&lt;div&gt;connection&nbsp;lost&nbsp;from&nbsp;IPv4Address(TCP,&nbsp;&amp;#39;127.0.0.1&amp;#39;,&nbsp;54859)&lt;/div&gt;<br>
&lt;div&gt;connection&nbsp;made&nbsp;from&nbsp;IPv4Address(TCP,&nbsp;&amp;#39;127.0.0.1&amp;#39;,&nbsp;54864)&lt;/div&gt;<br>
&lt;div&gt;pausing&nbsp;connection&nbsp;from&nbsp;IPv4Address(TCP,&nbsp;&amp;#39;127.0.0.1&amp;#39;,&nbsp;54864)&lt;/div&gt;<br>
&lt;div&gt;pausing&nbsp;connection&nbsp;from&nbsp;IPv4Address(TCP,&nbsp;&amp;#39;127.0.0.1&amp;#39;,&nbsp;54864)&lt;/div&gt;<br>
&lt;div&gt;pausing&nbsp;connection&nbsp;from&nbsp;IPv4Address(TCP,&nbsp;&amp;#39;127.0.0.1&amp;#39;,&nbsp;54864)&lt;/div&gt;<br>
&lt;div&gt;pausing&nbsp;connection&nbsp;from&nbsp;IPv4Address(TCP,&nbsp;&amp;#39;127.0.0.1&amp;#39;,&nbsp;54864)&lt;/div&gt;<br>
&lt;div&gt;connection&nbsp;lost&nbsp;from&nbsp;IPv4Address(TCP,&nbsp;&amp;#39;127.0.0.1&amp;#39;,&nbsp;54864)&lt;/div&gt;&lt;/font&gt;[...]&lt;br&gt;&lt;br&gt;Thanks.&lt;br&gt;--&nbsp;&lt;br&gt;Benjamin&nbsp;Rutt&lt;br&gt;<br>

</tt>
