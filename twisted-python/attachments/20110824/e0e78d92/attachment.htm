<tt>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;TITLE&gt;Twisted&nbsp;vs&nbsp;jQuery&nbsp;Deferreds&nbsp;(was&nbsp;Re:&nbsp;[Twisted-Python]&nbsp;RPC&nbsp;design&nbsp;questions)&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;I&nbsp;follow&nbsp;Glyphs&nbsp;advice&nbsp;and&nbsp;only&nbsp;keep&nbsp;the&nbsp;lambda&nbsp;version&nbsp;with&nbsp;standard&nbsp;Twisted&nbsp;Deferred.&lt;BR&gt;<br>
&lt;BR&gt;<br>
However,&nbsp;I've&nbsp;got&nbsp;a&nbsp;(I&nbsp;believe)&nbsp;more&nbsp;serious&nbsp;&amp;quot;design&amp;quot;&nbsp;problem.&lt;BR&gt;<br>
&lt;BR&gt;<br>
The&nbsp;RPC&nbsp;stuff&nbsp;works&nbsp;in&nbsp;Twisted,&nbsp;but&nbsp;also&nbsp;from&nbsp;JavaScript.&lt;BR&gt;<br>
&lt;BR&gt;<br>
So&nbsp;I&nbsp;have&nbsp;2&nbsp;audiences&nbsp;(Twisted&nbsp;and&nbsp;JS&nbsp;developers).&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;JS,&nbsp;I&nbsp;use&nbsp;the&nbsp;Deferreds&nbsp;that&nbsp;come&nbsp;standard&nbsp;with&nbsp;jQuery&nbsp;since&nbsp;1.5.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Now&nbsp;compare&nbsp;the&nbsp;following&nbsp;Twisted&nbsp;code&nbsp;(self.call&nbsp;does&nbsp;the&nbsp;RPC&nbsp;and&nbsp;returns&nbsp;a&nbsp;Twisted&nbsp;Deferred):&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#&nbsp;prints&nbsp;23&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;d2&nbsp;=&nbsp;self.call(&amp;quot;square&amp;quot;,&nbsp;23).addCallback(lambda&nbsp;res:&nbsp;\&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;self.call(&amp;quot;sqrt&amp;quot;,&nbsp;res)).addCallback(self.show)&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#&nbsp;prints&nbsp;23&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;d3&nbsp;=&nbsp;self.call(&amp;quot;square&amp;quot;,&nbsp;23).addCallback(lambda&nbsp;res:&nbsp;\&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;self.call(&amp;quot;sqrt&amp;quot;,&nbsp;res).addCallback(self.show))&lt;BR&gt;<br>
&lt;BR&gt;<br>
(note&nbsp;the&nbsp;subtle&nbsp;difference&nbsp;in&nbsp;bracketing)&lt;BR&gt;<br>
&lt;BR&gt;<br>
with&nbsp;the&nbsp;following&nbsp;JS&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&nbsp;prints&nbsp;529&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sess.call(&amp;quot;square&amp;quot;,&nbsp;23).then(function(res)&nbsp;{&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;sess.call(&amp;quot;sqrt&amp;quot;,&nbsp;res);&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}).then(console.log);&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&nbsp;prints&nbsp;23&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sess.call(&amp;quot;square&amp;quot;,&nbsp;23).then(function(res)&nbsp;{&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sess.call(&amp;quot;sqrt&amp;quot;,&nbsp;res).then(console.log);&lt;BR&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;});&lt;BR&gt;<br>
&lt;BR&gt;<br>
===&lt;BR&gt;<br>
&lt;BR&gt;<br>
The&nbsp;JS&nbsp;is&nbsp;structurally/syntactically&nbsp;similar&nbsp;to&nbsp;the&nbsp;Py&nbsp;version.&lt;BR&gt;<br>
&lt;BR&gt;<br>
However&nbsp;they&nbsp;behave&nbsp;differently.&lt;BR&gt;<br>
&lt;BR&gt;<br>
There&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;fundamental&nbsp;difference&nbsp;between&nbsp;Twisted&nbsp;and&nbsp;jQuery&nbsp;Deferreds.&lt;BR&gt;<br>
&lt;BR&gt;<br>
When&nbsp;calling&nbsp;then()&nbsp;on&nbsp;a&nbsp;jQuery&nbsp;Deferred&nbsp;D,&nbsp;it&nbsp;seems&nbsp;to&nbsp;return&nbsp;D,&nbsp;not&nbsp;any&nbsp;Deferred&nbsp;that&nbsp;might&lt;BR&gt;<br>
be&nbsp;returned&nbsp;within&nbsp;the&nbsp;handler&nbsp;within&nbsp;then().&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;http://api.jquery.com/deferred.then&quot;&gt;http://api.jquery.com/deferred.then&lt;/a&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
Whereas&nbsp;the&nbsp;Twisted&nbsp;Deferred&nbsp;addCallback()&nbsp;returns&nbsp;the&nbsp;inner&nbsp;Deferred.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Am&nbsp;I&nbsp;getting&nbsp;something&nbsp;wrong?&lt;BR&gt;<br>
&lt;BR&gt;<br>
I'd&nbsp;be&nbsp;glad&nbsp;on&nbsp;any&nbsp;hints/clarification&nbsp;whats&nbsp;going&nbsp;on&nbsp;here&nbsp;..&lt;BR&gt;<br>
&lt;BR&gt;<br>
Tobias&lt;BR&gt;<br>
&lt;BR&gt;<br>
==&lt;BR&gt;<br>
&lt;BR&gt;<br>
The&nbsp;complete&nbsp;examples&nbsp;are&nbsp;on:&lt;BR&gt;<br>
&lt;BR&gt;<br>
JS:&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/oberstet/Autobahn/blob/master/demo/rpc/simple/simple_client.html&quot;&gt;https://github.com/oberstet/Autobahn/blob/master/demo/rpc/simple/simple_client.html&lt;/a&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
Py&nbsp;Client:&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/oberstet/Autobahn/blob/master/demo/rpc/simple/simple_client.py&quot;&gt;https://github.com/oberstet/Autobahn/blob/master/demo/rpc/simple/simple_client.py&lt;/a&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
Py&nbsp;Server:&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/oberstet/Autobahn/blob/master/demo/rpc/simple/simple_server.py&quot;&gt;https://github.com/oberstet/Autobahn/blob/master/demo/rpc/simple/simple_server.py&lt;/a&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
Library:&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/oberstet/Autobahn/tree/master/lib/python&quot;&gt;https://github.com/oberstet/Autobahn/tree/master/lib/python&lt;/a&gt;&lt;BR&gt;<br>
=&amp;gt;&nbsp;python&nbsp;setup.py&nbsp;install&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>
<br>

</tt>
