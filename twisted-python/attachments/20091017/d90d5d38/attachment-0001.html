<tt>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;TITLE&gt;Re:&nbsp;[Twisted-Python]&nbsp;Newbie&nbsp;question:&nbsp;can't&nbsp;get&nbsp;getProcessOutput&nbsp;to&nbsp;run&nbsp;from&nbsp;inside&nbsp;a&nbsp;listenTCP&nbsp;service&nbsp;call-back&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:14pt'&gt;Hi&nbsp;Nick;&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks&nbsp;for&nbsp;the&nbsp;answer.&nbsp;However,&nbsp;If&nbsp;I&nbsp;take&nbsp;the&nbsp;while&nbsp;loop&nbsp;out,&nbsp;&nbsp;&#8220;helloWorldTest()&#8221;&nbsp;returns&nbsp;immediately,&nbsp;and&nbsp;the&nbsp;Flex&nbsp;app&nbsp;gets&nbsp;the&nbsp;initial&nbsp;value&nbsp;of&nbsp;self.result.&nbsp;The&nbsp;defer.callback&nbsp;function&nbsp;doLog&nbsp;never&nbsp;gets&nbsp;called.&nbsp;&nbsp;If&nbsp;I&nbsp;call&nbsp;&nbsp;the&nbsp;&#8220;terminate()&#8221;&nbsp;from&nbsp;the&nbsp;Flex&nbsp;app,&nbsp;which&nbsp;in&nbsp;turn&nbsp;calls&nbsp;reactor.sop()&nbsp;&nbsp;the&nbsp;doLog&nbsp;&nbsp;function&nbsp;finally&nbsp;then&nbsp;gets&nbsp;called.&nbsp;&nbsp;&nbsp;I&nbsp;am&nbsp;looking&nbsp;for&nbsp;what&nbsp;I&nbsp;need&nbsp;to&nbsp;do&nbsp;to&nbsp;allow&nbsp;getProcessOutput&nbsp;to&nbsp;run&nbsp;such&nbsp;that&nbsp;the&nbsp;defer.callback&nbsp;function&nbsp;doLog&nbsp;actually&nbsp;gets&nbsp;called.&nbsp;&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;have&nbsp;figured&nbsp;out&nbsp;that&nbsp;if&nbsp;instead&nbsp;of&nbsp;calling&nbsp;getProcessOutput()&nbsp;directly&nbsp;within&nbsp;the&nbsp;helloWorldTest()&nbsp;method,&nbsp;that&nbsp;I&nbsp;can&nbsp;queue&nbsp;it&nbsp;for&nbsp;running&nbsp;&nbsp;after&nbsp;helloWorldTest()&nbsp;as&nbsp;returned,&nbsp;as&nbsp;in:&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;reactor.callLater(1,&nbsp;self.&nbsp;helloWorldTest2)&lt;BR&gt;<br>
&nbsp;and&nbsp;that&nbsp;the&nbsp;defer.callback&nbsp;function&nbsp;doLog&nbsp;does&nbsp;then&nbsp;get&nbsp;called.&lt;BR&gt;<br>
&lt;BR&gt;<br>
This&nbsp;means&nbsp;that&nbsp;the&nbsp;defer.callback&nbsp;function&nbsp;doLog&nbsp;will&nbsp;get&nbsp;&nbsp;called&nbsp;after&nbsp;the&nbsp;helloWorldTest()&nbsp;&nbsp;has&nbsp;returned.&nbsp;I&nbsp;see&nbsp;can&nbsp;call&nbsp;helloWorldTest()&nbsp;,&nbsp;and&nbsp;then&nbsp;keep&nbsp;querying&nbsp;the&nbsp;python&nbsp;service&nbsp;from&nbsp;the&nbsp;Flex&nbsp;app&nbsp;until&nbsp;the&nbsp;&nbsp;defer.callback&nbsp;function&nbsp;doLog&nbsp;&nbsp;has&nbsp;run.&nbsp;&nbsp;&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;still&nbsp;don&#8217;t&nbsp;understand&nbsp;why&nbsp;calling&nbsp;getProcessOutput()&nbsp;directly&nbsp;within&nbsp;the&nbsp;helloWorldTest()&nbsp;method&nbsp;doesn&#8217;t&nbsp;work.&nbsp;Any&nbsp;explanation&nbsp;would&nbsp;be&nbsp;welcome.&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks,&nbsp;&nbsp;Read&nbsp;Roberts&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;10/17/09&nbsp;1:53&nbsp;AM,&nbsp;&quot;Nick&nbsp;Joyce&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;nick@boxdesign.co.uk&quot;&gt;nick@boxdesign.co.uk&lt;/a&gt;&gt;&nbsp;wrote:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:14pt'&gt;On&nbsp;17&nbsp;Oct&nbsp;2009,&nbsp;at&nbsp;05:15,&nbsp;Read&nbsp;Roberts&nbsp;wrote:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;a&nbsp;Python&nbsp;server&nbsp;using&nbsp;twisted&nbsp;which&nbsp;responds&nbsp;to&nbsp;pyAMF&nbsp;calls&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;from&lt;BR&gt;<br>
&gt;&nbsp;Flex/Air&nbsp;applications&nbsp;(following&nbsp;Bruce&nbsp;Eckels&nbsp;5/1/2008&nbsp;article&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;&quot;Concurrency&lt;BR&gt;<br>
&gt;&nbsp;with&nbsp;Python,&nbsp;Twisted,&nbsp;and&nbsp;Flex&quot;).&nbsp;The&nbsp;service&nbsp;is&nbsp;basically&nbsp;as&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;follows&nbsp;below.&lt;BR&gt;<br>
&gt;&nbsp;When&nbsp;the&nbsp;client&nbsp;calls&nbsp;a&nbsp;service&nbsp;API,&nbsp;the&nbsp;API&nbsp;needs&nbsp;to&nbsp;make&nbsp;a&nbsp;OS&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;shell&nbsp;call.&lt;BR&gt;<br>
&gt;&nbsp;I&nbsp;see&nbsp;that&nbsp;if&nbsp;I&nbsp;call&nbsp;reactor.stop()&nbsp;after&nbsp;the&nbsp;&nbsp;getProcessOutput&nbsp;call&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;(such&lt;BR&gt;<br>
&gt;&nbsp;as&nbsp;within&nbsp;the&nbsp;doLog&nbsp;and&nbsp;doError&nbsp;functions),&nbsp;the&nbsp;call&nbsp;happens&nbsp;and&nbsp;I&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;see&nbsp;the&lt;BR&gt;<br>
&gt;&nbsp;output.&nbsp;How&nbsp;can&nbsp;can&nbsp;I&nbsp;retrieve&nbsp;the&nbsp;output&nbsp;without&nbsp;calling&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;reactor.stop()?&nbsp;In&lt;BR&gt;<br>
&gt;&nbsp;the&nbsp;example&nbsp;below,&nbsp;the&nbsp;AIR&nbsp;app&nbsp;calls&nbsp;the&nbsp;callback&nbsp;helloWorldTest(),&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;and&nbsp;the&lt;BR&gt;<br>
&gt;&nbsp;deferred.addCallback&nbsp;function&nbsp;is&nbsp;never&nbsp;called.&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;import&nbsp;os&lt;BR&gt;<br>
&gt;&nbsp;from&nbsp;twisted.spread&nbsp;import&nbsp;pb&lt;BR&gt;<br>
&gt;&nbsp;from&nbsp;&nbsp;twisted.internet.utils&nbsp;import&nbsp;getProcessOutput&lt;BR&gt;<br>
&gt;&nbsp;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;class&nbsp;FlexInterface(pb.Root):&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self):&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.result&nbsp;e&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;doLog(self,&nbsp;result):&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.result&nbsp;=&nbsp;&quot;%s&quot;&nbsp;%&nbsp;(result)&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;doError(self,&nbsp;failure):&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.result&nbsp;=&nbsp;&quot;%s&quot;&nbsp;%&nbsp;(&nbsp;failure)&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;failure&lt;BR&gt;<br>
&gt;&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;helloWorldTest(self):&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deferred&nbsp;=&nbsp;getProcessOutput(&quot;echo&quot;,&nbsp;[&quot;Hello&nbsp;World&quot;],&nbsp;&lt;BR&gt;<br>
&gt;&nbsp;os.environ)&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deferred.addErrback(self.doError)&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deferred.addCallback(self.doLog)&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(self.result&nbsp;==&nbsp;None)&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;doLog&nbsp;still&nbsp;hasn't&nbsp;been&nbsp;called&quot;&lt;BR&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.result&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
The&nbsp;while&nbsp;loop&nbsp;will&nbsp;block&nbsp;the&nbsp;event&nbsp;loop,&nbsp;preventing&nbsp;the&nbsp;deferred&nbsp;from&nbsp;&lt;BR&gt;<br>
ever&nbsp;being&nbsp;called.&nbsp;PyAMF&nbsp;will&nbsp;accept&nbsp;a&nbsp;deferred&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;for&nbsp;&lt;BR&gt;<br>
the&nbsp;service&nbsp;function&nbsp;and&nbsp;will&nbsp;not&nbsp;return&nbsp;a&nbsp;response&nbsp;until&nbsp;the&nbsp;&lt;BR&gt;<br>
deferred's&nbsp;callback&nbsp;is&nbsp;fired.&lt;BR&gt;<br>
&lt;BR&gt;<br>
So,&nbsp;you&nbsp;could&nbsp;re-write&nbsp;the&nbsp;method&nbsp;like:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;helloWorldTest(self):&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deferred&nbsp;=&nbsp;getProcessOutput(&quot;echo&quot;,&nbsp;[&quot;Hello&nbsp;World&quot;],&nbsp;&lt;BR&gt;<br>
os.environ)&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deferred.addErrback(self.doError)&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deferred.addCallback(self.doLog)&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;deferred&lt;BR&gt;<br>
&lt;BR&gt;<br>
If&nbsp;the&nbsp;deferred's&nbsp;callback&nbsp;is&nbsp;called&nbsp;then&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;doLog&nbsp;&lt;BR&gt;<br>
will&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;response&nbsp;value.&nbsp;If&nbsp;the&nbsp;errback&nbsp;is&nbsp;called,&nbsp;the&nbsp;&lt;BR&gt;<br>
return&nbsp;value&nbsp;of&nbsp;doError&nbsp;will&nbsp;be&nbsp;used&nbsp;as&nbsp;the&nbsp;response,&nbsp;in&nbsp;this&nbsp;case&nbsp;a&nbsp;&lt;BR&gt;<br>
Failure&nbsp;instance.&nbsp;PyAMF&nbsp;converts&nbsp;Failure&nbsp;instances&nbsp;to&nbsp;remoting/&lt;BR&gt;<br>
messaging&nbsp;error&nbsp;objects&nbsp;automagically,&nbsp;so&nbsp;the&nbsp;faultHandler&nbsp;on&nbsp;the&nbsp;&lt;BR&gt;<br>
flash/air&nbsp;side&nbsp;will&nbsp;be&nbsp;called.&lt;BR&gt;<br>
&lt;BR&gt;<br>
hth,&lt;BR&gt;<br>
&lt;BR&gt;<br>
Nick&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
_______________________________________________&lt;BR&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/BLOCKQUOTE&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>
<br>

</tt>
