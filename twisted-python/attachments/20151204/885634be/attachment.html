<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Dec&nbsp;3,&nbsp;2015,&nbsp;at&nbsp;9:14&nbsp;PM,&nbsp;meejah&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:meejah@meejah.ca&quot;&nbsp;class=&quot;&quot;&gt;meejah@meejah.ca&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I've&nbsp;been&nbsp;fooling&nbsp;around&nbsp;with&nbsp;the&nbsp;Twisted&nbsp;SSL&nbsp;APIs.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I'd&nbsp;like&nbsp;to&nbsp;add&nbsp;a&nbsp;&quot;loadPEM&quot;&nbsp;and&nbsp;documentation&nbsp;to&nbsp;ssl.KeyPair;&nbsp;shall&nbsp;I&lt;br&nbsp;class=&quot;&quot;&gt;open&nbsp;a&nbsp;ticket&nbsp;and&nbsp;start&nbsp;this,&nbsp;or&nbsp;is&nbsp;there&nbsp;a&nbsp;reason&nbsp;it&nbsp;doesn't&nbsp;have&nbsp;a&lt;br&nbsp;class=&quot;&quot;&gt;loadPEM()&nbsp;like&nbsp;some&nbsp;of&nbsp;the&nbsp;other&nbsp;classes&nbsp;(or&nbsp;any&nbsp;docstrings)?&nbsp;It&nbsp;is&lt;br&nbsp;class=&quot;&quot;&gt;exported&nbsp;as&nbsp;a&nbsp;public&nbsp;class&nbsp;in&nbsp;&quot;ssl&quot;.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Please&nbsp;go&nbsp;ahead&nbsp;and&nbsp;do&nbsp;it.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Also&nbsp;I'm&nbsp;wondering&nbsp;why&nbsp;CertificateOptions&nbsp;takes&nbsp;actual&nbsp;OpenSSL&nbsp;objects&lt;br&nbsp;class=&quot;&quot;&gt;for&nbsp;args,&nbsp;instead&nbsp;of&nbsp;the&nbsp;Twisted&nbsp;equivalents;&nbsp;this&nbsp;leads&nbsp;to&nbsp;code&lt;br&nbsp;class=&quot;&quot;&gt;accessing&nbsp;&quot;.original&quot;&nbsp;all&nbsp;the&nbsp;time&nbsp;if&nbsp;you&nbsp;use&nbsp;Twisted&nbsp;APIs&nbsp;to&nbsp;load&lt;br&nbsp;class=&quot;&quot;&gt;Certificate&nbsp;(and&nbsp;friends)&nbsp;which&nbsp;seems&nbsp;..&nbsp;odd.&nbsp;Perhaps&nbsp;either&nbsp;a&lt;br&nbsp;class=&quot;&quot;&gt;Certificate&nbsp;*or*&nbsp;the&nbsp;correct&nbsp;underlying&nbsp;OpenSSL&nbsp;object&nbsp;could&nbsp;be&lt;br&nbsp;class=&quot;&quot;&gt;accepted?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Wow!&nbsp;&nbsp;I&nbsp;am&nbsp;so&nbsp;glad&nbsp;someone&nbsp;else&nbsp;finally&nbsp;noticed&nbsp;this!&nbsp;:-)&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Basically:&nbsp;yes,&nbsp;this&nbsp;is&nbsp;odd.&nbsp;&nbsp;It&nbsp;is&nbsp;a&nbsp;result&nbsp;of&nbsp;a&nbsp;miscommunication&nbsp;(or&nbsp;rather,&nbsp;lack&nbsp;of&nbsp;communication)&nbsp;between&nbsp;the&nbsp;designers&nbsp;and&nbsp;the&nbsp;maintainers&nbsp;of&nbsp;that&nbsp;system.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;long&nbsp;time&nbsp;ago,&nbsp;I&nbsp;designed&nbsp;a&nbsp;&quot;just&nbsp;enough&quot;&nbsp;API&nbsp;for&nbsp;TLS&nbsp;(for&nbsp;Vertex,&nbsp;even,&nbsp;not&nbsp;really&nbsp;for&nbsp;Twisted),&nbsp;which&nbsp;is&nbsp;what&nbsp;got&nbsp;adopted&nbsp;into&nbsp;Twisted&nbsp;and&nbsp;eventually&nbsp;became&nbsp;_sslverify.py.&nbsp;&nbsp;However,&nbsp;this&nbsp;was&nbsp;very&nbsp;much&nbsp;incomplete;&nbsp;it&nbsp;wasn't&nbsp;really&nbsp;designed&nbsp;for&nbsp;the&nbsp;99%&nbsp;use-case&nbsp;(running&nbsp;an&nbsp;HTTPS&nbsp;server).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;OpenSSLCertificateOptions&nbsp;was&nbsp;just&nbsp;a&nbsp;private&nbsp;implementation&nbsp;detail;&nbsp;it&nbsp;was&nbsp;the&nbsp;object&nbsp;returned&nbsp;by&nbsp;PrivateCertificate.options().&nbsp;&nbsp;(Hence&nbsp;its&nbsp;somewhat&nbsp;odd&nbsp;name:&nbsp;'options',&nbsp;which&nbsp;has&nbsp;now&nbsp;become&nbsp;the&nbsp;convention;&nbsp;see&nbsp;optionsForClientTLS).&nbsp;&nbsp;However,&nbsp;the&nbsp;signature&nbsp;of&nbsp;.options()&nbsp;was&nbsp;tough&nbsp;to&nbsp;extend,&nbsp;since&nbsp;it&nbsp;just&nbsp;takes&nbsp;&quot;*authorities&quot;.&nbsp;&nbsp;Given&nbsp;Vertex's&nbsp;use-case&nbsp;that&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;sort&nbsp;of&lt;/i&gt;&nbsp;made&nbsp;sense&nbsp;but&nbsp;it&nbsp;really&nbsp;doesn't&nbsp;belong&nbsp;in&nbsp;the&nbsp;general-purpose&nbsp;library&nbsp;of&nbsp;twisted.internet.ssl.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Anyway,&nbsp;I&nbsp;digress:&nbsp;the&nbsp;point&nbsp;is&nbsp;that&nbsp;these&nbsp;classes&nbsp;were&nbsp;lying&nbsp;around,&nbsp;basically&nbsp;undocumented,&nbsp;when&nbsp;Hynek&nbsp;Schlawack&nbsp;showed&nbsp;up&nbsp;and&nbsp;began&nbsp;his&nbsp;otherwise&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;excellent&lt;/i&gt;&nbsp;feature&nbsp;additions&nbsp;to&nbsp;Twisted's&nbsp;TLS&nbsp;stack,&nbsp;among&nbsp;.&nbsp;&nbsp;When&nbsp;asked&nbsp;&quot;what&nbsp;is&nbsp;the&nbsp;'good'&nbsp;ContextFactory&nbsp;class&quot;,&nbsp;the&nbsp;answer&nbsp;he&nbsp;got&nbsp;was&nbsp;unanimously&nbsp;'OpenSSLCertificateOptions'.&nbsp;&nbsp;So&nbsp;he&nbsp;did&nbsp;what&nbsp;seemed&nbsp;reasonable:&nbsp;start&nbsp;adding&nbsp;features&nbsp;to&nbsp;that&nbsp;class,&nbsp;and&nbsp;then&nbsp;make&nbsp;it&nbsp;public.&nbsp;&nbsp;I&nbsp;took&nbsp;my&nbsp;eye&nbsp;off&nbsp;the&nbsp;ball&nbsp;for&nbsp;a&nbsp;release&nbsp;or&nbsp;two&nbsp;and&nbsp;by&nbsp;the&nbsp;time&nbsp;I&nbsp;checked&nbsp;back,&nbsp;&quot;CertificateOptions&quot;&nbsp;was&nbsp;the&nbsp;recommended&nbsp;public&nbsp;interface,&nbsp;warts&nbsp;and&nbsp;all&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;want&nbsp;to&nbsp;be&nbsp;clear&nbsp;that&nbsp;despite&nbsp;the&nbsp;fact&nbsp;that&nbsp;there&nbsp;are&nbsp;problems&nbsp;with&nbsp;the&nbsp;factoring&nbsp;here,&nbsp;if&nbsp;you're&nbsp;writing&nbsp;TLS&nbsp;server&nbsp;code&nbsp;with&nbsp;Twisted&nbsp;today&nbsp;you&nbsp;should&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;absolutely&lt;/i&gt;&nbsp;be&nbsp;using&nbsp;CertificateOptions;&nbsp;its&nbsp;interface&nbsp;is&nbsp;crummy&nbsp;but&nbsp;its&nbsp;implementation&nbsp;is&nbsp;very&nbsp;solid;&nbsp;again,&nbsp;Hynek&nbsp;did&nbsp;some&nbsp;really&nbsp;excellent&nbsp;work.&nbsp;&nbsp;As&nbsp;the&nbsp;interface&nbsp;changes,&nbsp;the&nbsp;implementation&nbsp;should&nbsp;stay&nbsp;largely&nbsp;the&nbsp;same.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;want&nbsp;to&nbsp;fix&nbsp;this,&nbsp;rather&nbsp;than&nbsp;continue&nbsp;to&nbsp;mangle&nbsp;this&nbsp;architectural&nbsp;monstrosity,&nbsp;I&nbsp;think&nbsp;we&nbsp;should&nbsp;develop&nbsp;something&nbsp;symmetrical&nbsp;to&nbsp;the&nbsp;new,&nbsp;mostly&nbsp;pretty&nbsp;good&nbsp;optionsForClientTLS&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.ssl.html#optionsForClientTLS&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.ssl.html#optionsForClientTLS&lt;/a&gt;&nbsp;-&nbsp;which&nbsp;operates&nbsp;entirely&nbsp;in&nbsp;terms&nbsp;of&nbsp;high-level&nbsp;wrapper&nbsp;objects&nbsp;defined&nbsp;in&nbsp;twisted.internet.ssl.&nbsp;&nbsp;Make&nbsp;an&nbsp;'optionsForServerTLS',&nbsp;which&nbsp;can&nbsp;have&nbsp;a&nbsp;simpler&nbsp;interface,&nbsp;because&nbsp;it&nbsp;will&nbsp;just&nbsp;accept&nbsp;relevant&nbsp;configuration&nbsp;parameters&nbsp;for&nbsp;server&nbsp;TLS,&nbsp;and&nbsp;under&nbsp;the&nbsp;covers&nbsp;still&nbsp;use&nbsp;CertificateOptions.&nbsp;&nbsp;Initially&nbsp;we&nbsp;can&nbsp;provide&nbsp;the&nbsp;'extraCertificateOptions'&nbsp;escape-hatch&nbsp;as&nbsp;we&nbsp;have&nbsp;with&nbsp;'optionsForClientTLS',&nbsp;but&nbsp;once&nbsp;we've&nbsp;got&nbsp;a&nbsp;nice&nbsp;way&nbsp;to&nbsp;deal&nbsp;with&nbsp;esoterica&nbsp;like&nbsp;selecting&nbsp;TLS&nbsp;protocol&nbsp;versions&nbsp;and&nbsp;selecting&nbsp;cipher&nbsp;suites&nbsp;in&nbsp;those&nbsp;APIs,&nbsp;we&nbsp;can&nbsp;deprecate&nbsp;and&nbsp;remove&nbsp;the&nbsp;escape-hatch&nbsp;and&nbsp;be&nbsp;left&nbsp;with&nbsp;a&nbsp;clean&nbsp;function.&nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;are&nbsp;you&nbsp;up&nbsp;for&nbsp;contributing&nbsp;an&nbsp;'optionsForServerTLS'?&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;There&nbsp;also&nbsp;doesn't&nbsp;seem&nbsp;to&nbsp;be&nbsp;a&nbsp;way&nbsp;around&nbsp;importing&lt;br&nbsp;class=&quot;&quot;&gt;OpenSSLCertificateAuthorities&nbsp;from&nbsp;_sslverify&nbsp;(i.e.&nbsp;&quot;private&quot;&nbsp;class)&nbsp;if&lt;br&nbsp;class=&quot;&quot;&gt;you&nbsp;want&nbsp;to&nbsp;give&nbsp;optionsForClientTLS()&nbsp;more&nbsp;than&nbsp;a&nbsp;single&nbsp;certificate&nbsp;as&lt;br&nbsp;class=&quot;&quot;&gt;trustRoot.&nbsp;The&nbsp;only&nbsp;way&nbsp;I&nbsp;can&nbsp;see&nbsp;is&nbsp;to&nbsp;construct&nbsp;one&nbsp;of&nbsp;those&nbsp;from&nbsp;a&lt;br&nbsp;class=&quot;&quot;&gt;list&nbsp;of&nbsp;OpenSSL&nbsp;certificate&nbsp;instances&nbsp;and&nbsp;pass&nbsp;that&nbsp;as&nbsp;trustRoot=&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Yes,&nbsp;that&nbsp;is&nbsp;in&nbsp;fact&nbsp;an&nbsp;oversight.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;write&nbsp;a&nbsp;ticket&nbsp;up&nbsp;yourself;&nbsp;you&nbsp;can&nbsp;just&nbsp;fix&nbsp;this&nbsp;one:&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/trac/ticket/7671&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/trac/ticket/7671&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Thanks&nbsp;a&nbsp;ton&nbsp;for&nbsp;your&nbsp;interest,&nbsp;it&nbsp;would&nbsp;be&nbsp;great&nbsp;to&nbsp;get&nbsp;more&nbsp;people&nbsp;interested&nbsp;in&nbsp;TLS&nbsp;to&nbsp;maintain&nbsp;this&nbsp;stuff!&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-glyph&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
