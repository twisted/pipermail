<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
This&nbsp;example&nbsp;shows&nbsp;what&nbsp;i&nbsp;want:&lt;br&gt;<br>
&lt;pre&nbsp;class=&quot;wiki&quot;&gt;@defer.inlineCallbacks<br>
def&nbsp;create_audio_link(tel,&nbsp;addr1,&nbsp;addr2):<br>
&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection1,&nbsp;connection2&nbsp;=&nbsp;yield&nbsp;(tel.connect(addr1),&nbsp;tel.connect(addr2))<br>
&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;ConnectionError,&nbsp;exc:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;some&nbsp;error&nbsp;work&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;tel.create_audiolink(connection1,&nbsp;connection2)<br>
&lt;/pre&gt;<br>
At&nbsp;now&nbsp;we&nbsp;can&nbsp;do&nbsp;this&nbsp;with&nbsp;DeferredList&nbsp;but&nbsp;it&nbsp;is&nbsp;complex&nbsp;(compare&nbsp;with<br>
first&nbsp;example):&lt;br&gt;<br>
&lt;pre&nbsp;class=&quot;wiki&quot;&gt;@defer.inlineCallbacks<br>
def&nbsp;create_audio_link(tel,&nbsp;addr1,&nbsp;addr2):<br>
&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;yield&nbsp;DeferredList([tel.connect(addr1),&nbsp;tel.connect(addr2)],&nbsp;fireOnOneErrback=1,&nbsp;consumeErrors=1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;FirstError,&nbsp;exc:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;exc.subFailure.value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection1,&nbsp;connection2&nbsp;=&nbsp;tuple(_r&nbsp;for&nbsp;_s,&nbsp;_r&nbsp;in&nbsp;r)<br>
&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;ConnectionError,&nbsp;exc:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;some&nbsp;error&nbsp;work&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;tel.create_audiolink(connection1,&nbsp;connection2)<br>
&lt;/pre&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;&quot;&gt;<br>
&lt;div&nbsp;id=&quot;tts_button&quot;&nbsp;title=&quot;Прослушать&nbsp;этот&nbsp;перевод&quot;<br>
&nbsp;style=&quot;display:&nbsp;block;&quot;&nbsp;class=&quot;&nbsp;&quot;&gt;&lt;object<br>
&nbsp;type=&quot;application/x-shockwave-flash&quot;<br>
&nbsp;data=&quot;http://www.gstatic.com/translate/sound_player2.swf&quot;<br>
&nbsp;id=&quot;tts_flash&quot;&nbsp;width=&quot;18&quot;&nbsp;height=&quot;18&quot;&gt;&lt;param<br>
&nbsp;value=&quot;http://www.gstatic.com/translate/sound_player2.swf&quot;&nbsp;name=&quot;movie&quot;&gt;&lt;param<br>
&nbsp;value=&quot;sound_name=translate_tts%3Fq%3DPython%2BURL%2B%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B1%25D0%25BE%25D1%2580%25D0%25B0%26tl%3Dru&amp;amp;sound_name_cb=_TTSSoundFile&quot;<br>
&nbsp;name=&quot;flashvars&quot;&gt;&lt;param&nbsp;value=&quot;transparent&quot;&nbsp;name=&quot;wmode&quot;&gt;&lt;param<br>
&nbsp;value=&quot;always&quot;&nbsp;name=&quot;allowScriptAccess&quot;&gt;&lt;/object&gt;&lt;/div&gt;<br>
&lt;span&nbsp;id=&quot;result_box&quot;&nbsp;class=&quot;short_text&quot;&gt;&lt;span<br>
&nbsp;style=&quot;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;<br>
&nbsp;title=&quot;&quot;&gt;Approximate&lt;/span&gt;&lt;/span&gt;&nbsp;solution&nbsp;(idea)&nbsp;is&nbsp;patch&nbsp;in<br>
defer.py:&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;pre&nbsp;class=&quot;wiki&quot;&gt;def&nbsp;_inlineCallbacks(result,&nbsp;g,&nbsp;deferred):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;skipped&nbsp;...<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isinstance(result,&nbsp;Deferred):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;a&nbsp;deferred&nbsp;was&nbsp;yielded,&nbsp;get&nbsp;the&nbsp;result.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;skipped&nbsp;...<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waiting[0]&nbsp;=&nbsp;True<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waiting[1]&nbsp;=&nbsp;None<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isinstance(result,&nbsp;tuple):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;a&nbsp;tuple&nbsp;was&nbsp;yielded,&nbsp;get&nbsp;the&nbsp;result.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;DeferredList(result,&nbsp;fireOnOneErrback=1,&nbsp;consumeErrors=1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;gotResult(r):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isinstance(r,&nbsp;failure.Failure):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;r.value.subFailure<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;tuple(_r&nbsp;for&nbsp;_s,&nbsp;_r&nbsp;in&nbsp;r)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;waiting[0]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waiting[0]&nbsp;=&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waiting[1]&nbsp;=&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_inlineCallbacks(r,&nbsp;g,&nbsp;deferred)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.addBoth(gotResult)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;waiting[0]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Haven't&nbsp;called&nbsp;back&nbsp;yet,&nbsp;set&nbsp;flag&nbsp;so&nbsp;that&nbsp;we&nbsp;get&nbsp;reinvoked<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;return&nbsp;from&nbsp;the&nbsp;loop<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waiting[0]&nbsp;=&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;deferred<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;waiting[1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Reset&nbsp;waiting&nbsp;to&nbsp;initial&nbsp;values&nbsp;for&nbsp;next&nbsp;loop.&nbsp;&nbsp;gotResult&nbsp;uses<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;waiting,&nbsp;but&nbsp;this&nbsp;isn't&nbsp;a&nbsp;problem&nbsp;because&nbsp;gotResult&nbsp;is&nbsp;only<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;executed&nbsp;once,&nbsp;and&nbsp;if&nbsp;it&nbsp;hasn't&nbsp;been&nbsp;executed&nbsp;yet,&nbsp;the&nbsp;return<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;branch&nbsp;above&nbsp;would&nbsp;have&nbsp;been&nbsp;taken.<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waiting[0]&nbsp;=&nbsp;True<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waiting[1]&nbsp;=&nbsp;None<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;deferred<br>
&lt;/pre&gt;<br>
I&nbsp;post&nbsp;this&nbsp;as&nbsp;ticket&nbsp;but&nbsp;was&nbsp;redirected&nbsp;to&nbsp;mailing-list&lt;br&gt;<br>
&lt;a&nbsp;moz-do-not-send=&quot;true&quot;&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;href=&quot;http://twistedmatrix.com/trac/ticket/4627&quot;&gt;http://twistedmatrix.com/trac/ticket/4627&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
