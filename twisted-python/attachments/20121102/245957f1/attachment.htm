<tt>
On&nbsp;2&nbsp;November&nbsp;2012&nbsp;15:57,&nbsp;Laurens&nbsp;Van&nbsp;Houtven&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:_@lvh.cc&quot;&nbsp;target=&quot;_blank&quot;&gt;_@lvh.cc&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Yeah,&nbsp;very&nbsp;big&nbsp;+1&nbsp;to&nbsp;showing&nbsp;the&nbsp;deferToThread&nbsp;version.&nbsp;I&nbsp;feel&nbsp;bad&nbsp;even&nbsp;trying&nbsp;to&nbsp;spot&nbsp;potential&nbsp;threading&nbsp;issues&nbsp;here...&nbsp;It&nbsp;could&nbsp;be&nbsp;because&nbsp;the&nbsp;default&nbsp;thread&nbsp;pool&nbsp;isn&amp;#39;t&nbsp;very&nbsp;large,&nbsp;but&nbsp;you&amp;#39;re&nbsp;making&nbsp;many&nbsp;requests.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;What&nbsp;functionality&nbsp;does&nbsp;boto&nbsp;have&nbsp;that&nbsp;txaws&nbsp;doesn&amp;#39;t&nbsp;that&nbsp;you&nbsp;really&nbsp;need&nbsp;here?&nbsp;Perhaps&nbsp;you&nbsp;can&nbsp;avoid&nbsp;blocking&nbsp;(and&nbsp;hence&nbsp;threads)&nbsp;at&nbsp;all.&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;the&nbsp;deferToThread&nbsp;version: &lt;a&nbsp;href=&quot;https://github.com/GP89/thumbs/blob/defertothread/thumb.py&quot;&gt;https://github.com/GP89/thumbs/blob/defertothread/thumb.py&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;thread&nbsp;pool&nbsp;size&nbsp;was&nbsp;60,&nbsp;pretty arbitrary&nbsp;but&nbsp;(ignoring&nbsp;the&nbsp;memory&nbsp;leaks)&nbsp;it&nbsp;should&nbsp;only&nbsp;have&nbsp;at&nbsp;most&nbsp;n&nbsp;images&nbsp;in&nbsp;memory&nbsp;at&nbsp;once&nbsp;where&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;threads.&nbsp;If&nbsp;there&amp;#39;s&nbsp;more&nbsp;requests&nbsp;that&nbsp;it&nbsp;can&nbsp;process&nbsp;they&amp;#39;ll&nbsp;just&nbsp;build&nbsp;up&nbsp;in&nbsp;the&nbsp;queue&nbsp;and&nbsp;not&nbsp;cause&nbsp;memory&nbsp;to&nbsp;fill&nbsp;up&nbsp;with&nbsp;downloaded&nbsp;images&nbsp;(this&nbsp;was&nbsp;an&nbsp;initial&nbsp;problem&nbsp;I&nbsp;had).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;understanding&nbsp;is&nbsp;that&nbsp;txaws&nbsp;would&nbsp;only&nbsp;work&nbsp;in&nbsp;a&nbsp;twisted&nbsp;way,&nbsp;but&nbsp;as&nbsp;the&nbsp;work&nbsp;in&nbsp;the&nbsp;thread&nbsp;has&nbsp;blocking&nbsp;code&nbsp;(the&nbsp;PIL&nbsp;bits)&nbsp;I&nbsp;just&nbsp;used&nbsp;boto&nbsp;as&nbsp;I&amp;#39;m&nbsp;more&nbsp;familiar&nbsp;with&nbsp;it.&nbsp;I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;how&nbsp;I&amp;#39;d&nbsp;use&nbsp;txaws&nbsp;in&nbsp;a&nbsp;thread&nbsp;or&nbsp;what&nbsp;benefit&nbsp;that&nbsp;would&nbsp;have?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;d&nbsp;love&nbsp;to&nbsp;avoid&nbsp;blocking&nbsp;and&nbsp;keep&nbsp;it&nbsp;all&nbsp;in&nbsp;1&nbsp;thread,&nbsp;but&nbsp;I&nbsp;don&amp;#39;t&nbsp;know&nbsp;of&nbsp;anyway&nbsp;to&nbsp;do&nbsp;the&nbsp;image&nbsp;resizing/rotation&nbsp;etc.&nbsp;without&nbsp;blocking.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;Fri,&nbsp;Nov&nbsp;2,&nbsp;2012&nbsp;at&nbsp;4:42&nbsp;PM,&nbsp;Paul&nbsp;Wiseman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:poalman@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;poalman@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;I&nbsp;hope&nbsp;this&nbsp;will&nbsp;be&nbsp;an&nbsp;easy&nbsp;question&nbsp;for&nbsp;some&nbsp;of&nbsp;you&nbsp;guys&nbsp;:)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;trying&nbsp;to&nbsp;set&nbsp;up&nbsp;a&nbsp;simple&nbsp;server&nbsp;which&nbsp;will&nbsp;accept&nbsp;requests&nbsp;over&nbsp;GET&nbsp;to&nbsp;create&nbsp;a&nbsp;thumbnail&nbsp;for&nbsp;an&nbsp;image,&nbsp;and&nbsp;server&nbsp;it&nbsp;back&nbsp;as&nbsp;the&nbsp;response.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;images&nbsp;are&nbsp;stored&nbsp;in&nbsp;two&nbsp;S3&nbsp;buckets,&nbsp;the&nbsp;originals&nbsp;are&nbsp;in&nbsp;one&nbsp;bucket&nbsp;(store),&nbsp;and&nbsp;the&nbsp;generated&nbsp;thumbnails&nbsp;are&nbsp;stored&nbsp;in&nbsp;another&nbsp;(thumb)&nbsp;as&nbsp;a&nbsp;cache&nbsp;so&nbsp;that&nbsp;the&nbsp;work&nbsp;doesn&amp;#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;repeated.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Currently&nbsp;I&amp;#39;m&nbsp;checking&nbsp;if&nbsp;the&nbsp;thumbnail&nbsp;already&nbsp;exists&nbsp;in&nbsp;the&nbsp;thumb&nbsp;bucket.&nbsp;I&amp;#39;m&nbsp;redirecting&nbsp;the&nbsp;request&nbsp;if&nbsp;it&nbsp;is&nbsp;or&nbsp;if&nbsp;not&nbsp;I&amp;#39;m&nbsp;downloading&nbsp;the&nbsp;image&nbsp;from&nbsp;store,&nbsp;generating&nbsp;the&nbsp;thumb&nbsp;using&nbsp;PIL,&nbsp;uploading&nbsp;the&nbsp;thumbnail&nbsp;to&nbsp;the&nbsp;thumb&nbsp;bucket&nbsp;and&nbsp;then&nbsp;redirecting&nbsp;the&nbsp;request.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;very&nbsp;new&nbsp;to&nbsp;twisted&nbsp;and&nbsp;was&nbsp;wondering&nbsp;if&nbsp;anyone&nbsp;who&nbsp;is&nbsp;more&nbsp;experienced&nbsp;would&nbsp;be&nbsp;able&nbsp;to&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;what&nbsp;I&nbsp;have&nbsp;so&nbsp;far&nbsp;and&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;anything&nbsp;is&nbsp;wrong/not&nbsp;ideal/will&nbsp;cause&nbsp;problems&nbsp;etc.&nbsp;or&nbsp;just&nbsp;general&nbsp;style&nbsp;pointers?&nbsp;The&nbsp;more&nbsp;critical&nbsp;the&nbsp;better,&nbsp;as&nbsp;I&nbsp;said&nbsp;I&amp;#39;m&nbsp;very&nbsp;new&nbsp;to&nbsp;this.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;ve&nbsp;just&nbsp;chucked&nbsp;it&nbsp;up&nbsp;on&nbsp;github:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/GP89/thumbs/blob/master/thumb.py&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/GP89/thumbs/blob/master/thumb.py&lt;/a&gt; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&amp;#39;s&nbsp;a&nbsp;definite&nbsp;memory&nbsp;leak&nbsp;right&nbsp;now&nbsp;which&nbsp;I&nbsp;believe&nbsp;is&nbsp;PIL,&nbsp;or&nbsp;possibly&nbsp;StringIO&nbsp;objects&nbsp;not&nbsp;being&nbsp;disposed,&nbsp;hence&nbsp;all&nbsp;the&nbsp;random&nbsp;del&nbsp;statements&nbsp;trying&nbsp;to&nbsp;cure&nbsp;it&nbsp;(unsuccessfully).&nbsp;Maybe&nbsp;there&amp;#39;s&nbsp;something&nbsp;I&amp;#39;m&nbsp;doing&nbsp;wrong&nbsp;in&nbsp;twisted&nbsp;that&nbsp;is&nbsp;causing&nbsp;things&nbsp;not&nbsp;to&nbsp;be&nbsp;cleaned&nbsp;up&nbsp;that&nbsp;I&amp;#39;m&nbsp;not&nbsp;aware&nbsp;of&nbsp;as&nbsp;well.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;did&nbsp;try&nbsp;to&nbsp;use&nbsp;deferToThread,&nbsp;rather&nbsp;than&nbsp;my&nbsp;thread&nbsp;pool&nbsp;but&nbsp;the&nbsp;server&nbsp;seemed&nbsp;to&nbsp;block&nbsp;up-&nbsp;I&nbsp;probably&nbsp;should&nbsp;have&nbsp;left&nbsp;it&nbsp;incase&nbsp;it&nbsp;was&nbsp;because&nbsp;I&nbsp;was&nbsp;doing&nbsp;something&nbsp;obviously&nbsp;wrong.&nbsp;I&nbsp;think&nbsp;I&amp;#39;ll&nbsp;make&nbsp;a&nbsp;branch&nbsp;quickly&nbsp;with&nbsp;my&nbsp;deferToThread&nbsp;version.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;very&nbsp;much&nbsp;for&nbsp;any&nbsp;time&nbsp;you&nbsp;can&nbsp;lend!&lt;/div&gt;&lt;span&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Paul&lt;/div&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;cheers&lt;div&gt;lvh&lt;/div&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
