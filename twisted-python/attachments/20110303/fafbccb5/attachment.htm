<tt>
Thanks&nbsp;Reza&nbsp;and&nbsp;Jean-Paul&nbsp;for&nbsp;your&nbsp;response.&nbsp;Actually,&nbsp;I&nbsp;tried&nbsp;investigating&nbsp;a&nbsp;bit&nbsp;more&nbsp;that&nbsp;whether&nbsp;the&nbsp;reactor&nbsp;is&nbsp;in&nbsp;different&nbsp;process&nbsp;than&nbsp;the&nbsp;calling&nbsp;celery&nbsp;task,&nbsp;and&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;case.&nbsp;The&nbsp;workflow&nbsp;that&nbsp;I&nbsp;am&nbsp;assuming&nbsp;is&nbsp;as&nbsp;follows:&lt;br&gt;<br>
<br>
&lt;br&gt;1.&nbsp;Celery&nbsp;creates&nbsp;a&nbsp;worker&nbsp;process&nbsp;and&nbsp;assigns&nbsp;a&nbsp;task&nbsp;to&nbsp;it,&nbsp;which&nbsp;is&nbsp;our&nbsp;Python&nbsp;code.&lt;br&gt;2.&nbsp;That&nbsp;python&nbsp;code&nbsp;is&nbsp;calling&nbsp;into&nbsp;the&nbsp;twisted&nbsp;library&nbsp;where&nbsp;the&nbsp;reactor&nbsp;exists,&nbsp;so&nbsp;that&nbsp;reactor&nbsp;is&nbsp;in&nbsp;the&nbsp;same&nbsp;process&nbsp;as&nbsp;our&nbsp;python&nbsp;code.&lt;br&gt;<br>
<br>
3.&nbsp;Our&nbsp;code&nbsp;opens&nbsp;up&nbsp;a&nbsp;TCP&nbsp;socket&nbsp;to&nbsp;another&nbsp;process&nbsp;which&nbsp;is&nbsp;NOT&nbsp;related&nbsp;to&nbsp;celery&nbsp;or&nbsp;twisted&nbsp;(it&nbsp;connects&nbsp;to&nbsp;freeswitch&nbsp;process).&lt;br&gt;4.&nbsp;When&nbsp;celery&nbsp;is&nbsp;run&nbsp;with&nbsp;concurrency&nbsp;of&nbsp;2,&nbsp;then&nbsp;I&nbsp;tried&nbsp;printing&nbsp;out&nbsp;the&nbsp;process&nbsp;ids&nbsp;of&nbsp;calling&nbsp;process&nbsp;in&nbsp;the&nbsp;reactor&nbsp;code,&nbsp;and&nbsp;I&nbsp;am&nbsp;getting&nbsp;2&nbsp;different&nbsp;pids,&nbsp;so&nbsp;I&nbsp;am&nbsp;assuming&nbsp;there&nbsp;are&nbsp;two&nbsp;seperate&nbsp;copies&nbsp;of&nbsp;reactor&nbsp;in&nbsp;those&nbsp;separate&nbsp;tasks.&lt;br&gt;<br>
5.&nbsp;One&nbsp;thing&nbsp;that&nbsp;I&nbsp;have&nbsp;think&nbsp;that&amp;#39;s&nbsp;happening&nbsp;is&nbsp;that&nbsp;the&nbsp;reactor&nbsp;gets&nbsp;stuck&nbsp;at&nbsp;polling,&nbsp;and&nbsp;then&nbsp;once&nbsp;it&nbsp;times&nbsp;out,&nbsp;the&nbsp;data&nbsp;is&nbsp;written&nbsp;on&nbsp;the&nbsp;socket.&nbsp;Is&nbsp;that&nbsp;possible?&nbsp;If&nbsp;yes,&nbsp;how&nbsp;can&nbsp;I&nbsp;get&nbsp;around&nbsp;it?&lt;br&gt;6.&nbsp;Jean-Paul,&nbsp;how&nbsp;does&nbsp;Ampoule&nbsp;compares&nbsp;to&nbsp;Twisted?&lt;br&gt;<br>
&lt;br&gt;Thanks,&lt;br&gt;Dinesh&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Mar&nbsp;2,&nbsp;2011&nbsp;at&nbsp;7:04&nbsp;PM,&nbsp;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;09:42&nbsp;am,&nbsp;&lt;a&nbsp;href=&quot;mailto:dineshkapoor27@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;dineshkapoor27@gmail.com&lt;/a&gt;&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;Hi,&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp; I&nbsp;have&nbsp;run&nbsp;into&nbsp;a&nbsp;weird&nbsp;performance&nbsp;issue&nbsp;while&nbsp;working&nbsp;with&nbsp;twisted&lt;br&gt;<br>
&amp;gt;and&lt;br&gt;<br>
&amp;gt;using&nbsp;celery&nbsp;to&nbsp;schedule&nbsp;tasks&nbsp;on&nbsp;it.&nbsp;Here&nbsp;is&nbsp;my&nbsp;setup:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;1.&nbsp;Celery&nbsp;schedules&nbsp;a&nbsp;task&nbsp;which&nbsp;makes&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;a&nbsp;server&lt;br&gt;<br>
&amp;gt;running&lt;br&gt;<br>
&amp;gt;FreeSwitch&lt;br&gt;<br>
&amp;gt;2.&nbsp;Celery&nbsp;is&nbsp;running&nbsp;with&nbsp;concurrency&nbsp;=&nbsp;2.&lt;br&gt;<br>
&amp;gt;3.&nbsp;I&nbsp;have&nbsp;changed&nbsp;my&nbsp;code&nbsp;so&nbsp;that&nbsp;I&nbsp;call&nbsp;reactor.callfromthread&nbsp;for&nbsp;all&lt;br&gt;<br>
&amp;gt;reactor&nbsp;based&nbsp;work.&lt;br&gt;<br>
&amp;gt;4.&nbsp;A&nbsp;lot&nbsp;of&nbsp;times&nbsp;once&nbsp;I&nbsp;schedule&nbsp;the&nbsp;celery&nbsp;task,&nbsp;I&nbsp;get&nbsp;delays&nbsp;ranging&lt;br&gt;<br>
&amp;gt;from&lt;br&gt;<br>
&amp;gt;3&nbsp;-&nbsp;30&nbsp;seconds&nbsp;when&nbsp;I&nbsp;am&nbsp;running&nbsp;with&nbsp;Celery&nbsp;concurrency&nbsp;=2.&lt;br&gt;<br>
&amp;gt;5.&nbsp;If&nbsp;I&nbsp;reduce&nbsp;the&nbsp;celery&nbsp;concurrency&nbsp;to&nbsp;1,&nbsp;then&nbsp;everything&nbsp;works&lt;br&gt;<br>
&amp;gt;great!&lt;br&gt;<br>
&amp;gt;6.&nbsp;Upon&nbsp;debugging&nbsp;it&nbsp;a&nbsp;little&nbsp;bit&nbsp;more,&nbsp;it&nbsp;seems&nbsp;that&nbsp;the&lt;br&gt;<br>
&amp;gt;selectReactor&amp;#39;s&lt;br&gt;<br>
&amp;gt;doSelect&nbsp;is&nbsp;where&nbsp;the&nbsp;code&nbsp;is&nbsp;getting&nbsp;stuck&nbsp;on&nbsp;the&nbsp;select().&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;I&nbsp;dont&nbsp;know&nbsp;how&nbsp;to&nbsp;get&nbsp;around&nbsp;the&nbsp;delay,&nbsp;and&nbsp;I&nbsp;dont&nbsp;know&nbsp;who&nbsp;is&nbsp;causing&lt;br&gt;<br>
&amp;gt;that&lt;br&gt;<br>
&amp;gt;delay&nbsp;exactly.&nbsp;If&nbsp;there&nbsp;is&nbsp;more&nbsp;info&nbsp;that&nbsp;is&nbsp;needed&nbsp;then&nbsp;please&nbsp;let&nbsp;me&lt;br&gt;<br>
&amp;gt;know.&lt;br&gt;<br>
&amp;gt;Everything&nbsp;works&nbsp;fine&nbsp;when&nbsp;the&nbsp;Celery&nbsp;worker&nbsp;process&nbsp;is&nbsp;1,&nbsp;but&nbsp;delay&lt;br&gt;<br>
&amp;gt;starts&lt;br&gt;<br>
&amp;gt;happening&nbsp;invariably&nbsp;when&nbsp;celery&amp;#39;s&nbsp;worker&nbsp;processes&nbsp;&amp;gt;=2.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;I&nbsp;think&nbsp;Reza&nbsp;Lotun&nbsp;explained&nbsp;what&amp;#39;s&nbsp;causing&nbsp;this&nbsp;problem.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;haven&amp;#39;t&nbsp;looked&nbsp;at&nbsp;it&nbsp;yet,&nbsp;you&nbsp;might&nbsp;want&nbsp;to&nbsp;see&nbsp;if&nbsp;Ampoule&nbsp;can&lt;br&gt;<br>
help&nbsp;you&nbsp;out.&lt;br&gt;<br>
&lt;br&gt;<br>
Jean-Paul&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
