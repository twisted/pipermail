<tt>
I&nbsp;would&nbsp;also&nbsp;be&nbsp;very&nbsp;grateful&nbsp;for&nbsp;feedback&nbsp;from&nbsp;the&nbsp;twisted&nbsp;point&nbsp;of&nbsp;view.&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;&lt;br&gt;&lt;br&gt;Marc&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;----------&nbsp;Forwarded&nbsp;message&nbsp;----------&lt;br&gt;From:&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Marc&nbsp;Byrd&lt;/b&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dr.marc.byrd@gmail.com&quot;&gt;dr.marc.byrd@gmail.com&lt;/a&gt;&gt;&lt;br&gt;<br>
Date:&nbsp;Fri,&nbsp;Feb&nbsp;29,&nbsp;2008&nbsp;at&nbsp;10:17&nbsp;AM&lt;br&gt;Subject:&nbsp;Seeking&nbsp;Validation&nbsp;-&nbsp;search&nbsp;web&nbsp;service&nbsp;using&nbsp;memcached&lt;br&gt;To:&nbsp;&lt;a&nbsp;href=&quot;mailto:rubyonrails-talk@googlegroups.com&quot;&gt;rubyonrails-talk@googlegroups.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Hi,&lt;br&gt;&lt;br&gt;<br>
I&#39;m&nbsp;looking&nbsp;for&nbsp;some&nbsp;validation&nbsp;for&nbsp;some&nbsp;work&nbsp;I&#39;ve&nbsp;done&nbsp;for&nbsp;a&nbsp;client,&nbsp;and&nbsp;I&#39;m&nbsp;open&nbsp;to&nbsp;criticism&nbsp;(&quot;mock&nbsp;me&quot;&nbsp;?&nbsp;;^),&nbsp;relevant&nbsp;awareness&nbsp;of&nbsp;similar&nbsp;projects,&nbsp;and&nbsp;alternatives.&lt;br&gt;&lt;br&gt;When&nbsp;I&nbsp;looked&nbsp;around&nbsp;in&nbsp;about&nbsp;September&nbsp;2007&nbsp;for&nbsp;a&nbsp;good&nbsp;scalable&nbsp;search&nbsp;solution&nbsp;for&nbsp;Ruby&nbsp;on&nbsp;Rails,&nbsp;I&nbsp;found&nbsp;the&nbsp;choices&nbsp;lacking.&nbsp;&nbsp;Firstly,&nbsp;none&nbsp;of&nbsp;the&nbsp;solutions&nbsp;seemed&nbsp;to&nbsp;have&nbsp;an&nbsp;option&nbsp;for&nbsp;keeping&nbsp;the&nbsp;reverse&nbsp;indices&nbsp;in-memory&nbsp;across&nbsp;any&nbsp;number&nbsp;of&nbsp;machines&nbsp;I&nbsp;might&nbsp;like&nbsp;to&nbsp;store&nbsp;them.&nbsp;&nbsp;Secondly,&nbsp;many&nbsp;of&nbsp;the&nbsp;solutions&nbsp;seemed&nbsp;too&nbsp;general&nbsp;purpose&nbsp;and&nbsp;heavy&nbsp;weight&nbsp;for&nbsp;my&nbsp;client&#39;s&nbsp;needs&nbsp;(which&nbsp;are&nbsp;basically&nbsp;to&nbsp;search&nbsp;for&nbsp;items&nbsp;from&nbsp;the&nbsp;db,&nbsp;based&nbsp;on&nbsp;tags).&nbsp;&nbsp;But&nbsp;without&nbsp;addressing&nbsp;the&nbsp;first&nbsp;concern,&nbsp;I&nbsp;felt&nbsp;that&nbsp;anything&nbsp;I&nbsp;implemented&nbsp;would&nbsp;not&nbsp;scale&nbsp;to&nbsp;the&nbsp;customer&#39;s&nbsp;needs&nbsp;and&nbsp;aspirations,&nbsp;and&nbsp;that&nbsp;for&nbsp;such&nbsp;an&nbsp;investment,&nbsp;virtually&nbsp;unlimited&nbsp;scale&nbsp;would&nbsp;be&nbsp;mandatory.&nbsp;&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;Therefore&nbsp;I&nbsp;looked&nbsp;at&nbsp;memcached&nbsp;-&nbsp;well-proven&nbsp;on&nbsp;many&nbsp;large-scale&nbsp;sites&nbsp;for&nbsp;caching,&nbsp;but&nbsp;to&nbsp;my&nbsp;knowledge&nbsp;not&nbsp;used&nbsp;in&nbsp;search.&nbsp;&nbsp;Note&nbsp;that&nbsp;memcached&nbsp;uses&nbsp;an&nbsp;approach&nbsp;wherein&nbsp;the&nbsp;clients&nbsp;all&nbsp;calculate&nbsp;a&nbsp;server&nbsp;based&nbsp;on&nbsp;a&nbsp;given&nbsp;key,&nbsp;such&nbsp;that&nbsp;no&nbsp;central&nbsp;(scale-limiting)&nbsp;controller&nbsp;is&nbsp;required.&nbsp;&nbsp;Having&nbsp;chosen&nbsp;memcached,&nbsp;I&nbsp;next&nbsp;attempted&nbsp;to&nbsp;use&nbsp;various&nbsp;memcached&nbsp;connectors&nbsp;into&nbsp;RoR.&nbsp;&nbsp;I&nbsp;found&nbsp;them&nbsp;at&nbsp;the&nbsp;time&nbsp;(Oct&nbsp;2007&nbsp;or&nbsp;so)&nbsp;to&nbsp;be&nbsp;slow&nbsp;and&nbsp;buggy;&nbsp;it&nbsp;didn&#39;t&nbsp;take&nbsp;more&nbsp;than&nbsp;a&nbsp;couple&nbsp;of&nbsp;times&nbsp;of&nbsp;totally&nbsp;corrupting&nbsp;the&nbsp;entire&nbsp;cache&nbsp;to&nbsp;avert&nbsp;my&nbsp;attention&nbsp;from&nbsp;a&nbsp;Ruby&nbsp;approach&nbsp;to&nbsp;using&nbsp;memcached.&nbsp;&nbsp;Meanwhile,&nbsp;I&nbsp;knew&nbsp;from&nbsp;prior&nbsp;experience&nbsp;that&nbsp;the&nbsp;python&nbsp;client&nbsp;for&nbsp;memcached&nbsp;was&nbsp;both&nbsp;fast&nbsp;and&nbsp;reliable.&nbsp;&nbsp;The&nbsp;python&nbsp;memcached&nbsp;client&nbsp;was&nbsp;routinely&nbsp;3x&nbsp;faster&nbsp;for&nbsp;the&nbsp;tests&nbsp;I&nbsp;ran.&nbsp;&nbsp;Python&nbsp;also&nbsp;seems&nbsp;to&nbsp;be&nbsp;quite&nbsp;fast&nbsp;at&nbsp;set&nbsp;operations.&nbsp;&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;Getting&nbsp;to&nbsp;the&nbsp;punchline,&nbsp;I&nbsp;used&nbsp;python&nbsp;and&nbsp;memcached,&nbsp;wrapped&nbsp;in&nbsp;twisted,&nbsp;to&nbsp;provide&nbsp;a&nbsp;ReSTful&nbsp;web&nbsp;service&nbsp;api,&nbsp;which&nbsp;is&nbsp;called&nbsp;from&nbsp;RoR&nbsp;to&nbsp;get&nbsp;ALL&nbsp;of&nbsp;the&nbsp;information&nbsp;needed&nbsp;to&nbsp;render&nbsp;search&nbsp;results.&nbsp;&nbsp;The&nbsp;API&nbsp;has&nbsp;been&nbsp;extended&nbsp;to&nbsp;allow&nbsp;the&nbsp;Ruby&nbsp;code&nbsp;to&nbsp;&quot;fire&nbsp;and&nbsp;forget&quot;&nbsp;new&nbsp;indexing&nbsp;info&nbsp;onto&nbsp;a&nbsp;deque&nbsp;(fifo&nbsp;queue),&nbsp;which&nbsp;is&nbsp;processed&nbsp;by&nbsp;a&nbsp;loosely-coupled&nbsp;daemon&nbsp;-&nbsp;overhead&nbsp;to&nbsp;Ruby&nbsp;is&nbsp;about&nbsp;20ms.&nbsp;&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;Prior&nbsp;to&nbsp;this&nbsp;approach,&nbsp;the&nbsp;client&nbsp;was&nbsp;using&nbsp;MyISAM&nbsp;full&nbsp;text&nbsp;search.&nbsp;&nbsp;Search&nbsp;results&nbsp;were&nbsp;10s&nbsp;for&nbsp;smaller&nbsp;search&nbsp;terms&nbsp;(5000&nbsp;uses),&nbsp;and&nbsp;20+s&nbsp;for&nbsp;larger&nbsp;search&nbsp;terms&nbsp;(100k+&nbsp;uses).&nbsp;&nbsp;&lt;br&gt;&lt;br&gt;With&nbsp;the&nbsp;web&nbsp;service,&nbsp;the&nbsp;search&nbsp;results&nbsp;are&nbsp;routinely&nbsp;returned&nbsp;in&nbsp;1-2&nbsp;seconds,&nbsp;and&nbsp;the&nbsp;web&nbsp;service&nbsp;itself&nbsp;returns&nbsp;results&nbsp;to&nbsp;RoR&nbsp;within&nbsp;100-200ms.&nbsp;&nbsp;Indexing&nbsp;is&nbsp;a&nbsp;challenge&nbsp;-&nbsp;the&nbsp;rank&nbsp;score&nbsp;needs&nbsp;to&nbsp;be&nbsp;updated&nbsp;upon&nbsp;each&nbsp;viewing,&nbsp;but&nbsp;I&#39;ve&nbsp;now&nbsp;gotten&nbsp;that&nbsp;to&nbsp;be&nbsp;almost&nbsp;real-time&nbsp;(5&nbsp;minutes&nbsp;max).&nbsp;&nbsp;Plus&nbsp;I&nbsp;can&nbsp;re-index&nbsp;the&nbsp;entire&nbsp;database&nbsp;of&nbsp;1M+&nbsp;items&nbsp;in&nbsp;about&nbsp;8&nbsp;hours.&nbsp;&nbsp;The&nbsp;index&nbsp;is&nbsp;backed&nbsp;up&nbsp;nightly&nbsp;in&nbsp;case&nbsp;of&nbsp;a&nbsp;memcached&nbsp;server&nbsp;failure&nbsp;(we&#39;re&nbsp;using&nbsp;3).&nbsp;&nbsp;In&nbsp;addition&nbsp;to&nbsp;search,&nbsp;the&nbsp;search&nbsp;web&nbsp;service&nbsp;is&nbsp;used&nbsp;for&nbsp;relatedness&nbsp;and&nbsp;for&nbsp;something&nbsp;like&nbsp;bookmarks.&nbsp;&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;So,&nbsp;is&nbsp;there&nbsp;anything&nbsp;out&nbsp;there&nbsp;that&nbsp;can&nbsp;touch&nbsp;these&nbsp;results&nbsp;and&nbsp;provide&nbsp;for&nbsp;virtually&nbsp;unlimited&nbsp;scale&nbsp;(no&nbsp;central&nbsp;controller)?&nbsp;&nbsp;&lt;br&gt;&lt;br&gt;Thanks&nbsp;in&nbsp;advance,&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&lt;br&gt;Marc&lt;br&gt;&lt;/font&gt;&lt;br&gt;PS:&nbsp;&nbsp;Because&nbsp;of&nbsp;leaks&nbsp;in&nbsp;rmagick&nbsp;and&nbsp;its&nbsp;inferior&nbsp;performance&nbsp;compared&nbsp;to&nbsp;the&nbsp;Python&nbsp;Image&nbsp;Library,&nbsp;I&#39;m&nbsp;also&nbsp;considering&nbsp;a&nbsp;similar&nbsp;approach&nbsp;for&nbsp;generating&nbsp;many&nbsp;different&nbsp;sizes&nbsp;of&nbsp;fairly&nbsp;large&nbsp;(10MB)&nbsp;images.&nbsp;&nbsp;A&nbsp;similar&nbsp;fire&nbsp;and&nbsp;forget&nbsp;web&nbsp;service&nbsp;approach&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;minimize&nbsp;the&nbsp;impact&nbsp;on&nbsp;the&nbsp;RoR&nbsp;side.&nbsp;&nbsp;Early&nbsp;tests&nbsp;show&nbsp;a&nbsp;10x&nbsp;speed&nbsp;improvement&nbsp;(even&nbsp;without&nbsp;the&nbsp;fire&nbsp;and&nbsp;forget).&nbsp;&nbsp;Any&nbsp;thoughts&nbsp;there?&nbsp;&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;br&gt;<br>

</tt>
