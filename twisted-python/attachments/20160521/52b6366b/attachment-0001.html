<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;May&nbsp;10,&nbsp;2016,&nbsp;at&nbsp;9:52&nbsp;AM,&nbsp;Daniel&nbsp;Sutcliffe&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dansut@gmail.com&quot;&nbsp;class=&quot;&quot;&gt;dansut@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Thanks&nbsp;Glyph,&nbsp;I&nbsp;think&nbsp;you&nbsp;have&nbsp;given&nbsp;me&nbsp;a&nbsp;push&nbsp;back&nbsp;in&nbsp;the&nbsp;'right'&lt;br&nbsp;class=&quot;&quot;&gt;direction&nbsp;-&nbsp;more&nbsp;thoughts&nbsp;and&nbsp;commentary&nbsp;embedded&nbsp;below&nbsp;if&nbsp;you,&nbsp;or&lt;br&nbsp;class=&quot;&quot;&gt;anyone&nbsp;else,&nbsp;has&nbsp;the&nbsp;time.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;On&nbsp;May&nbsp;6,&nbsp;2016,&nbsp;at&nbsp;10:19&nbsp;AM,&nbsp;Daniel&nbsp;Sutcliffe&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dansut@gmail.com&quot;&nbsp;class=&quot;&quot;&gt;dansut@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;[...]&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;The&nbsp;new&nbsp;ClientService&nbsp;class&nbsp;seems&nbsp;like&nbsp;it&nbsp;will&nbsp;fit&nbsp;my&nbsp;needs&nbsp;very&lt;br&nbsp;class=&quot;&quot;&gt;closely&nbsp;but&nbsp;I&nbsp;am&nbsp;struggling&nbsp;with&nbsp;how&nbsp;to&nbsp;handle&nbsp;the&nbsp;reconnections...&nbsp;I&lt;br&nbsp;class=&quot;&quot;&gt;have&nbsp;been&nbsp;using&nbsp;the&nbsp;whenConnected()&nbsp;method&nbsp;to&nbsp;grab&nbsp;the&nbsp;Protocol&nbsp;for&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;initial&nbsp;connection&nbsp;and&nbsp;then&nbsp;use&nbsp;a&nbsp;method&nbsp;of&nbsp;this&nbsp;to&nbsp;poll&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;connected&nbsp;slave.&nbsp;When&nbsp;the&nbsp;connection&nbsp;is&nbsp;lost&nbsp;I&nbsp;get&nbsp;an&nbsp;errback&nbsp;from&lt;br&nbsp;class=&quot;&quot;&gt;this&nbsp;method's&nbsp;deferred&nbsp;which&nbsp;I&nbsp;use&nbsp;as&nbsp;a&nbsp;signal&nbsp;to&nbsp;abandon&nbsp;the&nbsp;Protocol&lt;br&nbsp;class=&quot;&quot;&gt;and&nbsp;call&nbsp;whenConnected()&nbsp;again...&nbsp;at&nbsp;this&nbsp;point&nbsp;I&nbsp;have&nbsp;an&nbsp;issue&nbsp;though&lt;br&nbsp;class=&quot;&quot;&gt;as&nbsp;the&nbsp;returned&nbsp;deferred&nbsp;immediately&nbsp;gives&nbsp;me&nbsp;a&nbsp;callback&nbsp;with&nbsp;the&nbsp;same&lt;br&nbsp;class=&quot;&quot;&gt;Protocol&nbsp;which&nbsp;has&nbsp;just&nbsp;lost&nbsp;its&nbsp;connection,&nbsp;and&nbsp;thus&nbsp;loop...&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;On&nbsp;Mon,&nbsp;May&nbsp;9,&nbsp;2016&nbsp;at&nbsp;6:19&nbsp;PM,&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;class=&quot;&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;If&nbsp;you&nbsp;want&nbsp;a&nbsp;hook&nbsp;each&nbsp;time&nbsp;a&nbsp;new&nbsp;protocol&nbsp;is&nbsp;created,&nbsp;you're&nbsp;probably&lt;br&nbsp;class=&quot;&quot;&gt;better&nbsp;off&nbsp;writing&nbsp;a&nbsp;wrapper&nbsp;protocol&nbsp;factory,&nbsp;and&nbsp;passing&nbsp;that&nbsp;to&nbsp;your&lt;br&nbsp;class=&quot;&quot;&gt;ClientService,&nbsp;then&nbsp;doing&nbsp;any&nbsp;set-up&nbsp;work&nbsp;you&nbsp;want&nbsp;to&nbsp;do&nbsp;in&nbsp;your&lt;br&nbsp;class=&quot;&quot;&gt;buildProtocol&nbsp;implementation,&nbsp;which&nbsp;delegates&nbsp;to&nbsp;the&nbsp;real,&nbsp;pymodbus&lt;br&nbsp;class=&quot;&quot;&gt;implementation.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Understood,&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;way&nbsp;the&nbsp;framework&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;I&lt;br&nbsp;class=&quot;&quot;&gt;realize&nbsp;doing&nbsp;anything&nbsp;else&nbsp;is&nbsp;going&nbsp;to&nbsp;be&nbsp;fighting&nbsp;against&nbsp;the&nbsp;flow.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;However,&nbsp;just&nbsp;to&nbsp;probe&nbsp;the&nbsp;situation&nbsp;I&nbsp;found&nbsp;myself&nbsp;in&nbsp;further,&nbsp;for&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;sake&nbsp;probing&nbsp;broken&nbsp;code&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;might&nbsp;be&nbsp;fixed:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Given&nbsp;the&nbsp;ClientService.whenConnected()&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;provide&lt;br&nbsp;class=&quot;&quot;&gt;access&nbsp;to&nbsp;my&nbsp;connected&nbsp;Protocol&nbsp;through&nbsp;the&nbsp;deferred&nbsp;it&nbsp;returns,&nbsp;is&nbsp;it&lt;br&nbsp;class=&quot;&quot;&gt;not&nbsp;a&nbsp;little&nbsp;unfriendly&nbsp;that&nbsp;this&nbsp;Protocol&nbsp;may&nbsp;turn&nbsp;out&nbsp;to&nbsp;be&lt;br&nbsp;class=&quot;&quot;&gt;disconnected?&nbsp;OK&nbsp;occasionally&nbsp;due&nbsp;to&nbsp;timing&nbsp;but&nbsp;for&nbsp;this&nbsp;to&nbsp;be&nbsp;a&lt;br&nbsp;class=&quot;&quot;&gt;possible&nbsp;condition&nbsp;which&nbsp;can&nbsp;loop&nbsp;with&nbsp;the&nbsp;same&nbsp;disconnected&nbsp;Protocol&lt;br&nbsp;class=&quot;&quot;&gt;returned&nbsp;until&nbsp;the&nbsp;ClientService&nbsp;has&nbsp;its&nbsp;_currentConnection&nbsp;set&nbsp;to&lt;br&nbsp;class=&quot;&quot;&gt;None,&nbsp;suggests&nbsp;to&nbsp;me&nbsp;that&nbsp;I&nbsp;can't&nbsp;safely&nbsp;use&nbsp;my&nbsp;Protocol&nbsp;from&lt;br&nbsp;class=&quot;&quot;&gt;whenConnected()&nbsp;for&nbsp;much&nbsp;other&nbsp;than&nbsp;as&nbsp;a&nbsp;notification&nbsp;the&nbsp;first&lt;br&nbsp;class=&quot;&quot;&gt;connection&nbsp;has&nbsp;occurred...&nbsp;but&nbsp;how&nbsp;do&nbsp;I&nbsp;avoid&nbsp;this?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;whenConnected()&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;for&nbsp;&quot;give&nbsp;me&nbsp;each&nbsp;Protocol&nbsp;as&nbsp;it&nbsp;is&nbsp;instantiated&nbsp;so&nbsp;that&nbsp;state&nbsp;can&nbsp;be&nbsp;set&nbsp;up&quot;,&nbsp;it&nbsp;is&nbsp;intended&nbsp;for&nbsp;API&nbsp;clients&nbsp;which&nbsp;want&nbsp;to&nbsp;send&nbsp;a&nbsp;message&nbsp;to&nbsp;the&nbsp;current&nbsp;connection&nbsp;to&nbsp;just&nbsp;retrieve&nbsp;the&nbsp;current&nbsp;connection&nbsp;so&nbsp;they&nbsp;can&nbsp;call&nbsp;a&nbsp;method&nbsp;on&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;not&nbsp;sure&nbsp;what&nbsp;you&nbsp;mean&nbsp;by&nbsp;&quot;turn&nbsp;out&nbsp;to&nbsp;be&nbsp;disconnected&quot;.&nbsp;&nbsp;The&nbsp;physical&nbsp;reality&nbsp;of&nbsp;networking&nbsp;is&nbsp;that&nbsp;you&nbsp;might&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;always&lt;/i&gt;&nbsp;encounter&nbsp;a&nbsp;transport&nbsp;which&nbsp;has&nbsp;been&nbsp;disconnected&nbsp;but&nbsp;which&nbsp;you&nbsp;haven't&nbsp;received&nbsp;notification&nbsp;of&nbsp;its&nbsp;disconnection&nbsp;yet.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;have&nbsp;looked&nbsp;at&nbsp;the&nbsp;source&nbsp;and&nbsp;it&nbsp;seems&nbsp;to&nbsp;me&nbsp;the&nbsp;fact&nbsp;that&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;connection&nbsp;has&nbsp;been&nbsp;lost&nbsp;should&nbsp;bubble&nbsp;up&nbsp;to&nbsp;the&nbsp;ClientService&nbsp;through&lt;br&nbsp;class=&quot;&quot;&gt;a&nbsp;t.a.i._DisconnectFactory&nbsp;and&nbsp;t.a.i._ReconnectingProtocolProxy&nbsp;once&lt;br&nbsp;class=&quot;&quot;&gt;my&nbsp;Protocol's&nbsp;connectionLost()&nbsp;is&nbsp;called.&nbsp;My&nbsp;issue&nbsp;seems&nbsp;to&nbsp;be&nbsp;that&nbsp;I&lt;br&nbsp;class=&quot;&quot;&gt;errback&nbsp;on&nbsp;a&nbsp;Protocol&nbsp;method's&nbsp;deferred&nbsp;returned&nbsp;to&nbsp;code&nbsp;at&nbsp;or&nbsp;above&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;ClientService&nbsp;level&nbsp;which&nbsp;gives&nbsp;up&nbsp;on&nbsp;that&nbsp;Protocol&nbsp;and&nbsp;calls&lt;br&nbsp;class=&quot;&quot;&gt;whenConnected()&nbsp;to&nbsp;get&nbsp;the&nbsp;next&nbsp;one,&nbsp;only&nbsp;the&nbsp;Protocol's&lt;br&nbsp;class=&quot;&quot;&gt;connectionLost()&nbsp;has&nbsp;yet&nbsp;to&nbsp;be&nbsp;called&nbsp;and&nbsp;then&nbsp;doesn't&nbsp;have&nbsp;chance&nbsp;to&lt;br&nbsp;class=&quot;&quot;&gt;because&nbsp;my&nbsp;code&nbsp;is&nbsp;looping&nbsp;around&nbsp;calling&nbsp;whenConnected()&nbsp;and&nbsp;getting&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;same&nbsp;Protocol&nbsp;back.&nbsp;I&nbsp;hope&nbsp;that&nbsp;makes&nbsp;sense&nbsp;:-/&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Let&nbsp;me&nbsp;try&nbsp;to&nbsp;rephrase:&nbsp;you&nbsp;call&nbsp;a&nbsp;protocol&nbsp;method&nbsp;which&nbsp;returns&nbsp;a&nbsp;Deferred;&nbsp;you&nbsp;add&nbsp;an&nbsp;errback&nbsp;to&nbsp;that&nbsp;Deferred&nbsp;which&nbsp;calls&nbsp;whenConnected()&nbsp;to&nbsp;re-try,&nbsp;but&nbsp;since&nbsp;the&nbsp;protocol&nbsp;hasn't&nbsp;disconnected&nbsp;yet,&nbsp;you&nbsp;get&nbsp;the&nbsp;same&nbsp;protocol&nbsp;instance&nbsp;back,&nbsp;which&nbsp;is&nbsp;useless&nbsp;to&nbsp;you.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;My&nbsp;Q&nbsp;on&nbsp;this&nbsp;is&nbsp;if&nbsp;I&nbsp;should&nbsp;be&nbsp;internally&nbsp;calling&nbsp;my&nbsp;Protocol's&lt;br&nbsp;class=&quot;&quot;&gt;connectionLost()&nbsp;so&nbsp;it&nbsp;can&nbsp;bubble&nbsp;up&nbsp;to&nbsp;the&nbsp;ClientService&nbsp;before&nbsp;I&lt;br&nbsp;class=&quot;&quot;&gt;errback&nbsp;on&nbsp;the&nbsp;Protocol&nbsp;method&nbsp;-&nbsp;whose&nbsp;responsibility&nbsp;is&nbsp;it&nbsp;to&nbsp;call&lt;br&nbsp;class=&quot;&quot;&gt;this?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;It's&nbsp;the&nbsp;framework's&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;it.&nbsp;&nbsp;You&nbsp;should&nbsp;not&nbsp;call&nbsp;it&nbsp;yourself.&nbsp;&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;Your&lt;/i&gt;&nbsp;Protocol's&nbsp;connectionLost&nbsp;isn't&nbsp;going&nbsp;to&nbsp;bubble&nbsp;up&nbsp;to&nbsp;ClientService&nbsp;anyway;&nbsp;you'd&nbsp;have&nbsp;to&nbsp;call&nbsp;your&nbsp;wrapper's&nbsp;connectionLost,&nbsp;which&nbsp;would&nbsp;confuse&nbsp;its&nbsp;internal&nbsp;state,&nbsp;since&nbsp;the&nbsp;framework&nbsp;would&nbsp;call&nbsp;it&nbsp;again&nbsp;right&nbsp;afterwards,&nbsp;and&nbsp;we&nbsp;definitely&nbsp;don't&nbsp;have&nbsp;test&nbsp;coverage&nbsp;for&nbsp;that,&nbsp;since&nbsp;the&nbsp;framework&nbsp;will&nbsp;normally&nbsp;only&nbsp;call&nbsp;it&nbsp;once.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;right&nbsp;way&nbsp;to&nbsp;handle&nbsp;this&nbsp;would&nbsp;be&nbsp;to&nbsp;introduce&nbsp;a&nbsp;delay&nbsp;between&nbsp;re-tries.&nbsp;&nbsp;It's&nbsp;generally&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;have&nbsp;such&nbsp;a&nbsp;delay&nbsp;for&nbsp;lots&nbsp;of&nbsp;reasons;&nbsp;you&nbsp;don't&nbsp;want&nbsp;to&nbsp;overload&nbsp;your&nbsp;peer&nbsp;in&nbsp;the&nbsp;case&nbsp;of&nbsp;a&nbsp;transient&nbsp;failure.&nbsp;&nbsp;As&nbsp;a&nbsp;bonus,&nbsp;the&nbsp;fact&nbsp;that&nbsp;you've&nbsp;gone&nbsp;back&nbsp;up&nbsp;to&nbsp;the&nbsp;reactor&nbsp;loop&nbsp;to&nbsp;wait&nbsp;a&nbsp;while&nbsp;means&nbsp;that&nbsp;the&nbsp;transport&nbsp;will&nbsp;be&nbsp;properly&nbsp;disconnected&nbsp;and&nbsp;whenConnected()&nbsp;will&nbsp;do&nbsp;what&nbsp;you&nbsp;want.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;Before&nbsp;I&nbsp;got&nbsp;on&nbsp;this&nbsp;mailing&nbsp;list&nbsp;I&nbsp;posted&nbsp;this&nbsp;Q&nbsp;to&nbsp;stackoverflow&lt;br&nbsp;class=&quot;&quot;&gt;with&nbsp;some&nbsp;example&nbsp;code:&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://stackoverflow.com/q/37061807/3448214&quot;&nbsp;class=&quot;&quot;&gt;http://stackoverflow.com/q/37061807/3448214&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;but&nbsp;no&nbsp;solution&nbsp;or&nbsp;much&nbsp;attention&nbsp;there&nbsp;yet.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;As&nbsp;I&nbsp;say&nbsp;there,&nbsp;I&nbsp;realize&nbsp;I&nbsp;have&nbsp;probably&nbsp;just&nbsp;made&nbsp;a&nbsp;bad&nbsp;pattern&lt;br&nbsp;class=&quot;&quot;&gt;choice&nbsp;for&nbsp;how&nbsp;to&nbsp;use&nbsp;this&nbsp;API,&nbsp;but&nbsp;I&nbsp;have&nbsp;not&nbsp;been&nbsp;able&nbsp;to&nbsp;work&nbsp;out&nbsp;a&lt;br&nbsp;class=&quot;&quot;&gt;better&nbsp;choice&nbsp;which&nbsp;seems&nbsp;clean&nbsp;and&nbsp;fits&nbsp;my&nbsp;needs/understanding&nbsp;well.&lt;br&nbsp;class=&quot;&quot;&gt;I&nbsp;have&nbsp;tried&nbsp;deriving&nbsp;my&nbsp;own&nbsp;Protocol/Factory&nbsp;and&nbsp;handling&nbsp;the&nbsp;polling&lt;br&nbsp;class=&quot;&quot;&gt;there&nbsp;but&nbsp;this&nbsp;seems&nbsp;to&nbsp;get&nbsp;really&nbsp;messy&nbsp;once&nbsp;I&nbsp;start&nbsp;to&nbsp;add&nbsp;code&nbsp;to&lt;br&nbsp;class=&quot;&quot;&gt;get&nbsp;the&nbsp;collected&nbsp;data&nbsp;to&nbsp;a&nbsp;destination&nbsp;at&nbsp;that&nbsp;level,&nbsp;involving&lt;br&nbsp;class=&quot;&quot;&gt;giving&nbsp;the&nbsp;Protocol&nbsp;too&nbsp;much&nbsp;knowledge&nbsp;of&nbsp;how&nbsp;the&nbsp;data&nbsp;is&nbsp;to&nbsp;be&lt;br&nbsp;class=&quot;&quot;&gt;handled.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I&nbsp;am&nbsp;curious&nbsp;as&nbsp;to&nbsp;why&nbsp;you&nbsp;say&nbsp;that&nbsp;this&nbsp;is&nbsp;&quot;messy&quot;.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Honestly,&nbsp;this&nbsp;was&nbsp;just&nbsp;a&nbsp;gut&nbsp;feeling&nbsp;at&nbsp;the&nbsp;time,&nbsp;probably&nbsp;more&lt;br&nbsp;class=&quot;&quot;&gt;sourced&nbsp;in&nbsp;my&nbsp;implementation&nbsp;from&nbsp;lack&nbsp;of&nbsp;experience&nbsp;in&nbsp;using&nbsp;Twisted;&lt;br&nbsp;class=&quot;&quot;&gt;after&nbsp;reading&nbsp;around&nbsp;the&nbsp;subject,&nbsp;looking&nbsp;at&nbsp;many&nbsp;more&nbsp;examples,&nbsp;and&lt;br&nbsp;class=&quot;&quot;&gt;your&nbsp;advice,&nbsp;I&nbsp;think&nbsp;I&nbsp;am&nbsp;convinced&nbsp;I&nbsp;need&nbsp;to&nbsp;back&nbsp;to&nbsp;looking&nbsp;at&nbsp;my&lt;br&nbsp;class=&quot;&quot;&gt;own&nbsp;Protocol&nbsp;derived&nbsp;from&nbsp;the&nbsp;pymodbus&nbsp;one&nbsp;with&nbsp;a&nbsp;Factory&nbsp;that&lt;br&nbsp;class=&quot;&quot;&gt;contains&nbsp;the&nbsp;persistent&nbsp;config&nbsp;and&nbsp;access&nbsp;to&nbsp;an&nbsp;interface&nbsp;to&nbsp;pump&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;polled&nbsp;data&nbsp;upstream.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;Any&nbsp;advice,&nbsp;good&nbsp;patterns,&nbsp;or&nbsp;pointers&nbsp;to&nbsp;other&nbsp;projects&nbsp;which&nbsp;do&lt;br&nbsp;class=&quot;&quot;&gt;something&nbsp;similar&nbsp;is&nbsp;appreciated,&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I&nbsp;spent&nbsp;a&nbsp;while&nbsp;thinking&nbsp;about&nbsp;your&nbsp;question,&nbsp;and&nbsp;I'm&nbsp;sorry&nbsp;that&nbsp;I&nbsp;can't&nbsp;give&lt;br&nbsp;class=&quot;&quot;&gt;a&nbsp;more&nbsp;thorough&nbsp;answer,&nbsp;but&nbsp;I&nbsp;think&nbsp;you&nbsp;need&nbsp;to&nbsp;be&nbsp;a&nbsp;bit&nbsp;more&nbsp;specific&lt;br&nbsp;class=&quot;&quot;&gt;about&nbsp;what&nbsp;it&nbsp;is&nbsp;you&nbsp;don't&nbsp;like&nbsp;about&nbsp;your&nbsp;potential&nbsp;solution.&nbsp;&nbsp;It&nbsp;seems&nbsp;to&nbsp;me&lt;br&nbsp;class=&quot;&quot;&gt;that&nbsp;having&nbsp;a&nbsp;delegating&nbsp;Factory,&nbsp;especially&nbsp;if&nbsp;all&nbsp;you&nbsp;need&nbsp;to&nbsp;do&nbsp;is&nbsp;set&nbsp;up&lt;br&nbsp;class=&quot;&quot;&gt;some&nbsp;state&nbsp;on&nbsp;each&nbsp;Protocol&nbsp;that&nbsp;gets&nbsp;produced,&nbsp;should&nbsp;be&nbsp;sufficient...&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Looking&nbsp;at&nbsp;the&nbsp;code&nbsp;again&nbsp;I&nbsp;think&nbsp;it&nbsp;just&nbsp;seemed&nbsp;to&nbsp;make&nbsp;sense&nbsp;to&nbsp;me&lt;br&nbsp;class=&quot;&quot;&gt;at&nbsp;the&nbsp;time&nbsp;to&nbsp;have&nbsp;something&nbsp;that&nbsp;is&nbsp;(or&nbsp;has)&nbsp;a&nbsp;ClientService&nbsp;be&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;object&nbsp;I&nbsp;am&nbsp;calling&nbsp;a&nbsp;DataSource&nbsp;have&nbsp;more&nbsp;control&nbsp;over&nbsp;when&nbsp;it&nbsp;polls&lt;br&nbsp;class=&quot;&quot;&gt;that&nbsp;data&nbsp;and&nbsp;what&nbsp;it&nbsp;does&nbsp;with&nbsp;it&nbsp;-&nbsp;and&nbsp;not&nbsp;to&nbsp;have&nbsp;to&nbsp;make&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;Protocol&nbsp;and&nbsp;its&nbsp;Factory&nbsp;aware&nbsp;of&nbsp;this&nbsp;at&nbsp;all.&nbsp;Does&nbsp;that&nbsp;make&nbsp;it&nbsp;any&lt;br&nbsp;class=&quot;&quot;&gt;clearer?&nbsp;I&nbsp;am&nbsp;happy&nbsp;to&nbsp;push&nbsp;ahead&nbsp;with&nbsp;building&nbsp;this&nbsp;into&nbsp;my&lt;br&nbsp;class=&quot;&quot;&gt;Factory/Protocol&nbsp;if&nbsp;that&nbsp;is&nbsp;more&nbsp;normal&nbsp;usage&nbsp;for&nbsp;Twisted&nbsp;as&nbsp;I&nbsp;am&nbsp;sure&lt;br&nbsp;class=&quot;&quot;&gt;there&nbsp;will&nbsp;be&nbsp;benefits&nbsp;of&nbsp;encapsulating&nbsp;it&nbsp;here&nbsp;beyond&nbsp;the&nbsp;other&nbsp;side&lt;br&nbsp;class=&quot;&quot;&gt;I&nbsp;was&nbsp;seeing&nbsp;during&nbsp;that&nbsp;moment&nbsp;of&nbsp;confusion.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Thanks&nbsp;for&nbsp;the&nbsp;advice,&nbsp;I&nbsp;think&nbsp;it&nbsp;was&nbsp;enough&nbsp;to&nbsp;nudge&nbsp;me&nbsp;in&nbsp;a&lt;br&nbsp;class=&quot;&quot;&gt;direction&nbsp;that&nbsp;will&nbsp;work&nbsp;better&nbsp;to&nbsp;get&nbsp;me&nbsp;going,&nbsp;and&nbsp;if&nbsp;with&nbsp;more&lt;br&nbsp;class=&quot;&quot;&gt;experience&nbsp;other&nbsp;usage&nbsp;makes&nbsp;more&nbsp;sense&nbsp;I&nbsp;can&nbsp;always&nbsp;refactor,&lt;br&nbsp;class=&quot;&quot;&gt;refactor,&nbsp;refactor&nbsp;:)&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Yup!&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Happy&nbsp;to&nbsp;help,&nbsp;sorry&nbsp;for&nbsp;the&nbsp;super&nbsp;long&nbsp;lag&nbsp;time&nbsp;on&nbsp;this&nbsp;reply,&nbsp;but&nbsp;my&nbsp;email&nbsp;queue&nbsp;has&nbsp;been&nbsp;pretty&nbsp;full&nbsp;lately&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
