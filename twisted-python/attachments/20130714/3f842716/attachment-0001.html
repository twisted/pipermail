<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=iso-8859-1&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;div&gt;First&nbsp;off,&nbsp;hi&nbsp;Harry!&nbsp;&nbsp;I&nbsp;am&nbsp;super&nbsp;glad&nbsp;that&nbsp;someone&nbsp;has&nbsp;taken&nbsp;an&nbsp;interest&nbsp;in&nbsp;this.&nbsp;&nbsp;Please&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;I&nbsp;can&nbsp;be&nbsp;helpful&nbsp;in&nbsp;your&nbsp;effort&nbsp;to&nbsp;fix&nbsp;this.&nbsp;&nbsp;FilePath&nbsp;totally&nbsp;has&nbsp;the&nbsp;right&nbsp;sort&nbsp;of&nbsp;shape&nbsp;to&nbsp;handle&nbsp;all&nbsp;these&nbsp;problems&nbsp;very&nbsp;gracefully,&nbsp;but&nbsp;its&nbsp;current&nbsp;implementation&nbsp;is&nbsp;(as&nbsp;you&nbsp;have&nbsp;noticed!)&nbsp;a&nbsp;disaster,&nbsp;regardless&nbsp;of&nbsp;python&nbsp;2/3&nbsp;issues,&nbsp;it&nbsp;doesn't&nbsp;handle&nbsp;text/bytes&nbsp;correctly&nbsp;on&nbsp;python&nbsp;2.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;sorry&nbsp;for&nbsp;being&nbsp;a&nbsp;bit&nbsp;late&nbsp;to&nbsp;the&nbsp;party,&nbsp;been&nbsp;on&nbsp;vacation&nbsp;for&nbsp;a&nbsp;week&nbsp;:-).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Jul&nbsp;14,&nbsp;2013,&nbsp;at&nbsp;7:18&nbsp;AM,&nbsp;Harry&nbsp;Bock&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:bock.harryw@gmail.com&quot;&gt;bock.harryw@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Jul&nbsp;14,&nbsp;2013&nbsp;at&nbsp;8:16&nbsp;AM,&nbsp;Itamar&nbsp;Turner-Trauring&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:itamar@itamarst.org&quot;&nbsp;target=&quot;_blank&quot;&gt;itamar@itamarst.org&lt;/a&gt;&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;07/13/2013&nbsp;10:00&nbsp;PM,&nbsp;Harry&nbsp;Bock&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&quot;&gt;Hi&nbsp;all,&lt;br&gt;&lt;br&gt;My&nbsp;name&nbsp;is&nbsp;Harry&nbsp;Bock.&nbsp;&nbsp;I'm&nbsp;interested&nbsp;in&nbsp;helping&nbsp;out&nbsp;porting&nbsp;Twisted&nbsp;to&nbsp;Python&nbsp;3,&nbsp;and&nbsp;I've&nbsp;popped&nbsp;in&nbsp;IRC&nbsp;a&nbsp;few&nbsp;times&nbsp;to&nbsp;introduce&nbsp;myself&nbsp;and&nbsp;ask&nbsp;a&nbsp;few&nbsp;questions.&nbsp;A&nbsp;few&nbsp;developers&nbsp;agreed&nbsp;that&nbsp;working&nbsp;on&nbsp;trial&nbsp;dependencies&nbsp;would&nbsp;be&nbsp;a&nbsp;big&nbsp;help.&lt;br&gt;&lt;br&gt;In&nbsp;doing&nbsp;some&nbsp;porting&nbsp;work&nbsp;on&nbsp;trial,&nbsp;I&nbsp;stumbled&nbsp;upon&nbsp;a&nbsp;previous&nbsp;porting&nbsp;effort&nbsp;(possibly&nbsp;by&nbsp;Itamar?)&nbsp;for&nbsp;twisted.python.filepath&nbsp;and&nbsp;related&nbsp;modules.&nbsp;&nbsp;It&nbsp;seemed&nbsp;like&nbsp;the&nbsp;porting&nbsp;effort&nbsp;included&nbsp;forcing&nbsp;all&nbsp;pathname&nbsp;inputs&nbsp;to&nbsp;be&nbsp;byte&nbsp;strings&nbsp;instead&nbsp;of&nbsp;native&nbsp;strings.&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;You&nbsp;imply&nbsp;that&nbsp;this&nbsp;was&nbsp;a&nbsp;change,&nbsp;somehow,&nbsp;but&nbsp;it&nbsp;wasn't.&nbsp;The&nbsp;API&nbsp;was&nbsp;*always*&nbsp;bytes&nbsp;and&nbsp;it&nbsp;continues&nbsp;to&nbsp;be&nbsp;bytes&nbsp;on&nbsp;Python&nbsp;3.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ah,&nbsp;I&nbsp;understand&nbsp;now.&nbsp;&nbsp;Since&nbsp;the&nbsp;native&nbsp;string&nbsp;type&nbsp;was&nbsp;used&nbsp;in&nbsp;Python&nbsp;2,&nbsp;it&nbsp;follows&nbsp;that&nbsp;in&nbsp;Python&nbsp;3&nbsp;the&nbsp;API&nbsp;should&nbsp;be&nbsp;bytes.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;doesn't&nbsp;really&nbsp;make&nbsp;sense&nbsp;to&nbsp;talk&nbsp;about&nbsp;&quot;native&nbsp;strings&quot;&nbsp;unless&nbsp;you're&nbsp;talking&nbsp;about&nbsp;Python&nbsp;code&nbsp;objects;&nbsp;__doc__&nbsp;and&nbsp;func_name&nbsp;are&nbsp;&quot;native&nbsp;strings&quot;;&nbsp;the&nbsp;inputs&nbsp;to&nbsp;FilePath&nbsp;are&nbsp;bytes,&nbsp;pure&nbsp;and&nbsp;simple.&nbsp;&nbsp;This&nbsp;is&nbsp;mostly&nbsp;just&nbsp;because&nbsp;FilePath&nbsp;was&nbsp;designed&nbsp;way&nbsp;back&nbsp;when&nbsp;I&nbsp;only&nbsp;really&nbsp;knew&nbsp;about&nbsp;the&nbsp;way&nbsp;path&nbsp;names&nbsp;worked&nbsp;on&nbsp;Linux.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Among&nbsp;several&nbsp;of&nbsp;the&nbsp;design&nbsp;errors&nbsp;in&nbsp;Python&nbsp;3's&nbsp;allegedly&nbsp;superior&nbsp;unicode&nbsp;support&nbsp;was&nbsp;to&nbsp;call&nbsp;the&nbsp;text&nbsp;type&nbsp;&quot;str&quot;,&nbsp;when&nbsp;this&nbsp;was&nbsp;a&nbsp;confusing&nbsp;name&nbsp;in&nbsp;the&nbsp;first&nbsp;place,&nbsp;and&nbsp;is&nbsp;now&nbsp;ambiguous,&nbsp;confusing,&nbsp;and&nbsp;arguably&nbsp;wrong&nbsp;all&nbsp;at&nbsp;once;&nbsp;at&nbsp;the&nbsp;cost&nbsp;of&nbsp;one&nbsp;additional&nbsp;letter,&nbsp;it&nbsp;could&nbsp;have&nbsp;been&nbsp;&quot;text&quot;,&nbsp;which&nbsp;is&nbsp;both&nbsp;a&nbsp;whole&nbsp;word&nbsp;and&nbsp;a&nbsp;more&nbsp;accurate&nbsp;description&nbsp;of&nbsp;what&nbsp;it&nbsp;does.&nbsp;&nbsp;I&nbsp;generally&nbsp;use&nbsp;&quot;text&quot;&nbsp;rather&nbsp;than&nbsp;&quot;string&quot;&nbsp;to&nbsp;describe&nbsp;the&nbsp;text&nbsp;type&nbsp;anyway,&nbsp;because&nbsp;it's&nbsp;a&nbsp;lot&nbsp;less&nbsp;ambiguous&nbsp;and&nbsp;requires&nbsp;less&nbsp;backtracking&nbsp;(&quot;oh&nbsp;I&nbsp;was&nbsp;talking&nbsp;about&nbsp;python&nbsp;2&nbsp;there,&nbsp;let&nbsp;me&nbsp;rephrase&quot;).&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&quot;&gt;It's&nbsp;a&nbsp;common&nbsp;Python&nbsp;3&nbsp;porting&nbsp;mistake&nbsp;to&nbsp;change&nbsp;everything&nbsp;from&nbsp;bytes&nbsp;to&nbsp;unicode&nbsp;just&nbsp;because.&nbsp;E.g.&nbsp;Python&nbsp;standard&nbsp;library&nbsp;does&nbsp;this&nbsp;in&nbsp;many&nbsp;places&nbsp;for&nbsp;no&nbsp;good&nbsp;reason,&nbsp;resulting&nbsp;in&nbsp;bugs&nbsp;that&nbsp;are&nbsp;still&nbsp;being&nbsp;fixed&nbsp;(&lt;a&nbsp;href=&quot;http://bugs.python.org/issue12411&quot;&nbsp;target=&quot;_blank&quot;&gt;http://bugs.python.org/&lt;u&gt;&lt;/u&gt;issue12411&lt;/a&gt;)&nbsp;or&nbsp;APIs&nbsp;that&nbsp;are&nbsp;less&nbsp;useful&nbsp;(zipfile&nbsp;docs&nbsp;explicitly&nbsp;state&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;standard&nbsp;encoding&nbsp;in&nbsp;zip&nbsp;files,&nbsp;but&nbsp;Python&nbsp;3&nbsp;zipfile&nbsp;module&nbsp;only&nbsp;supports&nbsp;one&nbsp;specific&nbsp;encoding&nbsp;because&nbsp;they&nbsp;switched&nbsp;to&nbsp;Unicode&nbsp;and&nbsp;didn't&nbsp;bother&nbsp;reading&nbsp;the&nbsp;module's&nbsp;own&nbsp;docs).&nbsp;Our&nbsp;goal&nbsp;in&nbsp;porting&nbsp;was&nbsp;backwards&nbsp;compatibility&nbsp;with&nbsp;Python&nbsp;2&nbsp;code,&nbsp;so&nbsp;porters&nbsp;don't&nbsp;have&nbsp;to&nbsp;change&nbsp;everything,&nbsp;and&nbsp;correctness.&nbsp;And,&nbsp;in&nbsp;this&nbsp;particular&nbsp;case,&nbsp;to&nbsp;get&nbsp;something&nbsp;working&nbsp;in&nbsp;the&nbsp;minimal&nbsp;amount&nbsp;of&nbsp;time&nbsp;-&nbsp;*adding*&nbsp;Unicode&nbsp;support&nbsp;is&nbsp;useful&nbsp;and&nbsp;should&nbsp;be&nbsp;done.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&quot;&gt;After&nbsp;some&nbsp;investigation,&nbsp;I&nbsp;believe&nbsp;this&nbsp;is&nbsp;the&nbsp;wrong&nbsp;approach,&nbsp;but&nbsp;I&nbsp;wanted&nbsp;to&nbsp;start&nbsp;a&nbsp;discussion&nbsp;here&nbsp;first.&nbsp;&nbsp;Some&nbsp;thoughts:&lt;br&gt;&lt;br&gt;(a)&nbsp;As&nbsp;of&nbsp;Python&nbsp;3.3,&nbsp;use&nbsp;of&nbsp;the&nbsp;ANSI&nbsp;API&nbsp;in&nbsp;Windows&nbsp;is&nbsp;deprecated[1],&nbsp;so&nbsp;many&nbsp;functions&nbsp;in&nbsp;os&nbsp;and&nbsp;os.path&nbsp;raise&nbsp;DeprecationWarning&nbsp;when&nbsp;given&nbsp;byte&nbsp;strings&nbsp;as&nbsp;input.&nbsp;&nbsp;Although&nbsp;win32&nbsp;is&nbsp;not&nbsp;an&nbsp;initial&nbsp;target&nbsp;of&nbsp;the&nbsp;porting&nbsp;effort,&nbsp;we'll&nbsp;have&nbsp;to&nbsp;support&nbsp;it&nbsp;eventually&nbsp;and&nbsp;the&nbsp;API&nbsp;should&nbsp;be&nbsp;supported&nbsp;before&nbsp;then.&lt;br&gt;&lt;br&gt;(b)&nbsp;Misunderstandings&nbsp;at&nbsp;the&nbsp;application&nbsp;level&nbsp;about&nbsp;the&nbsp;underlying&nbsp;filesystem's&nbsp;path&nbsp;encoding&nbsp;is&nbsp;not&nbsp;the&nbsp;problem&nbsp;of&nbsp;the&nbsp;Twisted&nbsp;API.&nbsp;&nbsp;Correct&nbsp;me&nbsp;if&nbsp;I'm&nbsp;wrong,&nbsp;but&nbsp;that's&nbsp;the&nbsp;responsibility&nbsp;of&nbsp;the&nbsp;system&nbsp;administrator&nbsp;or&nbsp;individual&nbsp;user&nbsp;(at&nbsp;least&nbsp;on&nbsp;UNIX)&nbsp;to&nbsp;set&nbsp;the&nbsp;LANG&nbsp;environment&nbsp;variable,&nbsp;or&nbsp;for&nbsp;the&nbsp;application&nbsp;to&nbsp;call&nbsp;setlocale(3)&nbsp;to&nbsp;explicitly&nbsp;override&nbsp;it.&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;Given&nbsp;operating&nbsp;systems&nbsp;that&nbsp;don't&nbsp;really&nbsp;know&nbsp;about&nbsp;encodings&nbsp;on&nbsp;the&nbsp;filesystem&nbsp;level,&nbsp;forcing&nbsp;everything&nbsp;to&nbsp;be&nbsp;unicode&nbsp;doesn't&nbsp;make&nbsp;sense.&nbsp;I'm&nbsp;pretty&nbsp;sure&nbsp;you&nbsp;can&nbsp;end&nbsp;up&nbsp;with&nbsp;files&nbsp;in&nbsp;multiple&nbsp;different&nbsp;Unicode&nbsp;encodings&nbsp;on&nbsp;same&nbsp;filesystem&nbsp;on&nbsp;Linux,&nbsp;for&nbsp;example.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;very&nbsp;true&nbsp;and&nbsp;I&nbsp;didn't&nbsp;consider&nbsp;it&nbsp;in&nbsp;my&nbsp;initial&nbsp;investigation.&nbsp;&nbsp;While&nbsp;I&nbsp;think&nbsp;it&nbsp;would&nbsp;be&nbsp;uncommon&nbsp;to&nbsp;have&nbsp;files&nbsp;in&nbsp;multiple&nbsp;encodings&nbsp;on&nbsp;the&nbsp;same&nbsp;filesystem,&nbsp;it&nbsp;certainly&nbsp;would&nbsp;not&nbsp;be&nbsp;rare&nbsp;-&nbsp;to&nbsp;Tristan's&nbsp;point,&nbsp;copying&nbsp;names&nbsp;from&nbsp;filesystem&nbsp;to&nbsp;filesystem&nbsp;could&nbsp;easily&nbsp;result&nbsp;in&nbsp;multiple&nbsp;encodings.&nbsp;&nbsp;The&nbsp;operating&nbsp;system&nbsp;may&nbsp;not&nbsp;need&nbsp;to&nbsp;understand&nbsp;the&nbsp;encodings,&nbsp;but&nbsp;applications&nbsp;do&nbsp;to&nbsp;display&nbsp;them&nbsp;correctly,&nbsp;&nbsp;Which&nbsp;leads&nbsp;to&nbsp;your&nbsp;last&nbsp;point...&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;not&nbsp;really&nbsp;true.&nbsp;&nbsp;This&nbsp;is&nbsp;how&nbsp;Linux&nbsp;and&nbsp;BSD&nbsp;handle&nbsp;file&nbsp;names;&nbsp;it&nbsp;is&nbsp;not&nbsp;how&nbsp;OS&nbsp;X&nbsp;handle&nbsp;file&nbsp;names.&nbsp;&nbsp;(Nor&nbsp;is&nbsp;it&nbsp;how&nbsp;Windows&nbsp;works,&nbsp;as&nbsp;you've&nbsp;mentioned&nbsp;above.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;OS&nbsp;X,&nbsp;file&nbsp;names&nbsp;are&nbsp;normalized&nbsp;(I&nbsp;forget&nbsp;the&nbsp;normalization&nbsp;at&nbsp;the&nbsp;moment,&nbsp;but&nbsp;you&nbsp;can&nbsp;look&nbsp;it&nbsp;up)&nbsp;UTF-8.&nbsp;&nbsp;They&nbsp;_must_&nbsp;be&nbsp;normalized&nbsp;UTF-8;&nbsp;it&nbsp;doesn't&nbsp;matter&nbsp;what&nbsp;$LANG&nbsp;is.&nbsp;&nbsp;If&nbsp;you&nbsp;try&nbsp;to&nbsp;deal&nbsp;with&nbsp;filenames&nbsp;that&nbsp;are&nbsp;invalid&nbsp;UTF-8&nbsp;byte&nbsp;sequences,&nbsp;the&nbsp;OS&nbsp;will&nbsp;URL-encode&nbsp;portions&nbsp;of&nbsp;the&nbsp;filename&nbsp;for&nbsp;you&nbsp;and&nbsp;_force_&nbsp;its&nbsp;name&nbsp;(as&nbsp;returned&nbsp;by&nbsp;listdir()&nbsp;at&nbsp;least)&nbsp;to&nbsp;be&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.&nbsp;&nbsp;If&nbsp;you&nbsp;give&nbsp;it&nbsp;something&nbsp;non-normalized,&nbsp;it&nbsp;will&nbsp;normalize&nbsp;it&nbsp;for&nbsp;you.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&quot;&gt;Thus,&nbsp;my&nbsp;vote&nbsp;is&nbsp;that&nbsp;on&nbsp;Python&nbsp;2.x,&nbsp;Twisted&nbsp;should&nbsp;accept&nbsp;either&nbsp;the&nbsp;native&nbsp;str&nbsp;or&nbsp;unicode&nbsp;types&nbsp;for&nbsp;path&nbsp;names,&nbsp;and&nbsp;on&nbsp;Python&nbsp;3.x,&nbsp;only&nbsp;accept&nbsp;the&nbsp;str&nbsp;type&nbsp;to&nbsp;prevent&nbsp;deprecation&nbsp;issues&nbsp;with&nbsp;system&nbsp;calls.&nbsp;&nbsp;I&nbsp;have&nbsp;a&nbsp;patch&nbsp;set&nbsp;that&nbsp;will&nbsp;make&nbsp;this&nbsp;happen&nbsp;including&nbsp;unittest&nbsp;modifications;&nbsp;if&nbsp;there's&nbsp;a&nbsp;consensus&nbsp;I'm&nbsp;happy&nbsp;to&nbsp;open&nbsp;a&nbsp;ticket&nbsp;and&nbsp;submit&nbsp;the&nbsp;patches.&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;The&nbsp;ideal&nbsp;situation&nbsp;would&nbsp;be&nbsp;to&nbsp;support&nbsp;bytes&nbsp;and&nbsp;Unicode&nbsp;on&nbsp;Python&nbsp;2&nbsp;*and*&nbsp;Python&nbsp;3,&nbsp;for&nbsp;maximum&nbsp;compatibility.&nbsp;Even&nbsp;if&nbsp;deprecated&nbsp;on&nbsp;Windows,&nbsp;filesystem&nbsp;operations&nbsp;on&nbsp;Python&nbsp;3&nbsp;still&nbsp;do&nbsp;accept&nbsp;bytes&nbsp;(and&nbsp;they're&nbsp;not&nbsp;deprecated&nbsp;elsewhere).&nbsp;Given&nbsp;existing&nbsp;code&nbsp;that&nbsp;already&nbsp;takes&nbsp;bytes,&nbsp;switching&nbsp;to&nbsp;only&nbsp;doing&nbsp;Unicode&nbsp;on&nbsp;Python&nbsp;3&nbsp;would&nbsp;not&nbsp;be&nbsp;backwards&nbsp;compatible,&nbsp;so&nbsp;we&nbsp;can't&nbsp;really&nbsp;do&nbsp;that&nbsp;without&nbsp;a&nbsp;bunch&nbsp;of&nbsp;deprecation&nbsp;warnings&nbsp;and&nbsp;a&nbsp;few&nbsp;releases.&nbsp;Instead&nbsp;we&nbsp;should&nbsp;just&nbsp;do&nbsp;what&nbsp;Python&nbsp;does:&nbsp;if&nbsp;you&nbsp;start&nbsp;with&nbsp;bytes&nbsp;path&nbsp;you&nbsp;always&nbsp;get&nbsp;back&nbsp;bytes,&nbsp;if&nbsp;you&nbsp;start&nbsp;with&nbsp;Unicode&nbsp;path&nbsp;you&nbsp;always&nbsp;get&nbsp;back&nbsp;Unicode.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes,&nbsp;you're&nbsp;right,&nbsp;that's&nbsp;probably&nbsp;the&nbsp;best&nbsp;solution.&nbsp;&nbsp;It&nbsp;would&nbsp;not&nbsp;be&nbsp;terribly&nbsp;hard&nbsp;to&nbsp;do&nbsp;so&nbsp;-&nbsp;then&nbsp;application&nbsp;developers&nbsp;can&nbsp;choose&nbsp;whether&nbsp;to&nbsp;defer&nbsp;to&nbsp;the&nbsp;local&nbsp;user's&nbsp;interpretation&nbsp;of&nbsp;the&nbsp;setting,&nbsp;or&nbsp;explicitly&nbsp;use&nbsp;byte&nbsp;paths.&nbsp;&nbsp;Thanks&nbsp;so&nbsp;much&nbsp;for&nbsp;your&nbsp;input!&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;design&nbsp;should&nbsp;not&nbsp;be&nbsp;as&nbsp;naive&nbsp;as&nbsp;&quot;support&nbsp;bytes&quot;&nbsp;or&nbsp;&quot;support&nbsp;unicode&quot;,&nbsp;or&nbsp;even&nbsp;&quot;support&nbsp;both&quot;.&nbsp;&nbsp;In&nbsp;order&nbsp;to&nbsp;deal&nbsp;with&nbsp;some&nbsp;of&nbsp;these&nbsp;nastier&nbsp;edge-cases,&nbsp;you&nbsp;need&nbsp;a&nbsp;method&nbsp;that&nbsp;can&nbsp;give&nbsp;you&nbsp;a&nbsp;name&nbsp;to&nbsp;display&nbsp;to&nbsp;a&nbsp;user&nbsp;that's&nbsp;&quot;human&nbsp;readable&quot;,&nbsp;a&nbsp;weird-Python-broken-surrogates-trick&nbsp;unicode&nbsp;object,&nbsp;and&nbsp;some&nbsp;bytes.&nbsp;&nbsp;Then&nbsp;there's&nbsp;possibly&nbsp;some&nbsp;extra&nbsp;methods&nbsp;that&nbsp;could&nbsp;be&nbsp;added&nbsp;which&nbsp;are&nbsp;only&nbsp;sometimes&nbsp;available,&nbsp;like&nbsp;&quot;driveLetter()&quot;&nbsp;or&nbsp;somesuch.&nbsp;&nbsp;(Maybe&nbsp;we&nbsp;could&nbsp;do&nbsp;better&nbsp;and&nbsp;have&nbsp;some&nbsp;kind&nbsp;of&nbsp;general&nbsp;mount-point&nbsp;object,&nbsp;but&nbsp;I&nbsp;digress.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;other&nbsp;words,&nbsp;we&nbsp;need&nbsp;to&nbsp;give&nbsp;the&nbsp;developer&nbsp;an&nbsp;expressive&nbsp;enough&nbsp;API&nbsp;to&nbsp;clearly&nbsp;indicate&nbsp;their&nbsp;intent,&nbsp;and&nbsp;then&nbsp;have&nbsp;clear&nbsp;enough&nbsp;API&nbsp;documentation&nbsp;for&nbsp;them&nbsp;to&nbsp;figure&nbsp;out&nbsp;what&nbsp;their&nbsp;intent&nbsp;is&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;At&nbsp;the&nbsp;implementation&nbsp;level,&nbsp;these&nbsp;potential&nbsp;methods&nbsp;are&nbsp;both&nbsp;platform-specific&nbsp;and&nbsp;subtly&nbsp;distinctive.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;&quot;human&nbsp;readable&nbsp;name&quot;&nbsp;implementation&nbsp;of&nbsp;a&nbsp;broken&nbsp;FilePath&nbsp;should&nbsp;include&nbsp;replacement&nbsp;characters&nbsp;rather&nbsp;than&nbsp;broken-surrogate&nbsp;hacks.&nbsp;&nbsp;Replacement&nbsp;characters&nbsp;have&nbsp;a&nbsp;defined&nbsp;method&nbsp;for&nbsp;displaying&nbsp;them;&nbsp;since&nbsp;broken&nbsp;surrogates&nbsp;are&nbsp;just&nbsp;invalid&nbsp;garbage,&nbsp;some&nbsp;software&nbsp;might&nbsp;elect&nbsp;not&nbsp;to&nbsp;display&nbsp;the&nbsp;string&nbsp;at&nbsp;all,&nbsp;or&nbsp;throw&nbsp;an&nbsp;error.&nbsp;&nbsp;It&nbsp;might&nbsp;also&nbsp;be&nbsp;sensible&nbsp;(as&nbsp;a&nbsp;future&nbsp;enhancement,&nbsp;this&nbsp;is&nbsp;not&nbsp;something&nbsp;we&nbsp;should&nbsp;try&nbsp;to&nbsp;do&nbsp;as&nbsp;a&nbsp;basic&nbsp;part&nbsp;of&nbsp;proper&nbsp;unicode&nbsp;support)&nbsp;to&nbsp;do&nbsp;some&nbsp;encoding-guessing&nbsp;and&nbsp;mojibake&nbsp;detection&nbsp;when&nbsp;trying&nbsp;to&nbsp;compute&nbsp;the&nbsp;human-readable&nbsp;name,&nbsp;since&nbsp;this&nbsp;name&nbsp;is&nbsp;just&nbsp;for&nbsp;display&nbsp;and&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;work&nbsp;as&nbsp;hard&nbsp;as&nbsp;possible&nbsp;to&nbsp;display&nbsp;something&nbsp;sensible,&nbsp;since&nbsp;it&nbsp;does&nbsp;NOT&nbsp;need&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;be&nbsp;fed&nbsp;back&nbsp;in&nbsp;to&nbsp;FilePath.&nbsp;&nbsp;But&nbsp;of&nbsp;course&nbsp;on&nbsp;OS&nbsp;X,&nbsp;the&nbsp;thing&nbsp;to&nbsp;do&nbsp;would&nbsp;just&nbsp;be&nbsp;to&nbsp;convert&nbsp;to&nbsp;the&nbsp;percent-escaped&nbsp;version,&nbsp;since&nbsp;that's&nbsp;what&nbsp;the&nbsp;platform&nbsp;presents.&nbsp;&nbsp;And&nbsp;on&nbsp;Windows,&nbsp;it&nbsp;might&nbsp;be&nbsp;sensible&nbsp;for&nbsp;the&nbsp;thing&nbsp;that&nbsp;gives&nbsp;you&nbsp;bytes&nbsp;to&nbsp;give&nbsp;you&nbsp;a&nbsp;faithful&nbsp;UTF-8&nbsp;version&nbsp;of&nbsp;the&nbsp;filename&nbsp;rather&nbsp;than&nbsp;some&nbsp;platform-dependent&nbsp;ANSI&nbsp;junk,&nbsp;since&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;tell&nbsp;there's&nbsp;no&nbsp;need&nbsp;to&nbsp;ever&nbsp;get&nbsp;a&nbsp;byte&nbsp;sequence&nbsp;you&nbsp;could&nbsp;pass&nbsp;back&nbsp;to&nbsp;some&nbsp;other&nbsp;ANSI&nbsp;API.&nbsp;&nbsp;If&nbsp;it&nbsp;were,&nbsp;that&nbsp;could&nbsp;be&nbsp;an&nbsp;explicitly&nbsp;separate&nbsp;API.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Finally,&nbsp;the&nbsp;fact&nbsp;that&nbsp;FilePath&nbsp;exposes&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;the&nbsp;path&nbsp;(as&nbsp;&quot;.path&quot;)&nbsp;is&nbsp;sort&nbsp;of&nbsp;a&nbsp;design&nbsp;error,&nbsp;and&nbsp;we&nbsp;should&nbsp;eventually&nbsp;deprecate&nbsp;that&nbsp;attribute,&nbsp;since&nbsp;there&nbsp;are&nbsp;multiple&nbsp;use-cases&nbsp;you&nbsp;might&nbsp;want&nbsp;that&nbsp;string&nbsp;for&nbsp;and&nbsp;we&nbsp;should&nbsp;return&nbsp;the&nbsp;appropriate&nbsp;version&nbsp;depending&nbsp;on&nbsp;which&nbsp;one&nbsp;you&nbsp;want.&nbsp;&nbsp;I&nbsp;wouldn't&nbsp;worry&nbsp;about&nbsp;getting&nbsp;that&nbsp;attribute&nbsp;to&nbsp;do&nbsp;anything&nbsp;useful&nbsp;beyond&nbsp;a&nbsp;very&nbsp;rudimentary&nbsp;level&nbsp;of&nbsp;compatibility;&nbsp;in&nbsp;fact&nbsp;it&nbsp;would&nbsp;be&nbsp;great&nbsp;if&nbsp;the&nbsp;internal&nbsp;storage&nbsp;of&nbsp;the&nbsp;path&nbsp;were&nbsp;always&nbsp;unicode&nbsp;on&nbsp;Windows&nbsp;and&nbsp;always&nbsp;bytes&nbsp;on&nbsp;UNIX-ish&nbsp;platforms,&nbsp;and&nbsp;&quot;.path&quot;&nbsp;were&nbsp;just&nbsp;a&nbsp;proxy&nbsp;that&nbsp;always&nbsp;gave&nbsp;you&nbsp;bytes.&nbsp;&nbsp;(Although&nbsp;possibly&nbsp;the&nbsp;internal&nbsp;representation&nbsp;should&nbsp;just&nbsp;be&nbsp;unicode&nbsp;too&nbsp;on&nbsp;OS&nbsp;X,&nbsp;I&nbsp;keep&nbsp;finding&nbsp;myself&nbsp;on&nbsp;the&nbsp;fence&nbsp;about&nbsp;that.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;Is&nbsp;this&nbsp;something&nbsp;I&nbsp;can&nbsp;open&nbsp;a&nbsp;ticket&nbsp;for?&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hopefully&nbsp;the&nbsp;existing&nbsp;ticket&nbsp;is&nbsp;sufficient,&nbsp;but,&nbsp;open&nbsp;as&nbsp;many&nbsp;as&nbsp;you&nbsp;need&nbsp;:).&nbsp;&nbsp;There&nbsp;might&nbsp;be&nbsp;a&nbsp;bunch&nbsp;of&nbsp;methods&nbsp;that&nbsp;need&nbsp;modification&nbsp;here,&nbsp;and&nbsp;at&nbsp;least&nbsp;e.g.&nbsp;the&nbsp;ZipPath&nbsp;work&nbsp;could&nbsp;be&nbsp;done&nbsp;separately.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
