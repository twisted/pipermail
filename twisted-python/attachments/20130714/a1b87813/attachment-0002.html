<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Jul&nbsp;14,&nbsp;2013&nbsp;at&nbsp;8:16&nbsp;AM,&nbsp;Itamar&nbsp;Turner-Trauring&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:itamar@itamarst.org&quot;&nbsp;target=&quot;_blank&quot;&gt;itamar@itamarst.org&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;07/13/2013&nbsp;10:00&nbsp;PM,&nbsp;Harry&nbsp;Bock&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi&nbsp;all,&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;name&nbsp;is&nbsp;Harry&nbsp;Bock.&nbsp; I&#39;m&nbsp;interested&nbsp;in&nbsp;helping&nbsp;out&nbsp;porting&nbsp;Twisted&nbsp;to&nbsp;Python&nbsp;3,&nbsp;and&nbsp;I&#39;ve&nbsp;popped&nbsp;in&nbsp;IRC&nbsp;a&nbsp;few&nbsp;times&nbsp;to&nbsp;introduce&nbsp;myself&nbsp;and&nbsp;ask&nbsp;a&nbsp;few&nbsp;questions.&nbsp;A&nbsp;few&nbsp;developers&nbsp;agreed&nbsp;that&nbsp;working&nbsp;on&nbsp;trial&nbsp;dependencies&nbsp;would&nbsp;be&nbsp;a&nbsp;big&nbsp;help.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
In&nbsp;doing&nbsp;some&nbsp;porting&nbsp;work&nbsp;on&nbsp;trial,&nbsp;I&nbsp;stumbled&nbsp;upon&nbsp;a&nbsp;previous&nbsp;porting&nbsp;effort&nbsp;(possibly&nbsp;by&nbsp;Itamar?)&nbsp;for&nbsp;twisted.python.filepath&nbsp;and&nbsp;related&nbsp;modules.&nbsp; It&nbsp;seemed&nbsp;like&nbsp;the&nbsp;porting&nbsp;effort&nbsp;included&nbsp;forcing&nbsp;all&nbsp;pathname&nbsp;inputs&nbsp;to&nbsp;be&nbsp;byte&nbsp;strings&nbsp;instead&nbsp;of&nbsp;native&nbsp;strings.&lt;br&gt;<br>
<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
You&nbsp;imply&nbsp;that&nbsp;this&nbsp;was&nbsp;a&nbsp;change,&nbsp;somehow,&nbsp;but&nbsp;it&nbsp;wasn&#39;t.&nbsp;The&nbsp;API&nbsp;was&nbsp;*always*&nbsp;bytes&nbsp;and&nbsp;it&nbsp;continues&nbsp;to&nbsp;be&nbsp;bytes&nbsp;on&nbsp;Python&nbsp;3.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ah,&nbsp;I&nbsp;understand&nbsp;now. &nbsp;Since&nbsp;the&nbsp;native&nbsp;string&nbsp;type&nbsp;was&nbsp;used&nbsp;in&nbsp;Python&nbsp;2,&nbsp;it&nbsp;follows&nbsp;that&nbsp;in&nbsp;Python&nbsp;3&nbsp;the&nbsp;API&nbsp;should&nbsp;be&nbsp;bytes.&lt;br&gt;<br>
 &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
It&#39;s&nbsp;a&nbsp;common&nbsp;Python&nbsp;3&nbsp;porting&nbsp;mistake&nbsp;to&nbsp;change&nbsp;everything&nbsp;from&nbsp;bytes&nbsp;to&nbsp;unicode&nbsp;just&nbsp;because.&nbsp;E.g.&nbsp;Python&nbsp;standard&nbsp;library&nbsp;does&nbsp;this&nbsp;in&nbsp;many&nbsp;places&nbsp;for&nbsp;no&nbsp;good&nbsp;reason,&nbsp;resulting&nbsp;in&nbsp;bugs&nbsp;that&nbsp;are&nbsp;still&nbsp;being&nbsp;fixed&nbsp;(&lt;a&nbsp;href=&quot;http://bugs.python.org/issue12411&quot;&nbsp;target=&quot;_blank&quot;&gt;http://bugs.python.org/&lt;u&gt;&lt;/u&gt;issue12411&lt;/a&gt;)&nbsp;or&nbsp;APIs&nbsp;that&nbsp;are&nbsp;less&nbsp;useful&nbsp;(zipfile&nbsp;docs&nbsp;explicitly&nbsp;state&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;standard&nbsp;encoding&nbsp;in&nbsp;zip&nbsp;files,&nbsp;but&nbsp;Python&nbsp;3&nbsp;zipfile&nbsp;module&nbsp;only&nbsp;supports&nbsp;one&nbsp;specific&nbsp;encoding&nbsp;because&nbsp;they&nbsp;switched&nbsp;to&nbsp;Unicode&nbsp;and&nbsp;didn&#39;t&nbsp;bother&nbsp;reading&nbsp;the&nbsp;module&#39;s&nbsp;own&nbsp;docs).&nbsp;Our&nbsp;goal&nbsp;in&nbsp;porting&nbsp;was&nbsp;backwards&nbsp;compatibility&nbsp;with&nbsp;Python&nbsp;2&nbsp;code,&nbsp;so&nbsp;porters&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;change&nbsp;everything,&nbsp;and&nbsp;correctness.&nbsp;And,&nbsp;in&nbsp;this&nbsp;particular&nbsp;case,&nbsp;to&nbsp;get&nbsp;something&nbsp;working&nbsp;in&nbsp;the&nbsp;minimal&nbsp;amount&nbsp;of&nbsp;time&nbsp;-&nbsp;*adding*&nbsp;Unicode&nbsp;support&nbsp;is&nbsp;useful&nbsp;and&nbsp;should&nbsp;be&nbsp;done.&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
After&nbsp;some&nbsp;investigation,&nbsp;I&nbsp;believe&nbsp;this&nbsp;is&nbsp;the&nbsp;wrong&nbsp;approach,&nbsp;but&nbsp;I&nbsp;wanted&nbsp;to&nbsp;start&nbsp;a&nbsp;discussion&nbsp;here&nbsp;first.&nbsp; Some&nbsp;thoughts:&lt;br&gt;<br>
&lt;br&gt;<br>
(a)&nbsp;As&nbsp;of&nbsp;Python&nbsp;3.3,&nbsp;use&nbsp;of&nbsp;the&nbsp;ANSI&nbsp;API&nbsp;in&nbsp;Windows&nbsp;is&nbsp;deprecated[1],&nbsp;so&nbsp;many&nbsp;functions&nbsp;in&nbsp;os&nbsp;and&nbsp;os.path&nbsp;raise&nbsp;DeprecationWarning&nbsp;when&nbsp;given&nbsp;byte&nbsp;strings&nbsp;as&nbsp;input.&nbsp; Although&nbsp;win32&nbsp;is&nbsp;not&nbsp;an&nbsp;initial&nbsp;target&nbsp;of&nbsp;the&nbsp;porting&nbsp;effort,&nbsp;we&#39;ll&nbsp;have&nbsp;to&nbsp;support&nbsp;it&nbsp;eventually&nbsp;and&nbsp;the&nbsp;API&nbsp;should&nbsp;be&nbsp;supported&nbsp;before&nbsp;then.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
(b)&nbsp;Misunderstandings&nbsp;at&nbsp;the&nbsp;application&nbsp;level&nbsp;about&nbsp;the&nbsp;underlying&nbsp;filesystem&#39;s&nbsp;path&nbsp;encoding&nbsp;is&nbsp;not&nbsp;the&nbsp;problem&nbsp;of&nbsp;the&nbsp;Twisted&nbsp;API.&nbsp; Correct&nbsp;me&nbsp;if&nbsp;I&#39;m&nbsp;wrong,&nbsp;but&nbsp;that&#39;s&nbsp;the&nbsp;responsibility&nbsp;of&nbsp;the&nbsp;system&nbsp;administrator&nbsp;or&nbsp;individual&nbsp;user&nbsp;(at&nbsp;least&nbsp;on&nbsp;UNIX)&nbsp;to&nbsp;set&nbsp;the&nbsp;LANG&nbsp;environment&nbsp;variable,&nbsp;or&nbsp;for&nbsp;the&nbsp;application&nbsp;to&nbsp;call&nbsp;setlocale(3)&nbsp;to&nbsp;explicitly&nbsp;override&nbsp;it.&lt;br&gt;<br>
<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
Given&nbsp;operating&nbsp;systems&nbsp;that&nbsp;don&#39;t&nbsp;really&nbsp;know&nbsp;about&nbsp;encodings&nbsp;on&nbsp;the&nbsp;filesystem&nbsp;level,&nbsp;forcing&nbsp;everything&nbsp;to&nbsp;be&nbsp;unicode&nbsp;doesn&#39;t&nbsp;make&nbsp;sense.&nbsp;I&#39;m&nbsp;pretty&nbsp;sure&nbsp;you&nbsp;can&nbsp;end&nbsp;up&nbsp;with&nbsp;files&nbsp;in&nbsp;multiple&nbsp;different&nbsp;Unicode&nbsp;encodings&nbsp;on&nbsp;same&nbsp;filesystem&nbsp;on&nbsp;Linux,&nbsp;for&nbsp;example.&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;very&nbsp;true&nbsp;and&nbsp;I&nbsp;didn&#39;t&nbsp;consider&nbsp;it&nbsp;in&nbsp;my&nbsp;initial&nbsp;investigation. &nbsp;While&nbsp;I&nbsp;think&nbsp;it&nbsp;would&nbsp;be&nbsp;uncommon&nbsp;to&nbsp;have&nbsp;files&nbsp;in&nbsp;multiple&nbsp;encodings&nbsp;on&nbsp;the&nbsp;same&nbsp;filesystem,&nbsp;it&nbsp;certainly&nbsp;would&nbsp;not&nbsp;be&nbsp;rare&nbsp;-&nbsp;to&nbsp;Tristan&#39;s&nbsp;point,&nbsp;copying&nbsp;names&nbsp;from&nbsp;filesystem&nbsp;to&nbsp;filesystem&nbsp;could&nbsp;easily&nbsp;result&nbsp;in&nbsp;multiple&nbsp;encodings. &nbsp;The&nbsp;operating&nbsp;system&nbsp;may&nbsp;not&nbsp;need&nbsp;to&nbsp;understand&nbsp;the&nbsp;encodings,&nbsp;but&nbsp;applications&nbsp;do&nbsp;to&nbsp;display&nbsp;them&nbsp;correctly, &nbsp;Which&nbsp;leads&nbsp;to&nbsp;your&nbsp;last&nbsp;point...&lt;br&gt;<br>
&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Thus,&nbsp;my&nbsp;vote&nbsp;is&nbsp;that&nbsp;on&nbsp;Python&nbsp;2.x,&nbsp;Twisted&nbsp;should&nbsp;accept&nbsp;either&nbsp;the&nbsp;native&nbsp;str&nbsp;or&nbsp;unicode&nbsp;types&nbsp;for&nbsp;path&nbsp;names,&nbsp;and&nbsp;on&nbsp;Python&nbsp;3.x,&nbsp;only&nbsp;accept&nbsp;the&nbsp;str&nbsp;type&nbsp;to&nbsp;prevent&nbsp;deprecation&nbsp;issues&nbsp;with&nbsp;system&nbsp;calls.&nbsp; I&nbsp;have&nbsp;a&nbsp;patch&nbsp;set&nbsp;that&nbsp;will&nbsp;make&nbsp;this&nbsp;happen&nbsp;including&nbsp;unittest&nbsp;modifications;&nbsp;if&nbsp;there&#39;s&nbsp;a&nbsp;consensus&nbsp;I&#39;m&nbsp;happy&nbsp;to&nbsp;open&nbsp;a&nbsp;ticket&nbsp;and&nbsp;submit&nbsp;the&nbsp;patches.&lt;br&gt;<br>
<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
The&nbsp;ideal&nbsp;situation&nbsp;would&nbsp;be&nbsp;to&nbsp;support&nbsp;bytes&nbsp;and&nbsp;Unicode&nbsp;on&nbsp;Python&nbsp;2&nbsp;*and*&nbsp;Python&nbsp;3,&nbsp;for&nbsp;maximum&nbsp;compatibility.&nbsp;Even&nbsp;if&nbsp;deprecated&nbsp;on&nbsp;Windows,&nbsp;filesystem&nbsp;operations&nbsp;on&nbsp;Python&nbsp;3&nbsp;still&nbsp;do&nbsp;accept&nbsp;bytes&nbsp;(and&nbsp;they&#39;re&nbsp;not&nbsp;deprecated&nbsp;elsewhere).&nbsp;Given&nbsp;existing&nbsp;code&nbsp;that&nbsp;already&nbsp;takes&nbsp;bytes,&nbsp;switching&nbsp;to&nbsp;only&nbsp;doing&nbsp;Unicode&nbsp;on&nbsp;Python&nbsp;3&nbsp;would&nbsp;not&nbsp;be&nbsp;backwards&nbsp;compatible,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;really&nbsp;do&nbsp;that&nbsp;without&nbsp;a&nbsp;bunch&nbsp;of&nbsp;deprecation&nbsp;warnings&nbsp;and&nbsp;a&nbsp;few&nbsp;releases.&nbsp;Instead&nbsp;we&nbsp;should&nbsp;just&nbsp;do&nbsp;what&nbsp;Python&nbsp;does:&nbsp;if&nbsp;you&nbsp;start&nbsp;with&nbsp;bytes&nbsp;path&nbsp;you&nbsp;always&nbsp;get&nbsp;back&nbsp;bytes,&nbsp;if&nbsp;you&nbsp;start&nbsp;with&nbsp;Unicode&nbsp;path&nbsp;you&nbsp;always&nbsp;get&nbsp;back&nbsp;Unicode.&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes,&nbsp;you&#39;re&nbsp;right,&nbsp;that&#39;s&nbsp;probably&nbsp;the&nbsp;best&nbsp;solution. &nbsp;It&nbsp;would&nbsp;not&nbsp;be&nbsp;terribly&nbsp;hard&nbsp;to&nbsp;do&nbsp;so&nbsp;-&nbsp;then&nbsp;application&nbsp;developers&nbsp;can&nbsp;choose&nbsp;whether&nbsp;to&nbsp;defer&nbsp;to&nbsp;the&nbsp;local&nbsp;user&#39;s&nbsp;interpretation&nbsp;of&nbsp;the&nbsp;setting,&nbsp;or&nbsp;explicitly&nbsp;use&nbsp;byte&nbsp;paths. &nbsp;Thanks&nbsp;so&nbsp;much&nbsp;for&nbsp;your&nbsp;input!&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;this&nbsp;something&nbsp;I&nbsp;can&nbsp;open&nbsp;a&nbsp;ticket&nbsp;for?&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt; &lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.&lt;u&gt;&lt;/u&gt;com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-&lt;u&gt;&lt;/u&gt;bin/mailman/listinfo/twisted-&lt;u&gt;&lt;/u&gt;python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
