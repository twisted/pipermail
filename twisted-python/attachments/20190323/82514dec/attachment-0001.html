<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;Mar&nbsp;23,&nbsp;2019,&nbsp;at&nbsp;7:21&nbsp;AM,&nbsp;Daniel&nbsp;Holth&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dholth@gmail.com&quot;&nbsp;class=&quot;&quot;&gt;dholth@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;Hello.&nbsp;Can&nbsp;you&nbsp;help&nbsp;me&nbsp;to&nbsp;learn&nbsp;to&nbsp;debug&nbsp;tls&nbsp;problems&nbsp;in&nbsp;twisted?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Hi&nbsp;Daniel!&nbsp;&nbsp;Thanks&nbsp;so&nbsp;much&nbsp;for&nbsp;trying&nbsp;to&nbsp;improve&nbsp;this&nbsp;aspect&nbsp;of&nbsp;the&nbsp;Twisted&nbsp;ecosystem.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;I&nbsp;was&nbsp;disappointed&nbsp;that&nbsp;txacme,&nbsp;an&nbsp;automatic&nbsp;way&nbsp;to&nbsp;get&nbsp;certificates&nbsp;for&nbsp;twisted&nbsp;web,&nbsp;stopped&nbsp;working,&nbsp;so&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;add&nbsp;a&nbsp;responder&nbsp;for&nbsp;the&nbsp;new&nbsp;challenge&nbsp;type.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;situation&nbsp;is&nbsp;definitely&nbsp;bad;&nbsp;as&nbsp;JP&nbsp;tersely&nbsp;put&nbsp;it&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;https://github.com/twisted/txacme/issues/148&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/twisted/txacme/issues/148&lt;/a&gt;,&nbsp;&quot;The&nbsp;published&nbsp;documentation&nbsp;makes&nbsp;it&nbsp;appear&nbsp;as&nbsp;though&nbsp;the&nbsp;server&nbsp;endpoint&nbsp;works&nbsp;though&nbsp;it&nbsp;has&nbsp;apparently&nbsp;been&nbsp;broken&nbsp;for&nbsp;about&nbsp;a&nbsp;year&quot;.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;to&nbsp;prevent&nbsp;onlookers&nbsp;from&nbsp;thinking&nbsp;the&nbsp;situation&nbsp;is&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;even&nbsp;worse&lt;/i&gt;&nbsp;than&nbsp;it&nbsp;is,&nbsp;please&nbsp;allow&nbsp;me&nbsp;to&nbsp;clarify:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;txacme&nbsp;still&nbsp;&quot;works&quot;&nbsp;in&nbsp;the&nbsp;sense&nbsp;that&nbsp;it&nbsp;supports&nbsp;the&nbsp;http-01&nbsp;challenge&nbsp;(which&nbsp;is&nbsp;still&nbsp;supported&nbsp;for&nbsp;the&nbsp;forseeable&nbsp;future,&nbsp;AFAIK),&nbsp;and&nbsp;its&nbsp;challenge/response&nbsp;implementation&nbsp;also&nbsp;powers&nbsp;&lt;a&nbsp;href=&quot;https://pypi.org/project/lancer/&quot;&nbsp;class=&quot;&quot;&gt;https://pypi.org/project/lancer/&lt;/a&gt;,&nbsp;which&nbsp;uses&nbsp;the&nbsp;dns-01&nbsp;challenge.&nbsp;&nbsp;However,&nbsp;its&nbsp;endpoints&nbsp;(and&nbsp;particularly&nbsp;its&nbsp;string&nbsp;endpoint&nbsp;plugin)&nbsp;doesn't&nbsp;support&nbsp;this&nbsp;challenge&nbsp;directly.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;thing&nbsp;that's&nbsp;broken&nbsp;is&nbsp;sni-01,&nbsp;which&nbsp;was&nbsp;disabled&nbsp;globally&nbsp;by&nbsp;Let's&nbsp;Encrypt&nbsp;for&nbsp;security&nbsp;reasons:&nbsp;&lt;a&nbsp;href=&quot;https://www.zdnet.com/article/lets-encrypt-disables-tls-sni-01-validation/&quot;&nbsp;class=&quot;&quot;&gt;https://www.zdnet.com/article/lets-encrypt-disables-tls-sni-01-validation/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;One&nbsp;approach&nbsp;to&nbsp;fixing&nbsp;this&nbsp;is&nbsp;to&nbsp;implement&nbsp;a&nbsp;string&nbsp;endpoint&nbsp;syntax&nbsp;that&nbsp;listens&nbsp;on&nbsp;port&nbsp;80&nbsp;and&nbsp;supports&nbsp;HTTP-01&nbsp;rather&nbsp;than&nbsp;trying&nbsp;to&nbsp;make&nbsp;TLS&nbsp;support&nbsp;TLS-ALPN-01.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;See&nbsp;discussion&nbsp;here:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/twisted/txacme/issues/129&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/twisted/txacme/issues/129&lt;/a&gt;.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Brian&nbsp;Warner&nbsp;already&nbsp;has&nbsp;a&nbsp;branch&nbsp;here:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/warner/txacme/tree/129-http01-endpoint&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/warner/txacme/tree/129-http01-endpoint&lt;/a&gt;&nbsp;but&nbsp;has&nbsp;not&nbsp;made&nbsp;a&nbsp;PR&nbsp;yet.&nbsp;&nbsp;Perhaps&nbsp;you&nbsp;could&nbsp;resurrect&nbsp;this&nbsp;code,&nbsp;polish&nbsp;anything&nbsp;that&nbsp;needs&nbsp;polishing,&nbsp;and&nbsp;get&nbsp;it&nbsp;integrated&nbsp;and&nbsp;released&nbsp;:).&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;It&nbsp;sends&nbsp;a&nbsp;special&nbsp;certificate&nbsp;if&nbsp;the&nbsp;CA&nbsp;negotiates&nbsp;acme&nbsp;using&nbsp;alpn,&nbsp;proving&nbsp;domain&nbsp;control,&nbsp;then&nbsp;you&nbsp;get&nbsp;a&nbsp;certificate.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;Seems&nbsp;to&nbsp;work&nbsp;with&nbsp;openssl&nbsp;s_client&nbsp;but&nbsp;letsencrypt&nbsp;says&nbsp;&quot;no&nbsp;application&nbsp;protocol&quot;.&nbsp;Anyone&nbsp;know&nbsp;where&nbsp;that&nbsp;error&nbsp;comes&nbsp;from?&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;https://github.com/glyph/txsni/pull/26&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/glyph/txsni/pull/26&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;I&nbsp;suspect&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;one&lt;/i&gt;&nbsp;thing&nbsp;you&nbsp;might&nbsp;be&nbsp;running&nbsp;into&nbsp;is&nbsp;this:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/pyca/pyopenssl/issues/769&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/pyca/pyopenssl/issues/769&lt;/a&gt;,&nbsp;i.e.&nbsp;the&nbsp;issue&nbsp;that&nbsp;caused&nbsp;Certbot&nbsp;to&nbsp;revert&nbsp;their&nbsp;own&nbsp;ALPN&nbsp;support:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/certbot/certbot/pull/6100&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/certbot/certbot/pull/6100&lt;/a&gt;.&nbsp;&nbsp;This&nbsp;is&nbsp;an&nbsp;OpenSSL&nbsp;bug&nbsp;and&nbsp;there's&nbsp;not&nbsp;a&nbsp;whole&nbsp;lot&nbsp;Twisted&nbsp;can&nbsp;do&nbsp;about&nbsp;it.&nbsp;&nbsp;See&nbsp;here&nbsp;where&nbsp;I&nbsp;ran&nbsp;into&nbsp;it&nbsp;myself,&nbsp;for&nbsp;this&nbsp;exact&nbsp;same&nbsp;reason:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/openssl/openssl/issues/7660#issuecomment-462104869&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/openssl/openssl/issues/7660#issuecomment-462104869&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Even&nbsp;if&nbsp;you're&nbsp;not&nbsp;hitting&nbsp;this&nbsp;specific&nbsp;problem,&nbsp;continuing&nbsp;down&nbsp;this&nbsp;road&nbsp;(implementing&nbsp;the&nbsp;ALPN&nbsp;challenge&nbsp;using&nbsp;OpenSSL)&nbsp;is&nbsp;unfortunately&nbsp;a&nbsp;bad&nbsp;idea.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Fundamentally,&nbsp;the&nbsp;ALPN&nbsp;callback&nbsp;in&nbsp;OpenSSL&nbsp;is&nbsp;poorly&nbsp;designed,&nbsp;and&nbsp;optimized&nbsp;for&nbsp;the&nbsp;very&nbsp;specific&nbsp;negotiation&nbsp;process&nbsp;that&nbsp;HTTP/2&nbsp;requires.&nbsp;&nbsp;The&nbsp;guidance&nbsp;from&nbsp;people&nbsp;familiar&nbsp;with&nbsp;OpenSSL&nbsp;is&nbsp;-&nbsp;and&nbsp;I&nbsp;know&nbsp;this&nbsp;sounds&nbsp;like&nbsp;a&nbsp;joke,&nbsp;I&nbsp;wish&nbsp;I&nbsp;were&nbsp;kidding&nbsp;here,&nbsp;but&nbsp;no,&nbsp;this&nbsp;is&nbsp;seriously&nbsp;the&nbsp;recommendation&nbsp;-&nbsp;implement&nbsp;your&nbsp;own&nbsp;parser&nbsp;for&nbsp;the&nbsp;ClientHello,&nbsp;extract&nbsp;the&nbsp;ALPN&nbsp;field&nbsp;yourself,&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;then&lt;/i&gt;&nbsp;construct&nbsp;an&nbsp;OpenSSL&nbsp;connection&nbsp;object&nbsp;based&nbsp;on&nbsp;what&nbsp;you&nbsp;find&nbsp;there,&nbsp;and&nbsp;hand&nbsp;it&nbsp;the&nbsp;bytes&nbsp;you&nbsp;just&nbsp;parsed.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Given&nbsp;the&nbsp;mechanics&nbsp;of&nbsp;the&nbsp;challenge&nbsp;message&nbsp;(i.e.:&nbsp;it's&nbsp;going&nbsp;to&nbsp;be&nbsp;in&nbsp;the&nbsp;initial&nbsp;clienthello)&nbsp;you&nbsp;could&nbsp;probably&nbsp;cheese&nbsp;it&nbsp;with&nbsp;a&nbsp;regex&nbsp;just&nbsp;to&nbsp;get&nbsp;something&nbsp;working.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;hope&nbsp;this&nbsp;was&nbsp;helpful.&nbsp;&nbsp;Good&nbsp;luck,&nbsp;and&nbsp;please&nbsp;keep&nbsp;us&nbsp;posted&nbsp;on&nbsp;your&nbsp;efforts!&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-g&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
