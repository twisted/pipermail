<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.2900.2769&quot;&nbsp;name=GENERATOR&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;I&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&nbsp;am&nbsp;running&nbsp;Twisted&nbsp;1.3&nbsp;server&nbsp;with&nbsp;a&nbsp;fairly&amp;nbsp;large&nbsp;<br>
number&nbsp;of&nbsp;clients.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;T&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;he&nbsp;hardware&nbsp;is&nbsp;two&nbsp;64&nbsp;bit&nbsp;3.0&nbsp;GHz&nbsp;Xeons&nbsp;with&nbsp;HT,&nbsp;4GB&nbsp;<br>
RAM,&nbsp;and&nbsp;it's&nbsp;on&nbsp;2.6.11&nbsp;kernel.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;I&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&nbsp;am&nbsp;using&nbsp;poll&nbsp;reactor.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;C&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;urrently,&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;clients&nbsp;approaches&nbsp;5000,&nbsp;<br>
the&nbsp;&quot;top&quot;&nbsp;shows&nbsp;99%&nbsp;CPU&nbsp;load&nbsp;for&nbsp;twistd&nbsp;process,&nbsp;the&nbsp;event&nbsp;loop&nbsp;slows&nbsp;down&nbsp;and&nbsp;<br>
weird&nbsp;racing&nbsp;conditions&nbsp;show&nbsp;up.&nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;class=843084009-07122005&gt;My&nbsp;clients&nbsp;<br>
basically&nbsp;do&nbsp;nothing:&nbsp;they&nbsp;connect&nbsp;and&nbsp;just&nbsp;sit&nbsp;there,&nbsp;sending&nbsp;application-level&nbsp;<br>
keep-alives&nbsp;(null&nbsp;character&nbsp;string)&amp;nbsp;to&nbsp;the&nbsp;server&nbsp;every&nbsp;90&nbsp;sec,&nbsp;which&nbsp;are&nbsp;<br>
echoed&nbsp;back.&nbsp;The&nbsp;connections/&nbsp;disconnections&nbsp;for&nbsp;clients&nbsp;are&nbsp;rare-&nbsp;about&nbsp;4-5&nbsp;per&nbsp;<br>
sec.&nbsp;So&nbsp;I&nbsp;am&nbsp;mostly&nbsp;dealing&nbsp;with&nbsp;5000&nbsp;clients&nbsp;in&nbsp;the&nbsp;ESTABLISHED&nbsp;state.&nbsp;Very&nbsp;<br>
rarely&amp;nbsp;(5x&nbsp;per&nbsp;second&nbsp;on&nbsp;average)&amp;nbsp;one&nbsp;of&nbsp;the&amp;nbsp;clients&nbsp;gets&nbsp;a&nbsp;<br>
message&nbsp;from&nbsp;the&nbsp;server,&nbsp;but&nbsp;I&nbsp;am&nbsp;sure&nbsp;that&nbsp;this&nbsp;is&nbsp;not&nbsp;what&nbsp;keeps&nbsp;the&nbsp;load&nbsp;so&nbsp;<br>
high&nbsp;(I&nbsp;slowed&nbsp;down&nbsp;message&nbsp;rates,&nbsp;and&nbsp;the&nbsp;CPU&nbsp;load&nbsp;did&nbsp;not&nbsp;<br>
change).&amp;nbsp;&amp;nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;class=843084009-07122005&gt;What&nbsp;are&nbsp;your&nbsp;<br>
thoughts&nbsp;on&nbsp;this&nbsp;performance?&nbsp;Is&nbsp;this&nbsp;load&nbsp;mainly&nbsp;due&amp;nbsp;to&nbsp;poll()&nbsp;overhead,&nbsp;<br>
polling&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;file&nbsp;descriptors?&nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;class=843084009-07122005&gt;I&nbsp;would&nbsp;love&nbsp;<br>
to&nbsp;try&nbsp;an&nbsp;epoll&nbsp;reactor,&nbsp;but&nbsp;as&nbsp;I&nbsp;understand,&nbsp;it's&nbsp;not&nbsp;yet&nbsp;<br>
available?&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;class=843084009-07122005&gt;Additionally,&nbsp;<br>
the&nbsp;process&nbsp;leaks&nbsp;about&nbsp;100MB&nbsp;memory&nbsp;per&nbsp;day.&nbsp;I&nbsp;made&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;print&nbsp;<br>
out&nbsp;the&nbsp;number&nbsp;of&nbsp;objects&nbsp;traced&nbsp;by&nbsp;it&nbsp;every&nbsp;30&nbsp;min,&nbsp;and&nbsp;this&nbsp;number&nbsp;stays&nbsp;more&nbsp;<br>
or&nbsp;less&nbsp;constant.&nbsp;When&nbsp;the&nbsp;memory&nbsp;held&nbsp;by&nbsp;the&nbsp;process&nbsp;becomes&nbsp;larger,&nbsp;the&nbsp;event&nbsp;<br>
loop&nbsp;further&nbsp;slows&nbsp;down,&nbsp;and&nbsp;the&nbsp;performance&nbsp;with&nbsp;the&nbsp;same&nbsp;number&nbsp;of&nbsp;clients&nbsp;<br>
degrades,&nbsp;as&nbsp;the&nbsp;memory&nbsp;footprint&nbsp;increases.&nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;class=843084009-07122005&gt;Thanks&nbsp;for&nbsp;any&nbsp;<br>
advice.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;Alec.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;FONT&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=843084009-07122005&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&lt;BR&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
