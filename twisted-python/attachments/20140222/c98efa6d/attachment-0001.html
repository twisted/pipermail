<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;everyone,&nbsp;&lt;br&gt;&lt;br&gt;I&#39;m&nbsp;writing&nbsp;a&nbsp;client&nbsp;library&nbsp;that&nbsp;makes&nbsp;(potentially&nbsp;long&nbsp;running)&nbsp;HTTP&nbsp;requests.&nbsp;Since&nbsp;the&nbsp;library&nbsp;will&nbsp;be&nbsp;used&nbsp;within&nbsp;non-Twisted&nbsp;code,&nbsp;I&nbsp;was&nbsp;thinking&nbsp;of&nbsp;running&nbsp;the&nbsp;reactor&nbsp;in&nbsp;a&nbsp;separate&nbsp;thread.&nbsp;The&nbsp;library&nbsp;code&nbsp;looks&nbsp;roughly&nbsp;like&nbsp;this:&lt;br&gt;<br>
<br>
&lt;br&gt;def&nbsp;start():&lt;br&gt;   &nbsp;Thread(target=reactor.run,&nbsp;args=(False,)).start()&lt;br&gt;&lt;br&gt;def&nbsp;shutdown():&lt;br&gt;   &nbsp;reactor.callFromThread(lambda&nbsp;x:&nbsp;reactor.stop(),&nbsp;None)&lt;br&gt;&lt;br&gt;def&nbsp;make_request(url):&lt;br&gt;   &nbsp;   &nbsp;agent&nbsp;=&nbsp;Agent(reactor)&lt;br&gt;<br>
<br>
       &nbsp;d&nbsp;=&nbsp;agent.request(&lt;br&gt;           &nbsp;&#39;GET&#39;,&lt;br&gt;           &nbsp;url,&lt;br&gt;           &nbsp;Headers({&lt;br&gt;               &nbsp;&#39;User-Agent&#39;:&nbsp;[&#39;Twisted&nbsp;SSE&nbsp;Client&#39;],&lt;br&gt;               &nbsp;&#39;Cache-Control&#39;:&nbsp;[&#39;no-cache&#39;],&lt;br&gt;<br>
           &nbsp;}),&lt;br&gt;           &nbsp;None)&lt;br&gt;       &nbsp;d.addCallback(self.cbRequest)&lt;br&gt;&lt;br&gt;Then&nbsp;I&nbsp;make&nbsp;requests&nbsp;from&nbsp;the&nbsp;application&nbsp;like&nbsp;so:&lt;br&gt;&lt;br&gt;start()&lt;br&gt;make_request(&quot;&lt;a&nbsp;href=&quot;http://localhost:12000&quot;&nbsp;target=&quot;_blank&quot;&gt;http://localhost:12000&lt;/a&gt;&quot;)&lt;br&gt;<br>
<br>
....&lt;br&gt;make_request(&quot;&lt;a&nbsp;href=&quot;http://localhost:12000&quot;&nbsp;target=&quot;_blank&quot;&gt;http://localhost:12000&lt;/a&gt;&quot;)&lt;br&gt;...&lt;br&gt;shutdown()&lt;br&gt;&lt;br&gt;However,&nbsp;it&nbsp;looks&nbsp;like&nbsp;the&nbsp;&#39;d&#39;&nbsp;deferred&nbsp;never&nbsp;gets&nbsp;fired.&nbsp;From&nbsp;a&nbsp;little&nbsp;playing&nbsp;around,&nbsp;it&nbsp;looks&nbsp;like&nbsp;this&nbsp;is&nbsp;because&nbsp;the&nbsp;reactor&nbsp;is&nbsp;started&nbsp;before&nbsp;the&nbsp;call(s)&nbsp;to&nbsp;agent.request&nbsp;are&nbsp;made.&nbsp;All&nbsp;examples&nbsp;in&nbsp;the&nbsp;twisted&nbsp;docs&nbsp;create&nbsp;the&nbsp;request&nbsp;before&nbsp;running&nbsp;the&nbsp;reactor.&nbsp;I&#39;m&nbsp;sure&nbsp;I&#39;m&nbsp;missing&nbsp;something&nbsp;very&nbsp;obvious&nbsp;here.&nbsp;Also,&nbsp;is&nbsp;there&nbsp;a&nbsp;better&nbsp;way&nbsp;to&nbsp;design&nbsp;such&nbsp;a&nbsp;library?&lt;br&nbsp;clear=&quot;all&quot;&gt;<br>
<br>
&lt;br&gt;--&nbsp;&lt;br&gt;-Ameya<br>
&lt;/div&gt;<br>

</tt>
