<tt>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;Piper,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;`successResultOf`&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;called&nbsp;on&nbsp;a&nbsp;Deferred&nbsp;which&nbsp;has&nbsp;a&nbsp;result&nbsp;(meaning&nbsp;`Deferred.errback`&nbsp;or&nbsp;`Deferred.callback`&nbsp;has&nbsp;been&nbsp;called&nbsp;on&nbsp;it&nbsp;already.)&nbsp;[1]&nbsp;In&nbsp;this&nbsp;case&nbsp;presumably&nbsp;your&nbsp;blocking&nbsp;call&nbsp;hasn’t&nbsp;finished&nbsp;(or&nbsp;even&nbsp;started?)&nbsp;by&nbsp;the&nbsp;time&nbsp;the&nbsp;assertion&nbsp;is&nbsp;executed,&nbsp;hence&nbsp;the&nbsp;Deferred&nbsp;has&nbsp;no&nbsp;result.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;usual&nbsp;case&nbsp;for&nbsp;using&nbsp;`successResultOf`&nbsp;is&nbsp;when&nbsp;you&nbsp;have&nbsp;a&nbsp;Deferred&nbsp;that&nbsp;you’re&nbsp;delivering&nbsp;results&nbsp;to&nbsp;synchronously&nbsp;(probably&nbsp;by&nbsp;way&nbsp;of&nbsp;calling&nbsp;`Deferred.callback`&nbsp;from&nbsp;your&nbsp;test)&nbsp;to&nbsp;determine&nbsp;if&nbsp;the&nbsp;callback&nbsp;chain&nbsp;produces&nbsp;the&nbsp;expected&nbsp;final&nbsp;result.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Without&nbsp;debating&nbsp;the&nbsp;merits&nbsp;of&nbsp;preferring&nbsp;to&nbsp;avoid&nbsp;interaction&nbsp;with&nbsp;the&nbsp;real&nbsp;world&nbsp;in&nbsp;unit&nbsp;tests,&nbsp;you&nbsp;can&nbsp;return&nbsp;a&nbsp;Deferred&nbsp;from&nbsp;your&nbsp;test&nbsp;method&nbsp;to&nbsp;run&nbsp;the&nbsp;reactor&nbsp;for&nbsp;you&nbsp;until&nbsp;the&nbsp;Deferred&nbsp;has&nbsp;fired&nbsp;and&nbsp;its&nbsp;callbacks&nbsp;have&nbsp;run.&nbsp;[2]&nbsp;You&nbsp;probably&nbsp;want&nbsp;to&nbsp;add&nbsp;some&nbsp;callbacks,&nbsp;to&nbsp;perform&nbsp;some&nbsp;assertions&nbsp;about&nbsp;the&nbsp;result,&nbsp;to&nbsp;the&nbsp;Deferred&nbsp;you’ll&nbsp;be&nbsp;returning.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[1]&nbsp;&lt;http://twistedmatrix.com/documents/current/api/twisted.trial._synctest._Assertions.html#successResultOf&gt;&lt;/div&gt;&lt;div&gt;[2]&nbsp;&lt;http://twistedmatrix.com/documents/current/core/howto/testing.html#leave-the-reactor-as-you-found-it&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Jonathan&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&nbsp;style=&quot;color:&nbsp;#A0A0A8;&quot;&gt;On&nbsp;Friday&nbsp;30&nbsp;May&nbsp;2014&nbsp;at&nbsp;8:13&nbsp;AM,&nbsp;Piper&nbsp;Masden&nbsp;wrote:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;some&nbsp;Klein&nbsp;code&nbsp;that&nbsp;uses&nbsp;deferToThread&nbsp;for&nbsp;I/O.&nbsp;It&nbsp;looks&nbsp;something&nbsp;like&nbsp;this:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;@app.route('/',&nbsp;methods=['GET']&lt;/div&gt;&lt;div&gt;def&nbsp;index(request,&nbsp;*args,&nbsp;**kwargs):&lt;/div&gt;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;deferToThread(some_blocking_db_select_function)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;serialize(db_object):&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;json.dumps({&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'id':&nbsp;db_object,&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;d.addCallback(serialize)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;d&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;test&nbsp;that&nbsp;executes&nbsp;this&nbsp;function,&nbsp;and&nbsp;the&nbsp;deferToThread&nbsp;returns&nbsp;a&nbsp;Deferred,&nbsp;but&nbsp;that&nbsp;deferred&nbsp;never&nbsp;fires&nbsp;its&nbsp;callback,&nbsp;and&nbsp;so&nbsp;when&nbsp;I&nbsp;use&nbsp;successResultOf&nbsp;expecting&nbsp;a&nbsp;success&nbsp;result,&nbsp;no&nbsp;result&nbsp;is&nbsp;found.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;use&nbsp;twistd&nbsp;to&nbsp;run&nbsp;the&nbsp;Klein&nbsp;application,&nbsp;everything&nbsp;works&nbsp;fine&nbsp;(the&nbsp;deferred&nbsp;fires&nbsp;and&nbsp;I&nbsp;get&nbsp;a&nbsp;json&nbsp;string&nbsp;in&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response).&nbsp;What's&nbsp;different&nbsp;about&nbsp;the&nbsp;trial&nbsp;environment&nbsp;that&nbsp;deferToThread&nbsp;might&nbsp;not&nbsp;fire&nbsp;its&nbsp;callback?&nbsp;Do&nbsp;I&nbsp;need&nbsp;to&nbsp;explicitly&nbsp;set&nbsp;up&nbsp;a&nbsp;thread&nbsp;pool&nbsp;in&nbsp;trial&nbsp;that&nbsp;I&nbsp;don't&nbsp;have&nbsp;to&nbsp;set&nbsp;up&nbsp;using&nbsp;twistd?&nbsp;&nbsp;Any&nbsp;help&nbsp;would&nbsp;be&nbsp;appreciated.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</tt>
