<tt>
<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;Paul_S_Johnson&nbsp;at&nbsp;mnb.uscourts.gov&nbsp;Paul_S_Johnson<br>
at&nbsp;mnb.uscourts.gov&nbsp;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;Thu&nbsp;Sep&nbsp;27&nbsp;16:00:14&nbsp;EDT&nbsp;200:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;After&nbsp;much&nbsp;wrangling&nbsp;and&nbsp;a&nbsp;small&nbsp;miracle&nbsp;I&nbsp;have&nbsp;managed&nbsp;to&nbsp;write&nbsp;an<br>
object&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;that&nbsp;fetches&nbsp;the&nbsp;output&nbsp;of&nbsp;three&nbsp;commands&nbsp;in&nbsp;the&nbsp;order&nbsp;given&nbsp;through<br>
an&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;SSH&nbsp;connection.&nbsp;How&nbsp;come&nbsp;I&nbsp;cannot&nbsp;switch&nbsp;users?&nbsp;Some&nbsp;of&nbsp;the&nbsp;information<br>
I&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;need&nbsp;can&nbsp;only&nbsp;be&nbsp;fetched&nbsp;through&nbsp;a&nbsp;root&nbsp;account&nbsp;and&nbsp;security&nbsp;is&nbsp;such<br>
that&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;cannot&nbsp;log&nbsp;in&nbsp;remotely&nbsp;from&nbsp;a&nbsp;root&nbsp;account&nbsp;but&nbsp;must&nbsp;switch&nbsp;once<br>
logged&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;in&nbsp;from&nbsp;an&nbsp;account&nbsp;with&nbsp;less&nbsp;than&nbsp;root&nbsp;privileges.&lt;br&gt;<br>
&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;I've&nbsp;been&nbsp;trying&nbsp;something&nbsp;similar.&nbsp;As&nbsp;you've&nbsp;probably<br>
found&nbsp;out&nbsp;you&nbsp;cant&nbsp;just&nbsp;write&nbsp;in&nbsp;the&nbsp;password&nbsp;to&nbsp;su&nbsp;-&nbsp;you'll&nbsp;get&nbsp;an&nbsp;error<br>
&amp;quot;Standard&nbsp;in&nbsp;must&nbsp;be&nbsp;a&nbsp;tty&amp;quot;.&nbsp;Basically&nbsp;I&nbsp;think&nbsp;su&nbsp;needs&nbsp;a&nbsp;shell<br>
to&nbsp;work.&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;Consequently,&nbsp;before&nbsp;sending&nbsp;your&nbsp;password,&nbsp;you'll<br>
need&nbsp;to&nbsp;request&nbsp;a&nbsp;shell.&nbsp;I&nbsp;would've&nbsp;been&nbsp;utterly&nbsp;clueless&nbsp;about&nbsp;this&nbsp;if<br>
it&nbsp;wasn't&nbsp;for&nbsp;the&nbsp;post&nbsp;@&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;http://twistedmatrix.com/pipermail/twisted-python/2007-July/015793.html,<br>
from&nbsp;which&nbsp;I&nbsp;managed&nbsp;to&nbsp;extract&nbsp;the&nbsp;crucial&nbsp;code:&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;term&nbsp;=&nbsp;'ansi'&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;winsz&nbsp;=&nbsp;struct.pack('4H',&nbsp;80,&nbsp;100,&nbsp;80,&nbsp;100)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;winSize&nbsp;=&nbsp;struct.unpack('4H',&nbsp;winsz)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;ptyReqData&nbsp;=&nbsp;session.packRequest_pty_req(term,&nbsp;winSize,<br>
'')&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;self.conn.sendRequest(self,&nbsp;'pty-req',&nbsp;ptyReqData)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;self.conn.sendRequest(self,&nbsp;'shell',&nbsp;'')&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;Sticking&nbsp;this&nbsp;in&nbsp;your&nbsp;SSHChannel.channelOpen&nbsp;method<br>
will&nbsp;allow&nbsp;you&nbsp;to&nbsp;get&nbsp;a&nbsp;shell.&nbsp;Unfortunately&nbsp;you&nbsp;then&nbsp;have&nbsp;to&nbsp;interact<br>
with&nbsp;the&nbsp;session&nbsp;in&nbsp;an&nbsp;expect-like&nbsp;manner&nbsp;which&nbsp;turns&nbsp;the&nbsp;whole&nbsp;procedure<br>
into&nbsp;one&nbsp;big&nbsp;easily&nbsp;broken&nbsp;hack.&nbsp;Basically&nbsp;I&nbsp;just&nbsp;write&nbsp;&amp;quot;su&nbsp;-&amp;quot;<br>
and&nbsp;wait&nbsp;for&nbsp;my&nbsp;method&nbsp;dataReceived&nbsp;to&nbsp;return&nbsp;&amp;quot;password:&amp;quot;&nbsp;at<br>
which&nbsp;point&nbsp;I&nbsp;write&nbsp;in&nbsp;the&nbsp;password.&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;Another&nbsp;point&nbsp;to&nbsp;mention&nbsp;is&nbsp;that&nbsp;the&nbsp;ssh&nbsp;session&nbsp;is<br>
still&nbsp;not&nbsp;root,&nbsp;the&nbsp;root&nbsp;functionality&nbsp;is&nbsp;being&nbsp;provided&nbsp;by&nbsp;the&nbsp;shell&nbsp;instance.<br>
Consequently&nbsp;any&nbsp;new&nbsp;channels&nbsp;opened&nbsp;up&nbsp;will&nbsp;not&nbsp;be&nbsp;root&nbsp;so&nbsp;you&nbsp;cant&nbsp;easily<br>
use&nbsp;this&nbsp;method&nbsp;to&nbsp;scp&nbsp;file's&nbsp;that&nbsp;are&nbsp;only&nbsp;readable&nbsp;for&nbsp;root.&nbsp;You&nbsp;can<br>
of&nbsp;course&nbsp;cat&nbsp;from&nbsp;the&nbsp;shell&nbsp;session&nbsp;but&nbsp;then&nbsp;you&nbsp;have&nbsp;issues&nbsp;with&nbsp;line<br>
wrapping&nbsp;and&nbsp;reliably&nbsp;figuring&nbsp;out&nbsp;when&nbsp;the&nbsp;file&nbsp;ends&nbsp;and&nbsp;your&nbsp;shell&nbsp;prompt<br>
begins.&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;I&nbsp;looked&nbsp;into&nbsp;trying&nbsp;to&nbsp;do&nbsp;some&nbsp;setreuid/setuid&nbsp;magic<br>
in&nbsp;the&nbsp;hope&nbsp;that&nbsp;I&nbsp;could&nbsp;issue&nbsp;a&nbsp;command&nbsp;from&nbsp;my&nbsp;root&nbsp;shell&nbsp;prompt&nbsp;that<br>
would&nbsp;elevate&nbsp;the&nbsp;whole&nbsp;ssh&nbsp;process&nbsp;to&nbsp;root&nbsp;allowing&nbsp;all&nbsp;my&nbsp;channels&nbsp;root<br>
priviliges.&nbsp;However&nbsp;I&nbsp;soon&nbsp;got&nbsp;well&nbsp;out&nbsp;of&nbsp;my&nbsp;depth&nbsp;and&nbsp;decided&nbsp;it&nbsp;wasn't<br>
possible,&nbsp;at&nbsp;least&nbsp;by&nbsp;me&nbsp;:)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;So,&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;see,&nbsp;it's&nbsp;not&nbsp;possible,&nbsp;if&nbsp;your<br>
server&nbsp;doesn't&nbsp;allow&nbsp;root&nbsp;access&nbsp;to&nbsp;open&nbsp;up&nbsp;a&nbsp;channel&nbsp;that&nbsp;has&nbsp;root&nbsp;priviliges.<br>
The&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;it&nbsp;is&nbsp;in&nbsp;the&nbsp;aformentioned&nbsp;messy&nbsp;way&nbsp;via&nbsp;a&nbsp;shell&nbsp;&amp;amp;<br>
su&nbsp;(which&nbsp;I&nbsp;gave&nbsp;up&nbsp;on&nbsp;when&nbsp;my&nbsp;regular&nbsp;expression&nbsp;took&nbsp;up&nbsp;two&nbsp;lines&nbsp;on<br>
my&nbsp;screen&nbsp;and&nbsp;still&nbsp;didn't&nbsp;reliable&nbsp;match&nbsp;half&nbsp;the&nbsp;shell&nbsp;prompts&nbsp;it&nbsp;needed<br>
to).&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;I&nbsp;would&nbsp;love&nbsp;somebody&nbsp;to&nbsp;prove&nbsp;me&nbsp;wrong&nbsp;and&nbsp;let&nbsp;me<br>
know&nbsp;of&nbsp;a&nbsp;nice&nbsp;way&nbsp;round&nbsp;this.&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;Of&nbsp;course&nbsp;-&nbsp;these&nbsp;problems&nbsp;are&nbsp;nothing&nbsp;to&nbsp;do&nbsp;with<br>
twisted&nbsp;and&nbsp;all&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;way&nbsp;ssh&nbsp;works.&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;-ross&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Ross&nbsp;McKerchar&lt;br&gt;<br>
Systems&nbsp;Analyst,&nbsp;Sophos&lt;br&gt;<br>
&lt;br&gt;<br>
Tel:&nbsp;01235&nbsp;559933&lt;br&gt;<br>
Web:&nbsp;http://www.sophos.com&lt;br&gt;<br>
Sophos&nbsp;-&nbsp;security&nbsp;and&nbsp;control&lt;br&gt;<br>
&lt;/font&gt;&lt;/tt&gt;Sophos&nbsp;Plc,&nbsp;The&nbsp;Pentagon,&nbsp;Abingdon&nbsp;Science&nbsp;Park,&nbsp;Abingdon,<br>
OX14&nbsp;3YP,&nbsp;United&nbsp;Kingdom.<br>
<br>
Company&nbsp;Reg&nbsp;No&nbsp;2096520.&nbsp;VAT&nbsp;Reg&nbsp;No&nbsp;GB&nbsp;348&nbsp;3873&nbsp;20.<br>

</tt>
