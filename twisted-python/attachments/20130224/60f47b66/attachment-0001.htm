<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;encountering&nbsp;a&nbsp;weird&nbsp;bug,&nbsp;where&nbsp;some&nbsp;TCP&nbsp;client&nbsp;connections&nbsp;get&nbsp;into&nbsp;a&nbsp;state&nbsp;where&nbsp;the&nbsp;server&nbsp;is&nbsp;able&nbsp;to&nbsp;read&nbsp;data&nbsp;sent&nbsp;from&nbsp;the&nbsp;client,&nbsp;but&nbsp;not&nbsp;able&nbsp;to&nbsp;send&nbsp;any&nbsp;data&nbsp;with&nbsp;transport.write().&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;With&nbsp;some&nbsp;help&nbsp;from&nbsp;the&nbsp;#twitsed&nbsp;IRC&nbsp;channel,&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;gather&nbsp;the&nbsp;following&nbsp;information&nbsp;regarding&nbsp;the&nbsp;bug.&nbsp;While&nbsp;I&amp;#39;m&nbsp;still&nbsp;unable&nbsp;to&nbsp;provide&nbsp;steps&nbsp;to&nbsp;reporduce&nbsp;this&nbsp;bug,&nbsp;I&nbsp;am&nbsp;able&nbsp;to&nbsp;reliably&nbsp;find&nbsp;clients&nbsp;who&nbsp;are&nbsp;in&nbsp;this&nbsp;state.&nbsp;I&nbsp;am&nbsp;running&nbsp;24&nbsp;instances&nbsp;of&nbsp;the&nbsp;twisted&nbsp;server&nbsp;(Epoll&nbsp;reactor)&nbsp;running&nbsp;on&nbsp;Ubuntu,&nbsp;with&nbsp;a&nbsp;peak&nbsp;traffic&nbsp;of&nbsp;&amp;gt;130k&nbsp;users.&nbsp;At&nbsp;any&nbsp;instance,&nbsp;there&nbsp;are&nbsp;&amp;lt;&nbsp;20&nbsp;TCP&nbsp;connections&nbsp;stuck&nbsp;in&nbsp;this&nbsp;state.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;is&nbsp;some&nbsp;information&nbsp;about&nbsp;the&nbsp;bug:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;transport.write()&nbsp;does&nbsp;not&nbsp;send&nbsp;anything&nbsp;down&nbsp;the&nbsp;socket&lt;/div&gt;&lt;div&gt;2.&nbsp;transport.doWrite()&nbsp;will&nbsp;send&nbsp;all&nbsp;the&nbsp;data&nbsp;that&nbsp;has&nbsp;been&nbsp;buffered&nbsp;up,&nbsp;and&nbsp;then&nbsp;stop&nbsp;sending&nbsp;any&nbsp;new&nbsp;data.&lt;/div&gt;<br>
<br>
&lt;div&gt;3.&nbsp;transport.writeSomeData()&nbsp;will&nbsp;send&nbsp;data&lt;/div&gt;&lt;div&gt;3.&nbsp;reactor.getWriters()&nbsp;will&nbsp;return&nbsp;a&nbsp;list&nbsp;of&nbsp;transports&nbsp;that&nbsp;are&nbsp;all&nbsp;stuck&nbsp;in&nbsp;this&nbsp;state,&nbsp;and&nbsp;the&nbsp;writers&nbsp;will&nbsp;remain&nbsp;in&nbsp;this&nbsp;list.&lt;/div&gt;&lt;div&gt;4.&nbsp;Calling&nbsp;reactor.removeWriter(transport)&nbsp;will&nbsp;&amp;quot;unstuck&amp;quot;&nbsp;the&nbsp;transport&nbsp;and&nbsp;data&nbsp;gets&nbsp;streamed&nbsp;once&nbsp;again.&lt;/div&gt;<br>
<br>
&lt;div&gt;5.&nbsp;A&nbsp;small&nbsp;number&nbsp;of&nbsp;clients&nbsp;will&nbsp;receive&nbsp;data&nbsp;for&nbsp;a&nbsp;while,&nbsp;and&nbsp;return&nbsp;to&nbsp;this&nbsp;stuck&nbsp;state.&nbsp;Most&nbsp;return&nbsp;to&nbsp;normal&nbsp;once&nbsp;reactor.removeWriter()&nbsp;is&nbsp;called.&lt;/div&gt;&lt;div&gt;6.&nbsp;Based&nbsp;on&nbsp;the&nbsp;suggestion&nbsp;from&nbsp;IRC&nbsp;user&nbsp;_habnabit,&nbsp;I&nbsp;used&nbsp;strace&nbsp;after&nbsp;removing&nbsp;the&nbsp;writer,&nbsp;here&nbsp;is&nbsp;the&nbsp;output:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;(4:52:09&nbsp;PM)&nbsp;thewrongboy:&nbsp;epoll_ctl(3,&nbsp;EPOLL_CTL_MOD,&nbsp;6504,&nbsp;{EPOLLIN,&nbsp;{u32=6504,&nbsp;u64=22205092589476200}})&nbsp;=&nbsp;0&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;(4:52:09&nbsp;PM)&nbsp;thewrongboy:&nbsp;epoll_ctl(3,&nbsp;EPOLL_CTL_MOD,&nbsp;6504,&nbsp;{EPOLLIN|EPOLLOUT,&nbsp;{u32=6504,&nbsp;u64=22205092589476200}})&nbsp;=&nbsp;0&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;(4:52:09&nbsp;PM)&nbsp;thewrongboy:&nbsp;epoll_ctl(3,&nbsp;EPOLL_CTL_MOD,&nbsp;6504,&nbsp;{EPOLLIN,&nbsp;{u32=6504,&nbsp;u64=22205092589476200}})&nbsp;=&nbsp;0&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;(4:52:09&nbsp;PM)&nbsp;thewrongboy:&nbsp;epoll_ctl(3,&nbsp;EPOLL_CTL_MOD,&nbsp;6504,&nbsp;{EPOLLIN|EPOLLOUT,&nbsp;{u32=6504,&nbsp;u64=22205092589476200}})&nbsp;=&nbsp;0&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;(4:52:09&nbsp;PM)&nbsp;thewrongboy:&nbsp;epoll_ctl(3,&nbsp;EPOLL_CTL_MOD,&nbsp;6504,&nbsp;{EPOLLIN,&nbsp;{u32=6504,&nbsp;u64=22205092589476200}})&nbsp;=&nbsp;0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;now,&nbsp;I&nbsp;am&nbsp;using&nbsp;a&nbsp;LoopingCall&nbsp;to&nbsp;check&nbsp;and&nbsp;remove&nbsp;transports&nbsp;that&nbsp;are&nbsp;stuck&nbsp;in&nbsp;getWriters().&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;using&nbsp;Twisted&nbsp;12.3.0&nbsp;on&nbsp;Ubuntu&nbsp;12.04&nbsp;-&nbsp;3.2.0-35-generic&nbsp;#55-Ubuntu&nbsp;SMP&nbsp;Wed&nbsp;Dec&nbsp;5&nbsp;17:42:16&nbsp;UTC&nbsp;2012&nbsp;x86_64&nbsp;x86_64&nbsp;x86_64&nbsp;GNU/Linux.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Has&nbsp;anyone&nbsp;else&nbsp;experienced&nbsp;this&nbsp;weird&nbsp;problem?&nbsp;I&amp;#39;d&nbsp;love&nbsp;to&nbsp;provide&nbsp;more&nbsp;information&nbsp;regarding&nbsp;this&nbsp;bug.&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;<br>

</tt>
