<tt>
&lt;DIV&gt;Itamar,&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;This&nbsp;is&nbsp;also&nbsp;problematic.&nbsp;What&nbsp;this&nbsp;code&nbsp;does&nbsp;is&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&lt;/DIV&gt;<br>
&lt;DIV&gt;calls&nbsp;that&nbsp;will&nbsp;be&nbsp;made&nbsp;by&nbsp;runUntilCurrent.&nbsp;However,&nbsp;if&nbsp;there's&nbsp;code&lt;/DIV&gt;<br>
&lt;DIV&gt;that&nbsp;does&nbsp;a&nbsp;callLater&nbsp;with&nbsp;a&nbsp;delay&nbsp;of&nbsp;0,&nbsp;it&nbsp;will&nbsp;always&nbsp;execute&nbsp;that.&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;The&nbsp;problem&nbsp;now&nbsp;is&nbsp;that&nbsp;only&nbsp;callLater's&nbsp;with&nbsp;a&nbsp;delay&nbsp;of&nbsp;0&nbsp;will&nbsp;be&lt;/DIV&gt;<br>
&lt;DIV&gt;executed.&nbsp;Yes,&nbsp;now&nbsp;the&nbsp;main&nbsp;loop&nbsp;runs&nbsp;fine,&nbsp;but&nbsp;the&nbsp;other&nbsp;timeouts&lt;/DIV&gt;<br>
&lt;DIV&gt;are&nbsp;prevented&nbsp;from&nbsp;running.&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;I'm&nbsp;thinking&nbsp;that&nbsp;what&nbsp;you&nbsp;need&nbsp;to&nbsp;do&nbsp;is&nbsp;to&nbsp;have&nbsp;runUntilCurrent&nbsp;first&lt;/DIV&gt;<br>
&lt;DIV&gt;extract&nbsp;all&nbsp;the&nbsp;pending&nbsp;timed&nbsp;calls&nbsp;that&nbsp;it&nbsp;plans&nbsp;to&nbsp;execute,&nbsp;creating&lt;/DIV&gt;<br>
&lt;DIV&gt;a&nbsp;sub-list,&nbsp;and&nbsp;then&nbsp;call&nbsp;them.&nbsp;It&nbsp;takes&nbsp;two&nbsp;loops,&nbsp;not&nbsp;one.&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;Bill&lt;BR&gt;&lt;BR&gt;&lt;B&gt;&lt;I&gt;Itamar&nbsp;Shtull-Trauring&nbsp;&lt;itamar@itamarst.org&gt;&lt;/I&gt;&lt;/B&gt;&nbsp;wrote:&lt;/DIV&gt;<br>
&lt;BLOCKQUOTE&nbsp;class=replbq&nbsp;style=&quot;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#1010ff&nbsp;2px&nbsp;solid&quot;&gt;On&nbsp;Mon,&nbsp;2004-05-17&nbsp;at&nbsp;10:14,&nbsp;Bill&nbsp;la&nbsp;Forge&nbsp;wrote:&lt;BR&gt;&lt;BR&gt;&gt;&nbsp;This&nbsp;means&nbsp;that&nbsp;when&nbsp;you&nbsp;do&nbsp;a&nbsp;callLater&nbsp;with&nbsp;a&nbsp;delay&nbsp;of&nbsp;0,&nbsp;&lt;BR&gt;&gt;&nbsp;runUntilCurrent&nbsp;will&nbsp;immediately&nbsp;call&nbsp;the&nbsp;delayed&nbsp;function,&nbsp;which&nbsp;then&lt;BR&gt;&gt;&nbsp;calls&nbsp;callLater,&nbsp;and&nbsp;again&nbsp;the&nbsp;delayed&nbsp;function&nbsp;is&nbsp;immediately&nbsp;called,&lt;BR&gt;&gt;&nbsp;etc.&lt;BR&gt;&lt;BR&gt;And&nbsp;that's&nbsp;why&nbsp;testImmediateThread&nbsp;failed.&nbsp;Attached&nbsp;is&nbsp;a&nbsp;fixed&nbsp;up&nbsp;patch&lt;BR&gt;that&nbsp;solves&nbsp;that&nbsp;problem.&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;Index:&nbsp;base.py&lt;BR&gt;===================================================================&lt;BR&gt;---&nbsp;base.py&nbsp;(revision&nbsp;10658)&lt;BR&gt;+++&nbsp;base.py&nbsp;(working&nbsp;copy)&lt;BR&gt;@@&nbsp;-368,7&nbsp;+368,11&nbsp;@@&lt;BR&gt;assert&nbsp;callable(_f),&nbsp;&quot;%s&nbsp;is&nbsp;not&nbsp;callable&quot;&nbsp;%&nbsp;_f&lt;BR&gt;assert&nbsp;sys.maxint&nbsp;&gt;=&nbsp;_seconds&nbsp;&gt;=&nbsp;0,&nbsp;\&lt;BR&gt;&quot;%s&nbsp;is&nbsp;not&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;0&nbsp;seconds&quot;&nbsp;%&nbsp;(_seconds,)&lt;BR&gt;-&nbsp;tple&nbsp;=&nbsp;DelayedCall(seconds()&nbsp;+&nbsp;_seconds,&nbsp;_f,&nbsp;args,&nbsp;kw,&lt;BR&gt;+&nbsp;if&nbsp;_seconds&nbsp;==&nbsp;0:&lt;BR&gt;+&nbsp;tcc&nbsp;=&nbsp;0&lt;BR&gt;+&nbsp;else:&lt;BR&gt;+&nbsp;tcc&nbsp;=&nbsp;seconds()&nbsp;+&nbsp;_seconds&lt;BR&gt;+&nbsp;tple&nbsp;=<br>
&nbsp;DelayedCall(tcc,&nbsp;_f,&nbsp;args,&nbsp;kw,&lt;BR&gt;self._pendingTimedCalls.remove,&lt;BR&gt;self._resetCallLater)&lt;BR&gt;insort(self._pendingTimedCalls,&nbsp;tple)&lt;BR&gt;@@&nbsp;-416,7&nbsp;+420,10&nbsp;@@&lt;BR&gt;count&nbsp;+=&nbsp;1&lt;BR&gt;del&nbsp;self.threadCallQueue[:count]&lt;BR&gt;now&nbsp;=&nbsp;seconds()&lt;BR&gt;-&nbsp;while&nbsp;self._pendingTimedCalls&nbsp;and&nbsp;(self._pendingTimedCalls[-1].time&nbsp;&lt;=&nbsp;now):&lt;BR&gt;+&nbsp;#&nbsp;make&nbsp;sure&nbsp;we&nbsp;don't&nbsp;run&nbsp;newly&nbsp;added&nbsp;calls,&nbsp;so&nbsp;we&nbsp;don't&nbsp;get&nbsp;into&nbsp;infinite&nbsp;loop&lt;BR&gt;+&nbsp;numCalls&nbsp;=&nbsp;len(self._pendingTimedCalls)&lt;BR&gt;+&nbsp;while&nbsp;numCalls&nbsp;and&nbsp;(self._pendingTimedCalls[-1].time&nbsp;&lt;=&nbsp;now):&lt;BR&gt;+&nbsp;numCalls&nbsp;-=&nbsp;1&lt;BR&gt;call&nbsp;=&nbsp;self._pendingTimedCalls.pop()&lt;BR&gt;try:&lt;BR&gt;call.called&nbsp;=&nbsp;1&lt;BR&gt;&lt;/BLOCKQUOTE&gt;&lt;BR&gt;&lt;BR&gt;Bill&nbsp;la&nbsp;Forge&lt;br&gt;http://www.geocities.com/laforge49/&lt;p&gt;&lt;font&nbsp;face=arial&nbsp;size=-1&gt;<br>
&lt;a&nbsp;href=&quot;http://in.rd.yahoo.com/specials/mailtg/*http://yahoo.shaadi.com/india-matrimony/&quot;&nbsp;target=&quot;_blank&quot;&gt;<br>
&lt;b&gt;Yahoo!&nbsp;India&nbsp;Matrimony&lt;/a&gt;:&lt;/b&gt;&nbsp;Find&nbsp;your&nbsp;partner&nbsp;<br>
&lt;a&nbsp;href=&quot;http://in.rd.yahoo.com/specials/mailtg2/*http://yahoo.shaadi.com/india-matrimony/community.php&quot;&nbsp;target=&quot;_blank&quot;&gt;online&lt;/a&gt;.&lt;/font&gt;
</tt>
