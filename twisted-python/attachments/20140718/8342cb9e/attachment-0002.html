<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;We&nbsp;recently&nbsp;started&nbsp;experiencing&nbsp;the&nbsp;following&nbsp;error:&nbsp;&lt;b&gt;RuntimeError:&nbsp;maximum&nbsp;recursion&nbsp;depth&nbsp;exceeded&nbsp;while&nbsp;calling&nbsp;a&nbsp;Python&nbsp;object&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;After&nbsp;a&nbsp;fair&nbsp;bit&nbsp;of&nbsp;debugging&nbsp;we&nbsp;eventually&nbsp;found&nbsp;the&nbsp;problem&nbsp;and&nbsp;implemented&nbsp;a&nbsp;fix&nbsp;for&nbsp;it&nbsp;in&nbsp;our&nbsp;codebase.&nbsp;We&nbsp;found&nbsp;that&nbsp;if&nbsp;a&nbsp;waiting&lt;br&gt;<br>
&lt;/div&gt;queue&nbsp;on&nbsp;a&nbsp;DeferredLock&nbsp;is&nbsp;~125&nbsp;(depending&nbsp;on&nbsp;call &nbsp;depth)&nbsp;the&nbsp;error&nbsp;can&nbsp;error.&nbsp;I&nbsp;recommend&nbsp;releasing&nbsp;the&nbsp;lock&nbsp;in&nbsp;a&nbsp;callLater.&lt;br&gt;&lt;br&gt;&lt;/div&gt;The&nbsp;offending&nbsp;line&nbsp;is&nbsp;here:&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/trac/browser/trunk/twisted/internet/defer.py#L1360&quot;&gt;https://twistedmatrix.com/trac/browser/trunk/twisted/internet/defer.py#L1360&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;And&nbsp;the&nbsp;script&nbsp;below&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;issue.&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;#!/usr/bin/env&nbsp;python&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;defer,&nbsp;reactor&lt;br&gt;&lt;br&gt;LOCK&nbsp;=&nbsp;defer.DeferredLock()&lt;br&gt;FIRST_RUN&nbsp;=&nbsp;True&lt;br&gt;<br>
&lt;br&gt;def&nbsp;deferred_sleep(delay):&lt;br&gt;   &nbsp;d&nbsp;=&nbsp;defer.Deferred()&lt;br&gt;   &nbsp;delay&nbsp;=&nbsp;reactor.callLater(delay,&nbsp;d.callback,&nbsp;True)&lt;br&gt;   &nbsp;d.delay&nbsp;=&nbsp;delay&lt;br&gt;   &nbsp;return&nbsp;d&lt;br&gt;&lt;br&gt;@defer.inlineCallbacks&lt;br&gt;def&nbsp;synchronized_call():&lt;br&gt;   &nbsp;global&nbsp;FIRST_RUN&lt;br&gt;<br>
   &nbsp;yield&nbsp;LOCK.acquire()&lt;br&gt;   &nbsp;try:&lt;br&gt;       &nbsp;if&nbsp;FIRST_RUN:&lt;br&gt;           &nbsp;FIRST_RUN&nbsp;=&nbsp;False&lt;br&gt;           &nbsp;yield&nbsp;deferred_sleep(2)&lt;br&gt;           &nbsp;print&nbsp;&quot;Queue&nbsp;length:&nbsp;%s&quot;&nbsp;%&nbsp;len(LOCK.waiting)&lt;br&gt;   &nbsp;finally:&lt;br&gt;<br>
       &nbsp;LOCK.release()&lt;br&gt;       &nbsp;#reactor.callLater(0,&nbsp;lambda:&nbsp;LOCK.release())&lt;br&gt;&lt;br&gt;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;&#39;__main__&#39;:&lt;br&gt;   &nbsp;count&nbsp;=&nbsp;125&lt;br&gt;   &nbsp;def&nbsp;start_test():&lt;br&gt;       &nbsp;for&nbsp;i&nbsp;in&nbsp;xrange(count):&lt;br&gt;           &nbsp;synchronized_call()&lt;br&gt;<br>
   &nbsp;&lt;br&gt;   &nbsp;reactor.callWhenRunning(start_test)&lt;br&gt;   &nbsp;reactor.run()&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://www.ml.sun.ac.za/&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;/a&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
