<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Nov&nbsp;6,&nbsp;2012&nbsp;at&nbsp;10:49&nbsp;PM,&nbsp;Matt&nbsp;Freeman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matt@nonuby.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matt@nonuby.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;I&nbsp;asked&nbsp;this&nbsp;question&nbsp;on &nbsp;Stackoverflow&nbsp;(even&nbsp;offered&nbsp;a&nbsp;bounty)&nbsp;and&nbsp;IRC:&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://stackoverflow.com/questions/13117502/twisted-conch-flow-control&quot;&nbsp;target=&quot;_blank&quot;&gt;http://stackoverflow.com/questions/13117502/twisted-conch-flow-control&lt;/a&gt;&lt;br&gt;<br>
<br>
<br>
--&lt;br&gt;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;I&nbsp;have&nbsp;a&nbsp;Twisted&nbsp;Conch&nbsp;SSH&nbsp;server&nbsp;and&nbsp;the&nbsp;typical&nbsp;scenario&nbsp;is&nbsp;this:&lt;/p&gt;<br>
<br>
&lt;p&gt;git&nbsp;via&nbsp;OpenSSH&nbsp;client&nbsp;&nbsp;&nbsp;&amp;gt;&amp;gt;---&nbsp;WAN1&nbsp;---&amp;gt;&amp;gt;&nbsp;Twisted&nbsp;conch&nbsp;svr&nbsp;&amp;gt;&amp;gt;---&nbsp;WAN2&nbsp;--&amp;gt;&amp;gt;&nbsp;Git&nbsp;server&lt;/p&gt;<br>
<br>
&lt;p&gt;There&nbsp;will&nbsp;be&nbsp;occassions&nbsp;that&nbsp;the&nbsp;&amp;#39;git&nbsp;push&amp;#39;&nbsp;is&nbsp;sending&nbsp;data&nbsp;faster&nbsp;<br>
over&nbsp;WAN1&nbsp;than&nbsp;I&nbsp;can&nbsp;proxy&nbsp;it&nbsp;over&nbsp;WAN2,&nbsp;so&nbsp;I&nbsp;need&nbsp;to&nbsp;tell&nbsp;the&nbsp;client&nbsp;to<br>
&nbsp;slow&nbsp;down&nbsp;(well&nbsp;before&nbsp;any&nbsp;TCP&nbsp;packet&nbsp;loss&nbsp;causes&nbsp;adjustments&nbsp;the&nbsp;TCP&nbsp;<br>
window&nbsp;size)&nbsp;to&nbsp;avoid&nbsp;buffering&nbsp;too&nbsp;much&nbsp;on&nbsp;the&nbsp;Twisted&nbsp;server.&nbsp;Reading&nbsp;<br>
the&nbsp;RFC&nbsp;for&nbsp;SSH&nbsp;this&nbsp;is&nbsp;accomplished&nbsp;with&nbsp;not&nbsp;acknowledging&nbsp;via&nbsp;adj&nbsp;<br>
window&nbsp;this&nbsp;will&nbsp;then&nbsp;cause&nbsp;the&nbsp;git&nbsp;push&nbsp;to&nbsp;block&nbsp;on&nbsp;syscall&nbsp;write&nbsp;to&nbsp;<br>
the&nbsp;pipe&nbsp;backed&nbsp;by&nbsp;openssh.&nbsp;&lt;/p&gt;<br>
<br>
&lt;p&gt;Looking&nbsp;at&nbsp;conch/ssh/connection.py:L216&nbsp;in&nbsp;the&nbsp;method&nbsp;&nbsp;def&nbsp;<br>
ssh_CHANNEL_DATA(self,&nbsp;packet):<br>
I&nbsp;can&nbsp;accomplish&nbsp;this&nbsp;with&nbsp;setting&nbsp;localWindowSize&nbsp;to&nbsp;0,&nbsp;and&nbsp;inflight&nbsp;<br>
data&nbsp;will&nbsp;still&nbsp;land&nbsp;as&nbsp;the&nbsp;predicate&nbsp;on&nbsp;230&nbsp;should&nbsp;still&nbsp;pass&nbsp;(give&nbsp;<br>
localWindowLeft).&nbsp;I&nbsp;am&nbsp;wondering&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;correct&nbsp;approach&nbsp;or&nbsp;am&nbsp;I<br>
&nbsp;missing&nbsp;something&nbsp;blindly&nbsp;obvious&nbsp;with&nbsp;regards&nbsp;to&nbsp;flow&nbsp;control&nbsp;with&nbsp;<br>
Twisted&nbsp;SSH&nbsp;Conch?&nbsp;*&lt;/p&gt;<br>
<br>
&lt;p&gt;Note:&nbsp;I&nbsp;acknowledge&nbsp;there&nbsp;are&nbsp;methods&nbsp;placeholders&nbsp;for&nbsp;stopWriting&nbsp;<br>
and&nbsp;startWriting&nbsp;on&nbsp;(channel)&nbsp;that&nbsp;I&nbsp;can&nbsp;override&nbsp;so&nbsp;I&nbsp;have&nbsp;hooks&nbsp;to&nbsp;<br>
control&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;transmission&nbsp;&amp;#39;git&nbsp;pull&amp;#39;,&nbsp;but&nbsp;Im&nbsp;interested<br>
&nbsp;in&nbsp;first&nbsp;leg.&nbsp;Also&nbsp;IPush/IPull&nbsp;producer&nbsp;dont&nbsp;seem&nbsp;applicable&nbsp;at&nbsp;<br>
this&nbsp;level&nbsp;and&nbsp;I&nbsp;cant&nbsp;see&nbsp;how&nbsp;I&nbsp;can&nbsp;tie&nbsp;in&nbsp;these&nbsp;higher&nbsp;abstraction&nbsp;<br>
without&nbsp;butchering&nbsp;conch?&lt;br&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;The&nbsp;general&nbsp;non-SSH&nbsp;specific&nbsp;answer&nbsp;is&nbsp;to&nbsp;use&nbsp;the&nbsp;producer&nbsp;API.&nbsp;Something&nbsp;like:&lt;br&gt;&lt;br&gt;   &nbsp;wan2transport.registerProducer(wan1transport,&nbsp;True)&lt;br&gt; &lt;br&gt;Assuming&nbsp;WAN2&nbsp;is&nbsp;also&nbsp;over&nbsp;SSH&nbsp;(it&nbsp;wasn&amp;#39;t&nbsp;quite&nbsp;clear),&nbsp;SSHChannel&nbsp;ideally&nbsp;should&nbsp;implement&nbsp;the&nbsp;producer&nbsp;and&nbsp;consumer&nbsp;APIs&nbsp;so&nbsp;you&nbsp;could&nbsp;do:&lt;br&gt;<br>
&lt;br&gt;   &nbsp;wan2channel.registerProducer(wan1channel,&nbsp;True)&lt;br&gt;&lt;br&gt;But,&nbsp;as&nbsp;you&nbsp;say,&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;implement&nbsp;those&nbsp;APIs.&nbsp;Thus&nbsp;it&nbsp;looks&nbsp;like&nbsp;you&amp;#39;d&nbsp;want&nbsp;to&nbsp;subclass&nbsp;SSHChannel,&nbsp;and&nbsp;have&nbsp;wan2&amp;#39;s&nbsp;SSHChannel.stop/startWriting&nbsp;call&nbsp;pause/resumeProducing&nbsp;on&nbsp;the&nbsp;WAN1&nbsp;channel&amp;#39;s&nbsp;*transport*&nbsp;(SSHConnection).&nbsp;Unless&nbsp;you&nbsp;have&nbsp;multiple&nbsp;channels&nbsp;in&nbsp;your&nbsp;incoming&nbsp;SSH&nbsp;connection&nbsp;that&nbsp;you&nbsp;want&nbsp;to&nbsp;pause/resume&nbsp;separately,&nbsp;and&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;sound&nbsp;like&nbsp;you&nbsp;do,&nbsp;this&nbsp;should&nbsp;work.&lt;br&gt;<br>
&lt;br&gt;twisted.conch.scripts.conch.SSHSession&nbsp;has&nbsp;an&nbsp;example&nbsp;of&nbsp;this,&nbsp;more&nbsp;or&nbsp;less,&nbsp;except&nbsp;that&nbsp;it&amp;#39;s&nbsp;pausing&nbsp;reading&nbsp;from&nbsp;stdin&nbsp;rather&nbsp;than&nbsp;another&nbsp;SSH&nbsp;connection.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Itamar&nbsp;Turner-Trauring,&nbsp;Future&nbsp;Foundries&nbsp;LLC&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://futurefoundries.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://futurefoundries.com/&lt;/a&gt;&nbsp;—&nbsp;Twisted&nbsp;consulting,&nbsp;training&nbsp;and&nbsp;support.&lt;br&gt;&lt;br&gt;<br>

</tt>
