<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;I&nbsp;asked&nbsp;this&nbsp;question&nbsp;onÂ &nbsp;Stackoverflow&nbsp;(even&nbsp;offered&nbsp;a&nbsp;bounty)&nbsp;and&nbsp;IRC:&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://stackoverflow.com/questions/13117502/twisted-conch-flow-control&quot;&nbsp;target=&quot;_blank&quot;&gt;http://stackoverflow.com/questions/13117502/twisted-conch-flow-control&lt;/a&gt;&lt;br&gt;<br>
<br>
--&lt;br&gt;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;I&nbsp;have&nbsp;a&nbsp;Twisted&nbsp;Conch&nbsp;SSH&nbsp;server&nbsp;and&nbsp;the&nbsp;typical&nbsp;scenario&nbsp;is&nbsp;this:&lt;/p&gt;<br>
<br>
&lt;p&gt;git&nbsp;via&nbsp;OpenSSH&nbsp;client&nbsp;&nbsp;&nbsp;&amp;gt;&amp;gt;---&nbsp;WAN1&nbsp;---&amp;gt;&amp;gt;&nbsp;Twisted&nbsp;conch&nbsp;svr&nbsp;&amp;gt;&amp;gt;---&nbsp;WAN2&nbsp;--&amp;gt;&amp;gt;&nbsp;Git&nbsp;server&lt;/p&gt;<br>
<br>
&lt;p&gt;There&nbsp;will&nbsp;be&nbsp;occassions&nbsp;that&nbsp;the&nbsp;&amp;#39;git&nbsp;push&amp;#39;&nbsp;is&nbsp;sending&nbsp;data&nbsp;faster&nbsp;<br>
over&nbsp;WAN1&nbsp;than&nbsp;I&nbsp;can&nbsp;proxy&nbsp;it&nbsp;over&nbsp;WAN2,&nbsp;so&nbsp;I&nbsp;need&nbsp;to&nbsp;tell&nbsp;the&nbsp;client&nbsp;to<br>
&nbsp;slow&nbsp;down&nbsp;(well&nbsp;before&nbsp;any&nbsp;TCP&nbsp;packet&nbsp;loss&nbsp;causes&nbsp;adjustments&nbsp;the&nbsp;TCP&nbsp;<br>
window&nbsp;size)&nbsp;to&nbsp;avoid&nbsp;buffering&nbsp;too&nbsp;much&nbsp;on&nbsp;the&nbsp;Twisted&nbsp;server.&nbsp;Reading&nbsp;<br>
the&nbsp;RFC&nbsp;for&nbsp;SSH&nbsp;this&nbsp;is&nbsp;accomplished&nbsp;with&nbsp;not&nbsp;acknowledging&nbsp;via&nbsp;adj&nbsp;<br>
window&nbsp;this&nbsp;will&nbsp;then&nbsp;cause&nbsp;the&nbsp;git&nbsp;push&nbsp;to&nbsp;block&nbsp;on&nbsp;syscall&nbsp;write&nbsp;to&nbsp;<br>
the&nbsp;pipe&nbsp;backed&nbsp;by&nbsp;openssh.&nbsp;&lt;/p&gt;<br>
<br>
&lt;p&gt;Looking&nbsp;at&nbsp;conch/ssh/connection.py:L216&nbsp;in&nbsp;the&nbsp;method&nbsp;&nbsp;def&nbsp;<br>
ssh_CHANNEL_DATA(self,&nbsp;packet):<br>
I&nbsp;can&nbsp;accomplish&nbsp;this&nbsp;with&nbsp;setting&nbsp;localWindowSize&nbsp;to&nbsp;0,&nbsp;and&nbsp;inflight&nbsp;<br>
data&nbsp;will&nbsp;still&nbsp;land&nbsp;as&nbsp;the&nbsp;predicate&nbsp;on&nbsp;230&nbsp;should&nbsp;still&nbsp;pass&nbsp;(give&nbsp;<br>
localWindowLeft).&nbsp;I&nbsp;am&nbsp;wondering&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;correct&nbsp;approach&nbsp;or&nbsp;am&nbsp;I<br>
&nbsp;missing&nbsp;something&nbsp;blindly&nbsp;obvious&nbsp;with&nbsp;regards&nbsp;to&nbsp;flow&nbsp;control&nbsp;with&nbsp;<br>
Twisted&nbsp;SSH&nbsp;Conch?&nbsp;*&lt;/p&gt;<br>
<br>
&lt;p&gt;Note:&nbsp;I&nbsp;acknowledge&nbsp;there&nbsp;are&nbsp;methods&nbsp;placeholders&nbsp;for&nbsp;stopWriting&nbsp;<br>
and&nbsp;startWriting&nbsp;on&nbsp;(channel)&nbsp;that&nbsp;I&nbsp;can&nbsp;override&nbsp;so&nbsp;I&nbsp;have&nbsp;hooks&nbsp;to&nbsp;<br>
control&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;transmission&nbsp;&amp;#39;git&nbsp;pull&amp;#39;,&nbsp;but&nbsp;Im&nbsp;interested<br>
&nbsp;in&nbsp;first&nbsp;leg.&nbsp;Also&nbsp;IPush/IPull&nbsp;producer&nbsp;dont&nbsp;seem&nbsp;applicable&nbsp;at&nbsp;<br>
this&nbsp;level&nbsp;and&nbsp;I&nbsp;cant&nbsp;see&nbsp;how&nbsp;I&nbsp;can&nbsp;tie&nbsp;in&nbsp;these&nbsp;higher&nbsp;abstraction&nbsp;<br>
without&nbsp;butchering&nbsp;conch?&nbsp;&lt;/p&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;/span&gt;--&nbsp;&lt;br&gt;&lt;/div&gt;Matt&nbsp;Freeman&nbsp;-&nbsp;@nonuby&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;http://blog.nonuby.com&quot;&nbsp;target=&quot;_blank&quot;&gt;http://blog.nonuby.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;<br>

</tt>
