<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;color:#000;&nbsp;background-color:#fff;&nbsp;font-family:HelveticaNeue,&nbsp;Helvetica&nbsp;Neue,&nbsp;Helvetica,&nbsp;Arial,&nbsp;Lucida&nbsp;Grande,&nbsp;sans-serif;font-size:14px&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2610&quot;&gt;Hello,&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2664&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2701&quot;&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;a&nbsp;small&nbsp;problem.&nbsp;I&nbsp;using&nbsp;SMTPClient&nbsp;and&nbsp;ClientFactory&nbsp;in&nbsp;order&nbsp;to&nbsp;send&nbsp;emails.&nbsp;I&nbsp;have&nbsp;something&nbsp;like:&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2800&quot;&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;observer['workers']&nbsp;=&nbsp;total&nbsp;mails&nbsp;to&nbsp;send(connections)&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2801&quot;&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2701&quot;&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;got_result(*args):&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;observer['results']&nbsp;+=&nbsp;1&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;got_error(err):&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;observer['errors']&nbsp;+=&nbsp;1&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;got_end(_):&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;observer['results']&nbsp;+&nbsp;observer['errors']&nbsp;==&nbsp;observer['workers']:&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactor.stop()&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2820&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2821&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;factory&nbsp;=&nbsp;SomeFactory(...)&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2843&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;reactor.connectTCP(...)&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_3007&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;d.addCallbacks(got_result,&nbsp;got_error)&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;d.addBoth(got_end)&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2992&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_3187&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;class&nbsp;SomeFactory(ClientFactory):&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_3186&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;clientConnectionLost(self,&nbsp;connector,&nbsp;reason):&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.error_handle(reason)&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;error_handle(self,&nbsp;reason):&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.deferred&nbsp;is&nbsp;not&nbsp;None:&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d,&nbsp;self.deferred&nbsp;=&nbsp;self.deferred,&nbsp;None&lt;br&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.errback(reason)&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_3176&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_3195&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2846&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;&quot;&nbsp;id=&quot;result_box&quot;&nbsp;class=&quot;&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;Everything&nbsp;&nbsp;&lt;/span&gt;&lt;/span&gt;is&nbsp;working&nbsp;ok&nbsp;if&nbsp;I&nbsp;don't&nbsp;have&nbsp;errors&nbsp;like:&nbsp;[Failure&nbsp;instance:&nbsp;Traceback&nbsp;(failure&nbsp;with&nbsp;no&nbsp;frames):&nbsp;&lt;class&nbsp;'twisted.internet.error.ConnectionLost'&gt;:&nbsp;Connection&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;was&nbsp;lost&nbsp;in&nbsp;a&nbsp;non-clean&nbsp;fashion:&nbsp;Connection&nbsp;lost.&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_3204&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;When&nbsp;I&nbsp;have&nbsp;a&nbsp;error&nbsp;like&nbsp;that,&nbsp;the&nbsp;rector&nbsp;is&nbsp;not&nbsp;stopping&nbsp;because&nbsp;the&nbsp;error&nbsp;counter&nbsp;is&nbsp;not&nbsp;&lt;span&nbsp;style=&quot;&quot;&nbsp;id=&quot;result_box&quot;&nbsp;class=&quot;&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;id=&quot;yui_3_16_0_1_1417713573151_3517&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;incrementing&lt;/span&gt;&lt;/span&gt;.&nbsp;But&nbsp;when&nbsp;I&nbsp;kill&nbsp;the&nbsp;reactor,&nbsp;got_error()&nbsp;receive&nbsp;the&nbsp;errors&nbsp;and&nbsp;observer['results']&nbsp;+&nbsp;observer['errors']&nbsp;==&nbsp;observer['workers']&nbsp;is&nbsp;&lt;span&nbsp;style=&quot;&quot;&nbsp;id=&quot;result_box&quot;&nbsp;class=&quot;&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;id=&quot;yui_3_16_0_1_1417713573151_4243&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;evaluated&nbsp;and&nbsp;the&nbsp;reactor&nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;&quot;&nbsp;id=&quot;result_box&quot;&nbsp;class=&quot;&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;id=&quot;yui_3_16_0_1_1417713573151_4243&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;&quot;&nbsp;id=&quot;result_box&quot;&nbsp;class=&quot;&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&gt;stops&lt;/span&gt;&lt;/span&gt;(with&nbsp;a&nbsp;error&nbsp;of&nbsp;course,&nbsp;Can't&nbsp;stop&nbsp;reactor&nbsp;that&nbsp;isn't&nbsp;running&nbsp;:))&lt;/span&gt;&lt;/span&gt;.&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2821&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_4260&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;don't&nbsp;understand&nbsp;how&nbsp;can&nbsp;I&nbsp;make&nbsp;this&nbsp;work.&nbsp;Can&nbsp;someone&nbsp;help&nbsp;me?&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_4261&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_4262&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;Thanks,&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1417713573151_2845&quot;&nbsp;style=&quot;&quot;&nbsp;class=&quot;&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
