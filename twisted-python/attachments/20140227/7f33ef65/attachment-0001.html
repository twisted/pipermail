<tt>
&lt;div&nbsp;class=&quot;markdown&quot;&gt;<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Hi&nbsp;all,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;I&nbsp;am&nbsp;using&nbsp;Twisted&nbsp;Web&nbsp;WSGIResource&nbsp;to&nbsp;host&nbsp;a&nbsp;Django&nbsp;site.&nbsp;Here's&nbsp;the&nbsp;code&nbsp;I&nbsp;use&nbsp;to&nbsp;setup&nbsp;the&nbsp;WSGI&nbsp;resource&nbsp;(other&nbsp;boilerplate&nbsp;skipped)&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;def&nbsp;wsgi&lt;em&gt;resource():&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;django.core.handlers.wsgi&nbsp;import&nbsp;WSGIHandler&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;pool&nbsp;=&nbsp;threadpool.ThreadPool()&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;pool.start()&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Allow&nbsp;Ctrl-C&nbsp;to&nbsp;get&nbsp;you&nbsp;out&nbsp;cleanly:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;reactor.addSystemEventTrigger('after',&nbsp;'shutdown',&nbsp;pool.stop)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;wsgi&lt;/em&gt;resource&nbsp;=&nbsp;wsgi.WSGIResource(reactor,&nbsp;pool,&nbsp;WSGIHandler())&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;wsgi_resource&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;This&nbsp;generally&nbsp;worked&nbsp;quite&nbsp;well.&nbsp;However&nbsp;I&nbsp;have&nbsp;an&nbsp;API&nbsp;endpoint&nbsp;that&nbsp;gets&nbsp;hit&nbsp;with&nbsp;multiple&nbsp;POST&nbsp;requests&nbsp;per&nbsp;second&nbsp;(not&nbsp;very&nbsp;much&nbsp;-&nbsp;I'd&nbsp;say&nbsp;10-20&nbsp;req/sec&nbsp;at&nbsp;most).&nbsp;Sometimes&nbsp;I&nbsp;see&nbsp;this&nbsp;in&nbsp;the&nbsp;logs:&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Internal&nbsp;Server&nbsp;Error:&nbsp;/cas/eventlog/&lt;br&gt;<br>
Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;<br>
&nbsp;&nbsp;File&nbsp;&quot;/site-packages/django/core/handlers/base.py&quot;,&nbsp;line&nbsp;114,&nbsp;in&nbsp;get&lt;em&gt;response&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;response&nbsp;=&nbsp;wrapped&lt;/em&gt;callback(request,&nbsp;&lt;em&gt;callback_args,&nbsp;*&lt;/em&gt;callback&lt;em&gt;kwargs)&lt;br&gt;<br>
&nbsp;&nbsp;File&nbsp;&quot;/site-packages/django/views/decorators/csrf.py&quot;,&nbsp;line&nbsp;57,&nbsp;in&nbsp;wrapped&lt;/em&gt;view&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;view&lt;em&gt;func(&lt;em&gt;args,&nbsp;*&lt;/em&gt;kwargs)&lt;br&gt;<br>
&nbsp;&nbsp;File&nbsp;&quot;/views.py&quot;,&nbsp;line&nbsp;488,&nbsp;in&nbsp;event&lt;/em&gt;log&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;json.loads(request.body)&lt;br&gt;<br>
&nbsp;&nbsp;File&nbsp;&quot;/site-packages/django/http/request.py&quot;,&nbsp;line&nbsp;192,&nbsp;in&nbsp;body&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;self.&lt;em&gt;body&nbsp;=&nbsp;self.read()&lt;br&gt;<br>
&nbsp;&nbsp;File&nbsp;&quot;/site-packages/django/http/request.py&quot;,&nbsp;line&nbsp;246,&nbsp;in&nbsp;read&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.&lt;/em&gt;stream.read(&lt;em&gt;args,&nbsp;*&lt;/em&gt;kwargs)&lt;br&gt;<br>
&nbsp;&nbsp;File&nbsp;&quot;/site-packages/django/core/handlers/wsgi.py&quot;,&nbsp;line&nbsp;45,&nbsp;in&nbsp;read&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;self.buffer&nbsp;+&nbsp;self.&lt;em&gt;read&lt;/em&gt;limited()&lt;br&gt;<br>
&nbsp;&nbsp;File&nbsp;&quot;/site-packages/django/core/handlers/wsgi.py&quot;,&nbsp;line&nbsp;39,&nbsp;in&nbsp;&lt;em&gt;read&lt;/em&gt;limited&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;self.stream.read(size)&lt;br&gt;<br>
&nbsp;&nbsp;File&nbsp;&quot;/site-packages/twisted/web/wsgi.py&quot;,&nbsp;line&nbsp;94,&nbsp;in&nbsp;read&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._wrapped.read(size)&lt;br&gt;<br>
ValueError:&nbsp;I/O&nbsp;operation&nbsp;on&nbsp;closed&nbsp;file.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Any&nbsp;pointers&nbsp;on&nbsp;why&nbsp;would&nbsp;this&nbsp;happen?&nbsp;Why&nbsp;would&nbsp;Twisted&nbsp;close&nbsp;the&nbsp;file&nbsp;early?&nbsp;Could&nbsp;it&nbsp;be&nbsp;that&nbsp;I&nbsp;need&nbsp;to&nbsp;increase&nbsp;the&nbsp;threadpool&nbsp;size?&nbsp;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;I&nbsp;use&nbsp;treq&nbsp;0.2.0&nbsp;for&nbsp;the&nbsp;requests,&nbsp;with&nbsp;the&nbsp;&quot;persistent&quot;&nbsp;flag&nbsp;turned&nbsp;on,&nbsp;if&nbsp;that&nbsp;makes&nbsp;any&nbsp;difference.&nbsp;Twisted&nbsp;13.2.0&nbsp;and&nbsp;Django&nbsp;1.6,&nbsp;python&nbsp;2.7.1&nbsp;on&nbsp;OS&nbsp;X&nbsp;10.7.5.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Many&nbsp;thanks,&lt;br&gt;<br>
Orestis&lt;/p&gt;<br>
<br>
&lt;/div&gt;
</tt>
