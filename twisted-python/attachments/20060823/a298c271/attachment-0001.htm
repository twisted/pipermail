<tt>
&lt;div&gt;&lt;br&gt;Hi,&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;Apologies,&nbsp;please&nbsp;disregard&nbsp;the&nbsp;previous&nbsp;email&nbsp;-&nbsp;here&nbsp;is&nbsp;the&nbsp;good&nbsp;one.&lt;/div&gt;<br>
&lt;p&gt;I&nbsp;need&nbsp;to&nbsp;connect&nbsp;to&nbsp;a&nbsp;PerspectiveBroker&nbsp;from&nbsp;a&nbsp;VB&nbsp;application.&nbsp;&lt;br&gt;I&nbsp;did&nbsp;it&nbsp;with&nbsp;a&nbsp;com&nbsp;server&nbsp;in&nbsp;python,&nbsp;which&nbsp;works&nbsp;fine&nbsp;when&nbsp;the&nbsp;com&nbsp;client&nbsp;is&nbsp;also&nbsp;python&nbsp;code.&lt;br&gt;All&nbsp;the&nbsp;calls&nbsp;must&nbsp;be&nbsp;synchronous&nbsp;to&nbsp;the&nbsp;com&nbsp;server.&nbsp;<br>
&lt;br&gt;When&nbsp;Calling&nbsp;from&nbsp;VB&nbsp;it&nbsp;works&nbsp;fine&nbsp;every&nbsp;time&nbsp;if&nbsp;the&nbsp;function&nbsp;used&nbsp;from&nbsp;the&nbsp;com&nbsp;server&nbsp;don't&nbsp;use&nbsp;the&nbsp;reactor.&lt;/p&gt;<br>
&lt;p&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;when&nbsp;I&nbsp;call&nbsp;(from&nbsp;the&nbsp;VB&nbsp;com&nbsp;client)&nbsp;the&nbsp;functions&nbsp;that&nbsp;uses&nbsp;the&nbsp;twisted&nbsp;reactor&nbsp;it&nbsp;performs&nbsp;well&nbsp;the&nbsp;first&nbsp;time&nbsp;but&nbsp;for&nbsp;the&nbsp;the&nbsp;second&nbsp;time&nbsp;it's&nbsp;called,&nbsp;it&nbsp;stalls.&nbsp;I&nbsp;have&nbsp;to&nbsp;kill&nbsp;the&nbsp;vb&nbsp;executable.&nbsp;<br>
&lt;br&gt;The&nbsp;function&nbsp;from&nbsp;the&nbsp;test&nbsp;code&nbsp;is:&nbsp;testBroker()&lt;/p&gt;<br>
&lt;p&gt;Please&nbsp;can&nbsp;you&nbsp;help&nbsp;me&nbsp;to&nbsp;shed&nbsp;some&nbsp;light&nbsp;on&nbsp;this?&nbsp;Should&nbsp;I&nbsp;do&nbsp;it&nbsp;another&nbsp;way?&nbsp;Bellow&nbsp;is&nbsp;the&nbsp;code&nbsp;that&nbsp;I&nbsp;am&nbsp;using.&lt;/p&gt;<br>
&lt;p&gt;Many&nbsp;thanks&lt;br&gt;Miguel&lt;/p&gt;<br>
&lt;p&gt;----------------------------------------------------&lt;br&gt;The&nbsp;code&nbsp;for&nbsp;the&nbsp;python&nbsp;com&nbsp;client&nbsp;:&lt;/p&gt;<br>
&lt;p&gt;import&nbsp;win32com.client&lt;br&gt;object&nbsp;=&nbsp;win32com.client.Dispatch(&amp;quot;Python.TestServer&amp;quot;)&lt;br&gt;print&nbsp;object.gettestresult&nbsp;()&lt;br&gt;print&nbsp;object.testBroker()&lt;br&gt;print&nbsp;object.gettestresult&nbsp;()&lt;/p&gt;<br>
&lt;p&gt;----------------------------------------------------&lt;br&gt;The&nbsp;code&nbsp;for&nbsp;the&nbsp;VB&nbsp;com&nbsp;client:&lt;/p&gt;<br>
&lt;p&gt;Private&nbsp;Sub&nbsp;TestComServer()&lt;br&gt;&amp;nbsp;Dim&nbsp;y&nbsp;As&nbsp;Object&lt;br&gt;&amp;nbsp;Set&nbsp;y&nbsp;=&nbsp;CreateObject(&amp;quot;Python.TestServer&amp;quot;)&nbsp;&lt;br&gt;&amp;nbsp;MsgBox&nbsp;y.gettestresult&lt;br&gt;&amp;nbsp;MsgBox&nbsp;y.testBroker()&lt;br&gt;&amp;nbsp;MsgBox&nbsp;y.gettestresult()&lt;br&gt;&amp;nbsp;Set&nbsp;y&nbsp;=&nbsp;Nothing&lt;br&gt;End&nbsp;Sub<br>
&lt;br&gt;----------------------------------------------------&lt;br&gt;the&nbsp;code&nbsp;for&nbsp;the&nbsp;python&nbsp;comserver:&lt;/p&gt;<br>
&lt;p&gt;#testcom.py&lt;br&gt;from&nbsp;twisted.spread&nbsp;import&nbsp;pb&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor,&nbsp;defer&lt;br&gt;from&nbsp;twisted.python&nbsp;import&nbsp;util&lt;br&gt;import&nbsp;sys&lt;br&gt;import&nbsp;time&lt;br&gt;import&nbsp;socket&nbsp;&lt;/p&gt;<br>
&lt;p&gt;class&nbsp;HelloWorld:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;_reg_clsid_&nbsp;=&nbsp;&amp;quot;{7CC9F362-486D-11D1-BB48-0000E838A65F}&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;_reg_desc_&nbsp;=&nbsp;&amp;quot;Python&nbsp;Test&nbsp;COM&nbsp;Server&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;_reg_progid_&nbsp;=&nbsp;&amp;quot;Python.TestServer&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;_public_methods_&nbsp;=&nbsp;['testBroker','gettestresult']&nbsp;<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.sText='sText10'&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.reactorFinished=False&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;get_ip(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;addrs&nbsp;=&nbsp;socket.getaddrinfo(socket.gethostname(),&nbsp;None)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;addr&nbsp;=&nbsp;addrs[0]&nbsp;<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;IPaddr&nbsp;=&nbsp;addr[4][0]&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;IPaddr&nbsp;#&amp;quot;localhost&amp;quot;&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;get_ip(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;&amp;quot;localhost&amp;quot;&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;get_port(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;8786&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;DealWithReactor(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;now&nbsp;=&nbsp;time.localtime(time.time())&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;factory&nbsp;=&nbsp;pb.PBClientFactory()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.connectTCP(self.get_ip(),&nbsp;self.get_port(),&nbsp;factory)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d&nbsp;=&nbsp;factory.getRootObject<br>
&nbsp;()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;strt=&amp;quot;hello&nbsp;network&nbsp;&amp;quot;&amp;nbsp;&nbsp;+&nbsp;'&nbsp;'&nbsp;+&nbsp;time.asctime(now)&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d.addCallback(lambda&nbsp;object:&nbsp;object.callRemote(&amp;quot;echo&amp;quot;,&nbsp;strt))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d.addErrback(lambda&nbsp;reason:&nbsp;'error:&nbsp;'+str(reason.value<br>
&nbsp;))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d.addCallback(self.StopReactor)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.run()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;StopReactor(self,obj):&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.stop()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.reactorFinished=True&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.sText=str(obj)&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;obj&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;testBroker(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.reactorFinished=False&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.DealWithReactor()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;while&nbsp;self.reactorFinished==False:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;pass&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;'OK&nbsp;testBroker22&nbsp;<br>
self.reactorFinished:'&nbsp;+&nbsp;str(self.reactorFinished)&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;gettestresult(self):&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;&amp;quot;gettestresult:&amp;quot;&nbsp;+&nbsp;str(self.sText)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;if&nbsp;__name__=='__main__':&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;import&nbsp;win32com.server.register&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;win32com.server.register.UseCommandLine<br>
&nbsp;(HelloWorld)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;h=HelloWorld()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print(h.gettestresult())&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print(h.testBroker())&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print(h.gettestresult())&lt;/p&gt;<br>
&lt;p&gt;&amp;nbsp;&lt;/p&gt;<br>

</tt>
