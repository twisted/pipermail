<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;Indeed,&nbsp;a&nbsp;Deferred&nbsp;should&nbsp;help.&nbsp;&nbsp;You&nbsp;can&nbsp;have&nbsp;one&nbsp;which&nbsp;is&nbsp;fired&nbsp;with&nbsp;the&lt;br&gt;SSHConnection&nbsp;once&nbsp;it&nbsp;is&nbsp;available.&nbsp;&nbsp;Then,&nbsp;callbacks&nbsp;on&nbsp;this&nbsp;Deferred&nbsp;will&lt;br&gt;be&nbsp;able&nbsp;to&nbsp;start&nbsp;any&nbsp;commands&nbsp;they&nbsp;want.&nbsp;&nbsp;One&nbsp;way&nbsp;to&nbsp;do&nbsp;this&nbsp;would&nbsp;be&nbsp;to&lt;br&gt;pass&nbsp;a&nbsp;Deferred&nbsp;all&nbsp;the&nbsp;way&nbsp;down&nbsp;into&nbsp;the&nbsp;SSHConnection&nbsp;and&nbsp;fire&nbsp;it&nbsp;with&lt;br&gt;`self´&nbsp;in&nbsp;`serviceStarted´.&nbsp;&nbsp;This&nbsp;basically&nbsp;turns&nbsp;control&nbsp;flow&nbsp;inside-out,&lt;br&gt;allowing&nbsp;arbitrary&nbsp;code&nbsp;which&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;SSHConnection&nbsp;class&nbsp;to&nbsp;use&lt;br&gt;the&nbsp;connection.&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hi&nbsp;Jean-Paul,&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;that&nbsp;advice&nbsp;-&nbsp;as&nbsp;you&nbsp;suggested&nbsp;I'm&nbsp;now&nbsp;passing&nbsp;a&nbsp;Deferred&nbsp;down&nbsp;into&nbsp;the&nbsp;SSHConnection&nbsp;to&nbsp;receive&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;object,&nbsp;which&nbsp;works&nbsp;really&nbsp;well.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;now&nbsp;have&nbsp;a&nbsp;follow-on&nbsp;question.&nbsp;This&nbsp;is&nbsp;my&nbsp;situation:&nbsp;I'd&nbsp;like&nbsp;to&nbsp;set&nbsp;up&nbsp;an&nbsp;SSHConnection&nbsp;and&nbsp;associate&nbsp;it&nbsp;with&nbsp;a&nbsp;Machine&nbsp;object&nbsp;at&nbsp;program&nbsp;startup,&nbsp;then&nbsp;execute&nbsp;arbitrary&nbsp;commands&nbsp;over&nbsp;this&nbsp;SSHConnection&nbsp;at&nbsp;run-time.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;I'm&nbsp;facing&nbsp;is&nbsp;that&nbsp;after&nbsp;instantiating&nbsp;the&nbsp;Twisted&nbsp;objects,&nbsp;calling&nbsp;reactor.run()&nbsp;doesn't&nbsp;return,&nbsp;so&nbsp;I&nbsp;can't&nbsp;create&nbsp;a&nbsp;standalone&nbsp;SSHConnection&nbsp;and&nbsp;attach&nbsp;it&nbsp;as&nbsp;a&nbsp;utility&nbsp;to&nbsp;a&nbsp;Machine&nbsp;object.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;example:&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;#0000ff&quot;&gt;class&lt;/span&gt;&nbsp;Machine(object):&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;#0000ff&quot;&gt;def&lt;/span&gt;&nbsp;__init__(self,&nbsp;address):&lt;/div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Monaco;&nbsp;font-size:&nbsp;11px;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.conn&nbsp;=&nbsp;MachineConnection(self,&nbsp;address,&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;170,&nbsp;0);&nbsp;&quot;&gt;'user'&lt;/span&gt;)&lt;/span&gt;&lt;p&nbsp;style=&quot;margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;min-height:&nbsp;15.0px&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;min-height:&nbsp;15.0px&quot;&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;#0000ff&quot;&gt;class&lt;/span&gt;&nbsp;MachineConnection(object):&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;#0000ff&quot;&gt;def&lt;/span&gt;&nbsp;__init__(self,&nbsp;address,&nbsp;user):&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.address&nbsp;=&nbsp;address&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.port&nbsp;=&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;#800000&quot;&gt;22&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.user&nbsp;=&nbsp;user&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d=defer.Deferred()&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.addCallback(self.__conn_ready)&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.addErrback(self.__conn_err)&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory&nbsp;=&nbsp;protocol.ClientFactory(self.user,&nbsp;d)&nbsp;#&nbsp;I'm&nbsp;actually&nbsp;using&nbsp;a&nbsp;subclass&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactor.connectTCP(self.address,&nbsp;self.port,&nbsp;factory)&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactor.run()&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;Here,&nbsp;I've&nbsp;left&nbsp;out&nbsp;definitions&nbsp;of&nbsp;my&nbsp;conch&nbsp;subclasses,&nbsp;and&nbsp;methods&nbsp;on&nbsp;Machine&nbsp;and&nbsp;MachineConnection,&nbsp;but&nbsp;I&nbsp;don't&nbsp;think&nbsp;they're&nbsp;relevant.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;The&nbsp;issue&nbsp;is&nbsp;that&nbsp;reactor.run()&nbsp;in&nbsp;the&nbsp;last&nbsp;line&nbsp;of&nbsp;MachineConnection.__init__&nbsp;starts&nbsp;Twisted&nbsp;up,&nbsp;creates&nbsp;the&nbsp;connection&nbsp;and&nbsp;so&nbsp;on,&nbsp;but&nbsp;doesn't&nbsp;return&nbsp;control&nbsp;to&nbsp;the&nbsp;original&nbsp;flow&nbsp;of&nbsp;code.&nbsp;I've&nbsp;tried&nbsp;starting&nbsp;separate&nbsp;threads&nbsp;for&nbsp;the&nbsp;connections,&nbsp;but&nbsp;Twisted&nbsp;seems&nbsp;to&nbsp;rely&nbsp;on&nbsp;running&nbsp;in&nbsp;the&nbsp;main&nbsp;thread.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;Are&nbsp;the&nbsp;any&nbsp;suggestions&nbsp;on&nbsp;how&nbsp;to&nbsp;set&nbsp;up&nbsp;backgrounded&nbsp;Twisted&nbsp;connections&nbsp;that&nbsp;can&nbsp;be&nbsp;interacted&nbsp;with&nbsp;as&nbsp;daemonic&nbsp;threads?&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;Thank&nbsp;you,&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;font:&nbsp;normal&nbsp;normal&nbsp;normal&nbsp;11px/normal&nbsp;Monaco;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;James&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
