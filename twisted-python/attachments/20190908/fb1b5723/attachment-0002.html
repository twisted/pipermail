<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;Indeed,&nbsp;in&nbsp;Twisted,&nbsp;the&nbsp;SSL.Connection&nbsp;is&nbsp;constructed&nbsp;with&nbsp;a&nbsp;memory&nbsp;BIO.&nbsp;And&nbsp;in&nbsp;fact&nbsp;there&nbsp;may&nbsp;not&nbsp;be&nbsp;a&nbsp;socket&nbsp;in&nbsp;the&nbsp;loop&nbsp;at&nbsp;all!&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;What&nbsp;are&nbsp;you&nbsp;trying&nbsp;to&nbsp;do&nbsp;with&nbsp;`getpeername()`?&nbsp;&nbsp;Hopefully&nbsp;there's&nbsp;a&nbsp;similar&nbsp;Twisted&nbsp;API&nbsp;that&nbsp;you&nbsp;could&nbsp;work&nbsp;with.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-glyph&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Sep&nbsp;5,&nbsp;2019,&nbsp;at&nbsp;11:07&nbsp;PM,&nbsp;Sean&nbsp;DiZazzo&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:sean.dizazzo@gmail.com&quot;&nbsp;class=&quot;&quot;&gt;sean.dizazzo@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;Perhaps&nbsp;this&nbsp;line&nbsp;from&nbsp;OpenSSL.SSL.Connection&nbsp;is&nbsp;a&nbsp;clue.&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&quot;socket&nbsp;may&nbsp;be&nbsp;None;&nbsp;in&nbsp;this&nbsp;case,&nbsp;the&nbsp;Connection&nbsp;is&nbsp;created&nbsp;with&nbsp;a&nbsp;memory&nbsp;BIO:&nbsp;see&nbsp;the&nbsp;bio_read(),&nbsp;bio_write(),&nbsp;and&nbsp;bio_shutdown()&nbsp;methods.&quot;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Connection&quot;&nbsp;class=&quot;&quot;&gt;https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Connection&lt;/a&gt;&lt;span&nbsp;style=&quot;color:rgb(64,64,64);font-family:Lato,proxima-nova,&quot;Helvetica&nbsp;Neue&quot;,Arial,sans-serif;font-size:16px;background-color:rgb(252,252,252)&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;input&nbsp;name=&quot;virtru-metadata&quot;&nbsp;type=&quot;hidden&quot;&nbsp;value=&quot;{&quot;email-policy&quot;:{&quot;state&quot;:&quot;closed&quot;,&quot;expirationUnit&quot;:&quot;days&quot;,&quot;disableCopyPaste&quot;:false,&quot;disablePrint&quot;:false,&quot;disableForwarding&quot;:false,&quot;enableNoauth&quot;:false,&quot;persistentProtection&quot;:false,&quot;expandedWatermarking&quot;:false,&quot;expires&quot;:false,&quot;isManaged&quot;:false},&quot;attachments&quot;:{},&quot;compose-id&quot;:&quot;1&quot;,&quot;compose-window&quot;:{&quot;secure&quot;:false}}&quot;&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Wed,&nbsp;Sep&nbsp;4,&nbsp;2019&nbsp;at&nbsp;1:38&nbsp;AM&nbsp;Arn&nbsp;Vollebregt&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:kpn.arn.vollebregt@gmail.com&quot;&nbsp;class=&quot;&quot;&gt;kpn.arn.vollebregt@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Hi,&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;noticed&nbsp;that&nbsp;PyOpenSSL&nbsp;SNI&nbsp;callbacks&nbsp;(set&nbsp;with&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;ctx.set_tlsext_servername_callback&lt;/i&gt;)&nbsp;receive&nbsp;a&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;OpenSSL.SSL.Connection&lt;/i&gt;&nbsp;object&nbsp;within&nbsp;Twisted&nbsp;that&nbsp;have&nbsp;an&nbsp;empty&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;_socket&lt;/i&gt;&nbsp;property,&nbsp;while&nbsp;this&nbsp;property&nbsp;&lt;u&nbsp;class=&quot;&quot;&gt;is&lt;/u&gt;&nbsp;actually&nbsp;set&nbsp;when&nbsp;using&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;PyOpenSSL&lt;/i&gt;&nbsp;directly.&nbsp;For&nbsp;my&nbsp;use-case&nbsp;this&nbsp;is&nbsp;a&nbsp;problem&nbsp;as&nbsp;I&nbsp;want&nbsp;to&nbsp;call&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;conn._socket.getpeername()&lt;/i&gt;&nbsp;to&nbsp;determine&nbsp;the&nbsp;peer's&nbsp;IP&nbsp;address.&nbsp;So&nbsp;I&nbsp;am&nbsp;wondering:&nbsp;why&nbsp;is&nbsp;this&nbsp;behaviour&nbsp;different?&nbsp;And&nbsp;how&nbsp;do&nbsp;I&nbsp;get&nbsp;the&nbsp;peer&nbsp;IP&nbsp;address?&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;---console---&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;user:~$&nbsp;sudo&nbsp;python&nbsp;testTwisted.py&nbsp;&amp;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;[3]&nbsp;32842&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;user:~$&nbsp;curl&nbsp;-s&nbsp;--insecure&nbsp;--key&nbsp;clientPrivateKey.pem&nbsp;--cert&nbsp;clientCertificate.pem&nbsp;&lt;a&nbsp;href=&quot;https://127.0.0.1/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://127.0.0.1&lt;/a&gt;&nbsp;&gt;&nbsp;/dev/null&lt;br&nbsp;class=&quot;&quot;&gt;'sniCallback'&nbsp;called.&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn._socket:&nbsp;None&lt;br&nbsp;class=&quot;&quot;&gt;'verifyCallback'&nbsp;called&nbsp;for&nbsp;result&nbsp;0&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn._socket:&nbsp;None&lt;br&nbsp;class=&quot;&quot;&gt;'verifyCallback'&nbsp;called&nbsp;for&nbsp;result&nbsp;1&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn._socket:&nbsp;None&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;user:~$&nbsp;sudo&nbsp;python&nbsp;testPyOpenSSL.py&nbsp;&amp;&lt;br&nbsp;class=&quot;&quot;&gt;[1]&nbsp;33270&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;user:~$&nbsp;curl&nbsp;-s&nbsp;--insecure&nbsp;--key&nbsp;clientPrivateKey.pem&nbsp;--cert&nbsp;clientCertificate.pem&nbsp;&lt;a&nbsp;href=&quot;https://127.0.0.1/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://127.0.0.1&lt;/a&gt;&nbsp;&gt;&nbsp;/dev/null&lt;br&nbsp;class=&quot;&quot;&gt;'sniCallback'&nbsp;called.&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn._socket:&nbsp;&lt;socket._socketobject&nbsp;object&nbsp;at&nbsp;0x7f34c5bd3130&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;class&nbsp;'OpenSSL.SSL.Connection'&gt;&lt;br&nbsp;class=&quot;&quot;&gt;'verifyCallback'&nbsp;called&nbsp;for&nbsp;result&nbsp;0&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn._socket:&nbsp;&lt;socket._socketobject&nbsp;object&nbsp;at&nbsp;0x7f34c5bd3130&gt;&lt;br&nbsp;class=&quot;&quot;&gt;'verifyCallback'&nbsp;called&nbsp;for&nbsp;result&nbsp;1&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn._socket:&nbsp;&lt;socket._socketobject&nbsp;object&nbsp;at&nbsp;0x7f34c5bd3130&gt;&lt;br&nbsp;class=&quot;&quot;&gt;127.0.0.1&nbsp;-&nbsp;-&nbsp;[29/Aug/2019&nbsp;11:45:47]&nbsp;&quot;GET&nbsp;/&nbsp;HTTP/1.1&quot;&nbsp;200&nbsp;-&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;------&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;---testTwisted.py---&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;###&nbsp;Generate&nbsp;server&nbsp;key&nbsp;material&nbsp;###&lt;br&nbsp;class=&quot;&quot;&gt;#<br>
&nbsp;openssl&nbsp;req&nbsp;-x509&nbsp;-nodes&nbsp;-days&nbsp;365&nbsp;-newkey&nbsp;rsa:2048&nbsp;-keyout&nbsp;<br>
serverPrivateKey.pem&nbsp;-out&nbsp;serverCertificate.pem&nbsp;-subj&nbsp;<br>
&quot;/C=''/O=''/OU=''/CN=server&quot;&lt;br&nbsp;class=&quot;&quot;&gt;###&nbsp;Generate&nbsp;client&nbsp;key&nbsp;material&nbsp;###&lt;br&nbsp;class=&quot;&quot;&gt;#<br>
&nbsp;openssl&nbsp;req&nbsp;-x509&nbsp;-nodes&nbsp;-days&nbsp;365&nbsp;-newkey&nbsp;rsa:2048&nbsp;-keyout&nbsp;<br>
clientPrivateKey.pem&nbsp;-out&nbsp;clientCertificate.pem&nbsp;-subj&nbsp;<br>
&quot;/C=''/O=''/OU=''/CN=client&quot;&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;__future__&nbsp;import&nbsp;print_function&lt;br&nbsp;class=&quot;&quot;&gt;#&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/12.0.0/core/howto/ssl.html&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/documents/12.0.0/core/howto/ssl.html&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;OpenSSL&nbsp;import&nbsp;SSL&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;ssl,&nbsp;reactor&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;twisted.web&nbsp;import&nbsp;server,&nbsp;resource&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;twisted.internet.protocol&nbsp;import&nbsp;Factory,&nbsp;Protocol&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;def&nbsp;verifyCallback(conn,&nbsp;cert,&nbsp;errno,&nbsp;depth,&nbsp;result):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print('\'verifyCallback\'&nbsp;called&nbsp;for&nbsp;result&nbsp;'&nbsp;+&nbsp;str(result))&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print('\tconn._socket:&nbsp;'&nbsp;+&nbsp;str(conn._socket))&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;True&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;def&nbsp;sniCallback(conn):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print('\'sniCallback\'&nbsp;called.')&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print('\tconn._socket:&nbsp;'&nbsp;+&nbsp;str(conn._socket))&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;class&nbsp;MainResource(resource.Resource):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;isLeaf&nbsp;=&nbsp;True&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;render_GET(self,&nbsp;request):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.responseHeaders.addRawHeader(&quot;Content-Type&quot;,&nbsp;&quot;text/html;&nbsp;charset=utf-8&quot;)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;b&quot;&lt;html&gt;&lt;body&gt;Hello&nbsp;World&lt;/body&gt;&lt;/html&gt;&quot;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;if&nbsp;__name__&nbsp;==&nbsp;'__main__':&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;myContextFactory&nbsp;=&nbsp;ssl.DefaultOpenSSLContextFactory(&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'serverPrivateKey.pem',&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'serverCertificate.pem'&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;ctx&nbsp;=&nbsp;myContextFactory.getContext()&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&lt;a&nbsp;href=&quot;https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_verify&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_verify&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;ctx.set_verify(SSL.VERIFY_PEER,&nbsp;verifyCallback)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&lt;a&nbsp;href=&quot;https://pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_tlsext_servername_callback&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_tlsext_servername_callback&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;ctx.set_tlsext_servername_callback(sniCallback)&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;site&nbsp;=&nbsp;server.Site(MainResource())&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;reactor.listenSSL(443,&nbsp;site,&nbsp;myContextFactory)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;reactor.run()&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;------&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;---testPyOpenSSL.py---&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;###&nbsp;Generate&nbsp;server&nbsp;key&nbsp;material&nbsp;###&lt;br&nbsp;class=&quot;&quot;&gt;#<br>
&nbsp;openssl&nbsp;req&nbsp;-x509&nbsp;-nodes&nbsp;-days&nbsp;365&nbsp;-newkey&nbsp;rsa:2048&nbsp;-keyout&nbsp;<br>
serverPrivateKey.pem&nbsp;-out&nbsp;serverCertificate.pem&nbsp;-subj&nbsp;<br>
&quot;/C=''/O=''/OU=''/CN=server&quot;&lt;br&nbsp;class=&quot;&quot;&gt;###&nbsp;Generate&nbsp;client&nbsp;key&nbsp;material&nbsp;###&lt;br&nbsp;class=&quot;&quot;&gt;#<br>
&nbsp;openssl&nbsp;req&nbsp;-x509&nbsp;-nodes&nbsp;-days&nbsp;365&nbsp;-newkey&nbsp;rsa:2048&nbsp;-keyout&nbsp;<br>
clientPrivateKey.pem&nbsp;-out&nbsp;clientCertificate.pem&nbsp;-subj&nbsp;<br>
&quot;/C=''/O=''/OU=''/CN=client&quot;&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;__future__&nbsp;import&nbsp;print_function&lt;br&nbsp;class=&quot;&quot;&gt;import&nbsp;socket,&nbsp;sys,&nbsp;os&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;SocketServer&nbsp;import&nbsp;BaseServer&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;BaseHTTPServer&nbsp;import&nbsp;HTTPServer&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;SimpleHTTPServer&nbsp;import&nbsp;SimpleHTTPRequestHandler&lt;br&nbsp;class=&quot;&quot;&gt;from&nbsp;OpenSSL&nbsp;import&nbsp;SSL&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;def&nbsp;verifyCallback(conn,&nbsp;cert,&nbsp;errno,&nbsp;depth,&nbsp;result):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print('\'verifyCallback\'&nbsp;called&nbsp;for&nbsp;result&nbsp;'&nbsp;+&nbsp;str(result))&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print('\tconn._socket:&nbsp;'&nbsp;+&nbsp;str(conn._socket))&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;True&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;def&nbsp;sniCallback(conn):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print('\'sniCallback\'&nbsp;called.')&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print('\tconn._socket:&nbsp;'&nbsp;+&nbsp;str(conn._socket))&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print(type(conn))&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;class&nbsp;SecureHTTPServer(HTTPServer):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;server_address,&nbsp;HandlerClass):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BaseServer.__init__(self,&nbsp;server_address,&nbsp;HandlerClass)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx&nbsp;=&nbsp;SSL.Context(SSL.TLSv1_2_METHOD)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.use_privatekey_file('serverPrivateKey.pem')&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.use_certificate_file('serverCertificate.pem')&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&lt;a&nbsp;href=&quot;https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_verify&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_verify&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.set_verify(SSL.VERIFY_PEER,&nbsp;verifyCallback)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&lt;a&nbsp;href=&quot;https://pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_tlsext_servername_callback&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_tlsext_servername_callback&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.set_tlsext_servername_callback(sniCallback)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.socket&nbsp;=&nbsp;SSL.Connection(ctx,&nbsp;socket.socket(self.address_family,self.socket_type))&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.server_bind()&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.server_activate()&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;shutdown_request(self,request):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.shutdown()&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;class&nbsp;SecureHTTPRequestHandler(SimpleHTTPRequestHandler):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;setup(self):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.connection&nbsp;=&nbsp;self.request&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.rfile&nbsp;=&nbsp;socket._fileobject(self.request,&nbsp;&quot;rb&quot;,&nbsp;self.rbufsize)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.wfile&nbsp;=&nbsp;socket._fileobject(self.request,&nbsp;&quot;wb&quot;,&nbsp;self.wbufsize)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;do_GET(self):&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_response(200)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SimpleHTTPRequestHandler.end_headers(self)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.wfile.write('&lt;html&gt;&lt;body&gt;Hello&nbsp;World&lt;/body&gt;&lt;/html&gt;')&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;if&nbsp;__name__&nbsp;==&nbsp;'__main__':&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;ip,port&nbsp;=&nbsp;('0.0.0.0',&nbsp;443)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;httpd&nbsp;=&nbsp;SecureHTTPServer((ip,&nbsp;port),&nbsp;SecureHTTPRequestHandler)&lt;br&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;httpd.serve_forever()&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;------&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;(Please&nbsp;note&nbsp;that&nbsp;even&nbsp;though&nbsp;these&nbsp;examples&nbsp;are&nbsp;for&nbsp;Python2&nbsp;(due&nbsp;to&nbsp;other&nbsp;quirks)&nbsp;I&nbsp;am&nbsp;aiming&nbsp;to&nbsp;implement&nbsp;this&nbsp;in&nbsp;Python3.)&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Regards,&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Arn&lt;/div&gt;&lt;/div&gt;<br>
_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>
_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;class=&quot;&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
