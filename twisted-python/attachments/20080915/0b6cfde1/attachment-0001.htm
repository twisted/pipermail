<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Use&nbsp;twisted.python.logfile.LogFile&nbsp;wirte&nbsp;log，Memory&nbsp;can&nbsp;not&nbsp;be<br>
released,&nbsp;does&nbsp;anybody&nbsp;familiar&nbsp;with&nbsp;or&nbsp;encounter&nbsp;such&nbsp;a&nbsp;situation?&lt;br&gt;&lt;br&gt;Environment:&nbsp;FREEBSD&nbsp;6.3&nbsp;RELEASE&lt;br&gt;twisted&nbsp;svn&nbsp;trunk&nbsp;today&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>
Description&nbsp;of&nbsp;the&nbsp;problem&lt;br&gt;Use&nbsp;&amp;quot;TOP&amp;quot;&nbsp;command&nbsp;observe&nbsp;the&nbsp;used&nbsp;memory,&nbsp;memory&nbsp;first&nbsp;use&nbsp;the&nbsp;BUF,&nbsp;if&nbsp;buf&amp;gt;111M,&nbsp;then&nbsp;don&amp;#39;t&nbsp;use&nbsp;buf&lt;br&gt;and&nbsp;use&nbsp;WIRED,&nbsp;Wired&nbsp;to&nbsp;around&nbsp;132&nbsp;M，&nbsp;and&nbsp;then&nbsp;use&nbsp;Inact&lt;br&gt;If&nbsp;during&nbsp;the&nbsp;service&amp;nbsp;&nbsp;manually&nbsp;delete&nbsp;the&nbsp;generated&nbsp;file.&nbsp;Memory&nbsp;will&nbsp;be&nbsp;released.&lt;br&gt;<br>
<br>
twisted.python.logfile.LogFile&nbsp;default&amp;nbsp;&nbsp;log&nbsp;file&nbsp;will&nbsp;be&nbsp;closed&nbsp;at&nbsp;1&nbsp;M<br>
size,&nbsp;and&nbsp;re-open&nbsp;a&nbsp;file,&nbsp;how&nbsp;the&nbsp;file&nbsp;is&nbsp;closed，&nbsp;but&nbsp;the&nbsp;memory&nbsp;still<br>
not&nbsp;released？&lt;br&gt;&lt;br&gt;sorry&nbsp;for&nbsp;my&nbsp;poor&nbsp;english..&nbsp;thank&nbsp;you&lt;br&gt;&lt;br&gt;&lt;br&gt;**test&nbsp;code：&lt;br&gt;<br>
&lt;br&gt;#!/usr/local/bin/python&lt;br&gt;import&nbsp;datetime&lt;br&gt;import&nbsp;os&lt;br&gt;from&nbsp;twisted.python&nbsp;import&nbsp;logfile&lt;br&gt;&lt;br&gt;class&nbsp;LogFile2(logfile.LogFile):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;#39;&amp;#39;&amp;#39;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;#39;&amp;#39;&amp;#39;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;rotate(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Rotate&nbsp;the&nbsp;file&nbsp;and&nbsp;create&nbsp;a&nbsp;new&nbsp;one.&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;If&nbsp;it&amp;#39;s&nbsp;not&nbsp;possible&nbsp;to&nbsp;open&nbsp;new&nbsp;logfile,&nbsp;this&nbsp;will&nbsp;fail&nbsp;silently,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;and&nbsp;continue&nbsp;logging&nbsp;to&nbsp;old&nbsp;logfile.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;not&nbsp;(os.access(self.directory,&nbsp;os.W_OK)&nbsp;and&nbsp;os.access(self.path,&nbsp;os.W_OK)):&lt;br&gt;<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;logs&nbsp;=&nbsp;self.listLogs()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;logs.reverse()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;logs:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;self.maxRotatedFiles&nbsp;is&nbsp;not&nbsp;None&nbsp;and&nbsp;i&nbsp;&amp;gt;=&nbsp;self.maxRotatedFiles:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;os.remove(&amp;quot;%s.%d&amp;quot;&nbsp;%&nbsp;(self.path,&nbsp;i))&lt;br&gt;<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;os.rename(&amp;quot;%s.%d&amp;quot;&nbsp;%&nbsp;(self.path,&nbsp;i),&nbsp;&amp;quot;%s.%d&amp;quot;&nbsp;%&nbsp;(self.path,&nbsp;i&nbsp;+&nbsp;1))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self._file.close()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;self._file,&nbsp;&amp;#39;closed&amp;#39;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;os.rename(self.path,&nbsp;&amp;quot;%s.1&amp;quot;&nbsp;%&nbsp;self.path)&lt;br&gt;<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self._openFile()&lt;br&gt;&lt;br&gt;&lt;br&gt;i=10000000&lt;br&gt;log&nbsp;=&nbsp;LogFile2(&amp;#39;test_logfile.log&amp;#39;,&nbsp;&amp;#39;/home/echo/tmp/test/&amp;#39;)&lt;br&gt;&lt;br&gt;while&nbsp;i:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;msg&nbsp;=&nbsp;&amp;#39;%s:&nbsp;test_test_test_test\r\n&amp;#39;&nbsp;%&nbsp;str(i)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;log.write(msg)&lt;br&gt;<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;i=i-1&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;log.close()&lt;br&gt;&lt;br&gt;**result。&lt;br&gt;&lt;br&gt;&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_&lt;div&nbsp;dir=&quot;ltr&quot;&gt;logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;r+&amp;#39;&nbsp;at&nbsp;0x827ccc8&amp;gt;&nbsp;closeed&lt;br&gt;&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827c458&amp;gt;&nbsp;closeed&lt;br&gt;<br>
<br>
&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827ccc8&amp;gt;&nbsp;closeed&lt;br&gt;&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827c458&amp;gt;&nbsp;closeed&lt;br&gt;<br>
&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827ccc8&amp;gt;&nbsp;closeed&lt;br&gt;<br>
&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827c458&amp;gt;&nbsp;closeed&lt;br&gt;&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827ccc8&amp;gt;&nbsp;closeed&lt;br&gt;<br>
&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827c458&amp;gt;&nbsp;closeed&lt;br&gt;<br>
&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827ccc8&amp;gt;&nbsp;closeed&lt;br&gt;&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827c458&amp;gt;&nbsp;closeed&lt;br&gt;<br>
&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827ccc8&amp;gt;&nbsp;closeed&lt;br&gt;<br>
&amp;lt;closed&nbsp;file&nbsp;&amp;#39;/home/echo/tmp/test/test_logfile.log&amp;#39;,&nbsp;mode&nbsp;&amp;#39;w+&amp;#39;&nbsp;at&nbsp;0x827c458&amp;gt;&nbsp;closeed&lt;br&gt;.......&lt;/div&gt;&lt;/div&gt;
</tt>
