<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Alright,&nbsp;it&#39;s&nbsp;a&nbsp;but&nbsp;in&nbsp;twisted.&nbsp;How&nbsp;do&nbsp;I&nbsp;report&nbsp;twisted&nbsp;bugs?&nbsp;Under&nbsp;python3&nbsp;&lt;a&nbsp;href=&quot;http://service.name&quot;&gt;service.name&lt;/a&gt;&nbsp;is&nbsp;bytes&nbsp;and&nbsp;not&nbsp;a&nbsp;string. &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L86&quot;&gt;https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L86&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Mon,&nbsp;Nov&nbsp;30,&nbsp;2020&nbsp;at&nbsp;4:00&nbsp;PM&nbsp;Robert&nbsp;DiFalco&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:robert.difalco@gmail.com&quot;&gt;robert.difalco@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Ok,&nbsp;my&nbsp;solution&nbsp;is&nbsp;to&nbsp;re-write&nbsp;the&nbsp;connect&nbsp;function&nbsp;like&nbsp;this.&nbsp;Any&nbsp;issues&nbsp;with&nbsp;this&nbsp;approach? &lt;br&gt;&lt;br&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(43,43,43);color:rgb(169,183,198);font-family:&quot;JetBrains&nbsp;Mono&quot;,monospace;font-size:9.8pt&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;def&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(255,198,109)&quot;&gt;connect&lt;/span&gt;(options&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;userAuthObject):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;d_connect&nbsp;=&nbsp;Deferred()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;d_authorized&nbsp;=&nbsp;Deferred()&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;factory&nbsp;=&nbsp;SFTPClientFactory(d_connect&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;options&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;userAuthObject)&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;def&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(255,198,109)&quot;&gt;_connect_failed&lt;/span&gt;(*args&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(114,115,122)&quot;&gt;**kwargs&lt;/span&gt;):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d_authorized.errback(args[&lt;span&nbsp;style=&quot;color:rgb(104,151,187)&quot;&gt;0&lt;/span&gt;])&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;def&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(255,198,109)&quot;&gt;_connected&lt;/span&gt;(&lt;span&nbsp;style=&quot;color:rgb(114,115,122)&quot;&gt;*args&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(114,115,122)&quot;&gt;**kwargs&lt;/span&gt;):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Reset&nbsp;the&nbsp;factory&#39;s&nbsp;deferred&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.d&nbsp;=&nbsp;d_authorized&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;d_connect.addErrback(_connect_failed).addCallback(_connected)&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;reactor.connectTCP(options[&lt;span&nbsp;style=&quot;color:rgb(106,135,89)&quot;&gt;&quot;host&quot;&lt;/span&gt;]&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;options[&lt;span&nbsp;style=&quot;color:rgb(106,135,89)&quot;&gt;&quot;port&quot;&lt;/span&gt;]&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;,&nbsp;&lt;/span&gt;factory)&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;return&nbsp;&lt;/span&gt;d_authorized.addCallback(&lt;span&nbsp;style=&quot;color:rgb(204,120,50)&quot;&gt;lambda&nbsp;&lt;/span&gt;ignore:&nbsp;factory)&lt;br&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sun,&nbsp;Nov&nbsp;29,&nbsp;2020&nbsp;at&nbsp;9:41&nbsp;AM&nbsp;Robert&nbsp;DiFalco&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:robert.difalco@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;robert.difalco@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;continuing to&nbsp;wrestle&nbsp;with&nbsp;conch,&nbsp;this&nbsp;time&nbsp;around&nbsp;authentication&nbsp;and&nbsp;notifying&nbsp;deferred&nbsp;of&nbsp;auth&nbsp;failure. &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;seems&nbsp;like&nbsp;the&nbsp;SSH&nbsp;factory&nbsp;has&nbsp;a&nbsp;deferred&nbsp;to&nbsp;be&nbsp;notified&nbsp;of&nbsp;auth&nbsp;failures&nbsp;here:&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L61-L66&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L61-L66&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Unfortunately,&nbsp;this&nbsp;deferred&nbsp;is&nbsp;cleared&nbsp;because&nbsp;prior&nbsp;to&nbsp;auth,&nbsp;it&nbsp;receives this&nbsp;on&nbsp;successful&nbsp;connect:&lt;br&gt;&lt;a&nbsp;href=&quot;https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L83-L88&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L83-L88&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;you&nbsp;can&nbsp;see&nbsp;this&nbsp;clears&nbsp;the&nbsp;deferred&nbsp;so&nbsp;it&nbsp;is&nbsp;no&nbsp;longer&nbsp;available&nbsp;to&nbsp;get&nbsp;an&nbsp;errback.&nbsp;This&nbsp;also&nbsp;prevents&nbsp;the&nbsp;SSHClientTransport&nbsp;from&nbsp;getting&nbsp;a&nbsp;sendDisconnect. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;try&nbsp;it&nbsp;change&nbsp;the&nbsp;user&nbsp;to&nbsp;something&nbsp;invalid&nbsp;here: &lt;a&nbsp;href=&quot;https://gist.github.com/radifalco/5a5cca4bf8d49d5c61113e36f9be7553#file-sftp-py-L328&quot;&nbsp;target=&quot;_blank&quot;&gt;https://gist.github.com/radifalco/5a5cca4bf8d49d5c61113e36f9be7553#file-sftp-py-L328&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;will&nbsp;never&nbsp;get&nbsp;a&nbsp;callback&nbsp;to&nbsp;errback. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;guess&nbsp;I&nbsp;would&nbsp;have&nbsp;expected&nbsp;this&nbsp;to&nbsp;get&nbsp;the&nbsp;error&nbsp;but&nbsp;it&nbsp;actually&nbsp;succeeds&nbsp;with&nbsp;None.&nbsp;As&nbsp;a&nbsp;result&nbsp;there&nbsp;is&nbsp;no&nbsp;deferred&nbsp;to&nbsp;get&nbsp;the&nbsp;auth&nbsp;failure&nbsp;and&nbsp;my&nbsp;app&nbsp;waits&nbsp;forever&nbsp;for&nbsp;a&nbsp;notification. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;is&nbsp;one&nbsp;ting&nbsp;I&nbsp;*think*&nbsp;I&nbsp;know&nbsp;how&nbsp;to&nbsp;do,&nbsp;add&nbsp;a&nbsp;timeout&nbsp;with&nbsp;a&nbsp;callback&nbsp;later&nbsp;on&nbsp;the&nbsp;sftpClient&nbsp;deferred.&nbsp;But&nbsp;that&nbsp;seems&nbsp;lame.&nbsp;What&nbsp;I&#39;d&nbsp;like&nbsp;to&nbsp;do&nbsp;is&nbsp;to&nbsp;get&nbsp;this&nbsp;ConchError&nbsp;as&nbsp;it&nbsp;has&nbsp;the&nbsp;actual&nbsp;reason&nbsp;for&nbsp;the&nbsp;connection&nbsp;failure. &nbsp;Thoughts?&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L61-L66&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L61-L66&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
