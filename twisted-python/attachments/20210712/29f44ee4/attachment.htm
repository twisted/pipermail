<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Jul&nbsp;12,&nbsp;2021,&nbsp;at&nbsp;12:07&nbsp;AM,&nbsp;Ian&nbsp;Haywood&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ian@haywood.id.au&quot;&nbsp;class=&quot;&quot;&gt;ian@haywood.id.au&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;work&nbsp;out&nbsp;how&nbsp;to&nbsp;retrieve&nbsp;on&nbsp;the&nbsp;server&nbsp;a&nbsp;X.509&nbsp;certificate&nbsp;presented&nbsp;by&nbsp;the&nbsp;HTTPS&nbsp;client.&nbsp;&nbsp;This&nbsp;code&nbsp;tries&nbsp;to&nbsp;tell&nbsp;me&nbsp;the&nbsp;transport&nbsp;has&nbsp;no&nbsp;peer&nbsp;certificate.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;same&nbsp;error&nbsp;when&nbsp;I&nbsp;use&nbsp;wget&nbsp;as&nbsp;a&nbsp;client&nbsp;so&nbsp;I&nbsp;think&nbsp;my&nbsp;problem&nbsp;is&nbsp;in&nbsp;the&nbsp;server&nbsp;code.&nbsp;I'm&nbsp;using&nbsp;self-signed&nbsp;certificates&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Any&nbsp;clues&nbsp;as&nbsp;to&nbsp;what&nbsp;I'm&nbsp;doing&nbsp;wrong?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;It's&nbsp;been&nbsp;quite&nbsp;a&nbsp;while&nbsp;since&nbsp;I&nbsp;tried&nbsp;to&nbsp;do&nbsp;this,&nbsp;but:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&nbsp;class=&quot;MailOutline&quot;&gt;&lt;li&nbsp;class=&quot;&quot;&gt;For&nbsp;starters,&nbsp;you&nbsp;need&nbsp;to&nbsp;specify&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;the&nbsp;certificate&nbsp;authority&nbsp;that&nbsp;will&nbsp;be&nbsp;validating&nbsp;your&nbsp;client's&nbsp;certificates.&lt;/i&gt;&lt;span&nbsp;style=&quot;font-style:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;I&nbsp;forget&nbsp;the&nbsp;precise&nbsp;specifics,&nbsp;but&nbsp;I&nbsp;believe&nbsp;if&nbsp;you&nbsp;don't&nbsp;specify&nbsp;a&nbsp;CA&nbsp;that&nbsp;will&nbsp;be&nbsp;used,&nbsp;it&nbsp;won't&nbsp;prompt&nbsp;the&nbsp;client&nbsp;to&nbsp;present&nbsp;a&nbsp;certificate&nbsp;in&nbsp;the&nbsp;first&nbsp;place,&nbsp;and&nbsp;also&nbsp;there's&nbsp;nothing&nbsp;for&nbsp;your&nbsp;endpoint&nbsp;to&nbsp;validate&nbsp;against,&nbsp;so&nbsp;what&nbsp;would&nbsp;it&nbsp;even&nbsp;do&nbsp;if&nbsp;the&nbsp;client&nbsp;&lt;/span&gt;&lt;i&nbsp;class=&quot;&quot;&gt;did&lt;/i&gt;&lt;span&nbsp;style=&quot;font-style:&nbsp;normal;&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;present&nbsp;one,&nbsp;other&nbsp;than&nbsp;let&nbsp;you&nbsp;retrieve&nbsp;it?&nbsp;The&nbsp;point&nbsp;is&nbsp;not&nbsp;to&nbsp;inspect&nbsp;the&nbsp;certificate&nbsp;but&nbsp;to&nbsp;authenticate&nbsp;it,&nbsp;an&nbsp;API&nbsp;that&nbsp;let&nbsp;you&nbsp;inspect&nbsp;it&nbsp;without&nbsp;first&nbsp;validating&nbsp;it&nbsp;against&nbsp;a&nbsp;CA&nbsp;would&nbsp;be&nbsp;a&nbsp;security&nbsp;nightmare.&nbsp;&nbsp;And&nbsp;generally&nbsp;client&nbsp;certs&nbsp;are&nbsp;not&nbsp;understood&nbsp;to&nbsp;be&nbsp;validated&nbsp;by&nbsp;webtrust&nbsp;CAs,&nbsp;so&nbsp;&quot;just&nbsp;validate&nbsp;it&nbsp;like&nbsp;usual&quot;&nbsp;doesn't&nbsp;apply,&nbsp;since&nbsp;you&nbsp;can't&nbsp;check&nbsp;the&nbsp;SANs&nbsp;for&nbsp;a&nbsp;hostname.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;There's&nbsp;a&nbsp;guide&nbsp;to&nbsp;doing&nbsp;this&nbsp;programmatically&nbsp;here:&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;https://docs.twistedmatrix.com/en/twisted-21.2.0/core/howto/ssl.html#tls-server-with-client-authentication-via-client-certificate-verification&quot;&nbsp;class=&quot;&quot;&gt;https://docs.twistedmatrix.com/en/twisted-21.2.0/core/howto/ssl.html#tls-server-with-client-authentication-via-client-certificate-verification&lt;/a&gt;&nbsp;-&nbsp;I&nbsp;believe&nbsp;that&nbsp;this&nbsp;edge-case&nbsp;is&nbsp;not&nbsp;supported&nbsp;by&nbsp;endpoints.serverFromString.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/li&gt;&lt;li&nbsp;class=&quot;&quot;&gt;&lt;i&nbsp;class=&quot;&quot;&gt;If&lt;/i&gt;&nbsp;it's&nbsp;within&nbsp;your&nbsp;control&nbsp;to&nbsp;avoid,&nbsp;don't&nbsp;use&nbsp;client&nbsp;certificate&nbsp;authentication&nbsp;from&nbsp;HTTPS&nbsp;clients.&nbsp;&nbsp;It&nbsp;unnecessarily&nbsp;leaks&nbsp;a&nbsp;bunch&nbsp;of&nbsp;peripheral&nbsp;information&nbsp;to&nbsp;the&nbsp;service&nbsp;you're&nbsp;authenticating&nbsp;to,&nbsp;the&nbsp;UX&nbsp;is&nbsp;a&nbsp;disaster&nbsp;on&nbsp;basically&nbsp;every&nbsp;browser,&nbsp;and&nbsp;most&nbsp;of&nbsp;the&nbsp;big&nbsp;players&nbsp;have&nbsp;stopped&nbsp;caring&nbsp;about&nbsp;this&nbsp;use-case&nbsp;in&nbsp;favor&nbsp;of&nbsp;things&nbsp;like&nbsp;webauthn&nbsp;that&nbsp;properly&nbsp;exist&nbsp;entirely&nbsp;outside&nbsp;of&nbsp;the&nbsp;setup&nbsp;process&nbsp;for&nbsp;a&nbsp;secure&nbsp;channel.&nbsp;&nbsp;I&nbsp;confess&nbsp;I&nbsp;used&nbsp;to&nbsp;think&nbsp;client&nbsp;cert&nbsp;auth&nbsp;was&nbsp;really&nbsp;cool&nbsp;myself,&nbsp;but&nbsp;luckily&nbsp;nothing&nbsp;I&nbsp;did&nbsp;with&nbsp;it&nbsp;ever&nbsp;took&nbsp;off&nbsp;:-).&lt;/li&gt;&lt;/ol&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;That&nbsp;said:&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;use-case&nbsp;exists,&nbsp;Twisted&nbsp;should&nbsp;have&nbsp;good&nbsp;support&nbsp;for&nbsp;it.&nbsp;&nbsp;Adding&nbsp;a&nbsp;clientCA&nbsp;argument&nbsp;to&nbsp;twisted.internet.endpoints._parseSSL&nbsp;so&nbsp;that&nbsp;serverFromString&nbsp;would&nbsp;support&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;pretty&nbsp;simple&nbsp;PR&nbsp;to&nbsp;put&nbsp;together,&nbsp;so&nbsp;if&nbsp;you've&nbsp;got&nbsp;to&nbsp;bite&nbsp;the&nbsp;bullet&nbsp;on&nbsp;this,&nbsp;a&nbsp;contribution&nbsp;to&nbsp;close&nbsp;the&nbsp;gap&nbsp;here&nbsp;would&nbsp;be&nbsp;appreciated.&nbsp;&nbsp;Twisted&nbsp;is&nbsp;nothing&nbsp;if&nbsp;not&nbsp;a&nbsp;tool&nbsp;that&nbsp;should&nbsp;make&nbsp;it&nbsp;seamless&nbsp;to&nbsp;integrate&nbsp;with&nbsp;every&nbsp;bad&nbsp;idea&nbsp;anyone's&nbsp;had&nbsp;in&nbsp;a&nbsp;protocol&nbsp;design&nbsp;;-).&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-g&lt;/div&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
