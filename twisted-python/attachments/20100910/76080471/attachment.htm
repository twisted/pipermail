<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;I&amp;#39;ll&nbsp;give&nbsp;a&nbsp;very&nbsp;practical&nbsp;example&nbsp;of&nbsp;an&nbsp;example&nbsp;request&nbsp;+&nbsp;response,&nbsp;because&nbsp;I&amp;#39;m&nbsp;not&nbsp;entirely&nbsp;sure&nbsp;I&nbsp;communicated&nbsp;that&nbsp;properly.&nbsp;The&nbsp;code&nbsp;we&amp;#39;re&nbsp;discussing&nbsp;is&nbsp;part&nbsp;of&nbsp;a&nbsp;TokenEndpoint,&nbsp;which&nbsp;is&nbsp;an&nbsp;IResource.&nbsp;Something&nbsp;(a&nbsp;client,&nbsp;in&nbsp;OAuth&nbsp;terminology)&nbsp;makes&nbsp;a&nbsp;request&nbsp;that&nbsp;looks&nbsp;like&nbsp;this:&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;---&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;POST&nbsp;/token&nbsp;HTTP/1.1&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://server.example.com&quot;&nbsp;target=&quot;_blank&quot;&gt;server.example.com&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
Content-Type:&nbsp;application/x-www-form-urlencoded&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;grant_type=password&amp;amp;client_id=s6BhdRkqt3&amp;amp;client_secret=47HDu8s&amp;amp;username=johndoe&amp;amp;password=A3ddj3w&lt;/div&gt;<br>
<br>
&lt;div&gt;---&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;And&nbsp;hopefully&nbsp;the&nbsp;code&nbsp;we&amp;#39;re&nbsp;discussing&nbsp;answers&nbsp;with&nbsp;a&nbsp;request&nbsp;that&nbsp;looks&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;---&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
HTTP/1.1&nbsp;200&nbsp;OK&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Content-Type:&nbsp;application/json&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
Cache-Control:&nbsp;no-store&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;{&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&amp;quot;access_token&amp;quot;:&amp;quot;SlAV32hkKG&amp;quot;,&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&amp;quot;expires_in&amp;quot;:3600,&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&amp;quot;refresh_token&amp;quot;:&amp;quot;8xLOxBtZp8&amp;quot;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&amp;quot;scope&amp;quot;:&nbsp;&amp;quot;tummies&nbsp;cookies&nbsp;parrots&amp;quot;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;}&lt;/div&gt;&lt;div&gt;---&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
Where,&nbsp;as&nbsp;mentioned&nbsp;before,&nbsp;everything&nbsp;besides&nbsp;&amp;quot;access_token&amp;quot;&nbsp;is&nbsp;not&nbsp;always&nbsp;required&nbsp;(but&nbsp;it&nbsp;must&nbsp;be&nbsp;possible&nbsp;to&nbsp;set&nbsp;them,&nbsp;because&nbsp;occasionally&nbsp;they&nbsp;are&nbsp;required).&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Fri,&nbsp;Sep&nbsp;10,&nbsp;2010&nbsp;at&nbsp;2:34&nbsp;AM,&nbsp;Glyph&nbsp;Lefkowitz&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;for&nbsp;any&nbsp;given&nbsp;cred&nbsp;implementation,&nbsp;there&nbsp;are&nbsp;two&nbsp;key&nbsp;questions:&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;What&nbsp;is&nbsp;the&nbsp;avatar&nbsp;interface?&lt;/li&gt;&lt;li&gt;What&nbsp;is&nbsp;the&nbsp;associated&nbsp;mind&nbsp;interface?&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;If&nbsp;we&amp;#39;re&nbsp;not&nbsp;talking&nbsp;about&nbsp;a&nbsp;system&nbsp;where&nbsp;the&nbsp;avatar&nbsp;interface&nbsp;(the&nbsp;one&nbsp;passed&nbsp;to&nbsp;&amp;#39;login&amp;#39;,&nbsp;the&nbsp;one&nbsp;that&nbsp;the&nbsp;realm&nbsp;must&nbsp;return&nbsp;something&nbsp;that&nbsp;gets&nbsp;implemented)&nbsp;is&nbsp;IResource,&nbsp;then&nbsp;that&amp;#39;s&nbsp;the&nbsp;problem.&nbsp; What&nbsp;&lt;i&gt;is&lt;/i&gt; that&nbsp;interface&nbsp;that&nbsp;you&amp;#39;re&nbsp;talking&nbsp;about?&nbsp; Be&nbsp;very&nbsp;specific:&nbsp;what&nbsp;methods&nbsp;does&nbsp;it&nbsp;have&nbsp;and&nbsp;why?&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Okay,&nbsp;to&nbsp;be&nbsp;specific:&nbsp;I&nbsp;believe&nbsp;the&nbsp;appropriate&nbsp;interface&nbsp;is&nbsp;IResource.&nbsp;This&nbsp;is&nbsp;in&nbsp;line&nbsp;with&nbsp;t.web&amp;#39;s&nbsp;general&nbsp;way&nbsp;of&nbsp;interacting&nbsp;with&nbsp;cred:&nbsp;you&nbsp;give&nbsp;me&nbsp;credentials,&nbsp;I&nbsp;give&nbsp;you&nbsp;a&nbsp;protected&nbsp;IResource.&lt;br&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;It&nbsp;sounds&nbsp;like&nbsp;OAuth&nbsp;is&nbsp;very&nbsp;precisely&nbsp;implementing&nbsp;something&nbsp;that&nbsp;maps&nbsp;almost&nbsp;exactly&nbsp;onto&nbsp;the&nbsp;&lt;i&gt;checker&lt;/i&gt; part&nbsp;of&nbsp;cred,&nbsp;but&nbsp;you&amp;#39;re&nbsp;doing&nbsp;it&nbsp;by&nbsp;implementing&nbsp;a&nbsp;realm&nbsp;to&nbsp;allow&nbsp;applications&nbsp;to&nbsp;provide&nbsp;their&nbsp;own&nbsp;logic.&nbsp; This&nbsp;might&nbsp;not&nbsp;be&nbsp;the&nbsp;wrong&nbsp;idea,&nbsp;but&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;spelled&nbsp;out&nbsp;very&nbsp;clearly.&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Doing&nbsp;everything&nbsp;in&nbsp;the&nbsp;checker&nbsp;probably&nbsp;might&nbsp;make&nbsp;more&nbsp;sense.&nbsp;The&nbsp;reason&nbsp;I&nbsp;originally&nbsp;thought&nbsp;to&nbsp;do&nbsp;this&nbsp;in&nbsp;the&nbsp;IRealm&nbsp;is&nbsp;that&nbsp;I&nbsp;figured&nbsp;credentials&nbsp;checkers&nbsp;should&nbsp;just&nbsp;check&nbsp;credentials,&nbsp;and&nbsp;creating&nbsp;a&nbsp;new&nbsp;credential&nbsp;(the&nbsp;access&nbsp;token)&nbsp;wasn&amp;#39;t&nbsp;part&nbsp;of&nbsp;ICredentialsChecker&amp;#39;s&nbsp;job&nbsp;(more&nbsp;like&nbsp;IRealm&amp;#39;s&nbsp;job).&nbsp;Apparently&nbsp;I&nbsp;was&nbsp;mistaken.&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;As&nbsp;you&nbsp;describe&nbsp;it:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;token&nbsp;endpoints&nbsp;let&nbsp;you&nbsp;trade&nbsp;in&nbsp;some&nbsp;credentials&nbsp;that&nbsp;prove&nbsp;you&amp;#39;re&nbsp;supposed&nbsp;to&nbsp;have&nbsp;access&nbsp;for&nbsp;a&nbsp;token&nbsp;that&nbsp;actually&nbsp;*gives*&nbsp;you&nbsp;that&nbsp;access&lt;/blockquote&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;cred-ese,&nbsp;that&nbsp;would&nbsp;be&nbsp;&amp;quot;checkers&nbsp;let&nbsp;you&nbsp;trade&nbsp;in&nbsp;some&nbsp;credentials&nbsp;that&nbsp;prove&nbsp;you&amp;#39;re&nbsp;supposed&nbsp;to&nbsp;have&nbsp;access&nbsp;for&nbsp;an&nbsp;&amp;lt;avatar&nbsp;ID,&nbsp;which&nbsp;you&nbsp;give&nbsp;to&nbsp;a&nbsp;Realm&amp;gt; that&nbsp;actually&nbsp;*gives*&nbsp;you&nbsp;that&nbsp;access&amp;quot;.&nbsp; As&nbsp;far&nbsp;as&nbsp;the&nbsp;OAuth&nbsp;response&nbsp;is&nbsp;concerned,&nbsp;it&amp;#39;s&nbsp;like&nbsp;a&nbsp;checker.&nbsp; Looking&nbsp;at&nbsp;the&nbsp;individual&nbsp;parts,&nbsp;assuming&nbsp;that&nbsp;the&nbsp;avatar&nbsp;interface&nbsp;for&nbsp;the&nbsp;purposes&nbsp;of&nbsp;this&nbsp;discussion&nbsp;is&nbsp;IResource,&nbsp;it&nbsp;breaks&nbsp;down&nbsp;like&nbsp;this&nbsp;in&nbsp;my&nbsp;mind:&lt;/div&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;  &nbsp; -&nbsp;the&nbsp;access&nbsp;token&nbsp;(an&nbsp;ascii&nbsp;string,&nbsp;mandatory)&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;Avatar&nbsp;ID.&nbsp; (See,&nbsp;it&amp;#39;s&nbsp;a&nbsp;str!)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Heh,&nbsp;okay;&nbsp;as&nbsp;long&nbsp;as&nbsp;there&amp;#39;s&nbsp;a&nbsp;plausible&nbsp;way&nbsp;to&nbsp;get&nbsp;the&nbsp;other&nbsp;important&nbsp;information&nbsp;(see&nbsp;rest&nbsp;of&nbsp;email)&nbsp;into&nbsp;the&nbsp;HTTP&nbsp;response,&nbsp;I&amp;#39;ll&nbsp;believe&nbsp;you.&nbsp; &lt;/div&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;  &nbsp; -&nbsp;the&nbsp;expiration&nbsp;time&nbsp;(optional)&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;Implementation&nbsp;detail&nbsp;of&nbsp;the&nbsp;session.&nbsp; Avatars&nbsp;are&nbsp;actually&nbsp;sessions,&nbsp;which&nbsp;expire:&nbsp;sometimes&nbsp;(as&nbsp;with&nbsp;POP)&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;connection,&nbsp;sometimes&nbsp;(as&nbsp;with&nbsp;nevow.guard&amp;#39;s&nbsp;HTTP&nbsp;support)&nbsp;with&nbsp;a&nbsp;session&nbsp;timeout.&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Right,&nbsp;but:&lt;/div&gt;&lt;div&gt;a)&nbsp;The&nbsp;avatar&nbsp;needs&nbsp;to&nbsp;know&nbsp;about&nbsp;this&nbsp;timeout,&nbsp;since&nbsp;the&nbsp;timeout&nbsp;information&nbsp;needs&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;make&nbsp;it&nbsp;into&nbsp;the&nbsp;HTTP&nbsp;response.&lt;/div&gt;&lt;div&gt;b)&nbsp;The&nbsp;expiration&nbsp;time&nbsp;is&nbsp;only&nbsp;known&nbsp;to&nbsp;the&nbsp;thing&nbsp;that&nbsp;creates&nbsp;the&nbsp;access&nbsp;token&nbsp;(obviously).&nbsp;
</tt>
