<tt>
&lt;html&gt;&lt;head&gt;&lt;style&gt;body{font-family:Helvetica,Arial;font-size:13px}&lt;/style&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;div&nbsp;id=&quot;bloop_customfont&quot;&nbsp;style=&quot;font-family:Helvetica,Arial;font-size:13px;&nbsp;color:&nbsp;rgba(0,0,0,1.0);&nbsp;margin:&nbsp;0px;&nbsp;line-height:&nbsp;auto;&quot;&gt;Hi&nbsp;Chris,&lt;/div&gt;&nbsp;&lt;br&gt;&lt;p&nbsp;class=&quot;airmail_on&quot;&gt;On&nbsp;March&nbsp;22,&nbsp;2016&nbsp;at&nbsp;2:42:14&nbsp;PM,&nbsp;Chris&nbsp;Norman&nbsp;(&lt;a&nbsp;href=&quot;mailto:chris.norman2@googlemail.com&quot;&gt;chris.norman2@googlemail.com&lt;/a&gt;)&nbsp;wrote:&lt;/p&gt;&nbsp;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;clean_bq&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica,&nbsp;Arial;&nbsp;font-size:&nbsp;13px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;&lt;span&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;Hi&nbsp;all,&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;I'm&nbsp;sure&nbsp;I&nbsp;asked&nbsp;this&nbsp;question&nbsp;before,&nbsp;but&nbsp;I&nbsp;can't&nbsp;find&nbsp;any&nbsp;answers&nbsp;on&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;google,&nbsp;and&nbsp;I've&nbsp;changed&nbsp;my&nbsp;work&nbsp;flow&nbsp;a&nbsp;bit&nbsp;now,&nbsp;so&nbsp;thought&nbsp;it&nbsp;was&nbsp;worth&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;re-asking.&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;&lt;br&gt;So&nbsp;on&nbsp;my&nbsp;server's&nbsp;protocol,&nbsp;I&nbsp;have&nbsp;a&nbsp;send&nbsp;method.&nbsp;This&nbsp;allows&nbsp;me&nbsp;to&nbsp;pass&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;arguments&nbsp;which&nbsp;get&nbsp;sent&nbsp;off&nbsp;to&nbsp;the&nbsp;client&nbsp;in&nbsp;the&nbsp;right&nbsp;format.&nbsp;The&nbsp;send&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;method&nbsp;looks&nbsp;something&nbsp;like&nbsp;this:&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;&lt;br&gt;def&nbsp;send(self,&nbsp;command,&nbsp;**kwargs):&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;&quot;&quot;&quot;Cause&nbsp;the&nbsp;client&nbsp;to&nbsp;issue&nbsp;getattr(connection,&nbsp;command)(**kwargs).&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;If&nbsp;disconnect&nbsp;evaluates&nbsp;to&nbsp;True,&nbsp;disconnect&nbsp;the&nbsp;client&nbsp;after&nbsp;the&nbsp;message&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;is&nbsp;sent.&quot;&quot;&quot;&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;disconnect&nbsp;=&nbsp;kwargs.get('disconnect',&nbsp;False)&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;try:&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;del&nbsp;kwargs['disconnect']&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;except&nbsp;KeyError:&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;pass&nbsp;#&nbsp;Argument&nbsp;not&nbsp;found.&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;d&nbsp;=&nbsp;defer.Deferred()&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;d.addCallback(self.prepare_command)&nbsp;Convert&nbsp;the&nbsp;command&nbsp;and&nbsp;kwargs&nbsp;to&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;json.&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;d.addCallback(self.deferred_write)&nbsp;#&nbsp;Write&nbsp;the&nbsp;json&nbsp;to&nbsp;the&nbsp;transport.&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;if&nbsp;disconnect:&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;d.addCallback(self.deferred_disconnect)&nbsp;#&nbsp;Issue&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;self.transport.loseConnection().&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;p&gt;You&nbsp;are&nbsp;disconnecting&nbsp;right&nbsp;here,&nbsp;without&nbsp;waiting&nbsp;for&nbsp;your&nbsp;Deferred&nbsp;to&nbsp;fire.&nbsp;&nbsp;It&nbsp;might&nbsp;make&nbsp;better&nbsp;sense&nbsp;to&nbsp;add&nbsp;the&nbsp;call&nbsp;the&nbsp;self.transport.loseConnection()&nbsp;to&nbsp;your&nbsp;Deferredâ€™s&nbsp;callback&nbsp;chain.&lt;/p&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;helvetica,&nbsp;arial;&quot;&gt;Hope&nbsp;this&nbsp;helps,&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;helvetica,&nbsp;arial;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;helvetica,&nbsp;arial;&quot;&gt;Daniel&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;helvetica,&nbsp;arial;&quot;&gt;--&lt;br&gt;L.&nbsp;Daniel&nbsp;Burr&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:ldanielburr@me.com&quot;&gt;ldanielburr@me.com&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;helvetica,&nbsp;arial;&quot;&gt;(312)&nbsp;656-8387&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
