<tt>
&lt;div&gt;&lt;div&gt;Hello,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;implementing&nbsp;UDP-based&nbsp;protocol&nbsp;in&nbsp;Twisted&nbsp;(CoAP)&nbsp;which&nbsp;allows&nbsp;two&nbsp;behaviors&nbsp;when&nbsp;answering&nbsp;requests:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;If&nbsp;response&nbsp;is&nbsp;immediately&nbsp;available&nbsp;-&nbsp;send&nbsp;acknowledgement&nbsp;and&nbsp;response&nbsp;in&nbsp;a&nbsp;single&nbsp;datagram&nbsp;(piggyback&nbsp;response)&lt;/div&gt;<br>
<br>
&lt;div&gt;2.&nbsp;If&nbsp;response&nbsp;needs&nbsp;to&nbsp;be&nbsp;fetched&nbsp;or&nbsp;prepared&nbsp;-&nbsp;send&nbsp;datagram&nbsp;with&nbsp;acknowledgement,&nbsp;and&nbsp;then&nbsp;send&nbsp;another&nbsp;datagram&nbsp;with&nbsp;a&nbsp;response&nbsp;(separate&nbsp;response)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;(I&nbsp;think&nbsp;behavior&nbsp;#1&nbsp;is&nbsp;called&nbsp;synchronous&nbsp;in&nbsp;most&nbsp;Twisted&nbsp;tutorials,&nbsp;and&nbsp;behavior&nbsp;#2&nbsp;is&nbsp;called&nbsp;asynchronous.)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;programmer&nbsp;is&nbsp;implementing&nbsp;his&nbsp;application&nbsp;on&nbsp;top&nbsp;of&nbsp;CoAP&nbsp;protocol,&nbsp;he&nbsp;or&nbsp;she&nbsp;needs&nbsp;to&nbsp;choose&nbsp;how&nbsp;his&nbsp;request&nbsp;handler&nbsp;is&nbsp;going&nbsp;to&nbsp;behave. I&nbsp;would&nbsp;like&nbsp;to&nbsp;handle&nbsp;both&nbsp;behaviors&nbsp;in&nbsp;the&nbsp;same&nbsp;manner&nbsp;-&nbsp;by&nbsp;forcing&nbsp;every&nbsp;user-written&nbsp;request&nbsp;handler&nbsp;to&nbsp;return&nbsp;Deferred.&nbsp;Then&nbsp;I&nbsp;would&nbsp;check Deferred.called&nbsp;parameter. &lt;/div&gt;<br>
<br>
&lt;div&gt;1.&nbsp;If&nbsp;True&nbsp;-&nbsp;callback&nbsp;will&nbsp;execute&nbsp;immediately&nbsp;and&nbsp;send&nbsp;proper&nbsp;ACK+Response&nbsp;(that&nbsp;means&nbsp;request&nbsp;handler&nbsp;used&nbsp;defer.succeed()&nbsp;or&nbsp;somethin&nbsp;similar)&lt;/div&gt;&lt;div&gt;2. If&nbsp;False&nbsp;I&nbsp;send&nbsp;empty&nbsp;ACK,&nbsp;and&nbsp;wait&nbsp;for&nbsp;callback&nbsp;to&nbsp;send&nbsp;Response&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;code:&lt;/div&gt;&lt;div&gt;def&nbsp;respond(request):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;d&nbsp;=&nbsp;requestHandler(request)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;d.called&nbsp;is&nbsp;False:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sendEmptyAck()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;d.addCallback(sendResponse)&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;assume&nbsp;that&nbsp;sendResponse&nbsp;can&nbsp;send&nbsp;either&nbsp;ACK+RSP,&nbsp;or&nbsp;only&nbsp;RSP.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;would&nbsp;like&nbsp;to&nbsp;ask&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;proper&nbsp;approach?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best&nbsp;Regards&lt;/div&gt;&lt;div&gt;Maciej&nbsp;Wasilak&lt;/div&gt;<br>
<br>
<br>

</tt>
