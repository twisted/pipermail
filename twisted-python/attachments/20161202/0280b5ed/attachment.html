<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Dec&nbsp;2,&nbsp;2016&nbsp;at&nbsp;1:23&nbsp;AM,&nbsp;Glyph&nbsp;Lefkowitz&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail-h5&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Investigating&nbsp;further,&nbsp;I&nbsp;think&nbsp;I&#39;ve&nbsp;figured&nbsp;it&nbsp;out. &nbsp;Here&#39;s&nbsp;a&nbsp;patch&nbsp;that&nbsp;fixes&nbsp;the&nbsp;problem:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;div&gt;diff&nbsp;--git&nbsp;a/src/twisted/conch/ssh/keys.&lt;wbr&gt;py&nbsp;b/src/twisted/conch/ssh/keys.&lt;wbr&gt;py&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;index&nbsp;d47db7f..570f524&nbsp;100644&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;---&nbsp;a/src/twisted/conch/ssh/keys.&lt;wbr&gt;py&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;+++&nbsp;b/src/twisted/conch/ssh/keys.&lt;wbr&gt;py&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;@@&nbsp;-247,8&nbsp;+247,10&nbsp;@@&nbsp;class&nbsp;Key(object):&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ).public_key(default_backend(&lt;wbr&gt;))&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; elif&nbsp;keyType&nbsp;in&nbsp;[b&#39;ecdsa-sha2-&#39;&nbsp;+&nbsp;curve&nbsp;for&nbsp;curve&nbsp;in&nbsp;list(_curveTable.keys())]:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x,&nbsp;y,&nbsp;rest&nbsp;=&nbsp;common.getMP(rest,&nbsp;2)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;cls._fromECComponents(x=x,&nbsp;y=y,&nbsp;curve=keyType)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;cls(load_ssh_public_key(&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyType&nbsp;+&nbsp;b&#39;&nbsp;&#39;&nbsp;+&nbsp;base64.encodestring(blob),&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default_backend())&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; else:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; raise&nbsp;BadKeyError(&#39;unknown&nbsp;blob&nbsp;type:&nbsp;%s&#39;&nbsp;%&nbsp;(keyType,))&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;I&nbsp;suspect,&nbsp;but&nbsp;do&nbsp;not&nbsp;fully&nbsp;understand,&nbsp;that&nbsp;the&nbsp;problem&nbsp;here&nbsp;is&nbsp;point&nbsp;compression. &nbsp;Key._fromString_BLOB&nbsp;naively&nbsp;just&nbsp;does&nbsp;getMP(blob,&nbsp;2)&nbsp;and&nbsp;expects&nbsp;that&nbsp;the&nbsp;x,y&nbsp;will&nbsp;be&nbsp;the&nbsp;EC&nbsp;point. &nbsp;However,&nbsp;to&nbsp;quote &lt;a&nbsp;href=&quot;https://tools.ietf.org/html/rfc5656#section-3.1&quot;&nbsp;target=&quot;_blank&quot;&gt;https://tools.ietf.org/&lt;wbr&gt;html/rfc5656#section-3.1&lt;/a&gt;,&nbsp;&quot;point&nbsp;compression&nbsp;MAY&nbsp;be&nbsp;used&quot;. &nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;exactly&nbsp;how&nbsp;point&nbsp;compression&nbsp;works,&nbsp;but&nbsp;I&nbsp;do&nbsp;understand&nbsp;that&nbsp;it&nbsp;means&nbsp;you&nbsp;do&nbsp;funky&nbsp;stuff&nbsp;with&nbsp;the&nbsp;Y&nbsp;value. &nbsp;I&nbsp;do&nbsp;not&nbsp;believe&nbsp;that &lt;wbr&gt;EllipticCurvePrivateNumbers&nbsp;understands&nbsp;said&nbsp;funky&nbsp;stuff.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;specific&nbsp;ECC&nbsp;integration&nbsp;test&nbsp;with&nbsp;ssh-keygen&nbsp;from&nbsp;OpenSSH&nbsp;and&nbsp;twisted.conch.client.&lt;wbr&gt;knownhosts.KnownHostsFile&nbsp;would&nbsp;have&nbsp;spotted&nbsp;this&nbsp;specific&nbsp;manifestation&nbsp;of&nbsp;the&nbsp;issue. &nbsp;However,&nbsp;another&nbsp;underlying&nbsp;bug&nbsp;is&nbsp;that&nbsp;KnownHostsFile&nbsp;_should_&nbsp;ignore&nbsp;lines&nbsp;that&nbsp;it&nbsp;can&#39;t&nbsp;parse. &nbsp;And,&nbsp;there&#39;s&nbsp;another&nbsp;potential&nbsp;manifestation&nbsp;of&nbsp;the&nbsp;issue&nbsp;where&nbsp;loading&nbsp;from&nbsp;an&nbsp;actual&nbsp;key&nbsp;blob&nbsp;might&nbsp;not&nbsp;work;&nbsp;arguably&nbsp;the&nbsp;problem&nbsp;here&nbsp;is&nbsp;that&nbsp;KnownHostsFile&nbsp;made&nbsp;the&nbsp;questionable&nbsp;decision&nbsp;to&nbsp;do&nbsp;its&nbsp;own&nbsp;base64-decoding&nbsp;and&nbsp;pass&nbsp;the&nbsp;blob&nbsp;straight&nbsp;to&nbsp;the&nbsp;key&nbsp;rather&nbsp;than&nbsp;just&nbsp;pass&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;line&nbsp;after&nbsp;the&nbsp;hostname&nbsp;and&nbsp;load&nbsp;it&nbsp;as&nbsp;an&nbsp;openssh-format&nbsp;key&nbsp;directly.&lt;/div&gt;&lt;span&nbsp;class=&quot;gmail-HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes,&nbsp;you&nbsp;are&nbsp;on&nbsp;the&nbsp;right&nbsp;track. &nbsp;As&nbsp;the&nbsp;known_hosts&nbsp;file&nbsp;is&nbsp;parsed&nbsp;line&nbsp;by&nbsp;line,&lt;/div&gt;&lt;div&gt;if&nbsp;an&nbsp;exception&nbsp;is&nbsp;thrown&nbsp;during&nbsp;parsing,&nbsp;then&nbsp;any&nbsp;valid&nbsp;keys&nbsp;further&nbsp;in&nbsp;the&nbsp;file&nbsp;are&nbsp;ignored,&lt;/div&gt;&lt;div&gt;and&nbsp;you&nbsp;get&nbsp;the&nbsp;&quot;bad&nbsp;host&nbsp;key&quot;&nbsp;error.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;tried&nbsp;your&nbsp;patch,&nbsp;and&nbsp;while&nbsp;I&nbsp;don&#39;t&nbsp;get&nbsp;the&nbsp;same&nbsp;error,&nbsp;the&nbsp;patch&nbsp;doesn&#39;t&nbsp;solve&nbsp;the&nbsp;problem&nbsp;for&nbsp;me.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;did&nbsp;some&nbsp;more&nbsp;debugging,&nbsp;and&nbsp;when&nbsp;I&nbsp;tried&nbsp;to&nbsp;put&nbsp;some&nbsp;print&nbsp;statements&nbsp;in&nbsp;the&nbsp;code&nbsp;to&lt;/div&gt;&lt;div&gt;figure&nbsp;out&nbsp;what&nbsp;is&nbsp;going&nbsp;on,&nbsp;I&nbsp;found&nbsp;these&nbsp;errors:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;&lt;br&gt; &nbsp;File&nbsp;&quot;&lt;pudb&nbsp;command&nbsp;line&gt;&quot;,&nbsp;line&nbsp;1,&nbsp;in&nbsp;&lt;module&gt;&lt;br&gt; &nbsp;File&nbsp;&quot;/Users/crodrigues/twisted8/src/twisted/conch/ssh/keys.py&quot;,&nbsp;line&nbsp;787,&nbsp;in&nbsp;__repr__&lt;br&gt; &nbsp; &nbsp;self._keyObject.key_size)]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;AttributeError:&nbsp;&#39;_EllipticCurvePublicKey&#39;&nbsp;object&nbsp;has&nbsp;no&nbsp;attribute&nbsp;&#39;key_size&#39;&nbsp;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and&nbsp;also&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt; &nbsp;File&nbsp;&quot;/Users/crodrigues/twisted8/src/twisted/conch/client/knownhosts.py&quot;,&nbsp;line&nbsp;107,&nbsp;in&nbsp;matchesKey&lt;br&gt; &nbsp; &nbsp;print(&quot;SELF.PUBLICKEY&nbsp;&quot;,&nbsp;self.publickey)&lt;br&gt;AttributeError:&nbsp;&#39;PlainEntry&#39;&nbsp;object&nbsp;has&nbsp;no&nbsp;attribute&nbsp;&#39;publickey&#39;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;Craig &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
