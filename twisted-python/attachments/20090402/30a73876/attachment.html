<tt>
So&nbsp;I&nbsp;can&nbsp;do&nbsp;the&nbsp;following&nbsp;but&nbsp;the&nbsp;onDisconnect&nbsp;and&nbsp;onConnect&nbsp;functions&nbsp;don&#39;t&nbsp;receive&nbsp;the&nbsp;broker&nbsp;-&nbsp;odd&nbsp;design&nbsp;decision?&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;there&#39;s&nbsp;a&nbsp;comment&nbsp;in PBServerFactory.clientConnectionMade&nbsp;--&gt;&nbsp;&quot;#&nbsp;XXX&nbsp;does&nbsp;this&nbsp;method&nbsp;make&nbsp;any&nbsp;sense?&quot;.&nbsp; Weird.&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;class&nbsp;MyServerObject(pb.Root):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;__init__(self):&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; pass&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;onConnect(self):&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;MyServerObject::onConnect&quot;)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;onDisconnect(self):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;MyServerObject::onDisconnect&quot;)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;class&nbsp;MyServerFactory(pb.PBServerFactory):&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;buildProtocol(self,&nbsp;addr):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; s&nbsp;=&nbsp;addr.host&nbsp;+&nbsp;&quot;:&quot;&nbsp;+&nbsp;str(addr.port)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;MyServerFactory::buildProtocol&nbsp;-&nbsp;building&nbsp;protocol&nbsp;for&nbsp;&quot;&nbsp;+&nbsp;s)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; broker&nbsp;=&nbsp;pb.PBServerFactory.buildProtocol(self,&nbsp;addr)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; broker.notifyOnDisconnect(self.root.onDisconnect)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; broker.notifyOnConnect(self.root.onConnect)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; return&nbsp;broker&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;reactor.listenTCP(9999,&nbsp;MyServerFactory(MyServerObject()))&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;reactor.run()&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Apr&nbsp;2,&nbsp;2009&nbsp;at&nbsp;8:02&nbsp;AM,&nbsp;Mike&nbsp;Stoddart&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:stodge@gmail.com&quot;&gt;stodge@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;I&#39;m&nbsp;experimenting&nbsp;with&nbsp;Twisted&nbsp;Spread&nbsp;for&nbsp;a&nbsp;registry&nbsp;server,&nbsp;among&nbsp;other&nbsp;things.&nbsp;I&#39;m&nbsp;just&nbsp;curious&nbsp;how&nbsp;the&nbsp;onDisconnect&nbsp;function&nbsp;knows&nbsp;which&nbsp;client&nbsp;disconnected?&nbsp;I&#39;m&nbsp;also&nbsp;curious&nbsp;why&nbsp;the PBServerFactory&nbsp;class&nbsp;doesn&#39;t&nbsp;have&nbsp;a&nbsp;disconnection&nbsp;function&nbsp;to&nbsp;complement clientConnectionMade? I&nbsp;don&#39;t&nbsp;need&nbsp;security&nbsp;-&nbsp;this&nbsp;is&nbsp;running&nbsp;on&nbsp;a&nbsp;closed,&nbsp;secure&nbsp;LAN&nbsp;and&nbsp;I&nbsp;don&#39;t&nbsp;need&nbsp;&quot;Avatars&quot;.&nbsp;Any&nbsp;suggestions&nbsp;on&nbsp;how&nbsp;to&nbsp;improve&nbsp;this?&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;protocol,&nbsp;reactor&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;from&nbsp;twisted.python&nbsp;import&nbsp;log&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;from&nbsp;twisted.spread&nbsp;import&nbsp;pb&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;import&nbsp;sys&lt;/font&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;log.startLogging(sys.stdout)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;class&nbsp;RegistryService(pb.Root):&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;__init__(self):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; self._clientCount&nbsp;=&nbsp;0&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; self._clients&nbsp;=&nbsp;{}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;remote_register(self,&nbsp;name,&nbsp;service):&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;Registering&nbsp;service&nbsp;&quot;&nbsp;+&nbsp;name)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(str(service))&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; #&nbsp;Welcome&nbsp;the&nbsp;client.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; service.callRemote(&quot;welcome&quot;)&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;onDisconnect(self):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;onDisconnect&quot;)&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;Client&nbsp;count&nbsp;=&nbsp;&quot;&nbsp;+&nbsp;str(len(self._clients)))&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;onConnect(self,&nbsp;broker):&nbsp; &nbsp; &nbsp;  &lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; s&nbsp;=&nbsp;broker.transport.getPeer().host&nbsp;+&nbsp;&quot;:&quot;&nbsp;+&nbsp;str(broker.transport.getPeer().port)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;onConnect&nbsp;-&nbsp;client&nbsp;at&nbsp;&quot;&nbsp;+&nbsp;s) &lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; #&nbsp;Add&nbsp;the&nbsp;client.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; self._clients[s]&nbsp;=&nbsp;broker.transport&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;Client&nbsp;count&nbsp;=&nbsp;&quot;&nbsp;+&nbsp;str(len(self._clients)))&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; #&nbsp;Set&nbsp;a&nbsp;callback&nbsp;in&nbsp;case&nbsp;they&nbsp;disconnect.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; broker.notifyOnDisconnect(self.onDisconnect)&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;class&nbsp;MyPBFactory(pb.PBServerFactory):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;__init__(self,&nbsp;root):&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; pb.PBServerFactory.__init__(self,&nbsp;root)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; def&nbsp;clientConnectionMade(self,&nbsp;broker):&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; log.msg(&quot;clientConnectionMade&quot;)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; self.root.onConnect(broker)&nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;registry&nbsp;=&nbsp;RegistryService()&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;f&nbsp;=&nbsp;MyPBFactory(RegistryService())&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;reactor.listenTCP(9999,&nbsp;f)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&#39;courier&nbsp;new&#39;,&nbsp;monospace&quot;&gt;reactor.run()&lt;/font&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;Mike&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
