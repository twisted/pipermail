<tt>
Hi&nbsp;everyone,&lt;br&gt;I&#39;m&nbsp;writing&nbsp;a&nbsp;server&nbsp;and&nbsp;a&nbsp;client&nbsp;using&nbsp;Perspective&nbsp;Broker&nbsp;with&nbsp;no&nbsp;Avatar&nbsp;and&nbsp;no&nbsp;auth.&lt;br&gt;The&nbsp;server&nbsp;accumulates&nbsp;some&nbsp;data&nbsp;using&nbsp;a&nbsp;DeferredQueue.&lt;br&gt;The&nbsp;clients&nbsp;using&nbsp;a&nbsp;remote&nbsp;call&nbsp;retrieve&nbsp;one&nbsp;item&nbsp;per&nbsp;time&nbsp;from&nbsp;the&nbsp;queue&nbsp;and&nbsp;elaborates&nbsp;it&nbsp;making&nbsp;some&nbsp;changes&nbsp;on&nbsp;a&nbsp;database&nbsp;using&nbsp;adbapi.&lt;br&gt;<br>
What&nbsp;i&nbsp;want&nbsp;to&nbsp;know&nbsp;is:&nbsp;&lt;br&gt;1)&nbsp;how&nbsp;can&nbsp;i&nbsp;recursively&nbsp;call&nbsp;the&nbsp;remote&nbsp;method&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;items&nbsp;from&nbsp;the&nbsp;server?&lt;br&gt;2)&nbsp;can&nbsp;i&nbsp;defer&nbsp;the&nbsp;database&nbsp;operations&nbsp;to&nbsp;a&nbsp;thread&nbsp;so&nbsp;every&nbsp;client&nbsp;can&nbsp;elaborates&nbsp;multiple&nbsp;requests&nbsp;per&nbsp;time?&lt;br&gt;<br>
&lt;br&gt;The&nbsp;code&nbsp;i&#39;m&nbsp;using&nbsp;is&nbsp;this:&lt;br&gt;&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor,&nbsp;defer,&nbsp;pb&lt;br&gt;from&nbsp;twisted.enterprise&nbsp;import&nbsp;adbapi&lt;br&gt;from&nbsp;twisted.python&nbsp;import&nbsp;log&lt;br&gt;import&nbsp;os&lt;br&gt;&lt;br&gt;globalConfigurationFile=os.path.abspath(&#39;conf&#39;&nbsp;+&nbsp;os.sep&nbsp;+&nbsp;&#39;configuration.ini&#39;)&lt;br&gt;<br>
&lt;br&gt;class&nbsp;DataBasePreparerClient(object):&lt;br&gt;   &nbsp;&#39;&#39;&#39;&lt;br&gt;   &nbsp;DataBasePreparerClient()&lt;br&gt;   &nbsp;&#39;&#39;&#39;&lt;br&gt;   &nbsp;&lt;br&gt;   &nbsp;def&nbsp;__init__(self,&nbsp;globalConfigurationFile):&lt;br&gt;       &nbsp;self._gcf&nbsp;=&nbsp;globalConfigurationFile&lt;br&gt;<br>
       &nbsp;self.data&nbsp;=&nbsp;{}&lt;br&gt;       &nbsp;self._parseConfig()&lt;br&gt;<br>
       &nbsp;self._createDbPool()&lt;br&gt;       &nbsp;self.d&nbsp;=&nbsp;defer.Deferred()&lt;br&gt;       &nbsp;self.clientfactory&nbsp;=&nbsp;pb.PBClientFactory()&lt;br&gt;       &nbsp;&lt;br&gt;   &nbsp;def&nbsp;_createDbPool(self):&lt;br&gt;       &nbsp;self.dbpool&nbsp;=&nbsp;adbapi.ConnectionPool(&#39;cx_Oracle&#39;,&nbsp;self.data[&#39;db_username&#39;],&nbsp;self.data[&#39;db_password&#39;],&nbsp;self.data[&#39;db_tns&#39;])&lt;br&gt;<br>
   &nbsp;&lt;br&gt;   &nbsp;def&nbsp;connect(self):&lt;br&gt;       &nbsp;reactor.connectTCP(self.data[&#39;server_ip&#39;],&nbsp;self.data[&#39;server_port&#39;],&nbsp;self.clientfactory)&lt;br&gt;       &nbsp;self.d&nbsp;=&nbsp;self.clientfactory.getRootObject()&lt;br&gt;       &nbsp;self.dbpool.connect()&lt;br&gt;<br>
       &nbsp;self.d.addCallbacks(self.get_item,&nbsp;self._eb)&lt;br&gt;&lt;br&gt;   &nbsp;def&nbsp;_eb(self,&nbsp;reason):&lt;br&gt;<br>
       &nbsp;print&nbsp;&quot;Failure:&nbsp;&quot;,&nbsp;reason.getErrorMessage()&lt;br&gt;<br>
   &nbsp;&lt;br&gt;<br>
   &nbsp;def&nbsp;get_item(self,&nbsp;result):&lt;br&gt;<br>
       &nbsp;d&nbsp;=&nbsp;result.callRemote(&quot;get_item&quot;)&lt;br&gt;<br>
       &nbsp;d.addCallback(self.got_item)&lt;br&gt;<br>
       &nbsp;&lt;br&gt;   &nbsp;def&nbsp;got_item(self,&nbsp;item):&lt;br&gt;       &nbsp;query&nbsp;=&nbsp;&quot;update&nbsp;table&nbsp;where&nbsp;...&quot;&lt;br&gt;       &nbsp;res&nbsp;=&nbsp;self.dbpool.runOperation(query)&lt;br&gt;       &nbsp;res.addErrback(self._eb)&lt;br&gt;       &nbsp;self.d&nbsp;=&nbsp;self.clientfactory.getRootObject()&lt;br&gt;<br>
       &nbsp;self.d.addCallbacks(self.get_item,&nbsp;self._eb)&lt;br&gt;   &nbsp;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:&lt;br&gt;   &nbsp;DataBasePreparerClient(globalConfigurationFile).connect()&lt;br&gt;   &nbsp;reactor.run()&lt;br&gt;&lt;br&gt;To&nbsp;call&nbsp;recursively&nbsp;the&nbsp;remote&nbsp;object&nbsp;in&nbsp;function&nbsp;connect&nbsp;i&nbsp;call&nbsp;clientfactory.getRootObject()&nbsp;and&nbsp;addCallback()&nbsp;for&nbsp;the&nbsp;first&nbsp;time,&nbsp;and&nbsp;the&nbsp;i&nbsp;recall&nbsp;always&nbsp;self.clientfactory.getRootObject()&nbsp;and&nbsp;self.d.addCallback&nbsp;when&nbsp;the&nbsp;db&nbsp;query&nbsp;has&nbsp;completed.&lt;br&gt;<br>
Is&nbsp;this&nbsp;correct?&lt;br&gt;Do&nbsp;I&nbsp;have&nbsp;to&nbsp;always&nbsp;call&nbsp;self.clientfactory.getRootObject()&nbsp;every&nbsp;time&nbsp;i&nbsp;have&nbsp;to&nbsp;call&nbsp;a&nbsp;remote&nbsp;method?&lt;br&gt;Can&nbsp;i&nbsp;deferToThread&nbsp;the&nbsp;function&nbsp;got_item&nbsp;or&nbsp;self.dbpool.runOperation(query)?&lt;br&gt;Thanks&nbsp;in&nbsp;advance&lt;br&gt;<br>
Fabrizio&lt;br&gt;<br>

</tt>
