<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;Matthew&nbsp;-&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;couple&nbsp;of&nbsp;idioms&nbsp;I&nbsp;use&nbsp;for&nbsp;#2&nbsp;and&nbsp;#3&nbsp;in&nbsp;your&nbsp;message.&nbsp; Here&nbsp;they&nbsp;are.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#2)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;timer&nbsp;events,&nbsp;I&nbsp;create&nbsp;a&nbsp;function&nbsp;that&nbsp;when&nbsp;called,&nbsp;continuously&lt;/div&gt;<br>
&lt;div&gt;schedules&nbsp;itself&nbsp;again&nbsp;in&nbsp;the&nbsp;reactor,&nbsp;does&nbsp;some&nbsp;work&nbsp;for&nbsp;the&nbsp;current&lt;/div&gt;&lt;div&gt;tick,&nbsp;and&nbsp;then&nbsp;exits.&nbsp; I&#39;ve&nbsp;used&nbsp;this&nbsp;down&nbsp;to&nbsp;1-second&nbsp;intervals.&nbsp; If&lt;/div&gt;&lt;div&gt;you&#39;re&nbsp;looking&nbsp;for&nbsp;sub-millisecond&nbsp;level&nbsp;timing,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&lt;/div&gt;<br>
&lt;div&gt;appropriate&nbsp;for&nbsp;your&nbsp;application.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;timerFunction(reactor):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;reactor.callLater(1.0,&nbsp;timerFunction,&nbsp;reactor)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#&nbsp;do&nbsp;the&nbsp;work&nbsp;for&nbsp;this&nbsp;time&nbsp;tick&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;#&nbsp;etc&nbsp;etc&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;return&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;Somewhere&nbsp;in&nbsp;main&nbsp;do&nbsp;this&nbsp;to&nbsp;kick&nbsp;it&nbsp;off&lt;/div&gt;&lt;div&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;/div&gt;&lt;div&gt;timerFunction(reactor)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#3)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;subprocesses,&nbsp;I&nbsp;like&nbsp;to&nbsp;create&nbsp;a&nbsp;custom&nbsp;protocol&nbsp;for&nbsp;each&nbsp;type&nbsp;of&lt;/div&gt;&lt;div&gt;sub-command&nbsp;I&nbsp;am&nbsp;calling.&nbsp; I&nbsp;also&nbsp;like&nbsp;to&nbsp;create&nbsp;an&nbsp;object&nbsp;to&nbsp;manage&lt;/div&gt;&lt;div&gt;the&nbsp;process,&nbsp;its&nbsp;arguments,&nbsp;its&nbsp;results&nbsp;and&nbsp;its&nbsp;temp&nbsp;files.&nbsp; The&nbsp;idiom&lt;/div&gt;<br>
&lt;div&gt;below&nbsp;is&nbsp;suitable&nbsp;for&nbsp;calling&nbsp;a&nbsp;subprocess&nbsp;that&nbsp;accepts&nbsp;a&nbsp;small&nbsp;amount&lt;/div&gt;&lt;div&gt;of&nbsp;buffered&nbsp;data&nbsp;on&nbsp;stdin,&nbsp;produces&nbsp;some&nbsp;output&nbsp;on&nbsp;stdout,&nbsp;and&nbsp;logs&nbsp;its&lt;/div&gt;&lt;div&gt;stderr.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Be&nbsp;careful&nbsp;examining&nbsp;the&nbsp;value&nbsp;of&nbsp;reason.value.exitCode&nbsp;in&lt;/div&gt;<br>
&lt;div&gt;processExited.&nbsp; The&nbsp;twisted&nbsp;docs&nbsp;show&nbsp;printing&nbsp;the&nbsp;exitCode&nbsp;as&nbsp;a&nbsp;&quot;%d&quot;,&lt;/div&gt;&lt;div&gt;but&nbsp;sometimes&nbsp;the&nbsp;value&nbsp;is&nbsp;None&nbsp;---&nbsp;if&nbsp;the&nbsp;process&nbsp;was&nbsp;terminated&nbsp;by&nbsp;a&lt;/div&gt;&lt;div&gt;signal.&nbsp; The&nbsp;mere&nbsp;printing&nbsp;of&nbsp;the&nbsp;value&nbsp;with&nbsp;&quot;%d&quot;&nbsp;will&nbsp;then&nbsp;trigger&nbsp;an&lt;/div&gt;<br>
&lt;div&gt;exception!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&#39;s&nbsp;my&nbsp;idiom:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;FooprocProtocol(protocol.ProcessProtocol):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;__init__(self,&nbsp;foomgr):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;the&nbsp;object&nbsp;managing&nbsp;my&nbsp;subprocess&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.foomgr&nbsp;=&nbsp;foomgr&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;my&nbsp;stdout&nbsp;data&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.data&nbsp;=&nbsp;&quot;&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;connectionMade(self):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;Pump&nbsp;input&nbsp;data&nbsp;in&nbsp;using&nbsp;this,&nbsp;and&nbsp;then&nbsp;close&nbsp;stdin&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log.msg(&quot;connectionMade!&quot;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;self.transport.write(&quot;...&quot;)&nbsp; #&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;data&nbsp;to&nbsp;shove&nbsp;into&nbsp;stdin&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.transport.closeStdin()&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp;def&nbsp;outReceived(self,&nbsp;data):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;collect&nbsp;up&nbsp;our&nbsp;stdout&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log.msg(&quot;outReceived!&nbsp;with&nbsp;%d&nbsp;bytes!&quot;&nbsp;%&nbsp;len(data))&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.data&nbsp;=&nbsp;self.data&nbsp;+&nbsp;data&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;def&nbsp;errReceived(self,&nbsp;data):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;echo&nbsp;stderr&nbsp;messages&nbsp;to&nbsp;log&nbsp;with&nbsp;a&nbsp;marker&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log.msg(&quot;&gt;%s&quot;&nbsp;%&nbsp;data)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;inConnectionLost(self):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&quot;inConnectionLost!&nbsp;stdin&nbsp;is&nbsp;closed!&nbsp;(we&nbsp;probably&nbsp;did&nbsp;it)&quot;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;outConnectionLost(self):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log.msg(&quot;outConnectionLost!&nbsp;The&nbsp;child&nbsp;closed&nbsp;their&nbsp;stdout!&quot;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;errConnectionLost(self):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log.msg(&quot;errConnectionLost!&nbsp;The&nbsp;child&nbsp;closed&nbsp;their&nbsp;stderr.&quot;)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;processExited(self,&nbsp;reason):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log.msg(&quot;processExited:%s:&quot;&nbsp;%&nbsp;reason)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;exitcode&nbsp;=&nbsp;reason.value.exitCode&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;an&nbsp;integer&nbsp;or&nbsp;None&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;do&nbsp;some&nbsp;work&nbsp;upon&nbsp;processExit&nbsp;potentially&nbsp;make&nbsp;a&nbsp;decision&nbsp;on&nbsp;exitcode&nbsp;...&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log.msg(&quot;processExited:%s&quot;&nbsp;%&nbsp;exitcode)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;processEnded(self,&nbsp;reason):&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&quot;processEnded,&nbsp;status&nbsp;%s&quot;&nbsp;%&nbsp;(reason.value.exitCode,)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;process&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;process&nbsp;manager&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;exitcode&nbsp;=&nbsp;reason.value.exitCode&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;might&nbsp;be&nbsp;non-numeric&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;result&nbsp;=&nbsp;self.foomgr.processData(exitcode)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;The&nbsp;main&nbsp;job&nbsp;of&nbsp;the&nbsp;Process&nbsp;Manager&nbsp;is&nbsp;to&nbsp;build&nbsp;the&nbsp;command&nbsp;list&nbsp;and&lt;/div&gt;&lt;div&gt;#&nbsp;process&nbsp;the&nbsp;results.&nbsp; It&nbsp;gives&nbsp;us&nbsp;a&nbsp;handy&nbsp;place&nbsp;to&nbsp;encapsulate&nbsp;this&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;logic.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;FooprocManager(object):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;CMD&nbsp;=&nbsp;&quot;/usr/local/foocmd&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;__init__(self,&nbsp;arg1,&nbsp;arg2,&nbsp;arg3)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;create&nbsp;a&nbsp;Deferred&nbsp;to&nbsp;fire&nbsp;when&nbsp;we&nbsp;succeed&nbsp;or&nbsp;fail&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.d&nbsp;=&nbsp;Deferred()&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;build&nbsp;our&nbsp;command&nbsp;argument&nbsp;list&nbsp;as&nbsp;appropriate&nbsp;for&nbsp;our&nbsp;command&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.cmdargs&nbsp;=&nbsp;self.build_cmd_args(arg1,&nbsp;arg2,&nbsp;arg3)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;define&nbsp;places&nbsp;to&nbsp;store&nbsp;the&nbsp;transport,&nbsp;pid&nbsp;and&nbsp;other&nbsp;things&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.ptransport&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.pid&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;build_cmd_args(self,&nbsp;arg1,&nbsp;arg2,&nbsp;arg3):&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;in&nbsp;my&nbsp;projects,&nbsp;this&nbsp;method&nbsp;has&nbsp;become&nbsp;fairly&nbsp;involved&nbsp;as&nbsp;it&nbsp;creates&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;tmp&nbsp;files&nbsp;and&nbsp;builds&nbsp;potentially&nbsp;complicated&nbsp;argument&nbsp;lists.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;arglist&nbsp;=&nbsp;[self.CMD,&nbsp;arg1,&nbsp;arg2,&nbsp;arg3]&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;arglist&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;run(self):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;instantiate&nbsp;a&nbsp;protocol&nbsp;connected&nbsp;to&nbsp;this&nbsp;manager&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;pp&nbsp;=&nbsp;FooprocProtocol(self)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;spawn&nbsp;the&nbsp;process,&nbsp;save&nbsp;the&nbsp;PID&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.ptransport&nbsp;=&nbsp;reactor.spawnProcess(pp,&nbsp;self.CMD,&nbsp;self.cmdargs,&nbsp;{&nbsp;})&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.pid&nbsp;=&nbsp;self.ptransport.pid&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;processData(exitcode):&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;in&nbsp;my&nbsp;projects,&nbsp;this&nbsp;method&nbsp;opens&nbsp;up&nbsp;result&nbsp;files,&nbsp;parses&nbsp;results,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;moves&nbsp;things&nbsp;around,&nbsp;deletes&nbsp;tmp&nbsp;files,&nbsp;etc.&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;return&nbsp;the&nbsp;result&nbsp;that&nbsp;we&nbsp;ran&nbsp;this&nbsp;subprocess&nbsp;for&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;result&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;Instantiate&nbsp;a&nbsp;new&nbsp;process&nbsp;manager&nbsp;and&nbsp;run&nbsp;it&nbsp;this&nbsp;way.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mgr&nbsp;=&nbsp;FooprocManager(args&nbsp;...)&lt;/div&gt;&lt;div&gt;d&nbsp;=&nbsp;mgr.run(args&nbsp;...)&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt;=================&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;T&lt;/div&gt;&lt;/div&gt;<br>

</tt>
