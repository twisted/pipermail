<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;got&nbsp;the&nbsp;point.&lt;div&gt;server.py:&lt;/div&gt;&lt;div&gt;&lt;div&gt;def&nbsp;write(self,&nbsp;notifications):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;&quot;Connect&nbsp;to&nbsp;the&nbsp;APNS&nbsp;service&nbsp;and&nbsp;send&nbsp;notifications&quot;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;if&nbsp;True:&nbsp;#not&nbsp;self.factory:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;log.msg(&#39;APNSService&nbsp;write&nbsp;(connecting)&#39;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;with&nbsp;open(&#39;/tmp/wniapns.log&#39;,&#39;a&#39;)&nbsp;as&nbsp;f:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f.write(&quot;#&quot;*20+&quot;\n&quot;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f.write(&quot;apns&nbsp;server1\n&quot;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f.write(&quot;#&quot;*20+&quot;\n&quot;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;server,&nbsp;port&nbsp;=&nbsp;((APNS_SERVER_SANDBOX_HOSTNAME &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;self.environment&nbsp;==&nbsp;&#39;sandbox&#39;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else&nbsp;APNS_SERVER_HOSTNAME),&nbsp;APNS_SERVER_PORT)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;self.factory&nbsp;=&nbsp;self.clientProtocolFactory()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;context&nbsp;=&nbsp;self.getContextFactory()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;reactor.connectSSL(server,&nbsp;port,&nbsp;self.factory,&nbsp;context)&lt;/div&gt;&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;client&nbsp;=&nbsp;self.factory.clientProtocol&lt;/div&gt;&lt;div&gt; &nbsp; &lt;b&gt;&lt;font&nbsp;color=&quot;#ff0000&quot;&gt;&nbsp;if&nbsp;client:&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;with&nbsp;open(&#39;/tmp/wniapns.log&#39;,&#39;a&#39;)&nbsp;as&nbsp;f:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f.write(&quot;#&quot;*20+&quot;\n&quot;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f.write(&quot;apns&nbsp;server2\n&quot;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f.write(&quot;#&quot;*20+&quot;\n&quot;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;return&nbsp;client.sendMessage(notifications)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;else:&nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;/div&gt;&lt;div&gt;Problem&nbsp;is&nbsp;for&nbsp;twice&nbsp;push&nbsp;to&nbsp;one&nbsp;device,&nbsp;client&nbsp;is&nbsp;not&nbsp;None&nbsp;the&nbsp;second&nbsp;time,&nbsp;code&nbsp;goes&nbsp;here&nbsp;and&nbsp;error&nbsp;then.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;BTW,&nbsp;what&nbsp;I&nbsp;wanna&nbsp;ask&nbsp;is&nbsp;where&nbsp;is&nbsp;the&nbsp;default&nbsp;log&nbsp;file?&nbsp;I&nbsp;didn&#39;t&nbsp;see&nbsp;any&nbsp;exception&nbsp;raised.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;haven&#39;t&nbsp;used&nbsp;pyapns&nbsp;and&nbsp;twisted&nbsp;before,&nbsp;I&nbsp;see&nbsp;twisted&nbsp;has&nbsp;lines&nbsp;like&nbsp;log.msg(&quot;xx&quot;),&nbsp;where&nbsp;is&nbsp;the&nbsp;default&nbsp;log&nbsp;file?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks.&lt;/div&gt;&lt;div&gt;Wesley&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2014-10-16&nbsp;13:39&nbsp;GMT+08:00&nbsp;Glyph&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;On&nbsp;Oct&nbsp;14,&nbsp;2014,&nbsp;at&nbsp;6:27&nbsp;PM,&nbsp;Ni&nbsp;Wesley&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:nispray@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;nispray@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt; &nbsp; The&nbsp;code&nbsp;is&nbsp;from&nbsp;our&nbsp;partner,&nbsp;so&nbsp;currently&nbsp;I&nbsp;won&#39;t&nbsp;change&nbsp;their&nbsp;code&nbsp;until&nbsp;I&nbsp;address&nbsp;this&nbsp;issue.&lt;/div&gt;&lt;div&gt;The&nbsp;used&nbsp;pyapns&nbsp;code&nbsp;is&nbsp;here:&nbsp; &lt;a&nbsp;name=&quot;149177b1382eabf8_OLE_LINK46&quot;&gt;&lt;span&nbsp;lang=&quot;EN-US&quot;&nbsp;style=&quot;font-size:10.5pt;font-family:&#39;Times&nbsp;New&nbsp;Roman&#39;,serif&quot;&gt;https://github.com/samuraisam/pyapns&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;name=&quot;149177b1382eabf8_OLE_LINK46&quot;&gt;&lt;span&nbsp;lang=&quot;EN-US&quot;&nbsp;style=&quot;font-size:10.5pt;font-family:&#39;Times&nbsp;New&nbsp;Roman&#39;,serif&quot;&gt;And&nbsp;start&nbsp;twisted&nbsp;service&nbsp;by&nbsp;command&nbsp;:&nbsp; twistd&nbsp;-r&nbsp;epoll&nbsp;web&nbsp;--class=pyapns.server.APNSServer&nbsp;--port=7077&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;Could&nbsp;you&nbsp;please&nbsp;help&nbsp;have&nbsp;a&nbsp;look?&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;OK,&nbsp;you&nbsp;made&nbsp;me&nbsp;curious&nbsp;;).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;looked&nbsp;through&nbsp;the&nbsp;code,&nbsp;and&nbsp;as&nbsp;it&nbsp;stands,&nbsp;I&nbsp;doubt&nbsp;my&nbsp;original&nbsp;hypothesis&nbsp;(a&nbsp;threading&nbsp;problem)&nbsp;is&nbsp;correct. &nbsp;Threads&nbsp;are&nbsp;used&nbsp;only&nbsp;in&nbsp;the&nbsp;client&nbsp;talking&nbsp;to&nbsp;the&nbsp;pyapns&nbsp;server,&nbsp;not&nbsp;the&nbsp;pyapns&nbsp;server&#39;s&nbsp;client&nbsp;talking&nbsp;to&nbsp;APNS,&nbsp;so&nbsp;they&#39;re&nbsp;probably&nbsp;not&nbsp;interfering&nbsp;with&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;tell,&nbsp;the&nbsp;ReconnectingClientFactory&nbsp;is&nbsp;set&nbsp;up&nbsp;properly. &nbsp;Have&nbsp;you&nbsp;looked&nbsp;at&nbsp;the&nbsp;logs? &nbsp;The&nbsp;one&nbsp;possibility&nbsp;I&nbsp;can&nbsp;think&nbsp;of&nbsp;just&nbsp;from&nbsp;examining&nbsp;the&nbsp;code&nbsp;is&nbsp;that&nbsp;the&nbsp;log&nbsp;messages&nbsp;before&nbsp;calling&nbsp;up&nbsp;to&nbsp;ReconnectingClientFactory.clientConnectionLost&nbsp;are&nbsp;raising&nbsp;an&nbsp;exception,&nbsp;causing&nbsp;the&nbsp;reconnection&nbsp;not&nbsp;to&nbsp;proceed. &nbsp;That&nbsp;would&nbsp;most&nbsp;likely&nbsp;show&nbsp;a&nbsp;traceback&nbsp;in&nbsp;the&nbsp;logs,&nbsp;though.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;&lt;a&nbsp;href=&quot;https://github.com/samuraisam/pyapns/blob/master/pyapns/server.py#L157-L164&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/samuraisam/pyapns/blob/master/pyapns/server.py#L157-L164&lt;/a&gt;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;clue?&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;我是nispray先生<br>
&lt;/div&gt;<br>

</tt>
