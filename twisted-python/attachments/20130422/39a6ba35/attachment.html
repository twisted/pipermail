<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;RFC&nbsp;4252 &lt;a&nbsp;href=&quot;http://www.ietf.org/rfc/rfc4252.txt&quot;&gt;http://www.ietf.org/rfc/rfc4252.txt&lt;/a&gt; for &lt;span&nbsp;style=&quot;color:rgb(0,0,0);white-space:pre-wrap&quot;&gt;The&nbsp;Secure&nbsp;Shell&nbsp;(SSH)&nbsp;Authentication&nbsp;Protocol&nbsp;at&nbsp;section&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);white-space:pre-wrap&quot;&gt;7.&nbsp;&nbsp;Public&nbsp;Key&nbsp;Authentication&nbsp;Method:&nbsp;&quot;publickey&quot;&lt;/span&gt;&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;There&nbsp;is&nbsp;the&nbsp;following&nbsp;information&nbsp;about&nbsp;SSH&nbsp;public&nbsp;key&nbsp;signature.&lt;/div&gt;&lt;div&gt;&lt;pre&nbsp;style=&quot;color:rgb(0,0,0);word-wrap:break-word;white-space:pre-wrap&quot;&gt;&nbsp;The&nbsp;value&nbsp;of&nbsp;&#39;signature&#39;&nbsp;is&nbsp;a&nbsp;signature&nbsp;by&nbsp;the&nbsp;corresponding&nbsp;private&nbsp;key&nbsp;over&nbsp;the&nbsp;following&nbsp;data,&nbsp;in&nbsp;the&nbsp;following&nbsp;order:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;session&nbsp;identifier<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSH_MSG_USERAUTH_REQUEST<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;user&nbsp;name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;service&nbsp;name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&quot;publickey&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;&nbsp;&nbsp;TRUE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;key&nbsp;algorithm&nbsp;name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;key&nbsp;to&nbsp;be&nbsp;used&nbsp;for&nbsp;authentication<br>
<br>
&nbsp;&nbsp;&nbsp;When&nbsp;the&nbsp;server&nbsp;receives&nbsp;this&nbsp;message,&nbsp;it&nbsp;MUST&nbsp;check&nbsp;whether&nbsp;the&nbsp;supplied&nbsp;key&nbsp;is&nbsp;acceptable&nbsp;for&nbsp;authentication,&nbsp;and&nbsp;if&nbsp;so,&nbsp;it&nbsp;MUST&nbsp;check&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;correct.&lt;/pre&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;The&nbsp;current&nbsp;code&nbsp;check&nbsp;that&nbsp;key&nbsp;is&nbsp;accepted&nbsp;for&nbsp;authentication&nbsp;and&nbsp;it&nbsp;also&nbsp;verifies&nbsp;if&nbsp;signature&nbsp;is&nbsp;correct.&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;It&nbsp;does&nbsp;not&nbsp;check&nbsp;that&nbsp;session&nbsp;the&nbsp;format&nbsp;of&nbsp;the&nbsp;signed&nbsp;data, especially&nbsp;if&nbsp;session&nbsp;identifier&nbsp;from&nbsp;signed&nbsp;data&nbsp;is  the&nbsp;same&nbsp;as&nbsp;the&nbsp;session&nbsp;of&nbsp;the&nbsp;the&nbsp;current&nbsp;SSH&nbsp;transport&nbsp; session.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;-----&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&nbsp;also&nbsp;found&nbsp;this&nbsp;document&nbsp;describing&nbsp;how&nbsp;ssh&nbsp;public&nbsp;key&nbsp;authentication&nbsp;works,&nbsp;but&nbsp;it&nbsp;differes&nbsp;from&nbsp;the&nbsp;current&nbsp;conch.ssh&nbsp;userauth.py&nbsp;implementation...&nbsp;maybe&nbsp;it&nbsp;is&nbsp;for&nbsp;SSH&nbsp;v1 &lt;a&nbsp;href=&quot;http://www.unixwiz.net/techtips/ssh-agent-forwarding.html#chal&quot;&gt;http://www.unixwiz.net/techtips/ssh-agent-forwarding.html#chal&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;------&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Shouldn&#39;t twisted.conch.checkers.SSHPublicKeyDatabase&nbsp;also&nbsp;check&nbsp;that&nbsp;session&nbsp;id&nbsp;from&nbsp;signed&nbsp;data&nbsp;match&nbsp;the&nbsp;one&nbsp;from&nbsp;transport&nbsp;session?&lt;br&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Maybe&nbsp;it&nbsp;does&nbsp;but&nbsp;I&nbsp;am&nbsp;not&nbsp;looking&nbsp;at&nbsp;the&nbsp;right&nbsp;place.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&nbsp;see&nbsp;that&nbsp;in&nbsp;conch/checkers.py&nbsp;line&nbsp;167 &lt;a&nbsp;href=&quot;https://github.com/tomprince/twisted/blob/trunk/twisted/conch/checkers.py#L167&quot;&gt;https://github.com/tomprince/twisted/blob/trunk/twisted/conch/checkers.py#L167&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;there&nbsp;is&nbsp;this&nbsp;check,&nbsp;which&nbsp;once&nbsp;signature&nbsp;is&nbsp;valid&nbsp; it&nbsp;just&nbsp;returns&nbsp;avatar_id:&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;pubKey.verify(credentials.signature,&nbsp;credentials.sigData):&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;credentials.username&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thanks!&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Adi&nbsp;Roiban<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
