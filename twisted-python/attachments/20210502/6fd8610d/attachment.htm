<tt>
&lt;html&gt;Hi&nbsp;Adi,&nbsp;all,&lt;br&nbsp;/&gt;First,&nbsp;thx&nbsp;for&nbsp;your&nbsp;reply.&lt;br&nbsp;/&gt;I&nbsp;think&nbsp;your&nbsp;solution&nbsp;may&nbsp;not&nbsp;be&nbsp;the&nbsp;good&nbsp;one,&nbsp;but&nbsp;for&nbsp;sure,&nbsp;you&nbsp;put&nbsp;me&nbsp;on&nbsp;the&nbsp;good&nbsp;track,&nbsp;so&nbsp;thx&nbsp;a&nbsp;lot.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;What&nbsp;I&nbsp;currently&nbsp;did&nbsp;:&lt;br&nbsp;/&gt;I&nbsp;did&nbsp;an&nbsp;inheritance&nbsp;of&nbsp;DNSServerFactory&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;add&nbsp;the&nbsp;&quot;address&quot;&nbsp;propertie&nbsp;on&nbsp;my&nbsp;query&nbsp;object.&lt;br&nbsp;/&gt;It&nbsp;looks&nbsp;like&nbsp;that&nbsp;:&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;class&nbsp;DNSServerFactory2(server.DNSServerFactory):&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;def&nbsp;handleQuery(self,&nbsp;message,&nbsp;protocol,&nbsp;address):&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query&nbsp;=&nbsp;message.queries[0]&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.address&nbsp;=&nbsp;address&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message.queries[0]&nbsp;=&nbsp;query&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;pprint&nbsp;import&nbsp;pprint&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pprint(vars(message.queries[0]))&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;super().handleQuery(message,&nbsp;protocol,&nbsp;address)&nbsp;#&nbsp;@&nbsp;&nbsp;this&nbsp;point&nbsp;the&nbsp;resolver&nbsp;is&nbsp;called&nbsp;in&nbsp;the&nbsp;DNSServerFactory.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;In&nbsp;the&nbsp;log&nbsp;i&nbsp;have&nbsp;that&nbsp;:&lt;br&nbsp;/&gt;2021-05-02&nbsp;08:47:58+0200&nbsp;[-]&nbsp;{'address':&nbsp;('127.0.0.1',&nbsp;60750),&lt;br&nbsp;/&gt;2021-05-02&nbsp;08:47:58+0200&nbsp;[-]&nbsp;&nbsp;'cls':&nbsp;1,&lt;br&nbsp;/&gt;2021-05-02&nbsp;08:47:58+0200&nbsp;[-]&nbsp;&nbsp;'name':&nbsp;&lt;twisted.names.dns.Name&nbsp;object&nbsp;at&nbsp;0x13c8e38b0&gt;,&lt;br&nbsp;/&gt;2021-05-02&nbsp;08:47:58+0200&nbsp;[-]&nbsp;&nbsp;'type':&nbsp;1}&lt;br&nbsp;/&gt;So&nbsp;the&nbsp;propertie&nbsp;looks&nbsp;added...&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;But&nbsp;after&nbsp;that,&nbsp;I&nbsp;am&nbsp;going&nbsp;to&nbsp;the&nbsp;resolver&nbsp;and&nbsp;at&nbsp;that&nbsp;moment,&nbsp;the&nbsp;address&nbsp;propertie&nbsp;is&nbsp;missing...?!&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;def&nbsp;query(self,&nbsp;query,&nbsp;timeout=None):&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;pprint&nbsp;import&nbsp;pprint&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pprint(vars(query))&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;in&nbsp;the&nbsp;logs&nbsp;:&lt;br&nbsp;/&gt;2021-05-02&nbsp;08:47:58+0200&nbsp;[-]&nbsp;{'cls':&nbsp;1,&nbsp;'name':&nbsp;&lt;twisted.names.dns.Name&nbsp;object&nbsp;at&nbsp;0x13c8e3880&gt;,&nbsp;'t&lt;br&nbsp;/&gt;ype':&nbsp;1}&lt;br&nbsp;/&gt;So&nbsp;there&nbsp;is&nbsp;no&nbsp;anymore&nbsp;the&nbsp;address&nbsp;propertie&nbsp;that&nbsp;i&nbsp;have&nbsp;added&nbsp;just&nbsp;before...&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;What&nbsp;am&nbsp;i&nbsp;missing?&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Thx&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Benoît&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Le&nbsp;Samedi,&nbsp;Mai&nbsp;01,&nbsp;2021&nbsp;11:18&nbsp;CEST,&nbsp;Adi&nbsp;Roiban&nbsp;&lt;adi@roiban.ro&gt;&nbsp;a&nbsp;écrit:&lt;br&nbsp;/&gt;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;cite=&quot;CAFycZ9d=TCnDjuxiE=LXpGjquMXxJv=DDW7rMvbk+pgK7vuqPg@mail.gmail.com&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&lt;/div&gt;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sat,&nbsp;1&nbsp;May&nbsp;2021&nbsp;at&nbsp;07:43,&nbsp;&lt;a&nbsp;href=&quot;mailto:contact@benoit-laviale.fr&quot;&gt;contact@benoit-laviale.fr&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:contact@benoit-laviale.fr&quot;&gt;contact@benoit-laviale.fr&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;Dear&nbsp;all,&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;I&nbsp;am&nbsp;working&nbsp;on&nbsp;twisted&nbsp;names&nbsp;since&nbsp;some&nbsp;days&nbsp;to&nbsp;make&nbsp;kind&nbsp;of&nbsp;filtering&nbsp;system&nbsp;(with&nbsp;domains&nbsp;blacklists).&lt;br&nbsp;/&gt;So&nbsp;I&nbsp;made&nbsp;my&nbsp;own&nbsp;resolver&nbsp;that&nbsp;can&nbsp;reply&nbsp;defer.fail(error.DomainError())&nbsp;to&nbsp;send&nbsp;the&nbsp;query&nbsp;to&nbsp;the&nbsp;next&nbsp;resolver&nbsp;(and&nbsp;in&nbsp;this&nbsp;case,&nbsp;it&nbsp;will&nbsp;be&nbsp;resolve)&nbsp;or&nbsp;defer.fail(dns.AuthoritativeDomainError(&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;href=&quot;http://query.name.name&quot;&gt;query.name.name&lt;/a&gt;))&nbsp;to&nbsp;reply&nbsp;NXDOMAIN&nbsp;that&nbsp;can&nbsp;&quot;block&quot;&nbsp;the&nbsp;domain&nbsp;to&nbsp;the&nbsp;final&nbsp;client.&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;That&nbsp;part&nbsp;is&nbsp;working&nbsp;well.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Next,&nbsp;i&nbsp;would&nbsp;like&nbsp;to&nbsp;&quot;block&quot;&nbsp;the&nbsp;resolution&nbsp;regarding&nbsp;the&nbsp;device&nbsp;(Mac&nbsp;address/IP/???).&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;I&nbsp;would&nbsp;like&nbsp;something&nbsp;like&nbsp;that&nbsp;:&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;if&nbsp;self.query.meta.client.ip&nbsp;==&nbsp;b&quot;192.168.0.5&quot;&nbsp;or&nbsp;self.query.meta.client.mac&nbsp;==&nbsp;&quot;XX:YY:ZZ:....&quot;:&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.do_something()&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;My&nbsp;use&nbsp;case&nbsp;is&nbsp;that&nbsp;device&nbsp;of&nbsp;Kelly,&nbsp;(Kelly&nbsp;is&nbsp;a&nbsp;teenager&nbsp;of&nbsp;12&nbsp;years)&nbsp;cant&nbsp;use&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;href=&quot;http://youtube.com&quot;&gt;youtube.com&lt;/a&gt;&nbsp;at&nbsp;all,&nbsp;but&nbsp;other&nbsp;devices&nbsp;are&nbsp;allowed&nbsp;to&nbsp;get&nbsp;the&nbsp;resolution.&lt;br&nbsp;/&gt;How&nbsp;can&nbsp;I&nbsp;get&nbsp;the&nbsp;IP/Name/mac&nbsp;(an&nbsp;identifier)&nbsp;of&nbsp;the&nbsp;device&nbsp;that's&nbsp;querying&nbsp;my&nbsp;custom&nbsp;dns?&lt;br&nbsp;/&gt;I&nbsp;read&nbsp;something&nbsp;about&nbsp;datagrams,&nbsp;but&nbsp;in&nbsp;my&nbsp;case&nbsp;i&nbsp;think&nbsp;i&nbsp;must&nbsp;get&nbsp;this&nbsp;information&nbsp;in&nbsp;my&nbsp;resolver...&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Thx&nbsp;and&nbsp;cheers.&lt;/blockquote&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;you&nbsp;are&nbsp;using&nbsp;DNS&nbsp;over&nbsp;UDP...&nbsp;so&nbsp;to&nbsp;understand&nbsp;how&nbsp;UDP&nbsp;works&nbsp;with&nbsp;Twisted&nbsp;you&nbsp;can&nbsp;check&nbsp;this&nbsp;page&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/current/core/howto/udp.html&quot;&gt;https://twistedmatrix.com/documents/current/core/howto/udp.html&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;&nbsp;I&nbsp;have&nbsp;never&nbsp;used&nbsp;Twisted&nbsp;names&nbsp;so&nbsp;I&nbsp;am&nbsp;just&nbsp;trying&nbsp;to&nbsp;help&nbsp;based&nbsp;on&nbsp;my&nbsp;general&nbsp;knowledge&nbsp;of&nbsp;Twisted&nbsp;design&lt;/div&gt;&lt;div&gt;...&nbsp;but&nbsp;I&nbsp;think&nbsp;the&nbsp;entry&nbsp;point&nbsp;is&nbsp;here&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/twisted/twisted/blob/63649469c1fe46d8a713e8034239ac3cc0498ea7/src/twisted/names/dns.py#L3242&quot;&gt;https://github.com/twisted/twisted/blob/63649469c1fe46d8a713e8034239ac3cc0498ea7/src/twisted/names/dns.py#L3242&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;then&nbsp;it&nbsp;goes&nbsp;to&nbsp;here&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/twisted/twisted/blob/63649469c1fe46d8a713e8034239ac3cc0498ea7/src/twisted/names/server.py#L538&quot;&gt;https://github.com/twisted/twisted/blob/63649469c1fe46d8a713e8034239ac3cc0498ea7/src/twisted/names/server.py#L538&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;and&nbsp;then&nbsp;in&nbsp;handleQuery&nbsp;where&nbsp;I&nbsp;see&nbsp;that&nbsp;the&nbsp;&nbsp;query&nbsp;is&nbsp;done&nbsp;without&nbsp;the&nbsp;`address`...but&nbsp;the&nbsp;address&nbsp;is&nbsp;available&nbsp;again&nbsp;in&lt;/div&gt;&lt;div&gt;`gotResolverResponse`..&nbsp;so&nbsp;maybe&nbsp;that&nbsp;help&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;-------&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;Hope&nbsp;it&nbsp;helps&lt;div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&gt;Adi&nbsp;Roiban&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;/html&gt;<br>

</tt>
