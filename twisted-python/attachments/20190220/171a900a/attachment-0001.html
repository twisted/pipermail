<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Feb&nbsp;19,&nbsp;2019,&nbsp;at&nbsp;5:34&nbsp;AM,&nbsp;Chris&nbsp;Withers&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:chris@withers.org&quot;&nbsp;class=&quot;&quot;&gt;chris@withers.org&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;19/02/2019&nbsp;11:41,&nbsp;Adi&nbsp;Roiban&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I&nbsp;think&nbsp;it&nbsp;was&nbsp;introduced&nbsp;to&nbsp;catch&nbsp;some&nbsp;common&nbsp;bad&nbsp;usage&nbsp;patterns&nbsp;...&lt;br&nbsp;class=&quot;&quot;&gt;like&nbsp;yours&nbsp;:)&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Not&nbsp;a&nbsp;massively&nbsp;helpful&nbsp;comment.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;I&nbsp;think&nbsp;what&nbsp;Adi&nbsp;was&nbsp;trying&nbsp;to&nbsp;get&nbsp;at&nbsp;here&nbsp;is&nbsp;that&nbsp;this&nbsp;is&nbsp;exactly&nbsp;the&nbsp;sort&nbsp;of&nbsp;type&nbsp;confusion&nbsp;that&nbsp;this&nbsp;assert&nbsp;was&nbsp;intended&nbsp;to&nbsp;defend&nbsp;against.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;said,&nbsp;the&nbsp;bare&nbsp;assert&nbsp;in&nbsp;question&nbsp;was&nbsp;definitely&nbsp;written&nbsp;with&nbsp;the&nbsp;implementor's&nbsp;sort&nbsp;of&nbsp;&quot;this&nbsp;should&nbsp;never&nbsp;happen&quot;&nbsp;hat&nbsp;on,&nbsp;not&nbsp;the&nbsp;&quot;let's&nbsp;report&nbsp;a&nbsp;useful&nbsp;error&nbsp;to&nbsp;the&nbsp;user&quot;&nbsp;hat.&nbsp;&nbsp;So&nbsp;it&nbsp;could&nbsp;certainly&nbsp;stand&nbsp;to&nbsp;be&nbsp;improved&nbsp;regardless.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;If&nbsp;you&nbsp;want&nbsp;to&nbsp;chain&nbsp;the&nbsp;deferreds,&nbsp;use&nbsp;the&nbsp;dedicated&nbsp;helper&lt;br&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/documents/current/core/howto/defer.html#chaining-deferreds&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/documents/current/core/howto/defer.html#chaining-deferreds&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;Deferred&nbsp;are&nbsp;not&nbsp;always&nbsp;100%&nbsp;resolved/called.&lt;br&nbsp;class=&quot;&quot;&gt;You&nbsp;might&nbsp;have&nbsp;a&nbsp;deferred&nbsp;called,&nbsp;but&nbsp;the&nbsp;current&nbsp;result&nbsp;might&nbsp;be&lt;br&nbsp;class=&quot;&quot;&gt;another&nbsp;deferred...&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;final&nbsp;result&nbsp;yet.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;----&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;so&nbsp;in&nbsp;your&nbsp;case,&nbsp;instead&nbsp;of&nbsp;`returnValue(result)`&nbsp;use&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;result&nbsp;=&nbsp;yield&nbsp;result&lt;br&nbsp;class=&quot;&quot;&gt;returnValue(result)&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;in&nbsp;this&nbsp;way,&nbsp;the&nbsp;result&nbsp;is&nbsp;resolved&nbsp;:)&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;The&nbsp;methods&nbsp;being&nbsp;hooked&nbsp;don't&nbsp;necessarily&nbsp;return&nbsp;deferreds.&lt;br&nbsp;class=&quot;&quot;&gt;I'd&nbsp;like&nbsp;it&nbsp;to&nbsp;be&nbsp;an&nbsp;explicit&nbsp;choice&nbsp;of&nbsp;the&nbsp;caller,&nbsp;ie:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;result&nbsp;=&nbsp;yield&nbsp;SomeProtocol.onMessage.called()&lt;br&nbsp;class=&quot;&quot;&gt;#&nbsp;okay,&nbsp;we&nbsp;got&nbsp;here,&nbsp;we&nbsp;know&nbsp;onMessage&nbsp;was&nbsp;called,&lt;br&nbsp;class=&quot;&quot;&gt;#&nbsp;now&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;tick&nbsp;a&nbsp;clock,&nbsp;or&nbsp;otherwise&nbsp;simulate&lt;br&nbsp;class=&quot;&quot;&gt;#&nbsp;async&nbsp;state&nbsp;manipulation.&lt;br&nbsp;class=&quot;&quot;&gt;#&nbsp;now&nbsp;I&nbsp;want&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;deferred&nbsp;chain&nbsp;on&nbsp;the&nbsp;onMessage&nbsp;result&nbsp;has&nbsp;been&nbsp;completed:&lt;br&nbsp;class=&quot;&quot;&gt;yield&nbsp;result&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I'm&nbsp;not&nbsp;sure&nbsp;I&nbsp;understand&nbsp;your&nbsp;example&nbsp;here.&nbsp;&nbsp;The&nbsp;assertion&nbsp;in&nbsp;question&nbsp;only&nbsp;happens&nbsp;if&nbsp;you&nbsp;call&nbsp;returnValue&nbsp;or&nbsp;do&nbsp;a&nbsp;return&nbsp;with&nbsp;a&nbsp;Deferred&nbsp;directly;&nbsp;this&nbsp;example&nbsp;doesn't&nbsp;do&nbsp;either&nbsp;of&nbsp;those&nbsp;things.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;think&nbsp;you&nbsp;could&nbsp;fix&nbsp;the&nbsp;linked&nbsp;example&nbsp;code&nbsp;to&nbsp;still&nbsp;do&nbsp;what&nbsp;you&nbsp;want&nbsp;by&nbsp;simply&nbsp;doing&nbsp;`returnValue(yield&nbsp;result)`?&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;-g&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
