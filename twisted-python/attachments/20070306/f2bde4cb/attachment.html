<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;6.5.7651.59&quot;&gt;<br>
&lt;TITLE&gt;Learning&nbsp;about&nbsp;IPushProducer&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;!--&nbsp;Converted&nbsp;from&nbsp;text/rtf&nbsp;format&nbsp;--&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;When&nbsp;running&nbsp;the&nbsp;following&nbsp;code&nbsp;(my&nbsp;2nd&nbsp;twisted&nbsp;program!),&nbsp;it&nbsp;works&nbsp;as&nbsp;I&nbsp;had&nbsp;hoped&nbsp;-&nbsp;it&nbsp;doesn't&nbsp;starve&nbsp;any&nbsp;clients&nbsp;that&nbsp;want&nbsp;to&nbsp;receive&nbsp;data&nbsp;back,&nbsp;even&nbsp;with&nbsp;a&nbsp;simultaneously&nbsp;active&nbsp;really&nbsp;long&nbsp;streaming&nbsp;server-to-client&nbsp;communication&nbsp;(i.e.&nbsp;one&nbsp;piggy&nbsp;client&nbsp;asking&nbsp;for&nbsp;millions&nbsp;of&nbsp;bytes).&nbsp;&nbsp;i.e.&nbsp;another&nbsp;client&nbsp;can&nbsp;get&nbsp;in&nbsp;and&nbsp;ask&nbsp;for&nbsp;just&nbsp;a&nbsp;few&nbsp;bytes&nbsp;while&nbsp;a&nbsp;large&nbsp;payload&nbsp;is&nbsp;being&nbsp;delivered&nbsp;to&nbsp;a&nbsp;different&nbsp;client.&nbsp;&nbsp;Which&nbsp;is&nbsp;great!&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;Here's&nbsp;a&nbsp;sample&nbsp;interaction&nbsp;from&nbsp;the&nbsp;client&nbsp;side:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;$&nbsp;telnet&nbsp;localhost&nbsp;8007&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;Trying&nbsp;127.0.0.1...&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;Connected&nbsp;to&nbsp;localhost.&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;Escape&nbsp;character&nbsp;is&nbsp;'^]'.&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;1&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;x&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;2&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;xx&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;3&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;xxx&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;10&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;xxxxxxxxxx&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;99999&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;[...lots&nbsp;of&nbsp;x's...]&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;bye&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;Connection&nbsp;closed&nbsp;by&nbsp;foreign&nbsp;host.&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;$&nbsp;&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;So&nbsp;I&nbsp;have&nbsp;2&nbsp;questions&nbsp;on&nbsp;my&nbsp;code:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;1)&nbsp;am&nbsp;I&nbsp;doing&nbsp;anything&nbsp;wrong&nbsp;in&nbsp;setting&nbsp;up&nbsp;the&nbsp;plumbing?&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;2)&nbsp;does&nbsp;pauseProducing()&nbsp;get&nbsp;called&nbsp;by&nbsp;another&nbsp;thread&nbsp;whilst&nbsp;resumeProducing()&nbsp;is&nbsp;running?&nbsp;&nbsp;(I&nbsp;believe&nbsp;it&nbsp;must,&nbsp;otherwise&nbsp;my&nbsp;resumeProducing()&nbsp;would&nbsp;only&nbsp;be&nbsp;entered&nbsp;once).&nbsp;&nbsp;If&nbsp;so&nbsp;I&nbsp;should&nbsp;have&nbsp;an&nbsp;appropriate&nbsp;mutex&nbsp;around&nbsp;the&nbsp;read/write&nbsp;of&nbsp;self.pause,&nbsp;no?&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;Here&nbsp;is&nbsp;the&nbsp;code,&nbsp;and&nbsp;output&nbsp;from&nbsp;the&nbsp;server&nbsp;is&nbsp;at&nbsp;the&nbsp;end.&nbsp;&nbsp;Thanks&nbsp;--&nbsp;Benjamin&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;#!/usr/bin/env&nbsp;python&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;import&nbsp;os,&nbsp;os.path,&nbsp;sys,&nbsp;re,&nbsp;commands,&nbsp;pickle,&nbsp;tempfile,&nbsp;getopt,&nbsp;datetime&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;import&nbsp;socket,&nbsp;string,&nbsp;random,&nbsp;time,&nbsp;traceback,&nbsp;shutil,&nbsp;popen2&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;from&nbsp;zope.interface&nbsp;import&nbsp;implements&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;protocol,&nbsp;defer,&nbsp;interfaces,&nbsp;error,&nbsp;reactor&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;from&nbsp;twisted.internet.protocol&nbsp;import&nbsp;Protocol,&nbsp;Factory&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;from&nbsp;twisted.protocols.basic&nbsp;import&nbsp;LineReceiver&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;class&nbsp;NonStarvingXGiver:&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;implements(interfaces.IPushProducer)&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;howmany,&nbsp;consumer):&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.howmany&nbsp;=&nbsp;howmany&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.sent_already&nbsp;=&nbsp;0&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.paused&nbsp;=&nbsp;False&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.consumer&nbsp;=&nbsp;consumer&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;beginSendingXs(self):&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.deferred&nbsp;=&nbsp;deferred&nbsp;=&nbsp;defer.Deferred()&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.consumer.registerProducer(self,&nbsp;False)&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;deferred&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;pauseProducing(self):&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;'pauseProducing:&nbsp;invoked'&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.paused&nbsp;=&nbsp;True&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;resumeProducing(self):&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;'resumeProducing:&nbsp;invoked'&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.paused&nbsp;=&nbsp;False&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxchunksz&nbsp;=&nbsp;1024&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;not&nbsp;self.paused&nbsp;and&nbsp;self.howmany&nbsp;&gt;&nbsp;self.sent_already:&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chunksz&nbsp;=&nbsp;min(maxchunksz,&nbsp;self.howmany&nbsp;-&nbsp;self.sent_already)&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.consumer.write('x'&nbsp;*&nbsp;chunksz)&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.sent_already&nbsp;+=&nbsp;chunksz&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.howmany&nbsp;==&nbsp;self.sent_already:&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.consumer.write('\n')&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.consumer.unregisterProducer()&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;'resumeProducing:&nbsp;exiting&nbsp;for&nbsp;the&nbsp;last&nbsp;time'&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;stopProducing(self):&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;'stopProducing:&nbsp;invoked'&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.consumer.unregisterProducer()&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;class&nbsp;xgiver(LineReceiver):&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;lineReceived(self,&nbsp;howmany):&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;'got&nbsp;line&nbsp;[%s]&nbsp;from&nbsp;client&nbsp;[%s]'&nbsp;%&nbsp;(howmany,&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.transport.getPeer())&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;howmany&nbsp;==&nbsp;'bye':&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;'goodbye&nbsp;to',&nbsp;self.transport.getPeer()&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.transport.loseConnection()&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;howmany&nbsp;=&nbsp;int(howmany)&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;NonStarvingXGiver(howmany,&nbsp;self.transport)&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.beginSendingXs()&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;Exception,&nbsp;ex:&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.transport.write(&quot;invalid&nbsp;input&nbsp;&quot;&nbsp;+&nbsp;howmany&nbsp;+&nbsp;&quot;\n&quot;)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;#&nbsp;Next&nbsp;lines&nbsp;are&nbsp;magic:&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;factory&nbsp;=&nbsp;Factory()&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;factory.protocol&nbsp;=&nbsp;xgiver&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;#&nbsp;8007&nbsp;is&nbsp;the&nbsp;port&nbsp;you&nbsp;want&nbsp;to&nbsp;run&nbsp;under.&nbsp;Choose&nbsp;something&nbsp;&gt;1024&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;reactor.listenTCP(8007,&nbsp;factory)&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;reactor.run()&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;-------------------------------------------------------------------&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;Server&nbsp;output:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;$&nbsp;./xgiver.py&nbsp;&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;got&nbsp;line&nbsp;[1]&nbsp;from&nbsp;client&nbsp;[IPv4Address(TCP,&nbsp;'127.0.0.1',&nbsp;51007)]&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;invoked&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;exiting&nbsp;for&nbsp;the&nbsp;last&nbsp;time&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;got&nbsp;line&nbsp;[2]&nbsp;from&nbsp;client&nbsp;[IPv4Address(TCP,&nbsp;'127.0.0.1',&nbsp;51007)]&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;invoked&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;exiting&nbsp;for&nbsp;the&nbsp;last&nbsp;time&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;got&nbsp;line&nbsp;[3]&nbsp;from&nbsp;client&nbsp;[IPv4Address(TCP,&nbsp;'127.0.0.1',&nbsp;51007)]&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;invoked&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;exiting&nbsp;for&nbsp;the&nbsp;last&nbsp;time&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;got&nbsp;line&nbsp;[10]&nbsp;from&nbsp;client&nbsp;[IPv4Address(TCP,&nbsp;'127.0.0.1',&nbsp;51007)]&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;invoked&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;exiting&nbsp;for&nbsp;the&nbsp;last&nbsp;time&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;got&nbsp;line&nbsp;[99999]&nbsp;from&nbsp;client&nbsp;[IPv4Address(TCP,&nbsp;'127.0.0.1',&nbsp;51007)]&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;invoked&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;pauseProducing:&nbsp;invoked&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;invoked&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;resumeProducing:&nbsp;exiting&nbsp;for&nbsp;the&nbsp;last&nbsp;time&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;got&nbsp;line&nbsp;[bye]&nbsp;from&nbsp;client&nbsp;[IPv4Address(TCP,&nbsp;'127.0.0.1',&nbsp;51007)]&lt;/FONT&gt;<br>
<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&nbsp;FACE=&quot;Courier&nbsp;New&quot;&gt;goodbye&nbsp;to&nbsp;IPv4Address(TCP,&nbsp;'127.0.0.1',&nbsp;51007)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
