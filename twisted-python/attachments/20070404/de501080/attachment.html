<tt>
&lt;html&gt;&lt;body&gt;&lt;br&nbsp;/&gt;On&nbsp;05:25&nbsp;pm,&nbsp;ellisonbg.net@gmail.com&nbsp;wrote:&lt;br&nbsp;/&gt;&gt;The&nbsp;issue&nbsp;brought&nbsp;up&nbsp;in&nbsp;this&nbsp;thread&nbsp;is&nbsp;one&nbsp;that&nbsp;we&nbsp;(the&nbsp;IPython&nbsp;dev&lt;br&nbsp;/&gt;&gt;team)&nbsp;has&nbsp;thought&nbsp;about&nbsp;a&nbsp;lot.&nbsp;&#160;There&nbsp;are&nbsp;really&nbsp;two&nbsp;questions&nbsp;about&lt;br&nbsp;/&gt;&gt;having&nbsp;true&nbsp;synchronization&nbsp;primitives&nbsp;(something&nbsp;like&nbsp;d.waitFor()&nbsp;or&lt;br&nbsp;/&gt;&gt;blockOn(d)):&lt;br&nbsp;/&gt;&gt;&lt;br&nbsp;/&gt;&gt;1.&nbsp;&#160;Can&nbsp;they&nbsp;be&nbsp;implemented&nbsp;in&nbsp;python/twisted&nbsp;in&nbsp;a&nbsp;reliable&nbsp;and&nbsp;robust&nbsp;way?&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;The&nbsp;real&nbsp;question&nbsp;here&nbsp;doesn't&nbsp;involve&nbsp;the&nbsp;words&nbsp;&quot;in&nbsp;python/twisted&quot;&nbsp;:).&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;2.&nbsp;&#160;Should&nbsp;you&nbsp;use&nbsp;them&nbsp;in&nbsp;your&nbsp;code?&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;Unfortunately,&nbsp;the&nbsp;answer&nbsp;to&nbsp;(1)&nbsp;seems&nbsp;to&nbsp;be&nbsp;no&nbsp;-&nbsp;at&nbsp;least&nbsp;not&nbsp;without&lt;br&nbsp;/&gt;&gt;completely&nbsp;refactoring&nbsp;the&nbsp;core&nbsp;of&nbsp;twisted&nbsp;to&nbsp;support&nbsp;this&nbsp;capability&lt;br&nbsp;/&gt;&gt;from&nbsp;the&nbsp;ground&nbsp;level.&nbsp;&#160;The&nbsp;tempting&nbsp;way&nbsp;of&nbsp;doing&nbsp;it&nbsp;currently&nbsp;is&nbsp;to&lt;br&nbsp;/&gt;&gt;call&nbsp;reactor.iterate()&nbsp;to&nbsp;spin&nbsp;the&nbsp;event&nbsp;loop&nbsp;at&nbsp;a&nbsp;particular&nbsp;point.&lt;br&nbsp;/&gt;&gt;We&nbsp;have&nbsp;code&nbsp;in&nbsp;IPython&nbsp;that&nbsp;does&nbsp;this:&lt;br&nbsp;/&gt;&gt;&lt;br&nbsp;/&gt;&gt;http://projects.scipy.org/ipython/ipython/browser/ipython/branches/saw/ipython1/kernel/blockon.py&lt;br&nbsp;/&gt;&gt;[DON'T&nbsp;USE&nbsp;THIS&nbsp;CODE!]&lt;br&nbsp;/&gt;&gt;&lt;br&nbsp;/&gt;&gt;For&nbsp;very&nbsp;simple&nbsp;things&nbsp;this&nbsp;code&nbsp;works&nbsp;just&nbsp;fine.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;I&nbsp;think&nbsp;you&nbsp;mean,&nbsp;&quot;in&nbsp;some&nbsp;cases&nbsp;this&nbsp;code&nbsp;appears&nbsp;to&nbsp;work&quot;.&nbsp;&#160;Working&nbsp;&quot;just&nbsp;fine&quot;&nbsp;implies&nbsp;that&nbsp;it&nbsp;is&nbsp;robust&nbsp;and&nbsp;supported.&nbsp;&#160;This&nbsp;is&nbsp;an&nbsp;actively&nbsp;deprecated&nbsp;programming&nbsp;style&nbsp;and&nbsp;there&nbsp;are&nbsp;numerous&nbsp;known&nbsp;problems&nbsp;(besides&nbsp;the&nbsp;ones&nbsp;you've&nbsp;already&nbsp;documented&nbsp;here)&nbsp;with&nbsp;doing&nbsp;it.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;d&nbsp;=&nbsp;functionThatReturnsADeferred()&lt;br&nbsp;/&gt;&gt;r&nbsp;=&nbsp;blockOn(d)&nbsp;&#160;&nbsp;&#160;&nbsp;&#160;&nbsp;&#160;&nbsp;&#160;#&nbsp;spin&nbsp;the&nbsp;reactor&nbsp;until&nbsp;d&nbsp;fires.&lt;br&nbsp;/&gt;&gt;&lt;br&nbsp;/&gt;&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;if&nbsp;you&nbsp;start&nbsp;to&nbsp;use&nbsp;blockOn&nbsp;in&nbsp;various&nbsp;places&nbsp;in&lt;br&nbsp;/&gt;&gt;your&nbsp;code,&nbsp;a&nbsp;single&nbsp;call&nbsp;to&nbsp;blockOn&nbsp;(which&nbsp;calls&nbsp;reactor.iterate())&lt;br&nbsp;/&gt;&gt;could&nbsp;trigger&nbsp;other&nbsp;calls&nbsp;to&nbsp;blockOn&nbsp;(which&nbsp;will&nbsp;attempt&nbsp;to&nbsp;call&lt;br&nbsp;/&gt;&gt;reactor.iterate()&nbsp;again).&nbsp;&#160;The&nbsp;twisted&nbsp;reactor&nbsp;is&nbsp;simply&nbsp;not&nbsp;designed&lt;br&nbsp;/&gt;&gt;to&nbsp;be&nbsp;doubly&nbsp;iterated&nbsp;like&nbsp;this&nbsp;-&nbsp;it&nbsp;leads&nbsp;to&nbsp;all&nbsp;sorts&nbsp;of&nbsp;really&lt;br&nbsp;/&gt;&gt;weird&nbsp;problems&nbsp;that&nbsp;are&nbsp;_impossible_&nbsp;to&nbsp;track&nbsp;down.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;These&nbsp;&quot;weird&quot;&nbsp;problems&nbsp;are&nbsp;the&nbsp;entirely&nbsp;predictable&nbsp;result&nbsp;of&nbsp;violating&nbsp;every&nbsp;assumption&nbsp;that&nbsp;code&nbsp;makes&nbsp;about&nbsp;its&nbsp;run-time&nbsp;environment&nbsp;when&nbsp;it&nbsp;is&nbsp;written&nbsp;and&nbsp;tested.&nbsp;&#160;An&nbsp;analogous&nbsp;operation&nbsp;would&nbsp;be&nbsp;to&nbsp;write&nbsp;C&nbsp;code&nbsp;to&nbsp;forcibly&nbsp;delete&nbsp;Python&nbsp;objects&nbsp;rather&nbsp;than&nbsp;go&nbsp;through&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;because&nbsp;you&nbsp;*really&nbsp;know*,&nbsp;*just&nbsp;this&nbsp;one&nbsp;time*,&nbsp;that&nbsp;you&nbsp;want&nbsp;to&nbsp;free&nbsp;that&nbsp;memory.&nbsp;&#160;If&nbsp;you're&nbsp;careful&nbsp;to&nbsp;never&nbsp;touch&nbsp;that&nbsp;object&nbsp;again,&nbsp;you&nbsp;might&nbsp;be&nbsp;able&nbsp;to&nbsp;avoid&nbsp;a&nbsp;segfault,&nbsp;but&nbsp;I&nbsp;think&nbsp;most&nbsp;people&nbsp;would&nbsp;agree&nbsp;that&nbsp;all&nbsp;bets&nbsp;are&nbsp;off&nbsp;at&nbsp;that&nbsp;point.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;This&nbsp;might&nbsp;seem&nbsp;like&nbsp;an&nbsp;exaggerated&nbsp;problem,&nbsp;but&nbsp;I&nbsp;have&nbsp;actually&nbsp;seen&nbsp;code&nbsp;like&nbsp;that&nbsp;more&nbsp;than&nbsp;once&nbsp;written&nbsp;by&nbsp;dyed-in-the-wool&nbsp;C&nbsp;programmers&nbsp;who&nbsp;didn't&nbsp;&quot;get&quot;&nbsp;how&nbsp;Python's&nbsp;object&nbsp;model&nbsp;worked.&nbsp;&#160;It's&nbsp;the&nbsp;same&nbsp;with&nbsp;dyed-in-the-wool&nbsp;non-concurrent&nbsp;programmers&nbsp;approaching&nbsp;concurrent&nbsp;systems&nbsp;for&nbsp;the&nbsp;first&nbsp;time.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;This&nbsp;is&nbsp;why&nbsp;people&nbsp;are&nbsp;saying&nbsp;&quot;it&nbsp;can't&nbsp;be&nbsp;done.&quot;&nbsp;&#160;I&nbsp;should&nbsp;mention&lt;br&nbsp;/&gt;&gt;that&nbsp;it&nbsp;might&nbsp;be&nbsp;possible&nbsp;to&nbsp;implement&nbsp;these&nbsp;things&nbsp;in&nbsp;stackless.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;If&nbsp;you&nbsp;were&nbsp;to&nbsp;implement&nbsp;these&nbsp;things&nbsp;in&nbsp;stackless,&nbsp;you&nbsp;would&nbsp;still&nbsp;have&nbsp;to&nbsp;deal&nbsp;with&nbsp;the&nbsp;inherently&nbsp;problematic&nbsp;issue&nbsp;of&nbsp;apparently&nbsp;&quot;sequential&quot;&nbsp;code&nbsp;being&nbsp;run&nbsp;recursively&nbsp;when&nbsp;it&nbsp;does&nbsp;not&nbsp;expect&nbsp;to&nbsp;be.&nbsp;&#160;In&nbsp;order&nbsp;to&nbsp;prevent&nbsp;this,&nbsp;you&nbsp;would&nbsp;likely&nbsp;have&nbsp;a&nbsp;completely&nbsp;different&nbsp;programming&nbsp;model&nbsp;where&nbsp;something&nbsp;properly&nbsp;event-driven,&nbsp;like&nbsp;Twisted&nbsp;itself,&nbsp;were&nbsp;scheduling&nbsp;&quot;user&nbsp;code&quot;&nbsp;which&nbsp;was&nbsp;written&nbsp;using&nbsp;a&nbsp;different&nbsp;programming&nbsp;style.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;For&nbsp;certain&nbsp;problems&nbsp;such&nbsp;things&nbsp;are&nbsp;a&nbsp;good&nbsp;approach.&nbsp;&#160;For&nbsp;example,&nbsp;in&nbsp;AI&nbsp;code&nbsp;with&nbsp;extremely&nbsp;deeply&nbsp;nested&nbsp;ad-hoc&nbsp;decision&nbsp;trees&nbsp;modeled&nbsp;as&nbsp;if&nbsp;statements&nbsp;and&nbsp;for&nbsp;loops,&nbsp;the&nbsp;cost&nbsp;of&nbsp;stack&nbsp;ripping&nbsp;becomes&nbsp;high&nbsp;both&nbsp;conceptually&nbsp;and&nbsp;performance-wise,&nbsp;and&nbsp;it&nbsp;is&nbsp;more&nbsp;natural&nbsp;to&nbsp;model&nbsp;individual&nbsp;agents&nbsp;as&nbsp;individual&nbsp;control&nbsp;flows&nbsp;(or&nbsp;&quot;cooperative&nbsp;threads&quot;).&nbsp;&#160;This&nbsp;sort&nbsp;of&nbsp;code,&nbsp;though,&nbsp;would&nbsp;be&nbsp;written&nbsp;in&nbsp;a&nbsp;style&nbsp;more&nbsp;like&nbsp;Erlang,&nbsp;with&nbsp;almost&nbsp;no&nbsp;shared&nbsp;state&nbsp;at&nbsp;all.&nbsp;&#160;Part&nbsp;of&nbsp;Twisted's&nbsp;appeal&nbsp;is&nbsp;that&nbsp;it&nbsp;makes&nbsp;mutable&nbsp;state-sharing&nbsp;between&nbsp;disparate&nbsp;systems&nbsp;straightforward.&nbsp;&#160;In&nbsp;other&nbsp;words,&nbsp;it&nbsp;is&nbsp;a&nbsp;different&nbsp;programming&nbsp;model&nbsp;for&nbsp;a&nbsp;different&nbsp;set&nbsp;of&nbsp;problems&nbsp;that&nbsp;would&nbsp;require&nbsp;a&nbsp;different&nbsp;pile&nbsp;of&nbsp;infrastructure.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;It&nbsp;may&nbsp;well&nbsp;be&nbsp;possible&nbsp;to&nbsp;implement&nbsp;such&nbsp;a&nbsp;layer&nbsp;on&nbsp;top&nbsp;of&nbsp;Twisted,&nbsp;but&nbsp;there&nbsp;is&nbsp;a&nbsp;curious&nbsp;thing&nbsp;that&nbsp;takes&nbsp;place&nbsp;when&nbsp;people&nbsp;begin&nbsp;to&nbsp;tackle&nbsp;this&nbsp;problem.&nbsp;&#160;Pretty&nbsp;much&nbsp;everyone&nbsp;eventually&nbsp;comes&nbsp;to&nbsp;the&nbsp;realization&nbsp;that&nbsp;this&nbsp;isn't&nbsp;a&nbsp;good&nbsp;idea&nbsp;for&nbsp;their&nbsp;problem&nbsp;domain,&nbsp;and&nbsp;what&nbsp;they&nbsp;*actually*&nbsp;want&nbsp;is&nbsp;to&nbsp;wish&nbsp;away&nbsp;the&nbsp;difficulties&nbsp;associated&nbsp;with&nbsp;concurrency&nbsp;and&nbsp;pretend&nbsp;that&nbsp;they&nbsp;can&nbsp;&quot;just&nbsp;block&quot;&nbsp;and&nbsp;everything&nbsp;will&nbsp;be&nbsp;OK.&nbsp;&#160;The&nbsp;ones&nbsp;who&nbsp;really,&nbsp;really&nbsp;need&nbsp;it&nbsp;(like&nbsp;people&nbsp;dealing&nbsp;with&nbsp;the&nbsp;aforementioned&nbsp;AI&nbsp;problems)&nbsp;already&nbsp;know&nbsp;their&nbsp;requirements&nbsp;and&nbsp;quietly&nbsp;go&nbsp;ahead&nbsp;and&nbsp;implement&nbsp;what&nbsp;they&nbsp;need,&nbsp;without&nbsp;any&nbsp;hand-wringing&nbsp;about&nbsp;how&nbsp;hard&nbsp;programming&nbsp;with&nbsp;Deferreds&nbsp;is&nbsp;or&nbsp;how&nbsp;they'd&nbsp;really&nbsp;like&nbsp;to&nbsp;block&nbsp;on&nbsp;one.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;So&nbsp;what&nbsp;about&nbsp;(2)?&nbsp;&#160;Ignoring&nbsp;the&nbsp;fact&nbsp;that&nbsp;such&nbsp;constructs&nbsp;can't&nbsp;be&lt;br&nbsp;/&gt;&gt;implemented&nbsp;reliably&nbsp;(let's&nbsp;imagine&nbsp;they&nbsp;could&nbsp;be),&nbsp;should&nbsp;you&nbsp;want&nbsp;to&lt;br&nbsp;/&gt;&gt;use&nbsp;them?&nbsp;&#160;I&nbsp;think&nbsp;the&nbsp;answer&nbsp;is&nbsp;this:&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;The&nbsp;design&nbsp;of&nbsp;Twisted&nbsp;reflects&nbsp;the&nbsp;realities&nbsp;of&nbsp;an&nbsp;asynchronous,&nbsp;event&lt;br&nbsp;/&gt;&gt;driven&nbsp;world&nbsp;where&nbsp;things&nbsp;can&nbsp;and&nbsp;do&nbsp;go&nbsp;wrong&nbsp;when&nbsp;you&nbsp;least&nbsp;expect&lt;br&nbsp;/&gt;&gt;it.&nbsp;&#160;The&nbsp;error&nbsp;handling&nbsp;decision&nbsp;tree&nbsp;of&nbsp;Deferreds&nbsp;are&nbsp;a&nbsp;reflection&nbsp;of&lt;br&nbsp;/&gt;&gt;this&nbsp;reality.&nbsp;&#160;If&nbsp;you&nbsp;try&nbsp;to&nbsp;make&nbsp;this&nbsp;stuff&nbsp;go&nbsp;away&nbsp;(we&nbsp;have&nbsp;tried&nbsp;ma&lt;br&nbsp;/&gt;&gt;ny&nbsp;times&nbsp;-&nbsp;we&nbsp;are&nbsp;slow&nbsp;learners&nbsp;and&nbsp;very&nbsp;stubborn)&nbsp;you&nbsp;will&nbsp;be&lt;br&nbsp;/&gt;&gt;punished&nbsp;and&nbsp;there&nbsp;will&nbsp;be&nbsp;&quot;weeping&nbsp;and&nbsp;gnashing&nbsp;of&nbsp;teeth.&quot;&nbsp;&#160;This&lt;br&nbsp;/&gt;&gt;punishment&nbsp;will&nbsp;take&nbsp;the&nbsp;form&nbsp;of&nbsp;buggy&nbsp;code&nbsp;that&nbsp;is&nbsp;difficult&nbsp;to&lt;br&nbsp;/&gt;&gt;maintain&nbsp;and&nbsp;extend.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;It&nbsp;sounds&nbsp;like&nbsp;we&nbsp;broadly&nbsp;agree&nbsp;here&nbsp;:).&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;With&nbsp;all&nbsp;that&nbsp;said,&nbsp;I&nbsp;have&nbsp;encountered&nbsp;a&nbsp;few&nbsp;highly&nbsp;unusual&nbsp;cases&lt;br&nbsp;/&gt;&gt;where&nbsp;I&nbsp;really&nbsp;did&nbsp;want&nbsp;blockOn&nbsp;to&nbsp;exist.&nbsp;&#160;These&nbsp;cases&nbsp;had&nbsp;the&lt;br&nbsp;/&gt;&gt;characteristic&nbsp;that&nbsp;they&nbsp;couldn't&nbsp;be&nbsp;done&nbsp;any&nbsp;other&nbsp;way&nbsp;in&nbsp;Twisted.&lt;br&nbsp;/&gt;&gt;The&nbsp;answer&nbsp;in&nbsp;this&nbsp;case&nbsp;is&nbsp;to&nbsp;ditch&nbsp;twisted&nbsp;and&nbsp;use&nbsp;a&nbsp;tool&nbsp;that&nbsp;is&lt;br&nbsp;/&gt;&gt;better&nbsp;suited&nbsp;to&nbsp;the&nbsp;problem.&nbsp;&#160;But&nbsp;in&nbsp;my&nbsp;experience&nbsp;these&nbsp;cases&nbsp;only&lt;br&nbsp;/&gt;&gt;pop&nbsp;up&nbsp;about&nbsp;0.00001%&nbsp;of&nbsp;the&nbsp;time.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;I&nbsp;am&nbsp;very&nbsp;curious&nbsp;about&nbsp;your&nbsp;0.00001%&nbsp;case.&nbsp;&#160;Not&nbsp;that&nbsp;I&nbsp;don't&nbsp;believe&nbsp;such&nbsp;cases&nbsp;exist,&nbsp;but&nbsp;in&nbsp;every&nbsp;case&nbsp;but&nbsp;one&nbsp;(twisted&nbsp;ticket&nbsp;#2545)&nbsp;the&nbsp;issue&nbsp;has&nbsp;actually&nbsp;been&nbsp;a&nbsp;documentation&nbsp;problem&nbsp;with&nbsp;Twisted,&nbsp;where&nbsp;it&nbsp;wasn't&nbsp;clear&nbsp;how&nbsp;to&nbsp;do&nbsp;something&nbsp;the&nbsp;&quot;normal&quot;&nbsp;way&nbsp;with&nbsp;Deferreds&nbsp;and&nbsp;such.&nbsp;&#160;I'd&nbsp;like&nbsp;to&nbsp;know&nbsp;if&nbsp;there&nbsp;is&nbsp;another&nbsp;such&nbsp;doc&nbsp;bug&nbsp;we&nbsp;should&nbsp;be&nbsp;filing&nbsp;:).&lt;br&nbsp;/&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
