<tt>
<br>
There&nbsp;is&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;extractRecord&nbsp;function&nbsp;of&nbsp;common.py.&nbsp;And&nbsp;I&nbsp;open&nbsp;a&nbsp;ticket&nbsp;in&nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/trac/ticket/2850&quot;&gt;http://twistedmatrix.com/trac/ticket/2850&lt;/a&gt;&lt;br&gt;----------------------------------------------------------------------------------------------------<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;searchable&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br>
Python&nbsp;Version:2.5&lt;br&gt;Twisted&nbsp;Version:2.5&lt;br&gt;<br>
Names&nbsp;Version:0.4&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;<br>
When&nbsp;we&nbsp;got&nbsp;a&nbsp;resolver&nbsp;and&nbsp;call&nbsp;getHostByname,&nbsp;perhaps&nbsp;DNS&nbsp;server&nbsp;can<br>
return&nbsp;CNAME,&nbsp;Auth&nbsp;NS&nbsp;Server&nbsp;Name&nbsp;and&nbsp;Auth&nbsp;NS&nbsp;Server&nbsp;IP&nbsp;Address.&nbsp;So<br>
extractRecord&nbsp;function&nbsp;will&nbsp;extract&nbsp;the&nbsp;Auth&nbsp;NS&nbsp;Server&nbsp;and&nbsp;send&nbsp;the&nbsp;DNS<br>
request&nbsp;to&nbsp;the&nbsp;Auth&nbsp;NS&nbsp;Server.&nbsp;But&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;extractRecord<br>
function.<br>
&lt;/p&gt;<br>
&lt;p&gt;<br>
Code:<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
#&nbsp;No&nbsp;answers,&nbsp;but&nbsp;maybe&nbsp;there&#39;s&nbsp;a&nbsp;hint&nbsp;at&nbsp;who&nbsp;we&nbsp;should&nbsp;be&nbsp;asking&nbsp;about&nbsp;this<br>
for&nbsp;r&nbsp;in&nbsp;answers:<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
if&nbsp;r.type&nbsp;==&nbsp;dns.NS:<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
from&nbsp;twisted.names&nbsp;import&nbsp;client<br>
r&nbsp;=&nbsp;client.Resolver(servers=[(str(&lt;a&nbsp;href=&quot;http://r.payload.name&quot;&gt;r.payload.name&lt;/a&gt;),&nbsp;dns.PORT)])<br>
return&nbsp;r.lookupAddress(str(name)<br>
&lt;/p&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;p&gt;Generally,&nbsp;the&nbsp;Auth&nbsp;NS&nbsp;Server&nbsp;is&nbsp;the&nbsp;Domain&nbsp;name,&nbsp;and&nbsp;it&#39;s&nbsp;IP<br>
contained&nbsp;in&nbsp;the&nbsp;addition&nbsp;fields.&nbsp;If&nbsp;we&nbsp;get&nbsp;the&nbsp;NS&nbsp;Server&nbsp;by<br>
&lt;a&nbsp;href=&quot;http://r.payload.name&quot;&gt;r.payload.name&lt;/a&gt;,&nbsp;we&nbsp;will&nbsp;get&nbsp;the&nbsp;DNS&nbsp;Server&nbsp;Domain,&nbsp;so&nbsp;the&nbsp;Domain&nbsp;as<br>
server&nbsp;will&nbsp;pass&nbsp;to&nbsp;client.queryUDP&nbsp;as&nbsp;DNS&nbsp;Server&nbsp;Address.&nbsp;UDP.write<br>
will&nbsp;complaint&nbsp;that&nbsp;warnings.warn(&quot;Please&nbsp;only&nbsp;pass&nbsp;IPs&nbsp;to&nbsp;write(),&nbsp;not<br>
hostnames&nbsp;&quot;+addr&lt;a&nbsp;class=&quot;missing&nbsp;changeset&quot;&nbsp;href=&quot;http://twistedmatrix.com/trac/changeset/0&quot;&nbsp;rel=&quot;nofollow&quot;&gt;[0]&lt;/a&gt;,&nbsp;&lt;a&nbsp;class=&quot;missing&nbsp;wiki&quot;&nbsp;href=&quot;http://twistedmatrix.com/trac/wiki/DeprecationWarning&quot;&nbsp;rel=&quot;nofollow&quot;&gt;<br>
DeprecationWarning?&lt;/a&gt;,&nbsp;stacklevel=2).&nbsp;In&nbsp;addition,&nbsp;self.socket.sendto(datagram,&nbsp;addr)&nbsp;will&nbsp;call&nbsp;socket.gethostbyname(addr),&nbsp;but&nbsp;this&nbsp;call&nbsp;is&nbsp;block.<br>
&lt;/p&gt;<br>
&lt;p&gt;<br>
I&nbsp;think&nbsp;we&nbsp;should&nbsp;use&nbsp;the&nbsp;Auth&nbsp;NS&nbsp;Server&nbsp;IP&nbsp;to&nbsp;replace&nbsp;the&nbsp;Domain.<br>
The&nbsp;patch&nbsp;code&nbsp;as&nbsp;fellow:&lt;/p&gt;&lt;p&gt;Any&nbsp;comment&nbsp;is&nbsp;welcome!&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
#&nbsp;No&nbsp;answers,&nbsp;but&nbsp;maybe&nbsp;there&#39;s&nbsp;a&nbsp;hint&nbsp;at&nbsp;who&nbsp;we&nbsp;should&nbsp;be&nbsp;asking&nbsp;about&nbsp;this<br>
for&nbsp;r&nbsp;in&nbsp;answers:<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
if&nbsp;r.type&nbsp;==&nbsp;dns.NS:<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
from&nbsp;twisted.names&nbsp;import&nbsp;client&nbsp;&lt;br&gt;&lt;/p&gt;&lt;p&gt;server&nbsp;=&nbsp;str(&lt;a&nbsp;href=&quot;http://r.payload.name&quot;&gt;r.payload.name&lt;/a&gt;)<br>
&lt;/p&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;p&gt;<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;blockquote&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
for&nbsp;s&nbsp;in&nbsp;answers:<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
if&nbsp;s.type==dns.A&nbsp;and&nbsp;str(&lt;a&nbsp;href=&quot;http://s.name&quot;&gt;s.name&lt;/a&gt;)==server&nbsp;:<br>
&lt;/p&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
server&nbsp;=&nbsp;&nbsp;socket.inet_ntop(socket.AF_INET,&nbsp;s.payload.address)<br>
break<br>
&lt;/p&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&gt;<br>
&lt;blockquote&gt;<br>
&lt;blockquote&gt;<br>
&lt;p&gt;<br>
r&nbsp;=&nbsp;client.Resolver(servers=[(server,&nbsp;dns.PORT)])&lt;/p&gt;&lt;br&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;br&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;br&gt;<br>

</tt>
