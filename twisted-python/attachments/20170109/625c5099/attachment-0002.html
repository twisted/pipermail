<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;9,&nbsp;2017&nbsp;at&nbsp;4:52&nbsp;AM,&nbsp;Glyph&nbsp;Lefkowitz&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;On&nbsp;Jan&nbsp;8,&nbsp;2017,&nbsp;at&nbsp;4:34&nbsp;PM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&nbsp;class=&quot;gmail-m_4897655694086818359Apple-interchange-newline&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-family:menlo-regular;font-size:12px;font-style:normal;font-variant-caps:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px&quot;&gt;Here&#39;s&nbsp;one&nbsp;example&nbsp;I&nbsp;know&nbsp;of&nbsp;off&nbsp;the&nbsp;top&nbsp;of&nbsp;my&nbsp;head,&nbsp;&lt;&lt;a&nbsp;href=&quot;https://github.com/ScatterHQ/flocker/blob/master/flocker/restapi/testtools.py#L316&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/ScatterHQ/&lt;wbr&gt;flocker/blob/master/flocker/&lt;wbr&gt;restapi/testtools.py#L316&lt;/a&gt;&gt;. &nbsp;This&nbsp;one&nbsp;isn&#39;t&nbsp;a&nbsp;from-scratch&nbsp;re-implementation&nbsp;of&nbsp;the&nbsp;implicit&nbsp;Request&nbsp;interface&nbsp;but&nbsp;a&nbsp;Request&nbsp;subclass,&nbsp;instead. &nbsp;However,&nbsp;it&nbsp;still&nbsp;interacts&nbsp;with&nbsp;a&nbsp;lot&nbsp;of&nbsp;important&nbsp;pieces&nbsp;of&nbsp;Request&nbsp;which&nbsp;aren&#39;t&nbsp;part&nbsp;of&nbsp;IRequest.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Mark&nbsp;already&nbsp;addressed&nbsp;how&nbsp;he&nbsp;won&#39;t&nbsp;be&nbsp;breaking&nbsp;this&nbsp;use-case&nbsp;(which&nbsp;is&nbsp;hugely&nbsp;important,&nbsp;and&nbsp;core&nbsp;to&nbsp;the&nbsp;whole&nbsp;idea&nbsp;of&nbsp;a&nbsp;compatibility&nbsp;policy,&nbsp;so&nbsp;that&nbsp;is&nbsp;as&nbsp;it&nbsp;should&nbsp;be).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;this&nbsp;kind&nbsp;of&nbsp;test-mocking&nbsp;is,&nbsp;I&nbsp;think,&nbsp;ultimately&nbsp;done&nbsp;at&nbsp;the&nbsp;wrong&nbsp;layer. &nbsp;It&#39;s&nbsp;trying&nbsp;to&nbsp;override&nbsp;some&nbsp;very&nbsp;vaguely-specified&nbsp;internals&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;an&nbsp;implementation.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Absolutely.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;Really,&nbsp;twisted.web&nbsp;should&nbsp;provide&nbsp;its&nbsp;own&nbsp;testing&nbsp;tools,&nbsp;of&nbsp;course. &nbsp;But&nbsp;if&nbsp;you&#39;re&nbsp;going&nbsp;to&nbsp;implement&nbsp;something&nbsp;that&nbsp;does&nbsp;this&nbsp;sort&nbsp;of&nbsp;overriding,&nbsp;I&nbsp;think&nbsp;the&nbsp;idiom&nbsp;to&nbsp;follow&nbsp;would&nbsp;be&nbsp;treq.testing: &lt;a&nbsp;href=&quot;https://github.com/twisted/treq/blob/fcf5deb976c955ca6ef6484f414d25839932940e/src/treq/testing.py&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.&lt;wbr&gt;com/twisted/treq/blob/&lt;wbr&gt;fcf5deb976c955ca6ef6484f414d25&lt;wbr&gt;839932940e/src/treq/testing.py&lt;/a&gt;&lt;wbr&gt;,&nbsp;rather&nbsp;than&nbsp;any&nbsp;of&nbsp;the&nbsp;various&nbsp;implementations&nbsp;of&nbsp;DummyRequest&nbsp;(including&nbsp;more&nbsp;than&nbsp;a&nbsp;few&nbsp;I&#39;m&nbsp;sure&nbsp;I&#39;ve&nbsp;written).&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Though,&nbsp;note,&nbsp;the&nbsp;link&nbsp;I&nbsp;gave&nbsp;above&nbsp;was&nbsp;support&nbsp;code&nbsp;for&nbsp;something&nbsp;very&nbsp;similar&nbsp;to&nbsp;this&nbsp;treq&nbsp;code: &lt;a&nbsp;href=&quot;https://github.com/ScatterHQ/flocker/blob/master/flocker/restapi/testtools.py#L460&quot;&gt;https://github.com/ScatterHQ/flocker/blob/master/flocker/restapi/testtools.py#L460&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;clarify&nbsp;your&nbsp;point&nbsp;a&nbsp;bit&nbsp;(I&nbsp;think):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;MemoryAgent&nbsp;(from&nbsp;Flocker)&nbsp;provides&nbsp;a&nbsp;testing&nbsp;IAgent&nbsp;by&nbsp;implementing&nbsp;an&nbsp;IRequest&nbsp;that&nbsp;does&nbsp;in-memory&nbsp;resource&nbsp;traversal&nbsp;to&nbsp;dispatch&nbsp;requests&nbsp;and&nbsp;generate&nbsp;responses.&lt;br&gt;&lt;/li&gt;&lt;li&gt;RequestTraversalAgent&nbsp;(from&nbsp;treq)&nbsp;provides&nbsp;a&nbsp;testing&nbsp;IAgent&nbsp;by&nbsp;implementing&nbsp;(using)&nbsp;iosim&nbsp;to&nbsp;do&nbsp;in-memory&nbsp;protocol/transport&nbsp;interacts&nbsp;to&nbsp;drive&nbsp;an&nbsp;in-memory&nbsp;HTTP&nbsp;conversation&nbsp;that&nbsp;runs&nbsp;all&nbsp;of&nbsp;the&nbsp;regular&nbsp;Twisted&nbsp;Web&nbsp;HTTP&nbsp;processing&nbsp;machinery.&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;RequestTraversalAgent&#39;s&nbsp;approach&nbsp;is&nbsp;better&nbsp;because&nbsp;the&nbsp;protocol/transport&nbsp;interface&nbsp;is&nbsp;better&nbsp;defined. &nbsp;Because&nbsp;it&#39;s&nbsp;better&nbsp;defined, RequestTraversalAgent&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;touch&nbsp;pieces&nbsp;that&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;consider&nbsp;implementation&nbsp;details&nbsp;(whether&nbsp;they&#39;re&nbsp;_-prefixed&nbsp;or&nbsp;not). &nbsp;It&nbsp;also&nbsp;invokes&nbsp;a&nbsp;larger&nbsp;portion&nbsp;of&nbsp;the&nbsp;real&nbsp;implementation&nbsp;code&nbsp;making&nbsp;it&nbsp;more&nbsp;likely&nbsp;to&nbsp;be&nbsp;a&nbsp;realistic&nbsp;simulation&nbsp;of&nbsp;real-world&nbsp;use&nbsp;of&nbsp;the&nbsp;code.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Having&nbsp;spelled&nbsp;this&nbsp;out,&nbsp;what&nbsp;occurs&nbsp;to&nbsp;me&nbsp;now&nbsp;is&nbsp;that RequestTraversalAgent&nbsp;is&nbsp;really&nbsp;just&nbsp;a&nbsp;step&nbsp;or&nbsp;so&nbsp;up&nbsp;the&nbsp;ladder&nbsp;and&nbsp;there&#39;s&nbsp;further&nbsp;to&nbsp;go. &nbsp;For&nbsp;example,&nbsp;RequestTraversalAgent&nbsp;only&nbsp;needs&nbsp;to&nbsp;exist&nbsp;at&nbsp;all&nbsp;because&nbsp;`iosim`&nbsp;has&nbsp;a&nbsp;distinct&nbsp;interface. &nbsp;This&nbsp;distinct&nbsp;interface&nbsp;means&nbsp;you&nbsp;need&nbsp;a&nbsp;RequestTraversalAgent-like&nbsp;thing&nbsp;for&nbsp;each&nbsp;reactor-using&nbsp;thing&nbsp;for&nbsp;which&nbsp;you&nbsp;want&nbsp;to&nbsp;provide&nbsp;a&nbsp;test&nbsp;double. &nbsp;If&nbsp;this&nbsp;adaption&nbsp;behavior&nbsp;were&nbsp;bundled&nbsp;up&nbsp;differently&nbsp;then&nbsp;I&nbsp;think&nbsp;we&#39;d&nbsp;get&nbsp;a&nbsp;lot&nbsp;more&nbsp;in-memory&nbsp;test&nbsp;doubles&nbsp;for&nbsp;free&nbsp;(or&nbsp;closer&nbsp;to&nbsp;it&nbsp;-&nbsp;we&#39;d&nbsp;be&nbsp;another&nbsp;rung&nbsp;up&nbsp;the&nbsp;ladder,&nbsp;at&nbsp;least). &nbsp;That&nbsp;seems&nbsp;like&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;big&nbsp;win&nbsp;given&nbsp;how&nbsp;&lt;i&gt;few&lt;/i&gt; of&nbsp;these&nbsp;testing&nbsp;helpers&nbsp;Twisted&nbsp;has&nbsp;historically&nbsp;managed&nbsp;to&nbsp;provide&nbsp;(suggesting&nbsp;it&#39;s&nbsp;just&nbsp;too&nbsp;hard&nbsp;to&nbsp;do&nbsp;so&nbsp;given&nbsp;the&nbsp;current&nbsp;tools).&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;ideas&nbsp;that&nbsp;I&#39;ve&nbsp;been&nbsp;gradually&nbsp;arriving&nbsp;at&nbsp;over&nbsp;a&nbsp;long&nbsp;period&nbsp;of&nbsp;time,&nbsp;but&nbsp;it&#39;s&nbsp;probably&nbsp;high&nbsp;time&nbsp;for&nbsp;some&nbsp;public&nbsp;discussion&nbsp;by&nbsp;now,&nbsp;even&nbsp;if&nbsp;it&#39;s&nbsp;just&nbsp;everybody&nbsp;saying&nbsp;&quot;yeah,&nbsp;that&nbsp;sounds&nbsp;good&quot;&nbsp;:-).&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;it&nbsp;pretty&nbsp;much&nbsp;sounds&nbsp;good,&nbsp;though&nbsp;with&nbsp;the&nbsp;above&nbsp;refinements.&nbsp;:)&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;a&nbsp;related&nbsp;note,&nbsp;&#39;proto_helpers&#39;&nbsp;is&nbsp;in&nbsp;a&nbsp;super&nbsp;awkward&nbsp;place.&nbsp; &#39;twisted.testing&#39;,&nbsp;anyone?&nbsp;:)&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes. &nbsp;I&nbsp;almost&nbsp;suggested&nbsp;this&nbsp;about&nbsp;a&nbsp;week&nbsp;ago&nbsp;when&nbsp;I&nbsp;was&nbsp;preparing&nbsp;to&nbsp;contribute&nbsp;some&nbsp;testing&nbsp;code&nbsp;but&nbsp;then&nbsp;realized&nbsp;I&nbsp;couldn&#39;t&nbsp;contribute&nbsp;the&nbsp;code&nbsp;after&nbsp;all.&nbsp;:(&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jean-Paul&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
