<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;Jan&nbsp;8,&nbsp;2017,&nbsp;at&nbsp;4:34&nbsp;PM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&nbsp;class=&quot;&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant-caps:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&nbsp;class=&quot;&quot;&gt;Here's&nbsp;one&nbsp;example&nbsp;I&nbsp;know&nbsp;of&nbsp;off&nbsp;the&nbsp;top&nbsp;of&nbsp;my&nbsp;head,&nbsp;&lt;&lt;a&nbsp;href=&quot;https://github.com/ScatterHQ/flocker/blob/master/flocker/restapi/testtools.py#L316&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/ScatterHQ/flocker/blob/master/flocker/restapi/testtools.py#L316&lt;/a&gt;&gt;.&nbsp;&nbsp;This&nbsp;one&nbsp;isn't&nbsp;a&nbsp;from-scratch&nbsp;re-implementation&nbsp;of&nbsp;the&nbsp;implicit&nbsp;Request&nbsp;interface&nbsp;but&nbsp;a&nbsp;Request&nbsp;subclass,&nbsp;instead.&nbsp;&nbsp;However,&nbsp;it&nbsp;still&nbsp;interacts&nbsp;with&nbsp;a&nbsp;lot&nbsp;of&nbsp;important&nbsp;pieces&nbsp;of&nbsp;Request&nbsp;which&nbsp;aren't&nbsp;part&nbsp;of&nbsp;IRequest.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Mark&nbsp;already&nbsp;addressed&nbsp;how&nbsp;he&nbsp;won't&nbsp;be&nbsp;breaking&nbsp;this&nbsp;use-case&nbsp;(which&nbsp;is&nbsp;hugely&nbsp;important,&nbsp;and&nbsp;core&nbsp;to&nbsp;the&nbsp;whole&nbsp;idea&nbsp;of&nbsp;a&nbsp;compatibility&nbsp;policy,&nbsp;so&nbsp;that&nbsp;is&nbsp;as&nbsp;it&nbsp;should&nbsp;be).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;this&nbsp;kind&nbsp;of&nbsp;test-mocking&nbsp;is,&nbsp;I&nbsp;think,&nbsp;ultimately&nbsp;done&nbsp;at&nbsp;the&nbsp;wrong&nbsp;layer.&nbsp;&nbsp;It's&nbsp;trying&nbsp;to&nbsp;override&nbsp;some&nbsp;very&nbsp;vaguely-specified&nbsp;internals&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;an&nbsp;implementation.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Really,&nbsp;twisted.web&nbsp;should&nbsp;provide&nbsp;its&nbsp;own&nbsp;testing&nbsp;tools,&nbsp;of&nbsp;course.&nbsp;&nbsp;But&nbsp;if&nbsp;you're&nbsp;going&nbsp;to&nbsp;implement&nbsp;something&nbsp;that&nbsp;does&nbsp;this&nbsp;sort&nbsp;of&nbsp;overriding,&nbsp;I&nbsp;think&nbsp;the&nbsp;idiom&nbsp;to&nbsp;follow&nbsp;would&nbsp;be&nbsp;treq.testing:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/twisted/treq/blob/fcf5deb976c955ca6ef6484f414d25839932940e/src/treq/testing.py&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/twisted/treq/blob/fcf5deb976c955ca6ef6484f414d25839932940e/src/treq/testing.py&lt;/a&gt;,&nbsp;rather&nbsp;than&nbsp;any&nbsp;of&nbsp;the&nbsp;various&nbsp;implementations&nbsp;of&nbsp;DummyRequest&nbsp;(including&nbsp;more&nbsp;than&nbsp;a&nbsp;few&nbsp;I'm&nbsp;sure&nbsp;I've&nbsp;written).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Internally,&nbsp;treq.testing&nbsp;uses&nbsp;MemoryReactor&nbsp;and&nbsp;the&nbsp;(not-technically-public-but-it-really-should-be)&nbsp;iosim&nbsp;module.&nbsp;&nbsp;Therefore&nbsp;the&nbsp;layer&nbsp;it's&nbsp;plugging&nbsp;in&nbsp;at&nbsp;is&nbsp;at&nbsp;the&nbsp;very&nbsp;well-defined&nbsp;interface&nbsp;between&nbsp;IAgent&nbsp;and&nbsp;IStreamClientEndpoint,&nbsp;and&nbsp;between&nbsp;HTTPChannel&nbsp;and&nbsp;Transport.&nbsp;&nbsp;This&nbsp;gives&nbsp;the&nbsp;determinism&nbsp;and&nbsp;(most&nbsp;of&nbsp;the)&nbsp;speed&nbsp;of&nbsp;an&nbsp;in-memory&nbsp;implementation,&nbsp;but&nbsp;a&nbsp;great&nbsp;deal&nbsp;of&nbsp;the&nbsp;realism&nbsp;of&nbsp;a&nbsp;full-blown&nbsp;integration&nbsp;test.&nbsp;&nbsp;In&nbsp;particular,&nbsp;it&nbsp;binds&nbsp;to&nbsp;the&nbsp;appropriate&nbsp;objects&nbsp;within&nbsp;Twisted&nbsp;and&nbsp;will&nbsp;throw&nbsp;deprecation&nbsp;warnings&nbsp;if&nbsp;their&nbsp;interfaces&nbsp;change.&nbsp;&nbsp;(Also&nbsp;of&nbsp;note;&nbsp;since&nbsp;what&nbsp;it's&nbsp;building&nbsp;a&nbsp;fake&nbsp;for&nbsp;is&nbsp;really&nbsp;99%&nbsp;Agent,&nbsp;the&nbsp;bulk&nbsp;of&nbsp;this&nbsp;could&nbsp;probably&nbsp;move&nbsp;up&nbsp;another&nbsp;level&nbsp;into&nbsp;Twisted&nbsp;with&nbsp;very&nbsp;little&nbsp;effort.)&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;following&nbsp;this&nbsp;idiom&nbsp;of&nbsp;pushing&nbsp;I/O&nbsp;through&nbsp;a&nbsp;fake&nbsp;reactor&nbsp;and&nbsp;having&nbsp;a&nbsp;back-end&nbsp;that&nbsp;can&nbsp;be&nbsp;controlled&nbsp;via&nbsp;test-specific&nbsp;APIs&nbsp;is&nbsp;probably&nbsp;what&nbsp;we&nbsp;should&nbsp;all&nbsp;be&nbsp;striving&nbsp;for,&nbsp;and&nbsp;in&nbsp;Twisted&nbsp;we&nbsp;should&nbsp;be&nbsp;working&nbsp;to&nbsp;make&nbsp;the&nbsp;memory-reactor&nbsp;stuff&nbsp;more&nbsp;complete&nbsp;and&nbsp;convenient,&nbsp;rather&nbsp;than&nbsp;adding&nbsp;dummy&nbsp;implementations&nbsp;at&nbsp;each&nbsp;layer&nbsp;of&nbsp;the&nbsp;stack.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;ideas&nbsp;that&nbsp;I've&nbsp;been&nbsp;gradually&nbsp;arriving&nbsp;at&nbsp;over&nbsp;a&nbsp;long&nbsp;period&nbsp;of&nbsp;time,&nbsp;but&nbsp;it's&nbsp;probably&nbsp;high&nbsp;time&nbsp;for&nbsp;some&nbsp;public&nbsp;discussion&nbsp;by&nbsp;now,&nbsp;even&nbsp;if&nbsp;it's&nbsp;just&nbsp;everybody&nbsp;saying&nbsp;&quot;yeah,&nbsp;that&nbsp;sounds&nbsp;good&quot;&nbsp;:-).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;a&nbsp;related&nbsp;note,&nbsp;'proto_helpers'&nbsp;is&nbsp;in&nbsp;a&nbsp;super&nbsp;awkward&nbsp;place.&nbsp;&nbsp;'twisted.testing',&nbsp;anyone?&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
