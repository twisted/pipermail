# Web-server root

from twisted.web.woven import page, model, widgets as W
from twisted.python.rebuild import rebuild
import data
rebuild(data)

m=model.AttributeModel()
m.setSubmodel('title', "DB-Test")
m.setSubmodel('topic', 'DB-Test')


## db stuff:
from twisted.enterprise import adbapi

dbpool=adbapi.ConnectionPool("MySQLdb",host='localhost',db='tgroupware',user='woven',passwd='woven')

class MyDb(adbapi.Augmentation):
    def getTables(self, arg):
        sql="""show tables""" # % ('')
        return self.runQuery(sql)
    def getBookmarks(self, arg):
        sql="""SELECT Name,Url FROM Bookmark"""
        return self.runQuery(sql)
    
def gotEntr(resultlist,arg):
    print resultlist
    return resultlist
    
db = MyDb(dbpool)
dblist = db.getBookmarks('').addCallbacks(gotEntr, db.operationError, callbackArgs=('1'))

#dblist=["mydata1","mydata2",]
m.setSubmodel('myDBList', dblist) 

resource = page.Page(m, templateDirectory=data.tpldir, templateFile = "dbtest.xhtml")