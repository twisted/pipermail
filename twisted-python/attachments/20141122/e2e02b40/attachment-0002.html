<tt>
&lt;!DOCTYPE&nbsp;html&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;&lt;div&gt;On&nbsp;Fri,&nbsp;21&nbsp;Nov&nbsp;2014,&nbsp;at&nbsp;19:26,&nbsp;Glyph&nbsp;wrote:&lt;br&gt;&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Nov&nbsp;21,&nbsp;2014,&nbsp;at&nbsp;15:13,&nbsp;Peter&nbsp;Westlake&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:peter.westlake@pobox.com&quot;&nbsp;class=&quot;&quot;&gt;peter.westlake@pobox.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Menlo-Regular;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&nbsp;class=&quot;&quot;&gt;I&lt;span&gt;&lt;/span&gt;&lt;i&nbsp;class=&quot;&quot;&gt;am&lt;/i&gt;&lt;span&gt;&lt;/span&gt;missing&nbsp;something&nbsp;obvious.&nbsp;The&nbsp;file&nbsp;opened&nbsp;by&nbsp;open()&nbsp;immediately&nbsp;goes&nbsp;out&nbsp;of&nbsp;scope.&nbsp;&nbsp;AAAUGH!&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;So...&nbsp;back&nbsp;to&nbsp;square&nbsp;one?&nbsp;&nbsp;Or&nbsp;is&nbsp;this&nbsp;the&nbsp;solution&nbsp;to&nbsp;your&nbsp;problem?&nbsp;&nbsp;I&nbsp;don't&nbsp;entirely&nbsp;follow&nbsp;how&nbsp;this&nbsp;connects..&lt;br&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;didn't&nbsp;explain,&nbsp;sorry.&nbsp;This&nbsp;does&nbsp;indeed&nbsp;solve&nbsp;my&nbsp;problem!&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;It's&nbsp;a&nbsp;mistake&nbsp;in&nbsp;very&nbsp;nearly&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;first&nbsp;real&nbsp;Python&nbsp;program&nbsp;I&nbsp;wrote.&nbsp;It&nbsp;goes&nbsp;likes&nbsp;this:&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;menlo,&nbsp;consolas,&nbsp;&quot;courier&nbsp;new&quot;,&nbsp;monospace,&nbsp;sans-serif;&quot;&nbsp;class=&quot;font&quot;&gt;devnull&nbsp;=&nbsp;open('/dev/null').fileno()&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;1.&nbsp;Create&nbsp;a&nbsp;Python&nbsp;file&nbsp;object&nbsp;on&nbsp;/dev/null.&nbsp;Its&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;the&nbsp;first&nbsp;one&nbsp;available,&nbsp;3.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;2.&nbsp;Use&nbsp;it&nbsp;in&nbsp;an&nbsp;expression,&nbsp;and&nbsp;store&nbsp;the&nbsp;FD&nbsp;(3)&nbsp;in&nbsp;the&nbsp;variable&nbsp;devnull.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;3.&nbsp;Lose&nbsp;the&nbsp;last&nbsp;reference&nbsp;to&nbsp;it.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;4.&nbsp;&lt;b&gt;The&nbsp;file&nbsp;object&nbsp;is&nbsp;garbage&nbsp;collected&nbsp;and&nbsp;the&nbsp;file&nbsp;is&nbsp;closed.&lt;/b&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;5.&nbsp;The&nbsp;variable&nbsp;devnull&nbsp;remembers&nbsp;the&nbsp;file&nbsp;descriptor&nbsp;number&nbsp;of&nbsp;this&nbsp;short-lived&nbsp;file.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:menlo,consolas,&quot;courier&nbsp;new&quot;,monospace,sans-serif&quot;&nbsp;class=&quot;font&quot;&gt;reactor.connectTCP('localhost',&nbsp;'http',&nbsp;factory)&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:menlo,consolas,&quot;courier&nbsp;new&quot;,monospace,sans-serif&quot;&nbsp;class=&quot;font&quot;&gt;#&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif,&nbsp;sans-serif;&quot;&nbsp;class=&quot;font&quot;&gt;6.&nbsp;Open&nbsp;a&nbsp;socket.&nbsp;Its&nbsp;file&nbsp;number&nbsp;is&nbsp;the&nbsp;first&nbsp;one&nbsp;available,&lt;/span&gt;&nbsp;which&nbsp;is&nbsp;3&nbsp;again.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:menlo,consolas,&quot;courier&nbsp;new&quot;,monospace,sans-serif&quot;&nbsp;class=&quot;font&quot;&gt;reactor.callWhenRunning(reactor.spawnProcess,&nbsp;ProcessProtocol(),&nbsp;'/bin/sleep',&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:menlo,consolas,&quot;courier&nbsp;new&quot;,monospace,sans-serif&quot;&nbsp;class=&quot;font&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args=['/bin/sleep',&nbsp;'1000'],&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:menlo,consolas,&quot;courier&nbsp;new&quot;,monospace,sans-serif&quot;&nbsp;class=&quot;font&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;childFDs={0:&nbsp;devnull,&nbsp;1:&nbsp;'r',&nbsp;2:'r'})&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif,&nbsp;sans-serif;&quot;&nbsp;class=&quot;font&quot;&gt;#&nbsp;7.&nbsp;Pass&nbsp;the&nbsp;file&nbsp;on&nbsp;descriptor&nbsp;3&nbsp;to&nbsp;the&nbsp;spawned&nbsp;process.&nbsp;But&nbsp;it's&nbsp;the&nbsp;socket,&nbsp;not&nbsp;/dev/null!&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif,&nbsp;sans-serif;&quot;&nbsp;class=&quot;font&quot;&gt;In&nbsp;the&nbsp;real&nbsp;program&nbsp;the&nbsp;socket&nbsp;is&nbsp;an&nbsp;AMP&nbsp;connection,&nbsp;and&nbsp;the&nbsp;spawnProcess&nbsp;is&nbsp;a&nbsp;vast&nbsp;tree&nbsp;of&nbsp;processes&nbsp;that&nbsp;build&nbsp;a&nbsp;large&nbsp;and&nbsp;complex&nbsp;piece&nbsp;of&nbsp;software.&nbsp;Eventually&nbsp;the&nbsp;build&nbsp;process&nbsp;reaches&nbsp;an&nbsp;SSH&nbsp;call,&nbsp;and&nbsp;for&nbsp;some&nbsp;reason&nbsp;SSH&nbsp;sometimes&nbsp;reads&nbsp;from&nbsp;its&nbsp;stdin.&nbsp;I&nbsp;don't&nbsp;know&nbsp;why,&nbsp;and&nbsp;I&nbsp;don't&nbsp;know&nbsp;why&nbsp;it&nbsp;always&nbsp;tried&nbsp;to&nbsp;read&nbsp;at&nbsp;precisely&nbsp;the&nbsp;same&nbsp;&lt;/span&gt;time&nbsp;at&nbsp;Twisted.&nbsp;But&nbsp;I&nbsp;do&nbsp;know&nbsp;that&nbsp;it&nbsp;does,&nbsp;thanks&nbsp;to&nbsp;a&nbsp;systemtap&nbsp;probe.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;To&nbsp;fix&nbsp;the&nbsp;bug&nbsp;(and&nbsp;it&nbsp;&lt;i&gt;is&lt;/i&gt;&nbsp;fixed,&nbsp;and&nbsp;passes&nbsp;testing)&nbsp;I&nbsp;had&nbsp;the&nbsp;option&nbsp;of&nbsp;either&nbsp;saving&nbsp;the&nbsp;file&nbsp;object:&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;menlo,&nbsp;consolas,&nbsp;&quot;courier&nbsp;new&quot;,&nbsp;monospace,&nbsp;sans-serif;&quot;&nbsp;class=&quot;font&quot;&gt;devnull&nbsp;=&nbsp;open('/dev/null')&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;menlo,&nbsp;consolas,&nbsp;&quot;courier&nbsp;new&quot;,&nbsp;monospace,&nbsp;sans-serif;&quot;&nbsp;class=&quot;font&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;menlo,&nbsp;consolas,&nbsp;&quot;courier&nbsp;new&quot;,&nbsp;monospace,&nbsp;sans-serif;&quot;&nbsp;class=&quot;font&quot;&gt;spawnProcess(...childFDS{0:&nbsp;devnull.fileno(),&nbsp;1:&nbsp;'r',&nbsp;2:&nbsp;'r'}...)&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;or&nbsp;closing&nbsp;stdin:&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;menlo,&nbsp;consolas,&nbsp;&quot;courier&nbsp;new&quot;,&nbsp;monospace,&nbsp;sans-serif;&quot;&nbsp;class=&quot;font&quot;&gt;spawnProcess(...childFDS{1:&nbsp;'r',&nbsp;2:&nbsp;'r'}...)&lt;/span&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;The&nbsp;fact&nbsp;that&nbsp;the&nbsp;AMP&nbsp;connection&nbsp;ever&nbsp;worked&nbsp;at&nbsp;all&nbsp;showed&nbsp;that&nbsp;the&nbsp;build&nbsp;process&nbsp;didn't&nbsp;try&nbsp;to&nbsp;read&nbsp;stdin,&nbsp;so&nbsp;I&nbsp;chose&nbsp;the&nbsp;latter&nbsp;option.&nbsp;The&nbsp;SSH&nbsp;still&nbsp;works,&nbsp;so&nbsp;I&nbsp;suppose&nbsp;it&nbsp;is&nbsp;using&nbsp;a&nbsp;select()&nbsp;or&nbsp;similar&nbsp;to&nbsp;read&nbsp;stdin.&nbsp;That&nbsp;would&nbsp;account&nbsp;for&nbsp;it&nbsp;being&nbsp;synchronised&nbsp;with&nbsp;Twisted:&nbsp;when&nbsp;they&nbsp;are&nbsp;both&nbsp;waiting&nbsp;for&nbsp;data,&nbsp;both&nbsp;of&nbsp;them&nbsp;see&nbsp;it&nbsp;at&nbsp;once&nbsp;and&nbsp;collide.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;suspect&nbsp;that&nbsp;the&nbsp;reason&nbsp;this&nbsp;went&nbsp;away&nbsp;in&nbsp;2009&nbsp;was&nbsp;because&nbsp;a&nbsp;load&nbsp;of&nbsp;SSH&nbsp;calls&nbsp;were&nbsp;removed&nbsp;(they&nbsp;were&nbsp;to&nbsp;Windows&nbsp;machines,&nbsp;and&nbsp;very&nbsp;unreliable!),&nbsp;and&nbsp;the&nbsp;reason&nbsp;it&nbsp;came&nbsp;back&nbsp;now&nbsp;was&nbsp;because&nbsp;a&nbsp;load&nbsp;more&nbsp;were&nbsp;put&nbsp;in.&nbsp;The&nbsp;system&nbsp;was&nbsp;moved&nbsp;behind&nbsp;a&nbsp;firewall,&nbsp;and&nbsp;had&nbsp;to&nbsp;do&nbsp;a&nbsp;lot&nbsp;of&nbsp;its&nbsp;former&nbsp;work&nbsp;by&nbsp;remote&nbsp;control&nbsp;using&nbsp;SSH.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;Again,&nbsp;thank&nbsp;you&nbsp;for&nbsp;all&nbsp;the&nbsp;help.&nbsp;I&nbsp;do&nbsp;like&nbsp;Twisted!&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;Peter.&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
