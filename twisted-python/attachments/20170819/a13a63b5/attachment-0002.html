<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Verdana;font-size:&nbsp;12.0px;&quot;&gt;&lt;div&gt;<br>
&lt;div&gt;Ok,&nbsp;let&nbsp;me&nbsp;try&nbsp;to&nbsp;provide&nbsp;some&nbsp;detailled&nbsp;information,&nbsp;hope&nbsp;it&nbsp;helps:&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&gt;&nbsp;openssl&nbsp;version&nbsp;-a:&lt;/div&gt;<br>
<br>
&lt;div&gt;OpenSSL&nbsp;1.1.0f&nbsp;&nbsp;25&nbsp;May&nbsp;2017&lt;br/&gt;<br>
built&nbsp;on:&nbsp;reproducible&nbsp;build,&nbsp;date&nbsp;unspecified&lt;br/&gt;<br>
platform:&nbsp;linux-x86_64&lt;br/&gt;<br>
compiler:&nbsp;gcc&nbsp;-DDSO_DLFCN&nbsp;-DHAVE_DLFCN_H&nbsp;-DNDEBUG&nbsp;-DOPENSSL_THREADS&nbsp;-DOPENSSL_NO_STATIC_ENGINE&nbsp;-DOPENSSL_PIC&nbsp;-DOPENSSL_IA32_SSE2&nbsp;-DOPENSSL_BN_ASM_MONT&nbsp;-DOPENSSL_BN_ASM_MONT5&nbsp;-DOPENSSL_BN_ASM_GF2m&nbsp;-DSHA1_ASM&nbsp;-DSHA256_ASM&nbsp;-DSHA512_ASM&nbsp;-DRC4_ASM&nbsp;-DMD5_ASM&nbsp;-DAES_ASM&nbsp;-DVPAES_ASM&nbsp;-DBSAES_ASM&nbsp;-DGHASH_ASM&nbsp;-DECP_NISTZ256_ASM&nbsp;-DPADLOCK_ASM&nbsp;-DPOLY1305_ASM&nbsp;-DOPENSSLDIR=&quot;&#92;&quot;/usr/local/ssl&#92;&quot;&quot;&nbsp;-DENGINESDIR=&quot;&#92;&quot;/usr/local/lib/engines-1.1&#92;&quot;&quot;&nbsp;&nbsp;-Wa,--noexecstack&lt;br/&gt;<br>
OPENSSLDIR:&nbsp;&quot;/usr/local/ssl&quot;&lt;br/&gt;<br>
ENGINESDIR:&nbsp;&quot;/usr/local/lib/engines-1.1&quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&gt;&nbsp;uname&nbsp;-vr&lt;/div&gt;<br>
<br>
&lt;div&gt;4.9.0-3-amd64&nbsp;#1&nbsp;SMP&nbsp;Debian&nbsp;4.9.30-2+deb9u2&nbsp;(2017-06-26)&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&gt;&nbsp;Installed&nbsp;python3&nbsp;(3.5.3)&nbsp;packages&nbsp;via&nbsp;pip:&lt;/div&gt;<br>
<br>
&lt;div&gt;cryptography&nbsp;2.0.3&lt;/div&gt;<br>
<br>
&lt;div&gt;pyopenssl&nbsp;17.2.0&lt;/div&gt;<br>
<br>
&lt;div&gt;Twisted&nbsp;17.5.0&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;I&nbsp;linked&nbsp;cryptography&nbsp;with&nbsp;the&nbsp;following&nbsp;flags:&lt;/div&gt;<br>
<br>
&lt;div&gt;CFLAGS=&quot;-I/usr/local/include&quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;LDFLAGS=&quot;-L/usr/local/lib&quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;think&nbsp;I&nbsp;know&nbsp;where&nbsp;the&nbsp;problem&nbsp;is.&nbsp;It&#39;s&nbsp;obviously&nbsp;not&nbsp;Twisted.&nbsp;I&#39;m&nbsp;using&nbsp;an&nbsp;ECC&nbsp;private&nbsp;key&nbsp;from&nbsp;curve&nbsp;secp521r1&nbsp;and&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;understand,&nbsp;pyOpenSSL&nbsp;still&nbsp;has&nbsp;some&nbsp;problems&nbsp;with&nbsp;supporting&nbsp;this&nbsp;type&nbsp;of&nbsp;private&nbsp;keys.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Its&nbsp;some&nbsp;kind&nbsp;of&nbsp;strange&nbsp;behaviour.&nbsp;I&nbsp;can&nbsp;parse&nbsp;the&nbsp;ECC&nbsp;key&nbsp;from&nbsp;file&nbsp;and&nbsp;do&nbsp;some&nbsp;operations&nbsp;with&nbsp;it&nbsp;(e.g.&nbsp;signing&nbsp;a&nbsp;file)&nbsp;which&nbsp;works&nbsp;well.&lt;/div&gt;<br>
<br>
&lt;div&gt;But&nbsp;if&nbsp;I&nbsp;just&nbsp;call&nbsp;the&nbsp;check()&nbsp;method&nbsp;of&nbsp;the&nbsp;pkey&nbsp;object,&nbsp;I&nbsp;get&nbsp;the&nbsp;error:&nbsp;&quot;Unsupported&nbsp;key&nbsp;type&quot;&nbsp;from&nbsp;pyOpenSSL.&nbsp;I&nbsp;think&nbsp;this&nbsp;is&nbsp;the&nbsp;reason&nbsp;why&nbsp;Twisted&nbsp;cannot&nbsp;get&nbsp;the&nbsp;TLS&nbsp;options&nbsp;from&nbsp;it.&lt;/div&gt;<br>
<br>
&lt;div&gt;A&nbsp;similar&nbsp;situation&nbsp;is&nbsp;being&nbsp;described&nbsp;here:&nbsp;https://github.com/pyca/pyopenssl/issues/291&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;tried&nbsp;to&nbsp;follow&nbsp;the&nbsp;workaround&nbsp;being&nbsp;described&nbsp;in&nbsp;the&nbsp;issue&nbsp;from&nbsp;the&nbsp;link&nbsp;above,&nbsp;namely&nbsp;to&nbsp;serialise&nbsp;the&nbsp;private&nbsp;key&nbsp;to&nbsp;cryptography&nbsp;and&nbsp;later&nbsp;to&nbsp;convert&nbsp;it&nbsp;to&nbsp;a&nbsp;pyOpenSSL&nbsp;pkey&nbsp;object,&nbsp;but&nbsp;it&nbsp;still&nbsp;does&nbsp;not&nbsp;support&nbsp;the&nbsp;key&nbsp;type.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Maybe&nbsp;you&nbsp;have&nbsp;an&nbsp;idea&nbsp;of&nbsp;how&nbsp;to&nbsp;get&nbsp;those&nbsp;things&nbsp;work?&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Thank&nbsp;you&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;name=&quot;quote&quot;&nbsp;style=&quot;margin:10px&nbsp;5px&nbsp;5px&nbsp;10px;&nbsp;padding:&nbsp;10px&nbsp;0&nbsp;10px&nbsp;10px;&nbsp;border-left:2px&nbsp;solid&nbsp;#C3D9E5;&nbsp;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;<br>
&lt;div&nbsp;style=&quot;margin:0&nbsp;0&nbsp;10px&nbsp;0;&quot;&gt;&lt;b&gt;Gesendet:&lt;/b&gt;&nbsp;Freitag,&nbsp;18.&nbsp;August&nbsp;2017&nbsp;um&nbsp;07:23&nbsp;Uhr&lt;br/&gt;<br>
&lt;b&gt;Von:&lt;/b&gt;&nbsp;Glyph&nbsp;&lt;glyph@twistedmatrix.com&gt;&lt;br/&gt;<br>
&lt;b&gt;An:&lt;/b&gt;&nbsp;&quot;Twisted&nbsp;general&nbsp;discussion&quot;&nbsp;&lt;twisted-python@twistedmatrix.com&gt;&lt;br/&gt;<br>
&lt;b&gt;Betreff:&lt;/b&gt;&nbsp;Re:&nbsp;[Twisted-Python]&nbsp;SSLContext&nbsp;not&nbsp;valid&nbsp;for&nbsp;TLS&nbsp;Server&lt;/div&gt;<br>
<br>
&lt;div&nbsp;name=&quot;quoted-content&quot;&gt;&lt;br/&gt;<br>
&gt;&nbsp;On&nbsp;Aug&nbsp;16,&nbsp;2017,&nbsp;at&nbsp;1:15&nbsp;PM,&nbsp;ceeborraa&nbsp;&lt;ceeborraa@gmx.de&gt;&nbsp;wrote:&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;Hi,&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;running&nbsp;Twisted&nbsp;17.5.0&nbsp;on&nbsp;Python&nbsp;3.5.3&nbsp;and&nbsp;want&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS&nbsp;server&nbsp;with&nbsp;Twisted.&nbsp;I&nbsp;strictly&nbsp;sticked&nbsp;to&nbsp;the&nbsp;example&nbsp;of&nbsp;echoserv_ssl.py&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/documents/current/core/howto/ssl.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/documents/current/core/howto/ssl.html&lt;/a&gt;,&nbsp;but&nbsp;TLS&nbsp;server&nbsp;is&nbsp;not&nbsp;running&nbsp;properly.&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;Despite&nbsp;the&nbsp;server&nbsp;starts&nbsp;correctly,&nbsp;it&nbsp;doesn&#39;t&nbsp;offer&nbsp;any&nbsp;cipher&nbsp;suites&nbsp;to&nbsp;the&nbsp;client,&nbsp;no&nbsp;matter&nbsp;what&nbsp;kind&nbsp;of&nbsp;client&nbsp;is&nbsp;trying&nbsp;to&nbsp;connect.&nbsp;Any&nbsp;time&nbsp;a&nbsp;client&nbsp;connects,&nbsp;the&nbsp;connection&nbsp;is&nbsp;immediately&nbsp;aborted&nbsp;by&nbsp;server&nbsp;with&nbsp;the&nbsp;error&nbsp;message&nbsp;of:&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;&lt;class&nbsp;&#39;OpenSSL.SSL.Error&#39;&gt;:&nbsp;[(&#39;SSL&nbsp;routines&#39;,&#39;tls_post_process_client_hello&#39;,no&nbsp;shared&nbsp;cipher&#39;)]&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;I&nbsp;tried&nbsp;to&nbsp;connect&nbsp;to&nbsp;server&nbsp;with&nbsp;the&nbsp;TLS&nbsp;echo&nbsp;client&nbsp;example&nbsp;of&nbsp;echoclient_ssl.py,&nbsp;with&nbsp;openssl&nbsp;s_client&nbsp;command&nbsp;and&nbsp;with&nbsp;nmap&nbsp;by&nbsp;using&nbsp;the&nbsp;--ssl-enum-ciphers&nbsp;script.&nbsp;Each&nbsp;time&nbsp;it&nbsp;failed&nbsp;with&nbsp;the&nbsp;above&nbsp;error&nbsp;message.&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;If&nbsp;I&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;options&nbsp;offered&nbsp;by&nbsp;ssl.CertificateOptions()&nbsp;as&nbsp;suggested&nbsp;in&nbsp;the&nbsp;example,&nbsp;but&nbsp;instead&nbsp;create&nbsp;a&nbsp;ssl.DefaultOpenSSLContextFactory()&nbsp;where&nbsp;I&nbsp;provide&nbsp;the&nbsp;privateKey&nbsp;and&nbsp;Certificate&nbsp;as&nbsp;filename-strings,&nbsp;the&nbsp;server&nbsp;works&nbsp;correctly&nbsp;and&nbsp;offers&nbsp;the&nbsp;intended&nbsp;cipher&nbsp;suites.&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;But&nbsp;I&nbsp;need&nbsp;to&nbsp;create&nbsp;the&nbsp;SSLContext&nbsp;from&nbsp;a&nbsp;OpenSSL&nbsp;PKey-Object&nbsp;(private&nbsp;Key)&nbsp;and&nbsp;a&nbsp;OpenSSL&nbsp;Certificate-Object.&nbsp;Therefore&nbsp;I&nbsp;adjusted&nbsp;the&nbsp;server&nbsp;code&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;example&nbsp;to:&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;certificate&nbsp;=&nbsp;ssl.Certificate(cert_obj)&lt;br/&gt;<br>
&gt;&nbsp;privkey&nbsp;=&nbsp;ssl.KeyPair(pkey)&nbsp;#&nbsp;pkey&nbsp;is&nbsp;the&nbsp;OpenSSL&nbsp;PKey&nbsp;object&lt;br/&gt;<br>
&gt;&nbsp;prkey_and_cert&nbsp;=&nbsp;ssl.PrivateCertificate.fromCertificateAndKeyPair(certificate,privkey)&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;factory&nbsp;=&nbsp;protocol.Factory.forProtocol(Echo)&lt;br/&gt;<br>
&gt;&nbsp;reactor.listenSSL(7498,factory,prkey_and_cert.options())&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;Again,&nbsp;the&nbsp;server&nbsp;starts,&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;provide&nbsp;cipher&nbsp;suites&nbsp;so&nbsp;that&nbsp;no&nbsp;client&nbsp;can&nbsp;connect.&nbsp;Same&nbsp;as&nbsp;above!&lt;br/&gt;<br>
&gt;&lt;br/&gt;<br>
&gt;&nbsp;Appreciate&nbsp;any&nbsp;help!&lt;br/&gt;<br>
&lt;br/&gt;<br>
This&nbsp;sounds&nbsp;like&nbsp;it&nbsp;might&nbsp;be&nbsp;a&nbsp;configuration&nbsp;problem&nbsp;with&nbsp;your&nbsp;build&nbsp;of&nbsp;OpenSSL.&nbsp;Can&nbsp;you&nbsp;post&nbsp;the&nbsp;most&nbsp;detailed&nbsp;explanation&nbsp;of&nbsp;what&nbsp;versions&nbsp;of&nbsp;everything&nbsp;you&#39;re&nbsp;using&nbsp;that&nbsp;you&nbsp;can?&nbsp;Particularly:&nbsp;your&nbsp;operating&nbsp;system,&nbsp;any&nbsp;installed&nbsp;version&nbsp;of&nbsp;OpenSSL,&nbsp;cryptography?&nbsp;(If&nbsp;you&nbsp;know&nbsp;how&nbsp;to&nbsp;check&nbsp;which&nbsp;OpenSSL&nbsp;cryptography&nbsp;is&nbsp;linked&nbsp;to,&nbsp;that&nbsp;would&nbsp;be&nbsp;great&nbsp;too.)&nbsp;What&nbsp;attributes&nbsp;does&nbsp;the&nbsp;private&nbsp;key&nbsp;have?&lt;br/&gt;<br>
&lt;br/&gt;<br>
Thanks&nbsp;for&nbsp;using&nbsp;Twisted,&lt;br/&gt;<br>
&lt;br/&gt;<br>
-g&lt;br/&gt;<br>
&lt;br/&gt;<br>
_______________________________________________&lt;br/&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br/&gt;<br>
Twisted-Python@twistedmatrix.com&lt;br/&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<br>
<br>
<br>

</tt>
