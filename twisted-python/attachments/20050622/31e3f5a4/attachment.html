<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;5.5.2657.73&quot;&gt;<br>
&lt;TITLE&gt;Distinguishing&nbsp;TCP&nbsp;connections&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Eric,&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;I&nbsp;came&nbsp;up&nbsp;with&nbsp;a&nbsp;nice&nbsp;way&nbsp;of&nbsp;managing&nbsp;connections&nbsp;on&nbsp;the&nbsp;last&nbsp;project&nbsp;I&nbsp;worked&nbsp;on:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;The&nbsp;DataConnection&nbsp;is&nbsp;the&nbsp;protocol&nbsp;instance&nbsp;(in&nbsp;this&nbsp;case&nbsp;inheriting&nbsp;from&nbsp;Int32StringReceiver).&nbsp;&nbsp;Each&nbsp;time&nbsp;a&nbsp;protocol&nbsp;connects&nbsp;it&nbsp;calls&nbsp;the&nbsp;registerSource&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;class&nbsp;DataConnection(Int32StringReceiver):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;manager):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.manager&nbsp;=&nbsp;manager&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;closeConnection(self):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.transport.loseConnection()&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;connectionMade(self):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;'registering&nbsp;connection'&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.registerConnection()&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;connectionLost(self,&nbsp;reason):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;'connection&nbsp;lost,&nbsp;removing....'&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.removeConnection()&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;.&lt;/FONT&gt;<br>
&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;[&nbsp;code&nbsp;omitted&nbsp;for&nbsp;brevity&nbsp;]&lt;/FONT&gt;<br>
&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;.&lt;/FONT&gt;<br>
&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;registerConnection(self):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;register&nbsp;data&nbsp;connection&nbsp;with&nbsp;connection&nbsp;manager.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.manager.registerSource(self)&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;removeConnection(self):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove&nbsp;this&nbsp;connection&nbsp;from&nbsp;the&nbsp;connection&nbsp;manager.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.manager.removeSource(self.id)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;setId(self,&nbsp;id):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.id&nbsp;=&nbsp;id&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;And&nbsp;the&nbsp;ConnectionManager&nbsp;is&nbsp;the&nbsp;factory&nbsp;class&nbsp;(inherited&nbsp;from&nbsp;the&nbsp;generic&nbsp;Factory&nbsp;class).&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;class&nbsp;ConnectionManager(Factory):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;eventhandler):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.ids&nbsp;=&nbsp;0&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.sources&nbsp;=&nbsp;{}&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.eventhandler&nbsp;=&nbsp;eventhandler&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;--&nbsp;see&nbsp;comments&nbsp;later&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;buildProtocol(self,&nbsp;addr):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;DataConnection(self)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;newId(self):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get&nbsp;an&nbsp;id&nbsp;that&nbsp;is&nbsp;unique&nbsp;for&nbsp;the&nbsp;life&nbsp;of&nbsp;the&nbsp;connection&nbsp;manager.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;=&nbsp;self.ids+1&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.ids&nbsp;=&nbsp;id&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;id&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;registerSource(self,&nbsp;source):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;register&nbsp;a&nbsp;new&nbsp;source,&nbsp;this&nbsp;assigns&nbsp;the&nbsp;source&nbsp;an&nbsp;id&nbsp;and&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adds&nbsp;it&nbsp;to&nbsp;the&nbsp;sources&nbsp;dictionary.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;=&nbsp;self.newId()&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.sources[id]&nbsp;=&nbsp;source&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;set&nbsp;source&nbsp;id&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source.setId(id)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;removeSource(self,&nbsp;id):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove&nbsp;the&nbsp;connection&nbsp;indicated&nbsp;by&nbsp;the&nbsp;source&nbsp;id&nbsp;from&nbsp;the&nbsp;current&nbsp;connection&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool&nbsp;any&nbsp;subsequent&nbsp;behaviour&nbsp;must&nbsp;be&nbsp;handled&nbsp;in&nbsp;the&nbsp;event&nbsp;manager.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.sources.has_key(id):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;del&nbsp;self.sources[id]&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;closeConnections(self):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;source&nbsp;in&nbsp;self.sources.values():&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source.closeConnection()&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;[&nbsp;code&nbsp;omitted&nbsp;for&nbsp;brevity&nbsp;]&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;As&nbsp;you&nbsp;can&nbsp;see&nbsp;the&nbsp;when&nbsp;a&nbsp;connection&nbsp;is&nbsp;made&nbsp;it&nbsp;is&nbsp;registered&nbsp;with&nbsp;the&nbsp;factory&nbsp;instance.&nbsp;&nbsp;This&nbsp;uniquely&nbsp;identifies&nbsp;the&nbsp;connection,&nbsp;and&nbsp;allows&nbsp;you&nbsp;to&nbsp;identify&nbsp;when&nbsp;you&nbsp;get&nbsp;a&nbsp;message&nbsp;which&nbsp;connection&nbsp;it&nbsp;is&nbsp;from.&nbsp;&nbsp;This&nbsp;also&nbsp;simplifies&nbsp;sending&nbsp;a&nbsp;message&nbsp;back&nbsp;along&nbsp;the&nbsp;same&nbsp;channel:&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;To&nbsp;do&nbsp;this&nbsp;you&nbsp;can&nbsp;create&nbsp;an&nbsp;event&nbsp;handler&nbsp;that&nbsp;implements&nbsp;some&nbsp;form&nbsp;of&nbsp;event&nbsp;processing:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;class&nbsp;EventHandler:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;manager):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.manager&nbsp;=&nbsp;manager&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;messageReceived(self,&nbsp;id,&nbsp;message):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;process&nbsp;message&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;create&nbsp;new&nbsp;message&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newMessage&nbsp;=&nbsp;&quot;this&nbsp;is&nbsp;a&nbsp;test&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;send&nbsp;new&nbsp;message&nbsp;back&nbsp;along&nbsp;same&nbsp;connection&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.manager.sendMessage(id,&nbsp;newMessage)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;And&nbsp;in&nbsp;the&nbsp;ConnectionManager&nbsp;add&nbsp;something&nbsp;like&nbsp;the&nbsp;following&nbsp;methods:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;propagateMessage(self,&nbsp;id,&nbsp;message):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;method&nbsp;simply&nbsp;passes&nbsp;the&nbsp;received&nbsp;message&nbsp;through&nbsp;to&nbsp;the&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EventHandler&nbsp;class&nbsp;instance&nbsp;along&nbsp;with&nbsp;the&nbsp;id&nbsp;of&nbsp;the&nbsp;connection&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;message&nbsp;was&nbsp;received&nbsp;from.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.eventhandler.messageReceived(id,&nbsp;message)&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;sendMessage(self,&nbsp;id,&nbsp;message):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;method&nbsp;retrieves&nbsp;the&nbsp;correct&nbsp;connection&nbsp;and&nbsp;sends&nbsp;a&nbsp;message&nbsp;through&nbsp;it.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.sources.has_key(id):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.sources[id].emitMessage(message)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;And&nbsp;the&nbsp;DataConnection:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;stringReceived(self,&nbsp;data):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.manager.propagateEvent(self.id,&nbsp;data)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;emitMessage(self,&nbsp;message):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send&nbsp;a&nbsp;message&nbsp;along&nbsp;the&nbsp;data&nbsp;connection.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.sendString(message)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;If&nbsp;any&nbsp;of&nbsp;this&nbsp;is&nbsp;unclear&nbsp;please&nbsp;let&nbsp;me&nbsp;know.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Regards,&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Grant&nbsp;McDonald&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;----Original&nbsp;Message-----&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;From:&nbsp;twisted-python-bounces@twistedmatrix.com&nbsp;[&lt;A&nbsp;HREF=&quot;mailto:twisted-python-bounces@twistedmatrix.com&quot;&gt;mailto:twisted-python-bounces@twistedmatrix.com&lt;/A&gt;]On&nbsp;Behalf&nbsp;Of&nbsp;Eric&nbsp;Hsu&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Sent:&nbsp;21&nbsp;June&nbsp;2005&nbsp;17:33&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;To:&nbsp;radix@twistedmatrix.com&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Cc:&nbsp;Twisted&nbsp;general&nbsp;discussion&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Subject:&nbsp;Re:&nbsp;[Twisted-Python]&nbsp;How&nbsp;could&nbsp;I&nbsp;distinguish&nbsp;each&nbsp;TCP&nbsp;connection?&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Thank&nbsp;you&nbsp;very&nbsp;much!&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;You've&nbsp;been&nbsp;a&nbsp;GREAT&nbsp;help&nbsp;:D&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;2005/6/21,&nbsp;Christopher&nbsp;Armstrong&nbsp;&lt;radeex@gmail.com&gt;:&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;I&nbsp;suggest,&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;stock&nbsp;&quot;Factory&quot;,&nbsp;making&nbsp;a&nbsp;subclass&nbsp;of&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;it&nbsp;with&nbsp;buildProtocol&nbsp;implemented&nbsp;like&nbsp;so:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;def&nbsp;buildProtocol(self,&nbsp;addr):&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;Factory.buildProtocol(self,&nbsp;addr)&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;self.connections.append&nbsp;(p)&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;p&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Or&nbsp;similar&nbsp;(you'll&nbsp;have&nbsp;to&nbsp;define&nbsp;the&nbsp;'connections'&nbsp;list&nbsp;yourself&nbsp;in&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;__init__).&nbsp;In&nbsp;the&nbsp;protocol's&nbsp;connectionLost,&nbsp;you&nbsp;could&nbsp;then&nbsp;remove&nbsp;the&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;protocol&nbsp;from&nbsp;that&nbsp;list.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;!--[object_id=#infocomp.com#]--&gt;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#808080&nbsp;size=1&gt;Important&nbsp;notice:&nbsp;This&nbsp;message&nbsp;is&nbsp;intended&nbsp;for&nbsp;the&nbsp;individual(s)&nbsp;and&nbsp;entity(s)&nbsp;addressed.&nbsp;The&nbsp;information&nbsp;contained&nbsp;in&nbsp;this&nbsp;transmission&nbsp;and&nbsp;any&nbsp;attached,&nbsp;may&nbsp;be&nbsp;confidential&nbsp;and&nbsp;may&nbsp;also&nbsp;be&nbsp;the&nbsp;subject&nbsp;of&nbsp;legal&nbsp;privilege,&nbsp;public&nbsp;interest&nbsp;immunity&nbsp;or&nbsp;legal&nbsp;professional&nbsp;privilege.&nbsp;Any&nbsp;review,&nbsp;retransmission,&nbsp;dissemination&nbsp;or&nbsp;other&nbsp;use&nbsp;of,&nbsp;taking&nbsp;of&nbsp;any&nbsp;action&nbsp;in&nbsp;reliance&nbsp;upon&nbsp;this&nbsp;information&nbsp;by&nbsp;person&nbsp;or&nbsp;entities&nbsp;other&nbsp;than&nbsp;the&nbsp;recipient&nbsp;is&nbsp;prohibited&nbsp;and&nbsp;requires&nbsp;authorization&nbsp;from&nbsp;the&nbsp;sender.&nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;addressee&nbsp;indicated&nbsp;in&nbsp;this&nbsp;message&nbsp;(or&nbsp;responsible&nbsp;for&nbsp;delivery&nbsp;of&nbsp;the&nbsp;message&nbsp;to&nbsp;such&nbsp;person)&nbsp;you&nbsp;may&nbsp;not&nbsp;copy&nbsp;or&nbsp;deliver&nbsp;this&nbsp;message&nbsp;to&nbsp;anyone.&nbsp;In&nbsp;such&nbsp;cases&nbsp;you&nbsp;should&nbsp;destroy&nbsp;this&nbsp;message&nbsp;and&nbsp;kindly&nbsp;notify&nbsp;the&nbsp;sender&nbsp;by&nbsp;reply&nbsp;email.&nbsp;&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#808080&nbsp;size=1&gt;WARNING:&nbsp;Although&nbsp;Infocomp&nbsp;has&nbsp;taken&nbsp;reasonable&nbsp;precautions&nbsp;so&nbsp;that&nbsp;no&nbsp;viruses&nbsp;are&nbsp;present&nbsp;in&nbsp;this&nbsp;e-mail,&nbsp;the&nbsp;company&nbsp;cannot&nbsp;accept&nbsp;responsibility&nbsp;for&nbsp;any&nbsp;loss&nbsp;or&nbsp;damage&nbsp;arising&nbsp;from&nbsp;the&nbsp;use&nbsp;of&nbsp;e-mail&nbsp;attachments.&lt;/FONT&gt;&lt;/P&gt;&lt;/HTML&gt;
</tt>
