<tt>
Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;wrote&nbsp;a&nbsp;server&nbsp;using&nbsp;a&nbsp;protocol&nbsp;that&nbsp;inherit&nbsp;from&nbsp;&#39;basic.LineReceiver&#39;.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;some&nbsp;circonstances&nbsp;I&nbsp;need&nbsp; to&nbsp;reject&nbsp;the&nbsp;data&nbsp;send&nbsp;by&nbsp;the&nbsp;client&nbsp;and&nbsp;to&nbsp;close&nbsp;the&nbsp;connection.&nbsp;Here&nbsp;is&nbsp;how&nbsp;I&nbsp;do&nbsp;that:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;MyProtocol(basic.LineReceiver):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; ........&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; def&nbsp;error(self,&nbsp;error_msg):&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; self.transport.write(error_msg)&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; self.transport.loseConnection()&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sometimes&nbsp;it&nbsp;works:&nbsp;the&nbsp;client&nbsp;gets&nbsp;notify&nbsp;of&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;connection&nbsp;is&nbsp;closed&nbsp;properly.&lt;/div&gt;&lt;div&gt;And&nbsp;some&nbsp;other&nbsp;times,&nbsp;the&nbsp;client&nbsp;does&nbsp;not&nbsp;received&nbsp;the&nbsp;error&nbsp;notification&nbsp;and&nbsp;the&nbsp;server&nbsp;closes&nbsp;the&nbsp;connection,&nbsp;which&nbsp;causes&nbsp;the&nbsp;client&nbsp;(wich&nbsp;is&nbsp;not&nbsp;written&nbsp;using&nbsp;twisted,&nbsp;but&nbsp;with&nbsp;the&nbsp;socket&nbsp;module&nbsp;from&nbsp;the&nbsp;standard&nbsp;lib)&nbsp;to&nbsp;crash&nbsp;with&nbsp;&#39;socket.error:&nbsp;(10054,&nbsp;&#39;Connection&nbsp;reset&nbsp;by&nbsp;peer&#39;)&#39;.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;I&nbsp;red&nbsp;somewhere&nbsp;in&nbsp;the&nbsp;docs&nbsp;or&nbsp;in&nbsp;the&nbsp;mailing&nbsp;list,&nbsp;self.transort.write&nbsp;does&nbsp;can&nbsp;return&nbsp;before&nbsp;it&nbsp;really&nbsp;writes&nbsp;the&nbsp;data. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;how&nbsp;could&nbsp;I&nbsp;do,&nbsp;without&nbsp;using&nbsp;blocking&nbsp;code,&nbsp;to&nbsp;wait&nbsp;until self.transort.write&nbsp;effectively&nbsp;writes&nbsp;the&nbsp;data&nbsp;to&nbsp;avoid&nbsp;closing&nbsp;the&nbsp;connection&nbsp;with&nbsp;unwritten&nbsp;data&nbsp;?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;you.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Emmanuel&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
