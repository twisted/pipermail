<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Hi&nbsp;Quan&nbsp;Tong&nbsp;Anh.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Nov&nbsp;25,&nbsp;2013&nbsp;at&nbsp;10:05&nbsp;PM,&nbsp;Quan&nbsp;Tong&nbsp;Anh&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:anhquankitty@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;anhquankitty@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt; -&nbsp;Python&nbsp;2.7.3&lt;/div&gt;<br>
&lt;div&gt; -&nbsp;[twisted,&nbsp;version&nbsp;13.1.0]&lt;/div&gt;&lt;div&gt; -&nbsp;xen-domU&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;`atop`&nbsp;shows&nbsp;that&nbsp;`carbon-relay`&nbsp;is&nbsp;eating&nbsp;80,&nbsp;90%&nbsp;USRCPU.&nbsp;&gt;From&nbsp;the&nbsp;`strace`:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp;accept(7,&nbsp;{sa_family=AF_INET,&nbsp;sin_port=htons(60649),&nbsp;sin_addr=inet_addr(&quot;192.237.222.81&quot;)},&nbsp;[16])&nbsp;=&nbsp;257&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;{sa_family=AF_INET,&nbsp;sin_port=htons(51564),&nbsp;sin_addr=inet_addr(&quot;166.78.1.48&quot;)},&nbsp;[16])&nbsp;=&nbsp;257&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;0x7ffff4679550,&nbsp;[16])&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&nbsp;-1&nbsp;EAGAIN&nbsp;(Resource&nbsp;temporarily&nbsp;unavailable)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;{sa_family=AF_INET,&nbsp;sin_port=htons(33654),&nbsp;sin_addr=inet_addr(&quot;198.61.194.248&quot;)},&nbsp;[16])&nbsp;=&nbsp;257&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;{sa_family=AF_INET,&nbsp;sin_port=htons(50037),&nbsp;sin_addr=inet_addr(&quot;&lt;a&nbsp;href=&quot;tel:166.78.181.204&quot;&nbsp;value=&quot;+16678181204&quot;&nbsp;target=&quot;_blank&quot;&gt;166.78.181.204&lt;/a&gt;&quot;)},&nbsp;[16])&nbsp;=&nbsp;257&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;0x7ffff4679550,&nbsp;[16])&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&nbsp;-1&nbsp;EAGAIN&nbsp;(Resource&nbsp;temporarily&nbsp;unavailable)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;strange&nbsp;thing&nbsp;is:&nbsp;even&nbsp;restart&nbsp;the&nbsp;service,&nbsp;it&nbsp;seems&nbsp;stuck&nbsp;at&nbsp;fd&nbsp;7&nbsp;everytime&nbsp;running&nbsp;`strace`.&nbsp;Does&nbsp;it&nbsp;mean&nbsp;this&nbsp;fd&nbsp;is&nbsp;not&nbsp;being&nbsp;cleanup&nbsp;properly?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;have&nbsp;given&nbsp;a&nbsp;lot&nbsp;of&nbsp;data,&nbsp;but&nbsp;haven&#39;t&nbsp;actually&nbsp;described&nbsp;a&nbsp;problem.&nbsp;Nothing&nbsp;is&nbsp;&quot;stuck&quot;&nbsp;at&nbsp;FD&nbsp;7,&nbsp;it&#39;s&nbsp;simply&nbsp;a&nbsp;listening&nbsp;socket&nbsp;file&nbsp;descriptor,&nbsp;and&nbsp;the&nbsp;way&nbsp;listening&nbsp;sockets&nbsp;work&nbsp;is&nbsp;you&nbsp;call&nbsp;accept()&nbsp;repeatedly&nbsp;on&nbsp;them&nbsp;to&nbsp;get&nbsp;incoming&nbsp;connections.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;accept()&nbsp;returning&nbsp;EAGAIN&nbsp;is&nbsp;normal&nbsp;behavior&nbsp;and&nbsp;should&nbsp;basically&nbsp;be&nbsp;ignored.&nbsp;Twisted&nbsp;handles&nbsp;this&nbsp;case&nbsp;appropriately.&nbsp;From&nbsp;the&nbsp;man&nbsp;page:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; EAGAIN&nbsp;or&nbsp;EWOULDBLOCK&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The&nbsp;socket&nbsp;is&nbsp;marked&nbsp;nonblocking&nbsp;and&nbsp;no&nbsp;connections&nbsp;are&nbsp;present&nbsp;to&nbsp;be&nbsp;accepted.&nbsp; POSIX.1-2001&nbsp;allows&nbsp;either&nbsp;error&nbsp;to&nbsp;be&nbsp;returned&nbsp;for&nbsp;this&nbsp;case,&nbsp;and&nbsp;does&nbsp;not&nbsp;require&nbsp;these&nbsp;constants&nbsp;to&nbsp;have&nbsp;the&nbsp;same&nbsp;value,&nbsp;so&nbsp;a&nbsp;portable&nbsp;application&nbsp;should&nbsp;check&nbsp;for&nbsp;both&nbsp;possibilities.&lt;/div&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;actually&nbsp;something&nbsp;wrong&nbsp;with&nbsp;your&nbsp;service?&nbsp;Can&nbsp;you&nbsp;explain&nbsp;the&nbsp;behavior&nbsp;you&#39;re&nbsp;seeing&nbsp;and&nbsp;how&nbsp;it&nbsp;differs&nbsp;from&nbsp;the&nbsp;behavior&nbsp;you&nbsp;want&nbsp;to&nbsp;see?&nbsp;If&nbsp;the&nbsp;problem&nbsp;is&nbsp;only&nbsp;&quot;carbon&nbsp;uses&nbsp;a&nbsp;lot&nbsp;of&nbsp;CPU&quot;,&nbsp;maybe&nbsp;the&nbsp;problem&nbsp;is&nbsp;either&nbsp;just&nbsp;that&nbsp;carbon&nbsp;is&nbsp;inefficient&nbsp;or&nbsp;you&nbsp;need&nbsp;to&nbsp;scale&nbsp;up&nbsp;to&nbsp;more&nbsp;instances?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Christopher&nbsp;Armstrong&lt;br&gt;&lt;a&nbsp;href=&quot;http://radix.twistedmatrix.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://radix.twistedmatrix.com/&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://planet-if.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://planet-if.com/&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
