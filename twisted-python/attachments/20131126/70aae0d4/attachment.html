<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt; -&nbsp;Python&nbsp;2.7.3&lt;/div&gt;&lt;div&gt; -&nbsp;[twisted,&nbsp;version&nbsp;13.1.0]&lt;/div&gt;&lt;div&gt; -&nbsp;xen-domU&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;`atop`&nbsp;shows&nbsp;that&nbsp;`carbon-relay`&nbsp;is&nbsp;eating&nbsp;80,&nbsp;90%&nbsp;USRCPU.&nbsp;From&nbsp;the&nbsp;`strace`:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp;accept(7,&nbsp;{sa_family=AF_INET,&nbsp;sin_port=htons(60649),&nbsp;sin_addr=inet_addr(&quot;192.237.222.81&quot;)},&nbsp;[16])&nbsp;=&nbsp;257&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;{sa_family=AF_INET,&nbsp;sin_port=htons(51564),&nbsp;sin_addr=inet_addr(&quot;166.78.1.48&quot;)},&nbsp;[16])&nbsp;=&nbsp;257&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;0x7ffff4679550,&nbsp;[16])&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&nbsp;-1&nbsp;EAGAIN&nbsp;(Resource&nbsp;temporarily&nbsp;unavailable)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;{sa_family=AF_INET,&nbsp;sin_port=htons(33654),&nbsp;sin_addr=inet_addr(&quot;198.61.194.248&quot;)},&nbsp;[16])&nbsp;=&nbsp;257&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;{sa_family=AF_INET,&nbsp;sin_port=htons(50037),&nbsp;sin_addr=inet_addr(&quot;166.78.181.204&quot;)},&nbsp;[16])&nbsp;=&nbsp;257&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;accept(7,&nbsp;0x7ffff4679550,&nbsp;[16])&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&nbsp;-1&nbsp;EAGAIN&nbsp;(Resource&nbsp;temporarily&nbsp;unavailable)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;strange&nbsp;thing&nbsp;is:&nbsp;even&nbsp;restart&nbsp;the&nbsp;service,&nbsp;it&nbsp;seems&nbsp;stuck&nbsp;at&nbsp;fd&nbsp;7&nbsp;everytime&nbsp;running&nbsp;`strace`.&nbsp;Does&nbsp;it&nbsp;mean&nbsp;this&nbsp;fd&nbsp;is&nbsp;not&nbsp;being&nbsp;cleanup&nbsp;properly?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;increased&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;files:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;**/proc/2891/limits** &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Soft&nbsp;Limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hard&nbsp;Limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Units&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;cpu&nbsp;time&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; seconds&nbsp;  &lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;Max&nbsp;file&nbsp;size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;data&nbsp;size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;stack&nbsp;size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8388608&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes&nbsp; &nbsp;  &lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;Max&nbsp;core&nbsp;file&nbsp;size&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;resident&nbsp;set&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;processes&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;15834&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 15834&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; processes &lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;Max&nbsp;open&nbsp;files&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16384&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16384&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; files&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;locked&nbsp;memory&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;65536&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 65536&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;address&nbsp;space&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytes&nbsp; &nbsp;  &lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;Max&nbsp;file&nbsp;locks&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; locks&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;pending&nbsp;signals&nbsp; &nbsp; &nbsp; &nbsp;15834&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 15834&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signals&nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;msgqueue&nbsp;size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;819200&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;819200&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bytes&nbsp; &nbsp;  &lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;Max&nbsp;nice&nbsp;priority&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;realtime&nbsp;priority&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Max&nbsp;realtime&nbsp;timeout&nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unlimited&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; us&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;then&nbsp;it&nbsp;decreases&nbsp;down&nbsp;to&nbsp;~&nbsp;50%.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;problem&nbsp;looks&nbsp;like&nbsp;similar&nbsp;to&nbsp;this&nbsp;[thread](&lt;a&nbsp;href=&quot;http://twistedmatrix.com/pipermail/twisted-python/2008-September/018361.html&quot;&gt;http://twistedmatrix.com/pipermail/twisted-python/2008-September/018361.html&lt;/a&gt;)&nbsp;but&nbsp;since&nbsp;we&nbsp;have&nbsp;a&nbsp;few&nbsp;sockets&nbsp;in&nbsp;TIME_WAIT&nbsp;state,&nbsp;I&nbsp;don&#39;t&nbsp;think&nbsp;that&nbsp;enable&nbsp;the&nbsp;`tw_recycle`&nbsp;can&nbsp;help.&nbsp;About&nbsp;the&nbsp;`tcp_syncookies`,&nbsp;I&nbsp;don&#39;t&nbsp;see&nbsp;any&nbsp;related&nbsp;message&nbsp;in&nbsp;the&nbsp;syslog.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;what&nbsp;I&nbsp;get&nbsp;when&nbsp;trying&nbsp;to&nbsp;start&nbsp;`carbon-relay`&nbsp;in&nbsp;debug&nbsp;mode:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;26/11/2013&nbsp;02:22:14&nbsp;::&nbsp;[listener]&nbsp;MetricPickleReceiver&nbsp;connection&nbsp;with&nbsp;&lt;a&nbsp;href=&quot;http://50.56.249.127:48772&quot;&gt;50.56.249.127:48772&lt;/a&gt;&nbsp;lost:&nbsp;Connection&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;was&nbsp;lost&nbsp;in&nbsp;a&nbsp;non-clean&nbsp;fashion:&nbsp;Connection&nbsp;lost.&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;26/11/2013&nbsp;02:22:14&nbsp;::&nbsp;[listener]&nbsp;MetricPickleReceiver&nbsp;connection&nbsp;with&nbsp;&lt;a&nbsp;href=&quot;http://198.101.241.101:50672&quot;&gt;198.101.241.101:50672&lt;/a&gt;&nbsp;lost:&nbsp;Connection&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;was&nbsp;lost&nbsp;in&nbsp;a&nbsp;non-clean&nbsp;fashion:&nbsp;Connection&nbsp;lost.&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;26/11/2013&nbsp;02:22:14&nbsp;::&nbsp;[listener]&nbsp;MetricPickleReceiver&nbsp;connection&nbsp;with&nbsp;&lt;a&nbsp;href=&quot;http://166.78.2.167:43346&quot;&gt;166.78.2.167:43346&lt;/a&gt;&nbsp;lost:&nbsp;Connection&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;was&nbsp;lost&nbsp;in&nbsp;a&nbsp;non-clean&nbsp;fashion:&nbsp;Connection&nbsp;lost.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;from&nbsp;`twisted`:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;class&nbsp;ConnectionLost(ConnectionClosed):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;&quot;&quot;&quot;Connection&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;was&nbsp;lost&nbsp;in&nbsp;a&nbsp;non-clean&nbsp;fashion&quot;&quot;&quot;&lt;/div&gt;<br>
&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;def&nbsp;__str__(self):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;s&nbsp;=&nbsp;self.__doc__.strip().splitlines()[0]&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;self.args:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;s&nbsp;=&nbsp;&#39;%s:&nbsp;%s&#39;&nbsp;%&nbsp;(s,&nbsp;&#39;&nbsp;&#39;.join(self.args))&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;s&nbsp;=&nbsp;&#39;%s.&#39;&nbsp;%&nbsp;s&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;s&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;also&nbsp;have&nbsp;tried&nbsp;to&nbsp;[debug&nbsp;with&nbsp;`gdb`](&lt;a&nbsp;href=&quot;https://wiki.python.org/moin/DebuggingWithGdb&quot;&gt;https://wiki.python.org/moin/DebuggingWithGdb&lt;/a&gt;)&nbsp;but&nbsp;`pystack`&nbsp;returns&nbsp;nothing.&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
