<tt>
&lt;html&gt;&lt;body&gt;On&nbsp;08:00&nbsp;pm,&nbsp;exarkun@divmod.com&nbsp;wrote:&lt;br&nbsp;/&gt;&amp;gt;On&nbsp;Fri,&nbsp;12&nbsp;Jan&nbsp;2007&nbsp;10:54:10&nbsp;-0800,&nbsp;Scott&nbsp;Lamb&nbsp;&amp;lt;slamb@slamb.org&amp;gt;&nbsp;wrote:&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;(1)&nbsp;create&nbsp;a&nbsp;test&nbsp;that&nbsp;likely&nbsp;fails&nbsp;by&nbsp;running&nbsp;many,&nbsp;many&nbsp;times.&nbsp;It'd&nbsp;&amp;#160;bog&nbsp;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;down&nbsp;the&nbsp;test&nbsp;suite.&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;(2)&nbsp;create&nbsp;a&nbsp;test&nbsp;that&nbsp;might&nbsp;fail&nbsp;sometime,&nbsp;maybe.&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;(3)&nbsp;add&nbsp;instrumentation&nbsp;to&nbsp;the&nbsp;main&nbsp;code&nbsp;solely&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;&amp;#160;the&nbsp;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;test&nbsp;(break&nbsp;twisted's&nbsp;kneecap&nbsp;before&nbsp;the&nbsp;race).&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;(4)&nbsp;just&nbsp;say&nbsp;&quot;clearly[*]&nbsp;if&nbsp;event&nbsp;A&nbsp;happens&nbsp;between&nbsp;lines&nbsp;X&nbsp;and&nbsp;Y,&nbsp;&amp;#160;then&nbsp;it&nbsp;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;is&nbsp;handled&nbsp;improperly.&quot;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;&lt;br&nbsp;/&gt;&amp;gt;&amp;gt;I&nbsp;prefer&nbsp;#4.&lt;br&nbsp;/&gt;&amp;gt;&lt;br&nbsp;/&gt;&amp;gt;I&nbsp;think&nbsp;this&nbsp;actually&nbsp;varies&nbsp;from&nbsp;case&nbsp;to&nbsp;case.&nbsp;&amp;#160;For&nbsp;a&nbsp;problem&nbsp;where&nbsp;all&lt;br&nbsp;/&gt;&amp;gt;of&nbsp;the&nbsp;relevant&nbsp;critical&nbsp;points&nbsp;cannot&nbsp;be&nbsp;hooked&nbsp;or&nbsp;mocked&nbsp;or&nbsp;stubbed&nbsp;or&lt;br&nbsp;/&gt;&amp;gt;what&nbsp;have&nbsp;you,&nbsp;then&nbsp;a&nbsp;combination&nbsp;of&nbsp;#2&nbsp;and&nbsp;#4&nbsp;seems&nbsp;correct&nbsp;to&nbsp;me.&nbsp;&amp;#160;You&lt;br&nbsp;/&gt;&amp;gt;should&nbsp;be&nbsp;able&nbsp;to&nbsp;demonstrate&nbsp;that&nbsp;a&nbsp;real&nbsp;problem&nbsp;does&nbsp;exist&nbsp;by&nbsp;adding&nbsp;a&lt;br&nbsp;/&gt;&amp;gt;test&nbsp;which&nbsp;will&nbsp;fail&nbsp;eventually&nbsp;when&nbsp;run&nbsp;repeatedly&nbsp;(eg,&nbsp;using&nbsp;trial&nbsp;-u)&lt;br&nbsp;/&gt;&amp;gt;and&nbsp;which&nbsp;runs&nbsp;for&nbsp;orders&nbsp;of&nbsp;magnitude&nbsp;longer&nbsp;without&nbsp;failing&nbsp;once&nbsp;a&nbsp;fix&lt;br&nbsp;/&gt;&amp;gt;has&nbsp;been&nbsp;applied.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Race&nbsp;conditions&nbsp;are&nbsp;tricky,&nbsp;but&nbsp;in&nbsp;every&nbsp;case&nbsp;it&nbsp;is&nbsp;worth&nbsp;_trying_&nbsp;to&nbsp;mock/stub/hook&nbsp;the&nbsp;code&nbsp;as&nbsp;it&nbsp;already&nbsp;is&nbsp;to&nbsp;demonstrate&nbsp;it&nbsp;deterministically.&nbsp;&amp;#160;It&nbsp;isn't&nbsp;always&nbsp;possible&nbsp;with&nbsp;a&nbsp;reasonable&nbsp;amount&nbsp;of&nbsp;effort,&nbsp;but&nbsp;very&nbsp;often&nbsp;it&nbsp;is&nbsp;actually&nbsp;quite&nbsp;easy.&nbsp;&amp;#160;As&nbsp;you&nbsp;do&nbsp;it&nbsp;more,&nbsp;it&nbsp;gets&nbsp;easier&nbsp;to&nbsp;figure&nbsp;out&nbsp;the&nbsp;trickier&nbsp;cases.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;In&nbsp;any&nbsp;case,&nbsp;writing&nbsp;a&nbsp;test&nbsp;(which&nbsp;runs&nbsp;quickly)&nbsp;to&nbsp;be&nbsp;used&nbsp;with&nbsp;trial&nbsp;-u&nbsp;is&nbsp;a&nbsp;pretty&nbsp;low&nbsp;bar.&nbsp;&amp;#160;There&nbsp;are&nbsp;some&nbsp;extremely&nbsp;rare&nbsp;cases&nbsp;(mostly&nbsp;involving&nbsp;threading&nbsp;infrastructure)&nbsp;where&nbsp;those&nbsp;tests&nbsp;take&nbsp;a&nbsp;long&nbsp;time&nbsp;to&nbsp;fail,&nbsp;but&nbsp;even&nbsp;there&nbsp;it&nbsp;is&nbsp;usually&nbsp;possible&nbsp;to&nbsp;make&nbsp;them&nbsp;*succeed*&nbsp;reliably.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&amp;gt;Always&nbsp;feel&nbsp;free&nbsp;to&nbsp;file&nbsp;the&nbsp;ticket&nbsp;before&nbsp;figuring&nbsp;any&nbsp;of&nbsp;this&nbsp;out,&nbsp;by&lt;br&nbsp;/&gt;&amp;gt;the&nbsp;way.&nbsp;&amp;#160;It&nbsp;is&nbsp;still&nbsp;possible&nbsp;that&nbsp;it&nbsp;will&nbsp;strike&nbsp;someone&nbsp;else's&nbsp;fancy&lt;br&nbsp;/&gt;&amp;gt;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;work&nbsp;will&nbsp;be&nbsp;taken&nbsp;care&nbsp;of&nbsp;for&nbsp;you.&nbsp;:)&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;And&nbsp;of&nbsp;course&nbsp;this&nbsp;is&nbsp;always&nbsp;true.&lt;br&nbsp;/&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
