<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Oct&nbsp;25,&nbsp;2015,&nbsp;at&nbsp;4:54&nbsp;AM,&nbsp;Jonathan&nbsp;Stoppani&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:jonathan@stoppani.name&quot;&nbsp;class=&quot;&quot;&gt;jonathan@stoppani.name&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;Hello,&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;A&nbsp;couple&nbsp;of&nbsp;days&nbsp;ago&nbsp;I&nbsp;asked&nbsp;on&nbsp;Stack&nbsp;Overflow&nbsp;about&nbsp;returning&nbsp;a&nbsp;deferred&nbsp;from&nbsp;an&nbsp;SNI&nbsp;callback&nbsp;and&nbsp;have&nbsp;pyOpenSSL&nbsp;wait&nbsp;for&nbsp;it&nbsp;to&nbsp;fire&nbsp;before&nbsp;continuing&nbsp;handling&nbsp;the&nbsp;request.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Thanks&nbsp;to&nbsp;some&nbsp;pointers&nbsp;by&nbsp;Gyph&nbsp;I've&nbsp;found&nbsp;a&nbsp;solution&nbsp;(&quot;workaround&quot;)&nbsp;for&nbsp;my&nbsp;problem,&nbsp;involving&nbsp;a&nbsp;fake&nbsp;TLSMemoryBIOProtocol&nbsp;to&nbsp;handle&nbsp;the&nbsp;client&nbsp;hello&nbsp;until&nbsp;the&nbsp;SNI&nbsp;is&nbsp;received,&nbsp;firing&nbsp;the&nbsp;SNI&nbsp;callback,&nbsp;waiting&nbsp;for&nbsp;it&nbsp;to&nbsp;callback&nbsp;and&nbsp;then&nbsp;re-feeding&nbsp;the&nbsp;resulting&nbsp;context&nbsp;to&nbsp;the&nbsp;real&nbsp;TLSMemoryBIOProtocol.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Really&nbsp;glad&nbsp;to&nbsp;hear&nbsp;that&nbsp;this&nbsp;worked.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;The&nbsp;implementation&nbsp;of&nbsp;this&nbsp;solution&nbsp;is&nbsp;available&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;https://gist.github.com/GaretJax/124c523a62ba48c9eec1&quot;&nbsp;class=&quot;&quot;&gt;https://gist.github.com/GaretJax/124c523a62ba48c9eec1&lt;/a&gt;,&nbsp;and&nbsp;I'd&nbsp;like&nbsp;to&nbsp;contribute&nbsp;it&nbsp;back&nbsp;to&nbsp;Twisted,&nbsp;however,&nbsp;it&nbsp;has&nbsp;no&nbsp;unit&nbsp;tests&nbsp;and&nbsp;needs&nbsp;some&nbsp;design&nbsp;decisions/validation.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;also&nbsp;needs&nbsp;a&nbsp;serious&nbsp;overhaul&nbsp;on&nbsp;its&nbsp;indentation&nbsp;-&nbsp;something&nbsp;messed&nbsp;up&nbsp;happened&nbsp;to&nbsp;that&nbsp;code&nbsp;:).&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I've&nbsp;opened&nbsp;a&nbsp;ticket&nbsp;to&nbsp;track&nbsp;it&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;https://twistedmatrix.com/trac/ticket/8065&quot;&nbsp;class=&quot;&quot;&gt;https://twistedmatrix.com/trac/ticket/8065&lt;/a&gt;.&nbsp;Real-life&nbsp;impediments&nbsp;permitting,&nbsp;I'm&nbsp;willing&nbsp;to&nbsp;work&nbsp;on&nbsp;it&nbsp;and&nbsp;get&nbsp;the&nbsp;feature&nbsp;supported&nbsp;in&nbsp;Twisted&nbsp;core.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Thanks!&nbsp;&nbsp;We&nbsp;don't&nbsp;really&nbsp;support&nbsp;an&nbsp;SNI&nbsp;callback&nbsp;at&nbsp;all&nbsp;(that's&nbsp;purely&nbsp;in&nbsp;the&nbsp;pyOpenSSL&nbsp;layer)&nbsp;so&nbsp;this&nbsp;will&nbsp;be&nbsp;very&nbsp;good&nbsp;to&nbsp;have.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Anyone&nbsp;willing&nbsp;to&nbsp;help&nbsp;me&nbsp;getting&nbsp;a&nbsp;proper&nbsp;patch?&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;help&nbsp;do&nbsp;you&nbsp;need?&nbsp;&nbsp;I&nbsp;will&nbsp;be&nbsp;happy&nbsp;to&nbsp;do&nbsp;reviews&nbsp;when&nbsp;it's&nbsp;readye.&nbsp;:)&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;P.S.:&nbsp;A&nbsp;big&nbsp;shout-out&nbsp;to&nbsp;Twisted&nbsp;for&nbsp;its&nbsp;excellent&nbsp;TLS&nbsp;support&nbsp;out&nbsp;of&nbsp;the&nbsp;box.&nbsp;We&nbsp;got&nbsp;a&nbsp;straight&nbsp;A&nbsp;rating&nbsp;out&nbsp;of&nbsp;the&nbsp;box&nbsp;on&nbsp;ssl&nbsp;labs!&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;really&nbsp;glad&nbsp;to&nbsp;hear&nbsp;this!&nbsp;&nbsp;I&nbsp;do&nbsp;plan&nbsp;to&nbsp;quote&nbsp;you&nbsp;on&nbsp;that&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
