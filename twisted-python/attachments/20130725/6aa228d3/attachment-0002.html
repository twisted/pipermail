<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hey&nbsp;all&nbsp;-&lt;br&gt;&lt;br&gt;I&#39;ve&nbsp;recently&nbsp;started&nbsp;working&nbsp;with&nbsp;the&nbsp;&#39;mock&#39;&nbsp;library&nbsp;in&nbsp;our&nbsp;trial&nbsp;tests,&nbsp;and&nbsp;am&nbsp;looking&nbsp;for&nbsp;some&nbsp;best-practice&nbsp;advice. &nbsp;I&#39;m&nbsp;really&nbsp;just&nbsp;starting&nbsp;to&nbsp;get&nbsp;used&nbsp;to&nbsp;the&nbsp;library,&nbsp;so&nbsp;it&nbsp;might&nbsp;well&nbsp;have&nbsp;functionality&nbsp;that&nbsp;I&#39;m&nbsp;unaware&nbsp;of&nbsp;or&nbsp;am&nbsp;misusing.&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;I&nbsp;very&nbsp;quickly&nbsp;ran&nbsp;into&nbsp;a&nbsp;problem&nbsp;where&nbsp;I&nbsp;mistakenly&nbsp;returned&nbsp;a&nbsp;Mock()&nbsp;in&nbsp;the&nbsp;place&nbsp;of&nbsp;a&nbsp;deferred,&nbsp;causing&nbsp;the&nbsp;asserts&nbsp;in&nbsp;callbacks&nbsp;to&nbsp;not&nbsp;be&nbsp;called,&nbsp;and&nbsp;for&nbsp;the&nbsp;test&nbsp;to&nbsp;spuriously&nbsp;pass.&lt;br&gt;<br>
&lt;br&gt;A&nbsp;basic&nbsp;example:&lt;br&gt;&lt;br&gt;def&nbsp;test_foo():&lt;br&gt; &nbsp;d&nbsp;=&nbsp;Mock()&lt;br&gt; &nbsp;def&nbsp;check_result(res):&lt;br&gt; &nbsp; &nbsp;self.assertEqual(res.code,&nbsp;expected)&nbsp; #&nbsp;never&nbsp;called&lt;br&gt; &nbsp;d.addCallback(check_result)&lt;br&gt; &nbsp;return&nbsp;d&nbsp;#&nbsp;Mock&nbsp;is&nbsp;truthy,&nbsp;test&nbsp;passes&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;This&nbsp;occurred&nbsp;where&nbsp;I&nbsp;was&nbsp;mocking&nbsp;some&nbsp;internals&nbsp;of&nbsp;the&nbsp;class&nbsp;under&nbsp;test;&nbsp;something&nbsp;like&nbsp;the&nbsp;below&lt;br&gt;&lt;br&gt;A&nbsp;slightly&nbsp;more&nbsp;believable&nbsp;example:&lt;br&gt;==&nbsp;myclass.py&nbsp;==&lt;br&gt;def&nbsp;some_function(...):&lt;br&gt; &nbsp;d&nbsp;=&nbsp;self.authenticate()&lt;br&gt;<br>
<br>
<br>
 &nbsp;d.addCallback(foo)&nbsp;#&nbsp;foo&nbsp;never&nbsp;called&lt;br&gt; &nbsp;d.addErrback(bar)&nbsp;#&nbsp;bar&nbsp;never&nbsp;called&lt;br&gt; &nbsp;return&nbsp;d&lt;br&gt;&lt;br&gt;==&nbsp;test_myclass.py&nbsp;==&lt;br&gt;def&nbsp;setUp(self):&lt;br&gt; &nbsp;self.resource.authenticate&nbsp;=&nbsp;Mock(return_value=Mock())&lt;br&gt;&lt;br&gt;def&nbsp;test_foo():&lt;br&gt;<br>
<br>
<br>
 &nbsp;d&nbsp;=&nbsp;self.resource.some_function&lt;br&gt; &nbsp;def&nbsp;check_result(res):&nbsp; #&nbsp;never&nbsp;called&lt;br&gt; &nbsp; &nbsp;self.assertEqual(res.code,&nbsp;expected)&nbsp;&lt;br&gt; &nbsp;d.addCallback(check_result)&lt;br&gt; &nbsp;return&nbsp;d&nbsp;#&nbsp;test&nbsp;passes&lt;br&gt;&lt;br&gt;Currently,&nbsp;I&#39;m&nbsp;experimenting&nbsp;with&nbsp;wrapping&nbsp;Mock&nbsp;instantiations&nbsp;by&nbsp;defining&nbsp;common&nbsp;deferred&nbsp;methods&nbsp;on&nbsp;them&nbsp;in&nbsp;advance;&nbsp;this&nbsp;approach&nbsp;would&nbsp;eventually&nbsp;lead&nbsp;to&nbsp;extending&nbsp;Mock&nbsp;itself&nbsp;with&nbsp;this&nbsp;functionality.&nbsp;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;def&nbsp;nonDeferredMock():&lt;br&gt;&lt;/div&gt;   &nbsp;m&nbsp;=&nbsp;Mock()&lt;br&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;notimpl(*args,&nbsp;**kwargs):&lt;br&gt;   &nbsp; &nbsp; &nbsp;raise&nbsp;NotImplementedError(&#39;You&nbsp;treated&nbsp;a&nbsp;Mock&nbsp;like&nbsp;a&nbsp;Deferred!&#39;)&lt;br&gt; &nbsp; &nbsp;m.addCallback&nbsp;=&nbsp;notimpl&lt;br&gt; &nbsp; &nbsp;m.addErrback&nbsp;=&nbsp;notimpl&lt;br&gt;<br>
<br>
<br>
   &nbsp;m.addBoth&nbsp;=&nbsp;notimpl&lt;br&gt;   &nbsp;m.addCallbacks&nbsp;=&nbsp;notimpl&lt;br&gt;&lt;/div&gt;&lt;div&gt;   &nbsp;return&nbsp;m&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Another&nbsp;approach&nbsp;might&nbsp;be&nbsp;extending&nbsp;TestCase&nbsp;to&nbsp;check&nbsp;that&nbsp;return&nbsp;values&nbsp;are&nbsp;always&nbsp;not&nbsp;Mock&nbsp;objects.&nbsp;&lt;br&gt;&lt;br&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&gt;Does&nbsp;anyone&nbsp;on&nbsp;the&nbsp;list&nbsp;have&nbsp;experience&nbsp;with&nbsp;this?&nbsp;Obviously,&nbsp;this&nbsp;only&nbsp;happens&nbsp;when&nbsp;mistakes&nbsp;are&nbsp;made&nbsp;when&nbsp;writing&nbsp;tests,&nbsp;but&nbsp;I&#39;d&nbsp;rather&nbsp;have&nbsp;confidence&nbsp;that&nbsp;when&nbsp;my&nbsp;tests&nbsp;pass,&nbsp;that&nbsp;they&#39;ve&nbsp;passed&nbsp;for&nbsp;the&nbsp;right&nbsp;reasons.&nbsp;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Another&nbsp;antipattern&nbsp;that&nbsp;I&#39;ve&nbsp;come&nbsp;across&nbsp;has&nbsp;been:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;resource.mymethod&nbsp;=&nbsp;Mock(return_value=defer.succeed(None))&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;which&nbsp;works&nbsp;fine&nbsp;for&nbsp;tests&nbsp;in&nbsp;which&nbsp;mymethod()&nbsp;is&nbsp;called&nbsp;once,&nbsp;but&nbsp;always&nbsp;returns&nbsp;the&nbsp;same&nbsp;deferred&nbsp;object&nbsp;if&nbsp;multiple&nbsp;calls&nbsp;are&nbsp;made.&nbsp;What&nbsp;would&nbsp;be&nbsp;a&nbsp;better&nbsp;approach?&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers-&nbsp;&lt;br&gt;&lt;br&gt;James&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
