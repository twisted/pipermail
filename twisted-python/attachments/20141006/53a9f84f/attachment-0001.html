<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=windows-1252&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;Folks,&lt;br&gt;&lt;br&gt;I’m&nbsp;writing&nbsp;an&nbsp;client&nbsp;using&nbsp;twisted,&nbsp;and&nbsp;I’m&nbsp;basing&nbsp;it&nbsp;off&nbsp;the&nbsp;Poetry&nbsp;client&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://krondo.com/wp-content/uploads/2009/08/twisted-intro.html&quot;&gt;http://krondo.com/wp-content/uploads/2009/08/twisted-intro.html&lt;/a&gt;.&lt;br&gt;I&nbsp;am&nbsp;porting&nbsp;a&nbsp;previous&nbsp;pyserial&nbsp;based&nbsp;client,&nbsp;so&nbsp;I’m&nbsp;running&nbsp;into&nbsp;new&nbsp;territory&nbsp;here.&lt;br&gt;&lt;br&gt;And&nbsp;it’s&nbsp;working&nbsp;fine,&nbsp;there&nbsp;are&nbsp;two&nbsp;“issues&quot;&nbsp;that&nbsp;I&nbsp;am&nbsp;running&nbsp;into.&lt;br&gt;&lt;br&gt;class&nbsp;WT_Protocol(Protocol):&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;tag&nbsp;=&nbsp;''&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;def&nbsp;to_bytes(self,&nbsp;seq):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;convert&nbsp;a&nbsp;sequence&nbsp;to&nbsp;a&nbsp;bytes&nbsp;type&quot;&quot;&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;from&nbsp;pyserial.util&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isinstance(seq,&nbsp;bytes):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;seq&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;isinstance(seq,&nbsp;bytearray):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bytes(seq)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;isinstance(seq,&nbsp;memoryview):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;seq.tobytes()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;bytearray()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;item&nbsp;in&nbsp;seq:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.append(item)&nbsp;&nbsp;#&nbsp;this&nbsp;one&nbsp;handles&nbsp;int&nbsp;and&nbsp;str&nbsp;for&nbsp;our&nbsp;emulation&nbsp;and&nbsp;ints&nbsp;for&nbsp;Python&nbsp;3.x&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bytes(b)&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;def&nbsp;connectionMade(self):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Reseting&nbsp;the&nbsp;network&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reset&nbsp;=&nbsp;self.to_bytes(packets.network_reset()&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.transport.write&nbsp;(&nbsp;reset&nbsp;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.transport.write&nbsp;(&nbsp;self.to_bytes(packets.Set_SiteCode(NodeID=255,&nbsp;SC1=0,&nbsp;SC2=0,&nbsp;SC3=0)&nbsp;))&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.transport.write&nbsp;(&nbsp;self.to_bytes(packets.Set_Gain_Packet(NodeID=255,&nbsp;Gain=1)&nbsp;))&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;high&nbsp;gain&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.transport.write&nbsp;(&nbsp;self.to_bytes(packets.Set_Protocol_No_Nulls&nbsp;(NetworkID=0,&nbsp;ReceiverID=0,&nbsp;NodeID=1)&nbsp;))&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;high&nbsp;gain&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep&nbsp;(.5)&lt;br&gt;&lt;br&gt;Now&nbsp;the&nbsp;client&nbsp;works&nbsp;right&nbsp;now,&nbsp;but&nbsp;I’m&nbsp;concerned&nbsp;that&nbsp;I&nbsp;can’t&nbsp;figure&nbsp;out&nbsp;how&nbsp;to&nbsp;immediately&nbsp;read&nbsp;for&nbsp;a&nbsp;reply&nbsp;packet&nbsp;from&nbsp;the&nbsp;server.&lt;br&gt;&lt;br&gt;For&nbsp;example,&nbsp;when&nbsp;I&nbsp;send&nbsp;the&nbsp;Set_SiteCode&nbsp;packet,&nbsp;I&nbsp;may&nbsp;receive&nbsp;a&nbsp;reply.&nbsp;&nbsp;&lt;br&gt;&lt;br&gt;But&nbsp;how&nbsp;would&nbsp;that&nbsp;occur&nbsp;in&nbsp;the&nbsp;Twisted&nbsp;framework?&nbsp;&nbsp;In&nbsp;my&nbsp;testing&nbsp;the&nbsp;dataReceived&nbsp;function&nbsp;is&nbsp;not&nbsp;being&nbsp;called,&nbsp;so&nbsp;I&nbsp;can’t&nbsp;trap&nbsp;it&nbsp;there,&nbsp;plus&nbsp;I’m&nbsp;not&nbsp;sure&nbsp;how&nbsp;I&nbsp;would&nbsp;figure&nbsp;that&nbsp;logic.&lt;br&gt;&lt;br&gt;Can&nbsp;anyone&nbsp;suggest&nbsp;a&nbsp;method&nbsp;to&nbsp;do&nbsp;this?&lt;br&gt;&lt;br&gt;The&nbsp;second&nbsp;question,&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;tell,&nbsp;isn’t&nbsp;very&nbsp;solvable.&nbsp;&nbsp;I’d&nbsp;like&nbsp;to&nbsp;add&nbsp;a&nbsp;“Press&nbsp;Q&nbsp;to&nbsp;quit”&nbsp;type&nbsp;logic&nbsp;to&nbsp;the&nbsp;code.&nbsp;&nbsp;But&nbsp;I&nbsp;don’t&nbsp;see&nbsp;a&nbsp;way&nbsp;to&nbsp;do&nbsp;this&nbsp;easily&nbsp;in&nbsp;twisted?&nbsp;&nbsp;(platform&nbsp;unspecific,&nbsp;but&nbsp;it’s&nbsp;running&nbsp;Mac&nbsp;OS&nbsp;X&nbsp;/&nbsp;Unix&nbsp;right&nbsp;now).&lt;br&gt;&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;-&nbsp;Ben&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
