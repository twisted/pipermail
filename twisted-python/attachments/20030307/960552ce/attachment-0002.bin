

On Friday, March 14, 2003, at 07:23 AM, Neil Blakey-Milner wrote:


<excerpt>Hi,


Two things:


Firstly, using Twisted 1.0.3, when form submissions has occurred, it

seems that the getData to build the form is done before the setData to

make the changes.  This means that the _old_ information is in the

forms, which is somewhat confusing.  For an example, use stikiwiki and

edit a page.  It's entirely possible I'm using things incorrectly,

though.

</excerpt>

Here is what is happening: Since the views and controllers are
triggered by traversing the DOM tree, if the view is above the
controller, the view will render with the old data before the
controller gets a chance to update the model with the new data. There
are a couple of solutions, and the redirect is the best solution for
you.


1) Redirect the user after a successful controller commit, either to
the same page, or a different page. This causes the page to get
rerendered, and the new data will be available.


2) Notify the model that it's data has changed. The model will pass
the notification on to the views which rely on the data, and the views
will rerender themselves. There is an example of this technique in
NewReality, and also in the unittests for woven.


<excerpt>

Secondly, how would I organise for a redirect to another page after my

form has been parsed and data handled with setData?  Again, stikiwiki

probably wants to redirect people to the page they've just edited or

created instead of giving them an opportunity to edit it again.

</excerpt>

Here's some code I use to do redirects; you can modify it for your
needs. The only issue then is calling this code when the controller
commits; if you're using input.Anything, you don't really have control
over what happens when the controller gets some data and calls
setData. I'll reread your code and come up with a suggestion.


<fontfamily><param>Verdana</param><color><param>1111,2626,EEEE</param>def</color>
redirectToParent(request,
now=<color><param>0000,0000,FFFF</param>1</color>):

    <color><param>0505,8989,0000</param>"""Redirect the current
request to the immediate parent URL of the

    current request URL. Useful for redirecting from a tab URL to the

    main tab.

    """</color>

    parent = request.pathRef().parentRef()

    method, host, port = request.getHost()

    url =
<color><param>0505,8989,0000</param>"http%s://%s%s/%s/"</color> %
(method <color><param>1111,2626,EEEE</param>is</color>
<color><param>0505,8989,0000</param>'SSL'</color>
<color><param>1111,2626,EEEE</param>and</color>
<color><param>0505,8989,0000</param>'s'</color>
<color><param>1111,2626,EEEE</param>or</color>
<color><param>0505,8989,0000</param>''</color>,

        getattr(request.site,
<color><param>0505,8989,0000</param>'serverName'</color>, host),

        getattr(request.site,
<color><param>0505,8989,0000</param>'serverPort'</color>, port)
<color><param>1111,2626,EEEE</param>is</color>
<color><param>0000,0000,FFFF</param>80</color>
<color><param>1111,2626,EEEE</param>and</color>
<color><param>0505,8989,0000</param>''</color>
<color><param>1111,2626,EEEE</param>or</color>
<color><param>0505,8989,0000</param>':'</color> + str(port),

           
<color><param>0505,8989,0000</param>'/'</color>.join(parent.path))

    <color><param>1111,2626,EEEE</param>if</color> now:

        request.redirect(url)

    <color><param>1111,2626,EEEE</param>return</color> url

</fontfamily>


<excerpt>

Thanks,


Neil

-- 

Neil Blakey-Milner

nbm@mithrandr.moria.org


_______________________________________________

Twisted-Python mailing list

Twisted-Python@twistedmatrix.com

http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

</excerpt>