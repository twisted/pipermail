<tt>
&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;2006/10/18,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:exarkun@divmod.com&quot;&gt;exarkun@divmod.com&lt;/a&gt;&amp;gt;:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
On&nbsp;Tue,&nbsp;17&nbsp;Oct&nbsp;2006&nbsp;22:51:55&nbsp;-0200,&nbsp;Felipe&nbsp;Almeida&nbsp;Lessa&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:felipe.lessa@gmail.com&quot;&gt;felipe.lessa@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&amp;gt;2006/10/17,&nbsp;Franz&nbsp;Zieher&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:franz.zieher@gmail.com&quot;&gt;franz.zieher@gmail.com<br>
&lt;/a&gt;&amp;gt;:&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;Can&nbsp;anybody&nbsp;provide&nbsp;a&nbsp;an&nbsp;example&nbsp;on&nbsp;how&nbsp;I&nbsp;would&nbsp;best&nbsp;send&lt;br&gt;&amp;gt;&amp;gt;a&nbsp;data&nbsp;structure&nbsp;(i.e.&nbsp;an&nbsp;ElemenTree&nbsp;from&nbsp;elementtree)&nbsp;over&nbsp;from&lt;br&gt;&amp;gt;&amp;gt;a&nbsp;server&nbsp;to&nbsp;a&nbsp;client&nbsp;process.&nbsp;I&nbsp;followed&nbsp;somewhat&nbsp;the&nbsp;example&nbsp;in<br>
&lt;br&gt;&amp;gt;&amp;gt;the&nbsp;documentation&nbsp;and&nbsp;used&nbsp;the&nbsp;perspective&nbsp;broker&nbsp;&amp;quot;pb&amp;quot;&nbsp;to&nbsp;send&lt;br&gt;&amp;gt;&amp;gt;an&nbsp;&amp;quot;simple&amp;quot;&nbsp;structure&nbsp;(some&nbsp;class&nbsp;with&nbsp;simple&nbsp;members)&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;When&nbsp;I&nbsp;changed&nbsp;to&nbsp;a&nbsp;more&nbsp;complex&nbsp;class&nbsp;definition,&nbsp;I&nbsp;obviously&nbsp;got<br>
&lt;br&gt;&amp;gt;&amp;gt;an&nbsp;InsecureJelly&nbsp;exception.&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;I'm&nbsp;sure&nbsp;this&nbsp;question&nbsp;must&nbsp;have&nbsp;come&nbsp;up&nbsp;a&nbsp;number&nbsp;of&nbsp;times.&nbsp;I'm&nbsp;new&lt;br&gt;&amp;gt;&amp;gt;in&nbsp;using&nbsp;twisted&nbsp;and&nbsp;not&nbsp;everything&nbsp;is&nbsp;so&nbsp;obvious&nbsp;at&nbsp;the&nbsp;beginning&nbsp;to&nbsp;me&lt;br&gt;&amp;gt;&amp;gt;:-(<br>
&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;I&nbsp;don't&nbsp;know&nbsp;if&nbsp;it&nbsp;may&nbsp;help&nbsp;you,&nbsp;but&nbsp;I&nbsp;think&nbsp;you&nbsp;should&nbsp;take&nbsp;a&nbsp;look&nbsp;at&lt;br&gt;&amp;gt;Cerealizer&nbsp;(&nbsp;&lt;a&nbsp;href=&quot;http://home.gna.org/oomadness/en/cerealizer/index.html&quot;&gt;http://home.gna.org/oomadness/en/cerealizer/index.html<br>
&lt;/a&gt;&nbsp;)&lt;br&gt;&amp;gt;&lt;br&gt;&lt;br&gt;Using&nbsp;this&nbsp;together&nbsp;with&nbsp;PB&nbsp;would&nbsp;probably&nbsp;be&nbsp;counterproductive.&lt;br&gt;&lt;br&gt;Jean-Paul&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;<br>
Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;the&nbsp;help.&nbsp;I&nbsp;opted&nbsp;for&nbsp;Jean-Pauls&nbsp;suggestion.<br>
&lt;br&gt;It&nbsp;really&nbsp;allows&nbsp;for&nbsp;such&nbsp;a&nbsp;simple&nbsp;data&nbsp;transfer&nbsp;between&nbsp;a&nbsp;server&lt;br&gt;and&nbsp;a&nbsp;client.&nbsp;I&nbsp;included&nbsp;a&nbsp;compressed&nbsp;string.&nbsp;It&nbsp;very&nbsp;likely&nbsp;misses&lt;br&gt;a&nbsp;number&nbsp;of&nbsp;details,&nbsp;I&nbsp;post&nbsp;the&nbsp;changes&nbsp;again.&nbsp;Maybe&nbsp;it&nbsp;is&nbsp;helpful&lt;br&gt;for&nbsp;somebody&nbsp;else.<br>
&lt;br&gt;&lt;br&gt;Franz&nbsp;:-)&lt;br&gt;&lt;br&gt;-----------&nbsp;pbsimple.py&lt;br&gt;&lt;br&gt;from&nbsp;twisted.spread&nbsp;import&nbsp;pb,&nbsp;jelly&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;import&nbsp;elementtree.ElementTree&nbsp;as&nbsp;ET&lt;br&gt;from&nbsp;path&nbsp;import&nbsp;path&lt;br&gt;import&nbsp;os,&nbsp;pickle&lt;br&gt;<br>
from&nbsp;StringIO&nbsp;import&nbsp;StringIO&lt;br&gt;from&nbsp;zlib&nbsp;import&nbsp;compress&lt;br&gt;&lt;br&gt;class&nbsp;test:&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;__init__(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;x&nbsp;=&nbsp;3.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;y&nbsp;=&nbsp;4.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;data&nbsp;=&nbsp;ET.ElementTree()&lt;br&gt;&lt;br&gt;class&nbsp;Bag:&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;setContent(self,content):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;content&nbsp;must&nbsp;be&nbsp;serializable<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;s_content&nbsp;=&nbsp;StringIO()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;pickle.dump(content,s_content)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;s_content.flush()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.content&nbsp;=&nbsp;compress(s_content.getvalue())&lt;br&gt;&lt;br&gt;class&nbsp;CopyBag(Bag,&nbsp;pb.Copyable):&lt;br&gt;&amp;nbsp;&nbsp;pass&lt;br&gt;&lt;br&gt;class&nbsp;Sender(pb.Root<br>
):&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;bag):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.bag&nbsp;=&nbsp;bag&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;remote_sendBag(self,&nbsp;remote):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.remote&nbsp;=&nbsp;remote&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d&nbsp;=&nbsp;remote.callRemote(&amp;quot;takeBag&amp;quot;,&nbsp;self.bag)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d.addCallback(self.ok).addErrback(<br>
self.notOk)&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;ok(self,&nbsp;response):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;info:&nbsp;%s&amp;quot;&nbsp;%&nbsp;response&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d&nbsp;=&nbsp;self.remote.callRemote(&amp;quot;finishTransfer&amp;quot;)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;d.addErrback(self.notOk)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;None&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;notOk(self,&nbsp;failure):<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;failure.type&nbsp;==&nbsp;jelly.InsecureJelly:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;error:&nbsp;InsecureJelly&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;elif&nbsp;failure.type&nbsp;==&nbsp;pb.PBConnectionLost:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;info:&nbsp;data&nbsp;transfer&nbsp;finished&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;failure<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;None&lt;br&gt;&lt;br&gt;def&nbsp;main():&lt;br&gt;&amp;nbsp;&nbsp;from&nbsp;pbsimple&nbsp;import&nbsp;CopyBag&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;icae&nbsp;=&nbsp;iCAEconfig()&lt;br&gt;&amp;nbsp;&nbsp;bag&nbsp;=&nbsp;CopyBag()&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;bag.setContent(test())&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&nbsp;sender&nbsp;=&nbsp;Sender(bag)&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;factory&nbsp;=&nbsp;pb.PBServerFactory<br>
(sender)&lt;br&gt;&amp;nbsp;&nbsp;reactor.listenTCP(8789,&nbsp;factory)&lt;br&gt;&amp;nbsp;&nbsp;reactor.run()&lt;br&gt;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;'__main__':&lt;br&gt;&amp;nbsp;&nbsp;main()&lt;br&gt;&lt;br&gt;-----&nbsp;pbsimpleclient.py&lt;br&gt;&lt;br&gt;from&nbsp;twisted.spread&nbsp;import&nbsp;pb&lt;br&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;<br>
from&nbsp;twisted.python&nbsp;import&nbsp;util&lt;br&gt;import&nbsp;os,&nbsp;pickle&lt;br&gt;from&nbsp;StringIO&nbsp;import&nbsp;StringIO&lt;br&gt;from&nbsp;zlib&nbsp;import&nbsp;decompress&lt;br&gt;import&nbsp;elementtree.ElementTree&nbsp;as&nbsp;ET&lt;br&gt;&lt;br&gt;from&nbsp;pbsimple&nbsp;import&nbsp;Bag,&nbsp;CopyBag,&nbsp;test&lt;br&gt;&lt;br&gt;class&nbsp;ReceiverBag(Bag,<br>
pb.RemoteCopy):&lt;br&gt;&amp;nbsp;&nbsp;pass&lt;br&gt;&lt;br&gt;pb.setUnjellyableForClass(CopyBag,&nbsp;ReceiverBag)&lt;br&gt;&lt;br&gt;class&nbsp;Receiver(pb.Referenceable):&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;remote_takeBag(self,&nbsp;bag):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;deserialize&nbsp;the&nbsp;bag.content&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;try:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.content<br>
&nbsp;=&nbsp;pickle.loads(decompress(bag.content))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.len&nbsp;=&nbsp;len(bag.content)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;&amp;quot;data&nbsp;arrived&nbsp;safe&nbsp;and&nbsp;sound&amp;quot;&nbsp;#&nbsp;positive&nbsp;acknowledgement&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;except:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.content&nbsp;=&nbsp;None&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;self.len<br>
&nbsp;=&nbsp;0&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;error:&nbsp;data&nbsp;could&nbsp;not&nbsp;be&nbsp;de-serialized&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.stop()&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;remote_finishTransfer(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;got&nbsp;bag&nbsp;of&nbsp;length:&amp;quot;,&nbsp;self.len&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.stop()&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;def&nbsp;requestBag(self,remote):<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;asking&nbsp;server&nbsp;for&nbsp;sending&nbsp;the&nbsp;data&nbsp;bag&amp;quot;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;remote.callRemote(&amp;quot;sendBag&amp;quot;,self)&lt;br&gt;&lt;br&gt;def&nbsp;getContentFromServer():&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;receiver&nbsp;=&nbsp;Receiver()&lt;br&gt;&amp;nbsp;&nbsp;factory&nbsp;=&nbsp;pb.PBClientFactory()&lt;br&gt;<br>
&amp;nbsp;&nbsp;reactor.connectTCP(&amp;quot;localhost&amp;quot;,&nbsp;8789,&nbsp;factory,30)&lt;br&gt;&amp;nbsp;&nbsp;d&nbsp;=&nbsp;factory.getRootObject()&lt;br&gt;&amp;nbsp;&nbsp;d.addCallback(receiver.requestBag)&lt;br&gt;&amp;nbsp;&nbsp;reactor.run()&lt;br&gt;&amp;nbsp;&nbsp;return&nbsp;receiver.content&lt;br&gt;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;'__main__':&lt;br&gt;&amp;nbsp;&nbsp;content&nbsp;=&nbsp;getContentFromServer()<br>
&lt;br&gt;&amp;nbsp;&nbsp;if&nbsp;hasattr(content,'getroot'):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ET.dump(content)&lt;br&gt;&amp;nbsp;&nbsp;else:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;content&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;/span&gt;<br>

</tt>
