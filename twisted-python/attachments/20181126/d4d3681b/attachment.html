<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Forgot&nbsp;to&nbsp;include&nbsp;the&nbsp;list&nbsp;in&nbsp;my&nbsp;reply...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;On&nbsp;23/11/2018&nbsp;22:27,&nbsp;Chris&nbsp;Withers<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:6f5af07a-8355-d6ed-f2a5-50db0e4ab42a@withers.org&quot;&gt;On<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;23/11/2018&nbsp;22:22,&nbsp;Glyph&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;Nov&nbsp;23,&nbsp;2018,&nbsp;at&nbsp;7:58&nbsp;AM,&nbsp;Chris<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Withers&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:chris@withers.org&quot;&gt;&lt;chris@withers.org&gt;&lt;/a&gt;&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;All,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;trial&nbsp;do&nbsp;anything&nbsp;to&nbsp;clean&nbsp;up&nbsp;stuff&nbsp;that's&nbsp;been&nbsp;passed&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deferToThread?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nope.Â &nbsp;It&nbsp;does&nbsp;its&nbsp;best&nbsp;to&nbsp;clean&nbsp;up&nbsp;stuff&nbsp;that&nbsp;it&nbsp;knows&nbsp;is&nbsp;&quot;in&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;reactor&nbsp;(sockets,&nbsp;timers,&nbsp;and&nbsp;the&nbsp;like),&nbsp;but&nbsp;since&nbsp;threads<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;can&nbsp;kind&nbsp;of&nbsp;do&nbsp;~whatever~&nbsp;there&nbsp;hasn't&nbsp;been&nbsp;support&nbsp;for&nbsp;that.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actually,&nbsp;looks&nbsp;like&nbsp;there's&nbsp;stuff&nbsp;in&nbsp;trial's&nbsp;Janitor&nbsp;class,&nbsp;but<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;only&nbsp;kicks&nbsp;in&nbsp;after&nbsp;the&nbsp;suite&nbsp;is&nbsp;finished,&nbsp;and&nbsp;I'm&nbsp;seeing<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;leakage&nbsp;between&nbsp;tests&nbsp;within&nbsp;a&nbsp;suite...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;deferToThread&nbsp;is&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;special&nbsp;case<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;you&nbsp;make&nbsp;a&nbsp;good&nbsp;point&nbsp;here:&nbsp;there&nbsp;should&nbsp;probably&nbsp;be&nbsp;special<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;support&nbsp;for&nbsp;it&nbsp;in&nbsp;trial.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...which&nbsp;I&nbsp;plan&nbsp;to&nbsp;add&nbsp;in&nbsp;carly&nbsp;in&nbsp;the&nbsp;meantime:&nbsp;basically&nbsp;block<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;a&nbsp;timeout&nbsp;on&nbsp;everything&nbsp;in&nbsp;the&nbsp;threadpool&nbsp;finishing&nbsp;it's<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;work.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Speaking&nbsp;of&nbsp;which,&nbsp;I'm&nbsp;happy&nbsp;with&nbsp;how&nbsp;carly&nbsp;is&nbsp;turning&nbsp;out,&nbsp;but<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;would&nbsp;still&nbsp;welcome&nbsp;feedback,&nbsp;particularly&nbsp;on&nbsp;how&nbsp;the&nbsp;tests&nbsp;suites<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;feel:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://github.com/cjw296/carly/tree/master/tests&quot;&gt;https://github.com/cjw296/carly/tree/master/tests&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;don't&nbsp;read&nbsp;hook.py&nbsp;unless&nbsp;you&nbsp;like&nbsp;head-bendy&nbsp;code&nbsp;;-)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Okay,&nbsp;so&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
href=&quot;https://github.com/cjw296/carly/commit/71a1d2bfd501f5c561712c75253fc23c28c3bba7#diff-3670fb1f3b913f6c1ec584fa64302c2dR17&quot;&gt;here's<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;what&nbsp;I&nbsp;came&nbsp;up&nbsp;with&lt;/a&gt;.&nbsp;I'm&nbsp;not&nbsp;a&nbsp;fan&nbsp;of&nbsp;the&nbsp;sleep&nbsp;/&nbsp;busy&nbsp;loop<br>
&nbsp;&nbsp;&nbsp;&nbsp;pattern,&nbsp;but&nbsp;twisted&nbsp;makes&nbsp;it&nbsp;prettymuch&nbsp;impossible&nbsp;to&nbsp;get&nbsp;hold&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;ThreadWorkers&nbsp;queue,&nbsp;so&nbsp;that&nbsp;I&nbsp;could&nbsp;block&nbsp;on&nbsp;them&nbsp;in&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;method.&nbsp;Any&nbsp;ideas&nbsp;on&nbsp;improvements&nbsp;would&nbsp;be&nbsp;very&nbsp;welcome!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cheers,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Chris&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
