<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Dec&nbsp;21,&nbsp;2011,&nbsp;at&nbsp;9:52&nbsp;PM,&nbsp;bino&nbsp;oetomo&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;Dear&nbsp;All&nbsp;..&lt;br&gt;&lt;br&gt;A&nbsp;year&nbsp;ago,&nbsp;I&nbsp;need&nbsp;send&nbsp;some&nbsp;defined&nbsp;message&nbsp;to&nbsp;a&nbsp;jabber&nbsp;conference.&lt;br&gt;The&nbsp;message&nbsp;content&nbsp;will&nbsp;depend&nbsp;on&nbsp;a&nbsp;&quot;button-press&quot;.&lt;br&gt;My&nbsp;trick&nbsp;is&nbsp;to&nbsp;use&nbsp;ttyctrl&nbsp;(&lt;a&nbsp;href=&quot;http://ttyctrl.sourceforge.net/&quot;&gt;http://ttyctrl.sourceforge.net/&lt;/a&gt;).&lt;br&gt;&lt;br&gt;So&nbsp;basicaly&nbsp;my&nbsp;&quot;system&quot;&nbsp;is&nbsp;builded&nbsp;from&nbsp;several&nbsp;parts:&lt;br&gt;1.&nbsp;TTYCTRL&nbsp;:&nbsp;I&nbsp;made&nbsp;some&nbsp;small&nbsp;python&nbsp;XMLRPC&nbsp;client&nbsp;script,&nbsp;that&nbsp;will&nbsp;&lt;br&gt;send&nbsp;a&nbsp;msg&nbsp;to&nbsp;my&nbsp;local&nbsp;twisted&nbsp;server&lt;br&gt;2.&nbsp;Twisted&nbsp;server,&nbsp;contain&nbsp;:&lt;br&gt;a.&nbsp;an&nbsp;XMLRPC&nbsp;server&lt;br&gt;b.&nbsp;XMPP&nbsp;Client&nbsp;...&nbsp;use&nbsp;to&nbsp;send&nbsp;msg&nbsp;to&nbsp;remote&nbsp;jabber&nbsp;conference&nbsp;room&lt;br&gt;&lt;br&gt;I&nbsp;made&nbsp;a&nbsp;pastebin&nbsp;of&nbsp;that&nbsp;twisted&nbsp;script&nbsp;at&nbsp;:&nbsp;&lt;a&nbsp;href=&quot;http://pastebin.com/iSRVZNwS&quot;&gt;http://pastebin.com/iSRVZNwS&lt;/a&gt;&lt;br&gt;&lt;br&gt;With&nbsp;that&nbsp;script&nbsp;the&nbsp;flow&nbsp;alway&nbsp;one-way&nbsp;only&nbsp;:&lt;br&gt;serial====&amp;gt;Twisted_XMLRPC---&amp;gt;Twisted_XMPP=====&amp;gt;Jaber&lt;br&gt;&lt;br&gt;Now&nbsp;I&nbsp;need&nbsp;to&nbsp;do&nbsp;something&nbsp;different,&nbsp;since&nbsp;it's&nbsp;hard&nbsp;to&nbsp;find&nbsp;a&nbsp;Board&nbsp;&lt;br&gt;with&nbsp;RS232&nbsp;onboard.&lt;br&gt;I&nbsp;Need&nbsp;to&nbsp;replace&nbsp;TTYCTRL&nbsp;with&nbsp;Arduino&nbsp;MCU.&lt;br&gt;Arduino&nbsp;will&nbsp;Send&nbsp;serial&nbsp;data&nbsp;to&nbsp;my&nbsp;PC.&lt;br&gt;So&nbsp;I'll&nbsp;need&nbsp;my&nbsp;twisted&nbsp;to&nbsp;able&nbsp;to&nbsp;receive&nbsp;data&nbsp;via&nbsp;serial&lt;br&gt;There&nbsp;will&nbsp;also&nbsp;incoming&nbsp;XMPP&nbsp;msg&nbsp;from&nbsp;Jabber&nbsp;that&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;send&nbsp;&lt;br&gt;to&nbsp;arduino&nbsp;via&nbsp;Serial&nbsp;port.&lt;br&gt;&lt;br&gt;so&nbsp;the&nbsp;flow&nbsp;will&nbsp;be&nbsp;like&nbsp;:&lt;br&gt;serial&amp;lt;====&amp;gt;Twisted_Serial&amp;lt;---&amp;gt;Twisted_XMPP&amp;lt;=====&amp;gt;Jaber&lt;br&gt;&lt;br&gt;&lt;br&gt;My&nbsp;question&nbsp;is,&nbsp;How&nbsp;to&nbsp;make&nbsp;:&lt;br&gt;1.&nbsp;twisted.internet.serial&nbsp;to&nbsp;send&nbsp;data&nbsp;via&nbsp;an&nbsp;instance&nbsp;of&nbsp;XMPP&nbsp;client&nbsp;?&nbsp;and&lt;br&gt;2.&nbsp;my&nbsp;EchobotProtocol.onMessage&nbsp;(see&nbsp;pastebin),&nbsp;to&nbsp;write&nbsp;data&nbsp;to&nbsp;the&nbsp;&lt;br&gt;same&nbsp;serial&nbsp;port&nbsp;used&nbsp;by&nbsp;Point#1&nbsp;above.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;a&nbsp;relevant&nbsp;FAQ&nbsp;for&nbsp;this&nbsp;situation:&lt;/div&gt;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions%23HowdoImakeinputononeconnectionresultinoutputonanother&quot;&gt;http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother&lt;/a&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;More&nbsp;specifically:&lt;/div&gt;&lt;div&gt;1.&nbsp;Create&nbsp;a&nbsp;Protocol&nbsp;class&nbsp;for&nbsp;your&nbsp;SerialPort&nbsp;that&nbsp;will&nbsp;communicate&nbsp;with&nbsp;the&nbsp;Arduino.&nbsp;Instances&nbsp;of&nbsp;this&nbsp;class&nbsp;will&nbsp;have&nbsp;access&nbsp;to&nbsp;the&nbsp;serial&nbsp;transport&nbsp;and&nbsp;can&nbsp;write&nbsp;out&nbsp;to&nbsp;the&nbsp;serial&nbsp;port.&nbsp;Incoming&nbsp;messages&nbsp;from&nbsp;the&nbsp;Arduino&nbsp;will&nbsp;be&nbsp;handled&nbsp;by&nbsp;the&nbsp;dataReceived&nbsp;method&nbsp;of&nbsp;the&nbsp;protocol.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;Give&nbsp;your&nbsp;EchoBotProtocol&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;SerialPort&nbsp;somehow&nbsp;(e.g.&nbsp;via&nbsp;init),&nbsp;and&nbsp;set&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;EchoBotProtocol&nbsp;on&nbsp;the&nbsp;SerialPort.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here's&nbsp;a&nbsp;quick&nbsp;sketch:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#&nbsp;Basic&nbsp;line&nbsp;receiver&nbsp;protocol&lt;/div&gt;&lt;div&gt;class&nbsp;ArduinoReceiver(LineReceiver):&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;def&nbsp;lineReceived(self,&nbsp;line):&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;print&nbsp;&quot;Line&nbsp;Received&nbsp;from&nbsp;Arduino&quot;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;self.echobot.send('some&nbsp;xmpp&nbsp;message&nbsp;for&nbsp;which&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;the&nbsp;format')&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;#&nbsp;Wire&nbsp;up&nbsp;the&nbsp;serial&nbsp;port&nbsp;and&nbsp;protocol...note&nbsp;there&nbsp;are&nbsp;more&nbsp;parameters&nbsp;to&nbsp;create&nbsp;the&nbsp;SerialPort&nbsp;(baudrate,&nbsp;etc.)&lt;/div&gt;&lt;div&gt;serial&nbsp;=&nbsp;SerialPort(ArduinoReceiver,&nbsp;'/dev/tty.usbserial',&nbsp;reactor)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;EchoBot&nbsp;gets&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;serialport&lt;/div&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;EchoBotProtocol(MessageProtocol):&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;def&nbsp;__init__(self,&nbsp;serial,&nbsp;*args,&nbsp;**kwargs):&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;self.serial&nbsp;=&nbsp;serial&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;#&nbsp;Set&nbsp;a&nbsp;reference&nbsp;to&nbsp;self&nbsp;on&nbsp;the&nbsp;serial&nbsp;protocol&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;self.serial.protocol.echobot&nbsp;=&nbsp;self&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;MessageProtocol.__init__(self,&nbsp;*args,&nbsp;**kwargs)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;def&nbsp;onMessage(self,&nbsp;msg):&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;self.serial.transport.write('some&nbsp;message\n')&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;echobot&nbsp;=&nbsp;EchoBotProtocol(serial)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;...and&nbsp;an&nbsp;update&nbsp;to&nbsp;your&nbsp;pastebin&nbsp;that&nbsp;may&nbsp;be&nbsp;helpful&nbsp;for&nbsp;context:&amp;nbsp;&lt;a&nbsp;href=&quot;http://pastebin.com/2EJ22wXa&quot;&gt;http://pastebin.com/2EJ22wXa&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
