<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Jan&nbsp;21,&nbsp;2017&nbsp;at&nbsp;8:06&nbsp;PM,&nbsp;Glyph&nbsp;Lefkowitz&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;On&nbsp;Jan&nbsp;21,&nbsp;2017,&nbsp;at&nbsp;6:15&nbsp;PM,&nbsp;Craig&nbsp;Rodrigues&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rodrigc@crodrigues.org&quot;&nbsp;target=&quot;_blank&quot;&gt;rodrigc@crodrigues.org&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;gmail-m_1103198121470315311Apple-interchange-newline&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-family:menlo-regular;font-size:12px;font-style:normal;font-variant-caps:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px&quot;&gt;If&nbsp;I&nbsp;run&nbsp;the&nbsp;test&nbsp;on&nbsp;Python&nbsp;2,&nbsp;I&nbsp;don&#39;t&nbsp;get&nbsp;the&nbsp;error,&nbsp;and&nbsp;on&nbsp;line&nbsp;93,&nbsp;brdicts&nbsp;is&nbsp;a&nbsp;dict.&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:menlo-regular;font-size:12px;font-style:normal;font-variant-caps:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px&quot;&gt;However,&nbsp;if&nbsp;I&nbsp;run&nbsp;the&nbsp;test&nbsp;on&nbsp;Python&nbsp;3,&nbsp;brdicts&nbsp;is&nbsp;a&nbsp;Deferred,&nbsp;thus&nbsp;the&nbsp;error.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;This&nbsp;really&nbsp;ought&nbsp;to&nbsp;be&nbsp;impossible. &nbsp;If&nbsp;I&nbsp;were&nbsp;seeing&nbsp;this,&nbsp;single-stepping&nbsp;through&nbsp;inlineCallbacks&nbsp;in&nbsp;pudb&nbsp;would&nbsp;probably&nbsp;be&nbsp;my&nbsp;next&nbsp;step. &nbsp;Have&nbsp;you&nbsp;made&nbsp;any&nbsp;attempts&nbsp;to&nbsp;simplify&nbsp;it&nbsp;down&nbsp;to&nbsp;remove&nbsp;some&nbsp;of&nbsp;the&nbsp;buildbot-specific&nbsp;code?&lt;/div&gt;&lt;span&nbsp;class=&quot;gmail-HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;did&nbsp;some&nbsp;more&nbsp;debugging. &nbsp;The&nbsp;callstack&nbsp;is&nbsp;quite&nbsp;deep.&nbsp;:/&lt;br&gt;I&nbsp;used&nbsp;this&nbsp;command&nbsp;to&nbsp;trigger&nbsp;the&nbsp;error:&lt;br&gt;&lt;br&gt;trial&nbsp; buildbot.test.unit.test_process_buildrequestdistributor.TestMaybeStartBuilds.test_slow_db&lt;br&gt;&lt;br&gt;I&nbsp;found&nbsp;in&nbsp;this&nbsp;function&nbsp;in&nbsp;buildbot&#39;s&nbsp;BuildRequestsEndpoint.get()&nbsp;function&nbsp;(&nbsp;&lt;a&nbsp;href=&quot;https://github.com/buildbot/buildbot/blob/master/master/buildbot/data/buildrequests.py#L146&quot;&gt;https://github.com/buildbot/buildbot/blob/master/master/buildbot/data/buildrequests.py#L146&lt;/a&gt;&nbsp;)&nbsp;there&nbsp;is&nbsp;this&nbsp;line:&lt;br&gt;&lt;br&gt;&lt;b&gt; &nbsp; &nbsp; &nbsp; &nbsp;defer.returnValue(&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[(yield&nbsp;self.db2data(br))&nbsp;for&nbsp;br&nbsp;in&nbsp;buildrequests])&lt;br&gt;&lt;/b&gt;&lt;br&gt;On&nbsp;Python&nbsp;2,&nbsp;this&nbsp;line&nbsp;returns:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt; &nbsp;an&nbsp;object&nbsp;list&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt; &nbsp;each&nbsp;list&nbsp;entry&nbsp;is&nbsp;a&nbsp;dictionary&nbsp;of&nbsp;name/value&nbsp;pairs&nbsp;that&nbsp;looks&nbsp;like:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&gt;&lt;span&nbsp;class=&quot;gmail-s1&quot;&gt;[{&#39;buildrequestid&#39;:&nbsp;10,&nbsp;&#39;complete&#39;:&nbsp;False,&nbsp;&#39;waited_for&#39;:&nbsp;False,&nbsp;&#39;claimed_at&#39;:&nbsp;None,&nbsp;&#39;results&#39;:&nbsp;-1,&nbsp;&#39;claimed&#39;:&nbsp;False,&nbsp;&#39;buildsetid&#39;:&nbsp;11,&nbsp;&#39;complete_at&#39;:&nbsp;None,&nbsp;&#39;submitted_at&#39;:&nbsp;datetime.datetime(1970,&nbsp;1,&nbsp;2,&nbsp;12,&nbsp;6,&nbsp;40,&nbsp;tzinfo=tzutc()),&nbsp;&#39;builderid&#39;:&nbsp;77,&nbsp;&#39;claimed_by_masterid&#39;:&nbsp;None,&nbsp;&#39;priority&#39;:&nbsp;0},&nbsp;{&#39;buildrequestid&#39;:&nbsp;11,&nbsp;&#39;complete&#39;:&nbsp;False,&nbsp;&#39;waited_for&#39;:&nbsp;False,&nbsp;&#39;claimed_at&#39;:&nbsp;None,&nbsp;&#39;results&#39;:&nbsp;-1,&nbsp;&#39;claimed&#39;:&nbsp;False,&nbsp;&#39;buildsetid&#39;:&nbsp;11,&nbsp;&#39;complete_at&#39;:&nbsp;None,&nbsp;&#39;submitted_at&#39;:&nbsp;datetime.datetime(1970,&nbsp;1,&nbsp;2,&nbsp;13,&nbsp;30,&nbsp;tzinfo=tzutc()),&nbsp;&#39;builderid&#39;:&nbsp;77,&nbsp;&#39;claimed_by_masterid&#39;:&nbsp;None,&nbsp;&#39;priority&#39;:&nbsp;0}]&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Python&nbsp;3,&nbsp;this&nbsp;returns:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt; &nbsp;an&nbsp;object &lt;generator&nbsp;object&nbsp;BuildRequestsEndpoint.get.&lt;locals&gt;.&lt;listcomp&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt; &nbsp;of&nbsp;type&nbsp;&lt;class&nbsp;&#39;generator&#39;&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;The&nbsp;self.db2data()&nbsp;function&nbsp;returns&nbsp;defer.succeed(data)&nbsp;( &lt;a&nbsp;href=&quot;https://github.com/buildbot/buildbot/blob/master/master/buildbot/data/buildrequests.py#L32&quot;&gt;https://github.com/buildbot/buildbot/blob/master/master/buildbot/data/buildrequests.py#L32&lt;/a&gt;&nbsp;)&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;So&nbsp;it&nbsp;looks&nbsp;like&nbsp;on&nbsp;Python&nbsp;3,&nbsp;this&nbsp;is&nbsp;not&nbsp;getting&nbsp;evaluated&nbsp;properly,&nbsp;and&nbsp;the&nbsp;upper&nbsp;layer&nbsp;is&nbsp;trying&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;to&nbsp;index&nbsp;a&nbsp;Deferred&nbsp;instead&nbsp;of&nbsp;a&nbsp;list&nbsp;of&nbsp;dictionaries.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;I&#39;m&nbsp;not&nbsp;so&nbsp;familiar&nbsp;with&nbsp;generators/Deferreds&nbsp;in&nbsp;Py2&nbsp;vs.&nbsp;Py3. &nbsp;What&nbsp;is&nbsp;the&nbsp;best&nbsp;way&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;to&nbsp;fix&nbsp;this&nbsp;to&nbsp;get&nbsp;consistent&nbsp;behavior&nbsp;on&nbsp;Py2&nbsp;and&nbsp;Py3?&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Thanks.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;--&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Craig&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
