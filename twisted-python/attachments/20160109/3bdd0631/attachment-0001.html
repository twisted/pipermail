<tt>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;STYLE&nbsp;id=eMClientCss&gt;<br>
blockquote.cite&nbsp;{&nbsp;margin-left:&nbsp;5px;&nbsp;margin-right:&nbsp;0px;&nbsp;padding-left:&nbsp;10px;&nbsp;padding-right:0px;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;#cccccc&nbsp;}<br>
blockquote.cite2&nbsp;{margin-left:&nbsp;5px;&nbsp;margin-right:&nbsp;0px;&nbsp;padding-left:&nbsp;10px;&nbsp;padding-right:0px;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;#cccccc;&nbsp;margin-top:&nbsp;3px;&nbsp;padding-top:&nbsp;0px;&nbsp;}<br>
.plain&nbsp;pre,&nbsp;.plain&nbsp;tt&nbsp;{&nbsp;font-family:&nbsp;monospace;&nbsp;font-size:&nbsp;100%;&nbsp;font-weight:&nbsp;normal;&nbsp;font-style:&nbsp;normal;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;}<br>
a&nbsp;img&nbsp;{&nbsp;border:&nbsp;0px;&nbsp;}body&nbsp;{font-family:&nbsp;Tahoma;font-size:&nbsp;12pt;}<br>
.plain&nbsp;pre,&nbsp;.plain&nbsp;tt&nbsp;{font-family:&nbsp;Tahoma;font-size:&nbsp;12pt;}&lt;/STYLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;I'm&nbsp;trying&nbsp;to&nbsp;pass&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;a&nbsp;Twisted&nbsp;subprocess&nbsp;with&nbsp;adoptStreamConnection,&nbsp;but&nbsp;I&nbsp;can't&nbsp;figure&nbsp;out&nbsp;how&nbsp;to&nbsp;get&nbsp;the&nbsp;Process&nbsp;disposed&nbsp;in&nbsp;the&nbsp;main&nbsp;process&nbsp;after&nbsp;doing&nbsp;that.&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;My&nbsp;desired&nbsp;flow&nbsp;looks&nbsp;like&nbsp;this:&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;-&nbsp;Finish&nbsp;writing&nbsp;any&nbsp;data&nbsp;the&nbsp;Protocol&nbsp;transport&nbsp;has&nbsp;waiting&lt;BR&gt;-&nbsp;When&nbsp;we&nbsp;know&nbsp;the&nbsp;write&nbsp;buffer&nbsp;is&nbsp;empty&nbsp;send&nbsp;the&nbsp;AMP&nbsp;message&nbsp;to&nbsp;transfer&nbsp;the&nbsp;socket&nbsp;to&nbsp;the&nbsp;subprocess&lt;BR&gt;-&nbsp;Dispose&nbsp;the&nbsp;Protocol&nbsp;instance&nbsp;in&nbsp;the&nbsp;main&nbsp;process&lt;BR&gt;-&nbsp;I&nbsp;tried&nbsp;doing&nbsp;nothing,&nbsp;loseConnection,&nbsp;abortConnection,&nbsp;and&nbsp;monkey&nbsp;patching&nbsp;_socketClose&nbsp;out&nbsp;and&nbsp;using&nbsp;loseConnection.&nbsp;See&nbsp;code&nbsp;here:&nbsp;&lt;A&nbsp;href=&quot;http://pastebin.com/nK0Huxuj&quot;&gt;http://pastebin.com/nK0Huxuj&lt;/A&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;In&nbsp;all&nbsp;cases&nbsp;the&nbsp;Protocol&nbsp;object&nbsp;still&nbsp;exists&nbsp;in&nbsp;the&nbsp;main&nbsp;process&nbsp;after&nbsp;the&nbsp;socket&nbsp;has&nbsp;been&nbsp;transferred,&nbsp;even&nbsp;if&nbsp;the&nbsp;main&nbsp;process&nbsp;isn't&nbsp;listening&nbsp;to&nbsp;that&nbsp;socket&nbsp;anymore.&nbsp;How&nbsp;can&nbsp;I&nbsp;clean&nbsp;this&nbsp;up?&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;Thanks&nbsp;in&nbsp;advance.&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;
</tt>
