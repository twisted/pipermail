<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Aug&nbsp;18,&nbsp;2014,&nbsp;at&nbsp;8:31&nbsp;PM,&nbsp;Daniel&nbsp;Sank&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:sank.daniel@gmail.com&quot;&gt;sank.daniel@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Dustin,&lt;br&gt;&lt;br&gt;&gt;&nbsp;Adding&nbsp;what&nbsp;amounts&nbsp;to&nbsp;a&nbsp;use-after-free&nbsp;bug&nbsp;to&nbsp;the&nbsp;protocol&nbsp;seems&nbsp;like&nbsp;a&nbsp;really&nbsp;bad&nbsp;idea&nbsp;to&nbsp;me.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Oh&nbsp;goody,&nbsp;a&nbsp;sarcastic&nbsp;comment&nbsp;which&nbsp;doesn't&nbsp;actually&nbsp;bother&nbsp;to&nbsp;explain&nbsp;the&nbsp;bug&nbsp;:)&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Oddly&nbsp;this&nbsp;is&nbsp;_exactly_&nbsp;how&nbsp;a&nbsp;co-worker&nbsp;characterized&nbsp;the&nbsp;problem&nbsp;as&nbsp;well,&nbsp;with&nbsp;(as&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;see)&nbsp;no&nbsp;communication&nbsp;of&nbsp;this&nbsp;idea&nbsp;;).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;&lt;a&nbsp;href=&quot;http://cwe.mitre.org/data/definitions/416.html&quot;&gt;http://cwe.mitre.org/data/definitions/416.html&lt;/a&gt;&gt;&nbsp;describes&nbsp;the&nbsp;disastrous&nbsp;consequences&nbsp;of&nbsp;this&nbsp;in&nbsp;C;&nbsp;the&nbsp;Python&nbsp;equivalent&nbsp;is&nbsp;mild,&nbsp;but&nbsp;it's&nbsp;still&nbsp;annoying&nbsp;to&nbsp;get&nbsp;'None&nbsp;has&nbsp;no&nbsp;attribute&nbsp;&quot;frob&quot;'&nbsp;when&nbsp;you&nbsp;do&nbsp;self.frobber.frob().&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Since&nbsp;what&nbsp;I&nbsp;describe&nbsp;is&nbsp;basically&nbsp;WeakReferenceable,&nbsp;it's&nbsp;not&nbsp;obvious&nbsp;to&nbsp;me&nbsp;that&nbsp;there's&nbsp;a&nbsp;bug.&nbsp;I&nbsp;tell&nbsp;you&nbsp;when&nbsp;the&nbsp;thing&nbsp;to&nbsp;which&nbsp;your&nbsp;Remote(Weak)Reference&nbsp;points&nbsp;is&nbsp;destroyed,&nbsp;just&nbsp;like&nbsp;weak&nbsp;references&nbsp;invoke&nbsp;finalization&nbsp;callbacks.&nbsp;If&nbsp;you&nbsp;try&nbsp;to&nbsp;invoke&nbsp;remote&nbsp;methods&nbsp;after&nbsp;than&nbsp;happens&nbsp;I&nbsp;just&nbsp;return&nbsp;you&nbsp;an&nbsp;error.&nbsp;What's&nbsp;the&nbsp;problem?&nbsp;This&nbsp;is&nbsp;exactly&nbsp;how&nbsp;weak&nbsp;references&nbsp;work.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;thing&nbsp;about&nbsp;weak&nbsp;references&nbsp;is&nbsp;that&nbsp;they&nbsp;are&nbsp;almost&nbsp;always&nbsp;to&nbsp;objects&nbsp;that&nbsp;are&nbsp;shared,&nbsp;that&nbsp;have&nbsp;a&nbsp;well-defined&nbsp;lifecycle.&nbsp;&nbsp;Your&nbsp;PB&nbsp;objects&nbsp;generally&nbsp;should&nbsp;_not_&nbsp;be&nbsp;shared;&nbsp;a&nbsp;well-structured&nbsp;PB&nbsp;application&nbsp;will&nbsp;almost&nbsp;always&nbsp;create&nbsp;thin&nbsp;wrapper&nbsp;objects,&nbsp;factoring&nbsp;the&nbsp;remote-access-control&nbsp;logic&nbsp;out&nbsp;of&nbsp;the&nbsp;core&nbsp;model&nbsp;abstractions.&nbsp;&nbsp;Exposing&nbsp;weak&nbsp;references&nbsp;across&nbsp;a&nbsp;network&nbsp;is&nbsp;also&nbsp;very,&nbsp;very&nbsp;tricky:&nbsp;distributed&nbsp;reference&nbsp;counting&nbsp;is&nbsp;hard&nbsp;enough&nbsp;without&nbsp;trying&nbsp;to&nbsp;introduce&nbsp;real&nbsp;distributed&nbsp;GC&nbsp;that&nbsp;involves&nbsp;reference&nbsp;tracing.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&gt;&nbsp;If&nbsp;your&nbsp;server-side&nbsp;app&nbsp;is&nbsp;sensitive&nbsp;to&nbsp;when&nbsp;objects&nbsp;are&nbsp;destroyed&nbsp;for&nbsp;<br>
any&nbsp;reason&nbsp;aside&lt;br&gt;&gt;&nbsp;from&nbsp;management&nbsp;of&nbsp;its&nbsp;memory&nbsp;consumption,&nbsp;I'd&nbsp;argue&nbsp;<br>
your&nbsp;app&nbsp;is&nbsp;broken.&lt;br&gt;&lt;br&gt;&lt;/div&gt;That's&nbsp;a&nbsp;really&nbsp;good&nbsp;point.&nbsp;Only&nbsp;CPython&nbsp;destroys&nbsp;objects&nbsp;deterministically&nbsp;when&nbsp;the&nbsp;ref&nbsp;count&nbsp;hits&nbsp;zero.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes.&nbsp;And&nbsp;even&nbsp;the&nbsp;CPython&nbsp;developers&nbsp;have&nbsp;said&nbsp;it's&nbsp;effectively&nbsp;a&nbsp;bug&nbsp;to&nbsp;depend&nbsp;on&nbsp;this&nbsp;behavior,&nbsp;because&nbsp;you&nbsp;can't&nbsp;&lt;i&gt;really&lt;/i&gt;&nbsp;know&nbsp;when&nbsp;it's&nbsp;going&nbsp;to&nbsp;happen.&nbsp;&nbsp;A&nbsp;debugger&nbsp;might&nbsp;be&nbsp;holding&nbsp;on&nbsp;to&nbsp;your&nbsp;stack&nbsp;frames&nbsp;for&nbsp;a&nbsp;little&nbsp;while.&nbsp;&nbsp;The&nbsp;profiler&nbsp;might&nbsp;be&nbsp;keeping&nbsp;your&nbsp;locals&nbsp;around&nbsp;for&nbsp;a&nbsp;moment&nbsp;longer&nbsp;than&nbsp;you&nbsp;expect.&nbsp;&nbsp;This&nbsp;is&nbsp;why&nbsp;we&nbsp;have&nbsp;idioms&nbsp;like&nbsp;'with&nbsp;f&nbsp;as&nbsp;open(...)'&nbsp;now.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&gt;&nbsp;Certainly&nbsp;it&nbsp;opens&nbsp;you&nbsp;to&nbsp;a&nbsp;denial&nbsp;of&nbsp;service&nbsp;from&nbsp;a&nbsp;malicious&nbsp;client,&nbsp;<br>
which&nbsp;might&nbsp;hold&nbsp;references&lt;br&gt;&gt;&nbsp;to&nbsp;objects&nbsp;you'd&nbsp;rather&nbsp;it&nbsp;didn't&lt;br&gt;&lt;br&gt;&lt;/div&gt;So&nbsp;my&nbsp;instinct&nbsp;to&nbsp;keep&nbsp;strong&nbsp;references&nbsp;only&nbsp;where&nbsp;they're&nbsp;needed&nbsp;is&nbsp;just&nbsp;bad?&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;are&nbsp;a&nbsp;couple&nbsp;of&nbsp;ways&nbsp;to&nbsp;solve&nbsp;this&nbsp;problem&nbsp;without&nbsp;getting&nbsp;weak&nbsp;references&nbsp;involved:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&nbsp;class=&quot;MailOutline&quot;&gt;&lt;li&gt;Set&nbsp;limits&nbsp;on&nbsp;things.&nbsp;&nbsp;PB&nbsp;isn't&nbsp;great&nbsp;about&nbsp;this,&nbsp;but&nbsp;this&nbsp;is&nbsp;an&nbsp;area&nbsp;where&nbsp;it&nbsp;could&nbsp;get&nbsp;better,&nbsp;and&nbsp;where&nbsp;all&nbsp;the&nbsp;fixes&nbsp;are&nbsp;really&nbsp;straightforward&nbsp;(find&nbsp;the&nbsp;place&nbsp;where&nbsp;PB&nbsp;does&nbsp;a&nbsp;thing,&nbsp;set&nbsp;a&nbsp;limit,&nbsp;raise&nbsp;an&nbsp;exception&nbsp;if&nbsp;the&nbsp;thing&nbsp;is&nbsp;over&nbsp;that&nbsp;limit).&nbsp;In&nbsp;this&nbsp;case,&nbsp;don't&nbsp;allow&nbsp;clients&nbsp;to&nbsp;hold&nbsp;unlimited&nbsp;numbers&nbsp;of&nbsp;simultaneous&nbsp;references.&nbsp;&nbsp;Start&nbsp;throwing&nbsp;errors&nbsp;when&nbsp;too&nbsp;many&nbsp;live&nbsp;references&nbsp;exist&nbsp;on&nbsp;one&nbsp;connection.&nbsp;&nbsp;A&nbsp;reasonable&nbsp;application&nbsp;should&nbsp;not&nbsp;need&nbsp;&lt;i&gt;that&lt;/i&gt;&nbsp;many&nbsp;at&nbsp;once&nbsp;-&nbsp;if&nbsp;you&nbsp;set&nbsp;a&nbsp;limit&nbsp;at&nbsp;around&nbsp;1024&nbsp;and&nbsp;allow&nbsp;servers&nbsp;to&nbsp;tune&nbsp;it&nbsp;for&nbsp;particular&nbsp;workloads,&nbsp;it&nbsp;should&nbsp;be&nbsp;fine.&nbsp;&nbsp;(Set&nbsp;it&nbsp;per-type&nbsp;maybe?)&lt;/li&gt;&lt;li&gt;Don't&nbsp;give&nbsp;out&nbsp;references&nbsp;to&nbsp;objects&nbsp;you&nbsp;can't&nbsp;revoke&nbsp;logically,&nbsp;at&nbsp;an&nbsp;application&nbsp;level.&nbsp;&nbsp;If&nbsp;you&nbsp;have&nbsp;a&nbsp;chess&nbsp;piece&nbsp;that&nbsp;has&nbsp;been&nbsp;taken,&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;NULL&nbsp;pointer&nbsp;or&nbsp;None.&nbsp;&nbsp;There&nbsp;is&nbsp;a&nbsp;small,&nbsp;fixed&nbsp;number&nbsp;of&nbsp;chess&nbsp;pieces&nbsp;per&nbsp;game,&nbsp;so&nbsp;you&nbsp;don't&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;denials&nbsp;of&nbsp;service.&nbsp;&nbsp;Therefore&nbsp;your&nbsp;ChessPiece&nbsp;class&nbsp;should&nbsp;have&nbsp;a&nbsp;'taken'&nbsp;state&nbsp;associated&nbsp;with&nbsp;it;&nbsp;in&nbsp;fact,&nbsp;you&nbsp;could&nbsp;remember&nbsp;which&nbsp;move&nbsp;of&nbsp;the&nbsp;game&nbsp;the&nbsp;piece&nbsp;was&nbsp;taken&nbsp;on,&nbsp;and&nbsp;produce&nbsp;an&nbsp;error&nbsp;message&nbsp;which&nbsp;specifically&nbsp;reminds&nbsp;the&nbsp;player&nbsp;when&nbsp;it&nbsp;was&nbsp;taken.&nbsp;&nbsp;Much&nbsp;like&nbsp;'with&nbsp;f&nbsp;as&nbsp;open(...)'&nbsp;explicitly&nbsp;invokes&nbsp;'f.close()'&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;block&nbsp;but&nbsp;does&nbsp;not&nbsp;force&nbsp;'f'&nbsp;to&nbsp;get&nbsp;garbage&nbsp;collected,&nbsp;you&nbsp;should&nbsp;still&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;a&nbsp;PB&nbsp;protocol-level&nbsp;reference&nbsp;to&nbsp;an&nbsp;application-level&nbsp;revoked&nbsp;object.&nbsp;&nbsp;Debugging&nbsp;distributed&nbsp;systems&nbsp;is&nbsp;hard&nbsp;enough&nbsp;without&nbsp;translating&nbsp;every&nbsp;revoked-permission&nbsp;error&nbsp;into&nbsp;some&nbsp;common&nbsp;&quot;the&nbsp;distributed&nbsp;GC&nbsp;happened,&nbsp;I&nbsp;don't&nbsp;know&nbsp;what&nbsp;happened&nbsp;to&nbsp;your&nbsp;object,&nbsp;life&nbsp;is&nbsp;hard&quot;.&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;this&nbsp;making&nbsp;sense?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Should&nbsp;a&nbsp;GUI&nbsp;or&nbsp;a&nbsp;logger&nbsp;keep&nbsp;a&nbsp;strong&nbsp;reference&nbsp;to&nbsp;the&nbsp;things&nbsp;they&nbsp;observe?&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;my&nbsp;other&nbsp;message&nbsp;indicated&nbsp;-&nbsp;yes&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
