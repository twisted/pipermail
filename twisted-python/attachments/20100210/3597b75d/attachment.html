<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
I&nbsp;don't&nbsp;think&nbsp;so.&nbsp;&nbsp;I&nbsp;believe&nbsp;the&nbsp;reactor&nbsp;is&nbsp;actually&nbsp;added&nbsp;during&nbsp;the<br>
import.&nbsp;&nbsp;(I&nbsp;learned&nbsp;this&nbsp;as&nbsp;I&nbsp;discovered&nbsp;that&nbsp;reactors&nbsp;can't&nbsp;be<br>
restarted,&nbsp;which&nbsp;means&nbsp;you&nbsp;have&nbsp;to&nbsp;manually&nbsp;create&nbsp;a&nbsp;new&nbsp;one&nbsp;as&nbsp;a<br>
fixture&nbsp;for&nbsp;simple&nbsp;unittest&nbsp;work.)&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;looked&nbsp;through&nbsp;the&nbsp;code&nbsp;and&nbsp;there's&nbsp;a&nbsp;call&nbsp;in&nbsp;the&nbsp;reactor&nbsp;to&nbsp;fileno<br>
immediately&nbsp;after&nbsp;the&nbsp;call&nbsp;to&nbsp;doRead.&nbsp;&nbsp;It&nbsp;seems&nbsp;to&nbsp;be&nbsp;attempting&nbsp;to<br>
check&nbsp;for&nbsp;file&nbsp;descriptors&nbsp;which&nbsp;broke&nbsp;during&nbsp;the&nbsp;read,&nbsp;but&nbsp;I&nbsp;think<br>
that's&nbsp;a&nbsp;mistake.&nbsp;&nbsp;(Or&nbsp;at&nbsp;least,&nbsp;I'm&nbsp;confused&nbsp;about&nbsp;how&nbsp;else&nbsp;to&nbsp;do<br>
it).&nbsp;&nbsp;Seems&nbsp;to&nbsp;me&nbsp;that&nbsp;the&nbsp;only&nbsp;time&nbsp;my&nbsp;object&nbsp;has&nbsp;control&nbsp;in&nbsp;order&nbsp;to<br>
remove&nbsp;itself&nbsp;is&nbsp;during&nbsp;doRead.&nbsp;&nbsp;So&nbsp;I'm&nbsp;thinking&nbsp;that&nbsp;either...&lt;br&gt;<br>
&lt;br&gt;<br>
a)&nbsp;there's&nbsp;some&nbsp;other&nbsp;way&nbsp;to&nbsp;close&nbsp;out&nbsp;my&nbsp;object&nbsp;that&nbsp;I&nbsp;just&nbsp;haven't<br>
discovered&nbsp;or&lt;br&gt;<br>
&lt;br&gt;<br>
b)&nbsp;the&nbsp;code&nbsp;which&nbsp;checks&nbsp;the&nbsp;file&nbsp;descriptor,&nbsp;(which&nbsp;may&nbsp;have&nbsp;been<br>
closed),&nbsp;after&nbsp;doRead&nbsp;is&nbsp;doing&nbsp;so&nbsp;mistakenly.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;now,&nbsp;in&nbsp;my&nbsp;real&nbsp;code,&nbsp;I'm&nbsp;just&nbsp;leaving&nbsp;the&nbsp;file&nbsp;descriptor.&nbsp;&nbsp;But<br>
I'd&nbsp;like&nbsp;to&nbsp;know&nbsp;how&nbsp;this&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used.&lt;br&gt;<br>
&lt;br&gt;<br>
--rich&nbsp;(still&nbsp;a&nbsp;newbie)&lt;br&gt;<br>
&lt;br&gt;<br>
Mark&nbsp;Bailey&nbsp;wrote:<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:dc408fe51002101057k6d4159e6o132500fe8628d790@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;Hi:&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Aren't&nbsp;you&nbsp;adding&nbsp;two&nbsp;readers?&nbsp;&nbsp;One&nbsp;is&nbsp;added&nbsp;in&nbsp;the&nbsp;__init__&nbsp;method&nbsp;of<br>
inputFile,&nbsp;the&nbsp;other&nbsp;in&nbsp;the&nbsp;test&nbsp;code.&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
I'm&nbsp;also&nbsp;a&nbsp;newbie&nbsp;so&nbsp;maybe&nbsp;I'm&nbsp;equally&nbsp;confused...&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Feb&nbsp;9,&nbsp;2010&nbsp;at&nbsp;8:47&nbsp;PM,&nbsp;K.&nbsp;Richard<br>
Pixley&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;href=&quot;mailto:rich@noir.com&quot;&gt;rich@noir.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;<br>
&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;I'm&nbsp;confused&nbsp;be&nbsp;the&nbsp;response<br>
I&nbsp;get&nbsp;to&nbsp;the&nbsp;attached&nbsp;program.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
In&nbsp;a&nbsp;nutshell,&nbsp;I'm&nbsp;building&nbsp;a&nbsp;reader,&nbsp;attaching&nbsp;it&nbsp;with&nbsp;addReader,<br>
later&nbsp;removing&nbsp;it&nbsp;with&nbsp;removeReader.&nbsp;&nbsp;And&nbsp;I'm&nbsp;getting&nbsp;this:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&gt;time&nbsp;python&nbsp;test_reactor.py&lt;br&gt;<br>
Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;<br>
Failure:&nbsp;twisted.internet.error.ConnectionFdescWentAway:&nbsp;Uh:<br>
Filedescriptor&nbsp;went&nbsp;away.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
Which&nbsp;seems&nbsp;to&nbsp;be&nbsp;telling&nbsp;me&nbsp;that&nbsp;I&nbsp;don't&nbsp;know&nbsp;as&nbsp;much&nbsp;yet&nbsp;as&nbsp;I'd&nbsp;hoped.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
Why&nbsp;would&nbsp;the&nbsp;reactor&nbsp;care&nbsp;about&nbsp;a&nbsp;closed&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;isn't<br>
even&nbsp;in&nbsp;it's&nbsp;interest&nbsp;set?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
--rich&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
#!/usr/bin/env&nbsp;python&lt;br&gt;<br>
#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
import&nbsp;os&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
from&nbsp;zope.interface&nbsp;import&nbsp;implements&lt;br&gt;<br>
from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;<br>
from&nbsp;twisted.internet.interfaces&nbsp;import&nbsp;IReadDescriptor&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
class&nbsp;inputFile(object):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;implements(IReadDescriptor)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;filename):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.filename&nbsp;=&nbsp;filename&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.filedes&nbsp;=&nbsp;os.open(filename,&nbsp;os.O_RDONLY&nbsp;|&nbsp;os.O_NONBLOCK)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactor.addReader(self)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;def&nbsp;fileno(self):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.filedes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;def&nbsp;connectionLost(self,&nbsp;reason):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;reason&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;def&nbsp;logPrefix(self):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'inputFile'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;def&nbsp;doRead(self):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactor.removeReader(self)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.close(self.filedes)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.filedes&nbsp;=&nbsp;-1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reactor.stop()&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
if&nbsp;__name__&nbsp;==&nbsp;'__main__':&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;inputFile('/etc/group')&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;reactor.addReader(r)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;reactor.run()&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;<br>
&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;hr&nbsp;size=&quot;4&quot;&nbsp;width=&quot;90%&quot;&gt;<br>
_______________________________________________<br>
Twisted-Python&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
