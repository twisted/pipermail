<tt>
Hi&nbsp;Rich:&lt;br&gt;&lt;br&gt;Try&nbsp;removing&nbsp;the&nbsp;&quot;reactor.addReader(self)&quot;&nbsp;call&nbsp;from&nbsp;&quot;__init__&quot;&nbsp;and&nbsp;see&nbsp;what&nbsp;happens. &nbsp;That&nbsp;call&nbsp;is&nbsp;made&nbsp;when&nbsp;&quot;r&quot;&nbsp;is&nbsp;created&nbsp;in&lt;br&gt;<br>
&lt;br&gt;<br>
  &nbsp;r&nbsp;=&nbsp;inputFile(&#39;/etc/group&#39;)&lt;br&gt;<br>
&lt;br&gt;<br>
and&nbsp;immediately&nbsp;after&nbsp;that&nbsp;you&nbsp;are&nbsp;calling&lt;br&gt;<br>
  &nbsp;reactor.addReader(r)&lt;br&gt;&lt;br&gt;So,&nbsp;you&nbsp;are&nbsp;calling&nbsp;reactor.addReader()&nbsp;twice&nbsp;on&nbsp;the&nbsp;same&nbsp;instance.&lt;br&gt;<br>
&lt;br&gt;<br>
Mark&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Feb&nbsp;10,&nbsp;2010&nbsp;at&nbsp;2:24&nbsp;PM,&nbsp;K.&nbsp;Richard&nbsp;Pixley&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rich@noir.com&quot;&gt;rich@noir.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
<br>
<br>
&nbsp;&nbsp;<br>
<br>
&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
I&nbsp;don&#39;t&nbsp;think&nbsp;so. &nbsp;I&nbsp;believe&nbsp;the&nbsp;reactor&nbsp;is&nbsp;actually&nbsp;added&nbsp;during&nbsp;the<br>
import. &nbsp;(I&nbsp;learned&nbsp;this&nbsp;as&nbsp;I&nbsp;discovered&nbsp;that&nbsp;reactors&nbsp;can&#39;t&nbsp;be<br>
restarted,&nbsp;which&nbsp;means&nbsp;you&nbsp;have&nbsp;to&nbsp;manually&nbsp;create&nbsp;a&nbsp;new&nbsp;one&nbsp;as&nbsp;a<br>
fixture&nbsp;for&nbsp;simple&nbsp;unittest&nbsp;work.)&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;looked&nbsp;through&nbsp;the&nbsp;code&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;call&nbsp;in&nbsp;the&nbsp;reactor&nbsp;to&nbsp;fileno<br>
immediately&nbsp;after&nbsp;the&nbsp;call&nbsp;to&nbsp;doRead. &nbsp;It&nbsp;seems&nbsp;to&nbsp;be&nbsp;attempting&nbsp;to<br>
check&nbsp;for&nbsp;file&nbsp;descriptors&nbsp;which&nbsp;broke&nbsp;during&nbsp;the&nbsp;read,&nbsp;but&nbsp;I&nbsp;think<br>
that&#39;s&nbsp;a&nbsp;mistake. &nbsp;(Or&nbsp;at&nbsp;least,&nbsp;I&#39;m&nbsp;confused&nbsp;about&nbsp;how&nbsp;else&nbsp;to&nbsp;do<br>
it). &nbsp;Seems&nbsp;to&nbsp;me&nbsp;that&nbsp;the&nbsp;only&nbsp;time&nbsp;my&nbsp;object&nbsp;has&nbsp;control&nbsp;in&nbsp;order&nbsp;to<br>
remove&nbsp;itself&nbsp;is&nbsp;during&nbsp;doRead. &nbsp;So&nbsp;I&#39;m&nbsp;thinking&nbsp;that&nbsp;either...&lt;br&gt;<br>
&lt;br&gt;<br>
a)&nbsp;there&#39;s&nbsp;some&nbsp;other&nbsp;way&nbsp;to&nbsp;close&nbsp;out&nbsp;my&nbsp;object&nbsp;that&nbsp;I&nbsp;just&nbsp;haven&#39;t<br>
discovered&nbsp;or&lt;br&gt;<br>
&lt;br&gt;<br>
b)&nbsp;the&nbsp;code&nbsp;which&nbsp;checks&nbsp;the&nbsp;file&nbsp;descriptor,&nbsp;(which&nbsp;may&nbsp;have&nbsp;been<br>
closed),&nbsp;after&nbsp;doRead&nbsp;is&nbsp;doing&nbsp;so&nbsp;mistakenly.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;now,&nbsp;in&nbsp;my&nbsp;real&nbsp;code,&nbsp;I&#39;m&nbsp;just&nbsp;leaving&nbsp;the&nbsp;file&nbsp;descriptor. &nbsp;But<br>
I&#39;d&nbsp;like&nbsp;to&nbsp;know&nbsp;how&nbsp;this&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used.&lt;br&gt;<br>
&lt;br&gt;<br>
--rich&nbsp;(still&nbsp;a&nbsp;newbie)&lt;br&gt;<br>
&lt;br&gt;<br>
Mark&nbsp;Bailey&nbsp;wrote:<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;Hi:&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Aren&#39;t&nbsp;you&nbsp;adding&nbsp;two&nbsp;readers? &nbsp;One&nbsp;is&nbsp;added&nbsp;in&nbsp;the&nbsp;__init__&nbsp;method&nbsp;of<br>
inputFile,&nbsp;the&nbsp;other&nbsp;in&nbsp;the&nbsp;test&nbsp;code.&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
I&#39;m&nbsp;also&nbsp;a&nbsp;newbie&nbsp;so&nbsp;maybe&nbsp;I&#39;m&nbsp;equally&nbsp;confused...&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Feb&nbsp;9,&nbsp;2010&nbsp;at&nbsp;8:47&nbsp;PM,&nbsp;K.&nbsp;Richard<br>
Pixley&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rich@noir.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rich@noir.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;I&#39;m&nbsp;confused&nbsp;be&nbsp;the&nbsp;response<br>
I&nbsp;get&nbsp;to&nbsp;the&nbsp;attached&nbsp;program.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
In&nbsp;a&nbsp;nutshell,&nbsp;I&#39;m&nbsp;building&nbsp;a&nbsp;reader,&nbsp;attaching&nbsp;it&nbsp;with&nbsp;addReader,<br>
later&nbsp;removing&nbsp;it&nbsp;with&nbsp;removeReader. &nbsp;And&nbsp;I&#39;m&nbsp;getting&nbsp;this:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&gt;time&nbsp;python&nbsp;test_reactor.py&lt;br&gt;<br>
Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;<br>
Failure:&nbsp;twisted.internet.error.ConnectionFdescWentAway:&nbsp;Uh:<br>
Filedescriptor&nbsp;went&nbsp;away.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
Which&nbsp;seems&nbsp;to&nbsp;be&nbsp;telling&nbsp;me&nbsp;that&nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;as&nbsp;much&nbsp;yet&nbsp;as&nbsp;I&#39;d&nbsp;hoped.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
Why&nbsp;would&nbsp;the&nbsp;reactor&nbsp;care&nbsp;about&nbsp;a&nbsp;closed&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;isn&#39;t<br>
even&nbsp;in&nbsp;it&#39;s&nbsp;interest&nbsp;set?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
--rich&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
#!/usr/bin/env&nbsp;python&lt;br&gt;<br>
#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
import&nbsp;os&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
from&nbsp;zope.interface&nbsp;import&nbsp;implements&lt;br&gt;<br>
from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;<br>
from&nbsp;twisted.internet.interfaces&nbsp;import&nbsp;IReadDescriptor&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
class&nbsp;inputFile(object):&lt;br&gt;<br>
 &nbsp; implements(IReadDescriptor)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
 &nbsp; def&nbsp;__init__(self,&nbsp;filename):&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; self.filename&nbsp;=&nbsp;filename&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; self.filedes&nbsp;=&nbsp;os.open(filename,&nbsp;os.O_RDONLY&nbsp;|&nbsp;os.O_NONBLOCK)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; reactor.addReader(self)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
 &nbsp; def&nbsp;fileno(self):&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; return&nbsp;self.filedes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
 &nbsp; def&nbsp;connectionLost(self,&nbsp;reason):&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; raise&nbsp;reason&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
 &nbsp; def&nbsp;logPrefix(self):&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; return&nbsp;&#39;inputFile&#39;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
 &nbsp; def&nbsp;doRead(self):&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; reactor.removeReader(self)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; os.close(self.filedes)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; self.filedes&nbsp;=&nbsp;-1&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; reactor.stop()&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
if&nbsp;__name__&nbsp;==&nbsp;&#39;__main__&#39;:&lt;br&gt;<br>
 &nbsp; r&nbsp;=&nbsp;inputFile(&#39;/etc/group&#39;)&lt;br&gt;<br>
 &nbsp; reactor.addReader(r)&lt;br&gt;<br>
 &nbsp; reactor.run()&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;pre&gt;&lt;hr&nbsp;size=&quot;4&quot;&nbsp;width=&quot;90%&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
_______________________________________________<br>
Twisted-Python&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
