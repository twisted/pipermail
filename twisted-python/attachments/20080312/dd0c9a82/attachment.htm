<tt>
I&nbsp;have&nbsp;a&nbsp;small&nbsp;script&nbsp;which&nbsp;answers&nbsp;dns&nbsp;queries&nbsp;by&nbsp;returning&nbsp;the&nbsp;original&nbsp;message.&amp;nbsp;&nbsp;I&nbsp;have&nbsp;spent&nbsp;a&nbsp;couple&nbsp;of&nbsp;hours&nbsp;RTFMing,&nbsp;but&nbsp;I&nbsp;still&nbsp;cannot&nbsp;find&nbsp;out&nbsp;how&nbsp;to&nbsp;correctly&nbsp;add&nbsp;answers&nbsp;to&nbsp;the&nbsp;message,&nbsp;before&nbsp;returning&nbsp;it.&lt;br&gt;&lt;br&gt;<br>
I&nbsp;want&nbsp;to&nbsp;add&nbsp;an&nbsp;answer,&nbsp;either&nbsp;a&nbsp;Record_CNAME&nbsp;or&nbsp;Record_A,&nbsp;so&nbsp;as&nbsp;to&nbsp;produce&nbsp;a&nbsp;trivial&nbsp;authoritative-only&nbsp;DNS&nbsp;server.&nbsp;&lt;br&gt;&lt;br&gt;Adding&nbsp;a&nbsp;Record_XXX&nbsp;object&nbsp;to&nbsp;message.answers&nbsp;using&nbsp;the&nbsp;Array&amp;#39;s&nbsp;&amp;#39;append&amp;#39;&nbsp;method&nbsp;produces&nbsp;a&nbsp;MalformedPacket&nbsp;(according&nbsp;to&nbsp;wireshark),&nbsp;though&nbsp;the&nbsp;server&nbsp;does&nbsp;not&nbsp;throw&nbsp;any&nbsp;exceptions.&amp;nbsp;&amp;nbsp;&nbsp;(In&nbsp;this&nbsp;situation,&nbsp;the&nbsp;answer&nbsp;count,&nbsp;as&nbsp;shown&nbsp;by&nbsp;dig,&nbsp;does&nbsp;rise&nbsp;to&nbsp;1,&nbsp;even&nbsp;though&nbsp;no&nbsp;answer&nbsp;is&nbsp;displayed&nbsp;[due&nbsp;to&nbsp;malformed&nbsp;packet?].)&lt;br&gt;<br>
&lt;br&gt;Perhaps&nbsp;there&nbsp;is&nbsp;a&nbsp;completely&nbsp;different&nbsp;way&nbsp;to&nbsp;do&nbsp;this?&amp;nbsp;&nbsp;Could&nbsp;I&nbsp;craft&nbsp;a&nbsp;message&nbsp;with&nbsp;answers&nbsp;from&nbsp;scratch?&lt;br&gt;&lt;br&gt;Any&nbsp;help&nbsp;appreciated,&lt;br&gt;&lt;br&gt;Chris.&lt;br&gt;&lt;br&gt;&lt;br&gt;#!/usr/bin/python&lt;br&gt;&lt;br&gt;from&nbsp;twisted.internet.protocol&nbsp;import&nbsp;Protocol,&nbsp;Factory&lt;br&gt;<br>
from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;from&nbsp;twisted.names.server&nbsp;import&nbsp;DNSServerFactory&lt;br&gt;from&nbsp;twisted.names.dns&nbsp;import&nbsp;Query,&nbsp;DNSDatagramProtocol,&nbsp;RRHeader,&nbsp;Record_CNAME,&nbsp;Record_A,&nbsp;Message&lt;br&gt;from&nbsp;twisted.names&nbsp;import&nbsp;dns&lt;br&gt;<br>
from&nbsp;twisted.internet.interfaces&nbsp;import&nbsp;IAddress&lt;br&gt;&lt;br&gt;class&nbsp;Controller(object):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;messageReceived(self,&nbsp;m,&nbsp;protocol,&nbsp;addr):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;print&nbsp;m,&nbsp;dir(m),&nbsp;m.queries,&nbsp;m.answers&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;tried&nbsp;all&nbsp;sorts&nbsp;of&nbsp;things&nbsp;here&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;protocol.transport.write(m.toStr(),&nbsp;addr)&lt;br&gt;&lt;br&gt;controller&nbsp;=&nbsp;Controller()&lt;br&gt;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;&amp;quot;__main__&amp;quot;:&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.listenUDP(53,&nbsp;DNSDatagramProtocol(controller))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reactor.run()&nbsp;&lt;br&gt;<br>

</tt>
