<tt>
Hi,&nbsp;all.&lt;div&gt;using&nbsp;PB&nbsp;i&nbsp;wanted&nbsp;to&nbsp;implement&nbsp;some&nbsp;access&nbsp;control&nbsp;check&nbsp;on&nbsp;my&nbsp;copyable&nbsp;objects.&lt;/div&gt;&lt;div&gt;so&nbsp;i&nbsp;placed&nbsp;that&nbsp;in&nbsp;getStateToCopyFor,&nbsp;all&nbsp;is&nbsp;ok&nbsp;except&nbsp;when&nbsp;i&nbsp;need&nbsp;to&nbsp;perfom&nbsp;some&nbsp;asynchronous&nbsp;call&nbsp;in&nbsp;that&nbsp;method.&lt;/div&gt;<br>
&lt;div&gt;ex:&nbsp;(i&nbsp;use&nbsp;twisted&nbsp;10.1.0)&lt;br&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;def&nbsp;getStateToCopyFor(self,&nbsp;user):&lt;/div&gt;&lt;div&gt; &nbsp;state&nbsp;=&nbsp;self.getStateToCopy()&lt;/div&gt;&lt;div&gt; &nbsp;d&nbsp;=&nbsp;user.has_perm()&nbsp; #&nbsp;this&nbsp;do&nbsp;an&nbsp;asynchronous&nbsp;call&lt;/div&gt;&lt;div&gt; &nbsp;def&nbsp;got_perm(allowed,&nbsp;state):&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;if&nbsp;not&nbsp;allowed:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;state[&#39;secret&#39;]&nbsp;=&nbsp;&#39;&#39;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;return&nbsp;state &lt;/div&gt;&lt;div&gt; &nbsp;d.addCallback(got_perm,&nbsp;state)&lt;/div&gt;&lt;div&gt; &nbsp;return&nbsp;d&lt;/div&gt;&lt;div&gt;...&nbsp; &lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;here&nbsp;user.has_perm&nbsp;performe&nbsp;a&nbsp;database&nbsp;access&nbsp;so&nbsp;it&nbsp;returns&nbsp;a&nbsp;deferred,&nbsp;but&nbsp;when&nbsp;i&nbsp;return&nbsp;that&nbsp;deferred,&nbsp;i&nbsp;got&nbsp;an&nbsp;error&nbsp;saying&nbsp;that&nbsp;&#39;state&#39;&nbsp;is&nbsp;not&nbsp;a&nbsp;dict&nbsp;(which&nbsp;is&nbsp;quit&nbsp;normal&nbsp;cause&nbsp;it&#39;s&nbsp;a&nbsp;deferred).&lt;/div&gt;<br>
&lt;div&gt;it&nbsp;seems&nbsp;pb&nbsp;do&nbsp;not&nbsp;handle&nbsp;this&nbsp;case,&nbsp;i&nbsp;know&nbsp;i&nbsp;can&nbsp;put&nbsp;my&nbsp;control&nbsp;logic&nbsp;directly&nbsp;in&nbsp;the&nbsp;view&nbsp;method&nbsp;(where&nbsp;returning&nbsp;a&nbsp;deferred&nbsp;is&nbsp;handled)&nbsp;but&nbsp;this&nbsp;will&nbsp;lead&nbsp;to&nbsp;a&nbsp;lot&nbsp;of&nbsp;code&nbsp;duplication,&nbsp;and&nbsp;i&nbsp;really&nbsp;thought&nbsp;that&nbsp;getStateToCopyFor&nbsp;is&nbsp;made&nbsp;for&nbsp;that&nbsp;purpouse.&lt;/div&gt;<br>
&lt;div&gt;so&nbsp;i&nbsp;wanted&nbsp;to&nbsp;ask&nbsp;what&#39;s&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;achieve&nbsp;that&nbsp;?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thankx&nbsp;!&lt;/div&gt;<br>

</tt>
