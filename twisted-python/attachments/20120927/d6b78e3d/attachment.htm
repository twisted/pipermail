<tt>
&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&gt;&lt;div&gt;Hi,&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;<br>
understand&nbsp;what&nbsp;will&nbsp;happen&nbsp;in&nbsp;my&nbsp;long-running&nbsp;twisted&nbsp;server&nbsp;program&nbsp;when&nbsp;the&nbsp;available&nbsp;memory&nbsp;is&nbsp;low.&nbsp;&lt;br&gt;&lt;br&gt;If&nbsp;I&nbsp;run&nbsp;the&nbsp;<br>
following&nbsp;program&nbsp;with&nbsp;increasing&nbsp;numeric&nbsp;seeds&nbsp;as&nbsp;arguments,&nbsp;0,&nbsp;1,&nbsp;2,&nbsp;3,&nbsp;<br>
4,&nbsp;…&nbsp;,&nbsp;some&nbsp;of&nbsp;the&nbsp;time<br>
the&nbsp;out&nbsp;of&nbsp;memory&nbsp;condition&nbsp;will&nbsp;crash&nbsp;and&nbsp;exit&nbsp;the&nbsp;program&nbsp;right&nbsp;away&nbsp;(when&nbsp;the&nbsp;MemoryError&nbsp;is&nbsp;raised&nbsp;inside&nbsp;<br>
twisted&nbsp;core&nbsp;code),&nbsp;and&nbsp;other&nbsp;times&nbsp;it&nbsp;will&nbsp;just&nbsp;carry&nbsp;on&nbsp;with&nbsp;an&nbsp;<br>
UnhandledError&nbsp;(if&nbsp;the&nbsp;MemoryError&nbsp;is&nbsp;raised&nbsp;inside&nbsp;my&nbsp;hi()&nbsp;function&nbsp;<br>
below).&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;Sample&nbsp;code:&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;br&gt;---&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;#!/usr/bin/env&nbsp;python&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;import&nbsp;sys,&nbsp;resource,&nbsp;random,&nbsp;traceback&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;from&nbsp;twisted.internet        &nbsp;import&nbsp;reactor&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;resource.setrlimit(resource.RLIMIT_AS,&nbsp;(180&nbsp;*&nbsp;1024&nbsp;*&nbsp;1024,&nbsp;resource.RLIM_INFINITY))&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;data&nbsp;=&nbsp;[]&lt;/div&gt;<br>
&lt;div&gt;random.seed(int(sys.argv[1]))&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;def&nbsp;hi():&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;data.append(&amp;#39;x&amp;#39;&nbsp;*&nbsp;random.randint(1,&nbsp;10000))&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;reactor.callLater(0,&nbsp;hi)&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;def&nbsp;main():&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;reactor.callLater(0,&nbsp;hi)&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;reactor.callWhenRunning(main)&lt;/div&gt;<br>
&lt;div&gt;reactor.run()&lt;/div&gt;<br>
&lt;div&gt; ---&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;am&nbsp;using&nbsp;python&nbsp;2.7.1,&nbsp;twisted&nbsp;11.0.0.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;Sample&nbsp;runs&nbsp;follow:&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
<br>
&lt;div&gt;bash$&nbsp;n=0;&nbsp;while&nbsp;true;&nbsp;do&nbsp;echo&nbsp;&amp;quot;starting&nbsp;rep&nbsp;$n&amp;quot;;&nbsp;./twisted-oom.py&nbsp;$n;&nbsp;n=$(($n+1));&nbsp;echo;&nbsp;done&lt;/div&gt;<br>
&lt;div&gt;starting&nbsp;rep&nbsp;0&lt;/div&gt;<br>
&lt;div&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;“./twisted-oom.py&amp;quot;,&nbsp;line&nbsp;21,&nbsp;in&nbsp;&amp;lt;module&amp;gt;&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;reactor.run()&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/sw/external/twisted-py27-11.0.0/lib/python/twisted/internet/base.py&amp;quot;,&nbsp;line&nbsp;1162,&nbsp;in&nbsp;run&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;self.mainLoop()&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/sw/external/twisted-py27-11.0.0/lib/python/twisted/internet/base.py&amp;quot;,&nbsp;line&nbsp;1177,&nbsp;in&nbsp;mainLoop&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;log.err()&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/sw/external/twisted-py27-11.0.0/lib/python/twisted/python/log.py&amp;quot;,&nbsp;line&nbsp;197,&nbsp;in&nbsp;err&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;_stuff&nbsp;=&nbsp;failure.Failure()&lt;/div&gt;<br>
&lt;div&gt;MemoryError&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;starting&nbsp;rep&nbsp;1&lt;/div&gt;<br>
&lt;div&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;.&nbsp;/twisted-oom.py&amp;quot;,&nbsp;line&nbsp;21,&nbsp;in&nbsp;&amp;lt;module&amp;gt;&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;reactor.run()&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/sw/external/twisted-py27-11.0.0/lib/python/twisted/internet/base.py&amp;quot;,&nbsp;line&nbsp;1162,&nbsp;in&nbsp;run&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;self.mainLoop()&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/sw/external/twisted-py27-11.0.0/lib/python/twisted/internet/base.py&amp;quot;,&nbsp;line&nbsp;1177,&nbsp;in&nbsp;mainLoop&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;log.err()&lt;/div&gt;<br>
&lt;div&gt;MemoryError&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;starting&nbsp;rep&nbsp;2&lt;/div&gt;<br>
&lt;div&gt;Unhandled&nbsp;Error&lt;/div&gt;<br>
&lt;div&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;./twisted-oom.py&amp;quot;,&nbsp;line&nbsp;21,&nbsp;in&nbsp;&amp;lt;module&amp;gt;&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;reactor.run()&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/sw/external/twisted-py27-11.0.0/lib/python/twisted/internet/base.py&amp;quot;,&nbsp;line&nbsp;1162,&nbsp;in&nbsp;run&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;self.mainLoop()&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/sw/external/twisted-py27-11.0.0/lib/python/twisted/internet/base.py&amp;quot;,&nbsp;line&nbsp;1171,&nbsp;in&nbsp;mainLoop&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;self.runUntilCurrent()&lt;/div&gt;<br>
&lt;div&gt;---&nbsp;&amp;lt;exception&nbsp;caught&nbsp;here&amp;gt;&nbsp;---&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/sw/external/twisted-py27-11.0.0/lib/python/twisted/internet/base.py&amp;quot;,&nbsp;line&nbsp;793,&nbsp;in&nbsp;runUntilCurrent&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;call.func(*call.args,&nbsp;**&lt;a&nbsp;href=&quot;http://call.kw&quot;&nbsp;target=&quot;_blank&quot;&gt;call.kw&lt;/a&gt;)&lt;/div&gt;<br>
&lt;div&gt; &nbsp;File&nbsp;&amp;quot;/home/ruttbe/dev/oneoff/twisted-oom.py&amp;quot;,&nbsp;line&nbsp;14,&nbsp;in&nbsp;hi&lt;/div&gt;<br>
&lt;div&gt;   &nbsp;data.append(&amp;#39;x&amp;#39;&nbsp;*&nbsp;random.randint(1,&nbsp;10000))&lt;/div&gt;<br>
&lt;div&gt;exceptions.MemoryError:&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;On&nbsp;the&nbsp;first&nbsp;two&nbsp;runs,&nbsp;the&nbsp;program&nbsp;exited&nbsp;quickly,&nbsp;but&nbsp;on&nbsp;the&nbsp;last&nbsp;rep&nbsp;<br>
(&amp;quot;starting&nbsp;rep&nbsp;2&amp;quot;),&nbsp;it&nbsp;just&nbsp;carried&nbsp;on&nbsp;running&nbsp;with&nbsp;the&nbsp;reactor&nbsp;still&nbsp;<br>
running. &nbsp;It&nbsp;<br>
would&nbsp;be&nbsp;nice&nbsp;if&nbsp;there&nbsp;was&nbsp;a&nbsp;way&nbsp;to&nbsp;make&nbsp;the&nbsp;out&nbsp;of&nbsp;memory&nbsp;behavior&nbsp;<br>
consistent,&nbsp;so&nbsp;I&nbsp;would&nbsp;know&nbsp;that&nbsp;it&nbsp;would&nbsp;either&nbsp;always&nbsp;carry&nbsp;on&nbsp;running<br>
&nbsp;with&nbsp;a&nbsp;<br>
MemoryError&nbsp;stack&nbsp;trace,&nbsp;or&nbsp;always&nbsp;crash&nbsp;out&nbsp;and&nbsp;end&nbsp;the&nbsp;program. &nbsp;Maybe<br>
&nbsp;runUntilCurrent<br>
should&nbsp;not&nbsp;catch&nbsp;MemoryError&nbsp;from&nbsp;user&nbsp;code&nbsp;and&nbsp;should&nbsp;let&nbsp;it&nbsp;propagate&nbsp;<br>
out? &nbsp;Also&nbsp;wondering&nbsp;if&nbsp;there&nbsp;<br>
are&nbsp;other&nbsp;different&nbsp;behaviors&nbsp;in&nbsp;other&nbsp;areas&nbsp;of&nbsp;the&nbsp;code&nbsp;(such&nbsp;as&nbsp;<br>
callbacks&nbsp;into&nbsp;user&nbsp;code&nbsp;such&nbsp;as&nbsp;dataReceived,&nbsp;outReceived,&nbsp;<br>
lineReceived,&nbsp;etc.). &nbsp;i.e.&nbsp;is&nbsp;the&nbsp;observed&nbsp;behavior&nbsp;(that&nbsp;MemoryError&nbsp;in<br>
&nbsp;user&nbsp;code&nbsp;is&nbsp;caught&nbsp;and&nbsp;MemoryError&nbsp;in&nbsp;twisted&nbsp;core&nbsp;is&nbsp;not)&nbsp;<br>
intentional,&nbsp;or&nbsp;an&nbsp;accident?&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;Thanks,&lt;br&gt;--&nbsp;&lt;br&gt;Benjamin&nbsp;Rutt&lt;br&gt;<br>
&lt;br&gt;<br>

</tt>
