<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Jan&nbsp;9,&nbsp;2017,&nbsp;at&nbsp;4:13&nbsp;AM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&nbsp;class=&quot;&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;9,&nbsp;2017&nbsp;at&nbsp;4:52&nbsp;AM,&nbsp;Glyph&nbsp;Lefkowitz&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;Jan&nbsp;8,&nbsp;2017,&nbsp;at&nbsp;4:34&nbsp;PM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;gmail-m_4897655694086818359Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;style=&quot;font-family:menlo-regular;font-size:12px;font-style:normal;font-variant-caps:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px&quot;&nbsp;class=&quot;&quot;&gt;Here's&nbsp;one&nbsp;example&nbsp;I&nbsp;know&nbsp;of&nbsp;off&nbsp;the&nbsp;top&nbsp;of&nbsp;my&nbsp;head,&nbsp;&lt;&lt;a&nbsp;href=&quot;https://github.com/ScatterHQ/flocker/blob/master/flocker/restapi/testtools.py#L316&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/ScatterHQ/&lt;wbr&nbsp;class=&quot;&quot;&gt;flocker/blob/master/flocker/&lt;wbr&nbsp;class=&quot;&quot;&gt;restapi/testtools.py#L316&lt;/a&gt;&gt;.&nbsp;&nbsp;This&nbsp;one&nbsp;isn't&nbsp;a&nbsp;from-scratch&nbsp;re-implementation&nbsp;of&nbsp;the&nbsp;implicit&nbsp;Request&nbsp;interface&nbsp;but&nbsp;a&nbsp;Request&nbsp;subclass,&nbsp;instead.&nbsp;&nbsp;However,&nbsp;it&nbsp;still&nbsp;interacts&nbsp;with&nbsp;a&nbsp;lot&nbsp;of&nbsp;important&nbsp;pieces&nbsp;of&nbsp;Request&nbsp;which&nbsp;aren't&nbsp;part&nbsp;of&nbsp;IRequest.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Mark&nbsp;already&nbsp;addressed&nbsp;how&nbsp;he&nbsp;won't&nbsp;be&nbsp;breaking&nbsp;this&nbsp;use-case&nbsp;(which&nbsp;is&nbsp;hugely&nbsp;important,&nbsp;and&nbsp;core&nbsp;to&nbsp;the&nbsp;whole&nbsp;idea&nbsp;of&nbsp;a&nbsp;compatibility&nbsp;policy,&nbsp;so&nbsp;that&nbsp;is&nbsp;as&nbsp;it&nbsp;should&nbsp;be).&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;However,&nbsp;this&nbsp;kind&nbsp;of&nbsp;test-mocking&nbsp;is,&nbsp;I&nbsp;think,&nbsp;ultimately&nbsp;done&nbsp;at&nbsp;the&nbsp;wrong&nbsp;layer.&nbsp;&nbsp;It's&nbsp;trying&nbsp;to&nbsp;override&nbsp;some&nbsp;very&nbsp;vaguely-specified&nbsp;internals&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;an&nbsp;implementation.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Absolutely.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Yay!&nbsp;Glad&nbsp;to&nbsp;have&nbsp;some&nbsp;consensus&nbsp;on&nbsp;this.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Really,&nbsp;twisted.web&nbsp;should&nbsp;provide&nbsp;its&nbsp;own&nbsp;testing&nbsp;tools,&nbsp;of&nbsp;course.&nbsp;&nbsp;But&nbsp;if&nbsp;you're&nbsp;going&nbsp;to&nbsp;implement&nbsp;something&nbsp;that&nbsp;does&nbsp;this&nbsp;sort&nbsp;of&nbsp;overriding,&nbsp;I&nbsp;think&nbsp;the&nbsp;idiom&nbsp;to&nbsp;follow&nbsp;would&nbsp;be&nbsp;treq.testing:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/twisted/treq/blob/fcf5deb976c955ca6ef6484f414d25839932940e/src/treq/testing.py&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;https://github.&lt;wbr&nbsp;class=&quot;&quot;&gt;com/twisted/treq/blob/&lt;wbr&nbsp;class=&quot;&quot;&gt;fcf5deb976c955ca6ef6484f414d25&lt;wbr&nbsp;class=&quot;&quot;&gt;839932940e/src/treq/testing.py&lt;/a&gt;&lt;wbr&nbsp;class=&quot;&quot;&gt;,&nbsp;rather&nbsp;than&nbsp;any&nbsp;of&nbsp;the&nbsp;various&nbsp;implementations&nbsp;of&nbsp;DummyRequest&nbsp;(including&nbsp;more&nbsp;than&nbsp;a&nbsp;few&nbsp;I'm&nbsp;sure&nbsp;I've&nbsp;written).&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Though,&nbsp;note,&nbsp;the&nbsp;link&nbsp;I&nbsp;gave&nbsp;above&nbsp;was&nbsp;support&nbsp;code&nbsp;for&nbsp;something&nbsp;very&nbsp;similar&nbsp;to&nbsp;this&nbsp;treq&nbsp;code:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/ScatterHQ/flocker/blob/master/flocker/restapi/testtools.py#L460&quot;&nbsp;class=&quot;&quot;&gt;https://github.com/ScatterHQ/flocker/blob/master/flocker/restapi/testtools.py#L460&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;To&nbsp;clarify&nbsp;your&nbsp;point&nbsp;a&nbsp;bit&nbsp;(I&nbsp;think):&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;ul&nbsp;class=&quot;&quot;&gt;&lt;li&nbsp;class=&quot;&quot;&gt;MemoryAgent&nbsp;(from&nbsp;Flocker)&nbsp;provides&nbsp;a&nbsp;testing&nbsp;IAgent&nbsp;by&nbsp;implementing&nbsp;an&nbsp;IRequest&nbsp;that&nbsp;does&nbsp;in-memory&nbsp;resource&nbsp;traversal&nbsp;to&nbsp;dispatch&nbsp;requests&nbsp;and&nbsp;generate&nbsp;responses.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/li&gt;&lt;li&nbsp;class=&quot;&quot;&gt;RequestTraversalAgent&nbsp;(from&nbsp;treq)&nbsp;provides&nbsp;a&nbsp;testing&nbsp;IAgent&nbsp;by&nbsp;implementing&nbsp;(using)&nbsp;iosim&nbsp;to&nbsp;do&nbsp;in-memory&nbsp;protocol/transport&nbsp;interacts&nbsp;to&nbsp;drive&nbsp;an&nbsp;in-memory&nbsp;HTTP&nbsp;conversation&nbsp;that&nbsp;runs&nbsp;all&nbsp;of&nbsp;the&nbsp;regular&nbsp;Twisted&nbsp;Web&nbsp;HTTP&nbsp;processing&nbsp;machinery.&lt;/li&gt;&lt;/ul&gt;&lt;div&nbsp;class=&quot;&quot;&gt;RequestTraversalAgent's&nbsp;approach&nbsp;is&nbsp;better&nbsp;because&nbsp;the&nbsp;protocol/transport&nbsp;interface&nbsp;is&nbsp;better&nbsp;defined.&nbsp;&nbsp;Because&nbsp;it's&nbsp;better&nbsp;defined,&nbsp;RequestTraversalAgent&nbsp;doesn't&nbsp;have&nbsp;to&nbsp;touch&nbsp;pieces&nbsp;that&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;consider&nbsp;implementation&nbsp;details&nbsp;(whether&nbsp;they're&nbsp;_-prefixed&nbsp;or&nbsp;not).&nbsp;&nbsp;It&nbsp;also&nbsp;invokes&nbsp;a&nbsp;larger&nbsp;portion&nbsp;of&nbsp;the&nbsp;real&nbsp;implementation&nbsp;code&nbsp;making&nbsp;it&nbsp;more&nbsp;likely&nbsp;to&nbsp;be&nbsp;a&nbsp;realistic&nbsp;simulation&nbsp;of&nbsp;real-world&nbsp;use&nbsp;of&nbsp;the&nbsp;code.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;100%&nbsp;agree.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Having&nbsp;spelled&nbsp;this&nbsp;out,&nbsp;what&nbsp;occurs&nbsp;to&nbsp;me&nbsp;now&nbsp;is&nbsp;that&nbsp;RequestTraversalAgent&nbsp;is&nbsp;really&nbsp;just&nbsp;a&nbsp;step&nbsp;or&nbsp;so&nbsp;up&nbsp;the&nbsp;ladder&nbsp;and&nbsp;there's&nbsp;further&nbsp;to&nbsp;go.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;generally&lt;/i&gt;&nbsp;agree&nbsp;with&nbsp;this&nbsp;next&nbsp;bit,&nbsp;but&nbsp;I&nbsp;have&nbsp;my&nbsp;own&nbsp;spin.&nbsp;&nbsp;So,&nbsp;one&nbsp;point&nbsp;at&nbsp;a&nbsp;time:&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;For&nbsp;example,&nbsp;RequestTraversalAgent&nbsp;only&nbsp;needs&nbsp;to&nbsp;exist&nbsp;at&nbsp;all&nbsp;because&nbsp;`iosim`&nbsp;has&nbsp;a&nbsp;distinct&nbsp;interface.&nbsp;&nbsp;This&nbsp;distinct&nbsp;interface&nbsp;means&nbsp;you&nbsp;need&nbsp;a&nbsp;RequestTraversalAgent-like&nbsp;thing&nbsp;for&nbsp;each&nbsp;reactor-using&nbsp;thing&nbsp;for&nbsp;which&nbsp;you&nbsp;want&nbsp;to&nbsp;provide&nbsp;a&nbsp;test&nbsp;double.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;that&nbsp;there&nbsp;are&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;pieces&lt;/i&gt;&nbsp;of&nbsp;RequestTraversalAgent&nbsp;for&nbsp;which&nbsp;this&nbsp;is&nbsp;true;&nbsp;the&nbsp;parts&nbsp;where&nbsp;it&nbsp;has&nbsp;to&nbsp;instantiate&nbsp;its&nbsp;own&nbsp;FakeTransport&nbsp;objects&nbsp;and&nbsp;IPv4Addresses&nbsp;and&nbsp;whatever.&nbsp;&nbsp;This&nbsp;could&nbsp;be&nbsp;streamlined&nbsp;a&nbsp;lot&nbsp;more.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;at&nbsp;the&nbsp;higher&nbsp;level,&nbsp;each&nbsp;layer&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;will&lt;/i&gt;&nbsp;want&nbsp;its&nbsp;own&nbsp;public&nbsp;API&nbsp;entrypoint,&nbsp;to&nbsp;facilitate&nbsp;the&nbsp;orchestration&nbsp;and&nbsp;setup&nbsp;of&nbsp;domain-specific&nbsp;client/server&nbsp;objects&nbsp;and&nbsp;reduce&nbsp;boilerplate&nbsp;for&nbsp;testing&nbsp;at&nbsp;a&nbsp;given&nbsp;level.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;If&nbsp;this&nbsp;adaption&nbsp;behavior&nbsp;were&nbsp;bundled&nbsp;up&nbsp;differently&nbsp;then&nbsp;I&nbsp;think&nbsp;we'd&nbsp;get&nbsp;a&nbsp;lot&nbsp;more&nbsp;in-memory&nbsp;test&nbsp;doubles&nbsp;for&nbsp;free&nbsp;(or&nbsp;closer&nbsp;to&nbsp;it&nbsp;-&nbsp;we'd&nbsp;be&nbsp;another&nbsp;rung&nbsp;up&nbsp;the&nbsp;ladder,&nbsp;at&nbsp;least).&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;I&nbsp;definitely&nbsp;agree&nbsp;with.&nbsp;&nbsp;Each&nbsp;abstraction-level-specific&nbsp;fake&nbsp;should&nbsp;be&nbsp;a&nbsp;paper-thin&nbsp;layer&nbsp;over&nbsp;the&nbsp;one&nbsp;below,&nbsp;and&nbsp;each&nbsp;abstraction&nbsp;layer&nbsp;should&nbsp;cover&nbsp;a&nbsp;fair&nbsp;amount&nbsp;of&nbsp;ground&nbsp;for&nbsp;itself.&nbsp;&nbsp;For&nbsp;example,&nbsp;you&nbsp;can&nbsp;test&nbsp;Klein&nbsp;apps&nbsp;trivially&nbsp;with&nbsp;treq.testing,&nbsp;without&nbsp;adding&nbsp;very&nbsp;much&nbsp;extra&nbsp;logic&nbsp;at&nbsp;all.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;That&nbsp;seems&nbsp;like&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;big&nbsp;win&nbsp;given&nbsp;how&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;few&lt;/i&gt;&nbsp;of&nbsp;these&nbsp;testing&nbsp;helpers&nbsp;Twisted&nbsp;has&nbsp;historically&nbsp;managed&nbsp;to&nbsp;provide&nbsp;(suggesting&nbsp;it's&nbsp;just&nbsp;too&nbsp;hard&nbsp;to&nbsp;do&nbsp;so&nbsp;given&nbsp;the&nbsp;current&nbsp;tools).&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;I&nbsp;think&nbsp;there&nbsp;are&nbsp;a&nbsp;few&nbsp;mitigating&nbsp;factors:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&nbsp;class=&quot;MailOutline&quot;&gt;&lt;li&nbsp;class=&quot;&quot;&gt;I&nbsp;don't&nbsp;actually&nbsp;think&nbsp;that&nbsp;it's&nbsp;that&nbsp;hard&nbsp;using&nbsp;current&nbsp;tools.&nbsp;&nbsp;It's&nbsp;pretty&nbsp;easy,&nbsp;in&nbsp;fact,&nbsp;to&nbsp;build&nbsp;up&nbsp;from&nbsp;the&nbsp;bottom&nbsp;and&nbsp;layer&nbsp;subsequent&nbsp;things&nbsp;on&nbsp;top&nbsp;of&nbsp;another.&lt;/li&gt;&lt;li&nbsp;class=&quot;&quot;&gt;The&nbsp;way&nbsp;I&nbsp;see&nbsp;the&nbsp;problem&nbsp;that&nbsp;we're&nbsp;facing&nbsp;is&nbsp;that&nbsp;we&nbsp;realized&nbsp;we&nbsp;should&nbsp;be&nbsp;doing&nbsp;this&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;many&lt;/i&gt;&nbsp;years&nbsp;after&nbsp;doing&nbsp;the&nbsp;actual&nbsp;implementation,&nbsp;and&nbsp;we&nbsp;realized&nbsp;this&nbsp;several&nbsp;layers&nbsp;up.&nbsp;&nbsp;So&nbsp;we&nbsp;built&nbsp;mid-tier&nbsp;test&nbsp;mocks&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;build&nbsp;on&nbsp;top&nbsp;of&nbsp;them,&nbsp;rather&nbsp;than&nbsp;heading&nbsp;straight&nbsp;for&nbsp;the&nbsp;bottom&nbsp;layer.&nbsp;&nbsp;This&nbsp;has&nbsp;lead&nbsp;to&nbsp;awkwardness&nbsp;like&nbsp;needing&nbsp;to&nbsp;monkeypatch&nbsp;HostnameEndpoint&nbsp;to&nbsp;avoid&nbsp;deferToThread&nbsp;calls.&lt;/li&gt;&lt;li&nbsp;class=&quot;&quot;&gt;So,&nbsp;even&nbsp;now,&nbsp;we&nbsp;have&nbsp;an&nbsp;anemic&nbsp;bottom&nbsp;layer.&nbsp;&nbsp;task.Clock&nbsp;is&nbsp;pretty&nbsp;good,&nbsp;but&nbsp;MemoryReactor&nbsp;still&nbsp;leaves&nbsp;a&nbsp;lot&nbsp;to&nbsp;be&nbsp;desired.&lt;/li&gt;&lt;li&nbsp;class=&quot;&quot;&gt;Therefore,&nbsp;I&nbsp;don't&nbsp;think&nbsp;that&nbsp;we&nbsp;really&nbsp;need&nbsp;to&nbsp;build&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;that&nbsp;many&lt;/i&gt;&nbsp;different&nbsp;abstraction&nbsp;layers;&nbsp;if&nbsp;we&nbsp;really&nbsp;focus&nbsp;on&nbsp;nailing&nbsp;down&nbsp;(A)&nbsp;MemoryReactor+iosim+something&nbsp;with&nbsp;addresses&nbsp;so&nbsp;'connectTCP'&nbsp;can&nbsp;be&nbsp;hooked&nbsp;up&nbsp;to&nbsp;'listenTCP'&nbsp;when&nbsp;both&nbsp;are&nbsp;given&nbsp;the&nbsp;same&nbsp;address,&nbsp;and&nbsp;(B)&nbsp;the&nbsp;vast&nbsp;majority&nbsp;of&nbsp;what&nbsp;folks&nbsp;want&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;test&nbsp;is&nbsp;HTTP&nbsp;API&nbsp;type&nbsp;stuff,&nbsp;so&nbsp;integrating&nbsp;treq.testing&nbsp;(treq&nbsp;is&nbsp;license-compatible,&nbsp;so&nbsp;we&nbsp;can&nbsp;just&nbsp;move&nbsp;the&nbsp;code&nbsp;if&nbsp;we&nbsp;want)&nbsp;would&nbsp;get&nbsp;us&nbsp;a&nbsp;_long_&nbsp;way&nbsp;there,&nbsp;and&nbsp;would&nbsp;popularize&nbsp;this&nbsp;style&nbsp;with&nbsp;a&nbsp;lot&nbsp;of&nbsp;other&nbsp;developers&nbsp;who&nbsp;might&nbsp;then&nbsp;be&nbsp;motivated&nbsp;to&nbsp;help&nbsp;improve&nbsp;the&nbsp;more&nbsp;obscure&nbsp;corners,&nbsp;like,&nbsp;say,&nbsp;DNS.&lt;/li&gt;&lt;/ol&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I've&nbsp;been&nbsp;slowly&nbsp;improving&nbsp;the&nbsp;testability&nbsp;of&nbsp;Twisted's&nbsp;core;&nbsp;the&nbsp;recent&nbsp;name-resolver&nbsp;change&nbsp;made&nbsp;a&nbsp;LOT&nbsp;of&nbsp;things&nbsp;easier.&nbsp;&nbsp;We&nbsp;should&nbsp;be&nbsp;making&nbsp;deterministicResolvingReactor&nbsp;and&nbsp;twisted.threads&nbsp;(along&nbsp;with&nbsp;MemoryWorker)&nbsp;public,&nbsp;and&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;circuitous&nbsp;routes&nbsp;that&nbsp;higher-level&nbsp;code&nbsp;needed&nbsp;to&nbsp;traverse&nbsp;to&nbsp;get&nbsp;to&nbsp;&quot;no&nbsp;I/O&quot;&nbsp;will&nbsp;just&nbsp;go&nbsp;away.&nbsp;&nbsp;I'm&nbsp;probably&nbsp;forgetting&nbsp;a&nbsp;few&nbsp;other&nbsp;building&nbsp;blocks,&nbsp;but&nbsp;I've&nbsp;noticed&nbsp;that&nbsp;each&nbsp;additional&nbsp;one&nbsp;that&nbsp;I&nbsp;remove&nbsp;makes&nbsp;the&nbsp;task&nbsp;more&nbsp;like&nbsp;exponentially&nbsp;than&nbsp;linearly&nbsp;easier.&lt;/div&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;This&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;ideas&nbsp;that&nbsp;I've&nbsp;been&nbsp;gradually&nbsp;arriving&nbsp;at&nbsp;over&nbsp;a&nbsp;long&nbsp;period&nbsp;of&nbsp;time,&nbsp;but&nbsp;it's&nbsp;probably&nbsp;high&nbsp;time&nbsp;for&nbsp;some&nbsp;public&nbsp;discussion&nbsp;by&nbsp;now,&nbsp;even&nbsp;if&nbsp;it's&nbsp;just&nbsp;everybody&nbsp;saying&nbsp;&quot;yeah,&nbsp;that&nbsp;sounds&nbsp;good&quot;&nbsp;:-).&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;So,&nbsp;it&nbsp;pretty&nbsp;much&nbsp;sounds&nbsp;good,&nbsp;though&nbsp;with&nbsp;the&nbsp;above&nbsp;refinements.&nbsp;:)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Cool.&nbsp;&nbsp;I&nbsp;suspect&nbsp;I&nbsp;haven't&nbsp;even&nbsp;covered&nbsp;all&nbsp;of&nbsp;it&nbsp;with&nbsp;my&nbsp;refine-refinements&nbsp;above,&nbsp;but&nbsp;at&nbsp;this&nbsp;point&nbsp;it&nbsp;seems&nbsp;clear&nbsp;we&nbsp;can&nbsp;all&nbsp;pull&nbsp;in&nbsp;the&nbsp;same&nbsp;direction.&nbsp;&nbsp;I&nbsp;wonder&nbsp;if&nbsp;a&nbsp;themed&nbsp;sprint&nbsp;at&nbsp;some&nbsp;point&nbsp;in&nbsp;the&nbsp;next&nbsp;year&nbsp;might&nbsp;be&nbsp;worthwhile?&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;a&nbsp;related&nbsp;note,&nbsp;'proto_helpers'&nbsp;is&nbsp;in&nbsp;a&nbsp;super&nbsp;awkward&nbsp;place.&nbsp;&nbsp;'twisted.testing',&nbsp;anyone?&nbsp;:)&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Yes.&nbsp;&nbsp;I&nbsp;almost&nbsp;suggested&nbsp;this&nbsp;about&nbsp;a&nbsp;week&nbsp;ago&nbsp;when&nbsp;I&nbsp;was&nbsp;preparing&nbsp;to&nbsp;contribute&nbsp;some&nbsp;testing&nbsp;code&nbsp;but&nbsp;then&nbsp;realized&nbsp;I&nbsp;couldn't&nbsp;contribute&nbsp;the&nbsp;code&nbsp;after&nbsp;all.&nbsp;:(&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Well,&nbsp;now&nbsp;it's&nbsp;just&nbsp;a&nbsp;matter&nbsp;of&nbsp;time&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;-g&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
