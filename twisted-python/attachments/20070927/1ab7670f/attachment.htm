<tt>
<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;After&nbsp;much&nbsp;wrangling&nbsp;and&nbsp;a&nbsp;small&nbsp;miracle&nbsp;I&nbsp;have&nbsp;managed<br>
to&nbsp;write&nbsp;an&nbsp;object&nbsp;that&nbsp;fetches&nbsp;the&nbsp;output&nbsp;of&nbsp;three&nbsp;commands&nbsp;in&nbsp;the&nbsp;order<br>
given&nbsp;through&nbsp;an&nbsp;SSH&nbsp;connection.&nbsp;How&nbsp;come&nbsp;I&nbsp;cannot&nbsp;switch&nbsp;users?&nbsp;Some&nbsp;of<br>
the&nbsp;information&nbsp;I&nbsp;need&nbsp;can&nbsp;only&nbsp;be&nbsp;fetched&nbsp;through&nbsp;a&nbsp;root&nbsp;account&nbsp;and&nbsp;security<br>
is&nbsp;such&nbsp;that&nbsp;I&nbsp;cannot&nbsp;log&nbsp;in&nbsp;remotely&nbsp;from&nbsp;a&nbsp;root&nbsp;account&nbsp;but&nbsp;must&nbsp;switch<br>
once&nbsp;logged&nbsp;in&nbsp;from&nbsp;an&nbsp;account&nbsp;with&nbsp;less&nbsp;than&nbsp;root&nbsp;privileges.&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;Here's&nbsp;the&nbsp;line&nbsp;that&nbsp;instaniates&nbsp;my&nbsp;SSH&nbsp;object&nbsp;(also<br>
repeated&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;my&nbsp;code):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;myssh&nbsp;=&nbsp;SSH(&amp;quot;my.host.com&amp;quot;,&nbsp;&amp;quot;myusername&amp;quot;,<br>
&amp;quot;mypasswd&amp;quot;,&nbsp;[&amp;quot;id;&nbsp;su&nbsp;-&nbsp;root;&nbsp;myrootpasswd;&nbsp;id&amp;quot;,&nbsp;&amp;quot;pwd&amp;quot;,<br>
&amp;quot;ls&nbsp;-l&amp;quot;])&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;The&nbsp;last&nbsp;argument&nbsp;above&nbsp;is&nbsp;a&nbsp;&amp;nbsp;list&nbsp;of&nbsp;three&nbsp;commands.<br>
Inside&nbsp;one&nbsp;command&nbsp;&amp;quot;;&amp;quot;&nbsp;separates&nbsp;the&nbsp;piece&nbsp;parts.&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;I&nbsp;am&nbsp;not&nbsp;even&nbsp;able&nbsp;to&nbsp;su&nbsp;to&nbsp;accounts&nbsp;that&nbsp;don't&nbsp;require<br>
a&nbsp;password.&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;###=========&nbsp;CODE&nbsp;STARTS&nbsp;================###&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;from&nbsp;twisted.conch&nbsp;import&nbsp;error&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;from&nbsp;twisted.conch.ssh&nbsp;import&nbsp;transport,&nbsp;connection,<br>
keys,&nbsp;userauth,&nbsp;channel,&nbsp;common&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;defer,&nbsp;protocol,&nbsp;reactor&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;import&nbsp;sys,&nbsp;getpass,&nbsp;os,&nbsp;string&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;class&nbsp;ClientCommandTransport(transport.SSHClientTransport):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;username,&nbsp;password,<br>
cmds,&nbsp;caller):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.username&nbsp;=&nbsp;username&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.password&nbsp;=&nbsp;password&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.cmds&nbsp;=&nbsp;cmds&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller&nbsp;=&nbsp;caller&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;verifyHostKey(self,&nbsp;pubKey,&nbsp;fingerprint):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#&nbsp;in&nbsp;a&nbsp;real&nbsp;app,&nbsp;you&nbsp;should<br>
verify&nbsp;that&nbsp;the&nbsp;fingerprint&nbsp;matches&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#&nbsp;the&nbsp;one&nbsp;you&nbsp;expected<br>
to&nbsp;get&nbsp;from&nbsp;this&nbsp;server&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;defer.succeed(True)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;connectionSecure(self):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.requestService(PasswordAuth(self.username,<br>
self.password,&nbsp;ClientConnection(self.cmds,&nbsp;self.caller)))&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;class&nbsp;PasswordAuth(userauth.SSHUserAuthClient):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;user,&nbsp;password,&nbsp;connection):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;userauth.SSHUserAuthClient.__init__(self,<br>
user,&nbsp;connection)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.password&nbsp;=&nbsp;password&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;getPassword(self,&nbsp;prompt=None):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;defer.succeed(self.password)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;class&nbsp;ClientConnection(connection.SSHConnection):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;cmds,&nbsp;caller,&nbsp;*args,<br>
**kwargs):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;connection.SSHConnection.__init__(self)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.cmds&nbsp;=&nbsp;cmds&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller&nbsp;=&nbsp;caller&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#======================&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;serviceStarted(self):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d&nbsp;=&nbsp;defer.Deferred()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addCallback(self._cbFirst)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addErrback(self._ebFirst)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.openChannel(CommandChannel(self.cmds[0],<br>
lastcmd=0,&nbsp;conn=self))&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;_cbFirst(self,&nbsp;result):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#print&nbsp;'CALLBACK&nbsp;Result<br>
1:',&nbsp;result&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller.responses.append(result.rstrip())&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d&nbsp;=&nbsp;defer.Deferred()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addCallback(self._cbSecond)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addErrback(self._ebSecond)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.openChannel(CommandChannel(self.cmds[1],<br>
lastcmd=0,&nbsp;conn=self))&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;_ebFirst(self,&nbsp;f):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller.responses.append(None)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;Error&nbsp;1&amp;quot;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d&nbsp;=&nbsp;defer.Deferred()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addCallback(self._cbSecond)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addErrback(self._ebSecond)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.openChannel(CommandChannel(self.cmds[1],<br>
lastcmd=0,&nbsp;conn=self))&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#log.err()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;_cbSecond(self,&nbsp;result):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#print&nbsp;'CALLBACK&nbsp;Result<br>
2:',&nbsp;result&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller.responses.append(result.rstrip())&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d&nbsp;=&nbsp;defer.Deferred()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addCallback(self._cbThird)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addErrback(self._ebThird)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.openChannel(CommandChannel(self.cmds[2],<br>
lastcmd=1,&nbsp;conn=self))&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;_ebSecond(self,&nbsp;f):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller.responses.append(None)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d&nbsp;=&nbsp;defer.Deferred()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addCallback(self._cbThird)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.d.addErrback(self._ebThird)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.openChannel(CommandChannel(self.cmds[2],<br>
lastcmd=1,&nbsp;conn=self))&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#log.err()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;_cbThird(self,&nbsp;result):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller.responses.append(result.rstrip())&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#print&nbsp;'CALLBACK&nbsp;Result<br>
3:',&nbsp;result&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;reactor.stop()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;_ebThird(self,&nbsp;f):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller.responses.append(None)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;log.err()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;reactor.stop()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#======================&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;class&nbsp;CommandChannel(channel.SSHChannel):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;name&nbsp;=&nbsp;'session'&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;command,&nbsp;lastcmd,<br>
*args,&nbsp;**kwargs):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;channel.SSHChannel.__init__(self,<br>
*args,&nbsp;**kwargs)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.command&nbsp;=&nbsp;command&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.lastcmd&nbsp;=&nbsp;lastcmd&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.data&nbsp;=&nbsp;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;channelOpen(self,&nbsp;data):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.conn.sendRequest(self,<br>
'exec',&nbsp;common.NS(self.command),&nbsp;wantReply=True).addCallback(self._gotResponse)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;_gotResponse(self,&nbsp;_):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#print&nbsp;&amp;quot;RESPONSE&amp;quot;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.conn.sendEOF(self)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;dataReceived(self,&nbsp;data):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#print&nbsp;&amp;quot;Data&nbsp;Received:&amp;quot;,<br>
data&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.data&nbsp;+=&nbsp;data&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;closed(self):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.conn.d.callback(self.data)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.loseConnection()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;##&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;<br>
&amp;nbsp;if&nbsp;self.lastcmd:&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;##&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;print&nbsp;&amp;quot;closing&nbsp;reactor.&amp;quot;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;##&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;reactor.stop()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;class&nbsp;ClientCommandFactory(protocol.ClientFactory):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;username,&nbsp;password,<br>
cmds,&nbsp;caller):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.username&nbsp;=&nbsp;username&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.password&nbsp;=&nbsp;password&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.cmds&nbsp;=&nbsp;cmds&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.caller&nbsp;=&nbsp;caller&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;buildProtocol(self,&nbsp;addr):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;protocol&nbsp;=&nbsp;ClientCommandTransport(self.username,<br>
self.password,&nbsp;self.cmds,&nbsp;self.caller)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;protocol&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;class&nbsp;SSH():&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;quot;&amp;quot;&amp;quot;&nbsp;Contains&nbsp;a&nbsp;SSH&nbsp;connection,<br>
runs&nbsp;commands,&nbsp;and&nbsp;stores&nbsp;results.&nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;host,&nbsp;username,&nbsp;password,<br>
cmds):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.host&nbsp;=&nbsp;host&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.username&nbsp;=&nbsp;username&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.password&nbsp;=&nbsp;password&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.cmds&nbsp;=&nbsp;cmds&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.responses&nbsp;=&nbsp;[]&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.run_commands()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;run_commands(self):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;factory&nbsp;=&nbsp;ClientCommandFactory(self.username,<br>
self.password,&nbsp;self.cmds,&nbsp;self)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;reactor.connectTCP(self.host,<br>
22,&nbsp;factory)&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;reactor.run()&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;myssh&nbsp;=&nbsp;SSH(&amp;quot;my.host.com&amp;quot;,&nbsp;&amp;quot;myacct&amp;quot;,<br>
&amp;quot;mypasswd&amp;quot;,&nbsp;[&amp;quot;id;&nbsp;su&nbsp;-&nbsp;root;&nbsp;myrootpasswd;&nbsp;id&amp;quot;,&nbsp;&amp;quot;pwd&amp;quot;,<br>
&amp;quot;ls&nbsp;-l&amp;quot;])&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;print&nbsp;&amp;quot;=&amp;quot;&nbsp;*&nbsp;25&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;for&nbsp;i,&nbsp;response&nbsp;in&nbsp;enumerate(myssh.responses):&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;print&nbsp;i,&nbsp;response&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;=&amp;quot;&nbsp;*&nbsp;25&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;print&nbsp;&amp;quot;\nDone.&amp;quot;&lt;/font&gt;&lt;/tt&gt;
</tt>
