<tt>
&lt;div&gt;I&nbsp;changed&nbsp;my&nbsp;code&nbsp;to&nbsp;this&nbsp;style,&nbsp;it&nbsp;works&nbsp;again.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;code&nbsp;would&nbsp;create&nbsp;a&nbsp;new&nbsp;session&nbsp;on&nbsp;each&nbsp;request&nbsp;and&nbsp;close&nbsp;it&nbsp;immediately.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hope&nbsp;this&nbsp;trick&nbsp;could&nbsp;save&nbsp;me!&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;#=========================================&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;def&nbsp;require_session(f):&lt;/div&gt;&lt;div&gt;  &nbsp; &#39;&#39;&#39;create&nbsp;and&nbsp;close&nbsp;session&nbsp;for&nbsp;each&nbsp;synchronous&nbsp;method&#39;&#39;&#39;&lt;/div&gt;&lt;div&gt;  &nbsp; def&nbsp;wrapper(model,&nbsp;*args,&nbsp;**kw):&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; sess&nbsp;=&nbsp;model.Session()&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; try:&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;f(model,&nbsp;sess,&nbsp;*args,&nbsp;**kw)&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; finally:&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sess.close()&lt;/div&gt;&lt;div&gt;  &nbsp; return&nbsp;wrapper&lt;/div&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&nbsp;font-size:&nbsp;18px;&nbsp;&quot;&gt;&lt;p&gt;class&nbsp;Database() &lt;br&gt; &nbsp; &nbsp;def&nbsp;__init__(self,&nbsp;conn_str): &lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.conn_str&nbsp;=&nbsp;conn_str &lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.engine&nbsp;=&nbsp;create_engine(self.conn_str,&nbsp;echo=False) &lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;self.Session&nbsp;=&nbsp;sessionmaker(bind&nbsp;=&nbsp;self.engine,  expire_on_commit=False)&lt;br&gt;&lt;/p&gt;&lt;p&gt; &nbsp; &nbsp;def&nbsp;getObjectById(self,&nbsp;klass,&nbsp;id): &lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;threads.deferToThread(self._getObjectById,&nbsp;klass,&nbsp;id) &lt;br&gt;&lt;/p&gt;&lt;p&gt;  &nbsp; @&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;separate;&nbsp;font-size:&nbsp;20px;&nbsp;&quot;&gt;require_session&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&nbsp;font-size:&nbsp;18px;&nbsp;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;separate;&nbsp;font-size:&nbsp;20px;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&nbsp;font-size:&nbsp;18px;&nbsp;&quot;&gt;  &nbsp; def&nbsp;_getObjectById(self,&nbsp;sess,&nbsp;klass,&nbsp;id): &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;separate;&nbsp;font-size:&nbsp;20px;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&nbsp;font-size:&nbsp;18px;&nbsp;&quot;&gt;  &nbsp; &nbsp; &nbsp; return&nbsp;sess.query(klass).get(id) &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;/span&gt;&lt;/div&gt;#=========================================&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Mar&nbsp;5,&nbsp;2009&nbsp;at&nbsp;4:29&nbsp;AM,&nbsp;Valentino&nbsp;Volonghi&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:dialtone@gmail.com&quot;&gt;dialtone@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&lt;br&gt;<br>
Hash:&nbsp;SHA1&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
On&nbsp;Mar&nbsp;4,&nbsp;2009,&nbsp;at&nbsp;11:15&nbsp;AM,&nbsp;Chris&nbsp;Foster&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;think&nbsp;SQLAlchemy&#39;s&nbsp;ORM&nbsp;might&nbsp;work&nbsp;fine&nbsp;with&nbsp;Twisted.&nbsp; Check&nbsp;out&nbsp;&lt;a&nbsp;href=&quot;http://foss.eepatents.com/sAsync/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://foss.eepatents.com/sAsync/&lt;/a&gt; .&nbsp; sAsync&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;widely&nbsp;used,&nbsp;but&nbsp;I&nbsp;got&nbsp;the&nbsp;examples&nbsp;to&nbsp;run&nbsp;with&nbsp;some&nbsp;minor&nbsp;changes&nbsp;to&nbsp;the&nbsp;sqlite&nbsp;connection.&nbsp; I&#39;m&nbsp;hoping&nbsp;to&nbsp;try&nbsp;something&nbsp;useful&nbsp;in&nbsp;the&nbsp;next&nbsp;week&nbsp;or&nbsp;two.&lt;br&gt;<br>
<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
sAsync&nbsp;repository&nbsp;hasn&#39;t&nbsp;changed&nbsp;since&nbsp;about&nbsp;1&nbsp;or&nbsp;2&nbsp;years&nbsp;ago.&nbsp;Now&nbsp;sqlalchemy&nbsp;0.5&lt;br&gt;<br>
changed&nbsp;quite&nbsp;a&nbsp;bit&nbsp;of&nbsp;the&nbsp;internals&nbsp;and&nbsp;so&nbsp;on.&nbsp;Notice&nbsp;however&nbsp;that&nbsp;the&nbsp;tests&nbsp;for&lt;br&gt;<br>
sAsync&nbsp;use&nbsp;sqlite&nbsp;that&nbsp;is&nbsp;limited&nbsp;essentially&nbsp;to&nbsp;1&nbsp;connection,&nbsp;which&nbsp;goes&nbsp;back&nbsp;to&lt;br&gt;<br>
your&nbsp;original&nbsp;discontent.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;tried&nbsp;to&nbsp;integrate&nbsp;sqlalchemy&nbsp;ORM&nbsp;in&nbsp;the&nbsp;past&nbsp;and&nbsp;it&nbsp;never&nbsp;worked&nbsp;right&nbsp;because&lt;br&gt;<br>
the&nbsp;code&nbsp;in&nbsp;the&nbsp;objects&nbsp;didn&#39;t&nbsp;know&nbsp;that&nbsp;it&nbsp;was&nbsp;dealing&nbsp;with&nbsp;twisted&nbsp;and&nbsp;because&lt;br&gt;<br>
sqlalchemy&nbsp;is&nbsp;mainly&nbsp;used&nbsp;in&nbsp;a&nbsp;single&nbsp;thread,&nbsp;it&#39;s&nbsp;thread&nbsp;safe&nbsp;but&nbsp;that&nbsp;doesn&#39;t&nbsp;mean&lt;br&gt;<br>
that&nbsp;you&nbsp;can&nbsp;share&nbsp;objects&nbsp;between&nbsp;threads.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;--&lt;br&gt;<br>
Valentino&nbsp;Volonghi&nbsp;aka&nbsp;Dialtone&lt;br&gt;<br>
Now&nbsp;running&nbsp;MacOS&nbsp;X&nbsp;10.5&lt;br&gt;<br>
Home&nbsp;Page:&nbsp;&lt;a&nbsp;href=&quot;http://www.twisted.it&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.twisted.it&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.adroll.com&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.adroll.com&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
Version:&nbsp;GnuPG&nbsp;v1.4.9&nbsp;(Darwin)&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
iEYEARECAAYFAkmu5KoACgkQ9Llz28widGWBWwCglXIKPUFaGbk5tI9XmtrH8lH+&lt;br&gt;<br>
7woAnjrWWWEj2P78szZbNyLzSx0kgz4B&lt;br&gt;<br>
=9uZo&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
-----END&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;look&nbsp;to&nbsp;the&nbsp;things&nbsp;around&nbsp;you,the&nbsp;immediate&nbsp;world&nbsp;around&nbsp;you,&nbsp;if&nbsp;you&nbsp;are&nbsp;alive,it&nbsp;will&nbsp;mean&nbsp;something&nbsp;to&nbsp;you&nbsp;——Paul&nbsp;Strand&lt;br&gt;<br>

</tt>
