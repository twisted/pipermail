<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Glyph,&lt;div&gt; &nbsp;Thanks&nbsp;for&nbsp;the&nbsp;suggestion.&lt;/div&gt;&lt;div&gt;I&nbsp;tried&nbsp;the&nbsp;suggestion..&nbsp;While&nbsp;it&nbsp;fixes&nbsp;the&nbsp;self.channel&nbsp;NoneType&nbsp;issue..&nbsp;It&nbsp;creates&nbsp;another&nbsp;issue.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/events.py&quot;,&nbsp;line&nbsp;88,&nbsp;in&nbsp;_run&lt;br&gt; &nbsp; &nbsp;self._context.run(self._callback,&nbsp;*self._args)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;827,&nbsp;in&nbsp;adapt&lt;br&gt; &nbsp; &nbsp;adapt.actual.callback(extracted)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;460,&nbsp;in&nbsp;callback&lt;br&gt; &nbsp; &nbsp;self._startRunCallbacks(result)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;568,&nbsp;in&nbsp;_startRunCallbacks&lt;br&gt; &nbsp; &nbsp;self._runCallbacks()&lt;br&gt;---&nbsp;&lt;exception&nbsp;caught&nbsp;here&gt;&nbsp;---&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;654,&nbsp;in&nbsp;_runCallbacks&lt;br&gt; &nbsp; &nbsp;current.result&nbsp;=&nbsp;callback(current.result,&nbsp;*args,&nbsp;**kw)&lt;br&gt;......&lt;br&gt; &nbsp; &nbsp;request.finish()&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/web/server.py&quot;,&nbsp;line&nbsp;268,&nbsp;in&nbsp;finish&lt;br&gt; &nbsp; &nbsp;return&nbsp;http.Request.finish(self)&lt;br&gt; &nbsp;File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/web/http.py&quot;,&nbsp;line&nbsp;1071,&nbsp;in&nbsp;finish&lt;br&gt; &nbsp; &nbsp;&quot;Request.finish&nbsp;called&nbsp;on&nbsp;a&nbsp;request&nbsp;after&nbsp;its&nbsp;connection&nbsp;was&nbsp;lost;&nbsp;&quot;&lt;br&gt;builtins.RuntimeError:&nbsp;Request.finish&nbsp;called&nbsp;on&nbsp;a&nbsp;request&nbsp;after&nbsp;its&nbsp;connection&nbsp;was&nbsp;lost;&nbsp;use&nbsp;Request.notifyFinish&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;this.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; I&nbsp;have&nbsp;got&nbsp;some&nbsp;handle&nbsp;on&nbsp;the&nbsp;issue.&nbsp;I&nbsp;was&nbsp;wondering&nbsp;if&nbsp;you&nbsp;have&nbsp;any&nbsp;advise&nbsp;on&nbsp;how&nbsp;to&nbsp;debug&nbsp;the&nbsp;issue. &lt;/div&gt;&lt;div&gt;Somewhere&nbsp;in&nbsp;the&nbsp;codebase&nbsp;are&nbsp;async/await&nbsp;code&nbsp;(from&nbsp;asyncio&nbsp;world).&nbsp;Hence,&nbsp;when&nbsp;the&nbsp;connection&nbsp;is&nbsp;closed&nbsp;down&nbsp;by&nbsp;client,&nbsp;seems&nbsp;like&nbsp;those&nbsp;pending&nbsp;coroutines&nbsp;are&nbsp;lingering&nbsp;on.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(248,248,255);color:rgb(0,0,0);font-family:Menlo;font-size:9pt&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;def&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,229,144)&quot;&gt;connectionLost&lt;/span&gt;(&lt;span&nbsp;style=&quot;color:rgb(148,85,141)&quot;&gt;self&lt;/span&gt;,&nbsp;&lt;span&nbsp;style=&quot;font-style:italic&quot;&gt;channel&lt;/span&gt;,&nbsp;&lt;span&nbsp;style=&quot;font-style:italic&quot;&gt;reason&lt;/span&gt;)&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(248,248,255);color:rgb(0,0,0);font-family:Menlo;font-size:9pt&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-weight:bold&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&gt;asyncio.&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:9pt;color:rgb(153,0,0);font-weight:bold&quot;&gt;all_tasks&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&gt;(asyncio.&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:9pt;color:rgb(153,0,0);font-weight:bold&quot;&gt;get_event_loop&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&gt;())&lt;/span&gt;&lt;/pre&gt;&lt;pre&nbsp;style=&quot;background-color:rgb(248,248,255);color:rgb(0,0,0);font-family:Menlo;font-size:9pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;pending&nbsp;tasks&nbsp;&quot;,&nbsp;len(t))&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;above&nbsp;does&nbsp;shows&nbsp;the&nbsp;list&nbsp;of&nbsp;pending&nbsp;tasks. &nbsp;I&nbsp;am&nbsp;wondering&nbsp;if&nbsp;you&nbsp;have&nbsp;any&nbsp;advice&nbsp;on&nbsp;how&nbsp;to&nbsp;kill&nbsp;these&nbsp;coroutines? &lt;/div&gt;&lt;div&gt;Also,&nbsp;I&nbsp;apologize&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;wrong&nbsp;community&nbsp;to&nbsp;ask&nbsp;and&nbsp;if&nbsp;I&nbsp;should&nbsp;post&nbsp;it&nbsp;to&nbsp;asyncio&nbsp;community?&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;all&nbsp;the&nbsp;help.&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Waqar&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sat,&nbsp;Aug&nbsp;3,&nbsp;2019&nbsp;at&nbsp;3:56&nbsp;PM&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;overflow-wrap:&nbsp;break-word;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;On&nbsp;Aug&nbsp;2,&nbsp;2019,&nbsp;at&nbsp;4:31&nbsp;PM,&nbsp;Waqar&nbsp;Khan&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:wk80333@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;wk80333@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;gmail-m_-758423342056639834Apple-interchange-newline&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt; &nbsp;I&nbsp;have&nbsp;a&nbsp;twisted&nbsp;server.&nbsp;And&nbsp;I&nbsp;have&nbsp;been&nbsp;seeing&nbsp;this&nbsp;annoying&nbsp;issue.&lt;/div&gt;&lt;div&gt;Normally.&nbsp;when&nbsp;i&nbsp;develop&nbsp;and&nbsp;test&nbsp;it&nbsp;out.&nbsp;everything&nbsp;is&nbsp;fine..&lt;br&gt;But&nbsp;then&nbsp;I&nbsp;try&nbsp;to&nbsp;loadtest&nbsp;is&nbsp;via &lt;a&nbsp;href=&quot;https://locust.io/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://locust.io/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Again,&nbsp;everything&nbsp;is&nbsp;fine..&nbsp;until&nbsp;I&nbsp;&quot;stop&quot;&nbsp;the&nbsp;test.&lt;/div&gt;&lt;div&gt;Then,&nbsp;I&nbsp;see&nbsp;this&lt;br&gt;&#39;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):\n&nbsp; File&nbsp;&quot;/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/events.py&quot;,&nbsp;line&nbsp;88,&nbsp;in&nbsp;_run\n&nbsp; &nbsp; self._context.run(self._callback,&nbsp;*self._args)\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;827,&nbsp;in&nbsp;adapt\n&nbsp; &nbsp; adapt.actual.callback(extracted)\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;460,&nbsp;in&nbsp;callback\n&nbsp; &nbsp; self._startRunCallbacks(result)\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;568,&nbsp;in&nbsp;_startRunCallbacks\n&nbsp; &nbsp; self._runCallbacks()\n---&nbsp;&lt;exception&nbsp;caught&nbsp;here&gt;&nbsp;---\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;654,&nbsp;in&nbsp;_runCallbacks\n&nbsp; &nbsp; current.result&nbsp;=&nbsp;callback(current.result,&nbsp;*args,&nbsp;**kw)\n&nbsp; File &lt;/div&gt;&lt;div&gt;....&lt;/div&gt;&lt;div&gt; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/web/server.py&quot;,&nbsp;line&nbsp;238,&nbsp;in&nbsp;write\n&nbsp; &nbsp; http.Request.write(self,&nbsp;data)\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/web/http.py&quot;,&nbsp;line&nbsp;1118,&nbsp;in&nbsp;write\n&nbsp; &nbsp; self.channel.writeHeaders(version,&nbsp;code,&nbsp;reason,&nbsp;headers)\nbuiltins.AttributeError:&nbsp;\&#39;NoneType\&#39;&nbsp;object&nbsp;has&nbsp;no&nbsp;attribute&nbsp;\&#39;writeHeaders\&#39;\n&#39;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;found&nbsp;this&nbsp;similar&nbsp;bug&nbsp;report: &lt;a&nbsp;href=&quot;https://github.com/buildbot/buildbot/issues/4045&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/buildbot/buildbot/issues/4045&lt;/a&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;I&nbsp;am&nbsp;using 19.2.1&nbsp;twisted&nbsp;version..&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;is&nbsp;a&nbsp;prerelease&nbsp;version,&nbsp;with&nbsp;this&nbsp;bug&nbsp;fixed,&nbsp;that&nbsp;is&nbsp;awaiting&nbsp;final&nbsp;release&nbsp;upload&nbsp;right&nbsp;now;&nbsp;can&nbsp;you&nbsp;try&nbsp;with Twisted==19.7.0rc1&nbsp;? &nbsp;That&nbsp;should&nbsp;fix&nbsp;this&nbsp;issue. &nbsp;If&nbsp;not,&nbsp;then&nbsp;we&nbsp;have&nbsp;some&nbsp;investigating&nbsp;to&nbsp;do&nbsp;:-).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-g&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-g&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
