<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Glyph,&lt;div&gt; &nbsp; Here&nbsp;is&nbsp;the&nbsp;minimal&nbsp;version&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;FooResource(resource.Resource):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; def&nbsp;render_GET(request):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;future&nbsp;=&nbsp;asyncio.ensure_future(self.fetch_response(request))&nbsp;//&nbsp;some&nbsp;async&nbsp;await&nbsp;functions&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;d&nbsp;= Deferred.fromFuture(future)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  d.addCallback(print_json_response,&nbsp;request)&nbsp;//&nbsp;this&nbsp;is&nbsp;actually&nbsp;where&nbsp;the&nbsp;error&nbsp;is&nbsp;triggered.&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  d.addErrback(lambda&nbsp;failure:&nbsp;failure.trap(defer.CancelledError))&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  finished_errback&nbsp;=&nbsp;request.notifyFinish()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;finished_errback.addErrback(self.handle_cancel,&nbsp;d)&nbsp;//&nbsp;simple&nbsp;logs&nbsp;and&nbsp;cancels&nbsp;d&nbsp;by&nbsp;d.cancel()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;NOT_DONE_YET&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;traceback&nbsp;is&nbsp;like&lt;/div&gt;&lt;div&gt;&#39;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):\n&nbsp; File&nbsp;&quot;/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/events.py&quot;,&nbsp;line&nbsp;88,&nbsp;in&nbsp;_run\n&nbsp; &nbsp; self._context.run(self._callback,&nbsp;*self._args)\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;827,&nbsp;in&nbsp;adapt\n&nbsp; &nbsp; adapt.actual.callback(extracted)\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;460,&nbsp;in&nbsp;callback\n&nbsp; &nbsp; self._startRunCallbacks(result)\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;568,&nbsp;in&nbsp;_startRunCallbacks\n&nbsp; &nbsp; self._runCallbacks()\n---&nbsp;&lt;exception&nbsp;caught&nbsp;here&gt;&nbsp;---\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;654,&nbsp;in&nbsp;_runCallbacks\n&nbsp; &nbsp; current.result&nbsp;=&nbsp;callback(current.result,&nbsp;*args,&nbsp;**kw)\n&nbsp; File&nbsp;&quot;/Users/wqKhan/twisted_eg/parse_response.py&quot;,&nbsp;line&nbsp;3,&nbsp;in&nbsp;print_json_response\n &nbsp; &nbsp;&lt;b&gt;print_json_response&lt;/b&gt;(response,&nbsp;request)\n&nbsp; File&nbsp;&quot;/Users/wqKhan/twisted_eg/parse_response.py&quot;,&nbsp;line&nbsp;21,&nbsp;in&nbsp;&lt;b&gt;print_json_response&lt;/b&gt;\n&nbsp; &nbsp; request.finish()\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/web/server.py&quot;,&nbsp;line&nbsp;268,&nbsp;in&nbsp;finish\n&nbsp; &nbsp; return&nbsp;http.Request.finish(self)\n&nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/web/http.py&quot;,&nbsp;line&nbsp;1071,&nbsp;in&nbsp;finish\n&nbsp; &nbsp; &quot;Request.finish&nbsp;called&nbsp;on&nbsp;a&nbsp;request&nbsp;after&nbsp;its&nbsp;connection&nbsp;was&nbsp;lost;&nbsp;&quot;\nbuiltins.RuntimeError:&nbsp;Request.finish&nbsp;called&nbsp;on&nbsp;a&nbsp;request&nbsp;after&nbsp;its&nbsp;connection&nbsp;was&nbsp;lost;&nbsp;use&nbsp;Request.notifyFinish&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;this.\n&#39;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sun,&nbsp;Aug&nbsp;4,&nbsp;2019&nbsp;at&nbsp;10:36&nbsp;PM&nbsp;Glyph&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:glyph@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;glyph@twistedmatrix.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Aug&nbsp;4,&nbsp;2019,&nbsp;at&nbsp;5:57&nbsp;PM,&nbsp;Waqar&nbsp;Khan&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:wk80333@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;wk80333@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;Glyph,&lt;br&gt;<br>
&gt; &nbsp; Thanks&nbsp;for&nbsp;the&nbsp;suggestion.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;tried&nbsp;the&nbsp;suggestion..&nbsp;While&nbsp;it&nbsp;fixes&nbsp;the&nbsp;self.channel&nbsp;NoneType&nbsp;issue..&nbsp;It&nbsp;creates&nbsp;another&nbsp;issue.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;<br>
&gt; &nbsp; File&nbsp;&quot;/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/events.py&quot;,&nbsp;line&nbsp;88,&nbsp;in&nbsp;_run&lt;br&gt;<br>
&gt; &nbsp; &nbsp; self._context.run(self._callback,&nbsp;*self._args)&lt;br&gt;<br>
&gt; &nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;827,&nbsp;in&nbsp;adapt&lt;br&gt;<br>
&gt; &nbsp; &nbsp; adapt.actual.callback(extracted)&lt;br&gt;<br>
&gt; &nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;460,&nbsp;in&nbsp;callback&lt;br&gt;<br>
&gt; &nbsp; &nbsp; self._startRunCallbacks(result)&lt;br&gt;<br>
&gt; &nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;568,&nbsp;in&nbsp;_startRunCallbacks&lt;br&gt;<br>
&gt; &nbsp; &nbsp; self._runCallbacks()&lt;br&gt;<br>
&gt;&nbsp;---&nbsp;&lt;exception&nbsp;caught&nbsp;here&gt;&nbsp;---&lt;br&gt;<br>
&gt; &nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/internet/defer.py&quot;,&nbsp;line&nbsp;654,&nbsp;in&nbsp;_runCallbacks&lt;br&gt;<br>
&gt; &nbsp; &nbsp; current.result&nbsp;=&nbsp;callback(current.result,&nbsp;*args,&nbsp;**kw)&lt;br&gt;<br>
&gt;&nbsp;......&lt;br&gt;<br>
&gt; &nbsp; &nbsp; request.finish()&lt;br&gt;<br>
&gt; &nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/web/server.py&quot;,&nbsp;line&nbsp;268,&nbsp;in&nbsp;finish&lt;br&gt;<br>
&gt; &nbsp; &nbsp; return&nbsp;http.Request.finish(self)&lt;br&gt;<br>
&gt; &nbsp; File&nbsp;&quot;/usr/local/lib/python3.7/site-packages/twisted/web/http.py&quot;,&nbsp;line&nbsp;1071,&nbsp;in&nbsp;finish&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &quot;Request.finish&nbsp;called&nbsp;on&nbsp;a&nbsp;request&nbsp;after&nbsp;its&nbsp;connection&nbsp;was&nbsp;lost;&nbsp;&quot;&lt;br&gt;<br>
&gt;&nbsp;builtins.RuntimeError:&nbsp;Request.finish&nbsp;called&nbsp;on&nbsp;a&nbsp;request&nbsp;after&nbsp;its&nbsp;connection&nbsp;was&nbsp;lost;&nbsp;use&nbsp;Request.notifyFinish&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;this.&lt;br&gt;<br>
&lt;br&gt;<br>
Oh,&nbsp;hrm. &nbsp;The&nbsp;idea&nbsp;here&nbsp;is&nbsp;that&nbsp;any&nbsp;code&nbsp;that&nbsp;returns&nbsp;NOT_DONE_YET&nbsp;(i.e.&nbsp;does&nbsp;asynchronous&nbsp;work&nbsp;to&nbsp;generate&nbsp;a&nbsp;response)&nbsp;should&nbsp;also&nbsp;be&nbsp;tracking&nbsp;whether&nbsp;it&nbsp;needs&nbsp;to&nbsp;call&nbsp;`.finish()`&nbsp;by&nbsp;watching&nbsp;a&nbsp;`.notifyFinish()`&nbsp;Deferred. &nbsp;I&nbsp;bet&nbsp;that&nbsp;there&nbsp;are&nbsp;plenty&nbsp;of&nbsp;resources&nbsp;in&nbsp;Twisted&nbsp;which&nbsp;don&#39;t&nbsp;follow&nbsp;this&nbsp;rule,&nbsp;and&nbsp;we&nbsp;should&nbsp;fix&nbsp;those;&nbsp;but&nbsp;possibly&nbsp;we&nbsp;should&nbsp;also&nbsp;make&nbsp;this&nbsp;error&nbsp;message&nbsp;less&nbsp;stern. &nbsp;Do&nbsp;you&nbsp;have&nbsp;a&nbsp;minimal&nbsp;example?&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp;I&nbsp;have&nbsp;got&nbsp;some&nbsp;handle&nbsp;on&nbsp;the&nbsp;issue.&nbsp;I&nbsp;was&nbsp;wondering&nbsp;if&nbsp;you&nbsp;have&nbsp;any&nbsp;advise&nbsp;on&nbsp;how&nbsp;to&nbsp;debug&nbsp;the&nbsp;issue.&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Somewhere&nbsp;in&nbsp;the&nbsp;codebase&nbsp;are&nbsp;async/await&nbsp;code&nbsp;(from&nbsp;asyncio&nbsp;world).&nbsp;Hence,&nbsp;when&nbsp;the&nbsp;connection&nbsp;is&nbsp;closed&nbsp;down&nbsp;by&nbsp;client,&nbsp;seems&nbsp;like&nbsp;those&nbsp;pending&nbsp;coroutines&nbsp;are&nbsp;lingering&nbsp;on.&lt;br&gt;<br>
&lt;br&gt;<br>
This,&nbsp;I&nbsp;have&nbsp;no&nbsp;idea&nbsp;about. &nbsp;What&nbsp;tasks&nbsp;are&nbsp;you&nbsp;starting,&nbsp;when&nbsp;are&nbsp;you&nbsp;expecting&nbsp;them&nbsp;to&nbsp;get&nbsp;cleaned&nbsp;up,&nbsp;what&nbsp;are&nbsp;they&nbsp;blocking&nbsp;on,&nbsp;how&nbsp;do&nbsp;these&nbsp;interact&nbsp;with&nbsp;Twisted? &nbsp;There&nbsp;are&nbsp;a&nbsp;couple&nbsp;dozen&nbsp;questions&nbsp;I&#39;d&nbsp;have&nbsp;to&nbsp;know&nbsp;the&nbsp;answer&nbsp;to&nbsp;in&nbsp;order&nbsp;to&nbsp;even&nbsp;begin&nbsp;debugging&nbsp;this. &nbsp;If&nbsp;you&nbsp;cancel&nbsp;all&nbsp;the&nbsp;outstanding&nbsp;tasks&nbsp;and&nbsp;look&nbsp;at&nbsp;their&nbsp;tracebacks&nbsp;when&nbsp;exiting&nbsp;it&nbsp;might&nbsp;give&nbsp;you&nbsp;more&nbsp;of&nbsp;a&nbsp;sense&nbsp;of&nbsp;where&nbsp;they&#39;re&nbsp;stuck...&lt;br&gt;<br>
&lt;br&gt;<br>
-g&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-Python&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-Python@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-Python@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
