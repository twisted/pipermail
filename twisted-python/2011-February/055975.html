<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Guidance needed on serial device interaction
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Guidance%20needed%20on%20serial%20device%20interaction&In-Reply-To=%3CCB97EF58-6555-407C-AF7B-EAEF457415C4%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055974.html">
   <LINK REL="Next"  HREF="055968.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Guidance needed on serial device interaction</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Guidance%20needed%20on%20serial%20device%20interaction&In-Reply-To=%3CCB97EF58-6555-407C-AF7B-EAEF457415C4%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Guidance needed on serial device interaction">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Feb  2 11:08:16 MST 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055974.html">[Twisted-Python] Guidance needed on serial device interaction
</A></li>
        <LI>Next message (by thread): <A HREF="055968.html">[Twisted-Python] design of twisted application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55975">[ date ]</a>
              <a href="thread.html#55975">[ thread ]</a>
              <a href="subject.html#55975">[ subject ]</a>
              <a href="author.html#55975">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Feb 2, 2011, at 7:42 AM, Michael Thompson wrote:

&gt;<i> On 2 February 2011 10:11, Jason Heeris &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jason.heeris at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> On 2 February 2011 17:53, Albert Brandl &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">albert.brandl at weiermayer.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> &quot;string&quot; could be interpreted as &quot;complete message&quot;. It might e.g. happen
</I>&gt;&gt;&gt;<i> that a message arrives in three chunks. Each time a chunk is read, the
</I>&gt;&gt;&gt;<i> dataReceived method is called. When it detects that the message is
</I>&gt;&gt;&gt;<i> complete, it calls stringReceived with the content of the message.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Okay, but I don't see how to use that to solve my particular problem.
</I>&gt;&gt;<i> I'm not waiting passively to receive a complete string, I have to
</I>&gt;&gt;<i> react to whatever's sent back, character by character, either by
</I>&gt;&gt;<i> reporting completion, an error or sending more data. In effect, I
</I>&gt;&gt;<i> guess, each character is a &quot;complete message&quot; anyway. I don't think
</I>&gt;&gt;<i> the t.i.protocols offer much for that.
</I>&gt;<i> 
</I>&gt;<i> Yep you have a pretty simple protocol there so even the basic examples
</I>&gt;<i> are probably more than you need.
</I>&gt;<i> 
</I>&gt;<i> Something like this might get you started.
</I>&gt;<i> 
</I>&gt;<i> class MyProtocol(Protocol):
</I>&gt;<i>    def send(self, byte):
</I>&gt;<i>          self.transport.write(byte)
</I>&gt;<i>          self.response = Deferred()
</I>&gt;<i>          return self.response
</I>&gt;<i> 
</I>&gt;<i>    def dataReceived(self, byte):
</I>&gt;<i>           self.response.callback(byte)
</I>
Not quite.  You mean:

class MyProtocol(Protocol):
  # ...
  def dataReceived(self, data):
    for octet in data:
      self.process(octet)

If the device outputs multiple bytes it might show up to Twisted as strings of arbitrary length (this depends on timings of the serial port which are basically impossible to control), so if you want to process a byte at a time, you need to specifically iterate through the string that is passed, even if it's usually one byte long.  (Some of the protocol examples showed multibyte sequences as messages.  I don't understand the framing well enough to provide a better example though, sorry.)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20110202/04b17774/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055974.html">[Twisted-Python] Guidance needed on serial device interaction
</A></li>
	<LI>Next message (by thread): <A HREF="055968.html">[Twisted-Python] design of twisted application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55975">[ date ]</a>
              <a href="thread.html#55975">[ thread ]</a>
              <a href="subject.html#55975">[ subject ]</a>
              <a href="author.html#55975">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
