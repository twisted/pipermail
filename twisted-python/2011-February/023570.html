<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A thread in isolation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20thread%20in%20isolation&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023569.html">
   <LINK REL="Next"  HREF="023571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A thread in isolation</H1>
    <B>Andy.Henshaw at gtri.gatech.edu</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20thread%20in%20isolation&In-Reply-To="
       TITLE="[Twisted-Python] A thread in isolation">Andy.Henshaw at gtri.gatech.edu
       </A><BR>
    <I>Thu Feb 17 16:38:34 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023569.html">[Twisted-Python] Looking for intern (and full time developers)
</A></li>
        <LI>Next message: <A HREF="023571.html">[Twisted-Python] A thread in isolation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23570">[ date ]</a>
              <a href="thread.html#23570">[ thread ]</a>
              <a href="subject.html#23570">[ subject ]</a>
              <a href="author.html#23570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I apologize in advance - another question about Twisted and threading.  I just seem to have trouble with this and I'm hoping my example is simple enough that a good explanation will be forthcoming.

I'm trying to start and stop Twisted in its own thread, over and over.  I've seen some notes that say this is a bad idea and that programs that do so should be restructured.  But, it would really work better for this application if I could do it somehow.

My controlling thread just wants to start Twisted, let it do its thing, and then let the thread stop.  Later on, I'd like to do it again.  In the example code below, the thread runs and stops fine in the first iteration.  In the second iteration, it starts, seems to run okay, but it never stops.  Is this an unreasonable request?

from threading import Thread
from twisted.internet import reactor
from twisted.internet import protocol

PORT = 9999

class AgentManager(Thread):
    def run(self):
        print '\nstarting agentmanager', self

        reactor.connectTCP('localhost', PORT, AgentClientFactory())
        reactor.listenTCP(PORT, AgentServerFactory())

        reactor.callLater(5, reactor.stop)
        reactor.run(installSignalHandlers=0)


class Producer(protocol.Protocol):
    def connectionMade(self):
        print 'connection made'
        self.transport.write('Hello')

    def connectionLost(self, reason):
        print 'connection lost'


class Consumer(protocol.Protocol):
    def dataReceived(self, data):
        print data

class AgentServerFactory(protocol.ServerFactory):
    protocol = Producer


class AgentClientFactory(protocol.ClientFactory):
    protocol = Consumer


if __name__ == '__main__':
    for i in range(3):
        mgr = AgentManager()
        mgr.start()
        mgr.join()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20110217/8bcd120a/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20110217/8bcd120a/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023569.html">[Twisted-Python] Looking for intern (and full time developers)
</A></li>
	<LI>Next message: <A HREF="023571.html">[Twisted-Python] A thread in isolation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23570">[ date ]</a>
              <a href="thread.html#23570">[ thread ]</a>
              <a href="subject.html#23570">[ subject ]</a>
              <a href="author.html#23570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
