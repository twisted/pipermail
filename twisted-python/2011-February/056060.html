<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A thread in isolation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20thread%20in%20isolation&In-Reply-To=%3CA9B1577E2DCC7545A1018EC14CC4B8BE4C28286B%40apatlisdmbx01%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056059.html">
   <LINK REL="Next"  HREF="056061.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A thread in isolation</H1>
    <B>Andy.Henshaw at gtri.gatech.edu</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20thread%20in%20isolation&In-Reply-To=%3CA9B1577E2DCC7545A1018EC14CC4B8BE4C28286B%40apatlisdmbx01%3E"
       TITLE="[Twisted-Python] A thread in isolation">Andy.Henshaw at gtri.gatech.edu
       </A><BR>
    <I>Thu Feb 17 20:48:37 MST 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056059.html">[Twisted-Python] A thread in isolation
</A></li>
        <LI>Next message (by thread): <A HREF="056061.html">[Twisted-Python] ANN: MV3D 0.50 released!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56060">[ date ]</a>
              <a href="thread.html#56060">[ thread ]</a>
              <a href="subject.html#56060">[ subject ]</a>
              <a href="author.html#56060">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a wxPython app that starts up a network-intensive process.  I played with wxReactor, but found the performance of the separate thread much better.  The GUI has very little interaction with the twisted thread.  Once the network process is done,  I'm done with the services.  At that point, I set up another set of consumers and producers in which all of the service parameters can be changed (host address, port, client/server,  and protocol) and start them running.

Since my approach is not workable, I'll restructure the app to leave the reactor running until the program exits.

From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of Jason Rennie
Sent: Thursday, February 17, 2011 5:59 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] A thread in isolation

What's the larger problem you're trying to solve?

Jason
On Thu, Feb 17, 2011 at 4:38 PM, &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Andy.Henshaw at gtri.gatech.edu</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Andy.Henshaw at gtri.gatech.edu</A>&gt;&gt; wrote:
I apologize in advance - another question about Twisted and threading.  I just seem to have trouble with this and I'm hoping my example is simple enough that a good explanation will be forthcoming.

I'm trying to start and stop Twisted in its own thread, over and over.  I've seen some notes that say this is a bad idea and that programs that do so should be restructured.  But, it would really work better for this application if I could do it somehow.

My controlling thread just wants to start Twisted, let it do its thing, and then let the thread stop.  Later on, I'd like to do it again.  In the example code below, the thread runs and stops fine in the first iteration.  In the second iteration, it starts, seems to run okay, but it never stops.  Is this an unreasonable request?

from threading import Thread
from twisted.internet import reactor
from twisted.internet import protocol

PORT = 9999

class AgentManager(Thread):
    def run(self):
        print '\nstarting agentmanager', self

        reactor.connectTCP('localhost', PORT, AgentClientFactory())
        reactor.listenTCP(PORT, AgentServerFactory())

        reactor.callLater(5, reactor.stop)
        reactor.run(installSignalHandlers=0)


class Producer(protocol.Protocol):
    def connectionMade(self):
        print 'connection made'
        self.transport.write('Hello')

    def connectionLost(self, reason):
        print 'connection lost'


class Consumer(protocol.Protocol):
    def dataReceived(self, data):
        print data

class AgentServerFactory(protocol.ServerFactory):
    protocol = Producer


class AgentClientFactory(protocol.ClientFactory):
    protocol = Consumer


if __name__ == '__main__':
    for i in range(3):
        mgr = AgentManager()
        mgr.start()
        mgr.join()

_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>



--
Jason Rennie
Research Scientist, ITA Software
617-714-2645
<A HREF="http://www.itasoftware.com/">http://www.itasoftware.com/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20110218/36485b65/attachment-0001.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056059.html">[Twisted-Python] A thread in isolation
</A></li>
	<LI>Next message (by thread): <A HREF="056061.html">[Twisted-Python] ANN: MV3D 0.50 released!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56060">[ date ]</a>
              <a href="thread.html#56060">[ thread ]</a>
              <a href="subject.html#56060">[ subject ]</a>
              <a href="author.html#56060">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
