<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] test if thread is reactor's thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20test%20if%20thread%20is%20reactor%27s%20thread&In-Reply-To=%3CBANLkTinSiZeMKntxZS6WYPc6su9aKukY3A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056475.html">
   <LINK REL="Next"  HREF="056479.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] test if thread is reactor's thread</H1>
    <B>Jamu Kakar</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20test%20if%20thread%20is%20reactor%27s%20thread&In-Reply-To=%3CBANLkTinSiZeMKntxZS6WYPc6su9aKukY3A%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] test if thread is reactor's thread">jkakar at kakar.ca
       </A><BR>
    <I>Wed May 11 13:41:49 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056475.html">[Twisted-Python] test if thread is reactor's thread
</A></li>
        <LI>Next message (by thread): <A HREF="056479.html">[Twisted-Python] test if thread is reactor's thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56477">[ date ]</a>
              <a href="thread.html#56477">[ thread ]</a>
              <a href="subject.html#56477">[ subject ]</a>
              <a href="author.html#56477">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alessandro,

On Wed, May 11, 2011 at 8:18 PM, Alessandro Dentella &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sandro at e-den.it</A>&gt; wrote:
&gt;<i> is there a way to test if the thread a function is called is the reactor's
</I>&gt;<i> thread?
</I>
Yes, you can do it with code like this:

from threading import currentThread

if currentThread().getName() == 'MainThread':
    # Code is running in the main reactor thread
else:
    # Code is running in a child thread

&gt;<i> I have a function that can be called from the main thread or from the
</I>&gt;<i> reactor's thread and should behave differently...
</I>
We had a situation like this recently in Fluidinfo.  We started with
the trick above, but it was a bit weird.  The situation we had was
that we had to run some asynchronous code (ie, a function returning a
Deferred) in a thread used to run a database transaction.  We ended up
with a nice solution.  Something like:

# In the transaction thread.
proxy = doAThing()
result = blockingCallFromThread(proxy.run)

At first, deep inside doAThing we had the black magic above, but it
was awkward to test and behaved differently depending on which thread
the code ran in, which was confusing to understand.  We refactored
doAThing to not run the asynchronous code but to, instead, return a
proxy object with a method that needed to be run asynchronously.  The
proxy was configured with the arguments and such needed for it to run
properly, so the user could just invoke the asynchronous code in the
way that made sense for them.

It's much nicer because the caller of the function gets to decide how
to run the asynchronous code, instead of it being hard-coded deep in
some logic.  Also, the logic is much easier to comprehend because it
only behaves one way.  Anyway, maybe this strategy won't work for you,
but behaves-differently-depending-on-the-thread-you-use is probably a
behaviour you should avoid if possible.

Thanks,
J.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056475.html">[Twisted-Python] test if thread is reactor's thread
</A></li>
	<LI>Next message (by thread): <A HREF="056479.html">[Twisted-Python] test if thread is reactor's thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56477">[ date ]</a>
              <a href="thread.html#56477">[ thread ]</a>
              <a href="subject.html#56477">[ subject ]</a>
              <a href="author.html#56477">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
