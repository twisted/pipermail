<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Configuration, Persistance and Version Control
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Configuration%2C%20Persistance%20and%20Version%20Control&In-Reply-To=%3CPine.LNX.4.21.0107282348170.32721-100000%40zaibach.twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="032651.html">
   <LINK REL="Next"  HREF="032653.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Configuration, Persistance and Version Control</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Configuration%2C%20Persistance%20and%20Version%20Control&In-Reply-To=%3CPine.LNX.4.21.0107282348170.32721-100000%40zaibach.twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Configuration, Persistance and Version Control">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Jul 29 12:40:19 MDT 2001</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="032651.html">[Twisted-Python] Configuration, Persistance and Version Control
</A></li>
        <LI>Next message (by thread): <A HREF="032653.html">[Twisted-Python] &quot;Ports&quot; vs. &quot;Listeners&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32652">[ date ]</a>
              <a href="thread.html#32652">[ thread ]</a>
              <a href="subject.html#32652">[ subject ]</a>
              <a href="author.html#32652">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Kickin' it IRC style --

Here are some responses interspersed with the dialogue.  Hope this helps
:<i>)
</I>
On Sat, 28 Jul 2001, Kevin Turner wrote:

&gt;<i> &lt;itamar|home&gt; you coifgure them and then can pickle them to disk
</I>
... OR you run them, depending on your requirements.  The default 'twistd'
binary does UNIX daemonization; but if you wanted to do an NT service,
you'd obviously have to have some different code.

&gt;<i> &lt;Tv&gt; Acapnotic: But all that does is make your &quot;config settings&quot;
</I>&gt;<i>           into &quot;command line settings&quot;.
</I>
It makes your *initial* &quot;config settings&quot; into &quot;command line settings&quot;.  
Those scripts exist more for examples than for actual configuration; the
&quot;settings&quot; they provide are a small subset of the full set available in
the code.

&gt;<i> &lt;Tv&gt; I don't see it making things very easy.
</I>&gt;<i> &lt;Tv&gt; And think about version upgrades.
</I>
We here at Twisted Matrix Laboratories have a commitment to backwards
compatibility :-).  *IF* we had more users, the 0.9.0 upgrade would have
gone much more smoothly; we actually had a backwards compatibility plan
and decided to forego it for efficiency because we (rightly) believed that
nobody would care.

My configuration (e.g. the www.twistedmatrix.com site) is fairly complex,
and I've been maintaining it with Twisted since the inception of
Twisted.Web (which I think was .7 or so).  It's never taken me more than 3
or 4 minutes to replicate this with simple python scripts.

&gt;<i> &lt;Tv&gt; I see trouble with the approach; mostly losing the unix
</I>&gt;<i>           ubiquitousness (sp?). I can grep my config files; I store them in
</I>&gt;<i>           CVS.
</I>
1: learn how to use add +kb :-)

2: use pickle's &quot;text&quot; mode.

3: version control a script which generates and runs your monumentally
byzantine configuration, then store THAT in cvs.

About option 3: radix, moshez, and I have been thinking about, and
prototyping configuration systems for quite a while.  I have yet to think
of a system which can't be easily beaten by &quot;just using Python&quot;.  For
example, here's an example XML solution;

&lt;Site name=&quot;myvhost&quot;&gt;
 &lt;NameVirtualHost&gt;
  &lt;Host name=&quot;myhost.com&quot;&gt;
   &lt;Resource&gt;
    ...
   &lt;/Resource&gt;
  &lt;/Host&gt;
 &lt;/NameVirtualHost&gt;
&lt;/Site&gt;
...
&lt;WebServer port=80 site=&quot;myvhost&quot;/&gt;

And here's the actual Twisted code which will do the same thing (I
haven't had an opportunity to test it, but you get the idea):

---
from twisted.web.server import Site
from twisted.web.vhost import NameVirtualHost
from twisted.internet.main impot Application
a = Application(&quot;web&quot;)
v = NameVirtualHost()
r = SomeResource(...)
v.addHost(&quot;myhost.com&quot;, r)
s = Site()
s.resource = v
a.listenOn(80, s)
---

It's equally concise *and* more flexible.

&gt;<i> &lt;Tv&gt; And don't give a trivial example..
</I>&gt;<i> &lt;Tv&gt; I have multi-hundred-line config files here.
</I>&gt;<i> &lt;Tv&gt; Shared between n hosts, via CVS.
</I>&gt;<i> &lt;Tv&gt; I'd love to hear more of the twisted philosophy..
</I>
If you have multi-hundred-line configuration files some of which allow
programmability), I'm guessing that you have considerable applications
that are written in buggy half-thought-out programming languages with no
module systems and you're using version control as part of a crutch to
make up for their many and varied deficiencies.

Since Twisted will allow you to use Python (or save your configuration in
Pickles, which is usually more convenient -- keep in mind I use this
software myself; pickles are how I use it -- to configure your servers,
you can encapsulate parts of your configuration or segment it however you
like.  and VC it too.

&gt;<i> &lt;Tv&gt; Personally, I have _needed_ programmability in config files
</I>&gt;<i>           many times.
</I>
And you've got it ;)

&gt;<i> &lt;Tv&gt; Acapnotic: Oh, I like version control. I wish I could put more
</I>&gt;<i>           things into it.
</I>
Hopefully jasbahr will jump in here with a little comment about potential
future ideas for version control within Twisted itself... ;-)

&gt;<i> &lt;Tv&gt; Have you ever screwed up a config file?
</I>&gt;<i> &lt;Tv&gt; Have you ever downgraded something, and found out it won't
</I>&gt;<i>           understand the new config file, and had to recreate the config to
</I>&gt;<i>           match the older version?
</I>&gt;<i> &lt;Tv&gt; The same reasons you version control source code.
</I>
&gt;<i> &lt;Acapnotic&gt; tv: you should post to the list at
</I>&gt;<i>           <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
</I>&gt;<i> &lt;Tv&gt; Acapnotic: I'm not following any more lists until I have
</I>&gt;<i>           migrated my mail to another domain :)
</I>&gt;<i> &lt;Acapnotic&gt; tv: bah, you don't have to follow it, just post ;)
</I>
I would *really* appreciate it if more people took advantage of resources
like the mailing list, and my personal email address :-), to resolve
issues like this.  Thanks, kevin, for posting this log!

&gt;<i> &lt;Acapnotic&gt; Tv: so if you want programmable config, is there a
</I>&gt;<i>           problem with just using python?  In which case your configuration
</I>&gt;<i>           process is a script that does &quot;app = pickle.load(...) app['web'].
</I>&gt;<i>           port = 8080 ; app.append(ChickenServer()) ; ... ; pickle.dump(app, 
</I>&gt;<i>           ...) ?
</I>&gt;<i> &lt;Tv&gt; Acapnotic: That may very well be what I'd do. But then the
</I>&gt;<i>           mechanism needs to support _both_ getting config programmatically
</I>&gt;<i>           and state from pickle, at the same time.
</I>
Just make your &quot;configuration file&quot; as described, except put &quot;app.run()&quot;
at the end of it.  This lets you do what &quot;configuration&quot; really is; e.g.
to make a customized version of the application for your site.

&gt;<i> &lt;Acapnotic&gt; Well, if I follow this train, there is only the state
</I>&gt;<i>           of the application, since it is persistant.  That state may be
</I>&gt;<i>           changed or examined programmaticly.
</I>
It's *optionally* persistent.

The point of Twisted's configuration philosophy is that &quot;configuration&quot; is
not really a disjoint set of options, but rather the custom development of
a personal application.  Twisted provides you with a big pile of very
well-developed pieces (so you hopefully don't have to spend time fixing
the little pieces while you're building your big one), but you still have
to put them together somehow.  The mk*server scripts provide one way to
do that; hopefully matsaleh's upcoming configuration protoserver will
allow it to be done interactively so that users can discover more aspects
of the software.

In eschewing the ubiquity of &quot;configuration files&quot; on UNIX, twisted also
eschews the necessity of dedicating a large body of code to parsing,
interpreting, and understanding an underpowered mini-language designed
only for talking to it.  &quot;Configure&quot; with python.  &quot;Script&quot; with python.  
&quot;Code&quot; with python.  &quot;Debug&quot; with python.

The twisted philosophy is that all of these tasks are inherently the same,
and are all complex enough to warrant a full-powered programming language.  
Event-based dynamic modification of a stateful system is what object
orientation was originally intended to do.

&gt;<i> &lt;Tv&gt; I see something beautiful there, but..
</I>&gt;<i> &lt;Tv&gt; noone has yet explained persistence to me well enough to
</I>&gt;<i>           convince me.
</I>&gt;<i> &lt;Acapnotic&gt; but what happens when you upgrade?  heh.
</I>&gt;<i> &lt;Tv&gt; What if a buggy program corrupts its state?
</I>&gt;<i> &lt;Tv&gt; Then you lose your config file also.
</I>
This assumes you don't back up your original config file.  Why would you
throw it away?  If it were complex, I'd keep mine in CVS :)

&gt;<i> &lt;Tv&gt; There needs to be something else.
</I>&gt;<i> &lt;Tv&gt; Something that is less volatile.
</I>&gt;<i> &lt;DavidC_&gt; what do you mean? both config and state are the same
</I>&gt;<i>           thing.
</I>&gt;<i> &lt;Tv&gt; No.
</I>&gt;<i> &lt;Tv&gt; config changes when *I* say it changes.
</I>
Config is *initial* state.  e.g. the state that you start the server up
with; so it changes whenever the program changes.  Or does anything.  You
can always stop the server and start from scratch again, but that doesn't
mean that bugs won't affect you.

&gt;<i> &lt;itamar|home&gt; nah, config is parsed and then &quot;rendered&quot; into state
</I>&gt;<i> &lt;Tv&gt; program can change it's state as it wants.
</I>&gt;<i> &lt;Tv&gt; Any bug in program must never change the port to bind to.
</I>
If the bug would change the persistent port, then it would change the
runtime port.  That seems like it would be pretty bad too :)

&gt;<i> &lt;Tv&gt; :)
</I>&gt;<i> &lt;Tv&gt; I see config as sort of a factory for initial program states,
</I>&gt;<i>           if you want to put it that way.
</I>
If one were to believe there is something beyond this that describes
&quot;configuration&quot;, then they would be confused :-).  The *state* of the
server changes whenever it executes an action that causes state to change;
the difference between Twisted and other systems is that Twisted *can*
remember these changes to state automatically.  This state will not
replace your initial state, nor will it prevent you from writing scripts
which create the initial state each time that the server is run.

The reason I suggest the pickle-the-state approach is because if you make
a change to the &quot;configuration&quot; as the server is running, you can change
it *live*, test it, etc, and know that when the server comes up next time,
it'll start the same way, rather than having to change your &quot;factory&quot;,
shut down your server and start it again, or make the change to your
factory and your runtime state concurrently and take the risk that they'll
be different.

&gt;<i> &lt;itamar|home&gt; lets say by mistake someone does &quot;del serverInstace.
</I>&gt;<i>           port&quot;
</I>&gt;<i> &lt;itamar|home&gt; and then shuts down the server
</I>&gt;<i> &lt;itamar|home&gt; the pickled state is now wrong
</I>
The pickled state that the server saved *when it shut down* is now wrong.  
The initial state (what *I* consider the &quot;configuration&quot;) is still
correct; but you now have the corrupt state to study as well (so you can
figure out what happened with information beyond the log.)

&gt;<i> &lt;DavidC_&gt; well that would be a bug.
</I>&gt;<i> &lt;itamar|home&gt; the point is that if you have an external, version
</I>&gt;<i>           controleld config file
</I>&gt;<i> &lt;itamar|home&gt; these bugs don't bite you, or even if they do at
</I>&gt;<i>           least they don't effect the configuration
</I>
In conclusion, &quot;so do that then&quot; :).

I still don't understand how a pickled file isn't &quot;external&quot;.  It's not
like it gets mmap'd when you start the Python process and then
automatically overwritten after every action that happens :)

                      ______      __   __  _____  _     _
                     |  ____ |      \_/   |_____] |_____|
                     |_____| |_____  |    |       |     |
                     @ t w i s t e d m a t r i x  . c o m
                     <A HREF="http://twistedmatrix.com/users/glyph">http://twistedmatrix.com/users/glyph</A>






</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="032651.html">[Twisted-Python] Configuration, Persistance and Version Control
</A></li>
	<LI>Next message (by thread): <A HREF="032653.html">[Twisted-Python] &quot;Ports&quot; vs. &quot;Listeners&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32652">[ date ]</a>
              <a href="thread.html#32652">[ thread ]</a>
              <a href="subject.html#32652">[ subject ]</a>
              <a href="author.html#32652">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
