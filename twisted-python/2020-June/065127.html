<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twistedchecker now uses pylint &gt;= 2.4.4, can we use type annotations in Twisted now?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twistedchecker%20now%20uses%20pylint%20%3E%3D%202.4.4%2C%0A%20can%20we%20use%20type%20annotations%20in%20Twisted%20now%3F&In-Reply-To=%3C8A9C147A-4C3B-4FC0-A24F-BC5BD95C3797%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065126.html">
   <LINK REL="Next"  HREF="065132.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twistedchecker now uses pylint &gt;= 2.4.4, can we use type annotations in Twisted now?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twistedchecker%20now%20uses%20pylint%20%3E%3D%202.4.4%2C%0A%20can%20we%20use%20type%20annotations%20in%20Twisted%20now%3F&In-Reply-To=%3C8A9C147A-4C3B-4FC0-A24F-BC5BD95C3797%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] twistedchecker now uses pylint &gt;= 2.4.4, can we use type annotations in Twisted now?">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Jun  7 18:13:56 MDT 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065126.html">[Twisted-Python] twistedchecker now uses pylint &gt;= 2.4.4, can we use type annotations in Twisted now?
</A></li>
        <LI>Next message (by thread): <A HREF="065132.html">[Twisted-Python] twistedchecker now uses pylint &gt;= 2.4.4, can we use type annotations in Twisted now?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65127">[ date ]</a>
              <a href="thread.html#65127">[ thread ]</a>
              <a href="subject.html#65127">[ subject ]</a>
              <a href="author.html#65127">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> On Jun 7, 2020, at 4:43 PM, Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Sun, Jun 7, 2020 at 7:22 PM Craig Rodrigues &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rodrigc at crodrigues.org</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rodrigc at crodrigues.org</A>&gt;&gt; wrote:
</I>&gt;<i> I have merged a few PR's to trunk which eliminate hundreds of errors encountered with:
</I>&gt;<i> 
</I>&gt;<i> tox -e mypy
</I>&gt;<i> 
</I>&gt;<i> I think we can take several passes with more PR's to whack away all these mypy errors,
</I>&gt;<i> and turn on mypy as part of the default CI for Twisted.
</I>&gt;<i> 
</I>&gt;<i> I have seen a few errors like:
</I>&gt;<i> 
</I>&gt;<i> src/twisted/words/protocols/jabber/sasl_mechanisms.py:47:1: error: 'Anonymous' is missing following 'ISASLMechanism' interface members: getResponse.  [misc]
</I>&gt;<i>     class Anonymous(object):
</I>&gt;<i> src/twisted/words/protocols/jabber/sasl_mechanisms.py:61:1: error: 'Plain' is missing following 'ISASLMechanism' interface members: getResponse.  [misc]
</I>&gt;<i>     class Plain(object):
</I>&gt;<i> src/twisted/internet/_dumbwin32proc.py:110:1: error: 'Process' is missing following 'twisted.internet.interfaces.ITransport' interface members: getHost, getPeer.  [misc]
</I>&gt;<i>     class Process(_pollingfile._PollingTimer, BaseProcess):
</I>&gt;<i> src/twisted/internet/process.py:959:1: error: 'PTYProcess' is missing following 'twisted.internet.interfaces.ITransport' interface members: getHost, getPeer.  [misc]
</I>&gt;<i>     class PTYProcess(abstract.FileDescriptor, _BaseProcess):
</I>&gt;<i> src/twisted/internet/process.py:959:1: error: 'PTYProcess' is missing following 'IProcessTransport' interface members: closeChildFD, writeToChild.  [misc]
</I>&gt;<i>     class PTYProcess(abstract.FileDescriptor, _BaseProcess):
</I>&gt;<i> src/twisted/internet/base.py:504:1: error: 'ReactorBase' is missing following 'IReactorCore' interface members: run.  [misc]
</I>&gt;<i>     class ReactorBase(PluggableResolverMixin)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> For a class to properly implement a Zope interface, is it mandatory that it  implement every method in that interface?
</I>&gt;<i> 
</I>&gt;<i> Yes.
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> If we modify the classes with mypy errors to properly implement these methods (even with no-ops) is that the correct
</I>&gt;<i> way to go?
</I>&gt;<i> 
</I>&gt;<i> Who does this serve?  I would say no, this is not correct.  If a type declares it implements an interface and it cannot provide useful implementations of every method/attribute, then it made a mistake in its declaration or the interface has the wrong methods/attributes.
</I>&gt;<i> 
</I>
First of all, it's totally awesome that we're catching these problems with mypy!  Thank you to everyone who contributed to get this set up.

I think that different errors probably indicate different problems. Without a lot of motivated consumers of this interface information, it's easy to slip up, and we have slipped up.  And without accurate interface information it's hard to be a discerning consumer!  So there's a bit of a chicken-and-egg problem here, and mypy will help us resolve that paradox, and let people really depend on these.

To opine on the ones listed above specifically, in case this can be more readily generalized:

Anonymous &amp; Plain missing getResponse is probably something they can get away with due to the specifics of how SASL works with those specific mechanisms.  They should still provide an implementation, although it would be fine if it was one that simply raised an explanatory exception explaining why they don't expect to get called in their specific cases.
PTYProcess and Process's missing attributes are just bugs.  I thought they were even already-filed bugs, but I was remembering this one: <A HREF="https://twistedmatrix.com/trac/ticket/4585.">https://twistedmatrix.com/trac/ticket/4585.</A>  There was also <A HREF="https://twistedmatrix.com/trac/ticket/6606">https://twistedmatrix.com/trac/ticket/6606</A> .  As I said: easy to screw this up without any way to consistently check; we've screwed it up in other ways in the past. We should implement all of these methods. 
ReactorBase is another depressing artifact of our inheritance-obsessed initial design, which I hold out hope that we may recover from before my 50th birthday.  The idea here being that subclasses of ReactorBase should be implementing those interfaces, so it'll go ahead and declare them for you.  Now, ReactorBase probably just shouldn't be public in the first place, but this specific attribute of its declaration is simply wrong; it doesn't implement those interfaces and it should not say that it does.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20200607/c3aca4f5/attachment-0001.htm&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065126.html">[Twisted-Python] twistedchecker now uses pylint &gt;= 2.4.4, can we use type annotations in Twisted now?
</A></li>
	<LI>Next message (by thread): <A HREF="065132.html">[Twisted-Python] twistedchecker now uses pylint &gt;= 2.4.4, can we use type annotations in Twisted now?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65127">[ date ]</a>
              <a href="thread.html#65127">[ thread ]</a>
              <a href="subject.html#65127">[ subject ]</a>
              <a href="author.html#65127">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
