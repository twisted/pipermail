<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] composition VS. inheritance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20composition%20VS.%20inheritance&In-Reply-To=%3CCAMTx_3DVYTDe0XQrRe_hJ4OXKGHovBCuECusEz7%3DoJPzEm%3DgcQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065162.html">
   <LINK REL="Next"  HREF="065165.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] composition VS. inheritance</H1>
    <B>Colin Dunklau</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20composition%20VS.%20inheritance&In-Reply-To=%3CCAMTx_3DVYTDe0XQrRe_hJ4OXKGHovBCuECusEz7%3DoJPzEm%3DgcQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] composition VS. inheritance">colin.dunklau at gmail.com
       </A><BR>
    <I>Sun Jun 28 00:48:16 MDT 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065162.html">[Twisted-Python] composition VS. inheritance
</A></li>
        <LI>Next message (by thread): <A HREF="065165.html">[Twisted-Python] composition VS. inheritance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65164">[ date ]</a>
              <a href="thread.html#65164">[ thread ]</a>
              <a href="subject.html#65164">[ subject ]</a>
              <a href="author.html#65164">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Jun 27, 2020 at 8:48 AM Ian Haywood &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ian at haywood.id.au</A>&gt; wrote:

&gt;<i> In smb I have a SMBPacketReceiver that inherits from t.i.p.Protocol, it
</I>&gt;<i> breaks the incoming TCP stream into logical packets (the analogue of
</I>&gt;<i> LineReceiver in line-based protocols).
</I>&gt;<i>
</I>&gt;<i> I then subclass SMBPacketReceiver to SMBProtocol which does a lot of the
</I>&gt;<i> &quot;heavy lifting&quot; analyzing incoming packets.
</I>&gt;<i>
</I>&gt;<i> I've been told in code review to use composition instead of inheritance,
</I>&gt;<i> which is fine in a general sense but I have difficulty applying to
</I>&gt;<i> twisted-specific tasks.
</I>&gt;<i>
</I>&gt;<i> 1. how to do Factory.buildProtocol? It has to return a t.i.p.Protocol,
</I>&gt;<i> but with composition the Protocol object is a private variable of
</I>&gt;<i> SMBPacketReceiver, in turn a private variable of SMBProtocol.
</I>&gt;<i>
</I>&gt;<i> 2. what to do instead of overriding Protocol.dataReceived and access
</I>&gt;<i> incoming data if not allowed to subclass it?
</I>&gt;<i>
</I>&gt;<i> Now  its not that I cant think of workarounds to these two problems, but
</I>&gt;<i> they're ugly
</I>&gt;<i>
</I>&gt;<i> Is there some recent twisted code using composition that I can look at?
</I>

Hi Ian,

Unfortunately we're stuck with inheritance in Twisted. Its developers made
the decision (nearly two decades ago?) to use inheritance (hindsight is
20/20 and all that) and that's permeated through the majority of the
codebase. It's quite difficult to even *imagine* a Twisted without it, let
alone make the necessary (huge and almost certainly breaking) changes to
shift to a composition-oriented design. The good news is that while you're
stuck with inheritance for interacting with the Twisted parts, you're free
to do whatever you want outside of that.

I suggest jumping out of the inheritance world as soon as possible; instead
of having a SMBProtocol inherit from SMBPacketReceiver, make the initial
Protocol subclass as general as possible -- maybe make it just deal with
framing. Then you wired the protocol up with some object(s) that the
protocol interacts with (and interacts with the protocol), and you have
your inheritance escape hatch.

I've been playing with this idea on infobob's functional tests, and will
probably use it in the long-due refactor of infobob's code itself:

- ComposedIRCController
<A HREF="https://github.com/pound-python/infobob/blob/7d6cc51bd6aeba735c6fb081cf042d1157fbc6ca/functional-tests/clients.py#L48">https://github.com/pound-python/infobob/blob/7d6cc51bd6aeba735c6fb081cf042d1157fbc6ca/functional-tests/clients.py#L48</A>
- _ComposedIRCClient subclass
<A HREF="https://github.com/pound-python/infobob/blob/7d6cc51bd6aeba735c6fb081cf042d1157fbc6ca/functional-tests/clients.py#L425">https://github.com/pound-python/infobob/blob/7d6cc51bd6aeba735c6fb081cf042d1157fbc6ca/functional-tests/clients.py#L425</A>

- _IRCClientState
<A HREF="https://github.com/pound-python/infobob/blob/7d6cc51bd6aeba735c6fb081cf042d1157fbc6ca/functional-tests/clients.py#L376">https://github.com/pound-python/infobob/blob/7d6cc51bd6aeba735c6fb081cf042d1157fbc6ca/functional-tests/clients.py#L376</A>

The protocol _ComposedIRCClient (an IRCClient subclass) deals with the
irritating bits of IRC and tells its attached _IRCClientState instance
about incoming protocol events (messages, joins, parts, etc). The protocol
is itself wrapped by ComposedIRCController which is the main interface for
other code to initiate actions which ultimately end up in a method call on
the protocol.

I hope that helps trigger some ideas in your head :)

Colin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20200628/faaeb58e/attachment.htm&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065162.html">[Twisted-Python] composition VS. inheritance
</A></li>
	<LI>Next message (by thread): <A HREF="065165.html">[Twisted-Python] composition VS. inheritance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65164">[ date ]</a>
              <a href="thread.html#65164">[ thread ]</a>
              <a href="subject.html#65164">[ subject ]</a>
              <a href="author.html#65164">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
