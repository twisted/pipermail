<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SSL problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SSL%20problem&In-Reply-To=%3C1166756114.4739.11.camel%40infinite-loop%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047037.html">
   <LINK REL="Next"  HREF="047042.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SSL problem</H1>
    <B>Steve Freitas</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SSL%20problem&In-Reply-To=%3C1166756114.4739.11.camel%40infinite-loop%3E"
       TITLE="[Twisted-Python] SSL problem">sflist at ihonk.com
       </A><BR>
    <I>Thu Dec 21 19:55:14 MST 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047037.html">[Twisted-Python] SSL problem
</A></li>
        <LI>Next message (by thread): <A HREF="047042.html">[Twisted-Python] SSL problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47041">[ date ]</a>
              <a href="thread.html#47041">[ thread ]</a>
              <a href="subject.html#47041">[ subject ]</a>
              <a href="author.html#47041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks JP.

On Thu, 2006-12-21 at 11:04 -0500, Jean-Paul Calderone wrote:
&gt;<i> You have two pieces of data which are yours -  your private key and your
</I>&gt;<i> certificate (which is a csr signed by RapidSSL).  The client needs (at
</I>&gt;<i> least) one more piece of information, though - RapidSSL's certificate.
</I>
I found it here:

<A HREF="http://www.rapidssl.com/cps/rapidssl_01.cer">http://www.rapidssl.com/cps/rapidssl_01.cer</A>

At least, I believe that's right, since despite some looking around, I'm
not sure how to verify by hand that my cert was signed by that CA. (I
played with openssl verify but it gave the OK to my cert without
pointing it at RapidSSL's root cert file, so I don't know that it's
doing what I want.) I've attached my cert in case you're interested.

&gt;<i> Try this.  Put RapidSSL's certificate into a file, subclass
</I>&gt;<i> DefaultOpenSSLContextFactory, override cacheContext, and on self._context,
</I>&gt;<i> call use_certificate_chain_file with the name of the file you put RapidSSL's
</I>&gt;<i> certificate into.
</I>&gt;<i> 
</I>&gt;<i> This causes the server to include it in the handshake which is often
</I>&gt;<i> required for clients to accept your certificate as valid.
</I>
Okay, I tried that...

class MyOpenSSLContextFactory(ssl.DefaultOpenSSLContextFactory):
    def cacheContext(self):
        ssl.DefaultOpenSSLContextFactory.cacheContext(self)
        self._context.use_certificate_chain_file(CA_CERT_FILE)

...and nothing at all would connect to it. But read on...

&gt;<i> At some point, I think connectionLost for SSL connections was adjusted
</I>&gt;<i> so that the SSL exception would be available.  However, the important
</I>&gt;<i> information is going to be on the client side &lt;snip&gt;
</I>
So based on this information, I whipped up a Twisted SSL client to hit
it so see what's wrong, and it tossed this out:

2006/12/21 20:36 CST [POP3Client,client] Traceback (most recent call
last):
        Failure: OpenSSL.SSL.Error: [('SSL routines', 'SSL3_READ_BYTES',
'sslv3 alert handshake failure'), ('SSL routines', 'SSL3_WRITE_BYTES',
'ssl handshake failure')]

Not sure if that's informative enough to suggest a next step!

Thanks for your help,

Steve
-------------- next part --------------
-----BEGIN CERTIFICATE-----
MIIDRTCCAq6gAwIBAgIDBSYeMA0GCSqGSIb3DQEBBAUAMFoxCzAJBgNVBAYTAlVT
MRwwGgYDVQQKExNFcXVpZmF4IFNlY3VyZSBJbmMuMS0wKwYDVQQDEyRFcXVpZmF4
IFNlY3VyZSBHbG9iYWwgZUJ1c2luZXNzIENBLTEwHhcNMDYxMjIwMjA1OTAzWhcN
MDcxMjIxMjA1OTAzWjCBtDELMAkGA1UEBhMCVVMxGjAYBgNVBAoTEW1haWwuaGFt
YmVycnkuY29tMRMwEQYDVQQLEwpHVDAxNzg0NDM4MScwJQYDVQQLEx5TZWUgd3d3
LnJhcGlkc3NsLmNvbS9jcHMgKGMpMDUxLzAtBgNVBAsTJkRvbWFpbiBDb250cm9s
IFZhbGlkYXRlZCAtIFJhcGlkU1NMKFIpMRowGAYDVQQDExFtYWlsLmhhbWJlcnJ5
LmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwhbwBpjWAPoh7RycuNmh
LTPRea2Sn1vBJjOEh4Ykz9ygU9Jg1oYrehcdbE8Kr67sqYmBXP9Cc9E1ggze5MSP
Ah4+LN4HvhrBJejFHL3EIJsw4zNHs5oaQotTESXTcCQaoY0+TYg4F+naFsbIg8wu
bx+d3wTLbD/ra1X2T21fdBMCAwEAAaOBvTCBujAOBgNVHQ8BAf8EBAMCBPAwHQYD
VR0OBBYEFBIbxks9N2DLNItskPfnvkchalyMMDsGA1UdHwQ0MDIwMKAuoCyGKmh0
dHA6Ly9jcmwuZ2VvdHJ1c3QuY29tL2NybHMvZ2xvYmFsY2ExLmNybDAfBgNVHSME
GDAWgBS+qKB0clBrRLfJI9j7qP+zV2tobDAdBgNVHSUEFjAUBggrBgEFBQcDAQYI
KwYBBQUHAwIwDAYDVR0TAQH/BAIwADANBgkqhkiG9w0BAQQFAAOBgQBmfT5Tzsft
qnvYrK71y7SHnUHM3dlDaRY4uLb1poE/BktG4eYGsKoBi/2bBK3rdgPi0NchaFqq
bJxJOnjYQFSmpMgeFp5jEYlJGIiZalhXh7sPtz+dBfD4sGEd5y3L9Oyu60DokmbL
EqemXOWWeQpa25IKUWcNt9O7jeoHRZSrYg==
-----END CERTIFICATE-----
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047037.html">[Twisted-Python] SSL problem
</A></li>
	<LI>Next message (by thread): <A HREF="047042.html">[Twisted-Python] SSL problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47041">[ date ]</a>
              <a href="thread.html#47041">[ thread ]</a>
              <a href="subject.html#47041">[ subject ]</a>
              <a href="author.html#47041">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
