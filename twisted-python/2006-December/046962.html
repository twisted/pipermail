<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] robust listenUDP with N clients?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20robust%20listenUDP%20with%20N%20clients%3F&In-Reply-To=%3C45743EB9.3070204%40acm.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="046964.html">
   <LINK REL="Next"  HREF="046963.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] robust listenUDP with N clients?</H1>
    <B>marc bohlen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20robust%20listenUDP%20with%20N%20clients%3F&In-Reply-To=%3C45743EB9.3070204%40acm.org%3E"
       TITLE="[Twisted-Python] robust listenUDP with N clients?">marcbohlen at acm.org
       </A><BR>
    <I>Mon Dec  4 08:28:57 MST 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="046964.html">[Twisted-Python] peer 2 peer, udp, stdio -&gt; very confused
</A></li>
        <LI>Next message (by thread): <A HREF="046963.html">[Twisted-Python] robust listenUDP with N clients?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46962">[ date ]</a>
              <a href="thread.html#46962">[ thread ]</a>
              <a href="subject.html#46962">[ subject ]</a>
              <a href="author.html#46962">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi folks

I am new to twisted and new to server programming. Nonetheless, I would 
like to build a robust client-server looping mechanism in which a server 
would listen for input from N clients, say 10, and react immediately 
when it receives data from them. I have a sample (see below) that 
appears to run well, but am not sure if it will scale under real network 
load and larger N.
(I am parsing the input data received from the clients and using it to 
calculate a fibonnaci series, just for testing. The reactor can be 
stopped with keyboard input (I am on a win32 platform)).

If you see any problems with this approach, please let me know !
Thanks, marc

CODE:

import os, sys, time, msvcrt
from twisted.internet import reactor, defer, task
from twisted.internet.protocol import DatagramProtocol
ports = [1007, 2007, 3007, 4007, 5007, 6007, 7007, 8007, 9007]
#----------------------------
def check_keyboard(result):
   try:
       if(msvcrt.kbhit()):
           result = &quot;hit&quot;
   except:         pass

   return result
#---------------------------
def mstop(result):
   if(result == &quot;hit&quot;):
       print &quot;got hit - closing task and reactor&quot;
       mtask.stop()
       reactor.stop()
#---------------------------
def print_time(result):
   print time.asctime(time.localtime())
#---------------------------
def fibonnaci(limit):
   first, new, second = 0,0,1
   for i in xrange(limit - 1):
       new = first + second
       first = second
       second = new
   return new
#---------------------------
def mrun():
   d = defer.Deferred()
   d.addCallback(check_keyboard)
   d.addCallback(mstop)
   d.addCallback(print_time)
   d.callback(&quot;blabla&quot;)
#---------------------------
class server(DatagramProtocol):
   def datagramReceived(self, data, (host, port)):
       print &quot;server received: %r from %s:%d&quot; % (data, host, port)
       self.transport.write(data, (host, port))
       limit = int(data.split(&quot;: &quot;)[1])
       num = fibonnaci(limit)
   print num
#---------------------------

if __name__ == '__main__':
   print &quot;listening on 9 ports - hit key to quit&quot;
   mrun()
   mtask = task.LoopingCall(mrun)
   mtask.start(1.0)
   for i in range (0,(len(ports))):
       reactor.listenUDP(ports[i], server())
reactor.run()
#--------------------------





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="046964.html">[Twisted-Python] peer 2 peer, udp, stdio -&gt; very confused
</A></li>
	<LI>Next message (by thread): <A HREF="046963.html">[Twisted-Python] robust listenUDP with N clients?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46962">[ date ]</a>
              <a href="thread.html#46962">[ thread ]</a>
              <a href="subject.html#46962">[ subject ]</a>
              <a href="author.html#46962">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
