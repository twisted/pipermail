<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Punching a firewall with (or without) Twisted -	the plot thickens
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Punching%20a%20firewall%20with%20%28or%20without%29%20Twisted%20-%0A%09the%20plot%20thickens&In-Reply-To=AANLkTikvfPKGXMmnvakNezIbMPYhnpPSErjn-QDJLXN5%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022374.html">
   <LINK REL="Next"  HREF="022378.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Punching a firewall with (or without) Twisted -	the plot thickens</H1>
    <B>Stefan Reich</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Punching%20a%20firewall%20with%20%28or%20without%29%20Twisted%20-%0A%09the%20plot%20thickens&In-Reply-To=AANLkTikvfPKGXMmnvakNezIbMPYhnpPSErjn-QDJLXN5%40mail.gmail.com"
       TITLE="[Twisted-Python] Punching a firewall with (or without) Twisted -	the plot thickens">wertiges.produkt at googlemail.com
       </A><BR>
    <I>Thu Jun 17 14:53:00 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022374.html">[Twisted-Python] Punching a firewall with Twisted?
</A></li>
        <LI>Next message: <A HREF="022378.html">[Twisted-Python] Punching a firewall with (or without) Twisted	- the plot thickens
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22377">[ date ]</a>
              <a href="thread.html#22377">[ thread ]</a>
              <a href="subject.html#22377">[ subject ]</a>
              <a href="author.html#22377">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>lasizoillo wrote:
&gt;<i> I don't know if this is Deluge's method, but sounds interesting:
</I>&gt;<i> <A HREF="http://samy.pl/natpin/?port=80">http://samy.pl/natpin/?port=80</A>
</I>&gt;<i>   
</I>Hm. That's another kind of hack, and it didn't work for me.
&gt;<i> If you don't want see deluge code, maybe you want use a sniffer.
</I>&gt;<i> Wireshark is great for these things ;-)
</I>&gt;<i> <A HREF="http://www.wireshark.org/">http://www.wireshark.org/</A>
</I>&gt;<i>   
</I>Wireshark! What a nice tool that wasn't on my radar before. Thanks for 
this, it really helped.

Using Wireshark, I found out that both Bittorrent and Deluge talk to the 
gateway via UPNP for opening the port. It all works over HTTP, so it's 
really easy to see what's going on.

These are the steps:

1. Find out the gateway IP (192.168.0.1 or some such)

2. GET <A HREF="http://{gateway}/desc.xml.">http://{gateway}/desc.xml.</A> This makes the gateway print some 
information about itself (make &amp; model and so on). Not sure why this is 
needed. Maybe the protocol is different for different gateways. Or to 
make sure that there is a gateway at all. Or maybe there is some detail 
information in there that is needed for the next steps.

3. Also sent to the gateway: POST /upnp/control3 with some XML/SOAP data 
containing a command called AddPortMapping.

It looks really easy, like you could reprogram this in a few lines, with 
a SOAP library, or even just manual XML. There's also a command called 
DeletePortMapping for proper cleanup.

And it seems like Twisted may actually not even be involved in Deluge's 
port opening code.

Ah. I'm really quite satisfied. I heard that there are tricks to open 
firewalls (Skype's been doing this for ages), but I didn't know that 
there is such an elegant solution.

Cheers and thanks for the hints,
Stefan

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022374.html">[Twisted-Python] Punching a firewall with Twisted?
</A></li>
	<LI>Next message: <A HREF="022378.html">[Twisted-Python] Punching a firewall with (or without) Twisted	- the plot thickens
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22377">[ date ]</a>
              <a href="thread.html#22377">[ thread ]</a>
              <a href="subject.html#22377">[ subject ]</a>
              <a href="author.html#22377">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
