<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Multiple clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Multiple%20clients&In-Reply-To=201006182055.49458.bszabolcs%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022398.html">
   <LINK REL="Next"  HREF="022392.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Multiple clients</H1>
    <B>Kevin Horn</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Multiple%20clients&In-Reply-To=201006182055.49458.bszabolcs%40gmail.com"
       TITLE="[Twisted-Python] Multiple clients">kevin.horn at gmail.com
       </A><BR>
    <I>Fri Jun 18 18:24:10 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022398.html">[Twisted-Python] Multiple clients
</A></li>
        <LI>Next message: <A HREF="022392.html">[Twisted-Python] Multiple clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22399">[ date ]</a>
              <a href="thread.html#22399">[ thread ]</a>
              <a href="subject.html#22399">[ subject ]</a>
              <a href="author.html#22399">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Jun 18, 2010 at 12:55 PM, Szabolcs Balogh &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bszabolcs at gmail.com</A>&gt;wrote:

&gt;<i>
</I>&gt;<i> It is possible to:
</I>&gt;<i>  - start the reactor when I initialize my program (eg. in main)
</I>&gt;<i>  - call connectTCP or connectSSL when I want and every time I want?
</I>&gt;<i>
</I>&gt;<i>
</I>Yes, this is exactly what you are supposed to do.  Call the reactor _once_
and once only.

The call connectTCP or whatever whenever is appropriate for your program.


&gt;<i> Something like this:
</I>&gt;<i>
</I>&gt;<i> def check_messages(account):
</I>&gt;<i>        # connect to imap server and check for new mailboxes/messages
</I>&gt;<i>        reactor.connectSSL(...)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> if __name__ == &quot;__main__&quot;:
</I>&gt;<i>        reactor.run()
</I>&gt;<i>
</I>&gt;<i>        check_message(account1)
</I>&gt;<i>        check_message(account2)
</I>&gt;<i>        ...
</I>&gt;<i>        do something else
</I>&gt;<i>        ...
</I>&gt;<i>        check_message(accountn)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Because I can't implement this :}
</I>&gt;<i>
</I>&gt;<i> I have started the implementation based on &quot;Twisted Network Programming
</I>&gt;<i> Essential&quot;, but this book doesn't treat multiple connections...
</I>&gt;<i>
</I>&gt;<i>
</I>The above won't work, because run() blocks.  So in your example here,
check_messages() won't be called until after the run() call returns, which
means the reactor won't be running, which means check_messages won't work.

look into callWhenRunning:
<A HREF="http://twistedmatrix.com/documents/10.0.0/api/twisted.internet.interfaces.IReactorCore.html#callWhenRunning">http://twistedmatrix.com/documents/10.0.0/api/twisted.internet.interfaces.IReactorCore.html#callWhenRunning</A>

and do something like:

def start_checking():
    (do your check_messages stuff here)

if __name__ == '__main__':
    reactor.callWhenRunning(start_checking)

    reactor.run()

using callWhenRunning isn't necessary, but I find that it clarifies things
for me sometimes

reactor.run() is usually the _last_ thing I call in my Twisted programs,
unless I have some shutdown cleanup to do, and even that is usually better
done in the reactor shutdown hook
(see:
<A HREF="http://twistedmatrix.com/documents/10.0.0/api/twisted.internet.interfaces.IReactorCore.html#addSystemEventTrigger">http://twistedmatrix.com/documents/10.0.0/api/twisted.internet.interfaces.IReactorCore.html#addSystemEventTrigger</A>
)

you also need to figure out how to structure your program flow using
deferreds, which is not always easy, and depends greatly on your specific
application.

remember that deferreds are just a way of organizing callback functions

you can &quot;chain&quot; deferreds something like this (assuming your functions
return Deferreds):

d = check_first_one()
d.addCallback(check_second_one, ...)

etc...

which will make check_second_one start after check_first_one completes

You can also use a deferredList, which is often handy when you want to keep
track of several deferred operations which are operating simultaneously
(I haven't used one in a while, so I don't have a simple example off the top
of my head, but there's a simple example in the Twisted book)

Hope this helps,

Kevin Horn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100618/f9335a51/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100618/f9335a51/attachment.htm</A> 
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022398.html">[Twisted-Python] Multiple clients
</A></li>
	<LI>Next message: <A HREF="022392.html">[Twisted-Python] Multiple clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22399">[ date ]</a>
              <a href="thread.html#22399">[ thread ]</a>
              <a href="subject.html#22399">[ subject ]</a>
              <a href="author.html#22399">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
