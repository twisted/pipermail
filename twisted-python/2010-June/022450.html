<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] runInteraction function returning a deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20runInteraction%20function%20returning%20a%20deferred&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022452.html">
   <LINK REL="Next"  HREF="022453.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] runInteraction function returning a deferred</H1>
    <B>Landreville</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20runInteraction%20function%20returning%20a%20deferred&In-Reply-To="
       TITLE="[Twisted-Python] runInteraction function returning a deferred">landreville at deadtreepages.com
       </A><BR>
    <I>Mon Jun 28 10:19:11 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022452.html">[Twisted-Python] reactor.spawnProcess() and file descriptors
</A></li>
        <LI>Next message: <A HREF="022453.html">[Twisted-Python] runInteraction function returning a deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22450">[ date ]</a>
              <a href="thread.html#22450">[ thread ]</a>
              <a href="subject.html#22450">[ subject ]</a>
              <a href="author.html#22450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am working with a third-party web-scraping application that also
uses twisted (Scrapy) and would like for it to do its thing in a
transaction along with a database action. This can be done with
runInteraction, but Scrapy uses a non-blocking call when it does its
thing. This actually doesn't even return a deferred, but you pass in
the callback function you would like it to call when finished.

Is there some way for runInteraction to wait for this deferred to be
finished before ending the transaction?

Or could something like this work, where the thread gets paused until
it completes?:
def interaction(txn):

        finished = {'test':False, 'failed': False}

        def _cb(r):
            finished['test'] = True

        def _err(failure):
            finished['failed'] = True

        Spider.crawl(_cb, _err)

        # do database stuff here

        while not finished['test'] and not finished['failed']:
            time.sleep(0.25)

        if finished['failed']:
            raise Exception('Web scraping failed.')

d = dbpool.runInteraction(interaction)




Thanks for a look,

Landreville

</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022452.html">[Twisted-Python] reactor.spawnProcess() and file descriptors
</A></li>
	<LI>Next message: <A HREF="022453.html">[Twisted-Python] runInteraction function returning a deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22450">[ date ]</a>
              <a href="thread.html#22450">[ thread ]</a>
              <a href="subject.html#22450">[ subject ]</a>
              <a href="author.html#22450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
