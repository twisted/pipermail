<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Multiple plugins in &quot;twistd&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20plugins%20in%20%22twistd%22&In-Reply-To=%3C1DBE6BD3-AA90-405E-8A67-E6DC0DA8D9D4%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029501.html">
   <LINK REL="Next"  HREF="029504.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Multiple plugins in &quot;twistd&quot;</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20plugins%20in%20%22twistd%22&In-Reply-To=%3C1DBE6BD3-AA90-405E-8A67-E6DC0DA8D9D4%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Multiple plugins in &quot;twistd&quot;">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue May 19 13:02:20 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029501.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
        <LI>Next message: <A HREF="029504.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29503">[ date ]</a>
              <a href="thread.html#29503">[ thread ]</a>
              <a href="subject.html#29503">[ subject ]</a>
              <a href="author.html#29503">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On May 19, 2015, at 05:59, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;<i> 
</I>&gt;<i> On 12:07 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">zadka.moshe at gmail.com</A> wrote:
</I>&gt;&gt;<i> Background
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Currently, &quot;twistd&quot; assumes one-run-one-plugin. It would be nice to load up
</I>&gt;&gt;<i> multiple plug-ins in Twisted, for many reasons. These include: serving the
</I>&gt;&gt;<i> same in-memory content via separate protocols, adding manhole to other
</I>&gt;&gt;<i> plug-ins (so the end-deployer can add it to other things, as opposed to the
</I>&gt;&gt;<i> original implementor, and a catch-all category of &quot;auxiliary services&quot;.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Auxiliary services are those which are not useful in and of themselves, but
</I>&gt;&gt;<i> add value to a service which does something else of use.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Examples of auxiliary services -- a logging service (that connects to some
</I>&gt;&gt;<i> logging protocol on start-up), a metrics service (that sends statistics to
</I>&gt;&gt;<i> a collector like statsd or riemann) or an error-sending service (to
</I>&gt;&gt;<i> something like Sentry).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Proposal
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> tl;dr: four new tickets (codenamed SUBCOMMANDS, SERVICES, MANHOLE and
</I>&gt;&gt;<i> PROVIDERS) and one old ticket (3538)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> SUBCOMMANDS: Add '+' as a special character in t.p.usage.Options. This
</I>&gt;&gt;<i> behavior will be off by default, and controlled by an attribute on the
</I>&gt;&gt;<i> Options instance &quot;allowMultipleSubcommands&quot;.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The attribute will only be checked when the first sub-command starts, to
</I>&gt;&gt;<i> allow setting it based on global flags. When the option is on, '-+' will be
</I>&gt;&gt;<i> passed as '+' to the Options instance, to allow sending plain '+' to
</I>&gt;&gt;<i> sub-commands.
</I>&gt;<i> 
</I>&gt;<i> Having a new, weird, fragile syntax is probably the least interesting part of this.  I suggest not doing this part - or at the very least, not doing it first and not making it a general part of `Options`.
</I>&gt;<i> 
</I>&gt;<i> There are lots of other ways to get the service object from more than one service plugin.  For example, read lines from a file.  Or have a variation of `--python` or something else similar using the existing option syntax `Options` supports.
</I>&gt;<i> 
</I>&gt;<i> The more interesting part to get right is the underlying model which you discuss elsewhere.
</I>
I love new, weird syntaxes, but I have to agree here.  Let's do it with a boring syntax with no compatibility implications first.  The boring syntax would actually be quite similar to the exciting one; a &quot;compose&quot; plugin.  Consider: &quot;twistd compose web --path . + words --irc-port=6789&quot;.  There's no need to make this a general feature of Options to do it this way; just have the &quot;compose&quot; plugin take its argument list and pass it to two discrete other Options instances as lists of strings, looking for a &quot;+&quot; simply as the place to split the argument list.  You could also find some other way to split the argument list but &quot;+&quot; doesn't seem particularly obscure in this context to me.  (If there's really a need to pass a literal &quot;+&quot; to a plugin we could add an escaping syntax as well.)

&gt;&gt;<i> Glyph thinks there's a ticket for it. I couldn't find it in &quot;search for
</I>&gt;&gt;<i> tickets in 'core' whose description mentionds 'command'&quot;. Unless anyone can
</I>&gt;&gt;<i> find it, I'll open a new ticket.
</I>&gt;<i> 
</I>&gt;<i> I think there is a ticket for being able to use multiple twistd plugins. I don't think there's a ticket for a general change to `Options`.
</I>
I was referring to the multiple-twistd-plugin ticket.

&gt;&gt;<i> SERVICES (depends on SUBCOMMANDS): In twistd, set the flag aMS if
</I>&gt;&gt;<i> '--allow-multiple-services' is given. Add to the application all services.
</I>&gt;<i> 
</I>&gt;<i> If you skip the `SUBCOMMANDS` ticket described above, then you can skip this too.
</I>&gt;&gt;<i> 3538 (depends on SERVICES): If '--allow-multiple-services' is given, and
</I>&gt;&gt;<i> '--python &lt;.tac file&gt;' is given, process subcommands as usual.
</I>&gt;<i> 
</I>&gt;<i> Or just process the tac file and the subcommand if they're both given - without requiring an extra option?  The current behavior, &quot;silently ignore one of the arguments&quot;, doesn't seem particularly worth keeping to me.
</I>
It seems halfway plausible to me that someone could have some automation that chooses a plugin and/or a python file and expects that one or the other will be ignored.  So we should do the usual incompatibility-notification dance but I don't anticipate any objections.

&gt;&gt;<i> PROVIDERS: Add a function,
</I>&gt;&gt;<i>      &quot;providersInHierarchy(IService, IInterface) -&gt; List[IInterface]&quot;
</I>&gt;&gt;<i> that returns all services in the hierarchy which provide the interface.
</I>&gt;&gt;<i> This ticket does not depend on any other tickets.
</I>&gt;<i> 
</I>&gt;<i> The first argument needs to be `IServiceCollection` instead of `IService`.
</I>&gt;&gt;<i> MANHOLE (depends on PROVIDERS, SERVICES): Add a built-in twistd plugin
</I>&gt;&gt;<i> named &quot;manhole&quot;. The plugin will expose manhole as PB/telnet with a
</I>&gt;&gt;<i> namespace that includes
</I>&gt;&gt;<i> {'services': providersInHierarchy(manholeService, IService)}
</I>&gt;&gt;<i> This ticket technically could only depend on PROVIDERS, but to be useful,
</I>&gt;&gt;<i> it also depends on SERVICES
</I>&gt;<i> 
</I>&gt;<i> Manhole is part of Conch now and the telnet manhole is deprecated (and the PB manhole really should be deprecated - using a structured protocol for manhole isn't a bad idea but the existing implementation is half broken, mostly untested, exposes tons of implementation details as part of the public interface, etc.  If this were a piece of widely used software it would probably be worth gradually renovating - but it's basically used by no one so starting fresh makes more sense).
</I>&gt;<i> 
</I>&gt;<i> So it's part of Conch.  And ... it exists already.  I'm pretty sure no one will object if you add a new name to the default namespace.
</I>&gt;<i> 
</I>&gt;<i> Thanks for taking this on.
</I>
Yeah.  It's great to have you around again, Moshe :).

-glyph


</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029501.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
	<LI>Next message: <A HREF="029504.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29503">[ date ]</a>
              <a href="thread.html#29503">[ thread ]</a>
              <a href="subject.html#29503">[ subject ]</a>
              <a href="author.html#29503">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
