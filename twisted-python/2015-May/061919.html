<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted-Python Digest, Vol 132, Issue 23
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted-Python%20Digest%2C%20Vol%20132%2C%20Issue%2023&In-Reply-To=%3C2E0A0B508EE01A488C1CC7275D3706B9D09C4B51%40DC1EXCHANGE.nuspire.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted-Python Digest, Vol 132, Issue 23</H1>
    <B>Timothy Gallagher</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted-Python%20Digest%2C%20Vol%20132%2C%20Issue%2023&In-Reply-To=%3C2E0A0B508EE01A488C1CC7275D3706B9D09C4B51%40DC1EXCHANGE.nuspire.net%3E"
       TITLE="[Twisted-Python] Twisted-Python Digest, Vol 132, Issue 23">timothy.gallagher at nuspire.com
       </A><BR>
    <I>Tue May  5 16:17:18 MDT 2015</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61919">[ date ]</a>
              <a href="thread.html#61919">[ thread ]</a>
              <a href="subject.html#61919">[ subject ]</a>
              <a href="author.html#61919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph I just saw this response in my junk mail.  Thank you for the help, I can work with this.

Tj

-----Original Message-----
From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-request at twistedmatrix.com</A>
Sent: Friday, March 20, 2015 1:26 AM
To: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Subject: Twisted-Python Digest, Vol 132, Issue 23

Send Twisted-Python mailing list submissions to
	<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>

To subscribe or unsubscribe via the World Wide Web, visit
	<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
or, via email, send a message with subject or body 'help' to
	<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-request at twistedmatrix.com</A>

You can reach the person managing the list at
	<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-owner at twistedmatrix.com</A>

When replying, please edit your Subject line so it is more specific than &quot;Re: Contents of Twisted-Python digest...&quot;


Today's Topics:

   1. custom FTP server is blocking (Paul Wiseman)
   2. Re: custom FTP server is blocking (Louis D. Burr)
   3. Re: __nonzero__ for Deferred (Glyph Lefkowitz)
   4. Re: Removing Python 2.6 Support after Twisted 15.1 (David Ripton)
   5. Re: twistechecker and twisted-dev-tools as part of	twisted
      main repo (Glyph)
   6. Re: twisted echo ssl client with .p12 (Glyph)


----------------------------------------------------------------------

Message: 1
Date: Thu, 19 Mar 2015 18:18:27 +0000
From: Paul Wiseman &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">poalman at gmail.com</A>&gt;
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Subject: [Twisted-Python] custom FTP server is blocking
Message-ID:
	&lt;CACgdh2i4n5CgwiOQ124YeM-Cyqp+3rMwHGFN7cnq5dt=<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">C_Ne0A at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=UTF-8

I have some blocking going on in a custom twisted ftp server and I'm trying to pin point what exactly is doing it.

I think this line in openForReading on my FTPShell object could be the culprit:

_FileReader(urllib2.urlopen(result.link,timeout=settings.GLOBAL_TIMEOUT))

(_FileReader is twisted.protocols.ftp._FileReader and result.link a url string)

I'm guessing urllib2.urlopen blocks resolving the domain and connecting? What would be the twisted equivalent way of providing a file like object of the download stream to the FileReader that wouldn't block?

Regards,

Paul



------------------------------

Message: 2
Date: Thu, 19 Mar 2015 15:38:30 -0500
From: &quot;Louis D. Burr&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ldanielburr at me.com</A>&gt;
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Subject: Re: [Twisted-Python] custom FTP server is blocking
Message-ID: &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">3E9E76E8-E3D3-4905-86B1-0003192C2834 at me.com</A>&gt;
Content-Type: text/plain; charset=us-ascii

Hi Paul,

&gt;<i> On Mar 19, 2015, at 1:18 PM, Paul Wiseman &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">poalman at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> I have some blocking going on in a custom twisted ftp server and I'm 
</I>&gt;<i> trying to pin point what exactly is doing it.
</I>&gt;<i> 
</I>&gt;<i> I think this line in openForReading on my FTPShell object could be the culprit:
</I>&gt;<i> 
</I>&gt;<i> _FileReader(urllib2.urlopen(result.link,timeout=settings.GLOBAL_TIMEOU
</I>&gt;<i> T))
</I>&gt;<i> 
</I>
Yeah, urllib2.urlopen() blocks, so this is at least one place in your code that will cause you a problem.

&gt;<i> (_FileReader is twisted.protocols.ftp._FileReader and result.link a 
</I>&gt;<i> url string)
</I>&gt;<i> 
</I>&gt;<i> I'm guessing urllib2.urlopen blocks resolving the domain and 
</I>&gt;<i> connecting? What would be the twisted equivalent way of providing a 
</I>&gt;<i> file like object of the download stream to the FileReader that 
</I>&gt;<i> wouldn't block?
</I>&gt;<i> 
</I>
You probably want to use twisted.web.client.Agent for this, as it allows you to perform non-blocking http requests.  If you can live with buffering the http response body into, say, a tempfile or an io.BytesIO instance, then you can just pass that to _FileReader as the fObj argument and call it a day.


Hope this helps,

--
L. Daniel Burr




------------------------------

Message: 3
Date: Thu, 19 Mar 2015 14:13:48 -0700
From: Glyph Lefkowitz &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Subject: Re: [Twisted-Python] __nonzero__ for Deferred
Message-ID: &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">18084B73-66AE-4F0A-857C-507D27537533 at twistedmatrix.com</A>&gt;
Content-Type: text/plain; charset=us-ascii


&gt;<i> On Mar 18, 2015, at 5:50 PM, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;<i> 
</I>&gt;<i> On 18 Mar, 10:03 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i> I'd like to deprecate and remove __nonzero__ on Deferreds. Occasionally I see code where someone (maybe even me) does &quot;if d:&quot; where they should have been doing &quot;@d.addCallback def cb(result): if result: ...&quot;.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Anybody else have this issue?  Objections?
</I>&gt;<i> 
</I>&gt;<i> Er.  What?  It's a little early for april fools' day, isn't it?
</I>
&gt;<i> Seriously, this is weird.  Am I missing something?
</I>
Apparently?

&gt;<i> Can expand on what it would mean to deprecated a special method of a 
</I>&gt;<i> class that doesn't even define it
</I>
Add such a method and cause it to emit a warning, then raise an exception.

&gt;<i> and what makes Deferred unique among all user-defined classes in this regard.
</I>
As I stated in my original message, there's a class of bug where someone does &quot;if somethingThatReturnsDeferred()&quot;.  Particularly, &quot;if checkPassword()&quot; is a dangerous manifestation of this class of bug.  I'd like this to fail noisily instead of appearing to work.

In my opinion, having all user-defined classes implement true truthiness by default is a design error in the language.  It's a usually-harmless one except in a few cases, and this is one of those cases, which is why Deferred is not the same as the average user-defined class.

-glyph




------------------------------

Message: 4
Date: Thu, 19 Mar 2015 20:23:35 -0400
From: David Ripton &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dripton at ripton.net</A>&gt;
To: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Subject: Re: [Twisted-Python] Removing Python 2.6 Support after
	Twisted 15.1
Message-ID: &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">550B6887.4020703 at ripton.net</A>&gt;
Content-Type: text/plain; charset=utf-8

On 03/19/2015 08:05 AM, Phil Mayers wrote:
&gt;<i> On 18/03/15 23:57, Glyph Lefkowitz wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Rather than just suggest we preserve the status quo and stay on 2.6 
</I>&gt;&gt;<i> forever to do indefinite free work to support Red Hat's obsolescence
</I>&gt;<i> 
</I>&gt;<i> You *definitely* shouldn't do that. Push back on RedHat, and tell 
</I>&gt;<i> customers to push back on RedHat. I say this to other projects.
</I>
Red Hat supports old versions of RHEL forever because they have customers that want that (because they have legacy apps that they want to keep working with minimal maintenance, but who still want security patches), and are willing to pay for it.  It's a good thing that someone provides that option, even if we don't all need it.

That doesn't mean Twisted needs to support old versions of RHEL forever.
 RHEL 7 has been out for a while, and comes with Python 2.7 as the default.  So even if Twisted drops support for Python 2.6, it'll still work on RHEL.  (Just not on old versions of RHEL.)

Furthermore, SCL makes Python 2.7 available (in /opt) on RHEL 5 and 6 and CentOS 6, without users needing to build it themselves.  So even those who are stuck with old versions can install SCL, then use pip to install new Twisted.

IOW, I wouldn't worry about it.  Drop support for Python 2.6 when it makes sense for Twisted.

-- 
David Ripton    <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dripton at ripton.net</A>



------------------------------

Message: 5
Date: Thu, 19 Mar 2015 20:25:04 -0700
From: Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Subject: Re: [Twisted-Python] twistechecker and twisted-dev-tools as
	part of	twisted main repo
Message-ID: &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">790710C6-7461-4E4C-A796-381BD3ED2679 at twistedmatrix.com</A>&gt;
Content-Type: text/plain; charset=utf-8


&gt;<i> On Mar 19, 2015, at 8:41 AM, Christopher Armstrong &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">radix at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> On Mar 19, 2015, at 4:45 AM, Adi Roiban &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> OK, cool.  I didn't realize that was ready for review.  I am liking 
</I>&gt;&gt;&gt;<i> the process we have for Mimic for flagging PRs with keywords - 
</I>&gt;&gt;&gt;<i> <A HREF="https://github.com/rackerlabs/mimic/pulls">https://github.com/rackerlabs/mimic/pulls</A> - but this needs 
</I>&gt;&gt;&gt;<i> automation so as not to be unfriendly to non-committer contributors.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I'll try to get to it by the end of the week.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> For twistedchecker I start using tags ... but I don't have 
</I>&gt;&gt;<i> permissions for twisted-infra repos.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Yes. GitHub PR are nice but horrible for implementing anything formal 
</I>&gt;&gt;<i> on top of it.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I was preparing to suggest someting similar also for Trac as 
</I>&gt;&gt;<i> sometimes I am not sure if a comment is 'do minor changes and merge' 
</I>&gt;&gt;<i> or 'do minor change and send them for review'
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> My suggestion is this:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> when a PR is ready for review the author should leave a comment 
</I>&gt;&gt;<i> containing the `needs-review` marker. This will send a hook and a 
</I>&gt;&gt;<i> custom hook server will update the tags of the ticket.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I suggest making the default, tagless state of a PR mean ?in review?, for a couple of reasons:
</I>&gt;<i> 
</I>&gt;<i> - having labels for both `needs-changes` and `in-review` means you can 
</I>&gt;<i> enter an invalid state where both labels are applied
</I>&gt;<i> - if the automation loses track of a PR, we don?t want people 
</I>&gt;<i> filtering only for PRs with `label:in-review` and missing out on the 
</I>&gt;<i> forgotten PR
</I>&gt;<i> 
</I>&gt;<i> so I propose tagless PRs be considered ?in review?, and a label only for `needs-changes`.
</I>
I like seeing the big green &quot;ready for review&quot; on Mimic PRs; it's more eye-catching.  We can have 2 labels though, so that if the automation breaks, we can have a periodic check that adds &quot;in-review&quot; to everything un-labeled.

-g


------------------------------

Message: 6
Date: Thu, 19 Mar 2015 22:25:10 -0700
From: Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Subject: Re: [Twisted-Python] twisted echo ssl client with .p12
Message-ID: &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">1AE7D177-6F83-4204-B088-3706F7E1B05F at twistedmatrix.com</A>&gt;
Content-Type: text/plain; charset=&quot;us-ascii&quot;


&gt;<i> On Mar 19, 2015, at 8:36 AM, Louis D. Burr &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ldanielburr at me.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi Timothy,
</I>&gt;<i> 
</I>&gt;&gt;<i> On Mar 19, 2015, at 9:56 AM, Timothy Gallagher &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">timothy.gallagher at nuspire.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">timothy.gallagher at nuspire.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Hello all,
</I>&gt;&gt;<i> I have a project that requires client server with ssl/tls including client certificate authentication.  Also the a requirement is that the client needs to use a .p12 file to house its keys.  I have the server part and client part down except I cannot find any code examples using a .p12 file to get the certificates.  Can this be done without having to hack into the ssl.ClientConextFactory?
</I>&gt;<i> 
</I>&gt;<i> Maybe <A HREF="http://stackoverflow.com/questions/6345786/python-reading-a-pkcs12-certificate-with-pyopenssl-crypto">http://stackoverflow.com/questions/6345786/python-reading-a-pkcs12-certificate-with-pyopenssl-crypto</A> &lt;<A HREF="http://stackoverflow.com/questions/6345786/python-reading-a-pkcs12-certificate-with-pyopenssl-crypto">http://stackoverflow.com/questions/6345786/python-reading-a-pkcs12-certificate-with-pyopenssl-crypto</A>&gt; will be useful to you.  Twisted uses pyopenssl under the covers, so the solution exarkun posted to StackOverflow should be applicable.
</I>&gt;<i> 
</I>&gt;<i> Hope this helps,
</I>&gt;<i> 
</I>&gt;<i> - L. Daniel Burr
</I>
You definitely shouldn't use ssl.ClientContextFactory.  It doesn't verify certificates, or provide any authentication of the server.  We should really remove and deprecate it :-\.

You should use ssl.optionsForClientTLS, and you should build it like this:

import getpass

from OpenSSL.crypto import load_pkcs12
from twisted.internet.ssl import (
    PrivateCertificate, KeyPair, Certificate, optionsForClientTLS
)

from twisted.internet.protocol import Factory, Protocol from twisted.internet.endpoints import SSL4ClientEndpoint from twisted.internet.defer import inlineCallbacks, Deferred from twisted.internet.task import react

@inlineCallbacks
def main(reactor, p12file, host, port=443):
    host = host.decode(&quot;utf-8&quot;)
    port = int(port)
    with open(p12file) as f:
        pkcs12 = load_pkcs12(f.read(), getpass.getpass())
        publicCertificate = Certificate(pkcs12.get_certificate())
        privateKey = KeyPair(pkcs12.get_privatekey())
        privateCertificate = PrivateCertificate.fromCertificateAndKeyPair(
            publicCertificate, privateKey
        )
    contextFactory = optionsForClientTLS(host,
                                         clientCertificate=privateCertificate)
    endpoint = SSL4ClientEndpoint(reactor, host, port, contextFactory)
    x = Deferred()
    class it(Protocol, object):
        def connectionMade(self):
            self.transport.write(b&quot;GET / HTTP/1.1\r\n\r\n&quot;)
        def dataReceived(self, data):
            x.callback(Certificate.peerFromTransport(self.transport))
            self.transport.abortConnection()
    yield endpoint.connect(Factory.forProtocol(it))
    cert = yield x
    print(cert)

from sys import argv
react(main, argv[1:])

Hopefully that's a pretty complete answer :-).

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20150319/5d5edec5/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20150319/5d5edec5/attachment.html</A>&gt;

------------------------------

_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>


End of Twisted-Python Digest, Vol 132, Issue 23
***********************************************



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61919">[ date ]</a>
              <a href="thread.html#61919">[ thread ]</a>
              <a href="subject.html#61919">[ subject ]</a>
              <a href="author.html#61919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
