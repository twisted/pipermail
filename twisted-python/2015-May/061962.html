<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Multiple plugins in &quot;twistd&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20plugins%20in%20%22twistd%22&In-Reply-To=%3C20150519125921.21155.2042175335.divmod.xquotient.100%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="029500.html">
   <LINK REL="Next"  HREF="061964.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Multiple plugins in &quot;twistd&quot;</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20plugins%20in%20%22twistd%22&In-Reply-To=%3C20150519125921.21155.2042175335.divmod.xquotient.100%40top%3E"
       TITLE="[Twisted-Python] Multiple plugins in &quot;twistd&quot;">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue May 19 06:59:21 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="029500.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="061964.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61962">[ date ]</a>
              <a href="thread.html#61962">[ thread ]</a>
              <a href="subject.html#61962">[ subject ]</a>
              <a href="author.html#61962">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12:07 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">zadka.moshe at gmail.com</A> wrote:
&gt;<i>Background
</I>&gt;<i>
</I>&gt;<i>Currently, &quot;twistd&quot; assumes one-run-one-plugin. It would be nice to 
</I>&gt;<i>load up
</I>&gt;<i>multiple plug-ins in Twisted, for many reasons. These include: serving 
</I>&gt;<i>the
</I>&gt;<i>same in-memory content via separate protocols, adding manhole to other
</I>&gt;<i>plug-ins (so the end-deployer can add it to other things, as opposed to 
</I>&gt;<i>the
</I>&gt;<i>original implementor, and a catch-all category of &quot;auxiliary services&quot;.
</I>&gt;<i>
</I>&gt;<i>Auxiliary services are those which are not useful in and of themselves, 
</I>&gt;<i>but
</I>&gt;<i>add value to a service which does something else of use.
</I>&gt;<i>
</I>&gt;<i>Examples of auxiliary services -- a logging service (that connects to 
</I>&gt;<i>some
</I>&gt;<i>logging protocol on start-up), a metrics service (that sends statistics 
</I>&gt;<i>to
</I>&gt;<i>a collector like statsd or riemann) or an error-sending service (to
</I>&gt;<i>something like Sentry).
</I>&gt;<i>
</I>&gt;<i>Proposal
</I>&gt;<i>
</I>&gt;<i>tl;dr: four new tickets (codenamed SUBCOMMANDS, SERVICES, MANHOLE and
</I>&gt;<i>PROVIDERS) and one old ticket (3538)
</I>&gt;<i>
</I>&gt;<i>SUBCOMMANDS: Add '+' as a special character in t.p.usage.Options. This
</I>&gt;<i>behavior will be off by default, and controlled by an attribute on the
</I>&gt;<i>Options instance &quot;allowMultipleSubcommands&quot;.
</I>&gt;<i>
</I>&gt;<i>The attribute will only be checked when the first sub-command starts, 
</I>&gt;<i>to
</I>&gt;<i>allow setting it based on global flags. When the option is on, '-+' 
</I>&gt;<i>will be
</I>&gt;<i>passed as '+' to the Options instance, to allow sending plain '+' to
</I>&gt;<i>sub-commands.
</I>
Having a new, weird, fragile syntax is probably the least interesting 
part of this.  I suggest not doing this part - or at the very least, not 
doing it first and not making it a general part of `Options`.

There are lots of other ways to get the service object from more than 
one service plugin.  For example, read lines from a file.  Or have a 
variation of `--python` or something else similar using the existing 
option syntax `Options` supports.

The more interesting part to get right is the underlying model which you 
discuss elsewhere.
&gt;<i>
</I>&gt;<i>Glyph thinks there's a ticket for it. I couldn't find it in &quot;search for
</I>&gt;<i>tickets in 'core' whose description mentionds 'command'&quot;. Unless anyone 
</I>&gt;<i>can
</I>&gt;<i>find it, I'll open a new ticket.
</I>
I think there is a ticket for being able to use multiple twistd plugins. 
I don't think there's a ticket for a general change to `Options`.
&gt;<i>
</I>&gt;<i>SERVICES (depends on SUBCOMMANDS): In twistd, set the flag aMS if
</I>&gt;<i>'--allow-multiple-services' is given. Add to the application all 
</I>&gt;<i>services.
</I>
If you skip the `SUBCOMMANDS` ticket described above, then you can skip 
this too.
&gt;<i>3538 (depends on SERVICES): If '--allow-multiple-services' is given, 
</I>&gt;<i>and
</I>&gt;<i>'--python &lt;.tac file&gt;' is given, process subcommands as usual.
</I>
Or just process the tac file and the subcommand if they're both given - 
without requiring an extra option?  The current behavior, &quot;silently 
ignore one of the arguments&quot;, doesn't seem particularly worth keeping to 
me.
&gt;<i>PROVIDERS: Add a function,
</I>&gt;<i>       &quot;providersInHierarchy(IService, IInterface) -&gt; List[IInterface]&quot;
</I>&gt;<i>that returns all services in the hierarchy which provide the interface.
</I>&gt;<i>This ticket does not depend on any other tickets.
</I>
The first argument needs to be `IServiceCollection` instead of 
`IService`.
&gt;<i>MANHOLE (depends on PROVIDERS, SERVICES): Add a built-in twistd plugin
</I>&gt;<i>named &quot;manhole&quot;. The plugin will expose manhole as PB/telnet with a
</I>&gt;<i>namespace that includes
</I>&gt;<i>  {'services': providersInHierarchy(manholeService, IService)}
</I>&gt;<i>This ticket technically could only depend on PROVIDERS, but to be 
</I>&gt;<i>useful,
</I>&gt;<i>it also depends on SERVICES
</I>
Manhole is part of Conch now and the telnet manhole is deprecated (and 
the PB manhole really should be deprecated - using a structured protocol 
for manhole isn't a bad idea but the existing implementation is half 
broken, mostly untested, exposes tons of implementation details as part 
of the public interface, etc.  If this were a piece of widely used 
software it would probably be worth gradually renovating - but it's 
basically used by no one so starting fresh makes more sense).

So it's part of Conch.  And ... it exists already.  I'm pretty sure no 
one will object if you add a new name to the default namespace.

Thanks for taking this on.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="029500.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="061964.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61962">[ date ]</a>
              <a href="thread.html#61962">[ thread ]</a>
              <a href="subject.html#61962">[ subject ]</a>
              <a href="author.html#61962">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
