<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Multiple plugins in &quot;twistd&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20plugins%20in%20%22twistd%22&In-Reply-To=%3C20150521001713.21155.270918325.divmod.xquotient.157%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029515.html">
   <LINK REL="Next"  HREF="029518.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Multiple plugins in &quot;twistd&quot;</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20plugins%20in%20%22twistd%22&In-Reply-To=%3C20150521001713.21155.270918325.divmod.xquotient.157%40top%3E"
       TITLE="[Twisted-Python] Multiple plugins in &quot;twistd&quot;">exarkun at twistedmatrix.com
       </A><BR>
    <I>Wed May 20 18:17:13 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029515.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
        <LI>Next message: <A HREF="029518.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29517">[ date ]</a>
              <a href="thread.html#29517">[ thread ]</a>
              <a href="subject.html#29517">[ subject ]</a>
              <a href="author.html#29517">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07:29 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
&gt;<i>
</I>&gt;&gt;<i>On May 20, 2015, at 04:13, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>On 19 May, 09:01 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tom.prince at ualberta.net</A> wrote:
</I>&gt;&gt;&gt;<i>Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; writes:
</I>&gt;&gt;&gt;&gt;<i>You could also find some other way to split the argument list but 
</I>&gt;&gt;&gt;&gt;<i>&quot;+&quot; doesn't seem particularly obscure in this context to me.  (If 
</I>&gt;&gt;&gt;&gt;<i>there's really a need to pass a literal &quot;+&quot; to a plugin we could add 
</I>&gt;&gt;&gt;&gt;<i>an escaping syntax as well.)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I think if we are adding syntax, then we should also add escaping at 
</I>&gt;&gt;&gt;<i>the
</I>&gt;&gt;&gt;<i>same time.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>On a related note, when designing this kind of syntax, I think it is
</I>&gt;&gt;&gt;<i>often valuable to explictly leave some of the space as an explict 
</I>&gt;&gt;&gt;<i>error,
</I>&gt;&gt;&gt;<i>to leave freedom to extend the syntax in the future.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I think this is 100% correct.  This is part of why I don't want the 
</I>&gt;&gt;<i>syntax added to `Options`.  If it's a feature of, say, a &quot;compose&quot; 
</I>&gt;&gt;<i>twistd plugin then you can always throw the whole &quot;compose&quot; twistd 
</I>&gt;&gt;<i>plugin in the trash and start again.  That gives you quite a lot of 
</I>&gt;&gt;<i>space for syntax changes. :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>(And of course, not introducing a syntax at all leaves you even more 
</I>&gt;&gt;<i>room... but talking this crowd out of inventing weird syntaxes is 
</I>&gt;&gt;<i>probably an exercise in futility.)
</I>&gt;<i>
</I>&gt;<i>Much as I love weird syntaxes, using &quot;+&quot; as a separator for a 'compose' 
</I>&gt;<i>plugin seems about as straightforward as I could imagine such a thing 
</I>&gt;<i>working.  Do you have an alternate proposal that is less 'weird'?  I 
</I>&gt;<i>wouldn't promise to accept it but I wouldn't want to go with something 
</I>&gt;<i>unnecessarily weird just due to a failure of my imagination.
</I>
It's possible this is a case of necessary weirdness - at least, if 
you're dead-set on some kind of option-based CLI interface to this 
functionality.

Think about other CLI tools that try to offer this kind of composition. 
Only two really come to mind for me and one of those is not exactly well 
regarded for its novel syntax (hint - it rhymes with &quot;schmestreamer).

This is not to say that this kind of composition is a bad thing - or 
even that no other widely-used software supports the kind of invoke- 
several-things-of-stuff behavior that we're talking about providing 
access to here.

However, I do think it is the case that most of the world tries to solve 
this problem without trying to force everything into a world-view framed 
by GNU getopt().

With that in mind, here are some alternatives:

  (0) The null proposal

    $ twistd compose \
        web --port 80 +
        manhole --auth foo + \
        logging --path /var/run

  (1) Borrow `--` which already means &quot;stop parsing options here&quot;.  It 
makes sense if you think about sub-commands as existing on a stack and 
`--` meaning &quot;pop the stack&quot;.  Possibly not actually feasible since I 
think `Options` already knows what `--` means (by virtue of actually 
*using* getopt()) and uses it to separate options from positional 
arguments (and therefore it's not an unambiguous separator - but I 
haven't double-checked this).

    $ twistd compose \
        web --port 80 -- \
        manhole --auth foo -- \
        logging --path /var/run

  (2) Put things into strings which already have well-defined escape 
syntax:

    $ twistd compose \
        'web --port 80' \
        'manhole --auth foo' \
        'logging --path /var/run'

  (3) Load things from a file (really just a variation on (2)):

    $ cat myapp.compose
    web --port 80
    manhole --auth foo
    logging --path /var/run
    $ twistd compose myapp.compose

Note these aren't really syntax ideas.  Apart from (1), they're ideas 
for not needing a new syntax.  As soon as you actually invent a new 
syntax you invite comments like &quot;Well, maybe you should use `;` instead 
of `+` because `;` is already kind of ingrained as a separator and 
people are used to having to escape it&quot; (which, see, I put in quotes, 
because I'm totally not saying that, even if it is totally true) to 
which you can only really reply that your gut agrees or your gut 
disagrees and it's always a bummer when the best support you have for 
some programming decision is some gut feeling you had.

I might actually be somewhat attracted to (3) because:

  * I don't really want to build up giant piles of configuration on my 
command line and then rely on my shell history for being able to find it 
again.  myapp.compose is something I could even put in my version 
control system.

  * Despite shell quoting and escaping rules being perfectly well 
defined, I'd really much rather not have to deal with an automatic extra 
layer of quotes.

And a last point to consider about new syntaxes - what are the security 
considerations of a command like:

    $ twistd compose \
        web --port ${WEB_PORT} +
        manhole --auth foo + \
        logging --path /var/run

I'll grant there's a bug there (the shell variable should be quoted - 
but I only know one person who consistently gets that right).

Regardless, I think any proposal would greatly benefit from a much 
greater consideration of use-cases and examples than I've yet seen 
discussed in this thread.

Jean-Paul

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029515.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
	<LI>Next message: <A HREF="029518.html">[Twisted-Python] Multiple plugins in &quot;twistd&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29517">[ date ]</a>
              <a href="thread.html#29517">[ thread ]</a>
              <a href="subject.html#29517">[ subject ]</a>
              <a href="author.html#29517">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
