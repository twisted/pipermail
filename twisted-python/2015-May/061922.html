<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Fwd: Adding callbacks using loop variables
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Fwd%3A%20Adding%20callbacks%20using%20loop%20variables&In-Reply-To=%3CCAMWNtQrMKDVj%2BUuXKphj7W1TvvkMPJOwRxsw3CuGK8V9B0DJyA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Fwd: Adding callbacks using loop variables</H1>
    <B>Saoili</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Fwd%3A%20Adding%20callbacks%20using%20loop%20variables&In-Reply-To=%3CCAMWNtQrMKDVj%2BUuXKphj7W1TvvkMPJOwRxsw3CuGK8V9B0DJyA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Fwd: Adding callbacks using loop variables">saoili at gmail.com
       </A><BR>
    <I>Wed May  6 02:26:25 MDT 2015</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61922">[ date ]</a>
              <a href="thread.html#61922">[ thread ]</a>
              <a href="subject.html#61922">[ subject ]</a>
              <a href="author.html#61922">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi folks,

I was going to ask a question, but a colleague resolved it for me. I
thought I'd share the result!

We often end up using lambda to add callbacks, especially where we want to
pass the response to a deferred into a function and it's not the first
parameter. However, if you do that inside a loop and one of the variables
you're passing is a loop variable, you're going to get the same value for
that loop variable in all of your callbacks (the last one). The solution is
to avoid calling lambda, either by reordering the expected params in
function you're calling, or by creating a small function that just reorders
what's passed to it and sends them to that function in the right order.

Hopefully that's useful to someone.
Sorcha


Eg. code BEFORE
            for loop_var in a_dict['loop_vars']:
                d = self.returns_a_deferred(loop_var[&quot;x&quot;])
                d.addCallback(
                    lambda ret_val: self.do_another_thing(
                        other_param, loop_var.copy(), ret_val
                    )
                )
                _dlist.append(d)
            return defer.DeferredList(_dlist)

Eg. code AFTER
            def other_func(ret_val, other_param, loop_var):
                return self.do_other_thing(
                    other_param, loop_var, ret_val
                )

            for loop_var in a_dict['loop_vars']:
                d = self.returns_a_deferred(loop_var[&quot;x&quot;])
                d.addCallback(other_func, other_param, loop_var)
                _dlist.append(d)
            return defer.DeferredList(_dlist)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20150506/9c3bbf3b/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61922">[ date ]</a>
              <a href="thread.html#61922">[ thread ]</a>
              <a href="subject.html#61922">[ subject ]</a>
              <a href="author.html#61922">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
