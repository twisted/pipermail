<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Newbie - how to modify my db-intensive app to	use Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Newbie%20-%20how%20to%20modify%20my%20db-intensive%20app%20to%0A%09use%20Twisted&In-Reply-To=20051120095402.8522E3F434C%40fcserver.chagford.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012024.html">
   <LINK REL="Next"  HREF="012015.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Newbie - how to modify my db-intensive app to	use Twisted</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Newbie%20-%20how%20to%20modify%20my%20db-intensive%20app%20to%0A%09use%20Twisted&In-Reply-To=20051120095402.8522E3F434C%40fcserver.chagford.com"
       TITLE="[Twisted-Python] Newbie - how to modify my db-intensive app to	use Twisted">glyph at divmod.com
       </A><BR>
    <I>Mon Nov 21 09:31:51 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012024.html">[Twisted-Python] Newbie - how to modify my db-intensive app	touseTwisted
</A></li>
        <LI>Next message: <A HREF="012015.html">[Twisted-Python] Getting started with twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12019">[ date ]</a>
              <a href="thread.html#12019">[ thread ]</a>
              <a href="subject.html#12019">[ subject ]</a>
              <a href="author.html#12019">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Sun, 20 Nov 2005 11:59:27 +0200, Frank Millman &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">frank at chagford.com</A>&gt; wrote:

&gt;<i>Moving this concept onto Twisted does not seem to work, as it can be running
</I>&gt;<i>sessions for multiple users, and each 'block' will block the main loop,
</I>&gt;<i>resulting in a major performance hit. The correct solution, as I understand
</I>&gt;<i>it, is to change each SQL command to a deferred with a callback. I can do
</I>&gt;<i>this on the inner layers, where the actual SQL command is executed. But I
</I>&gt;<i>would also have to do it on each outer layer that calls a function which
</I>&gt;<i>'may' trigger a SQL command. There are many of these, and it goes to the
</I>&gt;<i>heart of my approach of hiding the underlying database complexity from the
</I>&gt;<i>application layer. Changing this feels like a daunting task, and frankly I
</I>&gt;<i>would not know where to start.
</I>
The way I would probably work on an application that did this was making each *transaction* into something that ran in a thread and returned a Deferred, which would reduce the footprint of impacted code.  Each user-interface action can be encapsulated as a transaction, and then your code doesn't need to convert each function into a Deferred, just the top-level event handler which kicks off the transaction.

&gt;<i>The alternative is to use a multi-threaded approach. In this case, I can
</I>&gt;<i>keep my existing approach largely unchanged, as it does not matter if one
</I>&gt;<i>thread blocks, the others will continue without being affected.
</I>
In the case where you're turning each SQL statement into a Deferred, you're actually using threads anyway; each statement executes in a thread, then sends its result to the main loop.  The important thing when you turn a Twisted application into a multithreaded application is to have a stark distinction between code which runs in threads and code which runs in the main loop.  Code which runs in threads can't call Twisted functions (other than callFromThread), use Deferreds, etc.  It also should refer to as little state as possible, since if you can create isolated groups of objects in the main thread, you don't need to bother with locking as your blocking threaded code runs.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012024.html">[Twisted-Python] Newbie - how to modify my db-intensive app	touseTwisted
</A></li>
	<LI>Next message: <A HREF="012015.html">[Twisted-Python] Getting started with twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12019">[ date ]</a>
              <a href="thread.html#12019">[ thread ]</a>
              <a href="subject.html#12019">[ subject ]</a>
              <a href="author.html#12019">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
