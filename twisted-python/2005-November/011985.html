<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r15100 - So I really do	want this stuff
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r15100%20-%20So%20I%20really%20do%0A%09want%20this%20stuff&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011994.html">
   <LINK REL="Next"  HREF="011987.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r15100 - So I really do	want this stuff</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r15100%20-%20So%20I%20really%20do%0A%09want%20this%20stuff&In-Reply-To="
       TITLE="[Twisted-Python] Re: [Twisted-commits] r15100 - So I really do	want this stuff">warner at lothar.com
       </A><BR>
    <I>Sun Nov 13 14:15:56 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011994.html">[Twisted-Python] Re: [Twisted-commits] r15100 - So I really do	want this stuff
</A></li>
        <LI>Next message: <A HREF="011987.html">[Twisted-Python] How to talk to IM's 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11985">[ date ]</a>
              <a href="thread.html#11985">[ thread ]</a>
              <a href="subject.html#11985">[ subject ]</a>
              <a href="author.html#11985">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i>This is a bug, not a feature.
</I>&gt;<i>
</I>&gt;<i> Why is it a bug?
</I>
I've been bitten by this behavior.. basically it means that the TestCase's
__init__ method is not invoked for each test method, so you have to remember
to clear status flags (say, things that are set from a Deferred callback,
like maybe a .oopsSomethingFailed flag) in setUp() rather than just
initialize them in __init__ . The annoying thing is that it (the __init__
approach) works fine when you run the tests one at a time, which I frequently
do as I set up a brand new test. It only breaks when you run multiple tests,
and even then only when the leftover results of one test get interpreted by a
later one.

I think part of the &quot;clean all lingering state after every test&quot; philosophy
should include cleaning attributes from the test methods themselves (or just
not re-using those objects).

That said, I still want a place to amortize expensive setup across multiple
tests. The buildbot tests, for example, have about half a dozen tests for
each supported version control system. There is a module-level check that
sees which ones you have installed (arch, baz, cvs, svn, darcs), then sets
some flags which cause certain tests to be run or skipped. I don't want to
re-do these checks for each test method. It may work to re-do them for each
TestCase class (say, the setUpClass for the SVN TestCase class checks to see
if SVN is available), but for code factoring purposes there might be multiple
SVN TestCase classes, and it would be nice to avoid duplicate checks.

Incidentally, these checks are the only remaining use of deferredResult() in
the buildbot test suite, at least when it is run against Twisted-2.0 or
newer, because they were originally run at import time. In the current code,
they are performed by the first setUpClass that gets run, and the results are
stashed in a module-level global to avoid running them again. If I were
confident that all supported (by buildbot) versions of Twisted allowed
setUpClass to return a Deferred, I could get rid of that last
deferredResult() call.

cheers,
 -Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011994.html">[Twisted-Python] Re: [Twisted-commits] r15100 - So I really do	want this stuff
</A></li>
	<LI>Next message: <A HREF="011987.html">[Twisted-Python] How to talk to IM's 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11985">[ date ]</a>
              <a href="thread.html#11985">[ thread ]</a>
              <a href="subject.html#11985">[ subject ]</a>
              <a href="author.html#11985">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
