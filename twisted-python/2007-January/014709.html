<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Losing Deferreds : Re: More Questions about Custom	Reactors 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Losing%20Deferreds%20%3A%20Re%3A%20More%20Questions%20about%20Custom%0A%09Reactors%20&In-Reply-To=E1H93Se-0007xs-02%40pyramid.twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014708.html">
   <LINK REL="Next"  HREF="014710.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Losing Deferreds : Re: More Questions about Custom	Reactors </H1>
    <B>Andrew Francis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Losing%20Deferreds%20%3A%20Re%3A%20More%20Questions%20about%20Custom%0A%09Reactors%20&In-Reply-To=E1H93Se-0007xs-02%40pyramid.twistedmatrix.com"
       TITLE="[Twisted-Python] Losing Deferreds : Re: More Questions about Custom	Reactors ">andrewfr_ice at yahoo.com
       </A><BR>
    <I>Thu Jan 25 11:44:01 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="014708.html">[Twisted-Python] Pycon Twisted Sprint
</A></li>
        <LI>Next message: <A HREF="014710.html">[Twisted-Python] xml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14709">[ date ]</a>
              <a href="thread.html#14709">[ thread ]</a>
              <a href="subject.html#14709">[ subject ]</a>
              <a href="author.html#14709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Message: 3
Date: Mon, 22 Jan 2007 00:32:16 +0000
From: Phil Mayers &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">p.mayers at imperial.ac.uk</A>&gt;
Subject: Re: [Twisted-Python] More Questions about
Custom Reactors
To: Twisted general discussion
&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Message-ID: &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">45B40610.7020607 at imperial.ac.uk</A>&gt;
Content-Type: text/plain; charset=ISO-8859-1;
format=flowed

I am sorry that I am tardy in responding. I was trying
out your suggestions. Right now, my main question is
under which conditions do deferred fail to fire? How
do I know that the reactor is still running? Would
Manhole help? (Unfortunately I haven't been able to
get gtk to work Manhole with Twisted 2.4)

&gt;<i>Perhaps you could explain what you're actually trying
</I>&gt;<i>to achieve, rather than the solution you have decided
</I>&gt;<i>on? An indeed, why you want to use stackless at all -
</I>&gt;<i>Twisted is predicated around the assumption of a 
</I>&gt;<i>stackful i.e. single-threaded Python.
</I>
I understand your questioning. The main reason I am
using Stackless Python is for its process execution
state pickling abilities. A second reason is that I
find Stackless's communication model very handy for
modeling the type of thread synchronisation I wish to
do.

I know that Twisted assumes a stackful Python and it
is an uphill battle. However the gains from getting
Twisted to work with Stackless are so great, I think
it is worthwhile. For the most part, I have succeeded
in having Stackless Python work with Twisted. If you
read the Stackless mailing list, I have posted
examples. Soon, I will post on the Wiki.

My problems stem from situations where I have two or
more concurrent tasklets (Stackless threads) that do
the following)

tasklet[0] - waiting for a Twisted Request Handler
tasklet[1] - making a client.getPage call
tasklet[2] - making a client.getPage call
tasklet[3] - some other operation
tasklet[n] - some other operation

under these conditions, if tasklet[0] is executed
first, the other tasklets will block indefinitely. My
problems occur from trying to get around this.
Originally I tried taskLoop calling
stackless.schedule() to give other tasklets a chance
to execute but this would cause reactor problems.
Hence the current approach of looking at getting
Twisted to run in its own thread.

&gt;<i>Alternatively you might be wanting long-running jobs
</I>&gt;<i>to be interleaved with other code transparently but
</I>&gt;<i>without using real threads?
</I>
I am not sure how to do this.

&gt;<i>If you're proposing using queues to communicate
</I>&gt;<i>between a Twisted thread running the reactor and a
</I>&gt;<i>stackless thread running your micro-threads, 
</I>&gt;<i>I don't see why you need to modify Twisted at all. 
</I>
I am a newbie to Twisted. Based on what I am reading,
I current assumption is that I would need to 

&gt;<i>You can just run the stackless microthreads from one
</I>&gt;<i>&quot;real&quot; thread (started via callInThread), pass jobs
</I>&gt;<i>from Twisted to the &quot;real&quot; thread and probably 
</I>&gt;<i>a stackless uthread, and pass the replies back to the
</I>&gt;<i>twisted thread with a callFromThread.
</I>
&gt;<i>So, can you not just do this?:
</I>
Philip, first the good news : thanks a million! This
is the exactly the type of example I wanted. It works.

The bad news - under certain conditions I am losing
deferreds. I think there are deadlock issues but that
is not Twisted's fault per se. Unfortunately debuggers
work poorly with Stackless so it is difficult for me
to know what is happening. I tried telneting but my
server is not responding - so I guess that implies
that Twisted is still listening but the reactor is not
working. Again, any suggestions would be more than
welcome.

Cheers,
Andrew


 
____________________________________________________________________________________
Bored stiff? Loosen up... 
Download and play hundreds of games for free on Yahoo! Games.
<A HREF="http://games.yahoo.com/games/front">http://games.yahoo.com/games/front</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014708.html">[Twisted-Python] Pycon Twisted Sprint
</A></li>
	<LI>Next message: <A HREF="014710.html">[Twisted-Python] xml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14709">[ date ]</a>
              <a href="thread.html#14709">[ thread ]</a>
              <a href="subject.html#14709">[ subject ]</a>
              <a href="author.html#14709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
