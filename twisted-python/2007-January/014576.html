<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted and gprs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20and%20gprs&In-Reply-To=45A2A7D6.3030403%40imperial.ac.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014575.html">
   <LINK REL="Next"  HREF="014577.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted and gprs</H1>
    <B>John Aherne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20and%20gprs&In-Reply-To=45A2A7D6.3030403%40imperial.ac.uk"
       TITLE="[Twisted-Python] twisted and gprs">johna at johnaherne.co.uk
       </A><BR>
    <I>Mon Jan  8 16:11:44 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="014575.html">[Twisted-Python] twisted and gprs
</A></li>
        <LI>Next message: <A HREF="014577.html">[Twisted-Python] twisted and gprs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14576">[ date ]</a>
              <a href="thread.html#14576">[ thread ]</a>
              <a href="subject.html#14576">[ subject ]</a>
              <a href="author.html#14576">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Phil Mayers wrote:
&gt;<i> John Aherne wrote:
</I>&gt;&gt;<i> Thanks to Phil, Carl and JPCalderone for the replies.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'll try and answer them by explaining more clearly what I am trying 
</I>&gt;&gt;<i> to do. And explaining some terms that I were vague.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The sessions are a connection that I need to keep open -  a 
</I>&gt;&gt;<i> combination of IP address and source port no - so the server can use 
</I>&gt;&gt;<i> the source port number that the PDA used when making the initial 
</I>&gt;&gt;<i> connection. The PDA 
</I>&gt;<i>
</I>&gt;<i> You only need to do this with UDP or other connection-less protocols. 
</I>&gt;<i> TCP will bind the connection and do the tracking for you.
</I>&gt;<i>
</I>&gt;&gt;<i> will need to block on the TCPIP socket waiting for messages to be 
</I>&gt;&gt;<i> sent to it. It will process the message and then wait again. Provided 
</I>&gt;&gt;<i> the PDA does not close the socket and lose the connection with the 
</I>&gt;&gt;<i> original port no, the firewall will let the conversation keep going.
</I>&gt;<i>
</I>&gt;<i> You will need keepalives for this, but yes.
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The server will send on the initial source/destination port nos and not 
</I>&gt;<i>
</I>&gt;<i> Again, TCP does this automatically
</I>&gt;<i>
</I>&gt;&gt;<i> close the connection. This way the PDA can still be contacted over a 
</I>&gt;&gt;<i> long period of time. Because the PDA is behind the network firewall, 
</I>&gt;&gt;<i> if the original port used by the PDA is lost, the server can no 
</I>&gt;&gt;<i> longer send data to the PDA, since the firewall will not let the 
</I>&gt;&gt;<i> traffic through even though the IP address had not changed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As Carl pointed out I will need more than the IP address to identify 
</I>&gt;&gt;<i> the PDA. I will need an ID from the PDA that is unique so that if the 
</I>&gt;&gt;<i> PDA comes back in with a different IP address I can pick that up, 
</I>&gt;&gt;<i> drop the existing IP/port no if I still have it and register it with 
</I>&gt;&gt;<i> it's new IP address and source port no.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As i write this down, explaining it to myself as much as anyone else, 
</I>&gt;&gt;<i> I think to myself that the mechanics look very much like an irc 
</I>&gt;&gt;<i> connection. I might be wrong so please let me know.
</I>&gt;<i>
</I>&gt;<i> I don't know why you're bringing up IRC. IRC uses TCP, so no 
</I>&gt;<i> port-number bookkeeping will be required.
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The server will need to ping the PDA to confirm the connection is still 
</I>&gt;<i>
</I>&gt;<i> Again, TCP keepalives
</I>&gt;<i>
</I>&gt;&gt;<i> there. If lost it will deregister the PDA and wait for it to 
</I>&gt;&gt;<i> reconnect again. What I am not sure about with irc is whether I can 
</I>&gt;&gt;<i> keep hold of the port no used by the PDA as its source port and 
</I>&gt;&gt;<i> maintain the connection with the IP address/port no combination.
</I>&gt;<i>
</I>&gt;<i> Again, IRC uses TCP which does this all automatically. Forget about 
</I>&gt;<i> the port numbers.
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What I would like is if I can find a framework that does most of the 
</I>&gt;&gt;<i> heavy work with the communications. I can then find a suitable point 
</I>&gt;&gt;<i> to make some not too difficult changes to accommodate my requirements.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have done a very simple test using the socket library to confirm 
</I>&gt;&gt;<i> that the basics do work. The connection stays open and as long as I 
</I>&gt;&gt;<i> do not close the socket connection at either end and use the same 
</I>&gt;&gt;<i> source/destination port numbers the traffic flows.And I can push data 
</I>&gt;&gt;<i> without the PDA having to initiate new connections and requesting data.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I hope this a better explanation than my first post. I am sure there 
</I>&gt;&gt;<i> will still be bits that might not be clear so let me know and I will 
</I>&gt;&gt;<i> fill in any gaps.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If it is clear,  what I am looking to find out is which bits of 
</I>&gt;&gt;<i> twisted I would need to use and what parts would need changing and to 
</I>&gt;&gt;<i> what extent.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One final note, there could be around 100 of the PDAs to look after.
</I>&gt;<i>
</I>&gt;<i> That's a tiny number.
</I>&gt;<i>
</I>&gt;<i> Just have each PDA make a TCP connection to the server. Enable TCP 
</I>&gt;<i> keepalives on both the client and on the server ends of the 
</I>&gt;<i> connection. Have the first operation on a new TCP connection be a 
</I>&gt;<i> &quot;login&quot; i.e. PDA says here is my ID, server maps the ID to a TCP 
</I>&gt;<i> connection. Have your server message distribution look up the current 
</I>&gt;<i> TCP connection for a given ID and send the message.
</I>&gt;<i>
</I>&gt;<i> It's a trivial application.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>Phil

Thanks for the reply.

I'm obviously missing some obvious point I think.

I need to be sure that the connection keeps on using the same 
source/destination ports for the duration, so the firewall lets the 
conversation carry on.

Provided I don't close the socket at either end will the PDA and server 
carry on using the same set of source/destination ports.

The test I did I purposely took note of the port used by the PDA as the 
network people told me to make sure I kept them the same. I then forced 
the server to send using that port as the destination. Over the time 
frame of about 40  minutes I did not need to issue any keepalives. I 
would rather not issue keepalives since this will cost money on a gprs 
network based on data usage.

Yes I know 100 is not much but I thought I would mention it as being 
more than 1.


Thanks for any clarification.

John Aherne



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014575.html">[Twisted-Python] twisted and gprs
</A></li>
	<LI>Next message: <A HREF="014577.html">[Twisted-Python] twisted and gprs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14576">[ date ]</a>
              <a href="thread.html#14576">[ thread ]</a>
              <a href="subject.html#14576">[ subject ]</a>
              <a href="author.html#14576">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
