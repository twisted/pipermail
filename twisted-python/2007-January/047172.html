<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20server%20is%205%20times%20SLOWER%20on%20Solaris%20than%0A%09Linux%3F&In-Reply-To=%3C20070118000947.17094.845374243.divmod.xquotient.2559%40joule.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047171.html">
   <LINK REL="Next"  HREF="047173.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20server%20is%205%20times%20SLOWER%20on%20Solaris%20than%0A%09Linux%3F&In-Reply-To=%3C20070118000947.17094.845374243.divmod.xquotient.2559%40joule.divmod.com%3E"
       TITLE="[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?">glyph at divmod.com
       </A><BR>
    <I>Wed Jan 17 17:09:47 MST 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047171.html">[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?
</A></li>
        <LI>Next message (by thread): <A HREF="047173.html">[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47172">[ date ]</a>
              <a href="thread.html#47172">[ thread ]</a>
              <a href="subject.html#47172">[ subject ]</a>
              <a href="author.html#47172">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11:35 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jarrod at vertigrated.com</A> wrote:

&gt;<i>There is a &quot;backend&quot; C module that our Twisted server front ends, and it is
</I>&gt;<i>highly multi-threaded.
</I>&gt;<i>So the T1000 is PERFECT for our application, except that now Twisted is the
</I>&gt;<i>bottleneck. :-(
</I>
This seems odd to me.

If all the CPUs are going to be busy doing a multi-threaded back-end's work, and Twisted is just doing the I/O, then it seems the T1000 would still be a benefit.  The benchmark you mentioned was completely static; there was no backend library, no multithreaded CPU load.  Is the performance disparity similar when you're running actual workloads?

Sure, Twisted isn't going to be able to dole out as much work as something optimized to balance the I/O management CPU across N+1 cores; but if those cores are going to be busy anyway in realistic use, then presumably having Twisted contending for all of them wouldn't be much of a performance boost.

I actually do have a little experience with Twisted-*like* software on Solaris, although not Twisted itself.  The proprietary system which originally inspired Twisted's networking core was actually designed to run on Solaris, and took Sparc hardware advantages into account.  It still ran all of its I/O in a single thread.

&gt;<i>So we either scrap our Twisted implementation and have to spend extra time
</I>&gt;<i>on another network handling layer, or run 5 times as many instances of our
</I>&gt;<i>server to service the same number of concurrent clients.
</I>
Congratulations.  For years, I've been warning people that Twisted cannot transparently take full advantage of vertical scaling with SMP.  While I've heard a lot of uninformed whinging about how this is a huge problem, you are the first person to report an actual performance problem related to that fact :).

Running 5 times as many instances of the server does make sense, and shouldn't have a significant downside.  The parallelism strategy I've used pretty much everywhere is multiprocessing rather than multithreading, and it works well.

If the issue is that you don't want to have that many different open ports on each machine, would it be possible to have a small front-end server accept()ing and sending sockets to N+1 (where N is the number of cores) other Twisted processes?  I don't know how this might be accomplished on solaris, but if it's possible, it should be transparent to the clients and let Twisted itself take advantage of the hardware.  It would take some work, but not as much as a rewrite.

Again, it seems weird to me that this is necessary if the back-end library is really utilizing all the CPUs already and you are not I/O bound.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20070118/6e05a7fe/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047171.html">[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?
</A></li>
	<LI>Next message (by thread): <A HREF="047173.html">[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47172">[ date ]</a>
              <a href="thread.html#47172">[ thread ]</a>
              <a href="subject.html#47172">[ subject ]</a>
              <a href="author.html#47172">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
