<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20server%20is%205%20times%20SLOWER%20on%20Solaris%20than%0A%09Linux%3F&In-Reply-To=20070118000947.17094.845374243.divmod.xquotient.2559%40joule.divmod.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014664.html">
   <LINK REL="Next"  HREF="014666.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?</H1>
    <B>Jarrod Roberson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20server%20is%205%20times%20SLOWER%20on%20Solaris%20than%0A%09Linux%3F&In-Reply-To=20070118000947.17094.845374243.divmod.xquotient.2559%40joule.divmod.com"
       TITLE="[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?">jarrod at vertigrated.com
       </A><BR>
    <I>Wed Jan 17 20:59:19 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="014664.html">[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?
</A></li>
        <LI>Next message: <A HREF="014666.html">[Twisted-Python] client,	deferred and/or reactor hung on these 2 URL's
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14665">[ date ]</a>
              <a href="thread.html#14665">[ thread ]</a>
              <a href="subject.html#14665">[ subject ]</a>
              <a href="author.html#14665">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/17/07, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On 11:35 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jarrod at vertigrated.com</A> wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;There is a &quot;backend&quot; C module that our Twisted server front ends, and it
</I>&gt;<i> is
</I>&gt;<i> &gt;highly multi-threaded.
</I>&gt;<i> &gt;So the T1000 is PERFECT for our application, except that now Twisted is
</I>&gt;<i> the
</I>&gt;<i> &gt;bottleneck. :-(
</I>&gt;<i>
</I>&gt;<i> This seems odd to me.
</I>&gt;<i>
</I>&gt;<i> If all the CPUs are going to be busy doing a multi-threaded back-end's
</I>&gt;<i> work, and Twisted is just doing the I/O, then it seems the T1000 would still
</I>&gt;<i> be a benefit.  The benchmark you mentioned was completely static; there was
</I>&gt;<i> no backend library, no multithreaded CPU load.  Is the performance disparity
</I>&gt;<i> similar when you're running actual workloads?
</I>&gt;<i>
</I>
snipped a  lot of good information :-)

Again, it seems weird to me that this is necessary if the back-end library
&gt;<i> is really utilizing all the CPUs already and you are not I/O bound.
</I>&gt;<i>
</I>
Here is what we are doing basically.

Twisted takes in data and in a C extension we send the data to multiple
backends in parallel to do processing on it.
Then we aggregate the results and send information back to the client.
This is basically a fancy proxy that parallelizes and distributes work to
other machines on the network.
All the clients run in &quot;keep-alive&quot; mode, so they don't create new
connections for each piece of work they send to the system, so
once they are all connected, they stay connected for their lifetime ( long
time ).

On the Dell 2850's without any backend code, we see 600ms latency with a
test suite of 400 clients.
With the Solaris SPARC machines T1000 and V210 we see 4000 - 5000 ms latency
with the same no-op code and the same 400 clients.

With the backend code we see about an additional 250ms latency on both
platforms, since the &quot;backend&quot; code is just taking the data and sending it
out across the network to process, it just sits waiting on responses. The
backend code is just not doing enough work to stress the machine basically.

We have LOTS and LOTS of test harness code and profiling code to pinpoint
where bottlenecks are. We are going to have process a couple of terabytes a
day thru this system. Latency thru the system is a high priority because of
what kind of system it is.

We can get up to about 1400 clients on the Dell 2850 hardware before latency
starts climbing out of control.
The SPARC hardware is falling over at 400 clients :-(

Thanks to everyone for all the ideas and help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20070117/c8713457/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20070117/c8713457/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014664.html">[Twisted-Python] Twisted server is 5 times SLOWER on Solaris than	Linux?
</A></li>
	<LI>Next message: <A HREF="014666.html">[Twisted-Python] client,	deferred and/or reactor hung on these 2 URL's
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14665">[ date ]</a>
              <a href="thread.html#14665">[ thread ]</a>
              <a href="subject.html#14665">[ subject ]</a>
              <a href="author.html#14665">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
