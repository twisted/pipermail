<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.web HTTPS client certificate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.web%20HTTPS%20client%20certificate&In-Reply-To=%3C741978AA-1DAA-4E9D-AE6E-792DA88FA203%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065644.html">
   <LINK REL="Next"  HREF="065646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.web HTTPS client certificate</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.web%20HTTPS%20client%20certificate&In-Reply-To=%3C741978AA-1DAA-4E9D-AE6E-792DA88FA203%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] twisted.web HTTPS client certificate">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Jul 12 02:27:19 MDT 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065644.html">[Twisted-Python] twisted.web HTTPS client certificate
</A></li>
        <LI>Next message (by thread): <A HREF="065646.html">[Twisted-Python] twisted.web HTTPS client certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65645">[ date ]</a>
              <a href="thread.html#65645">[ thread ]</a>
              <a href="subject.html#65645">[ subject ]</a>
              <a href="author.html#65645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> On Jul 12, 2021, at 1:05 AM, Adi Roiban &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Mon, 12 Jul 2021 at 08:09, Ian Haywood &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ian at haywood.id.au</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ian at haywood.id.au</A>&gt;&gt; wrote:
</I>&gt;<i> I am trying to work out how to retrieve on the server a X.509 
</I>&gt;<i> certificate presented by the HTTPS client.  This code tries to tell me 
</I>&gt;<i> the transport has no peer certificate.
</I>&gt;<i> 
</I>&gt;<i> same error when I use wget as a client so I think my problem is in the 
</I>&gt;<i> server code. I'm using self-signed certificates
</I>&gt;<i> 
</I>&gt;<i> Any clues as to what I'm doing wrong?
</I>&gt;<i> 
</I>&gt;<i> Ian
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> As commented by Glyph you will first need  to setup one or a list of accepted CAs.
</I>&gt;<i> 
</I>&gt;<i> Then setup custom server-side context.
</I>&gt;<i> 
</I>&gt;<i> Add the CA via <A HREF="https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.load_verify_locations">https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.load_verify_locations</A> &lt;<A HREF="https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.load_verify_locations">https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.load_verify_locations</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> This is done via <A HREF="https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_verify">https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_verify</A> &lt;<A HREF="https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_verify">https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.set_verify</A>&gt; to define a path or dir
</I>&gt;<i> or implement a custom one via <A HREF="https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.get_cert_store">https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.get_cert_store</A> &lt;<A HREF="https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.get_cert_store">https://www.pyopenssl.org/en/stable/api/ssl.html#OpenSSL.SSL.Context.get_cert_store</A>&gt;
</I>
FWIW I would avoid calling the pyOpenSSL APIs for this, since hopefully we'll manage to move away from OpenSSL and at least somewhat abstract away the transition.  These map to the 'caCerts' and 'verify=True' arguments to CertificateOptions, if you need more flexibility than the tutorial documentation that I linked previously: <A HREF="https://twistedmatrix.com/documents/20.3.0/api/twisted.internet.ssl.CertificateOptions.html">https://twistedmatrix.com/documents/20.3.0/api/twisted.internet.ssl.CertificateOptions.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/20.3.0/api/twisted.internet.ssl.CertificateOptions.html">https://twistedmatrix.com/documents/20.3.0/api/twisted.internet.ssl.CertificateOptions.html</A>&gt;
&gt;<i> Without set_verify, during the TLS/SSL handshake the server will not ask the client to send its own certificate.
</I>&gt;<i> 
</I>&gt;<i> ---------
</I>&gt;<i>  
</I>&gt;<i> I am using X509 authentication as a  passwordless authentication for automated transfers, similar to the SSH key authentication.
</I>&gt;<i> 
</I>&gt;<i> The x509 certificate authentication is used by the Spanish government across many of their services.
</I>&gt;<i> Taxes, customs, health service ...
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Adi Roiban
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20210712/13ce705a/attachment-0001.htm&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065644.html">[Twisted-Python] twisted.web HTTPS client certificate
</A></li>
	<LI>Next message (by thread): <A HREF="065646.html">[Twisted-Python] twisted.web HTTPS client certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65645">[ date ]</a>
              <a href="thread.html#65645">[ thread ]</a>
              <a href="subject.html#65645">[ subject ]</a>
              <a href="author.html#65645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
