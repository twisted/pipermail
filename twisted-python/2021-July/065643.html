<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.web HTTPS client certificate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.web%20HTTPS%20client%20certificate&In-Reply-To=%3C248CDBCC-DD47-41CD-B36A-69B86F4BD8B4%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065642.html">
   <LINK REL="Next"  HREF="065644.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.web HTTPS client certificate</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.web%20HTTPS%20client%20certificate&In-Reply-To=%3C248CDBCC-DD47-41CD-B36A-69B86F4BD8B4%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] twisted.web HTTPS client certificate">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Jul 12 01:35:50 MDT 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065642.html">[Twisted-Python] twisted.web HTTPS client certificate
</A></li>
        <LI>Next message (by thread): <A HREF="065644.html">[Twisted-Python] twisted.web HTTPS client certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65643">[ date ]</a>
              <a href="thread.html#65643">[ thread ]</a>
              <a href="subject.html#65643">[ subject ]</a>
              <a href="author.html#65643">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Jul 12, 2021, at 12:07 AM, Ian Haywood &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ian at haywood.id.au</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> I am trying to work out how to retrieve on the server a X.509 certificate presented by the HTTPS client.  This code tries to tell me the transport has no peer certificate.
</I>&gt;<i> 
</I>&gt;<i> same error when I use wget as a client so I think my problem is in the server code. I'm using self-signed certificates
</I>&gt;<i> 
</I>&gt;<i> Any clues as to what I'm doing wrong?
</I>
It's been quite a while since I tried to do this, but:

For starters, you need to specify the certificate authority that will be validating your client's certificates.  I forget the precise specifics, but I believe if you don't specify a CA that will be used, it won't prompt the client to present a certificate in the first place, and also there's nothing for your endpoint to validate against, so what would it even do if the client did present one, other than let you retrieve it? The point is not to inspect the certificate but to authenticate it, an API that let you inspect it without first validating it against a CA would be a security nightmare.  And generally client certs are not understood to be validated by webtrust CAs, so &quot;just validate it like usual&quot; doesn't apply, since you can't check the SANs for a hostname.

There's a guide to doing this programmatically here: <A HREF="https://docs.twistedmatrix.com/en/twisted-21.2.0/core/howto/ssl.html#tls-server-with-client-authentication-via-client-certificate-verification">https://docs.twistedmatrix.com/en/twisted-21.2.0/core/howto/ssl.html#tls-server-with-client-authentication-via-client-certificate-verification</A> &lt;<A HREF="https://docs.twistedmatrix.com/en/twisted-21.2.0/core/howto/ssl.html#tls-server-with-client-authentication-via-client-certificate-verification">https://docs.twistedmatrix.com/en/twisted-21.2.0/core/howto/ssl.html#tls-server-with-client-authentication-via-client-certificate-verification</A>&gt; - I believe that this edge-case is not supported by endpoints.serverFromString.

If it's within your control to avoid, don't use client certificate authentication from HTTPS clients.  It unnecessarily leaks a bunch of peripheral information to the service you're authenticating to, the UX is a disaster on basically every browser, and most of the big players have stopped caring about this use-case in favor of things like webauthn that properly exist entirely outside of the setup process for a secure channel.  I confess I used to think client cert auth was really cool myself, but luckily nothing I did with it ever took off :-).

That said: as long as the use-case exists, Twisted should have good support for it.  Adding a clientCA argument to twisted.internet.endpoints._parseSSL so that serverFromString would support it would be a pretty simple PR to put together, so if you've got to bite the bullet on this, a contribution to close the gap here would be appreciated.  Twisted is nothing if not a tool that should make it seamless to integrate with every bad idea anyone's had in a protocol design ;-).

-g

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20210712/29f44ee4/attachment.htm&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065642.html">[Twisted-Python] twisted.web HTTPS client certificate
</A></li>
	<LI>Next message (by thread): <A HREF="065644.html">[Twisted-Python] twisted.web HTTPS client certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65643">[ date ]</a>
              <a href="thread.html#65643">[ thread ]</a>
              <a href="subject.html#65643">[ subject ]</a>
              <a href="author.html#65643">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
