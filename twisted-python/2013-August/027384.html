<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Raising exception from a Deferred canceller.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Raising%20exception%20from%20a%20Deferred%20canceller.&In-Reply-To=%3C20130829120659.26068.1975359856.divmod.xquotient.338%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027382.html">
   <LINK REL="Next"  HREF="027383.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Raising exception from a Deferred canceller.</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Raising%20exception%20from%20a%20Deferred%20canceller.&In-Reply-To=%3C20130829120659.26068.1975359856.divmod.xquotient.338%40top%3E"
       TITLE="[Twisted-Python] Raising exception from a Deferred canceller.">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Aug 29 06:06:59 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027382.html">[Twisted-Python] Raising exception from a Deferred canceller.
</A></li>
        <LI>Next message: <A HREF="027383.html">[Twisted-Python] Raising exception from a Deferred canceller.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27384">[ date ]</a>
              <a href="thread.html#27384">[ thread ]</a>
              <a href="subject.html#27384">[ subject ]</a>
              <a href="author.html#27384">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10:18 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">terry at jon.es</A> wrote:
&gt;<i>Hi Kai
</I>&gt;<i>
</I>&gt;<i>[snip]
</I>&gt;<i>
</I>&gt;<i>2b) there is some kind of exception when
</I>&gt;<i>cancel calls the cancellation function.  I don't think 2a) is really an
</I>&gt;<i>exception situation, so it makes sense, as you say, just to return 
</I>&gt;<i>False
</I>&gt;<i>from cancel in this case. It's basically the cancel function saying it 
</I>&gt;<i>was
</I>&gt;<i>too late to do anything about the underlying operation but not 
</I>&gt;<i>providing
</I>&gt;<i>more information than that. Internally raising and catching
</I>&gt;<i>CancellationFailedError (as in your code) in that case seems good to 
</I>&gt;<i>me.
</I>&gt;<i>In the case of 2b) I would just let the exception bubble up to the 
</I>&gt;<i>calling
</I>&gt;<i>code. Agreed, it could break some existing code, but isn't that 
</I>&gt;<i>existing
</I>&gt;<i>code already subject to that exact failure? It's just currently
</I>&gt;<i>undefined/undocumented.
</I>
This seems like a bad behavior that we should fix.  Allowing arbitrary 
exceptions from other application code here makes it a lot harder to 
write robust code that uses Deferred cancellation.

Beyond that, how much code has already been written that uses this 
feature?  If it was written based on the (admittedly, meager) 
documentation that exists for the feature, then it won't have exception 
handling.

We could leave the behavior as it is and document it and require all of 
that code be updated and all future code be written to handle arbitrary 
exceptions from a cancel call.  Or we could get rid of the undocumented 
exception case, make the existing code correct (if it was previously 
correct based on documented behavior) and avoid making things more 
difficult for all future users of Deferred cancellation.

In my experience, there are usually a lot of subtle concerns and tricky 
corner cases when fixing an inconsistency between documentation and 
implementation.  This case seems like a much more clear-cut win to just 
fix the implementation.

Jean-Paul

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027382.html">[Twisted-Python] Raising exception from a Deferred canceller.
</A></li>
	<LI>Next message: <A HREF="027383.html">[Twisted-Python] Raising exception from a Deferred canceller.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27384">[ date ]</a>
              <a href="thread.html#27384">[ thread ]</a>
              <a href="subject.html#27384">[ subject ]</a>
              <a href="author.html#27384">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
