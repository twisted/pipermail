<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Advice Request: Under what circumstances	should I use AMP's Command Response field?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advice%20Request%3A%20Under%20what%20circumstances%0A%09should%20I%20use%20AMP%27s%20Command%20Response%20field%3F&In-Reply-To=%3C0E9F2BCF-32B7-4E1A-B8B1-3B7B0A25F6FD%40nehbit.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027331.html">
   <LINK REL="Next"  HREF="027336.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Advice Request: Under what circumstances	should I use AMP's Command Response field?</H1>
    <B>Burak Nehbit</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advice%20Request%3A%20Under%20what%20circumstances%0A%09should%20I%20use%20AMP%27s%20Command%20Response%20field%3F&In-Reply-To=%3C0E9F2BCF-32B7-4E1A-B8B1-3B7B0A25F6FD%40nehbit.net%3E"
       TITLE="[Twisted-Python] Advice Request: Under what circumstances	should I use AMP's Command Response field?">burak at nehbit.net
       </A><BR>
    <I>Wed Aug 21 12:09:25 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027331.html">[Twisted-Python] Advice Request: Under what circumstances should I use AMP's Command Response field?
</A></li>
        <LI>Next message: <A HREF="027336.html">[Twisted-Python] Advice Request: Under what circumstances should I use AMP's Command Response field?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27334">[ date ]</a>
              <a href="thread.html#27334">[ thread ]</a>
              <a href="subject.html#27334">[ subject ]</a>
              <a href="author.html#27334">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(Only the latter part of this post is related to Twisted. I apologise in advance for the former, and you can skip to that half directly to read about the gist)

Hi Laurens,

&gt;<i> I think you're doing fine. Distributed systems are just kind of hard :-)
</I>
This is encouraging to hear!

&gt;<i> It sounds like your fundamentally building an eventually consistent distributed database. We have a few of those already: it might be significantly less work to just use one of them. I suppose it depends why you're trying to make it distributed. 
</I>
I have done a superficial research, so far it points to implementing my own solution. Or rather, what I am producing is not a full&#8211;fledged eventually consistent database at all, it's a loosely knit bunches of people. There is no 'database' in the classical sense.

&gt;<i> Is this about reliability in the face of e.g. hardware failure, or is this about being able to disseminate data when someone tries to stop you from doing so? Are you trying to protect against byzantine failures too?
</I>
It's about the right to free speech, so I would say the latter. I'm from Turkey and currently living in the United States, so while I am protected under First Amendment, my compatriots are not. This is significant: As you might have heard, we had a wave of peaceful protests two months ago against the last green space being demolished in the heart of Istanbul, the Gezi Park, to turn the space into a shopping mall. The riot police attacked unarmed, stationary people with tear gas canisters, which, led to a series of much larger protests (a few million large at its height) and an international outcry. Thousands arrested, five dead, state apparatus pressing charges for everyone from high schoolers to suburban moms. This country is not a banana republic and it's what made these so shocking: Turkey is the 15th largest economy in the world, larger than South Korea in terms of GDP, in the process of joining the European Union etc. 

The reason I'm telling this is what happened afterwards; after the govt. had to stop police violence after the EU / US pressure, they silently began a witch&#8211;hunt of Twitter, Facebook users and bloggers they deemed to be 'promoting armed insurgency against the state', and there are currently around 20-25 people currently under detention, waiting for trial. Of course, Twitter and Facebook does not give Turkish government any IP addresses: They just look at people's profiles, and just grab the most likely person having the same name. Our very broken legal system allows for up to five years (!) of contempt of court without pressing any charges, something which the Islamist government really loves to use against its people. 

I am building a tool that allows people to express their opinions without necessarily revealing their identities. It's called Aether, a distributed network that allows its users&#8212;all users are anonymous and unregistered by default&#8212; to exercise their right to free speech without being endangered by state violence. Everything within it is public, and everything posted on Aether is in public domain. (And please excuse the holier&#8211;than&#8211;thou sounding copywriting on the webpage&#8212;this was my thesis project and it was one of the requirements.)

The backend process of this application runs entirely on Twisted. The business rules are simple. Consider Alice the local node, Bob the remote node, and Carol another remote node. When Bob connects to Alice and gets a list of the posts Alice has, it will request the posts he does not have. The posts Alice has publicly available are the posts Alice has either a) created, or b) upvoted. If Bob, at some point, also likes the post he has gotten from Alice, Bob will also start to publicly distribute that post. At that point, it is impossible to determine whether Alice or Bob has created this post&#8212;Alice might as well have gotten the post from a third party which Bob is not aware of. The post, being distributed from two nodes, now has have a higher chance of being found by Carol. If you extrapolate it to a thousand people who all have upvoted the post, it becomes rather impossible to determine the origin. The act of 'liking' something is the exact same thing as sharing something, as is 'creating' something&#8212;there is absolutely no difference, and every node only has the IP address of the last ring of the chain. The nodes simply count how many times they encounter the same post digest to determine the amount of upvotes the post has gotten, and they use it to determine the lineup of posts the app shows to its user. Other than that, there is no global database, there is no global state, no people in the entire network is aware of all rest&#8212;I just strive to distribute the maximum amount of popular data to maximum amount of people possible. The client application pieces together all this information into a coherent whole of topics, subjects and posts. There is also distribution of user addresses through Aether to allow people to find new nodes to connect to.

There are also other details both in cryptography to defeat a global passive adversary, or detailed business rules to detect and hide abuses from the local user and many other things&#8212;this is a large project I have been working on alone for a very long time so some parts of it are rightly esoteric. And I have been off&#8211;topic already way longer than acceptable. I have the entire local application finished, and the only remaining part is networking, which is why I am trying to figure out Twisted so hard. Here are a bunch of screenshots for your perusal. Image 1  Image 2  Image 3  Image 4.

&gt;<i> While you can't rely on synchronized clocks (in the wall-clock time sense) in a distributed system, you *can* rely on timestamps of your immutable messages. You could send only message id's in the preceding time window, for example. You can use hash chains to guarantee that the boards share the same history.
</I>
I'm just discarding posts timestamped UNIX time that is ahead of the local UNIX time&#8212;for this specific purpose, it works well. 

All of those commands are handled through AMP protocol, and so far I am treating AMP like a local protocol with no chance of failure&#8212;that won't be the case under a real network. I can serve errors over AMP, but it starts to get very, very complex very fast when you do not have any guarantees on in which order things arrive. There are certain actions I want to forbid if a certain sequence has not been completed with that peer yet, but otherwise the protocol is remarkably flexible, and likewise remarkably pain&#8211;inflicting in its implementation. I guess I just want to know if I am using Twisted in this project the sanest way possible&#8212;I have enough insanity going on in my project to last a lifetime already!

Sorry about the semi off&#8211;topic wall of text, won't happen again.

Thanks,
Burak





On Aug 21, 2013, at 3:28 PM, Laurens Van Houtven &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.io</A>&gt; wrote:

&gt;<i> Hi Burak,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I think you're doing fine. Distributed systems are just kind of hard :-)
</I>&gt;<i> 
</I>&gt;<i> It sounds like your fundamentally building an eventually consistent distributed database. We have a few of those already: it might be significantly less work to just use one of them. I suppose it depends why you're trying to make it distributed. Is this about reliability in the face of e.g. hardware failure, or is this about being able to disseminate data when someone tries to stop you from doing so? Are you trying to protect against byzantine failures too?
</I>&gt;<i> 
</I>&gt;<i> That said, you might want to consider how you communicate posts. Six months worth of posts is a lot. Even with ten posts per day, you'd end up with ~10*30*6 = 1800 hash values. The digest size of BLAKE2 is variable, but if you're using 512 bit digests, that's 64 bytes, or 112.5 kibibytes for the whole thing. That's probably more than you want to send in a single message.
</I>&gt;<i> 
</I>&gt;<i> While you can't rely on synchronized clocks (in the wall-clock time sense) in a distributed system, you *can* rely on timestamps of your immutable messages. You could send only message id's in the preceding time window, for example. You can use hash chains to guarantee that the boards share the same history.
</I>&gt;<i> 
</I>&gt;<i> cheers
</I>&gt;<i> lvh
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130821/9c0b7497/attachment-0001.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130821/9c0b7497/attachment-0001.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4343 bytes
Desc: not available
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130821/9c0b7497/attachment-0001.bin">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130821/9c0b7497/attachment-0001.bin</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027331.html">[Twisted-Python] Advice Request: Under what circumstances should I use AMP's Command Response field?
</A></li>
	<LI>Next message: <A HREF="027336.html">[Twisted-Python] Advice Request: Under what circumstances should I use AMP's Command Response field?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27334">[ date ]</a>
              <a href="thread.html#27334">[ thread ]</a>
              <a href="subject.html#27334">[ subject ]</a>
              <a href="author.html#27334">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
