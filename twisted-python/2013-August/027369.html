<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Advice on porting Python application to Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advice%20on%20porting%20Python%20application%20to%20Twisted&In-Reply-To=%3CCAMYwhVmH-J7bD5-0bCqGX%3DoMgdJHonjua7bGOoKkaGgnHj9PSg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027366.html">
   <LINK REL="Next"  HREF="027373.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Advice on porting Python application to Twisted</H1>
    <B>Matthew Humphrey</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advice%20on%20porting%20Python%20application%20to%20Twisted&In-Reply-To=%3CCAMYwhVmH-J7bD5-0bCqGX%3DoMgdJHonjua7bGOoKkaGgnHj9PSg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Advice on porting Python application to Twisted">mhumphrey at gmail.com
       </A><BR>
    <I>Tue Aug 27 22:51:03 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027366.html">[Twisted-Python] Advice on porting Python application to Twisted
</A></li>
        <LI>Next message: <A HREF="027373.html">[Twisted-Python] Advice on porting Python application to Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27369">[ date ]</a>
              <a href="thread.html#27369">[ thread ]</a>
              <a href="subject.html#27369">[ subject ]</a>
              <a href="author.html#27369">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(Reply to Matt Haggard)

Matt - I was getting the emails delivered in digest form, so I am having to
reply to my original email instead of to your reply. I have added your
email directly to make sure you get it.

&gt;<i> I am not familiar with how you communicate with hardware on a
</I>&gt;<i> Raspberry PI.  Can you link to your existing code?  In my brief
</I>&gt;<i> reading this morning, I'm guessing you might be using the RPi.GPIO
</I>&gt;<i> library?  If so, I'm looking at
</I>&gt;<i> <A HREF="https://code.google.com/p/raspberry-gpio-python/wiki/Inputs">https://code.google.com/p/raspberry-gpio-python/wiki/Inputs</A> which
</I>&gt;<i> indicates that wait_for_edge() or event_detected() might be useful
</I>&gt;<i> (instead of a &quot;continuously called a 'timeTick' event&quot;).  But I'm not
</I>&gt;<i> sure what thread the callbacks to those functions are called in.
</I>
&gt;<i> I've also come across
</I>&gt;<i> <A HREF="https://www.kernel.org/doc/Documentation/gpio.txt">https://www.kernel.org/doc/Documentation/gpio.txt</A> which makes me think
</I>&gt;<i> it would be possible to register the GPIO events with the Twisted
</I>&gt;<i> reactor (but I've never done that and don't have a Pi to test with).
</I>
I wrote a small Python wrapper over the user-space GPIO driver. This uses
some special files under /sys/class/gpio. It is possible to configure a
GPIO input to be interrupt driven, and then using select() or poll() get an
asynchronous event when the configured condition occurs. I tested this out
manually from the Python console, however, my little wrapper class doesn't
support it currently. The other issue is that the simplest way to do button
debounce is to just poll the button once it's pressed and make sure it
stays pressed before some time before treating it as a &quot;button pressed&quot;
event. In my case, I also monitor the button to see if it is held down for
two seconds, as I treat that as an indicator to trigger the machine to
dispense the cat food. I suspect all that behavior could be duplicated in a
Twisted-friendly way, but I am not sure how to do that.

&gt;<i> Perhaps it's time to buy one.
</I>
They are a lot of fun for $35-$40.

&gt;&gt;<i> 3) A thread that runs continuously capturing images from a webcam. This
</I>&gt;&gt;<i> ...(snip)
</I>
&gt;<i> Someone with more intelligence than me should answer this, but here's
</I>&gt;<i> my attempt:
</I>
&gt;<i> You can do this without threads since you're just spawning processes
</I>&gt;<i> for the image captures.  I'm assuming you only want to capture as many
</I>&gt;<i> low res images as you can process. Here's one way to do it:
</I>
&gt;<i> from twisted.internet import reactor, task, defer
</I>&gt;<i> (snip)
</I>
Thanks, I see the docs on spawning processes now that your example pointed
out their existance. I think I can also emulate the behavior of my polling
loop by using the scheduled callback feature. I will play around with it a
bit and check back if I can't figure it out.

Thanks much for your reply.




On Mon, Aug 26, 2013 at 8:06 PM, Matthew Humphrey &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mhumphrey at gmail.com</A>&gt;wrote:

&gt;<i> I recently created a small automated, remote (via web) controlled pet
</I>&gt;<i> feeder using a Raspberry Pi single-board computer. The software is all in
</I>&gt;<i> Python, and uses the simple HTTP server that is part of the Python
</I>&gt;<i> libraries. I discovered Twisted about 2/3 of the way through the project,
</I>&gt;<i> and now that I am done I would like to port it to use Twisted. After
</I>&gt;<i> reading much of the documentation the Twisted web site, some aspects of
</I>&gt;<i> this are fairly obvious to me, while others are not. I could use some
</I>&gt;<i> advice on how best to design my app to fit in with the Twisted framework.
</I>&gt;<i>
</I>&gt;<i> Here are the major components of the application:
</I>&gt;<i>
</I>&gt;<i> 1) A web site that hosts a combination of static content and some REST
</I>&gt;<i> APIs. REST apis are called from Javascript Ajax, and do things like
</I>&gt;<i> enable/disable the webcam, dispense a treat, etc. The static content
</I>&gt;<i> consists of a single HTML page, some javascript scripts, and a JPG that is
</I>&gt;<i> captured by #3 below.
</I>&gt;<i>
</I>&gt;<i> 2) A thread that runs a loop which manages the hardware. It does this with
</I>&gt;<i> a simple state machine composed of a base class and subclasses for all the
</I>&gt;<i> states that the hardware can be in (starting, idle, displaying status on
</I>&gt;<i> the lcd, dispensing a treat, recovering from treat dispense cycle, shutting
</I>&gt;<i> down). After initializing the hardware and the initial state, the thread
</I>&gt;<i> loops continuously calling a &quot;timeTick&quot; event to the current state. WIthin
</I>&gt;<i> the states, the code looks at various hardware status (like whether a
</I>&gt;<i> button is pressed) and decides to take action or to trigger transition to
</I>&gt;<i> another state.
</I>&gt;<i>
</I>&gt;<i> 3) A thread that runs continuously capturing images from a webcam. This
</I>&gt;<i> thread captures low resolution images continuously, and compares sucessive
</I>&gt;<i> frames to see if there is significant number of different pixels (motion
</I>&gt;<i> detect). If so, it captures a higher resolution image, updates a symbolic
</I>&gt;<i> link to point to the most recent image captured, and deletes any excessive
</I>&gt;<i> files from previous captures. The images captured for the motion detect are
</I>&gt;<i> handled by executing a process and capturing the stdout. The higher res
</I>&gt;<i> images captured by executing a process that writes directly to a file.
</I>&gt;<i>
</I>&gt;<i> Porting #1 is very straightforward after going through the tutorial on
</I>&gt;<i> Twisted web. However, I am not sure how to handle #2 and #3. I would
</I>&gt;<i> appreciate some suggestions from those who are familiar with Twisted.
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130827/8b942c88/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130827/8b942c88/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027366.html">[Twisted-Python] Advice on porting Python application to Twisted
</A></li>
	<LI>Next message: <A HREF="027373.html">[Twisted-Python] Advice on porting Python application to Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27369">[ date ]</a>
              <a href="thread.html#27369">[ thread ]</a>
              <a href="subject.html#27369">[ subject ]</a>
              <a href="author.html#27369">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
