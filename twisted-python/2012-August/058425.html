<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Password hash for Perspective Brokers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Password%20hash%20for%20Perspective%20Brokers&In-Reply-To=%3C501A583A.7050504%40gresille.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   <LINK REL="Next"  HREF="058426.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Password hash for Perspective Brokers</H1>
    <B>Louis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Password%20hash%20for%20Perspective%20Brokers&In-Reply-To=%3C501A583A.7050504%40gresille.org%3E"
       TITLE="[Twisted-Python] Password hash for Perspective Brokers">spalax at gresille.org
       </A><BR>
    <I>Thu Aug  2 04:36:42 MDT 2012</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="058426.html">[Twisted-Python] debug with twisted manhole?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58425">[ date ]</a>
              <a href="thread.html#58425">[ thread ]</a>
              <a href="subject.html#58425">[ subject ]</a>
              <a href="author.html#58425">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>	Hello,

On 27/07/2012 00:07, Flint wrote:
&gt;<i> Hi, i've faced the same problem and submitted a patch a few month ago,
</I>&gt;<i> your can check it here <A HREF="http://twistedmatrix.com/trac/ticket/4398">http://twistedmatrix.com/trac/ticket/4398</A> you'll
</I>&gt;<i> find also a complet example attached.
</I>I read and improved the patch you submitted [1].

Also, to answer to Jean-Paul about a salt already being used in the
authentication [2], I would like to stress that the authentication
method uses two hash methods, which for no reason should be the same
(they can be, but they do not have to).
* The first one (password hash) is the hash method used to store the
password (e.g. crypt(3) for the unix shadow password). It may or may not
be salted.
* The second one (challenge hash) is the hash used during the
challenge/response part of authentication. It is salted, the salt being
a randomly generated string (the challenge).

Right now, password hash is either plain (no hash) or md5, without salt,
and challenge hash is md5, with the challenge as a salt. With the patch
I am submitting, password hash and challenge hash can be any method, the
challenge salt still is a randomly generated string, and the password
salt is anything you want, given that it can be computed given the
username and hashed password.
I drew a sequence diagram in the bug report [1], which can help to
undersand this part

	Cheers,
	Louis

[1] <A HREF="http://twistedmatrix.com/trac/ticket/4398#comment:5">http://twistedmatrix.com/trac/ticket/4398#comment:5</A>
[2] <A HREF="http://twistedmatrix.com/pipermail/twisted-python/2012-July/025928.html">http://twistedmatrix.com/pipermail/twisted-python/2012-July/025928.html</A>



&gt;<i> 
</I>&gt;<i> My first problem was that, the way twisted pb authentication works we're
</I>&gt;<i> supposed to have a plan version of passwords at server side.
</I>&gt;<i> Or this is not always the case, most application store a hashed version
</I>&gt;<i> of the password, the hash method may be different from the one twisted
</I>&gt;<i> pb use to pass the credential over the network
</I>&gt;<i> and thus, we're not able to compare those values.
</I>&gt;<i> 
</I>&gt;<i> In my solution the user can define a custom hash method and tell twisted
</I>&gt;<i> to use it, so that the password given by twisted over the network will
</I>&gt;<i> be hashed the same way that the application does before storing it (in
</I>&gt;<i> database for example), which means we can check if the password is
</I>&gt;<i> correct without having a plain version of it.
</I>&gt;<i> Not that, If we don't &quot;customize&quot; the hash method, the original twisted
</I>&gt;<i> behaviour in used instead, and thus compatibility is preserved.
</I>&gt;<i> 
</I>&gt;<i> -- G
</I>&gt;<i> 
</I>&gt;<i> Message: 1
</I>&gt;<i> 
</I>&gt;<i>     Date: Thu, 26 Jul 2012 12:36:57 -0500
</I>&gt;<i>     From: Kevin Horn &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.horn at gmail.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.horn at gmail.com</A>&gt;&gt;
</I>&gt;<i>     Subject: Re: [Twisted-Python] Password hash for Perspective Brokers
</I>&gt;<i>     To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;&gt;
</I>&gt;<i>     Message-ID:
</I>&gt;<i>            
</I>&gt;<i>     &lt;CA+U=<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">zK3W21_BAg9fbLZzsAmRJXReHsvGmRYb0JLT4sgVV78R7A at mail.gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">zK3W21_BAg9fbLZzsAmRJXReHsvGmRYb0JLT4sgVV78R7A at mail.gmail.com</A>&gt;&gt;
</I>&gt;<i>     Content-Type: text/plain; charset=&quot;iso-8859-1&quot;
</I>&gt;<i> 
</I>&gt;<i>     On Thu, Jul 26, 2012 at 11:43 AM, &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     &gt; On 02:28 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">spalax at gresille.org</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">spalax at gresille.org</A>&gt; wrote:
</I>&gt;<i>     &gt; &gt;         Hello
</I>&gt;<i>     &gt; &gt;         I have a problem with checkers in Twisted, which could be
</I>&gt;<i>     &gt; &gt;solved by
</I>&gt;<i>     &gt; &gt;adding a new feature. I think I can write the necessary code, but
</I>&gt;<i>     &gt; &gt;before
</I>&gt;<i>     &gt; &gt;doing so, I would like to hear you about it.
</I>&gt;<i>     &gt; &gt;
</I>&gt;<i>     &gt; &gt;# The problem
</I>&gt;<i>     &gt; &gt;
</I>&gt;<i>     &gt; &gt;         If I am right, the only way passwords can be hashed when
</I>&gt;<i>     using
</I>&gt;<i>     &gt; &gt;authentication with perspective brokers is using MD5 [1]. However,
</I>&gt;<i>     &gt; &gt;there
</I>&gt;<i>     &gt; &gt;are two flaws with it.
</I>&gt;<i>     &gt; &gt;
</I>&gt;<i>     &gt; &gt;* First, MD5 is no longer considered sure. It may be possible,
</I>&gt;<i>     from the
</I>&gt;<i>     &gt; &gt;hashed password, to find the original one.
</I>&gt;<i>     &gt; &gt;* Second, in the current implementation of Twisted, no salt is
</I>&gt;<i>     used to
</I>&gt;<i>     &gt; &gt;hash the password. A salt is considered good practise : it is
</I>&gt;<i>     harder to
</I>&gt;<i>     &gt; &gt;find the password from the hashed form, and two identical passwords
</I>&gt;<i>     &gt; &gt;have
</I>&gt;<i>     &gt; &gt;different hashed form, which prevent someone looking at the hashed
</I>&gt;<i>     &gt; &gt;passwords to see if two users have the same password.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; The second point is incorrect.  The hash is salted.  See the `respond`
</I>&gt;<i>     &gt; method in twisted/spread/pb.py.
</I>&gt;<i>     &gt; &gt;# A solution
</I>&gt;<i>     &gt; &gt;
</I>&gt;<i>     &gt; &gt;         I tried to implement the solution proposed in [1], and I
</I>&gt;<i>     think
</I>&gt;<i>     &gt; &gt;I can
</I>&gt;<i>     &gt; &gt;manage to do it. However, this seems to be a not-so-smart hack, which
</I>&gt;<i>     &gt; &gt;is
</I>&gt;<i>     &gt; &gt;not guaranteed to work in future releases of Twisted. That is why
</I>&gt;<i>     I am
</I>&gt;<i>     &gt; &gt;proposing a patch.
</I>&gt;<i>     &gt; &gt;
</I>&gt;<i>     &gt; &gt;         The patch would introduce some arguments to class
</I>&gt;<i>     &gt; &gt;PBServerFactory [2]
</I>&gt;<i>     &gt; &gt;to use (or not) a salt, and a different hash function. I am not
</I>&gt;<i>     settled
</I>&gt;<i>     &gt; &gt;down yet about the new signature of this class, but what is sure is
</I>&gt;<i>     &gt; &gt;that
</I>&gt;<i>     &gt; &gt;the default must be the actual behaviour, not to break programs
</I>&gt;<i>     already
</I>&gt;<i>     &gt; &gt;using Twisted. Then, I hesitate between
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; A good approach would be to parameterize the supported authentication
</I>&gt;<i>     &gt; mechanisms in an extensible way, rather than just hard coding one
</I>&gt;<i>     or two
</I>&gt;<i>     &gt; new (probably better) options.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; In other words, a SASL implementation for PB would be the best way to
</I>&gt;<i>     &gt; go.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; The existing API and behavior should indeed be preserved as-is for
</I>&gt;<i>     &gt; backwards compatibility.  The new authentication features should be
</I>&gt;<i>     &gt; exposed under a new API - either as new optional arguments accepted by
</I>&gt;<i>     &gt; PBServerFactory (and perhaps PBClientFactory) and new login methods
</I>&gt;<i>     &gt; (again, probably on those two classes).
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Jean-Paul
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     It would probably also help if someone finished the &quot;Generic SASL
</I>&gt;<i>     implementation&quot; ticket.
</I>&gt;<i> 
</I>&gt;<i>     Lessee, who was working on that last?
</I>&gt;<i> 
</I>&gt;<i>     Crap. It was me.
</I>&gt;<i> 
</I>&gt;<i>     Sorry about that.
</I>&gt;<i> 
</I>&gt;<i>     Kevin Horn
</I>&gt;<i>     -------------- next part --------------
</I>&gt;<i>     An HTML attachment was scrubbed...
</I>&gt;<i>     URL:
</I>&gt;<i>     <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20120726/191265a5/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20120726/191265a5/attachment-0001.htm</A>
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="058426.html">[Twisted-Python] debug with twisted manhole?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58425">[ date ]</a>
              <a href="thread.html#58425">[ thread ]</a>
              <a href="subject.html#58425">[ subject ]</a>
              <a href="author.html#58425">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
