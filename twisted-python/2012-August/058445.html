<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] IUnicodeUsernamePassword?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20IUnicodeUsernamePassword%3F&In-Reply-To=%3C85BED73D-C15E-4147-BC89-2C7A6C118536%40lvh.cc%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] IUnicodeUsernamePassword?</H1>
    <B>Laurens Van Houtven</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20IUnicodeUsernamePassword%3F&In-Reply-To=%3C85BED73D-C15E-4147-BC89-2C7A6C118536%40lvh.cc%3E"
       TITLE="[Twisted-Python] IUnicodeUsernamePassword?">_ at lvh.cc
       </A><BR>
    <I>Wed Aug  8 06:36:37 MDT 2012</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58445">[ date ]</a>
              <a href="thread.html#58445">[ thread ]</a>
              <a href="subject.html#58445">[ subject ]</a>
              <a href="author.html#58445">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Adding t.conch's ssh manhole (any third party IUsernamePassword provider would've done, really) to my app recently uncovered some unicode handling issues and I'm wondering what the appropriate way to resolve them is.

In my API (AMP) there is a:
    - e-mail which is unicode
    - password which is unicode

In my store (Axiom), there is a:
    - uid (unique user identifier, think UUID) which is bytes
    - e-mail which is unicode
    - password which is bytes, because it's the output of scrypt. scrypt also takes bytes as input: the password is first utf-8 encoded.

Previously I was mistakenly handing around IUsernamePasswords where the e-mail address was unicode.

Obviously the ICredentialsChecker implementation should take IUsernamePasswords that actually satisfy their contract and don't just pretend to, so ALL credentials it receives should have str/str, no exceptions. So, right now my credentials checker decodes the provided username to unicode in order to find the user by e-mail address (since, as mentioned above, Axiom thinks my e-mail addresses are unicode).

The flip side of this is that the login method now first encodes the provided username and password as unicode. This is at least a semantically correct solution, but has the somewhat surprising property that in the 99.9% use case, the e-mail is received as unicode, immediately encoded, and then virtually straight after decoded again. That doesn't mean it's wrong, but it's a little weird.

Potential solutions:

1. Make e-mail addresses bytes always. I don't know if this is semantically valid.
2. Add an IUnicodeUsernamePassword interface and implementation, and leaving adaptation to handle decoding/encoding. The downside here is that IIUC cred does not try to adapt to the ICredentialsChecker's supported interfaces, something I believe I complained about a few years back.

cheers
lvh





</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58445">[ date ]</a>
              <a href="thread.html#58445">[ thread ]</a>
              <a href="subject.html#58445">[ subject ]</a>
              <a href="author.html#58445">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
