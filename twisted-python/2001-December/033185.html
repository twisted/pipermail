<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] newbie question: error handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20newbie%20question%3A%20error%20handling&In-Reply-To=%3C20011231192722.J6904%40amaze.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="033182.html">
   <LINK REL="Next"  HREF="033186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] newbie question: error handling</H1>
    <B>Ivo van der Wijk</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20newbie%20question%3A%20error%20handling&In-Reply-To=%3C20011231192722.J6904%40amaze.nl%3E"
       TITLE="[Twisted-Python] newbie question: error handling">ivo at amaze.nl
       </A><BR>
    <I>Mon Dec 31 11:27:22 MST 2001</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="033182.html">[Twisted-Python] newbie question: error handling
</A></li>
        <LI>Next message (by thread): <A HREF="033186.html">[Twisted-Python] newbie question: error handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33185">[ date ]</a>
              <a href="thread.html#33185">[ thread ]</a>
              <a href="subject.html#33185">[ subject ]</a>
              <a href="author.html#33185">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Dec 31, 2001 at 09:08:52AM -0600, Glyph Lefkowitz wrote:
&gt;<i> On Sun, 2001-12-30 at 17:44, Ivo van der Wijk wrote:
</I>&gt;<i> &gt; Hi All,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I'm currently migrating my irc client to twisted, and things look
</I>&gt;<i> &gt; promising.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; However, I can't figure out the following things:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; My protocol is derived from protocols.basic.LineReceiver
</I>&gt;<i> &gt; (which in turn derives from protocol.Protocol.protocol).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; How can I determine what specific error condition caused connectionLost()
</I>&gt;<i> &gt; or connectionFailed()? I.e. connection refused, unknown hostname,
</I>&gt;<i> &gt; no route to host, etc (the standard errno stuff). 
</I>&gt;<i> 
</I>&gt;<i> Currently you can't.  This is the first request I'm aware of to be made
</I>&gt;<i> aware of the actual errno that caused the connection to fail; the
</I>&gt;<i> distinction between connectionFailed and connectionLost seemed to be the
</I>&gt;<i> big one.
</I>&gt;<i> 
</I>&gt;<i> The place you'd have to fix would be
</I>&gt;<i> twisted.internet.tcp.Connection.(doRead|writeSomeData).  Similarly in
</I>&gt;<i> twisted.internet.udp.  Patches accepted :-).
</I>&gt;<i> 
</I>
Okay. How about an error parameter to connectionLost|Failed
that would contain the actual error? Unfortunately, this would break
existing code, so you would end up with names like connectionFailedWithError.
Alternatively, the protocol can query the transport for the (last) error code.
Is the python error mechanism platform independent enough, or should there be 
an abstraction of the errno/errstr mechanism?

&gt;<i> &gt; Also, how can I determine if Linereceived.sendLine() (or 
</I>&gt;<i> &gt; Protocol.Transport.write()) failed? It doesn't seem to return an
</I>&gt;<i> &gt; error value or raise Exceptions, and depending on the invocation
</I>&gt;<i> &gt; of connectionLost makes things perhaps too asynchronous..
</I>&gt;<i> 
</I>&gt;<i> If you need this level of guarantee, you need a protocol which will send
</I>&gt;<i> acks for messages as they've been received.  There is no such thing as
</I>&gt;<i> &quot;too asynchronous&quot; -- there is &quot;synchronous&quot;, &quot;asynchronous&quot;, and
</I>&gt;<i> &quot;sometimes stuck doing something with one client while the rest of the
</I>&gt;<i> server hangs...&quot; :-).
</I>&gt;<i> 
</I>
Well, you could return an error if the connection is obviously closed
already (and perhaps return the error received when the connection was
close asynchronously) - i.e. when it's clear that the async. write will
fail. The rest can be handled right away.

Also, I don't know if twisted will always attempt to send/flush data right
away and catch EWOULDBLOCK, or if flushing will only be triggered by
select() on write fd's. In the former case, if writing won't block (which
may be quite often the case?), you catch errors immediately as well..

&gt;<i> This is the same question as previously, really; if a write &quot;fails&quot;,
</I>&gt;<i> then the connection has been lost.  Knowing that a connection failed
</I>&gt;<i> during a write and getting an errno would give you all the same
</I>&gt;<i> information.
</I>&gt;<i> 
</I>&gt;<i> Keep in mind that a write &quot;succeeding&quot; might just mean that the memory
</I>&gt;<i> was succesfully copied into a buffer for your OS kernel to send; the
</I>&gt;<i> other side of the connection may never have received it.
</I>
I basically meant succeeding as with socket.recv/send().

Cheers,

	Ivo

-- 
Drs. I.R. van der Wijk                              -=-
Brouwersgracht 132                      Amaze Internet Services V.O.F.
1013 HA Amsterdam, NL                               -=-
Tel: +31-20-4688336                       Linux/Web/Zope/SQL/MMBase
Fax: +31-20-4688337                           Network Solutions
Web:     <A HREF="http://www.amaze.nl/">http://www.amaze.nl/</A>                    Consultancy
Email:   <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ivo at amaze.nl</A>                               -=-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="033182.html">[Twisted-Python] newbie question: error handling
</A></li>
	<LI>Next message (by thread): <A HREF="033186.html">[Twisted-Python] newbie question: error handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33185">[ date ]</a>
              <a href="thread.html#33185">[ thread ]</a>
              <a href="subject.html#33185">[ subject ]</a>
              <a href="author.html#33185">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
