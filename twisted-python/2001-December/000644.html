<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Running a twisted server as a WinNT service
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Running%20a%20twisted%20server%20as%20a%20WinNT%20service&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000643.html">
   <LINK REL="Next"  HREF="000645.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Running a twisted server as a WinNT service</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Running%20a%20twisted%20server%20as%20a%20WinNT%20service&In-Reply-To="
       TITLE="[Twisted-Python] Running a twisted server as a WinNT service">andrew-twisted at puzzling.org
       </A><BR>
    <I>Sun Dec  9 21:46:17 EST 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="000643.html">[Twisted-Python] python's &quot;import&quot; is giving me a headache.
</A></li>
        <LI>Next message: <A HREF="000645.html">[Twisted-Python] Running a twisted server as a WinNT service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#644">[ date ]</a>
              <a href="thread.html#644">[ thread ]</a>
              <a href="subject.html#644">[ subject ]</a>
              <a href="author.html#644">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is just a quick mail to let people know what I had to do to make
a Twisted server work as a WinNT service.

First, it should be noted that I'm not using twistd or tap files, partly
because this server has no state that needs persisting, and also because
I'm not sure how to use them ;)

Basically, the service is really really simple:

---
import win32serviceutil, win32service
import MyServer
from twisted.python.log import startLogging
import twisted.internet.main

class MyTwistedService(win32serviceutil.ServiceFramework):
    def SvcDoRun():
        # Can't use stdout for logging -- .flush will barf
        startLogging(open('c:/mylogfile.log','a'))
        MyServer.main()

    def SvcStop():
        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
        twisted.internet.main.shutDown()

if __name__ == '__main__':
    win32serviceutil.HandleCommandLine(MyTwistedService)

---

And that does it.  The trickiest bit is that you need to set the log
file to something other than stdout, otherwise it dies due to a Bad File
Descriptor error doing logfile.flush().  Other than that, it is
basically boilerplate code (if you're familiar with Win32 services
written in Python).

I wonder if there is a more integrated way to do this, though?

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000643.html">[Twisted-Python] python's &quot;import&quot; is giving me a headache.
</A></li>
	<LI>Next message: <A HREF="000645.html">[Twisted-Python] Running a twisted server as a WinNT service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#644">[ date ]</a>
              <a href="thread.html#644">[ thread ]</a>
              <a href="subject.html#644">[ subject ]</a>
              <a href="author.html#644">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
