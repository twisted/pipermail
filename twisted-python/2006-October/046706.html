<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Newbie question on how to send &quot;complex&quot; objects	over the wire
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Newbie%20question%20on%20how%20to%20send%20%22complex%22%20objects%0A%09over%20the%20wire&In-Reply-To=%3Cf15b981d0610171705r4ec92d4en3aefb37e2e985685%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="046704.html">
   <LINK REL="Next"  HREF="046707.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Newbie question on how to send &quot;complex&quot; objects	over the wire</H1>
    <B>Franz Zieher</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Newbie%20question%20on%20how%20to%20send%20%22complex%22%20objects%0A%09over%20the%20wire&In-Reply-To=%3Cf15b981d0610171705r4ec92d4en3aefb37e2e985685%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Newbie question on how to send &quot;complex&quot; objects	over the wire">franz.zieher at gmail.com
       </A><BR>
    <I>Tue Oct 17 18:05:28 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="046704.html">[Twisted-Python] Perspective Broker and keeping track of	connected clients
</A></li>
        <LI>Next message (by thread): <A HREF="046707.html">[Twisted-Python] Newbie question on how to send &quot;complex&quot;	objects over the wire
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46706">[ date ]</a>
              <a href="thread.html#46706">[ thread ]</a>
              <a href="subject.html#46706">[ subject ]</a>
              <a href="author.html#46706">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can anybody provide a an example on how I would best send
a data structure (i.e. an ElemenTree from elementtree) over from
a server to a client process. I followed somewhat the example in
the documentation and used the perspective broker &quot;pb&quot; to send
an &quot;simple&quot; structure (some class with simple members)

When I changed to a more complex class definition, I obviously got
an InsecureJelly exception.

I'm sure this question must have come up a number of times. I'm new
in using twisted and not everything is so obvious at the beginning to me :-(

Many thanks for the help

Franz

Attached is the sample code I used:

sending test1 --&gt; OK
sending test2 --&gt; InsecureJelly exception

------   pbsimple.py (server) -------
from twisted.spread import pb, jelly
from twisted.internet import reactor

class test:
  def __init__(self):
    x = 3.
    y = 4.

class Bag:
  def setContent(self,content):
    self.content = content
  def printContent(self):
    print &quot;My data is&quot;, self.content

class CopyBag(Bag, pb.Copyable):
  pass

class Sender(pb.Root):
  def __init__(self, bag):
    self.bag = bag

  def remote_sendBag(self, remote):
    self.remote = remote
    d = remote.callRemote(&quot;takeBag&quot;, self.bag)
    d.addCallback(self.ok).addErrback(self.notOk)

  def ok(self, response):
    print &quot;info: %s&quot; % response
    d = self.remote.callRemote(&quot;finishTransfer&quot;)
    d.addErrback(self.notOk)
    return None

  def notOk(self, failure):
    if failure.type == jelly.InsecureJelly:
      print &quot;error: InsecureJelly&quot;
    elif failure.type == pb.PBConnectionLost:
      print &quot;info: data transfer finished&quot;
    else:
    print failure
    return None

def main():
  from pbsimple import CopyBag

  icae = iCAEconfig()
  bag = CopyBag()

  bag.setContent('simple data') # --&gt; OK
  #bag.setContent(test())       # --&gt; InsecureJelly
  sender = Sender(bag)

  factory = pb.PBServerFactory(sender)
  reactor.listenTCP(8789, factory)
  reactor.run()

if __name__ == '__main__':
  main()

-----------------------------

------------  pbsimleclient.py  -----------------

from twisted.spread import pb
from twisted.internet import reactor
from twisted.python import util

from pbsimple import Bag, CopyBag

class ReceiverBag(Bag,pb.RemoteCopy):
  pass

pb.setUnjellyableForClass(CopyBag, ReceiverBag)

class Receiver(pb.Referenceable):
  def remote_takeBag(self, bag):
    self.bag = bag
    return &quot;data arrived safe and sound&quot; # positive acknowledgement

  def remote_finishTransfer(self):
    print &quot;got bag:&quot;, self.bag
    reactor.stop()

  def requestBag(self,remote):
    print &quot;asking server for sending the data bag&quot;
    remote.callRemote(&quot;sendBag&quot;,self)

def getContentFromServer():

  receiver = Receiver()
  factory = pb.PBClientFactory()
  reactor.connectTCP(&quot;localhost&quot;, 8789, factory,30)
  d = factory.getRootObject()
  d.addCallback(receiver.requestBag)
  reactor.run()
  return receiver.bag.content

if __name__ == '__main__':
  print getContentFromServer()

---------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20061018/185592e7/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="046704.html">[Twisted-Python] Perspective Broker and keeping track of	connected clients
</A></li>
	<LI>Next message (by thread): <A HREF="046707.html">[Twisted-Python] Newbie question on how to send &quot;complex&quot;	objects over the wire
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46706">[ date ]</a>
              <a href="thread.html#46706">[ thread ]</a>
              <a href="subject.html#46706">[ subject ]</a>
              <a href="author.html#46706">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
