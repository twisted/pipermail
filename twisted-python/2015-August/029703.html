<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] doWrite called on a twisted.internet.tcp.Port
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20doWrite%20called%20on%20a%20twisted.internet.tcp.Port&In-Reply-To=%3CCAJYM%3DXJzx3ijz5PigrtLshwPjy8m%2BOWmabvWB%2BeDhPALgb6xMg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="029702.html">
   <LINK REL="Next"  HREF="062166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] doWrite called on a twisted.internet.tcp.Port</H1>
    <B>Jason Kane</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20doWrite%20called%20on%20a%20twisted.internet.tcp.Port&In-Reply-To=%3CCAJYM%3DXJzx3ijz5PigrtLshwPjy8m%2BOWmabvWB%2BeDhPALgb6xMg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] doWrite called on a twisted.internet.tcp.Port">jason.w.kane at gmail.com
       </A><BR>
    <I>Fri Aug 28 11:23:47 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="029702.html">[Twisted-Python] Auto-Re: Twisted 15.4.0pre1 Prerelease Announcement
</A></li>
        <LI>Next message (by thread): <A HREF="062166.html">[Twisted-Python] doWrite called on a twisted.internet.tcp.Port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29703">[ date ]</a>
              <a href="thread.html#29703">[ thread ]</a>
              <a href="subject.html#29703">[ subject ]</a>
              <a href="author.html#29703">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://twistedmatrix.com/trac/ticket/4759">https://twistedmatrix.com/trac/ticket/4759</A> -- I tried to post as a
comment in the Trac ticket but &quot;SpamBayes determined spam probability
of 93.78%&quot;.

Same issue but w/Linux; I've been hacking around at it for a bit and
found a few things that might be helpful.  I am on old twisted
(12.1.0) using a backported protocols.memcache so this could be
self-inflicted.

Inside epollreactor doPoll() I added sanity checks to log when
_poller.poll() gives us an event flagged for READ on a fd that is
_not_ in self._reads (and similarly with writes).  Low and behold,
gobs of hits.  Unexpected.

So I took a closer look.  It appears to me that _epoll.epoll() is
emitting events that are outside of the flags that epollreactor
carefully registers.  Filtering them out in doPoll seems to avoid this
particular traceback but it also breaks the world.  At least in my
system this appears to be the expected behavior.

So (to restate and summarize) asserting on addWriter() doesn't do
anything because the Port was added by addReader().  Despite only
being in _reads() and being registered with _epoll.EPOLLIN, doPoll()
is getting write events which it happily passes through to
_doReadOrWrite which checks the event flag, sees it as a _POLL_OUT and
tries to write it.

I'll try the obvious (upgrade twisted to current) and see what happens.

[[<A HREF="https://gist.github.com/jason-kane/18f1516d7c1ef381b35e|Gist">https://gist.github.com/jason-kane/18f1516d7c1ef381b35e|Gist</A> of my
diagnostic]]

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="029702.html">[Twisted-Python] Auto-Re: Twisted 15.4.0pre1 Prerelease Announcement
</A></li>
	<LI>Next message (by thread): <A HREF="062166.html">[Twisted-Python] doWrite called on a twisted.internet.tcp.Port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29703">[ date ]</a>
              <a href="thread.html#29703">[ thread ]</a>
              <a href="subject.html#29703">[ subject ]</a>
              <a href="author.html#29703">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
