<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Blacklisting hosts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Blacklisting%20hosts&In-Reply-To=%3C976F95AC-9578-4E6B-A710-87EDD1181E98%40googlemail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062133.html">
   <LINK REL="Next"  HREF="062136.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Blacklisting hosts</H1>
    <B>Chris Norman</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Blacklisting%20hosts&In-Reply-To=%3C976F95AC-9578-4E6B-A710-87EDD1181E98%40googlemail.com%3E"
       TITLE="[Twisted-Python] Blacklisting hosts">chris.norman2 at googlemail.com
       </A><BR>
    <I>Mon Aug 10 15:43:31 MDT 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062133.html">[Twisted-Python] Blacklisting hosts
</A></li>
        <LI>Next message (by thread): <A HREF="062136.html">[Twisted-Python] Blacklisting hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62137">[ date ]</a>
              <a href="thread.html#62137">[ thread ]</a>
              <a href="subject.html#62137">[ subject ]</a>
              <a href="author.html#62137">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

&gt;<i> On 10 Aug 2015, at 03:32, Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Aug 9, 2015, at 9:07 AM, Cory Benfield &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">cory at lukasa.co.uk</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">cory at lukasa.co.uk</A>&gt;&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On 8 Aug 2015, at 08:07, Chris Norman &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Hi all,
</I>&gt;&gt;&gt;<i> I am using Twisted to make a game server. I want to be able to ban IP addresses. Currently I check if the host is in a blacklist, and if it is, call abortConnection on the transport. It works fine, but I'm thinking there should be a better way, to actively refuse the connection in the first place?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I am not aware of any hook in the BSD socket API that lets you refuse a connection entirely. Generally, you put a socket into ‘listen’ mode (indicating to the OS that you’ll accept new connections), and then you call accept() to get the new connection. In fact, the OS will accept the connection even before you call accept(): it’ll do it asynchronously, and you will just get the FD for the connection. IIRC Windows has a winsock specific thing that might do what you want, but that’s pretty platform specific and probably doesn’t actually prevent the connection getting established anyway.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If you really want to never allow the connection at all, you’ll probably want to program iptables (or some other firewall if you aren’t on Linux) to do the packet filtering for you. A combination of iptables and ipsets will get you a high-performance IP address blacklist that will drop all packets before they ever reach your application.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> There is a shortcut in Twisted, at least, although it does not actually refuse the initial connection for the reasons listed above; you can examine the &quot;addr&quot; passed to IProtocolFactory.buildProtocol and return None.
</I>
This is perfect, thanks. It would have been better to refuse the connection entirely, but as Corey said, I can use iptables if I get desperate.

&gt;<i> 
</I>&gt;<i> -glyph
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>&gt;
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20150810/ed169a1c/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062133.html">[Twisted-Python] Blacklisting hosts
</A></li>
	<LI>Next message (by thread): <A HREF="062136.html">[Twisted-Python] Blacklisting hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62137">[ date ]</a>
              <a href="thread.html#62137">[ thread ]</a>
              <a href="subject.html#62137">[ subject ]</a>
              <a href="author.html#62137">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
