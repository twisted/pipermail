<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Persuading Python's Logging to use	twisted.logger
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Persuading%20Python%27s%20Logging%20to%20use%0A%09twisted.logger&In-Reply-To=%3CCAKF%3D%2Bdg%2B%2BV8GsoP78zOmO10ycxePVZsS%2Bph_K%2BbG8kqnNrc1LA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030312.html">
   <LINK REL="Next"  HREF="030315.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Persuading Python's Logging to use	twisted.logger</H1>
    <B>Kevin Conway</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Persuading%20Python%27s%20Logging%20to%20use%0A%09twisted.logger&In-Reply-To=%3CCAKF%3D%2Bdg%2B%2BV8GsoP78zOmO10ycxePVZsS%2Bph_K%2BbG8kqnNrc1LA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Persuading Python's Logging to use	twisted.logger">kevinjacobconway at gmail.com
       </A><BR>
    <I>Mon May  9 19:16:35 MDT 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="030312.html">[Twisted-Python] Persuading Python's Logging to use	twisted.logger
</A></li>
        <LI>Next message: <A HREF="030315.html">[Twisted-Python] Persuading Python's Logging to use twisted.logger
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30314">[ date ]</a>
              <a href="thread.html#30314">[ thread ]</a>
              <a href="subject.html#30314">[ subject ]</a>
              <a href="author.html#30314">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> The reverse mechanism of sending twisted.logger's output to the
</I>&gt;<i> standard library is of course handled by the
</I>&gt;<i> twisted.logger.STDLibLogObserver (and similar in twisted legacy
</I>&gt;<i> logging) but the documentation for this even suggests why this is a
</I>&gt;<i> bad idea: 'Warning: specific logging configurations (example: network)
</I>&gt;<i> can lead to this observer blocking.' which seems to me why it would be
</I>&gt;<i> better to attempt this the other way around...
</I>
The warning in the documentation about the potential blocking behaviour of
the StdLibLogObserver is correct, but it does tip a little close to FUD. If
you are using the Syslog or File based log observers then there is no
change in &quot;blocking&quot; behaviour between Twisted and the standard lib. The
Syslog observer and the standard library syslog facility both use exactly
the same standard library syslog module which is known to block under
certain system configurations. The File observer in Twisted and the
standard library both use regular Python file objects that don't leverage
the reactor in any way. Likewise, logging to STDIN/STDERR in both logging
frameworks treats the streams like normal file objects which, when
subjected to back pressure, become a source of blocking time. The only
cases where Twisted and the standard lib differ would be network based
logging.

My recommendation is to use the STdLibLogObserver. This will allow you to
use the twisted.logger in your Twisted code, merge Twisted and non-Twisted
logs into a single stream regardless of their origin, and allow you to tap
into things like the standard lib RotatingFileHandler and file based
configuration system. Should you actually need to pipe logs over the
network it would not be overly difficult to implement a standard lib
logging transport that leverages the reactor when sending data.

On Mon, May 9, 2016 at 5:18 PM Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> &gt; On May 9, 2016, at 1:50 PM, Daniel Sutcliffe &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The project I am working on uses pymodbus which I am sure shares a
</I>&gt;<i> &gt; fairly common attribute with many other modules of using Python's
</I>&gt;<i> &gt; standard Logging mechanism - a very reasonable choice even for a
</I>&gt;<i> &gt; module that supports Twisted, the library can also be used entirely
</I>&gt;<i> &gt; synchronously and thus would not want a required dependency of
</I>&gt;<i> &gt; Twisted.
</I>&gt;<i>
</I>&gt;<i> Sure, this makes sense.
</I>&gt;<i>
</I>&gt;<i> &gt; It struck me that it would be great to be able to redirect the
</I>&gt;<i> &gt; standard logging library to use twisted.logger by some sort of 'Clever
</I>&gt;<i> &gt; Monkey Patching' and that this may be a relatively common
</I>&gt;<i> &gt; requirement... however after extensive searching, and asking on the
</I>&gt;<i> &gt; pymodbus list, I can't find any evidence that such a thing has ever
</I>&gt;<i> &gt; been attempted or discussed.
</I>&gt;<i>
</I>&gt;<i> You shouldn't need monkey patching; the standard library logger does have
</I>&gt;<i> facilities for setting up custom handlers.  We just need to make one.
</I>&gt;<i> Honestly it would be great if this were featured within Twisted itself; it
</I>&gt;<i> would make a great contribution to twisted.logger proper.
</I>&gt;<i>
</I>&gt;<i> &gt; The reverse mechanism of sending twisted.logger's output to the
</I>&gt;<i> &gt; standard library is of course handled by the
</I>&gt;<i> &gt; twisted.logger.STDLibLogObserver (and similar in twisted legacy
</I>&gt;<i> &gt; logging) but the documentation for this even suggests why this is a
</I>&gt;<i> &gt; bad idea: 'Warning: specific logging configurations (example: network)
</I>&gt;<i> &gt; can lead to this observer blocking.' which seems to me why it would be
</I>&gt;<i> &gt; better to attempt this the other way around...
</I>&gt;<i>
</I>&gt;<i> I would very much like to see this :).  The standard library logging
</I>&gt;<i> mechanism is in common use, and until we can spin it out into a separate
</I>&gt;<i> project, `twisted.logger&#180; is unlikely to
</I>&gt;<i>
</I>&gt;<i> &gt; Am I crazy to even think this? is it just the rambling of
</I>&gt;<i> &gt; Python/Twisted newb? Or is there something I'm missing that would make
</I>&gt;<i> &gt; this impossible to do generically, and awkward to provide a vague
</I>&gt;<i> &gt; recipe of how to do?
</I>&gt;<i>
</I>&gt;<i> No, there's nothing that would make it impossible.  If you want to
</I>&gt;<i> contribute it.
</I>&gt;<i>
</I>&gt;<i> &gt; I do appreciate that twisted.logger offers a more feature rich
</I>&gt;<i> &gt; (structured) API and the Logging API would only be able to provide
</I>&gt;<i> &gt; level and text but it would be better than loosing any possibly useful
</I>&gt;<i> &gt; log messages from used modules in my mind.
</I>&gt;<i>
</I>&gt;<i> I think you might even be able to claw back some structured information
</I>&gt;<i> out of the stdlib logging machinery?  LogRecord does have 'args' and 'msg',
</I>&gt;<i> and we could convert that into a twisted.logger format string.  This would
</I>&gt;<i> be more expensive than using twisted.logger directly of course, but it
</I>&gt;<i> would still provide a lot more useful information.
</I>&gt;<i>
</I>&gt;<i> &gt; If anyone can enlighten me I would be most appreciative,
</I>&gt;<i>
</I>&gt;<i> I think just try to write a Handler (&lt;
</I>&gt;<i> <A HREF="https://docs.python.org/2.7/library/logging.handlers.html#module-logging.handlers">https://docs.python.org/2.7/library/logging.handlers.html#module-logging.handlers</A>&gt;)
</I>&gt;<i> that converts LogRecord objects to event dictionaries, and then emit them
</I>&gt;<i> to a &lt;
</I>&gt;<i> <A HREF="https://twistedmatrix.com/documents/16.1.1/api/twisted.logger.ILogObserver.html">https://twistedmatrix.com/documents/16.1.1/api/twisted.logger.ILogObserver.html</A>&gt;
</I>&gt;<i> and let us know if you hit any problems.
</I>&gt;<i>
</I>&gt;<i> -glyph
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20160510/41971901/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20160510/41971901/attachment.html</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030312.html">[Twisted-Python] Persuading Python's Logging to use	twisted.logger
</A></li>
	<LI>Next message: <A HREF="030315.html">[Twisted-Python] Persuading Python's Logging to use twisted.logger
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30314">[ date ]</a>
              <a href="thread.html#30314">[ thread ]</a>
              <a href="subject.html#30314">[ subject ]</a>
              <a href="author.html#30314">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
