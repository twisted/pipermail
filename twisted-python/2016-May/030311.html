<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Persuading Python's Logging to use	twisted.logger
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Persuading%20Python%27s%20Logging%20to%20use%0A%09twisted.logger&In-Reply-To=%3CCAD-DQxQjTqrGdKqOhHjKVUK2AYe%3DROtpS-QqX%3D%3DbTEJqXMe66g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030310.html">
   <LINK REL="Next"  HREF="030312.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Persuading Python's Logging to use	twisted.logger</H1>
    <B>Jeffrey Ollie</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Persuading%20Python%27s%20Logging%20to%20use%0A%09twisted.logger&In-Reply-To=%3CCAD-DQxQjTqrGdKqOhHjKVUK2AYe%3DROtpS-QqX%3D%3DbTEJqXMe66g%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Persuading Python's Logging to use	twisted.logger">jeff at ocjtech.us
       </A><BR>
    <I>Mon May  9 15:54:34 MDT 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="030310.html">[Twisted-Python] Persuading Python's Logging to use twisted.logger
</A></li>
        <LI>Next message: <A HREF="030312.html">[Twisted-Python] Persuading Python's Logging to use	twisted.logger
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30311">[ date ]</a>
              <a href="thread.html#30311">[ thread ]</a>
              <a href="subject.html#30311">[ subject ]</a>
              <a href="author.html#30311">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's a snippet that shows how I've handled it.  This example uses the new
style of logging in Twisted but would work just as well in the old style.
I'm not sure if there's a label that you can supply to the logging.Handler
to handle all messages but that's probably just a matter of digging into
the source code.

import sys
import logging

from twisted.logger import Logger
from twisted.logger import globalLogBeginner
from twisted.logger import textFileLogObserver

class TxLogHandler(logging.Handler):
    log = Logger()

    def __init__(self, label):
        self.label = label
        logging.Handler.__init__(self)
        self.level = logging.DEBUG

    def flush(self):
        pass

    def emit(self, record):
        try:
            msg = self.format(record)
            self.log.debug('{msg:}', msg = '\n'.join(map(lambda line: '{}:
{}'.format(self.label, line), msg.split('\n'))))
        except:
            self.handleError(record)

tx = TxLogHandler('FastAGI')
logger = logging.getLogger('FastAGI')
logger.addHandler(tx)
logger.setLevel(logging.DEBUG)

tx = TxLogHandler('AMI')
logger = logging.getLogger('AMI')
logger.addHandler(tx)
logger.setLevel(logging.DEBUG)

output = textFileLogObserver(sys.stderr)
globalLogBeginner.beginLoggingTo([output])



On Mon, May 9, 2016 at 3:50 PM, Daniel Sutcliffe &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt; wrote:

&gt;<i> The project I am working on uses pymodbus which I am sure shares a
</I>&gt;<i> fairly common attribute with many other modules of using Python's
</I>&gt;<i> standard Logging mechanism - a very reasonable choice even for a
</I>&gt;<i> module that supports Twisted, the library can also be used entirely
</I>&gt;<i> synchronously and thus would not want a required dependency of
</I>&gt;<i> Twisted.
</I>&gt;<i>
</I>&gt;<i> It struck me that it would be great to be able to redirect the
</I>&gt;<i> standard logging library to use twisted.logger by some sort of 'Clever
</I>&gt;<i> Monkey Patching' and that this may be a relatively common
</I>&gt;<i> requirement... however after extensive searching, and asking on the
</I>&gt;<i> pymodbus list, I can't find any evidence that such a thing has ever
</I>&gt;<i> been attempted or discussed.
</I>&gt;<i>
</I>&gt;<i> The reverse mechanism of sending twisted.logger's output to the
</I>&gt;<i> standard library is of course handled by the
</I>&gt;<i> twisted.logger.STDLibLogObserver (and similar in twisted legacy
</I>&gt;<i> logging) but the documentation for this even suggests why this is a
</I>&gt;<i> bad idea: 'Warning: specific logging configurations (example: network)
</I>&gt;<i> can lead to this observer blocking.' which seems to me why it would be
</I>&gt;<i> better to attempt this the other way around...
</I>&gt;<i>
</I>&gt;<i> Am I crazy to even think this? is it just the rambling of
</I>&gt;<i> Python/Twisted newb? Or is there something I'm missing that would make
</I>&gt;<i> this impossible to do generically, and awkward to provide a vague
</I>&gt;<i> recipe of how to do?
</I>&gt;<i>
</I>&gt;<i> I do appreciate that twisted.logger offers a more feature rich
</I>&gt;<i> (structured) API and the Logging API would only be able to provide
</I>&gt;<i> level and text but it would be better than loosing any possibly useful
</I>&gt;<i> log messages from used modules in my mind.
</I>&gt;<i>
</I>&gt;<i> If anyone can enlighten me I would be most appreciative,
</I>&gt;<i> Cheers
</I>&gt;<i> /dan
</I>&gt;<i> --
</I>&gt;<i> Daniel Sutcliffe &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


-- 
Jeff Ollie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20160509/351b8b8a/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20160509/351b8b8a/attachment.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030310.html">[Twisted-Python] Persuading Python's Logging to use twisted.logger
</A></li>
	<LI>Next message: <A HREF="030312.html">[Twisted-Python] Persuading Python's Logging to use	twisted.logger
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30311">[ date ]</a>
              <a href="thread.html#30311">[ thread ]</a>
              <a href="subject.html#30311">[ subject ]</a>
              <a href="author.html#30311">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
