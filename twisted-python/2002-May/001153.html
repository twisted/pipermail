<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted Enterprise (newbie question)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Enterprise%20%28newbie%20question%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001152.html">
   <LINK REL="Next"  HREF="001154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted Enterprise (newbie question)</H1>
    <B>Steve Waterbury</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Enterprise%20%28newbie%20question%29&In-Reply-To="
       TITLE="[Twisted-Python] Twisted Enterprise (newbie question)">steve.waterbury at gsfc.nasa.gov
       </A><BR>
    <I>Thu May 23 11:36:48 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001152.html">[Twisted-Python] Twisted Enterprise (newbie question)
</A></li>
        <LI>Next message: <A HREF="001154.html">[Twisted-Python] Twisted Enterprise (newbie question)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1153">[ date ]</a>
              <a href="thread.html#1153">[ thread ]</a>
              <a href="subject.html#1153">[ subject ]</a>
              <a href="author.html#1153">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Andrew Bennetts wrote:
&gt;<i> 
</I>&gt;<i> On Wed, May 22, 2002 at 01:38:31PM -0400, Steve Waterbury wrote:
</I>&gt;<i> &gt; Twisted Gurus,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm just starting to experiment with Twisted, and am trying out the
</I>&gt;<i> &gt; example in the &quot;Introduction to Twisted Enterprise&quot;, slightly modified:
</I>&gt;<i> 
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i> 
</I>&gt;<i> Was that your complete script?
</I>
It was.  

&gt;<i> If so, it also needs to start the Twisted main-loop:
</I>&gt;<i> ---
</I>&gt;<i> from twisted.internet import main
</I>&gt;<i> main.run()
</I>&gt;<i> ---
</I>
Thanks -- that helped a lot!  :^)

&gt;<i> [Or for the version in CVS:
</I>&gt;<i> from twisted.internet import reactor
</I>&gt;<i> reactor.run()
</I>&gt;<i> ]
</I>
Good to hear that &quot;main&quot; got the name-change!

&gt;<i> The Twisted Enterprise docs should probably be updated to make this
</I>&gt;<i> clearer, rather than assuming that people are already familiar with the
</I>&gt;<i> Twisted main-loop...
</I>
I might be able to help some with the Twisted Enterprise docs, since 
I hope to use it pretty intensively in our app ... 

&gt;<i> I'd suggest also reading &quot;Writing Twisted Servers&quot;.  It's by far the
</I>&gt;<i> best general overview of Twisted we have at the moment, even if you
</I>&gt;<i> don't intend to write servers with it.
</I>
I'd read that at least twice, but I guess I hadn't grokked it.  
But now that I know the main loop needs to be run explicitly, 
it makes perfect sense ... how else would I get the result of 
callback?  I'm learning ...

&gt;<i> Let us know if you any other problems.
</I>
Right:  I got a traceback that said my &quot;result&quot; was not subscriptable.  
Looking at the code for adbapi.ConnectionPool in Twisted 0.17.4, 
I noticed that the &quot;runOperation&quot; method used in the example ultimately
calls _runOperation, which says it &quot;is used for non-query operations 
that don't want &quot;fetch*&quot; to be called&quot; ... doh!  No wonder my &quot;result&quot; 
was not subscriptable!  ;^)  

So I created a &quot;runQuery&quot; method for adbapi.ConnectionPool:

    def runQuery(self, *args, **kw):
        d = defer.Deferred()
        apply(self.query, (d.callback,d.errback)+args, kw)
        return d

... and now my script works!  (Has adbapi.ConnectionPool been fixed yet 
in the CVS version?)   

Here's the new version of my script (assumes the process owner's 
login name is also a database user):
--------------------------------------------------------------------------
from twisted.internet import main
from twisted.enterprise import adbapi
import sys
class TestDatabase(adbapi.Augmentation):
    def getSchemaByName(self,schemaname):
        sql = &quot;&quot;&quot;SELECT identification from schema WHERE schema_name = %s&quot;&quot;&quot;
        return self.runQuery(sql,schemaname)

def gotSchemaByName(resultlist):
    ident = resultlist[0][0]
    print resultlist
    print &quot;Schema has identifier %s.&quot; % ident

dbpool = adbapi.ConnectionPool(&quot;pyPgSQL.PgSQL&quot;,database=&quot;test&quot;)
db = TestDatabase(dbpool)

db.getSchemaByName(&quot;pgpdm_schema&quot;).addCallbacks(gotSchemaByName, db.operationError).arm()
main.run()
--------------------------------------------------------------------------

... with the output:
--------------------------------------------------------------------------
[['PGPDM-1.0']]
Schema has identifier PGPDM-1.0.
--------------------------------------------------------------------------

Thanks for the help!
-- Steve.

Stephen C. Waterbury  <A HREF="http://misspiggy.gsfc.nasa.gov/people/waterbug.html">http://misspiggy.gsfc.nasa.gov/people/waterbug.html</A>
    &quot;An idiot with a computer is a faster, better idiot.&quot; - Rick Julius


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001152.html">[Twisted-Python] Twisted Enterprise (newbie question)
</A></li>
	<LI>Next message: <A HREF="001154.html">[Twisted-Python] Twisted Enterprise (newbie question)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1153">[ date ]</a>
              <a href="thread.html#1153">[ thread ]</a>
              <a href="subject.html#1153">[ subject ]</a>
              <a href="author.html#1153">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
