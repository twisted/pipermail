<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted receiving buffers swamped?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20receiving%20buffers%20swamped%3F&In-Reply-To=%3C20150102113222.7937.1494245595.divmod.xquotient.13%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="061571.html">
   <LINK REL="Next"  HREF="061532.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted receiving buffers swamped?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20receiving%20buffers%20swamped%3F&In-Reply-To=%3C20150102113222.7937.1494245595.divmod.xquotient.13%40top%3E"
       TITLE="[Twisted-Python] Twisted receiving buffers swamped?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Fri Jan  2 04:32:22 MST 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="061571.html">[Twisted-Python] Twisted receiving buffers swamped?
</A></li>
        <LI>Next message (by thread): <A HREF="061532.html">[Twisted-Python] Twisted receiving buffers swamped?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61530">[ date ]</a>
              <a href="thread.html#61530">[ thread ]</a>
              <a href="subject.html#61530">[ subject ]</a>
              <a href="author.html#61530">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1 Jan, 10:21 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tobias.oberstein at tavendo.de</A> wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I am doing network performance tests using netperf on a trivial Twisted 
</I>&gt;<i>TCP echo server (code at the end).
</I>&gt;<i>
</I>&gt;<i>One of the tests that netperf offers is throughput, and I am running 
</I>&gt;<i>into an issue with this.
</I>? [snip]
&gt;<i>
</I>&gt;<i>Now, my suspicion is that Twisted is reading off the TCP stack from the 
</I>&gt;<i>kernel and buffering in userspace faster than the echo server is 
</I>&gt;<i>pushing out stuff to the TCP stack into the kernel. Hence, no TCP 
</I>&gt;<i>backpressure results, netperf happily sends more and more, and the 
</I>&gt;<i>memory of the Twisted process runs away.
</I>
What you said here about &quot;buffering in userspace&quot; is ambiguous.  It's 
not clear if you meant data is being buffered in userspace on the read 
side before your protocol gets a chance to handle it or if you meant 
that data being written to the transport by the protocol is being 
buffered in userspace.

The former doesn't happen.  There are no no userspace read buffers in 
Twisted between the transport and the protocol.  Bytes are read from the 
socket and then passed to dataReceived.

The latter would be addressed by using producer/consumer APIs as Glyph 
suggested.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="061571.html">[Twisted-Python] Twisted receiving buffers swamped?
</A></li>
	<LI>Next message (by thread): <A HREF="061532.html">[Twisted-Python] Twisted receiving buffers swamped?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61530">[ date ]</a>
              <a href="thread.html#61530">[ thread ]</a>
              <a href="subject.html#61530">[ subject ]</a>
              <a href="author.html#61530">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
