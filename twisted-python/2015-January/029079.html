<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted receiving buffers swamped?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20receiving%20buffers%20swamped%3F&In-Reply-To=%3C634914A010D0B943A035D226786325D44B55490515%40EXVMBX020-12.exch020.serverdata.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029077.html">
   <LINK REL="Next"  HREF="029080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted receiving buffers swamped?</H1>
    <B>Tobias Oberstein</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20receiving%20buffers%20swamped%3F&In-Reply-To=%3C634914A010D0B943A035D226786325D44B55490515%40EXVMBX020-12.exch020.serverdata.net%3E"
       TITLE="[Twisted-Python] Twisted receiving buffers swamped?">tobias.oberstein at tavendo.de
       </A><BR>
    <I>Sat Jan 10 01:33:38 MST 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029077.html">[Twisted-Python] Twisted receiving buffers swamped?
</A></li>
        <LI>Next message: <A HREF="029080.html">[Twisted-Python] Twisted receiving buffers swamped?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29079">[ date ]</a>
              <a href="thread.html#29079">[ thread ]</a>
              <a href="subject.html#29079">[ subject ]</a>
              <a href="author.html#29079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi glyph,

&gt;&gt;<i>I get strange results.
</I>&gt;&gt;<i>Sluggish performance:
</I>
&gt;<i>Did you ever diagnose this further? &#160;This seems like the sort of thing that we should start having a performance test for.
</I>
Not yet. I didn't reply again since you gave me enough homework already:

- Run the producer/consumer variant on Linux (bisecting BSD/kqueue)
- Do the memory profiling with non-producer/consumer (tracking down _where_ memory runs away)

Other stuff interrupted me again, and my impression is, that it might be significant effort to really track this down. No surprise here: really pushing things often means &quot;issues&quot; pop up.

I absolutely agree: we should have repeatable, comparable, standard performance tests.

Like we have with trial/buildbot, but for performance, not functional tests.

FWIW, here are my thoughts on this: 


1)
A simple Twisted based &quot;TCP echo server&quot; (maybe in non-producer/consumer and producer/consumer variants) as a testee will already allow us to do a _lot_.
We can come up with more testees later (e.g. Twisted Web with static resource, ...).

2)
It might be wise to use a non-Twisted, standard test load generator like netperf, instead of a Twisted based one.
- having the load generator written in Twisted creates a cyclic dependency (e.g. rgd. interpreting results)
- it allows to compare results to non-Twisted setups and allows others to repeat against their stuff

3)
We should include at least 2 operating systems (FreeBSD / Linux).
This allows to quickly bisect OS or Twisted reactor specific issues.

4)
We should run this on real, physical, non-virtualized, dedicated hardware and networking gear.
I can't stress enough how important this is in my experience:
Any form of virtualization brings a whole own dimension of factors/variability into the game.
Testing in VMs on a shared hypervisor on a public cloud: you never really know, you never really can repeat.
Repeatability is absolutely crucial.

5)
The load generator and the testee should run on 2 separate boxes, connected via real network (e.g. switched ether).
Testing via loopback is often misleading, and practically often irrelevant (too far away from production deployments).

6)
We should test on both CPython and PyPy.
Because this is where stuff actually runs later in production. And for bisecting Python implementation specifics.

7)
It should be automated.

8)
The results should be stored in a long term archive (a database) so we can compare results over time / setups.

9)
We should collect monitoring parameters (CPU load ...) on both the load generator and testee boxes during test runs.
Like, &quot;same network perf., but one triggers double the CPU load&quot; ..

===

Because of 3/4/5, this requires 4 boxes to begin with. Those should be absolutely _identical_.

Currently, we (Tavendo) have a setup dedicated to performance tests consisting of 2 boxes with dual port 10GbE and a 8 port 10GbE switch.

Buying 2 more identical boxes and adding those would be technically possible. 7/8/9 and setting this all up is work.

I would need to somehow justify/book these investments. I have &quot;ideas&quot; about that, but step by step: what do you think about above?

/Tobias


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029077.html">[Twisted-Python] Twisted receiving buffers swamped?
</A></li>
	<LI>Next message: <A HREF="029080.html">[Twisted-Python] Twisted receiving buffers swamped?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29079">[ date ]</a>
              <a href="thread.html#29079">[ thread ]</a>
              <a href="subject.html#29079">[ subject ]</a>
              <a href="author.html#29079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
