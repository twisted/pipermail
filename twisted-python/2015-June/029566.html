<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted logger changes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20logger%20changes&In-Reply-To=%3CA5C51B0F-57C8-425F-A860-F45557DD8BE3%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029562.html">
   <LINK REL="Next"  HREF="029568.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted logger changes</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20logger%20changes&In-Reply-To=%3CA5C51B0F-57C8-425F-A860-F45557DD8BE3%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Twisted logger changes">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Jun  9 00:09:33 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029562.html">[Twisted-Python] Twisted logger changes
</A></li>
        <LI>Next message: <A HREF="029568.html">[Twisted-Python] Twisted logger changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29566">[ date ]</a>
              <a href="thread.html#29566">[ thread ]</a>
              <a href="subject.html#29566">[ subject ]</a>
              <a href="author.html#29566">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Jun 8, 2015, at 9:51 AM, Maciej Wasilak &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wasilak at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Dear list,
</I>&gt;<i> 
</I>&gt;<i> I've tried running Twisted 15.2.1 with my old library, and I am
</I>&gt;<i> getting an exception, that I haven't seen before (with Twisted
</I>&gt;<i> 14.0.0):
</I>&gt;<i> 
</I>&gt;<i>      File &quot;/usr/local/lib/python2.7/dist-packages/txthings/coap.py&quot;,
</I>&gt;<i> line 1338, in sendResponse
</I>&gt;<i>        print &quot;Token: %s&quot; % (response.token)
</I>&gt;<i>      File &quot;/usr/local/lib/python2.7/dist-packages/twisted/logger/_io.py&quot;,
</I>&gt;<i> line 163, in write
</I>&gt;<i>        string = string.decode(self._encoding)
</I>&gt;<i>      File &quot;/usr/lib/python2.7/encodings/utf_8.py&quot;, line 16, in decode
</I>&gt;<i>        return codecs.utf_8_decode(input, errors, True)
</I>&gt;<i>    exceptions.UnicodeDecodeError: 'utf8' codec can't decode byte 0xae
</I>&gt;<i> in position 7: invalid start byte
</I>&gt;<i> 
</I>&gt;<i> Although it is triggered by simple print, it seems to be caused by
</I>&gt;<i> logging. Does new logging framework need any configuration to stay
</I>&gt;<i> compatible with the old one?
</I>

Although logger is reacting to this in a bad way, and that is a bug, your program has a bug too: you are printing to a text file (which is what stdout is when it is redirected to a log) by using binary data.  python 3 will mangle your output if you try to do this, so you should restrict your program to unicode if you intend to redirect stdout to a logger.

Here's a very simple example which provokes the same bad behavior:

import sys
from twisted.logger import globalLogBeginner, textFileLogObserver
globalLogBeginner.beginLoggingTo([textFileLogObserver(sys.stdout)])
print(b&quot;Testing testing, one \xae two.&quot;)

The equivalent in old-style logging would be:

import sys
from twisted.python.log import startLogging
startLogging(sys.stdout)
print(b&quot;Testing testing, one \xae two.&quot;)

Therefore this is a regression in the new logging system.  I've filed it as a bug, here: &lt;<A HREF="https://twistedmatrix.com/trac/ticket/7933">https://twistedmatrix.com/trac/ticket/7933</A> &lt;<A HREF="https://twistedmatrix.com/trac/ticket/7933">https://twistedmatrix.com/trac/ticket/7933</A>&gt;&gt;.  In the future, I would encourage you to take advantage of the pre-release testing period to discover issues like this, since it would have been nice to know about this before the final release went out ;-).  (Not to say this is your fault though, this is totally our bug, and I'm surprised we didn't catch it given all the other similar stuff we caught before the release.)

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20150608/92e4c851/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20150608/92e4c851/attachment.html</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029562.html">[Twisted-Python] Twisted logger changes
</A></li>
	<LI>Next message: <A HREF="029568.html">[Twisted-Python] Twisted logger changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29566">[ date ]</a>
              <a href="thread.html#29566">[ thread ]</a>
              <a href="subject.html#29566">[ subject ]</a>
              <a href="author.html#29566">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
