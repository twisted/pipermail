<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Using twisted.trial with nose unittest system
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Using%20twisted.trial%20with%20nose%20unittest%20system&In-Reply-To=%3C1170869775.5120.55.camel%40antoine-ubuntu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047295.html">
   <LINK REL="Next"  HREF="047302.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Using twisted.trial with nose unittest system</H1>
    <B>Antoine Pitrou</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Using%20twisted.trial%20with%20nose%20unittest%20system&In-Reply-To=%3C1170869775.5120.55.camel%40antoine-ubuntu%3E"
       TITLE="[Twisted-Python] Re: Using twisted.trial with nose unittest system">antoine.pitrou at wengo.com
       </A><BR>
    <I>Wed Feb  7 10:36:15 MST 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047295.html">[Twisted-Python] Re: Using twisted.trial with nose unittest system
</A></li>
        <LI>Next message (by thread): <A HREF="047302.html">[Twisted-Python] Re: Using twisted.trial with nose unittest system
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47296">[ date ]</a>
              <a href="thread.html#47296">[ thread ]</a>
              <a href="subject.html#47296">[ subject ]</a>
              <a href="author.html#47296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

Le mercredi 07 février 2007 à 16:35 +0000, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> a écrit :
&gt;<i> Yes.  Also, it's highly likely that the tests won't stop cleanly on
</I>&gt;<i> ^C.
</I>
Depends on what you mean by &quot;cleanly&quot;. I haven't noticed any annoying
behaviour when killing tests in the middle.

Regardless of ^C, there is a sporadic exception at shutdown due to the
way Python destroys modules (it first sets the module members to None).
I suppose it can happen in any situation in which Twisted is run in a
separate thread:

&lt;&lt;
Exception in thread Thread-1 (most likely raised during interpreter shutdown):
Traceback (most recent call last):
  File &quot;threading.py&quot;, line 460, in __bootstrap
  File &quot;threading.py&quot;, line 440, in run
  File &quot;/home/antoine/nose-svn/nose/twistedtools.py&quot;, line 52, in &lt;lambda&gt;
  File &quot;/usr/lib/python2.5/site-packages/twisted/internet/posixbase.py&quot;, line 218, in run
  File &quot;/usr/lib/python2.5/site-packages/twisted/internet/posixbase.py&quot;, line 231, in mainLoop
&lt;type 'exceptions.AttributeError'&gt;: 'NoneType' object has no attribute 'msg'
Unhandled exception in thread started by 
Error in sys.excepthook:

Original exception was:
&gt;&gt;<i>
</I>
&gt;<i> More serious than the process-running issue, from my point of view, is
</I>&gt;<i> the fact that if you forget the &quot;@deferred&quot; decorator on a test that
</I>&gt;<i> uses any reactor API, or code that internally _uses_ any reactor API,
</I>&gt;<i> you will put your tests into a non-deterministic state, and although
</I>&gt;<i> they'll pass _most_ of the time, they will die depending on the load
</I>&gt;<i> characteristics of your machine at the time and (insert long-winded
</I>&gt;<i> rant about the evil things threads do to your code here).  Tests are
</I>&gt;<i> exactly the place you never want this to happen :).
</I>
That's certainly right, although you should get messages about uncaught
exceptions or unhandled errbacks, so you'll know that something went
wrong.
What happens with Trial when you forget to return the Deferred the test
should wait on?

&gt;<i> Also, setUp and tearDown methods also need the decorator applied, I
</I>&gt;<i> think, not just test methods.
</I>
Setup methods at least, if they do something asynchronous.

&gt;<i> All in all it seems like it would be simpler to just use trials'
</I>&gt;<i> TestCase class with nose.  Is there any reason not to?
</I>
Given that Trial is a self-contained tool, and given that nose also has
its own test running and collecting, I simply didn't expect this to work
or to keep working accross versions of both tools.

&gt;<i> Trial doesn't force your code to make use of Twisted, and as Mr. Lange
</I>&gt;<i> has declared previously, it goes to some lengths to be compatible with
</I>&gt;<i> stdlib unit tests.
</I>
Of course, but to use Trial you must install Twisted don't you ?
Which is quite a big dependency, and Twisted does not yet support being
easy_install'ed.

Regards

Antoine.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047295.html">[Twisted-Python] Re: Using twisted.trial with nose unittest system
</A></li>
	<LI>Next message (by thread): <A HREF="047302.html">[Twisted-Python] Re: Using twisted.trial with nose unittest system
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47296">[ date ]</a>
              <a href="thread.html#47296">[ thread ]</a>
              <a href="subject.html#47296">[ subject ]</a>
              <a href="author.html#47296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
