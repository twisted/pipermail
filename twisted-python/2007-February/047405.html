<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] LineReceiver
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20LineReceiver&In-Reply-To=%3C20070225234535.25807.1196083361.divmod.quotient.32028%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="014896.html">
   <LINK REL="Next"  HREF="047406.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] LineReceiver</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20LineReceiver&In-Reply-To=%3C20070225234535.25807.1196083361.divmod.quotient.32028%40ohm%3E"
       TITLE="[Twisted-Python] LineReceiver">exarkun at divmod.com
       </A><BR>
    <I>Sun Feb 25 16:45:35 MST 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014896.html">[Twisted-Python] LineReceiver
</A></li>
        <LI>Next message (by thread): <A HREF="047406.html">[Twisted-Python] LineReceiver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47405">[ date ]</a>
              <a href="thread.html#47405">[ thread ]</a>
              <a href="subject.html#47405">[ subject ]</a>
              <a href="author.html#47405">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 25 Feb 2007 18:26:33 -0500, Lee Connell &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">lee.a.connell at gmail.com</A>&gt; wrote:
&gt;<i>Hello all,
</I>&gt;<i>
</I>&gt;<i>I am building a basic chat program.  I am using LineReceiver for the
</I>&gt;<i>protocol on both the server and the client.  My problem is when i loop
</I>&gt;<i>through all the clients in my ServerFactory and choose to send data to the
</I>&gt;<i>client with multiple calls to transport.write(data), the client side does
</I>&gt;<i>not pick it up in two seperate calls, instead it is received in one
</I>&gt;<i>lineReceive. In the server I call transport.write() twice, the client
</I>&gt;<i>however receives both calls in one lineReceive instead of two lineRecieve
</I>&gt;<i>calls, how can I get lineReceive to be fired for each transported message?
</I>
The purpose of LineReceiver is to take a stream of bytes which no guarantees
about how many bytes will be received at a time and make it appear as a line
stream where each complete line is delivered separately.

Since you are using LineReceiver, rather than calling self.transport.write,
you should probably be using self.sendLine, which will insert the delimiter
bytes for you.  You must also be careful not to include the delimiter bytes
in the strings you pass to self.sendLine.

&gt;<i>
</I>&gt;<i>//// CLIENT LINE RECEIVE ////
</I>&gt;<i>
</I>&gt;<i>    def lineReceived(self, line):
</I>&gt;<i>        if self.app:
</I>&gt;<i>            self.app.addMessage(line)
</I>&gt;<i>
</I>&gt;<i>//// SERVER CONNECTION MADE ////
</I>&gt;<i>
</I>&gt;<i>    def connectionMade(self):
</I>&gt;<i>        self.factory.clients.append(self)
</I>&gt;<i>        host = self.transport.getPeer().host + &quot;: joined the server.&quot;
</I>&gt;<i>
</I>&gt;<i>        for c in self.factory.clients:
</I>&gt;<i>            c.transport.write(host + '\n')
</I>
So, consider doing this instead:

      c.sendLine(host)

&gt;<i>            if self == c:
</I>&gt;<i>                c.transport.write(self.getMOTD())   ### getMOTD just returns
</I>&gt;<i>some string ###
</I>
As well as:

      c.sendLine(self.getMOTD())

Also note that the default LineReceiver line delimiter is \r\n, not \n.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014896.html">[Twisted-Python] LineReceiver
</A></li>
	<LI>Next message (by thread): <A HREF="047406.html">[Twisted-Python] LineReceiver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47405">[ date ]</a>
              <a href="thread.html#47405">[ thread ]</a>
              <a href="subject.html#47405">[ subject ]</a>
              <a href="author.html#47405">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
