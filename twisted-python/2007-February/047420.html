<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Making a duck-typed traceback from a Failure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Making%20a%20duck-typed%20traceback%20from%20a%20Failure&In-Reply-To=%3C20070301015016.17852.1513181203.divmod.quotient.1157%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047419.html">
   <LINK REL="Next"  HREF="047421.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Making a duck-typed traceback from a Failure</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Making%20a%20duck-typed%20traceback%20from%20a%20Failure&In-Reply-To=%3C20070301015016.17852.1513181203.divmod.quotient.1157%40ohm%3E"
       TITLE="[Twisted-Python] Re: Making a duck-typed traceback from a Failure">exarkun at divmod.com
       </A><BR>
    <I>Wed Feb 28 18:50:16 MST 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047419.html">[Twisted-Python] Re: Making a duck-typed traceback from a Failure
</A></li>
        <LI>Next message (by thread): <A HREF="047421.html">[Twisted-Python] Re: Making a duck-typed traceback from a Failure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47420">[ date ]</a>
              <a href="thread.html#47420">[ thread ]</a>
              <a href="subject.html#47420">[ subject ]</a>
              <a href="author.html#47420">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 1 Mar 2007 11:16:17 +1100, Jonathan Lange &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jml at mumak.net</A>&gt; wrote:
&gt;<i>On 2/28/07, Jonathan Lange &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jml at mumak.net</A>&gt; wrote:
</I>&gt;&gt;<i>Is it possible to make a duck-typed traceback from a cleaned Failure?
</I>&gt;&gt;<i>I haven't really looked into it, but I can't think of why not off the
</I>&gt;&gt;<i>top of my head. Granted I ran out of thought gluons a couple of hours
</I>&gt;&gt;<i>ago.
</I>&gt;<i>
</I>&gt;<i>&lt;exarkun&gt; jml: if you refine the question with some details (why isn't
</I>&gt;<i>there a real traceback, what do you want to do with the reconstructed
</I>&gt;<i>traceback, etc), I might be able to produce some useful feedback
</I>&gt;<i>
</I>&gt;<i>1. Why isn't there a real traceback
</I>&gt;<i>
</I>&gt;<i>The failure is caught in an errback in Trial's run().
</I>&gt;<i>Deferred._runCallbacks calls Failure.cleanFailure on any failures that
</I>&gt;<i>are returned from Deferreds. By the time the TestResult object gets
</I>&gt;<i>the failure, cleanFailure() has been run on it.
</I>&gt;<i>
</I>&gt;<i>cleanFailure() sets Failure.tb to None, and converts all of the frames
</I>&gt;<i>into strings. This ensures that we don't keep references to a billion
</I>&gt;<i>different objects every time there is a failure.
</I>&gt;<i>
</I>
To clarify slightly (this may be what you meant), _runCallbacks only calls
cleanFailure on Failures which run into the end of the callback chain.  So
any Failure which is returned by a callback while there is an errback left
to be processed will not have cleanFailure called on it.

&gt;<i>
</I>&gt;<i>2. What do I want to do with it
</I>&gt;<i>
</I>&gt;<i>I want to pass the duck-typed traceback along with the exception type
</I>&gt;<i>and exception value to traceback.format_exception.
</I>&gt;<i>
</I>
Is it particularly important that the exception be formatted using that
particular function?  Failure.printTraceback() exists to deal with the
fact that Failure doesn't play nicely with the traceback module.

If you absolutely must go through format_exception, then I guess you can
create an object which is traceback-like enough for the traceback module.
It probably wouldn't even be /that/ tedious.  I don't have any particular
suggestions for doing this.  Traceback objects have some attributes, I
think you'll just need to make a class and give it some attributes (and
another for frames).

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047419.html">[Twisted-Python] Re: Making a duck-typed traceback from a Failure
</A></li>
	<LI>Next message (by thread): <A HREF="047421.html">[Twisted-Python] Re: Making a duck-typed traceback from a Failure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47420">[ date ]</a>
              <a href="thread.html#47420">[ thread ]</a>
              <a href="subject.html#47420">[ subject ]</a>
              <a href="author.html#47420">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
