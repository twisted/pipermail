<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Inline callbacks: generating the same Deferred at	multiple places
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Inline%20callbacks%3A%20generating%20the%20same%20Deferred%20at%0A%09multiple%20places&In-Reply-To=%3C51279155.1070709%40jaury.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059024.html">
   <LINK REL="Next"  HREF="059026.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Inline callbacks: generating the same Deferred at	multiple places</H1>
    <B>Pierre Jaury</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Inline%20callbacks%3A%20generating%20the%20same%20Deferred%20at%0A%09multiple%20places&In-Reply-To=%3C51279155.1070709%40jaury.eu%3E"
       TITLE="[Twisted-Python] Inline callbacks: generating the same Deferred at	multiple places">pierre at jaury.eu
       </A><BR>
    <I>Fri Feb 22 08:40:05 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059024.html">[Twisted-Python] Building a TCP server, having issues
</A></li>
        <LI>Next message (by thread): <A HREF="059026.html">[Twisted-Python] Inline callbacks: generating the same Deferred at multiple places
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59025">[ date ]</a>
              <a href="thread.html#59025">[ thread ]</a>
              <a href="subject.html#59025">[ subject ]</a>
              <a href="author.html#59025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey everyone,

First of all, I am a french developer mostly dealing with security
matters, I have been a Twisted enthusiast for a couple of years now and
have been hacking around with Twisted for the very last couple of months.

I am aware that Deferred-related classes are very stable nowadays and
that such a change does not stand half a chance to get anywhere. Anyway,
Twisted behavior kind of annoys me when it comes to inline callback
management.

Indeed, the gotResult function used when generating Deferred objects
from a function decorated with inlineCallbacks currently looks like:

            def gotResult(r):
                if waiting[0]:
                    waiting[0] = False
                    waiting[1] = r
                else:
                    _inlineCallbacks(r, g, deferred)

So far the function does not return anything explicitely, thus following
callbacks get a very nice `None` as first argument. This is not so
annoying when using inline callbacks with very simple and
straightforward cases as advised by Twisted documentation. Anyway, when
generating the same Deferred object from multiple
inlineCallbacks-decorated functions, one would expect every `yield`
statement to return the same value.

As a matter of fact, this is not the case (the first generation of the
Deferred object will return its actual current state but later
generations will return `None`). Because a Deferred object generation
from an inlineCallbacks-decorated function does not allow for anything
but waiting for the Deferred object to fire and returning its state, it
would probably not harm to forward this state to the next callback as
well. Something like:


            def gotResult(r):
                if waiting[0]:
                    waiting[0] = False
                    waiting[1] = r
                else:
                    _inlineCallbacks(r, g, deferred)
                return r

would probably do the trick and allow for complex scenarios where the
same Deferred object is generated multiple times by different functions
before being fired.

As I am not an accomplished Twisted hacker, I cannot say if this kind of
change would harm or break any code out there. Yet it seems to me that
according to inlineCallbacks behavior, it is very unlikely to have any
consequence at all but improving (extending at least) inlineCallbacks
behavior.

Am I so wrong? (I would very much like someone to point out the one huge
detail I completely forgot before I make this change by monkey patching
and submit a feature request :)

Regards,
Pierre.

-- 
Pierre Jaury &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">pierre at jaury.eu</A>&gt;
Weblog - <A HREF="http://kaiyou.fr">http://kaiyou.fr</A>
GPG ID - E804FB60

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: &lt;/pipermail/twisted-python/attachments/20130222/2e9aed4c/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059024.html">[Twisted-Python] Building a TCP server, having issues
</A></li>
	<LI>Next message (by thread): <A HREF="059026.html">[Twisted-Python] Inline callbacks: generating the same Deferred at multiple places
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59025">[ date ]</a>
              <a href="thread.html#59025">[ thread ]</a>
              <a href="subject.html#59025">[ subject ]</a>
              <a href="author.html#59025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
