<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Building a TCP server, having issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Building%20a%20TCP%20server%2C%20having%20issues&In-Reply-To=%3CCAO6nAyMxK4xiAt%3DjTARmy68ssa9dUFN-ReQXe%3DgoFTkGG%2BNLxA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059020.html">
   <LINK REL="Next"  HREF="059023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Building a TCP server, having issues</H1>
    <B>Adam Heller</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Building%20a%20TCP%20server%2C%20having%20issues&In-Reply-To=%3CCAO6nAyMxK4xiAt%3DjTARmy68ssa9dUFN-ReQXe%3DgoFTkGG%2BNLxA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Building a TCP server, having issues">sk82712 at gmail.com
       </A><BR>
    <I>Sat Feb 16 18:09:22 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059020.html">[Twisted-Python] Building a TCP server, having issues
</A></li>
        <LI>Next message (by thread): <A HREF="059023.html">[Twisted-Python] Building a TCP server, having issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59021">[ date ]</a>
              <a href="thread.html#59021">[ thread ]</a>
              <a href="subject.html#59021">[ subject ]</a>
              <a href="author.html#59021">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph,

I will definately look into that.  As far as the server spec, it's over TOR
(This part of the 'competition' has since closed, but feel free to catch
up: <A HREF="http://uncovering-cicada.wikia.com/wiki/Uncovering_Cicada_Wiki">http://uncovering-cicada.wikia.com/wiki/Uncovering_Cicada_Wiki</A> and
<A HREF="http://mentalfloss.com/article/31932/chasing-cicada-exploring-darkest-corridors-internet(from">http://mentalfloss.com/article/31932/chasing-cicada-exploring-darkest-corridors-internet(from</A>
last year's 3301).  I'm simply trying to do the python thing and move
classes around instead of trying to reinvent the wheel [dh() is a
rudimentary Diffie Helman key exchange] : &quot;

In the programming language of your choice build a TCP server
that implements the protocol below. The server code must be written by you
and you alone, although you are free to use any modules or libraries
publicly available for the selected programming language. Once you have
done this, make it accessible as a Tor hidden service. Then provide us with
the onion address and port via a GPG-encrypted email to this address. You
have until 0:00 UTC on 3 Feb, 2013. Any emails received after that time
will be ignored. Good luck. 3301
==================================================================== 1.
INTRODUCTION The TCP server MUST listen on an arbitrary port, and send and
receive plain text with lines separated by &lt;CRLF&gt; (representing a carriage
return followed by a line feed). The TCP server MUST disregard the case of
input. In the examples below, lines sent by the server will be preceded
with &quot;S:&quot; and lines sent by the client will be preceded by &quot;C:&quot; Each
message sent by the server MUST conform to the format: [CODE] [RESPONSE
NAME] [RESPONSE (optional)]&lt;CRLF&gt; Where [CODE] and [RESPONSE NAME] is one
of: CODE RESPONSE NAME 00 Welcome 01 Ok 02 Error 03 Data 99 Goodbye 2.
PROCEDURES a. Remote Connection Upon receiving a remote connection, the
server MUST greet the client with a 00 WELCOME message. The RESPONSE of a
welcome message MAY contain arbitrary text. The arbitrary text MUST at the
very least contain the name of the programming language used to implement
the server. Upon receiving a 00 WELCOME message, the client may begin
initiating procedures. Example: S: 00 WELCOME [ARBITRARY RESPONSE
TEXT]&lt;CRLF&gt; b. RAND [n] Upon receiving a &quot;RAND&quot; request by the client, the
server will first send a 01 OK response, and will then provide the client
with [n] cryptographically random numbers within the range of 0-255. Each
number MUST be followed by &lt;CRLF&gt;. After the last number has been sent, the
server MUST send a dot (.) on a line by itself. Example: C: RAND 3&lt;CRLF&gt; S:
01 OK&lt;CRLF&gt; S: [first random number]&lt;CRLF&gt; S: [second random number]&lt;CRLF&gt;
S: [third random number]&lt;CRLF&gt; S: .&lt;CRLF&gt; c. QUINE Upon receiving a &quot;QUINE&quot;
request by the client, the server will first send a 01 OK response, and
will then provide the client with a quine in the programming language used
to implement the server. This quine does not have to be original. After the
last line of code has been sent, the server MUST send a dot (.) on a line
by itself. Example: C: QUINE&lt;CRLF&gt; S: 01 OK&lt;CRLF&gt; S: [quine code]&lt;CRLF&gt; S:
.&lt;CRLF&gt; d. BASE29 [n] Upon receiving a &quot;BASE29&quot; request by the client, the
server will send a 01 OK response followed by the number [n] converted into
its base 29 representation. Example: C: BASE29 3301&lt;CRLF&gt; S: 01 OK
3QO&lt;CRLF&gt; e. CODE Upon receiving a &quot;CODE&quot; request by the client, the server
will send a 01 OK response followed by its own source code. After the last
line of code has been sent, the server MUST send a dot(.) on a line by
itself. Example: C: CODE&lt;CRLF&gt; S: 01 OK&lt;CRLF&gt; S: [Server Source Code]&lt;CRLF&gt;
s: .&lt;CRLF&gt; f. KOAN Upon receiving a &quot;KOAN&quot; request by the client, the
server will send a 01 OK response followed by a koan. After the last line
of the koan, the server MUST send a dot (.) on a line by itself. Example:
C: KOAN&lt;CRLF&gt; S: 01 OK&lt;CRLF&gt; S: A master who lived as a hermit on a
mountain was asked by a&lt;CRLF&gt; S: monk, &quot;What is the Way?&lt;CRLF&gt; S: &quot;What a
fine mountain this is,&quot; the master said in reply&lt;CRLF&gt; S: &quot;I am not asking
you about the mountain, but about the Way.&lt;CRLF&gt; S: &quot;So long as you cannot
go beyond the mountain, my son, you&lt;CRLF&gt; S: cannot reach the Way,&quot; replied
the master&lt;CRLF&gt; S: . g. DH [p] Upon receiving a &quot;DH&quot; request by the
client, the server will proceed to perform a Diffie-Hellman key exchange
using [p] as the prime modulus. The server will then select a base [b] to
use in the protocol, as well as its secret integer. The server will then
compute its exponent result [e] as specified within the Diffie-Hellman key
exchange protocol. The server MUST then respond with a 01 OK response
followed by the selected base [b] and computed exponent [e] separated by
white space. The client MUST respond with its exponent result [e2], and the
client and server will follow the rest of the Diffie-Hellman key exchange
protocol. The server MUST then compute the resulting secret key, and
provide it using 03 DATA [k]. Example: C: DH 23&lt;CRLF&gt; S: 01 OK 5 8&lt;CRLF&gt; C:
19&lt;CRLF&gt; S: 03 DATA 2&lt;CRLF&gt; j. NEXT Upon receiving a &quot;NEXT&quot; request by the
client, the server will respond with 01 OK and then listen for text data to
be provided by the client. The client will send a dot (.) on a line by
itself after the last line of text. The server MUST record this. This data
will be the next set of instructions. Once the data is received the server
will respond with 01 OK. Example: C: NEXT&lt;CRLF&gt; S: 01 OK&lt;CRLF&gt; C:
-----BEGIN PGP SIGNED MESSAGE-----&lt;CRLF&gt; C: [MESSAGE CONTENTS]&lt;CRLF&gt; C:
-----END PGP SIGNATURE-----&lt;CRLF&gt; C: .&lt;CRLF&gt; S: 01 OK&lt;CRLF&gt; i. GOODBYE Upon
receiving a &quot;DH&quot; request by the client, the server MUST respond with 99
GOODBYE and then gracefully close the connection. Example: C: GOODBYE&lt;CRLF&gt;
S: 99 GOODBYE&lt;CRLF&gt;
====================================================================&quot;


&gt;<i>From a signed GPG message.
</I>

On Sat, Feb 16, 2013 at 11:53 PM, Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On Feb 16, 2013, at 1:09 PM, Adam Heller &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sk82712 at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Guys,
</I>&gt;<i> I'll try to be as exact as I can be with my question, but it may end up
</I>&gt;<i> being pretty broad. (I'm also relatively new to python, please go easy on
</I>&gt;<i> my code although suggestions are of course welcome.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The main suggestion is &quot;you can't parse TCP like this&quot; :).  You'll have
</I>&gt;<i> this problem: &lt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#Whyisprotocol.dataReceivedcalledwithonlypartofthedataIcalledtransport.writewith">http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#Whyisprotocol.dataReceivedcalledwithonlypartofthedataIcalledtransport.writewith</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> The issue I'm running into:
</I>&gt;<i> When a user connects to the TCP server, they are displayed a welcome menu
</I>&gt;<i> of things they can do. I'm simply catching the 'data' in an if statement to
</I>&gt;<i> determine which menu item was picked.  The problem is that some of the menu
</I>&gt;<i> items require further input.  I've had to use a series of bools to
</I>&gt;<i> determine if a certain menu option was previously picked that will then
</I>&gt;<i> directly send the data into the function / class.  Is there an easier way
</I>&gt;<i> to go about this? My current method seems a bit backwards and over
</I>&gt;<i> complicated.  I'm thinking I missed something in the documentation.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Anyway, here's the code: <A HREF="https://infotomb.com/q4293">https://infotomb.com/q4293</A> // Pass: twisted
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You should really attach the code itself to the email, so that future
</I>&gt;<i> readers of the archive have some idea what you're talking about.  Pastebins
</I>&gt;<i> in general are not great, since the code will expire before your archived
</I>&gt;<i> message does, and pastebins with passwords (!?) are even worse.
</I>&gt;<i>
</I>&gt;<i> (it was part of a challenge, so to speak, don't take too much out of
</I>&gt;<i> context)
</I>&gt;<i>
</I>&gt;<i> You can see I had trouble with next() and dh().  I'm now trying to move
</I>&gt;<i> this TCP 'framework' over to another project (the above was already
</I>&gt;<i> submitted), and I'm still running into the same issues.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You should try separating out your concerns a bit.  The protocol should
</I>&gt;<i> just parse the bytes into something meaningful, then call methods on some
</I>&gt;<i> other, higher-level object that isn't just manipulating strings.
</I>&gt;<i>
</I>&gt;<i> The &quot;other, higher-level object&quot; in your case might be a state machine of
</I>&gt;<i> some kind, or you might just have an object representing the mode that
</I>&gt;<i> you're currently in and switch that out for different modes.
</I>&gt;<i>
</I>&gt;<i> This isn't an issue with Twisted though; Twisted just calls some methods
</I>&gt;<i> on your objects in order to tell you what happened; what happens next is up
</I>&gt;<i> to you.  So it's a general program architecture issue.
</I>&gt;<i>
</I>&gt;<i> This is very general advice, obviously, because I'm not sure what you are
</I>&gt;<i> specifically asking, nor what your program is really intended to do.  What
</I>&gt;<i> kind of client is talking to this system?  Did you invent the protocol
</I>&gt;<i> yourself, or did it come from somewhere else?  What is 'dh()' even trying
</I>&gt;<i> to accomplish?  Etc, etc.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -glyph
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130217/97c3f65c/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059020.html">[Twisted-Python] Building a TCP server, having issues
</A></li>
	<LI>Next message (by thread): <A HREF="059023.html">[Twisted-Python] Building a TCP server, having issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59021">[ date ]</a>
              <a href="thread.html#59021">[ thread ]</a>
              <a href="subject.html#59021">[ subject ]</a>
              <a href="author.html#59021">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
