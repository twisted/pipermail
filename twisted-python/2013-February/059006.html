<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] TaskStopped error, unsure of the cause and solution
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20TaskStopped%20error%2C%0A%20unsure%20of%20the%20cause%20and%20solution&In-Reply-To=%3C20130208190326.3816.1016959687.divmod.xquotient.99%40localhost6.localdomain6%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059005.html">
   <LINK REL="Next"  HREF="059017.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] TaskStopped error, unsure of the cause and solution</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20TaskStopped%20error%2C%0A%20unsure%20of%20the%20cause%20and%20solution&In-Reply-To=%3C20130208190326.3816.1016959687.divmod.xquotient.99%40localhost6.localdomain6%3E"
       TITLE="[Twisted-Python] TaskStopped error, unsure of the cause and solution">exarkun at twistedmatrix.com
       </A><BR>
    <I>Fri Feb  8 12:03:26 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059005.html">[Twisted-Python] TaskStopped error,	unsure of the cause and solution
</A></li>
        <LI>Next message (by thread): <A HREF="059017.html">[Twisted-Python] TaskStopped error,	unsure of the cause and solution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59006">[ date ]</a>
              <a href="thread.html#59006">[ thread ]</a>
              <a href="subject.html#59006">[ subject ]</a>
              <a href="author.html#59006">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03:12 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">poalman at gmail.com</A> wrote:
&gt;<i>
</I>&gt;<i>I've still not been able to reproduce this on demand.. the least
</I>&gt;<i>amount of request I've seen before getting the error is 6500 :/
</I>&gt;<i>
</I>&gt;<i>I've also seen this stack trace which I didn't notice before
</I>&gt;<i>
</I>&gt;<i>2013-02-08 10:07:28+0000 [HTTP11ClientProtocol,client] Unhandled Error
</I>&gt;<i>        Traceback (most recent call last):
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/application/app.py&quot;,
</I>&gt;<i>line 323, in runReactorWithLogging
</I>&gt;<i>            reactor.run()
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/base.py&quot;,
</I>&gt;<i>line 1169, in run
</I>&gt;<i>            self.mainLoop()
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/base.py&quot;,
</I>&gt;<i>line 1181, in mainLoop
</I>&gt;<i>            self.doIteration(t)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/epollreactor.py&quot;,
</I>&gt;<i>line 379, in doPoll
</I>&gt;<i>            log.callWithLogger(selectable, _drdw, selectable, fd, event)
</I>&gt;<i>        --- &lt;exception caught here&gt; ---
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux-x86_64.egg/twisted/python/log.py&quot;,
</I>&gt;<i>line 84, in callWithLogger
</I>&gt;<i>            return callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux-x86_64.egg/twisted/python/log.py&quot;,
</I>&gt;<i>line 69, in callWithContext
</I>&gt;<i>            return context.call({ILogContext: newCtx}, func, *args, 
</I>&gt;<i>**kw)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/python/context.py&quot;,
</I>&gt;<i>line 118, in callWithContext
</I>&gt;<i>            return self.currentContext().callWithContext(ctx, func, 
</I>&gt;<i>*args, **kw)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/python/context.py&quot;,
</I>&gt;<i>line 81, in callWithContext
</I>&gt;<i>            return func(*args,**kw)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/posixbase.py&quot;,
</I>&gt;<i>line 639, in _doReadOrWrite
</I>&gt;<i>            self._disconnectSelectable(selectable, why, inRead)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/posixbase.py&quot;,
</I>&gt;<i>line 258, in _disconnectSelectable
</I>&gt;<i>            selectable.readConnectionLost(f)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/tcp.py&quot;,
</I>&gt;<i>line 267, in readConnectionLost
</I>&gt;<i>            self.connectionLost(reason)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/tcp.py&quot;,
</I>&gt;<i>line 473, in connectionLost
</I>&gt;<i>            self._commonConnection.connectionLost(self, reason)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/tcp.py&quot;,
</I>&gt;<i>line 281, in connectionLost
</I>&gt;<i>abstract.FileDescriptor.connectionLost(self, reason)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/abstract.py&quot;,
</I>&gt;<i>line 182, in connectionLost            self.producer.stopProducing()
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux-x86_64.egg/twisted/web/client.py&quot;,
</I>&gt;<i>line 760, in stopProducing            self._task.stop()
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/task.py&quot;,
</I>&gt;<i>line 460, in stop            self._completeWith(TaskStopped(),
</I>&gt;<i>Failure(TaskStopped()))
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/task.py&quot;,
</I>&gt;<i>line 439, in _completeWith
</I>&gt;<i>self._cooperator._removeTask(self)
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/task.py&quot;,
</I>&gt;<i>line 578, in _removeTask            self._delayedCall.cancel()
</I>&gt;<i>          File &quot;/usr/local/lib/python2.7/dist- 
</I>&gt;<i>packages/Twisted-12.2.0-py2.7-linux- 
</I>&gt;<i>x86_64.egg/twisted/internet/base.py&quot;,
</I>&gt;<i>line 89, in cancel
</I>&gt;<i>            raise error.AlreadyCalled
</I>&gt;<i>        twisted.internet.error.AlreadyCalled: Tried to cancel an
</I>&gt;<i>already-called event.
</I>&gt;<i>
</I>&gt;<i>I'll keep trying to work out the issue, any suggestions on what I
</I>&gt;<i>might try to reproduce it or guesses at causes?
</I>
Since it seems to be related to handling of lost connections, you may be 
able to reproduce it more easily if you issue your requests to an HTTP 
server which drops connections more often.  Presumably the production 
service you're issuing requests too tries pretty hard to properly serve 
responses to every request.  If you point `Agent` at a worse HTTP server 
(eg, one you write using twisted.web and implement to close connections 
prematurely at various points during the response) this may produce the 
issue more quickly.

You could also try hooking `Agent` up to one of the in-memory 
reactors/transports.  The advantage of this is that it will be much 
easier to &quot;close&quot; the connection at a specific point 
(deterministically).  The disadvantage is that the in-memory 
reactor/transport may not exactly replicate the real reactor/transport 
behavior and so fail to reproduce the issue entirely.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059005.html">[Twisted-Python] TaskStopped error,	unsure of the cause and solution
</A></li>
	<LI>Next message (by thread): <A HREF="059017.html">[Twisted-Python] TaskStopped error,	unsure of the cause and solution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59006">[ date ]</a>
              <a href="thread.html#59006">[ thread ]</a>
              <a href="subject.html#59006">[ subject ]</a>
              <a href="author.html#59006">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
