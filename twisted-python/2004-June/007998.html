<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adbapi,adodbapi and pythoncom.CoInitialize()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%2Cadodbapi%20and%20pythoncom.CoInitialize%28%29&In-Reply-To=E1Ba1B3-00077G-00%40pub.coot.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007997.html">
   <LINK REL="Next"  HREF="007999.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adbapi,adodbapi and pythoncom.CoInitialize()</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%2Cadodbapi%20and%20pythoncom.CoInitialize%28%29&In-Reply-To=E1Ba1B3-00077G-00%40pub.coot.net"
       TITLE="[Twisted-Python] adbapi,adodbapi and pythoncom.CoInitialize()">andrew-twisted at puzzling.org
       </A><BR>
    <I>Mon Jun 14 20:11:15 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007997.html">[Twisted-Python] adbapi,adodbapi and pythoncom.CoInitialize()
</A></li>
        <LI>Next message: <A HREF="007999.html">[Twisted-Python] adbapi,adodbapi and pythoncom.CoInitialize()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7998">[ date ]</a>
              <a href="thread.html#7998">[ thread ]</a>
              <a href="subject.html#7998">[ subject ]</a>
              <a href="author.html#7998">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jun 14, 2004 at 05:47:45PM -0600, Craig H. Anderson wrote:
&gt;<i> 
</I>&gt;<i> I would like to use adbapi with the com based adodbapi.
</I>&gt;<i> I found that the connect call hangs unless I add a call
</I>&gt;<i> to pythoncom.CoInitialize(). 
</I>
That doesn't surprise me, seeing as adbapi runs stuff in threads to make it
asynchronous, and COM requires each thread that uses COM stuff to be
CoInitialize()d.

I'm not sure how to cleanly arrange for that to happen, though.  Perhaps
something like:

----
import pythoncom
from twisted.python import threadpool
from twisted.enterprise import adbapi

class COMThreadPool(threadpool.ThreadPool):
    def _worker(self, o):
        pythoncom.CoInitialize()
        threadpool.ThreadPool._worker(o)
        pythoncom.CoUninitialize()

class COMConnectionPool(adbapi.ConnectionPool):
    def __init__(self, dbapiName, *args, **kwargs):
        adbapi.ConnectionPool.__init__(self, dbapiName, *args, **kwargs)
        self.threadpool = COMThreadPool(self.min, self.max)
----

Then use COMConnectionPool rather than adbapi.ConnectionPool.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007997.html">[Twisted-Python] adbapi,adodbapi and pythoncom.CoInitialize()
</A></li>
	<LI>Next message: <A HREF="007999.html">[Twisted-Python] adbapi,adodbapi and pythoncom.CoInitialize()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7998">[ date ]</a>
              <a href="thread.html#7998">[ thread ]</a>
              <a href="subject.html#7998">[ subject ]</a>
              <a href="author.html#7998">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
