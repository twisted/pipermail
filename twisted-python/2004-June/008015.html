<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Refactoring of trial - call for	feature	requests and suggestions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Refactoring%20of%20trial%20-%20call%20for%0A%09feature%09requests%20and%20suggestions&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008039.html">
   <LINK REL="Next"  HREF="008020.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Refactoring of trial - call for	feature	requests and suggestions</H1>
    <B>David Bolen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Refactoring%20of%20trial%20-%20call%20for%0A%09feature%09requests%20and%20suggestions&In-Reply-To="
       TITLE="[Twisted-Python] Re: Refactoring of trial - call for	feature	requests and suggestions">db3l at fitlinxx.com
       </A><BR>
    <I>Wed Jun 16 14:34:31 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008039.html">[Twisted-Python] Re: Refactoring of trial - call for feature	requests and suggestions
</A></li>
        <LI>Next message: <A HREF="008020.html">[Twisted-Python] Refactoring of trial - call for feature requests	and suggestions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8015">[ date ]</a>
              <a href="thread.html#8015">[ thread ]</a>
              <a href="subject.html#8015">[ subject ]</a>
              <a href="author.html#8015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph Lefkowitz &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>&gt; writes:

&gt;<i> There are multiple, parallel issues here :).  First is that the reactor
</I>&gt;<i> needs a genuine make-sure-i'm-cleaned-up function.  The current usage of
</I>&gt;<i> iterate() has its roots in the fact that shutdown is (used to be?)
</I>&gt;<i> horribly buggy and slightly destructive - if memory serves, the original
</I>&gt;<i> problem was that the threadpool was destroyed and could not be
</I>&gt;<i> re-created properly.
</I>
A general cleanup function would be much appreciated, as clearly our
biggest problem with tests involving the reactor has been the proper
cleanup.  While I can clean up pending delayed calls with an API call,
I've had to cheat and reach into the reactor to flush out pending
shutdown events during tests of modules that make use of them.

But to be honest, even better than a cleanup function would be the
ability to truly re-create/re-start the reactor.  It's always bothered
me that while everything else about the unit tests for my application
are fully independent (each test sets up and tears down everything it
needs), that the reactor is a persistence across tests.  It's led to a
few subtle issues in the tests that wouldn't have been there if each
test just created its own reactor.  Of course, this might be an ugly
change because of the way reactor instantiation right now is tied into
the import mechanism, rather than through an explicit API
initialization call.

&gt;<i> Second is that we shouldn't be waiting on deferreds in test code any
</I>&gt;<i> more than we should be waiting on deferreds in real code.  The different
</I>&gt;<i> approaches to waiting on deferreds currently mean there are still lots
</I>&gt;<i> of places the tests can hang.  With a more unified approach, we could
</I>&gt;<i> insert default timeouts on ALL tests more easily, and avoid loops that
</I>&gt;<i> wait for multiple deferreds by using, e.g. DeferredList.
</I>
Coming from the perspective of someone that uses deferredResult/Error a lot
in testing my application (not twisted's own tests), I will say that they
have a very desirable characteristic of permitting tests to be written in
a more classic linear flow (no callbacks) while properly testing code that
is using deferreds under the covers.  Since tests by their nature tend to be
focused on a very specific and narrow corridor of behavior, it's pretty
rare not to be able to turn individual deferrable operations into blocking
ones while still testing precisely what you want to test.

I have a feeling that even if various reactor changes were made to
make it more test friendly, I'd still try to find some form of
mechanism that let me wait on individual deferrable operations to
provide the increased readability of the tests.  Of course, I wouldn't
care if that just means that deferredResult just becomes the wrapper
that delays until the callback happens, but doesn't have to use
iterate(), nor would I object to having a timeout on such blocking
wrappers, to avoid hanging a test.

But I do think that writing most of my tests with actual callbacks
would end up obfuscating them more than clarifying, without (IMHO) any
real significant improvement in the reality of what was being tested.

-- David



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008039.html">[Twisted-Python] Re: Refactoring of trial - call for feature	requests and suggestions
</A></li>
	<LI>Next message: <A HREF="008020.html">[Twisted-Python] Refactoring of trial - call for feature requests	and suggestions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8015">[ date ]</a>
              <a href="thread.html#8015">[ thread ]</a>
              <a href="subject.html#8015">[ subject ]</a>
              <a href="author.html#8015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
