<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] mapped resultsets for adbapi:  &quot;runQueryMapped&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20mapped%20resultsets%20for%20adbapi%3A%20%20%22runQueryMapped%22&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007966.html">
   <LINK REL="Next"  HREF="007968.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] mapped resultsets for adbapi:  &quot;runQueryMapped&quot;</H1>
    <B>Stephen Waterbury</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20mapped%20resultsets%20for%20adbapi%3A%20%20%22runQueryMapped%22&In-Reply-To="
       TITLE="[Twisted-Python] mapped resultsets for adbapi:  &quot;runQueryMapped&quot;">golux at comcast.net
       </A><BR>
    <I>Fri Jun  4 02:33:34 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007966.html">[Twisted-Python] What does the LGPL mean in terms of python?
</A></li>
        <LI>Next message: <A HREF="007968.html">[Twisted-Python] mapped resultsets for adbapi: &quot;runQueryMapped&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7967">[ date ]</a>
              <a href="thread.html#7967">[ thread ]</a>
              <a href="subject.html#7967">[ subject ]</a>
              <a href="author.html#7967">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gang,

I don't know whether this is of interest to anyone else, but
I needed it for my stuff and I was hoping it might be suitable for
inclusion in adbapi:  it defines a new adbapi.ConnectionPool method
called 'runQueryMapped' (and corresponding '_runQueryMapped') whose
return value is a list of dicts that map column names to values
(rather than the list of lists of values that runQuery returns).

Attached are patches for adbapi.py and test_enterprise.py.

Pros:

* shouldn't break any existing code, as it is a completely separate
  method from runQuery and _runQuery.

* portable, should work with any DBAPI-conforming adaptor, since it
  builds the dictionaries from the cursor.description, which is part
  of the DBAPI spec.  The reason I needed to do this inside of adbapi
  is that adbapi doesn't expose cursor.description ... which is fine,
  as it seems cleaner to keep it inside adbapi anyway.

* unit test included (I've only run the test against SQLite, pyPgSQL,
  and psycopg, as I don't have the others installed on my machine).

Cons:

* only one I can think of is that it's unnecessary if you are using
  either reflector, which I'm not, or pyPgSQL's 'PgResultSet' attributes
  based on the cursor's column names, which I was but am not any more,
  since that is not portable and not part of the DBAPI spec.  While
  modifying my code to work with other backends (esp. psycopg and
  sqlite), I came up with this.

If it's decided not to include it, that's okay, I'll just keep patching
my Twisted source.  It's also fine if you want to name it something
else.  :)

Cheers,
Steve
-------------- next part --------------
A non-text attachment was scrubbed...
Name: adbapi.patch
Type: text/x-patch
Size: 1388 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20040604/83ec0bbd/attachment.bin">http://twistedmatrix.com/pipermail/twisted-python/attachments/20040604/83ec0bbd/attachment.bin</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test_enterprise.patch
Type: text/x-patch
Size: 3617 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20040604/83ec0bbd/attachment-0001.bin">http://twistedmatrix.com/pipermail/twisted-python/attachments/20040604/83ec0bbd/attachment-0001.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007966.html">[Twisted-Python] What does the LGPL mean in terms of python?
</A></li>
	<LI>Next message: <A HREF="007968.html">[Twisted-Python] mapped resultsets for adbapi: &quot;runQueryMapped&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7967">[ date ]</a>
              <a href="thread.html#7967">[ thread ]</a>
              <a href="subject.html#7967">[ subject ]</a>
              <a href="author.html#7967">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
