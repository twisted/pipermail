<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY and	RealDictCursor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20adbapi%20/%20Postgres%20%3A%20LISTEN/NOTIFY%20and%0A%09RealDictCursor&In-Reply-To=%3C634914A010D0B943A035D226786325D42D0C0CDDC6%40EXVMBX020-12.exch020.serverdata.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057340.html">
   <LINK REL="Next"  HREF="057268.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY and	RealDictCursor</H1>
    <B>Tobias Oberstein</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20adbapi%20/%20Postgres%20%3A%20LISTEN/NOTIFY%20and%0A%09RealDictCursor&In-Reply-To=%3C634914A010D0B943A035D226786325D42D0C0CDDC6%40EXVMBX020-12.exch020.serverdata.net%3E"
       TITLE="[Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY and	RealDictCursor">tobias.oberstein at tavendo.de
       </A><BR>
    <I>Thu Nov  3 11:33:24 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057340.html">[Twisted-Python] Second pre-release of Twisted 11.1.0
</A></li>
        <LI>Next message (by thread): <A HREF="057268.html">[Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY	and	RealDictCursor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57267">[ date ]</a>
              <a href="thread.html#57267">[ thread ]</a>
              <a href="subject.html#57267">[ subject ]</a>
              <a href="author.html#57267">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am using Twisted adbapi, psycopg2 and PostgreSQL which works really great.

Now, there are 2 features I'd like to use in this context, which I've been
using before without Twisted.

I'm missing those.

Would be glad for any hints ..

If there is work to do to make those features happen, and it's doable for
non-Twisted-gods, then I'd also be willing to invest time/effort ...

Thanks,
Tobias



LISTEN/NOTIFY
============

Is a Postgres&gt;=9 feature which allows one to asynchronously notify a database client
from _within_ the database (i.e. from pgPLSQL).

<A HREF="http://www.postgresql.org/docs/9.1/static/sql-notify.html">http://www.postgresql.org/docs/9.1/static/sql-notify.html</A>
<A HREF="http://initd.org/psycopg/docs/advanced.html#asynchronous-notifications">http://initd.org/psycopg/docs/advanced.html#asynchronous-notifications</A>

On the Python side, it'll do a select() on the TCP underlying the connection to Postgres.

adbapi assumes DBAPI, and above is a non-standard extension.

Now, what would be a sensible approach to use that with Twisted?

Own thread?
How do I integrate that into a standard Twisted application service hierarchy?
Or somehow extend adbapi?


psycopg2.extras.RealDictCursor
========================

We have a convention that all database access must be exclusively via
stored procedures with all IN and all OUT parameters named.

Outside the context of Twisted, we use that in conjunction with

# Real Dict Cursor (returns a Dict which can be referenced via named bracket access, or offset)

dict_cursor = db.cursor(cursor_factory = psycopg2.extras.RealDictCursor)
dict_cursor.execute(&quot;SELECT first_name, last_name, email FROM user.get_user(%s)&quot;, (user_id,))
my_row = dict_cursor.fetchone()

=&gt;

{'first_name': 'John', 'last_name': 'Doe', 'email': '<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">john at doe.com</A>'}

Is there a way to do something like this when using

self.dbpool.runInteraction

or otherwise?

Setting the &quot;cursor factory&quot; to be used?

On the other hand, the txn given to the fun provided with runInteraction already is somehow dressed up, right?



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057340.html">[Twisted-Python] Second pre-release of Twisted 11.1.0
</A></li>
	<LI>Next message (by thread): <A HREF="057268.html">[Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY	and	RealDictCursor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57267">[ date ]</a>
              <a href="thread.html#57267">[ thread ]</a>
              <a href="subject.html#57267">[ subject ]</a>
              <a href="author.html#57267">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
