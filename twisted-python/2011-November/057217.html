<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Global reactor unit tests in the Twisted test	suite
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Global%20reactor%20unit%20tests%20in%20the%20Twisted%20test%0A%09suite&In-Reply-To=%3CCALiqSLdOpCmWNkkF78NoVaBY3G-h7XTfceJC8Mxx55jLAZw8DA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057216.html">
   <LINK REL="Next"  HREF="057218.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Global reactor unit tests in the Twisted test	suite</H1>
    <B>Corbin Simpson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Global%20reactor%20unit%20tests%20in%20the%20Twisted%20test%0A%09suite&In-Reply-To=%3CCALiqSLdOpCmWNkkF78NoVaBY3G-h7XTfceJC8Mxx55jLAZw8DA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Global reactor unit tests in the Twisted test	suite">mostawesomedude at gmail.com
       </A><BR>
    <I>Tue Nov  1 11:23:05 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057216.html">[Twisted-Python] Global reactor unit tests in the Twisted test suite
</A></li>
        <LI>Next message (by thread): <A HREF="057218.html">[Twisted-Python] Global reactor unit tests in the Twisted test suite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57217">[ date ]</a>
              <a href="thread.html#57217">[ thread ]</a>
              <a href="subject.html#57217">[ subject ]</a>
              <a href="author.html#57217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Nov 1, 2011 at 10:06 AM, Phil Mayers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">p.mayers at imperial.ac.uk</A>&gt; wrote:
&gt;<i> On 01/11/11 16:58, Itamar Turner-Trauring wrote:
</I>&gt;&gt;&gt;<i> I find the &quot;pass reactor as 1st argument to everything&quot; API pattern
</I>&gt;&gt;&gt;<i> messy. I'm sure there's a good reason. What is it?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. Supporting multiple reactors.
</I>&gt;<i>
</I>&gt;<i> Interesting. I had assumed that was a &quot;never on the cards&quot; option. Would
</I>&gt;<i> it be possible to &quot;nest&quot; the reactors, or would they have to run in
</I>&gt;<i> separate threads? Or is this speculative?
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2. Unit testing: if you have an explicit object, you can replace it more
</I>&gt;&gt;<i> easily with a fake.
</I>&gt;<i>
</I>&gt;<i> Ok. I realise it's a bit late in the day at this point, but I do wonder
</I>&gt;<i> if something like:
</I>&gt;<i>
</I>&gt;<i> def method(arg, reactor=DefaultReactor):
</I>&gt;<i> Â  ...
</I>&gt;<i>
</I>&gt;<i> ...with DefaultReactor being some kind of lazy singleton or weak
</I>&gt;<i> reference might not have been a more friendly pattern to API users.
</I>&gt;<i>
</I>&gt;<i> As it is, I might bind a keystroke to &quot;reactor, &quot; ;o)
</I>
Singletons are an anti-pattern. Because the reactor is a singleton:

* We can't have multiple reactors instantiated
* We can't restart reactors
* We can't isolate certain reactor-dependent unit tests
* We have to install reactors, which requires careful ordering of imports

In Bravo, Exocet is used to set up a pseudo-sandbox. If reactor were
not a singleton, I could isolate people's usage of Twisted calls, and
force them to proxy everything. Instead, I have to grant them access
to the reactor, because it's shared global state. Is this horribly
important? No, but it does prohibit more effective sandboxing and
isolation.

Exocet needs to keep a list of modules which are so fucked that they
must be allowed to touch sys.modules to work correctly. There are two
things in that list: os.path and twisted.internet.reactor. Also, the
reactor only works if it's imported before Exocet. While Exocet's not
exactly a bastion of sanity, this doesn't speak well of the magic that
the reactor goes through in order to advertise itself globally.

Those are my reasons. They're not superb reasons from a
getting-shit-done point of view, but from a reducing-cyclopean-horrors
point of view, I think they're worth considering.

~ C.

-- 
When the facts change, I change my mind. What do you do, sir? ~ Keynes

Corbin Simpson
&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">MostAwesomeDude at gmail.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057216.html">[Twisted-Python] Global reactor unit tests in the Twisted test suite
</A></li>
	<LI>Next message (by thread): <A HREF="057218.html">[Twisted-Python] Global reactor unit tests in the Twisted test suite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57217">[ date ]</a>
              <a href="thread.html#57217">[ thread ]</a>
              <a href="subject.html#57217">[ subject ]</a>
              <a href="author.html#57217">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
