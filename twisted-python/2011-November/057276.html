<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adbapi / Postgres :	LISTEN/NOTIFY	and	RealDictCursor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20adbapi%20/%20Postgres%20%3A%0A%09LISTEN/NOTIFY%09and%09RealDictCursor&In-Reply-To=%3C634914A010D0B943A035D226786325D42D0C0CDFCF%40EXVMBX020-12.exch020.serverdata.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057274.html">
   <LINK REL="Next"  HREF="057277.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adbapi / Postgres :	LISTEN/NOTIFY	and	RealDictCursor</H1>
    <B>Tobias Oberstein</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20adbapi%20/%20Postgres%20%3A%0A%09LISTEN/NOTIFY%09and%09RealDictCursor&In-Reply-To=%3C634914A010D0B943A035D226786325D42D0C0CDFCF%40EXVMBX020-12.exch020.serverdata.net%3E"
       TITLE="[Twisted-Python] adbapi / Postgres :	LISTEN/NOTIFY	and	RealDictCursor">tobias.oberstein at tavendo.de
       </A><BR>
    <I>Thu Nov  3 17:40:04 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057274.html">[Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY	and	RealDictCursor
</A></li>
        <LI>Next message (by thread): <A HREF="057277.html">[Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY	and	RealDictCursor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57276">[ date ]</a>
              <a href="thread.html#57276">[ thread ]</a>
              <a href="subject.html#57276">[ subject ]</a>
              <a href="author.html#57276">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Glyph,

thank's a lot for this advice! I thought I would have done right, and Twisted-style .. but the select FD trap wasn't on my radar.


The <A HREF="https://github.com/wulczer/txpostgres">https://github.com/wulczer/txpostgres</A> is very interesting. Guess I need to learn about interfaces.IReadWriteDescriptor
first to grasp it.

Regarding the broader picture: I cannot say I understand what you say completely.

&quot; maximum file descriptor pollable by select()&quot;

Is this *nix in general?

Does that only apply to select.select?

Or also: select.poll(), select.epoll(), select.kqueue() ?

How would implementing an IReadDescriptor circumvent the problem? By not using select(), but poll/epoll/kqeue?

In any case: we're running FreeBSD, so epoll() is out.

Is there even a kqueue-based Twisted reactor?

Sorry if helping me spawns new questions,

Thanks!
Tobias


for reference (don't know if it applies here):
psycopg since v2.2 has
<A HREF="http://initd.org/psycopg/docs/advanced.html#asynchronous-support">http://initd.org/psycopg/docs/advanced.html#asynchronous-support</A>


Von: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] Im Auftrag von Glyph
Gesendet: Donnerstag, 3. November 2011 23:54
An: Twisted general discussion
Betreff: Re: [Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY and RealDictCursor

On Nov 3, 2011, at 6:18 PM, Tobias Oberstein wrote:


     while not self.stopped:
        if select.select([conn], [], [], self.timeout) == ([], [], []):
           pass


Please note that on high-volume servers, this is problematic, as 'conn' may be higher than the maximum file descriptor pollable by select().  So if you've tuned everything to be smart, use a high-volume reactor like epoll, and set all your ulimits correctly, you will still get tracebacks out of this code depending on random accidents of ordering.

This part of the logic might therefore be better implemented as a IReadDescriptor/IWriteDescriptor provider (i.e. a subclass of FileDescriptor), assuming you can ask your postgres binding to give you non-blocking reads and writes.  You're certainly not the first person to make this mistake though, &lt;<A HREF="http://divillo.com/">http://divillo.com/</A>&gt; gives the same advice :).

Also this would probably make a better patch for txpostgres &lt;<A HREF="https://launchpad.net/txpostgres">https://launchpad.net/txpostgres</A>&gt; than for Twisted itself, since support depends on specific database bindings.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20111103/7cb53792/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057274.html">[Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY	and	RealDictCursor
</A></li>
	<LI>Next message (by thread): <A HREF="057277.html">[Twisted-Python] adbapi / Postgres : LISTEN/NOTIFY	and	RealDictCursor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57276">[ date ]</a>
              <a href="thread.html#57276">[ thread ]</a>
              <a href="subject.html#57276">[ subject ]</a>
              <a href="author.html#57276">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
