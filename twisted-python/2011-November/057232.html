<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Global reactor unit tests in the Twisted test	suite
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Global%20reactor%20unit%20tests%20in%20the%20Twisted%20test%0A%09suite&In-Reply-To=%3C7214F82C-8EEC-469D-B289-5BD5C3871196%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057231.html">
   <LINK REL="Next"  HREF="057307.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Global reactor unit tests in the Twisted test	suite</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Global%20reactor%20unit%20tests%20in%20the%20Twisted%20test%0A%09suite&In-Reply-To=%3C7214F82C-8EEC-469D-B289-5BD5C3871196%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Global reactor unit tests in the Twisted test	suite">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Nov  1 21:18:12 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057231.html">[Twisted-Python] Global reactor unit tests in the Twisted test suite
</A></li>
        <LI>Next message (by thread): <A HREF="057307.html">[Twisted-Python] Global reactor unit tests in the Twisted test	suite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57232">[ date ]</a>
              <a href="thread.html#57232">[ thread ]</a>
              <a href="subject.html#57232">[ subject ]</a>
              <a href="author.html#57232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Nov 1, 2011, at 10:20 PM, Tim Allen wrote:

&gt;<i> On Tue, Nov 01, 2011 at 02:48:02PM -0400, Glyph wrote:
</I>&gt;&gt;<i> If you can think of a better solution that addresses all of these
</I>&gt;&gt;<i> concerns simultaneously somehow, please share, I'd love to hear it
</I>&gt;&gt;<i> :-).
</I>&gt;<i> 
</I>&gt;<i> I'm not sure if it addresses all your concerns, but
</I>&gt;<i> twisted.python.context will let you set a particular value for things
</I>&gt;<i> you call and all their descendants (unless one of them sets a new value
</I>&gt;<i> in the context). I can imagine interleaving code that passes a reactor
</I>&gt;<i> parameter explicitly and code that grabs a reactor from the current
</I>&gt;<i> context without much hassle.
</I>
I invented twisted.python.context for this very reason!

But... I find the idea of encouraging its widespread use disconcerting.

There are a couple of issues (and if you search the web for &quot;emacs lisp dynamic scope&quot; you will find a whole bunch of them) but the main problem is this:

When you do context.get(something) and something isn't there... what do you do?  Whose fault is it?

As a parallel example, when a function gets called with the wrong argument, it's quite easy to figure out where the problem is: you just look at the caller, and the caller almost certainly knows who they are.  The caller somehow has to know about the signature of the callee and if they get it wrong it's an immediate and obvious runtime error.

But when code has a relationship to its caller's caller's caller's caller's caller, and there may be any amount of indirection in there (callbacks registered on Deferreds, for example) how do you find the place that really should have been the one to pass the result?  How do you know at the time you invoke something, all the context that it may require?

The immediate place I can think of where this would cause issues is with GUI callbacks.  Right now Twisted goes out of its way to make sure that you can '.connect(&quot;clicked&quot;, ...)' on a GTK widget and use any old python callback you want.  If we made the reactor context-driven, then that would work... mostly.  If Twisted's callbacks were run with the reactor present, then the GUI's callbacks might not have the reactor available to them because they lack some setup.

Of course you can probably fix that problem, but there are other places where it will crop up again; the standard idiom is to call a bunch of functions to set up event handlers, then call reactor.run().  But what if the reactor isn't available to those functions before it's run?

Et cetera, et cetera.

If you can think of a solid, robust way to specify contracts that describe what context is expected, by whom, and how it can be filled at the right time without surprising consequences, I'd love to hear it, but I won't hold my breath :).

-glyph



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057231.html">[Twisted-Python] Global reactor unit tests in the Twisted test suite
</A></li>
	<LI>Next message (by thread): <A HREF="057307.html">[Twisted-Python] Global reactor unit tests in the Twisted test	suite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57232">[ date ]</a>
              <a href="thread.html#57232">[ thread ]</a>
              <a href="subject.html#57232">[ subject ]</a>
              <a href="author.html#57232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
