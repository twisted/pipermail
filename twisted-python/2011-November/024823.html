<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] TDD: How to test that a Timeout Exception	occurs	within the timeout period
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20TDD%3A%20How%20to%20test%20that%20a%20Timeout%20Exception%0A%09occurs%09within%20the%20timeout%20period&In-Reply-To=CAMBtMcuqDGf0%3DAmA8pAV8%3DfO6y%2BL7-jCyhFWkzEnNsrdku1XBg%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024821.html">
   <LINK REL="Next"  HREF="024833.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] TDD: How to test that a Timeout Exception	occurs	within the timeout period</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20TDD%3A%20How%20to%20test%20that%20a%20Timeout%20Exception%0A%09occurs%09within%20the%20timeout%20period&In-Reply-To=CAMBtMcuqDGf0%3DAmA8pAV8%3DfO6y%2BL7-jCyhFWkzEnNsrdku1XBg%40mail.gmail.com"
       TITLE="[Twisted-Python] TDD: How to test that a Timeout Exception	occurs	within the timeout period">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Nov  7 08:46:12 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024821.html">[Twisted-Python] TDD: How to test that a Timeout Exception occurs	within the timeout period
</A></li>
        <LI>Next message: <A HREF="024833.html">[Twisted-Python] [ANN] txWS 0.6.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24823">[ date ]</a>
              <a href="thread.html#24823">[ thread ]</a>
              <a href="subject.html#24823">[ subject ]</a>
              <a href="author.html#24823">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01:27 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tom.sheffler at gmail.com</A> wrote:
&gt;<i>I am investigating timeout properties of the FTP server module.  I
</I>&gt;<i>have written the following trial test, that when functioning properly
</I>&gt;<i>will throw a PortConnectionError with a &quot;DTPFactory timeout&quot;
</I>&gt;<i>
</I>&gt;<i>I would like to use something like
</I>&gt;<i>
</I>&gt;<i>   self.failUnlessRaises()
</I>
Unrelated to the real intent of your question: adjust this desire, you 
should want to use self.assertRaises() instead.
&gt;<i>but the test is also constructed using defer.deferredGenerator, and it
</I>&gt;<i>doesn't seem possible to apply the test for an exception to a
</I>&gt;<i>Generator-based test.
</I>
This is somewhat true-ish.  There is another trial method that helps out 
with this case: assertFailure.  The new trial documentation written by 
Thomas Herv&#233; addresses this use case a bit:

<A HREF="http://buildbot.twistedmatrix.com/builds/sphinx-">http://buildbot.twistedmatrix.com/builds/sphinx-</A> 
html/499-16046/projects/core/howto/trial.html#testing-scheduling

However, it's not clear to me that you actually have a Deferred that is 
going to fire with a Failure.  It sounds like maybe you have an error 
that will get logged and no other indication that what you were waiting 
for has happened?  If so, you might want to aim for a Deferred that 
fires when the important thing has happened.

Jean-Paul
&gt;<i>This is a useful type of test to be able to
</I>&gt;<i>write: to assert that an exceptional condition *will* occur within a
</I>&gt;<i>timeout period.  Failure is if the exceptional condition is *never*
</I>&gt;<i>raised.  Suggestions for attacking these types of properties is 
</I>&gt;<i>welcome.
</I>&gt;<i>
</I>&gt;<i>FYI: Here is my test, along with the trial directive that if it runs
</I>&gt;<i>for 60 seconds it is a failure.  But first, here is the ERROR
</I>&gt;<i>traceback that a &quot;successful&quot; run of this test produces.
</I>&gt;<i>
</I>&gt;<i>===============================================================================
</I>&gt;<i>[ERROR]
</I>&gt;<i>Traceback (most recent call last):
</I>&gt;<i>Failure: twisted.protocols.ftp.PortConnectionError: DTPFactory timeout
</I>&gt;<i>
</I>&gt;<i>test_ftp_timeouts.TimeoutsFTPServerTestCase.test_FtpControlChannelTimesOut
</I>&gt;<i>-------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>    def test_FtpControlChannelTimesOut(self):
</I>&gt;<i>        &quot;&quot;&quot;Test that after the FTP timeout, the control channel closes
</I>&gt;<i>itself.&quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i>        # Set the timeout to something small, but greater than 
</I>&gt;<i>DTPTimeout
</I>&gt;<i>        self.serverProtocol.timeOut = 15
</I>&gt;<i>
</I>&gt;<i>        # Login
</I>&gt;<i>        wfd = defer.waitForDeferred(self._anonymousLogin())
</I>&gt;<i>        yield wfd
</I>&gt;<i>        wfd.getResult()
</I>&gt;<i>        log.msg(&quot;Login Anonymous&quot;)
</I>&gt;<i>
</I>&gt;<i>        # Wait for N seconds, protocol timeOut not fired yet
</I>&gt;<i>        wait1 = defer.waitForDeferred(self.mywait(2))
</I>&gt;<i>        yield wait1
</I>&gt;<i>
</I>&gt;<i>        # Should get here and not fail
</I>&gt;<i>        log.msg(&quot;FTP is ok here&quot;)
</I>&gt;<i>
</I>&gt;<i>        # Issue a PASV command, and extract the host and port from the 
</I>&gt;<i>response
</I>&gt;<i>        pasvCmd = 
</I>&gt;<i>defer.waitForDeferred(self.client.queueStringCommand('PASV'))
</I>&gt;<i>        yield pasvCmd
</I>&gt;<i>        responseLines = pasvCmd.getResult()
</I>&gt;<i>        log.msg(&quot;PASV responseLines&quot;, responseLines)
</I>&gt;<i>        host, port = ftp.decodeHostPort(responseLines[-1][4:])
</I>&gt;<i>
</I>&gt;<i>        # Wait for N seconds, protocol timeOut will fire
</I>&gt;<i>        wait2 = defer.waitForDeferred(self.mywait(20))
</I>&gt;<i>        yield wait2
</I>&gt;<i>        log.msg(&quot;FTP should have timed out and left reactor clean&quot;)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>    test_FtpControlChannelTimesOut =
</I>&gt;<i>defer.deferredGenerator(test_FtpControlChannelTimesOut)
</I>&gt;<i>    # test_FtpControlChannelTimesOut.skip = &quot;skipping&quot;
</I>&gt;<i>    test_FtpControlChannelTimesOut.timeout = 60 # is a real error if
</I>&gt;<i>it takes this long
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-Python mailing list
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024821.html">[Twisted-Python] TDD: How to test that a Timeout Exception occurs	within the timeout period
</A></li>
	<LI>Next message: <A HREF="024833.html">[Twisted-Python] [ANN] txWS 0.6.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24823">[ date ]</a>
              <a href="thread.html#24823">[ thread ]</a>
              <a href="subject.html#24823">[ subject ]</a>
              <a href="author.html#24823">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
