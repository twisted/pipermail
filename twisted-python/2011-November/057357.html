<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] data dispatch on massive connection counts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20data%20dispatch%20on%20massive%20connection%20counts&In-Reply-To=%3C634914A010D0B943A035D226786325D42D0C2646E8%40EXVMBX020-12.exch020.serverdata.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057356.html">
   <LINK REL="Next"  HREF="057358.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] data dispatch on massive connection counts</H1>
    <B>Tobias Oberstein</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20data%20dispatch%20on%20massive%20connection%20counts&In-Reply-To=%3C634914A010D0B943A035D226786325D42D0C2646E8%40EXVMBX020-12.exch020.serverdata.net%3E"
       TITLE="[Twisted-Python] data dispatch on massive connection counts">tobias.oberstein at tavendo.de
       </A><BR>
    <I>Mon Nov 14 07:28:06 MST 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057356.html">[Twisted-Python] data dispatch on massive connection counts
</A></li>
        <LI>Next message (by thread): <A HREF="057358.html">[Twisted-Python] data dispatch on massive connection counts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57357">[ date ]</a>
              <a href="thread.html#57357">[ thread ]</a>
              <a href="subject.html#57357">[ subject ]</a>
              <a href="author.html#57357">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Besides callLater, a higher level construct to do this is
</I>&gt;<i> twisted.internet.task.cooperate().
</I>&gt;<i> <A HREF="https://blip.tv/pycon-us-videos-2009-2010-2011/pycon-2010-cooperative-">https://blip.tv/pycon-us-videos-2009-2010-2011/pycon-2010-cooperative-</A>
</I>&gt;<i> multitasking-with-twisted-getting-things-done-concurrently-11-3352182 is a
</I>&gt;<i> presentation dreid did, which should really be turned into a howto.
</I>
Interesting. Need to add that to my toolbox.

In the meantime I've implemented the chunked/callLater approach.

It works.

However, as I currently do it, it breaks message order guarantees .. i.e. it's no
longer guaranteed that each recepient will receive published messages in the
order a _single_ publisher sent them.

Currently I use a set() and pop() from it.

I might change that to fetch receivers from

deque(sorted(set))

Is it guaranteed that

callLater(0, fun1)
callLater(0, fun2)

will always result in fun2 being called after fun1?

Because then, and when alway using same chunk size (# of receivers), above
ordering guarantee would hold.

I'd like to avoid having to create a send queue per receiver ..

&gt;<i> 
</I>&gt;<i> &gt; 2) Too many files.
</I>&gt;<i> &gt; Is there another limit specifically for files, and/or something tunable in
</I>&gt;<i> Python/Twisted?
</I>&gt;<i> 
</I>&gt;<i> That's definitely not a limit on Python or Twisted. That's an OS limit.
</I>&gt;<i> Are you opening lots of files in addition to your sockets?
</I>
No.

After i.e. 50k clients have connected:

[<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">autobahn at autobahnhub</A> ~/AutobahnHub/service]$ sysctl kern.openfiles
kern.openfiles: 50115

[<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">autobahn at autobahnhub</A> ~/AutobahnHub/service]$ lsof -p 1888 | wc -l
   50075

This bugs me .. don't know why it's happening.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057356.html">[Twisted-Python] data dispatch on massive connection counts
</A></li>
	<LI>Next message (by thread): <A HREF="057358.html">[Twisted-Python] data dispatch on massive connection counts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57357">[ date ]</a>
              <a href="thread.html#57357">[ thread ]</a>
              <a href="subject.html#57357">[ subject ]</a>
              <a href="author.html#57357">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
