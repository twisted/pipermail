<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] data dispatch on massive connection counts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20data%20dispatch%20on%20massive%20connection%20counts&In-Reply-To=1321275752.1812.8.camel%40blake">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024883.html">
   <LINK REL="Next"  HREF="024886.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] data dispatch on massive connection counts</H1>
    <B>Tobias Oberstein</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20data%20dispatch%20on%20massive%20connection%20counts&In-Reply-To=1321275752.1812.8.camel%40blake"
       TITLE="[Twisted-Python] data dispatch on massive connection counts">tobias.oberstein at tavendo.de
       </A><BR>
    <I>Mon Nov 14 12:57:46 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024883.html">[Twisted-Python] data dispatch on massive connection counts
</A></li>
        <LI>Next message: <A HREF="024886.html">[Twisted-Python] data dispatch on massive connection counts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24885">[ date ]</a>
              <a href="thread.html#24885">[ thread ]</a>
              <a href="subject.html#24885">[ subject ]</a>
              <a href="author.html#24885">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> That's definitely not a limit on Python or Twisted. That's an OS limit.
</I>&gt;<i> Are you opening lots of files in addition to your sockets?
</I>
As it turns out, you are right, and the full answer is most unpleasant:

This

<A HREF="http://www.freebsd.org/cgi/query-pr.cgi?pr=148581&amp;cat=">http://www.freebsd.org/cgi/query-pr.cgi?pr=148581&amp;cat=</A>

bug in FreeBSD libc, which is there in i386/amd64 up to and including FreeBSD 9 RC1

and the fact that Python uses fopen() from libc, not open() from Posix

results in the situation that you can't have more than 32k FDs done.

In my situation, it's like this: the new kqueue reactor will happily accept
50k TCPs .. no problem, since Python isn't involved with fopen() here.

But as soon as a Python open() and thus fopen() happens, the new FD
would need to be &gt;32k and that does not work, since the braindead libc
on FreeBSD defines fileno to be SHORT_MAX.

Now I'm running out of options.

I was told that the new Python 3 IO system does not use fopen(),
however Twisted is not yet there on Python 3, right?

There is a backport of that new IO to Python 2.7, but I'm not sure
if thats transparent for calls like Python open().

I can't open first i.e. 100 files, since the set of files needed is not
fixed in the beginning ..i.e when Twisted does a log file switch.

Well, this is all absolutely sad. Now we (nearly) have new kqueue,
it does fly, but I can't break above 32k anyway ..

</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024883.html">[Twisted-Python] data dispatch on massive connection counts
</A></li>
	<LI>Next message: <A HREF="024886.html">[Twisted-Python] data dispatch on massive connection counts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24885">[ date ]</a>
              <a href="thread.html#24885">[ thread ]</a>
              <a href="subject.html#24885">[ subject ]</a>
              <a href="author.html#24885">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
