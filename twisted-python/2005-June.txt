From twisted at codex.net  Wed Jun  1 09:47:04 2005
From: twisted at codex.net (Vincent AE Scott)
Date: Wed, 1 Jun 2005 14:47:04 +0100
Subject: [Twisted-Python] twisted.enterprise.row multiple rowForeignKeys
Message-ID: <20050601134704.GA5577@mail.codex.net>

Hi,
First off, I'm a relative newby to twisted and I've just encountered my
first problem that i couldnt solve either via the docs or google.

I'm using twisted 2.0, python 2.4.1 on debian/testing

namely I'm attempting to use twisted.enterprise.row and add multiple
foreign kets to a RowObject.  What i thought would work is the
following:

 rowForeignKeys	= [
  ("questions", [("question_id","int")], [("id_question","int")], None, 1),
  ("users", [("user_id","int")], [("id_user","int")], None, 1),
 ]

But, what i find works is when i only have one foreign reference in my
class.  Both of the above ones are valid (see attached source), but only
the first one (questions) is actually used.  If i comment out the
questions entry, leaving just "users" it works as expected.

I popped in some extra debug in Reflector.populateSchemaFor to verify
that it was processing both entries, and it appears to be so.

Does anyone else have a suggestion as to where I'm going wrong?

TIA
-v


-- 
keys:  http://codex.net/gpg.asc 

 Nothing is true && everything is possible

-------------- next part --------------
from twisted.enterprise import row

class QuestionRow( row.RowObject ):
	rowColumns = [
		("id_question","int"),
		("the_question","varchar"),
		("poser_id","int")
		]
	rowTableName	= "questions"
	rowKeyColumns	= [("id_question","int")]
	rowForeignKeys	= [("users", [("poser_id","int")], [("id_user","int")], None, 1)]
	
#######################################################################################

class AnswerRow( row.RowObject ):
	rowColumns = [
		("id_answer","int"),
		("question_id","int"),
		("the_answer","varchar"),
		("user_id","int")
		]
	rowTableName	= "answers"
	rowKeyColumns	= [("id_answer","int")]
	rowForeignKeys	= [
		("users", [("user_id","int")], [("id_user","int")], None, 1),
		("questions", [("question_id","int")], [("id_question","int")], None, 1),
		]

#######################################################################################

class UserRow( row.RowObject ):
	rowColumns = [
		("id_user",		"int"),
		("username",		"varchar"),
		("forename",		"varchar"),
		("surname",		"varchar")
		]
	rowTableName	= "users"
	rowKeyColumns	= [("id_user","int")]

#######################################################################################

from twisted.enterprise import adbapi
from twisted.internet import reactor, defer, task
from twisted.enterprise.sqlreflector import SQLReflector
from twisted.trial.util import deferredResult

dbpool = adbapi.ConnectionPool( "pyPgSQL.PgSQL", database='xxxx', \
	host='localhost', user='xxxx', password='xxxx' )

reflector = SQLReflector( dbpool, [UserRow, PrimaryGroupRow, QuestionRow, AnswerRow] )

def gotUsers(users):
	for user in users:
		for child in user.childRows:
			print "KEYS: ", child.rowForeignKey
			# this will only print the foriegn key descriptions 

def runme():
	d2 = reflector.loadObjectsFrom( "users" )
	d2.addCallback( gotUsers )
	deferredResult(d2)
	print "runme got deferred d2"

reactor.callLater( 1.0, runme )
reactor.run()


From carolinaardohain at gmail.com  Wed Jun  1 15:27:54 2005
From: carolinaardohain at gmail.com (Carolina Ardohain)
Date: Wed, 1 Jun 2005 16:27:54 -0300
Subject: [Twisted-Python] PyPgSQL not locking in adbapi
Message-ID: <8ecf09605060112276542c9c2@mail.gmail.com>

I'm using Twisted 2.0, and pgSQL 2.4.

I have two function in plpgsql that access the same table, I have to
look if one id is in the table persons, if not then add to the table.
I try to lock a table with "LOCK TABLE persons IN ACCESS EXCLUSIVE
MODE;", so no both functions try to add the same id.

I get 'duplicate key violates unique constraint' when run the two
queries at the same time, if I delay one of the functions 1 sec then
everything is fine.



From exarkun at divmod.com  Wed Jun  1 17:05:22 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Wed, 01 Jun 2005 21:05:22 GMT
Subject: [Twisted-Python] PyPgSQL not locking in adbapi
In-Reply-To: <8ecf09605060112276542c9c2@mail.gmail.com>
Message-ID: <20050601210522.559.1924981987.divmod.quotient.14148@ohm>

On Wed, 1 Jun 2005 16:27:54 -0300, Carolina Ardohain <carolinaardohain at gmail.com> wrote:
>I'm using Twisted 2.0, and pgSQL 2.4.
>
>I have two function in plpgsql that access the same table, I have to
>look if one id is in the table persons, if not then add to the table.
>I try to lock a table with "LOCK TABLE persons IN ACCESS EXCLUSIVE
>MODE;", so no both functions try to add the same id.
>
>I get 'duplicate key violates unique constraint' when run the two
>queries at the same time, if I delay one of the functions 1 sec then
>everything is fine.
>

What method did you use to run the LOCK statement?  Did you make sure it ran in the same transaction as the subsequent SELECT and UPDATE?

If you aren't already, I think you want to use one runInteraction() call for all three parts.

Jp



From exarkun at divmod.com  Wed Jun  1 17:24:07 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Wed, 01 Jun 2005 21:24:07 GMT
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <429CDCAE.6020609@fettig.net>
Message-ID: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>

On Tue, 31 May 2005 17:52:46 -0400, Abe Fettig <abe at fettig.net> wrote:
>Hello all,
>
>I'm trying to figure out how to hook up the necessary classes in
>twisted.conch.recvline to add line-editing and history to a simple ssh
>app. It was easy to modify
>http://twistedmatrix.com/projects/conch/documentation/examples/sshsimpleserver.py
>to use a custom protocol (a simple command-line interface that sends web
>services requests to a JotSpot wiki), but I can't figure out how
>recvline is meant to be used. Could someone (Jp?) show me how you'd go
>about bolting recvline onto sshsimpleserver?
>

In summary, you need:

  1) A Realm which produces avatars implementing IConchUser
  2) An avatar which also implements or is adaptable to ISession
  3) A session which constructs a twisted.conch.insults.insults.ServerProtocol in openShell, and connects it to a transport
  4) A protocol class which subclasses one of the recvline protocol classes, passed as the first argument to ServerProtocol

If you hook all these pieces up right, the protocol class you give to ServerProtocol should end up receiving application-level data from your ssh server, and its terminal attribute will be hooked up to send bytes back.

Note that this API may not be stable.

There's an example of all this smeared across doc/conch/examples/demo_recvline.py and twisted/conch/manhole_ssh.py.


The API presented by manhole_ssh.py is definitely not stable.

Jp



From carolinaardohain at gmail.com  Wed Jun  1 18:23:26 2005
From: carolinaardohain at gmail.com (Carolina Ardohain)
Date: Wed, 1 Jun 2005 19:23:26 -0300
Subject: [Twisted-Python] PyPgSQL not locking in adbapi
In-Reply-To: <20050601210522.559.1924981987.divmod.quotient.14148@ohm>
References: <8ecf09605060112276542c9c2@mail.gmail.com>
	<20050601210522.559.1924981987.divmod.quotient.14148@ohm>
Message-ID: <8ecf09605060115233566a329@mail.gmail.com>

The functions are called with "SELECT conversation_insert(...)"
and "SELECT message_insert(...)".

FUNCTION conversation_insert(....)
BEGIN
    LOCK TABLE person IN ACCESS EXCLUSIVE MODE;
    PERSON * FROM persons WHERE id = person_id;
    IF NOT FOUND THEN
        INSERT INTO persons (id) VALUES (person_id)
    END IF;
    ...
    INSERT INTO conversations (personId) VALUES (person_id)
    ...
    RETURN;
END;

FUNCTION message_insert(....)
BEGIN
    LOCK TABLE person IN ACCESS EXCLUSIVE MODE;
    PERSON * FROM persons WHERE id = person_id;
    IF NOT FOUND THEN
        INSERT INTO persons (id) VALUES (person_id)
    END IF;
    ...
    INSERT INTO message (personId, subject, message) VALUES
(person_id, v_subject, v_message)
    ...
    RETURN;
END;



On 6/1/05, Jp Calderone <exarkun at divmod.com> wrote:
> On Wed, 1 Jun 2005 16:27:54 -0300, Carolina Ardohain <carolinaardohain at gmail.com> wrote:
> >I'm using Twisted 2.0, and pgSQL 2.4.
> >
> >I have two function in plpgsql that access the same table, I have to
> >look if one id is in the table persons, if not then add to the table.
> >I try to lock a table with "LOCK TABLE persons IN ACCESS EXCLUSIVE
> >MODE;", so no both functions try to add the same id.
> >
> >I get 'duplicate key violates unique constraint' when run the two
> >queries at the same time, if I delay one of the functions 1 sec then
> >everything is fine.
> >
> 
> What method did you use to run the LOCK statement?  Did you make sure it ran in the same transaction as the subsequent SELECT and UPDATE?
> 
> If you aren't already, I think you want to use one runInteraction() call for all three parts.
> 
> Jp
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From maoy at cis.upenn.edu  Wed Jun  1 18:42:00 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Wed, 1 Jun 2005 18:42:00 -0400 (EDT)
Subject: [Twisted-Python] what happened to the --profile option in twistd?
Message-ID: <Pine.LNX.4.61.0506011838320.11511@forty-thieves.cis.upenn.edu>

I thought there was one, but I just checked my 1.3.0 installation and it 
is gone. What is the right way to do profiling now?

Thanks,
Yun




From bgranger at scu.edu  Wed Jun  1 18:58:01 2005
From: bgranger at scu.edu (Brian Granger)
Date: Wed, 01 Jun 2005 15:58:01 -0700
Subject: [Twisted-Python] Stopping and restarting the reactor
Message-ID: <0691b0c3fe8435554c486474bb599d3b@scu.edu>

Hello,

I am using twisted's client capabilities in an interactive setting.  To 
allow for interactive work, I have wrapped all my calls to connectTCP 
with a class that starts the reactor when a new set of connectTCP calls 
is made.  I stop the reactor in the clientConnectionLost method of my 
ClientFactory (when there are no more connections).

The first time I initiate a connectTCP call in my wrapper class 
everything works as expected:  the reactor is started, twisted does its 
stuff, and the ClientFactory stops the reactor (giving me back 
interactive controll).  BUT, if I the initiate another connectTCP call, 
the reactor starts, but then I get a User Timeout error showing up.  
That is, the second time, no connection is made.  My ClientFactory 
again stops the reactor (this time in clientConnectionFailed), but then 
python hangs.

My question:  is the reactor designed to be started/stopped/restarted 
in a single session?  If so, are there any considerations that I am 
missing?  Why doesn't the connection get made the second time?

Thanks in advance

Brian






The first time

Brian E. Granger
Assistant Professor of Physics
Santa Clara University

bgranger at scu.edu
Phone: 408-551-1891
Fax: 408-554-6965




From maoy at cis.upenn.edu  Wed Jun  1 19:16:12 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Wed, 1 Jun 2005 19:16:12 -0400 (EDT)
Subject: [Twisted-Python] what happened to the --profile option in twistd?
In-Reply-To: <Pine.LNX.4.61.0506011838320.11511@forty-thieves.cis.upenn.edu>
References: <Pine.LNX.4.61.0506011838320.11511@forty-thieves.cis.upenn.edu>
Message-ID: <Pine.LNX.4.61.0506011915210.11511@forty-thieves.cis.upenn.edu>

Please ignore my previous post. :)




From bob at redivi.com  Wed Jun  1 19:25:59 2005
From: bob at redivi.com (Bob Ippolito)
Date: Wed, 1 Jun 2005 16:25:59 -0700
Subject: [Twisted-Python] Stopping and restarting the reactor
In-Reply-To: <0691b0c3fe8435554c486474bb599d3b@scu.edu>
References: <0691b0c3fe8435554c486474bb599d3b@scu.edu>
Message-ID: <D79C963C-37FA-4682-99A1-A1A0D1D12DE0@redivi.com>


On Jun 1, 2005, at 3:58 PM, Brian Granger wrote:

> I am using twisted's client capabilities in an interactive  
> setting.  To allow for interactive work, I have wrapped all my  
> calls to connectTCP with a class that starts the reactor when a new  
> set of connectTCP calls is made.  I stop the reactor in the  
> clientConnectionLost method of my ClientFactory (when there are no  
> more connections).
>
> The first time I initiate a connectTCP call in my wrapper class  
> everything works as expected:  the reactor is started, twisted does  
> its stuff, and the ClientFactory stops the reactor (giving me back  
> interactive controll).  BUT, if I the initiate another connectTCP  
> call, the reactor starts, but then I get a User Timeout error  
> showing up.  That is, the second time, no connection is made.  My  
> ClientFactory again stops the reactor (this time in  
> clientConnectionFailed), but then python hangs.
>
> My question:  is the reactor designed to be started/stopped/ 
> restarted in a single session?  If so, are there any considerations  
> that I am missing?  Why doesn't the connection get made the second  
> time?

No, it's not.  You should start the reactor at the beginning of your  
app, and stop it when your app is going to quit.  That's it.

threadedselectreactor <http://bob.pythonmac.org/archives/2005/04/17/ 
twisted-and-foreign-event-loops/> is probably more appropriate for  
what you're trying to do.

-bob




From radeex at gmail.com  Wed Jun  1 20:05:18 2005
From: radeex at gmail.com (Christopher Armstrong)
Date: Thu, 2 Jun 2005 10:05:18 +1000
Subject: [Twisted-Python] Database client-server based on Twisted
In-Reply-To: <20050601121942.C8F9C2A50@smtp-02.servidoresdns.net>
References: <20050601121942.C8F9C2A50@smtp-02.servidoresdns.net>
Message-ID: <60ed19d405060117053c2d91b4@mail.gmail.com>

This was accidentally posted to twisted-python-owner instead of twisted-python.

---------- Forwarded message ----------
From: Andreu Alted <aalted at cstables.org>
Date: Jun 1, 2005 10:19 PM
Subject: Database client-server based on Twisted
To: twisted-python-owner at twistedmatrix.com


 
Hello, 
  
I have released a beta version of CSTables (www.cstables.org).
CSTables is a client-server layer for PyTables (www.pytables.org) and
HDF5 (hdf.ncsa.uiuc.edu/HDF5/). It is designed to fast adapt to any
other API. In fact, I was thinking in converting it in a
semi-automatic generator of client-server layers for monolitic
applcations, but that's another story.
  
CSTables uses Twisted for client-server communication, and actually is
fully integrated with the Twisted Framework (it runs with twistd
script).
  
My project had to be commercialized by another company, but we didn't
get an agreement.
  
Now, I am looking for a way to keep CSTables alive. There is an
interest for CSTables as a client-server for HDF5, but my intention is
to make something nearest to the general developer.
  
I wonder if Twisted or a related company could be interested in some
manner in CSTables, (his technology, his development, integrating it
in some manner with other products, similar developments, etc.).
  
One of the strong points of CSTables is fast reading large amounts of
data, moreover after my current optimizations that use shared memory
for transferring data for local clients in place of banana
serialization.
  
Please, let me know any oppinion. 
  
Best Regards. 
  
______________________ 
Andreu Alted 
CSTables main developer



From exarkun at divmod.com  Wed Jun  1 20:11:43 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 02 Jun 2005 00:11:43 GMT
Subject: [Twisted-Python] Stopping and restarting the reactor
In-Reply-To: <0691b0c3fe8435554c486474bb599d3b@scu.edu>
Message-ID: <20050602001143.559.125749438.divmod.quotient.14227@ohm>

On Wed, 01 Jun 2005 15:58:01 -0700, Brian Granger <bgranger at scu.edu> wrote:
>Hello,
>
>I am using twisted's client capabilities in an interactive setting. 

How are you driving this interaction?  I could argue that the vast majority of Twisted applications fall into this category - for example, a Twisted web server is interacted with using an HTTP client; a Twisted mail client is interacted with using GUI widgets or a manhole shell. Neither of these cases demands the reactor stop while the interaction proceeds: in the ideal case, the interaction merely needs to be event driven.  In your case, it sounds like simply blocking for a while *while the reactor runs* is sufficient.  This will let whatever blocking mechanism you currently use to interact with the user to continue functioning, without dragging the problems of stopping and restarting the reactor into the picture.

Jp



From abe at fettig.net  Thu Jun  2 00:44:47 2005
From: abe at fettig.net (Abe Fettig)
Date: Thu, 02 Jun 2005 00:44:47 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>
Message-ID: <429E8EBF.2000501@fettig.net>

Jp Calderone wrote:

> If you hook all these pieces up right, the protocol class you give to
> ServerProtocol should end up receiving application-level data from your
> ssh server, and its terminal attribute will be hooked up to send bytes
> back.
> 
> Note that this API may not be stable.
> 
> There's an example of all this smeared across
> doc/conch/examples/demo_recvline.py and twisted/conch/manhole_ssh.py.

I've done this, and it's working in my example the same way as it does
in demo_recvline.py. It's a much nicer environment than my original:
backspace works, arrows work, you can scroll up and down through command
history. Yippee!

But there's a problem, both in my code and in demo_recvline.py: when you
get to the bottom of the terminal it doesn't scroll. All the lines just
get pasted over each other on the bottom line of the terminal. I'm
clueless about terminal programming: generally I just know that I can
dump a bunch of text and the terminal will scroll. But now it doesn't.
Can you help me fix this?

Once I get this all working, I'll post a modified simplesshserver.py for
the benefit of others who might want a working line editing and history
for their custom protocol.

Thanks!

Abe



From foom at fuhm.net  Thu Jun  2 02:04:26 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 2 Jun 2005 02:04:26 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <429E8EBF.2000501@fettig.net>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>
	<429E8EBF.2000501@fettig.net>
Message-ID: <EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>

On Jun 2, 2005, at 12:44 AM, Abe Fettig wrote:
> But there's a problem, both in my code and in demo_recvline.py:  
> when you
> get to the bottom of the terminal it doesn't scroll. All the lines  
> just
> get pasted over each other on the bottom line of the terminal. I'm
> clueless about terminal programming: generally I just know that I can
> dump a bunch of text and the terminal will scroll. But now it doesn't.
> Can you help me fix this?

I know way too much about terminal programming, and can immediately  
identify the problem as the use of "ESC E". Never ever use ESC E,  
it's worthless. While I'm at it: never use ESC D, and really try not  
to use ESC M either. They're all mostly unused and people who don't  
care about correctness, only "working for unix termcap" don't bother  
implementing them right. Use instead \r\n, \n, and ESC[A (not quite  
the same thing, as it doesn't do a backwards scroll, but if you think  
backwards scrolling is going to work, I've got this bridge to sell  
you...).

Anyhow, could you say which horribly broken terminal program you're  
using? I like to keep track of these things. From what I can tell,  
the authors of most of the terminal emulators out there must have  
never even bothered to read the documentation for the terminals they  
claim to emulate...

James



From jraghul85 at hotmail.com  Thu Jun  2 08:47:41 2005
From: jraghul85 at hotmail.com (Raghul Jagan)
Date: Thu, 02 Jun 2005 18:17:41 +0530
Subject: [Twisted-Python] Twisted server connection loss with Mysql  
Message-ID: <BAY12-F65964BE8D92DAD1E3A216AD060@phx.gbl>

hi friends,

          I also tried using the "cp_reconnect=1" for my twisted server.The 
first time it works but  the same error ocurrs after that .Is there anyway 
to solve this problem? I also tried by changing the value "reconnect=True" 
in adbapi.py file,the same error occurs what will be my problem? My machine 
configuration is

Linux fedora  core3
mysqldb 1.2
python 2.3
twisted server 2.0.1
pyxml 0.8

Windows with the same . I am running twisted server in windows. Is there any 
thing available in python equivalent to adbapi in python.  please give me a 
solution for this?


regards
raghul

_________________________________________________________________
Can?t have enough of SRK? http://server1.msn.co.in/sp05/iifa/ Help him bag 
the award.




From abe at fettig.net  Thu Jun  2 10:04:40 2005
From: abe at fettig.net (Abe Fettig)
Date: Thu, 02 Jun 2005 10:04:40 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>	<429E8EBF.2000501@fettig.net>
	<EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>
Message-ID: <429F11F8.4090803@fettig.net>

James Y Knight wrote:

> I know way too much about terminal programming, and can immediately 
> identify the problem as the use of "ESC E". Never ever use ESC E,  it's
> worthless. While I'm at it: never use ESC D, and really try not  to use
> ESC M either. They're all mostly unused and people who don't  care about
> correctness, only "working for unix termcap" don't bother  implementing
> them right. Use instead \r\n, \n, and ESC[A (not quite  the same thing,
> as it doesn't do a backwards scroll, but if you think  backwards
> scrolling is going to work, I've got this bridge to sell  you...).

Thanks, it worked! I changed the nextLine() method of
insults.ServerProtocol to use \r\n:

class PatchedServerProtocol(insults.ServerProtocol):
    def nextLine(self):
        self.cursorPos.x = 0
        self.cursorPos.y = min(self.cursorPos.y + 1, self.termSize.y - 1)
        self.transport.write('\r\n') # this is the only change

Is this something that should be fixed in insults? I can submit a patch
to the bug tracker.

> Anyhow, could you say which horribly broken terminal program you're 
> using? I like to keep track of these things. From what I can tell,  the
> authors of most of the terminal emulators out there must have  never
> even bothered to read the documentation for the terminals they  claim to
> emulate...

gnome-terminal 2.10

Thanks!

Abe



From itamar at itamarst.org  Thu Jun  2 10:59:53 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 02 Jun 2005 10:59:53 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <429F11F8.4090803@fettig.net>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>
	<429E8EBF.2000501@fettig.net>
	<EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>
	<429F11F8.4090803@fettig.net>
Message-ID: <1117724393.8250.24.camel@localhost.localdomain>

On Thu, 2005-06-02 at 10:04 -0400, Abe Fettig wrote:

> Thanks, it worked! I changed the nextLine() method of
> insults.ServerProtocol to use \r\n:
> 
> class PatchedServerProtocol(insults.ServerProtocol):
>     def nextLine(self):
>         self.cursorPos.x = 0
>         self.cursorPos.y = min(self.cursorPos.y + 1, self.termSize.y - 1)
>         self.transport.write('\r\n') # this is the only change
> 
> Is this something that should be fixed in insults? I can submit a patch
> to the bug tracker.

It sounds like it should be fixed, yes.





From bgranger at scu.edu  Thu Jun  2 12:37:09 2005
From: bgranger at scu.edu (Brian Granger)
Date: Thu, 02 Jun 2005 09:37:09 -0700
Subject: [Twisted-Python] Stopping and restarting the reactor
In-Reply-To: <D79C963C-37FA-4682-99A1-A1A0D1D12DE0@redivi.com>
References: <0691b0c3fe8435554c486474bb599d3b@scu.edu>
	<D79C963C-37FA-4682-99A1-A1A0D1D12DE0@redivi.com>
Message-ID: <b9555b6c36c18401dd74a38fc377dddf@scu.edu>

On Jun 1, 2005, at 4:25 PM, Bob Ippolito wrote:

>
> On Jun 1, 2005, at 3:58 PM, Brian Granger wrote:
>
>> I am using twisted's client capabilities in an interactive setting.   
>> To allow for interactive work, I have wrapped all my calls to  
>> connectTCP with a class that starts the reactor when a new set of  
>> connectTCP calls is made.  I stop the reactor in the  
>> clientConnectionLost method of my ClientFactory (when there are no  
>> more connections).
>>
>> The first time I initiate a connectTCP call in my wrapper class  
>> everything works as expected:  the reactor is started, twisted does  
>> its stuff, and the ClientFactory stops the reactor (giving me back  
>> interactive controll).  BUT, if I the initiate another connectTCP  
>> call, the reactor starts, but then I get a User Timeout error showing  
>> up.  That is, the second time, no connection is made.  My  
>> ClientFactory again stops the reactor (this time in  
>> clientConnectionFailed), but then python hangs.
>>
>> My question:  is the reactor designed to be started/stopped/restarted  
>> in a single session?  If so, are there any considerations that I am  
>> missing?  Why doesn't the connection get made the second time?
>
> No, it's not.  You should start the reactor at the beginning of your  
> app, and stop it when your app is going to quit.  That's it.
>

Ahh, that would explain the off behavior I see.


> threadedselectreactor  
> <http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- 
> event-loops/> is probably more appropriate for what you're trying to  
> do.
>

Fantastic!  I will have a look at this.

> -bob
>
>




From foom at fuhm.net  Thu Jun  2 12:48:13 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 2 Jun 2005 12:48:13 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <429F11F8.4090803@fettig.net>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>	<429E8EBF.2000501@fettig.net>
	<EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>
	<429F11F8.4090803@fettig.net>
Message-ID: <302FD2F5-BC1C-48A6-9D4C-BBF5DBB085D4@fuhm.net>

On Jun 2, 2005, at 10:04 AM, Abe Fettig wrote:
> gnome-terminal 2.10

Yeah, that's already on my "standards-ignoring completely worthless  
piece of crap" list. I suggest konsole, it seems to actually work  
right. I use it in gnome, myself.

James



From jraghul85 at hotmail.com  Thu Jun  2 12:54:43 2005
From: jraghul85 at hotmail.com (Raghul J)
Date: Thu, 02 Jun 2005 22:24:43 +0530
Subject: [Twisted-Python] Twisted server connection loss with Mysql
Message-ID: <BAY12-F16A65CB0835BE68FBBC849AD060@phx.gbl>

Hi Friends,

         My friend gave me a solution for the twisted server to

reconnect mysql.This was opening a database connection,excecuting a

query and closing the database connection.This works some what fine

with my application. I need to confirm that If this is ok and can be

deployed in live machine. Some people say that these won't be much

suitable and efficient.I also tried by putting cp_reconnect=1 but it didn't 
work. My code is

def excutequery:
	dbpool = adbapi.Connectionpool("db",host,passwd,cp_noisy=1)
	dbpool.connect()
	result = dbpool.runInteraction(......)
	dbpool.close()
	return result


I call this function in my program. This code is working fine but the

only thing I want to confirm is that whether it is stable and has a

good performance.Is there some other way to do this?

	I am eagerly waiting for this result,So as to deploy it in my

site.

Thanks in advance
raghul

_________________________________________________________________
Buy, sell or bid for anything! http://pages.ebay.in/msnindia/auctions.html 
Try MSN Auctions now!




From foom at fuhm.net  Thu Jun  2 14:20:27 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 2 Jun 2005 14:20:27 -0400
Subject: [Twisted-Python] Twisted server connection loss with Mysql  
In-Reply-To: <BAY12-F65964BE8D92DAD1E3A216AD060@phx.gbl>
References: <BAY12-F65964BE8D92DAD1E3A216AD060@phx.gbl>
Message-ID: <056E50A3-19A1-4BA4-B0FA-17DFB388DB50@fuhm.net>


On Jun 2, 2005, at 8:47 AM, Raghul Jagan wrote:
>          I also tried using the "cp_reconnect=1" for my twisted  
> server.The first time it works but  the same error ocurrs after  
> that .Is there anyway to solve this problem? I also tried by  
> changing the value "reconnect=True" in adbapi.py file,the same  
> error occurs what will be my problem? My machine configuration is

The expected behavior of cp_reconnect is not to retry the query  
automatically if it fails, because doing so could have undefined  
consequences. Really, it probably could retry when the error was on  
the query, not on the commit, but it doesn't currently.

If you have a connection pool size of 10, expect to see 10 queries  
fail before everything's working perfectly again, as each thread  
notices its connection has died (after failing to make the query) and  
closes it. In your app, you can either catch ConnectionLost errors  
and retry the queries yourself or live with 10 queries failing after  
restarting the database.

James



From maoy at cis.upenn.edu  Thu Jun  2 15:17:24 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Thu, 2 Jun 2005 15:17:24 -0400 (EDT)
Subject: [Twisted-Python] twisted profiling help
Message-ID: <Pine.LNX.4.61.0506021513270.4943@forty-thieves.cis.upenn.edu>

Part of my profiling result of a high speed transfer test is attached.
What might that <string>:1(connect_ex) be? I only created 2 or 3 TCP 
connections, but there are 24655 calls.

Thanks!

Yun


          608904 function calls (608583 primitive calls) in 52.314 CPU 
seconds

    Ordered by: standard name

    ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     24655    1.144    0.000    1.144    0.000 <string>:1(connect_ex)
     39185    1.247    0.000    3.853    0.000 abstract.py:159(write)
     39189    0.365    0.000    2.432    0.000 
abstract.py:239(startWriting)
      2447    0.026    0.000    0.107    0.000 
abstract.py:292(resumeProducing)
      2459    0.018    0.000    0.141    0.000 
abstract.py:296(pauseProducing)
      2459    1.496    0.001    5.195    0.002 abstract.py:88(doWrite)
     39210    5.207    0.000    5.785    0.000 base.py:432(callLater)
     39210    0.578    0.000    0.578    0.000 base.py:45(__init__)
     39181    0.223    0.000    0.223    0.000 
base.py:464(_cancelCallLater)
      9880    0.266    0.000    0.367    0.000 
base.py:482(_insertNewDelayedCalls)
      4940    0.094    0.000    0.129    0.000 base.py:491(timeout)
     39181    0.535    0.000    0.758    0.000 base.py:63(cancel)
      4927    0.134    0.000   37.772    0.008 
context.py:26(callWithContext)
     39176    3.473    0.000   12.772    0.000 expect.py:97(writeStruct)
     39177    5.446    0.000    5.446    0.000 myutil.py:34(dumps)
     39174    1.678    0.000   22.154    0.001 protocol.py:37(write)
     39175    1.164    0.000    7.706    0.000 
protocol.py:96(scheduleAliveMsg)
     39189    2.067    0.000    2.067    0.000 
selectreactor.py:156(addWriter)
      4940   12.490    0.003   51.625    0.010 
selectreactor.py:82(doSelect)
     39174    0.156    0.000    0.156    0.000 sndrcv.py:110(preWrite)
      2450    4.290    0.002   27.357    0.011 sndrcv.py:116(write)
      2450    0.743    0.000    0.743    0.000 sndrcv.py:389(addData)
      2459    0.033    0.000    0.174    0.000 sndrcv.py:83(pauseProducing)
      2447    0.021    0.000    0.128    0.000 
sndrcv.py:88(resumeProducing)
      2465    3.371    0.001   32.239    0.013 tcp.py:334(doRead)
      2459    3.406    0.001    3.406    0.001 tcp.py:353(writeSomeData)




From abe at fettig.net  Thu Jun  2 15:39:32 2005
From: abe at fettig.net (Abe Fettig)
Date: Thu, 02 Jun 2005 15:39:32 -0400
Subject: [Twisted-Python] twisted.mail.imap4.MessageSet object & imap4
	server example
In-Reply-To: <cd329af80505310849313e0b0b@mail.gmail.com>
References: <cd329af80505310849313e0b0b@mail.gmail.com>
Message-ID: <429F6074.3040109@fettig.net>

Sebastjan Trepca wrote:
> Hi!
> 
> 1. I don't understand how to use this object. When the fetch method is
> called, this object is passed containing the requested messages which
> you then return, right? But is there any easy way to just iterate
> through it and get the requested UIDis, even if LAST is not set.

MessageSet is iterable; you can say "for uid in MessageSet: doStuff()".
You have to set MessageSet.last yourself though if it wasn't specified
by the client; set it to the value of the last uid (or sequence ID)
available.

if not messageSet.last: messageSet.last = self.getUIDNext()-1

will probably do the trick.

> 2. Where could I find some IMAP4 server examples? 

You can look at the Hep IMAP server code here:

http://svn.yarnproject.org/websvn/filedetails.php?repname=hep&path=%2Fhep%2Fservices%2Fimap.py&rev=0&sc=0

It might be a little hard to understand as it's using the Hep server and
Yarn to translate between IMAP and other protocols, but hopefully you'll
find it helpful.

Abe



From carolinaardohain at gmail.com  Thu Jun  2 16:06:14 2005
From: carolinaardohain at gmail.com (Carolina Ardohain)
Date: Thu, 2 Jun 2005 17:06:14 -0300
Subject: [Twisted-Python] PyPgSQL not locking in adbapi
In-Reply-To: <8ecf09605060115233566a329@mail.gmail.com>
References: <8ecf09605060112276542c9c2@mail.gmail.com>
	<20050601210522.559.1924981987.divmod.quotient.14148@ohm>
	<8ecf09605060115233566a329@mail.gmail.com>
Message-ID: <8ecf096050602130677fa4a32@mail.gmail.com>

After the upgrade to postgres 8 the problems is gone (maybe a bug in
7.4?), thanks for your time.



From foom at fuhm.net  Thu Jun  2 16:57:21 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 2 Jun 2005 16:57:21 -0400
Subject: [Twisted-Python] twisted profiling help
In-Reply-To: <Pine.LNX.4.61.0506021513270.4943@forty-thieves.cis.upenn.edu>
References: <Pine.LNX.4.61.0506021513270.4943@forty-thieves.cis.upenn.edu>
Message-ID: <C76E2A5A-2AE1-4AE1-BE6D-F269C4F80755@fuhm.net>


On Jun 2, 2005, at 3:17 PM, Yun Mao wrote:

> Part of my profiling result of a high speed transfer test is attached.
> What might that <string>:1(connect_ex) be? I only created 2 or 3  
> TCP connections, but there are 24655 calls.

<string>:1(connect_ex) is part of the utterly stupid wrapper object  
that python has in socket.py around the real _socket module. Either  
you have a client that has tried to connect 24655 times, or the  
profiler is lying to you.

James




From maoy at cis.upenn.edu  Thu Jun  2 17:11:27 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Thu, 2 Jun 2005 17:11:27 -0400 (EDT)
Subject: [Twisted-Python] twisted profiling help
In-Reply-To: <C76E2A5A-2AE1-4AE1-BE6D-F269C4F80755@fuhm.net>
References: <Pine.LNX.4.61.0506021513270.4943@forty-thieves.cis.upenn.edu>
	<C76E2A5A-2AE1-4AE1-BE6D-F269C4F80755@fuhm.net>
Message-ID: <Pine.LNX.4.61.0506021705200.5476@forty-thieves.cis.upenn.edu>


On Thu, 2 Jun 2005, James Y Knight wrote:

>
> On Jun 2, 2005, at 3:17 PM, Yun Mao wrote:
>
>> Part of my profiling result of a high speed transfer test is attached.
>> What might that <string>:1(connect_ex) be? I only created 2 or 3 TCP 
>> connections, but there are 24655 calls.
>
> <string>:1(connect_ex) is part of the utterly stupid wrapper object that 
> python has in socket.py around the real _socket module. Either you have a 
> client that has tried to connect 24655 times, or the profiler is lying to 
> you.

If I had a client doing that, I should have had connectTCP or other 
similar methods called 24655 times (or close) too, right?

Yun



From glyph at divmod.com  Thu Jun  2 18:11:10 2005
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 2 Jun 2005 18:11:10 -0400
Subject: [Twisted-Python] twisted profiling help
In-Reply-To: <Pine.LNX.4.61.0506021705200.5476@forty-thieves.cis.upenn.edu>
Message-ID: <20050602221110.31075.1066341140.divmod.quotient.28@ohm>



On Thu, 2 Jun 2005 17:11:27 -0400 (EDT), Yun Mao <maoy at cis.upenn.edu> wrote:
>
>On Thu, 2 Jun 2005, James Y Knight wrote:
>>
>>On Jun 2, 2005, at 3:17 PM, Yun Mao wrote:
>>>Part of my profiling result of a high speed transfer test is attached.
>>>What might that <string>:1(connect_ex) be? I only created 2 or 3 TCP 
>>>connections, but there are 24655 calls.
>>
>><string>:1(connect_ex) is part of the utterly stupid wrapper object that 
>>python has in socket.py around the real _socket module. Either you have a 
>>client that has tried to connect 24655 times, or the profiler is lying to 
>>you.
>
>If I had a client doing that, I should have had connectTCP or other similar 
>methods called 24655 times (or close) too, right?

Do not underestimate the probability that the profiler is lying: Python's dev tools (profiler, debugger, etc) are all pretty buggy.

However, it is also possible that connect() is busy but the FD is showing up as readable anyway, and thus for some absurd number of mainloop iterations (until it ACTUALLY completes and is therefore finished connecting) the reactor runs .connect().

Is this on Windows by any chance?



From maoy at cis.upenn.edu  Thu Jun  2 20:43:01 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Thu, 2 Jun 2005 20:43:01 -0400 (EDT)
Subject: [Twisted-Python] twisted profiling help
In-Reply-To: <20050602221110.31075.1066341140.divmod.quotient.28@ohm>
References: <20050602221110.31075.1066341140.divmod.quotient.28@ohm>
Message-ID: <Pine.LNX.4.61.0506022042490.5476@forty-thieves.cis.upenn.edu>

>
> However, it is also possible that connect() is busy but the FD is showing up 
> as readable anyway, and thus for some absurd number of mainloop iterations 
> (until it ACTUALLY completes and is therefore finished connecting) the 
> reactor runs .connect().
>
> Is this on Windows by any chance?
>
It's linux.

Yun




From dave at krondo.com  Thu Jun  2 21:54:12 2005
From: dave at krondo.com (Dave Peticolas)
Date: Thu, 02 Jun 2005 18:54:12 -0700
Subject: [Twisted-Python] Twisted server connection loss with Mysql
In-Reply-To: <056E50A3-19A1-4BA4-B0FA-17DFB388DB50@fuhm.net>
References: <BAY12-F65964BE8D92DAD1E3A216AD060@phx.gbl>
	<056E50A3-19A1-4BA4-B0FA-17DFB388DB50@fuhm.net>
Message-ID: <1117763652.5811.11.camel@oneiros>

On Thu, 2005-06-02 at 14:20 -0400, James Y Knight wrote:
> On Jun 2, 2005, at 8:47 AM, Raghul Jagan wrote:
> >          I also tried using the "cp_reconnect=1" for my twisted  
> > server.The first time it works but  the same error ocurrs after  
> > that .Is there anyway to solve this problem? I also tried by  
> > changing the value "reconnect=True" in adbapi.py file,the same  
> > error occurs what will be my problem? My machine configuration is
> 
> The expected behavior of cp_reconnect is not to retry the query  
> automatically if it fails, because doing so could have undefined  
> consequences. Really, it probably could retry when the error was on  
> the query, not on the commit, but it doesn't currently.
> 
> If you have a connection pool size of 10, expect to see 10 queries  
> fail before everything's working perfectly again, as each thread  
> notices its connection has died (after failing to make the query) and  
> closes it. In your app, you can either catch ConnectionLost errors  
> and retry the queries yourself or live with 10 queries failing after  
> restarting the database.

Unfortunately, mysqldb doesn't throw an exception when you call
cursor() on a closed connection so the exception doesn't happen
until the query itself. Adding an option to adbapi to retry queries
on a failed connection shouldn't be too hard, I'll add that to the
tracker.

dave





From tv at twistedmatrix.com  Thu Jun  2 08:34:51 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu, 02 Jun 2005 15:34:51 +0300
Subject: [Twisted-Python] Status update on 2.0 debian packages
Message-ID: <429EFCEB.6090907@twistedmatrix.com>

Hi. Just to let everyone know, twisted 2.0 debs have been uploaded to
Debian experimental. As there are a lot of changes from 1.3, they
will require manual approval from Debian ftpmasters first.

This is 2.0 (+ related lower-versioned projects), not 2.0.1.
Hopefully I will have time for the version update sometime later.

And just the to be very very clear: 2.0 will never be in sarge.
2.0 will be in unstable _after_ sarge releases.




From james at delx.cjb.net  Fri Jun  3 20:36:51 2005
From: james at delx.cjb.net (James Bunton)
Date: Sat, 4 Jun 2005 10:36:51 +1000
Subject: [Twisted-Python] epoll reactor
In-Reply-To: <190bf2c1de5b2f4cb4217a682317c261@delx.cjb.net>
References: <20050524134807.559.1535540660.divmod.quotient.8568@ohm>
	<98310e0a7ff4b2b883d9afa5eaf4305d@delx.cjb.net>
	<20050525135656.GL26269@frobozz>
	<190bf2c1de5b2f4cb4217a682317c261@delx.cjb.net>
Message-ID: <fbad00235c69fe8945fd785e7f4e3eb0@delx.cjb.net>

On 26/05/2005, at 6:11 AM, James Bunton wrote:

>
> On 25/05/2005, at 11:56 PM, Andrew Bennetts wrote:
>
>> On Wed, May 25, 2005 at 11:30:52PM +1000, James Bunton wrote:
>> [...]
>>> The buildbot page didn't seem to say what tests were actually run, 
>>> only
>>> the warnings that occurred.
>>
>> The buildbot page does give the full test output in the "log" links, 
>> as well
>> as the full test.log file in the "test.log" links.  The "problems" and
>> "warnings" links are filtered versions of the "log" output.
>>
>> -Andrew.
>
> I thought they were all the same link :)
> Thanks
>
> ---
>
> James

What's the correct behaviour for a reactor if it has addReader/Writer 
called with an invalid file descriptor?

---

James




From itamar at itamarst.org  Sat Jun  4 10:10:56 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sat, 04 Jun 2005 10:10:56 -0400
Subject: [Twisted-Python] Re: [Twisted-commits] r13917 - Branching to
	native-gtk2-timers.
In-Reply-To: <E1DeSYv-0000gr-00@wolfwood>
References: <E1DeSYv-0000gr-00@wolfwood>
Message-ID: <1117894256.8230.31.camel@localhost.localdomain>

On Sat, 2005-06-04 at 00:55 -0600, Glyph Lefkowitz wrote:
> Author: glyph
> Date: Sat Jun  4 00:55:16 2005
> New Revision: 13917
> 
> Added:
>    branches/glyph/native-gtk2-timers/
>       - copied from r13916, trunk/
> Log:
> Branching to native-gtk2-timers.


I wouldn't bother. I tried this, and it's actually slower - the glib
event loop does an O(n) traversal of all timers on each iteration(!).




From vkshtkedag at chem-center.com  Sat Jun  4 21:25:40 2005
From: vkshtkedag at chem-center.com (vkshtkedag)
Date: Sun, 05 Jun 2005 01:25:40 -0000
Subject: [Twisted-Python] Diamond Equities
Message-ID: <0wPCPCp20w9F0864AnGT@chem-center.com>

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050605/49dd55c9/attachment.htm 

From alanjern at gmail.com  Sat Jun  4 23:47:07 2005
From: alanjern at gmail.com (Alan Jern)
Date: Sat, 4 Jun 2005 20:47:07 -0700
Subject: [Twisted-Python] Difficulty with twisted.web.client.getPage function
Message-ID: <579b3d800506042047690f9d8d@mail.gmail.com>

Hey, I'm new to Twisted and I've run into a problem that I can't solve.

I'm trying to write a simple Resource class that fetches a page from a
specified URL and returns it to the browser. I created a class called
MyResource in a .rpy file with the following two member functions:

def print_page (self, html):
        self.rq.write(html)
        self.rq.finish()

def render_GET (self, request):
        self.rq = request
        target = escape(request.args['target'][0])
        getPage(target).addCallback(self.print_page)
        return server.NOT_DONE_YET

When I run this script and send a request, the print_page function is
invoked but the variable 'html' has nothing in it. According to the
API and the examples I saw on the HOWTO section, this looks like it
ought to work. Clearly I'm missing something.

Any help would be greatly appreciated.

- Alan Jern



From Henning.Ramm at mediapro-gmbh.de  Sun Jun  5 16:49:49 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Sun, 5 Jun 2005 22:49:49 +0200
Subject: [Twisted-Python] wxreactor: dead close button
Message-ID: <F92274058556DE42B94B148EEFB9183949E701@exchange-03.suedkurier.de>

Hello, especially Itamar!

Consider the following minimal example:

import wx
from twisted.internet import wxreactor
wxreactor.install()
from twisted.internet import reactor

class Main(wx.App):

    def __init__(self):
        wx.App.__init__(self, redirect=False)
        reactor.registerWxApp(self)
        self.frame = wx.Frame(None, wx.ID_ANY, 'Test')
        self.frame.Show(True)

main = Main()
reactor.run()


At least on my system (WinXP, Py 2.3, wxPy 2.6.1, Twisted 2.0.1) the default close button of the window does nothing; same with your wxdemo.py; minimize/maximize works. Is there perhaps a bug in the destructor or event handler of wxreactor? Is there a simple workaround?


Best regards,
Henning Hraban Ramm
S?dkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From itamar at itamarst.org  Tue Jun  7 15:46:27 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 07 Jun 2005 15:46:27 -0400
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <F92274058556DE42B94B148EEFB9183949E701@exchange-03.suedkurier.de>
References: <F92274058556DE42B94B148EEFB9183949E701@exchange-03.suedkurier.de>
Message-ID: <1118173587.8527.51.camel@localhost.localdomain>

On Sun, 2005-06-05 at 22:49 +0200, Henning.Ramm at mediapro-gmbh.de wrote:

> At least on my system (WinXP, Py 2.3, wxPy 2.6.1, Twisted 2.0.1) the
> default close button of the window does nothing; same with your
> wxdemo.py; minimize/maximize works. Is there perhaps a bug in the
> destructor or event handler of wxreactor? Is there a simple
> workaround?

You probably need to hook up reactor.stop() to the event (callback?)
generated by the close button.




From dmitry at athabascau.ca  Tue Jun  7 15:47:31 2005
From: dmitry at athabascau.ca (Dmitry S. Makovey)
Date: Tue, 07 Jun 2005 13:47:31 -0600
Subject: [Twisted-Python] User manipulation question....
Message-ID: <200506071347.34679.dmitry@athabascau.ca>


Hi, 
First of all I'm using akadav1 which is library/application built on 
top of Twisted thus I post my question here.
I'm trying to make "akadav1" work "the way I like" and I face problem: 
I want akadav1 server to write out Files with permissions of 
currently connected user. Meaning that I'd like to run server as some 
regular user (say 'akadav') and when it operates on files do 
setuid(<currentl_user>) before any operation so it behaves same way 
as normal operation on FS would for that user. I came down to 
Resource class and see it possibly could be done extending this 
class. 
My problem right now is that I can't run server as unprivileged user 
and switch to other user's accounts. That would mean that I'd 
probably need:
1. run server as privileged user so I can setuid(...) any time I want
or
2. run two threads or so so that one thread is superuser-owned and the 
other one (the one that responds to requests) is non-privileged. 
First one will handle file operations since it can change uid 
on-the-flight and come back to normal.

I would prefer to implement second solution but I'm puzzled on where 
to start. Does twisted provide such capabilities out-of-the-box?

I'm not subscribed to the list, so please CC me on reply. 

-- 
Dmitry Makovey
Web Systems Administrator
Athabasca University
(780) 675-6245
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050607/22631cb2/attachment.pgp 

From foom at fuhm.net  Tue Jun  7 16:13:07 2005
From: foom at fuhm.net (James Y Knight)
Date: Tue, 7 Jun 2005 16:13:07 -0400
Subject: [Twisted-Python] User manipulation question....
In-Reply-To: <200506071347.34679.dmitry@athabascau.ca>
References: <200506071347.34679.dmitry@athabascau.ca>
Message-ID: <72303662-0C1B-45F4-AAFC-13F095C0BD23@fuhm.net>


On Jun 7, 2005, at 3:47 PM, Dmitry S. Makovey wrote:
> 1. run server as privileged user so I can setuid(...) any time I want
> or
> 2. run two threads or so so that one thread is superuser-owned and the
> other one (the one that responds to requests) is non-privileged.
> First one will handle file operations since it can change uid
> on-the-flight and come back to normal.

I assume by "thread" you mean "process", because threads in a single  
process can't have different owners.

> I would prefer to implement second solution but I'm puzzled on where
> to start. Does twisted provide such capabilities out-of-the-box?

Nope. The way I'd implement it is by having the unprivileged server  
execute a setuid-root binary which handles the file operations on  
behalf of a user. That binary should verify the user authentication  
data the unprivileged server sends it, and then setuid from root to  
the end-user uid, and then perform the requested operations.

James



From Henning.Ramm at mediapro-gmbh.de  Tue Jun  7 16:24:03 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Tue, 7 Jun 2005 22:24:03 +0200
Subject: [Twisted-Python] wxreactor: dead close button
Message-ID: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>

>> At least on my system (WinXP, Py 2.3, wxPy 2.6.1, Twisted 2.0.1) the
>> default close button of the window does nothing; same with your
>> wxdemo.py; minimize/maximize works. Is there perhaps a bug in the
>> destructor or event handler of wxreactor? Is there a simple
>> workaround?
>
>You probably need to hook up reactor.stop() to the event (callback?)
>generated by the close button.

It should generate wx.EVT_CLOSE, but it never fires. (I use the same OnExit function with a menu entry/event, and there it works.)
Without Twisted, no own handler is needed. But the wxreactor doesn't seem to block anything...

Are here any wxPython users around who managed to re-enable the close button?


Best regards,
Henning Hraban Ramm
S?dkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From bob at redivi.com  Tue Jun  7 19:41:48 2005
From: bob at redivi.com (Bob Ippolito)
Date: Tue, 7 Jun 2005 16:41:48 -0700
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>
References: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>
Message-ID: <7EB969BF-F2DF-4B2C-9BA9-CC1C7772CD8A@redivi.com>


On Jun 7, 2005, at 1:24 PM, <Henning.Ramm at mediapro-gmbh.de>  
<Henning.Ramm at mediapro-gmbh.de> wrote:

>>> At least on my system (WinXP, Py 2.3, wxPy 2.6.1, Twisted 2.0.1) the
>>> default close button of the window does nothing; same with your
>>> wxdemo.py; minimize/maximize works. Is there perhaps a bug in the
>>> destructor or event handler of wxreactor? Is there a simple
>>> workaround?
>>>
>>
>> You probably need to hook up reactor.stop() to the event (callback?)
>> generated by the close button.
>>
>
> It should generate wx.EVT_CLOSE, but it never fires. (I use the  
> same OnExit function with a menu entry/event, and there it works.)
> Without Twisted, no own handler is needed. But the wxreactor  
> doesn't seem to block anything...
>
> Are here any wxPython users around who managed to re-enable the  
> close button?

Why not just use the threadedselectreactor?

<http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- 
event-loops/>

-bob




From glyph at divmod.com  Tue Jun  7 21:34:26 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 07 Jun 2005 21:34:26 -0400
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <7EB969BF-F2DF-4B2C-9BA9-CC1C7772CD8A@redivi.com>
References: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>
	<7EB969BF-F2DF-4B2C-9BA9-CC1C7772CD8A@redivi.com>
Message-ID: <42A64B22.9090701@divmod.com>

Bob Ippolito wrote:

> Why not just use the threadedselectreactor?
> 
> <http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- 
> event-loops/>

Mary, perhaps the docs should start referring to this for the next minor 
release?  Can you start bothering someone to update the reactor 
selection documentation?  (Or has it been already?)



From exarkun at divmod.com  Tue Jun  7 22:14:22 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 7 Jun 2005 22:14:22 -0400
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <42A64B22.9090701@divmod.com>
Message-ID: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>

On Tue, 07 Jun 2005 21:34:26 -0400, Glyph Lefkowitz <glyph at divmod.com> wrote:
>Bob Ippolito wrote:
>>Why not just use the threadedselectreactor?
>>
>><http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- event- 
>>loops/>
>
>Mary, perhaps the docs should start referring to this for the next minor 
>release?  Can you start bothering someone to update the reactor selection 
>documentation?  (Or has it been already?)
>

Shining wonder though it may be, threaded select reactor is still missing some niceties - for example, unit tests.  It would be nice to have both documentation and tests before encouraging (well, any more than has been done) the world that tsr is the greatest thing since sliced bread.

There is also the matter of threaded non-select reactors.  What do I do if I want poll?  (The answer right now is "write threaded poll reactor" which is fine if _I_ am asking the question, but less than ideal from most people's perspective).

Jp



From bob at redivi.com  Tue Jun  7 22:46:14 2005
From: bob at redivi.com (Bob Ippolito)
Date: Tue, 7 Jun 2005 19:46:14 -0700
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>
References: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>
Message-ID: <344BA278-AADB-4D11-817A-2DDA2CD7A904@redivi.com>


On Jun 7, 2005, at 7:14 PM, Jp Calderone wrote:

> On Tue, 07 Jun 2005 21:34:26 -0400, Glyph Lefkowitz  
> <glyph at divmod.com> wrote:
>
>> Bob Ippolito wrote:
>>
>>> Why not just use the threadedselectreactor?
>>>
>>> <http://bob.pythonmac.org/archives/2005/04/17/twisted-and- 
>>> foreign- event- loops/>
>>>
>>
>> Mary, perhaps the docs should start referring to this for the next  
>> minor release?  Can you start bothering someone to update the  
>> reactor selection documentation?  (Or has it been already?)
>>
>>
>
> Shining wonder though it may be, threaded select reactor is still  
> missing some niceties - for example, unit tests.  It would be nice  
> to have both documentation and tests before encouraging (well, any  
> more than has been done) the world that tsr is the greatest thing  
> since sliced bread.

It's not the greatest thing since sliced bread, but it sucks a lot  
less than the other reactors which also aren't tested very well..  
since it's just a very small fork of the extremely stable, default,  
select reactor.

> There is also the matter of threaded non-select reactors.  What do  
> I do if I want poll?  (The answer right now is "write threaded poll  
> reactor" which is fine if _I_ am asking the question, but less than  
> ideal from most people's perspective).

The real answer is to extend the reactor interface so that all  
reactors can support the interleave API, and put the logic that deals  
with the threads somewhere else.. e.g. twisted.internet.interleave 
(reactor, function).

-bob




From nopa90 at gmail.com  Tue Jun  7 23:41:16 2005
From: nopa90 at gmail.com (John Janecek)
Date: Wed, 8 Jun 2005 11:41:16 +0800
Subject: [Twisted-Python] Getting rid of boiler plate in pb.RemoteCache
In-Reply-To: <mailman.3204.1118164709.458.twisted-python@twistedmatrix.com>
References: <mailman.3204.1118164709.458.twisted-python@twistedmatrix.com>
Message-ID: <6e2418ba05060720414705a027@mail.gmail.com>

Shows how to make it so MasterClass which inherit off DuckPond
And then show how to get method from Duck Pond into SlaveClass without
writing boiler plate code.
http://john.thetrotter.net/twistedpb.html

Not a perfect example but it works



From glyph at divmod.com  Wed Jun  8 01:11:14 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Wed, 08 Jun 2005 01:11:14 -0400
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>
References: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>
Message-ID: <42A67DF2.4000102@divmod.com>

Jp Calderone wrote:

> Shining wonder though it may be, threaded select reactor is still 
> missing some niceties - for example, unit tests.  It would be nice to 
> have both documentation and tests before encouraging (well, any more 
> than has been done) the world that tsr is the greatest thing since 
> sliced bread.

Saying it's the greatest thing since wxsupport.py is considerably less 
of a ringing endorsement :).  It should also have more tests, but then, 
what in Twisted shouldn't?  I'm just saying it needs docs.

> There is also the matter of threaded non-select reactors.  What do I do 
> if I want poll?  (The answer right now is "write threaded poll reactor" 
> which is fine if _I_ am asking the question, but less than ideal from 
> most people's perspective).

There is no reason to abandon existing _working_ reactors - for example, 
I have a soft spot for gtk2reactor.  Still, I think it makes sense to 
abandon the ones we know are broken and have no serious plan to fix, 
like wx (and maybe qt, from looking at the buildbot?).  Also it makes 
sense to have some least-common-denominator for working with really 
weird event loops, like the event loop one might find on a handheld 
device, such as fltk or the neutrino gui...  (I have never actually 
worked with either of those, they're just examples)



From mary-twisted at puzzling.org  Wed Jun  8 01:18:12 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 8 Jun 2005 15:18:12 +1000
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <42A64B22.9090701@divmod.com>
References: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>
	<7EB969BF-F2DF-4B2C-9BA9-CC1C7772CD8A@redivi.com>
	<42A64B22.9090701@divmod.com>
Message-ID: <20050608051812.GA31130@fuchsia.puzzling.org>

On Tue, Jun 07, 2005, Glyph Lefkowitz wrote:
> Mary, perhaps the docs should start referring to this for the next minor 
> release?  Can you start bothering someone to update the reactor 
> selection documentation?  (Or has it been already?)

I'm not aware of it being done. I'll try to schedule some bugging people
time. http://twistedmatrix.com/bugs/issue1077

-Mary



From girloncrack at yahoo.com  Wed Jun  8 03:29:25 2005
From: girloncrack at yahoo.com (Andrea Soong)
Date: Wed, 8 Jun 2005 00:29:25 -0700 (PDT)
Subject: [Twisted-Python] Need help getting started
Message-ID: <20050608072926.3460.qmail@web54101.mail.yahoo.com>

Hello, 
 
I'm taking a class in which we're supposed to be implementing a pseudo-proxy server that does some text parsing on web pages before passing them back to the client.  The proxy is supposed to be accessed via the URL and port that the server is running on, using an .rpy file.
 
I've looked through all of the available Twisted documentation, but just can't seem to get a handle on how to get started.  It's mostly setup questions - what code should go in which files?  How do I run it?  How do I test it?  There are a lot of code examples available, but very little information on how they interact and call each other.  It doesn't help that I am not too familiar with the OO-style API documentation.
 
I know that I need to be creating a subclass of HTTPClient, and creating a resource in the .rpy file.  I'm guessing that the .rpy file should create an instance of the HTTPClient subclass and use it to retrieve the requested URL (we have to get it line by line), but I don't understand how to create the instance.
 
A single good example that creates a web proxy server which simply retrieves the data line by line and displays it to the screen, plus the shell commands needed to run/test would be extremely helpful.  I am completely confused as to how the web server and .rpy file would interact.
 
I hope someone has the time and know-how to help me out.
THANKS


__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050608/c930586b/attachment.htm 

From nick at javacat.f2s.com  Wed Jun  8 03:51:05 2005
From: nick at javacat.f2s.com (nick at javacat.f2s.com)
Date: Wed,  8 Jun 2005 08:51:05 +0100
Subject: [Twisted-Python] Need help getting started
In-Reply-To: <20050608072926.3460.qmail@web54101.mail.yahoo.com>
References: <20050608072926.3460.qmail@web54101.mail.yahoo.com>
Message-ID: <1118217065.42a6a36981fb5@webmail.freedom2surf.net>

Have a look here for some examples -

http://xhaus.com/alan/python/proxies.html

Quoting Andrea Soong <girloncrack at yahoo.com>:

> Hello,
>
> I'm taking a class in which we're supposed to be implementing a pseudo-proxy
> server that does some text parsing on web pages before passing them back to
> the client.  The proxy is supposed to be accessed via the URL and port that
> the server is running on, using an .rpy file.
>
> I've looked through all of the available Twisted documentation, but just
> can't seem to get a handle on how to get started.  It's mostly setup
> questions - what code should go in which files?  How do I run it?  How do I
> test it?  There are a lot of code examples available, but very little
> information on how they interact and call each other.  It doesn't help that I
> am not too familiar with the OO-style API documentation.
>
> I know that I need to be creating a subclass of HTTPClient, and creating a
> resource in the .rpy file.  I'm guessing that the .rpy file should create an
> instance of the HTTPClient subclass and use it to retrieve the requested URL
> (we have to get it line by line), but I don't understand how to create the
> instance.
>
> A single good example that creates a web proxy server which simply retrieves
> the data line by line and displays it to the screen, plus the shell commands
> needed to run/test would be extremely helpful.  I am completely confused as
> to how the web server and .rpy file would interact.
>
> I hope someone has the time and know-how to help me out.
> THANKS
>
>
> __________________________________________________
> Do You Yahoo!?
> Tired of spam?  Yahoo! Mail has the best spam protection around
> http://mail.yahoo.com






From sc at linux.it  Wed Jun  8 06:03:58 2005
From: sc at linux.it (Stefano Canepa)
Date: Wed, 08 Jun 2005 12:03:58 +0200
Subject: [Twisted-Python] problem understand how to use a new created
	protocol
Message-ID: <1118225038.19110.31.camel@localhost.localdomain>

Dear all,
	I have a problem in understanding how to use the little protocol I have
written. First of all a little explanation of the protocol that is name
HL7. HL7 is based on simple messages that can be sent using serival
lines or network. To use HL7 over a network the application needs to use
HL7 LLP (Lower Level Protocol). LLP specification states that every
communicating part needs to have a client and a server. The server
(named accepting module) needs to receive a messagge and reply with an
ACK or NACK based on the syntax of the message. The client (named
initiating module) sends message and waits for ACK or NACK or timeouts.

Following the howto and reading all documents I was able to find on the
web, I coded the HL7 LLP accepting and initiating modules. 
Now my problem is: how can I pass the message to the application using
my LLP protocol? 
For example: the accepting module protocol is based on
basic.lineReceiver, it process the line and sends the appropriate reply.
Do I need to write a class in the application derived from my
HL7LLPAcceptingProtocol that process the message? 

I am really sorry to bother all of you with this sort of questions that
should sound stupid to you but I am really a newbie to twisted and need
some help.

TIA
Stefano

-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt? di un programmatore: pigrizia, impazienza e arroganza.
                                                              (Larry Wall)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050608/6793e1ac/attachment.pgp 

From Henning.Ramm at mediapro-gmbh.de  Wed Jun  8 08:46:36 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Wed, 8 Jun 2005 14:46:36 +0200
Subject: [Twisted-Python] wxreactor: dead close button
Message-ID: <F92274058556DE42B94B148EEFB9183949E706@exchange-03.suedkurier.de>

>Why not just use the threadedselectreactor?
><http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- 
>event-loops/>

Because it's only in the svn; but I found it, and it works now, thank you!
(I.e. my shutdown handlers don't work as they should, but I'll hopefully be able to fix that myself.)

BTW I adapted your wxdemo.py from "import *" to "import wx" style, see attachment.


Best regards,
Henning Hraban Ramm
S?dkurier Medienhaus / MediaPro
Support/Admin/Development Dept.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: wxdemo.py
Type: application/octet-stream
Size: 1378 bytes
Desc: wxdemo.py
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050608/70a7e030/attachment.obj 

From dmitry at athabascau.ca  Wed Jun  8 10:22:29 2005
From: dmitry at athabascau.ca (Dmitry S. Makovey)
Date: Wed, 08 Jun 2005 08:22:29 -0600
Subject: [Twisted-Python] User manipulation question....
In-Reply-To: <72303662-0C1B-45F4-AAFC-13F095C0BD23@fuhm.net>
References: <200506071347.34679.dmitry@athabascau.ca>
	<72303662-0C1B-45F4-AAFC-13F095C0BD23@fuhm.net>
Message-ID: <200506080822.33032.dmitry@athabascau.ca>

On June 7, 2005 02:13 pm, James Y Knight wrote:
> On Jun 7, 2005, at 3:47 PM, Dmitry S. Makovey wrote:
> > 1. run server as privileged user so I can setuid(...) any time I
> > want or
> > 2. run two threads or so so that one thread is superuser-owned
> > and the other one (the one that responds to requests) is
> > non-privileged. First one will handle file operations since it
> > can change uid on-the-flight and come back to normal.
>
> I assume by "thread" you mean "process", because threads in a
> single process can't have different owners.

yes. sorry for confusion.

> > I would prefer to implement second solution but I'm puzzled on
> > where to start. Does twisted provide such capabilities
> > out-of-the-box?
>
> Nope. The way I'd implement it is by having the unprivileged server
> execute a setuid-root binary which handles the file operations on
> behalf of a user. That binary should verify the user authentication
> data the unprivileged server sends it, and then setuid from root to
> the end-user uid, and then perform the requested operations.

I thought about it, but I'm sort of hesitant because it involves extra 
execs etc. which might reflect on performance. But so far that's the 
only simple options I have. Other one would be to do fork early in 
main program and detach from main process leaving pipes for 
communication etc. but then I've got another bottleneck - file 
operations. 

Thanks for idea I'll definitely give it a try I only wish that I could 
do it "less expensive way" :)

-- 
Dmitry Makovey
Web Systems Administrator
Athabasca University
(780) 675-6245

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050608/bcce06ff/attachment.pgp 

From ww at groovy.net  Wed Jun  8 10:46:03 2005
From: ww at groovy.net (William Waites)
Date: Wed, 8 Jun 2005 10:46:03 -0400
Subject: [Twisted-Python] User manipulation question....
In-Reply-To: <200506071347.34679.dmitry@athabascau.ca>
References: <200506071347.34679.dmitry@athabascau.ca>
Message-ID: <20050608144603.GR8097@groovy.net>

On Tue, Jun 07, 2005 at 01:47:31PM -0600, Dmitry S. Makovey wrote:
>
> My problem right now is that I can't run server as unprivileged user 
> and switch to other user's accounts. That would mean that I'd 
> probably need:
> 1. run server as privileged user so I can setuid(...) any time I want

Not the best idea, of course.

> 2. run two threads or so so that one thread is superuser-owned and the 
> other one (the one that responds to requests) is non-privileged. 
> First one will handle file operations since it can change uid 
> on-the-flight and come back to normal.
> 
> I would prefer to implement second solution but I'm puzzled on where 
> to start. Does twisted provide such capabilities out-of-the-box?

I'm reasonably sure it doesn't. You can't have threads in a single
process owned by different users. What you would have to do is
run different processes.

The only way I can think of right now, after only one coffee, 
is to have one twisted process that sits on the port
and waits for connections. When it gets one, it authenticates the
user then sends a message (pb maybe) to a superuser-owned process
whose only job is to fork(2) a user-owned process for file io
and to inform it how to talk with the original process that is 
holding the port... It would remain to write the file io <--> pb
glue I think...

Cheers,
-w



From ian at ianduggan.net  Wed Jun  8 12:27:33 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Wed, 8 Jun 2005 09:27:33 -0700
Subject: [Twisted-Python] -shutdown taps
Message-ID: <200506080927.33419.ian@ianduggan.net>


Does anyone have an init scripts for working with twistd and -shutdown 
scripts? I just tested out the shutdown persistence stuff with my daemon and 
it's very cool! My in-process requests don't die when I restart. Nice job.

I was hoping someone would have some shutdown/startup logic that handled 
possible error states, else I'm going to start working on one now.

--Ian



From itamar at itamarst.org  Wed Jun  8 13:19:25 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 08 Jun 2005 13:19:25 -0400
Subject: [Twisted-Python] -shutdown taps
In-Reply-To: <200506080927.33419.ian@ianduggan.net>
References: <200506080927.33419.ian@ianduggan.net>
Message-ID: <1118251165.9035.31.camel@localhost.localdomain>

On Wed, 2005-06-08 at 09:27 -0700, Ian Duggan wrote:
> Does anyone have an init scripts for working with twistd and -shutdown 
> scripts? I just tested out the shutdown persistence stuff with my daemon and 
> it's very cool! My in-process requests don't die when I restart. Nice job.

You probably shouldn't depend on this feature for persistence of data
that you care about, it's too fragile a storage mechanism.




From ian at ianduggan.net  Wed Jun  8 13:48:28 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Wed, 8 Jun 2005 10:48:28 -0700
Subject: [Twisted-Python] -shutdown taps
In-Reply-To: <1118251165.9035.31.camel@localhost.localdomain>
References: <200506080927.33419.ian@ianduggan.net>
	<1118251165.9035.31.camel@localhost.localdomain>
Message-ID: <200506081048.28903.ian@ianduggan.net>


On Wednesday 08 June 2005 10:19, Itamar Shtull-Trauring wrote:
> You probably shouldn't depend on this feature for persistence of data
> that you care about, it's too fragile a storage mechanism.

Yeah? My daemon keeps a small amount of state for "in process" requests 
related to long running background processes. I was hoping to have the daemon 
save the hash it was using, and restart the processes where they were when it 
restarted.

What about this method makes it fragile? I guess that's what I was hoping to 
code into a more robust state. It's a cool feature, IMHO, to have automagical 
daemon persistence.

--Ian



From ross at sourcelabs.com  Thu Jun  9 18:45:35 2005
From: ross at sourcelabs.com (Ross Jekel)
Date: Thu, 09 Jun 2005 15:45:35 -0700
Subject: [Twisted-Python] Any Message Queue recommendations
Message-ID: <1118357135.9683.12.camel@linux.site>

I'm writing several service processes that unfortunately need to
integrate with Java, PHP, and potentially C/C++ programs (non-legacy).
I've been searching for a message queuing layer that would support
Python/C++/PHP and Java clients (JMS is not necessarily a requirement). 

Short of writing my own messaging layer with twisted :-), I looked at
xmlBlaster which integrates well with all the languages but its complex
configuration makes it less that ideal to use. 

If anyone has any recommendations, could you please let me know.
Distributed message queuing combined with twisted services makes an good
combination. If there isn't anything better, I'll keep trying to make
xmlBlaster work and I'll contribute my twisted/xmlBlaster integration
when it is polished and solid.

Thanks,
Ross




From micktwomey at gmail.com  Thu Jun  9 18:56:27 2005
From: micktwomey at gmail.com (Michael Twomey)
Date: Thu, 9 Jun 2005 23:56:27 +0100
Subject: [Twisted-Python] -shutdown taps
In-Reply-To: <200506081048.28903.ian@ianduggan.net>
References: <200506080927.33419.ian@ianduggan.net>
	<1118251165.9035.31.camel@localhost.localdomain>
	<200506081048.28903.ian@ianduggan.net>
Message-ID: <50a522ca05060915564410af98@mail.gmail.com>

Hi,

The biggest thing which will kill the data is running the original tap
again, not the -shutdown one. Running the original tap will overwrite
the old shutdown one with a fresh instance. Since this can happen
easily (e.g. at critical oh-my-god-the-server-is-broken moments), you
really can't rely on the data being there. It's good for caching or
anything you don't mind losing, but you have to use conditional logic
in your startup script to figure out which tap to start with.

After experimenting with it and losing my data repeatedly I just wrote
the data I was interested in to a pickle. Since you have the
stopService hook in services, you can whack the persistence stuff in
there.

cheers,
  mick

On 6/8/05, Ian Duggan <ian at ianduggan.net> wrote:
> Yeah? My daemon keeps a small amount of state for "in process" requests
> related to long running background processes. I was hoping to have the daemon
> save the hash it was using, and restart the processes where they were when it
> restarted.
> 
> What about this method makes it fragile? I guess that's what I was hoping to
> code into a more robust state. It's a cool feature, IMHO, to have automagical
> daemon persistence.
> 
> --Ian
>



From bv at bnl.gov  Thu Jun  9 19:41:52 2005
From: bv at bnl.gov (Brett Viren)
Date: Thu, 09 Jun 2005 19:41:52 -0400
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <1118357135.9683.12.camel@linux.site> (Ross Jekel's message of
	"Thu, 09 Jun 2005 15:45:35 -0700")
References: <1118357135.9683.12.camel@linux.site>
Message-ID: <ir4zmtzayin.fsf@minos.phy.bnl.gov>

Hi Ross,

Ross Jekel <ross at sourcelabs.com> writes:

> I'm writing several service processes that unfortunately need to
> integrate with Java, PHP, and potentially C/C++ programs (non-legacy).
> I've been searching for a message queuing layer that would support
> Python/C++/PHP and Java clients (JMS is not necessarily a requirement). 

This sounds a lot like what I asked recently regarding a network
distributed system for producing and consuming "alarms" (basically
just your "messages").

Consider this:

 - XML-RPC for communications.  XML-RPC implementations exist in all
 your target languages.  Twisted has addition support beyond the
 built-in Python XML-RPC.

 - Write a central proxy server speaking XML-RPC, (implemented in
 Twisted, of course!).  Every message comes through this proxy.

 - Message producers do simple XML-RPC query/response (method call) to
 send a message to the central proxy server.

 - Then, depending on how you want your message consumers to behave
 you can either:

  a) have them poll the server.  This can work in two ways.  Either
  the proxy returns any messages collected since some time, or you can
  have the query block until a message returns.  Or a mixture of both.

  b) have consumers register with the proxy and provide a callback
  XML-RPC url, the consumers then go into listen mode and the proxy
  pushes messages as they come in.

Option (a) is good because your consumers can be behind a firewall.
It's not so good as it introduces latency and makes the proxy more
complex as it must handle the buffering of messages.

Option (b) is simpler and introduces less latency between message
production and consumption but does require your consumers to be able
to listen on a port and receive incoming connections.  If there is a
firewall between the consumers and the proxy or if your local network
overlords don't like programs listening on ports this won't do.

You probably want to also allow for message levels and/or classes so
consumers can pick and choose what they receive.

And, if you go this route be sure to post your work so I can steal it
for my project!

Regards,
-Brett.



From ross at sourcelabs.com  Thu Jun  9 22:24:14 2005
From: ross at sourcelabs.com (Ross Jekel)
Date: Thu, 09 Jun 2005 19:24:14 -0700
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <ir4zmtzayin.fsf@minos.phy.bnl.gov>
References: <1118357135.9683.12.camel@linux.site>
	<ir4zmtzayin.fsf@minos.phy.bnl.gov>
Message-ID: <42A8F9CE.1080709@sourcelabs.com>

Thanks Brett. Pretty much everything you describe is supposed to be in 
xmlBlaster using the xmlrpc interface. I can give you the start of a 
class that helps access xmlBlaster asynchronously if you want to check 
it out. At this point since I'd just be reinventing xmlBlaster, I'll 
spend a couple of days trying to get the queues working the way I want. 
I basically need the messages to be delivered once and only one to the 
subscriber.  Even if the subscriber was disconnected for a while and 
reconnects later I want the historical messages to be delivered once. 
This isn't rocket science, so I'm surprised it isn't available.

Brett Viren wrote:

>Hi Ross,
>
>Ross Jekel <ross at sourcelabs.com> writes:
>
>  
>
>>I'm writing several service processes that unfortunately need to
>>integrate with Java, PHP, and potentially C/C++ programs (non-legacy).
>>I've been searching for a message queuing layer that would support
>>Python/C++/PHP and Java clients (JMS is not necessarily a requirement). 
>>    
>>
>
>This sounds a lot like what I asked recently regarding a network
>distributed system for producing and consuming "alarms" (basically
>just your "messages").
>
>Consider this:
>
> - XML-RPC for communications.  XML-RPC implementations exist in all
> your target languages.  Twisted has addition support beyond the
> built-in Python XML-RPC.
>
> - Write a central proxy server speaking XML-RPC, (implemented in
> Twisted, of course!).  Every message comes through this proxy.
>
> - Message producers do simple XML-RPC query/response (method call) to
> send a message to the central proxy server.
>
> - Then, depending on how you want your message consumers to behave
> you can either:
>
>  a) have them poll the server.  This can work in two ways.  Either
>  the proxy returns any messages collected since some time, or you can
>  have the query block until a message returns.  Or a mixture of both.
>
>  b) have consumers register with the proxy and provide a callback
>  XML-RPC url, the consumers then go into listen mode and the proxy
>  pushes messages as they come in.
>
>Option (a) is good because your consumers can be behind a firewall.
>It's not so good as it introduces latency and makes the proxy more
>complex as it must handle the buffering of messages.
>
>Option (b) is simpler and introduces less latency between message
>production and consumption but does require your consumers to be able
>to listen on a port and receive incoming connections.  If there is a
>firewall between the consumers and the proxy or if your local network
>overlords don't like programs listening on ports this won't do.
>
>You probably want to also allow for message levels and/or classes so
>consumers can pick and choose what they receive.
>
>And, if you go this route be sure to post your work so I can steal it
>for my project!
>
>Regards,
>-Brett.
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>  
>





From nkeric at gmail.com  Thu Jun  9 23:19:30 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Fri, 10 Jun 2005 11:19:30 +0800
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on the
	same port?
Message-ID: <43c0d2b505060920193a8958ff@mail.gmail.com>

Hi all!

I'm trying to write a server which listens on port 12345 for both TLS
and normal TCP connections:

The client first connects to the server:12345 over TLS to obtain a
one-time share secret;
then the client closes(?) the TLS connection and uses the share secret
to communicate with the server:12345 over *normal TCP*.

Could this be done? If it could, pls enlighten me with some sample
code, BIG thanks!

- Eric



From golux at comcast.net  Fri Jun 10 00:11:10 2005
From: golux at comcast.net (Stephen Waterbury)
Date: Fri, 10 Jun 2005 00:11:10 -0400
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <43c0d2b505060920193a8958ff@mail.gmail.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
Message-ID: <42A912DE.30507@comcast.net>

Okay, enuffa this protocol mumbo-jumbo -- let's get
back to the really important shit.  Does anyone have a
32x32 twisted logo?  I have a larger one that I could
shrink down, but I *am* lazy, so if anybody has one let
me know!  (I mean with the image like the 16x16 used on
on the web site, not the *big* twisted logo.  If nobody
has one, I'll just make a 32x32 out of the 16x16.)

Cheers,
Steve



From bv at bnl.gov  Fri Jun 10 00:38:32 2005
From: bv at bnl.gov (Brett Viren)
Date: Fri, 10 Jun 2005 00:38:32 -0400
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <42A8F9CE.1080709@sourcelabs.com> (Ross Jekel's message of
	"Thu, 09 Jun 2005 19:24:14 -0700")
References: <1118357135.9683.12.camel@linux.site>
	<ir4zmtzayin.fsf@minos.phy.bnl.gov> <42A8F9CE.1080709@sourcelabs.com>
Message-ID: <ir4ll5ibzcn.fsf@minos.phy.bnl.gov>

Ross Jekel <ross at sourcelabs.com> writes:

> Thanks Brett. Pretty much everything you describe is supposed to be in
> xmlBlaster using the xmlrpc interface.

Indeed.  I should have looked up xmlBlaster before replying.  I didn't
realize what it was.  It looks pretty cool and just what I need as
well.  As the page says:

  This is the publish/subscribe middleware server you have needed many
  times before, now available for free to glue together your
  distributed client/server application.

Only minor downer is that it isn't written in Python....


It even has some kind of authentication which we will probably end up
requiring.  I've been thinking about how to bolt on an SSH port
forwarding based authentication to my scheme.  That may still be worth
pursuing as my environment tends to let SSH through firewalls.

>  I can give you the start of a
> class that helps access xmlBlaster asynchronously if you want to check
> it out.

Yes, that would be great, thanks.

-Brett.



From daedalus at eigenmagic.com  Fri Jun 10 01:06:57 2005
From: daedalus at eigenmagic.com (Justin Warren)
Date: Fri, 10 Jun 2005 15:06:57 +1000
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on
	the same port?
In-Reply-To: <43c0d2b505060920193a8958ff@mail.gmail.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
Message-ID: <1118380017.2672.27.camel@norbert>

On Fri, 2005-06-10 at 11:19 +0800, Eric Hsu wrote:
> Hi all!
> 
> I'm trying to write a server which listens on port 12345 for both TLS
> and normal TCP connections:
> 
> The client first connects to the server:12345 over TLS to obtain a
> one-time share secret;
> then the client closes(?) the TLS connection and uses the share secret
> to communicate with the server:12345 over *normal TCP*.
> 
> Could this be done? If it could, pls enlighten me with some sample
> code, BIG thanks!

That sounds a bit.. odd. TLS runs over the top of some sort of reliable
transport protocol, like TCP. A server would thus be listening for TCP
connections. What you do after the connection is accepted determines
whether you negotiate TLS, echo stuff back or do whatever else your
server does. If you've already negotiated a TLS connection and thus have
a secure communications channel, why would you want to turn it off and
go back to normal, unencrypted comms?

What is the problem you are trying to solve here?

I mean, in theory, yes, you could do what you're proposing. Why do you
want to, though?

-- 
Justin Warren <daedalus at eigenmagic.com>




From nkeric at gmail.com  Fri Jun 10 04:14:06 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Fri, 10 Jun 2005 16:14:06 +0800
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on the
	same port?
In-Reply-To: <1118380017.2672.27.camel@norbert>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
Message-ID: <43c0d2b505061001147782b353@mail.gmail.com>

Hi Justin,

Thank you for you quick reply :)

> What is the problem you are trying to solve here?
> 
> I mean, in theory, yes, you could do what you're proposing. Why do you
> want to, though?

I'm trying to write a TURN server:

http://www.ietf.org/internet-drafts/draft-rosenberg-midcom-turn-07.txt

The TURN client which is behind a NAT will ask the TURN server (with
public address) to allocate a public transport address for it to
receive data from outside.

There're two requests while the client trying to allocate a public
transport address from the TURN server:
 * Share Secret Request: over TLS; to obtain a one-time username and
passwd and keep the passwd as the share secret of both side (the
server and the client)
 * Allocate Request: to allocate a public transport address from the server

As the draft said:

"A TURN server MUST be prepared to receive  Binding (should be
Allocate - eric) Requests over TCP and UDP." (P10)

"The Allocate Request MUST be sent to the same IP address and port as the Shared
Secret Request. This is because one time passwords are expected to be
host-specific." (P20)

That means both the Share Secret Request (over TLS) and Allocate
Request will be sent to the same IP and port of the server.

Then, the draft said:

"The client SHOULD close its connection when it has completed
allocating username and passwords." (P19)

So, while the client sends the Allocate Request to the server over
TCP, the process would look like this (assuming the server is
listening on port 12345 for TLS connection):

* the client sends the Share Secret Request to server:12345 _over TLS_
and obtains a one-time username and passwd
* the client closes the TLS connection
* the client sends the Allocate Request to server:12345 _again_ to
allocate a public transport address...

It seems that I have to implement what I've mentioned in my previous mail?
I'm not a native English speaker, and TURN is only a draft, maybe I've
misunderstood something?



From screwtape at froup.com  Fri Jun 10 07:51:25 2005
From: screwtape at froup.com (Tim Allen)
Date: Fri, 10 Jun 2005 21:51:25 +1000
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <42A912DE.30507@comcast.net>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<42A912DE.30507@comcast.net>
Message-ID: <0aa49a10d63396c4735af4e0fe15e4fe@froup.com>

On 10 Jun 2005, at 14:11, Stephen Waterbury wrote:
> Okay, enuffa this protocol mumbo-jumbo -- let's get
> back to the really important shit.

:D

> Does anyone have a
> 32x32 twisted logo?  I have a larger one that I could
> shrink down, but I *am* lazy, so if anybody has one let
> me know!

You mean a 32x32 version of the square-snake on the right-hand edge of 
this:

	http://twistedmatrix.com/images/header-logo.png

?

I could probably draw one up in GIMP pretty easily. Even easier if you 
don't mind right-angles instead of the sexy perspective look that 
sample image uses.




From npk.gangadhar at gmail.com  Fri Jun 10 11:06:59 2005
From: npk.gangadhar at gmail.com (Gangadhar NPK)
Date: Fri, 10 Jun 2005 20:36:59 +0530
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <1118357135.9683.12.camel@linux.site>
References: <1118357135.9683.12.camel@linux.site>
Message-ID: <61b4e70f05061008062755b3db@mail.gmail.com>

I don't know how much of a use and close to your requirement is, you
can check if the spread toolkit (http://spread.org) can be of any help
to you.


On 6/10/05, Ross Jekel <ross at sourcelabs.com> wrote:
> I'm writing several service processes that unfortunately need to
> integrate with Java, PHP, and potentially C/C++ programs (non-legacy).
> I've been searching for a message queuing layer that would support
> Python/C++/PHP and Java clients (JMS is not necessarily a requirement).
> 
> Short of writing my own messaging layer with twisted :-), I looked at
> xmlBlaster which integrates well with all the languages but its complex
> configuration makes it less that ideal to use.
> 
> If anyone has any recommendations, could you please let me know.
> Distributed message queuing combined with twisted services makes an good
> combination. If there isn't anything better, I'll keep trying to make
> xmlBlaster work and I'll contribute my twisted/xmlBlaster integration
> when it is polished and solid.
> 
> Thanks,
> Ross
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From golux at comcast.net  Fri Jun 10 11:53:28 2005
From: golux at comcast.net (Stephen Waterbury)
Date: Fri, 10 Jun 2005 11:53:28 -0400
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <0aa49a10d63396c4735af4e0fe15e4fe@froup.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>	<42A912DE.30507@comcast.net>
	<0aa49a10d63396c4735af4e0fe15e4fe@froup.com>
Message-ID: <42A9B778.50903@comcast.net>

Tim Allen wrote:
> You mean a 32x32 version of the square-snake on the right-hand edge of 
> this:
> 
>     http://twistedmatrix.com/images/header-logo.png
> 
> ?

Yep, and I guess you aroused my graphics lust enough (obsessiveness
trumps laziness every time ;) ... attached is a "smoothed" 32x32
version of the 16x16 logo that I did using kiconedit.  It's a
contribution, if anyone wants it.  Of course, if an official Twisted
32x32 is ever created, I'll happily to use that instead.  :)

- Steve
-------------- next part --------------
A non-text attachment was scrubbed...
Name: twisted32logo.png
Type: image/png
Size: 970 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050610/fb78d493/attachment.png 

From ross at sourcelabs.com  Fri Jun 10 13:25:12 2005
From: ross at sourcelabs.com (Ross Jekel)
Date: Fri, 10 Jun 2005 10:25:12 -0700
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <61b4e70f05061008062755b3db@mail.gmail.com>
References: <1118357135.9683.12.camel@linux.site>
	<61b4e70f05061008062755b3db@mail.gmail.com>
Message-ID: <1118424312.6959.2.camel@linux.site>

Thank you. Yes, Spread might be another good option as it supports
Python, Java, Perl, and C/C++. I was also able to get a PHP client
example from Advanced PHP Programming book online.

http://www.samspublishing.com/bookstore/product.asp?
isbn=0672325616&rl=1#

I almost used Spread at a previous company when we were building a
cluster and we wanted total ordering of messages.

On Fri, 2005-06-10 at 20:36 +0530, Gangadhar NPK wrote:
> I don't know how much of a use and close to your requirement is, you
> can check if the spread toolkit (http://spread.org) can be of any help
> to you.
> 
> 





From dgray at omniti.com  Fri Jun 10 17:25:49 2005
From: dgray at omniti.com (Dave Gray)
Date: Fri, 10 Jun 2005 17:25:49 -0400
Subject: [Twisted-Python] Difficulty with twisted.web.client.getPage
	function
In-Reply-To: <579b3d800506042047690f9d8d@mail.gmail.com>
References: <579b3d800506042047690f9d8d@mail.gmail.com>
Message-ID: <42AA055D.6060701@omniti.com>

Alan Jern wrote:
> Hey, I'm new to Twisted and I've run into a problem that I can't solve.
> 
> I'm trying to write a simple Resource class that fetches a page from a
> specified URL and returns it to the browser. I created a class called
> MyResource in a .rpy file with the following two member functions:
> 
> def print_page (self, html):
>         self.rq.write(html)
>         self.rq.finish()
> 
> def render_GET (self, request):
>         self.rq = request
>         target = escape(request.args['target'][0])
>         getPage(target).addCallback(self.print_page)
>         return server.NOT_DONE_YET
> 
> When I run this script and send a request, the print_page function is
> invoked but the variable 'html' has nothing in it. According to the
> API and the examples I saw on the HOWTO section, this looks like it
> ought to work. Clearly I'm missing something.

You will probably get more enthusiastic responses to questions like this 
on twisted-web (cc'd), FYI

That said, this works for me:

---fetchpage.tac---
# run me with twistd -noy fetchpage.tac
from twisted.web import server
from twisted.web.resource import Resource
from twisted.web.client import getPage

from cgi import escape
class Foo(Resource):
     isLeaf=True
     def print_page (self, html):
         self.rq.write(html)
         self.rq.finish()

     def render_GET (self, request):
         self.rq = request
         target = escape(request.args['target'][0])
         getPage(target).addCallback(self.print_page)
         return server.NOT_DONE_YET

resource = Foo()
site = server.Site(resource)

from twisted.application import service, internet
application = service.Application("PageFetcher")
internet.TCPServer(9000, site).setServiceParent(application)

# and then from your command prompt:
 >  telnet localhost 9000
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
GET /?target=http://google.com/ HTTP/1.0
Host: localhost

HTTP/1.0 200 OK
Date: Fri, 10 Jun 2005 21:20:49 GMT
Content-type: text/html
Server: TwistedWeb/2.0.0

<html><head><meta http-equiv="content-type" content="text/html; 
charset=ISO-8859-1"><title>Google</title><style><!--
etc etc



From matt.feifarek at gmail.com  Fri Jun 10 18:43:13 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Fri, 10 Jun 2005 18:43:13 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
Message-ID: <6fb6dbfe05061015435de21846@mail.gmail.com>

Hello.

I'm using Twisted 1.3.0 on python2.4 on an Ubuntu-Hoary x86 Linux box.

I'm using twisted and spawnProcess() with a Queue structure to chain
processes that need to be called (specifically, imagemagick commands).
I use the "processEnded" event/method of t.i.p.ProcessProtocol to go
from one task to the next. Twisted shares a python process with a
multi-threaded web-app-kit (Webware) so it has to be run in a thread.

This worked well on other older versions of twisted and older versions
of python; also on linux. I've tracked down the problem to be twisted
itself (or my incorrect use of it) rather than my code. This example
illustrates it:

-------------------------------------------------
from twisted.internet import reactor
from twisted.internet.protocol import ProcessProtocol

class MyProt( ProcessProtocol ):
	def processEnded(self, reason):
		print "ended.", reason

executable = '/bin/touch'
args = ( '/tmp/foo.txt', )
args = (executable,) + tuple(args)

reactor.spawnProcess( MyProt(), executable, args )
reactor.callLater( 5, reactor.stop )

#reactor.run()
reactor.run(installSignalHandlers=False)
-------------------------------------------------

As is, this code never runs the "processEnded()" method of MyProt().
If I change the reactor.run() parameter to leave the signal handlers
on, it works.

Note that I need to leave the signal handlers turned off because I
can't run the reactor in the main thread; Webware needs that.

I also know that the subprocess is giving up its file descriptors; I
can see that if I put more print statements into MyProt(). And I know
that the subprocess is working; /tmp/foo.txt is there.

It seems that somehow the reactor is using signals to notice when a
process has ended; this makes a certain ammount of sense intuitively,
though I don't understand the nitty-gritty of processes and signals at
all. And more importantly, this has worked before on other
combinations of twisted/python.

Is this a bug? If so, has it been fixed? If not, what should I do to
detect when a spawned process is finished?

Thanks very much. Twisted rocks.



From glyph at divmod.com  Fri Jun 10 18:44:52 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Fri, 10 Jun 2005 18:44:52 -0400
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <42A9B778.50903@comcast.net>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>	<42A912DE.30507@comcast.net>	<0aa49a10d63396c4735af4e0fe15e4fe@froup.com>
	<42A9B778.50903@comcast.net>
Message-ID: <42AA17E4.3050408@divmod.com>

Stephen Waterbury wrote:

> Yep, and I guess you aroused my graphics lust enough (obsessiveness
> trumps laziness every time ;) ... attached is a "smoothed" 32x32
> version of the 16x16 logo that I did using kiconedit.  It's a
> contribution, if anyone wants it.  Of course, if an official Twisted
> 32x32 is ever created, I'll happily to use that instead.  :)

Thanks Steve - until further notice, I guess this is the "official" one :)



From ross at sourcelabs.com  Fri Jun 10 18:47:26 2005
From: ross at sourcelabs.com (Ross Jekel)
Date: Fri, 10 Jun 2005 15:47:26 -0700
Subject: [Twisted-Python] twistd stopService processing question
Message-ID: <1118443646.6958.15.camel@linux.site>

I am building and xmlBlaster XML-RPC client/server to interact with the
xmlBlaster server. xmlBlaster really works best if the client sends a
disconnect API call before shutting down, otherwise you sometimes won't
be able to reconnect the client until the next heartbeat timesout.

I thought the best place way to do this would be to create a simple
service that could get notified via stopService(), then return the
deferred from the xmlrpc.Proxy.callRemote function for the XML-RPC
xmlBlaster disconnect API call.

The issue is that if I do this, everything seems to work but I get this
error raised when I ^C my service:

2005/06/10 15:30 PDT [QueryProtocol,client] Traceback (most recent call
last):
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/defer.py", line
328, in _runCallbacks
            self.result = callback(self.result, *args, **kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/base.py", line
384, in _cbContinueSystemEvent
            self._continueSystemEvent(eventType)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/base.py", line
392, in _continueSystemEvent
            callable(*args, **kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/base.py", line
353, in disconnectAll
            failure.Failure(main.CONNECTION_LOST))
        --- <exception caught here> ---
          File
"/usr/local/lib/python2.4/site-packages/twisted/python/log.py", line 56,
in callWithLogger
            return callWithContext({"system": lp}, func, *args, **kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/python/log.py", line 41,
in callWithContext
            return context.call({ILogContext: newCtx}, func, *args,
**kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/python/context.py", line
52, in callWithContext
            return self.currentContext().callWithContext(ctx, func,
*args, **kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/python/context.py", line
31, in callWithContext
            return func(*args,**kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/tcp.py", line
557, in connectionLost
            self.connector.connectionLost(reason)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/base.py", line
655, in connectionLost
            self.factory.clientConnectionLost(self, reason)
          File
"/usr/local/lib/python2.4/site-packages/twisted/web/xmlrpc.py", line
294, in clientConnectionLost
            self.deferred.errback(reason)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/defer.py", line
276, in errback
            self._startRunCallbacks(fail)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/defer.py", line
303, in _startRunCallbacks
            raise AlreadyCalledError
        twisted.internet.defer.AlreadyCalledError:

I suppose I can probably ignore this but it makes it look like my
service isn't shutting down cleanly.

Any advice here? I include code snippets below to give you an idea what
I'm doing.

Ross

class SimpleService(service.Service):
    def stopService(self):
        global blaster
        return blaster.disconnect().addCallback(
            lambda res: service.Service.stopService(self))


# Create the application
a = service.Application("SMTP Server")

# Create a service wrapper so we can get notified of stopService
SimpleService().setServiceParent(service.IServiceCollection(a))

# Create an XML-RPC client/server for xmlBlaster
# TODO - come up with better server site creation
print 'INFO; Creating XML-RPC client/server'
s = SimpleSite()
blaster = xmlBlaster.xmlBlaster('http://127.0.0.2:8080', s)
internet.TCPServer(blaster.serverPort,
  server.Site(s)).setServiceParent(a)


xmlBlaster looks like this:

class xmlBlaster(xmlrpc.Proxy, xmlrpc.XMLRPC):
    def __init__(self, url, parent, serverPort = 7080):
        xmlrpc.Proxy.__init__(self, url)
        xmlrpc.XMLRPC.__init__(self)
        self.orig_url = url
        self.sessionId = None
        self.serverPort = serverPort
        self.subscriptions = {}
        parent.putChild('RC2', self)

    def disconnect(self):
        return self.callRemote('authenticate.disconnect',
            self.sessionId,
            "<qos/>).addCallback(self.__cbDisconnected)

    def __cbDisconnected(self, result):
        self.sessionId = None





From itamar at itamarst.org  Fri Jun 10 19:35:48 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 10 Jun 2005 19:35:48 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe05061015435de21846@mail.gmail.com>
References: <6fb6dbfe05061015435de21846@mail.gmail.com>
Message-ID: <1118446548.8272.17.camel@localhost.localdomain>

> reactor.run(installSignalHandlers=False)
> -------------------------------------------------
> 
> As is, this code never runs the "processEnded()" method of MyProt().
> If I change the reactor.run() parameter to leave the signal handlers
> on, it works.
> 
> Note that I need to leave the signal handlers turned off because I
> can't run the reactor in the main thread; Webware needs that.

Register the same SIGCHLD handler twisted does in the main thread, that
should work (they need to be reentrancy-safe anyway so the fact it's
called from a different thread is fine). Possibly a more general
solution could be devised for this, anyone have suggestions?




From golux at comcast.net  Fri Jun 10 20:34:14 2005
From: golux at comcast.net (Stephen Waterbury)
Date: Fri, 10 Jun 2005 20:34:14 -0400
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <42AA17E4.3050408@divmod.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>	<42A912DE.30507@comcast.net>	<0aa49a10d63396c4735af4e0fe15e4fe@froup.com>	<42A9B778.50903@comcast.net>
	<42AA17E4.3050408@divmod.com>
Message-ID: <42AA3186.30204@comcast.net>

Glyph Lefkowitz wrote:
> Stephen Waterbury wrote:
> 
>> Yep, and I guess you aroused my graphics lust enough (obsessiveness
>> trumps laziness every time ;) ... attached is a "smoothed" 32x32
>> version of the 16x16 logo that I did using kiconedit.  It's a
>> contribution, if anyone wants it.  Of course, if an official Twisted
>> 32x32 is ever created, I'll happily to use that instead.  :)
                          ^^^^^^^^^^^^^^^^^^^^^^^^
Oops ... Engrish!  :)

> Thanks Steve - until further notice, I guess this is the "official" one :)

Cool!  In that case, I'll happily to use mine.  ;)

Steve



From girloncrack at yahoo.com  Sat Jun 11 03:28:38 2005
From: girloncrack at yahoo.com (Andrea Soong)
Date: Sat, 11 Jun 2005 00:28:38 -0700 (PDT)
Subject: [Twisted-Python] Using lineReceived with HTTP requests
Message-ID: <20050611072838.57692.qmail@web54107.mail.yahoo.com>

Hi all,
 
First off, I'd like to say thanks to Ken Whitesell for giving me some much needed help.
 
Here's my problem:  I am using an HTTPClient instance to connect to a webpage, and am trying to retrieve its contents and display to the screen line by line, using the lineReceived method.  This is all being done in an .rpy file.  For some reason, I am only receiving the header information:
---------------------------------------------
[start line received]
       HTTP/1.0 200 OK
[end line received]
[start line received]
       Cache-Control: private
[end line received]
[start line received]
       Content-Type: text/html
[end line received]
[start line received]
       Set-Cookie: PREF=ID=aacd1eed2e435ca5:TM=1118474192:LM=1118474192:S=QyMnwhj46cXbhy_1; expires=Sun, 17-Jan-2038 19:14:07 GMT; path=/; domain=.google.com
[end line received]
[start line received]
       Server: GWS/2.1
[end line received]
[start line received]
       Date: Sat, 11 Jun 2005 07:16:32 GMT
[end line received]
[start line received]
       Connection: Close
[end line received]
[start line received]
       
[end line received]
---------------------------------------------
 
Does anyone know if there is some incompatibility in using lineReceived with the format of a webpage (i.e. maybe they are missing the standard EOL delimiters)?  dataReceived works fine and outputs the whole webpage at once.  
 
Also, I am using handleRequestEnd to detect the end of the transmission and call request.finish(),  but it does not seem to be getting called at all - the browser just keeps waiting for more data.  I've put a simple request.write("handleRequestEnd called") call on the first line of the method and it does not get written to the screen.  I can't find any explanation for how to use most of the methods in the HTTPClient class in the API - is there a better way to do this (i.e. one that works!) ?
 
 
Thanks,
Andrea


		
---------------------------------
Discover Yahoo!
 Have fun online with music videos, cool games, IM & more. Check it out!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050611/177451b5/attachment.htm 

From girloncrack at yahoo.com  Sat Jun 11 03:38:17 2005
From: girloncrack at yahoo.com (Andrea Soong)
Date: Sat, 11 Jun 2005 00:38:17 -0700 (PDT)
Subject: [Twisted-Python] Using lineReceived with HTTP requests
In-Reply-To: <20050611072838.57692.qmail@web54107.mail.yahoo.com>
Message-ID: <20050611073817.19497.qmail@web54102.mail.yahoo.com>


This seems like it has something to do with my problem, although it doesn't offer any clues as to a solution:

"Unfortunately, handling arbitrary data chunks is a hard way to code a server. This is why twisted has many classes sitting in submodules of the twisted.protocols package which give higher level interface to the data. For line oriented protocols, LineReceiver translates the low-level dataReceived events into lineReceived events. However, the first naive implementation of LineReceiver proved to be too simple. Protocols like HTTP/1.1 or Freenet have packets which begin with header lines that include length information, and then byte streams. LineReceiver was rewritten to have a simple interface for switching at the protocol layer between line-oriented parts and byte-stream parts. "
(from http://www.python10.org/p10-papers/09/index.htm)

Andrea Soong <girloncrack at yahoo.com> wrote:Hi all,
 
First off, I'd like to say thanks to Ken Whitesell for giving me some much needed help.
 
Here's my problem:  I am using an HTTPClient instance to connect to a webpage, and am trying to retrieve its contents and display to the screen line by line, using the lineReceived method.  This is all being done in an .rpy file.  For some reason, I am only receiving the header information:
---------------------------------------------
[start line received]
       HTTP/1.0 200 OK
[end line received]
[start line received]
       Cache-Control: private
[end line received]
[start line received]
       Content-Type: text/html
[end line received]
[start line received]
       Set-Cookie: PREF=ID=aacd1eed2e435ca5:TM=1118474192:LM=1118474192:S=QyMnwhj46cXbhy_1; expires=Sun, 17-Jan-2038 19:14:07 GMT; path=/; domain=.google.com
[end line received]
[start line received]
       Server: GWS/2.1
[end line received]
[start line received]
       Date: Sat, 11 Jun 2005 07:16:32 GMT
[end line received]
[start line received]
       Connection: Close
[end line received]
[start line received]
       
[end line received]
---------------------------------------------
 
Does anyone know if there is some incompatibility in using lineReceived with the format of a webpage (i.e. maybe they are missing the standard EOL delimiters)?  dataReceived works fine and outputs the whole webpage at once.  
 
Also, I am using handleRequestEnd to detect the end of the transmission and call request.finish(),  but it does not seem to be getting called at all - the browser just keeps waiting for more data.  I've put a simple request.write("handleRequestEnd called") call on the first line of the method and it does not get written to the screen.  I can't find any explanation for how to use most of the methods in the HTTPClient class in the API - is there a better way to do this (i.e. one that works!) ?
 
 
Thanks,
Andrea



---------------------------------
Discover Yahoo!
Have fun online with music videos, cool games, IM & more. Check it out!_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


		
---------------------------------
Do you Yahoo!?
 Yahoo! Mail - Find what you need with new enhanced search. Learn more.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050611/34235645/attachment.htm 

From exarkun at divmod.com  Sat Jun 11 11:04:53 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sat, 11 Jun 2005 11:04:53 -0400
Subject: [Twisted-Python] Using lineReceived with HTTP requests
In-Reply-To: <20050611072838.57692.qmail@web54107.mail.yahoo.com>
Message-ID: <20050611150453.5047.378421006.divmod.quotient.1011@ohm>

On Sat, 11 Jun 2005 00:28:38 -0700 (PDT), Andrea Soong <girloncrack at yahoo.com> wrote:
>Hi all,
>
>First off, I'd like to say thanks to Ken Whitesell for giving me some much needed help.
>
>Here's my problem:  I am using an HTTPClient instance to connect to a webpage, and am trying to retrieve its contents and display to the screen line by line, using the lineReceived method.  This is all being done in an .rpy file.  For some reason, I am only receiving the header information:

The header section of an HTTP response is line-oriented.  The body section is not.  HTTPClient uses both of LineReceivers modes, so for the header section, lineReceived gets called, then for the body section, rawDataReceived gets called.

If you override both of these, you should see all of the data from the server.  Of course, the data passed to rawDataReceive isn't going to be broken up into lines...

Jp



From matt.feifarek at gmail.com  Sat Jun 11 11:08:12 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Sat, 11 Jun 2005 11:08:12 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <1118446548.8272.17.camel@localhost.localdomain>
References: <6fb6dbfe05061015435de21846@mail.gmail.com>
	<1118446548.8272.17.camel@localhost.localdomain>
Message-ID: <6fb6dbfe050611080874419f5a@mail.gmail.com>

On 6/10/05, Itamar Shtull-Trauring <itamar at itamarst.org> wrote:
> Register the same SIGCHLD handler twisted does in the main thread, that
> should work (they need to be reentrancy-safe anyway so the fact it's
> called from a different thread is fine). Possibly a more general
> solution could be devised for this, anyone have suggestions?

Thanks.

So this behavior is by design? Again, it DID work before; for the last
year or so, I've been using this code in production on a few servers.

Perhaps a note could be made in the docs that ProcessProtocol doesn't
work in this case.

This will make it pretty hard to integrate into other worlds. I'm not
sure that I can over-ride the signal handling in Webware and register
handlers. Other bits of python libraries might be the same way.

I look forward to any "more general solution" that anyone can come up with!

Would the "twisted way" would be to run the reactor in a different
python process and talk to it via rpc? The problem, of course, is that
the best way to do that on the client end of the rpc is twisted, too!

Thanks again.



From exarkun at divmod.com  Sat Jun 11 11:35:37 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sat, 11 Jun 2005 11:35:37 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe050611080874419f5a@mail.gmail.com>
Message-ID: <20050611153537.5047.1641691101.divmod.quotient.1023@ohm>

On Sat, 11 Jun 2005 11:08:12 -0400, Matt Feifarek <matt.feifarek at gmail.com> wrote:
>On 6/10/05, Itamar Shtull-Trauring <itamar at itamarst.org> wrote:
>> Register the same SIGCHLD handler twisted does in the main thread, that
>> should work (they need to be reentrancy-safe anyway so the fact it's
>> called from a different thread is fine). Possibly a more general
>> solution could be devised for this, anyone have suggestions?
>
>Thanks.
>
>So this behavior is by design? Again, it DID work before; for the last
>year or so, I've been using this code in production on a few servers.

Yep, and always has been.  If it ever worked, it was by accident (I really don't see how it could have, though, so I can't begin to guess what might have changed to stop it).

>
>Perhaps a note could be made in the docs that ProcessProtocol doesn't
>work in this case.
>
>This will make it pretty hard to integrate into other worlds. I'm not
>sure that I can over-ride the signal handling in Webware and register
>handlers. Other bits of python libraries might be the same way.
>
>I look forward to any "more general solution" that anyone can come up with!

Here's one:

  def reapChildren():
      from twisted.internet import reactor, task
      t = task.LoopingCall(reactor._handleSigchld, None, None)
      return t.start(5)

Of course, it uses a non-public method of reactor (but installSignalHandlers is a non-public argument to reactor.run(), so you're already treading on thin ice :)

Jp



From foom at fuhm.net  Sat Jun 11 11:40:11 2005
From: foom at fuhm.net (James Y Knight)
Date: Sat, 11 Jun 2005 11:40:11 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe050611080874419f5a@mail.gmail.com>
References: <6fb6dbfe05061015435de21846@mail.gmail.com>
	<1118446548.8272.17.camel@localhost.localdomain>
	<6fb6dbfe050611080874419f5a@mail.gmail.com>
Message-ID: <F7509306-B75B-4CFC-891C-B0685ABB88B4@fuhm.net>


On Jun 11, 2005, at 11:08 AM, Matt Feifarek wrote:
> So this behavior is by design? Again, it DID work before; for the last
> year or so, I've been using this code in production on a few servers.
>
> Perhaps a note could be made in the docs that ProcessProtocol doesn't
> work in this case.

There is one. It logs "spawnProcess called, but the SIGCHLD handler  
is not installed. This probably means you have not yet called  
reactor.run, or called reactor.run(installSignalHandler=0). You will  
probably never see this process finish, and it may become a zombie  
process." However, your example doesn't have logging setup, so you  
don't see that message.

> This will make it pretty hard to integrate into other worlds. I'm not
> sure that I can over-ride the signal handling in Webware and register
> handlers. Other bits of python libraries might be the same way.
>
> I look forward to any "more general solution" that anyone can come  
> up with!

If you cannot override the signal handling, do something like:

from twisted.internet import task
task.LoopingCall(process.reapAllProcesses).start(1.0, now=False)

That's less efficient but will work. I have a vague recollection that  
in old versions twisted used to do this by default but I might just  
be making that up.

James



From matt.feifarek at gmail.com  Sat Jun 11 11:59:07 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Sat, 11 Jun 2005 11:59:07 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <20050611153537.5047.1641691101.divmod.quotient.1023@ohm>
References: <6fb6dbfe050611080874419f5a@mail.gmail.com>
	<20050611153537.5047.1641691101.divmod.quotient.1023@ohm>
Message-ID: <6fb6dbfe05061108594034b78f@mail.gmail.com>

On 6/11/05, Jp Calderone <exarkun at divmod.com> wrote:
> Of course, it uses a non-public method of reactor (but installSignalHandlers is a non-public argument to reactor.run(), so you're already treading on thin ice :)

Thanks.

I don't see how it's non-public. Twisted TELLS you to use it if you
run the reactor in a thread. That doesn't seem too secret to me.

But thanks for the suggestion.



From matt.feifarek at gmail.com  Sat Jun 11 12:00:37 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Sat, 11 Jun 2005 12:00:37 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <F7509306-B75B-4CFC-891C-B0685ABB88B4@fuhm.net>
References: <6fb6dbfe05061015435de21846@mail.gmail.com>
	<1118446548.8272.17.camel@localhost.localdomain>
	<6fb6dbfe050611080874419f5a@mail.gmail.com>
	<F7509306-B75B-4CFC-891C-B0685ABB88B4@fuhm.net>
Message-ID: <6fb6dbfe050611090025c3d0bc@mail.gmail.com>

Thanks, all, for the suggestions.

This is certainly enough to get me started.



From exarkun at divmod.com  Sat Jun 11 12:55:46 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sat, 11 Jun 2005 12:55:46 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe05061108594034b78f@mail.gmail.com>
Message-ID: <20050611165546.5047.1921872341.divmod.quotient.1054@ohm>

On Sat, 11 Jun 2005 11:59:07 -0400, Matt Feifarek <matt.feifarek at gmail.com> wrote:
>On 6/11/05, Jp Calderone <exarkun at divmod.com> wrote:
>> Of course, it uses a non-public method of reactor (but installSignalHandlers is a non-public argument to reactor.run(), so you're already treading on thin ice :)
>
>Thanks.
>
>I don't see how it's non-public. Twisted TELLS you to use it if you
>run the reactor in a thread. That doesn't seem too secret to me.

Where does it do that?

Jp



From Sl_Church at sbcglobal.net  Sun Jun 12 15:27:55 2005
From: Sl_Church at sbcglobal.net (Shawn Church)
Date: Sun, 12 Jun 2005 12:27:55 -0700
Subject: [Twisted-Python] Large blocks of data and Perspective Broker
Message-ID: <42AC8CBB.90903@sbcglobal.net>

Could someone please point me to an example of passing a large block of
data (>640k) via  Perspective Broker??? Specifically I want my PB server
to create and return  a PDF file in response to a remote method call. I
guess I can just break it up into blocks and pass it that way but it
seems there should be a better way.  I know I saw this somewhere but am
unable to locate the reference now.



Thanks,

Shawn



From girloncrack at yahoo.com  Sun Jun 12 18:59:47 2005
From: girloncrack at yahoo.com (Andrea Soong)
Date: Sun, 12 Jun 2005 15:59:47 -0700 (PDT)
Subject: [Twisted-Python] Using lineReceived with HTTP requests
In-Reply-To: <20050611150453.5047.378421006.divmod.quotient.1011@ohm>
Message-ID: <20050612225947.56376.qmail@web54108.mail.yahoo.com>

How will I know when the data for the webpage is complete?  Is handleRequestEnd supposed to be called when that happens, or is that called after *I* call request.finish()?

Jp Calderone <exarkun at divmod.com> wrote:On Sat, 11 Jun 2005 00:28:38 -0700 (PDT), Andrea Soong wrote:
>Hi all,
>
>First off, I'd like to say thanks to Ken Whitesell for giving me some much needed help.
>
>Here's my problem: I am using an HTTPClient instance to connect to a webpage, and am trying to retrieve its contents and display to the screen line by line, using the lineReceived method. This is all being done in an .rpy file. For some reason, I am only receiving the header information:

The header section of an HTTP response is line-oriented. The body section is not. HTTPClient uses both of LineReceivers modes, so for the header section, lineReceived gets called, then for the body section, rawDataReceived gets called.

If you override both of these, you should see all of the data from the server. Of course, the data passed to rawDataReceive isn't going to be broken up into lines...

Jp

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050612/7ba671dd/attachment.htm 

From james at delx.cjb.net  Sun Jun 12 22:10:12 2005
From: james at delx.cjb.net (James Bunton)
Date: Mon, 13 Jun 2005 12:10:12 +1000
Subject: [Twisted-Python] Reactor given a dead FD
Message-ID: <6be0bdaf0daf7c240fa70d1ec7fc5920@delx.cjb.net>

Hi again all.

I asked this in the epoll thread a little while ago, but didn't get a 
response.
Does anybody know what is the correct behaviour for a Twisted reactor 
when addReader/Writer is called with a dead file descriptor?
Should I just silently ignore it and remove the FD from the selectables 
list?

---

James




From bob at redivi.com  Sun Jun 12 23:22:54 2005
From: bob at redivi.com (Bob Ippolito)
Date: Sun, 12 Jun 2005 23:22:54 -0400
Subject: [Twisted-Python] Reactor given a dead FD
In-Reply-To: <6be0bdaf0daf7c240fa70d1ec7fc5920@delx.cjb.net>
References: <6be0bdaf0daf7c240fa70d1ec7fc5920@delx.cjb.net>
Message-ID: <E2778C31-0DB2-4C5B-8491-9C34B3AF882B@redivi.com>

On Jun 12, 2005, at 10:10 PM, James Bunton wrote:

> I asked this in the epoll thread a little while ago, but didn't get  
> a response.
> Does anybody know what is the correct behaviour for a Twisted  
> reactor when addReader/Writer is called with a dead file descriptor?
> Should I just silently ignore it and remove the FD from the  
> selectables list?

I don't know if anyone knows for sure without trying it.. so you  
might as well try it yourself.  The correct behavior is probably  
whatever the select reactor does on Anything But Windows ;)

-bob




From james at delx.cjb.net  Mon Jun 13 04:12:37 2005
From: james at delx.cjb.net (James Bunton)
Date: Mon, 13 Jun 2005 18:12:37 +1000
Subject: [Twisted-Python] Reactor given a dead FD
In-Reply-To: <E2778C31-0DB2-4C5B-8491-9C34B3AF882B@redivi.com>
References: <6be0bdaf0daf7c240fa70d1ec7fc5920@delx.cjb.net>
	<E2778C31-0DB2-4C5B-8491-9C34B3AF882B@redivi.com>
Message-ID: <27e317d642de7d5ad85209303583504d@delx.cjb.net>

On 13/06/2005, at 1:22 PM, Bob Ippolito wrote:

> On Jun 12, 2005, at 10:10 PM, James Bunton wrote:
>
>> I asked this in the epoll thread a little while ago, but didn't get a 
>> response.
>> Does anybody know what is the correct behaviour for a Twisted reactor 
>> when addReader/Writer is called with a dead file descriptor?
>> Should I just silently ignore it and remove the FD from the 
>> selectables list?
>
> I don't know if anyone knows for sure without trying it.. so you might 
> as well try it yourself.  The correct behavior is probably whatever 
> the select reactor does on Anything But Windows ;)
>
> -bob

Looks like removing from the selectables list and logging it is the go 
then.
Thanks :)

---

James




From ed at greengraphics.net  Mon Jun 13 17:17:47 2005
From: ed at greengraphics.net (Ed Colmar)
Date: Mon, 13 Jun 2005 14:17:47 -0700
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
Message-ID: <42ADF7FB.5070707@greengraphics.net>

Greetings.

I stumbled upon the twisted framework while looking for OSCAR support 
for python. 

I have built a py-TOC AIM bot, that is working in most situations, but 
is unable to communicate with certain AIM accunts (specifically the ones 
inside the matrix online MMORPG). 

I am curious to know how unstable the OSCAR implementaion is, because I 
saw the warning at the top of the code.

I have been gettting the struct.error (in readSNAC) that it appears 
others have seen.  Is there a workaround for this?

Thanks, and I look forward to working with twisted

Cheers!

-ed




From james at delx.cjb.net  Mon Jun 13 20:03:56 2005
From: james at delx.cjb.net (James Bunton)
Date: Tue, 14 Jun 2005 10:03:56 +1000
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <42ADF7FB.5070707@greengraphics.net>
References: <42ADF7FB.5070707@greengraphics.net>
Message-ID: <1baf00e5d4378ba94953504a7e1c215d@delx.cjb.net>

You might want to contact Daniel, the developer of PyAIM-t
http://www.blathersource.org for the homepage.
He's been doing lots of development with the Oscar module, and you 
could likely use that version in your own code to take advantage of the 
bugfixes.

---

James



On 14/06/2005, at 7:17 AM, Ed Colmar wrote:

> Greetings.
>
> I stumbled upon the twisted framework while looking for OSCAR support 
> for python.
> I have built a py-TOC AIM bot, that is working in most situations, but 
> is unable to communicate with certain AIM accunts (specifically the 
> ones inside the matrix online MMORPG).
> I am curious to know how unstable the OSCAR implementaion is, because 
> I saw the warning at the top of the code.
>
> I have been gettting the struct.error (in readSNAC) that it appears 
> others have seen.  Is there a workaround for this?
>
> Thanks, and I look forward to working with twisted
>
> Cheers!
>
> -ed
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From z3p at twistedmatrix.com  Mon Jun 13 20:47:41 2005
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Mon, 13 Jun 2005 20:47:41 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <42ADF7FB.5070707@greengraphics.net>
References: <42ADF7FB.5070707@greengraphics.net>
Message-ID: <1118710061.5248.1.camel@petra>

On Mon, 2005-06-13 at 14:17 -0700, Ed Colmar wrote:
> Greetings.
> 
> I stumbled upon the twisted framework while looking for OSCAR support 
> for python. 
> 
> I have built a py-TOC AIM bot, that is working in most situations, but 
> is unable to communicate with certain AIM accunts (specifically the ones 
> inside the matrix online MMORPG). 
> 
> I am curious to know how unstable the OSCAR implementaion is, because I 
> saw the warning at the top of the code.

'Unstable' means the code could possibly change frequently.  In reality,
I don't do much development on it, and so it rarely changes.

> I have been gettting the struct.error (in readSNAC) that it appears 
> others have seen.  Is there a workaround for this?

Are you using Twisted 2.x?  It should be fixed in there.  If not, file a
bug with the tracker and I'll take a look.

-p
-- 
       Paul Swartz
(o_    http://z3p.livejournal.com/  _o)
//\    z3p at twistedmatrix.com        /\\
V_/_   AIM: z3penguin              _\_V->
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050613/57af44a7/attachment.pgp 

From andrew-twisted at puzzling.org  Mon Jun 13 21:41:17 2005
From: andrew-twisted at puzzling.org (andrew-twisted at puzzling.org)
Date: Tue, 14 Jun 2005 11:41:17 +1000
Subject: [Twisted-Python] Large blocks of data and Perspective Broker
In-Reply-To: <42AC8CBB.90903@sbcglobal.net>
References: <42AC8CBB.90903@sbcglobal.net>
Message-ID: <20050614014117.GA7794@home.puzzling.org>

On Sun, Jun 12, 2005 at 12:27:55PM -0700, Shawn Church wrote:
> Could someone please point me to an example of passing a large block of
> data (>640k) via  Perspective Broker??? Specifically I want my PB server
> to create and return  a PDF file in response to a remote method call. I
> guess I can just break it up into blocks and pass it that way but it
> seems there should be a better way.  I know I saw this somewhere but am
> unable to locate the reference now.

Use twisted.spread.util.FilePager or StringPager.

-Andrew.




From matt.feifarek at gmail.com  Mon Jun 13 23:40:06 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Mon, 13 Jun 2005 23:40:06 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <20050611165546.5047.1921872341.divmod.quotient.1054@ohm>
References: <6fb6dbfe05061108594034b78f@mail.gmail.com>
	<20050611165546.5047.1921872341.divmod.quotient.1054@ohm>
Message-ID: <6fb6dbfe0506132040807af26@mail.gmail.com>

You're right; I stand corrected. What it DOES say is this:

ValueError: signal only works in main thread

Somebody here in the list or maybe on #twisted told me about the
installSignalhandlers, I guess I must have conflated the two
directives. It's been so long that I don't remember. As I said, I'm
using this on 3 servers right now to serve thousands of image requests
and convert them on the fly if necessary.

Oh well. Time to find a new way.

Thanks very much for your help.

On 6/11/05, Jp Calderone <exarkun at divmod.com> wrote:
> >I don't see how it's non-public. Twisted TELLS you to use it if you
> >run the reactor in a thread. That doesn't seem too secret to me.
> 
> Where does it do that?



From daedalus at eigenmagic.com  Tue Jun 14 00:44:12 2005
From: daedalus at eigenmagic.com (Justin Warren)
Date: Tue, 14 Jun 2005 14:44:12 +1000
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on
	the same port?
In-Reply-To: <43c0d2b505061001147782b353@mail.gmail.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
	<43c0d2b505061001147782b353@mail.gmail.com>
Message-ID: <1118724252.5388.14.camel@norbert>

On Fri, 2005-06-10 at 16:14 +0800, Eric Hsu wrote:
> Hi Justin,
> 
> Thank you for you quick reply :)
> 
> > What is the problem you are trying to solve here?
> > 
> > I mean, in theory, yes, you could do what you're proposing. Why do you
> > want to, though?
> 
> I'm trying to write a TURN server:
> 
> http://www.ietf.org/internet-drafts/draft-rosenberg-midcom-turn-07.txt
> 
> The TURN client which is behind a NAT will ask the TURN server (with
> public address) to allocate a public transport address for it to
> receive data from outside.
> 
> There're two requests while the client trying to allocate a public
> transport address from the TURN server:
>  * Share Secret Request: over TLS; to obtain a one-time username and
> passwd and keep the passwd as the share secret of both side (the
> server and the client)
>  * Allocate Request: to allocate a public transport address from the server
> 
> As the draft said:
> 
> "A TURN server MUST be prepared to receive  Binding (should be
> Allocate - eric) Requests over TCP and UDP." (P10)
> 
> "The Allocate Request MUST be sent to the same IP address and port as the Shared
> Secret Request. This is because one time passwords are expected to be
> host-specific." (P20)
> 
> That means both the Share Secret Request (over TLS) and Allocate
> Request will be sent to the same IP and port of the server.
> 
> Then, the draft said:
> 
> "The client SHOULD close its connection when it has completed
> allocating username and passwords." (P19)

Ok, so you shut down the session here.

> So, while the client sends the Allocate Request to the server over
> TCP, the process would look like this (assuming the server is
> listening on port 12345 for TLS connection):
> 
> * the client sends the Share Secret Request to server:12345 _over TLS_
> and obtains a one-time username and passwd
> * the client closes the TLS connection
> * the client sends the Allocate Request to server:12345 _again_ to
> allocate a public transport address...

My reading of this (without having read the actual RFC) would result in
this kind of sequence:

C: connect to server via TCP
S: accept connection
C/S: start TLS
-- TLS negotiation happens --
C: Share Secret Request
S: gives out one time username/password
C: cool! thanks!
S: close connection

So the TCP session actually gets shut down here. The client then does
the Allocate Request, presumably using the username/password combo it
got before.

C: connect to server via TCP
S: accept connection
C: Allocate request
... and so on.

> It seems that I have to implement what I've mentioned in my previous mail?
> I'm not a native English speaker, and TURN is only a draft, maybe I've
> misunderstood something?

So you SHOULD be closing the connection after doing the username and
password allocation, which I'm reading as being within the TLS session.
This means the shutdown of TLS happens when the TCP connection is ended.
The next connection will be standard bare TCP.

This means all you have to do is work out how to turn TLS *on* when you
get a TCP connection. You don't have to work out how to turn it off
within the same TCP session, because you actually end the session and
reconnect. Much easier. :)

-- 
Justin Warren <daedalus at eigenmagic.com>




From nkeric at gmail.com  Tue Jun 14 01:57:59 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 14 Jun 2005 13:57:59 +0800
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on the
	same port?
In-Reply-To: <1118724252.5388.14.camel@norbert>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
	<43c0d2b505061001147782b353@mail.gmail.com>
	<1118724252.5388.14.camel@norbert>
Message-ID: <43c0d2b5050613225779384807@mail.gmail.com>

Hi Justin!

BIG THANKS for your clarification! That really enlightened me :D

Then, here is the last question which is more related to twisted:

Does twisted already have support(libs, classes, api...) for "turning
TLS on within a normal TCP connection"? Is there any sample code or
tutorial I could learn from, or could you please point me to somewhere
I could find more information?

Big thanks again! :) :)

- Eric


2005/6/14, Justin Warren <daedalus at eigenmagic.com>:
> So you SHOULD be closing the connection after doing the username and
> password allocation, which I'm reading as being within the TLS session.
> This means the shutdown of TLS happens when the TCP connection is ended.
> The next connection will be standard bare TCP.
> 
> This means all you have to do is work out how to turn TLS *on* when you
> get a TCP connection. You don't have to work out how to turn it off
> within the same TCP session, because you actually end the session and
> reconnect. Much easier. :)
> 
> --
> Justin Warren <daedalus at eigenmagic.com>
> 
>



From foom at fuhm.net  Tue Jun 14 02:38:02 2005
From: foom at fuhm.net (James Y Knight)
Date: Tue, 14 Jun 2005 02:38:02 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe0506132040807af26@mail.gmail.com>
References: <6fb6dbfe05061108594034b78f@mail.gmail.com>
	<20050611165546.5047.1921872341.divmod.quotient.1054@ohm>
	<6fb6dbfe0506132040807af26@mail.gmail.com>
Message-ID: <36A717FD-D77E-42F8-8A52-0BAE85D9B5B2@fuhm.net>


On Jun 13, 2005, at 11:40 PM, Matt Feifarek wrote:
> Oh well. Time to find a new way.

I'd suggest continuing to do it the way you are currently. While  
installSignalHandlers may be undocumented, it's not just going to  
disappear overnight. If you use that parameter and
task.LoopingCall(process.reapAllProcesses).start(1.0, now=False)
then I'd say you're on fairly safe ground for the immediate future.

Overall we do a good job of keeping backwards compatibility even for  
APIs that may not be completely official, so it's unlikely to just up  
and disappear.

James



From apocalypznow at gmail.com  Tue Jun 14 03:34:31 2005
From: apocalypznow at gmail.com (apocalypznow)
Date: Tue, 14 Jun 2005 00:34:31 -0700
Subject: [Twisted-Python] Combine XMLRPC and PB in one server?
Message-ID: <d8m10u$nqd$1@sea.gmane.org>

How do you make a server that handles both XMLRPC and PB?

How do you do this as a service?

When I mean service, I mean as in the following code:

application = twisted.application.service.Application("pbserver")
myService = twisted.application.service.IServiceCollection(application)

p = portal.Portal(DefaultRealm())
dbu=twisted.cred.checkers.InMemoryUsernamePasswordDatabaseDontUse()
dbu.addUser("user1","pass1")
p.registerChecker(dbu)

myServer = 
twisted.application.internet.TCPServer(8080,pb.PBServerFactory(p))
myServer.setServiceParent(myService)




From apocalypznow at gmail.com  Tue Jun 14 04:28:14 2005
From: apocalypznow at gmail.com (apocalypznow)
Date: Tue, 14 Jun 2005 01:28:14 -0700
Subject: [Twisted-Python] FilePager?
Message-ID: <d8m45j$14i$1@sea.gmane.org>

How do you use twisted.spread.util.FilePager in a PB server?




From itamar at itamarst.org  Tue Jun 14 09:46:57 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 14 Jun 2005 09:46:57 -0400
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on
	the same port?
In-Reply-To: <43c0d2b5050613225779384807@mail.gmail.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
	<43c0d2b505061001147782b353@mail.gmail.com>
	<1118724252.5388.14.camel@norbert>
	<43c0d2b5050613225779384807@mail.gmail.com>
Message-ID: <1118756817.8307.13.camel@localhost.localdomain>

On Tue, 2005-06-14 at 13:57 +0800, Eric Hsu wrote:

> Does twisted already have support(libs, classes, api...) for "turning
> TLS on within a normal TCP connection"? Is there any sample code or
> tutorial I could learn from, or could you please point me to somewhere
> I could find more information?

Yep, self.transport.startTLS(...) where self is a connected Protocol
instance. There are probably some examples in the code, or look at how
the tests do it (twisted.test.test_tcp).




From glyph at divmod.com  Tue Jun 14 10:45:39 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 10:45:39 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending
	when	installSignalHandlers=False
In-Reply-To: <36A717FD-D77E-42F8-8A52-0BAE85D9B5B2@fuhm.net>
References: <6fb6dbfe05061108594034b78f@mail.gmail.com>	<20050611165546.5047.1921872341.divmod.quotient.1054@ohm>	<6fb6dbfe0506132040807af26@mail.gmail.com>
	<36A717FD-D77E-42F8-8A52-0BAE85D9B5B2@fuhm.net>
Message-ID: <42AEED93.70306@divmod.com>

James Y Knight wrote:

> On Jun 13, 2005, at 11:40 PM, Matt Feifarek wrote:

> I'd suggest continuing to do it the way you are currently. While  
> installSignalHandlers may be undocumented, it's not just going to  
> disappear overnight. If you use that parameter and
> task.LoopingCall(process.reapAllProcesses).start(1.0, now=False)
> then I'd say you're on fairly safe ground for the immediate future.
> 
> Overall we do a good job of keeping backwards compatibility even for  
> APIs that may not be completely official, so it's unlikely to just up  
> and disappear.

Perhaps a better way to handle this would be to create an official API 
to handle this problem, then distribute it as an external Python file 
you can include, which will have some forward-compatibility code put 
into it when newer versions of Twisted come out.

I don't like the "let's never change anything because someone might be 
using it somewhere" approach that we've been taking.  When we're making 
minor changes it's good but over time (especially given the sprawling 
nature of Twisted and the lack of any documentation on the state of its 
entirety) means tha we leave chunks of deprecated or semi-deprecated 
APIs around forever.



From glyph at divmod.com  Tue Jun 14 10:53:55 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 10:53:55 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <1baf00e5d4378ba94953504a7e1c215d@delx.cjb.net>
References: <42ADF7FB.5070707@greengraphics.net>
	<1baf00e5d4378ba94953504a7e1c215d@delx.cjb.net>
Message-ID: <42AEEF83.7070300@divmod.com>

James Bunton wrote:
> You might want to contact Daniel, the developer of PyAIM-t
> http://www.blathersource.org for the homepage.
> He's been doing lots of development with the Oscar module, and you could 
> likely use that version in your own code to take advantage of the bugfixes.

Daniel reads this list, at least according to my archives.  (Hi, Daniel!)

As Paul said elsewhere in this thread, the fix in question should be in 
Twisted 2.0.  However, Daniel, are there other fixes in PyAIM-t that 
haven't been contributed back?  I have a message from 2005/03/15 that 
says that you were going to try to merge PyAIM-t and PyICQ-t, document 
them, put them in twisted, and maintain them... any progress there?



From jadestorm at nc.rr.com  Tue Jun 14 11:25:45 2005
From: jadestorm at nc.rr.com (Daniel Henninger)
Date: Tue, 14 Jun 2005 11:25:45 -0400 (EDT)
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <42AEEF83.7070300@divmod.com>
References: <42ADF7FB.5070707@greengraphics.net>
	<1baf00e5d4378ba94953504a7e1c215d@delx.cjb.net>
	<42AEEF83.7070300@divmod.com>
Message-ID: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>

> James Bunton wrote:
>> You might want to contact Daniel, the developer of PyAIM-t
>> http://www.blathersource.org for the homepage.
>> He's been doing lots of development with the Oscar module, and you could
>> likely use that version in your own code to take advantage of the
>> bugfixes.
>
> Daniel reads this list, at least according to my archives.  (Hi, Daniel!)
>
> As Paul said elsewhere in this thread, the fix in question should be in
> Twisted 2.0.  However, Daniel, are there other fixes in PyAIM-t that
> haven't been contributed back?  I have a message from 2005/03/15 that
> says that you were going to try to merge PyAIM-t and PyICQ-t, document
> them, put them in twisted, and maintain them... any progress there?

LOL  Called me out   =)

Let me start off by saying, I'm in the process of moving, so my
response/ability to work on things is quite limited for the time being. 
That said, yes, I wanted to combine the changes to oscar.py that are done
in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy to
"be the supporter of" oscar.py in Twisted if you all want, but I don't
want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
nothing else, I'll try to clean things up and hand the code to Paul.

Daniel




From glyph at divmod.com  Tue Jun 14 12:33:34 2005
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 14 Jun 2005 12:33:34 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
Message-ID: <20050614163334.5047.683193401.divmod.quotient.2769@ohm>



On Tue, 14 Jun 2005 11:25:45 -0400 (EDT), Daniel Henninger 

>Let me start off by saying, I'm in the process of moving, so my
>response/ability to work on things is quite limited for the time being.

Understandable.  I'm in the process of living so my resources are similarly limited. :)

>That said, yes, I wanted to combine the changes to oscar.py that are done
>in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy to
>"be the supporter of" oscar.py in Twisted if you all want, but I don't
>want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
>nothing else, I'll try to clean things up and hand the code to Paul.

I'm sure that Paul wouldn't mind.  (As I understand it, he barely has time to work on conch, his main interest in Twisted currently.)

Is there a bug for this in the tracker?  If not, please create a bug on http://twistedmatrix.com/bugs and assign it to yourself.



From jadestorm at nc.rr.com  Tue Jun 14 13:09:20 2005
From: jadestorm at nc.rr.com (Daniel Henninger)
Date: Tue, 14 Jun 2005 13:09:20 -0400 (EDT)
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <20050614163334.5047.683193401.divmod.quotient.2769@ohm>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
Message-ID: <43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>

>>That said, yes, I wanted to combine the changes to oscar.py that are done
>>in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy to
>>"be the supporter of" oscar.py in Twisted if you all want, but I don't
>>want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
>>nothing else, I'll try to clean things up and hand the code to Paul.
>
> I'm sure that Paul wouldn't mind.  (As I understand it, he barely has time
> to work on conch, his main interest in Twisted currently.)

=D  What do you think, Paul?

> Is there a bug for this in the tracker?  If not, please create a bug on
> http://twistedmatrix.com/bugs and assign it to yourself.

Sorry, a bug for what?  What the thread was originally about or something
more directly related to me?

Daniel




From z3p at twistedmatrix.com  Tue Jun 14 13:25:33 2005
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Tue, 14 Jun 2005 13:25:33 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
Message-ID: <1118769934.5248.4.camel@petra>

On Tue, 2005-06-14 at 13:09 -0400, Daniel Henninger wrote:
> >>That said, yes, I wanted to combine the changes to oscar.py that are done
> >>in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy to
> >>"be the supporter of" oscar.py in Twisted if you all want, but I don't
> >>want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
> >>nothing else, I'll try to clean things up and hand the code to Paul.
> >
> > I'm sure that Paul wouldn't mind.  (As I understand it, he barely has time
> > to work on conch, his main interest in Twisted currently.)
> 
> =D  What do you think, Paul?

It's yours.  :)

-p
-- 
       Paul Swartz
(o_    http://z3p.livejournal.com/  _o)
//\    z3p at twistedmatrix.com        /\\
V_/_   AIM: z3penguin              _\_V->
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050614/b642e108/attachment.pgp 

From glyph at divmod.com  Tue Jun 14 13:42:49 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 13:42:49 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
Message-ID: <42AF1719.3080605@divmod.com>

Daniel Henninger wrote:

>>Is there a bug for this in the tracker?  If not, please create a bug on
>>http://twistedmatrix.com/bugs and assign it to yourself.

> Sorry, a bug for what?  What the thread was originally about or something
> more directly related to me?

I was talking about a bug for integrating the pyXXX-t changes into 
oscar.py and documenting it.



From jadestorm at nc.rr.com  Tue Jun 14 13:54:13 2005
From: jadestorm at nc.rr.com (Daniel Henninger)
Date: Tue, 14 Jun 2005 13:54:13 -0400 (EDT)
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <42AF1719.3080605@divmod.com>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
	<42AF1719.3080605@divmod.com>
Message-ID: <44363.152.1.4.40.1118771653.squirrel@www.vorpalcloud.org>

>>>Is there a bug for this in the tracker?  If not, please create a bug on
>>>http://twistedmatrix.com/bugs and assign it to yourself.
>
>> Sorry, a bug for what?  What the thread was originally about or
>> something
>> more directly related to me?
>
> I was talking about a bug for integrating the pyXXX-t changes into
> oscar.py and documenting it.

Oh ok  =)  I'll do that.  (didn't consider it a "bug", so was confused  ;D  )

Daniel




From christopher.zorn at gmail.com  Tue Jun 14 14:58:37 2005
From: christopher.zorn at gmail.com (Christopher Zorn)
Date: Tue, 14 Jun 2005 14:58:37 -0400
Subject: [Twisted-Python] ldaptor.protocols.ldap.ldapclient.startTLS
Message-ID: <149014b9050614115818c12cc6@mail.gmail.com>

I hope this is the correct place to ask about this, forgive me if it is not. 

I recently tried to use ldaptor. It is great!! 
I ran into one problem though. I wanted to use startTLS and I had to call 
it myself. 

So I put the following in front of some example code :

d=c.connectAnonymously(config['base'], config['serviceLocationOverrides'])
#d = c.connect(config['base'], config['serviceLocationOverrides'])

    
    def _startTLS(proto):
        d = proto.startTLS()
        d.addCallback(lambda _: proto)
        return d
        

    d.addCallback(_startTLS)


This would hang. I went to find out and there was a deferred created that seemed
to have been getting lost. It was never called when handle was called in the 
client class. 

I attached a patch that allows me to use startTLS the way I did it, but I do not
know if this is correct. Please let me know if I am doing something
wrong or if this
is actually a bug. 

The patch is to the file ldaptor/protocols/ldap/ldapclient.py



From ed at greengraphics.net  Tue Jun 14 15:04:10 2005
From: ed at greengraphics.net (Ed Colmar)
Date: Tue, 14 Jun 2005 12:04:10 -0700
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <1118710061.5248.1.camel@petra>
References: <42ADF7FB.5070707@greengraphics.net>
	<1118710061.5248.1.camel@petra>
Message-ID: <42AF2A2A.4080506@greengraphics.net>

Thanks for all the replies. 

Yes, I am using 2.0.1 twisted, however I'm not certain that I have 
installed the proper files from the seperate packages... 

My install procedure was to copy the entire twisted folder (from the 
2.0.1package), into python/lib.  Then I replaced the 'words' folder with 
the one supplied in the twisted words 0.1.0 package.

This still results in the struct.error.

Then I copied oscar.py sockserror.py and sock5.py into the protocols 
folder (overwriting oscar.py).

Same struct.error... 

I would copy the traceback for you, but it hangs my IDLE python editor 
on this crash.  So, I'll attach a screenshot.

Did I do something wrong on the install copy?

-ed

>Are you using Twisted 2.x?  It should be fixed in there.  If not, file a
>bug with the tracker and I'll take a look.
>
>  
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: traceback.gif
Type: image/gif
Size: 22247 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050614/852addb1/attachment.gif 

From ed at greengraphics.net  Tue Jun 14 15:27:51 2005
From: ed at greengraphics.net (Ed Colmar)
Date: Tue, 14 Jun 2005 12:27:51 -0700
Subject: [Twisted-Python] words/doc/examples/aimbot.py - BCFactory missing
Message-ID: <42AF2FB7.5050708@greengraphics.net>

I started playing around with the toc implementation, with hopes that it 
would work for my (somewhat wierd) needs.

I'm seeing this error when firing up the bot:

Traceback (most recent call last):
  File 
"C:\Installers\python_modules\TwistedWords-0.1.0.tar\TwistedWords-0.1.0\TwistedWords-0.1.0\doc\examples\aimbot2.py", 
line 59, in ?
    bot = base.BCFactory( aimBot(screenname, password) )
AttributeError: 'module' object has no attribute 'BCFactory'

Perhaps this BCFactory class has moved? 

-ed



From jadestorm at nc.rr.com  Tue Jun 14 15:32:40 2005
From: jadestorm at nc.rr.com (Daniel Henninger)
Date: Tue, 14 Jun 2005 15:32:40 -0400 (EDT)
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <1118769934.5248.4.camel@petra>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
	<1118769934.5248.4.camel@petra>
Message-ID: <44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>

> On Tue, 2005-06-14 at 13:09 -0400, Daniel Henninger wrote:
>> >>That said, yes, I wanted to combine the changes to oscar.py that are
>> done
>> >>in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy
>> to
>> >>"be the supporter of" oscar.py in Twisted if you all want, but I don't
>> >>want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
>> >>nothing else, I'll try to clean things up and hand the code to Paul.
>> >
>> > I'm sure that Paul wouldn't mind.  (As I understand it, he barely has
>> time
>> > to work on conch, his main interest in Twisted currently.)
>>
>> =D  What do you think, Paul?
>
> It's yours.  :)


=D

Ok so, that said, how do I go about updating oscar.py (when it comes time)?

Daniel




From liiwi at lonesom.pp.fi  Tue Jun 14 16:19:58 2005
From: liiwi at lonesom.pp.fi (Jaakko Niemi)
Date: Tue, 14 Jun 2005 23:19:58 +0300
Subject: [Twisted-Python] cred + PAM
Message-ID: <20050614201958.GA26005@jumper.lonesom.pp.fi>

 Hello,

 If you are interested of getting PAM support to cred, take a peek at:

 http://twistedmatrix.com/bugs/issue1044

 The patches are a start and propably break conch.

 Also, python-pam (PyPAM) is seriously bitrotten.
 Are there others who are interested in getting it into
 more working shape? If it's author is not near these
 bitfields anymore, maybe a fork or hijack is in place.

                --j




From christopher.zorn at gmail.com  Tue Jun 14 16:17:16 2005
From: christopher.zorn at gmail.com (Christopher Zorn)
Date: Tue, 14 Jun 2005 16:17:16 -0400
Subject: [Twisted-Python] Re: ldaptor.protocols.ldap.ldapclient.startTLS
In-Reply-To: <149014b9050614115818c12cc6@mail.gmail.com>
References: <149014b9050614115818c12cc6@mail.gmail.com>
Message-ID: <149014b9050614131710053e8e@mail.gmail.com>

I forgot to attach the patch, sorry, 

On 6/14/05, Christopher Zorn <christopher.zorn at gmail.com> wrote:
> I hope this is the correct place to ask about this, forgive me if it is not.
> 
> I recently tried to use ldaptor. It is great!!
> I ran into one problem though. I wanted to use startTLS and I had to call
> it myself.
> 
> So I put the following in front of some example code :
> 
> d=c.connectAnonymously(config['base'], config['serviceLocationOverrides'])
> #d = c.connect(config['base'], config['serviceLocationOverrides'])
> 
> 
>     def _startTLS(proto):
>         d = proto.startTLS()
>         d.addCallback(lambda _: proto)
>         return d
> 
> 
>     d.addCallback(_startTLS)
> 
> 
> This would hang. I went to find out and there was a deferred created that seemed
> to have been getting lost. It was never called when handle was called in the
> client class.
> 
> I attached a patch that allows me to use startTLS the way I did it, but I do not
> know if this is correct. Please let me know if I am doing something
> wrong or if this
> is actually a bug.
> 
> The patch is to the file ldaptor/protocols/ldap/ldapclient.py
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ldapclient.py.patch
Type: text/x-patch
Size: 394 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050614/a8cd7e2a/attachment.bin 

From foom at fuhm.net  Tue Jun 14 16:22:13 2005
From: foom at fuhm.net (James Y Knight)
Date: Tue, 14 Jun 2005 16:22:13 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending
	when	installSignalHandlers=False
In-Reply-To: <42AEED93.70306@divmod.com>
References: <6fb6dbfe05061108594034b78f@mail.gmail.com>	<20050611165546.5047.1921872341.divmod.quotient.1054@ohm>	<6fb6dbfe0506132040807af26@mail.gmail.com>
	<36A717FD-D77E-42F8-8A52-0BAE85D9B5B2@fuhm.net>
	<42AEED93.70306@divmod.com>
Message-ID: <6B3DF51E-B92E-4C62-8091-9873045097AD@fuhm.net>

On Jun 14, 2005, at 10:45 AM, Glyph Lefkowitz wrote:
> I don't like the "let's never change anything because someone might  
> be using it somewhere" approach that we've been taking.  When we're  
> making minor changes it's good but over time (especially given the  
> sprawling nature of Twisted and the lack of any documentation on  
> the state of its entirety) means tha we leave chunks of deprecated  
> or semi-deprecated APIs around forever.

That points to a need to better track deprecated APIs and when they  
are planned to be removed, not to a need to break things more.  
Stability is good, and without an easy way to verify conformance, it  
is dangerous to say that stability in undocumented interfaces is  
unimportant. It believe that an undocumented interface should be  
considered less important to keep stable, but it should still be done  
if possible. This is especially true in the twisted core, vs the  
various protocol packages, most of which are significantly less well  
developed and in some cases just have stupidly broken APIs.

For this particular case, I can't think of any reason why an  
installSignalHandlers=0 argument would ever need to be removed.

James




From mary-twisted at puzzling.org  Tue Jun 14 16:47:14 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 15 Jun 2005 06:47:14 +1000
Subject: [Twisted-Python] Australian Twisted Sprint #2: 19th - 21st August
	2005, Sydney
Message-ID: <20050614204714.GB8869@sourdust.home.puzzling.org>

Hi everyone,

We're still in the early stages of planning, but I thought I'd get the
date out there as soon as I could. Following the success of the
Twisted sprint in Hobart in April, we're having a second sprint.

Dates: Friday 19th - Sunday 21st August 2005

Location: Sydney (venue not yet known)

As with last time, there will be no attendence charge and sprinters will
be taking care of their own accommodation and transport. Once we have a
venue we'll have some suggestions.

We'll be working on code and documentation hopefully destined for the
Twisted Subversion repository. People not really familiar with Twisted
are welcome but will probably at least want to have the basics down by
the time of the sprint.

More details will be announced here, also see the wiki at
http://users.puzzling.org/users/mary/TwistedSprint/moin.cgi/FrontPage
People interested in coming should update
http://users.puzzling.org/users/mary/TwistedSprint/moin.cgi/SprintAttendees
and email me, so that we have an idea of numbers.

-Mary



From glyph at divmod.com  Tue Jun 14 17:44:42 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 17:44:42 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>	<1118769934.5248.4.camel@petra>
	<44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
Message-ID: <42AF4FCA.2000207@divmod.com>

Daniel Henninger wrote:

> Ok so, that said, how do I go about updating oscar.py (when it comes time)?

Put some patches in the bugtracker and assign them to someone (glyph, 
exarkun, z3p).  After a few patches, perhaps we will give you commit access.



From glyph at divmod.com  Tue Jun 14 17:55:56 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 17:55:56 -0400
Subject: [Twisted-Python] cred + PAM
In-Reply-To: <20050614201958.GA26005@jumper.lonesom.pp.fi>
References: <20050614201958.GA26005@jumper.lonesom.pp.fi>
Message-ID: <42AF526C.4030909@divmod.com>

Jaakko Niemi wrote:
>  Hello,
> 
>  If you are interested of getting PAM support to cred, take a peek at:

Awesome!  I will definitely have a look at this soon.  I've wanted to 
support PAM since day 1 with cred :)



From jason.mobarak at gmail.com  Tue Jun 14 19:53:22 2005
From: jason.mobarak at gmail.com (Jason Mobarak)
Date: Tue, 14 Jun 2005 17:53:22 -0600
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
	<1118769934.5248.4.camel@petra>
	<44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
Message-ID: <b194c9190506141653741d6030@mail.gmail.com>

On 6/14/05, Daniel Henninger <jadestorm at nc.rr.com> wrote:
[... stuff about Daniel working on OSCAR support ...]
> > It's yours.  :)
> 
> Ok so, that said, how do I go about updating oscar.py (when it comes time)?

I can't speak for the powers at be but generally you'd follow the
general process of:

- File a "bug" (really it's an issue, something that needs more
centralized tracking than email can support).  Twisted's bug tracker
is used for feature requests and improvements made by people without
commit access.

- Use the bug to communicate future work on the issue

- Check out a copy of Twisted's Subversion repository.  Work off that.
 Make diff when you're satisfied with your changes.  Attach the diff
to Twisted's issue/bug tracker and when someone with commit access
feels that it's properly documented and the quality is high enough
it'll get committed.

That seems to be the general process.  Someone correct me if I'm wrong.

,,Jason



From mary-twisted at puzzling.org  Tue Jun 14 19:59:22 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 15 Jun 2005 09:59:22 +1000
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <b194c9190506141653741d6030@mail.gmail.com>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
	<1118769934.5248.4.camel@petra>
	<44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
	<b194c9190506141653741d6030@mail.gmail.com>
Message-ID: <20050614235922.GA15789@home.puzzling.org>

On Tue, Jun 14, 2005, Jason Mobarak wrote:
> That seems to be the general process.  Someone correct me if I'm wrong.

I think there's a middle step about taking "ownership" of the issue, not
so much in the sense of assigning it to yourself as actually taking
initiative and bugging people to review it and merge it (on IRC,
usually). There's a lot of patches languishing for lack of nagging in
there.

-Mary



From ian at ianduggan.net  Tue Jun 14 20:45:54 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Tue, 14 Jun 2005 17:45:54 -0700
Subject: [Twisted-Python] Capture blocking calls?
Message-ID: <200506141745.54830.ian@ianduggan.net>


Hi,

Does anyone know of any tools that could be used to wrap a python module and 
capture/report blocking calls made by it?

My immediate need is to extend the twisted soap client to support the WSDL 
proxy that is part of SOAPpy. The current soap proxy looks to be pretty 
minimal.

I'll probably just end up reading through the code this time, but I thought I 
would throw the idea out there in case anyone had considered this before.

Such a tool might make it easier to wrap up/modify libraries and make them 
usable from Twisted.

--Ian



From exarkun at divmod.com  Tue Jun 14 21:17:34 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 14 Jun 2005 21:17:34 -0400
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <200506141745.54830.ian@ianduggan.net>
Message-ID: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>

On Tue, 14 Jun 2005 17:45:54 -0700, Ian Duggan <ian at ianduggan.net> wrote:
>
>Hi,
>
>Does anyone know of any tools that could be used to wrap a python module and
>capture/report blocking calls made by it?
>
>My immediate need is to extend the twisted soap client to support the WSDL
>proxy that is part of SOAPpy. The current soap proxy looks to be pretty
>minimal.
>
>I'll probably just end up reading through the code this time, but I thought I
>would throw the idea out there in case anyone had considered this before.
>
>Such a tool might make it easier to wrap up/modify libraries and make them
>usable from Twisted.

<http://svn.twistedmatrix.com/cvs/sandbox/exarkun/btt.py> (and <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/test_btt.py>) might be of interest/use.  I haven't done much with it yet, so I don't know if it's actually effective.  I'd be interested to hear if you have any luck with it.

Jp



From foom at fuhm.net  Tue Jun 14 22:08:06 2005
From: foom at fuhm.net (James Y Knight)
Date: Tue, 14 Jun 2005 22:08:06 -0400
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: <2803867A-D82B-4980-A7A3-D047005FD062@fuhm.net>

Bug summary
______________________
Since 2005-05-31 04:57:08.920000:
Bugs opened: 14   Bugs closed: 3   Total open bugs: 388 (+11)
   Urgent: 7 (+1)
   Bug: 163 (+8)
   Feature: 143 (+2)
   Wish: 75 (+0)

New / Reopened Bugs
______________________
                     ==== Urgent ====
[DOCUMENTATION, LORE] Lore  (1 week ago)
        http://twistedmatrix.com/bugs/issue1073 opened by glyph

                     ==== Bug ====
twisted.web.client _parse URL parse bug  (yesterday)
        http://twistedmatrix.com/bugs/issue1080 opened by gentoo.cn

[WEB] HTTPClientFactory leaks memory  (4 days ago)
        http://twistedmatrix.com/bugs/issue1079 opened by jojo

[XISH] twisted.xish.xmlstream parse error  (5 days ago)
        http://twistedmatrix.com/bugs/issue1078 opened by tofu

[PATCH]socks proxy bugs  (20 months ago)
        http://twistedmatrix.com/bugs/issue285 opened by maoy

[XISH] domish.Element checking __class__, breaks inheritance  (1 week  
ago)
        http://twistedmatrix.com/bugs/issue1074 opened by VislabSteve

[CORE, DOCUMENTATION] Add threadedselectreactor into appropriate  
docs  (6 days ago)
        http://twistedmatrix.com/bugs/issue1077 opened by hypatia

[MAIL] pop3 protocol does not parse lines according to the rfc  (1  
week ago)
        http://twistedmatrix.com/bugs/issue1076 opened by mg

log.msg fails and then the log file is silent ever after  (1 week ago)
        http://twistedmatrix.com/bugs/issue1069 opened by bruce

Stupid code needs removing from ftp.py  (1 week ago)
        http://twistedmatrix.com/bugs/issue1075 opened by orbitz

roundup bug?  (1 week ago)
        http://twistedmatrix.com/bugs/issue1070 opened by maoy

                     ==== Feature ====
deferToThread decorator  (1 week ago)
        http://twistedmatrix.com/bugs/issue1071 opened by tjs

adbapi: retrying queries on a lost connection  (1 week ago)
        http://twistedmatrix.com/bugs/issue1072 opened by davep

                     ==== Wish ====
[CHAT, WORDS] Incorporate PyAIM/PyICQ updates to oscar.py into  
Twisted  (7 hours ago)
        http://twistedmatrix.com/bugs/issue1081 opened by jadestorm

Bugs Closed
______________________
                     ==== Bug ====
[WEBSITE] http://twistedmatrix.com/documents/ has 1.3 documentation  
linked as current one  (1 month ago)
        http://twistedmatrix.com/bugs/issue1029 opened by itamarst,  
closed by ash

[PB] CopiedFailure printTraceback method signature doesn't match  
Failure's  (1 month ago)
        http://twistedmatrix.com/bugs/issue1006 opened by micktwomey,  
closed by exarkun

                     ==== Wish ====
CoreFoundation (just Foundation would be acceptable) RunLoop  
integration  (22 months ago)
        http://twistedmatrix.com/bugs/issue164 opened by etrepum,  
closed by exarkun





From ssmith at vislab.usyd.edu.au  Tue Jun 14 22:28:17 2005
From: ssmith at vislab.usyd.edu.au (Steve Smith)
Date: Wed, 15 Jun 2005 12:28:17 +1000
Subject: [Twisted-Python] Clean shutdown of an XMLStream session
Message-ID: <1118802497.21943.4.camel@moth.vislab.usyd.edu.au>

Hi,

This is probably a stupid question, but what is method of cleanly
shutting down an XMLStream (such that it sends the terminating </stream>
and closes the connection).

Thanks,
Steve




From gmcdonald at infocomp.com  Tue Jun 14 22:51:04 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Wed, 15 Jun 2005 12:51:04 +1000
Subject: [Twisted-Python] FW: Twisted Sprint (Mary please read)
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4DD5@XCHANGE>

Apologies in advance for posting this to the list.

Mary: I tried emailing you at the address supplied on the Sprint page but
the email wouldn't deliver (I am certain my understanding of the address
translation was faulty) can you please see my forwarded email below:

Regards,

Grant

-----Original Message-----
From: Grant McDonald 
Sent: 15 June 2005 12:32
To: xxxxxx
Subject: Twisted Sprint

Mary,

I am interested in attending the twisted sprint but have never been to a
"sprint" of any description and am wondering what use I could be? I have
been working with twisted in a production system for about 1.5 years and am
familiar with the core of twisted and would be more than happy to help out
with documentation.  Since I work full time I would only be able to attend
the Saturday and Sunday.  Accommodation is not a problem (depending on where
in Sydney) since I live in Wollongong.

Kind Regards,

Grant McDonald
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050615/f9946c9a/attachment.htm 

From mary-twisted at puzzling.org  Tue Jun 14 23:01:51 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 15 Jun 2005 13:01:51 +1000
Subject: [Twisted-Python] FW: Twisted Sprint (Mary please read)
In-Reply-To: <61DA7719C45FD31185280008C733EF6E04AC4DD5@XCHANGE>
References: <61DA7719C45FD31185280008C733EF6E04AC4DD5@XCHANGE>
Message-ID: <20050615030151.GD16295@home.puzzling.org>

On Wed, Jun 15, 2005, Grant McDonald wrote:
> Mary: I tried emailing you at the address supplied on the Sprint page but
> the email wouldn't deliver (I am certain my understanding of the address
> translation was faulty) can you please see my forwarded email below:

Thank you for the email. You can also send mail to the address that I
use to post to this list though...

Since this might be applicable more widely: as for what use you would be
at a sprint, well, there will be a few things going on:

 - writing and editing of existing Twisted documentation. You could be
   of use as a writer, editor, proofreader or reviewer
 - coding on a couple of projects including the VFS layer. You could be
   of use as a coder, code reviewer or tester

They don't really work on a "farming tasks out" basis though, ie there
is no Sprint Master watching everyone to make sure they have something
to do and aren't lost or bored. You just sit around and code (write,
review, test...) with a bunch of other people. They're generally small
enough that you'll get to know everyone well. People can pair with you
to let you in on their projects.

(All further mails regarding the sprint can be sent directly to me using
the address above. Watch it when you hit reply, they go back to the list
by default.)

-Mary



From nkeric at gmail.com  Tue Jun 14 23:17:59 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Wed, 15 Jun 2005 11:17:59 +0800
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on the
	same port?
In-Reply-To: <1118756817.8307.13.camel@localhost.localdomain>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
	<43c0d2b505061001147782b353@mail.gmail.com>
	<1118724252.5388.14.camel@norbert>
	<43c0d2b5050613225779384807@mail.gmail.com>
	<1118756817.8307.13.camel@localhost.localdomain>
Message-ID: <43c0d2b505061420171d7dd01d@mail.gmail.com>

Itamar, thank you very much!
I'm reading the twisted.test.test_tcp now : )

Thank you all guys! You've been a GREAT help!
I'll keep posting if I have further question ;)

2005/6/14, Itamar Shtull-Trauring <itamar at itamarst.org>:
> 
> Yep, self.transport.startTLS(...) where self is a connected Protocol
> instance. There are probably some examples in the code, or look at how
> the tests do it (twisted.test.test_tcp).
> 
>



From laran at elevasoft.com  Tue Jun 14 23:23:03 2005
From: laran at elevasoft.com (Laran Evans)
Date: Tue, 14 Jun 2005 23:23:03 -0400
Subject: [Twisted-Python] Preferred way to receive a patch?
Message-ID: <42AF9F17.1030900@elevasoft.com>

Should I just attach it to an email? Or should I attach it to the 
Roundup issue?

- Laran




From leszczynscy at yahoo.com  Tue Jun 14 23:40:31 2005
From: leszczynscy at yahoo.com (Andrzej Leszczynski)
Date: Tue, 14 Jun 2005 22:40:31 -0500
Subject: [Twisted-Python] ACE vs. Twisted
Message-ID: <42AFA32F.9070108@yahoo.com>

I have a general question, how the ACE differs conceptually from Twisted?

Thx, A.



From gmcdonald at infocomp.com  Tue Jun 14 23:46:59 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Wed, 15 Jun 2005 13:46:59 +1000
Subject: [Twisted-Python] FW: Twisted Sprint (Mary please read)
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4DD6@XCHANGE>

Mary,

Your address is still masked: see the header below.  Based on the
information given in your email I have updated the sprint page to indicate
that I'll be coming along.

Feel free to contact me on gmcdonald  at    infocomp  dot   com regarding
the sprint and sundries :)

Regards,

Grant


-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com]On Behalf Of Mary Gardiner
Sent: 15 June 2005 13:02
To: twisted-python at twistedmatrix.com
Subject: Re: [Twisted-Python] FW: Twisted Sprint (Mary please read)

On Wed, Jun 15, 2005, Grant McDonald wrote:
> Mary: I tried emailing you at the address supplied on the Sprint page but
> the email wouldn't deliver (I am certain my understanding of the address
> translation was faulty) can you please see my forwarded email below:

Thank you for the email. You can also send mail to the address that I
use to post to this list though...

Since this might be applicable more widely: as for what use you would be
at a sprint, well, there will be a few things going on:

 - writing and editing of existing Twisted documentation. You could be
   of use as a writer, editor, proofreader or reviewer
 - coding on a couple of projects including the VFS layer. You could be
   of use as a coder, code reviewer or tester

They don't really work on a "farming tasks out" basis though, ie there
is no Sprint Master watching everyone to make sure they have something
to do and aren't lost or bored. You just sit around and code (write,
review, test...) with a bunch of other people. They're generally small
enough that you'll get to know everyone well. People can pair with you
to let you in on their projects.

(All further mails regarding the sprint can be sent directly to me using
the address above. Watch it when you hit reply, they go back to the list
by default.)

-Mary

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050615/e94aa531/attachment.htm 

From mary-twisted at puzzling.org  Wed Jun 15 00:11:08 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 15 Jun 2005 14:11:08 +1000
Subject: [Twisted-Python] Preferred way to receive a patch?
In-Reply-To: <42AF9F17.1030900@elevasoft.com>
References: <42AF9F17.1030900@elevasoft.com>
Message-ID: <20050615041108.GC16836@home.puzzling.org>

On Tue, Jun 14, 2005, Laran Evans wrote:
> Should I just attach it to an email? Or should I attach it to the 
> Roundup issue?

Attach it to the roundup issue. If you don't get any response to the
issue within some reasonable period of time, mail the mailing list and
ask about it.

-Mary



From foom at fuhm.net  Wed Jun 15 00:16:00 2005
From: foom at fuhm.net (James Y Knight)
Date: Wed, 15 Jun 2005 00:16:00 -0400
Subject: [Twisted-Python] ACE vs. Twisted
In-Reply-To: <42AFA32F.9070108@yahoo.com>
References: <42AFA32F.9070108@yahoo.com>
Message-ID: <035994C4-332C-4C5B-914D-A9539824B0DF@fuhm.net>

On Jun 14, 2005, at 11:40 PM, Andrzej Leszczynski wrote:
> I have a general question, how the ACE differs conceptually from  
> Twisted?

As I understand it, they are pretty similar conceptually, except that  
ACE is in C++.

James




From twisted at ralphm.ik.nu  Wed Jun 15 05:51:53 2005
From: twisted at ralphm.ik.nu (Ralph Meijer)
Date: Wed, 15 Jun 2005 11:51:53 +0200
Subject: [Twisted-Python] Clean shutdown of an XMLStream session
In-Reply-To: <1118802497.21943.4.camel@moth.vislab.usyd.edu.au>
References: <1118802497.21943.4.camel@moth.vislab.usyd.edu.au>
Message-ID: <20050615095153.GA69043@ik.nu>

On Wed, Jun 15, 2005 at 12:28:17PM +1000, Steve Smith wrote:
> Hi,
> 
> This is probably a stupid question, but what is method of cleanly
> shutting down an XMLStream (such that it sends the terminating </stream>
> and closes the connection).

The cleanest way to end a connection is closing the 'XML document'.
Assuming xs is the object holding your XMLStream instance, simply do:

xs.send('</stream:stream>')

This signals to the other party that you want to end the conversation.
The peer will send you the same thing, and the connection will be
shutdown nicely. The STREAM_END_EVENT will be fired, so you can add an
observer to that.

-- 
Groetjes,

ralphm



From tv at twistedmatrix.com  Wed Jun 15 14:31:33 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Wed, 15 Jun 2005 21:31:33 +0300
Subject: [Twisted-Python] Re: ldaptor.protocols.ldap.ldapclient.startTLS
In-Reply-To: <149014b9050614115818c12cc6@mail.gmail.com>
References: <149014b9050614115818c12cc6@mail.gmail.com>
Message-ID: <42B07405.2010203@twistedmatrix.com>

[The list hates my @debian.org address. Sorry for the dup, Christopher]

Christopher Zorn wrote:
> I hope this is the correct place to ask about this, forgive me if it is not. 
> I recently tried to use ldaptor. It is great!!

This is. And thank you.

> I ran into one problem though. I wanted to use startTLS and I had to call 
> it myself.

Well, yes, you need to say when you want to use startTLS and when not..
Current default is "not".

Some day in the future I hope to support something like the
ldap://hostname, ldaps://hostname, ldapi://hostname syntaxes
and things like "whenever you talk to this server, require starttls
and verify the certificate is signed by one of these CAs". No such
thing exists for now, so you need to do the startTLS step manually.

>     def _startTLS(proto):
>         d = proto.startTLS()
>         d.addCallback(lambda _: proto)
>         return d
>         
>     d.addCallback(_startTLS)

I _think_ that can be written as

d.addCallback(lambda proto: proto.startTLS())

as the startTLS callback chain ends with

    def _cbStartTLS(self, msg, ctx):
        ...
        return self

Though I haven't tested it.

I really don't use starttls with ldaptor much (yet), so it may be still
somewhat buggy. Hopefully this will improve -- patches are appreciated.

> This would hang. I went to find out and there was a deferred created that seemed
> to have been getting lost. It was never called when handle was called in the 
> client class. 
> 
> I attached a patch that allows me to use startTLS the way I did it, but I do not
> know if this is correct. Please let me know if I am doing something
> wrong or if this
> is actually a bug. 

Yes, it is a bug, caused by the proto.send() changes in r180.
Your fix is correct. Thank you.




From matt.feifarek at gmail.com  Wed Jun 15 15:51:09 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Wed, 15 Jun 2005 15:51:09 -0400
Subject: [Twisted-Python] Strange exception deep in twisted
Message-ID: <6fb6dbfe050615125170c4adf3@mail.gmail.com>

Hello.

I'm using twisted 1.3.0 and python 2.4.1 on a 2.6.10 Linux box.

I've got an application that uses twisted.web.resource to render images.

I'm getting this strange exception in my logs, and I can't figure out
where to start looking for problems to fix; it's so deep in twisted.

Note that my app IS working; the images are coming to the browser, but
they're coming out in bursts, rather than one-by-one, as I'm used to.

Here's the info from the log file.

Note that if I do a dump on that args[0], it IS an instance of
twisted.web.server.Request and it does have "channel" in its __dict__.

Thanks!

-----------------------
Unhandled error in Deferred:
Traceback (most recent call last):
  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 313, in _startRunCallbacks
    self._runCallbacks()

  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 338, in _runCallbacks
    self.result = callback(self.result, *args, **kw)

  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 252, in callback
    self._startRunCallbacks(result)

  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 313, in _startRunCallbacks
    self._runCallbacks()

--- <exception caught here> ---

  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 338, in _runCallbacks
    self.result = callback(self.result, *args, **kw)

  File "/usr/local/lib/python2.4/site-packages/Wrangler/render/image/__init__.py",
line 132, in postConvert_Success
    Inline_Generic.render_present( self, args[0] )

  File "/usr/local/lib/python2.4/site-packages/Wrangler/render/generic.py",
line 131, in render_present
    static.FileTransfer(f, size, request)

  File "/usr/lib/python2.4/site-packages/twisted/web/static.py", line
426, in __init__
    request.registerProducer(self, 0)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 583, in registerProducer
    self.transport.registerProducer(producer, streaming)

  File "/usr/lib/python2.4/site-packages/twisted/internet/abstract.py",
line 241, in registerProducer
    producer.resumeProducing()

  File "/usr/lib/python2.4/site-packages/twisted/web/static.py", line
437, in resumeProducing
    self.request.finish()

  File "/usr/lib/python2.4/site-packages/twisted/web/server.py", line
277, in finish
    http.Request.finish(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 634, in finish
    self._cleanup()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 447, in _cleanup
    self.channel.requestDone(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 1062, in requestDone
    self.requests[0].noLongerQueued()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 478, in noLongerQueued
    self.transport.registerProducer(self.producer, self.streamingProducer)

  File "/usr/lib/python2.4/site-packages/twisted/internet/abstract.py",
line 241, in registerProducer
    producer.resumeProducing()

  File "/usr/lib/python2.4/site-packages/twisted/web/static.py", line
437, in resumeProducing
    self.request.finish()

  File "/usr/lib/python2.4/site-packages/twisted/web/server.py", line
277, in finish
    http.Request.finish(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 634, in finish
    self._cleanup()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 447, in _cleanup
    self.channel.requestDone(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 1062, in requestDone
    self.requests[0].noLongerQueued()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 478, in noLongerQueued
    self.transport.registerProducer(self.producer, self.streamingProducer)

  File "/usr/lib/python2.4/site-packages/twisted/internet/abstract.py",
line 241, in registerProducer
    producer.resumeProducing()

  File "/usr/lib/python2.4/site-packages/twisted/web/static.py", line
437, in resumeProducing
    self.request.finish()

  File "/usr/lib/python2.4/site-packages/twisted/web/server.py", line
277, in finish
    http.Request.finish(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 634, in finish
    self._cleanup()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 447, in _cleanup
    self.channel.requestDone(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 1062, in requestDone
    self.requests[0].noLongerQueued()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 482, in noLongerQueued
    self._cleanup()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 447, in _cleanup
    self.channel.requestDone(self)

exceptions.AttributeError: Request instance has no attribute 'channel'



From luc.stepniewski at adelux.fr  Thu Jun 16 02:46:17 2005
From: luc.stepniewski at adelux.fr (Luc Stepniewski)
Date: Thu, 16 Jun 2005 08:46:17 +0200
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
Message-ID: <200506160846.17897.luc.stepniewski@adelux.fr>

On Wednesday 15 June 2005 03:17, Jp Calderone wrote:
> On Tue, 14 Jun 2005 17:45:54 -0700, Ian Duggan <ian at ianduggan.net> wrote:
> >Hi,
> >
> >Does anyone know of any tools that could be used to wrap a python module
> > and capture/report blocking calls made by it?

I've go tthe same difficulties here.  I'm trying to integrate into Twisted a 
method (which comes from a python+C compiled module) that returns data. The 
problem is that this method is blocking, so I can't integrate it easily in 
Twisted.
So what I would like to do is, in a perfect world (i think):
- Make an infinite loop in which I have this blocking method
- When some data is returned from that method call, do some stuff on it, like
call a PB remote method, call a deferred, adding callbacks (I mean I need/use
the reactor). This work would not be blocking (it shouldn't as it's twisted 
stuff) as I need to get the results (callbacks).
- loop, etc.

My current solution is to use a separate thread for that blocking call, 
keeping the main twisted reactor in the main process. I can call twisted 
deferred by using the callFromThread() method, but the code is horribly big 
(and slow) and complex, even using exarkun's ThreadWrapper (from sandbox) :-(
Is threadedselectreactor what I'm looking for? I did not really understand 
what reactor.interleave() is supposed to call, as all I have is a method to 
call which blocks...

Luc



From tv at twistedmatrix.com  Thu Jun 16 04:18:57 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu, 16 Jun 2005 11:18:57 +0300
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <200506160846.17897.luc.stepniewski@adelux.fr>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
	<200506160846.17897.luc.stepniewski@adelux.fr>
Message-ID: <42B135F1.2020602@twistedmatrix.com>

Luc Stepniewski wrote:
> I've go tthe same difficulties here.  I'm trying to integrate into Twisted a 
> method (which comes from a python+C compiled module) that returns data. The 
> problem is that this method is blocking, so I can't integrate it easily in 
> Twisted.

Sounds like you want to run twisted as normal and just call
d = reactor.callInThread(bigUglyBlockingThing)
when you want more stuff from it.



From luc.stepniewski at adelux.fr  Thu Jun 16 04:51:24 2005
From: luc.stepniewski at adelux.fr (Luc Stepniewski)
Date: Thu, 16 Jun 2005 10:51:24 +0200
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <42B135F1.2020602@twistedmatrix.com>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
	<200506160846.17897.luc.stepniewski@adelux.fr>
	<42B135F1.2020602@twistedmatrix.com>
Message-ID: <200506161051.24422.luc.stepniewski@adelux.fr>

On Thursday 16 June 2005 10:18, Tommi Virtanen wrote:
> Luc Stepniewski wrote:
> > I've go tthe same difficulties here.  I'm trying to integrate into
> > Twisted a method (which comes from a python+C compiled module) that
> > returns data. The problem is that this method is blocking, so I can't
> > integrate it easily in Twisted.
>
> Sounds like you want to run twisted as normal and just call
> d = reactor.callInThread(bigUglyBlockingThing)
> when you want more stuff from it.

You're right, that's what I said I was doing. I was just making the point that 
it's easy to call methods from that thread using callFromThread(), but it's a 
pain to call a method which returns a deferred. Hopefully there's exarkun's 
ThreadWrapper (only in sandbox). Using this, I have some slowdown, but I'm 
not yet sure it's Twisted's fault.
So I was just asking if there was another way of doing it.

Luc




From tv at twistedmatrix.com  Thu Jun 16 07:53:23 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu, 16 Jun 2005 14:53:23 +0300
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <200506161051.24422.luc.stepniewski@adelux.fr>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>	<200506160846.17897.luc.stepniewski@adelux.fr>	<42B135F1.2020602@twistedmatrix.com>
	<200506161051.24422.luc.stepniewski@adelux.fr>
Message-ID: <42B16833.1080501@twistedmatrix.com>

Luc Stepniewski wrote:
> You're right, that's what I said I was doing. I was just making the point that 
> it's easy to call methods from that thread using callFromThread(), but it's a 
> pain to call a method which returns a deferred. Hopefully there's exarkun's 

Well, you have a few possibilities.

1. I haven't checked, but I guess a function called with callInThread
   could return a deferred.

2. If you need to interleave blocking and Deferred operations, split
it out. Instead of

def bigUglyThingThatBlocks():
    ...
    someVar = value
    ...
    d = something(someVar)
    d.addCallback(moreStuff)
    ...
    # we want "x" to be result of d here, but don't know how
    moreBlockingThings(x)

d = reactor.callInThread(bigUglyThingThatBlocks)

you can say

def smallerUglyThingThatBlocks():
    ...
    someVar = value
    ...
    return someVar

d = reactor.callInThread(smallerUglyThingThatBlocks)
d.addCallback(something)
d.addCallback(moreStuff)
d.addCallback(lambda x: reactor.callInThread(moreBlockingThings, x))



From itamar at itamarst.org  Thu Jun 16 11:16:15 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 16 Jun 2005 11:16:15 -0400
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <42B16833.1080501@twistedmatrix.com>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
	<200506160846.17897.luc.stepniewski@adelux.fr>
	<42B135F1.2020602@twistedmatrix.com>
	<200506161051.24422.luc.stepniewski@adelux.fr>
	<42B16833.1080501@twistedmatrix.com>
Message-ID: <1118934975.8674.34.camel@localhost.localdomain>

On Thu, 2005-06-16 at 14:53 +0300, Tommi Virtanen wrote:

> d = reactor.callInThread(smallerUglyThingThatBlocks)

this should be:

  d = twisted.internet.threads.deferToThread(smallerUglyThingThatBlocks)

callInThread does not return any result.




From ian at ianduggan.net  Thu Jun 16 12:56:23 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 16 Jun 2005 09:56:23 -0700
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
Message-ID: <200506160956.23811.ian@ianduggan.net>


On Tuesday 14 June 2005 18:17, Jp Calderone wrote:
> >Does anyone know of any tools that could be used to wrap a python module
> > and capture/report blocking calls made by it?
>
> <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/btt.py> (and
> <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/test_btt.py>) might be of
> interest/use.  I haven't done much with it yet, so I don't know if it's
> actually effective.  I'd be interested to hear if you have any luck with
> it.

Heh, this is a very clever trick, setting and disabling an alarm in a looping 
call. If it doesn't get disabled in time, it tells you where the stack is. It 
actually works great! I was able to immediately test it by suspending twisted 
for a moment.

I had to tune the precisions it was using, to prevent it from firing 
spuriously when my laptop got busy, but otherwise it's very cool. I love 
simple.

Suggestions for anyone else who uses this:

1) Tune the precisions so that you have a quiet baseline.

2) If the network you are interacting with is too fast, find a way to throttle 
your connection. 

http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/Adv-Routing-HOWTO.html

--Ian



From ian at ianduggan.net  Thu Jun 16 13:04:06 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 16 Jun 2005 10:04:06 -0700
Subject: [Twisted-Python] -shutdown taps
In-Reply-To: <50a522ca05060915564410af98@mail.gmail.com>
References: <200506080927.33419.ian@ianduggan.net>
	<200506081048.28903.ian@ianduggan.net>
	<50a522ca05060915564410af98@mail.gmail.com>
Message-ID: <200506161004.06669.ian@ianduggan.net>


On Thursday 09 June 2005 15:56, Michael Twomey wrote:
> The biggest thing which will kill the data is running the original tap
> again, not the -shutdown one. Running the original tap will overwrite
> the old shutdown one with a fresh instance. Since this can happen

Ok, so it sounds like I did understand the issues. I mostly want this for 
surviving quick upgrades. The connection info stored is useless if it's more 
than a minute old or so, and it's not the end of the world it it gets tossed.

I actually want it to blow things away and start over in some cases. I'll have 
my startup script look for -shutdown first, and otherwise start normally. 
I'll probably throw in a flag to force it either way as well.

Maybe a feature to prevent overwriting the old -shutdown unless the 
application was loaded from it would be a useful feature? I.e., force it to 
create a differently named -shutdown if so configured, and maybe log 
warnings?

> After experimenting with it and losing my data repeatedly I just wrote
> the data I was interested in to a pickle. Since you have the
> stopService hook in services, you can whack the persistence stuff in
> there.

Thanks, this will probably be stage2.

--Ian




From narnett at liveworld.com  Thu Jun 16 18:25:46 2005
From: narnett at liveworld.com (Nick Arnett)
Date: Thu, 16 Jun 2005 15:25:46 -0700
Subject: [Twisted-Python] Conch SSH help?
Message-ID: <42B1FC6A.6060201@liveworld.com>

I'm getting stuck trying to do something I imagined would be easy in 
Conch.  I want to log into a server, ls a directory, then grep inside a 
certain file in each of the directories found by the ls command.

I've had no trouble logging in and running ls, then capturing its 
output.  But then I'm stuck.  I can't figure out where to put the loop 
through the directories.  I can see how to do one in a new channel, but 
I sure can't see how to run the series of them and capture their 
output.  I want to end up with a data structure that has the directory 
name and the results of the grep as a list: [(dir, grep_results),...].

I've tried calling my "grep" channel object repeatedly and that sort of 
works, but only does the first seven or eight and fails.  I've tried 
putting the loop in the channelOpen method of the "grep" channel and 
that never gets any results.  I tried building a series of callbacks in 
there and running it, but that doesn't work, either.

What I also find confusing is that I run the command with sendRequest, 
but the results come back in the dataReceived method -- how does it know 
which command's results it is receiving?

Any help will be appreciated.

Nick




From jarrod.roberson at gmail.com  Thu Jun 16 18:46:51 2005
From: jarrod.roberson at gmail.com (jarrod roberson)
Date: Thu, 16 Jun 2005 18:46:51 -0400
Subject: [Twisted-Python] Combine XMLRPC and PB in one server?
In-Reply-To: <d8m10u$nqd$1@sea.gmane.org>
References: <d8m10u$nqd$1@sea.gmane.org>
Message-ID: <2389d473050616154610751fe9@mail.gmail.com>

On 6/14/05, apocalypznow <apocalypznow at gmail.com> wrote:
> 
> How do you make a server that handles both XMLRPC and PB?
> 
> How do you do this as a service?
> 
> When I mean service, I mean as in the following code:
> 
> application = twisted.application.service.Application("pbserver")
> myService = twisted.application.service.IServiceCollection(application)
> 
> p = portal.Portal(DefaultRealm())
> dbu=twisted.cred.checkers.InMemoryUsernamePasswordDatabaseDontUse()
> dbu.addUser("user1","pass1")
> p.registerChecker(dbu)
> 
> myServer =
> twisted.application.internet.TCPServer(8080,pb.PBServerFactory(p))
> myServer.setServiceParent(myService)



this is really simple and is explained in the HOW TO multiple protocols.

short story is you have your Factories delegate to the same service.




-- 
If you don't know what you want, you probably need a nap.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050616/f7f5967a/attachment.htm 

From ian at ianduggan.net  Thu Jun 16 19:25:31 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 16 Jun 2005 16:25:31 -0700
Subject: [Twisted-Python] Logging to multiple files
Message-ID: <200506161625.31552.ian@ianduggan.net>


Hi,

Anyone have any examples of logging to multiple files using the twisted 
logging framework? Ideally, I would like something like the logPrefix() 
functionality, only instead of prefixing lines, it would cause output to go 
to another logging source. Decorating classes, or using MixIns would be 
easiest.

Anything like that exist? I'm looking around in the code, but I'm getting 
confused between twisted.python.log, twisted.python.logging and the event 
archtiecture around the LogPublisher...

--Ian



From narnett at liveworld.com  Thu Jun 16 20:18:46 2005
From: narnett at liveworld.com (Nick Arnett)
Date: Thu, 16 Jun 2005 17:18:46 -0700
Subject: [Twisted-Python] Conch SSH help?
In-Reply-To: <42B1FC6A.6060201@liveworld.com>
References: <42B1FC6A.6060201@liveworld.com>
Message-ID: <42B216E6.4090409@liveworld.com>

To shed a  bit more light on this... I can get it to open 10 channels, 
then it's refusing to open more, which is the problem I'm now trying to 
solve.  But I can't figure out how to close the channels appropriately.  
I've tried putting a self.loseConnection in various places, but it 
doesn't seem to get called soon enough.

I guess what I really need to do is figure out how to only start one of 
these if the number of channels open is less than 10... which I'm 
guessing means using callbacks in the SSHConnection object...?

Nick




From kevin at electricanvil.com  Thu Jun 16 21:31:00 2005
From: kevin at electricanvil.com (Kevin Smith)
Date: Thu, 16 Jun 2005 21:31:00 -0400
Subject: [Twisted-Python] Using Deferreds
Message-ID: <42B227D4.2050306@electricanvil.com>

Getting my feet wet with Twisted and I've got a couple of questions
regarding Deferreds. To wit:

1) Is there a way to re-use Deferreds? It seems that a Deferred instance
is not usable after a callback has been triggered. When I try to trigger
a second callback on the same instance a AlreadyCalledError is raised.
Is there another approach I should be using?

2) I don't have a concrete reason for needing to do this, but is it
possible to remove a function registered as a callback from a Deferred?
I ask this question more out of curiosity rather than any practical need.

Thanks,
Kevin



From glyph at divmod.com  Thu Jun 16 22:31:29 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Thu, 16 Jun 2005 22:31:29 -0400
Subject: [Twisted-Python] Using Deferreds
In-Reply-To: <42B227D4.2050306@electricanvil.com>
References: <42B227D4.2050306@electricanvil.com>
Message-ID: <42B23601.9000100@divmod.com>

Kevin Smith wrote:

> 1) Is there a way to re-use Deferreds? It seems that a Deferred instance
> is not usable after a callback has been triggered. When I try to trigger
> a second callback on the same instance a AlreadyCalledError is raised.
> Is there another approach I should be using?

This is intentionally impossible.  A Deferred represents a single 
operation - there are no sensible semantics for re-starting a callback 
chain because you could add a new callback to a Deferred at any time.

> 2) I don't have a concrete reason for needing to do this, but is it
> possible to remove a function registered as a callback from a Deferred?
> I ask this question more out of curiosity rather than any practical need.

Nope.




From tom.cocagne at gmail.com  Fri Jun 17 00:06:16 2005
From: tom.cocagne at gmail.com (Tom Cocagne)
Date: Fri, 17 Jun 2005 00:06:16 -0400
Subject: [Twisted-Python] C++ implementation of Deferreds
Message-ID: <198edda90506162106729e2618@mail.gmail.com>

    Greetings all. 

    I'm curious to know if anyone has tried implementing a C++ version
of Twisted's Deferreds library. I've spent a day or so on an initial
prototype and it seems to be working out suprisingly well. Before I
put much more effort into it though, I thought I'd check to see if I'd
be reinventing the wheel with this one.

    Cheers,

    Tom



From z3p at twistedmatrix.com  Fri Jun 17 00:29:56 2005
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Fri, 17 Jun 2005 00:29:56 -0400
Subject: [Twisted-Python] Conch SSH help?
In-Reply-To: <42B216E6.4090409@liveworld.com>
References: <42B1FC6A.6060201@liveworld.com> <42B216E6.4090409@liveworld.com>
Message-ID: <1118982597.5248.7.camel@petra>

On Thu, 2005-06-16 at 17:18 -0700, Nick Arnett wrote:
> To shed a  bit more light on this... I can get it to open 10 channels, 
> then it's refusing to open more, which is the problem I'm now trying to 
> solve.  But I can't figure out how to close the channels appropriately.  
> I've tried putting a self.loseConnection in various places, but it 
> doesn't seem to get called soon enough.
> 
> I guess what I really need to do is figure out how to only start one of 
> these if the number of channels open is less than 10... which I'm 
> guessing means using callbacks in the SSHConnection object...?

Since you clearly have code demonstrating this problem, could you try to
fashion it into a minimal example and file a bug? (you can assign it to
me)  Also helpful would be the server you're trying to connect to.  It
may be that it's a problem on the server end.

-p
-- 
       Paul Swartz
(o_    http://z3p.livejournal.com/  _o)
//\    z3p at twistedmatrix.com        /\\
V_/_   AIM: z3penguin              _\_V->
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050617/aee74035/attachment.pgp 

From exarkun at divmod.com  Fri Jun 17 01:41:39 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Fri, 17 Jun 2005 01:41:39 -0400
Subject: [Twisted-Python] C++ implementation of Deferreds
In-Reply-To: <198edda90506162106729e2618@mail.gmail.com>
Message-ID: <20050617054139.5047.1390328222.divmod.quotient.4244@ohm>

On Fri, 17 Jun 2005 00:06:16 -0400, Tom Cocagne <tom.cocagne at gmail.com> wrote:
>    Greetings all.
>
>    I'm curious to know if anyone has tried implementing a C++ version
>of Twisted's Deferreds library. I've spent a day or so on an initial
>prototype and it seems to be working out suprisingly well. Before I
>put much more effort into it though, I thought I'd check to see if I'd
>be reinventing the wheel with this one.

http://svn.twistedmatrix.com/cvs/branches/foom/--omg-optimized/twisted/internet/cdefer/

Jp



From dguaraglia at gmx.de  Fri Jun 17 09:52:10 2005
From: dguaraglia at gmx.de (David Guaraglia)
Date: Fri, 17 Jun 2005 10:52:10 -0300
Subject: [Twisted-Python] Simple question
Message-ID: <42B2D58A.4050507@gmx.de>

Hello,

Maybe I'm being lazy not reading the whole documentation, but how can I 
get a (server) protocol to send an ACK to all connected clientes? Do I 
need to use  a separate thread or is there a way to set up a timer that 
goes off every X seconds?

Thanks in advance,

David



From sc at linux.it  Fri Jun 17 10:21:19 2005
From: sc at linux.it (Stefano Canepa)
Date: Fri, 17 Jun 2005 16:21:19 +0200
Subject: [Twisted-Python] Simple question
In-Reply-To: <42B2D58A.4050507@gmx.de>
References: <42B2D58A.4050507@gmx.de>
Message-ID: <1119018079.31337.39.camel@localhost.localdomain>

Il giorno ven, 17/06/2005 alle 10.52 -0300, David Guaraglia ha scritto:
> Hello,
> 
> Maybe I'm being lazy not reading the whole documentation, but how can I 
> get a (server) protocol to send an ACK to all connected clientes? Do I 
> need to use  a separate thread or is there a way to set up a timer that 
> goes off every X seconds?
> 
> Thanks in advance,

You were too lazy becouse it is written into:
http://twistedmatrix.com/users/warner/doc-latest/core/howto/time.html

Bye
Stefano

-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt? di un programmatore: pigrizia, impazienza e arroganza.
                                                              (Larry Wall)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050617/0e1da3e1/attachment.pgp 

From sc at linux.it  Fri Jun 17 10:41:17 2005
From: sc at linux.it (Stefano Canepa)
Date: Fri, 17 Jun 2005 16:41:17 +0200
Subject: [Twisted-Python] timeout and retries
Message-ID: <1119019277.31337.47.camel@localhost.localdomain>

The following code is a try to write a protocol with timeout and
retries. The connectioMade is used only as a test. I have some problems:
1) even if I placed "\x01" as delimiter the line is sent not terminated
2) even if timeout expired 3 times the success callback is called

Were is my mistake?

Secondly I will prefer to leave the protocol as simple as passible and
put all implementation details into the factory. I was unable to do
this, any suggestion would be of big help.

Thanks very much
Stefano

#!/usr/bin/env python
#
# Twisted modules 
#
from twisted.internet.protocol import ClientFactory
from twisted.protocols.basic import LineReceiver
from twisted.internet import reactor, defer
#
# Python modules
#
import re
#
# if it exists load configuration file
#
try:
    import HL7LLPClientConfig
except:
    #
    # else use defaults
    #
    TIMEOUT = 10
    PORT = 3000
    SERVER = 'localhost'
    RETRIES = 3
    pass

class HL7LLPClientProtocol(LineReceiver):
    """
    HL7 Lower Level Protocol initiating module implementation.
    It sends a packet, waits ACK/NACK or timeout in case of failure
    retries RETRIES times
    """
    # delimiter is set to <EB> (\x02 i.e. STX) so that the whole HL7
message
    # can be considered as a string
    delimiter = "\x02"
    msg = ""

    def __init__(self):
        self.ackMSG = re.compile("\x01\x06")
        self.nackMSG = re.compile("\x01\x15")

    def connectionMade(self):
        self.sendMsg("MSH|||||||||||")
        
    def sendMsg(self, msg, numRetries=RETRIES):
        """
        Store the message to be used by derived classes, send the
message and
        return a deferred
        """
        self.msg = msg
        self.sendLine(msg)
        return self.timeoutAndRetry(numRetries)
        
    def sendLine(self, msg):
        """
        Add <SB> (\x01 i.e. SOH) at the start of message as required by
        HL7 standard and send the message
        """
        msgToSend = "\x01"+msg
        print msgToSend
        self.transport.write(msgToSend)
        print "written"

    def lineReceived(self, response):
        """
        It receives the answer store it for use in the derived class and
        verify if it is ACK or NACK to cancel the timeout, every other
        string received is not valid answer so timeout continues to tick
        """
        m = self.ackMSG.match(response)
        n = self.nackMSG.match(response)
        if m or n:
            self.delayedCall.cancel()
            self.delayedCall = None  
        self.somethingResult.callback()
        self.somethingResult = None

    def timeoutAndRetry(self, n):
        """
        Create a deferred, fire the delayedCall, and return the deferred
        """
        d = defer.Deferred() 
        d.addErrback(self.tooManyRetries)
        d.addCallback(self.success)
        c = reactor.callLater(10, self._timeout, n)
        self.somethingResult, self.delayedCall = d, c
        return d
 
    def _timeout(self, n):
        """
        Retry to send if possible or raise and exception
        """
        print n
        if n > 0:
            d = self.somethingResult
            #self.sendMsg(self.msg, n - 1).chainDeferred(d)
            self.sendMsg(self.msg, n - 1)
        else:
            self.somethingResult.errback(Exception("TooManyRetries"))
            self.somethingResult = None

    def timeOutFailure(self, reason):
        """
        Don't know what to do in case of timeout
        """
        print "timeout failure %s " % reason

    def tooManyRetries(self, reason):
        """
        Don't know what to do in case of non timeout failure
        """
        print "non timeout failure %s" % reason

    def success(self, reason):
        """
        Don't know what to do in case of success
        """
        print "success %s" % reason
        
class HL7LLPClientFactory(ClientFactory):
   
    protocol = HL7LLPClientProtocol

def main():
    factory = HL7LLPClientFactory()
    reactor.connectTCP(SERVER, PORT, factory)
    reactor.run()

if __name__ == "__main__":
    main()


-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt? di un programmatore: pigrizia, impazienza e arroganza.
                                                              (Larry Wall)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050617/33b9b72f/attachment.pgp 

From shiznitmatt at yahoo.com  Fri Jun 17 11:10:11 2005
From: shiznitmatt at yahoo.com (Matt Doherty)
Date: Fri, 17 Jun 2005 08:10:11 -0700 (PDT)
Subject: [Twisted-Python] Want an ICMP implementation?
Message-ID: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>

I did an ICMP protocol and a transport that's along
the lines of twistet.internet.udp. Is anyone
interested in it enough that I should submit it?
-Matt


		
____________________________________________________ 
Yahoo! Sports 
Rekindle the Rivalries. Sign up for Fantasy Football 
http://football.fantasysports.yahoo.com



From dguaraglia at gmx.de  Fri Jun 17 11:29:52 2005
From: dguaraglia at gmx.de (David Guaraglia)
Date: Fri, 17 Jun 2005 12:29:52 -0300
Subject: [Twisted-Python] Want an ICMP implementation?
In-Reply-To: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>
References: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>
Message-ID: <42B2EC70.6060106@gmx.de>

Well it wouldn't be out of place in Twisted. Maybe you should contact 
one of the developers to include it in the main package :)

David

Matt Doherty wrote:

>I did an ICMP protocol and a transport that's along
>the lines of twistet.internet.udp. Is anyone
>interested in it enough that I should submit it?
>-Matt
>
>
>		
>____________________________________________________ 
>Yahoo! Sports 
>Rekindle the Rivalries. Sign up for Fantasy Football 
>http://football.fantasysports.yahoo.com
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>  
>




From narnett at liveworld.com  Fri Jun 17 11:41:47 2005
From: narnett at liveworld.com (Nick Arnett)
Date: Fri, 17 Jun 2005 08:41:47 -0700
Subject: [Twisted-Python] Conch SSH help?
In-Reply-To: <1118982597.5248.7.camel@petra>
References: <42B1FC6A.6060201@liveworld.com> <42B216E6.4090409@liveworld.com>
	<1118982597.5248.7.camel@petra>
Message-ID: <42B2EF3B.3050603@liveworld.com>

Paul Swartz wrote:

>Since you clearly have code demonstrating this problem, could you try to
>fashion it into a minimal example and file a bug? (you can assign it to
>me)  Also helpful would be the server you're trying to connect to.  It
>may be that it's a problem on the server end.
>
The bug would be...?  The failure of loseConnection()?  I'm not sure 
that's really a bug -- I think maybe it's a timing issue.  I'm about to 
try a couple of things in that regard.  I guess the problem as I now see 
it is a design issue -- the use of the "dataReceived" method, which is 
so different from the usual way a callback passes results.  But I'm not 
at all sure that I understand how I'm supposed to be using this.

As for the server, it's a generic sshd on Solaris.

Digging into the source a bit more, I think I could make a reasonable 
bug report.  I see in the source that channelClosed should always be 
called (which the example doesn't do).  But it fails because it uses 
channel_id, which is out of scope here.  I tried changing all of the 
occurrences of channel_id to self-channel_id, which seemed more 
reasonable... but then I'm getting key errors when it is used for a 
lookup in the localToRemoteChannel dict.

So... rather than just making a bug report, I'll see if I can't figure 
out how to fix all this, since it seems to be scope problems.  I really 
need to get something working and this module seems to be better than 
the other Python SSH gizmos I've tried.  (And even though debugging 
Twisted drives me crazy, I sure like what it does when it works.)

Nick









From shiznitmatt at yahoo.com  Fri Jun 17 11:50:14 2005
From: shiznitmatt at yahoo.com (Matt Doherty)
Date: Fri, 17 Jun 2005 08:50:14 -0700 (PDT)
Subject: [Twisted-Python] Want an ICMP implementation?
In-Reply-To: <42B2EC70.6060106@gmx.de>
Message-ID: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>

How do I do that?

--- David Guaraglia <dguaraglia at gmx.de> wrote:

> Well it wouldn't be out of place in Twisted. Maybe
> you should contact 
> one of the developers to include it in the main
> package :)
> 
> David
> 
> Matt Doherty wrote:
> 
> >I did an ICMP protocol and a transport that's along
> >the lines of twistet.internet.udp. Is anyone
> >interested in it enough that I should submit it?
> >-Matt
> >
> >
> >		
>
>____________________________________________________
> 
> >Yahoo! Sports 
> >Rekindle the Rivalries. Sign up for Fantasy
> Football 
> >http://football.fantasysports.yahoo.com
> >
> >_______________________________________________
> >Twisted-Python mailing list
> >Twisted-Python at twistedmatrix.com
>
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
> >
> >  
> >
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
>
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 



		
____________________________________________________ 
Yahoo! Sports 
Rekindle the Rivalries. Sign up for Fantasy Football 
http://football.fantasysports.yahoo.com



From projects at reedflute.com  Fri Jun 17 12:01:53 2005
From: projects at reedflute.com (Eugene Coetzee)
Date: Fri, 17 Jun 2005 18:01:53 +0200
Subject: [Twisted-Python] Want an ICMP implementation?
In-Reply-To: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>
References: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>
Message-ID: <42B2F3F1.4000704@reedflute.com>

Matt Doherty wrote:

>I did an ICMP protocol and a transport that's along
>the lines of twistet.internet.udp. Is anyone
>interested in it enough that I should submit it?
>-Matt
>  
>
I will have plenty of use for an ICMP implementation in Twisted.

regards,

Eugene coetzee


Web                 -> www.reedflute.com
=============================================== 




From itamar at itamarst.org  Fri Jun 17 12:06:44 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 17 Jun 2005 12:06:44 -0400
Subject: [Twisted-Python] Adding new code to Twisted
In-Reply-To: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>
References: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>
Message-ID: <1119024405.8741.35.camel@localhost.localdomain>

On Fri, 2005-06-17 at 08:50 -0700, Matt Doherty wrote:
> How do I do that?

Add patches or new modules, with tests of course :), to
http://twistedmatrix.com/bugs/ - at some point one of us will take a
look at it.

-- 
Itamar Shtull-Trauring <itamar at itamarst.org>
http://itamarst.org




From dguaraglia at gmx.de  Fri Jun 17 12:30:37 2005
From: dguaraglia at gmx.de (David Guaraglia)
Date: Fri, 17 Jun 2005 13:30:37 -0300
Subject: [Twisted-Python] Want an ICMP implementation?
In-Reply-To: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>
References: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>
Message-ID: <42B2FAAD.5030002@gmx.de>

Well, theoretically the developers read this mailing lists from time to 
time, but maybe the best way is to enter the #twisted channel in 
irc.freenode.net, and contact them there (they are very responsive).

Good luck!

David

Matt Doherty wrote:

>How do I do that?
>
>--- David Guaraglia <dguaraglia at gmx.de> wrote:
>
>  
>
>>Well it wouldn't be out of place in Twisted. Maybe
>>you should contact 
>>one of the developers to include it in the main
>>package :)
>>
>>David
>>
>>Matt Doherty wrote:
>>
>>    
>>
>>>I did an ICMP protocol and a transport that's along
>>>the lines of twistet.internet.udp. Is anyone
>>>interested in it enough that I should submit it?
>>>-Matt
>>>
>>>
>>>		
>>>      
>>>
>>____________________________________________________
>>
>>    
>>
>>>Yahoo! Sports 
>>>Rekindle the Rivalries. Sign up for Fantasy
>>>      
>>>
>>Football 
>>    
>>
>>>http://football.fantasysports.yahoo.com
>>>
>>>_______________________________________________
>>>Twisted-Python mailing list
>>>Twisted-Python at twistedmatrix.com
>>>      
>>>
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>    
>>
>>> 
>>>
>>>      
>>>
>>_______________________________________________
>>Twisted-Python mailing list
>>Twisted-Python at twistedmatrix.com
>>
>>    
>>
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>  
>
>
>
>
>		
>____________________________________________________ 
>Yahoo! Sports 
>Rekindle the Rivalries. Sign up for Fantasy Football 
>http://football.fantasysports.yahoo.com
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>  
>




From dgray at omniti.com  Fri Jun 17 12:51:01 2005
From: dgray at omniti.com (Dave Gray)
Date: Fri, 17 Jun 2005 12:51:01 -0400
Subject: [Twisted-Python] Strange exception deep in twisted
In-Reply-To: <6fb6dbfe050615125170c4adf3@mail.gmail.com>
References: <6fb6dbfe050615125170c4adf3@mail.gmail.com>
Message-ID: <42B2FF75.7070201@omniti.com>

Matt Feifarek wrote:
> -----------------------
> Unhandled error in Deferred:
> Traceback (most recent call last):
[snip]
>   File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
> line 447, in _cleanup
>     self.channel.requestDone(self)
> 
> exceptions.AttributeError: Request instance has no attribute 'channel'

I see errors like these when Deferreds fail and don't handle the error 
somehow and then, later on, get garbage collected. Perhaps this 
exception isn't happening exactly when you think it is?

<http://twisted.sourceforge.net/TwistedDocs-1.3.0/howto/defer.html#auto9>



From tom.cocagne at gmail.com  Fri Jun 17 13:00:43 2005
From: tom.cocagne at gmail.com (Tom Cocagne)
Date: Fri, 17 Jun 2005 13:00:43 -0400
Subject: [Twisted-Python] Re: C++ implementation of Deferreds
In-Reply-To: <20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
References: <198edda90506162106729e2618@mail.gmail.com>
	<20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
Message-ID: <198edda9050617100072fb91df@mail.gmail.com>

    Thanks for the link JP. I didn't know anyone was looking into
combining Twisted with Pyrex, it's good to see.
After re-reading my message, I can see that I wasn't very clear.

On 6/17/05, Jp Calderone <exarkun at divmod.com> wrote:
> On Fri, 17 Jun 2005 00:06:16 -0400, Tom Cocagne <tom.cocagne at gmail.com>
> wrote:
> >    Greetings all.
> >
> >    I'm curious to know if anyone has tried implementing a C++ version
> >of Twisted's Deferreds library. I've spent a day or so on an initial
> >prototype and it seems to be working out suprisingly well. Before I
> >put much more effort into it though, I thought I'd check to see if I'd
> >be reinventing the wheel with this one.
> 
> http://svn.twistedmatrix.com/cvs/branches/foom/--omg-optimized/twisted/internet/cdefer/
> 
> Jp
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From tom.cocagne at gmail.com  Fri Jun 17 13:03:37 2005
From: tom.cocagne at gmail.com (Tom Cocagne)
Date: Fri, 17 Jun 2005 13:03:37 -0400
Subject: [Twisted-Python] Re: C++ implementation of Deferreds
In-Reply-To: <20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
References: <198edda90506162106729e2618@mail.gmail.com>
	<20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
Message-ID: <198edda905061710037fb451c3@mail.gmail.com>

    Thanks for the link JP. I didn't know anyone was looking into
combining Twisted with Pyrex, it's good to see.
    After re-reading my message, I can see that I wasn't very clear.
I'm actually looking for a Deferred implementation as a library that's
usable from C++ rather than a C/C++ implementation to speed up
Twisted. I'm working on a hybrid Python / C++ project and would like
to be able to use the same Deferred mechanism within C++ that I get
from Twisted + Python.

    Cheers,

    Tom

On 6/17/05, Jp Calderone <exarkun at divmod.com> wrote:
> On Fri, 17 Jun 2005 00:06:16 -0400, Tom Cocagne <tom.cocagne at gmail.com>
> wrote:
> >    Greetings all.
> >
> >    I'm curious to know if anyone has tried implementing a C++ version
> >of Twisted's Deferreds library. I've spent a day or so on an initial
> >prototype and it seems to be working out suprisingly well. Before I
> >put much more effort into it though, I thought I'd check to see if I'd
> >be reinventing the wheel with this one.
> 
> http://svn.twistedmatrix.com/cvs/branches/foom/--omg-optimized/twisted/internet/cdefer/
> 
> Jp
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From itamar at itamarst.org  Fri Jun 17 13:13:56 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 17 Jun 2005 13:13:56 -0400
Subject: [Twisted-Python] Re: C++ implementation of Deferreds
In-Reply-To: <198edda905061710037fb451c3@mail.gmail.com>
References: <198edda90506162106729e2618@mail.gmail.com>
	<20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
	<198edda905061710037fb451c3@mail.gmail.com>
Message-ID: <1119028436.8741.41.camel@localhost.localdomain>

On Fri, 2005-06-17 at 13:03 -0400, Tom Cocagne wrote:

>     After re-reading my message, I can see that I wasn't very clear.
> I'm actually looking for a Deferred implementation as a library that's
> usable from C++ rather than a C/C++ implementation to speed up
> Twisted. I'm working on a hybrid Python / C++ project and would like
> to be able to use the same Deferred mechanism within C++ that I get
> from Twisted + Python.

That does sound useful. I've written Fusion
(http://itamarst.org/software/) which lets you implement Twisted
protocols in C++. Adding a Deferred-like class to that would be nice. If
this class could, via some automagic, also hook up to Python Deferreds
that would be even better.




From z3p at twistedmatrix.com  Fri Jun 17 13:43:38 2005
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Fri, 17 Jun 2005 13:43:38 -0400
Subject: [Twisted-Python] Conch SSH help?
In-Reply-To: <42B1FC6A.6060201@liveworld.com>
References: <42B1FC6A.6060201@liveworld.com>
Message-ID: <1119030220.5248.13.camel@petra>

On Thu, 2005-06-16 at 15:25 -0700, Nick Arnett wrote:
> I'm getting stuck trying to do something I imagined would be easy in 
> Conch.  I want to log into a server, ls a directory, then grep inside a 
> certain file in each of the directories found by the ls command.
> 
> I've had no trouble logging in and running ls, then capturing its 
> output.  But then I'm stuck.  I can't figure out where to put the loop 
> through the directories.  I can see how to do one in a new channel, but 
> I sure can't see how to run the series of them and capture their 
> output.  I want to end up with a data structure that has the directory 
> name and the results of the grep as a list: [(dir, grep_results),...].

It sounds like you want something like DeferredList.

> I've tried calling my "grep" channel object repeatedly and that sort of 
> works, but only does the first seven or eight and fails.  I've tried 
> putting the loop in the channelOpen method of the "grep" channel and 
> that never gets any results.  I tried building a series of callbacks in 
> there and running it, but that doesn't work, either.

What fails?  Does the channel fail to open?  Does it return the wrong
results?

> What I also find confusing is that I run the command with sendRequest, 
> but the results come back in the dataReceived method -- how does it know 
> which command's results it is receiving?

sendRequest tells the server what command to run.  The server runs that
command, and connects stdout/stdin to the SSH connection.  dataReceived
is then called with the data from stdout.

If you can get the code even into one file, that would be helpful.  It's
hard to know quite what's going on without seeing what you're doing.

-p
-- 
       Paul Swartz
(o_    http://z3p.livejournal.com/  _o)
//\    z3p at twistedmatrix.com        /\\
V_/_   AIM: z3penguin              _\_V->
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050617/5c689b98/attachment.pgp 

From pp64 at codelock.com  Fri Jun 17 15:08:26 2005
From: pp64 at codelock.com (Pavel Pergamenshchik)
Date: Fri, 17 Jun 2005 12:08:26 -0700
Subject: [Twisted-Python] Using Deferreds
In-Reply-To: <42B227D4.2050306@electricanvil.com>
References: <42B227D4.2050306@electricanvil.com>
Message-ID: <20050617120826.71f3afa2@dunce>

On Thu, 16 Jun 2005 21:31:00 -0400
Kevin Smith <kevin at electricanvil.com> wrote:

> Getting my feet wet with Twisted and I've got a couple of questions
> regarding Deferreds. To wit:
> 
> 1) Is there a way to re-use Deferreds? It seems that a Deferred instance
> is not usable after a callback has been triggered. When I try to trigger
> a second callback on the same instance a AlreadyCalledError is raised.
> Is there another approach I should be using?
> 
> 2) I don't have a concrete reason for needing to do this, but is it
> possible to remove a function registered as a callback from a Deferred?
> I ask this question more out of curiosity rather than any practical need.

Perhaps http://pydispatcher.sf.net is something that would suit you better.


P.S.: You people! Use pydispatcher more! It's totally awesome.



From liiwi at lonesom.pp.fi  Fri Jun 17 17:57:38 2005
From: liiwi at lonesom.pp.fi (Jaakko Niemi)
Date: Sat, 18 Jun 2005 00:57:38 +0300
Subject: [Twisted-Python] cred + PAM
In-Reply-To: <42AF526C.4030909@divmod.com>
References: <20050614201958.GA26005@jumper.lonesom.pp.fi>
	<42AF526C.4030909@divmod.com>
Message-ID: <20050617215738.GA28284@jumper.lonesom.pp.fi>

On Tue, 14 Jun 2005, Glyph Lefkowitz wrote:
> Jaakko Niemi wrote:
> > Hello,
> >
> > If you are interested of getting PAM support to cred, take a peek at:
> 
> Awesome!  I will definitely have a look at this soon.  I've wanted to 
> support PAM since day 1 with cred :)

 One issue is that some pam-modules want uid 0, and I at least
 don't want my stuff to run as root, if I can avoid it.
 
 Anyone got better idea than suid-wrapper that takes in user
 credentials and gives back yea/nay ?

		--j



From foom at fuhm.net  Fri Jun 17 21:40:18 2005
From: foom at fuhm.net (James Y Knight)
Date: Fri, 17 Jun 2005 21:40:18 -0400
Subject: [Twisted-Python] twisted.web2 0.1.0 released
Message-ID: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>

I'm happy to announce the first release of twisted.web2 today. This  
is a rewrite/refactor of the twisted.web HTTP server and framework,  
providing a nicer API (some parts inspired by the resource API that  
Nevow introduced on top of twisted.web) and many internal  
improvements, especially in the area of HTTP conformance.

Some highlights:
- Fully asynchronous twisted server.
- Can run as a HTTP/HTTPS server, or behind an apache mod_proxy, or  
serve requests via SCGI, or even just plain CGI.
- Supports SCGI clients, CGI scripts, WSGI applications. No new HTTP  
client/proxy yet, it's still on the TODO list.
- Also supports most twisted.web resources through a compatibility  
layer.
- Implements HTTP 1.1, including keep-alive, chunking, and pipelining.
- Has premade, correct, header parsers and generators for most of the  
headers.
- Supports streaming data input and output, has a nonblocking  
multipart/form-data parser.
- Automatic support for If-[Un]Modified-Since, If-[None-]Match and  
Range.

You can find downloads and documentation here:
     http://twistedmatrix.com/projects/web2/
You'll need at least Twisted 2.0.1 as well:
     http://twistedmatrix.com/projects/core/


This is still a preliminary release -- the API is not guaranteed to  
be stable to the next release.

James



From corydodt at twistedmatrix.com  Sat Jun 18 01:35:45 2005
From: corydodt at twistedmatrix.com (Cory Dodt)
Date: Fri, 17 Jun 2005 21:35:45 -0800
Subject: [Twisted-Python] Re: [Twisted-web] twisted.web2 0.1.0 released
In-Reply-To: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>
References: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>
Message-ID: <42B3B2B1.6000800@twistedmatrix.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Congratulations.  I'm looking forward to integrating it into Vellum.

C


James Y Knight wrote:
> I'm happy to announce the first release of twisted.web2 today. This  is
> a rewrite/refactor of the twisted.web HTTP server and framework, 
> providing a nicer API (some parts inspired by the resource API that 
> Nevow introduced on top of twisted.web) and many internal  improvements,
> especially in the area of HTTP conformance.
> 
> Some highlights:
> - Fully asynchronous twisted server.
> - Can run as a HTTP/HTTPS server, or behind an apache mod_proxy, or 
> serve requests via SCGI, or even just plain CGI.
> - Supports SCGI clients, CGI scripts, WSGI applications. No new HTTP 
> client/proxy yet, it's still on the TODO list.
> - Also supports most twisted.web resources through a compatibility  layer.
> - Implements HTTP 1.1, including keep-alive, chunking, and pipelining.
> - Has premade, correct, header parsers and generators for most of the 
> headers.
> - Supports streaming data input and output, has a nonblocking 
> multipart/form-data parser.
> - Automatic support for If-[Un]Modified-Since, If-[None-]Match and  Range.
> 
> You can find downloads and documentation here:
>     http://twistedmatrix.com/projects/web2/
> You'll need at least Twisted 2.0.1 as well:
>     http://twistedmatrix.com/projects/core/
> 
> 
> This is still a preliminary release -- the API is not guaranteed to  be
> stable to the next release.
> 
> James
> 
> _______________________________________________
> Twisted-web mailing list
> Twisted-web at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.5 (MingW32)
Comment: Using GnuPG with Thunderbird - http://enigmail.mozdev.org

iD8DBQFCs7Kk3A5SrXAiHQcRAtZQAJ0S+POf5U1dXsiQhasMiiqkR225zwCfUDbk
pFMvN9zJPRRjrgXWViGnnB0=
=ONdu
-----END PGP SIGNATURE-----



From andrew-twisted at puzzling.org  Sat Jun 18 06:34:49 2005
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Sat, 18 Jun 2005 20:34:49 +1000
Subject: [Twisted-Python] timeout and retries
In-Reply-To: <1119019277.31337.47.camel@localhost.localdomain>
References: <1119019277.31337.47.camel@localhost.localdomain>
Message-ID: <20050618103449.GA12957@trogdor.home.puzzling.org>

On Fri, Jun 17, 2005 at 04:41:17PM +0200, Stefano Canepa wrote:
> The following code is a try to write a protocol with timeout and
> retries. The connectioMade is used only as a test. I have some problems:
> 1) even if I placed "\x01" as delimiter the line is sent not terminated
[...]
>     def sendLine(self, msg):
>         """
>         Add <SB> (\x01 i.e. SOH) at the start of message as required by
>         HL7 standard and send the message
>         """
>         msgToSend = "\x01"+msg
>         print msgToSend
>         self.transport.write(msgToSend)
>         print "written"

You've overridden LineReceiver's sendLine to ignore the delimiter attribute.

> 2) even if timeout expired 3 times the success callback is called
[...]
>         d = defer.Deferred() 
>         d.addErrback(self.tooManyRetries)
>         d.addCallback(self.success)

Read the description of how callback/errback chains work again:

    http://twistedmatrix.com/projects/core/documentation/howto/defer.html#auto2

You probably meant:

        d = defer.Deferred() 
        d.addCallbacks(self.success, self.tooManyRetries)

Which has a subtly different meaning.

-Andrew.




From exarkun at divmod.com  Sat Jun 18 14:58:20 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sat, 18 Jun 2005 14:58:20 -0400
Subject: [Twisted-Python] Fwd: [Twisted-commits] r11032 - Made LineReceiver
 about 3x as fast, and clarified some of the docstrings.
In-Reply-To: 0
Message-ID: <20050618185820.5047.1935189464.divmod.quotient.5049@ohm>

Begin forwarded message:

> From: James Knight <foom at wolfwood.twistedmatrix.com>
> Date: Tue, 06 Jul 2004 13:53:09 -0600
> To: twisted-commits at twistedmatrix.com
> Subject: [Twisted-commits] r11032 - Made LineReceiver about 3x as fast,
	and clarified some of the docstrings.
> Reply-to: twisted-python at twistedmatrix.com
> 
> Author: foom
>Date: Tue Jul  6 13:53:08 2004
>New Revision: 11032
>
>Modified:
>   trunk/twisted/protocols/basic.py
>Log:
>Made LineReceiver about 3x as fast, and clarified some of the docstrings.
>
>
>
>Modified: trunk/twisted/protocols/basic.py
>==============================================================================
>--- trunk/twisted/protocols/basic.py	(original)
>+++ trunk/twisted/protocols/basic.py	Tue Jul  6 13:53:08 2004
>@@ -204,24 +204,31 @@
>         rawDataReceived, depending on mode.)
>         """
>         self.__buffer = self.__buffer+data
>+        lastoffset=0
>         while self.line_mode:
>-            try:
>-                line, self.__buffer = self.__buffer.split(self.delimiter, 1)
>-            except ValueError:
>+            offset=self.__buffer.find(self.delimiter, lastoffset)
>+            if offset == -1:
>+                self.__buffer=self.__buffer[lastoffset:]
>                 if len(self.__buffer) > self.MAX_LENGTH:
>-                    line, self.__buffer = self.__buffer, ''
>+                    line=self.__buffer
>+                    self.__buffer=''
>                     return self.lineLengthExceeded(line)
>                 break
>-            else:
>-                linelength = len(line)
>-                if linelength > self.MAX_LENGTH:
>-                    line, self.__buffer = self.__buffer, ''
>-                    return self.lineLengthExceeded(line)
>-                why = self.lineReceived(line)
>-                if why or self.transport and self.transport.disconnecting:
>-                    return why
>+
>+            line=self.__buffer[lastoffset:offset]
>+            lastoffset=offset+len(self.delimiter)
>+
>+            if len(line) > self.MAX_LENGTH:
>+                line=self.__buffer[lastoffset:]
>+                self.__buffer=''
>+                return self.lineLengthExceeded(line)
>+            why = self.lineReceived(line)
>+            if why or self.transport and self.transport.disconnecting:
>+                self.__buffer = self.__buffer[lastoffset:]
>+                return why
>         else:
>-            data, self.__buffer = self.__buffer, ''
>+            data=self.__buffer[lastoffset:]
>+            self.__buffer=''
>             if data:
>                 return self.rawDataReceived(data)
>

This changes dataReceived to call down into user code while the LineReceiver's instance attributes are in an inconsistent state.  This can lead to duplicate data delivery if dataReceived is called into from lineReceived.  Normally this sounds like a ridiculous thing to do, but notice the implementation of resumeProducing():

     def resumeProducing(self):
         self.paused = False
         self.dataReceived('')
         self.transport.resumeProducing()

Since resumeProducing is called immediately when a producer is registered, this means LineReceivers can no longer register themselves as producers for their transports from lineReceived, which is a much more reasonable thing to do.

Demonstration of the bug in action attached.

Jp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: linetest.py
Type: text/x-python
Size: 618 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050618/e47e28dd/attachment.py 

From sc at linux.it  Sat Jun 18 16:11:46 2005
From: sc at linux.it (Stefano Canepa)
Date: Sat, 18 Jun 2005 22:11:46 +0200
Subject: [Twisted-Python] timeout and retries
In-Reply-To: <20050618103449.GA12957@trogdor.home.puzzling.org>
References: <1119019277.31337.47.camel@localhost.localdomain>
	<20050618103449.GA12957@trogdor.home.puzzling.org>
Message-ID: <1119125506.7855.4.camel@localhost.localdomain>

Il giorno sab, 18/06/2005 alle 20.34 +1000, Andrew Bennetts ha scritto:
> On Fri, Jun 17, 2005 at 04:41:17PM +0200, Stefano Canepa wrote:
> > The following code is a try to write a protocol with timeout and
> > retries. The connectioMade is used only as a test. I have some problems:
> > 1) even if I placed "\x01" as delimiter the line is sent not terminated
> [...]
> >     def sendLine(self, msg):
> >         """
> >         Add <SB> (\x01 i.e. SOH) at the start of message as required by
> >         HL7 standard and send the message
> >         """
> >         msgToSend = "\x01"+msg
> >         print msgToSend
> >         self.transport.write(msgToSend)
> >         print "written"
> 
> You've overridden LineReceiver's sendLine to ignore the delimiter attribute.

Thanks I was able to find this error by my own. Thanks.

> > 2) even if timeout expired 3 times the success callback is called
> [...]
> >         d = defer.Deferred() 
> >         d.addErrback(self.tooManyRetries)
> >         d.addCallback(self.success)
> 
> Read the description of how callback/errback chains work again:
> 
>     http://twistedmatrix.com/projects/core/documentation/howto/defer.html#auto2
> 
> You probably meant:
> 
>         d = defer.Deferred() 
>         d.addCallbacks(self.success, self.tooManyRetries)
>
> Which has a subtly different meaning.

Now I see the difference, I am really new to twisted and even if I read
the howto and all docs I found on twisted site I need to read all again
to understand better.

Thanks
Stefano

-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt? di un programmatore: pigrizia, impazienza e arroganza.
                                                              (Larry Wall)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050618/5974f1e3/attachment.pgp 

From en.karpachov at ospaz.ru  Sun Jun 19 09:57:12 2005
From: en.karpachov at ospaz.ru (en.karpachov at ospaz.ru)
Date: Sun, 19 Jun 2005 17:57:12 +0400
Subject: [Twisted-Python] twisted.web2 0.1.0 released
In-Reply-To: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>
References: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>
Message-ID: <20050619135711.GB10607@ospaz.ru>

On Fri, Jun 17, 2005 at 09:40:18PM -0400, James Y Knight wrote:
> I'm happy to announce the first release of twisted.web2 today. This  

So how to deal with sessions now? It looks like this part is, well,
unstable yet. Is there some working method?

I also have a minor patch.

-- 
jk
-------------- next part --------------
diff -r -U 3 TwistedWeb2-0.1.orig/twisted/web2/server.py TwistedWeb2-0.1/twisted/web2/server.py
--- TwistedWeb2-0.1.orig/twisted/web2/server.py	2005-06-17 05:34:13.000000000 +0400
+++ TwistedWeb2-0.1/twisted/web2/server.py	2005-06-19 13:08:53.000000000 +0400
@@ -200,7 +200,7 @@
         if port == http.defaultPortForScheme.get(scheme, 0):
             hostport = host
         else:
-            hostport = host + ':' + port
+            hostport = host + ':' + str(port)
         
         return urlparse.urlunparse((
             scheme, hostport, path,

From foom at fuhm.net  Sun Jun 19 19:51:35 2005
From: foom at fuhm.net (James Y Knight)
Date: Sun, 19 Jun 2005 19:51:35 -0400
Subject: [Twisted-Python] Fwd: [Twisted-commits] r11032 - Made
	LineReceiver about 3x as fast, and clarified some of the docstrings.
In-Reply-To: <20050618185820.5047.1935189464.divmod.quotient.5049@ohm>
References: <20050618185820.5047.1935189464.divmod.quotient.5049@ohm>
Message-ID: <8524CF2E-3B48-40CA-B64F-06F7FB2A397F@fuhm.net>


On Jun 18, 2005, at 2:58 PM, Jp Calderone wrote:
> This changes dataReceived to call down into user code while the  
> LineReceiver's instance attributes are in an inconsistent state.   
> This can lead to duplicate data delivery if dataReceived is called  
> into from lineReceived.  Normally this sounds like a ridiculous  
> thing to do, but notice the implementation of resumeProducing():
>
>     def resumeProducing(self):
>         self.paused = False
>         self.dataReceived('')
>         self.transport.resumeProducing()
>
> Since resumeProducing is called immediately when a producer is  
> registered, this means LineReceivers can no longer register  
> themselves as producers for their transports from lineReceived,  
> which is a much more reasonable thing to do.
>
> Demonstration of the bug in action attached.

Two things about that:
1) resumeProducing actually now says:
     def resumeProducing(self):
         self.paused = False
         self.transport.resumeProducing()
         self.dataReceived('')

This was changed because of <http://twistedmatrix.com/pipermail/ 
twisted-python/2005-February/009626.html> also <http:// 
twistedmatrix.com/bugs/issue899>.

However, if resumeProducing is allowed to immediately produce data,  
this is somewhat bogus, as it could reverse the order of the data. In  
reality, a TCP transport's resumeProducing will not immediately  
produce data, but I think that's a fragile API to both have  
resumeProducing immediately produce data, and depend on a call to  
someone else resumeProducing not immediately producing data. I think  
there's an issue here.

2) dataReceived can be easily fixed to handle this by using a local  
-- patch coming separately.

James



From foom at fuhm.net  Sun Jun 19 20:47:56 2005
From: foom at fuhm.net (James Y Knight)
Date: Sun, 19 Jun 2005 20:47:56 -0400
Subject: [Twisted-Python] Fwd: [Twisted-commits] r11032 - Made
	LineReceiver about 3x as fast, and clarified some of the docstrings.
In-Reply-To: <8524CF2E-3B48-40CA-B64F-06F7FB2A397F@fuhm.net>
References: <20050618185820.5047.1935189464.divmod.quotient.5049@ohm>
	<8524CF2E-3B48-40CA-B64F-06F7FB2A397F@fuhm.net>
Message-ID: <FC3AC447-B4A0-4609-AD39-1C91B954B776@fuhm.net>


On Jun 19, 2005, at 7:51 PM, James Y Knight wrote:

> Two things about that:
> 1) resumeProducing actually now says:
>     def resumeProducing(self):
>         self.paused = False
>         self.transport.resumeProducing()
>         self.dataReceived('')
>
> This was changed because of <http://twistedmatrix.com/pipermail/ 
> twisted-python/2005-February/009626.html> also <http:// 
> twistedmatrix.com/bugs/issue899>.
>
> However, if resumeProducing is allowed to immediately produce data,  
> this is somewhat bogus, as it could reverse the order of the data.  
> In reality, a TCP transport's resumeProducing will not immediately  
> produce data, but I think that's a fragile API to both have  
> resumeProducing immediately produce data, and depend on a call to  
> someone else resumeProducing not immediately producing data. I  
> think there's an issue here.

Actually, there is no even potential for reordering of data --  
dataReceived is called with '', afterall. I'm not quite sure what I  
was thinking when I wrote that...sorry.

James



From exarkun at divmod.com  Sun Jun 19 20:57:19 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sun, 19 Jun 2005 20:57:19 -0400
Subject: [Twisted-Python] Fwd: [Twisted-commits] r11032 - Made
	LineReceiver about 3x as fast, and clarified some of the docstrings.
In-Reply-To: <8524CF2E-3B48-40CA-B64F-06F7FB2A397F@fuhm.net>
Message-ID: <20050620005719.5047.1423065954.divmod.quotient.5753@ohm>

On Sun, 19 Jun 2005 19:51:35 -0400, James Y Knight <foom at fuhm.net> wrote:
>
>On Jun 18, 2005, at 2:58 PM, Jp Calderone wrote:
>>This changes dataReceived to call down into user code while the 
>>LineReceiver's instance attributes are in an inconsistent state.   This can 
>>lead to duplicate data delivery if dataReceived is called  into from 
>>lineReceived.  Normally this sounds like a ridiculous  thing to do, but 
>>notice the implementation of resumeProducing():
>>
>>     def resumeProducing(self):
>>         self.paused = False
>>         self.dataReceived('')
>>         self.transport.resumeProducing()
>>
>>Since resumeProducing is called immediately when a producer is  registered, 
>>this means LineReceivers can no longer register  themselves as producers 
>>for their transports from lineReceived,  which is a much more reasonable 
>>thing to do.
>>
>>Demonstration of the bug in action attached.
>
>Two things about that:
>1) resumeProducing actually now says:
>     def resumeProducing(self):
>         self.paused = False
>         self.transport.resumeProducing()
>         self.dataReceived('')
>
>This was changed because of <http://twistedmatrix.com/pipermail/ twisted- 
>python/2005-February/009626.html> also <http:// 
>twistedmatrix.com/bugs/issue899>.
>
>However, if resumeProducing is allowed to immediately produce data,  this is 
>somewhat bogus, as it could reverse the order of the data. In  reality, a 
>TCP transport's resumeProducing will not immediately  produce data, but I 
>think that's a fragile API to both have  resumeProducing immediately produce 
>data, and depend on a call to  someone else resumeProducing not immediately 
>producing data. I think  there's an issue here.
>
>2) dataReceived can be easily fixed to handle this by using a local  -- 
>patch coming separately.

[Patch received out of band]

I've created an issue for this and attached a slightly modified version of the patch.  See <http://twistedmatrix.com/bugs/issue1087>.

Jp



From saphirra at gmail.com  Mon Jun 20 00:10:58 2005
From: saphirra at gmail.com (Jen Dockter)
Date: Sun, 19 Jun 2005 21:10:58 -0700
Subject: [Twisted-Python] TM t-shirts
Message-ID: <7a24934f05061921105ae2ba3a@mail.gmail.com>

I am making Twisted Matrix t-shirts; I have presently just finished blanking 
out the screen and am now taking orders.

The shirts will be using the small TMLabs logo (not the full pyramid snake, 
but just the top bit) on the front, approximately 7x5" with the URL (
www.twistedmatrix.com <http://www.twistedmatrix.com>) in web-friendly 
Verdana Bold on the back.

These are high-quality, hand-made silk screenings; this is not crummy 
iron-on CafePress work. The cost per shirt is $14 for US orders or $16 for 
International; these prices include shipping.

You can order shirts here: http://saph.twistedmatrix.com/blog/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050619/05c0a7d4/attachment.htm 

From gns24 at sphinx.mythic-beasts.com  Mon Jun 20 06:49:50 2005
From: gns24 at sphinx.mythic-beasts.com (Graham Stratton)
Date: Mon, 20 Jun 2005 11:49:50 +0100 (BST)
Subject: [Twisted-Python] Re: Using twisted for web crawling
In-Reply-To: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
References: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
Message-ID: <Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>

Hello all!

I'm trying to write a python utility to fetch large numbers of web pages.
I originally wrote a multi-threaded app, but found that I had no control
of it.

I then re-wrote it using asyncore, which is fine apart from the fact that
a few connections open sockets which never get closed, and eventually I
run out of sockets (well, file descriptors).  I see Twisted can avoid this
problem by setting an interval after which an inactive connection is closed.

I've been browsing the Twisted site and don't really understand what I
would need to implement this utility using Twisted.  Is Twisted the right
technology for this, or is there a simple way to fix my 'socket leak' that
I am getting with asyncore?

Thanks in advance,

Graham




From Henning.Ramm at mediapro-gmbh.de  Mon Jun 20 10:15:57 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Mon, 20 Jun 2005 16:15:57 +0200
Subject: [Twisted-Python] TM t-shirts
Message-ID: <F92274058556DE42B94B148EEFB9183949E725@exchange-03.suedkurier.de>

> You can order shirts here: http://saph.twistedmatrix.com/blog/

Nice, but what colors (T-Shirt/print) are available? Perhaps you could make a selector for that also?

Best regards,
Henning Hraban Ramm
S?dkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From dialtone at divmod.com  Mon Jun 20 12:16:20 2005
From: dialtone at divmod.com (Valentino Volonghi aka Dialtone)
Date: Mon, 20 Jun 2005 18:16:20 +0200
Subject: [Twisted-Python] Re: Using twisted for web crawling
In-Reply-To: <Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>
References: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
	<Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>
Message-ID: <42B6EBD4.5060102@divmod.com>

Graham Stratton wrote:

>I've been browsing the Twisted site and don't really understand what I
>would need to implement this utility using Twisted.  Is Twisted the right
>technology for this, or is there a simple way to fix my 'socket leak' that
>I am getting with asyncore?
>  
>
http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/277099

Check this out.

--  
Valentino Volonghi aka Dialtone
Now Running MacOSX 10.4.1
Blog: http://vvolonghi.blogspot.com
http://weever.berlios.de




From saphirra at gmail.com  Mon Jun 20 18:48:28 2005
From: saphirra at gmail.com (Jen Dockter)
Date: Mon, 20 Jun 2005 15:48:28 -0700
Subject: [Twisted-Python] TM t-shirts
Message-ID: <7a24934f050620154836887901@mail.gmail.com>

Message: 6
Date: Mon, 20 Jun 2005 16:15:57 +0200
From: <Henning.Ramm at mediapro-gmbh.de>
Subject: RE: [Twisted-Python] TM t-shirts
To: <saphirra at gmail.com>, <twisted-python at twistedmatrix.com>
Message-ID:
<F92274058556DE42B94B148EEFB9183949E725 at exchange-03.suedkurier.de>
Content-Type: text/plain; charset="iso-8859-1"

>> You can order shirts here: http://saph.twistedmatrix.com/blog/
>
>Nice, but what colors (T-Shirt/print) are available? Perhaps you could make 
a selector for that also?
>
>Best regards,
>Henning Hraban Ramm
>S?dkurier Medienhaus / MediaPro
>Support/Admin/Development Dept.

There are now colour options; first colour is the shirt, second is the 
print.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050620/4a41e446/attachment.htm 

From saphirra at gmail.com  Mon Jun 20 20:25:36 2005
From: saphirra at gmail.com (Jen Dockter)
Date: Mon, 20 Jun 2005 17:25:36 -0700
Subject: [Twisted-Python] TM t-shirts
In-Reply-To: <F92274058556DE42B94B148EEFB9183949E725@exchange-03.suedkurier.de>
References: <F92274058556DE42B94B148EEFB9183949E725@exchange-03.suedkurier.de>
Message-ID: <7a24934f050620172539d2c972@mail.gmail.com>

I am placing an order for the blank shirts to the supplier on Wednesday; so, 
if you want your order to ship with the first batch, get in your order by 
then: http://saph.twistedmatrix.com/blog/archives/000108.html

On 6/20/05, Henning.Ramm at mediapro-gmbh.de <Henning.Ramm at mediapro-gmbh.de> 
wrote:
> 
> > You can order shirts here: http://saph.twistedmatrix.com/blog/
> 
> Nice, but what colors (T-Shirt/print) are available? Perhaps you could 
> make a selector for that also?
> 
> Best regards,
> Henning Hraban Ramm
> S?dkurier Medienhaus / MediaPro
> Support/Admin/Development Dept.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050620/e1b2c3bd/attachment.htm 

From nkeric at gmail.com  Tue Jun 21 00:50:34 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 21 Jun 2005 12:50:34 +0800
Subject: [Twisted-Python] How could I distinguish each TCP connection?
Message-ID: <43c0d2b505062021508cfe424@mail.gmail.com>

Hi all,

I'm familiar with the thread-style network programming (create a single 
thread for each connected client).
With twisted, how could I know which client I'm talking to? (or, how could I 
maintain the connections list?)

I'm thinking of creating a Client object to represent each connected client
Could I save the transport to the Client object so that I can retrive that 
transport back to talk to a specific client?

Please point me to somewhere I could find the answer or enlighten me with 
some sample code, thanks in advance!

- Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050621/fbba2ba7/attachment.htm 

From radeex at gmail.com  Tue Jun 21 00:56:57 2005
From: radeex at gmail.com (Christopher Armstrong)
Date: Tue, 21 Jun 2005 14:56:57 +1000
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <43c0d2b505062021508cfe424@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
Message-ID: <60ed19d4050620215650648130@mail.gmail.com>

On 6/21/05, Eric Hsu <nkeric at gmail.com> wrote:
> Hi all,
>  
>  I'm familiar with the thread-style network programming (create a single
> thread for each connected client).
>  With twisted, how could I know which client I'm talking to? (or, how could
> I maintain the connections list?)
>  
>  I'm thinking of creating a Client object to represent each connected client
>  Could I save the transport to the Client object so that I can retrive that
> transport back to talk to a specific client?

You can do it based on the Protocol instance. For TCP, there is one
Protocol instance per connection, and it has access to the transport.

-- 
  Twisted   |  Christopher Armstrong: International Man of Twistery
   Radix    |    -- http://radix.twistedmatrix.com
            |  Release Manager, Twisted Project
  \\\V///   |    -- http://twistedmatrix.com
   |o O|    |  
w----v----w-+



From nkeric at gmail.com  Tue Jun 21 01:20:11 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 21 Jun 2005 13:20:11 +0800
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <60ed19d4050620215650648130@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
	<60ed19d4050620215650648130@mail.gmail.com>
Message-ID: <43c0d2b505062022206408acdc@mail.gmail.com>

2005/6/21, Christopher Armstrong <radeex at gmail.com>:
> 
> You can do it based on the Protocol instance. For TCP, there is one
> Protocol instance per connection, and it has access to the transport.


Hi Christopher!

Big thanks first!

When I writing codes like the following to provide TCP/UDP services:

factory = Factory()
factory.protocol = MyTCPService
reactor.listenTCP(port1, factory)
reactor.listenUDP(port2, MyUDPService())

How could I get the protocol instance of each client and maintain them?
Please tell me more details if you could, since I'm very very new to twisted 
:)

- Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050621/9cddd75f/attachment.htm 

From radeex at gmail.com  Tue Jun 21 01:26:12 2005
From: radeex at gmail.com (Christopher Armstrong)
Date: Tue, 21 Jun 2005 15:26:12 +1000
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <43c0d2b505062022206408acdc@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
	<60ed19d4050620215650648130@mail.gmail.com>
	<43c0d2b505062022206408acdc@mail.gmail.com>
Message-ID: <60ed19d405062022262eb99127@mail.gmail.com>

On 6/21/05, Eric Hsu <nkeric at gmail.com> wrote:
>  factory = Factory()
>  factory.protocol = MyTCPService
>  reactor.listenTCP(port1, factory)
>  reactor.listenUDP(port2, MyUDPService())
>  
>  How could I get the protocol instance of each client and maintain them?
>  Please tell me more details if you could, since I'm very very new to
> twisted :)

I suggest, instead of using the stock "Factory", making a subclass of
it with buildProtocol implemented like so:

def buildProtocol(self, addr):
    p = Factory.buildProtocol(self, addr)
    self.connections.append(p)
    return p

Or similar (you'll have to define the 'connections' list yourself in
__init__). In the protocol's connectionLost, you could then remove the
protocol from that list.

-- 
  Twisted   |  Christopher Armstrong: International Man of Twistery
   Radix    |    -- http://radix.twistedmatrix.com
            |  Release Manager, Twisted Project
  \\\V///   |    -- http://twistedmatrix.com
   |o O|    |  
w----v----w-+



From nkeric at gmail.com  Tue Jun 21 03:33:20 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 21 Jun 2005 15:33:20 +0800
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <60ed19d405062022262eb99127@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
	<60ed19d4050620215650648130@mail.gmail.com>
	<43c0d2b505062022206408acdc@mail.gmail.com>
	<60ed19d405062022262eb99127@mail.gmail.com>
Message-ID: <43c0d2b505062100335bd237ae@mail.gmail.com>

Thank you very much!
You've been a GREAT help :D

2005/6/21, Christopher Armstrong <radeex at gmail.com>:
> 
> I suggest, instead of using the stock "Factory", making a subclass of
> it with buildProtocol implemented like so:
> 
> def buildProtocol(self, addr):
> p = Factory.buildProtocol(self, addr)
> self.connections.append(p)
> return p
> 
> Or similar (you'll have to define the 'connections' list yourself in
> __init__). In the protocol's connectionLost, you could then remove the
> protocol from that list.
> 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050621/95ab402e/attachment.htm 

From zunbeltz at lcdx00.wm.lc.ehu.es  Tue Jun 21 04:30:49 2005
From: zunbeltz at lcdx00.wm.lc.ehu.es (zunbeltz)
Date: Tue, 21 Jun 2005 10:30:49 +0200 (CEST)
Subject: [Twisted-Python] newbie help (fwd)
Message-ID: <20050621103038.Y69229@lcdx00.wm.lc.ehu.es>

Hi,

I have the following problem.

I'm developing a GUI program (wxPython). This program has to comunicate
(TCP) whit other program that controls a laboratory machine to do a
measurement. I have a dialog box, wiht two buttoms "Start measurement" and
"Stop". "Start" executes a function that do the measurement in the
following way.

1) My program send a socket.
2) The other program recives it an send confirmation.
3) My program waits for the confirmation and send the next when
confirmation received.

This comunication is done in a new thread not to frezee the GUI.
The problem is that when "Stop" is done (it kills the thread) some
confirmation sockets are mixed (are not receibed in the correct order
although i use tcp).

I have been told not to do comunication in a new thread; instead, I should
use asyncronus comunication (asyncore or twisted).

My question:

How can i do that with twisted?
How can i implement this asyncronous comunication and the ability to
stop this long run funciton (the measurement can take hours or days, so
i need a way to stop it)?
Can twisted garantee that the confirmation socket will arrive in the
correct order (one after each sended socket)?
Can i use twisted 2.0 with wxPython 2.5.3.2?
Where can i found an example of twisted with wxpython?

Thanks for your help

Zunbeltz Izaola

--
Zunbeltz Izaola Azkona              (zunbeltz at wm dot lc dot ehu dot es)
Materia Kondentsatuaren Fisika Saila      |
Zientzia eta Teknologia Fakultatea        |   Telf:  34 946015326
Euskal Herriko Unibertsitatea             |
PK 644                                    |   Fax:   34 946013500
48080 Bilbo (SPAIN)                       |
--



From gns24 at sphinx.mythic-beasts.com  Tue Jun 21 05:21:11 2005
From: gns24 at sphinx.mythic-beasts.com (Graham Stratton)
Date: Tue, 21 Jun 2005 10:21:11 +0100 (BST)
Subject: [Twisted-Python] Re: Using twisted for web crawling
In-Reply-To: <42B6EBD4.5060102@divmod.com>
References: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
	<Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>
	<42B6EBD4.5060102@divmod.com>
Message-ID: <Pine.LNX.4.58.0506211016470.20829@sphinx.mythic-beasts.com>

Valentino, thanks for the link.

Just a quick request to someone; I'd like to be able to follow the link to
'Reactor basics' at
http://twistedmatrix.com/projects/twisted/internet
but it is broken.  Could someone please fix it/direct me to the page?

Many thanks,

Graham



From micktwomey at gmail.com  Tue Jun 21 05:40:54 2005
From: micktwomey at gmail.com (Michael Twomey)
Date: Tue, 21 Jun 2005 10:40:54 +0100
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <200506160956.23811.ian@ianduggan.net>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
	<200506160956.23811.ian@ianduggan.net>
Message-ID: <50a522ca05062102402aad620@mail.gmail.com>

Hi,

I've tried it out too and it seems to work well (I have to also
commend Jp on the sneakiness of the signal approach).

Since I don't have the dl module with my copy of mac python I've
attached a small patch which makes btt use the itimer module py-itimer
(http://www.cute.fi/~torppa/py-itimer/) if it can't import dl.

cheers,
  mick

On 6/16/05, Ian Duggan <ian at ianduggan.net> wrote:
> 
> On Tuesday 14 June 2005 18:17, Jp Calderone wrote:
> > >Does anyone know of any tools that could be used to wrap a python module
> > > and capture/report blocking calls made by it?
> >
> > <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/btt.py> (and
> > <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/test_btt.py>) might be of
> > interest/use.  I haven't done much with it yet, so I don't know if it's
> > actually effective.  I'd be interested to hear if you have any luck with
> > it.
> 
> Heh, this is a very clever trick, setting and disabling an alarm in a looping
> call. If it doesn't get disabled in time, it tells you where the stack is. It
> actually works great! I was able to immediately test it by suspending twisted
> for a moment.
> 
> I had to tune the precisions it was using, to prevent it from firing
> spuriously when my laptop got busy, but otherwise it's very cool. I love
> simple.
> 
> Suggestions for anyone else who uses this:
> 
> 1) Tune the precisions so that you have a quiet baseline.
> 
> 2) If the network you are interacting with is too fast, find a way to throttle
> your connection.
> 
> http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/Adv-Routing-HOWTO.html
> 
> --Ian
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: py-itimer.patch
Type: application/octet-stream
Size: 1206 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050621/e5df49a2/attachment.obj 

From andrew-twisted at puzzling.org  Tue Jun 21 05:49:40 2005
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue, 21 Jun 2005 19:49:40 +1000
Subject: [Twisted-Python] Re: Using twisted for web crawling
In-Reply-To: <Pine.LNX.4.58.0506211016470.20829@sphinx.mythic-beasts.com>
References: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
	<Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>
	<42B6EBD4.5060102@divmod.com>
	<Pine.LNX.4.58.0506211016470.20829@sphinx.mythic-beasts.com>
Message-ID: <20050621094940.GG8084@trogdor.home.puzzling.org>

On Tue, Jun 21, 2005 at 10:21:11AM +0100, Graham Stratton wrote:
> Valentino, thanks for the link.
> 
> Just a quick request to someone; I'd like to be able to follow the link to
> 'Reactor basics' at
> http://twistedmatrix.com/projects/twisted/internet
> but it is broken.  Could someone please fix it/direct me to the page?

http://twistedmatrix.com/projects/core/documentation/howto/reactor-basics.html

-Andrew.




From mustafa at liqia.com  Tue Jun 21 12:16:20 2005
From: mustafa at liqia.com (Mustafa Sakalsiz)
Date: Tue, 21 Jun 2005 19:16:20 +0300
Subject: [Twisted-Python] Asynchronous File I/O
Message-ID: <42B83D54.3010907@liqia.com>

Is there a way to read and writes files asynchronously using twisted.

The files may be of regular files or devices (/dev/*).

Saki



From exarkun at divmod.com  Tue Jun 21 12:42:39 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 21 Jun 2005 12:42:39 -0400
Subject: [Twisted-Python] Asynchronous File I/O
In-Reply-To: <42B83D54.3010907@liqia.com>
Message-ID: <20050621164239.5047.1520969969.divmod.quotient.6689@ohm>

On Tue, 21 Jun 2005 19:16:20 +0300, Mustafa Sakalsiz <mustafa at liqia.com> wrote:
>Is there a way to read and writes files asynchronously using twisted.
>
>The files may be of regular files or devices (/dev/*).
>

Twisted doesn't wrap or otherwise expose any platform specific asynchronous disk or device file IO routines.

Twisted's KQueue and IOCP support could be extended to provide this feature on BSD and Win32 (and AIO could probably be used to implement the same API on Linux), if there is some compelling use case for this.

Most applications get along fine using blocking disk IO, since it generally doesn't block for very long.  For cases where wrapping a real asynchronous IO layer is too much work but doing blocking disk IO is too detrimental, simply sending IO operations to a thread may be a suitable solution.  For example, twisted.internet.threads.deferToThread(fileObj.read, size) returns a Deferred that fires with at most size bytes from fileObj.  If you go this route, you must be careful to serialize operations on individual file objects, of course.

For device files, inotify.py in the Twisted sandbox has some code that might be useful (OTOH, perhaps it is just overengineered).  See its connectCharacterDevice() function.

Jp



From rfmeraz at gmail.com  Tue Jun 21 13:13:07 2005
From: rfmeraz at gmail.com (Richard Meraz)
Date: Tue, 21 Jun 2005 10:13:07 -0700
Subject: [Twisted-Python] defers, reactor,
	idiomatic/proper usage -- new user questions.
Message-ID: <f98c79100506211013159fe279@mail.gmail.com>

Hello all,
 
 Just getting started with Twisted. Thanks to the community for
tremendous work.  I diligently went through the entire archives of the
mailing list --  reading choice threads --  and I read through all the
documentation on the twisted-matrix website.  I've never done any
event-driven programming, but there was enough on the site for me to
start getting a handle on things.  Below is a short script that crawls
the links from a URI looking for RSS-type feeds.  I'm hoping that some
of the more experienced developers would be willing to give some
advice about whether I'm using twisted.internet.reactor and
twisted.web.client.getPage correctly.  I've put some comments labeled
as #Question where I'm unsure wheter I understand exactly what I'm
doing -- Im hoping someone can refute/chastise/critique the
understanding that is implied by the code and questions. I have a
thick skin so the more talented/vitriolic the response the better.
 
 # Find RSS Feeds.
 # Richard Meraz -- rfmeraz at gmail.com. 
from twisted.internet import reactor
from twisted.web.client import getPage
 
import feedlib # Includes modified version of M. Pilgrims
feedfinder.py and modified version of
                    # D. Mertz code for url extraction from p. 228 of __TPIP__. 

MAXTIME = 60 # Kill crawl after this time
TIMEOUT = 20 # Kill page retrieval after this time inactive
MAXDEPTH = 3 # Recurse this depth when crawling page. 
 
 # Question: There seem to be many idioms to aggregate information
from different defered call-back chains in twisted..  Since everything
runs in a single thread I just stuck my stuff in a global class and
everybody modifies the vars there as I pass it around to the
call-backs that should see it.  Seems okay for a small script like
this?
 
class StateVars:
    '''Keep Global state for starting/stopping feedfinding and a
record of links we have checked and their status'''
    connections = 1  
    links_checked = {} # Structure: {url: (is RSS/ATOM/RDF, page-content)}
 
 # Question: start_feed_crawl is where I set up my defers.  getPage
returns a defer and I attach my call-back process_link.
 # addCallbacks adds a callback/errback in parallel so only one or the
other is called?  so I need to add
 # the final errback to catch errors from callback process_link ?
      
def start_feed_crawl(uri,depth):
    '''Harvest feeds from a uri'''
 # Question: how to time-out this deferred chain if getPage is taking
too long to finish its work.
 # what exactly does the argument timeout to getPage do,  does it
timeout the socket after a no-response
 # or does it put an upper-bound on how long getPage has to finish its work?
 
    getPage(uri, timeout=TIMEOUT).addCallbacks
(callback=process_link,
                                                     
callbackArgs=(uri, depth, StateVars),
                                                      errback = process_error,
                                                     
errbackArgs=(uri,StateVars)
                                                     
).addErrback(process_error, uri, StateVars)

def process_link(data,uri,depth,state):
    '''Recursive link processing callback. Determines whether a link
    is a RSS/ATOM/RDF feed. If not then extracts all xml-like links
    that could point to feeds and starts crawl on those.''' 
    if feedlib.couldBeFeedData(data):
        #print 'Feed: %s' % uri
        state.links_checked[uri] = (True,data)
    else:
        state.links_checked[uri] = (False,None)
        if  depth <= MAXDEPTH: 
            alinks = feedlib.getALinks(data,uri)
            links = feedlib.getLinks(data,uri)
            rawurls = feedlib.extract_urls(data)        
            links_to_check = [feedlib.makeFullURI(u)
                              for u in set(alinks+links+rawurls)
                              if feedlib.isXMLRelatedLink(u)]
            for l in links_to_check:
                # Don't need to see it again.
                if state.links_checked.has_key(l):
                    continue
                else:
                    state.connections += 1
                     # Question: since I'm starting up these defers in
a callback they are
                     # being created after I've called reactor.run()
since we call start_feed_crawl
                     # as we find new links that meet our criteria. 
Am I doing anything bad here?
                     # All the examples I've seen (eg. p. 548-552
Python Cookbook, great eg by V. Volonghi
                     # and P. Cogolo) have their data up-front and
therefore set-up all the defers before calling
                     # reactor.run().  Here I'm discovering my data as
I go along and setting up deferrs while
                     # the reactor is spinning.  Here is my
fundamental lack of understanding.  While this script
                     # seems to run okay, is it okay to do this?
                    start_feed_crawl(l,depth+1)
 
    state.connections -= 1
 
     # Question: Is this how I kill the reactor -- ie. using some sort
of state condition.  Is there a better way,
     # should I try better to understand deferred-list.  For example. 
A top-level deferred-list that contains
     # other deferred-lists which get created to hold all the defers
(created by start_feed_crawl) for the
     # links on a given page.  Could this deferred-list be told to
stop the reactor when the other lists have
     # fired their callback (after the component defers have finished)
?  (Sorry for the convoluted question here
     # I'm new at this)
 
    if state.connections <= 0:
        reactor.stop()
    return

def process_error(error,uri,state):
    '''Catch errors in link processing'''
    state.connections -= 1
    if state.connections  <= 0:
        reactor.stop()
    return ''

if __name__ == '__main__':
    import sys
    if len(sys.argv) < 2:
        print 'feedfinder_new.py <uri>'
        sys.exit()

    uri =  feedlib.makeFullURI(sys.argv[1])
    start_feed_crawl(uri,1)
  
     # Question: I'm killing the process after a pre-determined amount
of time.  However reactor.stop() seems
     # to kill network connections.  is there a way to stop the
reactor but let the connections finish.
 
    # Hack to blow out any connections that are hung or uncalled after MAXTIME
    reactor.callLater(MAXTIME, reactor.stop)
    reactor.run()
 
    for l in StateVars.links_checked:
        if StateVars.links_checked[l][0]:
            print l

Final question: occasionally I get errors that come from the http.py
code in twisted.  This get printed to the console, but don't
necessarily stop my program.  Should my errbacks be catching these? 
How do I keep errors from getting logged to the console (beside
redirecting stderr). I can post an example if necessary of the errors
I'm getting.
 
 Thanks for your help.
 
 Richard F. Meraz
 
-- 
Never think there is anything impossible for the soul. It is the
greatest heresy to think so. If there is sin, this is the only sin ?
to say that you are weak, or others are weak.

Swami Vivekananda

From gmcdonald at infocomp.com  Tue Jun 21 21:15:51 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Wed, 22 Jun 2005 11:15:51 +1000
Subject: [Twisted-Python] Distinguishing TCP connections
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>

Eric,

I came up with a nice way of managing connections on the last project I
worked on:

The DataConnection is the protocol instance (in this case inheriting from
Int32StringReceiver).  Each time a protocol connects it calls the
registerSource

class DataConnection(Int32StringReceiver):
    
    def __init__(self, manager):
        self.manager = manager
    
    def closeConnection(self):
        self.transport.loseConnection()
    
    def connectionMade(self):
        print 'registering connection'
        self.registerConnection()
        
    def connectionLost(self, reason):
        print 'connection lost, removing....'
        self.removeConnection()

	.
	.
[ code omitted for brevity ]
	.
	.
 
    def registerConnection(self):
        """
        register data connection with connection manager.
        """
        self.manager.registerSource(self)
        
    def removeConnection(self):
        """
        remove this connection from the connection manager.
        """
        self.manager.removeSource(self.id)

    def setId(self, id):
        self.id = id
        
And the ConnectionManager is the factory class (inherited from the generic
Factory class).
 
class ConnectionManager(Factory):
    
    def __init__(self, eventhandler):
        self.ids = 0
        self.sources = {}
        self.eventhandler = eventhandler    # -- see comments later
    
    def buildProtocol(self, addr):
        return DataConnection(self)

    def newId(self):
        """
        get an id that is unique for the life of the connection manager.
        """
        id = self.ids+1
        self.ids = id
        return id

    def registerSource(self, source):
        """
        register a new source, this assigns the source an id and
        adds it to the sources dictionary.
        """
        id = self.newId()
        self.sources[id] = source
        
        # set source id
        source.setId(id)

    def removeSource(self, id):
        """
        remove the connection indicated by the source id from the current
connection
        pool any subsequent behaviour must be handled in the event manager.
        """
        if self.sources.has_key(id):
            del self.sources[id]

    def closeConnections(self):
        for source in self.sources.values():
            source.closeConnection()

[ code omitted for brevity ]

As you can see the when a connection is made it is registered with the
factory instance.  This uniquely identifies the connection, and allows you
to identify when you get a message which connection it is from.  This also
simplifies sending a message back along the same channel:

To do this you can create an event handler that implements some form of
event processing:

class EventHandler:

    def __init__(self, manager):
        self.manager = manager

    def messageReceived(self, id, message):
        # process message
        ...
        
        # create new message
        newMessage = "this is a test"
        
        # send new message back along same connection
        self.manager.sendMessage(id, newMessage)

And in the ConnectionManager add something like the following methods:

    def propagateMessage(self, id, message):
        """
        This method simply passes the received message through to the
        EventHandler class instance along with the id of the connection
        the message was received from.
        """
        self.eventhandler.messageReceived(id, message)
        
    def sendMessage(self, id, message):
        """
        This method retrieves the correct connection and sends a message
through it.
        """
        if self.sources.has_key(id):
            self.sources[id].emitMessage(message)

And the DataConnection:

    def stringReceived(self, data):
        self.manager.propagateEvent(self.id, data)

    def emitMessage(self, message):
        """
        send a message along the data connection.
        """
        self.sendString(message)


If any of this is unclear please let me know.

Regards,

Grant McDonald

----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com]On Behalf Of Eric Hsu
Sent: 21 June 2005 17:33
To: radix at twistedmatrix.com
Cc: Twisted general discussion
Subject: Re: [Twisted-Python] How could I distinguish each TCP connection?

Thank you very much!
You've been a GREAT help :D
2005/6/21, Christopher Armstrong <radeex at gmail.com>:
I suggest, instead of using the stock "Factory", making a subclass of
it with buildProtocol implemented like so:

def buildProtocol(self, addr):
    p = Factory.buildProtocol(self, addr)
    self.connections.append (p)
    return p

Or similar (you'll have to define the 'connections' list yourself in
__init__). In the protocol's connectionLost, you could then remove the
protocol from that list.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050622/31e3f5a4/attachment.htm 

From nkeric at gmail.com  Tue Jun 21 23:45:12 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Wed, 22 Jun 2005 11:45:12 +0800
Subject: [Twisted-Python] Re: Distinguishing TCP connections
In-Reply-To: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>
References: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>
Message-ID: <43c0d2b505062120455208829f@mail.gmail.com>

Hi Grant!

What a BIG surprise to receive this mail from you!
I've read your code in earnest, and it's very clear and straightforward to a 
newbie like me ;)
Thank you very much! twisted-python is really a wonderful place for 
learning, I'm loving it :D 

Best regards!

- Eric

2005/6/22, Grant McDonald <gmcdonald at infocomp.com>:
> 
> Eric, 
> 
> I came up with a nice way of managing connections on the last project I 
> worked on:
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050622/7515a8cf/attachment.htm 

From jarrod.roberson at gmail.com  Wed Jun 22 01:19:57 2005
From: jarrod.roberson at gmail.com (jarrod roberson)
Date: Wed, 22 Jun 2005 01:19:57 -0400
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <43c0d2b505062022206408acdc@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
	<60ed19d4050620215650648130@mail.gmail.com>
	<43c0d2b505062022206408acdc@mail.gmail.com>
Message-ID: <2389d4730506212219249a03b7@mail.gmail.com>

On 6/21/05, Eric Hsu <nkeric at gmail.com> wrote:
> 
> 
> 2005/6/21, Christopher Armstrong <radeex at gmail.com>:
> > 
> > You can do it based on the Protocol instance. For TCP, there is one
> > Protocol instance per connection, and it has access to the transport.
> 
> 
> Hi Christopher!
> 
> Big thanks first!
> 
> When I writing codes like the following to provide TCP/UDP services:
> 
> factory = Factory()
> factory.protocol = MyTCPService
> reactor.listenTCP(port1, factory)
> reactor.listenUDP(port2, MyUDPService())
> 
> How could I get the protocol instance of each client and maintain them?
> Please tell me more details if you could, since I'm very very new to 
> twisted :)
> 
> - Eric
> 
> 
> Read the documentation first, it is all there in the HOW-TOs and 
tutorials.


-- 
If you don't know what you want, you probably need a nap.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050622/455c5d12/attachment.htm 

From foom at fuhm.net  Wed Jun 22 12:17:05 2005
From: foom at fuhm.net (James Y Knight)
Date: Wed, 22 Jun 2005 12:17:05 -0400
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: <2D84ADB7-0093-44C5-8EBC-D61371B06AE3@fuhm.net>

Bug summary
______________________
Since 2005-06-15 01:17:07.440000:
Bugs opened: 9   Bugs closed: 1   Total open bugs: 396 (+8)
   Urgent: 9 (+2)
   Bug: 167 (+4)
   Feature: 144 (+1)
   Wish: 76 (+1)

New / Reopened Bugs
______________________
                     ==== Urgent ====
[CORE] LineReceiver Producer/Consumer support is broken  (2 days ago)
        http://twistedmatrix.com/bugs/issue1087 opened by exarkun

[CORE, DOCUMENTATION] gtk2reactor thread initialization confuses  
python-2.3  (5 days ago)
        http://twistedmatrix.com/bugs/issue1083 opened by loic

                     ==== Bug ====
http proxy doesn't close connection after sending 'Could not  
connect'  (2 days ago)
        http://twistedmatrix.com/bugs/issue1089 opened by jeffsilver

internet.py: self._port.stopListening() should check that self._port  
exists  (2 days ago)
        http://twistedmatrix.com/bugs/issue1088 opened by loic

/usr/lib/python2.3/site-packages/twisted/web/proxy.py:22:  
DeprecationWarning: twisted.protocols.http has moved to  
twisted.web.http.  (5 days ago)
CLOSED http://twistedmatrix.com/bugs/issue1085 opened by rusxakep

[CORE] ITCPConnector.disconnect() default implementation (or API?)  
problem  (4 days ago)
        http://twistedmatrix.com/bugs/issue1086 opened by itamarst

UDP Doc Update: Multicast Howto and Example  (5 days ago)
        http://twistedmatrix.com/bugs/issue1084 opened by ra1n

                     ==== Feature ====
twisted/web/server.py : Session expire times are hardwired  (yesterday)
        http://twistedmatrix.com/bugs/issue1090 opened by loic

                     ==== Wish ====
[WORDS] Speex in NAT environments with jabber protocol  (6 days ago)
        http://twistedmatrix.com/bugs/issue1082 opened by rko

Bugs Closed
______________________
                     ==== Bug ====
/usr/lib/python2.3/site-packages/twisted/web/proxy.py:22:  
DeprecationWarning: twisted.protocols.http has moved to  
twisted.web.http.  (5 days ago)
        http://twistedmatrix.com/bugs/issue1085 opened by rusxakep,  
closed by exarkun





From Stephan.Popp at iisb.fraunhofer.de  Thu Jun 23 04:53:31 2005
From: Stephan.Popp at iisb.fraunhofer.de (Stephan Popp)
Date: Thu, 23 Jun 2005 10:53:31 +0200
Subject: [Twisted-Python] Traceback from pb-Server
Message-ID: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>

Hi,
Please excuse my bad english, I hope you will understand what I mean, 
otherwise feel free to ask.
I'm trying to get error messages from my server. I'm using twisted 2.0.0 with 
python 2.4.
The server looks like this:

from twisted.spread import pb
from twisted.internet import reactor, threads

class ServerObject(pb.Root):

#...some other methods, which aren't involved...

def remote_fitness(self, task, taskDescription, serverID):
	return threads.deferToThread(self.calc, task, serverID, taskDescription)

def calc(self, task, serverID, taskDescription):
	exec('from %s import %s as func' % 
(taskDescription.fileName,taskDescription.functionName))
#problem: file specified in fileName needn't to be in working directory of 
server
	func(task) #calulates something
	return task

if __name__ == '__main__':
	factory = pb.PBServerFactory(ServerObject())
	reactor.listenTCP(8800, factory)
	reactor.run() 

The client calls, after connection is made.
def1 = root.call_remote("fitness", task, taskDescription, serverID)
def1.addCallback(self.serverCB)
def1.addErrback(self.serverErrorCB)

def serverErrorCB(self, reason):
	print reason

If the pythonscript named taskDescription.fileName isn't there 
self.serverErrorCB is called - thats ok. But it prints:
reason [Failure instance: Traceback from remote host -- Traceback unavailable]

But I need to know why the call failed. Can anyone please help me to get the 
traceback or the exception message that the server prints 
(exceptions.ImportError: No module named fitfunc2).



From gsakkis at eden.rutgers.edu  Thu Jun 23 12:29:30 2005
From: gsakkis at eden.rutgers.edu (George Sakkis)
Date: Thu, 23 Jun 2005 12:29:30 -0400 (EDT)
Subject: [Twisted-Python] Accurate delays in callLater
Message-ID: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>

Hello all,

I'm using twisted for a realtime simulation and I'm calling
reactor.callLater() for scheduling actions to be performed after a fixed
short delay (~60msec). However, if there is a cpu-intensive procedure
running in the meantime, the timer for the scheduled call may expire much
later, an order of magnitude or more if the procedure takes too much time.
Is this to be expected in general ? If not, does this may have to with the
delay being too short or the cpu-intensive procedure being mainly run in
an extension module ? Finally, is there a way to force the required delay
(with a tolerance of a few msec) ?

Thanks for any insight,

George



From njp at njp.us  Thu Jun 23 13:13:02 2005
From: njp at njp.us (Norm Petterson)
Date: Thu, 23 Jun 2005 13:13:02 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
Message-ID: <42BAED9E.8080304@njp.us>

George,

You don't say whether the cpu-intensive procedure is a part of your 
Twisted app (in which case it is an example of "blocking" behavior that 
you must design to eliminate yourself), or is running outside of Twisted 
(in which case you must utilize operating system features to run your 
Twisted app at a higher process priority).

Unlike the preemptive scheduling of real time operating systems, Twisted 
"scheduling" won't preempt anything already running.

HTH,

Norm


George Sakkis wrote:

>Hello all,
>
>I'm using twisted for a realtime simulation and I'm calling
>reactor.callLater() for scheduling actions to be performed after a fixed
>short delay (~60msec). However, if there is a cpu-intensive procedure
>running in the meantime, the timer for the scheduled call may expire much
>later, an order of magnitude or more if the procedure takes too much time.
>Is this to be expected in general ? If not, does this may have to with the
>delay being too short or the cpu-intensive procedure being mainly run in
>an extension module ? Finally, is there a way to force the required delay
>(with a tolerance of a few msec) ?
>
>Thanks for any insight,
>
>George
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>  
>



From ian at ianduggan.net  Thu Jun 23 13:13:55 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 23 Jun 2005 10:13:55 -0700
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
Message-ID: <200506231013.55704.ian@ianduggan.net>


The scheduling isn't preemptive. The main twisted thread would have to be 
passing through it's "find timed calls and run ones that are due" code within 
the window of time that you need.

Long calls in protocol code, or simply not being the currect process run by 
the processor would prevent it from scheduling your code in the time you 
need.

Think cooperative scheduling, not preemptive.

That being said, you might try adjusting the priority of the twisted process 
to give it more access to the CPU.

--Ian


On Thursday 23 June 2005 09:29, George Sakkis wrote:
> I'm using twisted for a realtime simulation and I'm calling
> reactor.callLater() for scheduling actions to be performed after a fixed
> short delay (~60msec). However, if there is a cpu-intensive procedure
> running in the meantime, the timer for the scheduled call may expire much
> later, an order of magnitude or more if the procedure takes too much time.
> Is this to be expected in general ? If not, does this may have to with the
> delay being too short or the cpu-intensive procedure being mainly run in
> an extension module ? Finally, is there a way to force the required delay
> (with a tolerance of a few msec) ?
>
> Thanks for any insight,
>
> George
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From bob at redivi.com  Thu Jun 23 13:30:19 2005
From: bob at redivi.com (Bob Ippolito)
Date: Thu, 23 Jun 2005 13:30:19 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <42BAED9E.8080304@njp.us>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
	<42BAED9E.8080304@njp.us>
Message-ID: <5686A4C6-5FA6-4E0E-A594-BBE974F1DE82@redivi.com>


On Jun 23, 2005, at 1:13 PM, Norm Petterson wrote:

> George Sakkis wrote:
>
>
>> I'm using twisted for a realtime simulation and I'm calling
>> reactor.callLater() for scheduling actions to be performed after a  
>> fixed
>> short delay (~60msec). However, if there is a cpu-intensive procedure
>> running in the meantime, the timer for the scheduled call may  
>> expire much
>> later, an order of magnitude or more if the procedure takes too  
>> much time.
>> Is this to be expected in general ? If not, does this may have to  
>> with the
>> delay being too short or the cpu-intensive procedure being mainly  
>> run in
>> an extension module ? Finally, is there a way to force the  
>> required delay
>> (with a tolerance of a few msec) ?
>>
>
> You don't say whether the cpu-intensive procedure is a part of your  
> Twisted app (in which case it is an example of "blocking" behavior  
> that you must design to eliminate yourself), or is running outside  
> of Twisted (in which case you must utilize operating system  
> features to run your Twisted app at a higher process priority).
>
> Unlike the preemptive scheduling of real time operating systems,  
> Twisted "scheduling" won't preempt anything already running.

Additionally, the precision of reactor.callLater is only as good as  
the precision of the reactor's primitive for timing (select, in the  
default reactor).  The precision of select varies widely based on the  
platform.

You might have more luck with twisted.internet.task.LoopingCall

-bob




From sebastien-lists at type-z.org  Thu Jun 23 13:44:02 2005
From: sebastien-lists at type-z.org (=?ISO-8859-1?Q?S=E9bastien_Pierre?=)
Date: Thu, 23 Jun 2005 19:44:02 +0200
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <5686A4C6-5FA6-4E0E-A594-BBE974F1DE82@redivi.com>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
	<42BAED9E.8080304@njp.us>
	<5686A4C6-5FA6-4E0E-A594-BBE974F1DE82@redivi.com>
Message-ID: <3D7AD863-2F7D-49E9-8A9A-FD9F44893458@type-z.org>

Hi !

Le 23 juin 05 ? 19:30, Bob Ippolito a ?crit :

> Additionally, the precision of reactor.callLater is only as good as  
> the precision of the reactor's primitive for timing (select, in the  
> default reactor).  The precision of select varies widely based on  
> the platform.
>
> You might have more luck with twisted.internet.task.LoopingCall

This makes me want to ask if Twisted is able to run "smooth real  
time" processes. Say for instance that I have to run a process every  
second (with a precision of 0.1s). Can I be sure that after having  
run for 1 hours the process will have been executed 3600 times ? same  
for 1 day, 1 week, etc ?

The underlying question is wether Twisted supports periodic process  
that synchronize on the clock, and if so, how does it prevent delay  
propagation ?

TIA,

  -- S?bastien




From njp at njp.us  Thu Jun 23 14:27:20 2005
From: njp at njp.us (Norm Petterson)
Date: Thu, 23 Jun 2005 14:27:20 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <3D7AD863-2F7D-49E9-8A9A-FD9F44893458@type-z.org>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>	<42BAED9E.8080304@njp.us>	<5686A4C6-5FA6-4E0E-A594-BBE974F1DE82@redivi.com>
	<3D7AD863-2F7D-49E9-8A9A-FD9F44893458@type-z.org>
Message-ID: <42BAFF08.3050904@njp.us>



S?bastien Pierre wrote:

> Hi !
>
> Le 23 juin 05 ? 19:30, Bob Ippolito a ?crit :
>
>> Additionally, the precision of reactor.callLater is only as good as  
>> the precision of the reactor's primitive for timing (select, in the  
>> default reactor).  The precision of select varies widely based on  
>> the platform.
>>
>> You might have more luck with twisted.internet.task.LoopingCall
>
>
> This makes me want to ask if Twisted is able to run "smooth real  
> time" processes. Say for instance that I have to run a process every  
> second (with a precision of 0.1s). Can I be sure that after having  
> run for 1 hours the process will have been executed 3600 times ? same  
> for 1 day, 1 week, etc ?
>
Based on  
http://twistedmatrix.com/pipermail/twisted-python/2004-March/007254.html,
I've been using twisted.internet.task.LoopingCall for applications 
calling for 1 second (or 2 second, or 10 second, etc.) indefinite 
repetition for the past year, and have noted minor slippage that I 
attribute to *not* bumping the twisted application process priority 
above its default on the platforms involved (Linux/DEC Alpha, W2K/Intel 
P4). If the slippage were unacceptable, I'd try raising process priority 
before anything else...

Norm




From psanchez at nortel.com  Thu Jun 23 14:43:38 2005
From: psanchez at nortel.com (Pedro Sanchez)
Date: Thu, 23 Jun 2005 14:43:38 -0400
Subject: [Twisted-Python] twisted.plugin (revised) documentation?
In-Reply-To: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>
References: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>
Message-ID: <1119552219.6528.23.camel@pcard0ze.ca.nortel.com>

Hello,

Where can I find documentation on the current twisted.plugin framework?

The document "Writing a New Plug-In for mktap" at
http://twistedmatrix.com/projects/core/documentation/howto/plugin.html
seems to have outdated information. When I run the mktap command, as
instructed there, this is what I get:

$ mktap qotd
TwistedQuotes/plugins.tml:7: DeprecationWarning: The
twisted.python.plugin system is deprecated.  See twisted.plugin for the
revised edition.  tapname="qotd")

I'm running twisted 2.0.1 and I can't find any new documentation. The
document above is also found in doc/core/howto/plugin.html of the
current twisted distribution.

Thanks,

-- 
Pedro

PS. Note: the link to this mailing list at
http://twistedmatrix.com/projects/core/ is broken.

- http://twistedmatrix.com/cgi-bin/mailman/twisted-python
+ http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

should fix it.





From ian at ianduggan.net  Thu Jun 23 15:34:41 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 23 Jun 2005 12:34:41 -0700
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <42BAFF08.3050904@njp.us>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
	<3D7AD863-2F7D-49E9-8A9A-FD9F44893458@type-z.org>
	<42BAFF08.3050904@njp.us>
Message-ID: <200506231234.42167.ian@ianduggan.net>


On Thursday 23 June 2005 11:27, Norm Petterson wrote:
> http://twistedmatrix.com/pipermail/twisted-python/2004-March/007254.html,
> I've been using twisted.internet.task.LoopingCall for applications
> calling for 1 second (or 2 second, or 10 second, etc.) indefinite
> repetition for the past year, and have noted minor slippage that I
> attribute to *not* bumping the twisted application process priority
> above its default on the platforms involved (Linux/DEC Alpha, W2K/Intel
> P4). If the slippage were unacceptable, I'd try raising process priority
> before anything else...

Another idea is to do the bookkeeping yourself. 

1) Schedule something to wake up periodically. The period would depend on your 
desired level of smoothness.

2) Have it perform your task. 

3) If it notices that things are slipping (numer exectutions < number expected 
excutions) based on time.time(), it can run your operation however many times 
it needs to catch up.

--Ian



From exarkun at divmod.com  Thu Jun 23 15:44:47 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 15:44:47 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <200506231234.42167.ian@ianduggan.net>
Message-ID: <20050623194447.5047.412302185.divmod.quotient.7885@ohm>

On Thu, 23 Jun 2005 12:34:41 -0700, Ian Duggan <ian at ianduggan.net> wrote:
>
>On Thursday 23 June 2005 11:27, Norm Petterson wrote:
>> http://twistedmatrix.com/pipermail/twisted-python/2004-March/007254.html,
>> I've been using twisted.internet.task.LoopingCall for applications
>> calling for 1 second (or 2 second, or 10 second, etc.) indefinite
>> repetition for the past year, and have noted minor slippage that I
>> attribute to *not* bumping the twisted application process priority
>> above its default on the platforms involved (Linux/DEC Alpha, W2K/Intel
>> P4). If the slippage were unacceptable, I'd try raising process priority
>> before anything else...
>
>Another idea is to do the bookkeeping yourself.
>
>1) Schedule something to wake up periodically. The period would depend on your
>desired level of smoothness.
>
>2) Have it perform your task.
>
>3) If it notices that things are slipping (numer exectutions < number expected
>excutions) based on time.time(), it can run your operation however many times
>it needs to catch up.

This is precisely what LoopingCall does.

I'd be interested to hear more details about cases where LoopingCall does allow slippage.  As far as I know, there is no room for improvement here: the only thing that could cause it to slip is if the system clock were not maintaining time correctly, and in that case I believe you are pretty much screwed on anything time related (okay, maybe not, I guess you could have an NTP implementation and schedule things against that, rather than the system clock...)

Jp



From njp at njp.us  Thu Jun 23 16:36:00 2005
From: njp at njp.us (Norm Petterson)
Date: Thu, 23 Jun 2005 16:36:00 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <20050623194447.5047.412302185.divmod.quotient.7885@ohm>
References: <20050623194447.5047.412302185.divmod.quotient.7885@ohm>
Message-ID: <42BB1D30.306@njp.us>



Jp Calderone wrote:

> On Thu, 23 Jun 2005 12:34:41 -0700, Ian Duggan <ian at ianduggan.net> wrote:
>
>>
>> On Thursday 23 June 2005 11:27, Norm Petterson wrote:
>>
>>> If the slippage were unacceptable, I'd try raising process priority
>>> before anything else...
>>
>> Another idea is to do the bookkeeping yourself.
>
> I'd be interested to hear more details about cases where LoopingCall 
> does allow slippage.  As far as I know, there is no room for 
> improvement here: the only thing that could cause it to slip is if the 
> system clock were not maintaining time correctly, and in that case I 
> believe you are pretty much screwed on anything time related (okay, 
> maybe not, I guess you could have an NTP implementation and schedule 
> things against that, rather than the system clock...)
>
In my case, for instance, 86400 repeated 1 second TimerService calls 
might take a few minutes more than precisely 24 hours (which is 
acceptable, so I haven't checked further). I am guessing that something 
outside of Twisted, running at a higher process priority  occasionally 
ties up the machine long enough to miss at least one scheduled cycle, 
possibly even more than one. AFAICT LoopingCall doesn't make any attempt 
to compensate for entirely missed (i.e., catastrophically missed) 
cycles, only for the minor slippage that might otherwise lead to 
gradually missed ones. Right?

Not a Twisted issue; hence recommending bumping process priority.





From gsakkis at eden.rutgers.edu  Thu Jun 23 16:49:06 2005
From: gsakkis at eden.rutgers.edu (George Sakkis)
Date: Thu, 23 Jun 2005 16:49:06 -0400 (EDT)
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
Message-ID: <Pine.GSO.4.58.0506231646580.28870@er1.rutgers.edu>

Thank you everyone who wrote back,

>From the replies I gather that preemptive scheduling would do the trick.
If it's not provided out-of-the-box in Twisted, is there a way it can be
simulated ? Here's a little more context:
- There are two processes involved, one for a single server and the other
for a small number (2-22, in my case 5) of clients. Twisted controls the
client side. Each client:
    - communicates asynchronously with the server through UDP. Clients
don't talk to each other directly.
    - expects two (actually more but two are the important) types of
messages, say 'feel' and 'see'.
    - when 'feel' is received, it schedules a call with a delay of 50-90
ms. It also updates itself, a computationally light procedure (at least
for now).
    - when 'see' is received, it updates itself accordingly; this *is* cpu
intensive and most time is spent at an extension's module code (by the
way, it would be very helpful if I could optimize the extension but I
don't know how to profile it; any help here would be great).

Normally 'feel' messages arrive every 100ms and 'see' every 150ms. That's
more or less what I observe when the processing of 'see' is turned off.
When it is on however, messages are received with bursts, e.g. 7 'feel'
messages within 200ms instead of 2. This is surprising because if I
believe the profiler, 'see' is usually processed in 25 to 55ms, so a delay
of 60ms should be long enough. Is it going to help if the processing of
'see' is dispatched in a separate thread ?

George


> Hello all,
>
> I'm using twisted for a realtime simulation and I'm calling
> reactor.callLater() for scheduling actions to be performed after a fixed
> short delay (~60msec). However, if there is a cpu-intensive procedure
> running in the meantime, the timer for the scheduled call may expire much
> later, an order of magnitude or more if the procedure takes too much time.
> Is this to be expected in general ? If not, does this may have to with the
> delay being too short or the cpu-intensive procedure being mainly run in
> an extension module ? Finally, is there a way to force the required delay
> (with a tolerance of a few msec) ?
>
> Thanks for any insight,
>
> George
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From exarkun at divmod.com  Thu Jun 23 17:05:17 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 17:05:17 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <42BB1D30.306@njp.us>
Message-ID: <20050623210517.5047.1409793409.divmod.quotient.7917@ohm>

On Thu, 23 Jun 2005 16:36:00 -0400, Norm Petterson <njp at njp.us> wrote:
>
>
>Jp Calderone wrote:
>>On Thu, 23 Jun 2005 12:34:41 -0700, Ian Duggan <ian at ianduggan.net> wrote:
>>>
>>>On Thursday 23 June 2005 11:27, Norm Petterson wrote:
>>>>If the slippage were unacceptable, I'd try raising process priority
>>>>before anything else...
>>>
>>>Another idea is to do the bookkeeping yourself.
>>
>>I'd be interested to hear more details about cases where LoopingCall does 
>>allow slippage.  As far as I know, there is no room for improvement here: 
>>the only thing that could cause it to slip is if the system clock were not 
>>maintaining time correctly, and in that case I believe you are pretty much 
>>screwed on anything time related (okay, maybe not, I guess you could have 
>>an NTP implementation and schedule things against that, rather than the 
>>system clock...)
>In my case, for instance, 86400 repeated 1 second TimerService calls might 
>take a few minutes more than precisely 24 hours (which is acceptable, so I 
>haven't checked further). I am guessing that something outside of Twisted, 
>running at a higher process priority  occasionally ties up the machine long 
>enough to miss at least one scheduled cycle, possibly even more than one. 
>AFAICT LoopingCall doesn't make any attempt to compensate for entirely 
>missed (i.e., catastrophically missed) cycles, only for the minor slippage 
>that might otherwise lead to gradually missed ones. Right?
>
>Not a Twisted issue; hence recommending bumping process priority.
>

Aha, this makes perfect sense.  It's a different kind of slippage than what I thought you were talking about.

Jp



From db3l at fitlinxx.com  Thu Jun 23 17:17:38 2005
From: db3l at fitlinxx.com (David Bolen)
Date: 23 Jun 2005 17:17:38 -0400
Subject: [Twisted-Python] Re: Traceback from pb-Server
References: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <ull503h8t.fsf@fitlinxx.com>

Stephan Popp <Stephan.Popp at iisb.fraunhofer.de> writes:

> If the pythonscript named taskDescription.fileName isn't there 
> self.serverErrorCB is called - thats ok. But it prints:
> reason [Failure instance: Traceback from remote host -- Traceback unavailable]
> 
> But I need to know why the call failed. Can anyone please help me to get the 
> traceback or the exception message that the server prints 
> (exceptions.ImportError: No module named fitfunc2).

The returned Failure instance should still encapsulate the underlying
exception information in the type and value fields, as is usual with
Failure objects.  One difference from a local Failure instance though
is that type will be a string representation of the exception class
and not the class object itself in the PB client context.  If you
stick with failure.trap() and failure.check() for explicit exception
checks in errback chains, they handle both the direct class as well as
string version, so errback code will work locally or via a PB client.

So you can still identify the root exception (ImportError).  It just
happens to not show up in the default __str__ output for the failure
object (e.g., your print in your errback) but if you were to modify
that print to explicitly print out the type and value fields, and not
just let the failure object generate its own printable format, you can
see the information.  And checking for an exception itself rather than
looking for textual information in a traceback is probably better for
production code.

If you really want to see the traceback during development/debugging,
you should see them output as a log message on the server side (if you
have twisted logging going somewhere).  Alternatively, I believe you
can enable "unsafe" tracebacks (which sends the traceback to remote
clients) by setting the unsafeTracebacks attribute in the factory on
the side on which the exception is being generated - the
PBServerFactory side in your case.  For PBServerFactory, it's an
optional argument to the constructor.

-- David




From exarkun at divmod.com  Thu Jun 23 17:23:57 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 17:23:57 -0400
Subject: [Twisted-Python] twisted.plugin (revised) documentation?
In-Reply-To: <1119552219.6528.23.camel@pcard0ze.ca.nortel.com>
Message-ID: <20050623212357.5047.1072105749.divmod.quotient.7925@ohm>

On Thu, 23 Jun 2005 14:43:38 -0400, Pedro Sanchez <psanchez at nortel.com> wrote:
>Hello,
>
>Where can I find documentation on the current twisted.plugin framework?
>
>The document "Writing a New Plug-In for mktap" at
>http://twistedmatrix.com/projects/core/documentation/howto/plugin.html
>seems to have outdated information. When I run the mktap command, as
>instructed there, this is what I get:
>
>$ mktap qotd
>TwistedQuotes/plugins.tml:7: DeprecationWarning: The
>twisted.python.plugin system is deprecated.  See twisted.plugin for the
>revised edition.  tapname="qotd")
>
>I'm running twisted 2.0.1 and I can't find any new documentation. The
>document above is also found in doc/core/howto/plugin.html of the
>current twisted distribution.
>

It's on my list of things to write.

In brief, the way plugins are implemented now is:

1) in a module in the twisted.plugins (plural) package.  Such modules should be named in such a way so as not to conflict with plugins provided by other parties (eg, Twisted uses the convention of "twisted_foo" for plugins it itself offers).  Installers should place plugin modules in the twisted/plugins/ directory and call list(twisted.plugin.getPlugin(twisted.plugin.IPlugin)) afterwards to regenerate the system cache (not doing so is only detrimental in that operation without the cache is much slower).  Uninstallers should do something similar to avoid leaving stale cache entries (these will be found and pruned, but lead to at least one ugly traceback, and for a system-wide install, the user probably will not have access to rewrite the cache with bogus entries removed).  As a convenience to developers, plugins placed in a _directory_ (not a package) named "twisted/plugins/" in any directory in sys.path will automatically be found by the plugin system as well.  This avoids the install process during development and for testing.

2) In these modules, names bound to objects which provide (z.i terminology) twisted.plugin.IPlugin will be considered plugin objects and can potentially be returned by twisted.plugin.getPlugins()

3) Objects providing IPlugin should also provide some other application-specific interface.  When calling twisted.plugin.getPlugins(IFoo), only objects providing IFoo will be returned.

4) Plugin "client" code (that is, code calling getPlugin) is then responsible for calling methods appropriate to the interface it passed.

For examples of this, see the twisted_ modules in twisted/plugins/.

Hope this helps,

Jp



From exarkun at divmod.com  Thu Jun 23 17:32:21 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 17:32:21 -0400
Subject: [Twisted-Python] Traceback from pb-Server
In-Reply-To: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <20050623213221.5047.1135639581.divmod.quotient.7930@ohm>

On Thu, 23 Jun 2005 10:53:31 +0200, Stephan Popp <stephan.popp at iisb.fraunhofer.de> wrote:
>Hi,
>Please excuse my bad english, I hope you will understand what I mean,
>otherwise feel free to ask.
>I'm trying to get error messages from my server. I'm using twisted 2.0.0 with
>python 2.4.
>The server looks like this:
>
>from twisted.spread import pb
>from twisted.internet import reactor, threads
>
>class ServerObject(pb.Root):
>
>#...some other methods, which aren't involved...
>
>def remote_fitness(self, task, taskDescription, serverID):
>	return threads.deferToThread(self.calc, task, serverID, taskDescription)
>
>def calc(self, task, serverID, taskDescription):
>	exec('from %s import %s as func' %
>(taskDescription.fileName,taskDescription.functionName))

Note:

    exarkun at boson:~$ python
    Python 2.4.1 (#2, Mar 30 2005, 21:51:10) 
    [GCC 3.3.5 (Debian 1:3.3.5-8ubuntu2)] on linux2
    Type "help", "copyright", "credits" or "license" for more information.
    >>> def calc(a, b):
    ...     exec 'from %s import %s as func' % (a, b)
    ... 
    >>> calc("os import system; system('echo Boo'); from foo", "bar")
    Boo
    Traceback (most recent call last):
      File "<stdin>", line 1, in ?
      File "<stdin>", line 2, in calc
      File "<string>", line 1, in ?
    ImportError: No module named foo
    >>> 

Jp



From foom at fuhm.net  Thu Jun 23 17:35:49 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 23 Jun 2005 17:35:49 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <42BB1D30.306@njp.us>
References: <20050623194447.5047.412302185.divmod.quotient.7885@ohm>
	<42BB1D30.306@njp.us>
Message-ID: <FF7CCE98-BA81-4AE8-AF88-5B46BDA0808A@fuhm.net>

On Jun 23, 2005, at 4:36 PM, Norm Petterson wrote:
> In my case, for instance, 86400 repeated 1 second TimerService  
> calls might take a few minutes more than precisely 24 hours (which  
> is acceptable, so I haven't checked further). I am guessing that  
> something outside of Twisted, running at a higher process priority   
> occasionally ties up the machine long enough to miss at least one  
> scheduled cycle, possibly even more than one. AFAICT LoopingCall  
> doesn't make any attempt to compensate for entirely missed (i.e.,  
> catastrophically missed) cycles, only for the minor slippage that  
> might otherwise lead to gradually missed ones. Right?

Right. It may be a desirable to add a subclass which will pass the  
number of cycles the function should run as the first argument. For  
many purposes (e.g. animation), it's acceptable to skip cycles, as  
long as you know how many you skipped and catch up the animation that  
far when you do end up getting scheduled.

James



From ian at ianduggan.net  Thu Jun 23 18:05:04 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 23 Jun 2005 15:05:04 -0700
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <Pine.GSO.4.58.0506231646580.28870@er1.rutgers.edu>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
	<Pine.GSO.4.58.0506231646580.28870@er1.rutgers.edu>
Message-ID: <200506231505.05378.ian@ianduggan.net>


On Thursday 23 June 2005 13:49, George Sakkis wrote:
> Normally 'feel' messages arrive every 100ms and 'see' every 150ms. That's
> more or less what I observe when the processing of 'see' is turned off.
> When it is on however, messages are received with bursts, e.g. 7 'feel'
> messages within 200ms instead of 2. This is surprising because if I
> believe the profiler, 'see' is usually processed in 25 to 55ms, so a delay
> of 60ms should be long enough. Is it going to help if the processing of
> 'see' is dispatched in a separate thread ?

Hmm. My gut tells me that your "see" processing is not fast enough (or 
something is blocking), and things are backing up in queues. When it comes 
around to service your "feel" messages (once things are backed up) it goes 
through 7 very quickly since they are cheap to process.

If this is the case, moving "see" to a thread might help.

You might also try out the BigTimesliceTimer stuff and see if you are 
"blocking" for too long.

	http://svn.twistedmatrix.com/cvs/sandbox/exarkun/btt.py
	http://svn.twistedmatrix.com/cvs/sandbox/exarkun/test_btt.py

As an aside, what is considered a reasonable amount of time for a function to 
run in in twisted?

--Ian



From bruce at cubik.org  Thu Jun 23 18:09:31 2005
From: bruce at cubik.org (Bruce Mitchener)
Date: Thu, 23 Jun 2005 16:09:31 -0600
Subject: [Twisted-Python] PB SturdyRef issue
Message-ID: <42BB331B.1050307@cubik.org>

I'm using something similar in style to a pb.SturdyRef and have run 
across a problem with it:

While it handles pb.DeadReferenceError, it doesn't handle the 
pb.PBConnectionLost that can come back as an errback from the callRemote.

Is there some way that I can juggle deferreds so that the caller can get 
the response from the server after I reconnect and re-try like what 
happens in the case of pb.DeadReferenceError?

It doesn't seem like I can just attach an errback to the deferred and in 
that errback, do a failure.trap(pb.PBConnectionLost) and then do 
something to bind a new deferred into the callback chain ...

Is there something that can happen magically by returning a new deferred 
from the errback that successfully traps the PBConnectionLost?

Thoughts?

  - Bruce



From exarkun at divmod.com  Thu Jun 23 19:02:25 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 19:02:25 -0400
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <50a522ca05062102402aad620@mail.gmail.com>
Message-ID: <20050623230225.5047.2026626881.divmod.quotient.7968@ohm>

On Tue, 21 Jun 2005 10:40:54 +0100, Michael Twomey <micktwomey at gmail.com> wrote:
>Hi,
>
>I've tried it out too and it seems to work well (I have to also
>commend Jp on the sneakiness of the signal approach).
>
>Since I don't have the dl module with my copy of mac python I've
>attached a small patch which makes btt use the itimer module py-itimer
>(http://www.cute.fi/~torppa/py-itimer/) if it can't import dl.
>

Thanks, I've applied a slightly modified version of this to svn.  I assume py-itimer works and such, so I just made it the preferred mechanism, falling back to dl if it is not available.

Jp



From gmcdonald at infocomp.com  Thu Jun 23 19:02:22 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Fri, 24 Jun 2005 09:02:22 +1000
Subject: [Twisted-Python] Documentation: producing standalone win32 exes for
	twisted
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4E01@XCHANGE>

All,

As a general question, would anyone find it useful to have in the twisted
documentation specific information on producing twisted win32 executables
(be this twistd, a service, or utilising a plugin) using py2exe?  I would be
happy to create such doco since I have had to produce several different
types of win32 exes using twisted components and am aware of some of the
pitfalls ;)

Grant

P.S. How does the new plugin system work with regards to running the plugin?
Is it any different?

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com]On Behalf Of Jp Calderone
Sent: 24 June 2005 07:24
To: Twisted general discussion
Subject: Re: [Twisted-Python] twisted.plugin (revised) documentation?

On Thu, 23 Jun 2005 14:43:38 -0400, Pedro Sanchez <psanchez at nortel.com>
wrote:
>Hello,
>
>Where can I find documentation on the current twisted.plugin framework?
>
>The document "Writing a New Plug-In for mktap" at
>http://twistedmatrix.com/projects/core/documentation/howto/plugin.html
>seems to have outdated information. When I run the mktap command, as
>instructed there, this is what I get:
>
>$ mktap qotd
>TwistedQuotes/plugins.tml:7: DeprecationWarning: The
>twisted.python.plugin system is deprecated.  See twisted.plugin for the
>revised edition.  tapname="qotd")
>
>I'm running twisted 2.0.1 and I can't find any new documentation. The
>document above is also found in doc/core/howto/plugin.html of the
>current twisted distribution.
>

It's on my list of things to write.

In brief, the way plugins are implemented now is:

1) in a module in the twisted.plugins (plural) package.  Such modules should
be named in such a way so as not to conflict with plugins provided by other
parties (eg, Twisted uses the convention of "twisted_foo" for plugins it
itself offers).  Installers should place plugin modules in the
twisted/plugins/ directory and call
list(twisted.plugin.getPlugin(twisted.plugin.IPlugin)) afterwards to
regenerate the system cache (not doing so is only detrimental in that
operation without the cache is much slower).  Uninstallers should do
something similar to avoid leaving stale cache entries (these will be found
and pruned, but lead to at least one ugly traceback, and for a system-wide
install, the user probably will not have access to rewrite the cache with
bogus entries removed).  As a convenience to developers, plugins placed in a
_directory_ (not a package) named "twisted/plugins/" in any directory in
sys.path will automatically be found by the plugin system as well.  This
avoids the install process during development and for testing.

2) In these modules, names bound to objects which provide (z.i terminology)
twisted.plugin.IPlugin will be considered plugin objects and can potentially
be returned by twisted.plugin.getPlugins()

3) Objects providing IPlugin should also provide some other
application-specific interface.  When calling
twisted.plugin.getPlugins(IFoo), only objects providing IFoo will be
returned.

4) Plugin "client" code (that is, code calling getPlugin) is then
responsible for calling methods appropriate to the interface it passed.

For examples of this, see the twisted_ modules in twisted/plugins/.

Hope this helps,

Jp

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050624/76768ea7/attachment.htm 

From sebastian.hanlon at uleth.ca  Thu Jun 23 19:25:43 2005
From: sebastian.hanlon at uleth.ca (Sebastian Hanlon)
Date: Thu, 23 Jun 2005 17:25:43 -0600
Subject: [Twisted-Python] _Dereference problems with jelly, pb.Cacheable,
	and cyclic references
Message-ID: <42BB44F7.7010108@uleth.ca>

I'm having problems trying to spread a data structure using 
pb.Cacheable. The general framework involves three classes: Alpha, 
Bravo, and Charlie. Alpha maintains a list of Bravos and Charlies. 
Bravos can reference Charlies and Charlies reference Bravos. When they 
get unserialized, though, some of the Charlies have _Dereference objects 
where references to Bravos should be. The Bravos themselves come across 
the wire just fine.

A simple example program is attached. To run it, first start the server 
by running 'python jelly-test.py server', then run the client with 
'python jelly-test.py client'. You should get a _Dereference in the list
of Charlies printed by the client, like such:

--cut here--
bravos:
Bravo(0) [<__main__.RemoteCharlie instance at 0x00C14DA0>]
Bravo(1) [<__main__.RemoteCharlie instance at 0x00C14DA0>, 
<__main__.RemoteCharlie instance at 0x00C19058>]
Bravo(2) [<__main__.RemoteCharlie instance at 0x00C19058>]
--------------------------------------------------
charlies:
Charlie(Bravo(0),Bravo(1))
Charlie(<twisted.persisted.crefutil._Dereference instance at 
0x00C190A8>,Bravo(2))
--cut here--

Can anyone help? I'm running the latest Twisted SVN on Python 2.3.4.

-Sebastian
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: jelly-test.py
Url: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050623/c637f14c/attachment.txt 

From mary-twisted at puzzling.org  Thu Jun 23 19:25:49 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Fri, 24 Jun 2005 09:25:49 +1000
Subject: [Twisted-Python] Documentation: producing standalone win32 exes
	for twisted
In-Reply-To: <61DA7719C45FD31185280008C733EF6E04AC4E01@XCHANGE>
References: <61DA7719C45FD31185280008C733EF6E04AC4E01@XCHANGE>
Message-ID: <20050623232549.GA5094@home.puzzling.org>

On Fri, Jun 24, 2005, Grant McDonald wrote:
> All,
> 
> As a general question, would anyone find it useful to have in the twisted
> documentation specific information on producing twisted win32 executables
> (be this twistd, a service, or utilising a plugin) using py2exe?  I would be
> happy to create such doco since I have had to produce several different
> types of win32 exes using twisted components and am aware of some of the
> pitfalls ;)

As a general principle, more documentation is always welcome. So I would
say "yes".

-Mary



From Henning.Ramm at mediapro-gmbh.de  Thu Jun 23 19:38:01 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Fri, 24 Jun 2005 01:38:01 +0200
Subject: [Twisted-Python] Documentation: producing standalone win32 exes
	fortwisted
Message-ID: <F92274058556DE42B94B148EEFB9183949E736@exchange-03.suedkurier.de>

> As a general question, would anyone find it useful to have in the twisted documentation specific information on producing twisted win32 executables (be this twistd, a service, or utilising a plugin) using py2exe?  I would be happy to create such doco since I have had to produce several different types of win32 exes using twisted components and am aware of some of the pitfalls ;)

In addition to Mary's general 'yes', I'd be especially interested in "howto make a Win service from a twisted app" (I'd like to run my server on a server ;-) without logged in user).


Best regards,
Henning Hraban Ramm
S?dkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From gmcdonald at infocomp.com  Thu Jun 23 19:58:38 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Fri, 24 Jun 2005 09:58:38 +1000
Subject: [Twisted-Python] Documentation: producing standalone win32 exes
	fortwisted
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4E02@XCHANGE>

All,

> In addition to Mary's general 'yes', I'd be especially interested in
> "howto make a Win service from a twisted app" (I'd like to run my server
> on a server ;-) without logged in user).

There are a number of caveats to creating services (both on the twisted side
and the windows side) which I will make sure to document.

I have created an issue in the bug tracker for the documentation:

http://twistedmatrix.com/bugs/issue1092

Regards,

Grant M
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050624/d2c0198f/attachment.htm 

From andrew-twisted at puzzling.org  Thu Jun 23 21:58:10 2005
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Fri, 24 Jun 2005 11:58:10 +1000
Subject: [Twisted-Python] PB SturdyRef issue
In-Reply-To: <42BB331B.1050307@cubik.org>
References: <42BB331B.1050307@cubik.org>
Message-ID: <20050624015810.GI28646@trogdor.home.puzzling.org>

On Thu, Jun 23, 2005 at 04:09:31PM -0600, Bruce Mitchener wrote:
> I'm using something similar in style to a pb.SturdyRef and have run 
> across a problem with it:
> 
> While it handles pb.DeadReferenceError, it doesn't handle the 
> pb.PBConnectionLost that can come back as an errback from the callRemote.
> 
> Is there some way that I can juggle deferreds so that the caller can get 
> the response from the server after I reconnect and re-try like what 
> happens in the case of pb.DeadReferenceError?
> 
> It doesn't seem like I can just attach an errback to the deferred and in 
> that errback, do a failure.trap(pb.PBConnectionLost) and then do 
> something to bind a new deferred into the callback chain ...
> 
> Is there something that can happen magically by returning a new deferred 
> from the errback that successfully traps the PBConnectionLost?

If you return a Deferred from a callback/errback, the outer Deferred will
wait for the inner Deferred to fire before continuing with its callback
chain.  It sounds like this is the magic you are looking for.

So here's one way to take advantage of that:

def sturdyRemoteCall(foo, *args, **kwargs):

    d = ...  # whatever you do to make the remote call, handle
             # DeadReferenceErrors, etc.

    def retryOnConnectionLost(failure):
        failure.trap(pb.PBConnectionLost)
        return sturdyRemoteCall(foo, *args, **kwargs)

    d.addErrback(retryOnConnectionLost)
    return d

-Andrew.




From jmhayes at speakeasy.net  Thu Jun 23 22:16:30 2005
From: jmhayes at speakeasy.net (Jordan Hayes)
Date: Thu, 23 Jun 2005 19:16:30 -0700
Subject: [Twisted-Python] Twisted / NNTP / Mailman
Message-ID: <026201c57862$bc3f4b80$1048a8c0@PAD2>

Has anyone worked on this integration?

I see it as an NNTP server using the Mailman database as the
backing-store.  Read-only would be fine, actually.

/jordan




From Stephan.Popp at iisb.fraunhofer.de  Fri Jun 24 03:11:40 2005
From: Stephan.Popp at iisb.fraunhofer.de (Stephan Popp)
Date: Fri, 24 Jun 2005 09:11:40 +0200
Subject: [Twisted-Python] Traceback from pb-Server
In-Reply-To: <ull503h8t.fsf@fitlinxx.com>
References: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>
	<ull503h8t.fsf@fitlinxx.com>
Message-ID: <200506240911.40276.Stephan.Popp@iisb.fraunhofer.de>

Hi,
thanks for the help. Everything is fine now.

Stephan



From digi at treepy.com  Fri Jun 24 05:34:09 2005
From: digi at treepy.com (Patrick Lauber)
Date: Fri, 24 Jun 2005 11:34:09 +0200
Subject: [Twisted-Python] too many file descriptors on win2003 server
In-Reply-To: <200506240911.40276.Stephan.Popp@iisb.fraunhofer.de>
References: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>	<ull503h8t.fsf@fitlinxx.com>
	<200506240911.40276.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <42BBD391.2030709@treepy.com>

hi,

I have a server that acts as a Flash-XML-Socket Server that pushes data 
to the clients in a irregular interval. It is running on win2003 server 
and i get the "too many file descriptors in select()" error when i hit 
the 512 mark. Is there a way to extend this limit? the poll reactor 
doesn't seam to work under win. is the win32 reactor better at large 
simultaneous connections?

cheers

pat




From psanchez at nortel.com  Fri Jun 24 09:05:13 2005
From: psanchez at nortel.com (Pedro Sanchez)
Date: Fri, 24 Jun 2005 09:05:13 -0400
Subject: [Twisted-Python] twisted.plugin (revised) documentation?
In-Reply-To: <20050623212357.5047.1072105749.divmod.quotient.7925@ohm>
References: <20050623212357.5047.1072105749.divmod.quotient.7925@ohm>
Message-ID: <1119618313.6528.27.camel@pcard0ze.ca.nortel.com>

On Thu, 2005-23-06 at 17:23 -0400, Jp Calderone wrote:

> It's on my list of things to write.
> ....
> For examples of this, see the twisted_ modules in twisted/plugins/.
> 
> Hope this helps,
> 
> Jp
> 
Thank you, it helps. I would suggest you add a little note at the
beginning of the current documentation on the web site to let new comers
like me know from the start that the documentation is not up to date.

Thanks,

-- 
Pedro





From itamar at itamarst.org  Fri Jun 24 11:25:02 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 24 Jun 2005 11:25:02 -0400
Subject: [Twisted-Python] too many file descriptors on win2003 server
In-Reply-To: <42BBD391.2030709@treepy.com>
References: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>
	<ull503h8t.fsf@fitlinxx.com>
	<200506240911.40276.Stephan.Popp@iisb.fraunhofer.de>
	<42BBD391.2030709@treepy.com>
Message-ID: <1119626702.8159.29.camel@localhost.localdomain>

On Fri, 2005-06-24 at 11:34 +0200, Patrick Lauber wrote:

> I have a server that acts as a Flash-XML-Socket Server that pushes data 
> to the clients in a irregular interval. It is running on win2003 server 
> and i get the "too many file descriptors in select()" error when i hit 
> the 512 mark. Is there a way to extend this limit? the poll reactor 
> doesn't seam to work under win. is the win32 reactor better at large 
> simultaneous connections?

No, win32eventreactor is worse, it only does 64. The 512 limit comes
from Python, it #defines FD_SETSIZE to be 512 in the C socket extension
module; the default without this would have been 64 as well.

Your options: 

1. Compile your own version of the _socket.pyd for Windows, patched to
have a higher FD_SETSIZE.

2. Try the IOCP reactor, it might work, and certainly shouldn't have
limits on number of sockets.

more aggressive timeouts on client connections should help somewhat as
well, though they don't solve the real issue.





From Henning.Ramm at mediapro-gmbh.de  Fri Jun 24 13:12:46 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Fri, 24 Jun 2005 19:12:46 +0200
Subject: [Twisted-Python] Documentation: producing standalone win32
	exesfortwisted
Message-ID: <F92274058556DE42B94B148EEFB9183949E739@exchange-03.suedkurier.de>

> There are a number of caveats to creating services
> (both on the twisted side and the windows side)
> which I will make sure to document.

That's good; I don't trust in my abilities so far to implement such without advice.

http://www.adelux.fr/libre/howto/deployTwistedWindows
looks good so far! (Even if I just have no time to try it.) Thank you in advance!


Best regards,
Henning Hraban Ramm
S?dkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From exarkun at divmod.com  Sun Jun 26 14:56:17 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sun, 26 Jun 2005 14:56:17 -0400
Subject: [Twisted-Python] Dropping support for old cred
In-Reply-To: 0
Message-ID: <20050626185617.26278.1290810310.divmod.quotient.1031@ohm>

The modules:

  twisted.cred.authorizer
  twisted.cred.identity
  twisted.cred.service
  twisted.cred.perspective

constitute "classic cred", which has been deprecated for some time now.  "New cred" is available in the modules:

  twisted.cred.portal
  twisted.cred.checkers
  twisted.cred.credentials

and offers a vastly superior API.  The only remaining code in Twisted which uses "classic cred" is the old PB log in method, which is also deprecated (in favor of one based around new cred), and the old application code (twisted.internet.app) which is also deprecated in favor of twisted.application.

It would be nice to remove this code from the next Twisted release.  Does anyone have any applications still relying on them which they plan to use with Twisted 2.1?  If so, what is preventing you from updating the code to the new, vastly improved APIs?

Jp & Itamar



From bruce at cubik.org  Sun Jun 26 15:23:07 2005
From: bruce at cubik.org (Bruce Mitchener)
Date: Sun, 26 Jun 2005 13:23:07 -0600
Subject: [Twisted-Python] Dropping support for old cred
In-Reply-To: <20050626185617.26278.1290810310.divmod.quotient.1031@ohm>
References: <20050626185617.26278.1290810310.divmod.quotient.1031@ohm>
Message-ID: <42BF009B.1050804@cubik.org>

Jp Calderone wrote:
> and offers a vastly superior API.  The only remaining code in Twisted 
> which uses "classic cred" is the old PB log in method, which is also 
> deprecated (in favor of one based around new cred), and the old 
> application code (twisted.internet.app) which is also deprecated in 
> favor of twisted.application.
> 
> It would be nice to remove this code from the next Twisted release.  
> Does anyone have any applications still relying on them which they plan 
> to use with Twisted 2.1?  If so, what is preventing you from updating 
> the code to the new, vastly improved APIs?

Our codebase at work still uses old cred.  I've never had the time or 
customer requirement to do the upgrade.  Unless I'd get a performance 
benefit out of it, it'd be hard to justify the time spent.

On the other hand, perhaps I do not need Twisted 2.1 either.  What do I 
stand to gain by making the switch?  What benefit can I use to sell 
this?  I assume that I could do this fairly incrementally as we have 
about 10 different processes that communicate within a server cluster 
over PB.  I still use the old PB APIs too (so no PBClientFactory for me!).

We still use the old application code as well for the same sorts of 
reasons. :)  I don't think we have anything that relies on that though, 
we just use barebones tap files (more deprecated code!).

  - Bruce



From glyph at divmod.com  Sun Jun 26 15:35:58 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Sun, 26 Jun 2005 15:35:58 -0400
Subject: [Twisted-Python] Dropping support for old cred
In-Reply-To: <42BF009B.1050804@cubik.org>
References: <20050626185617.26278.1290810310.divmod.quotient.1031@ohm>
	<42BF009B.1050804@cubik.org>
Message-ID: <42BF039E.6030205@divmod.com>

Bruce Mitchener wrote:
> Jp Calderone wrote:

> Our codebase at work still uses old cred.  I've never had the time or 
> customer requirement to do the upgrade.  Unless I'd get a performance 
> benefit out of it, it'd be hard to justify the time spent.

old->new cred would have zero performance benefit, I'd guess.  Twisted 
1.3->2.1 might have some but I don't believe anyone's measured it 
comprehensively yet.  1.3->2.1 with deprecations would almost certainly 
be a slowdown.

> On the other hand, perhaps I do not need Twisted 2.1 either.  What do I 
> stand to gain by making the switch?  What benefit can I use to sell 
> this?  I assume that I could do this fairly incrementally as we have 
> about 10 different processes that communicate within a server cluster 
> over PB.  I still use the old PB APIs too (so no PBClientFactory for me!).

Given what I know about your application, upgrading to 2.1 wouldn't be a 
big win.  At some point - if we are anywhere close to the "schedule" 
that I imagine, this would be around 2.2 - there will be several new 
protocols availble and you might want to upgrade to make use of those. 
The main advantage of new cred is that it gives a consistent view of 
login and session management across all protocols that your application 
supports.  Right now the featureset is rather bare-bones, but I have 
plans to build upon the existing API and add features to support things 
like cross-protocol session management and authentication (e.g. 
automatic support for things like SMTP-after-POP authentication, but 
using any two protocols).  Something like that would be totally 
impossible with old cred, since it barely even provides an abstraction 
for the same sorts of things that new cred does.

At some point NewPB will arrive, too - and when that does, I believe 
that the upgrade in terms of performance and security will be well worth 
it.  Talk to warner about when that might happen though, it's still a 
mystery to me :).




From gmcdonald at infocomp.com  Sun Jun 26 20:11:40 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Mon, 27 Jun 2005 10:11:40 +1000
Subject: [Twisted-Python] loading application files from zip files for
	frozen exes
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4E10@XCHANGE>

Hi All,

When packaging a twisted server implementation with py2exe that uses .tac
(.py) files one ends up with a zip file with all the python dependencies (as
.pyo bytecode), an .exe and the .tac files in the package directory. To me
this seems a bit messy since the distribution is by definition a 'frozen'
exe and any changes to the python modules in the zip will require a rebuild.

With this limitation in mind I initially wrote several patches to twisted
core modules to allow an application to be loaded from a zip file (only .py
modules) which i attached to issue 1092
(http://twistedmatrix.com/bugs/issue1092). Upon further reflection I
realised that this functionality is only really useful in the case of exes
frozen with py2exe and I rewrote my patch to be completely external to the
twisted core (code and test modules which i have attached to this mail).
Would you consider perhaps inclusion of this in the twisted/scripts
directory with a short note in a howto?

Regards,

Grant M

P.S. this allows you to specify:

twistd.exe -y <name>

where <name> is the python module name without the .py

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050627/0a934460/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: arc_twistw.py
Type: application/octet-stream
Size: 3783 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050627/0a934460/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: exesetup.py
Type: application/octet-stream
Size: 1335 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050627/0a934460/attachment-0001.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test_arc_twistw.py
Type: application/octet-stream
Size: 1067 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20050627/0a934460/attachment-0002.obj 

From tdickenson at devmail.geminidataloggers.co.uk  Tue Jun 28 05:47:04 2005
From: tdickenson at devmail.geminidataloggers.co.uk (Toby Dickenson)
Date: Tue, 28 Jun 2005 10:47:04 +0100
Subject: [Twisted-Python] Limiting number of concurrent client connections
Message-ID: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>

Im finding that Win32Reactor raises an exception on every iteration of the 
main loop if I exceed the limit of 64 WaitForMultipleObjects. 

I would prefer to avoid this fairly obvious denial-of-service problem by 
limiting the number of concurrent client connections. Is there a standard 
solution for this?

Thanks in advance,

-- 
Toby Dickenson



From nkeric at gmail.com  Tue Jun 28 08:36:40 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 28 Jun 2005 20:36:40 +0800
Subject: [Twisted-Python] Is it possible to write a tcp app which behaves
	like both client and server?
Message-ID: <43c0d2b5050628053616b33dba@mail.gmail.com>

Hi all!

Sorry for my poor english, I'll try to express myself clearly :p

I need to implement something like this:

 * it listens on a port 12345 for only one incoming connection if
there is currently no connection
 * it can also connect to other host from that port (12345) if there
is currently no connection

Or: Could I write a server which can connect (from the port it's
listening on) to another known server?

Could these be done with twisted?


Any infomatin would be warmly welcome, big thanks!

- Eric



From justinjohnson at gmail.com  Tue Jun 28 09:53:45 2005
From: justinjohnson at gmail.com (Justin Johnson)
Date: Tue, 28 Jun 2005 08:53:45 -0500
Subject: [Twisted-Python] Limiting number of concurrent client connections
In-Reply-To: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>
References: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>
Message-ID: <94a776e705062806537ab1dba9@mail.gmail.com>

This isn't the best solution, but I've been using a semaphore to limit the 
number of "tasks" that take place at a time. I've also been doing some 
research on IOCP and plan on adding some missing functionality to the IOCP 
reactor so I don't have to use the win32eventreactor anymore.
   
from twisted.internet import defer

class Semaphore:
"""A semaphore for event driven systems."""
def __init__(self, tokens):
self.waiting = []
self.tokens = tokens
self.limit = tokens

def acquire(self):
"""Attempt to acquire the token.

@return Deferred which returns on token acquisition.
"""
assert self.tokens >= 0
d = defer.Deferred()
if not self.tokens:
self.waiting.append(d)
else:
self.tokens = self.tokens - 1
d.callback(self)
return d

def release(self):
"""Release the token.

Should be called by whoever did the acquire() when the shared
resource is free.
"""
assert self.tokens < self.limit
self.tokens = self.tokens + 1
if self.waiting:
# someone is waiting to acquire token
self.tokens = self.tokens - 1
d = self.waiting.pop(0)
d.callback(self)

def _releaseAndReturn(self, r):
self.release()
return r

def run(self, f, *args, **kwargs):
"""Acquire token, run function, release token.

@return Deferred of function result.
"""
d = self.acquire()
d.addCallback(lambda r: defer.maybeDeferred(f, *args, 
**kwargs).addBoth(self._releaseAndReturn))
return d


 On 6/28/05, Toby Dickenson <tdickenson at devmail.geminidataloggers.co.uk> 
wrote: 
> 
> Im finding that Win32Reactor raises an exception on every iteration of the
> main loop if I exceed the limit of 64 WaitForMultipleObjects.
> 
> I would prefer to avoid this fairly obvious denial-of-service problem by
> limiting the number of concurrent client connections. Is there a standard
> solution for this?
> 
> Thanks in advance,
> 
> --
> Toby Dickenson
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050628/1cb432ae/attachment.htm 

From exarkun at divmod.com  Tue Jun 28 10:10:52 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 28 Jun 2005 10:10:52 -0400
Subject: [Twisted-Python] Limiting number of concurrent client connections
In-Reply-To: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>
Message-ID: <20050628141052.26278.1286405978.divmod.quotient.2053@ohm>

On Tue, 28 Jun 2005 10:47:04 +0100, Toby Dickenson <tdickenson at devmail.geminidataloggers.co.uk> wrote:
>Im finding that Win32Reactor raises an exception on every iteration of the
>main loop if I exceed the limit of 64 WaitForMultipleObjects.
>
>I would prefer to avoid this fairly obvious denial-of-service problem by
>limiting the number of concurrent client connections. Is there a standard
>solution for this?
>

Count the number of connections you have accepted.  When you get up to 62 or 63 or so, stop accepting new ones.  If ServerFactory.buildProtocol() returns None, Twisted immediately closes the accepted connection.  If you do this (perhaps in conjunction with calling stopListening() on the port returned by listenXYZ()), you'll never overrun the 64 object limit.

Jp



From justinjohnson at gmail.com  Tue Jun 28 10:50:49 2005
From: justinjohnson at gmail.com (Justin Johnson)
Date: Tue, 28 Jun 2005 09:50:49 -0500
Subject: [Twisted-Python] Limiting number of concurrent client connections
In-Reply-To: <20050628141052.26278.1286405978.divmod.quotient.2053@ohm>
References: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>
	<20050628141052.26278.1286405978.divmod.quotient.2053@ohm>
Message-ID: <94a776e705062807503652f841@mail.gmail.com>

>From my experience, the problem has to do with more than just number of 
connections. I've reached the limit from spawning too many processes.

On 6/28/05, Jp Calderone <exarkun at divmod.com> wrote: 
> 
> On Tue, 28 Jun 2005 10:47:04 +0100, Toby Dickenson <
> tdickenson at devmail.geminidataloggers.co.uk> wrote:
> >Im finding that Win32Reactor raises an exception on every iteration of 
> the
> >main loop if I exceed the limit of 64 WaitForMultipleObjects.
> >
> >I would prefer to avoid this fairly obvious denial-of-service problem by
> >limiting the number of concurrent client connections. Is there a standard
> >solution for this?
> >
> 
> Count the number of connections you have accepted. When you get up to 62 
> or 63 or so, stop accepting new ones. If ServerFactory.buildProtocol() 
> returns None, Twisted immediately closes the accepted connection. If you do 
> this (perhaps in conjunction with calling stopListening() on the port 
> returned by listenXYZ()), you'll never overrun the 64 object limit.
> 
> Jp
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20050628/79506c90/attachment.htm 

From itamar at itamarst.org  Tue Jun 28 10:56:25 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 28 Jun 2005 10:56:25 -0400
Subject: [Twisted-Python] Is it possible to write a tcp app which
	behaves like both client and server?
In-Reply-To: <43c0d2b5050628053616b33dba@mail.gmail.com>
References: <43c0d2b5050628053616b33dba@mail.gmail.com>
Message-ID: <1119970585.8392.24.camel@localhost.localdomain>

On Tue, 2005-06-28 at 20:36 +0800, Eric Hsu wrote:

> Or: Could I write a server which can connect (from the port it's
> listening on) to another known server?

You can't have (in TCP) something that is both server and client on same
port. You can either connect while bound to a port or you can listen to
a port. It is possible with UDP, however.

However: there is no reason why TCP clients should connect *from* a
specific port, it doesn't give you anything. So why bother? Just have
servers listen on a well known port.




From exarkun at divmod.com  Tue Jun 28 11:00:59 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 28 Jun 2005 11:00:59 -0400
Subject: [Twisted-Python] Limiting number of concurrent client connections
In-Reply-To: <94a776e705062807503652f841@mail.gmail.com>
Message-ID: <20050628150059.26278.1051040058.divmod.quotient.2064@ohm>

On Tue, 28 Jun 2005 09:50:49 -0500, Justin Johnson <justinjohnson at gmail.com> wrote:
>>From my experience, the problem has to do with more than just number of
>connections. I've reached the limit from spawning too many processes.

Right.  You need to take into account everything that is happening in the process.  Client connections you create, processes you spawn, _and_ incoming connections you accept.  The below lets you limit one of these factors.  A solution like the semaphore you posted (a version of which is in Twisted 2.0, btw, for those who aren't aware - twisted.internet.defer.DeferredSemaphore) would let you limit the others.

Jp



From nkeric at gmail.com  Tue Jun 28 22:30:52 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Wed, 29 Jun 2005 10:30:52 +0800
Subject: [Twisted-Python] Is it possible to write a tcp app which behaves
	like both client and server?
In-Reply-To: <1119970585.8392.24.camel@localhost.localdomain>
References: <43c0d2b5050628053616b33dba@mail.gmail.com>
	<1119970585.8392.24.camel@localhost.localdomain>
Message-ID: <43c0d2b5050628193061efa55@mail.gmail.com>

Itamar, thank you for your quick reply!

It helps me a lot to make things clear, since I've misunderstood
something important of the application I'm trying to implement ^_^

- Eric

2005/6/28, Itamar Shtull-Trauring <itamar at itamarst.org>:
> On Tue, 2005-06-28 at 20:36 +0800, Eric Hsu wrote:
> 
> > Or: Could I write a server which can connect (from the port it's
> > listening on) to another known server?
> 
> You can't have (in TCP) something that is both server and client on same
> port.



From Stephan.Popp at iisb.fraunhofer.de  Wed Jun 29 08:18:03 2005
From: Stephan.Popp at iisb.fraunhofer.de (Stephan Popp)
Date: Wed, 29 Jun 2005 14:18:03 +0200
Subject: [Twisted-Python] Passing arguments to application
Message-ID: <200506291418.03314.Stephan.Popp@iisb.fraunhofer.de>

Hi,
maybe I haven't searched enough, but I don't find anything that halps me to 
solve my problem.
I've got a serverapplication. The problem is in the following lines:

application = service.Application("TwistedServerApp")
internet.TCPServer(8800, pb.ServerFactory...)

I don't want to start this with a predetermined port. More like:

twistd -y TwistedServerApp.tac 8800

Is this somehow possible? sys.argv seems impossible to use.

-Stephan



From exarkun at divmod.com  Wed Jun 29 08:30:17 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Wed, 29 Jun 2005 08:30:17 -0400
Subject: [Twisted-Python] Passing arguments to application
In-Reply-To: <200506291418.03314.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <20050629123017.26278.917704695.divmod.quotient.2526@ohm>

On Wed, 29 Jun 2005 14:18:03 +0200, Stephan Popp <stephan.popp at iisb.fraunhofer.de> wrote:
>Hi,
>maybe I haven't searched enough, but I don't find anything that halps me to
>solve my problem.
>I've got a serverapplication. The problem is in the following lines:
>
>application = service.Application("TwistedServerApp")
>internet.TCPServer(8800, pb.ServerFactory...)
>
>I don't want to start this with a predetermined port. More like:
>
>twistd -y TwistedServerApp.tac 8800
>
>Is this somehow possible? sys.argv seems impossible to use.
>
>-Stephan

.tac files don't take configuration.  .tac files _are_ configuration.  There are no provisions for "passing arguments" to them.

Jp



From Stephan.Popp at iisb.fraunhofer.de  Wed Jun 29 09:03:37 2005
From: Stephan.Popp at iisb.fraunhofer.de (Stephan Popp)
Date: Wed, 29 Jun 2005 15:03:37 +0200
Subject: [Twisted-Python] Passing arguments to application
In-Reply-To: <20050629123017.26278.917704695.divmod.quotient.2526@ohm>
References: <20050629123017.26278.917704695.divmod.quotient.2526@ohm>
Message-ID: <200506291503.37706.Stephan.Popp@iisb.fraunhofer.de>

> .tac files don't take configuration.  .tac files _are_ configuration. 
> There are no provisions for "passing arguments" to them.
>
> Jp

Oh, then I misunderstood something here.
Thanks for the help.

-Stephan





From foom at fuhm.net  Wed Jun 29 20:56:37 2005
From: foom at fuhm.net (James Y Knight)
Date: Wed, 29 Jun 2005 20:56:37 -0400
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: <2841A347-724B-403A-86AE-EC258B0C94FF@fuhm.net>

Bug summary
______________________
Since 2005-06-22 16:16:07.550000:
Bugs opened: 5   Bugs closed: 5   Total open bugs: 396 (+0)
   Urgent: 9 (+0)
   Bug: 168 (+1)
   Feature: 143 (-1)
   Wish: 76 (+0)

New / Reopened Bugs
______________________
                     ==== Urgent ====
Error in DelayedCall.__str__  (2 days ago)
CLOSED http://twistedmatrix.com/bugs/issue1094 opened by bruce

                     ==== Bug ====
[FTP] FTPClient does not handle multi-line responses properly  (5  
days ago)
        http://twistedmatrix.com/bugs/issue1093 opened by orbitz

                     ==== Feature ====
Adding support for rotation on a fixed numlber of logs  (yesterday)
        http://twistedmatrix.com/bugs/issue1095 opened by lstep

[DOCUMENTATION, WIN32] Creating standalone twisted win32 executables  
using py2exe  (6 days ago)
        http://twistedmatrix.com/bugs/issue1092 opened by vertigo

                     ==== Wish ====
Tab in twisted/python/failure.py  (6 days ago)
CLOSED http://twistedmatrix.com/bugs/issue1091 opened by bruce

Bugs Closed
______________________
                     ==== Urgent ====
Error in DelayedCall.__str__  (2 days ago)
        http://twistedmatrix.com/bugs/issue1094 opened by bruce,  
closed by exarkun

                     ==== Feature ====
[CHAT] update words to use newcred  (21 months ago)
        http://twistedmatrix.com/bugs/issue270 opened by acapnotic,  
closed by exarkun

[WORDS] Remove Words' use of deprecated t.web.widgets  (1 month ago)
        http://twistedmatrix.com/bugs/issue1033 opened by exarkun,  
closed by exarkun

[WORDS] Update words to new PB API  (1 month ago)
        http://twistedmatrix.com/bugs/issue1032 opened by exarkun,  
closed by exarkun

                     ==== Wish ====
Tab in twisted/python/failure.py  (6 days ago)
        http://twistedmatrix.com/bugs/issue1091 opened by bruce,  
closed by exarkun




From july.lzu at gmail.com  Thu Jun 30 21:31:01 2005
From: july.lzu at gmail.com (july july)
Date: Fri, 1 Jul 2005 09:31:01 +0800
Subject: [Twisted-Python] Passing arguments to application
In-Reply-To: <200506291503.37706.Stephan.Popp@iisb.fraunhofer.de>
References: <20050629123017.26278.917704695.divmod.quotient.2526@ohm>
	<200506291503.37706.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <89cf12820506301831737ab604@mail.gmail.com>

On 6/29/05, Stephan Popp <Stephan.Popp at iisb.fraunhofer.de> wrote:
> > .tac files don't take configuration.  .tac files _are_ configuration.
> > There are no provisions for "passing arguments" to them.
> >
> > Jp
> 
> Oh, then I misunderstood something here.
> Thanks for the help.
> 
> -Stephan
> 
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
en I think so



From twisted at codex.net  Wed Jun  1 07:47:04 2005
From: twisted at codex.net (Vincent AE Scott)
Date: Wed, 1 Jun 2005 14:47:04 +0100
Subject: [Twisted-Python] twisted.enterprise.row multiple rowForeignKeys
Message-ID: <20050601134704.GA5577@mail.codex.net>

Hi,
First off, I'm a relative newby to twisted and I've just encountered my
first problem that i couldnt solve either via the docs or google.

I'm using twisted 2.0, python 2.4.1 on debian/testing

namely I'm attempting to use twisted.enterprise.row and add multiple
foreign kets to a RowObject.  What i thought would work is the
following:

 rowForeignKeys	= [
  ("questions", [("question_id","int")], [("id_question","int")], None, 1),
  ("users", [("user_id","int")], [("id_user","int")], None, 1),
 ]

But, what i find works is when i only have one foreign reference in my
class.  Both of the above ones are valid (see attached source), but only
the first one (questions) is actually used.  If i comment out the
questions entry, leaving just "users" it works as expected.

I popped in some extra debug in Reflector.populateSchemaFor to verify
that it was processing both entries, and it appears to be so.

Does anyone else have a suggestion as to where I'm going wrong?

TIA
-v


-- 
keys:  http://codex.net/gpg.asc 

 Nothing is true && everything is possible

-------------- next part --------------
from twisted.enterprise import row

class QuestionRow( row.RowObject ):
	rowColumns = [
		("id_question","int"),
		("the_question","varchar"),
		("poser_id","int")
		]
	rowTableName	= "questions"
	rowKeyColumns	= [("id_question","int")]
	rowForeignKeys	= [("users", [("poser_id","int")], [("id_user","int")], None, 1)]
	
#######################################################################################

class AnswerRow( row.RowObject ):
	rowColumns = [
		("id_answer","int"),
		("question_id","int"),
		("the_answer","varchar"),
		("user_id","int")
		]
	rowTableName	= "answers"
	rowKeyColumns	= [("id_answer","int")]
	rowForeignKeys	= [
		("users", [("user_id","int")], [("id_user","int")], None, 1),
		("questions", [("question_id","int")], [("id_question","int")], None, 1),
		]

#######################################################################################

class UserRow( row.RowObject ):
	rowColumns = [
		("id_user",		"int"),
		("username",		"varchar"),
		("forename",		"varchar"),
		("surname",		"varchar")
		]
	rowTableName	= "users"
	rowKeyColumns	= [("id_user","int")]

#######################################################################################

from twisted.enterprise import adbapi
from twisted.internet import reactor, defer, task
from twisted.enterprise.sqlreflector import SQLReflector
from twisted.trial.util import deferredResult

dbpool = adbapi.ConnectionPool( "pyPgSQL.PgSQL", database='xxxx', \
	host='localhost', user='xxxx', password='xxxx' )

reflector = SQLReflector( dbpool, [UserRow, PrimaryGroupRow, QuestionRow, AnswerRow] )

def gotUsers(users):
	for user in users:
		for child in user.childRows:
			print "KEYS: ", child.rowForeignKey
			# this will only print the foriegn key descriptions 

def runme():
	d2 = reflector.loadObjectsFrom( "users" )
	d2.addCallback( gotUsers )
	deferredResult(d2)
	print "runme got deferred d2"

reactor.callLater( 1.0, runme )
reactor.run()


From carolinaardohain at gmail.com  Wed Jun  1 13:27:54 2005
From: carolinaardohain at gmail.com (Carolina Ardohain)
Date: Wed, 1 Jun 2005 16:27:54 -0300
Subject: [Twisted-Python] PyPgSQL not locking in adbapi
Message-ID: <8ecf09605060112276542c9c2@mail.gmail.com>

I'm using Twisted 2.0, and pgSQL 2.4.

I have two function in plpgsql that access the same table, I have to
look if one id is in the table persons, if not then add to the table.
I try to lock a table with "LOCK TABLE persons IN ACCESS EXCLUSIVE
MODE;", so no both functions try to add the same id.

I get 'duplicate key violates unique constraint' when run the two
queries at the same time, if I delay one of the functions 1 sec then
everything is fine.



From exarkun at divmod.com  Wed Jun  1 15:05:22 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Wed, 01 Jun 2005 21:05:22 GMT
Subject: [Twisted-Python] PyPgSQL not locking in adbapi
In-Reply-To: <8ecf09605060112276542c9c2@mail.gmail.com>
Message-ID: <20050601210522.559.1924981987.divmod.quotient.14148@ohm>

On Wed, 1 Jun 2005 16:27:54 -0300, Carolina Ardohain <carolinaardohain at gmail.com> wrote:
>I'm using Twisted 2.0, and pgSQL 2.4.
>
>I have two function in plpgsql that access the same table, I have to
>look if one id is in the table persons, if not then add to the table.
>I try to lock a table with "LOCK TABLE persons IN ACCESS EXCLUSIVE
>MODE;", so no both functions try to add the same id.
>
>I get 'duplicate key violates unique constraint' when run the two
>queries at the same time, if I delay one of the functions 1 sec then
>everything is fine.
>

What method did you use to run the LOCK statement?  Did you make sure it ran in the same transaction as the subsequent SELECT and UPDATE?

If you aren't already, I think you want to use one runInteraction() call for all three parts.

Jp



From exarkun at divmod.com  Wed Jun  1 15:24:07 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Wed, 01 Jun 2005 21:24:07 GMT
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <429CDCAE.6020609@fettig.net>
Message-ID: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>

On Tue, 31 May 2005 17:52:46 -0400, Abe Fettig <abe at fettig.net> wrote:
>Hello all,
>
>I'm trying to figure out how to hook up the necessary classes in
>twisted.conch.recvline to add line-editing and history to a simple ssh
>app. It was easy to modify
>http://twistedmatrix.com/projects/conch/documentation/examples/sshsimpleserver.py
>to use a custom protocol (a simple command-line interface that sends web
>services requests to a JotSpot wiki), but I can't figure out how
>recvline is meant to be used. Could someone (Jp?) show me how you'd go
>about bolting recvline onto sshsimpleserver?
>

In summary, you need:

  1) A Realm which produces avatars implementing IConchUser
  2) An avatar which also implements or is adaptable to ISession
  3) A session which constructs a twisted.conch.insults.insults.ServerProtocol in openShell, and connects it to a transport
  4) A protocol class which subclasses one of the recvline protocol classes, passed as the first argument to ServerProtocol

If you hook all these pieces up right, the protocol class you give to ServerProtocol should end up receiving application-level data from your ssh server, and its terminal attribute will be hooked up to send bytes back.

Note that this API may not be stable.

There's an example of all this smeared across doc/conch/examples/demo_recvline.py and twisted/conch/manhole_ssh.py.


The API presented by manhole_ssh.py is definitely not stable.

Jp



From carolinaardohain at gmail.com  Wed Jun  1 16:23:26 2005
From: carolinaardohain at gmail.com (Carolina Ardohain)
Date: Wed, 1 Jun 2005 19:23:26 -0300
Subject: [Twisted-Python] PyPgSQL not locking in adbapi
In-Reply-To: <20050601210522.559.1924981987.divmod.quotient.14148@ohm>
References: <8ecf09605060112276542c9c2@mail.gmail.com>
	<20050601210522.559.1924981987.divmod.quotient.14148@ohm>
Message-ID: <8ecf09605060115233566a329@mail.gmail.com>

The functions are called with "SELECT conversation_insert(...)"
and "SELECT message_insert(...)".

FUNCTION conversation_insert(....)
BEGIN
    LOCK TABLE person IN ACCESS EXCLUSIVE MODE;
    PERSON * FROM persons WHERE id = person_id;
    IF NOT FOUND THEN
        INSERT INTO persons (id) VALUES (person_id)
    END IF;
    ...
    INSERT INTO conversations (personId) VALUES (person_id)
    ...
    RETURN;
END;

FUNCTION message_insert(....)
BEGIN
    LOCK TABLE person IN ACCESS EXCLUSIVE MODE;
    PERSON * FROM persons WHERE id = person_id;
    IF NOT FOUND THEN
        INSERT INTO persons (id) VALUES (person_id)
    END IF;
    ...
    INSERT INTO message (personId, subject, message) VALUES
(person_id, v_subject, v_message)
    ...
    RETURN;
END;



On 6/1/05, Jp Calderone <exarkun at divmod.com> wrote:
> On Wed, 1 Jun 2005 16:27:54 -0300, Carolina Ardohain <carolinaardohain at gmail.com> wrote:
> >I'm using Twisted 2.0, and pgSQL 2.4.
> >
> >I have two function in plpgsql that access the same table, I have to
> >look if one id is in the table persons, if not then add to the table.
> >I try to lock a table with "LOCK TABLE persons IN ACCESS EXCLUSIVE
> >MODE;", so no both functions try to add the same id.
> >
> >I get 'duplicate key violates unique constraint' when run the two
> >queries at the same time, if I delay one of the functions 1 sec then
> >everything is fine.
> >
> 
> What method did you use to run the LOCK statement?  Did you make sure it ran in the same transaction as the subsequent SELECT and UPDATE?
> 
> If you aren't already, I think you want to use one runInteraction() call for all three parts.
> 
> Jp
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From maoy at cis.upenn.edu  Wed Jun  1 16:42:00 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Wed, 1 Jun 2005 18:42:00 -0400 (EDT)
Subject: [Twisted-Python] what happened to the --profile option in twistd?
Message-ID: <Pine.LNX.4.61.0506011838320.11511@forty-thieves.cis.upenn.edu>

I thought there was one, but I just checked my 1.3.0 installation and it 
is gone. What is the right way to do profiling now?

Thanks,
Yun




From bgranger at scu.edu  Wed Jun  1 16:58:01 2005
From: bgranger at scu.edu (Brian Granger)
Date: Wed, 01 Jun 2005 15:58:01 -0700
Subject: [Twisted-Python] Stopping and restarting the reactor
Message-ID: <0691b0c3fe8435554c486474bb599d3b@scu.edu>

Hello,

I am using twisted's client capabilities in an interactive setting.  To 
allow for interactive work, I have wrapped all my calls to connectTCP 
with a class that starts the reactor when a new set of connectTCP calls 
is made.  I stop the reactor in the clientConnectionLost method of my 
ClientFactory (when there are no more connections).

The first time I initiate a connectTCP call in my wrapper class 
everything works as expected:  the reactor is started, twisted does its 
stuff, and the ClientFactory stops the reactor (giving me back 
interactive controll).  BUT, if I the initiate another connectTCP call, 
the reactor starts, but then I get a User Timeout error showing up.  
That is, the second time, no connection is made.  My ClientFactory 
again stops the reactor (this time in clientConnectionFailed), but then 
python hangs.

My question:  is the reactor designed to be started/stopped/restarted 
in a single session?  If so, are there any considerations that I am 
missing?  Why doesn't the connection get made the second time?

Thanks in advance

Brian






The first time

Brian E. Granger
Assistant Professor of Physics
Santa Clara University

bgranger at scu.edu
Phone: 408-551-1891
Fax: 408-554-6965




From maoy at cis.upenn.edu  Wed Jun  1 17:16:12 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Wed, 1 Jun 2005 19:16:12 -0400 (EDT)
Subject: [Twisted-Python] what happened to the --profile option in twistd?
In-Reply-To: <Pine.LNX.4.61.0506011838320.11511@forty-thieves.cis.upenn.edu>
References: <Pine.LNX.4.61.0506011838320.11511@forty-thieves.cis.upenn.edu>
Message-ID: <Pine.LNX.4.61.0506011915210.11511@forty-thieves.cis.upenn.edu>

Please ignore my previous post. :)




From bob at redivi.com  Wed Jun  1 17:25:59 2005
From: bob at redivi.com (Bob Ippolito)
Date: Wed, 1 Jun 2005 16:25:59 -0700
Subject: [Twisted-Python] Stopping and restarting the reactor
In-Reply-To: <0691b0c3fe8435554c486474bb599d3b@scu.edu>
References: <0691b0c3fe8435554c486474bb599d3b@scu.edu>
Message-ID: <D79C963C-37FA-4682-99A1-A1A0D1D12DE0@redivi.com>


On Jun 1, 2005, at 3:58 PM, Brian Granger wrote:

> I am using twisted's client capabilities in an interactive  
> setting.  To allow for interactive work, I have wrapped all my  
> calls to connectTCP with a class that starts the reactor when a new  
> set of connectTCP calls is made.  I stop the reactor in the  
> clientConnectionLost method of my ClientFactory (when there are no  
> more connections).
>
> The first time I initiate a connectTCP call in my wrapper class  
> everything works as expected:  the reactor is started, twisted does  
> its stuff, and the ClientFactory stops the reactor (giving me back  
> interactive controll).  BUT, if I the initiate another connectTCP  
> call, the reactor starts, but then I get a User Timeout error  
> showing up.  That is, the second time, no connection is made.  My  
> ClientFactory again stops the reactor (this time in  
> clientConnectionFailed), but then python hangs.
>
> My question:  is the reactor designed to be started/stopped/ 
> restarted in a single session?  If so, are there any considerations  
> that I am missing?  Why doesn't the connection get made the second  
> time?

No, it's not.  You should start the reactor at the beginning of your  
app, and stop it when your app is going to quit.  That's it.

threadedselectreactor <http://bob.pythonmac.org/archives/2005/04/17/ 
twisted-and-foreign-event-loops/> is probably more appropriate for  
what you're trying to do.

-bob




From radeex at gmail.com  Wed Jun  1 18:05:18 2005
From: radeex at gmail.com (Christopher Armstrong)
Date: Thu, 2 Jun 2005 10:05:18 +1000
Subject: [Twisted-Python] Database client-server based on Twisted
In-Reply-To: <20050601121942.C8F9C2A50@smtp-02.servidoresdns.net>
References: <20050601121942.C8F9C2A50@smtp-02.servidoresdns.net>
Message-ID: <60ed19d405060117053c2d91b4@mail.gmail.com>

This was accidentally posted to twisted-python-owner instead of twisted-python.

---------- Forwarded message ----------
From: Andreu Alted <aalted at cstables.org>
Date: Jun 1, 2005 10:19 PM
Subject: Database client-server based on Twisted
To: twisted-python-owner at twistedmatrix.com


 
Hello, 
  
I have released a beta version of CSTables (www.cstables.org).
CSTables is a client-server layer for PyTables (www.pytables.org) and
HDF5 (hdf.ncsa.uiuc.edu/HDF5/). It is designed to fast adapt to any
other API. In fact, I was thinking in converting it in a
semi-automatic generator of client-server layers for monolitic
applcations, but that's another story.
  
CSTables uses Twisted for client-server communication, and actually is
fully integrated with the Twisted Framework (it runs with twistd
script).
  
My project had to be commercialized by another company, but we didn't
get an agreement.
  
Now, I am looking for a way to keep CSTables alive. There is an
interest for CSTables as a client-server for HDF5, but my intention is
to make something nearest to the general developer.
  
I wonder if Twisted or a related company could be interested in some
manner in CSTables, (his technology, his development, integrating it
in some manner with other products, similar developments, etc.).
  
One of the strong points of CSTables is fast reading large amounts of
data, moreover after my current optimizations that use shared memory
for transferring data for local clients in place of banana
serialization.
  
Please, let me know any oppinion. 
  
Best Regards. 
  
______________________ 
Andreu Alted 
CSTables main developer



From exarkun at divmod.com  Wed Jun  1 18:11:43 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 02 Jun 2005 00:11:43 GMT
Subject: [Twisted-Python] Stopping and restarting the reactor
In-Reply-To: <0691b0c3fe8435554c486474bb599d3b@scu.edu>
Message-ID: <20050602001143.559.125749438.divmod.quotient.14227@ohm>

On Wed, 01 Jun 2005 15:58:01 -0700, Brian Granger <bgranger at scu.edu> wrote:
>Hello,
>
>I am using twisted's client capabilities in an interactive setting. 

How are you driving this interaction?  I could argue that the vast majority of Twisted applications fall into this category - for example, a Twisted web server is interacted with using an HTTP client; a Twisted mail client is interacted with using GUI widgets or a manhole shell. Neither of these cases demands the reactor stop while the interaction proceeds: in the ideal case, the interaction merely needs to be event driven.  In your case, it sounds like simply blocking for a while *while the reactor runs* is sufficient.  This will let whatever blocking mechanism you currently use to interact with the user to continue functioning, without dragging the problems of stopping and restarting the reactor into the picture.

Jp



From abe at fettig.net  Wed Jun  1 22:44:47 2005
From: abe at fettig.net (Abe Fettig)
Date: Thu, 02 Jun 2005 00:44:47 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>
Message-ID: <429E8EBF.2000501@fettig.net>

Jp Calderone wrote:

> If you hook all these pieces up right, the protocol class you give to
> ServerProtocol should end up receiving application-level data from your
> ssh server, and its terminal attribute will be hooked up to send bytes
> back.
> 
> Note that this API may not be stable.
> 
> There's an example of all this smeared across
> doc/conch/examples/demo_recvline.py and twisted/conch/manhole_ssh.py.

I've done this, and it's working in my example the same way as it does
in demo_recvline.py. It's a much nicer environment than my original:
backspace works, arrows work, you can scroll up and down through command
history. Yippee!

But there's a problem, both in my code and in demo_recvline.py: when you
get to the bottom of the terminal it doesn't scroll. All the lines just
get pasted over each other on the bottom line of the terminal. I'm
clueless about terminal programming: generally I just know that I can
dump a bunch of text and the terminal will scroll. But now it doesn't.
Can you help me fix this?

Once I get this all working, I'll post a modified simplesshserver.py for
the benefit of others who might want a working line editing and history
for their custom protocol.

Thanks!

Abe



From foom at fuhm.net  Thu Jun  2 00:04:26 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 2 Jun 2005 02:04:26 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <429E8EBF.2000501@fettig.net>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>
	<429E8EBF.2000501@fettig.net>
Message-ID: <EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>

On Jun 2, 2005, at 12:44 AM, Abe Fettig wrote:
> But there's a problem, both in my code and in demo_recvline.py:  
> when you
> get to the bottom of the terminal it doesn't scroll. All the lines  
> just
> get pasted over each other on the bottom line of the terminal. I'm
> clueless about terminal programming: generally I just know that I can
> dump a bunch of text and the terminal will scroll. But now it doesn't.
> Can you help me fix this?

I know way too much about terminal programming, and can immediately  
identify the problem as the use of "ESC E". Never ever use ESC E,  
it's worthless. While I'm at it: never use ESC D, and really try not  
to use ESC M either. They're all mostly unused and people who don't  
care about correctness, only "working for unix termcap" don't bother  
implementing them right. Use instead \r\n, \n, and ESC[A (not quite  
the same thing, as it doesn't do a backwards scroll, but if you think  
backwards scrolling is going to work, I've got this bridge to sell  
you...).

Anyhow, could you say which horribly broken terminal program you're  
using? I like to keep track of these things. From what I can tell,  
the authors of most of the terminal emulators out there must have  
never even bothered to read the documentation for the terminals they  
claim to emulate...

James



From jraghul85 at hotmail.com  Thu Jun  2 06:47:41 2005
From: jraghul85 at hotmail.com (Raghul Jagan)
Date: Thu, 02 Jun 2005 18:17:41 +0530
Subject: [Twisted-Python] Twisted server connection loss with Mysql  
Message-ID: <BAY12-F65964BE8D92DAD1E3A216AD060@phx.gbl>

hi friends,

          I also tried using the "cp_reconnect=1" for my twisted server.The 
first time it works but  the same error ocurrs after that .Is there anyway 
to solve this problem? I also tried by changing the value "reconnect=True" 
in adbapi.py file,the same error occurs what will be my problem? My machine 
configuration is

Linux fedora  core3
mysqldb 1.2
python 2.3
twisted server 2.0.1
pyxml 0.8

Windows with the same . I am running twisted server in windows. Is there any 
thing available in python equivalent to adbapi in python.  please give me a 
solution for this?


regards
raghul

_________________________________________________________________
Cant have enough of SRK? http://server1.msn.co.in/sp05/iifa/ Help him bag 
the award.




From abe at fettig.net  Thu Jun  2 08:04:40 2005
From: abe at fettig.net (Abe Fettig)
Date: Thu, 02 Jun 2005 10:04:40 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>	<429E8EBF.2000501@fettig.net>
	<EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>
Message-ID: <429F11F8.4090803@fettig.net>

James Y Knight wrote:

> I know way too much about terminal programming, and can immediately 
> identify the problem as the use of "ESC E". Never ever use ESC E,  it's
> worthless. While I'm at it: never use ESC D, and really try not  to use
> ESC M either. They're all mostly unused and people who don't  care about
> correctness, only "working for unix termcap" don't bother  implementing
> them right. Use instead \r\n, \n, and ESC[A (not quite  the same thing,
> as it doesn't do a backwards scroll, but if you think  backwards
> scrolling is going to work, I've got this bridge to sell  you...).

Thanks, it worked! I changed the nextLine() method of
insults.ServerProtocol to use \r\n:

class PatchedServerProtocol(insults.ServerProtocol):
    def nextLine(self):
        self.cursorPos.x = 0
        self.cursorPos.y = min(self.cursorPos.y + 1, self.termSize.y - 1)
        self.transport.write('\r\n') # this is the only change

Is this something that should be fixed in insults? I can submit a patch
to the bug tracker.

> Anyhow, could you say which horribly broken terminal program you're 
> using? I like to keep track of these things. From what I can tell,  the
> authors of most of the terminal emulators out there must have  never
> even bothered to read the documentation for the terminals they  claim to
> emulate...

gnome-terminal 2.10

Thanks!

Abe



From itamar at itamarst.org  Thu Jun  2 08:59:53 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 02 Jun 2005 10:59:53 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <429F11F8.4090803@fettig.net>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>
	<429E8EBF.2000501@fettig.net>
	<EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>
	<429F11F8.4090803@fettig.net>
Message-ID: <1117724393.8250.24.camel@localhost.localdomain>

On Thu, 2005-06-02 at 10:04 -0400, Abe Fettig wrote:

> Thanks, it worked! I changed the nextLine() method of
> insults.ServerProtocol to use \r\n:
> 
> class PatchedServerProtocol(insults.ServerProtocol):
>     def nextLine(self):
>         self.cursorPos.x = 0
>         self.cursorPos.y = min(self.cursorPos.y + 1, self.termSize.y - 1)
>         self.transport.write('\r\n') # this is the only change
> 
> Is this something that should be fixed in insults? I can submit a patch
> to the bug tracker.

It sounds like it should be fixed, yes.





From bgranger at scu.edu  Thu Jun  2 10:37:09 2005
From: bgranger at scu.edu (Brian Granger)
Date: Thu, 02 Jun 2005 09:37:09 -0700
Subject: [Twisted-Python] Stopping and restarting the reactor
In-Reply-To: <D79C963C-37FA-4682-99A1-A1A0D1D12DE0@redivi.com>
References: <0691b0c3fe8435554c486474bb599d3b@scu.edu>
	<D79C963C-37FA-4682-99A1-A1A0D1D12DE0@redivi.com>
Message-ID: <b9555b6c36c18401dd74a38fc377dddf@scu.edu>

On Jun 1, 2005, at 4:25 PM, Bob Ippolito wrote:

>
> On Jun 1, 2005, at 3:58 PM, Brian Granger wrote:
>
>> I am using twisted's client capabilities in an interactive setting.   
>> To allow for interactive work, I have wrapped all my calls to  
>> connectTCP with a class that starts the reactor when a new set of  
>> connectTCP calls is made.  I stop the reactor in the  
>> clientConnectionLost method of my ClientFactory (when there are no  
>> more connections).
>>
>> The first time I initiate a connectTCP call in my wrapper class  
>> everything works as expected:  the reactor is started, twisted does  
>> its stuff, and the ClientFactory stops the reactor (giving me back  
>> interactive controll).  BUT, if I the initiate another connectTCP  
>> call, the reactor starts, but then I get a User Timeout error showing  
>> up.  That is, the second time, no connection is made.  My  
>> ClientFactory again stops the reactor (this time in  
>> clientConnectionFailed), but then python hangs.
>>
>> My question:  is the reactor designed to be started/stopped/restarted  
>> in a single session?  If so, are there any considerations that I am  
>> missing?  Why doesn't the connection get made the second time?
>
> No, it's not.  You should start the reactor at the beginning of your  
> app, and stop it when your app is going to quit.  That's it.
>

Ahh, that would explain the off behavior I see.


> threadedselectreactor  
> <http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- 
> event-loops/> is probably more appropriate for what you're trying to  
> do.
>

Fantastic!  I will have a look at this.

> -bob
>
>




From foom at fuhm.net  Thu Jun  2 10:48:13 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 2 Jun 2005 12:48:13 -0400
Subject: [Twisted-Python] Using twisted.conch.recvline
In-Reply-To: <429F11F8.4090803@fettig.net>
References: <20050601212407.559.1305585479.divmod.quotient.14158@ohm>	<429E8EBF.2000501@fettig.net>
	<EB4F5BDA-5357-48DC-94F1-C8E7536810D3@fuhm.net>
	<429F11F8.4090803@fettig.net>
Message-ID: <302FD2F5-BC1C-48A6-9D4C-BBF5DBB085D4@fuhm.net>

On Jun 2, 2005, at 10:04 AM, Abe Fettig wrote:
> gnome-terminal 2.10

Yeah, that's already on my "standards-ignoring completely worthless  
piece of crap" list. I suggest konsole, it seems to actually work  
right. I use it in gnome, myself.

James



From jraghul85 at hotmail.com  Thu Jun  2 10:54:43 2005
From: jraghul85 at hotmail.com (Raghul J)
Date: Thu, 02 Jun 2005 22:24:43 +0530
Subject: [Twisted-Python] Twisted server connection loss with Mysql
Message-ID: <BAY12-F16A65CB0835BE68FBBC849AD060@phx.gbl>

Hi Friends,

         My friend gave me a solution for the twisted server to

reconnect mysql.This was opening a database connection,excecuting a

query and closing the database connection.This works some what fine

with my application. I need to confirm that If this is ok and can be

deployed in live machine. Some people say that these won't be much

suitable and efficient.I also tried by putting cp_reconnect=1 but it didn't 
work. My code is

def excutequery:
	dbpool = adbapi.Connectionpool("db",host,passwd,cp_noisy=1)
	dbpool.connect()
	result = dbpool.runInteraction(......)
	dbpool.close()
	return result


I call this function in my program. This code is working fine but the

only thing I want to confirm is that whether it is stable and has a

good performance.Is there some other way to do this?

	I am eagerly waiting for this result,So as to deploy it in my

site.

Thanks in advance
raghul

_________________________________________________________________
Buy, sell or bid for anything! http://pages.ebay.in/msnindia/auctions.html 
Try MSN Auctions now!




From foom at fuhm.net  Thu Jun  2 12:20:27 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 2 Jun 2005 14:20:27 -0400
Subject: [Twisted-Python] Twisted server connection loss with Mysql  
In-Reply-To: <BAY12-F65964BE8D92DAD1E3A216AD060@phx.gbl>
References: <BAY12-F65964BE8D92DAD1E3A216AD060@phx.gbl>
Message-ID: <056E50A3-19A1-4BA4-B0FA-17DFB388DB50@fuhm.net>


On Jun 2, 2005, at 8:47 AM, Raghul Jagan wrote:
>          I also tried using the "cp_reconnect=1" for my twisted  
> server.The first time it works but  the same error ocurrs after  
> that .Is there anyway to solve this problem? I also tried by  
> changing the value "reconnect=True" in adbapi.py file,the same  
> error occurs what will be my problem? My machine configuration is

The expected behavior of cp_reconnect is not to retry the query  
automatically if it fails, because doing so could have undefined  
consequences. Really, it probably could retry when the error was on  
the query, not on the commit, but it doesn't currently.

If you have a connection pool size of 10, expect to see 10 queries  
fail before everything's working perfectly again, as each thread  
notices its connection has died (after failing to make the query) and  
closes it. In your app, you can either catch ConnectionLost errors  
and retry the queries yourself or live with 10 queries failing after  
restarting the database.

James



From maoy at cis.upenn.edu  Thu Jun  2 13:17:24 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Thu, 2 Jun 2005 15:17:24 -0400 (EDT)
Subject: [Twisted-Python] twisted profiling help
Message-ID: <Pine.LNX.4.61.0506021513270.4943@forty-thieves.cis.upenn.edu>

Part of my profiling result of a high speed transfer test is attached.
What might that <string>:1(connect_ex) be? I only created 2 or 3 TCP 
connections, but there are 24655 calls.

Thanks!

Yun


          608904 function calls (608583 primitive calls) in 52.314 CPU 
seconds

    Ordered by: standard name

    ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     24655    1.144    0.000    1.144    0.000 <string>:1(connect_ex)
     39185    1.247    0.000    3.853    0.000 abstract.py:159(write)
     39189    0.365    0.000    2.432    0.000 
abstract.py:239(startWriting)
      2447    0.026    0.000    0.107    0.000 
abstract.py:292(resumeProducing)
      2459    0.018    0.000    0.141    0.000 
abstract.py:296(pauseProducing)
      2459    1.496    0.001    5.195    0.002 abstract.py:88(doWrite)
     39210    5.207    0.000    5.785    0.000 base.py:432(callLater)
     39210    0.578    0.000    0.578    0.000 base.py:45(__init__)
     39181    0.223    0.000    0.223    0.000 
base.py:464(_cancelCallLater)
      9880    0.266    0.000    0.367    0.000 
base.py:482(_insertNewDelayedCalls)
      4940    0.094    0.000    0.129    0.000 base.py:491(timeout)
     39181    0.535    0.000    0.758    0.000 base.py:63(cancel)
      4927    0.134    0.000   37.772    0.008 
context.py:26(callWithContext)
     39176    3.473    0.000   12.772    0.000 expect.py:97(writeStruct)
     39177    5.446    0.000    5.446    0.000 myutil.py:34(dumps)
     39174    1.678    0.000   22.154    0.001 protocol.py:37(write)
     39175    1.164    0.000    7.706    0.000 
protocol.py:96(scheduleAliveMsg)
     39189    2.067    0.000    2.067    0.000 
selectreactor.py:156(addWriter)
      4940   12.490    0.003   51.625    0.010 
selectreactor.py:82(doSelect)
     39174    0.156    0.000    0.156    0.000 sndrcv.py:110(preWrite)
      2450    4.290    0.002   27.357    0.011 sndrcv.py:116(write)
      2450    0.743    0.000    0.743    0.000 sndrcv.py:389(addData)
      2459    0.033    0.000    0.174    0.000 sndrcv.py:83(pauseProducing)
      2447    0.021    0.000    0.128    0.000 
sndrcv.py:88(resumeProducing)
      2465    3.371    0.001   32.239    0.013 tcp.py:334(doRead)
      2459    3.406    0.001    3.406    0.001 tcp.py:353(writeSomeData)




From abe at fettig.net  Thu Jun  2 13:39:32 2005
From: abe at fettig.net (Abe Fettig)
Date: Thu, 02 Jun 2005 15:39:32 -0400
Subject: [Twisted-Python] twisted.mail.imap4.MessageSet object & imap4
	server example
In-Reply-To: <cd329af80505310849313e0b0b@mail.gmail.com>
References: <cd329af80505310849313e0b0b@mail.gmail.com>
Message-ID: <429F6074.3040109@fettig.net>

Sebastjan Trepca wrote:
> Hi!
> 
> 1. I don't understand how to use this object. When the fetch method is
> called, this object is passed containing the requested messages which
> you then return, right? But is there any easy way to just iterate
> through it and get the requested UIDis, even if LAST is not set.

MessageSet is iterable; you can say "for uid in MessageSet: doStuff()".
You have to set MessageSet.last yourself though if it wasn't specified
by the client; set it to the value of the last uid (or sequence ID)
available.

if not messageSet.last: messageSet.last = self.getUIDNext()-1

will probably do the trick.

> 2. Where could I find some IMAP4 server examples? 

You can look at the Hep IMAP server code here:

http://svn.yarnproject.org/websvn/filedetails.php?repname=hep&path=%2Fhep%2Fservices%2Fimap.py&rev=0&sc=0

It might be a little hard to understand as it's using the Hep server and
Yarn to translate between IMAP and other protocols, but hopefully you'll
find it helpful.

Abe



From carolinaardohain at gmail.com  Thu Jun  2 14:06:14 2005
From: carolinaardohain at gmail.com (Carolina Ardohain)
Date: Thu, 2 Jun 2005 17:06:14 -0300
Subject: [Twisted-Python] PyPgSQL not locking in adbapi
In-Reply-To: <8ecf09605060115233566a329@mail.gmail.com>
References: <8ecf09605060112276542c9c2@mail.gmail.com>
	<20050601210522.559.1924981987.divmod.quotient.14148@ohm>
	<8ecf09605060115233566a329@mail.gmail.com>
Message-ID: <8ecf096050602130677fa4a32@mail.gmail.com>

After the upgrade to postgres 8 the problems is gone (maybe a bug in
7.4?), thanks for your time.



From foom at fuhm.net  Thu Jun  2 14:57:21 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 2 Jun 2005 16:57:21 -0400
Subject: [Twisted-Python] twisted profiling help
In-Reply-To: <Pine.LNX.4.61.0506021513270.4943@forty-thieves.cis.upenn.edu>
References: <Pine.LNX.4.61.0506021513270.4943@forty-thieves.cis.upenn.edu>
Message-ID: <C76E2A5A-2AE1-4AE1-BE6D-F269C4F80755@fuhm.net>


On Jun 2, 2005, at 3:17 PM, Yun Mao wrote:

> Part of my profiling result of a high speed transfer test is attached.
> What might that <string>:1(connect_ex) be? I only created 2 or 3  
> TCP connections, but there are 24655 calls.

<string>:1(connect_ex) is part of the utterly stupid wrapper object  
that python has in socket.py around the real _socket module. Either  
you have a client that has tried to connect 24655 times, or the  
profiler is lying to you.

James




From maoy at cis.upenn.edu  Thu Jun  2 15:11:27 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Thu, 2 Jun 2005 17:11:27 -0400 (EDT)
Subject: [Twisted-Python] twisted profiling help
In-Reply-To: <C76E2A5A-2AE1-4AE1-BE6D-F269C4F80755@fuhm.net>
References: <Pine.LNX.4.61.0506021513270.4943@forty-thieves.cis.upenn.edu>
	<C76E2A5A-2AE1-4AE1-BE6D-F269C4F80755@fuhm.net>
Message-ID: <Pine.LNX.4.61.0506021705200.5476@forty-thieves.cis.upenn.edu>


On Thu, 2 Jun 2005, James Y Knight wrote:

>
> On Jun 2, 2005, at 3:17 PM, Yun Mao wrote:
>
>> Part of my profiling result of a high speed transfer test is attached.
>> What might that <string>:1(connect_ex) be? I only created 2 or 3 TCP 
>> connections, but there are 24655 calls.
>
> <string>:1(connect_ex) is part of the utterly stupid wrapper object that 
> python has in socket.py around the real _socket module. Either you have a 
> client that has tried to connect 24655 times, or the profiler is lying to 
> you.

If I had a client doing that, I should have had connectTCP or other 
similar methods called 24655 times (or close) too, right?

Yun



From glyph at divmod.com  Thu Jun  2 16:11:10 2005
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 2 Jun 2005 18:11:10 -0400
Subject: [Twisted-Python] twisted profiling help
In-Reply-To: <Pine.LNX.4.61.0506021705200.5476@forty-thieves.cis.upenn.edu>
Message-ID: <20050602221110.31075.1066341140.divmod.quotient.28@ohm>



On Thu, 2 Jun 2005 17:11:27 -0400 (EDT), Yun Mao <maoy at cis.upenn.edu> wrote:
>
>On Thu, 2 Jun 2005, James Y Knight wrote:
>>
>>On Jun 2, 2005, at 3:17 PM, Yun Mao wrote:
>>>Part of my profiling result of a high speed transfer test is attached.
>>>What might that <string>:1(connect_ex) be? I only created 2 or 3 TCP 
>>>connections, but there are 24655 calls.
>>
>><string>:1(connect_ex) is part of the utterly stupid wrapper object that 
>>python has in socket.py around the real _socket module. Either you have a 
>>client that has tried to connect 24655 times, or the profiler is lying to 
>>you.
>
>If I had a client doing that, I should have had connectTCP or other similar 
>methods called 24655 times (or close) too, right?

Do not underestimate the probability that the profiler is lying: Python's dev tools (profiler, debugger, etc) are all pretty buggy.

However, it is also possible that connect() is busy but the FD is showing up as readable anyway, and thus for some absurd number of mainloop iterations (until it ACTUALLY completes and is therefore finished connecting) the reactor runs .connect().

Is this on Windows by any chance?



From maoy at cis.upenn.edu  Thu Jun  2 18:43:01 2005
From: maoy at cis.upenn.edu (Yun Mao)
Date: Thu, 2 Jun 2005 20:43:01 -0400 (EDT)
Subject: [Twisted-Python] twisted profiling help
In-Reply-To: <20050602221110.31075.1066341140.divmod.quotient.28@ohm>
References: <20050602221110.31075.1066341140.divmod.quotient.28@ohm>
Message-ID: <Pine.LNX.4.61.0506022042490.5476@forty-thieves.cis.upenn.edu>

>
> However, it is also possible that connect() is busy but the FD is showing up 
> as readable anyway, and thus for some absurd number of mainloop iterations 
> (until it ACTUALLY completes and is therefore finished connecting) the 
> reactor runs .connect().
>
> Is this on Windows by any chance?
>
It's linux.

Yun




From dave at krondo.com  Thu Jun  2 19:54:12 2005
From: dave at krondo.com (Dave Peticolas)
Date: Thu, 02 Jun 2005 18:54:12 -0700
Subject: [Twisted-Python] Twisted server connection loss with Mysql
In-Reply-To: <056E50A3-19A1-4BA4-B0FA-17DFB388DB50@fuhm.net>
References: <BAY12-F65964BE8D92DAD1E3A216AD060@phx.gbl>
	<056E50A3-19A1-4BA4-B0FA-17DFB388DB50@fuhm.net>
Message-ID: <1117763652.5811.11.camel@oneiros>

On Thu, 2005-06-02 at 14:20 -0400, James Y Knight wrote:
> On Jun 2, 2005, at 8:47 AM, Raghul Jagan wrote:
> >          I also tried using the "cp_reconnect=1" for my twisted  
> > server.The first time it works but  the same error ocurrs after  
> > that .Is there anyway to solve this problem? I also tried by  
> > changing the value "reconnect=True" in adbapi.py file,the same  
> > error occurs what will be my problem? My machine configuration is
> 
> The expected behavior of cp_reconnect is not to retry the query  
> automatically if it fails, because doing so could have undefined  
> consequences. Really, it probably could retry when the error was on  
> the query, not on the commit, but it doesn't currently.
> 
> If you have a connection pool size of 10, expect to see 10 queries  
> fail before everything's working perfectly again, as each thread  
> notices its connection has died (after failing to make the query) and  
> closes it. In your app, you can either catch ConnectionLost errors  
> and retry the queries yourself or live with 10 queries failing after  
> restarting the database.

Unfortunately, mysqldb doesn't throw an exception when you call
cursor() on a closed connection so the exception doesn't happen
until the query itself. Adding an option to adbapi to retry queries
on a failed connection shouldn't be too hard, I'll add that to the
tracker.

dave





From tv at twistedmatrix.com  Thu Jun  2 06:34:51 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu, 02 Jun 2005 15:34:51 +0300
Subject: [Twisted-Python] Status update on 2.0 debian packages
Message-ID: <429EFCEB.6090907@twistedmatrix.com>

Hi. Just to let everyone know, twisted 2.0 debs have been uploaded to
Debian experimental. As there are a lot of changes from 1.3, they
will require manual approval from Debian ftpmasters first.

This is 2.0 (+ related lower-versioned projects), not 2.0.1.
Hopefully I will have time for the version update sometime later.

And just the to be very very clear: 2.0 will never be in sarge.
2.0 will be in unstable _after_ sarge releases.




From james at delx.cjb.net  Fri Jun  3 18:36:51 2005
From: james at delx.cjb.net (James Bunton)
Date: Sat, 4 Jun 2005 10:36:51 +1000
Subject: [Twisted-Python] epoll reactor
In-Reply-To: <190bf2c1de5b2f4cb4217a682317c261@delx.cjb.net>
References: <20050524134807.559.1535540660.divmod.quotient.8568@ohm>
	<98310e0a7ff4b2b883d9afa5eaf4305d@delx.cjb.net>
	<20050525135656.GL26269@frobozz>
	<190bf2c1de5b2f4cb4217a682317c261@delx.cjb.net>
Message-ID: <fbad00235c69fe8945fd785e7f4e3eb0@delx.cjb.net>

On 26/05/2005, at 6:11 AM, James Bunton wrote:

>
> On 25/05/2005, at 11:56 PM, Andrew Bennetts wrote:
>
>> On Wed, May 25, 2005 at 11:30:52PM +1000, James Bunton wrote:
>> [...]
>>> The buildbot page didn't seem to say what tests were actually run, 
>>> only
>>> the warnings that occurred.
>>
>> The buildbot page does give the full test output in the "log" links, 
>> as well
>> as the full test.log file in the "test.log" links.  The "problems" and
>> "warnings" links are filtered versions of the "log" output.
>>
>> -Andrew.
>
> I thought they were all the same link :)
> Thanks
>
> ---
>
> James

What's the correct behaviour for a reactor if it has addReader/Writer 
called with an invalid file descriptor?

---

James




From itamar at itamarst.org  Sat Jun  4 08:10:56 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sat, 04 Jun 2005 10:10:56 -0400
Subject: [Twisted-Python] Re: [Twisted-commits] r13917 - Branching to
	native-gtk2-timers.
In-Reply-To: <E1DeSYv-0000gr-00@wolfwood>
References: <E1DeSYv-0000gr-00@wolfwood>
Message-ID: <1117894256.8230.31.camel@localhost.localdomain>

On Sat, 2005-06-04 at 00:55 -0600, Glyph Lefkowitz wrote:
> Author: glyph
> Date: Sat Jun  4 00:55:16 2005
> New Revision: 13917
> 
> Added:
>    branches/glyph/native-gtk2-timers/
>       - copied from r13916, trunk/
> Log:
> Branching to native-gtk2-timers.


I wouldn't bother. I tried this, and it's actually slower - the glib
event loop does an O(n) traversal of all timers on each iteration(!).




From vkshtkedag at chem-center.com  Sat Jun  4 19:25:40 2005
From: vkshtkedag at chem-center.com (vkshtkedag)
Date: Sun, 05 Jun 2005 01:25:40 -0000
Subject: [Twisted-Python] Diamond Equities
Message-ID: <0wPCPCp20w9F0864AnGT@chem-center.com>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050605/49dd55c9/attachment.html>

From alanjern at gmail.com  Sat Jun  4 21:47:07 2005
From: alanjern at gmail.com (Alan Jern)
Date: Sat, 4 Jun 2005 20:47:07 -0700
Subject: [Twisted-Python] Difficulty with twisted.web.client.getPage function
Message-ID: <579b3d800506042047690f9d8d@mail.gmail.com>

Hey, I'm new to Twisted and I've run into a problem that I can't solve.

I'm trying to write a simple Resource class that fetches a page from a
specified URL and returns it to the browser. I created a class called
MyResource in a .rpy file with the following two member functions:

def print_page (self, html):
        self.rq.write(html)
        self.rq.finish()

def render_GET (self, request):
        self.rq = request
        target = escape(request.args['target'][0])
        getPage(target).addCallback(self.print_page)
        return server.NOT_DONE_YET

When I run this script and send a request, the print_page function is
invoked but the variable 'html' has nothing in it. According to the
API and the examples I saw on the HOWTO section, this looks like it
ought to work. Clearly I'm missing something.

Any help would be greatly appreciated.

- Alan Jern



From Henning.Ramm at mediapro-gmbh.de  Sun Jun  5 14:49:49 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Sun, 5 Jun 2005 22:49:49 +0200
Subject: [Twisted-Python] wxreactor: dead close button
Message-ID: <F92274058556DE42B94B148EEFB9183949E701@exchange-03.suedkurier.de>

Hello, especially Itamar!

Consider the following minimal example:

import wx
from twisted.internet import wxreactor
wxreactor.install()
from twisted.internet import reactor

class Main(wx.App):

    def __init__(self):
        wx.App.__init__(self, redirect=False)
        reactor.registerWxApp(self)
        self.frame = wx.Frame(None, wx.ID_ANY, 'Test')
        self.frame.Show(True)

main = Main()
reactor.run()


At least on my system (WinXP, Py 2.3, wxPy 2.6.1, Twisted 2.0.1) the default close button of the window does nothing; same with your wxdemo.py; minimize/maximize works. Is there perhaps a bug in the destructor or event handler of wxreactor? Is there a simple workaround?


Best regards,
Henning Hraban Ramm
Sdkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From itamar at itamarst.org  Tue Jun  7 13:46:27 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 07 Jun 2005 15:46:27 -0400
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <F92274058556DE42B94B148EEFB9183949E701@exchange-03.suedkurier.de>
References: <F92274058556DE42B94B148EEFB9183949E701@exchange-03.suedkurier.de>
Message-ID: <1118173587.8527.51.camel@localhost.localdomain>

On Sun, 2005-06-05 at 22:49 +0200, Henning.Ramm at mediapro-gmbh.de wrote:

> At least on my system (WinXP, Py 2.3, wxPy 2.6.1, Twisted 2.0.1) the
> default close button of the window does nothing; same with your
> wxdemo.py; minimize/maximize works. Is there perhaps a bug in the
> destructor or event handler of wxreactor? Is there a simple
> workaround?

You probably need to hook up reactor.stop() to the event (callback?)
generated by the close button.




From dmitry at athabascau.ca  Tue Jun  7 13:47:31 2005
From: dmitry at athabascau.ca (Dmitry S. Makovey)
Date: Tue, 07 Jun 2005 13:47:31 -0600
Subject: [Twisted-Python] User manipulation question....
Message-ID: <200506071347.34679.dmitry@athabascau.ca>


Hi, 
First of all I'm using akadav1 which is library/application built on 
top of Twisted thus I post my question here.
I'm trying to make "akadav1" work "the way I like" and I face problem: 
I want akadav1 server to write out Files with permissions of 
currently connected user. Meaning that I'd like to run server as some 
regular user (say 'akadav') and when it operates on files do 
setuid(<currentl_user>) before any operation so it behaves same way 
as normal operation on FS would for that user. I came down to 
Resource class and see it possibly could be done extending this 
class. 
My problem right now is that I can't run server as unprivileged user 
and switch to other user's accounts. That would mean that I'd 
probably need:
1. run server as privileged user so I can setuid(...) any time I want
or
2. run two threads or so so that one thread is superuser-owned and the 
other one (the one that responds to requests) is non-privileged. 
First one will handle file operations since it can change uid 
on-the-flight and come back to normal.

I would prefer to implement second solution but I'm puzzled on where 
to start. Does twisted provide such capabilities out-of-the-box?

I'm not subscribed to the list, so please CC me on reply. 

-- 
Dmitry Makovey
Web Systems Administrator
Athabasca University
(780) 675-6245
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050607/22631cb2/attachment.sig>

From foom at fuhm.net  Tue Jun  7 14:13:07 2005
From: foom at fuhm.net (James Y Knight)
Date: Tue, 7 Jun 2005 16:13:07 -0400
Subject: [Twisted-Python] User manipulation question....
In-Reply-To: <200506071347.34679.dmitry@athabascau.ca>
References: <200506071347.34679.dmitry@athabascau.ca>
Message-ID: <72303662-0C1B-45F4-AAFC-13F095C0BD23@fuhm.net>


On Jun 7, 2005, at 3:47 PM, Dmitry S. Makovey wrote:
> 1. run server as privileged user so I can setuid(...) any time I want
> or
> 2. run two threads or so so that one thread is superuser-owned and the
> other one (the one that responds to requests) is non-privileged.
> First one will handle file operations since it can change uid
> on-the-flight and come back to normal.

I assume by "thread" you mean "process", because threads in a single  
process can't have different owners.

> I would prefer to implement second solution but I'm puzzled on where
> to start. Does twisted provide such capabilities out-of-the-box?

Nope. The way I'd implement it is by having the unprivileged server  
execute a setuid-root binary which handles the file operations on  
behalf of a user. That binary should verify the user authentication  
data the unprivileged server sends it, and then setuid from root to  
the end-user uid, and then perform the requested operations.

James



From Henning.Ramm at mediapro-gmbh.de  Tue Jun  7 14:24:03 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Tue, 7 Jun 2005 22:24:03 +0200
Subject: [Twisted-Python] wxreactor: dead close button
Message-ID: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>

>> At least on my system (WinXP, Py 2.3, wxPy 2.6.1, Twisted 2.0.1) the
>> default close button of the window does nothing; same with your
>> wxdemo.py; minimize/maximize works. Is there perhaps a bug in the
>> destructor or event handler of wxreactor? Is there a simple
>> workaround?
>
>You probably need to hook up reactor.stop() to the event (callback?)
>generated by the close button.

It should generate wx.EVT_CLOSE, but it never fires. (I use the same OnExit function with a menu entry/event, and there it works.)
Without Twisted, no own handler is needed. But the wxreactor doesn't seem to block anything...

Are here any wxPython users around who managed to re-enable the close button?


Best regards,
Henning Hraban Ramm
Sdkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From bob at redivi.com  Tue Jun  7 17:41:48 2005
From: bob at redivi.com (Bob Ippolito)
Date: Tue, 7 Jun 2005 16:41:48 -0700
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>
References: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>
Message-ID: <7EB969BF-F2DF-4B2C-9BA9-CC1C7772CD8A@redivi.com>


On Jun 7, 2005, at 1:24 PM, <Henning.Ramm at mediapro-gmbh.de>  
<Henning.Ramm at mediapro-gmbh.de> wrote:

>>> At least on my system (WinXP, Py 2.3, wxPy 2.6.1, Twisted 2.0.1) the
>>> default close button of the window does nothing; same with your
>>> wxdemo.py; minimize/maximize works. Is there perhaps a bug in the
>>> destructor or event handler of wxreactor? Is there a simple
>>> workaround?
>>>
>>
>> You probably need to hook up reactor.stop() to the event (callback?)
>> generated by the close button.
>>
>
> It should generate wx.EVT_CLOSE, but it never fires. (I use the  
> same OnExit function with a menu entry/event, and there it works.)
> Without Twisted, no own handler is needed. But the wxreactor  
> doesn't seem to block anything...
>
> Are here any wxPython users around who managed to re-enable the  
> close button?

Why not just use the threadedselectreactor?

<http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- 
event-loops/>

-bob




From glyph at divmod.com  Tue Jun  7 19:34:26 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 07 Jun 2005 21:34:26 -0400
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <7EB969BF-F2DF-4B2C-9BA9-CC1C7772CD8A@redivi.com>
References: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>
	<7EB969BF-F2DF-4B2C-9BA9-CC1C7772CD8A@redivi.com>
Message-ID: <42A64B22.9090701@divmod.com>

Bob Ippolito wrote:

> Why not just use the threadedselectreactor?
> 
> <http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- 
> event-loops/>

Mary, perhaps the docs should start referring to this for the next minor 
release?  Can you start bothering someone to update the reactor 
selection documentation?  (Or has it been already?)



From exarkun at divmod.com  Tue Jun  7 20:14:22 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 7 Jun 2005 22:14:22 -0400
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <42A64B22.9090701@divmod.com>
Message-ID: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>

On Tue, 07 Jun 2005 21:34:26 -0400, Glyph Lefkowitz <glyph at divmod.com> wrote:
>Bob Ippolito wrote:
>>Why not just use the threadedselectreactor?
>>
>><http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- event- 
>>loops/>
>
>Mary, perhaps the docs should start referring to this for the next minor 
>release?  Can you start bothering someone to update the reactor selection 
>documentation?  (Or has it been already?)
>

Shining wonder though it may be, threaded select reactor is still missing some niceties - for example, unit tests.  It would be nice to have both documentation and tests before encouraging (well, any more than has been done) the world that tsr is the greatest thing since sliced bread.

There is also the matter of threaded non-select reactors.  What do I do if I want poll?  (The answer right now is "write threaded poll reactor" which is fine if _I_ am asking the question, but less than ideal from most people's perspective).

Jp



From bob at redivi.com  Tue Jun  7 20:46:14 2005
From: bob at redivi.com (Bob Ippolito)
Date: Tue, 7 Jun 2005 19:46:14 -0700
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>
References: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>
Message-ID: <344BA278-AADB-4D11-817A-2DDA2CD7A904@redivi.com>


On Jun 7, 2005, at 7:14 PM, Jp Calderone wrote:

> On Tue, 07 Jun 2005 21:34:26 -0400, Glyph Lefkowitz  
> <glyph at divmod.com> wrote:
>
>> Bob Ippolito wrote:
>>
>>> Why not just use the threadedselectreactor?
>>>
>>> <http://bob.pythonmac.org/archives/2005/04/17/twisted-and- 
>>> foreign- event- loops/>
>>>
>>
>> Mary, perhaps the docs should start referring to this for the next  
>> minor release?  Can you start bothering someone to update the  
>> reactor selection documentation?  (Or has it been already?)
>>
>>
>
> Shining wonder though it may be, threaded select reactor is still  
> missing some niceties - for example, unit tests.  It would be nice  
> to have both documentation and tests before encouraging (well, any  
> more than has been done) the world that tsr is the greatest thing  
> since sliced bread.

It's not the greatest thing since sliced bread, but it sucks a lot  
less than the other reactors which also aren't tested very well..  
since it's just a very small fork of the extremely stable, default,  
select reactor.

> There is also the matter of threaded non-select reactors.  What do  
> I do if I want poll?  (The answer right now is "write threaded poll  
> reactor" which is fine if _I_ am asking the question, but less than  
> ideal from most people's perspective).

The real answer is to extend the reactor interface so that all  
reactors can support the interleave API, and put the logic that deals  
with the threads somewhere else.. e.g. twisted.internet.interleave 
(reactor, function).

-bob




From nopa90 at gmail.com  Tue Jun  7 21:41:16 2005
From: nopa90 at gmail.com (John Janecek)
Date: Wed, 8 Jun 2005 11:41:16 +0800
Subject: [Twisted-Python] Getting rid of boiler plate in pb.RemoteCache
In-Reply-To: <mailman.3204.1118164709.458.twisted-python@twistedmatrix.com>
References: <mailman.3204.1118164709.458.twisted-python@twistedmatrix.com>
Message-ID: <6e2418ba05060720414705a027@mail.gmail.com>

Shows how to make it so MasterClass which inherit off DuckPond
And then show how to get method from Duck Pond into SlaveClass without
writing boiler plate code.
http://john.thetrotter.net/twistedpb.html

Not a perfect example but it works



From glyph at divmod.com  Tue Jun  7 23:11:14 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Wed, 08 Jun 2005 01:11:14 -0400
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>
References: <20050608021422.15830.817423393.divmod.quotient.2610@ohm>
Message-ID: <42A67DF2.4000102@divmod.com>

Jp Calderone wrote:

> Shining wonder though it may be, threaded select reactor is still 
> missing some niceties - for example, unit tests.  It would be nice to 
> have both documentation and tests before encouraging (well, any more 
> than has been done) the world that tsr is the greatest thing since 
> sliced bread.

Saying it's the greatest thing since wxsupport.py is considerably less 
of a ringing endorsement :).  It should also have more tests, but then, 
what in Twisted shouldn't?  I'm just saying it needs docs.

> There is also the matter of threaded non-select reactors.  What do I do 
> if I want poll?  (The answer right now is "write threaded poll reactor" 
> which is fine if _I_ am asking the question, but less than ideal from 
> most people's perspective).

There is no reason to abandon existing _working_ reactors - for example, 
I have a soft spot for gtk2reactor.  Still, I think it makes sense to 
abandon the ones we know are broken and have no serious plan to fix, 
like wx (and maybe qt, from looking at the buildbot?).  Also it makes 
sense to have some least-common-denominator for working with really 
weird event loops, like the event loop one might find on a handheld 
device, such as fltk or the neutrino gui...  (I have never actually 
worked with either of those, they're just examples)



From mary-twisted at puzzling.org  Tue Jun  7 23:18:12 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 8 Jun 2005 15:18:12 +1000
Subject: [Twisted-Python] wxreactor: dead close button
In-Reply-To: <42A64B22.9090701@divmod.com>
References: <F92274058556DE42B94B148EEFB9183949E705@exchange-03.suedkurier.de>
	<7EB969BF-F2DF-4B2C-9BA9-CC1C7772CD8A@redivi.com>
	<42A64B22.9090701@divmod.com>
Message-ID: <20050608051812.GA31130@fuchsia.puzzling.org>

On Tue, Jun 07, 2005, Glyph Lefkowitz wrote:
> Mary, perhaps the docs should start referring to this for the next minor 
> release?  Can you start bothering someone to update the reactor 
> selection documentation?  (Or has it been already?)

I'm not aware of it being done. I'll try to schedule some bugging people
time. http://twistedmatrix.com/bugs/issue1077

-Mary



From girloncrack at yahoo.com  Wed Jun  8 01:29:25 2005
From: girloncrack at yahoo.com (Andrea Soong)
Date: Wed, 8 Jun 2005 00:29:25 -0700 (PDT)
Subject: [Twisted-Python] Need help getting started
Message-ID: <20050608072926.3460.qmail@web54101.mail.yahoo.com>

Hello, 
 
I'm taking a class in which we're supposed to be implementing a pseudo-proxy server that does some text parsing on web pages before passing them back to the client.  The proxy is supposed to be accessed via the URL and port that the server is running on, using an .rpy file.
 
I've looked through all of the available Twisted documentation, but just can't seem to get a handle on how to get started.  It's mostly setup questions - what code should go in which files?  How do I run it?  How do I test it?  There are a lot of code examples available, but very little information on how they interact and call each other.  It doesn't help that I am not too familiar with the OO-style API documentation.
 
I know that I need to be creating a subclass of HTTPClient, and creating a resource in the .rpy file.  I'm guessing that the .rpy file should create an instance of the HTTPClient subclass and use it to retrieve the requested URL (we have to get it line by line), but I don't understand how to create the instance.
 
A single good example that creates a web proxy server which simply retrieves the data line by line and displays it to the screen, plus the shell commands needed to run/test would be extremely helpful.  I am completely confused as to how the web server and .rpy file would interact.
 
I hope someone has the time and know-how to help me out.
THANKS


__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050608/c930586b/attachment.html>

From nick at javacat.f2s.com  Wed Jun  8 01:51:05 2005
From: nick at javacat.f2s.com (nick at javacat.f2s.com)
Date: Wed,  8 Jun 2005 08:51:05 +0100
Subject: [Twisted-Python] Need help getting started
In-Reply-To: <20050608072926.3460.qmail@web54101.mail.yahoo.com>
References: <20050608072926.3460.qmail@web54101.mail.yahoo.com>
Message-ID: <1118217065.42a6a36981fb5@webmail.freedom2surf.net>

Have a look here for some examples -

http://xhaus.com/alan/python/proxies.html

Quoting Andrea Soong <girloncrack at yahoo.com>:

> Hello,
>
> I'm taking a class in which we're supposed to be implementing a pseudo-proxy
> server that does some text parsing on web pages before passing them back to
> the client.  The proxy is supposed to be accessed via the URL and port that
> the server is running on, using an .rpy file.
>
> I've looked through all of the available Twisted documentation, but just
> can't seem to get a handle on how to get started.  It's mostly setup
> questions - what code should go in which files?  How do I run it?  How do I
> test it?  There are a lot of code examples available, but very little
> information on how they interact and call each other.  It doesn't help that I
> am not too familiar with the OO-style API documentation.
>
> I know that I need to be creating a subclass of HTTPClient, and creating a
> resource in the .rpy file.  I'm guessing that the .rpy file should create an
> instance of the HTTPClient subclass and use it to retrieve the requested URL
> (we have to get it line by line), but I don't understand how to create the
> instance.
>
> A single good example that creates a web proxy server which simply retrieves
> the data line by line and displays it to the screen, plus the shell commands
> needed to run/test would be extremely helpful.  I am completely confused as
> to how the web server and .rpy file would interact.
>
> I hope someone has the time and know-how to help me out.
> THANKS
>
>
> __________________________________________________
> Do You Yahoo!?
> Tired of spam?  Yahoo! Mail has the best spam protection around
> http://mail.yahoo.com






From sc at linux.it  Wed Jun  8 04:03:58 2005
From: sc at linux.it (Stefano Canepa)
Date: Wed, 08 Jun 2005 12:03:58 +0200
Subject: [Twisted-Python] problem understand how to use a new created
	protocol
Message-ID: <1118225038.19110.31.camel@localhost.localdomain>

Dear all,
	I have a problem in understanding how to use the little protocol I have
written. First of all a little explanation of the protocol that is name
HL7. HL7 is based on simple messages that can be sent using serival
lines or network. To use HL7 over a network the application needs to use
HL7 LLP (Lower Level Protocol). LLP specification states that every
communicating part needs to have a client and a server. The server
(named accepting module) needs to receive a messagge and reply with an
ACK or NACK based on the syntax of the message. The client (named
initiating module) sends message and waits for ACK or NACK or timeouts.

Following the howto and reading all documents I was able to find on the
web, I coded the HL7 LLP accepting and initiating modules. 
Now my problem is: how can I pass the message to the application using
my LLP protocol? 
For example: the accepting module protocol is based on
basic.lineReceiver, it process the line and sends the appropriate reply.
Do I need to write a class in the application derived from my
HL7LLPAcceptingProtocol that process the message? 

I am really sorry to bother all of you with this sort of questions that
should sound stupid to you but I am really a newbie to twisted and need
some help.

TIA
Stefano

-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt di un programmatore: pigrizia, impazienza e arroganza.
                                                              (Larry Wall)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20050608/6793e1ac/attachment.sig>

From Henning.Ramm at mediapro-gmbh.de  Wed Jun  8 06:46:36 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Wed, 8 Jun 2005 14:46:36 +0200
Subject: [Twisted-Python] wxreactor: dead close button
Message-ID: <F92274058556DE42B94B148EEFB9183949E706@exchange-03.suedkurier.de>

>Why not just use the threadedselectreactor?
><http://bob.pythonmac.org/archives/2005/04/17/twisted-and-foreign- 
>event-loops/>

Because it's only in the svn; but I found it, and it works now, thank you!
(I.e. my shutdown handlers don't work as they should, but I'll hopefully be able to fix that myself.)

BTW I adapted your wxdemo.py from "import *" to "import wx" style, see attachment.


Best regards,
Henning Hraban Ramm
Sdkurier Medienhaus / MediaPro
Support/Admin/Development Dept.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: wxdemo.py
Type: application/octet-stream
Size: 1378 bytes
Desc: wxdemo.py
URL: </pipermail/twisted-python/attachments/20050608/70a7e030/attachment-0002.obj>

From dmitry at athabascau.ca  Wed Jun  8 08:22:29 2005
From: dmitry at athabascau.ca (Dmitry S. Makovey)
Date: Wed, 08 Jun 2005 08:22:29 -0600
Subject: [Twisted-Python] User manipulation question....
In-Reply-To: <72303662-0C1B-45F4-AAFC-13F095C0BD23@fuhm.net>
References: <200506071347.34679.dmitry@athabascau.ca>
	<72303662-0C1B-45F4-AAFC-13F095C0BD23@fuhm.net>
Message-ID: <200506080822.33032.dmitry@athabascau.ca>

On June 7, 2005 02:13 pm, James Y Knight wrote:
> On Jun 7, 2005, at 3:47 PM, Dmitry S. Makovey wrote:
> > 1. run server as privileged user so I can setuid(...) any time I
> > want or
> > 2. run two threads or so so that one thread is superuser-owned
> > and the other one (the one that responds to requests) is
> > non-privileged. First one will handle file operations since it
> > can change uid on-the-flight and come back to normal.
>
> I assume by "thread" you mean "process", because threads in a
> single process can't have different owners.

yes. sorry for confusion.

> > I would prefer to implement second solution but I'm puzzled on
> > where to start. Does twisted provide such capabilities
> > out-of-the-box?
>
> Nope. The way I'd implement it is by having the unprivileged server
> execute a setuid-root binary which handles the file operations on
> behalf of a user. That binary should verify the user authentication
> data the unprivileged server sends it, and then setuid from root to
> the end-user uid, and then perform the requested operations.

I thought about it, but I'm sort of hesitant because it involves extra 
execs etc. which might reflect on performance. But so far that's the 
only simple options I have. Other one would be to do fork early in 
main program and detach from main process leaving pipes for 
communication etc. but then I've got another bottleneck - file 
operations. 

Thanks for idea I'll definitely give it a try I only wish that I could 
do it "less expensive way" :)

-- 
Dmitry Makovey
Web Systems Administrator
Athabasca University
(780) 675-6245

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050608/bcce06ff/attachment.sig>

From ww at groovy.net  Wed Jun  8 08:46:03 2005
From: ww at groovy.net (William Waites)
Date: Wed, 8 Jun 2005 10:46:03 -0400
Subject: [Twisted-Python] User manipulation question....
In-Reply-To: <200506071347.34679.dmitry@athabascau.ca>
References: <200506071347.34679.dmitry@athabascau.ca>
Message-ID: <20050608144603.GR8097@groovy.net>

On Tue, Jun 07, 2005 at 01:47:31PM -0600, Dmitry S. Makovey wrote:
>
> My problem right now is that I can't run server as unprivileged user 
> and switch to other user's accounts. That would mean that I'd 
> probably need:
> 1. run server as privileged user so I can setuid(...) any time I want

Not the best idea, of course.

> 2. run two threads or so so that one thread is superuser-owned and the 
> other one (the one that responds to requests) is non-privileged. 
> First one will handle file operations since it can change uid 
> on-the-flight and come back to normal.
> 
> I would prefer to implement second solution but I'm puzzled on where 
> to start. Does twisted provide such capabilities out-of-the-box?

I'm reasonably sure it doesn't. You can't have threads in a single
process owned by different users. What you would have to do is
run different processes.

The only way I can think of right now, after only one coffee, 
is to have one twisted process that sits on the port
and waits for connections. When it gets one, it authenticates the
user then sends a message (pb maybe) to a superuser-owned process
whose only job is to fork(2) a user-owned process for file io
and to inform it how to talk with the original process that is 
holding the port... It would remain to write the file io <--> pb
glue I think...

Cheers,
-w



From ian at ianduggan.net  Wed Jun  8 10:27:33 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Wed, 8 Jun 2005 09:27:33 -0700
Subject: [Twisted-Python] -shutdown taps
Message-ID: <200506080927.33419.ian@ianduggan.net>


Does anyone have an init scripts for working with twistd and -shutdown 
scripts? I just tested out the shutdown persistence stuff with my daemon and 
it's very cool! My in-process requests don't die when I restart. Nice job.

I was hoping someone would have some shutdown/startup logic that handled 
possible error states, else I'm going to start working on one now.

--Ian



From itamar at itamarst.org  Wed Jun  8 11:19:25 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Wed, 08 Jun 2005 13:19:25 -0400
Subject: [Twisted-Python] -shutdown taps
In-Reply-To: <200506080927.33419.ian@ianduggan.net>
References: <200506080927.33419.ian@ianduggan.net>
Message-ID: <1118251165.9035.31.camel@localhost.localdomain>

On Wed, 2005-06-08 at 09:27 -0700, Ian Duggan wrote:
> Does anyone have an init scripts for working with twistd and -shutdown 
> scripts? I just tested out the shutdown persistence stuff with my daemon and 
> it's very cool! My in-process requests don't die when I restart. Nice job.

You probably shouldn't depend on this feature for persistence of data
that you care about, it's too fragile a storage mechanism.




From ian at ianduggan.net  Wed Jun  8 11:48:28 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Wed, 8 Jun 2005 10:48:28 -0700
Subject: [Twisted-Python] -shutdown taps
In-Reply-To: <1118251165.9035.31.camel@localhost.localdomain>
References: <200506080927.33419.ian@ianduggan.net>
	<1118251165.9035.31.camel@localhost.localdomain>
Message-ID: <200506081048.28903.ian@ianduggan.net>


On Wednesday 08 June 2005 10:19, Itamar Shtull-Trauring wrote:
> You probably shouldn't depend on this feature for persistence of data
> that you care about, it's too fragile a storage mechanism.

Yeah? My daemon keeps a small amount of state for "in process" requests 
related to long running background processes. I was hoping to have the daemon 
save the hash it was using, and restart the processes where they were when it 
restarted.

What about this method makes it fragile? I guess that's what I was hoping to 
code into a more robust state. It's a cool feature, IMHO, to have automagical 
daemon persistence.

--Ian



From ross at sourcelabs.com  Thu Jun  9 16:45:35 2005
From: ross at sourcelabs.com (Ross Jekel)
Date: Thu, 09 Jun 2005 15:45:35 -0700
Subject: [Twisted-Python] Any Message Queue recommendations
Message-ID: <1118357135.9683.12.camel@linux.site>

I'm writing several service processes that unfortunately need to
integrate with Java, PHP, and potentially C/C++ programs (non-legacy).
I've been searching for a message queuing layer that would support
Python/C++/PHP and Java clients (JMS is not necessarily a requirement). 

Short of writing my own messaging layer with twisted :-), I looked at
xmlBlaster which integrates well with all the languages but its complex
configuration makes it less that ideal to use. 

If anyone has any recommendations, could you please let me know.
Distributed message queuing combined with twisted services makes an good
combination. If there isn't anything better, I'll keep trying to make
xmlBlaster work and I'll contribute my twisted/xmlBlaster integration
when it is polished and solid.

Thanks,
Ross




From micktwomey at gmail.com  Thu Jun  9 16:56:27 2005
From: micktwomey at gmail.com (Michael Twomey)
Date: Thu, 9 Jun 2005 23:56:27 +0100
Subject: [Twisted-Python] -shutdown taps
In-Reply-To: <200506081048.28903.ian@ianduggan.net>
References: <200506080927.33419.ian@ianduggan.net>
	<1118251165.9035.31.camel@localhost.localdomain>
	<200506081048.28903.ian@ianduggan.net>
Message-ID: <50a522ca05060915564410af98@mail.gmail.com>

Hi,

The biggest thing which will kill the data is running the original tap
again, not the -shutdown one. Running the original tap will overwrite
the old shutdown one with a fresh instance. Since this can happen
easily (e.g. at critical oh-my-god-the-server-is-broken moments), you
really can't rely on the data being there. It's good for caching or
anything you don't mind losing, but you have to use conditional logic
in your startup script to figure out which tap to start with.

After experimenting with it and losing my data repeatedly I just wrote
the data I was interested in to a pickle. Since you have the
stopService hook in services, you can whack the persistence stuff in
there.

cheers,
  mick

On 6/8/05, Ian Duggan <ian at ianduggan.net> wrote:
> Yeah? My daemon keeps a small amount of state for "in process" requests
> related to long running background processes. I was hoping to have the daemon
> save the hash it was using, and restart the processes where they were when it
> restarted.
> 
> What about this method makes it fragile? I guess that's what I was hoping to
> code into a more robust state. It's a cool feature, IMHO, to have automagical
> daemon persistence.
> 
> --Ian
>



From bv at bnl.gov  Thu Jun  9 17:41:52 2005
From: bv at bnl.gov (Brett Viren)
Date: Thu, 09 Jun 2005 19:41:52 -0400
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <1118357135.9683.12.camel@linux.site> (Ross Jekel's message of
	"Thu, 09 Jun 2005 15:45:35 -0700")
References: <1118357135.9683.12.camel@linux.site>
Message-ID: <ir4zmtzayin.fsf@minos.phy.bnl.gov>

Hi Ross,

Ross Jekel <ross at sourcelabs.com> writes:

> I'm writing several service processes that unfortunately need to
> integrate with Java, PHP, and potentially C/C++ programs (non-legacy).
> I've been searching for a message queuing layer that would support
> Python/C++/PHP and Java clients (JMS is not necessarily a requirement). 

This sounds a lot like what I asked recently regarding a network
distributed system for producing and consuming "alarms" (basically
just your "messages").

Consider this:

 - XML-RPC for communications.  XML-RPC implementations exist in all
 your target languages.  Twisted has addition support beyond the
 built-in Python XML-RPC.

 - Write a central proxy server speaking XML-RPC, (implemented in
 Twisted, of course!).  Every message comes through this proxy.

 - Message producers do simple XML-RPC query/response (method call) to
 send a message to the central proxy server.

 - Then, depending on how you want your message consumers to behave
 you can either:

  a) have them poll the server.  This can work in two ways.  Either
  the proxy returns any messages collected since some time, or you can
  have the query block until a message returns.  Or a mixture of both.

  b) have consumers register with the proxy and provide a callback
  XML-RPC url, the consumers then go into listen mode and the proxy
  pushes messages as they come in.

Option (a) is good because your consumers can be behind a firewall.
It's not so good as it introduces latency and makes the proxy more
complex as it must handle the buffering of messages.

Option (b) is simpler and introduces less latency between message
production and consumption but does require your consumers to be able
to listen on a port and receive incoming connections.  If there is a
firewall between the consumers and the proxy or if your local network
overlords don't like programs listening on ports this won't do.

You probably want to also allow for message levels and/or classes so
consumers can pick and choose what they receive.

And, if you go this route be sure to post your work so I can steal it
for my project!

Regards,
-Brett.



From ross at sourcelabs.com  Thu Jun  9 20:24:14 2005
From: ross at sourcelabs.com (Ross Jekel)
Date: Thu, 09 Jun 2005 19:24:14 -0700
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <ir4zmtzayin.fsf@minos.phy.bnl.gov>
References: <1118357135.9683.12.camel@linux.site>
	<ir4zmtzayin.fsf@minos.phy.bnl.gov>
Message-ID: <42A8F9CE.1080709@sourcelabs.com>

Thanks Brett. Pretty much everything you describe is supposed to be in 
xmlBlaster using the xmlrpc interface. I can give you the start of a 
class that helps access xmlBlaster asynchronously if you want to check 
it out. At this point since I'd just be reinventing xmlBlaster, I'll 
spend a couple of days trying to get the queues working the way I want. 
I basically need the messages to be delivered once and only one to the 
subscriber.  Even if the subscriber was disconnected for a while and 
reconnects later I want the historical messages to be delivered once. 
This isn't rocket science, so I'm surprised it isn't available.

Brett Viren wrote:

>Hi Ross,
>
>Ross Jekel <ross at sourcelabs.com> writes:
>
>  
>
>>I'm writing several service processes that unfortunately need to
>>integrate with Java, PHP, and potentially C/C++ programs (non-legacy).
>>I've been searching for a message queuing layer that would support
>>Python/C++/PHP and Java clients (JMS is not necessarily a requirement). 
>>    
>>
>
>This sounds a lot like what I asked recently regarding a network
>distributed system for producing and consuming "alarms" (basically
>just your "messages").
>
>Consider this:
>
> - XML-RPC for communications.  XML-RPC implementations exist in all
> your target languages.  Twisted has addition support beyond the
> built-in Python XML-RPC.
>
> - Write a central proxy server speaking XML-RPC, (implemented in
> Twisted, of course!).  Every message comes through this proxy.
>
> - Message producers do simple XML-RPC query/response (method call) to
> send a message to the central proxy server.
>
> - Then, depending on how you want your message consumers to behave
> you can either:
>
>  a) have them poll the server.  This can work in two ways.  Either
>  the proxy returns any messages collected since some time, or you can
>  have the query block until a message returns.  Or a mixture of both.
>
>  b) have consumers register with the proxy and provide a callback
>  XML-RPC url, the consumers then go into listen mode and the proxy
>  pushes messages as they come in.
>
>Option (a) is good because your consumers can be behind a firewall.
>It's not so good as it introduces latency and makes the proxy more
>complex as it must handle the buffering of messages.
>
>Option (b) is simpler and introduces less latency between message
>production and consumption but does require your consumers to be able
>to listen on a port and receive incoming connections.  If there is a
>firewall between the consumers and the proxy or if your local network
>overlords don't like programs listening on ports this won't do.
>
>You probably want to also allow for message levels and/or classes so
>consumers can pick and choose what they receive.
>
>And, if you go this route be sure to post your work so I can steal it
>for my project!
>
>Regards,
>-Brett.
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>  
>





From nkeric at gmail.com  Thu Jun  9 21:19:30 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Fri, 10 Jun 2005 11:19:30 +0800
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on the
	same port?
Message-ID: <43c0d2b505060920193a8958ff@mail.gmail.com>

Hi all!

I'm trying to write a server which listens on port 12345 for both TLS
and normal TCP connections:

The client first connects to the server:12345 over TLS to obtain a
one-time share secret;
then the client closes(?) the TLS connection and uses the share secret
to communicate with the server:12345 over *normal TCP*.

Could this be done? If it could, pls enlighten me with some sample
code, BIG thanks!

- Eric



From golux at comcast.net  Thu Jun  9 22:11:10 2005
From: golux at comcast.net (Stephen Waterbury)
Date: Fri, 10 Jun 2005 00:11:10 -0400
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <43c0d2b505060920193a8958ff@mail.gmail.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
Message-ID: <42A912DE.30507@comcast.net>

Okay, enuffa this protocol mumbo-jumbo -- let's get
back to the really important shit.  Does anyone have a
32x32 twisted logo?  I have a larger one that I could
shrink down, but I *am* lazy, so if anybody has one let
me know!  (I mean with the image like the 16x16 used on
on the web site, not the *big* twisted logo.  If nobody
has one, I'll just make a 32x32 out of the 16x16.)

Cheers,
Steve



From bv at bnl.gov  Thu Jun  9 22:38:32 2005
From: bv at bnl.gov (Brett Viren)
Date: Fri, 10 Jun 2005 00:38:32 -0400
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <42A8F9CE.1080709@sourcelabs.com> (Ross Jekel's message of
	"Thu, 09 Jun 2005 19:24:14 -0700")
References: <1118357135.9683.12.camel@linux.site>
	<ir4zmtzayin.fsf@minos.phy.bnl.gov> <42A8F9CE.1080709@sourcelabs.com>
Message-ID: <ir4ll5ibzcn.fsf@minos.phy.bnl.gov>

Ross Jekel <ross at sourcelabs.com> writes:

> Thanks Brett. Pretty much everything you describe is supposed to be in
> xmlBlaster using the xmlrpc interface.

Indeed.  I should have looked up xmlBlaster before replying.  I didn't
realize what it was.  It looks pretty cool and just what I need as
well.  As the page says:

  This is the publish/subscribe middleware server you have needed many
  times before, now available for free to glue together your
  distributed client/server application.

Only minor downer is that it isn't written in Python....


It even has some kind of authentication which we will probably end up
requiring.  I've been thinking about how to bolt on an SSH port
forwarding based authentication to my scheme.  That may still be worth
pursuing as my environment tends to let SSH through firewalls.

>  I can give you the start of a
> class that helps access xmlBlaster asynchronously if you want to check
> it out.

Yes, that would be great, thanks.

-Brett.



From daedalus at eigenmagic.com  Thu Jun  9 23:06:57 2005
From: daedalus at eigenmagic.com (Justin Warren)
Date: Fri, 10 Jun 2005 15:06:57 +1000
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on
	the same port?
In-Reply-To: <43c0d2b505060920193a8958ff@mail.gmail.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
Message-ID: <1118380017.2672.27.camel@norbert>

On Fri, 2005-06-10 at 11:19 +0800, Eric Hsu wrote:
> Hi all!
> 
> I'm trying to write a server which listens on port 12345 for both TLS
> and normal TCP connections:
> 
> The client first connects to the server:12345 over TLS to obtain a
> one-time share secret;
> then the client closes(?) the TLS connection and uses the share secret
> to communicate with the server:12345 over *normal TCP*.
> 
> Could this be done? If it could, pls enlighten me with some sample
> code, BIG thanks!

That sounds a bit.. odd. TLS runs over the top of some sort of reliable
transport protocol, like TCP. A server would thus be listening for TCP
connections. What you do after the connection is accepted determines
whether you negotiate TLS, echo stuff back or do whatever else your
server does. If you've already negotiated a TLS connection and thus have
a secure communications channel, why would you want to turn it off and
go back to normal, unencrypted comms?

What is the problem you are trying to solve here?

I mean, in theory, yes, you could do what you're proposing. Why do you
want to, though?

-- 
Justin Warren <daedalus at eigenmagic.com>




From nkeric at gmail.com  Fri Jun 10 02:14:06 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Fri, 10 Jun 2005 16:14:06 +0800
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on the
	same port?
In-Reply-To: <1118380017.2672.27.camel@norbert>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
Message-ID: <43c0d2b505061001147782b353@mail.gmail.com>

Hi Justin,

Thank you for you quick reply :)

> What is the problem you are trying to solve here?
> 
> I mean, in theory, yes, you could do what you're proposing. Why do you
> want to, though?

I'm trying to write a TURN server:

http://www.ietf.org/internet-drafts/draft-rosenberg-midcom-turn-07.txt

The TURN client which is behind a NAT will ask the TURN server (with
public address) to allocate a public transport address for it to
receive data from outside.

There're two requests while the client trying to allocate a public
transport address from the TURN server:
 * Share Secret Request: over TLS; to obtain a one-time username and
passwd and keep the passwd as the share secret of both side (the
server and the client)
 * Allocate Request: to allocate a public transport address from the server

As the draft said:

"A TURN server MUST be prepared to receive  Binding (should be
Allocate - eric) Requests over TCP and UDP." (P10)

"The Allocate Request MUST be sent to the same IP address and port as the Shared
Secret Request. This is because one time passwords are expected to be
host-specific." (P20)

That means both the Share Secret Request (over TLS) and Allocate
Request will be sent to the same IP and port of the server.

Then, the draft said:

"The client SHOULD close its connection when it has completed
allocating username and passwords." (P19)

So, while the client sends the Allocate Request to the server over
TCP, the process would look like this (assuming the server is
listening on port 12345 for TLS connection):

* the client sends the Share Secret Request to server:12345 _over TLS_
and obtains a one-time username and passwd
* the client closes the TLS connection
* the client sends the Allocate Request to server:12345 _again_ to
allocate a public transport address...

It seems that I have to implement what I've mentioned in my previous mail?
I'm not a native English speaker, and TURN is only a draft, maybe I've
misunderstood something?



From screwtape at froup.com  Fri Jun 10 05:51:25 2005
From: screwtape at froup.com (Tim Allen)
Date: Fri, 10 Jun 2005 21:51:25 +1000
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <42A912DE.30507@comcast.net>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<42A912DE.30507@comcast.net>
Message-ID: <0aa49a10d63396c4735af4e0fe15e4fe@froup.com>

On 10 Jun 2005, at 14:11, Stephen Waterbury wrote:
> Okay, enuffa this protocol mumbo-jumbo -- let's get
> back to the really important shit.

:D

> Does anyone have a
> 32x32 twisted logo?  I have a larger one that I could
> shrink down, but I *am* lazy, so if anybody has one let
> me know!

You mean a 32x32 version of the square-snake on the right-hand edge of 
this:

	http://twistedmatrix.com/images/header-logo.png

?

I could probably draw one up in GIMP pretty easily. Even easier if you 
don't mind right-angles instead of the sexy perspective look that 
sample image uses.




From npk.gangadhar at gmail.com  Fri Jun 10 09:06:59 2005
From: npk.gangadhar at gmail.com (Gangadhar NPK)
Date: Fri, 10 Jun 2005 20:36:59 +0530
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <1118357135.9683.12.camel@linux.site>
References: <1118357135.9683.12.camel@linux.site>
Message-ID: <61b4e70f05061008062755b3db@mail.gmail.com>

I don't know how much of a use and close to your requirement is, you
can check if the spread toolkit (http://spread.org) can be of any help
to you.


On 6/10/05, Ross Jekel <ross at sourcelabs.com> wrote:
> I'm writing several service processes that unfortunately need to
> integrate with Java, PHP, and potentially C/C++ programs (non-legacy).
> I've been searching for a message queuing layer that would support
> Python/C++/PHP and Java clients (JMS is not necessarily a requirement).
> 
> Short of writing my own messaging layer with twisted :-), I looked at
> xmlBlaster which integrates well with all the languages but its complex
> configuration makes it less that ideal to use.
> 
> If anyone has any recommendations, could you please let me know.
> Distributed message queuing combined with twisted services makes an good
> combination. If there isn't anything better, I'll keep trying to make
> xmlBlaster work and I'll contribute my twisted/xmlBlaster integration
> when it is polished and solid.
> 
> Thanks,
> Ross
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From golux at comcast.net  Fri Jun 10 09:53:28 2005
From: golux at comcast.net (Stephen Waterbury)
Date: Fri, 10 Jun 2005 11:53:28 -0400
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <0aa49a10d63396c4735af4e0fe15e4fe@froup.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>	<42A912DE.30507@comcast.net>
	<0aa49a10d63396c4735af4e0fe15e4fe@froup.com>
Message-ID: <42A9B778.50903@comcast.net>

Tim Allen wrote:
> You mean a 32x32 version of the square-snake on the right-hand edge of 
> this:
> 
>     http://twistedmatrix.com/images/header-logo.png
> 
> ?

Yep, and I guess you aroused my graphics lust enough (obsessiveness
trumps laziness every time ;) ... attached is a "smoothed" 32x32
version of the 16x16 logo that I did using kiconedit.  It's a
contribution, if anyone wants it.  Of course, if an official Twisted
32x32 is ever created, I'll happily to use that instead.  :)

- Steve
-------------- next part --------------
A non-text attachment was scrubbed...
Name: twisted32logo.png
Type: image/png
Size: 970 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050610/fb78d493/attachment-0002.png>

From ross at sourcelabs.com  Fri Jun 10 11:25:12 2005
From: ross at sourcelabs.com (Ross Jekel)
Date: Fri, 10 Jun 2005 10:25:12 -0700
Subject: [Twisted-Python] Any Message Queue recommendations
In-Reply-To: <61b4e70f05061008062755b3db@mail.gmail.com>
References: <1118357135.9683.12.camel@linux.site>
	<61b4e70f05061008062755b3db@mail.gmail.com>
Message-ID: <1118424312.6959.2.camel@linux.site>

Thank you. Yes, Spread might be another good option as it supports
Python, Java, Perl, and C/C++. I was also able to get a PHP client
example from Advanced PHP Programming book online.

http://www.samspublishing.com/bookstore/product.asp?
isbn=0672325616&rl=1#

I almost used Spread at a previous company when we were building a
cluster and we wanted total ordering of messages.

On Fri, 2005-06-10 at 20:36 +0530, Gangadhar NPK wrote:
> I don't know how much of a use and close to your requirement is, you
> can check if the spread toolkit (http://spread.org) can be of any help
> to you.
> 
> 





From dgray at omniti.com  Fri Jun 10 15:25:49 2005
From: dgray at omniti.com (Dave Gray)
Date: Fri, 10 Jun 2005 17:25:49 -0400
Subject: [Twisted-Python] Difficulty with twisted.web.client.getPage
	function
In-Reply-To: <579b3d800506042047690f9d8d@mail.gmail.com>
References: <579b3d800506042047690f9d8d@mail.gmail.com>
Message-ID: <42AA055D.6060701@omniti.com>

Alan Jern wrote:
> Hey, I'm new to Twisted and I've run into a problem that I can't solve.
> 
> I'm trying to write a simple Resource class that fetches a page from a
> specified URL and returns it to the browser. I created a class called
> MyResource in a .rpy file with the following two member functions:
> 
> def print_page (self, html):
>         self.rq.write(html)
>         self.rq.finish()
> 
> def render_GET (self, request):
>         self.rq = request
>         target = escape(request.args['target'][0])
>         getPage(target).addCallback(self.print_page)
>         return server.NOT_DONE_YET
> 
> When I run this script and send a request, the print_page function is
> invoked but the variable 'html' has nothing in it. According to the
> API and the examples I saw on the HOWTO section, this looks like it
> ought to work. Clearly I'm missing something.

You will probably get more enthusiastic responses to questions like this 
on twisted-web (cc'd), FYI

That said, this works for me:

---fetchpage.tac---
# run me with twistd -noy fetchpage.tac
from twisted.web import server
from twisted.web.resource import Resource
from twisted.web.client import getPage

from cgi import escape
class Foo(Resource):
     isLeaf=True
     def print_page (self, html):
         self.rq.write(html)
         self.rq.finish()

     def render_GET (self, request):
         self.rq = request
         target = escape(request.args['target'][0])
         getPage(target).addCallback(self.print_page)
         return server.NOT_DONE_YET

resource = Foo()
site = server.Site(resource)

from twisted.application import service, internet
application = service.Application("PageFetcher")
internet.TCPServer(9000, site).setServiceParent(application)

# and then from your command prompt:
 >  telnet localhost 9000
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
GET /?target=http://google.com/ HTTP/1.0
Host: localhost

HTTP/1.0 200 OK
Date: Fri, 10 Jun 2005 21:20:49 GMT
Content-type: text/html
Server: TwistedWeb/2.0.0

<html><head><meta http-equiv="content-type" content="text/html; 
charset=ISO-8859-1"><title>Google</title><style><!--
etc etc



From matt.feifarek at gmail.com  Fri Jun 10 16:43:13 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Fri, 10 Jun 2005 18:43:13 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
Message-ID: <6fb6dbfe05061015435de21846@mail.gmail.com>

Hello.

I'm using Twisted 1.3.0 on python2.4 on an Ubuntu-Hoary x86 Linux box.

I'm using twisted and spawnProcess() with a Queue structure to chain
processes that need to be called (specifically, imagemagick commands).
I use the "processEnded" event/method of t.i.p.ProcessProtocol to go
from one task to the next. Twisted shares a python process with a
multi-threaded web-app-kit (Webware) so it has to be run in a thread.

This worked well on other older versions of twisted and older versions
of python; also on linux. I've tracked down the problem to be twisted
itself (or my incorrect use of it) rather than my code. This example
illustrates it:

-------------------------------------------------
from twisted.internet import reactor
from twisted.internet.protocol import ProcessProtocol

class MyProt( ProcessProtocol ):
	def processEnded(self, reason):
		print "ended.", reason

executable = '/bin/touch'
args = ( '/tmp/foo.txt', )
args = (executable,) + tuple(args)

reactor.spawnProcess( MyProt(), executable, args )
reactor.callLater( 5, reactor.stop )

#reactor.run()
reactor.run(installSignalHandlers=False)
-------------------------------------------------

As is, this code never runs the "processEnded()" method of MyProt().
If I change the reactor.run() parameter to leave the signal handlers
on, it works.

Note that I need to leave the signal handlers turned off because I
can't run the reactor in the main thread; Webware needs that.

I also know that the subprocess is giving up its file descriptors; I
can see that if I put more print statements into MyProt(). And I know
that the subprocess is working; /tmp/foo.txt is there.

It seems that somehow the reactor is using signals to notice when a
process has ended; this makes a certain ammount of sense intuitively,
though I don't understand the nitty-gritty of processes and signals at
all. And more importantly, this has worked before on other
combinations of twisted/python.

Is this a bug? If so, has it been fixed? If not, what should I do to
detect when a spawned process is finished?

Thanks very much. Twisted rocks.



From glyph at divmod.com  Fri Jun 10 16:44:52 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Fri, 10 Jun 2005 18:44:52 -0400
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <42A9B778.50903@comcast.net>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>	<42A912DE.30507@comcast.net>	<0aa49a10d63396c4735af4e0fe15e4fe@froup.com>
	<42A9B778.50903@comcast.net>
Message-ID: <42AA17E4.3050408@divmod.com>

Stephen Waterbury wrote:

> Yep, and I guess you aroused my graphics lust enough (obsessiveness
> trumps laziness every time ;) ... attached is a "smoothed" 32x32
> version of the 16x16 logo that I did using kiconedit.  It's a
> contribution, if anyone wants it.  Of course, if an official Twisted
> 32x32 is ever created, I'll happily to use that instead.  :)

Thanks Steve - until further notice, I guess this is the "official" one :)



From ross at sourcelabs.com  Fri Jun 10 16:47:26 2005
From: ross at sourcelabs.com (Ross Jekel)
Date: Fri, 10 Jun 2005 15:47:26 -0700
Subject: [Twisted-Python] twistd stopService processing question
Message-ID: <1118443646.6958.15.camel@linux.site>

I am building and xmlBlaster XML-RPC client/server to interact with the
xmlBlaster server. xmlBlaster really works best if the client sends a
disconnect API call before shutting down, otherwise you sometimes won't
be able to reconnect the client until the next heartbeat timesout.

I thought the best place way to do this would be to create a simple
service that could get notified via stopService(), then return the
deferred from the xmlrpc.Proxy.callRemote function for the XML-RPC
xmlBlaster disconnect API call.

The issue is that if I do this, everything seems to work but I get this
error raised when I ^C my service:

2005/06/10 15:30 PDT [QueryProtocol,client] Traceback (most recent call
last):
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/defer.py", line
328, in _runCallbacks
            self.result = callback(self.result, *args, **kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/base.py", line
384, in _cbContinueSystemEvent
            self._continueSystemEvent(eventType)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/base.py", line
392, in _continueSystemEvent
            callable(*args, **kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/base.py", line
353, in disconnectAll
            failure.Failure(main.CONNECTION_LOST))
        --- <exception caught here> ---
          File
"/usr/local/lib/python2.4/site-packages/twisted/python/log.py", line 56,
in callWithLogger
            return callWithContext({"system": lp}, func, *args, **kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/python/log.py", line 41,
in callWithContext
            return context.call({ILogContext: newCtx}, func, *args,
**kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/python/context.py", line
52, in callWithContext
            return self.currentContext().callWithContext(ctx, func,
*args, **kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/python/context.py", line
31, in callWithContext
            return func(*args,**kw)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/tcp.py", line
557, in connectionLost
            self.connector.connectionLost(reason)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/base.py", line
655, in connectionLost
            self.factory.clientConnectionLost(self, reason)
          File
"/usr/local/lib/python2.4/site-packages/twisted/web/xmlrpc.py", line
294, in clientConnectionLost
            self.deferred.errback(reason)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/defer.py", line
276, in errback
            self._startRunCallbacks(fail)
          File
"/usr/local/lib/python2.4/site-packages/twisted/internet/defer.py", line
303, in _startRunCallbacks
            raise AlreadyCalledError
        twisted.internet.defer.AlreadyCalledError:

I suppose I can probably ignore this but it makes it look like my
service isn't shutting down cleanly.

Any advice here? I include code snippets below to give you an idea what
I'm doing.

Ross

class SimpleService(service.Service):
    def stopService(self):
        global blaster
        return blaster.disconnect().addCallback(
            lambda res: service.Service.stopService(self))


# Create the application
a = service.Application("SMTP Server")

# Create a service wrapper so we can get notified of stopService
SimpleService().setServiceParent(service.IServiceCollection(a))

# Create an XML-RPC client/server for xmlBlaster
# TODO - come up with better server site creation
print 'INFO; Creating XML-RPC client/server'
s = SimpleSite()
blaster = xmlBlaster.xmlBlaster('http://127.0.0.2:8080', s)
internet.TCPServer(blaster.serverPort,
  server.Site(s)).setServiceParent(a)


xmlBlaster looks like this:

class xmlBlaster(xmlrpc.Proxy, xmlrpc.XMLRPC):
    def __init__(self, url, parent, serverPort = 7080):
        xmlrpc.Proxy.__init__(self, url)
        xmlrpc.XMLRPC.__init__(self)
        self.orig_url = url
        self.sessionId = None
        self.serverPort = serverPort
        self.subscriptions = {}
        parent.putChild('RC2', self)

    def disconnect(self):
        return self.callRemote('authenticate.disconnect',
            self.sessionId,
            "<qos/>).addCallback(self.__cbDisconnected)

    def __cbDisconnected(self, result):
        self.sessionId = None





From itamar at itamarst.org  Fri Jun 10 17:35:48 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 10 Jun 2005 19:35:48 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe05061015435de21846@mail.gmail.com>
References: <6fb6dbfe05061015435de21846@mail.gmail.com>
Message-ID: <1118446548.8272.17.camel@localhost.localdomain>

> reactor.run(installSignalHandlers=False)
> -------------------------------------------------
> 
> As is, this code never runs the "processEnded()" method of MyProt().
> If I change the reactor.run() parameter to leave the signal handlers
> on, it works.
> 
> Note that I need to leave the signal handlers turned off because I
> can't run the reactor in the main thread; Webware needs that.

Register the same SIGCHLD handler twisted does in the main thread, that
should work (they need to be reentrancy-safe anyway so the fact it's
called from a different thread is fine). Possibly a more general
solution could be devised for this, anyone have suggestions?




From golux at comcast.net  Fri Jun 10 18:34:14 2005
From: golux at comcast.net (Stephen Waterbury)
Date: Fri, 10 Jun 2005 20:34:14 -0400
Subject: [Twisted-Python] 32x32 logo?
In-Reply-To: <42AA17E4.3050408@divmod.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>	<42A912DE.30507@comcast.net>	<0aa49a10d63396c4735af4e0fe15e4fe@froup.com>	<42A9B778.50903@comcast.net>
	<42AA17E4.3050408@divmod.com>
Message-ID: <42AA3186.30204@comcast.net>

Glyph Lefkowitz wrote:
> Stephen Waterbury wrote:
> 
>> Yep, and I guess you aroused my graphics lust enough (obsessiveness
>> trumps laziness every time ;) ... attached is a "smoothed" 32x32
>> version of the 16x16 logo that I did using kiconedit.  It's a
>> contribution, if anyone wants it.  Of course, if an official Twisted
>> 32x32 is ever created, I'll happily to use that instead.  :)
                          ^^^^^^^^^^^^^^^^^^^^^^^^
Oops ... Engrish!  :)

> Thanks Steve - until further notice, I guess this is the "official" one :)

Cool!  In that case, I'll happily to use mine.  ;)

Steve



From girloncrack at yahoo.com  Sat Jun 11 01:28:38 2005
From: girloncrack at yahoo.com (Andrea Soong)
Date: Sat, 11 Jun 2005 00:28:38 -0700 (PDT)
Subject: [Twisted-Python] Using lineReceived with HTTP requests
Message-ID: <20050611072838.57692.qmail@web54107.mail.yahoo.com>

Hi all,
 
First off, I'd like to say thanks to Ken Whitesell for giving me some much needed help.
 
Here's my problem:  I am using an HTTPClient instance to connect to a webpage, and am trying to retrieve its contents and display to the screen line by line, using the lineReceived method.  This is all being done in an .rpy file.  For some reason, I am only receiving the header information:
---------------------------------------------
[start line received]
       HTTP/1.0 200 OK
[end line received]
[start line received]
       Cache-Control: private
[end line received]
[start line received]
       Content-Type: text/html
[end line received]
[start line received]
       Set-Cookie: PREF=ID=aacd1eed2e435ca5:TM=1118474192:LM=1118474192:S=QyMnwhj46cXbhy_1; expires=Sun, 17-Jan-2038 19:14:07 GMT; path=/; domain=.google.com
[end line received]
[start line received]
       Server: GWS/2.1
[end line received]
[start line received]
       Date: Sat, 11 Jun 2005 07:16:32 GMT
[end line received]
[start line received]
       Connection: Close
[end line received]
[start line received]
       
[end line received]
---------------------------------------------
 
Does anyone know if there is some incompatibility in using lineReceived with the format of a webpage (i.e. maybe they are missing the standard EOL delimiters)?  dataReceived works fine and outputs the whole webpage at once.  
 
Also, I am using handleRequestEnd to detect the end of the transmission and call request.finish(),  but it does not seem to be getting called at all - the browser just keeps waiting for more data.  I've put a simple request.write("handleRequestEnd called") call on the first line of the method and it does not get written to the screen.  I can't find any explanation for how to use most of the methods in the HTTPClient class in the API - is there a better way to do this (i.e. one that works!) ?
 
 
Thanks,
Andrea


		
---------------------------------
Discover Yahoo!
 Have fun online with music videos, cool games, IM & more. Check it out!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050611/177451b5/attachment.html>

From girloncrack at yahoo.com  Sat Jun 11 01:38:17 2005
From: girloncrack at yahoo.com (Andrea Soong)
Date: Sat, 11 Jun 2005 00:38:17 -0700 (PDT)
Subject: [Twisted-Python] Using lineReceived with HTTP requests
In-Reply-To: <20050611072838.57692.qmail@web54107.mail.yahoo.com>
Message-ID: <20050611073817.19497.qmail@web54102.mail.yahoo.com>


This seems like it has something to do with my problem, although it doesn't offer any clues as to a solution:

"Unfortunately, handling arbitrary data chunks is a hard way to code a server. This is why twisted has many classes sitting in submodules of the twisted.protocols package which give higher level interface to the data. For line oriented protocols, LineReceiver translates the low-level dataReceived events into lineReceived events. However, the first naive implementation of LineReceiver proved to be too simple. Protocols like HTTP/1.1 or Freenet have packets which begin with header lines that include length information, and then byte streams. LineReceiver was rewritten to have a simple interface for switching at the protocol layer between line-oriented parts and byte-stream parts. "
(from http://www.python10.org/p10-papers/09/index.htm)

Andrea Soong <girloncrack at yahoo.com> wrote:Hi all,
 
First off, I'd like to say thanks to Ken Whitesell for giving me some much needed help.
 
Here's my problem:  I am using an HTTPClient instance to connect to a webpage, and am trying to retrieve its contents and display to the screen line by line, using the lineReceived method.  This is all being done in an .rpy file.  For some reason, I am only receiving the header information:
---------------------------------------------
[start line received]
       HTTP/1.0 200 OK
[end line received]
[start line received]
       Cache-Control: private
[end line received]
[start line received]
       Content-Type: text/html
[end line received]
[start line received]
       Set-Cookie: PREF=ID=aacd1eed2e435ca5:TM=1118474192:LM=1118474192:S=QyMnwhj46cXbhy_1; expires=Sun, 17-Jan-2038 19:14:07 GMT; path=/; domain=.google.com
[end line received]
[start line received]
       Server: GWS/2.1
[end line received]
[start line received]
       Date: Sat, 11 Jun 2005 07:16:32 GMT
[end line received]
[start line received]
       Connection: Close
[end line received]
[start line received]
       
[end line received]
---------------------------------------------
 
Does anyone know if there is some incompatibility in using lineReceived with the format of a webpage (i.e. maybe they are missing the standard EOL delimiters)?  dataReceived works fine and outputs the whole webpage at once.  
 
Also, I am using handleRequestEnd to detect the end of the transmission and call request.finish(),  but it does not seem to be getting called at all - the browser just keeps waiting for more data.  I've put a simple request.write("handleRequestEnd called") call on the first line of the method and it does not get written to the screen.  I can't find any explanation for how to use most of the methods in the HTTPClient class in the API - is there a better way to do this (i.e. one that works!) ?
 
 
Thanks,
Andrea



---------------------------------
Discover Yahoo!
Have fun online with music videos, cool games, IM & more. Check it out!_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


		
---------------------------------
Do you Yahoo!?
 Yahoo! Mail - Find what you need with new enhanced search. Learn more.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050611/34235645/attachment.html>

From exarkun at divmod.com  Sat Jun 11 09:04:53 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sat, 11 Jun 2005 11:04:53 -0400
Subject: [Twisted-Python] Using lineReceived with HTTP requests
In-Reply-To: <20050611072838.57692.qmail@web54107.mail.yahoo.com>
Message-ID: <20050611150453.5047.378421006.divmod.quotient.1011@ohm>

On Sat, 11 Jun 2005 00:28:38 -0700 (PDT), Andrea Soong <girloncrack at yahoo.com> wrote:
>Hi all,
>
>First off, I'd like to say thanks to Ken Whitesell for giving me some much needed help.
>
>Here's my problem:  I am using an HTTPClient instance to connect to a webpage, and am trying to retrieve its contents and display to the screen line by line, using the lineReceived method.  This is all being done in an .rpy file.  For some reason, I am only receiving the header information:

The header section of an HTTP response is line-oriented.  The body section is not.  HTTPClient uses both of LineReceivers modes, so for the header section, lineReceived gets called, then for the body section, rawDataReceived gets called.

If you override both of these, you should see all of the data from the server.  Of course, the data passed to rawDataReceive isn't going to be broken up into lines...

Jp



From matt.feifarek at gmail.com  Sat Jun 11 09:08:12 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Sat, 11 Jun 2005 11:08:12 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <1118446548.8272.17.camel@localhost.localdomain>
References: <6fb6dbfe05061015435de21846@mail.gmail.com>
	<1118446548.8272.17.camel@localhost.localdomain>
Message-ID: <6fb6dbfe050611080874419f5a@mail.gmail.com>

On 6/10/05, Itamar Shtull-Trauring <itamar at itamarst.org> wrote:
> Register the same SIGCHLD handler twisted does in the main thread, that
> should work (they need to be reentrancy-safe anyway so the fact it's
> called from a different thread is fine). Possibly a more general
> solution could be devised for this, anyone have suggestions?

Thanks.

So this behavior is by design? Again, it DID work before; for the last
year or so, I've been using this code in production on a few servers.

Perhaps a note could be made in the docs that ProcessProtocol doesn't
work in this case.

This will make it pretty hard to integrate into other worlds. I'm not
sure that I can over-ride the signal handling in Webware and register
handlers. Other bits of python libraries might be the same way.

I look forward to any "more general solution" that anyone can come up with!

Would the "twisted way" would be to run the reactor in a different
python process and talk to it via rpc? The problem, of course, is that
the best way to do that on the client end of the rpc is twisted, too!

Thanks again.



From exarkun at divmod.com  Sat Jun 11 09:35:37 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sat, 11 Jun 2005 11:35:37 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe050611080874419f5a@mail.gmail.com>
Message-ID: <20050611153537.5047.1641691101.divmod.quotient.1023@ohm>

On Sat, 11 Jun 2005 11:08:12 -0400, Matt Feifarek <matt.feifarek at gmail.com> wrote:
>On 6/10/05, Itamar Shtull-Trauring <itamar at itamarst.org> wrote:
>> Register the same SIGCHLD handler twisted does in the main thread, that
>> should work (they need to be reentrancy-safe anyway so the fact it's
>> called from a different thread is fine). Possibly a more general
>> solution could be devised for this, anyone have suggestions?
>
>Thanks.
>
>So this behavior is by design? Again, it DID work before; for the last
>year or so, I've been using this code in production on a few servers.

Yep, and always has been.  If it ever worked, it was by accident (I really don't see how it could have, though, so I can't begin to guess what might have changed to stop it).

>
>Perhaps a note could be made in the docs that ProcessProtocol doesn't
>work in this case.
>
>This will make it pretty hard to integrate into other worlds. I'm not
>sure that I can over-ride the signal handling in Webware and register
>handlers. Other bits of python libraries might be the same way.
>
>I look forward to any "more general solution" that anyone can come up with!

Here's one:

  def reapChildren():
      from twisted.internet import reactor, task
      t = task.LoopingCall(reactor._handleSigchld, None, None)
      return t.start(5)

Of course, it uses a non-public method of reactor (but installSignalHandlers is a non-public argument to reactor.run(), so you're already treading on thin ice :)

Jp



From foom at fuhm.net  Sat Jun 11 09:40:11 2005
From: foom at fuhm.net (James Y Knight)
Date: Sat, 11 Jun 2005 11:40:11 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe050611080874419f5a@mail.gmail.com>
References: <6fb6dbfe05061015435de21846@mail.gmail.com>
	<1118446548.8272.17.camel@localhost.localdomain>
	<6fb6dbfe050611080874419f5a@mail.gmail.com>
Message-ID: <F7509306-B75B-4CFC-891C-B0685ABB88B4@fuhm.net>


On Jun 11, 2005, at 11:08 AM, Matt Feifarek wrote:
> So this behavior is by design? Again, it DID work before; for the last
> year or so, I've been using this code in production on a few servers.
>
> Perhaps a note could be made in the docs that ProcessProtocol doesn't
> work in this case.

There is one. It logs "spawnProcess called, but the SIGCHLD handler  
is not installed. This probably means you have not yet called  
reactor.run, or called reactor.run(installSignalHandler=0). You will  
probably never see this process finish, and it may become a zombie  
process." However, your example doesn't have logging setup, so you  
don't see that message.

> This will make it pretty hard to integrate into other worlds. I'm not
> sure that I can over-ride the signal handling in Webware and register
> handlers. Other bits of python libraries might be the same way.
>
> I look forward to any "more general solution" that anyone can come  
> up with!

If you cannot override the signal handling, do something like:

from twisted.internet import task
task.LoopingCall(process.reapAllProcesses).start(1.0, now=False)

That's less efficient but will work. I have a vague recollection that  
in old versions twisted used to do this by default but I might just  
be making that up.

James



From matt.feifarek at gmail.com  Sat Jun 11 09:59:07 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Sat, 11 Jun 2005 11:59:07 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <20050611153537.5047.1641691101.divmod.quotient.1023@ohm>
References: <6fb6dbfe050611080874419f5a@mail.gmail.com>
	<20050611153537.5047.1641691101.divmod.quotient.1023@ohm>
Message-ID: <6fb6dbfe05061108594034b78f@mail.gmail.com>

On 6/11/05, Jp Calderone <exarkun at divmod.com> wrote:
> Of course, it uses a non-public method of reactor (but installSignalHandlers is a non-public argument to reactor.run(), so you're already treading on thin ice :)

Thanks.

I don't see how it's non-public. Twisted TELLS you to use it if you
run the reactor in a thread. That doesn't seem too secret to me.

But thanks for the suggestion.



From matt.feifarek at gmail.com  Sat Jun 11 10:00:37 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Sat, 11 Jun 2005 12:00:37 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <F7509306-B75B-4CFC-891C-B0685ABB88B4@fuhm.net>
References: <6fb6dbfe05061015435de21846@mail.gmail.com>
	<1118446548.8272.17.camel@localhost.localdomain>
	<6fb6dbfe050611080874419f5a@mail.gmail.com>
	<F7509306-B75B-4CFC-891C-B0685ABB88B4@fuhm.net>
Message-ID: <6fb6dbfe050611090025c3d0bc@mail.gmail.com>

Thanks, all, for the suggestions.

This is certainly enough to get me started.



From exarkun at divmod.com  Sat Jun 11 10:55:46 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sat, 11 Jun 2005 12:55:46 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe05061108594034b78f@mail.gmail.com>
Message-ID: <20050611165546.5047.1921872341.divmod.quotient.1054@ohm>

On Sat, 11 Jun 2005 11:59:07 -0400, Matt Feifarek <matt.feifarek at gmail.com> wrote:
>On 6/11/05, Jp Calderone <exarkun at divmod.com> wrote:
>> Of course, it uses a non-public method of reactor (but installSignalHandlers is a non-public argument to reactor.run(), so you're already treading on thin ice :)
>
>Thanks.
>
>I don't see how it's non-public. Twisted TELLS you to use it if you
>run the reactor in a thread. That doesn't seem too secret to me.

Where does it do that?

Jp



From Sl_Church at sbcglobal.net  Sun Jun 12 13:27:55 2005
From: Sl_Church at sbcglobal.net (Shawn Church)
Date: Sun, 12 Jun 2005 12:27:55 -0700
Subject: [Twisted-Python] Large blocks of data and Perspective Broker
Message-ID: <42AC8CBB.90903@sbcglobal.net>

Could someone please point me to an example of passing a large block of
data (>640k) via  Perspective Broker??? Specifically I want my PB server
to create and return  a PDF file in response to a remote method call. I
guess I can just break it up into blocks and pass it that way but it
seems there should be a better way.  I know I saw this somewhere but am
unable to locate the reference now.



Thanks,

Shawn



From girloncrack at yahoo.com  Sun Jun 12 16:59:47 2005
From: girloncrack at yahoo.com (Andrea Soong)
Date: Sun, 12 Jun 2005 15:59:47 -0700 (PDT)
Subject: [Twisted-Python] Using lineReceived with HTTP requests
In-Reply-To: <20050611150453.5047.378421006.divmod.quotient.1011@ohm>
Message-ID: <20050612225947.56376.qmail@web54108.mail.yahoo.com>

How will I know when the data for the webpage is complete?  Is handleRequestEnd supposed to be called when that happens, or is that called after *I* call request.finish()?

Jp Calderone <exarkun at divmod.com> wrote:On Sat, 11 Jun 2005 00:28:38 -0700 (PDT), Andrea Soong wrote:
>Hi all,
>
>First off, I'd like to say thanks to Ken Whitesell for giving me some much needed help.
>
>Here's my problem: I am using an HTTPClient instance to connect to a webpage, and am trying to retrieve its contents and display to the screen line by line, using the lineReceived method. This is all being done in an .rpy file. For some reason, I am only receiving the header information:

The header section of an HTTP response is line-oriented. The body section is not. HTTPClient uses both of LineReceivers modes, so for the header section, lineReceived gets called, then for the body section, rawDataReceived gets called.

If you override both of these, you should see all of the data from the server. Of course, the data passed to rawDataReceive isn't going to be broken up into lines...

Jp

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050612/7ba671dd/attachment.html>

From james at delx.cjb.net  Sun Jun 12 20:10:12 2005
From: james at delx.cjb.net (James Bunton)
Date: Mon, 13 Jun 2005 12:10:12 +1000
Subject: [Twisted-Python] Reactor given a dead FD
Message-ID: <6be0bdaf0daf7c240fa70d1ec7fc5920@delx.cjb.net>

Hi again all.

I asked this in the epoll thread a little while ago, but didn't get a 
response.
Does anybody know what is the correct behaviour for a Twisted reactor 
when addReader/Writer is called with a dead file descriptor?
Should I just silently ignore it and remove the FD from the selectables 
list?

---

James




From bob at redivi.com  Sun Jun 12 21:22:54 2005
From: bob at redivi.com (Bob Ippolito)
Date: Sun, 12 Jun 2005 23:22:54 -0400
Subject: [Twisted-Python] Reactor given a dead FD
In-Reply-To: <6be0bdaf0daf7c240fa70d1ec7fc5920@delx.cjb.net>
References: <6be0bdaf0daf7c240fa70d1ec7fc5920@delx.cjb.net>
Message-ID: <E2778C31-0DB2-4C5B-8491-9C34B3AF882B@redivi.com>

On Jun 12, 2005, at 10:10 PM, James Bunton wrote:

> I asked this in the epoll thread a little while ago, but didn't get  
> a response.
> Does anybody know what is the correct behaviour for a Twisted  
> reactor when addReader/Writer is called with a dead file descriptor?
> Should I just silently ignore it and remove the FD from the  
> selectables list?

I don't know if anyone knows for sure without trying it.. so you  
might as well try it yourself.  The correct behavior is probably  
whatever the select reactor does on Anything But Windows ;)

-bob




From james at delx.cjb.net  Mon Jun 13 02:12:37 2005
From: james at delx.cjb.net (James Bunton)
Date: Mon, 13 Jun 2005 18:12:37 +1000
Subject: [Twisted-Python] Reactor given a dead FD
In-Reply-To: <E2778C31-0DB2-4C5B-8491-9C34B3AF882B@redivi.com>
References: <6be0bdaf0daf7c240fa70d1ec7fc5920@delx.cjb.net>
	<E2778C31-0DB2-4C5B-8491-9C34B3AF882B@redivi.com>
Message-ID: <27e317d642de7d5ad85209303583504d@delx.cjb.net>

On 13/06/2005, at 1:22 PM, Bob Ippolito wrote:

> On Jun 12, 2005, at 10:10 PM, James Bunton wrote:
>
>> I asked this in the epoll thread a little while ago, but didn't get a 
>> response.
>> Does anybody know what is the correct behaviour for a Twisted reactor 
>> when addReader/Writer is called with a dead file descriptor?
>> Should I just silently ignore it and remove the FD from the 
>> selectables list?
>
> I don't know if anyone knows for sure without trying it.. so you might 
> as well try it yourself.  The correct behavior is probably whatever 
> the select reactor does on Anything But Windows ;)
>
> -bob

Looks like removing from the selectables list and logging it is the go 
then.
Thanks :)

---

James




From ed at greengraphics.net  Mon Jun 13 15:17:47 2005
From: ed at greengraphics.net (Ed Colmar)
Date: Mon, 13 Jun 2005 14:17:47 -0700
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
Message-ID: <42ADF7FB.5070707@greengraphics.net>

Greetings.

I stumbled upon the twisted framework while looking for OSCAR support 
for python. 

I have built a py-TOC AIM bot, that is working in most situations, but 
is unable to communicate with certain AIM accunts (specifically the ones 
inside the matrix online MMORPG). 

I am curious to know how unstable the OSCAR implementaion is, because I 
saw the warning at the top of the code.

I have been gettting the struct.error (in readSNAC) that it appears 
others have seen.  Is there a workaround for this?

Thanks, and I look forward to working with twisted

Cheers!

-ed




From james at delx.cjb.net  Mon Jun 13 18:03:56 2005
From: james at delx.cjb.net (James Bunton)
Date: Tue, 14 Jun 2005 10:03:56 +1000
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <42ADF7FB.5070707@greengraphics.net>
References: <42ADF7FB.5070707@greengraphics.net>
Message-ID: <1baf00e5d4378ba94953504a7e1c215d@delx.cjb.net>

You might want to contact Daniel, the developer of PyAIM-t
http://www.blathersource.org for the homepage.
He's been doing lots of development with the Oscar module, and you 
could likely use that version in your own code to take advantage of the 
bugfixes.

---

James



On 14/06/2005, at 7:17 AM, Ed Colmar wrote:

> Greetings.
>
> I stumbled upon the twisted framework while looking for OSCAR support 
> for python.
> I have built a py-TOC AIM bot, that is working in most situations, but 
> is unable to communicate with certain AIM accunts (specifically the 
> ones inside the matrix online MMORPG).
> I am curious to know how unstable the OSCAR implementaion is, because 
> I saw the warning at the top of the code.
>
> I have been gettting the struct.error (in readSNAC) that it appears 
> others have seen.  Is there a workaround for this?
>
> Thanks, and I look forward to working with twisted
>
> Cheers!
>
> -ed
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>




From z3p at twistedmatrix.com  Mon Jun 13 18:47:41 2005
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Mon, 13 Jun 2005 20:47:41 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <42ADF7FB.5070707@greengraphics.net>
References: <42ADF7FB.5070707@greengraphics.net>
Message-ID: <1118710061.5248.1.camel@petra>

On Mon, 2005-06-13 at 14:17 -0700, Ed Colmar wrote:
> Greetings.
> 
> I stumbled upon the twisted framework while looking for OSCAR support 
> for python. 
> 
> I have built a py-TOC AIM bot, that is working in most situations, but 
> is unable to communicate with certain AIM accunts (specifically the ones 
> inside the matrix online MMORPG). 
> 
> I am curious to know how unstable the OSCAR implementaion is, because I 
> saw the warning at the top of the code.

'Unstable' means the code could possibly change frequently.  In reality,
I don't do much development on it, and so it rarely changes.

> I have been gettting the struct.error (in readSNAC) that it appears 
> others have seen.  Is there a workaround for this?

Are you using Twisted 2.x?  It should be fixed in there.  If not, file a
bug with the tracker and I'll take a look.

-p
-- 
       Paul Swartz
(o_    http://z3p.livejournal.com/  _o)
//\    z3p at twistedmatrix.com        /\\
V_/_   AIM: z3penguin              _\_V->
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20050613/57af44a7/attachment.sig>

From andrew-twisted at puzzling.org  Mon Jun 13 19:41:17 2005
From: andrew-twisted at puzzling.org (andrew-twisted at puzzling.org)
Date: Tue, 14 Jun 2005 11:41:17 +1000
Subject: [Twisted-Python] Large blocks of data and Perspective Broker
In-Reply-To: <42AC8CBB.90903@sbcglobal.net>
References: <42AC8CBB.90903@sbcglobal.net>
Message-ID: <20050614014117.GA7794@home.puzzling.org>

On Sun, Jun 12, 2005 at 12:27:55PM -0700, Shawn Church wrote:
> Could someone please point me to an example of passing a large block of
> data (>640k) via  Perspective Broker??? Specifically I want my PB server
> to create and return  a PDF file in response to a remote method call. I
> guess I can just break it up into blocks and pass it that way but it
> seems there should be a better way.  I know I saw this somewhere but am
> unable to locate the reference now.

Use twisted.spread.util.FilePager or StringPager.

-Andrew.




From matt.feifarek at gmail.com  Mon Jun 13 21:40:06 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Mon, 13 Jun 2005 23:40:06 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <20050611165546.5047.1921872341.divmod.quotient.1054@ohm>
References: <6fb6dbfe05061108594034b78f@mail.gmail.com>
	<20050611165546.5047.1921872341.divmod.quotient.1054@ohm>
Message-ID: <6fb6dbfe0506132040807af26@mail.gmail.com>

You're right; I stand corrected. What it DOES say is this:

ValueError: signal only works in main thread

Somebody here in the list or maybe on #twisted told me about the
installSignalhandlers, I guess I must have conflated the two
directives. It's been so long that I don't remember. As I said, I'm
using this on 3 servers right now to serve thousands of image requests
and convert them on the fly if necessary.

Oh well. Time to find a new way.

Thanks very much for your help.

On 6/11/05, Jp Calderone <exarkun at divmod.com> wrote:
> >I don't see how it's non-public. Twisted TELLS you to use it if you
> >run the reactor in a thread. That doesn't seem too secret to me.
> 
> Where does it do that?



From daedalus at eigenmagic.com  Mon Jun 13 22:44:12 2005
From: daedalus at eigenmagic.com (Justin Warren)
Date: Tue, 14 Jun 2005 14:44:12 +1000
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on
	the same port?
In-Reply-To: <43c0d2b505061001147782b353@mail.gmail.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
	<43c0d2b505061001147782b353@mail.gmail.com>
Message-ID: <1118724252.5388.14.camel@norbert>

On Fri, 2005-06-10 at 16:14 +0800, Eric Hsu wrote:
> Hi Justin,
> 
> Thank you for you quick reply :)
> 
> > What is the problem you are trying to solve here?
> > 
> > I mean, in theory, yes, you could do what you're proposing. Why do you
> > want to, though?
> 
> I'm trying to write a TURN server:
> 
> http://www.ietf.org/internet-drafts/draft-rosenberg-midcom-turn-07.txt
> 
> The TURN client which is behind a NAT will ask the TURN server (with
> public address) to allocate a public transport address for it to
> receive data from outside.
> 
> There're two requests while the client trying to allocate a public
> transport address from the TURN server:
>  * Share Secret Request: over TLS; to obtain a one-time username and
> passwd and keep the passwd as the share secret of both side (the
> server and the client)
>  * Allocate Request: to allocate a public transport address from the server
> 
> As the draft said:
> 
> "A TURN server MUST be prepared to receive  Binding (should be
> Allocate - eric) Requests over TCP and UDP." (P10)
> 
> "The Allocate Request MUST be sent to the same IP address and port as the Shared
> Secret Request. This is because one time passwords are expected to be
> host-specific." (P20)
> 
> That means both the Share Secret Request (over TLS) and Allocate
> Request will be sent to the same IP and port of the server.
> 
> Then, the draft said:
> 
> "The client SHOULD close its connection when it has completed
> allocating username and passwords." (P19)

Ok, so you shut down the session here.

> So, while the client sends the Allocate Request to the server over
> TCP, the process would look like this (assuming the server is
> listening on port 12345 for TLS connection):
> 
> * the client sends the Share Secret Request to server:12345 _over TLS_
> and obtains a one-time username and passwd
> * the client closes the TLS connection
> * the client sends the Allocate Request to server:12345 _again_ to
> allocate a public transport address...

My reading of this (without having read the actual RFC) would result in
this kind of sequence:

C: connect to server via TCP
S: accept connection
C/S: start TLS
-- TLS negotiation happens --
C: Share Secret Request
S: gives out one time username/password
C: cool! thanks!
S: close connection

So the TCP session actually gets shut down here. The client then does
the Allocate Request, presumably using the username/password combo it
got before.

C: connect to server via TCP
S: accept connection
C: Allocate request
... and so on.

> It seems that I have to implement what I've mentioned in my previous mail?
> I'm not a native English speaker, and TURN is only a draft, maybe I've
> misunderstood something?

So you SHOULD be closing the connection after doing the username and
password allocation, which I'm reading as being within the TLS session.
This means the shutdown of TLS happens when the TCP connection is ended.
The next connection will be standard bare TCP.

This means all you have to do is work out how to turn TLS *on* when you
get a TCP connection. You don't have to work out how to turn it off
within the same TCP session, because you actually end the session and
reconnect. Much easier. :)

-- 
Justin Warren <daedalus at eigenmagic.com>




From nkeric at gmail.com  Mon Jun 13 23:57:59 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 14 Jun 2005 13:57:59 +0800
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on the
	same port?
In-Reply-To: <1118724252.5388.14.camel@norbert>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
	<43c0d2b505061001147782b353@mail.gmail.com>
	<1118724252.5388.14.camel@norbert>
Message-ID: <43c0d2b5050613225779384807@mail.gmail.com>

Hi Justin!

BIG THANKS for your clarification! That really enlightened me :D

Then, here is the last question which is more related to twisted:

Does twisted already have support(libs, classes, api...) for "turning
TLS on within a normal TCP connection"? Is there any sample code or
tutorial I could learn from, or could you please point me to somewhere
I could find more information?

Big thanks again! :) :)

- Eric


2005/6/14, Justin Warren <daedalus at eigenmagic.com>:
> So you SHOULD be closing the connection after doing the username and
> password allocation, which I'm reading as being within the TLS session.
> This means the shutdown of TLS happens when the TCP connection is ended.
> The next connection will be standard bare TCP.
> 
> This means all you have to do is work out how to turn TLS *on* when you
> get a TCP connection. You don't have to work out how to turn it off
> within the same TCP session, because you actually end the session and
> reconnect. Much easier. :)
> 
> --
> Justin Warren <daedalus at eigenmagic.com>
> 
>



From foom at fuhm.net  Tue Jun 14 00:38:02 2005
From: foom at fuhm.net (James Y Knight)
Date: Tue, 14 Jun 2005 02:38:02 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending when
	installSignalHandlers=False
In-Reply-To: <6fb6dbfe0506132040807af26@mail.gmail.com>
References: <6fb6dbfe05061108594034b78f@mail.gmail.com>
	<20050611165546.5047.1921872341.divmod.quotient.1054@ohm>
	<6fb6dbfe0506132040807af26@mail.gmail.com>
Message-ID: <36A717FD-D77E-42F8-8A52-0BAE85D9B5B2@fuhm.net>


On Jun 13, 2005, at 11:40 PM, Matt Feifarek wrote:
> Oh well. Time to find a new way.

I'd suggest continuing to do it the way you are currently. While  
installSignalHandlers may be undocumented, it's not just going to  
disappear overnight. If you use that parameter and
task.LoopingCall(process.reapAllProcesses).start(1.0, now=False)
then I'd say you're on fairly safe ground for the immediate future.

Overall we do a good job of keeping backwards compatibility even for  
APIs that may not be completely official, so it's unlikely to just up  
and disappear.

James



From apocalypznow at gmail.com  Tue Jun 14 01:34:31 2005
From: apocalypznow at gmail.com (apocalypznow)
Date: Tue, 14 Jun 2005 00:34:31 -0700
Subject: [Twisted-Python] Combine XMLRPC and PB in one server?
Message-ID: <d8m10u$nqd$1@sea.gmane.org>

How do you make a server that handles both XMLRPC and PB?

How do you do this as a service?

When I mean service, I mean as in the following code:

application = twisted.application.service.Application("pbserver")
myService = twisted.application.service.IServiceCollection(application)

p = portal.Portal(DefaultRealm())
dbu=twisted.cred.checkers.InMemoryUsernamePasswordDatabaseDontUse()
dbu.addUser("user1","pass1")
p.registerChecker(dbu)

myServer = 
twisted.application.internet.TCPServer(8080,pb.PBServerFactory(p))
myServer.setServiceParent(myService)




From apocalypznow at gmail.com  Tue Jun 14 02:28:14 2005
From: apocalypznow at gmail.com (apocalypznow)
Date: Tue, 14 Jun 2005 01:28:14 -0700
Subject: [Twisted-Python] FilePager?
Message-ID: <d8m45j$14i$1@sea.gmane.org>

How do you use twisted.spread.util.FilePager in a PB server?




From itamar at itamarst.org  Tue Jun 14 07:46:57 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 14 Jun 2005 09:46:57 -0400
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on
	the same port?
In-Reply-To: <43c0d2b5050613225779384807@mail.gmail.com>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
	<43c0d2b505061001147782b353@mail.gmail.com>
	<1118724252.5388.14.camel@norbert>
	<43c0d2b5050613225779384807@mail.gmail.com>
Message-ID: <1118756817.8307.13.camel@localhost.localdomain>

On Tue, 2005-06-14 at 13:57 +0800, Eric Hsu wrote:

> Does twisted already have support(libs, classes, api...) for "turning
> TLS on within a normal TCP connection"? Is there any sample code or
> tutorial I could learn from, or could you please point me to somewhere
> I could find more information?

Yep, self.transport.startTLS(...) where self is a connected Protocol
instance. There are probably some examples in the code, or look at how
the tests do it (twisted.test.test_tcp).




From glyph at divmod.com  Tue Jun 14 08:45:39 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 10:45:39 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending
	when	installSignalHandlers=False
In-Reply-To: <36A717FD-D77E-42F8-8A52-0BAE85D9B5B2@fuhm.net>
References: <6fb6dbfe05061108594034b78f@mail.gmail.com>	<20050611165546.5047.1921872341.divmod.quotient.1054@ohm>	<6fb6dbfe0506132040807af26@mail.gmail.com>
	<36A717FD-D77E-42F8-8A52-0BAE85D9B5B2@fuhm.net>
Message-ID: <42AEED93.70306@divmod.com>

James Y Knight wrote:

> On Jun 13, 2005, at 11:40 PM, Matt Feifarek wrote:

> I'd suggest continuing to do it the way you are currently. While  
> installSignalHandlers may be undocumented, it's not just going to  
> disappear overnight. If you use that parameter and
> task.LoopingCall(process.reapAllProcesses).start(1.0, now=False)
> then I'd say you're on fairly safe ground for the immediate future.
> 
> Overall we do a good job of keeping backwards compatibility even for  
> APIs that may not be completely official, so it's unlikely to just up  
> and disappear.

Perhaps a better way to handle this would be to create an official API 
to handle this problem, then distribute it as an external Python file 
you can include, which will have some forward-compatibility code put 
into it when newer versions of Twisted come out.

I don't like the "let's never change anything because someone might be 
using it somewhere" approach that we've been taking.  When we're making 
minor changes it's good but over time (especially given the sprawling 
nature of Twisted and the lack of any documentation on the state of its 
entirety) means tha we leave chunks of deprecated or semi-deprecated 
APIs around forever.



From glyph at divmod.com  Tue Jun 14 08:53:55 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 10:53:55 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <1baf00e5d4378ba94953504a7e1c215d@delx.cjb.net>
References: <42ADF7FB.5070707@greengraphics.net>
	<1baf00e5d4378ba94953504a7e1c215d@delx.cjb.net>
Message-ID: <42AEEF83.7070300@divmod.com>

James Bunton wrote:
> You might want to contact Daniel, the developer of PyAIM-t
> http://www.blathersource.org for the homepage.
> He's been doing lots of development with the Oscar module, and you could 
> likely use that version in your own code to take advantage of the bugfixes.

Daniel reads this list, at least according to my archives.  (Hi, Daniel!)

As Paul said elsewhere in this thread, the fix in question should be in 
Twisted 2.0.  However, Daniel, are there other fixes in PyAIM-t that 
haven't been contributed back?  I have a message from 2005/03/15 that 
says that you were going to try to merge PyAIM-t and PyICQ-t, document 
them, put them in twisted, and maintain them... any progress there?



From jadestorm at nc.rr.com  Tue Jun 14 09:25:45 2005
From: jadestorm at nc.rr.com (Daniel Henninger)
Date: Tue, 14 Jun 2005 11:25:45 -0400 (EDT)
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <42AEEF83.7070300@divmod.com>
References: <42ADF7FB.5070707@greengraphics.net>
	<1baf00e5d4378ba94953504a7e1c215d@delx.cjb.net>
	<42AEEF83.7070300@divmod.com>
Message-ID: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>

> James Bunton wrote:
>> You might want to contact Daniel, the developer of PyAIM-t
>> http://www.blathersource.org for the homepage.
>> He's been doing lots of development with the Oscar module, and you could
>> likely use that version in your own code to take advantage of the
>> bugfixes.
>
> Daniel reads this list, at least according to my archives.  (Hi, Daniel!)
>
> As Paul said elsewhere in this thread, the fix in question should be in
> Twisted 2.0.  However, Daniel, are there other fixes in PyAIM-t that
> haven't been contributed back?  I have a message from 2005/03/15 that
> says that you were going to try to merge PyAIM-t and PyICQ-t, document
> them, put them in twisted, and maintain them... any progress there?

LOL  Called me out   =)

Let me start off by saying, I'm in the process of moving, so my
response/ability to work on things is quite limited for the time being. 
That said, yes, I wanted to combine the changes to oscar.py that are done
in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy to
"be the supporter of" oscar.py in Twisted if you all want, but I don't
want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
nothing else, I'll try to clean things up and hand the code to Paul.

Daniel




From glyph at divmod.com  Tue Jun 14 10:33:34 2005
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 14 Jun 2005 12:33:34 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
Message-ID: <20050614163334.5047.683193401.divmod.quotient.2769@ohm>



On Tue, 14 Jun 2005 11:25:45 -0400 (EDT), Daniel Henninger 

>Let me start off by saying, I'm in the process of moving, so my
>response/ability to work on things is quite limited for the time being.

Understandable.  I'm in the process of living so my resources are similarly limited. :)

>That said, yes, I wanted to combine the changes to oscar.py that are done
>in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy to
>"be the supporter of" oscar.py in Twisted if you all want, but I don't
>want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
>nothing else, I'll try to clean things up and hand the code to Paul.

I'm sure that Paul wouldn't mind.  (As I understand it, he barely has time to work on conch, his main interest in Twisted currently.)

Is there a bug for this in the tracker?  If not, please create a bug on http://twistedmatrix.com/bugs and assign it to yourself.



From jadestorm at nc.rr.com  Tue Jun 14 11:09:20 2005
From: jadestorm at nc.rr.com (Daniel Henninger)
Date: Tue, 14 Jun 2005 13:09:20 -0400 (EDT)
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <20050614163334.5047.683193401.divmod.quotient.2769@ohm>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
Message-ID: <43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>

>>That said, yes, I wanted to combine the changes to oscar.py that are done
>>in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy to
>>"be the supporter of" oscar.py in Twisted if you all want, but I don't
>>want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
>>nothing else, I'll try to clean things up and hand the code to Paul.
>
> I'm sure that Paul wouldn't mind.  (As I understand it, he barely has time
> to work on conch, his main interest in Twisted currently.)

=D  What do you think, Paul?

> Is there a bug for this in the tracker?  If not, please create a bug on
> http://twistedmatrix.com/bugs and assign it to yourself.

Sorry, a bug for what?  What the thread was originally about or something
more directly related to me?

Daniel




From z3p at twistedmatrix.com  Tue Jun 14 11:25:33 2005
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Tue, 14 Jun 2005 13:25:33 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
Message-ID: <1118769934.5248.4.camel@petra>

On Tue, 2005-06-14 at 13:09 -0400, Daniel Henninger wrote:
> >>That said, yes, I wanted to combine the changes to oscar.py that are done
> >>in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy to
> >>"be the supporter of" oscar.py in Twisted if you all want, but I don't
> >>want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
> >>nothing else, I'll try to clean things up and hand the code to Paul.
> >
> > I'm sure that Paul wouldn't mind.  (As I understand it, he barely has time
> > to work on conch, his main interest in Twisted currently.)
> 
> =D  What do you think, Paul?

It's yours.  :)

-p
-- 
       Paul Swartz
(o_    http://z3p.livejournal.com/  _o)
//\    z3p at twistedmatrix.com        /\\
V_/_   AIM: z3penguin              _\_V->
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20050614/b642e108/attachment.sig>

From glyph at divmod.com  Tue Jun 14 11:42:49 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 13:42:49 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
Message-ID: <42AF1719.3080605@divmod.com>

Daniel Henninger wrote:

>>Is there a bug for this in the tracker?  If not, please create a bug on
>>http://twistedmatrix.com/bugs and assign it to yourself.

> Sorry, a bug for what?  What the thread was originally about or something
> more directly related to me?

I was talking about a bug for integrating the pyXXX-t changes into 
oscar.py and documenting it.



From jadestorm at nc.rr.com  Tue Jun 14 11:54:13 2005
From: jadestorm at nc.rr.com (Daniel Henninger)
Date: Tue, 14 Jun 2005 13:54:13 -0400 (EDT)
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <42AF1719.3080605@divmod.com>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
	<42AF1719.3080605@divmod.com>
Message-ID: <44363.152.1.4.40.1118771653.squirrel@www.vorpalcloud.org>

>>>Is there a bug for this in the tracker?  If not, please create a bug on
>>>http://twistedmatrix.com/bugs and assign it to yourself.
>
>> Sorry, a bug for what?  What the thread was originally about or
>> something
>> more directly related to me?
>
> I was talking about a bug for integrating the pyXXX-t changes into
> oscar.py and documenting it.

Oh ok  =)  I'll do that.  (didn't consider it a "bug", so was confused  ;D  )

Daniel




From christopher.zorn at gmail.com  Tue Jun 14 12:58:37 2005
From: christopher.zorn at gmail.com (Christopher Zorn)
Date: Tue, 14 Jun 2005 14:58:37 -0400
Subject: [Twisted-Python] ldaptor.protocols.ldap.ldapclient.startTLS
Message-ID: <149014b9050614115818c12cc6@mail.gmail.com>

I hope this is the correct place to ask about this, forgive me if it is not. 

I recently tried to use ldaptor. It is great!! 
I ran into one problem though. I wanted to use startTLS and I had to call 
it myself. 

So I put the following in front of some example code :

d=c.connectAnonymously(config['base'], config['serviceLocationOverrides'])
#d = c.connect(config['base'], config['serviceLocationOverrides'])

    
    def _startTLS(proto):
        d = proto.startTLS()
        d.addCallback(lambda _: proto)
        return d
        

    d.addCallback(_startTLS)


This would hang. I went to find out and there was a deferred created that seemed
to have been getting lost. It was never called when handle was called in the 
client class. 

I attached a patch that allows me to use startTLS the way I did it, but I do not
know if this is correct. Please let me know if I am doing something
wrong or if this
is actually a bug. 

The patch is to the file ldaptor/protocols/ldap/ldapclient.py



From ed at greengraphics.net  Tue Jun 14 13:04:10 2005
From: ed at greengraphics.net (Ed Colmar)
Date: Tue, 14 Jun 2005 12:04:10 -0700
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <1118710061.5248.1.camel@petra>
References: <42ADF7FB.5070707@greengraphics.net>
	<1118710061.5248.1.camel@petra>
Message-ID: <42AF2A2A.4080506@greengraphics.net>

Thanks for all the replies. 

Yes, I am using 2.0.1 twisted, however I'm not certain that I have 
installed the proper files from the seperate packages... 

My install procedure was to copy the entire twisted folder (from the 
2.0.1package), into python/lib.  Then I replaced the 'words' folder with 
the one supplied in the twisted words 0.1.0 package.

This still results in the struct.error.

Then I copied oscar.py sockserror.py and sock5.py into the protocols 
folder (overwriting oscar.py).

Same struct.error... 

I would copy the traceback for you, but it hangs my IDLE python editor 
on this crash.  So, I'll attach a screenshot.

Did I do something wrong on the install copy?

-ed

>Are you using Twisted 2.x?  It should be fixed in there.  If not, file a
>bug with the tracker and I'll take a look.
>
>  
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: traceback.gif
Type: image/gif
Size: 22247 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050614/852addb1/attachment-0002.gif>

From ed at greengraphics.net  Tue Jun 14 13:27:51 2005
From: ed at greengraphics.net (Ed Colmar)
Date: Tue, 14 Jun 2005 12:27:51 -0700
Subject: [Twisted-Python] words/doc/examples/aimbot.py - BCFactory missing
Message-ID: <42AF2FB7.5050708@greengraphics.net>

I started playing around with the toc implementation, with hopes that it 
would work for my (somewhat wierd) needs.

I'm seeing this error when firing up the bot:

Traceback (most recent call last):
  File 
"C:\Installers\python_modules\TwistedWords-0.1.0.tar\TwistedWords-0.1.0\TwistedWords-0.1.0\doc\examples\aimbot2.py", 
line 59, in ?
    bot = base.BCFactory( aimBot(screenname, password) )
AttributeError: 'module' object has no attribute 'BCFactory'

Perhaps this BCFactory class has moved? 

-ed



From jadestorm at nc.rr.com  Tue Jun 14 13:32:40 2005
From: jadestorm at nc.rr.com (Daniel Henninger)
Date: Tue, 14 Jun 2005 15:32:40 -0400 (EDT)
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <1118769934.5248.4.camel@petra>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
	<1118769934.5248.4.camel@petra>
Message-ID: <44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>

> On Tue, 2005-06-14 at 13:09 -0400, Daniel Henninger wrote:
>> >>That said, yes, I wanted to combine the changes to oscar.py that are
>> done
>> >>in PyAIM-t and PyICQ-t and then submit back to Twisted.  I'd be happy
>> to
>> >>"be the supporter of" oscar.py in Twisted if you all want, but I don't
>> >>want to step on anyone(Paul)'s toes!!  I leave that up to you all.  If
>> >>nothing else, I'll try to clean things up and hand the code to Paul.
>> >
>> > I'm sure that Paul wouldn't mind.  (As I understand it, he barely has
>> time
>> > to work on conch, his main interest in Twisted currently.)
>>
>> =D  What do you think, Paul?
>
> It's yours.  :)


=D

Ok so, that said, how do I go about updating oscar.py (when it comes time)?

Daniel




From liiwi at lonesom.pp.fi  Tue Jun 14 14:19:58 2005
From: liiwi at lonesom.pp.fi (Jaakko Niemi)
Date: Tue, 14 Jun 2005 23:19:58 +0300
Subject: [Twisted-Python] cred + PAM
Message-ID: <20050614201958.GA26005@jumper.lonesom.pp.fi>

 Hello,

 If you are interested of getting PAM support to cred, take a peek at:

 http://twistedmatrix.com/bugs/issue1044

 The patches are a start and propably break conch.

 Also, python-pam (PyPAM) is seriously bitrotten.
 Are there others who are interested in getting it into
 more working shape? If it's author is not near these
 bitfields anymore, maybe a fork or hijack is in place.

                --j




From christopher.zorn at gmail.com  Tue Jun 14 14:17:16 2005
From: christopher.zorn at gmail.com (Christopher Zorn)
Date: Tue, 14 Jun 2005 16:17:16 -0400
Subject: [Twisted-Python] Re: ldaptor.protocols.ldap.ldapclient.startTLS
In-Reply-To: <149014b9050614115818c12cc6@mail.gmail.com>
References: <149014b9050614115818c12cc6@mail.gmail.com>
Message-ID: <149014b9050614131710053e8e@mail.gmail.com>

I forgot to attach the patch, sorry, 

On 6/14/05, Christopher Zorn <christopher.zorn at gmail.com> wrote:
> I hope this is the correct place to ask about this, forgive me if it is not.
> 
> I recently tried to use ldaptor. It is great!!
> I ran into one problem though. I wanted to use startTLS and I had to call
> it myself.
> 
> So I put the following in front of some example code :
> 
> d=c.connectAnonymously(config['base'], config['serviceLocationOverrides'])
> #d = c.connect(config['base'], config['serviceLocationOverrides'])
> 
> 
>     def _startTLS(proto):
>         d = proto.startTLS()
>         d.addCallback(lambda _: proto)
>         return d
> 
> 
>     d.addCallback(_startTLS)
> 
> 
> This would hang. I went to find out and there was a deferred created that seemed
> to have been getting lost. It was never called when handle was called in the
> client class.
> 
> I attached a patch that allows me to use startTLS the way I did it, but I do not
> know if this is correct. Please let me know if I am doing something
> wrong or if this
> is actually a bug.
> 
> The patch is to the file ldaptor/protocols/ldap/ldapclient.py
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ldapclient.py.patch
Type: text/x-patch
Size: 395 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050614/a8cd7e2a/attachment-0002.bin>

From foom at fuhm.net  Tue Jun 14 14:22:13 2005
From: foom at fuhm.net (James Y Knight)
Date: Tue, 14 Jun 2005 16:22:13 -0400
Subject: [Twisted-Python] Problem: spawnProcess() never ending
	when	installSignalHandlers=False
In-Reply-To: <42AEED93.70306@divmod.com>
References: <6fb6dbfe05061108594034b78f@mail.gmail.com>	<20050611165546.5047.1921872341.divmod.quotient.1054@ohm>	<6fb6dbfe0506132040807af26@mail.gmail.com>
	<36A717FD-D77E-42F8-8A52-0BAE85D9B5B2@fuhm.net>
	<42AEED93.70306@divmod.com>
Message-ID: <6B3DF51E-B92E-4C62-8091-9873045097AD@fuhm.net>

On Jun 14, 2005, at 10:45 AM, Glyph Lefkowitz wrote:
> I don't like the "let's never change anything because someone might  
> be using it somewhere" approach that we've been taking.  When we're  
> making minor changes it's good but over time (especially given the  
> sprawling nature of Twisted and the lack of any documentation on  
> the state of its entirety) means tha we leave chunks of deprecated  
> or semi-deprecated APIs around forever.

That points to a need to better track deprecated APIs and when they  
are planned to be removed, not to a need to break things more.  
Stability is good, and without an easy way to verify conformance, it  
is dangerous to say that stability in undocumented interfaces is  
unimportant. It believe that an undocumented interface should be  
considered less important to keep stable, but it should still be done  
if possible. This is especially true in the twisted core, vs the  
various protocol packages, most of which are significantly less well  
developed and in some cases just have stupidly broken APIs.

For this particular case, I can't think of any reason why an  
installSignalHandlers=0 argument would ever need to be removed.

James




From mary-twisted at puzzling.org  Tue Jun 14 14:47:14 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 15 Jun 2005 06:47:14 +1000
Subject: [Twisted-Python] Australian Twisted Sprint #2: 19th - 21st August
	2005, Sydney
Message-ID: <20050614204714.GB8869@sourdust.home.puzzling.org>

Hi everyone,

We're still in the early stages of planning, but I thought I'd get the
date out there as soon as I could. Following the success of the
Twisted sprint in Hobart in April, we're having a second sprint.

Dates: Friday 19th - Sunday 21st August 2005

Location: Sydney (venue not yet known)

As with last time, there will be no attendence charge and sprinters will
be taking care of their own accommodation and transport. Once we have a
venue we'll have some suggestions.

We'll be working on code and documentation hopefully destined for the
Twisted Subversion repository. People not really familiar with Twisted
are welcome but will probably at least want to have the basics down by
the time of the sprint.

More details will be announced here, also see the wiki at
http://users.puzzling.org/users/mary/TwistedSprint/moin.cgi/FrontPage
People interested in coming should update
http://users.puzzling.org/users/mary/TwistedSprint/moin.cgi/SprintAttendees
and email me, so that we have an idea of numbers.

-Mary



From glyph at divmod.com  Tue Jun 14 15:44:42 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 17:44:42 -0400
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>	<1118769934.5248.4.camel@petra>
	<44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
Message-ID: <42AF4FCA.2000207@divmod.com>

Daniel Henninger wrote:

> Ok so, that said, how do I go about updating oscar.py (when it comes time)?

Put some patches in the bugtracker and assign them to someone (glyph, 
exarkun, z3p).  After a few patches, perhaps we will give you commit access.



From glyph at divmod.com  Tue Jun 14 15:55:56 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Tue, 14 Jun 2005 17:55:56 -0400
Subject: [Twisted-Python] cred + PAM
In-Reply-To: <20050614201958.GA26005@jumper.lonesom.pp.fi>
References: <20050614201958.GA26005@jumper.lonesom.pp.fi>
Message-ID: <42AF526C.4030909@divmod.com>

Jaakko Niemi wrote:
>  Hello,
> 
>  If you are interested of getting PAM support to cred, take a peek at:

Awesome!  I will definitely have a look at this soon.  I've wanted to 
support PAM since day 1 with cred :)



From jason.mobarak at gmail.com  Tue Jun 14 17:53:22 2005
From: jason.mobarak at gmail.com (Jason Mobarak)
Date: Tue, 14 Jun 2005 17:53:22 -0600
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
	<1118769934.5248.4.camel@petra>
	<44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
Message-ID: <b194c9190506141653741d6030@mail.gmail.com>

On 6/14/05, Daniel Henninger <jadestorm at nc.rr.com> wrote:
[... stuff about Daniel working on OSCAR support ...]
> > It's yours.  :)
> 
> Ok so, that said, how do I go about updating oscar.py (when it comes time)?

I can't speak for the powers at be but generally you'd follow the
general process of:

- File a "bug" (really it's an issue, something that needs more
centralized tracking than email can support).  Twisted's bug tracker
is used for feature requests and improvements made by people without
commit access.

- Use the bug to communicate future work on the issue

- Check out a copy of Twisted's Subversion repository.  Work off that.
 Make diff when you're satisfied with your changes.  Attach the diff
to Twisted's issue/bug tracker and when someone with commit access
feels that it's properly documented and the quality is high enough
it'll get committed.

That seems to be the general process.  Someone correct me if I'm wrong.

,,Jason



From mary-twisted at puzzling.org  Tue Jun 14 17:59:22 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 15 Jun 2005 09:59:22 +1000
Subject: [Twisted-Python] Setting up OSCAR bot in twisted
In-Reply-To: <b194c9190506141653741d6030@mail.gmail.com>
References: <43767.152.1.4.40.1118762745.squirrel@www.vorpalcloud.org>
	<20050614163334.5047.683193401.divmod.quotient.2769@ohm>
	<43993.152.1.4.40.1118768960.squirrel@www.vorpalcloud.org>
	<1118769934.5248.4.camel@petra>
	<44585.152.1.4.40.1118777560.squirrel@www.vorpalcloud.org>
	<b194c9190506141653741d6030@mail.gmail.com>
Message-ID: <20050614235922.GA15789@home.puzzling.org>

On Tue, Jun 14, 2005, Jason Mobarak wrote:
> That seems to be the general process.  Someone correct me if I'm wrong.

I think there's a middle step about taking "ownership" of the issue, not
so much in the sense of assigning it to yourself as actually taking
initiative and bugging people to review it and merge it (on IRC,
usually). There's a lot of patches languishing for lack of nagging in
there.

-Mary



From ian at ianduggan.net  Tue Jun 14 18:45:54 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Tue, 14 Jun 2005 17:45:54 -0700
Subject: [Twisted-Python] Capture blocking calls?
Message-ID: <200506141745.54830.ian@ianduggan.net>


Hi,

Does anyone know of any tools that could be used to wrap a python module and 
capture/report blocking calls made by it?

My immediate need is to extend the twisted soap client to support the WSDL 
proxy that is part of SOAPpy. The current soap proxy looks to be pretty 
minimal.

I'll probably just end up reading through the code this time, but I thought I 
would throw the idea out there in case anyone had considered this before.

Such a tool might make it easier to wrap up/modify libraries and make them 
usable from Twisted.

--Ian



From exarkun at divmod.com  Tue Jun 14 19:17:34 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 14 Jun 2005 21:17:34 -0400
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <200506141745.54830.ian@ianduggan.net>
Message-ID: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>

On Tue, 14 Jun 2005 17:45:54 -0700, Ian Duggan <ian at ianduggan.net> wrote:
>
>Hi,
>
>Does anyone know of any tools that could be used to wrap a python module and
>capture/report blocking calls made by it?
>
>My immediate need is to extend the twisted soap client to support the WSDL
>proxy that is part of SOAPpy. The current soap proxy looks to be pretty
>minimal.
>
>I'll probably just end up reading through the code this time, but I thought I
>would throw the idea out there in case anyone had considered this before.
>
>Such a tool might make it easier to wrap up/modify libraries and make them
>usable from Twisted.

<http://svn.twistedmatrix.com/cvs/sandbox/exarkun/btt.py> (and <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/test_btt.py>) might be of interest/use.  I haven't done much with it yet, so I don't know if it's actually effective.  I'd be interested to hear if you have any luck with it.

Jp



From foom at fuhm.net  Tue Jun 14 20:08:06 2005
From: foom at fuhm.net (James Y Knight)
Date: Tue, 14 Jun 2005 22:08:06 -0400
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: <2803867A-D82B-4980-A7A3-D047005FD062@fuhm.net>

Bug summary
______________________
Since 2005-05-31 04:57:08.920000:
Bugs opened: 14   Bugs closed: 3   Total open bugs: 388 (+11)
   Urgent: 7 (+1)
   Bug: 163 (+8)
   Feature: 143 (+2)
   Wish: 75 (+0)

New / Reopened Bugs
______________________
                     ==== Urgent ====
[DOCUMENTATION, LORE] Lore  (1 week ago)
        http://twistedmatrix.com/bugs/issue1073 opened by glyph

                     ==== Bug ====
twisted.web.client _parse URL parse bug  (yesterday)
        http://twistedmatrix.com/bugs/issue1080 opened by gentoo.cn

[WEB] HTTPClientFactory leaks memory  (4 days ago)
        http://twistedmatrix.com/bugs/issue1079 opened by jojo

[XISH] twisted.xish.xmlstream parse error  (5 days ago)
        http://twistedmatrix.com/bugs/issue1078 opened by tofu

[PATCH]socks proxy bugs  (20 months ago)
        http://twistedmatrix.com/bugs/issue285 opened by maoy

[XISH] domish.Element checking __class__, breaks inheritance  (1 week  
ago)
        http://twistedmatrix.com/bugs/issue1074 opened by VislabSteve

[CORE, DOCUMENTATION] Add threadedselectreactor into appropriate  
docs  (6 days ago)
        http://twistedmatrix.com/bugs/issue1077 opened by hypatia

[MAIL] pop3 protocol does not parse lines according to the rfc  (1  
week ago)
        http://twistedmatrix.com/bugs/issue1076 opened by mg

log.msg fails and then the log file is silent ever after  (1 week ago)
        http://twistedmatrix.com/bugs/issue1069 opened by bruce

Stupid code needs removing from ftp.py  (1 week ago)
        http://twistedmatrix.com/bugs/issue1075 opened by orbitz

roundup bug?  (1 week ago)
        http://twistedmatrix.com/bugs/issue1070 opened by maoy

                     ==== Feature ====
deferToThread decorator  (1 week ago)
        http://twistedmatrix.com/bugs/issue1071 opened by tjs

adbapi: retrying queries on a lost connection  (1 week ago)
        http://twistedmatrix.com/bugs/issue1072 opened by davep

                     ==== Wish ====
[CHAT, WORDS] Incorporate PyAIM/PyICQ updates to oscar.py into  
Twisted  (7 hours ago)
        http://twistedmatrix.com/bugs/issue1081 opened by jadestorm

Bugs Closed
______________________
                     ==== Bug ====
[WEBSITE] http://twistedmatrix.com/documents/ has 1.3 documentation  
linked as current one  (1 month ago)
        http://twistedmatrix.com/bugs/issue1029 opened by itamarst,  
closed by ash

[PB] CopiedFailure printTraceback method signature doesn't match  
Failure's  (1 month ago)
        http://twistedmatrix.com/bugs/issue1006 opened by micktwomey,  
closed by exarkun

                     ==== Wish ====
CoreFoundation (just Foundation would be acceptable) RunLoop  
integration  (22 months ago)
        http://twistedmatrix.com/bugs/issue164 opened by etrepum,  
closed by exarkun





From ssmith at vislab.usyd.edu.au  Tue Jun 14 20:28:17 2005
From: ssmith at vislab.usyd.edu.au (Steve Smith)
Date: Wed, 15 Jun 2005 12:28:17 +1000
Subject: [Twisted-Python] Clean shutdown of an XMLStream session
Message-ID: <1118802497.21943.4.camel@moth.vislab.usyd.edu.au>

Hi,

This is probably a stupid question, but what is method of cleanly
shutting down an XMLStream (such that it sends the terminating </stream>
and closes the connection).

Thanks,
Steve




From gmcdonald at infocomp.com  Tue Jun 14 20:51:04 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Wed, 15 Jun 2005 12:51:04 +1000
Subject: [Twisted-Python] FW: Twisted Sprint (Mary please read)
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4DD5@XCHANGE>

Apologies in advance for posting this to the list.

Mary: I tried emailing you at the address supplied on the Sprint page but
the email wouldn't deliver (I am certain my understanding of the address
translation was faulty) can you please see my forwarded email below:

Regards,

Grant

-----Original Message-----
From: Grant McDonald 
Sent: 15 June 2005 12:32
To: xxxxxx
Subject: Twisted Sprint

Mary,

I am interested in attending the twisted sprint but have never been to a
"sprint" of any description and am wondering what use I could be? I have
been working with twisted in a production system for about 1.5 years and am
familiar with the core of twisted and would be more than happy to help out
with documentation.  Since I work full time I would only be able to attend
the Saturday and Sunday.  Accommodation is not a problem (depending on where
in Sydney) since I live in Wollongong.

Kind Regards,

Grant McDonald
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050615/f9946c9a/attachment.html>

From mary-twisted at puzzling.org  Tue Jun 14 21:01:51 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 15 Jun 2005 13:01:51 +1000
Subject: [Twisted-Python] FW: Twisted Sprint (Mary please read)
In-Reply-To: <61DA7719C45FD31185280008C733EF6E04AC4DD5@XCHANGE>
References: <61DA7719C45FD31185280008C733EF6E04AC4DD5@XCHANGE>
Message-ID: <20050615030151.GD16295@home.puzzling.org>

On Wed, Jun 15, 2005, Grant McDonald wrote:
> Mary: I tried emailing you at the address supplied on the Sprint page but
> the email wouldn't deliver (I am certain my understanding of the address
> translation was faulty) can you please see my forwarded email below:

Thank you for the email. You can also send mail to the address that I
use to post to this list though...

Since this might be applicable more widely: as for what use you would be
at a sprint, well, there will be a few things going on:

 - writing and editing of existing Twisted documentation. You could be
   of use as a writer, editor, proofreader or reviewer
 - coding on a couple of projects including the VFS layer. You could be
   of use as a coder, code reviewer or tester

They don't really work on a "farming tasks out" basis though, ie there
is no Sprint Master watching everyone to make sure they have something
to do and aren't lost or bored. You just sit around and code (write,
review, test...) with a bunch of other people. They're generally small
enough that you'll get to know everyone well. People can pair with you
to let you in on their projects.

(All further mails regarding the sprint can be sent directly to me using
the address above. Watch it when you hit reply, they go back to the list
by default.)

-Mary



From nkeric at gmail.com  Tue Jun 14 21:17:59 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Wed, 15 Jun 2005 11:17:59 +0800
Subject: [Twisted-Python] Could I serve normal TCP and TLS services on the
	same port?
In-Reply-To: <1118756817.8307.13.camel@localhost.localdomain>
References: <43c0d2b505060920193a8958ff@mail.gmail.com>
	<1118380017.2672.27.camel@norbert>
	<43c0d2b505061001147782b353@mail.gmail.com>
	<1118724252.5388.14.camel@norbert>
	<43c0d2b5050613225779384807@mail.gmail.com>
	<1118756817.8307.13.camel@localhost.localdomain>
Message-ID: <43c0d2b505061420171d7dd01d@mail.gmail.com>

Itamar, thank you very much!
I'm reading the twisted.test.test_tcp now : )

Thank you all guys! You've been a GREAT help!
I'll keep posting if I have further question ;)

2005/6/14, Itamar Shtull-Trauring <itamar at itamarst.org>:
> 
> Yep, self.transport.startTLS(...) where self is a connected Protocol
> instance. There are probably some examples in the code, or look at how
> the tests do it (twisted.test.test_tcp).
> 
>



From laran at elevasoft.com  Tue Jun 14 21:23:03 2005
From: laran at elevasoft.com (Laran Evans)
Date: Tue, 14 Jun 2005 23:23:03 -0400
Subject: [Twisted-Python] Preferred way to receive a patch?
Message-ID: <42AF9F17.1030900@elevasoft.com>

Should I just attach it to an email? Or should I attach it to the 
Roundup issue?

- Laran




From leszczynscy at yahoo.com  Tue Jun 14 21:40:31 2005
From: leszczynscy at yahoo.com (Andrzej Leszczynski)
Date: Tue, 14 Jun 2005 22:40:31 -0500
Subject: [Twisted-Python] ACE vs. Twisted
Message-ID: <42AFA32F.9070108@yahoo.com>

I have a general question, how the ACE differs conceptually from Twisted?

Thx, A.



From gmcdonald at infocomp.com  Tue Jun 14 21:46:59 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Wed, 15 Jun 2005 13:46:59 +1000
Subject: [Twisted-Python] FW: Twisted Sprint (Mary please read)
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4DD6@XCHANGE>

Mary,

Your address is still masked: see the header below.  Based on the
information given in your email I have updated the sprint page to indicate
that I'll be coming along.

Feel free to contact me on gmcdonald  at    infocomp  dot   com regarding
the sprint and sundries :)

Regards,

Grant


-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com]On Behalf Of Mary Gardiner
Sent: 15 June 2005 13:02
To: twisted-python at twistedmatrix.com
Subject: Re: [Twisted-Python] FW: Twisted Sprint (Mary please read)

On Wed, Jun 15, 2005, Grant McDonald wrote:
> Mary: I tried emailing you at the address supplied on the Sprint page but
> the email wouldn't deliver (I am certain my understanding of the address
> translation was faulty) can you please see my forwarded email below:

Thank you for the email. You can also send mail to the address that I
use to post to this list though...

Since this might be applicable more widely: as for what use you would be
at a sprint, well, there will be a few things going on:

 - writing and editing of existing Twisted documentation. You could be
   of use as a writer, editor, proofreader or reviewer
 - coding on a couple of projects including the VFS layer. You could be
   of use as a coder, code reviewer or tester

They don't really work on a "farming tasks out" basis though, ie there
is no Sprint Master watching everyone to make sure they have something
to do and aren't lost or bored. You just sit around and code (write,
review, test...) with a bunch of other people. They're generally small
enough that you'll get to know everyone well. People can pair with you
to let you in on their projects.

(All further mails regarding the sprint can be sent directly to me using
the address above. Watch it when you hit reply, they go back to the list
by default.)

-Mary

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050615/e94aa531/attachment.html>

From mary-twisted at puzzling.org  Tue Jun 14 22:11:08 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Wed, 15 Jun 2005 14:11:08 +1000
Subject: [Twisted-Python] Preferred way to receive a patch?
In-Reply-To: <42AF9F17.1030900@elevasoft.com>
References: <42AF9F17.1030900@elevasoft.com>
Message-ID: <20050615041108.GC16836@home.puzzling.org>

On Tue, Jun 14, 2005, Laran Evans wrote:
> Should I just attach it to an email? Or should I attach it to the 
> Roundup issue?

Attach it to the roundup issue. If you don't get any response to the
issue within some reasonable period of time, mail the mailing list and
ask about it.

-Mary



From foom at fuhm.net  Tue Jun 14 22:16:00 2005
From: foom at fuhm.net (James Y Knight)
Date: Wed, 15 Jun 2005 00:16:00 -0400
Subject: [Twisted-Python] ACE vs. Twisted
In-Reply-To: <42AFA32F.9070108@yahoo.com>
References: <42AFA32F.9070108@yahoo.com>
Message-ID: <035994C4-332C-4C5B-914D-A9539824B0DF@fuhm.net>

On Jun 14, 2005, at 11:40 PM, Andrzej Leszczynski wrote:
> I have a general question, how the ACE differs conceptually from  
> Twisted?

As I understand it, they are pretty similar conceptually, except that  
ACE is in C++.

James




From twisted at ralphm.ik.nu  Wed Jun 15 03:51:53 2005
From: twisted at ralphm.ik.nu (Ralph Meijer)
Date: Wed, 15 Jun 2005 11:51:53 +0200
Subject: [Twisted-Python] Clean shutdown of an XMLStream session
In-Reply-To: <1118802497.21943.4.camel@moth.vislab.usyd.edu.au>
References: <1118802497.21943.4.camel@moth.vislab.usyd.edu.au>
Message-ID: <20050615095153.GA69043@ik.nu>

On Wed, Jun 15, 2005 at 12:28:17PM +1000, Steve Smith wrote:
> Hi,
> 
> This is probably a stupid question, but what is method of cleanly
> shutting down an XMLStream (such that it sends the terminating </stream>
> and closes the connection).

The cleanest way to end a connection is closing the 'XML document'.
Assuming xs is the object holding your XMLStream instance, simply do:

xs.send('</stream:stream>')

This signals to the other party that you want to end the conversation.
The peer will send you the same thing, and the connection will be
shutdown nicely. The STREAM_END_EVENT will be fired, so you can add an
observer to that.

-- 
Groetjes,

ralphm



From tv at twistedmatrix.com  Wed Jun 15 12:31:33 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Wed, 15 Jun 2005 21:31:33 +0300
Subject: [Twisted-Python] Re: ldaptor.protocols.ldap.ldapclient.startTLS
In-Reply-To: <149014b9050614115818c12cc6@mail.gmail.com>
References: <149014b9050614115818c12cc6@mail.gmail.com>
Message-ID: <42B07405.2010203@twistedmatrix.com>

[The list hates my @debian.org address. Sorry for the dup, Christopher]

Christopher Zorn wrote:
> I hope this is the correct place to ask about this, forgive me if it is not. 
> I recently tried to use ldaptor. It is great!!

This is. And thank you.

> I ran into one problem though. I wanted to use startTLS and I had to call 
> it myself.

Well, yes, you need to say when you want to use startTLS and when not..
Current default is "not".

Some day in the future I hope to support something like the
ldap://hostname, ldaps://hostname, ldapi://hostname syntaxes
and things like "whenever you talk to this server, require starttls
and verify the certificate is signed by one of these CAs". No such
thing exists for now, so you need to do the startTLS step manually.

>     def _startTLS(proto):
>         d = proto.startTLS()
>         d.addCallback(lambda _: proto)
>         return d
>         
>     d.addCallback(_startTLS)

I _think_ that can be written as

d.addCallback(lambda proto: proto.startTLS())

as the startTLS callback chain ends with

    def _cbStartTLS(self, msg, ctx):
        ...
        return self

Though I haven't tested it.

I really don't use starttls with ldaptor much (yet), so it may be still
somewhat buggy. Hopefully this will improve -- patches are appreciated.

> This would hang. I went to find out and there was a deferred created that seemed
> to have been getting lost. It was never called when handle was called in the 
> client class. 
> 
> I attached a patch that allows me to use startTLS the way I did it, but I do not
> know if this is correct. Please let me know if I am doing something
> wrong or if this
> is actually a bug. 

Yes, it is a bug, caused by the proto.send() changes in r180.
Your fix is correct. Thank you.




From matt.feifarek at gmail.com  Wed Jun 15 13:51:09 2005
From: matt.feifarek at gmail.com (Matt Feifarek)
Date: Wed, 15 Jun 2005 15:51:09 -0400
Subject: [Twisted-Python] Strange exception deep in twisted
Message-ID: <6fb6dbfe050615125170c4adf3@mail.gmail.com>

Hello.

I'm using twisted 1.3.0 and python 2.4.1 on a 2.6.10 Linux box.

I've got an application that uses twisted.web.resource to render images.

I'm getting this strange exception in my logs, and I can't figure out
where to start looking for problems to fix; it's so deep in twisted.

Note that my app IS working; the images are coming to the browser, but
they're coming out in bursts, rather than one-by-one, as I'm used to.

Here's the info from the log file.

Note that if I do a dump on that args[0], it IS an instance of
twisted.web.server.Request and it does have "channel" in its __dict__.

Thanks!

-----------------------
Unhandled error in Deferred:
Traceback (most recent call last):
  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 313, in _startRunCallbacks
    self._runCallbacks()

  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 338, in _runCallbacks
    self.result = callback(self.result, *args, **kw)

  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 252, in callback
    self._startRunCallbacks(result)

  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 313, in _startRunCallbacks
    self._runCallbacks()

--- <exception caught here> ---

  File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py",
line 338, in _runCallbacks
    self.result = callback(self.result, *args, **kw)

  File "/usr/local/lib/python2.4/site-packages/Wrangler/render/image/__init__.py",
line 132, in postConvert_Success
    Inline_Generic.render_present( self, args[0] )

  File "/usr/local/lib/python2.4/site-packages/Wrangler/render/generic.py",
line 131, in render_present
    static.FileTransfer(f, size, request)

  File "/usr/lib/python2.4/site-packages/twisted/web/static.py", line
426, in __init__
    request.registerProducer(self, 0)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 583, in registerProducer
    self.transport.registerProducer(producer, streaming)

  File "/usr/lib/python2.4/site-packages/twisted/internet/abstract.py",
line 241, in registerProducer
    producer.resumeProducing()

  File "/usr/lib/python2.4/site-packages/twisted/web/static.py", line
437, in resumeProducing
    self.request.finish()

  File "/usr/lib/python2.4/site-packages/twisted/web/server.py", line
277, in finish
    http.Request.finish(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 634, in finish
    self._cleanup()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 447, in _cleanup
    self.channel.requestDone(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 1062, in requestDone
    self.requests[0].noLongerQueued()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 478, in noLongerQueued
    self.transport.registerProducer(self.producer, self.streamingProducer)

  File "/usr/lib/python2.4/site-packages/twisted/internet/abstract.py",
line 241, in registerProducer
    producer.resumeProducing()

  File "/usr/lib/python2.4/site-packages/twisted/web/static.py", line
437, in resumeProducing
    self.request.finish()

  File "/usr/lib/python2.4/site-packages/twisted/web/server.py", line
277, in finish
    http.Request.finish(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 634, in finish
    self._cleanup()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 447, in _cleanup
    self.channel.requestDone(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 1062, in requestDone
    self.requests[0].noLongerQueued()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 478, in noLongerQueued
    self.transport.registerProducer(self.producer, self.streamingProducer)

  File "/usr/lib/python2.4/site-packages/twisted/internet/abstract.py",
line 241, in registerProducer
    producer.resumeProducing()

  File "/usr/lib/python2.4/site-packages/twisted/web/static.py", line
437, in resumeProducing
    self.request.finish()

  File "/usr/lib/python2.4/site-packages/twisted/web/server.py", line
277, in finish
    http.Request.finish(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 634, in finish
    self._cleanup()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 447, in _cleanup
    self.channel.requestDone(self)

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 1062, in requestDone
    self.requests[0].noLongerQueued()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 482, in noLongerQueued
    self._cleanup()

  File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
line 447, in _cleanup
    self.channel.requestDone(self)

exceptions.AttributeError: Request instance has no attribute 'channel'



From luc.stepniewski at adelux.fr  Thu Jun 16 00:46:17 2005
From: luc.stepniewski at adelux.fr (Luc Stepniewski)
Date: Thu, 16 Jun 2005 08:46:17 +0200
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
Message-ID: <200506160846.17897.luc.stepniewski@adelux.fr>

On Wednesday 15 June 2005 03:17, Jp Calderone wrote:
> On Tue, 14 Jun 2005 17:45:54 -0700, Ian Duggan <ian at ianduggan.net> wrote:
> >Hi,
> >
> >Does anyone know of any tools that could be used to wrap a python module
> > and capture/report blocking calls made by it?

I've go tthe same difficulties here.  I'm trying to integrate into Twisted a 
method (which comes from a python+C compiled module) that returns data. The 
problem is that this method is blocking, so I can't integrate it easily in 
Twisted.
So what I would like to do is, in a perfect world (i think):
- Make an infinite loop in which I have this blocking method
- When some data is returned from that method call, do some stuff on it, like
call a PB remote method, call a deferred, adding callbacks (I mean I need/use
the reactor). This work would not be blocking (it shouldn't as it's twisted 
stuff) as I need to get the results (callbacks).
- loop, etc.

My current solution is to use a separate thread for that blocking call, 
keeping the main twisted reactor in the main process. I can call twisted 
deferred by using the callFromThread() method, but the code is horribly big 
(and slow) and complex, even using exarkun's ThreadWrapper (from sandbox) :-(
Is threadedselectreactor what I'm looking for? I did not really understand 
what reactor.interleave() is supposed to call, as all I have is a method to 
call which blocks...

Luc



From tv at twistedmatrix.com  Thu Jun 16 02:18:57 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu, 16 Jun 2005 11:18:57 +0300
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <200506160846.17897.luc.stepniewski@adelux.fr>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
	<200506160846.17897.luc.stepniewski@adelux.fr>
Message-ID: <42B135F1.2020602@twistedmatrix.com>

Luc Stepniewski wrote:
> I've go tthe same difficulties here.  I'm trying to integrate into Twisted a 
> method (which comes from a python+C compiled module) that returns data. The 
> problem is that this method is blocking, so I can't integrate it easily in 
> Twisted.

Sounds like you want to run twisted as normal and just call
d = reactor.callInThread(bigUglyBlockingThing)
when you want more stuff from it.



From luc.stepniewski at adelux.fr  Thu Jun 16 02:51:24 2005
From: luc.stepniewski at adelux.fr (Luc Stepniewski)
Date: Thu, 16 Jun 2005 10:51:24 +0200
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <42B135F1.2020602@twistedmatrix.com>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
	<200506160846.17897.luc.stepniewski@adelux.fr>
	<42B135F1.2020602@twistedmatrix.com>
Message-ID: <200506161051.24422.luc.stepniewski@adelux.fr>

On Thursday 16 June 2005 10:18, Tommi Virtanen wrote:
> Luc Stepniewski wrote:
> > I've go tthe same difficulties here.  I'm trying to integrate into
> > Twisted a method (which comes from a python+C compiled module) that
> > returns data. The problem is that this method is blocking, so I can't
> > integrate it easily in Twisted.
>
> Sounds like you want to run twisted as normal and just call
> d = reactor.callInThread(bigUglyBlockingThing)
> when you want more stuff from it.

You're right, that's what I said I was doing. I was just making the point that 
it's easy to call methods from that thread using callFromThread(), but it's a 
pain to call a method which returns a deferred. Hopefully there's exarkun's 
ThreadWrapper (only in sandbox). Using this, I have some slowdown, but I'm 
not yet sure it's Twisted's fault.
So I was just asking if there was another way of doing it.

Luc




From tv at twistedmatrix.com  Thu Jun 16 05:53:23 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu, 16 Jun 2005 14:53:23 +0300
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <200506161051.24422.luc.stepniewski@adelux.fr>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>	<200506160846.17897.luc.stepniewski@adelux.fr>	<42B135F1.2020602@twistedmatrix.com>
	<200506161051.24422.luc.stepniewski@adelux.fr>
Message-ID: <42B16833.1080501@twistedmatrix.com>

Luc Stepniewski wrote:
> You're right, that's what I said I was doing. I was just making the point that 
> it's easy to call methods from that thread using callFromThread(), but it's a 
> pain to call a method which returns a deferred. Hopefully there's exarkun's 

Well, you have a few possibilities.

1. I haven't checked, but I guess a function called with callInThread
   could return a deferred.

2. If you need to interleave blocking and Deferred operations, split
it out. Instead of

def bigUglyThingThatBlocks():
    ...
    someVar = value
    ...
    d = something(someVar)
    d.addCallback(moreStuff)
    ...
    # we want "x" to be result of d here, but don't know how
    moreBlockingThings(x)

d = reactor.callInThread(bigUglyThingThatBlocks)

you can say

def smallerUglyThingThatBlocks():
    ...
    someVar = value
    ...
    return someVar

d = reactor.callInThread(smallerUglyThingThatBlocks)
d.addCallback(something)
d.addCallback(moreStuff)
d.addCallback(lambda x: reactor.callInThread(moreBlockingThings, x))



From itamar at itamarst.org  Thu Jun 16 09:16:15 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Thu, 16 Jun 2005 11:16:15 -0400
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <42B16833.1080501@twistedmatrix.com>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
	<200506160846.17897.luc.stepniewski@adelux.fr>
	<42B135F1.2020602@twistedmatrix.com>
	<200506161051.24422.luc.stepniewski@adelux.fr>
	<42B16833.1080501@twistedmatrix.com>
Message-ID: <1118934975.8674.34.camel@localhost.localdomain>

On Thu, 2005-06-16 at 14:53 +0300, Tommi Virtanen wrote:

> d = reactor.callInThread(smallerUglyThingThatBlocks)

this should be:

  d = twisted.internet.threads.deferToThread(smallerUglyThingThatBlocks)

callInThread does not return any result.




From ian at ianduggan.net  Thu Jun 16 10:56:23 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 16 Jun 2005 09:56:23 -0700
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
Message-ID: <200506160956.23811.ian@ianduggan.net>


On Tuesday 14 June 2005 18:17, Jp Calderone wrote:
> >Does anyone know of any tools that could be used to wrap a python module
> > and capture/report blocking calls made by it?
>
> <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/btt.py> (and
> <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/test_btt.py>) might be of
> interest/use.  I haven't done much with it yet, so I don't know if it's
> actually effective.  I'd be interested to hear if you have any luck with
> it.

Heh, this is a very clever trick, setting and disabling an alarm in a looping 
call. If it doesn't get disabled in time, it tells you where the stack is. It 
actually works great! I was able to immediately test it by suspending twisted 
for a moment.

I had to tune the precisions it was using, to prevent it from firing 
spuriously when my laptop got busy, but otherwise it's very cool. I love 
simple.

Suggestions for anyone else who uses this:

1) Tune the precisions so that you have a quiet baseline.

2) If the network you are interacting with is too fast, find a way to throttle 
your connection. 

http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/Adv-Routing-HOWTO.html

--Ian



From ian at ianduggan.net  Thu Jun 16 11:04:06 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 16 Jun 2005 10:04:06 -0700
Subject: [Twisted-Python] -shutdown taps
In-Reply-To: <50a522ca05060915564410af98@mail.gmail.com>
References: <200506080927.33419.ian@ianduggan.net>
	<200506081048.28903.ian@ianduggan.net>
	<50a522ca05060915564410af98@mail.gmail.com>
Message-ID: <200506161004.06669.ian@ianduggan.net>


On Thursday 09 June 2005 15:56, Michael Twomey wrote:
> The biggest thing which will kill the data is running the original tap
> again, not the -shutdown one. Running the original tap will overwrite
> the old shutdown one with a fresh instance. Since this can happen

Ok, so it sounds like I did understand the issues. I mostly want this for 
surviving quick upgrades. The connection info stored is useless if it's more 
than a minute old or so, and it's not the end of the world it it gets tossed.

I actually want it to blow things away and start over in some cases. I'll have 
my startup script look for -shutdown first, and otherwise start normally. 
I'll probably throw in a flag to force it either way as well.

Maybe a feature to prevent overwriting the old -shutdown unless the 
application was loaded from it would be a useful feature? I.e., force it to 
create a differently named -shutdown if so configured, and maybe log 
warnings?

> After experimenting with it and losing my data repeatedly I just wrote
> the data I was interested in to a pickle. Since you have the
> stopService hook in services, you can whack the persistence stuff in
> there.

Thanks, this will probably be stage2.

--Ian




From narnett at liveworld.com  Thu Jun 16 16:25:46 2005
From: narnett at liveworld.com (Nick Arnett)
Date: Thu, 16 Jun 2005 15:25:46 -0700
Subject: [Twisted-Python] Conch SSH help?
Message-ID: <42B1FC6A.6060201@liveworld.com>

I'm getting stuck trying to do something I imagined would be easy in 
Conch.  I want to log into a server, ls a directory, then grep inside a 
certain file in each of the directories found by the ls command.

I've had no trouble logging in and running ls, then capturing its 
output.  But then I'm stuck.  I can't figure out where to put the loop 
through the directories.  I can see how to do one in a new channel, but 
I sure can't see how to run the series of them and capture their 
output.  I want to end up with a data structure that has the directory 
name and the results of the grep as a list: [(dir, grep_results),...].

I've tried calling my "grep" channel object repeatedly and that sort of 
works, but only does the first seven or eight and fails.  I've tried 
putting the loop in the channelOpen method of the "grep" channel and 
that never gets any results.  I tried building a series of callbacks in 
there and running it, but that doesn't work, either.

What I also find confusing is that I run the command with sendRequest, 
but the results come back in the dataReceived method -- how does it know 
which command's results it is receiving?

Any help will be appreciated.

Nick




From jarrod.roberson at gmail.com  Thu Jun 16 16:46:51 2005
From: jarrod.roberson at gmail.com (jarrod roberson)
Date: Thu, 16 Jun 2005 18:46:51 -0400
Subject: [Twisted-Python] Combine XMLRPC and PB in one server?
In-Reply-To: <d8m10u$nqd$1@sea.gmane.org>
References: <d8m10u$nqd$1@sea.gmane.org>
Message-ID: <2389d473050616154610751fe9@mail.gmail.com>

On 6/14/05, apocalypznow <apocalypznow at gmail.com> wrote:
> 
> How do you make a server that handles both XMLRPC and PB?
> 
> How do you do this as a service?
> 
> When I mean service, I mean as in the following code:
> 
> application = twisted.application.service.Application("pbserver")
> myService = twisted.application.service.IServiceCollection(application)
> 
> p = portal.Portal(DefaultRealm())
> dbu=twisted.cred.checkers.InMemoryUsernamePasswordDatabaseDontUse()
> dbu.addUser("user1","pass1")
> p.registerChecker(dbu)
> 
> myServer =
> twisted.application.internet.TCPServer(8080,pb.PBServerFactory(p))
> myServer.setServiceParent(myService)



this is really simple and is explained in the HOW TO multiple protocols.

short story is you have your Factories delegate to the same service.




-- 
If you don't know what you want, you probably need a nap.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050616/f7f5967a/attachment.html>

From ian at ianduggan.net  Thu Jun 16 17:25:31 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 16 Jun 2005 16:25:31 -0700
Subject: [Twisted-Python] Logging to multiple files
Message-ID: <200506161625.31552.ian@ianduggan.net>


Hi,

Anyone have any examples of logging to multiple files using the twisted 
logging framework? Ideally, I would like something like the logPrefix() 
functionality, only instead of prefixing lines, it would cause output to go 
to another logging source. Decorating classes, or using MixIns would be 
easiest.

Anything like that exist? I'm looking around in the code, but I'm getting 
confused between twisted.python.log, twisted.python.logging and the event 
archtiecture around the LogPublisher...

--Ian



From narnett at liveworld.com  Thu Jun 16 18:18:46 2005
From: narnett at liveworld.com (Nick Arnett)
Date: Thu, 16 Jun 2005 17:18:46 -0700
Subject: [Twisted-Python] Conch SSH help?
In-Reply-To: <42B1FC6A.6060201@liveworld.com>
References: <42B1FC6A.6060201@liveworld.com>
Message-ID: <42B216E6.4090409@liveworld.com>

To shed a  bit more light on this... I can get it to open 10 channels, 
then it's refusing to open more, which is the problem I'm now trying to 
solve.  But I can't figure out how to close the channels appropriately.  
I've tried putting a self.loseConnection in various places, but it 
doesn't seem to get called soon enough.

I guess what I really need to do is figure out how to only start one of 
these if the number of channels open is less than 10... which I'm 
guessing means using callbacks in the SSHConnection object...?

Nick




From kevin at electricanvil.com  Thu Jun 16 19:31:00 2005
From: kevin at electricanvil.com (Kevin Smith)
Date: Thu, 16 Jun 2005 21:31:00 -0400
Subject: [Twisted-Python] Using Deferreds
Message-ID: <42B227D4.2050306@electricanvil.com>

Getting my feet wet with Twisted and I've got a couple of questions
regarding Deferreds. To wit:

1) Is there a way to re-use Deferreds? It seems that a Deferred instance
is not usable after a callback has been triggered. When I try to trigger
a second callback on the same instance a AlreadyCalledError is raised.
Is there another approach I should be using?

2) I don't have a concrete reason for needing to do this, but is it
possible to remove a function registered as a callback from a Deferred?
I ask this question more out of curiosity rather than any practical need.

Thanks,
Kevin



From glyph at divmod.com  Thu Jun 16 20:31:29 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Thu, 16 Jun 2005 22:31:29 -0400
Subject: [Twisted-Python] Using Deferreds
In-Reply-To: <42B227D4.2050306@electricanvil.com>
References: <42B227D4.2050306@electricanvil.com>
Message-ID: <42B23601.9000100@divmod.com>

Kevin Smith wrote:

> 1) Is there a way to re-use Deferreds? It seems that a Deferred instance
> is not usable after a callback has been triggered. When I try to trigger
> a second callback on the same instance a AlreadyCalledError is raised.
> Is there another approach I should be using?

This is intentionally impossible.  A Deferred represents a single 
operation - there are no sensible semantics for re-starting a callback 
chain because you could add a new callback to a Deferred at any time.

> 2) I don't have a concrete reason for needing to do this, but is it
> possible to remove a function registered as a callback from a Deferred?
> I ask this question more out of curiosity rather than any practical need.

Nope.




From tom.cocagne at gmail.com  Thu Jun 16 22:06:16 2005
From: tom.cocagne at gmail.com (Tom Cocagne)
Date: Fri, 17 Jun 2005 00:06:16 -0400
Subject: [Twisted-Python] C++ implementation of Deferreds
Message-ID: <198edda90506162106729e2618@mail.gmail.com>

    Greetings all. 

    I'm curious to know if anyone has tried implementing a C++ version
of Twisted's Deferreds library. I've spent a day or so on an initial
prototype and it seems to be working out suprisingly well. Before I
put much more effort into it though, I thought I'd check to see if I'd
be reinventing the wheel with this one.

    Cheers,

    Tom



From z3p at twistedmatrix.com  Thu Jun 16 22:29:56 2005
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Fri, 17 Jun 2005 00:29:56 -0400
Subject: [Twisted-Python] Conch SSH help?
In-Reply-To: <42B216E6.4090409@liveworld.com>
References: <42B1FC6A.6060201@liveworld.com> <42B216E6.4090409@liveworld.com>
Message-ID: <1118982597.5248.7.camel@petra>

On Thu, 2005-06-16 at 17:18 -0700, Nick Arnett wrote:
> To shed a  bit more light on this... I can get it to open 10 channels, 
> then it's refusing to open more, which is the problem I'm now trying to 
> solve.  But I can't figure out how to close the channels appropriately.  
> I've tried putting a self.loseConnection in various places, but it 
> doesn't seem to get called soon enough.
> 
> I guess what I really need to do is figure out how to only start one of 
> these if the number of channels open is less than 10... which I'm 
> guessing means using callbacks in the SSHConnection object...?

Since you clearly have code demonstrating this problem, could you try to
fashion it into a minimal example and file a bug? (you can assign it to
me)  Also helpful would be the server you're trying to connect to.  It
may be that it's a problem on the server end.

-p
-- 
       Paul Swartz
(o_    http://z3p.livejournal.com/  _o)
//\    z3p at twistedmatrix.com        /\\
V_/_   AIM: z3penguin              _\_V->
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20050617/aee74035/attachment.sig>

From exarkun at divmod.com  Thu Jun 16 23:41:39 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Fri, 17 Jun 2005 01:41:39 -0400
Subject: [Twisted-Python] C++ implementation of Deferreds
In-Reply-To: <198edda90506162106729e2618@mail.gmail.com>
Message-ID: <20050617054139.5047.1390328222.divmod.quotient.4244@ohm>

On Fri, 17 Jun 2005 00:06:16 -0400, Tom Cocagne <tom.cocagne at gmail.com> wrote:
>    Greetings all.
>
>    I'm curious to know if anyone has tried implementing a C++ version
>of Twisted's Deferreds library. I've spent a day or so on an initial
>prototype and it seems to be working out suprisingly well. Before I
>put much more effort into it though, I thought I'd check to see if I'd
>be reinventing the wheel with this one.

http://svn.twistedmatrix.com/cvs/branches/foom/--omg-optimized/twisted/internet/cdefer/

Jp



From dguaraglia at gmx.de  Fri Jun 17 07:52:10 2005
From: dguaraglia at gmx.de (David Guaraglia)
Date: Fri, 17 Jun 2005 10:52:10 -0300
Subject: [Twisted-Python] Simple question
Message-ID: <42B2D58A.4050507@gmx.de>

Hello,

Maybe I'm being lazy not reading the whole documentation, but how can I 
get a (server) protocol to send an ACK to all connected clientes? Do I 
need to use  a separate thread or is there a way to set up a timer that 
goes off every X seconds?

Thanks in advance,

David



From sc at linux.it  Fri Jun 17 08:21:19 2005
From: sc at linux.it (Stefano Canepa)
Date: Fri, 17 Jun 2005 16:21:19 +0200
Subject: [Twisted-Python] Simple question
In-Reply-To: <42B2D58A.4050507@gmx.de>
References: <42B2D58A.4050507@gmx.de>
Message-ID: <1119018079.31337.39.camel@localhost.localdomain>

Il giorno ven, 17/06/2005 alle 10.52 -0300, David Guaraglia ha scritto:
> Hello,
> 
> Maybe I'm being lazy not reading the whole documentation, but how can I 
> get a (server) protocol to send an ACK to all connected clientes? Do I 
> need to use  a separate thread or is there a way to set up a timer that 
> goes off every X seconds?
> 
> Thanks in advance,

You were too lazy becouse it is written into:
http://twistedmatrix.com/users/warner/doc-latest/core/howto/time.html

Bye
Stefano

-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt di un programmatore: pigrizia, impazienza e arroganza.
                                                              (Larry Wall)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20050617/0e1da3e1/attachment.sig>

From sc at linux.it  Fri Jun 17 08:41:17 2005
From: sc at linux.it (Stefano Canepa)
Date: Fri, 17 Jun 2005 16:41:17 +0200
Subject: [Twisted-Python] timeout and retries
Message-ID: <1119019277.31337.47.camel@localhost.localdomain>

The following code is a try to write a protocol with timeout and
retries. The connectioMade is used only as a test. I have some problems:
1) even if I placed "\x01" as delimiter the line is sent not terminated
2) even if timeout expired 3 times the success callback is called

Were is my mistake?

Secondly I will prefer to leave the protocol as simple as passible and
put all implementation details into the factory. I was unable to do
this, any suggestion would be of big help.

Thanks very much
Stefano

#!/usr/bin/env python
#
# Twisted modules 
#
from twisted.internet.protocol import ClientFactory
from twisted.protocols.basic import LineReceiver
from twisted.internet import reactor, defer
#
# Python modules
#
import re
#
# if it exists load configuration file
#
try:
    import HL7LLPClientConfig
except:
    #
    # else use defaults
    #
    TIMEOUT = 10
    PORT = 3000
    SERVER = 'localhost'
    RETRIES = 3
    pass

class HL7LLPClientProtocol(LineReceiver):
    """
    HL7 Lower Level Protocol initiating module implementation.
    It sends a packet, waits ACK/NACK or timeout in case of failure
    retries RETRIES times
    """
    # delimiter is set to <EB> (\x02 i.e. STX) so that the whole HL7
message
    # can be considered as a string
    delimiter = "\x02"
    msg = ""

    def __init__(self):
        self.ackMSG = re.compile("\x01\x06")
        self.nackMSG = re.compile("\x01\x15")

    def connectionMade(self):
        self.sendMsg("MSH|||||||||||")
        
    def sendMsg(self, msg, numRetries=RETRIES):
        """
        Store the message to be used by derived classes, send the
message and
        return a deferred
        """
        self.msg = msg
        self.sendLine(msg)
        return self.timeoutAndRetry(numRetries)
        
    def sendLine(self, msg):
        """
        Add <SB> (\x01 i.e. SOH) at the start of message as required by
        HL7 standard and send the message
        """
        msgToSend = "\x01"+msg
        print msgToSend
        self.transport.write(msgToSend)
        print "written"

    def lineReceived(self, response):
        """
        It receives the answer store it for use in the derived class and
        verify if it is ACK or NACK to cancel the timeout, every other
        string received is not valid answer so timeout continues to tick
        """
        m = self.ackMSG.match(response)
        n = self.nackMSG.match(response)
        if m or n:
            self.delayedCall.cancel()
            self.delayedCall = None  
        self.somethingResult.callback()
        self.somethingResult = None

    def timeoutAndRetry(self, n):
        """
        Create a deferred, fire the delayedCall, and return the deferred
        """
        d = defer.Deferred() 
        d.addErrback(self.tooManyRetries)
        d.addCallback(self.success)
        c = reactor.callLater(10, self._timeout, n)
        self.somethingResult, self.delayedCall = d, c
        return d
 
    def _timeout(self, n):
        """
        Retry to send if possible or raise and exception
        """
        print n
        if n > 0:
            d = self.somethingResult
            #self.sendMsg(self.msg, n - 1).chainDeferred(d)
            self.sendMsg(self.msg, n - 1)
        else:
            self.somethingResult.errback(Exception("TooManyRetries"))
            self.somethingResult = None

    def timeOutFailure(self, reason):
        """
        Don't know what to do in case of timeout
        """
        print "timeout failure %s " % reason

    def tooManyRetries(self, reason):
        """
        Don't know what to do in case of non timeout failure
        """
        print "non timeout failure %s" % reason

    def success(self, reason):
        """
        Don't know what to do in case of success
        """
        print "success %s" % reason
        
class HL7LLPClientFactory(ClientFactory):
   
    protocol = HL7LLPClientProtocol

def main():
    factory = HL7LLPClientFactory()
    reactor.connectTCP(SERVER, PORT, factory)
    reactor.run()

if __name__ == "__main__":
    main()


-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt di un programmatore: pigrizia, impazienza e arroganza.
                                                              (Larry Wall)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20050617/33b9b72f/attachment.sig>

From shiznitmatt at yahoo.com  Fri Jun 17 09:10:11 2005
From: shiznitmatt at yahoo.com (Matt Doherty)
Date: Fri, 17 Jun 2005 08:10:11 -0700 (PDT)
Subject: [Twisted-Python] Want an ICMP implementation?
Message-ID: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>

I did an ICMP protocol and a transport that's along
the lines of twistet.internet.udp. Is anyone
interested in it enough that I should submit it?
-Matt


		
____________________________________________________ 
Yahoo! Sports 
Rekindle the Rivalries. Sign up for Fantasy Football 
http://football.fantasysports.yahoo.com



From dguaraglia at gmx.de  Fri Jun 17 09:29:52 2005
From: dguaraglia at gmx.de (David Guaraglia)
Date: Fri, 17 Jun 2005 12:29:52 -0300
Subject: [Twisted-Python] Want an ICMP implementation?
In-Reply-To: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>
References: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>
Message-ID: <42B2EC70.6060106@gmx.de>

Well it wouldn't be out of place in Twisted. Maybe you should contact 
one of the developers to include it in the main package :)

David

Matt Doherty wrote:

>I did an ICMP protocol and a transport that's along
>the lines of twistet.internet.udp. Is anyone
>interested in it enough that I should submit it?
>-Matt
>
>
>		
>____________________________________________________ 
>Yahoo! Sports 
>Rekindle the Rivalries. Sign up for Fantasy Football 
>http://football.fantasysports.yahoo.com
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>  
>




From narnett at liveworld.com  Fri Jun 17 09:41:47 2005
From: narnett at liveworld.com (Nick Arnett)
Date: Fri, 17 Jun 2005 08:41:47 -0700
Subject: [Twisted-Python] Conch SSH help?
In-Reply-To: <1118982597.5248.7.camel@petra>
References: <42B1FC6A.6060201@liveworld.com> <42B216E6.4090409@liveworld.com>
	<1118982597.5248.7.camel@petra>
Message-ID: <42B2EF3B.3050603@liveworld.com>

Paul Swartz wrote:

>Since you clearly have code demonstrating this problem, could you try to
>fashion it into a minimal example and file a bug? (you can assign it to
>me)  Also helpful would be the server you're trying to connect to.  It
>may be that it's a problem on the server end.
>
The bug would be...?  The failure of loseConnection()?  I'm not sure 
that's really a bug -- I think maybe it's a timing issue.  I'm about to 
try a couple of things in that regard.  I guess the problem as I now see 
it is a design issue -- the use of the "dataReceived" method, which is 
so different from the usual way a callback passes results.  But I'm not 
at all sure that I understand how I'm supposed to be using this.

As for the server, it's a generic sshd on Solaris.

Digging into the source a bit more, I think I could make a reasonable 
bug report.  I see in the source that channelClosed should always be 
called (which the example doesn't do).  But it fails because it uses 
channel_id, which is out of scope here.  I tried changing all of the 
occurrences of channel_id to self-channel_id, which seemed more 
reasonable... but then I'm getting key errors when it is used for a 
lookup in the localToRemoteChannel dict.

So... rather than just making a bug report, I'll see if I can't figure 
out how to fix all this, since it seems to be scope problems.  I really 
need to get something working and this module seems to be better than 
the other Python SSH gizmos I've tried.  (And even though debugging 
Twisted drives me crazy, I sure like what it does when it works.)

Nick









From shiznitmatt at yahoo.com  Fri Jun 17 09:50:14 2005
From: shiznitmatt at yahoo.com (Matt Doherty)
Date: Fri, 17 Jun 2005 08:50:14 -0700 (PDT)
Subject: [Twisted-Python] Want an ICMP implementation?
In-Reply-To: <42B2EC70.6060106@gmx.de>
Message-ID: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>

How do I do that?

--- David Guaraglia <dguaraglia at gmx.de> wrote:

> Well it wouldn't be out of place in Twisted. Maybe
> you should contact 
> one of the developers to include it in the main
> package :)
> 
> David
> 
> Matt Doherty wrote:
> 
> >I did an ICMP protocol and a transport that's along
> >the lines of twistet.internet.udp. Is anyone
> >interested in it enough that I should submit it?
> >-Matt
> >
> >
> >		
>
>____________________________________________________
> 
> >Yahoo! Sports 
> >Rekindle the Rivalries. Sign up for Fantasy
> Football 
> >http://football.fantasysports.yahoo.com
> >
> >_______________________________________________
> >Twisted-Python mailing list
> >Twisted-Python at twistedmatrix.com
>
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> >
> >
> >  
> >
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
>
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 



		
____________________________________________________ 
Yahoo! Sports 
Rekindle the Rivalries. Sign up for Fantasy Football 
http://football.fantasysports.yahoo.com



From projects at reedflute.com  Fri Jun 17 10:01:53 2005
From: projects at reedflute.com (Eugene Coetzee)
Date: Fri, 17 Jun 2005 18:01:53 +0200
Subject: [Twisted-Python] Want an ICMP implementation?
In-Reply-To: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>
References: <20050617151011.72841.qmail@web32904.mail.mud.yahoo.com>
Message-ID: <42B2F3F1.4000704@reedflute.com>

Matt Doherty wrote:

>I did an ICMP protocol and a transport that's along
>the lines of twistet.internet.udp. Is anyone
>interested in it enough that I should submit it?
>-Matt
>  
>
I will have plenty of use for an ICMP implementation in Twisted.

regards,

Eugene coetzee


Web                 -> www.reedflute.com
=============================================== 




From itamar at itamarst.org  Fri Jun 17 10:06:44 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 17 Jun 2005 12:06:44 -0400
Subject: [Twisted-Python] Adding new code to Twisted
In-Reply-To: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>
References: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>
Message-ID: <1119024405.8741.35.camel@localhost.localdomain>

On Fri, 2005-06-17 at 08:50 -0700, Matt Doherty wrote:
> How do I do that?

Add patches or new modules, with tests of course :), to
http://twistedmatrix.com/bugs/ - at some point one of us will take a
look at it.

-- 
Itamar Shtull-Trauring <itamar at itamarst.org>
http://itamarst.org




From dguaraglia at gmx.de  Fri Jun 17 10:30:37 2005
From: dguaraglia at gmx.de (David Guaraglia)
Date: Fri, 17 Jun 2005 13:30:37 -0300
Subject: [Twisted-Python] Want an ICMP implementation?
In-Reply-To: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>
References: <20050617155014.39922.qmail@web32903.mail.mud.yahoo.com>
Message-ID: <42B2FAAD.5030002@gmx.de>

Well, theoretically the developers read this mailing lists from time to 
time, but maybe the best way is to enter the #twisted channel in 
irc.freenode.net, and contact them there (they are very responsive).

Good luck!

David

Matt Doherty wrote:

>How do I do that?
>
>--- David Guaraglia <dguaraglia at gmx.de> wrote:
>
>  
>
>>Well it wouldn't be out of place in Twisted. Maybe
>>you should contact 
>>one of the developers to include it in the main
>>package :)
>>
>>David
>>
>>Matt Doherty wrote:
>>
>>    
>>
>>>I did an ICMP protocol and a transport that's along
>>>the lines of twistet.internet.udp. Is anyone
>>>interested in it enough that I should submit it?
>>>-Matt
>>>
>>>
>>>		
>>>      
>>>
>>____________________________________________________
>>
>>    
>>
>>>Yahoo! Sports 
>>>Rekindle the Rivalries. Sign up for Fantasy
>>>      
>>>
>>Football 
>>    
>>
>>>http://football.fantasysports.yahoo.com
>>>
>>>_______________________________________________
>>>Twisted-Python mailing list
>>>Twisted-Python at twistedmatrix.com
>>>      
>>>
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>    
>>
>>> 
>>>
>>>      
>>>
>>_______________________________________________
>>Twisted-Python mailing list
>>Twisted-Python at twistedmatrix.com
>>
>>    
>>
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>  
>
>
>
>
>		
>____________________________________________________ 
>Yahoo! Sports 
>Rekindle the Rivalries. Sign up for Fantasy Football 
>http://football.fantasysports.yahoo.com
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>  
>




From dgray at omniti.com  Fri Jun 17 10:51:01 2005
From: dgray at omniti.com (Dave Gray)
Date: Fri, 17 Jun 2005 12:51:01 -0400
Subject: [Twisted-Python] Strange exception deep in twisted
In-Reply-To: <6fb6dbfe050615125170c4adf3@mail.gmail.com>
References: <6fb6dbfe050615125170c4adf3@mail.gmail.com>
Message-ID: <42B2FF75.7070201@omniti.com>

Matt Feifarek wrote:
> -----------------------
> Unhandled error in Deferred:
> Traceback (most recent call last):
[snip]
>   File "/usr/lib/python2.4/site-packages/twisted/protocols/http.py",
> line 447, in _cleanup
>     self.channel.requestDone(self)
> 
> exceptions.AttributeError: Request instance has no attribute 'channel'

I see errors like these when Deferreds fail and don't handle the error 
somehow and then, later on, get garbage collected. Perhaps this 
exception isn't happening exactly when you think it is?

<http://twisted.sourceforge.net/TwistedDocs-1.3.0/howto/defer.html#auto9>



From tom.cocagne at gmail.com  Fri Jun 17 11:00:43 2005
From: tom.cocagne at gmail.com (Tom Cocagne)
Date: Fri, 17 Jun 2005 13:00:43 -0400
Subject: [Twisted-Python] Re: C++ implementation of Deferreds
In-Reply-To: <20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
References: <198edda90506162106729e2618@mail.gmail.com>
	<20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
Message-ID: <198edda9050617100072fb91df@mail.gmail.com>

    Thanks for the link JP. I didn't know anyone was looking into
combining Twisted with Pyrex, it's good to see.
After re-reading my message, I can see that I wasn't very clear.

On 6/17/05, Jp Calderone <exarkun at divmod.com> wrote:
> On Fri, 17 Jun 2005 00:06:16 -0400, Tom Cocagne <tom.cocagne at gmail.com>
> wrote:
> >    Greetings all.
> >
> >    I'm curious to know if anyone has tried implementing a C++ version
> >of Twisted's Deferreds library. I've spent a day or so on an initial
> >prototype and it seems to be working out suprisingly well. Before I
> >put much more effort into it though, I thought I'd check to see if I'd
> >be reinventing the wheel with this one.
> 
> http://svn.twistedmatrix.com/cvs/branches/foom/--omg-optimized/twisted/internet/cdefer/
> 
> Jp
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From tom.cocagne at gmail.com  Fri Jun 17 11:03:37 2005
From: tom.cocagne at gmail.com (Tom Cocagne)
Date: Fri, 17 Jun 2005 13:03:37 -0400
Subject: [Twisted-Python] Re: C++ implementation of Deferreds
In-Reply-To: <20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
References: <198edda90506162106729e2618@mail.gmail.com>
	<20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
Message-ID: <198edda905061710037fb451c3@mail.gmail.com>

    Thanks for the link JP. I didn't know anyone was looking into
combining Twisted with Pyrex, it's good to see.
    After re-reading my message, I can see that I wasn't very clear.
I'm actually looking for a Deferred implementation as a library that's
usable from C++ rather than a C/C++ implementation to speed up
Twisted. I'm working on a hybrid Python / C++ project and would like
to be able to use the same Deferred mechanism within C++ that I get
from Twisted + Python.

    Cheers,

    Tom

On 6/17/05, Jp Calderone <exarkun at divmod.com> wrote:
> On Fri, 17 Jun 2005 00:06:16 -0400, Tom Cocagne <tom.cocagne at gmail.com>
> wrote:
> >    Greetings all.
> >
> >    I'm curious to know if anyone has tried implementing a C++ version
> >of Twisted's Deferreds library. I've spent a day or so on an initial
> >prototype and it seems to be working out suprisingly well. Before I
> >put much more effort into it though, I thought I'd check to see if I'd
> >be reinventing the wheel with this one.
> 
> http://svn.twistedmatrix.com/cvs/branches/foom/--omg-optimized/twisted/internet/cdefer/
> 
> Jp
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From itamar at itamarst.org  Fri Jun 17 11:13:56 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 17 Jun 2005 13:13:56 -0400
Subject: [Twisted-Python] Re: C++ implementation of Deferreds
In-Reply-To: <198edda905061710037fb451c3@mail.gmail.com>
References: <198edda90506162106729e2618@mail.gmail.com>
	<20050617054139.5047.1390328222.divmod.quotient.4244@ohm>
	<198edda905061710037fb451c3@mail.gmail.com>
Message-ID: <1119028436.8741.41.camel@localhost.localdomain>

On Fri, 2005-06-17 at 13:03 -0400, Tom Cocagne wrote:

>     After re-reading my message, I can see that I wasn't very clear.
> I'm actually looking for a Deferred implementation as a library that's
> usable from C++ rather than a C/C++ implementation to speed up
> Twisted. I'm working on a hybrid Python / C++ project and would like
> to be able to use the same Deferred mechanism within C++ that I get
> from Twisted + Python.

That does sound useful. I've written Fusion
(http://itamarst.org/software/) which lets you implement Twisted
protocols in C++. Adding a Deferred-like class to that would be nice. If
this class could, via some automagic, also hook up to Python Deferreds
that would be even better.




From z3p at twistedmatrix.com  Fri Jun 17 11:43:38 2005
From: z3p at twistedmatrix.com (Paul Swartz)
Date: Fri, 17 Jun 2005 13:43:38 -0400
Subject: [Twisted-Python] Conch SSH help?
In-Reply-To: <42B1FC6A.6060201@liveworld.com>
References: <42B1FC6A.6060201@liveworld.com>
Message-ID: <1119030220.5248.13.camel@petra>

On Thu, 2005-06-16 at 15:25 -0700, Nick Arnett wrote:
> I'm getting stuck trying to do something I imagined would be easy in 
> Conch.  I want to log into a server, ls a directory, then grep inside a 
> certain file in each of the directories found by the ls command.
> 
> I've had no trouble logging in and running ls, then capturing its 
> output.  But then I'm stuck.  I can't figure out where to put the loop 
> through the directories.  I can see how to do one in a new channel, but 
> I sure can't see how to run the series of them and capture their 
> output.  I want to end up with a data structure that has the directory 
> name and the results of the grep as a list: [(dir, grep_results),...].

It sounds like you want something like DeferredList.

> I've tried calling my "grep" channel object repeatedly and that sort of 
> works, but only does the first seven or eight and fails.  I've tried 
> putting the loop in the channelOpen method of the "grep" channel and 
> that never gets any results.  I tried building a series of callbacks in 
> there and running it, but that doesn't work, either.

What fails?  Does the channel fail to open?  Does it return the wrong
results?

> What I also find confusing is that I run the command with sendRequest, 
> but the results come back in the dataReceived method -- how does it know 
> which command's results it is receiving?

sendRequest tells the server what command to run.  The server runs that
command, and connects stdout/stdin to the SSH connection.  dataReceived
is then called with the data from stdout.

If you can get the code even into one file, that would be helpful.  It's
hard to know quite what's going on without seeing what you're doing.

-p
-- 
       Paul Swartz
(o_    http://z3p.livejournal.com/  _o)
//\    z3p at twistedmatrix.com        /\\
V_/_   AIM: z3penguin              _\_V->
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20050617/5c689b98/attachment.sig>

From pp64 at codelock.com  Fri Jun 17 13:08:26 2005
From: pp64 at codelock.com (Pavel Pergamenshchik)
Date: Fri, 17 Jun 2005 12:08:26 -0700
Subject: [Twisted-Python] Using Deferreds
In-Reply-To: <42B227D4.2050306@electricanvil.com>
References: <42B227D4.2050306@electricanvil.com>
Message-ID: <20050617120826.71f3afa2@dunce>

On Thu, 16 Jun 2005 21:31:00 -0400
Kevin Smith <kevin at electricanvil.com> wrote:

> Getting my feet wet with Twisted and I've got a couple of questions
> regarding Deferreds. To wit:
> 
> 1) Is there a way to re-use Deferreds? It seems that a Deferred instance
> is not usable after a callback has been triggered. When I try to trigger
> a second callback on the same instance a AlreadyCalledError is raised.
> Is there another approach I should be using?
> 
> 2) I don't have a concrete reason for needing to do this, but is it
> possible to remove a function registered as a callback from a Deferred?
> I ask this question more out of curiosity rather than any practical need.

Perhaps http://pydispatcher.sf.net is something that would suit you better.


P.S.: You people! Use pydispatcher more! It's totally awesome.



From liiwi at lonesom.pp.fi  Fri Jun 17 15:57:38 2005
From: liiwi at lonesom.pp.fi (Jaakko Niemi)
Date: Sat, 18 Jun 2005 00:57:38 +0300
Subject: [Twisted-Python] cred + PAM
In-Reply-To: <42AF526C.4030909@divmod.com>
References: <20050614201958.GA26005@jumper.lonesom.pp.fi>
	<42AF526C.4030909@divmod.com>
Message-ID: <20050617215738.GA28284@jumper.lonesom.pp.fi>

On Tue, 14 Jun 2005, Glyph Lefkowitz wrote:
> Jaakko Niemi wrote:
> > Hello,
> >
> > If you are interested of getting PAM support to cred, take a peek at:
> 
> Awesome!  I will definitely have a look at this soon.  I've wanted to 
> support PAM since day 1 with cred :)

 One issue is that some pam-modules want uid 0, and I at least
 don't want my stuff to run as root, if I can avoid it.
 
 Anyone got better idea than suid-wrapper that takes in user
 credentials and gives back yea/nay ?

		--j



From foom at fuhm.net  Fri Jun 17 19:40:18 2005
From: foom at fuhm.net (James Y Knight)
Date: Fri, 17 Jun 2005 21:40:18 -0400
Subject: [Twisted-Python] twisted.web2 0.1.0 released
Message-ID: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>

I'm happy to announce the first release of twisted.web2 today. This  
is a rewrite/refactor of the twisted.web HTTP server and framework,  
providing a nicer API (some parts inspired by the resource API that  
Nevow introduced on top of twisted.web) and many internal  
improvements, especially in the area of HTTP conformance.

Some highlights:
- Fully asynchronous twisted server.
- Can run as a HTTP/HTTPS server, or behind an apache mod_proxy, or  
serve requests via SCGI, or even just plain CGI.
- Supports SCGI clients, CGI scripts, WSGI applications. No new HTTP  
client/proxy yet, it's still on the TODO list.
- Also supports most twisted.web resources through a compatibility  
layer.
- Implements HTTP 1.1, including keep-alive, chunking, and pipelining.
- Has premade, correct, header parsers and generators for most of the  
headers.
- Supports streaming data input and output, has a nonblocking  
multipart/form-data parser.
- Automatic support for If-[Un]Modified-Since, If-[None-]Match and  
Range.

You can find downloads and documentation here:
     http://twistedmatrix.com/projects/web2/
You'll need at least Twisted 2.0.1 as well:
     http://twistedmatrix.com/projects/core/


This is still a preliminary release -- the API is not guaranteed to  
be stable to the next release.

James



From corydodt at twistedmatrix.com  Fri Jun 17 23:35:45 2005
From: corydodt at twistedmatrix.com (Cory Dodt)
Date: Fri, 17 Jun 2005 21:35:45 -0800
Subject: [Twisted-Python] Re: [Twisted-web] twisted.web2 0.1.0 released
In-Reply-To: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>
References: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>
Message-ID: <42B3B2B1.6000800@twistedmatrix.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Congratulations.  I'm looking forward to integrating it into Vellum.

C


James Y Knight wrote:
> I'm happy to announce the first release of twisted.web2 today. This  is
> a rewrite/refactor of the twisted.web HTTP server and framework, 
> providing a nicer API (some parts inspired by the resource API that 
> Nevow introduced on top of twisted.web) and many internal  improvements,
> especially in the area of HTTP conformance.
> 
> Some highlights:
> - Fully asynchronous twisted server.
> - Can run as a HTTP/HTTPS server, or behind an apache mod_proxy, or 
> serve requests via SCGI, or even just plain CGI.
> - Supports SCGI clients, CGI scripts, WSGI applications. No new HTTP 
> client/proxy yet, it's still on the TODO list.
> - Also supports most twisted.web resources through a compatibility  layer.
> - Implements HTTP 1.1, including keep-alive, chunking, and pipelining.
> - Has premade, correct, header parsers and generators for most of the 
> headers.
> - Supports streaming data input and output, has a nonblocking 
> multipart/form-data parser.
> - Automatic support for If-[Un]Modified-Since, If-[None-]Match and  Range.
> 
> You can find downloads and documentation here:
>     http://twistedmatrix.com/projects/web2/
> You'll need at least Twisted 2.0.1 as well:
>     http://twistedmatrix.com/projects/core/
> 
> 
> This is still a preliminary release -- the API is not guaranteed to  be
> stable to the next release.
> 
> James
> 
> _______________________________________________
> Twisted-web mailing list
> Twisted-web at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.5 (MingW32)
Comment: Using GnuPG with Thunderbird - http://enigmail.mozdev.org

iD8DBQFCs7Kk3A5SrXAiHQcRAtZQAJ0S+POf5U1dXsiQhasMiiqkR225zwCfUDbk
pFMvN9zJPRRjrgXWViGnnB0=
=ONdu
-----END PGP SIGNATURE-----



From andrew-twisted at puzzling.org  Sat Jun 18 04:34:49 2005
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Sat, 18 Jun 2005 20:34:49 +1000
Subject: [Twisted-Python] timeout and retries
In-Reply-To: <1119019277.31337.47.camel@localhost.localdomain>
References: <1119019277.31337.47.camel@localhost.localdomain>
Message-ID: <20050618103449.GA12957@trogdor.home.puzzling.org>

On Fri, Jun 17, 2005 at 04:41:17PM +0200, Stefano Canepa wrote:
> The following code is a try to write a protocol with timeout and
> retries. The connectioMade is used only as a test. I have some problems:
> 1) even if I placed "\x01" as delimiter the line is sent not terminated
[...]
>     def sendLine(self, msg):
>         """
>         Add <SB> (\x01 i.e. SOH) at the start of message as required by
>         HL7 standard and send the message
>         """
>         msgToSend = "\x01"+msg
>         print msgToSend
>         self.transport.write(msgToSend)
>         print "written"

You've overridden LineReceiver's sendLine to ignore the delimiter attribute.

> 2) even if timeout expired 3 times the success callback is called
[...]
>         d = defer.Deferred() 
>         d.addErrback(self.tooManyRetries)
>         d.addCallback(self.success)

Read the description of how callback/errback chains work again:

    http://twistedmatrix.com/projects/core/documentation/howto/defer.html#auto2

You probably meant:

        d = defer.Deferred() 
        d.addCallbacks(self.success, self.tooManyRetries)

Which has a subtly different meaning.

-Andrew.




From exarkun at divmod.com  Sat Jun 18 12:58:20 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sat, 18 Jun 2005 14:58:20 -0400
Subject: [Twisted-Python] Fwd: [Twisted-commits] r11032 - Made LineReceiver
 about 3x as fast, and clarified some of the docstrings.
In-Reply-To: 0
Message-ID: <20050618185820.5047.1935189464.divmod.quotient.5049@ohm>

Begin forwarded message:

> From: James Knight <foom at wolfwood.twistedmatrix.com>
> Date: Tue, 06 Jul 2004 13:53:09 -0600
> To: twisted-commits at twistedmatrix.com
> Subject: [Twisted-commits] r11032 - Made LineReceiver about 3x as fast,
	and clarified some of the docstrings.
> Reply-to: twisted-python at twistedmatrix.com
> 
> Author: foom
>Date: Tue Jul  6 13:53:08 2004
>New Revision: 11032
>
>Modified:
>   trunk/twisted/protocols/basic.py
>Log:
>Made LineReceiver about 3x as fast, and clarified some of the docstrings.
>
>
>
>Modified: trunk/twisted/protocols/basic.py
>==============================================================================
>--- trunk/twisted/protocols/basic.py	(original)
>+++ trunk/twisted/protocols/basic.py	Tue Jul  6 13:53:08 2004
>@@ -204,24 +204,31 @@
>         rawDataReceived, depending on mode.)
>         """
>         self.__buffer = self.__buffer+data
>+        lastoffset=0
>         while self.line_mode:
>-            try:
>-                line, self.__buffer = self.__buffer.split(self.delimiter, 1)
>-            except ValueError:
>+            offset=self.__buffer.find(self.delimiter, lastoffset)
>+            if offset == -1:
>+                self.__buffer=self.__buffer[lastoffset:]
>                 if len(self.__buffer) > self.MAX_LENGTH:
>-                    line, self.__buffer = self.__buffer, ''
>+                    line=self.__buffer
>+                    self.__buffer=''
>                     return self.lineLengthExceeded(line)
>                 break
>-            else:
>-                linelength = len(line)
>-                if linelength > self.MAX_LENGTH:
>-                    line, self.__buffer = self.__buffer, ''
>-                    return self.lineLengthExceeded(line)
>-                why = self.lineReceived(line)
>-                if why or self.transport and self.transport.disconnecting:
>-                    return why
>+
>+            line=self.__buffer[lastoffset:offset]
>+            lastoffset=offset+len(self.delimiter)
>+
>+            if len(line) > self.MAX_LENGTH:
>+                line=self.__buffer[lastoffset:]
>+                self.__buffer=''
>+                return self.lineLengthExceeded(line)
>+            why = self.lineReceived(line)
>+            if why or self.transport and self.transport.disconnecting:
>+                self.__buffer = self.__buffer[lastoffset:]
>+                return why
>         else:
>-            data, self.__buffer = self.__buffer, ''
>+            data=self.__buffer[lastoffset:]
>+            self.__buffer=''
>             if data:
>                 return self.rawDataReceived(data)
>

This changes dataReceived to call down into user code while the LineReceiver's instance attributes are in an inconsistent state.  This can lead to duplicate data delivery if dataReceived is called into from lineReceived.  Normally this sounds like a ridiculous thing to do, but notice the implementation of resumeProducing():

     def resumeProducing(self):
         self.paused = False
         self.dataReceived('')
         self.transport.resumeProducing()

Since resumeProducing is called immediately when a producer is registered, this means LineReceivers can no longer register themselves as producers for their transports from lineReceived, which is a much more reasonable thing to do.

Demonstration of the bug in action attached.

Jp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: linetest.py
Type: text/x-python
Size: 618 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050618/e47e28dd/attachment-0002.py>

From sc at linux.it  Sat Jun 18 14:11:46 2005
From: sc at linux.it (Stefano Canepa)
Date: Sat, 18 Jun 2005 22:11:46 +0200
Subject: [Twisted-Python] timeout and retries
In-Reply-To: <20050618103449.GA12957@trogdor.home.puzzling.org>
References: <1119019277.31337.47.camel@localhost.localdomain>
	<20050618103449.GA12957@trogdor.home.puzzling.org>
Message-ID: <1119125506.7855.4.camel@localhost.localdomain>

Il giorno sab, 18/06/2005 alle 20.34 +1000, Andrew Bennetts ha scritto:
> On Fri, Jun 17, 2005 at 04:41:17PM +0200, Stefano Canepa wrote:
> > The following code is a try to write a protocol with timeout and
> > retries. The connectioMade is used only as a test. I have some problems:
> > 1) even if I placed "\x01" as delimiter the line is sent not terminated
> [...]
> >     def sendLine(self, msg):
> >         """
> >         Add <SB> (\x01 i.e. SOH) at the start of message as required by
> >         HL7 standard and send the message
> >         """
> >         msgToSend = "\x01"+msg
> >         print msgToSend
> >         self.transport.write(msgToSend)
> >         print "written"
> 
> You've overridden LineReceiver's sendLine to ignore the delimiter attribute.

Thanks I was able to find this error by my own. Thanks.

> > 2) even if timeout expired 3 times the success callback is called
> [...]
> >         d = defer.Deferred() 
> >         d.addErrback(self.tooManyRetries)
> >         d.addCallback(self.success)
> 
> Read the description of how callback/errback chains work again:
> 
>     http://twistedmatrix.com/projects/core/documentation/howto/defer.html#auto2
> 
> You probably meant:
> 
>         d = defer.Deferred() 
>         d.addCallbacks(self.success, self.tooManyRetries)
>
> Which has a subtly different meaning.

Now I see the difference, I am really new to twisted and even if I read
the howto and all docs I found on twisted site I need to read all again
to understand better.

Thanks
Stefano

-- 
Stefano Canepa aka sc: sc at linux.it  http://www.stefanocanepa.it
Three great virtues of a programmer: laziness, impatience and hubris.
Le tre grandi virt di un programmatore: pigrizia, impazienza e arroganza.
                                                              (Larry Wall)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20050618/5974f1e3/attachment.sig>

From en.karpachov at ospaz.ru  Sun Jun 19 07:57:12 2005
From: en.karpachov at ospaz.ru (en.karpachov at ospaz.ru)
Date: Sun, 19 Jun 2005 17:57:12 +0400
Subject: [Twisted-Python] twisted.web2 0.1.0 released
In-Reply-To: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>
References: <C2BD6265-023D-4A8A-AEBE-70200B7ECF9C@fuhm.net>
Message-ID: <20050619135711.GB10607@ospaz.ru>

On Fri, Jun 17, 2005 at 09:40:18PM -0400, James Y Knight wrote:
> I'm happy to announce the first release of twisted.web2 today. This  

So how to deal with sessions now? It looks like this part is, well,
unstable yet. Is there some working method?

I also have a minor patch.

-- 
jk
-------------- next part --------------
diff -r -U 3 TwistedWeb2-0.1.orig/twisted/web2/server.py TwistedWeb2-0.1/twisted/web2/server.py
--- TwistedWeb2-0.1.orig/twisted/web2/server.py	2005-06-17 05:34:13.000000000 +0400
+++ TwistedWeb2-0.1/twisted/web2/server.py	2005-06-19 13:08:53.000000000 +0400
@@ -200,7 +200,7 @@
         if port == http.defaultPortForScheme.get(scheme, 0):
             hostport = host
         else:
-            hostport = host + ':' + port
+            hostport = host + ':' + str(port)
         
         return urlparse.urlunparse((
             scheme, hostport, path,

From foom at fuhm.net  Sun Jun 19 17:51:35 2005
From: foom at fuhm.net (James Y Knight)
Date: Sun, 19 Jun 2005 19:51:35 -0400
Subject: [Twisted-Python] Fwd: [Twisted-commits] r11032 - Made
	LineReceiver about 3x as fast, and clarified some of the docstrings.
In-Reply-To: <20050618185820.5047.1935189464.divmod.quotient.5049@ohm>
References: <20050618185820.5047.1935189464.divmod.quotient.5049@ohm>
Message-ID: <8524CF2E-3B48-40CA-B64F-06F7FB2A397F@fuhm.net>


On Jun 18, 2005, at 2:58 PM, Jp Calderone wrote:
> This changes dataReceived to call down into user code while the  
> LineReceiver's instance attributes are in an inconsistent state.   
> This can lead to duplicate data delivery if dataReceived is called  
> into from lineReceived.  Normally this sounds like a ridiculous  
> thing to do, but notice the implementation of resumeProducing():
>
>     def resumeProducing(self):
>         self.paused = False
>         self.dataReceived('')
>         self.transport.resumeProducing()
>
> Since resumeProducing is called immediately when a producer is  
> registered, this means LineReceivers can no longer register  
> themselves as producers for their transports from lineReceived,  
> which is a much more reasonable thing to do.
>
> Demonstration of the bug in action attached.

Two things about that:
1) resumeProducing actually now says:
     def resumeProducing(self):
         self.paused = False
         self.transport.resumeProducing()
         self.dataReceived('')

This was changed because of <http://twistedmatrix.com/pipermail/ 
twisted-python/2005-February/009626.html> also <http:// 
twistedmatrix.com/bugs/issue899>.

However, if resumeProducing is allowed to immediately produce data,  
this is somewhat bogus, as it could reverse the order of the data. In  
reality, a TCP transport's resumeProducing will not immediately  
produce data, but I think that's a fragile API to both have  
resumeProducing immediately produce data, and depend on a call to  
someone else resumeProducing not immediately producing data. I think  
there's an issue here.

2) dataReceived can be easily fixed to handle this by using a local  
-- patch coming separately.

James



From foom at fuhm.net  Sun Jun 19 18:47:56 2005
From: foom at fuhm.net (James Y Knight)
Date: Sun, 19 Jun 2005 20:47:56 -0400
Subject: [Twisted-Python] Fwd: [Twisted-commits] r11032 - Made
	LineReceiver about 3x as fast, and clarified some of the docstrings.
In-Reply-To: <8524CF2E-3B48-40CA-B64F-06F7FB2A397F@fuhm.net>
References: <20050618185820.5047.1935189464.divmod.quotient.5049@ohm>
	<8524CF2E-3B48-40CA-B64F-06F7FB2A397F@fuhm.net>
Message-ID: <FC3AC447-B4A0-4609-AD39-1C91B954B776@fuhm.net>


On Jun 19, 2005, at 7:51 PM, James Y Knight wrote:

> Two things about that:
> 1) resumeProducing actually now says:
>     def resumeProducing(self):
>         self.paused = False
>         self.transport.resumeProducing()
>         self.dataReceived('')
>
> This was changed because of <http://twistedmatrix.com/pipermail/ 
> twisted-python/2005-February/009626.html> also <http:// 
> twistedmatrix.com/bugs/issue899>.
>
> However, if resumeProducing is allowed to immediately produce data,  
> this is somewhat bogus, as it could reverse the order of the data.  
> In reality, a TCP transport's resumeProducing will not immediately  
> produce data, but I think that's a fragile API to both have  
> resumeProducing immediately produce data, and depend on a call to  
> someone else resumeProducing not immediately producing data. I  
> think there's an issue here.

Actually, there is no even potential for reordering of data --  
dataReceived is called with '', afterall. I'm not quite sure what I  
was thinking when I wrote that...sorry.

James



From exarkun at divmod.com  Sun Jun 19 18:57:19 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sun, 19 Jun 2005 20:57:19 -0400
Subject: [Twisted-Python] Fwd: [Twisted-commits] r11032 - Made
	LineReceiver about 3x as fast, and clarified some of the docstrings.
In-Reply-To: <8524CF2E-3B48-40CA-B64F-06F7FB2A397F@fuhm.net>
Message-ID: <20050620005719.5047.1423065954.divmod.quotient.5753@ohm>

On Sun, 19 Jun 2005 19:51:35 -0400, James Y Knight <foom at fuhm.net> wrote:
>
>On Jun 18, 2005, at 2:58 PM, Jp Calderone wrote:
>>This changes dataReceived to call down into user code while the 
>>LineReceiver's instance attributes are in an inconsistent state.   This can 
>>lead to duplicate data delivery if dataReceived is called  into from 
>>lineReceived.  Normally this sounds like a ridiculous  thing to do, but 
>>notice the implementation of resumeProducing():
>>
>>     def resumeProducing(self):
>>         self.paused = False
>>         self.dataReceived('')
>>         self.transport.resumeProducing()
>>
>>Since resumeProducing is called immediately when a producer is  registered, 
>>this means LineReceivers can no longer register  themselves as producers 
>>for their transports from lineReceived,  which is a much more reasonable 
>>thing to do.
>>
>>Demonstration of the bug in action attached.
>
>Two things about that:
>1) resumeProducing actually now says:
>     def resumeProducing(self):
>         self.paused = False
>         self.transport.resumeProducing()
>         self.dataReceived('')
>
>This was changed because of <http://twistedmatrix.com/pipermail/ twisted- 
>python/2005-February/009626.html> also <http:// 
>twistedmatrix.com/bugs/issue899>.
>
>However, if resumeProducing is allowed to immediately produce data,  this is 
>somewhat bogus, as it could reverse the order of the data. In  reality, a 
>TCP transport's resumeProducing will not immediately  produce data, but I 
>think that's a fragile API to both have  resumeProducing immediately produce 
>data, and depend on a call to  someone else resumeProducing not immediately 
>producing data. I think  there's an issue here.
>
>2) dataReceived can be easily fixed to handle this by using a local  -- 
>patch coming separately.

[Patch received out of band]

I've created an issue for this and attached a slightly modified version of the patch.  See <http://twistedmatrix.com/bugs/issue1087>.

Jp



From saphirra at gmail.com  Sun Jun 19 22:10:58 2005
From: saphirra at gmail.com (Jen Dockter)
Date: Sun, 19 Jun 2005 21:10:58 -0700
Subject: [Twisted-Python] TM t-shirts
Message-ID: <7a24934f05061921105ae2ba3a@mail.gmail.com>

I am making Twisted Matrix t-shirts; I have presently just finished blanking 
out the screen and am now taking orders.

The shirts will be using the small TMLabs logo (not the full pyramid snake, 
but just the top bit) on the front, approximately 7x5" with the URL (
www.twistedmatrix.com <http://www.twistedmatrix.com>) in web-friendly 
Verdana Bold on the back.

These are high-quality, hand-made silk screenings; this is not crummy 
iron-on CafePress work. The cost per shirt is $14 for US orders or $16 for 
International; these prices include shipping.

You can order shirts here: http://saph.twistedmatrix.com/blog/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050619/05c0a7d4/attachment.html>

From gns24 at sphinx.mythic-beasts.com  Mon Jun 20 04:49:50 2005
From: gns24 at sphinx.mythic-beasts.com (Graham Stratton)
Date: Mon, 20 Jun 2005 11:49:50 +0100 (BST)
Subject: [Twisted-Python] Re: Using twisted for web crawling
In-Reply-To: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
References: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
Message-ID: <Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>

Hello all!

I'm trying to write a python utility to fetch large numbers of web pages.
I originally wrote a multi-threaded app, but found that I had no control
of it.

I then re-wrote it using asyncore, which is fine apart from the fact that
a few connections open sockets which never get closed, and eventually I
run out of sockets (well, file descriptors).  I see Twisted can avoid this
problem by setting an interval after which an inactive connection is closed.

I've been browsing the Twisted site and don't really understand what I
would need to implement this utility using Twisted.  Is Twisted the right
technology for this, or is there a simple way to fix my 'socket leak' that
I am getting with asyncore?

Thanks in advance,

Graham




From Henning.Ramm at mediapro-gmbh.de  Mon Jun 20 08:15:57 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Mon, 20 Jun 2005 16:15:57 +0200
Subject: [Twisted-Python] TM t-shirts
Message-ID: <F92274058556DE42B94B148EEFB9183949E725@exchange-03.suedkurier.de>

> You can order shirts here: http://saph.twistedmatrix.com/blog/

Nice, but what colors (T-Shirt/print) are available? Perhaps you could make a selector for that also?

Best regards,
Henning Hraban Ramm
Sdkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From dialtone at divmod.com  Mon Jun 20 10:16:20 2005
From: dialtone at divmod.com (Valentino Volonghi aka Dialtone)
Date: Mon, 20 Jun 2005 18:16:20 +0200
Subject: [Twisted-Python] Re: Using twisted for web crawling
In-Reply-To: <Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>
References: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
	<Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>
Message-ID: <42B6EBD4.5060102@divmod.com>

Graham Stratton wrote:

>I've been browsing the Twisted site and don't really understand what I
>would need to implement this utility using Twisted.  Is Twisted the right
>technology for this, or is there a simple way to fix my 'socket leak' that
>I am getting with asyncore?
>  
>
http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/277099

Check this out.

--  
Valentino Volonghi aka Dialtone
Now Running MacOSX 10.4.1
Blog: http://vvolonghi.blogspot.com
http://weever.berlios.de




From saphirra at gmail.com  Mon Jun 20 16:48:28 2005
From: saphirra at gmail.com (Jen Dockter)
Date: Mon, 20 Jun 2005 15:48:28 -0700
Subject: [Twisted-Python] TM t-shirts
Message-ID: <7a24934f050620154836887901@mail.gmail.com>

Message: 6
Date: Mon, 20 Jun 2005 16:15:57 +0200
From: <Henning.Ramm at mediapro-gmbh.de>
Subject: RE: [Twisted-Python] TM t-shirts
To: <saphirra at gmail.com>, <twisted-python at twistedmatrix.com>
Message-ID:
<F92274058556DE42B94B148EEFB9183949E725 at exchange-03.suedkurier.de>
Content-Type: text/plain; charset="iso-8859-1"

>> You can order shirts here: http://saph.twistedmatrix.com/blog/
>
>Nice, but what colors (T-Shirt/print) are available? Perhaps you could make 
a selector for that also?
>
>Best regards,
>Henning Hraban Ramm
>Sdkurier Medienhaus / MediaPro
>Support/Admin/Development Dept.

There are now colour options; first colour is the shirt, second is the 
print.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050620/4a41e446/attachment.html>

From saphirra at gmail.com  Mon Jun 20 18:25:36 2005
From: saphirra at gmail.com (Jen Dockter)
Date: Mon, 20 Jun 2005 17:25:36 -0700
Subject: [Twisted-Python] TM t-shirts
In-Reply-To: <F92274058556DE42B94B148EEFB9183949E725@exchange-03.suedkurier.de>
References: <F92274058556DE42B94B148EEFB9183949E725@exchange-03.suedkurier.de>
Message-ID: <7a24934f050620172539d2c972@mail.gmail.com>

I am placing an order for the blank shirts to the supplier on Wednesday; so, 
if you want your order to ship with the first batch, get in your order by 
then: http://saph.twistedmatrix.com/blog/archives/000108.html

On 6/20/05, Henning.Ramm at mediapro-gmbh.de <Henning.Ramm at mediapro-gmbh.de> 
wrote:
> 
> > You can order shirts here: http://saph.twistedmatrix.com/blog/
> 
> Nice, but what colors (T-Shirt/print) are available? Perhaps you could 
> make a selector for that also?
> 
> Best regards,
> Henning Hraban Ramm
> Sdkurier Medienhaus / MediaPro
> Support/Admin/Development Dept.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050620/e1b2c3bd/attachment.html>

From nkeric at gmail.com  Mon Jun 20 22:50:34 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 21 Jun 2005 12:50:34 +0800
Subject: [Twisted-Python] How could I distinguish each TCP connection?
Message-ID: <43c0d2b505062021508cfe424@mail.gmail.com>

Hi all,

I'm familiar with the thread-style network programming (create a single 
thread for each connected client).
With twisted, how could I know which client I'm talking to? (or, how could I 
maintain the connections list?)

I'm thinking of creating a Client object to represent each connected client
Could I save the transport to the Client object so that I can retrive that 
transport back to talk to a specific client?

Please point me to somewhere I could find the answer or enlighten me with 
some sample code, thanks in advance!

- Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050621/fbba2ba7/attachment.html>

From radeex at gmail.com  Mon Jun 20 22:56:57 2005
From: radeex at gmail.com (Christopher Armstrong)
Date: Tue, 21 Jun 2005 14:56:57 +1000
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <43c0d2b505062021508cfe424@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
Message-ID: <60ed19d4050620215650648130@mail.gmail.com>

On 6/21/05, Eric Hsu <nkeric at gmail.com> wrote:
> Hi all,
>  
>  I'm familiar with the thread-style network programming (create a single
> thread for each connected client).
>  With twisted, how could I know which client I'm talking to? (or, how could
> I maintain the connections list?)
>  
>  I'm thinking of creating a Client object to represent each connected client
>  Could I save the transport to the Client object so that I can retrive that
> transport back to talk to a specific client?

You can do it based on the Protocol instance. For TCP, there is one
Protocol instance per connection, and it has access to the transport.

-- 
  Twisted   |  Christopher Armstrong: International Man of Twistery
   Radix    |    -- http://radix.twistedmatrix.com
            |  Release Manager, Twisted Project
  \\\V///   |    -- http://twistedmatrix.com
   |o O|    |  
w----v----w-+



From nkeric at gmail.com  Mon Jun 20 23:20:11 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 21 Jun 2005 13:20:11 +0800
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <60ed19d4050620215650648130@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
	<60ed19d4050620215650648130@mail.gmail.com>
Message-ID: <43c0d2b505062022206408acdc@mail.gmail.com>

2005/6/21, Christopher Armstrong <radeex at gmail.com>:
> 
> You can do it based on the Protocol instance. For TCP, there is one
> Protocol instance per connection, and it has access to the transport.


Hi Christopher!

Big thanks first!

When I writing codes like the following to provide TCP/UDP services:

factory = Factory()
factory.protocol = MyTCPService
reactor.listenTCP(port1, factory)
reactor.listenUDP(port2, MyUDPService())

How could I get the protocol instance of each client and maintain them?
Please tell me more details if you could, since I'm very very new to twisted 
:)

- Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050621/9cddd75f/attachment.html>

From radeex at gmail.com  Mon Jun 20 23:26:12 2005
From: radeex at gmail.com (Christopher Armstrong)
Date: Tue, 21 Jun 2005 15:26:12 +1000
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <43c0d2b505062022206408acdc@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
	<60ed19d4050620215650648130@mail.gmail.com>
	<43c0d2b505062022206408acdc@mail.gmail.com>
Message-ID: <60ed19d405062022262eb99127@mail.gmail.com>

On 6/21/05, Eric Hsu <nkeric at gmail.com> wrote:
>  factory = Factory()
>  factory.protocol = MyTCPService
>  reactor.listenTCP(port1, factory)
>  reactor.listenUDP(port2, MyUDPService())
>  
>  How could I get the protocol instance of each client and maintain them?
>  Please tell me more details if you could, since I'm very very new to
> twisted :)

I suggest, instead of using the stock "Factory", making a subclass of
it with buildProtocol implemented like so:

def buildProtocol(self, addr):
    p = Factory.buildProtocol(self, addr)
    self.connections.append(p)
    return p

Or similar (you'll have to define the 'connections' list yourself in
__init__). In the protocol's connectionLost, you could then remove the
protocol from that list.

-- 
  Twisted   |  Christopher Armstrong: International Man of Twistery
   Radix    |    -- http://radix.twistedmatrix.com
            |  Release Manager, Twisted Project
  \\\V///   |    -- http://twistedmatrix.com
   |o O|    |  
w----v----w-+



From nkeric at gmail.com  Tue Jun 21 01:33:20 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 21 Jun 2005 15:33:20 +0800
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <60ed19d405062022262eb99127@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
	<60ed19d4050620215650648130@mail.gmail.com>
	<43c0d2b505062022206408acdc@mail.gmail.com>
	<60ed19d405062022262eb99127@mail.gmail.com>
Message-ID: <43c0d2b505062100335bd237ae@mail.gmail.com>

Thank you very much!
You've been a GREAT help :D

2005/6/21, Christopher Armstrong <radeex at gmail.com>:
> 
> I suggest, instead of using the stock "Factory", making a subclass of
> it with buildProtocol implemented like so:
> 
> def buildProtocol(self, addr):
> p = Factory.buildProtocol(self, addr)
> self.connections.append(p)
> return p
> 
> Or similar (you'll have to define the 'connections' list yourself in
> __init__). In the protocol's connectionLost, you could then remove the
> protocol from that list.
> 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050621/95ab402e/attachment.html>

From zunbeltz at lcdx00.wm.lc.ehu.es  Tue Jun 21 02:30:49 2005
From: zunbeltz at lcdx00.wm.lc.ehu.es (zunbeltz)
Date: Tue, 21 Jun 2005 10:30:49 +0200 (CEST)
Subject: [Twisted-Python] newbie help (fwd)
Message-ID: <20050621103038.Y69229@lcdx00.wm.lc.ehu.es>

Hi,

I have the following problem.

I'm developing a GUI program (wxPython). This program has to comunicate
(TCP) whit other program that controls a laboratory machine to do a
measurement. I have a dialog box, wiht two buttoms "Start measurement" and
"Stop". "Start" executes a function that do the measurement in the
following way.

1) My program send a socket.
2) The other program recives it an send confirmation.
3) My program waits for the confirmation and send the next when
confirmation received.

This comunication is done in a new thread not to frezee the GUI.
The problem is that when "Stop" is done (it kills the thread) some
confirmation sockets are mixed (are not receibed in the correct order
although i use tcp).

I have been told not to do comunication in a new thread; instead, I should
use asyncronus comunication (asyncore or twisted).

My question:

How can i do that with twisted?
How can i implement this asyncronous comunication and the ability to
stop this long run funciton (the measurement can take hours or days, so
i need a way to stop it)?
Can twisted garantee that the confirmation socket will arrive in the
correct order (one after each sended socket)?
Can i use twisted 2.0 with wxPython 2.5.3.2?
Where can i found an example of twisted with wxpython?

Thanks for your help

Zunbeltz Izaola

--
Zunbeltz Izaola Azkona              (zunbeltz at wm dot lc dot ehu dot es)
Materia Kondentsatuaren Fisika Saila      |
Zientzia eta Teknologia Fakultatea        |   Telf:  34 946015326
Euskal Herriko Unibertsitatea             |
PK 644                                    |   Fax:   34 946013500
48080 Bilbo (SPAIN)                       |
--



From gns24 at sphinx.mythic-beasts.com  Tue Jun 21 03:21:11 2005
From: gns24 at sphinx.mythic-beasts.com (Graham Stratton)
Date: Tue, 21 Jun 2005 10:21:11 +0100 (BST)
Subject: [Twisted-Python] Re: Using twisted for web crawling
In-Reply-To: <42B6EBD4.5060102@divmod.com>
References: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
	<Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>
	<42B6EBD4.5060102@divmod.com>
Message-ID: <Pine.LNX.4.58.0506211016470.20829@sphinx.mythic-beasts.com>

Valentino, thanks for the link.

Just a quick request to someone; I'd like to be able to follow the link to
'Reactor basics' at
http://twistedmatrix.com/projects/twisted/internet
but it is broken.  Could someone please fix it/direct me to the page?

Many thanks,

Graham



From micktwomey at gmail.com  Tue Jun 21 03:40:54 2005
From: micktwomey at gmail.com (Michael Twomey)
Date: Tue, 21 Jun 2005 10:40:54 +0100
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <200506160956.23811.ian@ianduggan.net>
References: <20050615011734.5047.1237485630.divmod.quotient.2986@ohm>
	<200506160956.23811.ian@ianduggan.net>
Message-ID: <50a522ca05062102402aad620@mail.gmail.com>

Hi,

I've tried it out too and it seems to work well (I have to also
commend Jp on the sneakiness of the signal approach).

Since I don't have the dl module with my copy of mac python I've
attached a small patch which makes btt use the itimer module py-itimer
(http://www.cute.fi/~torppa/py-itimer/) if it can't import dl.

cheers,
  mick

On 6/16/05, Ian Duggan <ian at ianduggan.net> wrote:
> 
> On Tuesday 14 June 2005 18:17, Jp Calderone wrote:
> > >Does anyone know of any tools that could be used to wrap a python module
> > > and capture/report blocking calls made by it?
> >
> > <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/btt.py> (and
> > <http://svn.twistedmatrix.com/cvs/sandbox/exarkun/test_btt.py>) might be of
> > interest/use.  I haven't done much with it yet, so I don't know if it's
> > actually effective.  I'd be interested to hear if you have any luck with
> > it.
> 
> Heh, this is a very clever trick, setting and disabling an alarm in a looping
> call. If it doesn't get disabled in time, it tells you where the stack is. It
> actually works great! I was able to immediately test it by suspending twisted
> for a moment.
> 
> I had to tune the precisions it was using, to prevent it from firing
> spuriously when my laptop got busy, but otherwise it's very cool. I love
> simple.
> 
> Suggestions for anyone else who uses this:
> 
> 1) Tune the precisions so that you have a quiet baseline.
> 
> 2) If the network you are interacting with is too fast, find a way to throttle
> your connection.
> 
> http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/Adv-Routing-HOWTO.html
> 
> --Ian
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: py-itimer.patch
Type: application/octet-stream
Size: 1207 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050621/e5df49a2/attachment-0002.obj>

From andrew-twisted at puzzling.org  Tue Jun 21 03:49:40 2005
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue, 21 Jun 2005 19:49:40 +1000
Subject: [Twisted-Python] Re: Using twisted for web crawling
In-Reply-To: <Pine.LNX.4.58.0506211016470.20829@sphinx.mythic-beasts.com>
References: <Pine.LNX.4.58.0506201131220.20829@sphinx.mythic-beasts.com>
	<Pine.LNX.4.58.0506201148210.20829@sphinx.mythic-beasts.com>
	<42B6EBD4.5060102@divmod.com>
	<Pine.LNX.4.58.0506211016470.20829@sphinx.mythic-beasts.com>
Message-ID: <20050621094940.GG8084@trogdor.home.puzzling.org>

On Tue, Jun 21, 2005 at 10:21:11AM +0100, Graham Stratton wrote:
> Valentino, thanks for the link.
> 
> Just a quick request to someone; I'd like to be able to follow the link to
> 'Reactor basics' at
> http://twistedmatrix.com/projects/twisted/internet
> but it is broken.  Could someone please fix it/direct me to the page?

http://twistedmatrix.com/projects/core/documentation/howto/reactor-basics.html

-Andrew.




From mustafa at liqia.com  Tue Jun 21 10:16:20 2005
From: mustafa at liqia.com (Mustafa Sakalsiz)
Date: Tue, 21 Jun 2005 19:16:20 +0300
Subject: [Twisted-Python] Asynchronous File I/O
Message-ID: <42B83D54.3010907@liqia.com>

Is there a way to read and writes files asynchronously using twisted.

The files may be of regular files or devices (/dev/*).

Saki



From exarkun at divmod.com  Tue Jun 21 10:42:39 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 21 Jun 2005 12:42:39 -0400
Subject: [Twisted-Python] Asynchronous File I/O
In-Reply-To: <42B83D54.3010907@liqia.com>
Message-ID: <20050621164239.5047.1520969969.divmod.quotient.6689@ohm>

On Tue, 21 Jun 2005 19:16:20 +0300, Mustafa Sakalsiz <mustafa at liqia.com> wrote:
>Is there a way to read and writes files asynchronously using twisted.
>
>The files may be of regular files or devices (/dev/*).
>

Twisted doesn't wrap or otherwise expose any platform specific asynchronous disk or device file IO routines.

Twisted's KQueue and IOCP support could be extended to provide this feature on BSD and Win32 (and AIO could probably be used to implement the same API on Linux), if there is some compelling use case for this.

Most applications get along fine using blocking disk IO, since it generally doesn't block for very long.  For cases where wrapping a real asynchronous IO layer is too much work but doing blocking disk IO is too detrimental, simply sending IO operations to a thread may be a suitable solution.  For example, twisted.internet.threads.deferToThread(fileObj.read, size) returns a Deferred that fires with at most size bytes from fileObj.  If you go this route, you must be careful to serialize operations on individual file objects, of course.

For device files, inotify.py in the Twisted sandbox has some code that might be useful (OTOH, perhaps it is just overengineered).  See its connectCharacterDevice() function.

Jp



From rfmeraz at gmail.com  Tue Jun 21 11:13:07 2005
From: rfmeraz at gmail.com (Richard Meraz)
Date: Tue, 21 Jun 2005 10:13:07 -0700
Subject: [Twisted-Python] defers, reactor,
	idiomatic/proper usage -- new user questions.
Message-ID: <f98c79100506211013159fe279@mail.gmail.com>

Hello all,
 
 Just getting started with Twisted. Thanks to the community for
tremendous work.  I diligently went through the entire archives of the
mailing list --  reading choice threads --  and I read through all the
documentation on the twisted-matrix website.  I've never done any
event-driven programming, but there was enough on the site for me to
start getting a handle on things.  Below is a short script that crawls
the links from a URI looking for RSS-type feeds.  I'm hoping that some
of the more experienced developers would be willing to give some
advice about whether I'm using twisted.internet.reactor and
twisted.web.client.getPage correctly.  I've put some comments labeled
as #Question where I'm unsure wheter I understand exactly what I'm
doing -- Im hoping someone can refute/chastise/critique the
understanding that is implied by the code and questions. I have a
thick skin so the more talented/vitriolic the response the better.
 
 # Find RSS Feeds.
 # Richard Meraz -- rfmeraz at gmail.com. 
from twisted.internet import reactor
from twisted.web.client import getPage
 
import feedlib # Includes modified version of M. Pilgrims
feedfinder.py and modified version of
                    # D. Mertz code for url extraction from p. 228 of __TPIP__. 

MAXTIME = 60 # Kill crawl after this time
TIMEOUT = 20 # Kill page retrieval after this time inactive
MAXDEPTH = 3 # Recurse this depth when crawling page. 
 
 # Question: There seem to be many idioms to aggregate information
from different defered call-back chains in twisted..  Since everything
runs in a single thread I just stuck my stuff in a global class and
everybody modifies the vars there as I pass it around to the
call-backs that should see it.  Seems okay for a small script like
this?
 
class StateVars:
    '''Keep Global state for starting/stopping feedfinding and a
record of links we have checked and their status'''
    connections = 1  
    links_checked = {} # Structure: {url: (is RSS/ATOM/RDF, page-content)}
 
 # Question: start_feed_crawl is where I set up my defers.  getPage
returns a defer and I attach my call-back process_link.
 # addCallbacks adds a callback/errback in parallel so only one or the
other is called?  so I need to add
 # the final errback to catch errors from callback process_link ?
      
def start_feed_crawl(uri,depth):
    '''Harvest feeds from a uri'''
 # Question: how to time-out this deferred chain if getPage is taking
too long to finish its work.
 # what exactly does the argument timeout to getPage do,  does it
timeout the socket after a no-response
 # or does it put an upper-bound on how long getPage has to finish its work?
 
    getPage(uri, timeout=TIMEOUT).addCallbacks
(callback=process_link,
                                                     
callbackArgs=(uri, depth, StateVars),
                                                      errback = process_error,
                                                     
errbackArgs=(uri,StateVars)
                                                     
).addErrback(process_error, uri, StateVars)

def process_link(data,uri,depth,state):
    '''Recursive link processing callback. Determines whether a link
    is a RSS/ATOM/RDF feed. If not then extracts all xml-like links
    that could point to feeds and starts crawl on those.''' 
    if feedlib.couldBeFeedData(data):
        #print 'Feed: %s' % uri
        state.links_checked[uri] = (True,data)
    else:
        state.links_checked[uri] = (False,None)
        if  depth <= MAXDEPTH: 
            alinks = feedlib.getALinks(data,uri)
            links = feedlib.getLinks(data,uri)
            rawurls = feedlib.extract_urls(data)        
            links_to_check = [feedlib.makeFullURI(u)
                              for u in set(alinks+links+rawurls)
                              if feedlib.isXMLRelatedLink(u)]
            for l in links_to_check:
                # Don't need to see it again.
                if state.links_checked.has_key(l):
                    continue
                else:
                    state.connections += 1
                     # Question: since I'm starting up these defers in
a callback they are
                     # being created after I've called reactor.run()
since we call start_feed_crawl
                     # as we find new links that meet our criteria. 
Am I doing anything bad here?
                     # All the examples I've seen (eg. p. 548-552
Python Cookbook, great eg by V. Volonghi
                     # and P. Cogolo) have their data up-front and
therefore set-up all the defers before calling
                     # reactor.run().  Here I'm discovering my data as
I go along and setting up deferrs while
                     # the reactor is spinning.  Here is my
fundamental lack of understanding.  While this script
                     # seems to run okay, is it okay to do this?
                    start_feed_crawl(l,depth+1)
 
    state.connections -= 1
 
     # Question: Is this how I kill the reactor -- ie. using some sort
of state condition.  Is there a better way,
     # should I try better to understand deferred-list.  For example. 
A top-level deferred-list that contains
     # other deferred-lists which get created to hold all the defers
(created by start_feed_crawl) for the
     # links on a given page.  Could this deferred-list be told to
stop the reactor when the other lists have
     # fired their callback (after the component defers have finished)
?  (Sorry for the convoluted question here
     # I'm new at this)
 
    if state.connections <= 0:
        reactor.stop()
    return

def process_error(error,uri,state):
    '''Catch errors in link processing'''
    state.connections -= 1
    if state.connections  <= 0:
        reactor.stop()
    return ''

if __name__ == '__main__':
    import sys
    if len(sys.argv) < 2:
        print 'feedfinder_new.py <uri>'
        sys.exit()

    uri =  feedlib.makeFullURI(sys.argv[1])
    start_feed_crawl(uri,1)
  
     # Question: I'm killing the process after a pre-determined amount
of time.  However reactor.stop() seems
     # to kill network connections.  is there a way to stop the
reactor but let the connections finish.
 
    # Hack to blow out any connections that are hung or uncalled after MAXTIME
    reactor.callLater(MAXTIME, reactor.stop)
    reactor.run()
 
    for l in StateVars.links_checked:
        if StateVars.links_checked[l][0]:
            print l

Final question: occasionally I get errors that come from the http.py
code in twisted.  This get printed to the console, but don't
necessarily stop my program.  Should my errbacks be catching these? 
How do I keep errors from getting logged to the console (beside
redirecting stderr). I can post an example if necessary of the errors
I'm getting.
 
 Thanks for your help.
 
 Richard F. Meraz
 
-- 
Never think there is anything impossible for the soul. It is the
greatest heresy to think so. If there is sin, this is the only sin 
to say that you are weak, or others are weak.

Swami Vivekananda

From gmcdonald at infocomp.com  Tue Jun 21 19:15:51 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Wed, 22 Jun 2005 11:15:51 +1000
Subject: [Twisted-Python] Distinguishing TCP connections
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>

Eric,

I came up with a nice way of managing connections on the last project I
worked on:

The DataConnection is the protocol instance (in this case inheriting from
Int32StringReceiver).  Each time a protocol connects it calls the
registerSource

class DataConnection(Int32StringReceiver):
    
    def __init__(self, manager):
        self.manager = manager
    
    def closeConnection(self):
        self.transport.loseConnection()
    
    def connectionMade(self):
        print 'registering connection'
        self.registerConnection()
        
    def connectionLost(self, reason):
        print 'connection lost, removing....'
        self.removeConnection()

	.
	.
[ code omitted for brevity ]
	.
	.
 
    def registerConnection(self):
        """
        register data connection with connection manager.
        """
        self.manager.registerSource(self)
        
    def removeConnection(self):
        """
        remove this connection from the connection manager.
        """
        self.manager.removeSource(self.id)

    def setId(self, id):
        self.id = id
        
And the ConnectionManager is the factory class (inherited from the generic
Factory class).
 
class ConnectionManager(Factory):
    
    def __init__(self, eventhandler):
        self.ids = 0
        self.sources = {}
        self.eventhandler = eventhandler    # -- see comments later
    
    def buildProtocol(self, addr):
        return DataConnection(self)

    def newId(self):
        """
        get an id that is unique for the life of the connection manager.
        """
        id = self.ids+1
        self.ids = id
        return id

    def registerSource(self, source):
        """
        register a new source, this assigns the source an id and
        adds it to the sources dictionary.
        """
        id = self.newId()
        self.sources[id] = source
        
        # set source id
        source.setId(id)

    def removeSource(self, id):
        """
        remove the connection indicated by the source id from the current
connection
        pool any subsequent behaviour must be handled in the event manager.
        """
        if self.sources.has_key(id):
            del self.sources[id]

    def closeConnections(self):
        for source in self.sources.values():
            source.closeConnection()

[ code omitted for brevity ]

As you can see the when a connection is made it is registered with the
factory instance.  This uniquely identifies the connection, and allows you
to identify when you get a message which connection it is from.  This also
simplifies sending a message back along the same channel:

To do this you can create an event handler that implements some form of
event processing:

class EventHandler:

    def __init__(self, manager):
        self.manager = manager

    def messageReceived(self, id, message):
        # process message
        ...
        
        # create new message
        newMessage = "this is a test"
        
        # send new message back along same connection
        self.manager.sendMessage(id, newMessage)

And in the ConnectionManager add something like the following methods:

    def propagateMessage(self, id, message):
        """
        This method simply passes the received message through to the
        EventHandler class instance along with the id of the connection
        the message was received from.
        """
        self.eventhandler.messageReceived(id, message)
        
    def sendMessage(self, id, message):
        """
        This method retrieves the correct connection and sends a message
through it.
        """
        if self.sources.has_key(id):
            self.sources[id].emitMessage(message)

And the DataConnection:

    def stringReceived(self, data):
        self.manager.propagateEvent(self.id, data)

    def emitMessage(self, message):
        """
        send a message along the data connection.
        """
        self.sendString(message)


If any of this is unclear please let me know.

Regards,

Grant McDonald

----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com]On Behalf Of Eric Hsu
Sent: 21 June 2005 17:33
To: radix at twistedmatrix.com
Cc: Twisted general discussion
Subject: Re: [Twisted-Python] How could I distinguish each TCP connection?

Thank you very much!
You've been a GREAT help :D
2005/6/21, Christopher Armstrong <radeex at gmail.com>:
I suggest, instead of using the stock "Factory", making a subclass of
it with buildProtocol implemented like so:

def buildProtocol(self, addr):
    p = Factory.buildProtocol(self, addr)
    self.connections.append (p)
    return p

Or similar (you'll have to define the 'connections' list yourself in
__init__). In the protocol's connectionLost, you could then remove the
protocol from that list.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050622/31e3f5a4/attachment.html>

From nkeric at gmail.com  Tue Jun 21 21:45:12 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Wed, 22 Jun 2005 11:45:12 +0800
Subject: [Twisted-Python] Re: Distinguishing TCP connections
In-Reply-To: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>
References: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>
Message-ID: <43c0d2b505062120455208829f@mail.gmail.com>

Hi Grant!

What a BIG surprise to receive this mail from you!
I've read your code in earnest, and it's very clear and straightforward to a 
newbie like me ;)
Thank you very much! twisted-python is really a wonderful place for 
learning, I'm loving it :D 

Best regards!

- Eric

2005/6/22, Grant McDonald <gmcdonald at infocomp.com>:
> 
> Eric, 
> 
> I came up with a nice way of managing connections on the last project I 
> worked on:
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050622/7515a8cf/attachment.html>

From jarrod.roberson at gmail.com  Tue Jun 21 23:19:57 2005
From: jarrod.roberson at gmail.com (jarrod roberson)
Date: Wed, 22 Jun 2005 01:19:57 -0400
Subject: [Twisted-Python] How could I distinguish each TCP connection?
In-Reply-To: <43c0d2b505062022206408acdc@mail.gmail.com>
References: <43c0d2b505062021508cfe424@mail.gmail.com>
	<60ed19d4050620215650648130@mail.gmail.com>
	<43c0d2b505062022206408acdc@mail.gmail.com>
Message-ID: <2389d4730506212219249a03b7@mail.gmail.com>

On 6/21/05, Eric Hsu <nkeric at gmail.com> wrote:
> 
> 
> 2005/6/21, Christopher Armstrong <radeex at gmail.com>:
> > 
> > You can do it based on the Protocol instance. For TCP, there is one
> > Protocol instance per connection, and it has access to the transport.
> 
> 
> Hi Christopher!
> 
> Big thanks first!
> 
> When I writing codes like the following to provide TCP/UDP services:
> 
> factory = Factory()
> factory.protocol = MyTCPService
> reactor.listenTCP(port1, factory)
> reactor.listenUDP(port2, MyUDPService())
> 
> How could I get the protocol instance of each client and maintain them?
> Please tell me more details if you could, since I'm very very new to 
> twisted :)
> 
> - Eric
> 
> 
> Read the documentation first, it is all there in the HOW-TOs and 
tutorials.


-- 
If you don't know what you want, you probably need a nap.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050622/455c5d12/attachment.html>

From foom at fuhm.net  Wed Jun 22 10:17:05 2005
From: foom at fuhm.net (James Y Knight)
Date: Wed, 22 Jun 2005 12:17:05 -0400
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: <2D84ADB7-0093-44C5-8EBC-D61371B06AE3@fuhm.net>

Bug summary
______________________
Since 2005-06-15 01:17:07.440000:
Bugs opened: 9   Bugs closed: 1   Total open bugs: 396 (+8)
   Urgent: 9 (+2)
   Bug: 167 (+4)
   Feature: 144 (+1)
   Wish: 76 (+1)

New / Reopened Bugs
______________________
                     ==== Urgent ====
[CORE] LineReceiver Producer/Consumer support is broken  (2 days ago)
        http://twistedmatrix.com/bugs/issue1087 opened by exarkun

[CORE, DOCUMENTATION] gtk2reactor thread initialization confuses  
python-2.3  (5 days ago)
        http://twistedmatrix.com/bugs/issue1083 opened by loic

                     ==== Bug ====
http proxy doesn't close connection after sending 'Could not  
connect'  (2 days ago)
        http://twistedmatrix.com/bugs/issue1089 opened by jeffsilver

internet.py: self._port.stopListening() should check that self._port  
exists  (2 days ago)
        http://twistedmatrix.com/bugs/issue1088 opened by loic

/usr/lib/python2.3/site-packages/twisted/web/proxy.py:22:  
DeprecationWarning: twisted.protocols.http has moved to  
twisted.web.http.  (5 days ago)
CLOSED http://twistedmatrix.com/bugs/issue1085 opened by rusxakep

[CORE] ITCPConnector.disconnect() default implementation (or API?)  
problem  (4 days ago)
        http://twistedmatrix.com/bugs/issue1086 opened by itamarst

UDP Doc Update: Multicast Howto and Example  (5 days ago)
        http://twistedmatrix.com/bugs/issue1084 opened by ra1n

                     ==== Feature ====
twisted/web/server.py : Session expire times are hardwired  (yesterday)
        http://twistedmatrix.com/bugs/issue1090 opened by loic

                     ==== Wish ====
[WORDS] Speex in NAT environments with jabber protocol  (6 days ago)
        http://twistedmatrix.com/bugs/issue1082 opened by rko

Bugs Closed
______________________
                     ==== Bug ====
/usr/lib/python2.3/site-packages/twisted/web/proxy.py:22:  
DeprecationWarning: twisted.protocols.http has moved to  
twisted.web.http.  (5 days ago)
        http://twistedmatrix.com/bugs/issue1085 opened by rusxakep,  
closed by exarkun





From Stephan.Popp at iisb.fraunhofer.de  Thu Jun 23 02:53:31 2005
From: Stephan.Popp at iisb.fraunhofer.de (Stephan Popp)
Date: Thu, 23 Jun 2005 10:53:31 +0200
Subject: [Twisted-Python] Traceback from pb-Server
Message-ID: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>

Hi,
Please excuse my bad english, I hope you will understand what I mean, 
otherwise feel free to ask.
I'm trying to get error messages from my server. I'm using twisted 2.0.0 with 
python 2.4.
The server looks like this:

from twisted.spread import pb
from twisted.internet import reactor, threads

class ServerObject(pb.Root):

#...some other methods, which aren't involved...

def remote_fitness(self, task, taskDescription, serverID):
	return threads.deferToThread(self.calc, task, serverID, taskDescription)

def calc(self, task, serverID, taskDescription):
	exec('from %s import %s as func' % 
(taskDescription.fileName,taskDescription.functionName))
#problem: file specified in fileName needn't to be in working directory of 
server
	func(task) #calulates something
	return task

if __name__ == '__main__':
	factory = pb.PBServerFactory(ServerObject())
	reactor.listenTCP(8800, factory)
	reactor.run() 

The client calls, after connection is made.
def1 = root.call_remote("fitness", task, taskDescription, serverID)
def1.addCallback(self.serverCB)
def1.addErrback(self.serverErrorCB)

def serverErrorCB(self, reason):
	print reason

If the pythonscript named taskDescription.fileName isn't there 
self.serverErrorCB is called - thats ok. But it prints:
reason [Failure instance: Traceback from remote host -- Traceback unavailable]

But I need to know why the call failed. Can anyone please help me to get the 
traceback or the exception message that the server prints 
(exceptions.ImportError: No module named fitfunc2).



From gsakkis at eden.rutgers.edu  Thu Jun 23 10:29:30 2005
From: gsakkis at eden.rutgers.edu (George Sakkis)
Date: Thu, 23 Jun 2005 12:29:30 -0400 (EDT)
Subject: [Twisted-Python] Accurate delays in callLater
Message-ID: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>

Hello all,

I'm using twisted for a realtime simulation and I'm calling
reactor.callLater() for scheduling actions to be performed after a fixed
short delay (~60msec). However, if there is a cpu-intensive procedure
running in the meantime, the timer for the scheduled call may expire much
later, an order of magnitude or more if the procedure takes too much time.
Is this to be expected in general ? If not, does this may have to with the
delay being too short or the cpu-intensive procedure being mainly run in
an extension module ? Finally, is there a way to force the required delay
(with a tolerance of a few msec) ?

Thanks for any insight,

George



From njp at njp.us  Thu Jun 23 11:13:02 2005
From: njp at njp.us (Norm Petterson)
Date: Thu, 23 Jun 2005 13:13:02 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
Message-ID: <42BAED9E.8080304@njp.us>

George,

You don't say whether the cpu-intensive procedure is a part of your 
Twisted app (in which case it is an example of "blocking" behavior that 
you must design to eliminate yourself), or is running outside of Twisted 
(in which case you must utilize operating system features to run your 
Twisted app at a higher process priority).

Unlike the preemptive scheduling of real time operating systems, Twisted 
"scheduling" won't preempt anything already running.

HTH,

Norm


George Sakkis wrote:

>Hello all,
>
>I'm using twisted for a realtime simulation and I'm calling
>reactor.callLater() for scheduling actions to be performed after a fixed
>short delay (~60msec). However, if there is a cpu-intensive procedure
>running in the meantime, the timer for the scheduled call may expire much
>later, an order of magnitude or more if the procedure takes too much time.
>Is this to be expected in general ? If not, does this may have to with the
>delay being too short or the cpu-intensive procedure being mainly run in
>an extension module ? Finally, is there a way to force the required delay
>(with a tolerance of a few msec) ?
>
>Thanks for any insight,
>
>George
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>  
>



From ian at ianduggan.net  Thu Jun 23 11:13:55 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 23 Jun 2005 10:13:55 -0700
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
Message-ID: <200506231013.55704.ian@ianduggan.net>


The scheduling isn't preemptive. The main twisted thread would have to be 
passing through it's "find timed calls and run ones that are due" code within 
the window of time that you need.

Long calls in protocol code, or simply not being the currect process run by 
the processor would prevent it from scheduling your code in the time you 
need.

Think cooperative scheduling, not preemptive.

That being said, you might try adjusting the priority of the twisted process 
to give it more access to the CPU.

--Ian


On Thursday 23 June 2005 09:29, George Sakkis wrote:
> I'm using twisted for a realtime simulation and I'm calling
> reactor.callLater() for scheduling actions to be performed after a fixed
> short delay (~60msec). However, if there is a cpu-intensive procedure
> running in the meantime, the timer for the scheduled call may expire much
> later, an order of magnitude or more if the procedure takes too much time.
> Is this to be expected in general ? If not, does this may have to with the
> delay being too short or the cpu-intensive procedure being mainly run in
> an extension module ? Finally, is there a way to force the required delay
> (with a tolerance of a few msec) ?
>
> Thanks for any insight,
>
> George
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From bob at redivi.com  Thu Jun 23 11:30:19 2005
From: bob at redivi.com (Bob Ippolito)
Date: Thu, 23 Jun 2005 13:30:19 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <42BAED9E.8080304@njp.us>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
	<42BAED9E.8080304@njp.us>
Message-ID: <5686A4C6-5FA6-4E0E-A594-BBE974F1DE82@redivi.com>


On Jun 23, 2005, at 1:13 PM, Norm Petterson wrote:

> George Sakkis wrote:
>
>
>> I'm using twisted for a realtime simulation and I'm calling
>> reactor.callLater() for scheduling actions to be performed after a  
>> fixed
>> short delay (~60msec). However, if there is a cpu-intensive procedure
>> running in the meantime, the timer for the scheduled call may  
>> expire much
>> later, an order of magnitude or more if the procedure takes too  
>> much time.
>> Is this to be expected in general ? If not, does this may have to  
>> with the
>> delay being too short or the cpu-intensive procedure being mainly  
>> run in
>> an extension module ? Finally, is there a way to force the  
>> required delay
>> (with a tolerance of a few msec) ?
>>
>
> You don't say whether the cpu-intensive procedure is a part of your  
> Twisted app (in which case it is an example of "blocking" behavior  
> that you must design to eliminate yourself), or is running outside  
> of Twisted (in which case you must utilize operating system  
> features to run your Twisted app at a higher process priority).
>
> Unlike the preemptive scheduling of real time operating systems,  
> Twisted "scheduling" won't preempt anything already running.

Additionally, the precision of reactor.callLater is only as good as  
the precision of the reactor's primitive for timing (select, in the  
default reactor).  The precision of select varies widely based on the  
platform.

You might have more luck with twisted.internet.task.LoopingCall

-bob




From sebastien-lists at type-z.org  Thu Jun 23 11:44:02 2005
From: sebastien-lists at type-z.org (=?ISO-8859-1?Q?S=E9bastien_Pierre?=)
Date: Thu, 23 Jun 2005 19:44:02 +0200
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <5686A4C6-5FA6-4E0E-A594-BBE974F1DE82@redivi.com>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
	<42BAED9E.8080304@njp.us>
	<5686A4C6-5FA6-4E0E-A594-BBE974F1DE82@redivi.com>
Message-ID: <3D7AD863-2F7D-49E9-8A9A-FD9F44893458@type-z.org>

Hi !

Le 23 juin 05  19:30, Bob Ippolito a crit :

> Additionally, the precision of reactor.callLater is only as good as  
> the precision of the reactor's primitive for timing (select, in the  
> default reactor).  The precision of select varies widely based on  
> the platform.
>
> You might have more luck with twisted.internet.task.LoopingCall

This makes me want to ask if Twisted is able to run "smooth real  
time" processes. Say for instance that I have to run a process every  
second (with a precision of 0.1s). Can I be sure that after having  
run for 1 hours the process will have been executed 3600 times ? same  
for 1 day, 1 week, etc ?

The underlying question is wether Twisted supports periodic process  
that synchronize on the clock, and if so, how does it prevent delay  
propagation ?

TIA,

  -- Sbastien




From njp at njp.us  Thu Jun 23 12:27:20 2005
From: njp at njp.us (Norm Petterson)
Date: Thu, 23 Jun 2005 14:27:20 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <3D7AD863-2F7D-49E9-8A9A-FD9F44893458@type-z.org>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>	<42BAED9E.8080304@njp.us>	<5686A4C6-5FA6-4E0E-A594-BBE974F1DE82@redivi.com>
	<3D7AD863-2F7D-49E9-8A9A-FD9F44893458@type-z.org>
Message-ID: <42BAFF08.3050904@njp.us>



Sbastien Pierre wrote:

> Hi !
>
> Le 23 juin 05  19:30, Bob Ippolito a crit :
>
>> Additionally, the precision of reactor.callLater is only as good as  
>> the precision of the reactor's primitive for timing (select, in the  
>> default reactor).  The precision of select varies widely based on  
>> the platform.
>>
>> You might have more luck with twisted.internet.task.LoopingCall
>
>
> This makes me want to ask if Twisted is able to run "smooth real  
> time" processes. Say for instance that I have to run a process every  
> second (with a precision of 0.1s). Can I be sure that after having  
> run for 1 hours the process will have been executed 3600 times ? same  
> for 1 day, 1 week, etc ?
>
Based on  
http://twistedmatrix.com/pipermail/twisted-python/2004-March/007254.html,
I've been using twisted.internet.task.LoopingCall for applications 
calling for 1 second (or 2 second, or 10 second, etc.) indefinite 
repetition for the past year, and have noted minor slippage that I 
attribute to *not* bumping the twisted application process priority 
above its default on the platforms involved (Linux/DEC Alpha, W2K/Intel 
P4). If the slippage were unacceptable, I'd try raising process priority 
before anything else...

Norm




From psanchez at nortel.com  Thu Jun 23 12:43:38 2005
From: psanchez at nortel.com (Pedro Sanchez)
Date: Thu, 23 Jun 2005 14:43:38 -0400
Subject: [Twisted-Python] twisted.plugin (revised) documentation?
In-Reply-To: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>
References: <61DA7719C45FD31185280008C733EF6E04AC4DEF@XCHANGE>
Message-ID: <1119552219.6528.23.camel@pcard0ze.ca.nortel.com>

Hello,

Where can I find documentation on the current twisted.plugin framework?

The document "Writing a New Plug-In for mktap" at
http://twistedmatrix.com/projects/core/documentation/howto/plugin.html
seems to have outdated information. When I run the mktap command, as
instructed there, this is what I get:

$ mktap qotd
TwistedQuotes/plugins.tml:7: DeprecationWarning: The
twisted.python.plugin system is deprecated.  See twisted.plugin for the
revised edition.  tapname="qotd")

I'm running twisted 2.0.1 and I can't find any new documentation. The
document above is also found in doc/core/howto/plugin.html of the
current twisted distribution.

Thanks,

-- 
Pedro

PS. Note: the link to this mailing list at
http://twistedmatrix.com/projects/core/ is broken.

- http://twistedmatrix.com/cgi-bin/mailman/twisted-python
+ http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

should fix it.





From ian at ianduggan.net  Thu Jun 23 13:34:41 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 23 Jun 2005 12:34:41 -0700
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <42BAFF08.3050904@njp.us>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
	<3D7AD863-2F7D-49E9-8A9A-FD9F44893458@type-z.org>
	<42BAFF08.3050904@njp.us>
Message-ID: <200506231234.42167.ian@ianduggan.net>


On Thursday 23 June 2005 11:27, Norm Petterson wrote:
> http://twistedmatrix.com/pipermail/twisted-python/2004-March/007254.html,
> I've been using twisted.internet.task.LoopingCall for applications
> calling for 1 second (or 2 second, or 10 second, etc.) indefinite
> repetition for the past year, and have noted minor slippage that I
> attribute to *not* bumping the twisted application process priority
> above its default on the platforms involved (Linux/DEC Alpha, W2K/Intel
> P4). If the slippage were unacceptable, I'd try raising process priority
> before anything else...

Another idea is to do the bookkeeping yourself. 

1) Schedule something to wake up periodically. The period would depend on your 
desired level of smoothness.

2) Have it perform your task. 

3) If it notices that things are slipping (numer exectutions < number expected 
excutions) based on time.time(), it can run your operation however many times 
it needs to catch up.

--Ian



From exarkun at divmod.com  Thu Jun 23 13:44:47 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 15:44:47 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <200506231234.42167.ian@ianduggan.net>
Message-ID: <20050623194447.5047.412302185.divmod.quotient.7885@ohm>

On Thu, 23 Jun 2005 12:34:41 -0700, Ian Duggan <ian at ianduggan.net> wrote:
>
>On Thursday 23 June 2005 11:27, Norm Petterson wrote:
>> http://twistedmatrix.com/pipermail/twisted-python/2004-March/007254.html,
>> I've been using twisted.internet.task.LoopingCall for applications
>> calling for 1 second (or 2 second, or 10 second, etc.) indefinite
>> repetition for the past year, and have noted minor slippage that I
>> attribute to *not* bumping the twisted application process priority
>> above its default on the platforms involved (Linux/DEC Alpha, W2K/Intel
>> P4). If the slippage were unacceptable, I'd try raising process priority
>> before anything else...
>
>Another idea is to do the bookkeeping yourself.
>
>1) Schedule something to wake up periodically. The period would depend on your
>desired level of smoothness.
>
>2) Have it perform your task.
>
>3) If it notices that things are slipping (numer exectutions < number expected
>excutions) based on time.time(), it can run your operation however many times
>it needs to catch up.

This is precisely what LoopingCall does.

I'd be interested to hear more details about cases where LoopingCall does allow slippage.  As far as I know, there is no room for improvement here: the only thing that could cause it to slip is if the system clock were not maintaining time correctly, and in that case I believe you are pretty much screwed on anything time related (okay, maybe not, I guess you could have an NTP implementation and schedule things against that, rather than the system clock...)

Jp



From njp at njp.us  Thu Jun 23 14:36:00 2005
From: njp at njp.us (Norm Petterson)
Date: Thu, 23 Jun 2005 16:36:00 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <20050623194447.5047.412302185.divmod.quotient.7885@ohm>
References: <20050623194447.5047.412302185.divmod.quotient.7885@ohm>
Message-ID: <42BB1D30.306@njp.us>



Jp Calderone wrote:

> On Thu, 23 Jun 2005 12:34:41 -0700, Ian Duggan <ian at ianduggan.net> wrote:
>
>>
>> On Thursday 23 June 2005 11:27, Norm Petterson wrote:
>>
>>> If the slippage were unacceptable, I'd try raising process priority
>>> before anything else...
>>
>> Another idea is to do the bookkeeping yourself.
>
> I'd be interested to hear more details about cases where LoopingCall 
> does allow slippage.  As far as I know, there is no room for 
> improvement here: the only thing that could cause it to slip is if the 
> system clock were not maintaining time correctly, and in that case I 
> believe you are pretty much screwed on anything time related (okay, 
> maybe not, I guess you could have an NTP implementation and schedule 
> things against that, rather than the system clock...)
>
In my case, for instance, 86400 repeated 1 second TimerService calls 
might take a few minutes more than precisely 24 hours (which is 
acceptable, so I haven't checked further). I am guessing that something 
outside of Twisted, running at a higher process priority  occasionally 
ties up the machine long enough to miss at least one scheduled cycle, 
possibly even more than one. AFAICT LoopingCall doesn't make any attempt 
to compensate for entirely missed (i.e., catastrophically missed) 
cycles, only for the minor slippage that might otherwise lead to 
gradually missed ones. Right?

Not a Twisted issue; hence recommending bumping process priority.





From gsakkis at eden.rutgers.edu  Thu Jun 23 14:49:06 2005
From: gsakkis at eden.rutgers.edu (George Sakkis)
Date: Thu, 23 Jun 2005 16:49:06 -0400 (EDT)
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
Message-ID: <Pine.GSO.4.58.0506231646580.28870@er1.rutgers.edu>

Thank you everyone who wrote back,

>From the replies I gather that preemptive scheduling would do the trick.
If it's not provided out-of-the-box in Twisted, is there a way it can be
simulated ? Here's a little more context:
- There are two processes involved, one for a single server and the other
for a small number (2-22, in my case 5) of clients. Twisted controls the
client side. Each client:
    - communicates asynchronously with the server through UDP. Clients
don't talk to each other directly.
    - expects two (actually more but two are the important) types of
messages, say 'feel' and 'see'.
    - when 'feel' is received, it schedules a call with a delay of 50-90
ms. It also updates itself, a computationally light procedure (at least
for now).
    - when 'see' is received, it updates itself accordingly; this *is* cpu
intensive and most time is spent at an extension's module code (by the
way, it would be very helpful if I could optimize the extension but I
don't know how to profile it; any help here would be great).

Normally 'feel' messages arrive every 100ms and 'see' every 150ms. That's
more or less what I observe when the processing of 'see' is turned off.
When it is on however, messages are received with bursts, e.g. 7 'feel'
messages within 200ms instead of 2. This is surprising because if I
believe the profiler, 'see' is usually processed in 25 to 55ms, so a delay
of 60ms should be long enough. Is it going to help if the processing of
'see' is dispatched in a separate thread ?

George


> Hello all,
>
> I'm using twisted for a realtime simulation and I'm calling
> reactor.callLater() for scheduling actions to be performed after a fixed
> short delay (~60msec). However, if there is a cpu-intensive procedure
> running in the meantime, the timer for the scheduled call may expire much
> later, an order of magnitude or more if the procedure takes too much time.
> Is this to be expected in general ? If not, does this may have to with the
> delay being too short or the cpu-intensive procedure being mainly run in
> an extension module ? Finally, is there a way to force the required delay
> (with a tolerance of a few msec) ?
>
> Thanks for any insight,
>
> George
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From exarkun at divmod.com  Thu Jun 23 15:05:17 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 17:05:17 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <42BB1D30.306@njp.us>
Message-ID: <20050623210517.5047.1409793409.divmod.quotient.7917@ohm>

On Thu, 23 Jun 2005 16:36:00 -0400, Norm Petterson <njp at njp.us> wrote:
>
>
>Jp Calderone wrote:
>>On Thu, 23 Jun 2005 12:34:41 -0700, Ian Duggan <ian at ianduggan.net> wrote:
>>>
>>>On Thursday 23 June 2005 11:27, Norm Petterson wrote:
>>>>If the slippage were unacceptable, I'd try raising process priority
>>>>before anything else...
>>>
>>>Another idea is to do the bookkeeping yourself.
>>
>>I'd be interested to hear more details about cases where LoopingCall does 
>>allow slippage.  As far as I know, there is no room for improvement here: 
>>the only thing that could cause it to slip is if the system clock were not 
>>maintaining time correctly, and in that case I believe you are pretty much 
>>screwed on anything time related (okay, maybe not, I guess you could have 
>>an NTP implementation and schedule things against that, rather than the 
>>system clock...)
>In my case, for instance, 86400 repeated 1 second TimerService calls might 
>take a few minutes more than precisely 24 hours (which is acceptable, so I 
>haven't checked further). I am guessing that something outside of Twisted, 
>running at a higher process priority  occasionally ties up the machine long 
>enough to miss at least one scheduled cycle, possibly even more than one. 
>AFAICT LoopingCall doesn't make any attempt to compensate for entirely 
>missed (i.e., catastrophically missed) cycles, only for the minor slippage 
>that might otherwise lead to gradually missed ones. Right?
>
>Not a Twisted issue; hence recommending bumping process priority.
>

Aha, this makes perfect sense.  It's a different kind of slippage than what I thought you were talking about.

Jp



From db3l at fitlinxx.com  Thu Jun 23 15:17:38 2005
From: db3l at fitlinxx.com (David Bolen)
Date: 23 Jun 2005 17:17:38 -0400
Subject: [Twisted-Python] Re: Traceback from pb-Server
References: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <ull503h8t.fsf@fitlinxx.com>

Stephan Popp <Stephan.Popp at iisb.fraunhofer.de> writes:

> If the pythonscript named taskDescription.fileName isn't there 
> self.serverErrorCB is called - thats ok. But it prints:
> reason [Failure instance: Traceback from remote host -- Traceback unavailable]
> 
> But I need to know why the call failed. Can anyone please help me to get the 
> traceback or the exception message that the server prints 
> (exceptions.ImportError: No module named fitfunc2).

The returned Failure instance should still encapsulate the underlying
exception information in the type and value fields, as is usual with
Failure objects.  One difference from a local Failure instance though
is that type will be a string representation of the exception class
and not the class object itself in the PB client context.  If you
stick with failure.trap() and failure.check() for explicit exception
checks in errback chains, they handle both the direct class as well as
string version, so errback code will work locally or via a PB client.

So you can still identify the root exception (ImportError).  It just
happens to not show up in the default __str__ output for the failure
object (e.g., your print in your errback) but if you were to modify
that print to explicitly print out the type and value fields, and not
just let the failure object generate its own printable format, you can
see the information.  And checking for an exception itself rather than
looking for textual information in a traceback is probably better for
production code.

If you really want to see the traceback during development/debugging,
you should see them output as a log message on the server side (if you
have twisted logging going somewhere).  Alternatively, I believe you
can enable "unsafe" tracebacks (which sends the traceback to remote
clients) by setting the unsafeTracebacks attribute in the factory on
the side on which the exception is being generated - the
PBServerFactory side in your case.  For PBServerFactory, it's an
optional argument to the constructor.

-- David




From exarkun at divmod.com  Thu Jun 23 15:23:57 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 17:23:57 -0400
Subject: [Twisted-Python] twisted.plugin (revised) documentation?
In-Reply-To: <1119552219.6528.23.camel@pcard0ze.ca.nortel.com>
Message-ID: <20050623212357.5047.1072105749.divmod.quotient.7925@ohm>

On Thu, 23 Jun 2005 14:43:38 -0400, Pedro Sanchez <psanchez at nortel.com> wrote:
>Hello,
>
>Where can I find documentation on the current twisted.plugin framework?
>
>The document "Writing a New Plug-In for mktap" at
>http://twistedmatrix.com/projects/core/documentation/howto/plugin.html
>seems to have outdated information. When I run the mktap command, as
>instructed there, this is what I get:
>
>$ mktap qotd
>TwistedQuotes/plugins.tml:7: DeprecationWarning: The
>twisted.python.plugin system is deprecated.  See twisted.plugin for the
>revised edition.  tapname="qotd")
>
>I'm running twisted 2.0.1 and I can't find any new documentation. The
>document above is also found in doc/core/howto/plugin.html of the
>current twisted distribution.
>

It's on my list of things to write.

In brief, the way plugins are implemented now is:

1) in a module in the twisted.plugins (plural) package.  Such modules should be named in such a way so as not to conflict with plugins provided by other parties (eg, Twisted uses the convention of "twisted_foo" for plugins it itself offers).  Installers should place plugin modules in the twisted/plugins/ directory and call list(twisted.plugin.getPlugin(twisted.plugin.IPlugin)) afterwards to regenerate the system cache (not doing so is only detrimental in that operation without the cache is much slower).  Uninstallers should do something similar to avoid leaving stale cache entries (these will be found and pruned, but lead to at least one ugly traceback, and for a system-wide install, the user probably will not have access to rewrite the cache with bogus entries removed).  As a convenience to developers, plugins placed in a _directory_ (not a package) named "twisted/plugins/" in any directory in sys.path will automatically be found by the plugin system as well.  This avoids the install process during development and for testing.

2) In these modules, names bound to objects which provide (z.i terminology) twisted.plugin.IPlugin will be considered plugin objects and can potentially be returned by twisted.plugin.getPlugins()

3) Objects providing IPlugin should also provide some other application-specific interface.  When calling twisted.plugin.getPlugins(IFoo), only objects providing IFoo will be returned.

4) Plugin "client" code (that is, code calling getPlugin) is then responsible for calling methods appropriate to the interface it passed.

For examples of this, see the twisted_ modules in twisted/plugins/.

Hope this helps,

Jp



From exarkun at divmod.com  Thu Jun 23 15:32:21 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 17:32:21 -0400
Subject: [Twisted-Python] Traceback from pb-Server
In-Reply-To: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <20050623213221.5047.1135639581.divmod.quotient.7930@ohm>

On Thu, 23 Jun 2005 10:53:31 +0200, Stephan Popp <stephan.popp at iisb.fraunhofer.de> wrote:
>Hi,
>Please excuse my bad english, I hope you will understand what I mean,
>otherwise feel free to ask.
>I'm trying to get error messages from my server. I'm using twisted 2.0.0 with
>python 2.4.
>The server looks like this:
>
>from twisted.spread import pb
>from twisted.internet import reactor, threads
>
>class ServerObject(pb.Root):
>
>#...some other methods, which aren't involved...
>
>def remote_fitness(self, task, taskDescription, serverID):
>	return threads.deferToThread(self.calc, task, serverID, taskDescription)
>
>def calc(self, task, serverID, taskDescription):
>	exec('from %s import %s as func' %
>(taskDescription.fileName,taskDescription.functionName))

Note:

    exarkun at boson:~$ python
    Python 2.4.1 (#2, Mar 30 2005, 21:51:10) 
    [GCC 3.3.5 (Debian 1:3.3.5-8ubuntu2)] on linux2
    Type "help", "copyright", "credits" or "license" for more information.
    >>> def calc(a, b):
    ...     exec 'from %s import %s as func' % (a, b)
    ... 
    >>> calc("os import system; system('echo Boo'); from foo", "bar")
    Boo
    Traceback (most recent call last):
      File "<stdin>", line 1, in ?
      File "<stdin>", line 2, in calc
      File "<string>", line 1, in ?
    ImportError: No module named foo
    >>> 

Jp



From foom at fuhm.net  Thu Jun 23 15:35:49 2005
From: foom at fuhm.net (James Y Knight)
Date: Thu, 23 Jun 2005 17:35:49 -0400
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <42BB1D30.306@njp.us>
References: <20050623194447.5047.412302185.divmod.quotient.7885@ohm>
	<42BB1D30.306@njp.us>
Message-ID: <FF7CCE98-BA81-4AE8-AF88-5B46BDA0808A@fuhm.net>

On Jun 23, 2005, at 4:36 PM, Norm Petterson wrote:
> In my case, for instance, 86400 repeated 1 second TimerService  
> calls might take a few minutes more than precisely 24 hours (which  
> is acceptable, so I haven't checked further). I am guessing that  
> something outside of Twisted, running at a higher process priority   
> occasionally ties up the machine long enough to miss at least one  
> scheduled cycle, possibly even more than one. AFAICT LoopingCall  
> doesn't make any attempt to compensate for entirely missed (i.e.,  
> catastrophically missed) cycles, only for the minor slippage that  
> might otherwise lead to gradually missed ones. Right?

Right. It may be a desirable to add a subclass which will pass the  
number of cycles the function should run as the first argument. For  
many purposes (e.g. animation), it's acceptable to skip cycles, as  
long as you know how many you skipped and catch up the animation that  
far when you do end up getting scheduled.

James



From ian at ianduggan.net  Thu Jun 23 16:05:04 2005
From: ian at ianduggan.net (Ian Duggan)
Date: Thu, 23 Jun 2005 15:05:04 -0700
Subject: [Twisted-Python] Accurate delays in callLater
In-Reply-To: <Pine.GSO.4.58.0506231646580.28870@er1.rutgers.edu>
References: <Pine.GSO.4.58.0506231226240.21263@er1.rutgers.edu>
	<Pine.GSO.4.58.0506231646580.28870@er1.rutgers.edu>
Message-ID: <200506231505.05378.ian@ianduggan.net>


On Thursday 23 June 2005 13:49, George Sakkis wrote:
> Normally 'feel' messages arrive every 100ms and 'see' every 150ms. That's
> more or less what I observe when the processing of 'see' is turned off.
> When it is on however, messages are received with bursts, e.g. 7 'feel'
> messages within 200ms instead of 2. This is surprising because if I
> believe the profiler, 'see' is usually processed in 25 to 55ms, so a delay
> of 60ms should be long enough. Is it going to help if the processing of
> 'see' is dispatched in a separate thread ?

Hmm. My gut tells me that your "see" processing is not fast enough (or 
something is blocking), and things are backing up in queues. When it comes 
around to service your "feel" messages (once things are backed up) it goes 
through 7 very quickly since they are cheap to process.

If this is the case, moving "see" to a thread might help.

You might also try out the BigTimesliceTimer stuff and see if you are 
"blocking" for too long.

	http://svn.twistedmatrix.com/cvs/sandbox/exarkun/btt.py
	http://svn.twistedmatrix.com/cvs/sandbox/exarkun/test_btt.py

As an aside, what is considered a reasonable amount of time for a function to 
run in in twisted?

--Ian



From bruce at cubik.org  Thu Jun 23 16:09:31 2005
From: bruce at cubik.org (Bruce Mitchener)
Date: Thu, 23 Jun 2005 16:09:31 -0600
Subject: [Twisted-Python] PB SturdyRef issue
Message-ID: <42BB331B.1050307@cubik.org>

I'm using something similar in style to a pb.SturdyRef and have run 
across a problem with it:

While it handles pb.DeadReferenceError, it doesn't handle the 
pb.PBConnectionLost that can come back as an errback from the callRemote.

Is there some way that I can juggle deferreds so that the caller can get 
the response from the server after I reconnect and re-try like what 
happens in the case of pb.DeadReferenceError?

It doesn't seem like I can just attach an errback to the deferred and in 
that errback, do a failure.trap(pb.PBConnectionLost) and then do 
something to bind a new deferred into the callback chain ...

Is there something that can happen magically by returning a new deferred 
from the errback that successfully traps the PBConnectionLost?

Thoughts?

  - Bruce



From exarkun at divmod.com  Thu Jun 23 17:02:25 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Thu, 23 Jun 2005 19:02:25 -0400
Subject: [Twisted-Python] Capture blocking calls?
In-Reply-To: <50a522ca05062102402aad620@mail.gmail.com>
Message-ID: <20050623230225.5047.2026626881.divmod.quotient.7968@ohm>

On Tue, 21 Jun 2005 10:40:54 +0100, Michael Twomey <micktwomey at gmail.com> wrote:
>Hi,
>
>I've tried it out too and it seems to work well (I have to also
>commend Jp on the sneakiness of the signal approach).
>
>Since I don't have the dl module with my copy of mac python I've
>attached a small patch which makes btt use the itimer module py-itimer
>(http://www.cute.fi/~torppa/py-itimer/) if it can't import dl.
>

Thanks, I've applied a slightly modified version of this to svn.  I assume py-itimer works and such, so I just made it the preferred mechanism, falling back to dl if it is not available.

Jp



From gmcdonald at infocomp.com  Thu Jun 23 17:02:22 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Fri, 24 Jun 2005 09:02:22 +1000
Subject: [Twisted-Python] Documentation: producing standalone win32 exes for
	twisted
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4E01@XCHANGE>

All,

As a general question, would anyone find it useful to have in the twisted
documentation specific information on producing twisted win32 executables
(be this twistd, a service, or utilising a plugin) using py2exe?  I would be
happy to create such doco since I have had to produce several different
types of win32 exes using twisted components and am aware of some of the
pitfalls ;)

Grant

P.S. How does the new plugin system work with regards to running the plugin?
Is it any different?

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com]On Behalf Of Jp Calderone
Sent: 24 June 2005 07:24
To: Twisted general discussion
Subject: Re: [Twisted-Python] twisted.plugin (revised) documentation?

On Thu, 23 Jun 2005 14:43:38 -0400, Pedro Sanchez <psanchez at nortel.com>
wrote:
>Hello,
>
>Where can I find documentation on the current twisted.plugin framework?
>
>The document "Writing a New Plug-In for mktap" at
>http://twistedmatrix.com/projects/core/documentation/howto/plugin.html
>seems to have outdated information. When I run the mktap command, as
>instructed there, this is what I get:
>
>$ mktap qotd
>TwistedQuotes/plugins.tml:7: DeprecationWarning: The
>twisted.python.plugin system is deprecated.  See twisted.plugin for the
>revised edition.  tapname="qotd")
>
>I'm running twisted 2.0.1 and I can't find any new documentation. The
>document above is also found in doc/core/howto/plugin.html of the
>current twisted distribution.
>

It's on my list of things to write.

In brief, the way plugins are implemented now is:

1) in a module in the twisted.plugins (plural) package.  Such modules should
be named in such a way so as not to conflict with plugins provided by other
parties (eg, Twisted uses the convention of "twisted_foo" for plugins it
itself offers).  Installers should place plugin modules in the
twisted/plugins/ directory and call
list(twisted.plugin.getPlugin(twisted.plugin.IPlugin)) afterwards to
regenerate the system cache (not doing so is only detrimental in that
operation without the cache is much slower).  Uninstallers should do
something similar to avoid leaving stale cache entries (these will be found
and pruned, but lead to at least one ugly traceback, and for a system-wide
install, the user probably will not have access to rewrite the cache with
bogus entries removed).  As a convenience to developers, plugins placed in a
_directory_ (not a package) named "twisted/plugins/" in any directory in
sys.path will automatically be found by the plugin system as well.  This
avoids the install process during development and for testing.

2) In these modules, names bound to objects which provide (z.i terminology)
twisted.plugin.IPlugin will be considered plugin objects and can potentially
be returned by twisted.plugin.getPlugins()

3) Objects providing IPlugin should also provide some other
application-specific interface.  When calling
twisted.plugin.getPlugins(IFoo), only objects providing IFoo will be
returned.

4) Plugin "client" code (that is, code calling getPlugin) is then
responsible for calling methods appropriate to the interface it passed.

For examples of this, see the twisted_ modules in twisted/plugins/.

Hope this helps,

Jp

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050624/76768ea7/attachment.html>

From sebastian.hanlon at uleth.ca  Thu Jun 23 17:25:43 2005
From: sebastian.hanlon at uleth.ca (Sebastian Hanlon)
Date: Thu, 23 Jun 2005 17:25:43 -0600
Subject: [Twisted-Python] _Dereference problems with jelly, pb.Cacheable,
	and cyclic references
Message-ID: <42BB44F7.7010108@uleth.ca>

I'm having problems trying to spread a data structure using 
pb.Cacheable. The general framework involves three classes: Alpha, 
Bravo, and Charlie. Alpha maintains a list of Bravos and Charlies. 
Bravos can reference Charlies and Charlies reference Bravos. When they 
get unserialized, though, some of the Charlies have _Dereference objects 
where references to Bravos should be. The Bravos themselves come across 
the wire just fine.

A simple example program is attached. To run it, first start the server 
by running 'python jelly-test.py server', then run the client with 
'python jelly-test.py client'. You should get a _Dereference in the list
of Charlies printed by the client, like such:

--cut here--
bravos:
Bravo(0) [<__main__.RemoteCharlie instance at 0x00C14DA0>]
Bravo(1) [<__main__.RemoteCharlie instance at 0x00C14DA0>, 
<__main__.RemoteCharlie instance at 0x00C19058>]
Bravo(2) [<__main__.RemoteCharlie instance at 0x00C19058>]
--------------------------------------------------
charlies:
Charlie(Bravo(0),Bravo(1))
Charlie(<twisted.persisted.crefutil._Dereference instance at 
0x00C190A8>,Bravo(2))
--cut here--

Can anyone help? I'm running the latest Twisted SVN on Python 2.3.4.

-Sebastian
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: jelly-test.py
URL: </pipermail/twisted-python/attachments/20050623/c637f14c/attachment.ksh>

From mary-twisted at puzzling.org  Thu Jun 23 17:25:49 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Fri, 24 Jun 2005 09:25:49 +1000
Subject: [Twisted-Python] Documentation: producing standalone win32 exes
	for twisted
In-Reply-To: <61DA7719C45FD31185280008C733EF6E04AC4E01@XCHANGE>
References: <61DA7719C45FD31185280008C733EF6E04AC4E01@XCHANGE>
Message-ID: <20050623232549.GA5094@home.puzzling.org>

On Fri, Jun 24, 2005, Grant McDonald wrote:
> All,
> 
> As a general question, would anyone find it useful to have in the twisted
> documentation specific information on producing twisted win32 executables
> (be this twistd, a service, or utilising a plugin) using py2exe?  I would be
> happy to create such doco since I have had to produce several different
> types of win32 exes using twisted components and am aware of some of the
> pitfalls ;)

As a general principle, more documentation is always welcome. So I would
say "yes".

-Mary



From Henning.Ramm at mediapro-gmbh.de  Thu Jun 23 17:38:01 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Fri, 24 Jun 2005 01:38:01 +0200
Subject: [Twisted-Python] Documentation: producing standalone win32 exes
	fortwisted
Message-ID: <F92274058556DE42B94B148EEFB9183949E736@exchange-03.suedkurier.de>

> As a general question, would anyone find it useful to have in the twisted documentation specific information on producing twisted win32 executables (be this twistd, a service, or utilising a plugin) using py2exe?  I would be happy to create such doco since I have had to produce several different types of win32 exes using twisted components and am aware of some of the pitfalls ;)

In addition to Mary's general 'yes', I'd be especially interested in "howto make a Win service from a twisted app" (I'd like to run my server on a server ;-) without logged in user).


Best regards,
Henning Hraban Ramm
Sdkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From gmcdonald at infocomp.com  Thu Jun 23 17:58:38 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Fri, 24 Jun 2005 09:58:38 +1000
Subject: [Twisted-Python] Documentation: producing standalone win32 exes
	fortwisted
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4E02@XCHANGE>

All,

> In addition to Mary's general 'yes', I'd be especially interested in
> "howto make a Win service from a twisted app" (I'd like to run my server
> on a server ;-) without logged in user).

There are a number of caveats to creating services (both on the twisted side
and the windows side) which I will make sure to document.

I have created an issue in the bug tracker for the documentation:

http://twistedmatrix.com/bugs/issue1092

Regards,

Grant M
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050624/d2c0198f/attachment.html>

From andrew-twisted at puzzling.org  Thu Jun 23 19:58:10 2005
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Fri, 24 Jun 2005 11:58:10 +1000
Subject: [Twisted-Python] PB SturdyRef issue
In-Reply-To: <42BB331B.1050307@cubik.org>
References: <42BB331B.1050307@cubik.org>
Message-ID: <20050624015810.GI28646@trogdor.home.puzzling.org>

On Thu, Jun 23, 2005 at 04:09:31PM -0600, Bruce Mitchener wrote:
> I'm using something similar in style to a pb.SturdyRef and have run 
> across a problem with it:
> 
> While it handles pb.DeadReferenceError, it doesn't handle the 
> pb.PBConnectionLost that can come back as an errback from the callRemote.
> 
> Is there some way that I can juggle deferreds so that the caller can get 
> the response from the server after I reconnect and re-try like what 
> happens in the case of pb.DeadReferenceError?
> 
> It doesn't seem like I can just attach an errback to the deferred and in 
> that errback, do a failure.trap(pb.PBConnectionLost) and then do 
> something to bind a new deferred into the callback chain ...
> 
> Is there something that can happen magically by returning a new deferred 
> from the errback that successfully traps the PBConnectionLost?

If you return a Deferred from a callback/errback, the outer Deferred will
wait for the inner Deferred to fire before continuing with its callback
chain.  It sounds like this is the magic you are looking for.

So here's one way to take advantage of that:

def sturdyRemoteCall(foo, *args, **kwargs):

    d = ...  # whatever you do to make the remote call, handle
             # DeadReferenceErrors, etc.

    def retryOnConnectionLost(failure):
        failure.trap(pb.PBConnectionLost)
        return sturdyRemoteCall(foo, *args, **kwargs)

    d.addErrback(retryOnConnectionLost)
    return d

-Andrew.




From jmhayes at speakeasy.net  Thu Jun 23 20:16:30 2005
From: jmhayes at speakeasy.net (Jordan Hayes)
Date: Thu, 23 Jun 2005 19:16:30 -0700
Subject: [Twisted-Python] Twisted / NNTP / Mailman
Message-ID: <026201c57862$bc3f4b80$1048a8c0@PAD2>

Has anyone worked on this integration?

I see it as an NNTP server using the Mailman database as the
backing-store.  Read-only would be fine, actually.

/jordan




From Stephan.Popp at iisb.fraunhofer.de  Fri Jun 24 01:11:40 2005
From: Stephan.Popp at iisb.fraunhofer.de (Stephan Popp)
Date: Fri, 24 Jun 2005 09:11:40 +0200
Subject: [Twisted-Python] Traceback from pb-Server
In-Reply-To: <ull503h8t.fsf@fitlinxx.com>
References: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>
	<ull503h8t.fsf@fitlinxx.com>
Message-ID: <200506240911.40276.Stephan.Popp@iisb.fraunhofer.de>

Hi,
thanks for the help. Everything is fine now.

Stephan



From digi at treepy.com  Fri Jun 24 03:34:09 2005
From: digi at treepy.com (Patrick Lauber)
Date: Fri, 24 Jun 2005 11:34:09 +0200
Subject: [Twisted-Python] too many file descriptors on win2003 server
In-Reply-To: <200506240911.40276.Stephan.Popp@iisb.fraunhofer.de>
References: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>	<ull503h8t.fsf@fitlinxx.com>
	<200506240911.40276.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <42BBD391.2030709@treepy.com>

hi,

I have a server that acts as a Flash-XML-Socket Server that pushes data 
to the clients in a irregular interval. It is running on win2003 server 
and i get the "too many file descriptors in select()" error when i hit 
the 512 mark. Is there a way to extend this limit? the poll reactor 
doesn't seam to work under win. is the win32 reactor better at large 
simultaneous connections?

cheers

pat




From psanchez at nortel.com  Fri Jun 24 07:05:13 2005
From: psanchez at nortel.com (Pedro Sanchez)
Date: Fri, 24 Jun 2005 09:05:13 -0400
Subject: [Twisted-Python] twisted.plugin (revised) documentation?
In-Reply-To: <20050623212357.5047.1072105749.divmod.quotient.7925@ohm>
References: <20050623212357.5047.1072105749.divmod.quotient.7925@ohm>
Message-ID: <1119618313.6528.27.camel@pcard0ze.ca.nortel.com>

On Thu, 2005-23-06 at 17:23 -0400, Jp Calderone wrote:

> It's on my list of things to write.
> ....
> For examples of this, see the twisted_ modules in twisted/plugins/.
> 
> Hope this helps,
> 
> Jp
> 
Thank you, it helps. I would suggest you add a little note at the
beginning of the current documentation on the web site to let new comers
like me know from the start that the documentation is not up to date.

Thanks,

-- 
Pedro





From itamar at itamarst.org  Fri Jun 24 09:25:02 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Fri, 24 Jun 2005 11:25:02 -0400
Subject: [Twisted-Python] too many file descriptors on win2003 server
In-Reply-To: <42BBD391.2030709@treepy.com>
References: <200506231053.31280.Stephan.Popp@iisb.fraunhofer.de>
	<ull503h8t.fsf@fitlinxx.com>
	<200506240911.40276.Stephan.Popp@iisb.fraunhofer.de>
	<42BBD391.2030709@treepy.com>
Message-ID: <1119626702.8159.29.camel@localhost.localdomain>

On Fri, 2005-06-24 at 11:34 +0200, Patrick Lauber wrote:

> I have a server that acts as a Flash-XML-Socket Server that pushes data 
> to the clients in a irregular interval. It is running on win2003 server 
> and i get the "too many file descriptors in select()" error when i hit 
> the 512 mark. Is there a way to extend this limit? the poll reactor 
> doesn't seam to work under win. is the win32 reactor better at large 
> simultaneous connections?

No, win32eventreactor is worse, it only does 64. The 512 limit comes
from Python, it #defines FD_SETSIZE to be 512 in the C socket extension
module; the default without this would have been 64 as well.

Your options: 

1. Compile your own version of the _socket.pyd for Windows, patched to
have a higher FD_SETSIZE.

2. Try the IOCP reactor, it might work, and certainly shouldn't have
limits on number of sockets.

more aggressive timeouts on client connections should help somewhat as
well, though they don't solve the real issue.





From Henning.Ramm at mediapro-gmbh.de  Fri Jun 24 11:12:46 2005
From: Henning.Ramm at mediapro-gmbh.de (Henning.Ramm at mediapro-gmbh.de)
Date: Fri, 24 Jun 2005 19:12:46 +0200
Subject: [Twisted-Python] Documentation: producing standalone win32
	exesfortwisted
Message-ID: <F92274058556DE42B94B148EEFB9183949E739@exchange-03.suedkurier.de>

> There are a number of caveats to creating services
> (both on the twisted side and the windows side)
> which I will make sure to document.

That's good; I don't trust in my abilities so far to implement such without advice.

http://www.adelux.fr/libre/howto/deployTwistedWindows
looks good so far! (Even if I just have no time to try it.) Thank you in advance!


Best regards,
Henning Hraban Ramm
Sdkurier Medienhaus / MediaPro
Support/Admin/Development Dept.



From exarkun at divmod.com  Sun Jun 26 12:56:17 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Sun, 26 Jun 2005 14:56:17 -0400
Subject: [Twisted-Python] Dropping support for old cred
In-Reply-To: 0
Message-ID: <20050626185617.26278.1290810310.divmod.quotient.1031@ohm>

The modules:

  twisted.cred.authorizer
  twisted.cred.identity
  twisted.cred.service
  twisted.cred.perspective

constitute "classic cred", which has been deprecated for some time now.  "New cred" is available in the modules:

  twisted.cred.portal
  twisted.cred.checkers
  twisted.cred.credentials

and offers a vastly superior API.  The only remaining code in Twisted which uses "classic cred" is the old PB log in method, which is also deprecated (in favor of one based around new cred), and the old application code (twisted.internet.app) which is also deprecated in favor of twisted.application.

It would be nice to remove this code from the next Twisted release.  Does anyone have any applications still relying on them which they plan to use with Twisted 2.1?  If so, what is preventing you from updating the code to the new, vastly improved APIs?

Jp & Itamar



From bruce at cubik.org  Sun Jun 26 13:23:07 2005
From: bruce at cubik.org (Bruce Mitchener)
Date: Sun, 26 Jun 2005 13:23:07 -0600
Subject: [Twisted-Python] Dropping support for old cred
In-Reply-To: <20050626185617.26278.1290810310.divmod.quotient.1031@ohm>
References: <20050626185617.26278.1290810310.divmod.quotient.1031@ohm>
Message-ID: <42BF009B.1050804@cubik.org>

Jp Calderone wrote:
> and offers a vastly superior API.  The only remaining code in Twisted 
> which uses "classic cred" is the old PB log in method, which is also 
> deprecated (in favor of one based around new cred), and the old 
> application code (twisted.internet.app) which is also deprecated in 
> favor of twisted.application.
> 
> It would be nice to remove this code from the next Twisted release.  
> Does anyone have any applications still relying on them which they plan 
> to use with Twisted 2.1?  If so, what is preventing you from updating 
> the code to the new, vastly improved APIs?

Our codebase at work still uses old cred.  I've never had the time or 
customer requirement to do the upgrade.  Unless I'd get a performance 
benefit out of it, it'd be hard to justify the time spent.

On the other hand, perhaps I do not need Twisted 2.1 either.  What do I 
stand to gain by making the switch?  What benefit can I use to sell 
this?  I assume that I could do this fairly incrementally as we have 
about 10 different processes that communicate within a server cluster 
over PB.  I still use the old PB APIs too (so no PBClientFactory for me!).

We still use the old application code as well for the same sorts of 
reasons. :)  I don't think we have anything that relies on that though, 
we just use barebones tap files (more deprecated code!).

  - Bruce



From glyph at divmod.com  Sun Jun 26 13:35:58 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Sun, 26 Jun 2005 15:35:58 -0400
Subject: [Twisted-Python] Dropping support for old cred
In-Reply-To: <42BF009B.1050804@cubik.org>
References: <20050626185617.26278.1290810310.divmod.quotient.1031@ohm>
	<42BF009B.1050804@cubik.org>
Message-ID: <42BF039E.6030205@divmod.com>

Bruce Mitchener wrote:
> Jp Calderone wrote:

> Our codebase at work still uses old cred.  I've never had the time or 
> customer requirement to do the upgrade.  Unless I'd get a performance 
> benefit out of it, it'd be hard to justify the time spent.

old->new cred would have zero performance benefit, I'd guess.  Twisted 
1.3->2.1 might have some but I don't believe anyone's measured it 
comprehensively yet.  1.3->2.1 with deprecations would almost certainly 
be a slowdown.

> On the other hand, perhaps I do not need Twisted 2.1 either.  What do I 
> stand to gain by making the switch?  What benefit can I use to sell 
> this?  I assume that I could do this fairly incrementally as we have 
> about 10 different processes that communicate within a server cluster 
> over PB.  I still use the old PB APIs too (so no PBClientFactory for me!).

Given what I know about your application, upgrading to 2.1 wouldn't be a 
big win.  At some point - if we are anywhere close to the "schedule" 
that I imagine, this would be around 2.2 - there will be several new 
protocols availble and you might want to upgrade to make use of those. 
The main advantage of new cred is that it gives a consistent view of 
login and session management across all protocols that your application 
supports.  Right now the featureset is rather bare-bones, but I have 
plans to build upon the existing API and add features to support things 
like cross-protocol session management and authentication (e.g. 
automatic support for things like SMTP-after-POP authentication, but 
using any two protocols).  Something like that would be totally 
impossible with old cred, since it barely even provides an abstraction 
for the same sorts of things that new cred does.

At some point NewPB will arrive, too - and when that does, I believe 
that the upgrade in terms of performance and security will be well worth 
it.  Talk to warner about when that might happen though, it's still a 
mystery to me :).




From gmcdonald at infocomp.com  Sun Jun 26 18:11:40 2005
From: gmcdonald at infocomp.com (Grant McDonald)
Date: Mon, 27 Jun 2005 10:11:40 +1000
Subject: [Twisted-Python] loading application files from zip files for
	frozen exes
Message-ID: <61DA7719C45FD31185280008C733EF6E04AC4E10@XCHANGE>

Hi All,

When packaging a twisted server implementation with py2exe that uses .tac
(.py) files one ends up with a zip file with all the python dependencies (as
.pyo bytecode), an .exe and the .tac files in the package directory. To me
this seems a bit messy since the distribution is by definition a 'frozen'
exe and any changes to the python modules in the zip will require a rebuild.

With this limitation in mind I initially wrote several patches to twisted
core modules to allow an application to be loaded from a zip file (only .py
modules) which i attached to issue 1092
(http://twistedmatrix.com/bugs/issue1092). Upon further reflection I
realised that this functionality is only really useful in the case of exes
frozen with py2exe and I rewrote my patch to be completely external to the
twisted core (code and test modules which i have attached to this mail).
Would you consider perhaps inclusion of this in the twisted/scripts
directory with a short note in a howto?

Regards,

Grant M

P.S. this allows you to specify:

twistd.exe -y <name>

where <name> is the python module name without the .py

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050627/0a934460/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: arc_twistw.py
Type: application/octet-stream
Size: 3783 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050627/0a934460/attachment-0006.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: exesetup.py
Type: application/octet-stream
Size: 1335 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050627/0a934460/attachment-0007.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test_arc_twistw.py
Type: application/octet-stream
Size: 1067 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20050627/0a934460/attachment-0008.obj>

From tdickenson at devmail.geminidataloggers.co.uk  Tue Jun 28 03:47:04 2005
From: tdickenson at devmail.geminidataloggers.co.uk (Toby Dickenson)
Date: Tue, 28 Jun 2005 10:47:04 +0100
Subject: [Twisted-Python] Limiting number of concurrent client connections
Message-ID: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>

Im finding that Win32Reactor raises an exception on every iteration of the 
main loop if I exceed the limit of 64 WaitForMultipleObjects. 

I would prefer to avoid this fairly obvious denial-of-service problem by 
limiting the number of concurrent client connections. Is there a standard 
solution for this?

Thanks in advance,

-- 
Toby Dickenson



From nkeric at gmail.com  Tue Jun 28 06:36:40 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Tue, 28 Jun 2005 20:36:40 +0800
Subject: [Twisted-Python] Is it possible to write a tcp app which behaves
	like both client and server?
Message-ID: <43c0d2b5050628053616b33dba@mail.gmail.com>

Hi all!

Sorry for my poor english, I'll try to express myself clearly :p

I need to implement something like this:

 * it listens on a port 12345 for only one incoming connection if
there is currently no connection
 * it can also connect to other host from that port (12345) if there
is currently no connection

Or: Could I write a server which can connect (from the port it's
listening on) to another known server?

Could these be done with twisted?


Any infomatin would be warmly welcome, big thanks!

- Eric



From justinjohnson at gmail.com  Tue Jun 28 07:53:45 2005
From: justinjohnson at gmail.com (Justin Johnson)
Date: Tue, 28 Jun 2005 08:53:45 -0500
Subject: [Twisted-Python] Limiting number of concurrent client connections
In-Reply-To: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>
References: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>
Message-ID: <94a776e705062806537ab1dba9@mail.gmail.com>

This isn't the best solution, but I've been using a semaphore to limit the 
number of "tasks" that take place at a time. I've also been doing some 
research on IOCP and plan on adding some missing functionality to the IOCP 
reactor so I don't have to use the win32eventreactor anymore.
   
from twisted.internet import defer

class Semaphore:
"""A semaphore for event driven systems."""
def __init__(self, tokens):
self.waiting = []
self.tokens = tokens
self.limit = tokens

def acquire(self):
"""Attempt to acquire the token.

@return Deferred which returns on token acquisition.
"""
assert self.tokens >= 0
d = defer.Deferred()
if not self.tokens:
self.waiting.append(d)
else:
self.tokens = self.tokens - 1
d.callback(self)
return d

def release(self):
"""Release the token.

Should be called by whoever did the acquire() when the shared
resource is free.
"""
assert self.tokens < self.limit
self.tokens = self.tokens + 1
if self.waiting:
# someone is waiting to acquire token
self.tokens = self.tokens - 1
d = self.waiting.pop(0)
d.callback(self)

def _releaseAndReturn(self, r):
self.release()
return r

def run(self, f, *args, **kwargs):
"""Acquire token, run function, release token.

@return Deferred of function result.
"""
d = self.acquire()
d.addCallback(lambda r: defer.maybeDeferred(f, *args, 
**kwargs).addBoth(self._releaseAndReturn))
return d


 On 6/28/05, Toby Dickenson <tdickenson at devmail.geminidataloggers.co.uk> 
wrote: 
> 
> Im finding that Win32Reactor raises an exception on every iteration of the
> main loop if I exceed the limit of 64 WaitForMultipleObjects.
> 
> I would prefer to avoid this fairly obvious denial-of-service problem by
> limiting the number of concurrent client connections. Is there a standard
> solution for this?
> 
> Thanks in advance,
> 
> --
> Toby Dickenson
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050628/1cb432ae/attachment.html>

From exarkun at divmod.com  Tue Jun 28 08:10:52 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 28 Jun 2005 10:10:52 -0400
Subject: [Twisted-Python] Limiting number of concurrent client connections
In-Reply-To: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>
Message-ID: <20050628141052.26278.1286405978.divmod.quotient.2053@ohm>

On Tue, 28 Jun 2005 10:47:04 +0100, Toby Dickenson <tdickenson at devmail.geminidataloggers.co.uk> wrote:
>Im finding that Win32Reactor raises an exception on every iteration of the
>main loop if I exceed the limit of 64 WaitForMultipleObjects.
>
>I would prefer to avoid this fairly obvious denial-of-service problem by
>limiting the number of concurrent client connections. Is there a standard
>solution for this?
>

Count the number of connections you have accepted.  When you get up to 62 or 63 or so, stop accepting new ones.  If ServerFactory.buildProtocol() returns None, Twisted immediately closes the accepted connection.  If you do this (perhaps in conjunction with calling stopListening() on the port returned by listenXYZ()), you'll never overrun the 64 object limit.

Jp



From justinjohnson at gmail.com  Tue Jun 28 08:50:49 2005
From: justinjohnson at gmail.com (Justin Johnson)
Date: Tue, 28 Jun 2005 09:50:49 -0500
Subject: [Twisted-Python] Limiting number of concurrent client connections
In-Reply-To: <20050628141052.26278.1286405978.divmod.quotient.2053@ohm>
References: <200506281047.04810.tdickenson@devmail.geminidataloggers.co.uk>
	<20050628141052.26278.1286405978.divmod.quotient.2053@ohm>
Message-ID: <94a776e705062807503652f841@mail.gmail.com>

>From my experience, the problem has to do with more than just number of 
connections. I've reached the limit from spawning too many processes.

On 6/28/05, Jp Calderone <exarkun at divmod.com> wrote: 
> 
> On Tue, 28 Jun 2005 10:47:04 +0100, Toby Dickenson <
> tdickenson at devmail.geminidataloggers.co.uk> wrote:
> >Im finding that Win32Reactor raises an exception on every iteration of 
> the
> >main loop if I exceed the limit of 64 WaitForMultipleObjects.
> >
> >I would prefer to avoid this fairly obvious denial-of-service problem by
> >limiting the number of concurrent client connections. Is there a standard
> >solution for this?
> >
> 
> Count the number of connections you have accepted. When you get up to 62 
> or 63 or so, stop accepting new ones. If ServerFactory.buildProtocol() 
> returns None, Twisted immediately closes the accepted connection. If you do 
> this (perhaps in conjunction with calling stopListening() on the port 
> returned by listenXYZ()), you'll never overrun the 64 object limit.
> 
> Jp
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20050628/79506c90/attachment.html>

From itamar at itamarst.org  Tue Jun 28 08:56:25 2005
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Tue, 28 Jun 2005 10:56:25 -0400
Subject: [Twisted-Python] Is it possible to write a tcp app which
	behaves like both client and server?
In-Reply-To: <43c0d2b5050628053616b33dba@mail.gmail.com>
References: <43c0d2b5050628053616b33dba@mail.gmail.com>
Message-ID: <1119970585.8392.24.camel@localhost.localdomain>

On Tue, 2005-06-28 at 20:36 +0800, Eric Hsu wrote:

> Or: Could I write a server which can connect (from the port it's
> listening on) to another known server?

You can't have (in TCP) something that is both server and client on same
port. You can either connect while bound to a port or you can listen to
a port. It is possible with UDP, however.

However: there is no reason why TCP clients should connect *from* a
specific port, it doesn't give you anything. So why bother? Just have
servers listen on a well known port.




From exarkun at divmod.com  Tue Jun 28 09:00:59 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Tue, 28 Jun 2005 11:00:59 -0400
Subject: [Twisted-Python] Limiting number of concurrent client connections
In-Reply-To: <94a776e705062807503652f841@mail.gmail.com>
Message-ID: <20050628150059.26278.1051040058.divmod.quotient.2064@ohm>

On Tue, 28 Jun 2005 09:50:49 -0500, Justin Johnson <justinjohnson at gmail.com> wrote:
>>From my experience, the problem has to do with more than just number of
>connections. I've reached the limit from spawning too many processes.

Right.  You need to take into account everything that is happening in the process.  Client connections you create, processes you spawn, _and_ incoming connections you accept.  The below lets you limit one of these factors.  A solution like the semaphore you posted (a version of which is in Twisted 2.0, btw, for those who aren't aware - twisted.internet.defer.DeferredSemaphore) would let you limit the others.

Jp



From nkeric at gmail.com  Tue Jun 28 20:30:52 2005
From: nkeric at gmail.com (Eric Hsu)
Date: Wed, 29 Jun 2005 10:30:52 +0800
Subject: [Twisted-Python] Is it possible to write a tcp app which behaves
	like both client and server?
In-Reply-To: <1119970585.8392.24.camel@localhost.localdomain>
References: <43c0d2b5050628053616b33dba@mail.gmail.com>
	<1119970585.8392.24.camel@localhost.localdomain>
Message-ID: <43c0d2b5050628193061efa55@mail.gmail.com>

Itamar, thank you for your quick reply!

It helps me a lot to make things clear, since I've misunderstood
something important of the application I'm trying to implement ^_^

- Eric

2005/6/28, Itamar Shtull-Trauring <itamar at itamarst.org>:
> On Tue, 2005-06-28 at 20:36 +0800, Eric Hsu wrote:
> 
> > Or: Could I write a server which can connect (from the port it's
> > listening on) to another known server?
> 
> You can't have (in TCP) something that is both server and client on same
> port.



From Stephan.Popp at iisb.fraunhofer.de  Wed Jun 29 06:18:03 2005
From: Stephan.Popp at iisb.fraunhofer.de (Stephan Popp)
Date: Wed, 29 Jun 2005 14:18:03 +0200
Subject: [Twisted-Python] Passing arguments to application
Message-ID: <200506291418.03314.Stephan.Popp@iisb.fraunhofer.de>

Hi,
maybe I haven't searched enough, but I don't find anything that halps me to 
solve my problem.
I've got a serverapplication. The problem is in the following lines:

application = service.Application("TwistedServerApp")
internet.TCPServer(8800, pb.ServerFactory...)

I don't want to start this with a predetermined port. More like:

twistd -y TwistedServerApp.tac 8800

Is this somehow possible? sys.argv seems impossible to use.

-Stephan



From exarkun at divmod.com  Wed Jun 29 06:30:17 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Wed, 29 Jun 2005 08:30:17 -0400
Subject: [Twisted-Python] Passing arguments to application
In-Reply-To: <200506291418.03314.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <20050629123017.26278.917704695.divmod.quotient.2526@ohm>

On Wed, 29 Jun 2005 14:18:03 +0200, Stephan Popp <stephan.popp at iisb.fraunhofer.de> wrote:
>Hi,
>maybe I haven't searched enough, but I don't find anything that halps me to
>solve my problem.
>I've got a serverapplication. The problem is in the following lines:
>
>application = service.Application("TwistedServerApp")
>internet.TCPServer(8800, pb.ServerFactory...)
>
>I don't want to start this with a predetermined port. More like:
>
>twistd -y TwistedServerApp.tac 8800
>
>Is this somehow possible? sys.argv seems impossible to use.
>
>-Stephan

.tac files don't take configuration.  .tac files _are_ configuration.  There are no provisions for "passing arguments" to them.

Jp



From Stephan.Popp at iisb.fraunhofer.de  Wed Jun 29 07:03:37 2005
From: Stephan.Popp at iisb.fraunhofer.de (Stephan Popp)
Date: Wed, 29 Jun 2005 15:03:37 +0200
Subject: [Twisted-Python] Passing arguments to application
In-Reply-To: <20050629123017.26278.917704695.divmod.quotient.2526@ohm>
References: <20050629123017.26278.917704695.divmod.quotient.2526@ohm>
Message-ID: <200506291503.37706.Stephan.Popp@iisb.fraunhofer.de>

> .tac files don't take configuration.  .tac files _are_ configuration. 
> There are no provisions for "passing arguments" to them.
>
> Jp

Oh, then I misunderstood something here.
Thanks for the help.

-Stephan





From foom at fuhm.net  Wed Jun 29 18:56:37 2005
From: foom at fuhm.net (James Y Knight)
Date: Wed, 29 Jun 2005 20:56:37 -0400
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: <2841A347-724B-403A-86AE-EC258B0C94FF@fuhm.net>

Bug summary
______________________
Since 2005-06-22 16:16:07.550000:
Bugs opened: 5   Bugs closed: 5   Total open bugs: 396 (+0)
   Urgent: 9 (+0)
   Bug: 168 (+1)
   Feature: 143 (-1)
   Wish: 76 (+0)

New / Reopened Bugs
______________________
                     ==== Urgent ====
Error in DelayedCall.__str__  (2 days ago)
CLOSED http://twistedmatrix.com/bugs/issue1094 opened by bruce

                     ==== Bug ====
[FTP] FTPClient does not handle multi-line responses properly  (5  
days ago)
        http://twistedmatrix.com/bugs/issue1093 opened by orbitz

                     ==== Feature ====
Adding support for rotation on a fixed numlber of logs  (yesterday)
        http://twistedmatrix.com/bugs/issue1095 opened by lstep

[DOCUMENTATION, WIN32] Creating standalone twisted win32 executables  
using py2exe  (6 days ago)
        http://twistedmatrix.com/bugs/issue1092 opened by vertigo

                     ==== Wish ====
Tab in twisted/python/failure.py  (6 days ago)
CLOSED http://twistedmatrix.com/bugs/issue1091 opened by bruce

Bugs Closed
______________________
                     ==== Urgent ====
Error in DelayedCall.__str__  (2 days ago)
        http://twistedmatrix.com/bugs/issue1094 opened by bruce,  
closed by exarkun

                     ==== Feature ====
[CHAT] update words to use newcred  (21 months ago)
        http://twistedmatrix.com/bugs/issue270 opened by acapnotic,  
closed by exarkun

[WORDS] Remove Words' use of deprecated t.web.widgets  (1 month ago)
        http://twistedmatrix.com/bugs/issue1033 opened by exarkun,  
closed by exarkun

[WORDS] Update words to new PB API  (1 month ago)
        http://twistedmatrix.com/bugs/issue1032 opened by exarkun,  
closed by exarkun

                     ==== Wish ====
Tab in twisted/python/failure.py  (6 days ago)
        http://twistedmatrix.com/bugs/issue1091 opened by bruce,  
closed by exarkun




From july.lzu at gmail.com  Thu Jun 30 19:31:01 2005
From: july.lzu at gmail.com (july july)
Date: Fri, 1 Jul 2005 09:31:01 +0800
Subject: [Twisted-Python] Passing arguments to application
In-Reply-To: <200506291503.37706.Stephan.Popp@iisb.fraunhofer.de>
References: <20050629123017.26278.917704695.divmod.quotient.2526@ohm>
	<200506291503.37706.Stephan.Popp@iisb.fraunhofer.de>
Message-ID: <89cf12820506301831737ab604@mail.gmail.com>

On 6/29/05, Stephan Popp <Stephan.Popp at iisb.fraunhofer.de> wrote:
> > .tac files don't take configuration.  .tac files _are_ configuration.
> > There are no provisions for "passing arguments" to them.
> >
> > Jp
> 
> Oh, then I misunderstood something here.
> Thanks for the help.
> 
> -Stephan
> 
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
en I think so



