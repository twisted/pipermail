<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] PB SturdyRef issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20PB%20SturdyRef%20issue&In-Reply-To=42BB331B.1050307%40cubik.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010830.html">
   <LINK REL="Next"  HREF="010832.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] PB SturdyRef issue</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20PB%20SturdyRef%20issue&In-Reply-To=42BB331B.1050307%40cubik.org"
       TITLE="[Twisted-Python] PB SturdyRef issue">andrew-twisted at puzzling.org
       </A><BR>
    <I>Thu Jun 23 21:58:10 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010830.html">[Twisted-Python] PB SturdyRef issue
</A></li>
        <LI>Next message: <A HREF="010832.html">[Twisted-Python] Documentation: producing standalone win32 exes for	twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10837">[ date ]</a>
              <a href="thread.html#10837">[ thread ]</a>
              <a href="subject.html#10837">[ subject ]</a>
              <a href="author.html#10837">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Jun 23, 2005 at 04:09:31PM -0600, Bruce Mitchener wrote:
&gt;<i> I'm using something similar in style to a pb.SturdyRef and have run 
</I>&gt;<i> across a problem with it:
</I>&gt;<i> 
</I>&gt;<i> While it handles pb.DeadReferenceError, it doesn't handle the 
</I>&gt;<i> pb.PBConnectionLost that can come back as an errback from the callRemote.
</I>&gt;<i> 
</I>&gt;<i> Is there some way that I can juggle deferreds so that the caller can get 
</I>&gt;<i> the response from the server after I reconnect and re-try like what 
</I>&gt;<i> happens in the case of pb.DeadReferenceError?
</I>&gt;<i> 
</I>&gt;<i> It doesn't seem like I can just attach an errback to the deferred and in 
</I>&gt;<i> that errback, do a failure.trap(pb.PBConnectionLost) and then do 
</I>&gt;<i> something to bind a new deferred into the callback chain ...
</I>&gt;<i> 
</I>&gt;<i> Is there something that can happen magically by returning a new deferred 
</I>&gt;<i> from the errback that successfully traps the PBConnectionLost?
</I>
If you return a Deferred from a callback/errback, the outer Deferred will
wait for the inner Deferred to fire before continuing with its callback
chain.  It sounds like this is the magic you are looking for.

So here's one way to take advantage of that:

def sturdyRemoteCall(foo, *args, **kwargs):

    d = ...  # whatever you do to make the remote call, handle
             # DeadReferenceErrors, etc.

    def retryOnConnectionLost(failure):
        failure.trap(pb.PBConnectionLost)
        return sturdyRemoteCall(foo, *args, **kwargs)

    d.addErrback(retryOnConnectionLost)
    return d

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010830.html">[Twisted-Python] PB SturdyRef issue
</A></li>
	<LI>Next message: <A HREF="010832.html">[Twisted-Python] Documentation: producing standalone win32 exes for	twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10837">[ date ]</a>
              <a href="thread.html#10837">[ thread ]</a>
              <a href="subject.html#10837">[ subject ]</a>
              <a href="author.html#10837">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
