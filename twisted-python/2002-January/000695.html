<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] IRC protocol rewrite?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20IRC%20protocol%20rewrite%3F&In-Reply-To=1010011080.4106.4.camel%40troglodyte">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000693.html">
   <LINK REL="Next"  HREF="000696.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] IRC protocol rewrite?</H1>
    <B>Ivo van der Wijk</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20IRC%20protocol%20rewrite%3F&In-Reply-To=1010011080.4106.4.camel%40troglodyte"
       TITLE="[Twisted-Python] IRC protocol rewrite?">ivo at amaze.nl
       </A><BR>
    <I>Wed Jan  2 18:18:34 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="000693.html">[Twisted-Python] IRC protocol rewrite?
</A></li>
        <LI>Next message: <A HREF="000696.html">[Twisted-Python] IRC protocol rewrite?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#695">[ date ]</a>
              <a href="thread.html#695">[ thread ]</a>
              <a href="subject.html#695">[ subject ]</a>
              <a href="author.html#695">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jan 02, 2002 at 02:38:00PM -0800, Kevin Turner wrote:
&gt;<i> On Wed, 2002-01-02 at 09:46, Ivo van der Wijk wrote:
</I>&gt;<i> &gt; However, I noticed some bugs and (imho) design failures in the current
</I>&gt;<i> &gt; implementation, which makes the code not very usefull for any other 
</I>&gt;<i> &gt; use than what it's currently used for (twisted irc client + server?)
</I>&gt;<i> 
</I>&gt;<i> (And Tendril.  Don't forget Tendril, in twisted.words.tendril.)
</I>&gt;<i> I'm interested in hearing what makes it &quot;not very useful&quot; though.  I
</I>&gt;<i> didn't really get a sense of that from your message.
</I>&gt;<i> 
</I>
The current implementation is rather specific. For example, it assumes
only #-like channels exist, it takes actions/decisions the client builder
would rather like to implement (i.e. irc_ERR_NICKNAMEINUSE will generate
a new nickname by appending a _ - who says I want this in my client?),
ctcp_PING immediately sends a ping reply - this won't work with my
ignore list, etc.

I'm not saying this is wrong behaviour, it just does not belong at this
level in the protocol. I just want a basic abstraction of the server
connecting/disconnecting, server messages receiving (dispatching) and
sending. Anything else should be implemented in a derived/separate class.

&gt;<i> &gt; For example, channels are hardcoded as starting with '#', i.e.
</I>&gt;<i> &gt; IRCClient.join prepends a '#' to the channelname. Hoewever, most servers
</I>&gt;<i> &gt; support alernative style channels such as &amp;channel (local channels),
</I>&gt;<i> &gt; +channel (modeless channels), and perhaps more.
</I>&gt;<i> 
</I>&gt;<i> Valid point.  Of course, nobody actually uses those in real life
</I>&gt;<i> anymore, but it'd be fine to support it in the interest of completeness.
</I>&gt;<i> 
</I>
IRCops tend to visit channels like &amp;ERRORS and &amp;NOTICES (at least ircnet
supports this) to view server messages. Besides, you simply don't adhere to
the 'protocol' (eventhough it's poorly documented). And we have MIRC for
that, right? :)

&gt;<i> &gt; Furthermore, IMHO, the IRCClient class implements too many protocols
</I>&gt;<i> &gt; in one class. IRC, CTCP and DCC are distinct protocols, and each belong
</I>&gt;<i> &gt; in their own class.
</I>&gt;<i> 
</I>&gt;<i> There's some sense to this too.  As a Protocol class, IRCClient is
</I>&gt;<i> overfeatured (as a &quot;client&quot;, maybe it's okay).  I'm not quite sure how
</I>&gt;<i> to split off the CTCP stuff though, as intertwined as the CTCP messages
</I>&gt;<i> are with IRC.  Would you define IRCClient not only as a Protocol, but as
</I>&gt;<i> a Transport for CTCP?  Eaugh...  A somewhat more mundane option would be
</I>&gt;<i> to just put all the ctcp* methods in a mixin class.  That might make the
</I>&gt;<i> organization a little tidier, but it wouldn't change the interface at
</I>&gt;<i> all, so I'm not sure if that would satisfy your concerns or not.
</I>&gt;<i> 
</I>
The name IRCClient is a bit misleading, but the basic IRC protocol *is*
the transport for CTCP! CTCP is a separate protocol encoded in ^A's in
PRIVMSG/NOTICE. Also, CTCP is way less documented than the irc protocol,
and clients are (somewhat) free to make their own CTCP extension (i.e.
you coud send whiteboard drawing commands over ctcp or communicate 
gameplay over ctcp over irc. Some clients (zircon?) actually do this)

&gt;<i> As for DCC, it's in seperate protocol classes already.
</I>&gt;<i> 
</I>
There's is quite some DCC support in the IRCClient class that I have here
(twisted 0.12.3), i.e. ctcpQuery_DCC which initiates DCC, maintains a list
of sessions, etc

&gt;<i> &gt; Lastly, the current parsemsg routine can't handle ipv6 addresses in certain 
</I>&gt;<i> &gt; replies, i.e. a 311 (whois) reply like:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; :irc.xs4all.nl 311 VladDrac [p] -patrick 3ffe:2500:900:2000:1337:1337:1337:1337 *:foo
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; will be parsed incorrectly. I may provide a patch for this later.
</I>&gt;<i> 
</I>&gt;<i> Eh?  It's not immediately obvious to me what will break.  But patches
</I>&gt;<i> are always fine.  =)
</I>&gt;<i>
</I>
&gt;&gt;&gt;<i> parsemsg(&quot;:irc.xs4all.nl 311 VladDrac [p] -patrick 3ffe:2500:900:2000:1337:1337:1337:1337 *:foo&quot;)
</I>('irc.xs4all.nl', '311', ['VladDrac', '[p]', '-patrick', '3ffe', '2500:900:2000:1337:1337:1337:1337 *:foo'])

It's the assumption that a ':' will start the remainder of the argument
list, which is not true if one of the arguments is a ipv6 address.

&gt;<i> &gt; Is replacing the current IRC protocol with a (non-api-compatible) new
</I>&gt;<i> &gt; protocol discussable? If so, I'll make some suggestions on how I would
</I>&gt;<i> &gt; implement the protocol.
</I>&gt;<i> 
</I>&gt;<i> IMO, speaking as the guy who's probably spent the most time with it,
</I>&gt;<i> it's certainly discussable.  Unless there was some message I didn't read
</I>&gt;<i> from the BDFL about an API freeze. ;)  
</I>&gt;<i> 
</I>
Ok :)

	Ivo

-- 
Drs. I.R. van der Wijk                              -=-
Brouwersgracht 132                      Amaze Internet Services V.O.F.
1013 HA Amsterdam, NL                               -=-
Tel: +31-20-4688336                       Linux/Web/Zope/SQL/MMBase
Fax: +31-20-4688337                           Network Solutions
Web:     <A HREF="http://www.amaze.nl/">http://www.amaze.nl/</A>                    Consultancy
Email:   <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ivo at amaze.nl</A>                               -=-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000693.html">[Twisted-Python] IRC protocol rewrite?
</A></li>
	<LI>Next message: <A HREF="000696.html">[Twisted-Python] IRC protocol rewrite?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#695">[ date ]</a>
              <a href="thread.html#695">[ thread ]</a>
              <a href="subject.html#695">[ subject ]</a>
              <a href="author.html#695">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
