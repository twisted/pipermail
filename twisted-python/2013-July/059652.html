<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Python%203%3A%20bytes%20vs.%20str%20in%0A%09twisted.python.filepath&In-Reply-To=%3CCABjbJ3y0gHUD3Qz8FCQHHK7_eRhWnd6rfxFHQn8OvqYDH2y_ZA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059651.html">
   <LINK REL="Next"  HREF="059653.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath</H1>
    <B>Harry Bock</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Python%203%3A%20bytes%20vs.%20str%20in%0A%09twisted.python.filepath&In-Reply-To=%3CCABjbJ3y0gHUD3Qz8FCQHHK7_eRhWnd6rfxFHQn8OvqYDH2y_ZA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath">bock.harryw at gmail.com
       </A><BR>
    <I>Sun Jul 14 08:18:20 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059651.html">[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
</A></li>
        <LI>Next message (by thread): <A HREF="059653.html">[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59652">[ date ]</a>
              <a href="thread.html#59652">[ thread ]</a>
              <a href="subject.html#59652">[ subject ]</a>
              <a href="author.html#59652">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Jul 14, 2013 at 8:16 AM, Itamar Turner-Trauring &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>
&gt;<i> wrote:
</I>
&gt;<i> On 07/13/2013 10:00 PM, Harry Bock wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My name is Harry Bock.  I'm interested in helping out porting Twisted to
</I>&gt;&gt;<i> Python 3, and I've popped in IRC a few times to introduce myself and ask a
</I>&gt;&gt;<i> few questions. A few developers agreed that working on trial dependencies
</I>&gt;&gt;<i> would be a big help.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In doing some porting work on trial, I stumbled upon a previous porting
</I>&gt;&gt;<i> effort (possibly by Itamar?) for twisted.python.filepath and related
</I>&gt;&gt;<i> modules.  It seemed like the porting effort included forcing all pathname
</I>&gt;&gt;<i> inputs to be byte strings instead of native strings.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You imply that this was a change, somehow, but it wasn't. The API was
</I>&gt;<i> *always* bytes and it continues to be bytes on Python 3.
</I>&gt;<i>
</I>
Ah, I understand now.  Since the native string type was used in Python 2,
it follows that in Python 3 the API should be bytes.


&gt;<i>
</I>&gt;<i> It's a common Python 3 porting mistake to change everything from bytes to
</I>&gt;<i> unicode just because. E.g. Python standard library does this in many places
</I>&gt;<i> for no good reason, resulting in bugs that are still being fixed (
</I>&gt;<i> <A HREF="http://bugs.python.org/**issue12411">http://bugs.python.org/**issue12411</A> &lt;<A HREF="http://bugs.python.org/issue12411">http://bugs.python.org/issue12411</A>&gt;)
</I>&gt;<i> or APIs that are less useful (zipfile docs explicitly state that there is
</I>&gt;<i> no standard encoding in zip files, but Python 3 zipfile module only
</I>&gt;<i> supports one specific encoding because they switched to Unicode and didn't
</I>&gt;<i> bother reading the module's own docs). Our goal in porting was backwards
</I>&gt;<i> compatibility with Python 2 code, so porters don't have to change
</I>&gt;<i> everything, and correctness. And, in this particular case, to get something
</I>&gt;<i> working in the minimal amount of time - *adding* Unicode support is useful
</I>&gt;<i> and should be done.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  After some investigation, I believe this is the wrong approach, but I
</I>&gt;&gt;<i> wanted to start a discussion here first.  Some thoughts:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> (a) As of Python 3.3, use of the ANSI API in Windows is deprecated[1], so
</I>&gt;&gt;<i> many functions in os and os.path raise DeprecationWarning when given byte
</I>&gt;&gt;<i> strings as input.  Although win32 is not an initial target of the porting
</I>&gt;&gt;<i> effort, we'll have to support it eventually and the API should be supported
</I>&gt;&gt;<i> before then.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> (b) Misunderstandings at the application level about the underlying
</I>&gt;&gt;<i> filesystem's path encoding is not the problem of the Twisted API.  Correct
</I>&gt;&gt;<i> me if I'm wrong, but that's the responsibility of the system administrator
</I>&gt;&gt;<i> or individual user (at least on UNIX) to set the LANG environment variable,
</I>&gt;&gt;<i> or for the application to call setlocale(3) to explicitly override it.
</I>&gt;&gt;<i>
</I>&gt;<i> Given operating systems that don't really know about encodings on the
</I>&gt;<i> filesystem level, forcing everything to be unicode doesn't make sense. I'm
</I>&gt;<i> pretty sure you can end up with files in multiple different Unicode
</I>&gt;<i> encodings on same filesystem on Linux, for example.
</I>

This is very true and I didn't consider it in my initial investigation.
While I think it would be uncommon to have files in multiple encodings on
the same filesystem, it certainly would not be rare - to Tristan's point,
copying names from filesystem to filesystem could easily result in multiple
encodings.  The operating system may not need to understand the encodings,
but applications do to display them correctly,  Which leads to your last
point...

&gt;<i>
</I>&gt;<i>  Thus, my vote is that on Python 2.x, Twisted should accept either the
</I>&gt;&gt;<i> native str or unicode types for path names, and on Python 3.x, only accept
</I>&gt;&gt;<i> the str type to prevent deprecation issues with system calls.  I have a
</I>&gt;&gt;<i> patch set that will make this happen including unittest modifications; if
</I>&gt;&gt;<i> there's a consensus I'm happy to open a ticket and submit the patches.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The ideal situation would be to support bytes and Unicode on Python 2
</I>&gt;<i> *and* Python 3, for maximum compatibility. Even if deprecated on Windows,
</I>&gt;<i> filesystem operations on Python 3 still do accept bytes (and they're not
</I>&gt;<i> deprecated elsewhere). Given existing code that already takes bytes,
</I>&gt;<i> switching to only doing Unicode on Python 3 would not be backwards
</I>&gt;<i> compatible, so we can't really do that without a bunch of deprecation
</I>&gt;<i> warnings and a few releases. Instead we should just do what Python does: if
</I>&gt;<i> you start with bytes path you always get back bytes, if you start with
</I>&gt;<i> Unicode path you always get back Unicode.
</I>&gt;<i>
</I>&gt;<i>
</I>Yes, you're right, that's probably the best solution.  It would not be
terribly hard to do so - then application developers can choose whether to
defer to the local user's interpretation of the setting, or explicitly use
byte paths.  Thanks so much for your input!

Is this something I can open a ticket for?



&gt;<i>
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.</A>**com &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-**bin/mailman/listinfo/twisted-**python&lt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-**bin/mailman/listinfo/twisted-**python&lt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>&gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130714/a1b87813/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059651.html">[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
</A></li>
	<LI>Next message (by thread): <A HREF="059653.html">[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59652">[ date ]</a>
              <a href="thread.html#59652">[ thread ]</a>
              <a href="subject.html#59652">[ subject ]</a>
              <a href="author.html#59652">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
