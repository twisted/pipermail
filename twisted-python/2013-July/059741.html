<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python]  TestInternet2.testPickledTimer Failed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%20TestInternet2.testPickledTimer%20Failed&In-Reply-To=%3CCAK_130QFSBeg54ovf6aWG8gJjd2hdjV5s15iDXi%3D37aWQH%2Bg1Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python]  TestInternet2.testPickledTimer Failed</H1>
    <B>zhang kai</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%20TestInternet2.testPickledTimer%20Failed&In-Reply-To=%3CCAK_130QFSBeg54ovf6aWG8gJjd2hdjV5s15iDXi%3D37aWQH%2Bg1Q%40mail.gmail.com%3E"
       TITLE="[Twisted-Python]  TestInternet2.testPickledTimer Failed">kylerzhang11 at gmail.com
       </A><BR>
    <I>Wed Jul 31 23:46:17 MDT 2013</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59741">[ date ]</a>
              <a href="thread.html#59741">[ thread ]</a>
              <a href="subject.html#59741">[ subject ]</a>
              <a href="author.html#59741">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm a Google Summer of Code intern working on &quot;Deferred Cancellation&quot;
project. I'm recently working on adding cancellation support to
twisted.internet.task.LoopingCall.

However, after I added the canceller to LoopingCall.deferred,
the twisted.test.test_application.TestInternet2.testPickledTimer failed due
to a PicklingError.

My branch is loopingcall-deferred-cancellation-6656. Here is the diff of my
code: <A HREF="http://twistedmatrix.com/~diffresource.twistd/6656">http://twistedmatrix.com/~diffresource.twistd/6656</A>

Here is the error message:

===============================================================================
[ERROR]
Traceback (most recent call last):
  File
&quot;/home/kai/Projects/GSoC/DeferredCancellation/Twisted/branches/loopingcall-deferred-cancellation-6656/twisted/test/test_application.py&quot;,
line 487, in testPickledTimer
    s = pickle.dumps(t0)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 1374, in dumps
    Pickler(file, protocol).dump(obj)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 224, in dump
    self.save(obj)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 725, in save_inst
    save(stuff)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 649, in save_dict
    self._batch_setitems(obj.iteritems())
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 663, in _batch_setitems
    save(v)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 725, in save_inst
    save(stuff)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 649, in save_dict
    self._batch_setitems(obj.iteritems())
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 663, in _batch_setitems
    save(v)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 331, in save
    self.save_reduce(obj=obj, *rv)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 401, in save_reduce
    save(args)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 562, in save_tuple
    save(element)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 331, in save
    self.save_reduce(obj=obj, *rv)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 419, in save_reduce
    save(state)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 649, in save_dict
    self._batch_setitems(obj.iteritems())
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 663, in _batch_setitems
    save(v)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 331, in save
    self.save_reduce(obj=obj, *rv)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 419, in save_reduce
    save(state)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 649, in save_dict
    self._batch_setitems(obj.iteritems())
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 663, in _batch_setitems
    save(v)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 331, in save
    self.save_reduce(obj=obj, *rv)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 419, in save_reduce
    save(state)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 649, in save_dict
    self._batch_setitems(obj.iteritems())
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 663, in _batch_setitems
    save(v)
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 286, in save
    f(self, obj) # Call unbound method with explicit self
  File &quot;/usr/lib/python2.7/pickle.py&quot;, line 748, in save_global
    (obj, module, name))
pickle.PicklingError: Can't pickle &lt;function &lt;lambda&gt; at 0x8f1fb8c&gt;: it's
not found as twisted.internet.posixbase.&lt;lambda&gt;

twisted.test.test_application.TestInternet2.testPickledTimer
===============================================================================

I thought the reason was the circular references. However I searched about
it and found that pickle could handle the circular reference cases. But the
only significant change is that after I added the canceller, there is a
circular reference between LoopingCall and LoopingCall.deferred. So I don't
know what's the problem. How can I fix this?

Thanks,
-Kai
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130801/59955434/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59741">[ date ]</a>
              <a href="thread.html#59741">[ thread ]</a>
              <a href="subject.html#59741">[ subject ]</a>
              <a href="author.html#59741">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
