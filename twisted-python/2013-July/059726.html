<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] defer.gatherResults &amp; Deferreds chaining
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20defer.gatherResults%20%26%20Deferreds%20chaining&In-Reply-To=%3CCAN9%2BjDbNvJi9X2bsUswPWKf7jrzUT_b9kKo4YD6K-k-g4YuXEg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] defer.gatherResults &amp; Deferreds chaining</H1>
    <B>Jorge Gonzalez</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20defer.gatherResults%20%26%20Deferreds%20chaining&In-Reply-To=%3CCAN9%2BjDbNvJi9X2bsUswPWKf7jrzUT_b9kKo4YD6K-k-g4YuXEg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] defer.gatherResults &amp; Deferreds chaining">gjorge at google.com
       </A><BR>
    <I>Mon Jul 29 14:29:18 MDT 2013</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59726">[ date ]</a>
              <a href="thread.html#59726">[ thread ]</a>
              <a href="subject.html#59726">[ subject ]</a>
              <a href="author.html#59726">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to understand why a chain of Deferreds I'm dealing with hangs
and why return values from some callbacks are not always making it to other
callbacks down the chain of Deferreds.

Is it possible that there could be a race condition between Deferred
chaining and Deferred result
gathering&lt;<A HREF="http://twistedmatrix.com/documents/current/core/howto/defer.html">http://twistedmatrix.com/documents/current/core/howto/defer.html</A>&gt;
?
I.e., Chaining Deferreds&lt;<A HREF="http://twistedmatrix.com/documents/current/core/howto/defer.html#auto13">http://twistedmatrix.com/documents/current/core/howto/defer.html#auto13</A>&gt;
says
that &quot;*If you need one Deferred to wait on another, all you need to do is
return a Deferred from a method added to addCallbacks. Specifically, if you
return Deferred B from a method added to Deferred A using A.addCallbacks,
Deferred A's processing chain will stop until Deferred B's .callback()
method is called; at that point, the next callback in A will be passed the
result of the last callback in Deferred B's processing chain at the time*.&quot;

Now at the same time,
DeferredList&lt;<A HREF="http://twistedmatrix.com/documents/current/core/howto/defer.html#auto8">http://twistedmatrix.com/documents/current/core/howto/defer.html#auto8</A>&gt;
 (on top of which gatherResults is built) warns that &quot;*If you want to apply
callbacks to the individual Deferreds that go into the DeferredList, you
should be careful about when those callbacks are added. The act of adding a
Deferred to a DeferredList inserts a callback into that Deferred ... The
important thing to remember is that it is this callback which records the
value that goes into the result list handed to the DeferredList's callback.*
*Therefore, if you add a callback to the Deferred after adding the Deferred
to the DeferredList, the value returned by that callback will not be given
to the DeferredList's callback. To avoid confusion, we recommend not adding
callbacks to a Deferred once it has been used in a DeferredList*&quot;

Given these two explanations, say I have something like this:
---------------------------------------------------------------------------
def slowFuncReturningDeferred_A():
  ...

def slowFuncReturningDeferred_B():
  ...

d = defer.Deferred()
d.addCallback(labmda _: slowFuncReturningDeferred_A())
d.addCallback(labmda _: slowFuncReturningDeferred_B())

defer.gatherResults([d])
---------------------------------------------------------------------------

Wouldn't it be possible that defer.gatherResults inserts its callback
into d before
say slowFuncReturningDeferred_B gets to run and return its own Deferred
(and therefore chain it to what gatherRestults is ultimately waiting for?).
If so, wouldn't the results returned by slowFuncReturningDeferred_B never
make it to the results gathered by defer.gatherResults?

Thanks,
Jorge
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130729/63d8b800/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59726">[ date ]</a>
              <a href="thread.html#59726">[ thread ]</a>
              <a href="subject.html#59726">[ subject ]</a>
              <a href="author.html#59726">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
