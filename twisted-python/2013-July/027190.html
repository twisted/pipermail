<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Python%203%3A%20bytes%20vs.%20str%20in%0A%09twisted.python.filepath&In-Reply-To=%3C51E2968C.9040001%40itamarst.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027189.html">
   <LINK REL="Next"  HREF="027191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath</H1>
    <B>Itamar Turner-Trauring</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Python%203%3A%20bytes%20vs.%20str%20in%0A%09twisted.python.filepath&In-Reply-To=%3C51E2968C.9040001%40itamarst.org%3E"
       TITLE="[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath">itamar at itamarst.org
       </A><BR>
    <I>Sun Jul 14 06:16:12 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027189.html">[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
</A></li>
        <LI>Next message: <A HREF="027191.html">[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27190">[ date ]</a>
              <a href="thread.html#27190">[ thread ]</a>
              <a href="subject.html#27190">[ subject ]</a>
              <a href="author.html#27190">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/13/2013 10:00 PM, Harry Bock wrote:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> My name is Harry Bock.  I'm interested in helping out porting Twisted 
</I>&gt;<i> to Python 3, and I've popped in IRC a few times to introduce myself 
</I>&gt;<i> and ask a few questions. A few developers agreed that working on trial 
</I>&gt;<i> dependencies would be a big help.
</I>&gt;<i>
</I>&gt;<i> In doing some porting work on trial, I stumbled upon a previous 
</I>&gt;<i> porting effort (possibly by Itamar?) for twisted.python.filepath and 
</I>&gt;<i> related modules.  It seemed like the porting effort included forcing 
</I>&gt;<i> all pathname inputs to be byte strings instead of native strings.
</I>
You imply that this was a change, somehow, but it wasn't. The API was 
*always* bytes and it continues to be bytes on Python 3.

It's a common Python 3 porting mistake to change everything from bytes 
to unicode just because. E.g. Python standard library does this in many 
places for no good reason, resulting in bugs that are still being fixed 
(<A HREF="http://bugs.python.org/issue12411">http://bugs.python.org/issue12411</A>) or APIs that are less useful 
(zipfile docs explicitly state that there is no standard encoding in zip 
files, but Python 3 zipfile module only supports one specific encoding 
because they switched to Unicode and didn't bother reading the module's 
own docs). Our goal in porting was backwards compatibility with Python 2 
code, so porters don't have to change everything, and correctness. And, 
in this particular case, to get something working in the minimal amount 
of time - *adding* Unicode support is useful and should be done.

&gt;<i> After some investigation, I believe this is the wrong approach, but I 
</I>&gt;<i> wanted to start a discussion here first.  Some thoughts:
</I>&gt;<i>
</I>&gt;<i> (a) As of Python 3.3, use of the ANSI API in Windows is deprecated[1], 
</I>&gt;<i> so many functions in os and os.path raise DeprecationWarning when 
</I>&gt;<i> given byte strings as input.  Although win32 is not an initial target 
</I>&gt;<i> of the porting effort, we'll have to support it eventually and the API 
</I>&gt;<i> should be supported before then.
</I>&gt;<i>
</I>&gt;<i> (b) Misunderstandings at the application level about the underlying 
</I>&gt;<i> filesystem's path encoding is not the problem of the Twisted API.  
</I>&gt;<i> Correct me if I'm wrong, but that's the responsibility of the system 
</I>&gt;<i> administrator or individual user (at least on UNIX) to set the LANG 
</I>&gt;<i> environment variable, or for the application to call setlocale(3) to 
</I>&gt;<i> explicitly override it.
</I>Given operating systems that don't really know about encodings on the 
filesystem level, forcing everything to be unicode doesn't make sense. 
I'm pretty sure you can end up with files in multiple different Unicode 
encodings on same filesystem on Linux, for example.

&gt;<i> (c) If we do not allow unicode strings, we will be forcing the 
</I>&gt;<i> application developer to decide how to encode paths when using the 
</I>&gt;<i> FilePath API.  Per (b) above, the user will have to call 
</I>&gt;<i> sys.getfilesystemencoding()[2] to divine what encoding to use before 
</I>&gt;<i> using the API at all, which to me is terribly annoying and would just 
</I>&gt;<i> add str.encode calls everywhere.
</I>&gt;<i>
</I>It is indeed a problem that we only support bytes in FilePath on Python 
3. As I mentioned above, Unicode support is missing only due to lack of 
time in the initial port.

&gt;<i> Thus, my vote is that on Python 2.x, Twisted should accept either the 
</I>&gt;<i> native str or unicode types for path names, and on Python 3.x, only 
</I>&gt;<i> accept the str type to prevent deprecation issues with system calls.  
</I>&gt;<i> I have a patch set that will make this happen including unittest 
</I>&gt;<i> modifications; if there's a consensus I'm happy to open a ticket and 
</I>&gt;<i> submit the patches.
</I>
The ideal situation would be to support bytes and Unicode on Python 2 
*and* Python 3, for maximum compatibility. Even if deprecated on 
Windows, filesystem operations on Python 3 still do accept bytes (and 
they're not deprecated elsewhere). Given existing code that already 
takes bytes, switching to only doing Unicode on Python 3 would not be 
backwards compatible, so we can't really do that without a bunch of 
deprecation warnings and a few releases. Instead we should just do what 
Python does: if you start with bytes path you always get back bytes, if 
you start with Unicode path you always get back Unicode.


</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027189.html">[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
</A></li>
	<LI>Next message: <A HREF="027191.html">[Twisted-Python] Python 3: bytes vs. str in	twisted.python.filepath
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27190">[ date ]</a>
              <a href="thread.html#27190">[ thread ]</a>
              <a href="subject.html#27190">[ subject ]</a>
              <a href="author.html#27190">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
