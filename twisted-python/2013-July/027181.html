<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] AMQP listening and user-facing daemon
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMQP%20listening%20and%20user-facing%20daemon&In-Reply-To=%3CC0073FB6-2DFA-427A-AFE1-83BD8945BAA5%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027180.html">
   <LINK REL="Next"  HREF="027174.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] AMQP listening and user-facing daemon</H1>
    <B>Lucas Taylor</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMQP%20listening%20and%20user-facing%20daemon&In-Reply-To=%3CC0073FB6-2DFA-427A-AFE1-83BD8945BAA5%40gmail.com%3E"
       TITLE="[Twisted-Python] AMQP listening and user-facing daemon">ltaylor.volks at gmail.com
       </A><BR>
    <I>Wed Jul 10 14:42:52 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027180.html">[Twisted-Python] AMQP listening and user-facing daemon
</A></li>
        <LI>Next message: <A HREF="027174.html">[Twisted-Python] Twisted web,	giant-file POST forwarding and early bail-out.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27181">[ date ]</a>
              <a href="thread.html#27181">[ thread ]</a>
              <a href="subject.html#27181">[ subject ]</a>
              <a href="author.html#27181">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jul 8, 2013, at 3:31 PM, Justin Chiu wrote:

&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> *I posted this to python-list and tutor-list and received no replies. Any advice would be much appreciated. Thank you.*
</I>&gt;<i> 
</I>&gt;<i> What is the best approach to writing a concurrent daemon that can execute callbacks for different types of events (AMQP messages, parsed output of a subprocess, HTTP requests)?
</I>&gt;<i> 
</I>&gt;<i> I am considering [twisted][1], the built-in [threading][2] module, and [greenlet][3]. I must admit that I am very unfamiliar with concurrent programming and Python programming in general (formerly a data analysis driven procedural programmer). Any resources on threaded/concurrent programming (specifically daemons...not just multi-threading a single task) would be much appreciated.
</I>&gt;<i> 
</I>
From the details below, it would appear that Twisted would be a great fit for this application.

The asynchronous nature of the framework may cause some head scratching if you're in a procedural mindset, but on the other hand, attempting to facilitate all of the different service interactions you are proposing in a coherent manner can be challenging regardless. One of Twisted's strengths is that it provides that coherence...once you grok the paradigm, you'll be able to look at this type of application and quickly come up with a reasonable sketch of how all of the pieces will fit together, with confidence. 

I highly recommend Dave Peticolas' tutorial:  <A HREF="http://krondo.com/?page_id=1327">http://krondo.com/?page_id=1327</A>
You'll get a great introduction to asynchronous programming and dive into Twisted.

And of course the Twisted documentation, esp. the Getting Started section of <A HREF="http://twistedmatrix.com/documents/current/core/howto/.">http://twistedmatrix.com/documents/current/core/howto/.</A>

Finally, I'd stress that you don't need to know *all* of Twisted to benefit from using it. There is a great deal of functionality in the framework and I'm discovering new uses for it all of the time.


&gt;<i> Details:
</I>&gt;<i> 
</I>&gt;<i> 1) Listens into AMQP messaging queues and executes callbacks when messages arrive.
</I>&gt;<i> Example: Immediately after startup, the daemon continuously listens to the [Openstack Notifications messaging queue][4]. When a virtual machine is launched, a notification is generated by Openstack with the hostname, IP address, etc. The daemon should read this message and write some info to a log (or POST the info to a server, or notify the user...something simple).
</I>&gt;<i> 
</I>
Others have mentioned txAMQP.  It should be fairly straightforward to consume messages from the queue and hook it up to your user interface.  There are numerous asynchronous APIs in the framework, so you'll have options for doing things just as you propose, without blocking other parts of your application.  Twisted has its own logging system and twisted.web.client.Agent can be used to POST to a web server, etc. 

&gt;<i> 2) Parse the output of a subprocess and execute callbacks based on the output.
</I>&gt;<i> Example: Every 30 seconds, a system command &quot;[qstat][5]&quot; is run to query a job resource manager (e.g. TORQUE). Similar callbacks to 1).
</I>
Twisted can help you with scheduled tasks and there is a ProcessProtocol that, combined, will do exactly what you propose.
<A HREF="http://twistedmatrix.com/documents/current/core/howto/time.html">http://twistedmatrix.com/documents/current/core/howto/time.html</A>
<A HREF="http://twistedmatrix.com/documents/current/core/howto/process.html">http://twistedmatrix.com/documents/current/core/howto/process.html</A>


&gt;<i> 3) Receive requests from a user and process them. I think this will be via WSGI HTTP.
</I>&gt;<i> Example: User submits an XML template with virtual machine templates. The daemon does some simple XML parsing and writes a job script for the job resource manager. The job is submitted to the resource manager and the daemon continually checks for the status of the job with &quot;qstat&quot; and for messages from AMQP. It should return &quot;live&quot; feedback to the user and write to a log.
</I>&gt;<i> 
</I>
Twisted has a built-in programmable web server, and a WSGI container is available. <A HREF="http://twistedmatrix.com/documents/current/web/howto/web-in-60/index.html">http://twistedmatrix.com/documents/current/web/howto/web-in-60/index.html</A> is a good starter for web programming with Twisted, as is the general web howto: <A HREF="http://twistedmatrix.com/documents/current/web/howto/using-twistedweb.html">http://twistedmatrix.com/documents/current/web/howto/using-twistedweb.html</A>

There are many ways to construct what you describe, so it's probably not appropriate to give specific recommendations other than to say what you want is absolutely feasible. It appears you've already got a good handle on what you want to achieve, which should make it easier when it comes to seeking more specific help, etc. from the mailing list once you get your feet wet.


Lucas




-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130710/6b46df54/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130710/6b46df54/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027180.html">[Twisted-Python] AMQP listening and user-facing daemon
</A></li>
	<LI>Next message: <A HREF="027174.html">[Twisted-Python] Twisted web,	giant-file POST forwarding and early bail-out.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27181">[ date ]</a>
              <a href="thread.html#27181">[ thread ]</a>
              <a href="subject.html#27181">[ subject ]</a>
              <a href="author.html#27181">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
