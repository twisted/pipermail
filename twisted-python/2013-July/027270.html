<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] transport.write performance.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20transport.write%20performance.&In-Reply-To=%3CCAE_Hg6ZCScAj_RkcZVJ3L3SKiKQ3tNL6DFG0Hzhj7RnfMJ44Yg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027274.html">
   <LINK REL="Next"  HREF="027276.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] transport.write performance.</H1>
    <B>Laurens Van Houtven</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20transport.write%20performance.&In-Reply-To=%3CCAE_Hg6ZCScAj_RkcZVJ3L3SKiKQ3tNL6DFG0Hzhj7RnfMJ44Yg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] transport.write performance.">_ at lvh.io
       </A><BR>
    <I>Tue Jul 30 05:09:33 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027274.html">[Twisted-Python] transport.write performance.
</A></li>
        <LI>Next message: <A HREF="027276.html">[Twisted-Python] transport.write performance.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27270">[ date ]</a>
              <a href="thread.html#27270">[ thread ]</a>
              <a href="subject.html#27270">[ subject ]</a>
              <a href="author.html#27270">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi zipxing,

You don't mention the interpreter. Is it CPython? What kind of results do
you get trying it on PyPy?

Also, you don't need to specify epollreactor. Recent versions of twisted
will automagically choose the appropriate backend. I fixed this and some
other cleanups and got:

----
from time import clock
from twisted.internet import protocol, reactor
from twisted.protocols import basic

class MeasuringEchoProtocol(basic.LineReceiver):
    MEASUREMENT_INTERVAL = 1000

    def lineReceived(self, data):
        self.factory.requests += 1
        if self.factory.requests % self.MEASUREMENT_INTERVAL == 0:
            print &quot;RPS: {0}&quot;.format(self.factory.requests / clock())

        self.transport.write(data)



class ServerFactory(protocol.ServerFactory):
    protocol = MeasuringEchoProtocol

    def __init__(self):
        self.requests = 0



def main():
    reactor.listenTCP(9976, ServerFactory())
    clock()
    reactor.run()

if __name__ == '__main__':
    main()
----

Keep in mind that due to setup time few requests get handled right when it
starts, so the server RPS will take some time to balance out. On my wimpy
laptop on battery power, that was around 420.274404782.

cheers
lvh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130730/92a407f0/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130730/92a407f0/attachment.html</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027274.html">[Twisted-Python] transport.write performance.
</A></li>
	<LI>Next message: <A HREF="027276.html">[Twisted-Python] transport.write performance.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27270">[ date ]</a>
              <a href="thread.html#27270">[ thread ]</a>
              <a href="subject.html#27270">[ subject ]</a>
              <a href="author.html#27270">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
