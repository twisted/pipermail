From romanmescheryakov at yandex.ru  Wed Mar  1 10:46:29 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Wed, 01 Mar 2017 20:46:29 +0300
Subject: [Twisted-Python] How to restart Twisted service in-process
In-Reply-To: <341541A6-C553-4CBA-85C5-016BEB4CBA8C@twistedmatrix.com>
References: <1754891486027057@web35j.yandex.ru>
 <0DA1D2CA-1DC6-4B85-AD85-3C8AD995633A@twistedmatrix.com>
 <CAEeXt4M+MNEx4PkFMQ-fseRZb1OhAgPbrM1ED9z=wwhphfrz_g@mail.gmail.com>
 <18715221487581109@web25h.yandex.ru>
 <D4EEEDFF-7F58-4E0A-8378-727041D146D0@twistedmatrix.com>
 <72921488298276@web9j.yandex.ru>
 <341541A6-C553-4CBA-85C5-016BEB4CBA8C@twistedmatrix.com>
Message-ID: <1388131488390389@web16o.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170301/2a9c1e6e/attachment.html>

From glyph at twistedmatrix.com  Wed Mar  1 14:09:23 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 1 Mar 2017 13:09:23 -0800
Subject: [Twisted-Python] How to restart Twisted service in-process
In-Reply-To: <1388131488390389@web16o.yandex.ru>
References: <1754891486027057@web35j.yandex.ru>
 <0DA1D2CA-1DC6-4B85-AD85-3C8AD995633A@twistedmatrix.com>
 <CAEeXt4M+MNEx4PkFMQ-fseRZb1OhAgPbrM1ED9z=wwhphfrz_g@mail.gmail.com>
 <18715221487581109@web25h.yandex.ru>
 <D4EEEDFF-7F58-4E0A-8378-727041D146D0@twistedmatrix.com>
 <72921488298276@web9j.yandex.ru>
 <341541A6-C553-4CBA-85C5-016BEB4CBA8C@twistedmatrix.com>
 <1388131488390389@web16o.yandex.ru>
Message-ID: <AD725B7E-1B01-4C8F-AA74-2398A866A726@twistedmatrix.com>

> On Mar 1, 2017, at 9:46 AM, ????? ????????? <romanmescheryakov at yandex.ru> wrote:
> 
> Then the next question is: how to run my .tac file with twist? I don't see option like '-y' in it's --help output.

We haven't implemented .tac files for `twist` yet; you can either add that feature :) or you can write a twist plugin.  (It's the same as a twistd plugin.)

-glyph



From romanmescheryakov at yandex.ru  Thu Mar  2 02:08:12 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Thu, 02 Mar 2017 12:08:12 +0300
Subject: [Twisted-Python] How to restart Twisted service in-process
In-Reply-To: <AD725B7E-1B01-4C8F-AA74-2398A866A726@twistedmatrix.com>
References: <1754891486027057@web35j.yandex.ru>
 <0DA1D2CA-1DC6-4B85-AD85-3C8AD995633A@twistedmatrix.com>
 <CAEeXt4M+MNEx4PkFMQ-fseRZb1OhAgPbrM1ED9z=wwhphfrz_g@mail.gmail.com>
 <18715221487581109@web25h.yandex.ru>
 <D4EEEDFF-7F58-4E0A-8378-727041D146D0@twistedmatrix.com>
 <72921488298276@web9j.yandex.ru>
 <341541A6-C553-4CBA-85C5-016BEB4CBA8C@twistedmatrix.com>
 <1388131488390389@web16o.yandex.ru>
 <AD725B7E-1B01-4C8F-AA74-2398A866A726@twistedmatrix.com>
Message-ID: <664081488445692@web15j.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170302/67fc9f5a/attachment.html>

From romanmescheryakov at yandex.ru  Fri Mar  3 00:57:38 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Fri, 03 Mar 2017 10:57:38 +0300
Subject: [Twisted-Python] =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
Message-ID: <1795181488527858@web23h.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170303/3350e088/attachment.html>

From team at trubrain.com  Fri Mar  3 01:04:17 2017
From: team at trubrain.com (Team at TruBrain)
Date: Fri, 03 Mar 2017 08:04:17 +0000
Subject: [Twisted-Python] =?utf-8?q?Ticket_Received_-__Minor_fixes_in_the_?=
 =?utf-8?q?=E2=80=9CCustomizing_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1795181488527858@web23h.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
Message-ID: <58b92381a122c_7a9dd67c414674c.delayed-jobs-sidekiq-1@notification.freshdesk.com>

 Dear Twisted general discussion,  We would like to acknowledge that we have received your request and a ticket has been created. A support representative will be reviewing your request and will send you a personal response.(usually within 24 hours).  To view the status of the ticket or add comments, please visit  https://trubrain.freshdesk.com/helpdesk/tickets/264  Thank you for your patience.  Sincerely, TruBrain Support Team 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170303/94accc15/attachment.html>

From team at trubrain.com  Fri Mar  3 01:04:19 2017
From: team at trubrain.com (Team at TruBrain)
Date: Fri, 03 Mar 2017 08:04:19 +0000
Subject: [Twisted-Python] TruBrain user activation
Message-ID: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>

 Hi Twisted general discussion,  A new TruBrain account has been created for you.  Click the url below to activate your account and select a password!  https://trubrain.freshdesk.com/register/rYnBXi9wuEiIlk5Hgh5  If the above URL does not work try copying and pasting it into your browser. If you continue to have problems, please feel free to contact us.  Regards, TruBrain 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170303/4c69e525/attachment.html>

From glyph at twistedmatrix.com  Fri Mar  3 02:27:31 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 3 Mar 2017 01:27:31 -0800
Subject: [Twisted-Python] TruBrain user activation
In-Reply-To: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>
References: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>
Message-ID: <FA68B5CE-057A-4A6D-A28D-C60BAA1DE062@twistedmatrix.com>

Hi all, 

I have no idea how this bot got subscribed to the list, but, I've unsubscribed and banned them.  Sorry!

-glyph

> On Mar 3, 2017, at 12:04 AM, Team at TruBrain <team at trubrain.com> wrote:
> 
> Hi Twisted general discussion,
> 
> A new TruBrain account has been created for you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170303/f15e0b6f/attachment.html>

From romanmescheryakov at yandex.ru  Fri Mar  3 02:54:47 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Fri, 03 Mar 2017 12:54:47 +0300
Subject: [Twisted-Python] TruBrain user activation
In-Reply-To: <FA68B5CE-057A-4A6D-A28D-C60BAA1DE062@twistedmatrix.com>
References: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>
 <FA68B5CE-057A-4A6D-A28D-C60BAA1DE062@twistedmatrix.com>
Message-ID: <2828981488534887@web9o.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170303/2d64e2b9/attachment.html>

From glyph at twistedmatrix.com  Fri Mar  3 03:04:04 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 3 Mar 2017 02:04:04 -0800
Subject: [Twisted-Python] TruBrain user activation
In-Reply-To: <2828981488534887@web9o.yandex.ru>
References: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>
 <FA68B5CE-057A-4A6D-A28D-C60BAA1DE062@twistedmatrix.com>
 <2828981488534887@web9o.yandex.ru>
Message-ID: <EA275697-37E8-4562-AB93-2F7EE6E910DA@twistedmatrix.com>

I don't know what TruBrain is, but it would be good if it weren't trying to spam this list and getting its messages rejected :).

-g

> On Mar 3, 2017, at 1:54 AM, ????? ????????? <romanmescheryakov at yandex.ru> wrote:
> 
> I have to admit that I clicked on the user activation link and even specified some password... It seems I wasn't supposed to do that :( Should I delete that new TruBrain account?
>  
> -- 
> Kind regards, Roman Mescheryakov
>  
>  
>  
> 03.03.2017, 12:29, "Glyph Lefkowitz" <glyph at twistedmatrix.com>:
>> Hi all, 
>>  
>> I have no idea how this bot got subscribed to the list, but, I've unsubscribed and banned them.  Sorry!
>>  
>> -glyph
>>  
>>> On Mar 3, 2017, at 12:04 AM, Team at TruBrain <team at trubrain.com <mailto:team at trubrain.com>> wrote:
>>>  
>>> Hi Twisted general discussion,
>>> 
>>> A new TruBrain account has been created for you.
>>> 
>> ,
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com <mailto:Twisted-Python at twistedmatrix.com>
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python <http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python>_______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170303/274fef7c/attachment.html>

From exarkun at twistedmatrix.com  Fri Mar  3 05:23:53 2017
From: exarkun at twistedmatrix.com (Jean-Paul Calderone)
Date: Fri, 3 Mar 2017 07:23:53 -0500
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1795181488527858@web23h.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
Message-ID: <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>

On Fri, Mar 3, 2017 at 2:57 AM, ????? ????????? <romanmescheryakov at yandex.ru
> wrote:

> Hi everyone,
>
>
> *On the documentation web page
> https://twistedmatrix.com/documents/current/core/howto/application.html
> <https://twistedmatrix.com/documents/current/core/howto/application.html>
> in the ?Customizing twistd logging? section there are 2 examples which as I
> can see are a bit outdated in terms of imported module names and some other
> minor details. I would like to fix that. Is this change is worth doing? If
> so, please guide how can I do it. My GitHub login, if it?s needed, is
> RomanMeR.*
>

Hi ?????,

Thanks for your interest in improving Twisted!  Have a look at
https://twistedmatrix.com/trac/wiki/TwistedDevelopment and then let us know
if you have further questions.

Jean-Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170303/e3fce65a/attachment-0001.html>

From jasonjwwilliams at gmail.com  Fri Mar  3 13:34:32 2017
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 3 Mar 2017 12:34:32 -0800
Subject: [Twisted-Python] proto_helpers.StringTransport & TLS
Message-ID: <CAHZAEpfHZ1XaAfA8=RzPjmD7r6Y8B6cx+N4qpkNr+juqiK9cFw@mail.gmail.com>

Hey Guys,

We've been using proto_helpers.StringTransport for awhile in testing and
recently added TLS support we wanted to test as well. Has anyone subclassed
StringTransport to add startTLS support?

We added the _TLSConnectionMixin, _TLSClientMixin mixins to a new
StringTransportTLS subclass, but its throwing some basic errors we're
crunching through:

'StringTransportTLS' object has no attribute 'protocol'

So I thought I'd see if anyone had any pointers on doing this better. Thank
you in advance.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170303/3d75052b/attachment.html>

From trac at twistedmatrix.com  Sun Mar  5 00:05:19 2017
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 05 Mar 2017 07:05:19 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1488697519.96.1844292488552039864@twistedmatrix.com

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170305/f40c0fa1/attachment.html>

From adi at roiban.ro  Sun Mar  5 06:35:44 2017
From: adi at roiban.ro (Adi Roiban)
Date: Sun, 5 Mar 2017 13:35:44 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed for
	some HTTPS sites
Message-ID: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>

Hi,

It looks like when connected to some  HTTPS servers, the TLS
connection is not successfully closed.

With sites like google.com, the connection is successfully closed.

But with Office365 sharepoint.com sites the TLS shutdown is not completed.

Has anyone else observed this behaviour ?

I have observed this while running some end to end tests in which the
pool.closeCachedConnections() deferred was not called, even after a
generous amount of seconds :)

--------

the TLSMemoryBIOProtocol._tlsConnection.shutdown() will return False
and the connection is left open.

Future calls to tlsConnection will result in WantReadError

>From my understanding WantReadError means that more data needs to be
read and passed to the protocol.

And If I try to read from the raw socket I get this

data = TLSMemoryBIOProtocol.transport.socket.recv(1000)
*** error: [Errno 11] Resource temporarily unavailable

and the socket is never made available  and in the end it is closed with

data = TLSMemoryBIOProtocol.transport.socket.recv(100)
*** error: [Errno 104] Connection reset by peer

-----------

Here is a gits with the example code and some example output
https://gist.github.com/adiroiban/346dd455094d1762f0e69e9812309ad6

The gist also contains a patched TLSMemoryBIOProtocol._shutdownTLS
which will close the connection after some time.

PS: TLSMemoryBIOProtocol._tlsConnection.shutdown() make reference to
this issue https://github.com/pyca/pyopenssl/issues/91... but the
issue is now closed

Thanks!
-- 
Adi Roiban


From mithrandi at mithrandi.net  Sun Mar  5 07:25:01 2017
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Sun, 05 Mar 2017 14:25:01 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
Message-ID: <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>

On Sun, 5 Mar 2017 at 15:36 Adi Roiban <adi at roiban.ro> wrote:

> I have observed this while running some end to end tests in which the
> pool.closeCachedConnections() deferred was not called, even after a
> generous amount of seconds :)
>

The code to abort an HTTP client connection is here:

https://github.com/twisted/twisted/blob/twisted-17.1.0/src/twisted/web/_newclient.py#L1657

This calls loseConnection which for a TLS connection will try to do a TLS
shutdown under most circumstances (in some cases it can't, and will
abortConnection on the underlying transport instead). If the remote end has
stopped responding to the connection, I think this may end up hanging
forever.

I think this code should either call abortConnection directly, or set a
timer which will abort the connection after a little while if a clean
shutdown from loseConnection has not completed yet. I'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170305/d0581d6e/attachment.html>

From glyph at twistedmatrix.com  Sun Mar  5 23:37:02 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 5 Mar 2017 22:37:02 -0800
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
Message-ID: <42DCB7FB-754A-45C7-9568-4CDD9696C18D@twistedmatrix.com>


> On Mar 5, 2017, at 6:25 AM, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
> 
> I think this code should either call abortConnection directly, or set a timer which will abort the connection after a little while if a clean shutdown from loseConnection has not completed yet. I'
> 

Agreed - did someone file a bug? :)

-g
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170305/75d74e3f/attachment.html>

From pawelmhm at gmail.com  Mon Mar  6 00:22:07 2017
From: pawelmhm at gmail.com (=?UTF-8?B?UGF3ZcWCIE1pZWNo?=)
Date: Mon, 6 Mar 2017 08:22:07 +0100
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <42DCB7FB-754A-45C7-9568-4CDD9696C18D@twistedmatrix.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <42DCB7FB-754A-45C7-9568-4CDD9696C18D@twistedmatrix.com>
Message-ID: <CAO38UC=q6kuj3P2M3niU9PhFChB5jCpV1ie8twWDHa2CEfAe_Q@mail.gmail.com>

> It looks like when connected to some  HTTPS servers, the TLS
connection is not successfully closed.
> But with Office365 sharepoint.com sites the TLS shutdown is not completed.
> Has anyone else observed this behaviour ?

I observed something simillar a while ago, there was bug report created for
it in Scrapy. I'm not 100% sure this was same issue as you're discussing
here. Issue in Scrapy: https://github.com/scrapy/scrapy/issues/985 fix in
Scrapy https://github.com/scrapy/scrapy/pull/999 Author of this PR to
Scrapy also created Twisted ticket
https://twistedmatrix.com/trac/ticket/7738

Hope it helps

2017-03-06 7:37 GMT+01:00 Glyph Lefkowitz <glyph at twistedmatrix.com>:

>
> On Mar 5, 2017, at 6:25 AM, Tristan Seligmann <mithrandi at mithrandi.net>
> wrote:
>
> I think this code should either call abortConnection directly, or set a
> timer which will abort the connection after a little while if a clean
> shutdown from loseConnection has not completed yet. I'
>
>
> Agreed - did someone file a bug? :)
>
> -g
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170306/c0e5b0b2/attachment.html>

From mithrandi at mithrandi.net  Mon Mar  6 00:22:04 2017
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Mon, 06 Mar 2017 07:22:04 +0000
Subject: [Twisted-Python] twistedmatrix.com TLS certificate
Message-ID: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>

twistedmatrix.com's current certificate is issued by StartCom Certification
Authority; for certificates issued by this CA prior to 2016-09-21, the
domain must be on a Chrome whitelist for it to be accepted. As of Chrome
58.0.3026.3 (canary/dev channel only, currently, but eventually this will
presumably be in a release version) twistedmatrix.com is no longer[1] on
the whitelist, which means that twistedmatrix.com will issue a certificate
error. Can we switch to another CA? (Let's Encrypt, for example; I hear
somebody wrote a Twisted library for using that)

I'm sending this to the general list in case anyone else has been
scratching their head about why they're getting cert warnings.

[1]
https://chromium.googlesource.com/chromium/src/+/6fc397860ccafa55086456a4d1e6d713c418b41f%5E%21/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170306/fb53c92f/attachment.html>

From cory at lukasa.co.uk  Mon Mar  6 01:16:35 2017
From: cory at lukasa.co.uk (Cory Benfield)
Date: Mon, 6 Mar 2017 08:16:35 +0000
Subject: [Twisted-Python] twistedmatrix.com TLS certificate
In-Reply-To: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>
References: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>
Message-ID: <725154D7-EE02-4DFE-B332-DECA2423DBF0@lukasa.co.uk>


> On 6 Mar 2017, at 07:22, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
> 
> twistedmatrix.com <http://twistedmatrix.com/>'s current certificate is issued by StartCom Certification Authority; for certificates issued by this CA prior to 2016-09-21, the domain must be on a Chrome whitelist for it to be accepted. As of Chrome 58.0.3026.3 (canary/dev channel only, currently, but eventually this will presumably be in a release version) twistedmatrix.com <http://twistedmatrix.com/> is no longer[1] on the whitelist, which means that twistedmatrix.com <http://twistedmatrix.com/> will issue a certificate error. Can we switch to another CA? (Let's Encrypt, for example; I hear somebody wrote a Twisted library for using that)
> 
> I'm sending this to the general list in case anyone else has been scratching their head about why they're getting cert warnings.

This is an extremely good idea.

Cory

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170306/630d8dc8/attachment.html>

From cory at lukasa.co.uk  Mon Mar  6 01:17:39 2017
From: cory at lukasa.co.uk (Cory Benfield)
Date: Mon, 6 Mar 2017 08:17:39 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
Message-ID: <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>


> On 5 Mar 2017, at 14:25, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
> 
> On Sun, 5 Mar 2017 at 15:36 Adi Roiban <adi at roiban.ro <mailto:adi at roiban.ro>> wrote:
> I have observed this while running some end to end tests in which the
> pool.closeCachedConnections() deferred was not called, even after a
> generous amount of seconds :)
> 
> The code to abort an HTTP client connection is here:
> 
> https://github.com/twisted/twisted/blob/twisted-17.1.0/src/twisted/web/_newclient.py#L1657 <https://github.com/twisted/twisted/blob/twisted-17.1.0/src/twisted/web/_newclient.py#L1657>
> 
> This calls loseConnection which for a TLS connection will try to do a TLS shutdown under most circumstances (in some cases it can't, and will abortConnection on the underlying transport instead). If the remote end has stopped responding to the connection, I think this may end up hanging forever.
> 
> I think this code should either call abortConnection directly, or set a timer which will abort the connection after a little while if a clean shutdown from loseConnection has not completed yet. I?

Yeah, this looks right. We hit it in the server side code too: it?s a very unintuitive API in that sense.

Cory

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170306/75937ce2/attachment-0001.html>

From adi at roiban.ro  Mon Mar  6 02:05:09 2017
From: adi at roiban.ro (Adi Roiban)
Date: Mon, 6 Mar 2017 09:05:09 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
Message-ID: <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>

On 6 March 2017 at 08:17, Cory Benfield <cory at lukasa.co.uk> wrote:
>
> On 5 Mar 2017, at 14:25, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
>
> On Sun, 5 Mar 2017 at 15:36 Adi Roiban <adi at roiban.ro> wrote:
>>
>> I have observed this while running some end to end tests in which the
>> pool.closeCachedConnections() deferred was not called, even after a
>> generous amount of seconds :)
>
>
> The code to abort an HTTP client connection is here:
>
> https://github.com/twisted/twisted/blob/twisted-17.1.0/src/twisted/web/_newclient.py#L1657
>
> This calls loseConnection which for a TLS connection will try to do a TLS
> shutdown under most circumstances (in some cases it can't, and will
> abortConnection on the underlying transport instead). If the remote end has
> stopped responding to the connection, I think this may end up hanging
> forever.
>
> I think this code should either call abortConnection directly, or set a
> timer which will abort the connection after a little while if a clean
> shutdown from loseConnection has not completed yet. I?
>
>
> Yeah, this looks right. We hit it in the server side code too: it?s a very
> unintuitive API in that sense.

I am not sure about which code are we talking here.
The specific HTTP11ClientProtocol which will fix only the HTTP client
part or the generic TLSMemoryBIOProtocol code which might fix any TLS
connection?

I have observed this issue on the server side for the case in which a
TLS connection is opened and then closed  without transferring any
data ... and then the handshake will not have the chance to complete.

I think that this is the same issue which was reported for Scrapy

-- 
Adi Roiban


From exarkun at twistedmatrix.com  Mon Mar  6 19:03:57 2017
From: exarkun at twistedmatrix.com (Jean-Paul Calderone)
Date: Mon, 6 Mar 2017 21:03:57 -0500
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
Message-ID: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>

Hello,

GitHub apparently allows fast-forward merges to trunk.  Here's an example
of one:

  https://github.com/twisted/twisted/pull/730

This doesn't seem like a good thing.

   - The ticket is still open
   - There is no merge commit
   - There is no merge commit message
   - There are non-merge commits directly on trunk history (first parent)

  Anyone else have an opinion?

Also, on the same PR, it seems like folks have trouble managing the two
different ways to represent the review states: the "review" keyword in trac
and the accepted/etc status on the GitHub PR.  Maybe there shouldn't be two
different ways to represent this?

Jean-Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170306/49a404ae/attachment.html>

From glyph at twistedmatrix.com  Mon Mar  6 20:19:22 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 6 Mar 2017 19:19:22 -0800
Subject: [Twisted-Python] twistedmatrix.com TLS certificate
In-Reply-To: <725154D7-EE02-4DFE-B332-DECA2423DBF0@lukasa.co.uk>
References: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>
 <725154D7-EE02-4DFE-B332-DECA2423DBF0@lukasa.co.uk>
Message-ID: <68841104-9C0E-40F4-9189-A046C24E09DA@twistedmatrix.com>


> On Mar 6, 2017, at 12:16 AM, Cory Benfield <cory at lukasa.co.uk> wrote:
> 
> 
>> On 6 Mar 2017, at 07:22, Tristan Seligmann <mithrandi at mithrandi.net <mailto:mithrandi at mithrandi.net>> wrote:
>> 
>> twistedmatrix.com <http://twistedmatrix.com/>'s current certificate is issued by StartCom Certification Authority; for certificates issued by this CA prior to 2016-09-21, the domain must be on a Chrome whitelist for it to be accepted. As of Chrome 58.0.3026.3 (canary/dev channel only, currently, but eventually this will presumably be in a release version) twistedmatrix.com <http://twistedmatrix.com/> is no longer[1] on the whitelist, which means that twistedmatrix.com <http://twistedmatrix.com/> will issue a certificate error. Can we switch to another CA? (Let's Encrypt, for example; I hear somebody wrote a Twisted library for using that)
>> 
>> I'm sending this to the general list in case anyone else has been scratching their head about why they're getting cert warnings.
> 
> This is an extremely good idea.

Yes please.

This is the rare ops task that will actually be quite easy for someone to add in to Braid as a PR: https://github.com/twisted-infra/braid <https://github.com/twisted-infra/braid>

If you have a look at https://github.com/twisted-infra/braid/blob/master/services/t-web/twisted-web/ports <https://github.com/twisted-infra/braid/blob/master/services/t-web/twisted-web/ports> you might be able to guess how such a thing would go...

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170306/70f095dd/attachment.html>

From glyph at twistedmatrix.com  Mon Mar  6 21:37:47 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 6 Mar 2017 20:37:47 -0800
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
Message-ID: <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>


> On Mar 6, 2017, at 6:03 PM, Jean-Paul Calderone <exarkun at twistedmatrix.com> wrote:
> 
> Hello,
> 
> GitHub apparently allows fast-forward merges to trunk.  Here's an example of one:
> 
>   https://github.com/twisted/twisted/pull/730 <https://github.com/twisted/twisted/pull/730>
> 
> This doesn't seem like a good thing.
> The ticket is still open
> There is no merge commit
> There is no merge commit message
> There are non-merge commits directly on trunk history (first parent)
>   Anyone else have an opinion?

This is definitely bad, forbidden by existing policy, etc.  In fact I remember adjusting the settings so that the 'merge' button would always create a merge commit; in fact, the configuration is still set that way.

Craig, since you're the one who made this merge, can you explain what happened?  Has github's 'merge' button stopped prompting for a commit message?  Failing to wait for the removal of the 'review' keyword was obviously a mistake, but based on my previous experience with the 'merge' button this wouldn't even be a type of mistake that's _possible_ to make; understanding what you did to trigger it would therefore be very useful.

I don't think this is bad enough to do any major VCS surgery to fix (similar mistakes exist in the history, and both commits to Twisted.Quotes and literally all of the imported SVN history are single-parent), but it is worth doing some work to avoid recurring.

> Also, on the same PR, it seems like folks have trouble managing the two different ways to represent the review states: the "review" keyword in trac and the accepted/etc status on the GitHub PR.  Maybe there shouldn't be two different ways to represent this?

Indeed there should not.  I hope someone has the time to address this soon

The only blocker is that I don't want to lose the notion of a "review queue".  The random mess of works-in-progress, already-reviewed code awaiting feedback, and abandoned experiments that shows up on the default 'pull request' view is not a workable substitute for the relatively short and explicit "I have submitted code that wants a review but hasn't gotten one" list at https://twisted.reviews/ <https://twisted.reviews/>.  However, some combination of Github's new-ish explicit review workflow, (possibly, if necessary) some kind of bot to perform the operations that are mysteriously forbidden to outside contributors, and a custom query could easily do the trick if someone can work it out and document it.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170306/5aa6d9b9/attachment.html>

From mithrandi at mithrandi.net  Mon Mar  6 22:02:29 2017
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Tue, 07 Mar 2017 05:02:29 +0000
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
Message-ID: <CAMcKhMTdLoDYmfBYUJuOw4R5QJHamwDOgLc1rMa6giYfXF3K8Q@mail.gmail.com>

On Tue, 7 Mar 2017 at 06:38 Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

>
> This is definitely bad, forbidden by existing policy, etc.  In fact I
> remember adjusting the settings so that the 'merge' button would always
> create a merge commit; in fact, the configuration is still set that way.
>

Rebase merging was allowed when I checked earlier, so I disabled it (I
guess I managed to do this before you looked at the configuration). I
suspect that is what happened here, but note also that these settings only
control what is possible by pressing the merge button on GitHub; you can
construct commits locally however you like and push them, as long as you
get green commit statuses for all the mandatory commit checks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170307/ae0f154b/attachment.html>

From glyph at twistedmatrix.com  Tue Mar  7 00:56:00 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 6 Mar 2017 23:56:00 -0800
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <CAMcKhMTdLoDYmfBYUJuOw4R5QJHamwDOgLc1rMa6giYfXF3K8Q@mail.gmail.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
 <CAMcKhMTdLoDYmfBYUJuOw4R5QJHamwDOgLc1rMa6giYfXF3K8Q@mail.gmail.com>
Message-ID: <61649AEC-591F-4786-B9F5-E35A374AF1A4@twistedmatrix.com>


> On Mar 6, 2017, at 9:02 PM, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
> 
> On Tue, 7 Mar 2017 at 06:38 Glyph Lefkowitz <glyph at twistedmatrix.com <mailto:glyph at twistedmatrix.com>> wrote:
> 
> This is definitely bad, forbidden by existing policy, etc.  In fact I remember adjusting the settings so that the 'merge' button would always create a merge commit; in fact, the configuration is still set that way.
> 
> Rebase merging was allowed when I checked earlier, so I disabled it (I guess I managed to do this before you looked at the configuration).

Perhaps I only did this for some other repos, then.  Did I miss your announcement of this?  Hint, hint? :)

> I suspect that is what happened here, but note also that these settings only control what is possible by pressing the merge button on GitHub; you can construct commits locally however you like and push them, as long as you get green commit statuses for all the mandatory commit checks.

Is this true even for people with just repo:write?

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170306/5c7c4f2c/attachment-0001.html>

From cory at lukasa.co.uk  Tue Mar  7 02:31:11 2017
From: cory at lukasa.co.uk (Cory Benfield)
Date: Tue, 7 Mar 2017 09:31:11 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
Message-ID: <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>


> On 6 Mar 2017, at 09:05, Adi Roiban <adi at roiban.ro> wrote:
> 
> I am not sure about which code are we talking here.
> The specific HTTP11ClientProtocol which will fix only the HTTP client
> part or the generic TLSMemoryBIOProtocol code which might fix any TLS
> connection?

I?m talking about the fact that calling TLSMemoryBIOProtocol.loseConnection may not ever actually drop the underlying FD is the surprising part of the code. We had to work around it in the server side by adding a timeout after loseConnection is called to end up calling abortConnection.

Cory
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170307/0bb3b0a8/attachment.html>

From mithrandi at mithrandi.net  Tue Mar  7 02:52:38 2017
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Tue, 07 Mar 2017 09:52:38 +0000
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <61649AEC-591F-4786-B9F5-E35A374AF1A4@twistedmatrix.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
 <CAMcKhMTdLoDYmfBYUJuOw4R5QJHamwDOgLc1rMa6giYfXF3K8Q@mail.gmail.com>
 <61649AEC-591F-4786-B9F5-E35A374AF1A4@twistedmatrix.com>
Message-ID: <CAMcKhMTxPjtbWrS2HnoVdoVtVqV8t_jNZXUEiKDeMBxTO4_WLQ@mail.gmail.com>

On Tue, 7 Mar 2017 at 09:56 Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> On Mar 6, 2017, at 9:02 PM, Tristan Seligmann <mithrandi at mithrandi.net>
> wrote:
>
> On Tue, 7 Mar 2017 at 06:38 Glyph Lefkowitz <glyph at twistedmatrix.com>
> wrote:
>
>
> This is definitely bad, forbidden by existing policy, etc.  In fact I
> remember adjusting the settings so that the 'merge' button would always
> create a merge commit; in fact, the configuration is still set that way.
>
>
> Rebase merging was allowed when I checked earlier, so I disabled it (I
> guess I managed to do this before you looked at the configuration).
>
>
> Perhaps I only did this for some other repos, then.  Did I miss your
> announcement of this?  Hint, hint? :)
>

 By the time I got to my email client (which admittedly was several hours
after I made the configuration change), your email had arrived, so my reply
ended up being the "announcement" too. The last time I looked at these
settings, rebasing was not allowed, so I guess somebody else turned it on
(possibly by accident); the GitHub audit logs don't go far back enough for
me to check who did it and when, but that means the change happened over
several months ago.

> I suspect that is what happened here, but note also that these settings
> only control what is possible by pressing the merge button on GitHub; you
> can construct commits locally however you like and push them, as long as
> you get green commit statuses for all the mandatory commit checks.
>
>
> Is this true even for people with just repo:write?
>

I haven't actually tested this scenario, so I could be mistaken; inferring
from other things it shouldn't matter what your permissions are (for a
non-force push).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170307/dded756f/attachment.html>

From rodrigc at crodrigues.org  Tue Mar  7 11:40:50 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Tue, 7 Mar 2017 10:40:50 -0800
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
Message-ID: <CAG=rPVdEniSgKC12NFdXqUs+OqZeQb47cSBjwq-708=cLQ5wYA@mail.gmail.com>

On Mon, Mar 6, 2017 at 8:37 PM, Glyph Lefkowitz <glyph at twistedmatrix.com>
wrote:

>
>
> Craig, since you're the one who made this merge, can you explain what
> happened?  Has github's 'merge' button stopped prompting for a commit
> message?  Failing to wait for the removal of the 'review' keyword was
> obviously a mistake, but based on my previous experience with the 'merge'
> button this wouldn't even be a type of mistake that's _possible_ to make;
> understanding what you did to trigger it would therefore be very useful.
>
>
Woops, sorry about that.  I pressed the Merge button in git, but I guess I
clicked on the wrong
option after that.  It is good that this is now disabled to prevent future
mistakes like this.

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170307/bc56ce6b/attachment.html>

From glyph at twistedmatrix.com  Tue Mar  7 23:02:24 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 7 Mar 2017 22:02:24 -0800
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <CAG=rPVdEniSgKC12NFdXqUs+OqZeQb47cSBjwq-708=cLQ5wYA@mail.gmail.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
 <CAG=rPVdEniSgKC12NFdXqUs+OqZeQb47cSBjwq-708=cLQ5wYA@mail.gmail.com>
Message-ID: <5527A04E-DCF2-49A8-8C52-D988736BC63E@twistedmatrix.com>


> On Mar 7, 2017, at 10:40 AM, Craig Rodrigues <rodrigc at crodrigues.org> wrote:
> 
> 
> 
> On Mon, Mar 6, 2017 at 8:37 PM, Glyph Lefkowitz <glyph at twistedmatrix.com <mailto:glyph at twistedmatrix.com>> wrote:
> 
> 
> Craig, since you're the one who made this merge, can you explain what happened?  Has github's 'merge' button stopped prompting for a commit message?  Failing to wait for the removal of the 'review' keyword was obviously a mistake, but based on my previous experience with the 'merge' button this wouldn't even be a type of mistake that's _possible_ to make; understanding what you did to trigger it would therefore be very useful.
> 
> 
> Woops, sorry about that.  I pressed the Merge button in git, but I guess I clicked on the wrong
> option after that.  It is good that this is now disabled to prevent future mistakes like this.

OK, good to know; so this was a repo misconfiguration coupled with human error.  Glad we have something in place to prevent it now :).

Craig - that said, can you go back and fix up the relevant state (kill the 'review' keyword, close the ticket with a reference to the relevant commit, and so on)?

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170307/24cef158/attachment.html>

From adi at roiban.ro  Thu Mar  9 13:40:44 2017
From: adi at roiban.ro (Adi Roiban)
Date: Thu, 9 Mar 2017 20:40:44 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
 <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
Message-ID: <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>

On 7 March 2017 at 09:31, Cory Benfield <cory at lukasa.co.uk> wrote:
>
> On 6 Mar 2017, at 09:05, Adi Roiban <adi at roiban.ro> wrote:
>
> I am not sure about which code are we talking here.
> The specific HTTP11ClientProtocol which will fix only the HTTP client
> part or the generic TLSMemoryBIOProtocol code which might fix any TLS
> connection?
>
>
> I?m talking about the fact that calling TLSMemoryBIOProtocol.loseConnection
> may not ever actually drop the underlying FD is the surprising part of the
> code. We had to work around it in the server side by adding a timeout after
> loseConnection is called to end up calling abortConnection.
>
> Cory

In order to submit a patch, I am trying to write an automated tests for this.
Were you able to reproduce this issue in a controlled environment.

I am still not fully understanding why I get this behaviour with
sharepoint.com sites.

I am thinking at having a rigged TLS server which will keep the socket
open but will not
respond to the shutdown request.... but I still don't know how :)

-- 
Adi Roiban


From exarkun at twistedmatrix.com  Thu Mar  9 15:01:31 2017
From: exarkun at twistedmatrix.com (Jean-Paul Calderone)
Date: Thu, 9 Mar 2017 17:01:31 -0500
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
 <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
 <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>
Message-ID: <CAEeXt4OvT1qykf=n2zWGGUiokDm_dbkKTavAOnDnM5g6qVTQ1g@mail.gmail.com>

On Thu, Mar 9, 2017 at 3:40 PM, Adi Roiban <adi at roiban.ro> wrote:

> On 7 March 2017 at 09:31, Cory Benfield <cory at lukasa.co.uk> wrote:
> >
> > On 6 Mar 2017, at 09:05, Adi Roiban <adi at roiban.ro> wrote:
> >
> > I am not sure about which code are we talking here.
> > The specific HTTP11ClientProtocol which will fix only the HTTP client
> > part or the generic TLSMemoryBIOProtocol code which might fix any TLS
> > connection?
> >
> >
> > I?m talking about the fact that calling TLSMemoryBIOProtocol.
> loseConnection
> > may not ever actually drop the underlying FD is the surprising part of
> the
> > code. We had to work around it in the server side by adding a timeout
> after
> > loseConnection is called to end up calling abortConnection.
> >
> > Cory
>
> In order to submit a patch, I am trying to write an automated tests for
> this.
> Were you able to reproduce this issue in a controlled environment.
>
> I am still not fully understanding why I get this behaviour with
> sharepoint.com sites.
>
> I am thinking at having a rigged TLS server which will keep the socket
> open but will not
> respond to the shutdown request.... but I still don't know how :)
>
>
Run the server with TLSMemoryBIOProtocol and use the transport's
pauseProducing method before you attempt the shutdown?

Jean-Paul


> --
> Adi Roiban
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170309/79de8b8f/attachment.html>

From cory at lukasa.co.uk  Fri Mar 10 01:26:40 2017
From: cory at lukasa.co.uk (Cory Benfield)
Date: Fri, 10 Mar 2017 08:26:40 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAEeXt4OvT1qykf=n2zWGGUiokDm_dbkKTavAOnDnM5g6qVTQ1g@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
 <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
 <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>
 <CAEeXt4OvT1qykf=n2zWGGUiokDm_dbkKTavAOnDnM5g6qVTQ1g@mail.gmail.com>
Message-ID: <75B7556E-F0DB-4B9D-9B05-7224BA010690@lukasa.co.uk>


> On 9 Mar 2017, at 22:01, Jean-Paul Calderone <exarkun at twistedmatrix.com> wrote:
> 
> Run the server with TLSMemoryBIOProtocol and use the transport's pauseProducing method before you attempt the shutdown?
> 
> Jean-Paul

Yup, that will work. Similarly, having two TLSMemoryBIOProtocols communicating together and pausing one before calling loseConnection on the other should also work. Essentially, any situation you can conjure where the closing connection will manage not to see either a TLS CloseNotify or a TCP FIN or RST will do the job.

Cory

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170310/5e66904d/attachment.html>

From exarkun at twistedmatrix.com  Fri Mar 10 05:21:29 2017
From: exarkun at twistedmatrix.com (Jean-Paul Calderone)
Date: Fri, 10 Mar 2017 07:21:29 -0500
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <75B7556E-F0DB-4B9D-9B05-7224BA010690@lukasa.co.uk>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
 <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
 <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>
 <CAEeXt4OvT1qykf=n2zWGGUiokDm_dbkKTavAOnDnM5g6qVTQ1g@mail.gmail.com>
 <75B7556E-F0DB-4B9D-9B05-7224BA010690@lukasa.co.uk>
Message-ID: <CAEeXt4OuUXmr_76PhggLvrr6fs3Anc5YjH9rv10NQiHWLNCJ-w@mail.gmail.com>

On Fri, Mar 10, 2017 at 3:26 AM, Cory Benfield <cory at lukasa.co.uk> wrote:

>
> On 9 Mar 2017, at 22:01, Jean-Paul Calderone <exarkun at twistedmatrix.com>
> wrote:
>
> Run the server with TLSMemoryBIOProtocol and use the transport's
> pauseProducing method before you attempt the shutdown?
>
> Jean-Paul
>
>
> Yup, that will work. Similarly, having two TLSMemoryBIOProtocols
> communicating together and pausing one before calling loseConnection on the
> other should also work. Essentially, any situation you can conjure where
> the closing connection will manage not to see either a TLS CloseNotify or a
> TCP FIN or RST will do the job.
>

Indeed.  For that matter, you can have them interact in-memory (maybe
StringTransport is good enough as-is, maybe not, I'm not sure) and then
just stop shuttling the bytes in one direction.  (I/O-free tests for the
win)

Jean-Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170310/aba1629d/attachment.html>

From trac at twistedmatrix.com  Sun Mar 12 00:05:19 2017
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 12 Mar 2017 07:05:19 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1489302319.63.7467244579673818915@twistedmatrix.com

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170312/db62e0a2/attachment.html>

From jamesbroadhead at gmail.com  Sun Mar 12 09:13:01 2017
From: jamesbroadhead at gmail.com (James Broadhead)
Date: Sun, 12 Mar 2017 15:13:01 +0000
Subject: [Twisted-Python] twistedmatrix.com TLS certificate
In-Reply-To: <68841104-9C0E-40F4-9189-A046C24E09DA@twistedmatrix.com>
References: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>
 <725154D7-EE02-4DFE-B332-DECA2423DBF0@lukasa.co.uk>
 <68841104-9C0E-40F4-9189-A046C24E09DA@twistedmatrix.com>
Message-ID: <CA+hid6EfRpOixKeyfpxf+g3ApS=s+sT-qrCxgCdZ-1hpxprpTg@mail.gmail.com>

Just ran into this. For interested parties, Chrome 58 is due to go stable
on Apr 25th [1]



[1] https://www.chromium.org/developers/calendar

On 7 March 2017 at 03:19, Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

>
> On Mar 6, 2017, at 12:16 AM, Cory Benfield <cory at lukasa.co.uk> wrote:
>
>
> On 6 Mar 2017, at 07:22, Tristan Seligmann <mithrandi at mithrandi.net>
> wrote:
>
> twistedmatrix.com's current certificate is issued by StartCom
> Certification Authority; for certificates issued by this CA prior to
> 2016-09-21, the domain must be on a Chrome whitelist for it to be accepted.
> As of Chrome 58.0.3026.3 (canary/dev channel only, currently, but
> eventually this will presumably be in a release version) twistedmatrix.com
> is no longer[1] on the whitelist, which means that twistedmatrix.com will
> issue a certificate error. Can we switch to another CA? (Let's Encrypt, for
> example; I hear somebody wrote a Twisted library for using that)
>
> I'm sending this to the general list in case anyone else has been
> scratching their head about why they're getting cert warnings.
>
>
> This is an extremely good idea.
>
>
> Yes please.
>
> This is the rare ops task that will actually be quite easy for someone to
> add in to Braid as a PR: https://github.com/twisted-infra/braid
>
> If you have a look at https://github.com/twisted-infra/braid/blob/master/
> services/t-web/twisted-web/ports you might be able to guess how such a
> thing would go...
>
> -glyph
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170312/08b1ba22/attachment.html>

From romanmescheryakov at yandex.ru  Mon Mar 13 13:58:00 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Mon, 13 Mar 2017 22:58:00 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
Message-ID: <1562331489435080@web25j.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170313/5cf5fb42/attachment.html>

From jamesbroadhead at gmail.com  Mon Mar 13 16:04:29 2017
From: jamesbroadhead at gmail.com (James Broadhead)
Date: Mon, 13 Mar 2017 22:04:29 +0000
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1562331489435080@web25j.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
Message-ID: <CA+hid6H0nvRUBMHx4OuMea+PODeEY673gu8vR49Rj0Kx4CKjTQ@mail.gmail.com>

Hey there --

One way would be to use virtualenv to gather the dependencies without
installing them globally:

mkdir -p ~/venv
virtualenv ~/venv/twisted_docs   # `sudo pip install virtualenv` first if
you don't have this command
source ~/venv/twisted_docs/bin/activate
pip install sphinx twisted
cd <repo>/docs
make html

James

On 13 March 2017 at 19:58, ????? ????????? <romanmescheryakov at yandex.ru>
wrote:

>
> Hello,
>
> I managed to read documentation finally. I made a fork of Twisted
> repository using these commands:
>
>
> git clone https://github.com/<yourusername>/twisted.git Twisted
> cd Twisted
> git remote add upstream https://github.com/twisted/twisted.git
> git fetch upstream
> git branch -u upstream/trunk trunk
>
> Then created python virtualenv and installed Sphinx into it. Then I tried
> to generate narrative HTML documentation:
>
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev $ cd docs
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev/docs $ make html
> sphinx-build -b html -d _build/doctrees   . _build/html
> Running Sphinx v1.5.3
>
> Exception occurred:
>   File "conf.py", line 45, in <module>
>     from twisted import version as twisted_version_object
> ImportError: No module named twisted
> The full traceback has been saved in /tmp/sphinx-err-75zxJ8.log, if you
> want to report the issue to the developers.
> Please also report this if it was a user error, so that a better error
> message can be provided next time.
> A bug report can be filed in the tracker at <https://github.com/sphinx-
> doc/sphinx/issues>. Thanks!
> Makefile:53: ?????? ?????????? ??????? ??? ???? ?html?
> make: *** [html] ?????? 1
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev/docs $
>
> Please help me to resolve this error!
>
> --
> Kind regards, Roman Mescheryakov
>
>
>
> 03.03.2017, 15:25, "Jean-Paul Calderone" <exarkun at twistedmatrix.com>:
>
> On Fri, Mar 3, 2017 at 2:57 AM, ????? ????????? <
> romanmescheryakov at yandex.ru> wrote:
>
> Hi everyone,
>
>
> *On the documentation web page
> https://twistedmatrix.com/documents/current/core/howto/application.html
> <https://twistedmatrix.com/documents/current/core/howto/application.html>
> in the ?Customizing twistd logging? section there are 2 examples which as I
> can see are a bit outdated in terms of imported module names and some other
> minor details. I would like to fix that. Is this change is worth doing? If
> so, please guide how can I do it. My GitHub login, if it?s needed, is
> RomanMeR.*
>
>
> Hi ?????,
>
> Thanks for your interest in improving Twisted!  Have a look at
> https://twistedmatrix.com/trac/wiki/TwistedDevelopment and then let us
> know if you have further questions.
>
> Jean-Paul
>
> ,
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170313/9f09665d/attachment.html>

From rodrigc at crodrigues.org  Mon Mar 13 22:24:32 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Mon, 13 Mar 2017 21:24:32 -0700
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1562331489435080@web25j.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
Message-ID: <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>

On Mon, Mar 13, 2017 at 12:58 PM, ????? ????????? <
romanmescheryakov at yandex.ru> wrote:

>
>
> Exception occurred:
>   File "conf.py", line 45, in <module>
>     from twisted import version as twisted_version_object
> ImportError: No module named twisted
>
>
Looks like Twisted needs to be installed in order to build the docs.

I would suggest using a virtualenv for everything, and installing Twisted
from your checkout into it in it.


python -m virtualenv my_venv   # Python 2

or

python3 -m venv my_venv         # Python 3

source my_venv/bin/activate
#
git clone https://github.com/<yourusername>/twisted.git Twisted
cd Twisted
python setup.py develop    # this installs Twisted in your virtual env
git remote add upstream https://github.com/twisted/twisted.git
git fetch upstream
git branch -u upstream/trunk trunk
#
pip install sphinx
cd docs
make html



--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170313/e3a4c734/attachment-0001.html>

From rodrigc at crodrigues.org  Tue Mar 14 00:03:07 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Mon, 13 Mar 2017 23:03:07 -0700
Subject: [Twisted-Python] Problem with "dev" version number generated by
	incremental
Message-ID: <CAG=rPVcDuJvSfNCcDSa3Sp2JET2payzKNFt7nEgYoTb=_rbQgg@mail.gmail.com>

Hi,

I tried to use a "dev" version of Twisted, and ran into some
problems with the version number generated by incremental:

https://github.com/hawkowl/incremental/issues/29

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170313/95a57a12/attachment.html>

From glyph at twistedmatrix.com  Tue Mar 14 00:47:26 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 13 Mar 2017 23:47:26 -0700
Subject: [Twisted-Python]
 =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
 =?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
Message-ID: <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>


> On Mar 13, 2017, at 9:24 PM, Craig Rodrigues <rodrigc at crodrigues.org> wrote:
> 
> 
> 
> On Mon, Mar 13, 2017 at 12:58 PM, ????? ????????? <romanmescheryakov at yandex.ru <mailto:romanmescheryakov at yandex.ru>> wrote:
>  
>  
> Exception occurred:
>   File "conf.py", line 45, in <module>
>     from twisted import version as twisted_version_object
> ImportError: No module named twisted
> 
> 
> Looks like Twisted needs to be installed in order to build the docs.
> 
> I would suggest using a virtualenv for everything, and installing Twisted
> from your checkout into it in it.

My suggestion would be to use the tox environments for this that we already provide :).

`tox -e apidocs` will build the API documentation, and `tox -e narrativedocs` will build the narrative documentation.  This has the advantage that if we change the required packages for doc-building in the future, these commands will automatically re-build an appropriate virtualenv for the task.

To discover what environments are available, `tox -l`.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170313/84747c5c/attachment.html>

From romanmescheryakov at yandex.ru  Tue Mar 14 01:53:00 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Tue, 14 Mar 2017 10:53:00 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
Message-ID: <1971331489477980@web1o.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170314/9f2e63ff/attachment.html>

From glyph at twistedmatrix.com  Tue Mar 14 02:47:11 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 14 Mar 2017 01:47:11 -0700
Subject: [Twisted-Python]
 =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
 =?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1971331489477980@web1o.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
Message-ID: <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>


> On Mar 14, 2017, at 12:53 AM, ????? ????????? <romanmescheryakov at yandex.ru> wrote:
> 
> I decided to try Glyph's suggestion first.
> By the way, I'm trying to compile twisted documentation on Raspbian, is this platform suitable for that?
> The steps I performed just were:
> sudo pip install tox (Glyph said I shouldn't install packages globally but it's too late for this Raspbian installation...)
> Changed current directory to that where tox.ini resides
> I didn't activate any virtual environments
> tox -e narrativedocs
> The result was fail, if I understood correctly, due to this error:
>  
>   Running setup.py bdist_wheel for cryptography: started
>   Running setup.py bdist_wheel for cryptography: finished with status 'error'
>   Complete output from command /home/pi/ColourDreams/Twisted-dev/build/narrativedocs/bin/python -u -c "import setuptools, tokenize;__file__='/tmp/pip-build-LEVwwA/cryptography/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" bdist_wheel -d /tmp/tmpTiRC7Rpip-wheel- --python-tag cp27:
>   Package libffi was not found in the pkg-config search path.
>   Perhaps you should add the directory containing `libffi.pc'
>   to the PKG_CONFIG_PATH environment variable
>   No package 'libffi' found
>  
> Maybe it's because Raspbian is not suitable for twisted development? If this is the case, can I use Windows?

Raspbian should be fine, but you do have to have enough dependencies installed.  In this case you need to apt install libffi-dev and openssl-dev; it will be slow to build the first time (for each version of python) but it will speed up a lot after that due to build caching.

(Specifically this is because it is building Cryptography, which does not yet ship a manylinux1 wheel.)

Let me know if that works,

-g




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170314/abddb2dd/attachment.html>

From romanmescheryakov at yandex.ru  Tue Mar 14 07:28:12 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Tue, 14 Mar 2017 16:28:12 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
Message-ID: <4533161489498092@web20o.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170314/8d5bd49c/attachment-0001.html>

From glyph at twistedmatrix.com  Tue Mar 14 23:42:16 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 14 Mar 2017 22:42:16 -0700
Subject: [Twisted-Python]
 =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
 =?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <4533161489498092@web20o.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
Message-ID: <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>


> On Mar 14, 2017, at 6:28 AM, ????? ????????? <romanmescheryakov at yandex.ru> wrote:
> 
> I installed libffi-dev and libssl-dev Raspbian packages, and run "tox -e narrativedocs" again. Now the error was about missing "sphinx-build" executable. So I activated virtualenv where Sphinx was previously installed and again issued "tox -e narrativedocs". Now the output was:
>  
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev $ tox -e narrativedocs
> GLOB sdist-make: /home/pi/ColourDreams/Twisted-dev/setup.py
> narrativedocs inst-nodeps: /home/pi/ColourDreams/Twisted-dev/build/dist/Twisted-17.1.0dev0.zip
> narrativedocs installed: appdirs==1.4.3,asn1crypto==0.21.1,attrs==16.3.0,Automat==0.5.0,constantly==15.1.0,enum34==1.1.6,idna==2.5,incremental==16.10.1,ipaddress==1.0.18,packaging==16.8,pycparser==2.17,pyflakes==1.5.0,pyparsing==2.2.0,requests==2.13.0,six==1.10.0,Twisted==17.1.0.dev0,zope.interface==4.3.3
> narrativedocs runtests: PYTHONHASHSEED='496434055'
> narrativedocs runtests: commands[0] | python -c import sys; print(sys.prefix)
> /home/pi/ColourDreams/Twisted-dev/build/narrativedocs
> narrativedocs runtests: commands[1] | python -c import sys; print(sys.exec_prefix)
> /home/pi/ColourDreams/Twisted-dev/build/narrativedocs
> narrativedocs runtests: commands[2] | python -c import sys; print(sys.executable)
> /home/pi/ColourDreams/Twisted-dev/build/narrativedocs/bin/python
> narrativedocs runtests: commands[3] | python --version
> Python 2.7.9
> narrativedocs runtests: commands[4] | sphinx-build -aW -b html -d /home/pi/ColourDreams/Twisted-dev/docs/_build /home/pi/ColourDreams/Twisted-dev/docs /home/pi/ColourDreams/Twisted-dev/docs/_build/
> WARNING:test command found but not installed in testenv
>   cmd: /home/pi/twisted-dev-env/bin/sphinx-build
>   env: /home/pi/ColourDreams/Twisted-dev/build/narrativedocs
> Maybe you forgot to specify a dependency? See also the whitelist_externals envconfig setting.
> Running Sphinx v1.5.3
>  
> Exception occurred:
>   File "conf.py", line 45, in <module>
> ImportError: No module named twisted
> The full traceback has been saved in /tmp/sphinx-err-s9PZVd.log, if you want to report the issue to the developers.
> Please also report this if it was a user error, so that a better error message can be provided next time.
> A bug report can be filed in the tracker at <https://github.com/sphinx-doc/sphinx/issues>. Thanks!
> ERROR: InvocationError: '/home/pi/twisted-dev-env/bin/sphinx-build -aW -b html -d /home/pi/ColourDreams/Twisted-dev/docs/_build /home/pi/ColourDreams/Twisted-dev/docs /home/pi/ColourDreams/Twisted-dev/docs/_build/'
> __________________________________________________________ summary __________________________________________________________
> ERROR:   narrativedocs: commands failed
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev $
>  
> The error is "twisted" module missing. How could I fix that? Should I install Twisted Python package to my virtualenv? Now I only have Twisted Python package installed globally.

From what I've seen here, it doesn't look like you've done anything wrong - this should work.  So it's going to require some investigation.

I don't know why it would be choosing to 'inst-nodeps' when the deps clearly aren't installed yet.  When I do this, what I see is:

GLOB sdist-make: /Users/glyph/Projects/Twisted/setup.py
narrativedocs create: /Users/glyph/Projects/Twisted/build/narrativedocs
narrativedocs inst: /Users/glyph/Projects/Twisted/build/dist/Twisted-17.1.0.dev0.zip
narrativedocs installed: alabaster==0.7.10,amptrac==0.1,appdirs==1.4.3,asn1crypto==0.21.1,astroid==1.4.9,attrs==16.3.0,Automat==0.5.0,Babel==2.3.4,cffi==1.9.1,colorama==0.3.7,constantly==15.1.0,cryptography==1.8.1,docutils==0.13.1,enum34==1.1.6,epydoc==3.0.1,extras==1.0.0,fixtures==3.0.0,idna==2.5,imagesize==0.7.1,incremental==16.10.1,ipaddress==1.0.18,Jinja2==2.9.5,lazy-object-proxy==1.2.2,linecache2==1.0.0,logilab-common==1.2.1,MarkupSafe==1.0,packaging==16.8,pbr==2.0.0,pyasn1==0.2.3,pyasn1-modules==0.0.8,pycodestyle==2.0.0,pycparser==2.17,pydoctor==16.3.0,pyflakes==1.5.0,Pygments==2.2.0,pylint==1.5.6,pyOpenSSL==16.2.0,pyparsing==2.2.0,python-mimeparse==1.6.0,python-subunit==1.2.0,pytz==2016.10,requests==2.13.0,service-identity==16.0.0,six==1.10.0,snowballstemmer==1.2.1,Sphinx==1.5.3,testtools==2.2.0,traceback2==1.4.0,treq==16.12.0,Twisted==17.1.0.dev0,twisted-dev-tools==0.0.2,twistedchecker==0.7.1,unittest2==1.1.0,wrapt==1.10.10,zope.interface==4.3.3
narrativedocs runtests: PYTHONHASHSEED='3320851011'
narrativedocs runtests: commands[0] | python -c import sys; print(sys.prefix)
/Users/glyph/Projects/Twisted/build/narrativedocs/bin/..
narrativedocs runtests: commands[1] | python -c import sys; print(sys.exec_prefix)
/Users/glyph/Projects/Twisted/build/narrativedocs/bin/..
narrativedocs runtests: commands[2] | python -c import sys; print(sys.executable)
/Users/glyph/Projects/Twisted/build/narrativedocs/bin/python
narrativedocs runtests: commands[3] | python --version
Python 2.7.12
narrativedocs runtests: commands[4] | sphinx-build -aW -b html -d /Users/glyph/Projects/Twisted/docs/_build /Users/glyph/Projects/Twisted/docs /Users/glyph/Projects/Twisted/docs/_build/
Running Sphinx v1.5.3
making output directory...
loading pickled environment... not yet created
loading intersphinx inventory from http://docs.python.org/3.3/objects.inv...
intersphinx inventory has moved: http://docs.python.org/3.3/objects.inv -> https://docs.python.org/3.3/objects.inv
loading intersphinx inventory from http://docs.python.org/2.7/objects.inv...
intersphinx inventory has moved: http://docs.python.org/2.7/objects.inv -> https://docs.python.org/2.7/objects.inv
building [mo]: all of 0 po files
building [html]: all source files
updating environment: 135 added, 0 changed, 0 removed
reading sources... [100%] words/index                                                              
looking for now-outdated files... none found
pickling environment... done
checking consistency... done
preparing documents... done
writing output... [100%] words/index                                                               
generating indices... genindex
writing additional pages... search
copying images... [100%] web/howto/../img/web-process.png                                          
copying downloadable files... [ 58%] core/howto/tutorial/listings/finger/twisted/plugins/finger_tutcopying downloadable files... [ 84%] core/howto/listings/systemd/www.example.com.socketactivated.secopying downloadable files... [100%] core/howto/tutorial/listings/finger/fingerPBclient.py         
copying static files... done
copying extra files... done
dumping search index in English (code: en) ... done
dumping object inventory... done
build succeeded.
_____________________________________________ summary _____________________________________________
  narrativedocs: commands succeeded
  congratulations :)


So, a few questions for you:

Are you running the latest `tox`? (tox --version == 2.6.0)
This is not the first time you've run 'tox', or it would have the 'narrativedocs create' line above.  Did you see what happened on the earlier runs?  Did they all fail?
Can you try re-creating the virtual environment?  Either `tox -r -e narrativedocs` or `rm -fr build/; tox -e narrativedocs`
Can you try doing this against a 'dev' install, i.e. `tox --develop -e narrativedocs`?
What happens if you make a new virtual environment and do `pip install .../path/to/twisted[dev]` (just .[dev] if you're in the twisted dir)?  Specifically: does sphinx get installed in that virtual environment?
Did you copy this development environment from another machine, or move it to a different folder?

Hopefully we can get to the bottom of this and learn something for future contributors about whatever pitfall you've encountered!

Thanks for your patience,

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170314/9e9d0fbc/attachment-0001.html>

From romanmescheryakov at yandex.ru  Wed Mar 15 09:28:23 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Wed, 15 Mar 2017 18:28:23 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
Message-ID: <4741489591703@web42g.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170315/a131c2e7/attachment-0001.html>

From glyph at twistedmatrix.com  Wed Mar 15 22:41:12 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 15 Mar 2017 21:41:12 -0700
Subject: [Twisted-Python]
 =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
 =?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <4741489591703@web42g.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
 <4741489591703@web42g.yandex.ru>
Message-ID: <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>


> On Mar 15, 2017, at 8:28 AM, ????? ????????? <romanmescheryakov at yandex.ru> wrote:
> 
>  
> > Are you running the latest `tox`? (tox --version == 2.6.0)
> Yes
>  
> > This is not the first time you've run 'tox', or it would have the 'narrativedocs create' line above.  Did you see what happened on the earlier runs?  Did they all fail?
> 
> Yes, they all failed. I don't have tox output from previous runs. As I remember, the first 'tox -e narrativedocs' run failed because of missing libffi dependency, so this is possible first step one needs to reproduce the problem with running 'narrativedocs inst-nodeps' instead of 'narrativedocs create'.
>  
> > Did you copy this development environment from another machine, or move it to a different folder?
> No
>  
> > Can you try re-creating the virtual environment?  Either `tox -r -e narrativedocs` or `rm -fr build/; tox -e narrativedocs`
>  
> I tried the `tox -r -e narrativedocs` command and it succeeded! Docs built successfully.
>  
> Thank you Glyph for helping :) And thanks to all who responded as well! :)

You're welcome!  Glad we got you up and running, sorry we couldn't figure out what the problem was.

> One thing that is left unclear to me: the `narrativedocs installed` line in the tox output contains a long list of installed modules. Where were they installed? Because `pip list` doesn't show me them neither for the virtual environment which was active when I run tox nor for the global list.

`tox` is a tool which creates multiple virtualenvs for testing a project in multiple configurations, and for running multiple tasks associated with a project.  (Like, for example, generating narrative documentation.)

Twisted is weird and puts its tox venvs in 'build/<envname>'; normally they're in '.tox/envname'. (see http://twistedmatrix.com/trac/ticket/9040).  You can find your venv in build/narrativedocs.

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170315/afa6be2f/attachment.html>

From romanmescheryakov at yandex.ru  Thu Mar 16 02:33:49 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Thu, 16 Mar 2017 11:33:49 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
 <4741489591703@web42g.yandex.ru>
 <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>
Message-ID: <2333441489653229@web34j.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170316/ee554a1c/attachment.html>

From romanmescheryakov at yandex.ru  Thu Mar 16 02:36:32 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Thu, 16 Mar 2017 11:36:32 +0300
Subject: [Twisted-Python] Bugs #8264 and #8037 seems to be duplicates
Message-ID: <2354741489653392@web34j.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170316/a0705f68/attachment.html>

From rodrigc at crodrigues.org  Thu Mar 16 03:26:12 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Thu, 16 Mar 2017 02:26:12 -0700
Subject: [Twisted-Python] =?utf-8?q?_Minor_fixes_in_the_=E2=80=9CCustomizi?=
	=?utf-8?q?ng_twistd_logging=E2=80=9D_section?=
In-Reply-To: <2333441489653229@web34j.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
 <4741489591703@web42g.yandex.ru>
 <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>
 <2333441489653229@web34j.yandex.ru>
Message-ID: <CAG=rPVdXktH+sUae1rx7iTB8_QiB5xqubQ0Ss-HhrWNZFxsAVA@mail.gmail.com>

On Thursday, March 16, 2017, ????? ????????? <romanmescheryakov at yandex.ru
<javascript:_e(%7B%7D,'cvml','romanmescheryakov at yandex.ru');>> wrote:

>
> OK, got it.
>
> Back to the subject of this e-mail, I created ticket #9084
> <https://twistedmatrix.com/trac/ticket/9084> and attached proposed fix to
> it. Of course, there are many newbie questions related to that:
>
>    1. Did I filled bug correctly?
>
>
I think the bug you filed is fine.

>
>    1. Is it right that I uploaded fix immediately to the just-created bug?
>
>
Instead of uploading the patch to Trac, it is preferred that you follow the
procedures here, even for a documentation patch.

http://twistedmatrix.com/trac/wiki/TwistedDevelopment#SubmittingaPatch

That includes all the steps for GitHub, Newsfile, setting the "review"
keyword on the Trac ticket, etc.

Thank you for your patience, and contributions to Twisted, especially for
the docs, which is important for new users

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170316/f24be302/attachment.html>

From glyph at twistedmatrix.com  Thu Mar 16 20:55:32 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 16 Mar 2017 19:55:32 -0700
Subject: [Twisted-Python] Bugs #8264 and #8037 seems to be duplicates
In-Reply-To: <2354741489653392@web34j.yandex.ru>
References: <2354741489653392@web34j.yandex.ru>
Message-ID: <0A2C651F-0D84-4509-AB4C-12AD4DC01DFB@twistedmatrix.com>

> On Mar 16, 2017, at 1:36 AM, ????? ????????? <romanmescheryakov at yandex.ru> wrote:
> 
>  
> Maybe one of them should be closed as duplicate:
>  
> #8264 <https://twistedmatrix.com/trac/ticket/8264> STDLibLoggingObserver doesn't log traceback from unhandled Deferred errors
> #8037 <https://twistedmatrix.com/trac/ticket/8037> STDLibLogObserver eats unhandled errors in Deferreds
>  
> -- 
> Kind regards, Roman Mescheryakov

I closed the latter as a duplicate.  Feel free to do this (with comments on both tickets, as you can see I put on those) if you find more dups :).

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170316/a401aba0/attachment.html>

From romanmescheryakov at yandex.ru  Fri Mar 17 03:18:01 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Fri, 17 Mar 2017 12:18:01 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <CAG=rPVdXktH+sUae1rx7iTB8_QiB5xqubQ0Ss-HhrWNZFxsAVA@mail.gmail.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
 <4741489591703@web42g.yandex.ru>
 <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>
 <2333441489653229@web34j.yandex.ru>
 <CAG=rPVdXktH+sUae1rx7iTB8_QiB5xqubQ0Ss-HhrWNZFxsAVA@mail.gmail.com>
Message-ID: <2629331489742281@web53g.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170317/a114caa2/attachment.html>

From trac at twistedmatrix.com  Sun Mar 19 00:05:18 2017
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 19 Mar 2017 06:05:18 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1489903518.52.5346141693720610651@twistedmatrix.com

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170319/158aa3ae/attachment.html>

From glyph at twistedmatrix.com  Fri Mar 24 22:14:27 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 24 Mar 2017 21:14:27 -0700
Subject: [Twisted-Python] in case there's downtime
Message-ID: <27D41B92-7262-4EC3-BA25-E537971221B2@twistedmatrix.com>

We've been very conservative about upgrading our operating system on twistedmatrix.com <http://twistedmatrix.com/>, since we don't want to disrupt anything.  Since our OS is one release too old to support Docker, that unfortunately means we haven't been able to migrate incrementally to containers, which creates a bit of a chicken-and-egg problem.

However, as we are days away from the end-of-life cliff for the operating system as a whole, and as I discovered a few minutes ago, dozens of packages are already unsupported and not receiving security updates, I'm going to upgrade the host OS manually, even if it results in some disruption.  As with the Twisted compatibility policy, security is a good enough reason to break stuff.

Maybe we'll even get a new version of Mailman that will let me turn automatic subscriptions back on while the star-crossed https://lists.twistedmatrix.com <https://lists.twistedmatrix.com/> project waits for someone else to help out :-).

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170324/ed618054/attachment.html>

From chris.norman2 at googlemail.com  Sat Mar 25 14:21:40 2017
From: chris.norman2 at googlemail.com (Chris Norman)
Date: Sat, 25 Mar 2017 20:21:40 +0000
Subject: [Twisted-Python] in case there's downtime
In-Reply-To: <27D41B92-7262-4EC3-BA25-E537971221B2@twistedmatrix.com>
References: <27D41B92-7262-4EC3-BA25-E537971221B2@twistedmatrix.com>
Message-ID: <a07d3c3f-3e01-f605-a45e-bf06e66e9358@GOOGLEMAIL.COM>

Hi,

What needs taking over on the mailing list side? I'd love to help out if 
possible.


Cheers,


On 25/03/2017 04:14, Glyph Lefkowitz wrote:
> We've been very conservative about upgrading our operating system on 
> twistedmatrix.com <http://twistedmatrix.com>, since we don't want to 
> disrupt anything.  Since our OS is one release too old to support 
> Docker, that unfortunately means we haven't been able to migrate 
> incrementally to containers, which creates a bit of a chicken-and-egg 
> problem.
>
> However, as we are days away from the end-of-life cliff for the 
> operating system as a whole, and as I discovered a few minutes ago, 
> dozens of packages are already unsupported and not receiving security 
> updates, I'm going to upgrade the host OS manually, even if it results 
> in some disruption.  As with the Twisted compatibility policy, 
> security is a good enough reason to break stuff.
>
> Maybe we'll even get a new version of Mailman that will let me turn 
> automatic subscriptions back on while the star-crossed 
> https://lists.twistedmatrix.com project waits for someone else to help 
> out :-).
>
> -glyph
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170325/f5e576e6/attachment.html>

From glyph at twistedmatrix.com  Sat Mar 25 15:01:01 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 25 Mar 2017 14:01:01 -0700
Subject: [Twisted-Python] in case there's downtime
In-Reply-To: <a07d3c3f-3e01-f605-a45e-bf06e66e9358@GOOGLEMAIL.COM>
References: <27D41B92-7262-4EC3-BA25-E537971221B2@twistedmatrix.com>
 <a07d3c3f-3e01-f605-a45e-bf06e66e9358@GOOGLEMAIL.COM>
Message-ID: <30546D75-070E-4F45-A262-525D769FFF35@twistedmatrix.com>


> On Mar 25, 2017, at 1:21 PM, Chris Norman <chris.norman2 at googlemail.com> wrote:
> 
> Hi,
> 
> What needs taking over on the mailing list side? I'd love to help out if possible.
> 

Hi Chris!

Thanks for volunteering.  If you'd like to help out with infrastructure _generally_, there's a channel on freenode, #twisted-admin, where you can show up to discuss what's going on.

As to mailing lists specifically; over a year ago now, I outlined a plan to migrate our mail infrastructure:

https://twistedmatrix.com/pipermail/twisted-python/2016-March/030189.html <https://twistedmatrix.com/pipermail/twisted-python/2016-March/030189.html>

Unfortunately, I never had nearly as much time to work on that as I'd thought I would; also, Mailgun is no longer a product of Rackspace; also, I no longer work at either Rackspace or Mailgun :).  There's also the issue that the service that https://github.com/twisted-infra/lists.twistedmatrix.com/ <https://github.com/twisted-infra/lists.twistedmatrix.com/> deploys to, Carina, is shutting down: https://getcarina.com <https://getcarina.com/>.  So we need to find a new place for it to migrate to if it's going to be a real thing.

However, the generous open-source discount that Mailgun offers to Twisted remains in place.

Originally, I'd been nervous about migrating twistedmatrix.com <http://twistedmatrix.com/> to Mailgun without having an alternate solution in place for mailing lists, because I didn't want to be blasting out any spam that we were generating via mailman and ruining our sender score there.  I was also under the impression that more of the domain-name configuration had to match up in Mailman than actually does; experiments during the latest OS upgrade indicate to me that it's a relatively small configuration change.

Disabling automatic subscriptions does seem to have mitigated that almost completely, and now we're on a recent enough OS that we'll get security updates for mailman, at least.  Plus, Mailgun will give me better visibility than I currently have if we are generating such bad messages.  As such I'll probably migrate our main mail delivery / forwarder pipeline to mailgun later today, allowing us to migrate individual addresses or lists to some other system rather than doing something all at once.

Users with @twistedmatrix.com email addresses will need to get an SMTP password token from me in order to be able to properly send outbound DKIM-signed messages.  I am pretty sure you all have alternate ways of reaching me :-).

If I manage to screw up mail routing so bad that you can't reach me via this mail address, by the way, and you need to report a problem after this move, you can send messages to mail-admin-315569 at glyph.im <mailto:mail-admin-315569 at glyph.im>.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170325/4423261f/attachment.html>

From glyph at twistedmatrix.com  Sat Mar 25 18:20:21 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 25 Mar 2017 17:20:21 -0700
Subject: [Twisted-Python] Is this turned on right now?
Message-ID: <AC31315D-5D25-467C-8AD4-3E7386DC1186@twistedmatrix.com>

The answer should be "no", I believe it will bounce.

-g


From glyph at twistedmatrix.com  Sat Mar 25 19:06:18 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 25 Mar 2017 18:06:18 -0700
Subject: [Twisted-Python] Is this turned on right now?
In-Reply-To: <AC31315D-5D25-467C-8AD4-3E7386DC1186@twistedmatrix.com>
References: <AC31315D-5D25-467C-8AD4-3E7386DC1186@twistedmatrix.com>
Message-ID: <D4067282-7E97-463F-9EDE-3A96531FA0E6@twistedmatrix.com>

> On Mar 25, 2017, at 5:20 PM, Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:
> 
> The answer should be "no", I believe it will bounce.

Oops! Mail delivery retries to the rescue :).

Aside from an extremely exciting hour where I accidentally created a suppression for my own address and could not test anything, this went reasonably smoothly.  (Those who might want to help us out with ops: we now exclusively use exim for routing messages to mailman, and maybe delivering some emails from Trac; it no longer sends messages to users.  So we could maybe make a Docker container out of that.)

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170325/522c3df2/attachment.html>

From trac at twistedmatrix.com  Sun Mar 26 00:05:20 2017
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 26 Mar 2017 06:05:20 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1490508320.36.5011797527353855320@twistedmatrix.com

An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170326/c3fb4cb6/attachment-0001.html>

From jamohamm at cisco.com  Mon Mar 27 03:33:13 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Mon, 27 Mar 2017 09:33:13 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
Message-ID: <D4FED790.297AAF%jamohamm@cisco.com>

Hi Team,

Wanted to bring one code changes which is really required from twisted side otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted is failing when we negotiate any kex algorithm based on SHA1 and we have MAC as hmac-sha2-512. The reason for the failure was the below code

hashProcessor = _kex.getHashProcessor(self.kexAlg)
        k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
        k1 = k1.digest()
        k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
return k1 + k2

For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it will only generate 40 byte key and that induce a failure. So we need to modify the code as below to make it generic and make it comply with RFC (rfc4253 Section 7.2). So that twisted can work irrespective of what kex is been used. Actual code should plot in is like below

hashProcessor = _kex.getHashProcessor(self.kexAlg)
        k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
        k1 = k1.digest()
        k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
return k1 + k2 + k3 + k4

Can somebody help me to plot this fix so that twisted will work fine with all the other servers out there and even make it comply to the RFC. Thanks in advance and this will be my first findings on twisted code ;). Please let me know in case of any doubt on the same. Code changes should be plotted in to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py . Please help me with this commit team.


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Wednesday, 1 March 2017 9:26 am
To: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>
Cc: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>
Subject: Re: Regarding the SHA 512 support in twisted.

This doesn't appear to be a security issue. You can file an issue on the public tracker.

Alex

On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm) <jamohamm at cisco.com<mailto:jamohamm at cisco.com>> wrote:

Thanks Alex for the response. In our server we added support of HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to negotiate this hmac with most of the other client like Paramiko, OpenSSH and other flavours of SSH its working fine. But we are seeing a problem with twisted client that too only with HMAC-SHA-512. We have a limitation from our side to debug this since we dont know what is happening from the client side. We have taken our derived key for the HMAC and as well as the input to derive the MAC using online tools and it matches with whatever we have generated but whatever is been sent across the other Twisted side differs and we are closing the session. This is been tagged critical since most of the customers are migrating to Twisted and will be a deployment blocker for us.

What we suspect is the key or the algorithm itself. Please see the snippet below

This is our inmac Key
----------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: inmac.key
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - a5 cb a5 bb 4c 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010<tel:0010> - 1c e1 3f d9 a7 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020<tel:0020> - 2a bc 53 c6 85 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030<tel:0030> - d9 a5 0e 73 d0 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p<http://s.Dy...2;&..p>

This is our input data to the hmac-sha-512
-----------------------------------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: input.data to HMAC API
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - 00 00 00 03 00 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010<tel:0010> - 68 2d 75 73 65 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020<tel:0020> - ba 7e 56 e5                                       .~V.

The digest which is been sent from the twisted client side(Red)
-----------------------------------------------------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: digest
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - 95 f7 99 27 48 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010<tel:0010> - 93 d1 4d 46 5f d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020<tel:0020> - 84 a9 58 60 5e 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030<tel:0030> - 4b 1d 05 2d a4 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[

The digest which got created from our side using the same key and input data mentioned above(Green)

RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000<tel:0000> - 36 36 5c 6e 2d be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010<tel:0010> - 0e e8 d6 96 6e 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020<tel:0020> - 7c c8 15 b8 5a 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030<tel:0030> - 32 63 61 5e f5 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.

If you see the details this is the useauth first packet and we are not able to proceed because of the failure. We used online tool to do this calculation and we are getting the same output as what we generated so the one marked as red is creating problem.So the root cause could be either the key which is been derived or the algorithm so to debug that we need to enable details logging from client side. We can share the details with respective engineer and show what we are facing. Please help.

Online tool which we used to check our algorithm is: which result in same MAC marked as green.

https://www.liavaag.org/English/SHA-Generator/HMAC/


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Wednesday, 1 March 2017 6:39 am
To: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>
Cc: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>
Subject: Re: FW: Regarding the SHA 512 support in twisted.

Hi,

I think I'm missing some context here, what part of twisted are you trying to use SHA-512 for a MAC with? It sounds like Conch? Can you show how I could reproduce the problem?

Alex

On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>> wrote:
Hi,

Forwarding on to security contact to see if they think it's a security problem; otherwise you can probably just file a normal ticket.


On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
Hi Team,


Wanted to cross check on SHA 512 algorithm as MAC while using twisted. Few of our customers started using Twisted and even we are trying to incorporate some scripts via twisted client. But what we have noticed is that when we negotiate SHA 512 MAC with twisted we always get a failure and other MAC algorithms are working fine with twisted. So wanted to cross check do we have any bug or any issue with SHA 512 and twisted and how we can debug this from twisted side.

We checked the same with other OpenSSH client and even paramiko things work perfectly fine so wanted to debug further from the twisted side. We checked with the same derived key and the output whatever we got from SHA 512 is what we are getting from the online tool so we suspect something to do with the key or hash algorithm from the other side.

We used the twisted 16.6.0 version for testing, thanks in advance for looking in to this email.



Thanks,

Jabir

     \|/

    -------

   (  o o  )

oooO---O---Oooonull



--
Itamar Turner-Trauring





--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6




--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170327/68a79938/attachment-0001.html>

From adi at roiban.ro  Mon Mar 27 04:36:47 2017
From: adi at roiban.ro (Adi Roiban)
Date: Mon, 27 Mar 2017 11:36:47 +0100
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <D4FED790.297AAF%jamohamm@cisco.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
Message-ID: <CAFycZ9cL5k=Hu-S0_ucaK_ZEjDtUMw822ZUmyqsGV2b1wZRwFg@mail.gmail.com>

Hi Jarib,

Thanks for the details.

On 27 March 2017 at 10:33, jabir Mohammed (jamohamm) <jamohamm at cisco.com> wrote:
> Hi Team,
>
> Wanted to bring one code changes which is really required from twisted side
> otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted is
> failing when we negotiate any kex algorithm based on SHA1 and we have MAC as
> hmac-sha2-512. The reason for the failure was the below code
>
> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>         k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
>         k1 = k1.digest()
>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
> return k1 + k2
>
> For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it will
> only generate 40 byte key and that induce a failure. So we need to modify
> the code as below to make it generic and make it comply with RFC (rfc4253
> Section 7.2). So that twisted can work irrespective of what kex is been
> used. Actual code should plot in is like below
>
> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>         k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
>         k1 = k1.digest()
>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
> k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
> k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
> return k1 + k2 + k3 + k4
>
> Can somebody help me to plot this fix so that twisted will work fine with
> all the other servers out there and even make it comply to the RFC. Thanks
> in advance and this will be my first findings on twisted code ;). Please let
> me know in case of any doubt on the same. Code changes should be plotted in
> to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py .
> Please help me with this commit team.

Happy to help.

Here should be the documentation for contributing  (hopefully is up to date)

http://twistedmatrix.com/trac/wiki/TwistedDevelopment

The first thing is to fork twisted/twisted, apply the change on the
branch and then create a PR.

By creating the PR, you will trigger some of the automated tests and
you can get a quick feedback.
.. for example to see if your changes are not introducing any regressions.

In an ideal world before making the changes and creating a simple
example so that we can manually check the changes you start by
updating the existing automated test to make sure that we don't
introduce regressions in the feature (as a non exhaustive list of
reasons)

You can use this file
https://github.com/twisted/twisted/blob/trunk/docs/conch/examples/sshsimpleserver.py
as the foundation for a simple example.
In the PR you can provide the client-side command use for the manual test

Looking forward for you PR.
I can help with the review and/or writing the automated tests.

You can also find me on #twisted-dev

Thanks,
Adi

> From: Alex Gaynor <alex.gaynor at gmail.com>
> Date: Wednesday, 1 March 2017 9:26 am
> To: jabir mohammed <jamohamm at cisco.com>
> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
> "security at twistedmatrix.com" <security at twistedmatrix.com>
> Subject: Re: Regarding the SHA 512 support in twisted.
>
> This doesn't appear to be a security issue. You can file an issue on the
> public tracker.
>
> Alex
>
> On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm)
> <jamohamm at cisco.com> wrote:
>>
>>
>> Thanks Alex for the response. In our server we added support of
>> HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to negotiate this
>> hmac with most of the other client like Paramiko, OpenSSH and other flavours
>> of SSH its working fine. But we are seeing a problem with twisted client
>> that too only with HMAC-SHA-512. We have a limitation from our side to debug
>> this since we dont know what is happening from the client side. We have
>> taken our derived key for the HMAC and as well as the input to derive the
>> MAC using online tools and it matches with whatever we have generated but
>> whatever is been sent across the other Twisted side differs and we are
>> closing the session. This is been tagged critical since most of the
>> customers are migrating to Twisted and will be a deployment blocker for us.
>>
>> What we suspect is the key or the algorithm itself. Please see the snippet
>> below
>>
>> This is our inmac Key
>> ----------------------------
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>> inmac.key
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - a5 cb a5 bb 4c
>> 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 1c e1 3f d9 a7
>> 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - 2a bc 53 c6 85
>> 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030 - d9 a5 0e 73 d0
>> 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p
>>
>> This is our input data to the hmac-sha-512
>> -----------------------------------------------------
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>> input.data to HMAC API
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 00 00 00 03 00
>> 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 68 2d 75 73 65
>> 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - ba 7e 56 e5
>> .~V.
>>
>> The digest which is been sent from the twisted client side(Red)
>> -----------------------------------------------------------------------
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>> digest
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 95 f7 99 27 48
>> 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 93 d1 4d 46 5f
>> d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 84 a9 58 60 5e
>> 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 4b 1d 05 2d a4
>> 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[
>>
>> The digest which got created from our side using the same key and input
>> data mentioned above(Green)
>> 
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000 - 36 36 5c 6e 2d
>> be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 0e e8 d6 96 6e
>> 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 7c c8 15 b8 5a
>> 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 32 63 61 5e f5
>> 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.
>>
>> If you see the details this is the useauth first packet and we are not
>> able to proceed because of the failure. We used online tool to do this
>> calculation and we are getting the same output as what we generated so the
>> one marked as red is creating problem.So the root cause could be either the
>> key which is been derived or the algorithm so to debug that we need to
>> enable details logging from client side. We can share the details with
>> respective engineer and show what we are facing. Please help.
>>
>> Online tool which we used to check our algorithm is: which result in same
>> MAC marked as green.
>>
>> https://www.liavaag.org/English/SHA-Generator/HMAC/
>>
>>
>> Thanks,
>>
>> Jabir
>>
>>      \|/
>>
>>     -------
>>
>>    (  o o  )
>>
>> oooO---O---Oooonull
>>
>>
>> From: Alex Gaynor <alex.gaynor at gmail.com>
>> Date: Wednesday, 1 March 2017 6:39 am
>> To: Itamar Turner-Trauring <itamar at itamarst.org>
>> Cc: jabir mohammed <jamohamm at cisco.com>, "security at twistedmatrix.com"
>> <security at twistedmatrix.com>
>> Subject: Re: FW: Regarding the SHA 512 support in twisted.
>>
>> Hi,
>>
>> I think I'm missing some context here, what part of twisted are you trying
>> to use SHA-512 for a MAC with? It sounds like Conch? Can you show how I
>> could reproduce the problem?
>>
>> Alex
>>
>> On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring
>> <itamar at itamarst.org> wrote:
>>>
>>> Hi,
>>>
>>> Forwarding on to security contact to see if they think it's a security
>>> problem; otherwise you can probably just file a normal ticket.
>>>
>>>
>>> On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
>>>
>>> Hi Team,
>>>
>>>
>>> Wanted to cross check on SHA 512 algorithm as MAC while using twisted.
>>> Few of our customers started using Twisted and even we are trying to
>>> incorporate some scripts via twisted client. But what we have noticed is
>>> that when we negotiate SHA 512 MAC with twisted we always get a failure and
>>> other MAC algorithms are working fine with twisted. So wanted to cross check
>>> do we have any bug or any issue with SHA 512 and twisted and how we can
>>> debug this from twisted side.
>>>
>>> We checked the same with other OpenSSH client and even paramiko things
>>> work perfectly fine so wanted to debug further from the twisted side. We
>>> checked with the same derived key and the output whatever we got from SHA
>>> 512 is what we are getting from the online tool so we suspect something to
>>> do with the key or hash algorithm from the other side.
>>>
>>> We used the twisted 16.6.0 version for testing, thanks in advance for
>>> looking in to this email.
>>>



-- 
Adi Roiban


From jamohamm at cisco.com  Mon Mar 27 05:07:41 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Mon, 27 Mar 2017 11:07:41 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAFRnB2X4MBj1cieSjMRmS-NW9kRcW1yRAPmCC49gm43waja-pA@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAFRnB2X4MBj1cieSjMRmS-NW9kRcW1yRAPmCC49gm43waja-pA@mail.gmail.com>
Message-ID: <D4FEEFD4.297C13%jamohamm@cisco.com>


Its a security issue even you are allowing a weaker key in case of 64 bytes deriving only 40 bytes. Let me know how we issue a tracker bug can you please guide me. Since dont want someone else to waist effort in debugging the same issue.


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Monday, 27 March 2017 4:34 pm
To: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>
Cc: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>, Twisted general discussion <twisted-python at twistedmatrix.com<mailto:twisted-python at twistedmatrix.com>>, "twisted-python-bounces at twistedmatrix.com<mailto:twisted-python-bounces at twistedmatrix.com>" <twisted-python-bounces at twistedmatrix.com<mailto:twisted-python-bounces at twistedmatrix.com>>
Subject: Re: Regarding the SHA 512 support in twisted.

This is not a security issue, so this address isn't the right place for this discussion. Please use the public twisted issue tracker.

Alex

On Mon, Mar 27, 2017 at 5:33 AM, jabir Mohammed (jamohamm) <jamohamm at cisco.com<mailto:jamohamm at cisco.com>> wrote:
Hi Team,

Wanted to bring one code changes which is really required from twisted side otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted is failing when we negotiate any kex algorithm based on SHA1 and we have MAC as hmac-sha2-512. The reason for the failure was the below code

hashProcessor = _kex.getHashProcessor(self.kexAlg)
        k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
        k1 = k1.digest()
        k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
return k1 + k2

For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it will only generate 40 byte key and that induce a failure. So we need to modify the code as below to make it generic and make it comply with RFC (rfc4253 Section 7.2). So that twisted can work irrespective of what kex is been used. Actual code should plot in is like below

hashProcessor = _kex.getHashProcessor(self.kexAlg)
        k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
        k1 = k1.digest()
        k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
return k1 + k2 + k3 + k4

Can somebody help me to plot this fix so that twisted will work fine with all the other servers out there and even make it comply to the RFC. Thanks in advance and this will be my first findings on twisted code ;). Please let me know in case of any doubt on the same. Code changes should be plotted in to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py . Please help me with this commit team.


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Wednesday, 1 March 2017 9:26 am
To: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>
Cc: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>
Subject: Re: Regarding the SHA 512 support in twisted.

This doesn't appear to be a security issue. You can file an issue on the public tracker.

Alex

On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm) <jamohamm at cisco.com<mailto:jamohamm at cisco.com>> wrote:

Thanks Alex for the response. In our server we added support of HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to negotiate this hmac with most of the other client like Paramiko, OpenSSH and other flavours of SSH its working fine. But we are seeing a problem with twisted client that too only with HMAC-SHA-512. We have a limitation from our side to debug this since we dont know what is happening from the client side. We have taken our derived key for the HMAC and as well as the input to derive the MAC using online tools and it matches with whatever we have generated but whatever is been sent across the other Twisted side differs and we are closing the session. This is been tagged critical since most of the customers are migrating to Twisted and will be a deployment blocker for us.

What we suspect is the key or the algorithm itself. Please see the snippet below

This is our inmac Key
----------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: inmac.key
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - a5 cb a5 bb 4c 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010<tel:0010> - 1c e1 3f d9 a7 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020<tel:0020> - 2a bc 53 c6 85 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030<tel:0030> - d9 a5 0e 73 d0 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p<http://s.Dy...2;&..p>

This is our input data to the hmac-sha-512
-----------------------------------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: input.data to HMAC API
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - 00 00 00 03 00 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010<tel:0010> - 68 2d 75 73 65 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020<tel:0020> - ba 7e 56 e5                                       .~V.

The digest which is been sent from the twisted client side(Red)
-----------------------------------------------------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: digest
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - 95 f7 99 27 48 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010<tel:0010> - 93 d1 4d 46 5f d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020<tel:0020> - 84 a9 58 60 5e 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030<tel:0030> - 4b 1d 05 2d a4 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[

The digest which got created from our side using the same key and input data mentioned above(Green)

RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000<tel:0000> - 36 36 5c 6e 2d be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010<tel:0010> - 0e e8 d6 96 6e 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020<tel:0020> - 7c c8 15 b8 5a 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030<tel:0030> - 32 63 61 5e f5 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.

If you see the details this is the useauth first packet and we are not able to proceed because of the failure. We used online tool to do this calculation and we are getting the same output as what we generated so the one marked as red is creating problem.So the root cause could be either the key which is been derived or the algorithm so to debug that we need to enable details logging from client side. We can share the details with respective engineer and show what we are facing. Please help.

Online tool which we used to check our algorithm is: which result in same MAC marked as green.

https://www.liavaag.org/English/SHA-Generator/HMAC/


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Wednesday, 1 March 2017 6:39 am
To: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>
Cc: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>
Subject: Re: FW: Regarding the SHA 512 support in twisted.

Hi,

I think I'm missing some context here, what part of twisted are you trying to use SHA-512 for a MAC with? It sounds like Conch? Can you show how I could reproduce the problem?

Alex

On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>> wrote:
Hi,

Forwarding on to security contact to see if they think it's a security problem; otherwise you can probably just file a normal ticket.


On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
Hi Team,


Wanted to cross check on SHA 512 algorithm as MAC while using twisted. Few of our customers started using Twisted and even we are trying to incorporate some scripts via twisted client. But what we have noticed is that when we negotiate SHA 512 MAC with twisted we always get a failure and other MAC algorithms are working fine with twisted. So wanted to cross check do we have any bug or any issue with SHA 512 and twisted and how we can debug this from twisted side.

We checked the same with other OpenSSH client and even paramiko things work perfectly fine so wanted to debug further from the twisted side. We checked with the same derived key and the output whatever we got from SHA 512 is what we are getting from the online tool so we suspect something to do with the key or hash algorithm from the other side.

We used the twisted 16.6.0 version for testing, thanks in advance for looking in to this email.



Thanks,

Jabir

     \|/

    -------

   (  o o  )

oooO---O---Oooonull



--
Itamar Turner-Trauring





--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6




--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6




--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170327/2cd6002b/attachment-0001.html>

From jamohamm at cisco.com  Mon Mar 27 05:11:10 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Mon, 27 Mar 2017 11:11:10 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAFycZ9cL5k=Hu-S0_ucaK_ZEjDtUMw822ZUmyqsGV2b1wZRwFg@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAFycZ9cL5k=Hu-S0_ucaK_ZEjDtUMw822ZUmyqsGV2b1wZRwFg@mail.gmail.com>
Message-ID: <D4FEF0BB.297C27%jamohamm@cisco.com>

No probs Adi, can you help me to upload the fix to the twisted since I
dont know the procedure, if you can guide me that helps. Since I was
pretty sure that this a bug in coding twisted set keys part and not comply
to RFC.


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull




On 27/03/17 4:06 pm, "Twisted-Python on behalf of Adi Roiban"
<twisted-python-bounces at twistedmatrix.com on behalf of adi at roiban.ro>
wrote:

>Hi Jarib,
>
>Thanks for the details.
>
>On 27 March 2017 at 10:33, jabir Mohammed (jamohamm) <jamohamm at cisco.com>
>wrote:
>> Hi Team,
>>
>> Wanted to bring one code changes which is really required from twisted
>>side
>> otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted
>>is
>> failing when we negotiate any kex algorithm based on SHA1 and we have
>>MAC as
>> hmac-sha2-512. The reason for the failure was the below code
>>
>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>>self.sessionID)
>>         k1 = k1.digest()
>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>> return k1 + k2
>>
>> For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it
>>will
>> only generate 40 byte key and that induce a failure. So we need to
>>modify
>> the code as below to make it generic and make it comply with RFC
>>(rfc4253
>> Section 7.2). So that twisted can work irrespective of what kex is been
>> used. Actual code should plot in is like below
>>
>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>>self.sessionID)
>>         k1 = k1.digest()
>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>> k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
>> k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
>> return k1 + k2 + k3 + k4
>>
>> Can somebody help me to plot this fix so that twisted will work fine
>>with
>> all the other servers out there and even make it comply to the RFC.
>>Thanks
>> in advance and this will be my first findings on twisted code ;).
>>Please let
>> me know in case of any doubt on the same. Code changes should be
>>plotted in
>> to  the routine _getKey,  file name is
>>src/twisted/conch/ssh/transport.py .
>> Please help me with this commit team.
>
>Happy to help.
>
>Here should be the documentation for contributing  (hopefully is up to
>date)
>
>http://twistedmatrix.com/trac/wiki/TwistedDevelopment
>
>The first thing is to fork twisted/twisted, apply the change on the
>branch and then create a PR.
>
>By creating the PR, you will trigger some of the automated tests and
>you can get a quick feedback.
>.. for example to see if your changes are not introducing any regressions.
>
>In an ideal world before making the changes and creating a simple
>example so that we can manually check the changes you start by
>updating the existing automated test to make sure that we don't
>introduce regressions in the feature (as a non exhaustive list of
>reasons)
>
>You can use this file
>https://github.com/twisted/twisted/blob/trunk/docs/conch/examples/sshsimpl
>eserver.py
>as the foundation for a simple example.
>In the PR you can provide the client-side command use for the manual test
>
>Looking forward for you PR.
>I can help with the review and/or writing the automated tests.
>
>You can also find me on #twisted-dev
>
>Thanks,
>Adi
>
>> From: Alex Gaynor <alex.gaynor at gmail.com>
>> Date: Wednesday, 1 March 2017 9:26 am
>> To: jabir mohammed <jamohamm at cisco.com>
>> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
>> "security at twistedmatrix.com" <security at twistedmatrix.com>
>> Subject: Re: Regarding the SHA 512 support in twisted.
>>
>> This doesn't appear to be a security issue. You can file an issue on the
>> public tracker.
>>
>> Alex
>>
>> On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm)
>> <jamohamm at cisco.com> wrote:
>>>
>>>
>>> Thanks Alex for the response. In our server we added support of
>>> HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to
>>>negotiate this
>>> hmac with most of the other client like Paramiko, OpenSSH and other
>>>flavours
>>> of SSH its working fine. But we are seeing a problem with twisted
>>>client
>>> that too only with HMAC-SHA-512. We have a limitation from our side to
>>>debug
>>> this since we dont know what is happening from the client side. We
>>>have
>>> taken our derived key for the HMAC and as well as the input to derive
>>>the
>>> MAC using online tools and it matches with whatever we have generated
>>>but
>>> whatever is been sent across the other Twisted side differs and we are
>>> closing the session. This is been tagged critical since most of the
>>> customers are migrating to Twisted and will be a deployment blocker
>>>for us.
>>>
>>> What we suspect is the key or the algorithm itself. Please see the
>>>snippet
>>> below
>>>
>>> This is our inmac Key
>>> ----------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> inmac.key
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - a5 cb a5 bb
>>>4c
>>> 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 1c e1 3f d9
>>>a7
>>> 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - 2a bc 53 c6
>>>85
>>> 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030 - d9 a5 0e 73
>>>d0
>>> 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p
>>>
>>> This is our input data to the hmac-sha-512
>>> -----------------------------------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> input.data to HMAC API
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 00 00 00 03
>>>00
>>> 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 68 2d 75 73
>>>65
>>> 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - ba 7e 56 e5
>>> .~V.
>>>
>>> The digest which is been sent from the twisted client side(Red)
>>> -----------------------------------------------------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> digest
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 95 f7 99 27
>>>48
>>> 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 93 d1 4d 46
>>>5f
>>> d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 84 a9 58 60
>>>5e
>>> 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 4b 1d 05 2d
>>>a4
>>> 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[
>>>
>>> The digest which got created from our side using the same key and input
>>> data mentioned above(Green)
>>> 
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000 - 36 36 5c 6e
>>>2d
>>> be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 0e e8 d6 96
>>>6e
>>> 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 7c c8 15 b8
>>>5a
>>> 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 32 63 61 5e
>>>f5
>>> 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.
>>>
>>> If you see the details this is the useauth first packet and we are not
>>> able to proceed because of the failure. We used online tool to do this
>>> calculation and we are getting the same output as what we generated so
>>>the
>>> one marked as red is creating problem.So the root cause could be
>>>either the
>>> key which is been derived or the algorithm so to debug that we need to
>>> enable details logging from client side. We can share the details with
>>> respective engineer and show what we are facing. Please help.
>>>
>>> Online tool which we used to check our algorithm is: which result in
>>>same
>>> MAC marked as green.
>>>
>>> https://www.liavaag.org/English/SHA-Generator/HMAC/
>>>
>>>
>>> Thanks,
>>>
>>> Jabir
>>>
>>>      \|/
>>>
>>>     -------
>>>
>>>    (  o o  )
>>>
>>> oooO---O---Oooonull
>>>
>>>
>>> From: Alex Gaynor <alex.gaynor at gmail.com>
>>> Date: Wednesday, 1 March 2017 6:39 am
>>> To: Itamar Turner-Trauring <itamar at itamarst.org>
>>> Cc: jabir mohammed <jamohamm at cisco.com>, "security at twistedmatrix.com"
>>> <security at twistedmatrix.com>
>>> Subject: Re: FW: Regarding the SHA 512 support in twisted.
>>>
>>> Hi,
>>>
>>> I think I'm missing some context here, what part of twisted are you
>>>trying
>>> to use SHA-512 for a MAC with? It sounds like Conch? Can you show how I
>>> could reproduce the problem?
>>>
>>> Alex
>>>
>>> On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring
>>> <itamar at itamarst.org> wrote:
>>>>
>>>> Hi,
>>>>
>>>> Forwarding on to security contact to see if they think it's a security
>>>> problem; otherwise you can probably just file a normal ticket.
>>>>
>>>>
>>>> On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
>>>>
>>>> Hi Team,
>>>>
>>>>
>>>> Wanted to cross check on SHA 512 algorithm as MAC while using twisted.
>>>> Few of our customers started using Twisted and even we are trying to
>>>> incorporate some scripts via twisted client. But what we have noticed
>>>>is
>>>> that when we negotiate SHA 512 MAC with twisted we always get a
>>>>failure and
>>>> other MAC algorithms are working fine with twisted. So wanted to
>>>>cross check
>>>> do we have any bug or any issue with SHA 512 and twisted and how we
>>>>can
>>>> debug this from twisted side.
>>>>
>>>> We checked the same with other OpenSSH client and even paramiko things
>>>> work perfectly fine so wanted to debug further from the twisted side.
>>>>We
>>>> checked with the same derived key and the output whatever we got from
>>>>SHA
>>>> 512 is what we are getting from the online tool so we suspect
>>>>something to
>>>> do with the key or hash algorithm from the other side.
>>>>
>>>> We used the twisted 16.6.0 version for testing, thanks in advance for
>>>> looking in to this email.
>>>>
>
>
>
>-- 
>Adi Roiban
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


From adi at roiban.ro  Mon Mar 27 07:15:51 2017
From: adi at roiban.ro (Adi Roiban)
Date: Mon, 27 Mar 2017 14:15:51 +0100
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <D4FEEFD4.297C13%jamohamm@cisco.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAFRnB2X4MBj1cieSjMRmS-NW9kRcW1yRAPmCC49gm43waja-pA@mail.gmail.com>
 <D4FEEFD4.297C13%jamohamm@cisco.com>
Message-ID: <CAFycZ9dJH5D3ukSRA42XDkF2p6dyhzzuJQU8095Rv=eU4ZFUsw@mail.gmail.com>

On 27 March 2017 at 12:07, jabir Mohammed (jamohamm) <jamohamm at cisco.com> wrote:
>
> Its a security issue even you are allowing a weaker key in case of 64 bytes
> deriving only 40 bytes. Let me know how we issue a tracker bug can you
> please guide me. Since dont want someone else to waist effort in debugging
> the same issue.

Hi Jabir and sorry for the previous misspelling!

There are a few existing bug reports for KEX related tasks...some are
server side, some are client side

https://twistedmatrix.com/trac/search?q=kex

I think that your bug was already reported (by my) at
https://twistedmatrix.com/trac/ticket/8258

---------

Regarding the help with this patch.

What have you tried so far?
Where are you stuck?
Where/ with what specifically do you need help?



Thanks!

>
> Thanks,
>
> Jabir
>
>      \|/
>
>     -------
>
>    (  o o  )
>
> oooO---O---Oooonull
>
>
> From: Alex Gaynor <alex.gaynor at gmail.com>
> Date: Monday, 27 March 2017 4:34 pm
> To: jabir mohammed <jamohamm at cisco.com>
> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
> "security at twistedmatrix.com" <security at twistedmatrix.com>, Twisted general
> discussion <twisted-python at twistedmatrix.com>,
> "twisted-python-bounces at twistedmatrix.com"
> <twisted-python-bounces at twistedmatrix.com>
> Subject: Re: Regarding the SHA 512 support in twisted.
>
> This is not a security issue, so this address isn't the right place for this
> discussion. Please use the public twisted issue tracker.
>
> Alex
>
> On Mon, Mar 27, 2017 at 5:33 AM, jabir Mohammed (jamohamm)
> <jamohamm at cisco.com> wrote:
>>
>> Hi Team,
>>
>> Wanted to bring one code changes which is really required from twisted
>> side otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted
>> is failing when we negotiate any kex algorithm based on SHA1 and we have MAC
>> as hmac-sha2-512. The reason for the failure was the below code
>>
>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>> self.sessionID)
>>         k1 = k1.digest()
>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>> return k1 + k2
>>
>> For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it
>> will only generate 40 byte key and that induce a failure. So we need to
>> modify the code as below to make it generic and make it comply with RFC
>> (rfc4253 Section 7.2). So that twisted can work irrespective of what kex is
>> been used. Actual code should plot in is like below
>>
>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>> self.sessionID)
>>         k1 = k1.digest()
>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>> k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
>> k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
>> return k1 + k2 + k3 + k4
>>
>> Can somebody help me to plot this fix so that twisted will work fine with
>> all the other servers out there and even make it comply to the RFC. Thanks
>> in advance and this will be my first findings on twisted code ;). Please let
>> me know in case of any doubt on the same. Code changes should be plotted in
>> to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py .
>> Please help me with this commit team.
>>
>>
>> Thanks,
>>
>> Jabir
>>
>>      \|/
>>
>>     -------
>>
>>    (  o o  )
>>
>> oooO---O---Oooonull
>>
>>
>> From: Alex Gaynor <alex.gaynor at gmail.com>
>> Date: Wednesday, 1 March 2017 9:26 am
>> To: jabir mohammed <jamohamm at cisco.com>
>> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
>> "security at twistedmatrix.com" <security at twistedmatrix.com>
>> Subject: Re: Regarding the SHA 512 support in twisted.
>>
>> This doesn't appear to be a security issue. You can file an issue on the
>> public tracker.
>>
>> Alex
>>
>> On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm)
>> <jamohamm at cisco.com> wrote:
>>>
>>>
>>> Thanks Alex for the response. In our server we added support of
>>> HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to negotiate this
>>> hmac with most of the other client like Paramiko, OpenSSH and other flavours
>>> of SSH its working fine. But we are seeing a problem with twisted client
>>> that too only with HMAC-SHA-512. We have a limitation from our side to debug
>>> this since we dont know what is happening from the client side. We have
>>> taken our derived key for the HMAC and as well as the input to derive the
>>> MAC using online tools and it matches with whatever we have generated but
>>> whatever is been sent across the other Twisted side differs and we are
>>> closing the session. This is been tagged critical since most of the
>>> customers are migrating to Twisted and will be a deployment blocker for us.
>>>
>>> What we suspect is the key or the algorithm itself. Please see the
>>> snippet below
>>>
>>> This is our inmac Key
>>> ----------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> inmac.key
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - a5 cb a5 bb 4c
>>> 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 1c e1 3f d9 a7
>>> 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - 2a bc 53 c6 85
>>> 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030 - d9 a5 0e 73 d0
>>> 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p
>>>
>>> This is our input data to the hmac-sha-512
>>> -----------------------------------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> input.data to HMAC API
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 00 00 00 03 00
>>> 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 68 2d 75 73 65
>>> 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - ba 7e 56 e5
>>> .~V.
>>>
>>> The digest which is been sent from the twisted client side(Red)
>>> -----------------------------------------------------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> digest
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 95 f7 99 27 48
>>> 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 93 d1 4d 46 5f
>>> d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 84 a9 58 60 5e
>>> 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 4b 1d 05 2d a4
>>> 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[
>>>
>>> The digest which got created from our side using the same key and input
>>> data mentioned above(Green)
>>> 
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000 - 36 36 5c 6e 2d
>>> be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 0e e8 d6 96 6e
>>> 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 7c c8 15 b8 5a
>>> 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 32 63 61 5e f5
>>> 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.
>>>
>>> If you see the details this is the useauth first packet and we are not
>>> able to proceed because of the failure. We used online tool to do this
>>> calculation and we are getting the same output as what we generated so the
>>> one marked as red is creating problem.So the root cause could be either the
>>> key which is been derived or the algorithm so to debug that we need to
>>> enable details logging from client side. We can share the details with
>>> respective engineer and show what we are facing. Please help.
>>>
>>> Online tool which we used to check our algorithm is: which result in same
>>> MAC marked as green.
>>>
>>> https://www.liavaag.org/English/SHA-Generator/HMAC/
>>>
>>>
>>> Thanks,
>>>
>>> Jabir
>>>
>>>      \|/
>>>
>>>     -------
>>>
>>>    (  o o  )
>>>
>>> oooO---O---Oooonull
>>>
>>>
>>> From: Alex Gaynor <alex.gaynor at gmail.com>
>>> Date: Wednesday, 1 March 2017 6:39 am
>>> To: Itamar Turner-Trauring <itamar at itamarst.org>
>>> Cc: jabir mohammed <jamohamm at cisco.com>, "security at twistedmatrix.com"
>>> <security at twistedmatrix.com>
>>> Subject: Re: FW: Regarding the SHA 512 support in twisted.
>>>
>>> Hi,
>>>
>>> I think I'm missing some context here, what part of twisted are you
>>> trying to use SHA-512 for a MAC with? It sounds like Conch? Can you show how
>>> I could reproduce the problem?
>>>
>>> Alex
>>>
>>> On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring
>>> <itamar at itamarst.org> wrote:
>>>>
>>>> Hi,
>>>>
>>>> Forwarding on to security contact to see if they think it's a security
>>>> problem; otherwise you can probably just file a normal ticket.
>>>>
>>>>
>>>> On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
>>>>
>>>> Hi Team,
>>>>
>>>>
>>>> Wanted to cross check on SHA 512 algorithm as MAC while using twisted.
>>>> Few of our customers started using Twisted and even we are trying to
>>>> incorporate some scripts via twisted client. But what we have noticed is
>>>> that when we negotiate SHA 512 MAC with twisted we always get a failure and
>>>> other MAC algorithms are working fine with twisted. So wanted to cross check
>>>> do we have any bug or any issue with SHA 512 and twisted and how we can
>>>> debug this from twisted side.
>>>>
>>>> We checked the same with other OpenSSH client and even paramiko things
>>>> work perfectly fine so wanted to debug further from the twisted side. We
>>>> checked with the same derived key and the output whatever we got from SHA
>>>> 512 is what we are getting from the online tool so we suspect something to
>>>> do with the key or hash algorithm from the other side.
>>>>
>>>> We used the twisted 16.6.0 version for testing, thanks in advance for
>>>> looking in to this email.
>>>>
>>>>
>>>> Thanks,
>>>>
>>>> Jabir
>>>>
>>>>      \|/
>>>>
>>>>     -------
>>>>
>>>>    (  o o  )
>>>>
>>>> oooO---O---Oooonull
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Itamar Turner-Trauring
>>>>
>>>>
>>>
>>>
>>>
>>> --
>>> "I disapprove of what you say, but I will defend to the death your right
>>> to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>>> "The people's good is the highest law." -- Cicero
>>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>>
>>
>>
>>
>> --
>> "I disapprove of what you say, but I will defend to the death your right
>> to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>> "The people's good is the highest law." -- Cicero
>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>
>
>
>
> --
> "I disapprove of what you say, but I will defend to the death your right to
> say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
> "The people's good is the highest law." -- Cicero
> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



-- 
Adi Roiban


From jamohamm at cisco.com  Mon Mar 27 09:29:30 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Mon, 27 Mar 2017 15:29:30 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAFycZ9dJH5D3ukSRA42XDkF2p6dyhzzuJQU8095Rv=eU4ZFUsw@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAFRnB2X4MBj1cieSjMRmS-NW9kRcW1yRAPmCC49gm43waja-pA@mail.gmail.com>
 <D4FEEFD4.297C13%jamohamm@cisco.com>
 <CAFycZ9dJH5D3ukSRA42XDkF2p6dyhzzuJQU8095Rv=eU4ZFUsw@mail.gmail.com>
Message-ID: <D4FF2CBA.297D89%jamohamm@cisco.com>

Please see inline comments [[>> Jamohamm: <<]]. Thanks for the response
team.

Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull




On 27/03/17 6:45 pm, "Twisted-Python on behalf of Adi Roiban"
<twisted-python-bounces at twistedmatrix.com on behalf of adi at roiban.ro>
wrote:

>On 27 March 2017 at 12:07, jabir Mohammed (jamohamm) <jamohamm at cisco.com>
>wrote:
>>
>> Its a security issue even you are allowing a weaker key in case of 64
>>bytes
>> deriving only 40 bytes. Let me know how we issue a tracker bug can you
>> please guide me. Since dont want someone else to waist effort in
>>debugging
>> the same issue.
>
>Hi Jabir and sorry for the previous misspelling!
>
>There are a few existing bug reports for KEX related tasks...some are
>server side, some are client side
>
>https://twistedmatrix.com/trac/search?q=kex
>
>I think that your bug was already reported (by my) at
>https://twistedmatrix.com/trac/ticket/8258

[[>> Jamohamm: So this is the bug which is tracking the issue, sounds good
but its 12 months old but still nobody fixed this interesting. <<]]

>
>---------
>
>Regarding the help with this patch.
>
>What have you tried so far?

[[>> Jamohamm: We recompiled the twisted SSH client code with the fix and
it working fine with OpenSSH server and our server as well, so wanted to
plot the fix in next maintenance release of twisted. <<]]

>Where are you stuck?

[[>> Jamohamm: Since I didnt get any response from the community we
debugged and figured out the issue with coding in twisted SSH client code.
So as of now I am not stuck and we are good with twisted SSH client and
its working fine with this fix. <<]]

>Where/ with what specifically do you need help?

[[>> Jamohamm: Can we upload the fix and get it committed to twisted,
someone can help me with that. <<]]
>
>
>
>Thanks!
>
>>
>> Thanks,
>>
>> Jabir
>>
>>      \|/
>>
>>     -------
>>
>>    (  o o  )
>>
>> oooO---O---Oooonull
>>
>>
>> From: Alex Gaynor <alex.gaynor at gmail.com>
>> Date: Monday, 27 March 2017 4:34 pm
>> To: jabir mohammed <jamohamm at cisco.com>
>> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
>> "security at twistedmatrix.com" <security at twistedmatrix.com>, Twisted
>>general
>> discussion <twisted-python at twistedmatrix.com>,
>> "twisted-python-bounces at twistedmatrix.com"
>> <twisted-python-bounces at twistedmatrix.com>
>> Subject: Re: Regarding the SHA 512 support in twisted.
>>
>> This is not a security issue, so this address isn't the right place for
>>this
>> discussion. Please use the public twisted issue tracker.
>>
>> Alex
>>
>> On Mon, Mar 27, 2017 at 5:33 AM, jabir Mohammed (jamohamm)
>> <jamohamm at cisco.com> wrote:
>>>
>>> Hi Team,
>>>
>>> Wanted to bring one code changes which is really required from twisted
>>> side otherwise it is not behaving  as per RFC (rfc4253 Section 7.2),
>>>twisted
>>> is failing when we negotiate any kex algorithm based on SHA1 and we
>>>have MAC
>>> as hmac-sha2-512. The reason for the failure was the below code
>>>
>>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>>> self.sessionID)
>>>         k1 = k1.digest()
>>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>>> return k1 + k2
>>>
>>> For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it
>>> will only generate 40 byte key and that induce a failure. So we need to
>>> modify the code as below to make it generic and make it comply with RFC
>>> (rfc4253 Section 7.2). So that twisted can work irrespective of what
>>>kex is
>>> been used. Actual code should plot in is like below
>>>
>>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>>> self.sessionID)
>>>         k1 = k1.digest()
>>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>>> k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
>>> k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
>>> return k1 + k2 + k3 + k4
>>>
>>> Can somebody help me to plot this fix so that twisted will work fine
>>>with
>>> all the other servers out there and even make it comply to the RFC.
>>>Thanks
>>> in advance and this will be my first findings on twisted code ;).
>>>Please let
>>> me know in case of any doubt on the same. Code changes should be
>>>plotted in
>>> to  the routine _getKey,  file name is
>>>src/twisted/conch/ssh/transport.py .
>>> Please help me with this commit team.
>>>
>>>
>>> Thanks,
>>>
>>> Jabir
>>>
>>>      \|/
>>>
>>>     -------
>>>
>>>    (  o o  )
>>>
>>> oooO---O---Oooonull
>>>
>>>
>>> From: Alex Gaynor <alex.gaynor at gmail.com>
>>> Date: Wednesday, 1 March 2017 9:26 am
>>> To: jabir mohammed <jamohamm at cisco.com>
>>> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
>>> "security at twistedmatrix.com" <security at twistedmatrix.com>
>>> Subject: Re: Regarding the SHA 512 support in twisted.
>>>
>>> This doesn't appear to be a security issue. You can file an issue on
>>>the
>>> public tracker.
>>>
>>> Alex
>>>
>>> On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm)
>>> <jamohamm at cisco.com> wrote:
>>>>
>>>>
>>>> Thanks Alex for the response. In our server we added support of
>>>> HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to
>>>>negotiate this
>>>> hmac with most of the other client like Paramiko, OpenSSH and other
>>>>flavours
>>>> of SSH its working fine. But we are seeing a problem with twisted
>>>>client
>>>> that too only with HMAC-SHA-512. We have a limitation from our side
>>>>to debug
>>>> this since we dont know what is happening from the client side. We
>>>>have
>>>> taken our derived key for the HMAC and as well as the input to derive
>>>>the
>>>> MAC using online tools and it matches with whatever we have generated
>>>>but
>>>> whatever is been sent across the other Twisted side differs and we are
>>>> closing the session. This is been tagged critical since most of the
>>>> customers are migrating to Twisted and will be a deployment blocker
>>>>for us.
>>>>
>>>> What we suspect is the key or the algorithm itself. Please see the
>>>> snippet below
>>>>
>>>> This is our inmac Key
>>>> ----------------------------
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]:
>>>>ssh_integrity_check:
>>>> inmac.key
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - a5 cb a5 bb
>>>>4c
>>>> 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 1c e1 3f d9
>>>>a7
>>>> 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - 2a bc 53 c6
>>>>85
>>>> 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030 - d9 a5 0e 73
>>>>d0
>>>> 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p
>>>>
>>>> This is our input data to the hmac-sha-512
>>>> -----------------------------------------------------
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]:
>>>>ssh_integrity_check:
>>>> input.data to HMAC API
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 00 00 00 03
>>>>00
>>>> 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 68 2d 75 73
>>>>65
>>>> 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - ba 7e 56 e5
>>>> .~V.
>>>>
>>>> The digest which is been sent from the twisted client side(Red)
>>>> 
>>>>-----------------------------------------------------------------------
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]:
>>>>ssh_integrity_check:
>>>> digest
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 95 f7 99 27
>>>>48
>>>> 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 93 d1 4d 46
>>>>5f
>>>> d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 84 a9 58 60
>>>>5e
>>>> 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 4b 1d 05 2d
>>>>a4
>>>> 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[
>>>>
>>>> The digest which got created from our side using the same key and
>>>>input
>>>> data mentioned above(Green)
>>>> 
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000 - 36 36 5c 6e
>>>>2d
>>>> be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 0e e8 d6 96
>>>>6e
>>>> 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 7c c8 15 b8
>>>>5a
>>>> 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 32 63 61 5e
>>>>f5
>>>> 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.
>>>>
>>>> If you see the details this is the useauth first packet and we are not
>>>> able to proceed because of the failure. We used online tool to do this
>>>> calculation and we are getting the same output as what we generated
>>>>so the
>>>> one marked as red is creating problem.So the root cause could be
>>>>either the
>>>> key which is been derived or the algorithm so to debug that we need to
>>>> enable details logging from client side. We can share the details with
>>>> respective engineer and show what we are facing. Please help.
>>>>
>>>> Online tool which we used to check our algorithm is: which result in
>>>>same
>>>> MAC marked as green.
>>>>
>>>> https://www.liavaag.org/English/SHA-Generator/HMAC/
>>>>
>>>>
>>>> Thanks,
>>>>
>>>> Jabir
>>>>
>>>>      \|/
>>>>
>>>>     -------
>>>>
>>>>    (  o o  )
>>>>
>>>> oooO---O---Oooonull
>>>>
>>>>
>>>> From: Alex Gaynor <alex.gaynor at gmail.com>
>>>> Date: Wednesday, 1 March 2017 6:39 am
>>>> To: Itamar Turner-Trauring <itamar at itamarst.org>
>>>> Cc: jabir mohammed <jamohamm at cisco.com>, "security at twistedmatrix.com"
>>>> <security at twistedmatrix.com>
>>>> Subject: Re: FW: Regarding the SHA 512 support in twisted.
>>>>
>>>> Hi,
>>>>
>>>> I think I'm missing some context here, what part of twisted are you
>>>> trying to use SHA-512 for a MAC with? It sounds like Conch? Can you
>>>>show how
>>>> I could reproduce the problem?
>>>>
>>>> Alex
>>>>
>>>> On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring
>>>> <itamar at itamarst.org> wrote:
>>>>>
>>>>> Hi,
>>>>>
>>>>> Forwarding on to security contact to see if they think it's a
>>>>>security
>>>>> problem; otherwise you can probably just file a normal ticket.
>>>>>
>>>>>
>>>>> On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
>>>>>
>>>>> Hi Team,
>>>>>
>>>>>
>>>>> Wanted to cross check on SHA 512 algorithm as MAC while using
>>>>>twisted.
>>>>> Few of our customers started using Twisted and even we are trying to
>>>>> incorporate some scripts via twisted client. But what we have
>>>>>noticed is
>>>>> that when we negotiate SHA 512 MAC with twisted we always get a
>>>>>failure and
>>>>> other MAC algorithms are working fine with twisted. So wanted to
>>>>>cross check
>>>>> do we have any bug or any issue with SHA 512 and twisted and how we
>>>>>can
>>>>> debug this from twisted side.
>>>>>
>>>>> We checked the same with other OpenSSH client and even paramiko
>>>>>things
>>>>> work perfectly fine so wanted to debug further from the twisted
>>>>>side. We
>>>>> checked with the same derived key and the output whatever we got
>>>>>from SHA
>>>>> 512 is what we are getting from the online tool so we suspect
>>>>>something to
>>>>> do with the key or hash algorithm from the other side.
>>>>>
>>>>> We used the twisted 16.6.0 version for testing, thanks in advance for
>>>>> looking in to this email.
>>>>>
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Jabir
>>>>>
>>>>>      \|/
>>>>>
>>>>>     -------
>>>>>
>>>>>    (  o o  )
>>>>>
>>>>> oooO---O---Oooonull
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Itamar Turner-Trauring
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> "I disapprove of what you say, but I will defend to the death your
>>>>right
>>>> to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>>>> "The people's good is the highest law." -- Cicero
>>>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>>>
>>>
>>>
>>>
>>> --
>>> "I disapprove of what you say, but I will defend to the death your
>>>right
>>> to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>>> "The people's good is the highest law." -- Cicero
>>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>>
>>
>>
>>
>> --
>> "I disapprove of what you say, but I will defend to the death your
>>right to
>> say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>> "The people's good is the highest law." -- Cicero
>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>
>
>
>-- 
>Adi Roiban
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


From rodrigc at crodrigues.org  Mon Mar 27 10:08:27 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Mon, 27 Mar 2017 09:08:27 -0700
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <D4FED790.297AAF%jamohamm@cisco.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
Message-ID: <CAG=rPVc5T0FNv0u5Jcx+M+Cei9W5eO+=8oiwHcBx+KB4rRr1tQ@mail.gmail.com>

On Mon, Mar 27, 2017 at 2:33 AM, jabir Mohammed (jamohamm) <
jamohamm at cisco.com> wrote:

>
> Can somebody help me to plot this fix so that twisted will work fine with
> all the other servers out there and even make it comply to the RFC. Thanks
> in advance and this will be my first findings on twisted code ;). Please
> let me know in case of any doubt on the same. Code changes should be
> plotted in to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py
> . Please help me with this commit team.
>
>
You need to follow the procedure at:

https://twistedmatrix.com/trac/wiki/TwistedDevelopment#SubmittingaPatch

That will give you all the details you need about filing a new ticket in
Trac,
forking the repository on GitHub, doing a GitHub pull request, etc.

If you need more help, you should ask Einar Floystad Dorum, who works at
Cisco and has filed multiple Conch patches
for Twisted:
https://github.com/twisted/twisted/pulls?q=is%3Apr+author%3Aeinarfd+is%3Aclosed

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170327/3c98417e/attachment.html>

From jamohamm at cisco.com  Mon Mar 27 22:12:37 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Tue, 28 Mar 2017 04:12:37 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAG=rPVc5T0FNv0u5Jcx+M+Cei9W5eO+=8oiwHcBx+KB4rRr1tQ@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAG=rPVc5T0FNv0u5Jcx+M+Cei9W5eO+=8oiwHcBx+KB4rRr1tQ@mail.gmail.com>
Message-ID: <D4FFE080.297E8E%jamohamm@cisco.com>


Thanks Craig shall follow up.

Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: <crodr001 at gmail.com<mailto:crodr001 at gmail.com>> on behalf of Craig Rodrigues <rodrigc at crodrigues.org<mailto:rodrigc at crodrigues.org>>
Date: Monday, 27 March 2017 9:38 pm
To: Twisted general discussion <twisted-python at twistedmatrix.com<mailto:twisted-python at twistedmatrix.com>>
Cc: "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>, "twisted-python-bounces at twistedmatrix.com<mailto:twisted-python-bounces at twistedmatrix.com>" <twisted-python-bounces at twistedmatrix.com<mailto:twisted-python-bounces at twistedmatrix.com>>, jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>
Subject: Re: [Twisted-Python] Regarding the SHA 512 support in twisted.


On Mon, Mar 27, 2017 at 2:33 AM, jabir Mohammed (jamohamm) <jamohamm at cisco.com<mailto:jamohamm at cisco.com>> wrote:

Can somebody help me to plot this fix so that twisted will work fine with all the other servers out there and even make it comply to the RFC. Thanks in advance and this will be my first findings on twisted code ;). Please let me know in case of any doubt on the same. Code changes should be plotted in to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py . Please help me with this commit team.


You need to follow the procedure at:

https://twistedmatrix.com/trac/wiki/TwistedDevelopment#SubmittingaPatch

That will give you all the details you need about filing a new ticket in Trac,
forking the repository on GitHub, doing a GitHub pull request, etc.

If you need more help, you should ask Einar Floystad Dorum, who works at Cisco and has filed multiple Conch patches
for Twisted: https://github.com/twisted/twisted/pulls?q=is%3Apr+author%3Aeinarfd+is%3Aclosed

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170328/cbb96b62/attachment.html>

From glyph at twistedmatrix.com  Thu Mar 30 02:14:27 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 30 Mar 2017 01:14:27 -0700
Subject: [Twisted-Python] automatic subscription should be working again
Message-ID: <B1B9D422-BABF-4ABF-9797-13078FAB4C36@twistedmatrix.com>

The web forms at https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python <https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python> as well as  https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web <https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web> should now be accepting web-based subscriptions again.

Right now the configuration has not technically changed - just to be safe, for the first day or two, we're going to leave the administrative-approval check in place on new subscribers, but I think that we have managed to address the main problem that was leading to abuse (usually one spam comes in every couple of seconds, and there hasn't been one for nearly an hour now).  If I don't see any more spammer subscription attempts in the next 24h I will likely make it fully self-service again.  Tell your friends, come join us to talk about Twisted!  (Or Twisted's mailing lists, you know, as we do here.)

This is probably a bigger deal to me than anyone else, since making sure our abysmal mail infrastructure didn't fall over and stop delivering messages to project members or DDoS some poor soul on the other side of the planet has been a grindingly tedious intermittent task for me over the last year.  Processing new subscription requests, and trying to disambiguate them from spammers, has been particularly time-consuming and frustrating; I suspect that a few dozen people who would really prefer to be on this list now have bounced off of the byzantine subscription process in the last six months.

The visibility and confidence that Mailgun's deliverability tracking has given me, plus some Mailman upgrades and configuration changes, should vastly reduce the amount of ongoing work that mail infra maintenance requires for me, so that I can get my PyCon talk done in time this year.  Maybe even fix a Twisted bug or two.

My my very heartfelt thanks to M-jimt on the #mailman IRC channel on Freenode for giving me several tips which lead to this final change.

Thank you all for your patience, and I _really_ hope that this is my last posting about meta-level mailing list junk this year :-).

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-python/attachments/20170330/f8b63aef/attachment.html>

From contact at evilham.com  Thu Mar 30 05:45:56 2017
From: contact at evilham.com (Evilham)
Date: Thu, 30 Mar 2017 13:45:56 +0200
Subject: [Twisted-Python] automatic subscription should be working again
In-Reply-To: <B1B9D422-BABF-4ABF-9797-13078FAB4C36@twistedmatrix.com>
References: <B1B9D422-BABF-4ABF-9797-13078FAB4C36@twistedmatrix.com>
Message-ID: <8e241ead-3d72-56c5-89b3-2e6520ef3bdd@evilham.com>

Hey Glpyh,

Am 30/03/2017 um 10:14 schrieb Glyph Lefkowitz:
> This is probably a bigger deal to me than anyone else, since making sure
> our abysmal mail infrastructure didn't fall over and stop delivering
> messages to project members or DDoS some poor soul on the other side of
> the planet has been a grindingly tedious intermittent task for me over
> the last year.  Processing new subscription requests, and trying to
> disambiguate them from spammers, has been particularly time-consuming
> and frustrating; I suspect that a few dozen people who would really
> prefer to be on this list now have bounced off of the byzantine
> subscription process in the last six months.
> 
> Thank you all for your patience, and I _really_ hope that this is my
> last posting about meta-level mailing list junk this year :-).

I'm glad to read this, hopefully I was one of your last manual approvals
and you'll have one thing less to think about ^^.

Best wishes,
-- 
Evilham


From glyph at twistedmatrix.com  Fri Mar 31 00:02:39 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 30 Mar 2017 23:02:39 -0700
Subject: [Twisted-Python] automatic subscription should be working again
In-Reply-To: <8e241ead-3d72-56c5-89b3-2e6520ef3bdd@evilham.com>
References: <B1B9D422-BABF-4ABF-9797-13078FAB4C36@twistedmatrix.com>
 <8e241ead-3d72-56c5-89b3-2e6520ef3bdd@evilham.com>
Message-ID: <3E909244-BA03-4DB1-9A38-CA2B9BE68F61@twistedmatrix.com>


> On Mar 30, 2017, at 4:45 AM, Evilham <contact at evilham.com> wrote:
> 
> Hey Glpyh,
> 
> Am 30/03/2017 um 10:14 schrieb Glyph Lefkowitz:
>> This is probably a bigger deal to me than anyone else, since making sure
>> our abysmal mail infrastructure didn't fall over and stop delivering
>> messages to project members or DDoS some poor soul on the other side of
>> the planet has been a grindingly tedious intermittent task for me over
>> the last year.  Processing new subscription requests, and trying to
>> disambiguate them from spammers, has been particularly time-consuming
>> and frustrating; I suspect that a few dozen people who would really
>> prefer to be on this list now have bounced off of the byzantine
>> subscription process in the last six months.
>> 
>> Thank you all for your patience, and I _really_ hope that this is my
>> last posting about meta-level mailing list junk this year :-).
> 
> I'm glad to read this, hopefully I was one of your last manual approvals
> and you'll have one thing less to think about ^^.

Thanks for the well-wishes.  It's official; after 24h of no discernible subscription spam, I've re-enabled confirmation-based subscriptions.  So you were one last manual approval and this is the last mailing list meta-post :-).  Let's get back to talking about Twisted!

-glyph


From romanmescheryakov at yandex.ru  Wed Mar  1 10:46:29 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Wed, 01 Mar 2017 20:46:29 +0300
Subject: [Twisted-Python] How to restart Twisted service in-process
In-Reply-To: <341541A6-C553-4CBA-85C5-016BEB4CBA8C@twistedmatrix.com>
References: <1754891486027057@web35j.yandex.ru>
 <0DA1D2CA-1DC6-4B85-AD85-3C8AD995633A@twistedmatrix.com>
 <CAEeXt4M+MNEx4PkFMQ-fseRZb1OhAgPbrM1ED9z=wwhphfrz_g@mail.gmail.com>
 <18715221487581109@web25h.yandex.ru>
 <D4EEEDFF-7F58-4E0A-8378-727041D146D0@twistedmatrix.com>
 <72921488298276@web9j.yandex.ru>
 <341541A6-C553-4CBA-85C5-016BEB4CBA8C@twistedmatrix.com>
Message-ID: <1388131488390389@web16o.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170301/2a9c1e6e/attachment-0002.html>

From glyph at twistedmatrix.com  Wed Mar  1 14:09:23 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 1 Mar 2017 13:09:23 -0800
Subject: [Twisted-Python] How to restart Twisted service in-process
In-Reply-To: <1388131488390389@web16o.yandex.ru>
References: <1754891486027057@web35j.yandex.ru>
 <0DA1D2CA-1DC6-4B85-AD85-3C8AD995633A@twistedmatrix.com>
 <CAEeXt4M+MNEx4PkFMQ-fseRZb1OhAgPbrM1ED9z=wwhphfrz_g@mail.gmail.com>
 <18715221487581109@web25h.yandex.ru>
 <D4EEEDFF-7F58-4E0A-8378-727041D146D0@twistedmatrix.com>
 <72921488298276@web9j.yandex.ru>
 <341541A6-C553-4CBA-85C5-016BEB4CBA8C@twistedmatrix.com>
 <1388131488390389@web16o.yandex.ru>
Message-ID: <AD725B7E-1B01-4C8F-AA74-2398A866A726@twistedmatrix.com>

> On Mar 1, 2017, at 9:46 AM,   <romanmescheryakov at yandex.ru> wrote:
> 
> Then the next question is: how to run my .tac file with twist? I don't see option like '-y' in it's --help output.

We haven't implemented .tac files for `twist` yet; you can either add that feature :) or you can write a twist plugin.  (It's the same as a twistd plugin.)

-glyph




From romanmescheryakov at yandex.ru  Thu Mar  2 02:08:12 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Thu, 02 Mar 2017 12:08:12 +0300
Subject: [Twisted-Python] How to restart Twisted service in-process
In-Reply-To: <AD725B7E-1B01-4C8F-AA74-2398A866A726@twistedmatrix.com>
References: <1754891486027057@web35j.yandex.ru>
 <0DA1D2CA-1DC6-4B85-AD85-3C8AD995633A@twistedmatrix.com>
 <CAEeXt4M+MNEx4PkFMQ-fseRZb1OhAgPbrM1ED9z=wwhphfrz_g@mail.gmail.com>
 <18715221487581109@web25h.yandex.ru>
 <D4EEEDFF-7F58-4E0A-8378-727041D146D0@twistedmatrix.com>
 <72921488298276@web9j.yandex.ru>
 <341541A6-C553-4CBA-85C5-016BEB4CBA8C@twistedmatrix.com>
 <1388131488390389@web16o.yandex.ru>
 <AD725B7E-1B01-4C8F-AA74-2398A866A726@twistedmatrix.com>
Message-ID: <664081488445692@web15j.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170302/67fc9f5a/attachment-0002.html>

From romanmescheryakov at yandex.ru  Fri Mar  3 00:57:38 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Fri, 03 Mar 2017 10:57:38 +0300
Subject: [Twisted-Python] =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
Message-ID: <1795181488527858@web23h.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170303/3350e088/attachment-0002.html>

From team at trubrain.com  Fri Mar  3 01:04:17 2017
From: team at trubrain.com (Team at TruBrain)
Date: Fri, 03 Mar 2017 08:04:17 +0000
Subject: [Twisted-Python] =?utf-8?q?Ticket_Received_-__Minor_fixes_in_the_?=
 =?utf-8?q?=E2=80=9CCustomizing_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1795181488527858@web23h.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
Message-ID: <58b92381a122c_7a9dd67c414674c.delayed-jobs-sidekiq-1@notification.freshdesk.com>

 Dear Twisted general discussion,  We would like to acknowledge that we have received your request and a ticket has been created. A support representative will be reviewing your request and will send you a personal response.(usually within 24 hours).  To view the status of the ticket or add comments, please visit  https://trubrain.freshdesk.com/helpdesk/tickets/264  Thank you for your patience.  Sincerely, TruBrain Support Team 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170303/94accc15/attachment-0002.html>

From team at trubrain.com  Fri Mar  3 01:04:19 2017
From: team at trubrain.com (Team at TruBrain)
Date: Fri, 03 Mar 2017 08:04:19 +0000
Subject: [Twisted-Python] TruBrain user activation
Message-ID: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>

 Hi Twisted general discussion,  A new TruBrain account has been created for you.  Click the url below to activate your account and select a password!  https://trubrain.freshdesk.com/register/rYnBXi9wuEiIlk5Hgh5  If the above URL does not work try copying and pasting it into your browser. If you continue to have problems, please feel free to contact us.  Regards, TruBrain 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170303/4c69e525/attachment-0002.html>

From glyph at twistedmatrix.com  Fri Mar  3 02:27:31 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 3 Mar 2017 01:27:31 -0800
Subject: [Twisted-Python] TruBrain user activation
In-Reply-To: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>
References: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>
Message-ID: <FA68B5CE-057A-4A6D-A28D-C60BAA1DE062@twistedmatrix.com>

Hi all, 

I have no idea how this bot got subscribed to the list, but, I've unsubscribed and banned them.  Sorry!

-glyph

> On Mar 3, 2017, at 12:04 AM, Team at TruBrain <team at trubrain.com> wrote:
> 
> Hi Twisted general discussion,
> 
> A new TruBrain account has been created for you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170303/f15e0b6f/attachment-0002.html>

From romanmescheryakov at yandex.ru  Fri Mar  3 02:54:47 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Fri, 03 Mar 2017 12:54:47 +0300
Subject: [Twisted-Python] TruBrain user activation
In-Reply-To: <FA68B5CE-057A-4A6D-A28D-C60BAA1DE062@twistedmatrix.com>
References: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>
 <FA68B5CE-057A-4A6D-A28D-C60BAA1DE062@twistedmatrix.com>
Message-ID: <2828981488534887@web9o.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170303/2d64e2b9/attachment-0002.html>

From glyph at twistedmatrix.com  Fri Mar  3 03:04:04 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 3 Mar 2017 02:04:04 -0800
Subject: [Twisted-Python] TruBrain user activation
In-Reply-To: <2828981488534887@web9o.yandex.ru>
References: <58b923838d859_2c3e16ba570540696@paid-jobs-sidekiq-1.mail>
 <FA68B5CE-057A-4A6D-A28D-C60BAA1DE062@twistedmatrix.com>
 <2828981488534887@web9o.yandex.ru>
Message-ID: <EA275697-37E8-4562-AB93-2F7EE6E910DA@twistedmatrix.com>

I don't know what TruBrain is, but it would be good if it weren't trying to spam this list and getting its messages rejected :).

-g

> On Mar 3, 2017, at 1:54 AM,   <romanmescheryakov at yandex.ru> wrote:
> 
> I have to admit that I clicked on the user activation link and even specified some password... It seems I wasn't supposed to do that :( Should I delete that new TruBrain account?
>  
> -- 
> Kind regards, Roman Mescheryakov
>  
>  
>  
> 03.03.2017, 12:29, "Glyph Lefkowitz" <glyph at twistedmatrix.com>:
>> Hi all, 
>>  
>> I have no idea how this bot got subscribed to the list, but, I've unsubscribed and banned them.  Sorry!
>>  
>> -glyph
>>  
>>> On Mar 3, 2017, at 12:04 AM, Team at TruBrain <team at trubrain.com <mailto:team at trubrain.com>> wrote:
>>>  
>>> Hi Twisted general discussion,
>>> 
>>> A new TruBrain account has been created for you.
>>> 
>> ,
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com <mailto:Twisted-Python at twistedmatrix.com>
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python <http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python>_______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170303/274fef7c/attachment-0002.html>

From exarkun at twistedmatrix.com  Fri Mar  3 05:23:53 2017
From: exarkun at twistedmatrix.com (Jean-Paul Calderone)
Date: Fri, 3 Mar 2017 07:23:53 -0500
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1795181488527858@web23h.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
Message-ID: <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>

On Fri, Mar 3, 2017 at 2:57 AM,   <romanmescheryakov at yandex.ru
> wrote:

> Hi everyone,
>
>
> *On the documentation web page
> https://twistedmatrix.com/documents/current/core/howto/application.html
> <https://twistedmatrix.com/documents/current/core/howto/application.html>
> in the Customizing twistd logging section there are 2 examples which as I
> can see are a bit outdated in terms of imported module names and some other
> minor details. I would like to fix that. Is this change is worth doing? If
> so, please guide how can I do it. My GitHub login, if its needed, is
> RomanMeR.*
>

Hi ,

Thanks for your interest in improving Twisted!  Have a look at
https://twistedmatrix.com/trac/wiki/TwistedDevelopment and then let us know
if you have further questions.

Jean-Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170303/e3fce65a/attachment-0002.html>

From jasonjwwilliams at gmail.com  Fri Mar  3 13:34:32 2017
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 3 Mar 2017 12:34:32 -0800
Subject: [Twisted-Python] proto_helpers.StringTransport & TLS
Message-ID: <CAHZAEpfHZ1XaAfA8=RzPjmD7r6Y8B6cx+N4qpkNr+juqiK9cFw@mail.gmail.com>

Hey Guys,

We've been using proto_helpers.StringTransport for awhile in testing and
recently added TLS support we wanted to test as well. Has anyone subclassed
StringTransport to add startTLS support?

We added the _TLSConnectionMixin, _TLSClientMixin mixins to a new
StringTransportTLS subclass, but its throwing some basic errors we're
crunching through:

'StringTransportTLS' object has no attribute 'protocol'

So I thought I'd see if anyone had any pointers on doing this better. Thank
you in advance.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170303/3d75052b/attachment-0002.html>

From trac at twistedmatrix.com  Sun Mar  5 00:05:19 2017
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 05 Mar 2017 07:05:19 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1488697519.96.1844292488552039864@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170305/f40c0fa1/attachment-0002.html>

From adi at roiban.ro  Sun Mar  5 06:35:44 2017
From: adi at roiban.ro (Adi Roiban)
Date: Sun, 5 Mar 2017 13:35:44 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed for
	some HTTPS sites
Message-ID: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>

Hi,

It looks like when connected to some  HTTPS servers, the TLS
connection is not successfully closed.

With sites like google.com, the connection is successfully closed.

But with Office365 sharepoint.com sites the TLS shutdown is not completed.

Has anyone else observed this behaviour ?

I have observed this while running some end to end tests in which the
pool.closeCachedConnections() deferred was not called, even after a
generous amount of seconds :)

--------

the TLSMemoryBIOProtocol._tlsConnection.shutdown() will return False
and the connection is left open.

Future calls to tlsConnection will result in WantReadError

>From my understanding WantReadError means that more data needs to be
read and passed to the protocol.

And If I try to read from the raw socket I get this

data = TLSMemoryBIOProtocol.transport.socket.recv(1000)
*** error: [Errno 11] Resource temporarily unavailable

and the socket is never made available  and in the end it is closed with

data = TLSMemoryBIOProtocol.transport.socket.recv(100)
*** error: [Errno 104] Connection reset by peer

-----------

Here is a gits with the example code and some example output
https://gist.github.com/adiroiban/346dd455094d1762f0e69e9812309ad6

The gist also contains a patched TLSMemoryBIOProtocol._shutdownTLS
which will close the connection after some time.

PS: TLSMemoryBIOProtocol._tlsConnection.shutdown() make reference to
this issue https://github.com/pyca/pyopenssl/issues/91... but the
issue is now closed

Thanks!
-- 
Adi Roiban



From mithrandi at mithrandi.net  Sun Mar  5 07:25:01 2017
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Sun, 05 Mar 2017 14:25:01 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
Message-ID: <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>

On Sun, 5 Mar 2017 at 15:36 Adi Roiban <adi at roiban.ro> wrote:

> I have observed this while running some end to end tests in which the
> pool.closeCachedConnections() deferred was not called, even after a
> generous amount of seconds :)
>

The code to abort an HTTP client connection is here:

https://github.com/twisted/twisted/blob/twisted-17.1.0/src/twisted/web/_newclient.py#L1657

This calls loseConnection which for a TLS connection will try to do a TLS
shutdown under most circumstances (in some cases it can't, and will
abortConnection on the underlying transport instead). If the remote end has
stopped responding to the connection, I think this may end up hanging
forever.

I think this code should either call abortConnection directly, or set a
timer which will abort the connection after a little while if a clean
shutdown from loseConnection has not completed yet. I'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170305/d0581d6e/attachment-0002.html>

From glyph at twistedmatrix.com  Sun Mar  5 23:37:02 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sun, 5 Mar 2017 22:37:02 -0800
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
Message-ID: <42DCB7FB-754A-45C7-9568-4CDD9696C18D@twistedmatrix.com>


> On Mar 5, 2017, at 6:25 AM, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
> 
> I think this code should either call abortConnection directly, or set a timer which will abort the connection after a little while if a clean shutdown from loseConnection has not completed yet. I'
> 

Agreed - did someone file a bug? :)

-g
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170305/75d74e3f/attachment-0002.html>

From pawelmhm at gmail.com  Mon Mar  6 00:22:07 2017
From: pawelmhm at gmail.com (=?UTF-8?B?UGF3ZcWCIE1pZWNo?=)
Date: Mon, 6 Mar 2017 08:22:07 +0100
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <42DCB7FB-754A-45C7-9568-4CDD9696C18D@twistedmatrix.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <42DCB7FB-754A-45C7-9568-4CDD9696C18D@twistedmatrix.com>
Message-ID: <CAO38UC=q6kuj3P2M3niU9PhFChB5jCpV1ie8twWDHa2CEfAe_Q@mail.gmail.com>

> It looks like when connected to some  HTTPS servers, the TLS
connection is not successfully closed.
> But with Office365 sharepoint.com sites the TLS shutdown is not completed.
> Has anyone else observed this behaviour ?

I observed something simillar a while ago, there was bug report created for
it in Scrapy. I'm not 100% sure this was same issue as you're discussing
here. Issue in Scrapy: https://github.com/scrapy/scrapy/issues/985 fix in
Scrapy https://github.com/scrapy/scrapy/pull/999 Author of this PR to
Scrapy also created Twisted ticket
https://twistedmatrix.com/trac/ticket/7738

Hope it helps

2017-03-06 7:37 GMT+01:00 Glyph Lefkowitz <glyph at twistedmatrix.com>:

>
> On Mar 5, 2017, at 6:25 AM, Tristan Seligmann <mithrandi at mithrandi.net>
> wrote:
>
> I think this code should either call abortConnection directly, or set a
> timer which will abort the connection after a little while if a clean
> shutdown from loseConnection has not completed yet. I'
>
>
> Agreed - did someone file a bug? :)
>
> -g
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170306/c0e5b0b2/attachment-0002.html>

From mithrandi at mithrandi.net  Mon Mar  6 00:22:04 2017
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Mon, 06 Mar 2017 07:22:04 +0000
Subject: [Twisted-Python] twistedmatrix.com TLS certificate
Message-ID: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>

twistedmatrix.com's current certificate is issued by StartCom Certification
Authority; for certificates issued by this CA prior to 2016-09-21, the
domain must be on a Chrome whitelist for it to be accepted. As of Chrome
58.0.3026.3 (canary/dev channel only, currently, but eventually this will
presumably be in a release version) twistedmatrix.com is no longer[1] on
the whitelist, which means that twistedmatrix.com will issue a certificate
error. Can we switch to another CA? (Let's Encrypt, for example; I hear
somebody wrote a Twisted library for using that)

I'm sending this to the general list in case anyone else has been
scratching their head about why they're getting cert warnings.

[1]
https://chromium.googlesource.com/chromium/src/+/6fc397860ccafa55086456a4d1e6d713c418b41f%5E%21/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170306/fb53c92f/attachment-0002.html>

From cory at lukasa.co.uk  Mon Mar  6 01:16:35 2017
From: cory at lukasa.co.uk (Cory Benfield)
Date: Mon, 6 Mar 2017 08:16:35 +0000
Subject: [Twisted-Python] twistedmatrix.com TLS certificate
In-Reply-To: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>
References: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>
Message-ID: <725154D7-EE02-4DFE-B332-DECA2423DBF0@lukasa.co.uk>


> On 6 Mar 2017, at 07:22, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
> 
> twistedmatrix.com <http://twistedmatrix.com/>'s current certificate is issued by StartCom Certification Authority; for certificates issued by this CA prior to 2016-09-21, the domain must be on a Chrome whitelist for it to be accepted. As of Chrome 58.0.3026.3 (canary/dev channel only, currently, but eventually this will presumably be in a release version) twistedmatrix.com <http://twistedmatrix.com/> is no longer[1] on the whitelist, which means that twistedmatrix.com <http://twistedmatrix.com/> will issue a certificate error. Can we switch to another CA? (Let's Encrypt, for example; I hear somebody wrote a Twisted library for using that)
> 
> I'm sending this to the general list in case anyone else has been scratching their head about why they're getting cert warnings.

This is an extremely good idea.

Cory

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170306/630d8dc8/attachment-0002.html>

From cory at lukasa.co.uk  Mon Mar  6 01:17:39 2017
From: cory at lukasa.co.uk (Cory Benfield)
Date: Mon, 6 Mar 2017 08:17:39 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
Message-ID: <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>


> On 5 Mar 2017, at 14:25, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
> 
> On Sun, 5 Mar 2017 at 15:36 Adi Roiban <adi at roiban.ro <mailto:adi at roiban.ro>> wrote:
> I have observed this while running some end to end tests in which the
> pool.closeCachedConnections() deferred was not called, even after a
> generous amount of seconds :)
> 
> The code to abort an HTTP client connection is here:
> 
> https://github.com/twisted/twisted/blob/twisted-17.1.0/src/twisted/web/_newclient.py#L1657 <https://github.com/twisted/twisted/blob/twisted-17.1.0/src/twisted/web/_newclient.py#L1657>
> 
> This calls loseConnection which for a TLS connection will try to do a TLS shutdown under most circumstances (in some cases it can't, and will abortConnection on the underlying transport instead). If the remote end has stopped responding to the connection, I think this may end up hanging forever.
> 
> I think this code should either call abortConnection directly, or set a timer which will abort the connection after a little while if a clean shutdown from loseConnection has not completed yet. I

Yeah, this looks right. We hit it in the server side code too: its a very unintuitive API in that sense.

Cory

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170306/75937ce2/attachment-0002.html>

From adi at roiban.ro  Mon Mar  6 02:05:09 2017
From: adi at roiban.ro (Adi Roiban)
Date: Mon, 6 Mar 2017 09:05:09 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
Message-ID: <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>

On 6 March 2017 at 08:17, Cory Benfield <cory at lukasa.co.uk> wrote:
>
> On 5 Mar 2017, at 14:25, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
>
> On Sun, 5 Mar 2017 at 15:36 Adi Roiban <adi at roiban.ro> wrote:
>>
>> I have observed this while running some end to end tests in which the
>> pool.closeCachedConnections() deferred was not called, even after a
>> generous amount of seconds :)
>
>
> The code to abort an HTTP client connection is here:
>
> https://github.com/twisted/twisted/blob/twisted-17.1.0/src/twisted/web/_newclient.py#L1657
>
> This calls loseConnection which for a TLS connection will try to do a TLS
> shutdown under most circumstances (in some cases it can't, and will
> abortConnection on the underlying transport instead). If the remote end has
> stopped responding to the connection, I think this may end up hanging
> forever.
>
> I think this code should either call abortConnection directly, or set a
> timer which will abort the connection after a little while if a clean
> shutdown from loseConnection has not completed yet. I
>
>
> Yeah, this looks right. We hit it in the server side code too: its a very
> unintuitive API in that sense.

I am not sure about which code are we talking here.
The specific HTTP11ClientProtocol which will fix only the HTTP client
part or the generic TLSMemoryBIOProtocol code which might fix any TLS
connection?

I have observed this issue on the server side for the case in which a
TLS connection is opened and then closed  without transferring any
data ... and then the handshake will not have the chance to complete.

I think that this is the same issue which was reported for Scrapy

-- 
Adi Roiban



From exarkun at twistedmatrix.com  Mon Mar  6 19:03:57 2017
From: exarkun at twistedmatrix.com (Jean-Paul Calderone)
Date: Mon, 6 Mar 2017 21:03:57 -0500
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
Message-ID: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>

Hello,

GitHub apparently allows fast-forward merges to trunk.  Here's an example
of one:

  https://github.com/twisted/twisted/pull/730

This doesn't seem like a good thing.

   - The ticket is still open
   - There is no merge commit
   - There is no merge commit message
   - There are non-merge commits directly on trunk history (first parent)

  Anyone else have an opinion?

Also, on the same PR, it seems like folks have trouble managing the two
different ways to represent the review states: the "review" keyword in trac
and the accepted/etc status on the GitHub PR.  Maybe there shouldn't be two
different ways to represent this?

Jean-Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170306/49a404ae/attachment-0002.html>

From glyph at twistedmatrix.com  Mon Mar  6 20:19:22 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 6 Mar 2017 19:19:22 -0800
Subject: [Twisted-Python] twistedmatrix.com TLS certificate
In-Reply-To: <725154D7-EE02-4DFE-B332-DECA2423DBF0@lukasa.co.uk>
References: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>
 <725154D7-EE02-4DFE-B332-DECA2423DBF0@lukasa.co.uk>
Message-ID: <68841104-9C0E-40F4-9189-A046C24E09DA@twistedmatrix.com>


> On Mar 6, 2017, at 12:16 AM, Cory Benfield <cory at lukasa.co.uk> wrote:
> 
> 
>> On 6 Mar 2017, at 07:22, Tristan Seligmann <mithrandi at mithrandi.net <mailto:mithrandi at mithrandi.net>> wrote:
>> 
>> twistedmatrix.com <http://twistedmatrix.com/>'s current certificate is issued by StartCom Certification Authority; for certificates issued by this CA prior to 2016-09-21, the domain must be on a Chrome whitelist for it to be accepted. As of Chrome 58.0.3026.3 (canary/dev channel only, currently, but eventually this will presumably be in a release version) twistedmatrix.com <http://twistedmatrix.com/> is no longer[1] on the whitelist, which means that twistedmatrix.com <http://twistedmatrix.com/> will issue a certificate error. Can we switch to another CA? (Let's Encrypt, for example; I hear somebody wrote a Twisted library for using that)
>> 
>> I'm sending this to the general list in case anyone else has been scratching their head about why they're getting cert warnings.
> 
> This is an extremely good idea.

Yes please.

This is the rare ops task that will actually be quite easy for someone to add in to Braid as a PR: https://github.com/twisted-infra/braid <https://github.com/twisted-infra/braid>

If you have a look at https://github.com/twisted-infra/braid/blob/master/services/t-web/twisted-web/ports <https://github.com/twisted-infra/braid/blob/master/services/t-web/twisted-web/ports> you might be able to guess how such a thing would go...

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170306/70f095dd/attachment-0002.html>

From glyph at twistedmatrix.com  Mon Mar  6 21:37:47 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 6 Mar 2017 20:37:47 -0800
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
Message-ID: <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>


> On Mar 6, 2017, at 6:03 PM, Jean-Paul Calderone <exarkun at twistedmatrix.com> wrote:
> 
> Hello,
> 
> GitHub apparently allows fast-forward merges to trunk.  Here's an example of one:
> 
>   https://github.com/twisted/twisted/pull/730 <https://github.com/twisted/twisted/pull/730>
> 
> This doesn't seem like a good thing.
> The ticket is still open
> There is no merge commit
> There is no merge commit message
> There are non-merge commits directly on trunk history (first parent)
>   Anyone else have an opinion?

This is definitely bad, forbidden by existing policy, etc.  In fact I remember adjusting the settings so that the 'merge' button would always create a merge commit; in fact, the configuration is still set that way.

Craig, since you're the one who made this merge, can you explain what happened?  Has github's 'merge' button stopped prompting for a commit message?  Failing to wait for the removal of the 'review' keyword was obviously a mistake, but based on my previous experience with the 'merge' button this wouldn't even be a type of mistake that's _possible_ to make; understanding what you did to trigger it would therefore be very useful.

I don't think this is bad enough to do any major VCS surgery to fix (similar mistakes exist in the history, and both commits to Twisted.Quotes and literally all of the imported SVN history are single-parent), but it is worth doing some work to avoid recurring.

> Also, on the same PR, it seems like folks have trouble managing the two different ways to represent the review states: the "review" keyword in trac and the accepted/etc status on the GitHub PR.  Maybe there shouldn't be two different ways to represent this?

Indeed there should not.  I hope someone has the time to address this soon

The only blocker is that I don't want to lose the notion of a "review queue".  The random mess of works-in-progress, already-reviewed code awaiting feedback, and abandoned experiments that shows up on the default 'pull request' view is not a workable substitute for the relatively short and explicit "I have submitted code that wants a review but hasn't gotten one" list at https://twisted.reviews/ <https://twisted.reviews/>.  However, some combination of Github's new-ish explicit review workflow, (possibly, if necessary) some kind of bot to perform the operations that are mysteriously forbidden to outside contributors, and a custom query could easily do the trick if someone can work it out and document it.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170306/5aa6d9b9/attachment-0002.html>

From mithrandi at mithrandi.net  Mon Mar  6 22:02:29 2017
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Tue, 07 Mar 2017 05:02:29 +0000
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
Message-ID: <CAMcKhMTdLoDYmfBYUJuOw4R5QJHamwDOgLc1rMa6giYfXF3K8Q@mail.gmail.com>

On Tue, 7 Mar 2017 at 06:38 Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

>
> This is definitely bad, forbidden by existing policy, etc.  In fact I
> remember adjusting the settings so that the 'merge' button would always
> create a merge commit; in fact, the configuration is still set that way.
>

Rebase merging was allowed when I checked earlier, so I disabled it (I
guess I managed to do this before you looked at the configuration). I
suspect that is what happened here, but note also that these settings only
control what is possible by pressing the merge button on GitHub; you can
construct commits locally however you like and push them, as long as you
get green commit statuses for all the mandatory commit checks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170307/ae0f154b/attachment-0002.html>

From glyph at twistedmatrix.com  Tue Mar  7 00:56:00 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 6 Mar 2017 23:56:00 -0800
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <CAMcKhMTdLoDYmfBYUJuOw4R5QJHamwDOgLc1rMa6giYfXF3K8Q@mail.gmail.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
 <CAMcKhMTdLoDYmfBYUJuOw4R5QJHamwDOgLc1rMa6giYfXF3K8Q@mail.gmail.com>
Message-ID: <61649AEC-591F-4786-B9F5-E35A374AF1A4@twistedmatrix.com>


> On Mar 6, 2017, at 9:02 PM, Tristan Seligmann <mithrandi at mithrandi.net> wrote:
> 
> On Tue, 7 Mar 2017 at 06:38 Glyph Lefkowitz <glyph at twistedmatrix.com <mailto:glyph at twistedmatrix.com>> wrote:
> 
> This is definitely bad, forbidden by existing policy, etc.  In fact I remember adjusting the settings so that the 'merge' button would always create a merge commit; in fact, the configuration is still set that way.
> 
> Rebase merging was allowed when I checked earlier, so I disabled it (I guess I managed to do this before you looked at the configuration).

Perhaps I only did this for some other repos, then.  Did I miss your announcement of this?  Hint, hint? :)

> I suspect that is what happened here, but note also that these settings only control what is possible by pressing the merge button on GitHub; you can construct commits locally however you like and push them, as long as you get green commit statuses for all the mandatory commit checks.

Is this true even for people with just repo:write?

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170306/5c7c4f2c/attachment-0002.html>

From cory at lukasa.co.uk  Tue Mar  7 02:31:11 2017
From: cory at lukasa.co.uk (Cory Benfield)
Date: Tue, 7 Mar 2017 09:31:11 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
Message-ID: <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>


> On 6 Mar 2017, at 09:05, Adi Roiban <adi at roiban.ro> wrote:
> 
> I am not sure about which code are we talking here.
> The specific HTTP11ClientProtocol which will fix only the HTTP client
> part or the generic TLSMemoryBIOProtocol code which might fix any TLS
> connection?

Im talking about the fact that calling TLSMemoryBIOProtocol.loseConnection may not ever actually drop the underlying FD is the surprising part of the code. We had to work around it in the server side by adding a timeout after loseConnection is called to end up calling abortConnection.

Cory
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170307/0bb3b0a8/attachment-0002.html>

From mithrandi at mithrandi.net  Tue Mar  7 02:52:38 2017
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Tue, 07 Mar 2017 09:52:38 +0000
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <61649AEC-591F-4786-B9F5-E35A374AF1A4@twistedmatrix.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
 <CAMcKhMTdLoDYmfBYUJuOw4R5QJHamwDOgLc1rMa6giYfXF3K8Q@mail.gmail.com>
 <61649AEC-591F-4786-B9F5-E35A374AF1A4@twistedmatrix.com>
Message-ID: <CAMcKhMTxPjtbWrS2HnoVdoVtVqV8t_jNZXUEiKDeMBxTO4_WLQ@mail.gmail.com>

On Tue, 7 Mar 2017 at 09:56 Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

> On Mar 6, 2017, at 9:02 PM, Tristan Seligmann <mithrandi at mithrandi.net>
> wrote:
>
> On Tue, 7 Mar 2017 at 06:38 Glyph Lefkowitz <glyph at twistedmatrix.com>
> wrote:
>
>
> This is definitely bad, forbidden by existing policy, etc.  In fact I
> remember adjusting the settings so that the 'merge' button would always
> create a merge commit; in fact, the configuration is still set that way.
>
>
> Rebase merging was allowed when I checked earlier, so I disabled it (I
> guess I managed to do this before you looked at the configuration).
>
>
> Perhaps I only did this for some other repos, then.  Did I miss your
> announcement of this?  Hint, hint? :)
>

 By the time I got to my email client (which admittedly was several hours
after I made the configuration change), your email had arrived, so my reply
ended up being the "announcement" too. The last time I looked at these
settings, rebasing was not allowed, so I guess somebody else turned it on
(possibly by accident); the GitHub audit logs don't go far back enough for
me to check who did it and when, but that means the change happened over
several months ago.

> I suspect that is what happened here, but note also that these settings
> only control what is possible by pressing the merge button on GitHub; you
> can construct commits locally however you like and push them, as long as
> you get green commit statuses for all the mandatory commit checks.
>
>
> Is this true even for people with just repo:write?
>

I haven't actually tested this scenario, so I could be mistaken; inferring
from other things it shouldn't matter what your permissions are (for a
non-force push).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170307/dded756f/attachment-0002.html>

From rodrigc at crodrigues.org  Tue Mar  7 11:40:50 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Tue, 7 Mar 2017 10:40:50 -0800
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
Message-ID: <CAG=rPVdEniSgKC12NFdXqUs+OqZeQb47cSBjwq-708=cLQ5wYA@mail.gmail.com>

On Mon, Mar 6, 2017 at 8:37 PM, Glyph Lefkowitz <glyph at twistedmatrix.com>
wrote:

>
>
> Craig, since you're the one who made this merge, can you explain what
> happened?  Has github's 'merge' button stopped prompting for a commit
> message?  Failing to wait for the removal of the 'review' keyword was
> obviously a mistake, but based on my previous experience with the 'merge'
> button this wouldn't even be a type of mistake that's _possible_ to make;
> understanding what you did to trigger it would therefore be very useful.
>
>
Woops, sorry about that.  I pressed the Merge button in git, but I guess I
clicked on the wrong
option after that.  It is good that this is now disabled to prevent future
mistakes like this.

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170307/bc56ce6b/attachment-0002.html>

From glyph at twistedmatrix.com  Tue Mar  7 23:02:24 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 7 Mar 2017 22:02:24 -0800
Subject: [Twisted-Python] non-merge commits to trunk & "review" keyword
In-Reply-To: <CAG=rPVdEniSgKC12NFdXqUs+OqZeQb47cSBjwq-708=cLQ5wYA@mail.gmail.com>
References: <CAEeXt4PPaNS_8+h-NKhHryEgpoYbNssP5OMeDjrjZ+iWorKoqg@mail.gmail.com>
 <5596CEC9-113E-4B73-B59E-561752DE4870@twistedmatrix.com>
 <CAG=rPVdEniSgKC12NFdXqUs+OqZeQb47cSBjwq-708=cLQ5wYA@mail.gmail.com>
Message-ID: <5527A04E-DCF2-49A8-8C52-D988736BC63E@twistedmatrix.com>


> On Mar 7, 2017, at 10:40 AM, Craig Rodrigues <rodrigc at crodrigues.org> wrote:
> 
> 
> 
> On Mon, Mar 6, 2017 at 8:37 PM, Glyph Lefkowitz <glyph at twistedmatrix.com <mailto:glyph at twistedmatrix.com>> wrote:
> 
> 
> Craig, since you're the one who made this merge, can you explain what happened?  Has github's 'merge' button stopped prompting for a commit message?  Failing to wait for the removal of the 'review' keyword was obviously a mistake, but based on my previous experience with the 'merge' button this wouldn't even be a type of mistake that's _possible_ to make; understanding what you did to trigger it would therefore be very useful.
> 
> 
> Woops, sorry about that.  I pressed the Merge button in git, but I guess I clicked on the wrong
> option after that.  It is good that this is now disabled to prevent future mistakes like this.

OK, good to know; so this was a repo misconfiguration coupled with human error.  Glad we have something in place to prevent it now :).

Craig - that said, can you go back and fix up the relevant state (kill the 'review' keyword, close the ticket with a reference to the relevant commit, and so on)?

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170307/24cef158/attachment-0002.html>

From adi at roiban.ro  Thu Mar  9 13:40:44 2017
From: adi at roiban.ro (Adi Roiban)
Date: Thu, 9 Mar 2017 20:40:44 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
 <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
Message-ID: <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>

On 7 March 2017 at 09:31, Cory Benfield <cory at lukasa.co.uk> wrote:
>
> On 6 Mar 2017, at 09:05, Adi Roiban <adi at roiban.ro> wrote:
>
> I am not sure about which code are we talking here.
> The specific HTTP11ClientProtocol which will fix only the HTTP client
> part or the generic TLSMemoryBIOProtocol code which might fix any TLS
> connection?
>
>
> Im talking about the fact that calling TLSMemoryBIOProtocol.loseConnection
> may not ever actually drop the underlying FD is the surprising part of the
> code. We had to work around it in the server side by adding a timeout after
> loseConnection is called to end up calling abortConnection.
>
> Cory

In order to submit a patch, I am trying to write an automated tests for this.
Were you able to reproduce this issue in a controlled environment.

I am still not fully understanding why I get this behaviour with
sharepoint.com sites.

I am thinking at having a rigged TLS server which will keep the socket
open but will not
respond to the shutdown request.... but I still don't know how :)

-- 
Adi Roiban



From exarkun at twistedmatrix.com  Thu Mar  9 15:01:31 2017
From: exarkun at twistedmatrix.com (Jean-Paul Calderone)
Date: Thu, 9 Mar 2017 17:01:31 -0500
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
 <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
 <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>
Message-ID: <CAEeXt4OvT1qykf=n2zWGGUiokDm_dbkKTavAOnDnM5g6qVTQ1g@mail.gmail.com>

On Thu, Mar 9, 2017 at 3:40 PM, Adi Roiban <adi at roiban.ro> wrote:

> On 7 March 2017 at 09:31, Cory Benfield <cory at lukasa.co.uk> wrote:
> >
> > On 6 Mar 2017, at 09:05, Adi Roiban <adi at roiban.ro> wrote:
> >
> > I am not sure about which code are we talking here.
> > The specific HTTP11ClientProtocol which will fix only the HTTP client
> > part or the generic TLSMemoryBIOProtocol code which might fix any TLS
> > connection?
> >
> >
> > Im talking about the fact that calling TLSMemoryBIOProtocol.
> loseConnection
> > may not ever actually drop the underlying FD is the surprising part of
> the
> > code. We had to work around it in the server side by adding a timeout
> after
> > loseConnection is called to end up calling abortConnection.
> >
> > Cory
>
> In order to submit a patch, I am trying to write an automated tests for
> this.
> Were you able to reproduce this issue in a controlled environment.
>
> I am still not fully understanding why I get this behaviour with
> sharepoint.com sites.
>
> I am thinking at having a rigged TLS server which will keep the socket
> open but will not
> respond to the shutdown request.... but I still don't know how :)
>
>
Run the server with TLSMemoryBIOProtocol and use the transport's
pauseProducing method before you attempt the shutdown?

Jean-Paul


> --
> Adi Roiban
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170309/79de8b8f/attachment-0002.html>

From cory at lukasa.co.uk  Fri Mar 10 01:26:40 2017
From: cory at lukasa.co.uk (Cory Benfield)
Date: Fri, 10 Mar 2017 08:26:40 +0000
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <CAEeXt4OvT1qykf=n2zWGGUiokDm_dbkKTavAOnDnM5g6qVTQ1g@mail.gmail.com>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
 <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
 <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>
 <CAEeXt4OvT1qykf=n2zWGGUiokDm_dbkKTavAOnDnM5g6qVTQ1g@mail.gmail.com>
Message-ID: <75B7556E-F0DB-4B9D-9B05-7224BA010690@lukasa.co.uk>


> On 9 Mar 2017, at 22:01, Jean-Paul Calderone <exarkun at twistedmatrix.com> wrote:
> 
> Run the server with TLSMemoryBIOProtocol and use the transport's pauseProducing method before you attempt the shutdown?
> 
> Jean-Paul

Yup, that will work. Similarly, having two TLSMemoryBIOProtocols communicating together and pausing one before calling loseConnection on the other should also work. Essentially, any situation you can conjure where the closing connection will manage not to see either a TLS CloseNotify or a TCP FIN or RST will do the job.

Cory

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170310/5e66904d/attachment-0002.html>

From exarkun at twistedmatrix.com  Fri Mar 10 05:21:29 2017
From: exarkun at twistedmatrix.com (Jean-Paul Calderone)
Date: Fri, 10 Mar 2017 07:21:29 -0500
Subject: [Twisted-Python] HTTP Agent persistent connections not closed
 for some HTTPS sites
In-Reply-To: <75B7556E-F0DB-4B9D-9B05-7224BA010690@lukasa.co.uk>
References: <CAFycZ9cVFYDXCf_pqrAL_EA9NyGv8Ya26gNi1Fp3w0v1g=WENg@mail.gmail.com>
 <CAMcKhMQo5V=GwfKncA0Oa-X-MR9MGj=nYqTWnmHMC1JeneFUAw@mail.gmail.com>
 <0C743674-B591-4EDD-A7DA-E2102F1FE1CF@lukasa.co.uk>
 <CAFycZ9eBMKQHXDyyT4YBunPbWeD++zBUj48PoX26qb+K2rf3MA@mail.gmail.com>
 <9A0001A3-2E75-476E-88A0-AD50CBBC54C3@lukasa.co.uk>
 <CAFycZ9cyAZ1=PxLexj-pHS9SDh=83oAPwhThHkZp0aqwj6ehJQ@mail.gmail.com>
 <CAEeXt4OvT1qykf=n2zWGGUiokDm_dbkKTavAOnDnM5g6qVTQ1g@mail.gmail.com>
 <75B7556E-F0DB-4B9D-9B05-7224BA010690@lukasa.co.uk>
Message-ID: <CAEeXt4OuUXmr_76PhggLvrr6fs3Anc5YjH9rv10NQiHWLNCJ-w@mail.gmail.com>

On Fri, Mar 10, 2017 at 3:26 AM, Cory Benfield <cory at lukasa.co.uk> wrote:

>
> On 9 Mar 2017, at 22:01, Jean-Paul Calderone <exarkun at twistedmatrix.com>
> wrote:
>
> Run the server with TLSMemoryBIOProtocol and use the transport's
> pauseProducing method before you attempt the shutdown?
>
> Jean-Paul
>
>
> Yup, that will work. Similarly, having two TLSMemoryBIOProtocols
> communicating together and pausing one before calling loseConnection on the
> other should also work. Essentially, any situation you can conjure where
> the closing connection will manage not to see either a TLS CloseNotify or a
> TCP FIN or RST will do the job.
>

Indeed.  For that matter, you can have them interact in-memory (maybe
StringTransport is good enough as-is, maybe not, I'm not sure) and then
just stop shuttling the bytes in one direction.  (I/O-free tests for the
win)

Jean-Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170310/aba1629d/attachment-0002.html>

From trac at twistedmatrix.com  Sun Mar 12 00:05:19 2017
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 12 Mar 2017 07:05:19 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1489302319.63.7467244579673818915@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170312/db62e0a2/attachment-0002.html>

From jamesbroadhead at gmail.com  Sun Mar 12 09:13:01 2017
From: jamesbroadhead at gmail.com (James Broadhead)
Date: Sun, 12 Mar 2017 15:13:01 +0000
Subject: [Twisted-Python] twistedmatrix.com TLS certificate
In-Reply-To: <68841104-9C0E-40F4-9189-A046C24E09DA@twistedmatrix.com>
References: <CAMcKhMRadu8v70keDo9_tn2AEgn0SABhT6+GJSsMHP3Ho7daJg@mail.gmail.com>
 <725154D7-EE02-4DFE-B332-DECA2423DBF0@lukasa.co.uk>
 <68841104-9C0E-40F4-9189-A046C24E09DA@twistedmatrix.com>
Message-ID: <CA+hid6EfRpOixKeyfpxf+g3ApS=s+sT-qrCxgCdZ-1hpxprpTg@mail.gmail.com>

Just ran into this. For interested parties, Chrome 58 is due to go stable
on Apr 25th [1]



[1] https://www.chromium.org/developers/calendar

On 7 March 2017 at 03:19, Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:

>
> On Mar 6, 2017, at 12:16 AM, Cory Benfield <cory at lukasa.co.uk> wrote:
>
>
> On 6 Mar 2017, at 07:22, Tristan Seligmann <mithrandi at mithrandi.net>
> wrote:
>
> twistedmatrix.com's current certificate is issued by StartCom
> Certification Authority; for certificates issued by this CA prior to
> 2016-09-21, the domain must be on a Chrome whitelist for it to be accepted.
> As of Chrome 58.0.3026.3 (canary/dev channel only, currently, but
> eventually this will presumably be in a release version) twistedmatrix.com
> is no longer[1] on the whitelist, which means that twistedmatrix.com will
> issue a certificate error. Can we switch to another CA? (Let's Encrypt, for
> example; I hear somebody wrote a Twisted library for using that)
>
> I'm sending this to the general list in case anyone else has been
> scratching their head about why they're getting cert warnings.
>
>
> This is an extremely good idea.
>
>
> Yes please.
>
> This is the rare ops task that will actually be quite easy for someone to
> add in to Braid as a PR: https://github.com/twisted-infra/braid
>
> If you have a look at https://github.com/twisted-infra/braid/blob/master/
> services/t-web/twisted-web/ports you might be able to guess how such a
> thing would go...
>
> -glyph
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170312/08b1ba22/attachment-0002.html>

From romanmescheryakov at yandex.ru  Mon Mar 13 13:58:00 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Mon, 13 Mar 2017 22:58:00 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
Message-ID: <1562331489435080@web25j.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170313/5cf5fb42/attachment-0002.html>

From jamesbroadhead at gmail.com  Mon Mar 13 16:04:29 2017
From: jamesbroadhead at gmail.com (James Broadhead)
Date: Mon, 13 Mar 2017 22:04:29 +0000
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1562331489435080@web25j.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
Message-ID: <CA+hid6H0nvRUBMHx4OuMea+PODeEY673gu8vR49Rj0Kx4CKjTQ@mail.gmail.com>

Hey there --

One way would be to use virtualenv to gather the dependencies without
installing them globally:

mkdir -p ~/venv
virtualenv ~/venv/twisted_docs   # `sudo pip install virtualenv` first if
you don't have this command
source ~/venv/twisted_docs/bin/activate
pip install sphinx twisted
cd <repo>/docs
make html

James

On 13 March 2017 at 19:58,   <romanmescheryakov at yandex.ru>
wrote:

>
> Hello,
>
> I managed to read documentation finally. I made a fork of Twisted
> repository using these commands:
>
>
> git clone https://github.com/<yourusername>/twisted.git Twisted
> cd Twisted
> git remote add upstream https://github.com/twisted/twisted.git
> git fetch upstream
> git branch -u upstream/trunk trunk
>
> Then created python virtualenv and installed Sphinx into it. Then I tried
> to generate narrative HTML documentation:
>
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev $ cd docs
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev/docs $ make html
> sphinx-build -b html -d _build/doctrees   . _build/html
> Running Sphinx v1.5.3
>
> Exception occurred:
>   File "conf.py", line 45, in <module>
>     from twisted import version as twisted_version_object
> ImportError: No module named twisted
> The full traceback has been saved in /tmp/sphinx-err-75zxJ8.log, if you
> want to report the issue to the developers.
> Please also report this if it was a user error, so that a better error
> message can be provided next time.
> A bug report can be filed in the tracker at <https://github.com/sphinx-
> doc/sphinx/issues>. Thanks!
> Makefile:53:      html
> make: *** [html]  1
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev/docs $
>
> Please help me to resolve this error!
>
> --
> Kind regards, Roman Mescheryakov
>
>
>
> 03.03.2017, 15:25, "Jean-Paul Calderone" <exarkun at twistedmatrix.com>:
>
> On Fri, Mar 3, 2017 at 2:57 AM,   <
> romanmescheryakov at yandex.ru> wrote:
>
> Hi everyone,
>
>
> *On the documentation web page
> https://twistedmatrix.com/documents/current/core/howto/application.html
> <https://twistedmatrix.com/documents/current/core/howto/application.html>
> in the Customizing twistd logging section there are 2 examples which as I
> can see are a bit outdated in terms of imported module names and some other
> minor details. I would like to fix that. Is this change is worth doing? If
> so, please guide how can I do it. My GitHub login, if its needed, is
> RomanMeR.*
>
>
> Hi ,
>
> Thanks for your interest in improving Twisted!  Have a look at
> https://twistedmatrix.com/trac/wiki/TwistedDevelopment and then let us
> know if you have further questions.
>
> Jean-Paul
>
> ,
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170313/9f09665d/attachment-0002.html>

From rodrigc at crodrigues.org  Mon Mar 13 22:24:32 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Mon, 13 Mar 2017 21:24:32 -0700
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1562331489435080@web25j.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
Message-ID: <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>

On Mon, Mar 13, 2017 at 12:58 PM,   <
romanmescheryakov at yandex.ru> wrote:

>
>
> Exception occurred:
>   File "conf.py", line 45, in <module>
>     from twisted import version as twisted_version_object
> ImportError: No module named twisted
>
>
Looks like Twisted needs to be installed in order to build the docs.

I would suggest using a virtualenv for everything, and installing Twisted
from your checkout into it in it.


python -m virtualenv my_venv   # Python 2

or

python3 -m venv my_venv         # Python 3

source my_venv/bin/activate
#
git clone https://github.com/<yourusername>/twisted.git Twisted
cd Twisted
python setup.py develop    # this installs Twisted in your virtual env
git remote add upstream https://github.com/twisted/twisted.git
git fetch upstream
git branch -u upstream/trunk trunk
#
pip install sphinx
cd docs
make html



--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170313/e3a4c734/attachment-0002.html>

From rodrigc at crodrigues.org  Tue Mar 14 00:03:07 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Mon, 13 Mar 2017 23:03:07 -0700
Subject: [Twisted-Python] Problem with "dev" version number generated by
	incremental
Message-ID: <CAG=rPVcDuJvSfNCcDSa3Sp2JET2payzKNFt7nEgYoTb=_rbQgg@mail.gmail.com>

Hi,

I tried to use a "dev" version of Twisted, and ran into some
problems with the version number generated by incremental:

https://github.com/hawkowl/incremental/issues/29

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170313/95a57a12/attachment-0002.html>

From glyph at twistedmatrix.com  Tue Mar 14 00:47:26 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Mon, 13 Mar 2017 23:47:26 -0700
Subject: [Twisted-Python]
 =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
 =?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
Message-ID: <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>


> On Mar 13, 2017, at 9:24 PM, Craig Rodrigues <rodrigc at crodrigues.org> wrote:
> 
> 
> 
> On Mon, Mar 13, 2017 at 12:58 PM,   <romanmescheryakov at yandex.ru <mailto:romanmescheryakov at yandex.ru>> wrote:
>  
>  
> Exception occurred:
>   File "conf.py", line 45, in <module>
>     from twisted import version as twisted_version_object
> ImportError: No module named twisted
> 
> 
> Looks like Twisted needs to be installed in order to build the docs.
> 
> I would suggest using a virtualenv for everything, and installing Twisted
> from your checkout into it in it.

My suggestion would be to use the tox environments for this that we already provide :).

`tox -e apidocs` will build the API documentation, and `tox -e narrativedocs` will build the narrative documentation.  This has the advantage that if we change the required packages for doc-building in the future, these commands will automatically re-build an appropriate virtualenv for the task.

To discover what environments are available, `tox -l`.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170313/84747c5c/attachment-0002.html>

From romanmescheryakov at yandex.ru  Tue Mar 14 01:53:00 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Tue, 14 Mar 2017 10:53:00 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
Message-ID: <1971331489477980@web1o.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170314/9f2e63ff/attachment-0002.html>

From glyph at twistedmatrix.com  Tue Mar 14 02:47:11 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 14 Mar 2017 01:47:11 -0700
Subject: [Twisted-Python]
 =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
 =?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <1971331489477980@web1o.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
Message-ID: <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>


> On Mar 14, 2017, at 12:53 AM,   <romanmescheryakov at yandex.ru> wrote:
> 
> I decided to try Glyph's suggestion first.
> By the way, I'm trying to compile twisted documentation on Raspbian, is this platform suitable for that?
> The steps I performed just were:
> sudo pip install tox (Glyph said I shouldn't install packages globally but it's too late for this Raspbian installation...)
> Changed current directory to that where tox.ini resides
> I didn't activate any virtual environments
> tox -e narrativedocs
> The result was fail, if I understood correctly, due to this error:
>  
>   Running setup.py bdist_wheel for cryptography: started
>   Running setup.py bdist_wheel for cryptography: finished with status 'error'
>   Complete output from command /home/pi/ColourDreams/Twisted-dev/build/narrativedocs/bin/python -u -c "import setuptools, tokenize;__file__='/tmp/pip-build-LEVwwA/cryptography/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" bdist_wheel -d /tmp/tmpTiRC7Rpip-wheel- --python-tag cp27:
>   Package libffi was not found in the pkg-config search path.
>   Perhaps you should add the directory containing `libffi.pc'
>   to the PKG_CONFIG_PATH environment variable
>   No package 'libffi' found
>  
> Maybe it's because Raspbian is not suitable for twisted development? If this is the case, can I use Windows?

Raspbian should be fine, but you do have to have enough dependencies installed.  In this case you need to apt install libffi-dev and openssl-dev; it will be slow to build the first time (for each version of python) but it will speed up a lot after that due to build caching.

(Specifically this is because it is building Cryptography, which does not yet ship a manylinux1 wheel.)

Let me know if that works,

-g




-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170314/abddb2dd/attachment-0002.html>

From romanmescheryakov at yandex.ru  Tue Mar 14 07:28:12 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Tue, 14 Mar 2017 16:28:12 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
Message-ID: <4533161489498092@web20o.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170314/8d5bd49c/attachment-0002.html>

From glyph at twistedmatrix.com  Tue Mar 14 23:42:16 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 14 Mar 2017 22:42:16 -0700
Subject: [Twisted-Python]
 =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
 =?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <4533161489498092@web20o.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
Message-ID: <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>


> On Mar 14, 2017, at 6:28 AM,   <romanmescheryakov at yandex.ru> wrote:
> 
> I installed libffi-dev and libssl-dev Raspbian packages, and run "tox -e narrativedocs" again. Now the error was about missing "sphinx-build" executable. So I activated virtualenv where Sphinx was previously installed and again issued "tox -e narrativedocs". Now the output was:
>  
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev $ tox -e narrativedocs
> GLOB sdist-make: /home/pi/ColourDreams/Twisted-dev/setup.py
> narrativedocs inst-nodeps: /home/pi/ColourDreams/Twisted-dev/build/dist/Twisted-17.1.0dev0.zip
> narrativedocs installed: appdirs==1.4.3,asn1crypto==0.21.1,attrs==16.3.0,Automat==0.5.0,constantly==15.1.0,enum34==1.1.6,idna==2.5,incremental==16.10.1,ipaddress==1.0.18,packaging==16.8,pycparser==2.17,pyflakes==1.5.0,pyparsing==2.2.0,requests==2.13.0,six==1.10.0,Twisted==17.1.0.dev0,zope.interface==4.3.3
> narrativedocs runtests: PYTHONHASHSEED='496434055'
> narrativedocs runtests: commands[0] | python -c import sys; print(sys.prefix)
> /home/pi/ColourDreams/Twisted-dev/build/narrativedocs
> narrativedocs runtests: commands[1] | python -c import sys; print(sys.exec_prefix)
> /home/pi/ColourDreams/Twisted-dev/build/narrativedocs
> narrativedocs runtests: commands[2] | python -c import sys; print(sys.executable)
> /home/pi/ColourDreams/Twisted-dev/build/narrativedocs/bin/python
> narrativedocs runtests: commands[3] | python --version
> Python 2.7.9
> narrativedocs runtests: commands[4] | sphinx-build -aW -b html -d /home/pi/ColourDreams/Twisted-dev/docs/_build /home/pi/ColourDreams/Twisted-dev/docs /home/pi/ColourDreams/Twisted-dev/docs/_build/
> WARNING:test command found but not installed in testenv
>   cmd: /home/pi/twisted-dev-env/bin/sphinx-build
>   env: /home/pi/ColourDreams/Twisted-dev/build/narrativedocs
> Maybe you forgot to specify a dependency? See also the whitelist_externals envconfig setting.
> Running Sphinx v1.5.3
>  
> Exception occurred:
>   File "conf.py", line 45, in <module>
> ImportError: No module named twisted
> The full traceback has been saved in /tmp/sphinx-err-s9PZVd.log, if you want to report the issue to the developers.
> Please also report this if it was a user error, so that a better error message can be provided next time.
> A bug report can be filed in the tracker at <https://github.com/sphinx-doc/sphinx/issues>. Thanks!
> ERROR: InvocationError: '/home/pi/twisted-dev-env/bin/sphinx-build -aW -b html -d /home/pi/ColourDreams/Twisted-dev/docs/_build /home/pi/ColourDreams/Twisted-dev/docs /home/pi/ColourDreams/Twisted-dev/docs/_build/'
> __________________________________________________________ summary __________________________________________________________
> ERROR:   narrativedocs: commands failed
> (twisted-dev-env) pi at zyuzino11:~/ColourDreams/Twisted-dev $
>  
> The error is "twisted" module missing. How could I fix that? Should I install Twisted Python package to my virtualenv? Now I only have Twisted Python package installed globally.

From what I've seen here, it doesn't look like you've done anything wrong - this should work.  So it's going to require some investigation.

I don't know why it would be choosing to 'inst-nodeps' when the deps clearly aren't installed yet.  When I do this, what I see is:

GLOB sdist-make: /Users/glyph/Projects/Twisted/setup.py
narrativedocs create: /Users/glyph/Projects/Twisted/build/narrativedocs
narrativedocs inst: /Users/glyph/Projects/Twisted/build/dist/Twisted-17.1.0.dev0.zip
narrativedocs installed: alabaster==0.7.10,amptrac==0.1,appdirs==1.4.3,asn1crypto==0.21.1,astroid==1.4.9,attrs==16.3.0,Automat==0.5.0,Babel==2.3.4,cffi==1.9.1,colorama==0.3.7,constantly==15.1.0,cryptography==1.8.1,docutils==0.13.1,enum34==1.1.6,epydoc==3.0.1,extras==1.0.0,fixtures==3.0.0,idna==2.5,imagesize==0.7.1,incremental==16.10.1,ipaddress==1.0.18,Jinja2==2.9.5,lazy-object-proxy==1.2.2,linecache2==1.0.0,logilab-common==1.2.1,MarkupSafe==1.0,packaging==16.8,pbr==2.0.0,pyasn1==0.2.3,pyasn1-modules==0.0.8,pycodestyle==2.0.0,pycparser==2.17,pydoctor==16.3.0,pyflakes==1.5.0,Pygments==2.2.0,pylint==1.5.6,pyOpenSSL==16.2.0,pyparsing==2.2.0,python-mimeparse==1.6.0,python-subunit==1.2.0,pytz==2016.10,requests==2.13.0,service-identity==16.0.0,six==1.10.0,snowballstemmer==1.2.1,Sphinx==1.5.3,testtools==2.2.0,traceback2==1.4.0,treq==16.12.0,Twisted==17.1.0.dev0,twisted-dev-tools==0.0.2,twistedchecker==0.7.1,unittest2==1.1.0,wrapt==1.10.10,zope.interface==4.3.3
narrativedocs runtests: PYTHONHASHSEED='3320851011'
narrativedocs runtests: commands[0] | python -c import sys; print(sys.prefix)
/Users/glyph/Projects/Twisted/build/narrativedocs/bin/..
narrativedocs runtests: commands[1] | python -c import sys; print(sys.exec_prefix)
/Users/glyph/Projects/Twisted/build/narrativedocs/bin/..
narrativedocs runtests: commands[2] | python -c import sys; print(sys.executable)
/Users/glyph/Projects/Twisted/build/narrativedocs/bin/python
narrativedocs runtests: commands[3] | python --version
Python 2.7.12
narrativedocs runtests: commands[4] | sphinx-build -aW -b html -d /Users/glyph/Projects/Twisted/docs/_build /Users/glyph/Projects/Twisted/docs /Users/glyph/Projects/Twisted/docs/_build/
Running Sphinx v1.5.3
making output directory...
loading pickled environment... not yet created
loading intersphinx inventory from http://docs.python.org/3.3/objects.inv...
intersphinx inventory has moved: http://docs.python.org/3.3/objects.inv -> https://docs.python.org/3.3/objects.inv
loading intersphinx inventory from http://docs.python.org/2.7/objects.inv...
intersphinx inventory has moved: http://docs.python.org/2.7/objects.inv -> https://docs.python.org/2.7/objects.inv
building [mo]: all of 0 po files
building [html]: all source files
updating environment: 135 added, 0 changed, 0 removed
reading sources... [100%] words/index                                                              
looking for now-outdated files... none found
pickling environment... done
checking consistency... done
preparing documents... done
writing output... [100%] words/index                                                               
generating indices... genindex
writing additional pages... search
copying images... [100%] web/howto/../img/web-process.png                                          
copying downloadable files... [ 58%] core/howto/tutorial/listings/finger/twisted/plugins/finger_tutcopying downloadable files... [ 84%] core/howto/listings/systemd/www.example.com.socketactivated.secopying downloadable files... [100%] core/howto/tutorial/listings/finger/fingerPBclient.py         
copying static files... done
copying extra files... done
dumping search index in English (code: en) ... done
dumping object inventory... done
build succeeded.
_____________________________________________ summary _____________________________________________
  narrativedocs: commands succeeded
  congratulations :)


So, a few questions for you:

Are you running the latest `tox`? (tox --version == 2.6.0)
This is not the first time you've run 'tox', or it would have the 'narrativedocs create' line above.  Did you see what happened on the earlier runs?  Did they all fail?
Can you try re-creating the virtual environment?  Either `tox -r -e narrativedocs` or `rm -fr build/; tox -e narrativedocs`
Can you try doing this against a 'dev' install, i.e. `tox --develop -e narrativedocs`?
What happens if you make a new virtual environment and do `pip install .../path/to/twisted[dev]` (just .[dev] if you're in the twisted dir)?  Specifically: does sphinx get installed in that virtual environment?
Did you copy this development environment from another machine, or move it to a different folder?

Hopefully we can get to the bottom of this and learn something for future contributors about whatever pitfall you've encountered!

Thanks for your patience,

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170314/9e9d0fbc/attachment-0002.html>

From romanmescheryakov at yandex.ru  Wed Mar 15 09:28:23 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Wed, 15 Mar 2017 18:28:23 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
Message-ID: <4741489591703@web42g.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170315/a131c2e7/attachment-0002.html>

From glyph at twistedmatrix.com  Wed Mar 15 22:41:12 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Wed, 15 Mar 2017 21:41:12 -0700
Subject: [Twisted-Python]
 =?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
 =?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <4741489591703@web42g.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
 <4741489591703@web42g.yandex.ru>
Message-ID: <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>


> On Mar 15, 2017, at 8:28 AM,   <romanmescheryakov at yandex.ru> wrote:
> 
>  
> > Are you running the latest `tox`? (tox --version == 2.6.0)
> Yes
>  
> > This is not the first time you've run 'tox', or it would have the 'narrativedocs create' line above.  Did you see what happened on the earlier runs?  Did they all fail?
> 
> Yes, they all failed. I don't have tox output from previous runs. As I remember, the first 'tox -e narrativedocs' run failed because of missing libffi dependency, so this is possible first step one needs to reproduce the problem with running 'narrativedocs inst-nodeps' instead of 'narrativedocs create'.
>  
> > Did you copy this development environment from another machine, or move it to a different folder?
> No
>  
> > Can you try re-creating the virtual environment?  Either `tox -r -e narrativedocs` or `rm -fr build/; tox -e narrativedocs`
>  
> I tried the `tox -r -e narrativedocs` command and it succeeded! Docs built successfully.
>  
> Thank you Glyph for helping :) And thanks to all who responded as well! :)

You're welcome!  Glad we got you up and running, sorry we couldn't figure out what the problem was.

> One thing that is left unclear to me: the `narrativedocs installed` line in the tox output contains a long list of installed modules. Where were they installed? Because `pip list` doesn't show me them neither for the virtual environment which was active when I run tox nor for the global list.

`tox` is a tool which creates multiple virtualenvs for testing a project in multiple configurations, and for running multiple tasks associated with a project.  (Like, for example, generating narrative documentation.)

Twisted is weird and puts its tox venvs in 'build/<envname>'; normally they're in '.tox/envname'. (see http://twistedmatrix.com/trac/ticket/9040).  You can find your venv in build/narrativedocs.

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170315/afa6be2f/attachment-0002.html>

From romanmescheryakov at yandex.ru  Thu Mar 16 02:33:49 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Thu, 16 Mar 2017 11:33:49 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
 <4741489591703@web42g.yandex.ru>
 <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>
Message-ID: <2333441489653229@web34j.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170316/ee554a1c/attachment-0002.html>

From romanmescheryakov at yandex.ru  Thu Mar 16 02:36:32 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Thu, 16 Mar 2017 11:36:32 +0300
Subject: [Twisted-Python] Bugs #8264 and #8037 seems to be duplicates
Message-ID: <2354741489653392@web34j.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170316/a0705f68/attachment-0002.html>

From rodrigc at crodrigues.org  Thu Mar 16 03:26:12 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Thu, 16 Mar 2017 02:26:12 -0700
Subject: [Twisted-Python] =?utf-8?q?_Minor_fixes_in_the_=E2=80=9CCustomizi?=
	=?utf-8?q?ng_twistd_logging=E2=80=9D_section?=
In-Reply-To: <2333441489653229@web34j.yandex.ru>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
 <4741489591703@web42g.yandex.ru>
 <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>
 <2333441489653229@web34j.yandex.ru>
Message-ID: <CAG=rPVdXktH+sUae1rx7iTB8_QiB5xqubQ0Ss-HhrWNZFxsAVA@mail.gmail.com>

On Thursday, March 16, 2017,   <romanmescheryakov at yandex.ru
<javascript:_e(%7B%7D,'cvml','romanmescheryakov at yandex.ru');>> wrote:

>
> OK, got it.
>
> Back to the subject of this e-mail, I created ticket #9084
> <https://twistedmatrix.com/trac/ticket/9084> and attached proposed fix to
> it. Of course, there are many newbie questions related to that:
>
>    1. Did I filled bug correctly?
>
>
I think the bug you filed is fine.

>
>    1. Is it right that I uploaded fix immediately to the just-created bug?
>
>
Instead of uploading the patch to Trac, it is preferred that you follow the
procedures here, even for a documentation patch.

http://twistedmatrix.com/trac/wiki/TwistedDevelopment#SubmittingaPatch

That includes all the steps for GitHub, Newsfile, setting the "review"
keyword on the Trac ticket, etc.

Thank you for your patience, and contributions to Twisted, especially for
the docs, which is important for new users

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170316/f24be302/attachment-0002.html>

From glyph at twistedmatrix.com  Thu Mar 16 20:55:32 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 16 Mar 2017 19:55:32 -0700
Subject: [Twisted-Python] Bugs #8264 and #8037 seems to be duplicates
In-Reply-To: <2354741489653392@web34j.yandex.ru>
References: <2354741489653392@web34j.yandex.ru>
Message-ID: <0A2C651F-0D84-4509-AB4C-12AD4DC01DFB@twistedmatrix.com>

> On Mar 16, 2017, at 1:36 AM,   <romanmescheryakov at yandex.ru> wrote:
> 
>  
> Maybe one of them should be closed as duplicate:
>  
> #8264 <https://twistedmatrix.com/trac/ticket/8264> STDLibLoggingObserver doesn't log traceback from unhandled Deferred errors
> #8037 <https://twistedmatrix.com/trac/ticket/8037> STDLibLogObserver eats unhandled errors in Deferreds
>  
> -- 
> Kind regards, Roman Mescheryakov

I closed the latter as a duplicate.  Feel free to do this (with comments on both tickets, as you can see I put on those) if you find more dups :).

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170316/a401aba0/attachment-0002.html>

From romanmescheryakov at yandex.ru  Fri Mar 17 03:18:01 2017
From: romanmescheryakov at yandex.ru (=?utf-8?B?0KDQvtC80LDQvSDQnNC10YnQtdGA0Y/QutC+0LI=?=)
Date: Fri, 17 Mar 2017 12:18:01 +0300
Subject: [Twisted-Python]
	=?utf-8?q?Minor_fixes_in_the_=E2=80=9CCustomizin?=
	=?utf-8?q?g_twistd_logging=E2=80=9D_section?=
In-Reply-To: <CAG=rPVdXktH+sUae1rx7iTB8_QiB5xqubQ0Ss-HhrWNZFxsAVA@mail.gmail.com>
References: <1795181488527858@web23h.yandex.ru>
 <CAEeXt4ORU9sjQhycdswoa211cuLgemZ5TA0u=b+ks7eHmOj0sA@mail.gmail.com>
 <1562331489435080@web25j.yandex.ru>
 <CAG=rPVeG5uREojJk-ACjNNLocgsJzqGq3MuoinYMb0o5Qzzdcg@mail.gmail.com>
 <DEE1EA6C-5F83-46A0-B21E-415E319B52C1@twistedmatrix.com>
 <1971331489477980@web1o.yandex.ru>
 <C56F0148-637F-45FA-A88A-29B95FF32002@twistedmatrix.com>
 <4533161489498092@web20o.yandex.ru>
 <37E6EDD9-DE05-4911-BF42-E6B670F9B56B@twistedmatrix.com>
 <4741489591703@web42g.yandex.ru>
 <2B34EA89-5D62-4E20-A606-C65CC0635298@twistedmatrix.com>
 <2333441489653229@web34j.yandex.ru>
 <CAG=rPVdXktH+sUae1rx7iTB8_QiB5xqubQ0Ss-HhrWNZFxsAVA@mail.gmail.com>
Message-ID: <2629331489742281@web53g.yandex.ru>

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170317/a114caa2/attachment-0002.html>

From trac at twistedmatrix.com  Sun Mar 19 00:05:18 2017
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 19 Mar 2017 06:05:18 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1489903518.52.5346141693720610651@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170319/158aa3ae/attachment-0002.html>

From glyph at twistedmatrix.com  Fri Mar 24 22:14:27 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Fri, 24 Mar 2017 21:14:27 -0700
Subject: [Twisted-Python] in case there's downtime
Message-ID: <27D41B92-7262-4EC3-BA25-E537971221B2@twistedmatrix.com>

We've been very conservative about upgrading our operating system on twistedmatrix.com <http://twistedmatrix.com/>, since we don't want to disrupt anything.  Since our OS is one release too old to support Docker, that unfortunately means we haven't been able to migrate incrementally to containers, which creates a bit of a chicken-and-egg problem.

However, as we are days away from the end-of-life cliff for the operating system as a whole, and as I discovered a few minutes ago, dozens of packages are already unsupported and not receiving security updates, I'm going to upgrade the host OS manually, even if it results in some disruption.  As with the Twisted compatibility policy, security is a good enough reason to break stuff.

Maybe we'll even get a new version of Mailman that will let me turn automatic subscriptions back on while the star-crossed https://lists.twistedmatrix.com <https://lists.twistedmatrix.com/> project waits for someone else to help out :-).

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170324/ed618054/attachment-0002.html>

From chris.norman2 at googlemail.com  Sat Mar 25 14:21:40 2017
From: chris.norman2 at googlemail.com (Chris Norman)
Date: Sat, 25 Mar 2017 20:21:40 +0000
Subject: [Twisted-Python] in case there's downtime
In-Reply-To: <27D41B92-7262-4EC3-BA25-E537971221B2@twistedmatrix.com>
References: <27D41B92-7262-4EC3-BA25-E537971221B2@twistedmatrix.com>
Message-ID: <a07d3c3f-3e01-f605-a45e-bf06e66e9358@GOOGLEMAIL.COM>

Hi,

What needs taking over on the mailing list side? I'd love to help out if 
possible.


Cheers,


On 25/03/2017 04:14, Glyph Lefkowitz wrote:
> We've been very conservative about upgrading our operating system on 
> twistedmatrix.com <http://twistedmatrix.com>, since we don't want to 
> disrupt anything.  Since our OS is one release too old to support 
> Docker, that unfortunately means we haven't been able to migrate 
> incrementally to containers, which creates a bit of a chicken-and-egg 
> problem.
>
> However, as we are days away from the end-of-life cliff for the 
> operating system as a whole, and as I discovered a few minutes ago, 
> dozens of packages are already unsupported and not receiving security 
> updates, I'm going to upgrade the host OS manually, even if it results 
> in some disruption.  As with the Twisted compatibility policy, 
> security is a good enough reason to break stuff.
>
> Maybe we'll even get a new version of Mailman that will let me turn 
> automatic subscriptions back on while the star-crossed 
> https://lists.twistedmatrix.com project waits for someone else to help 
> out :-).
>
> -glyph
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170325/f5e576e6/attachment-0002.html>

From glyph at twistedmatrix.com  Sat Mar 25 15:01:01 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 25 Mar 2017 14:01:01 -0700
Subject: [Twisted-Python] in case there's downtime
In-Reply-To: <a07d3c3f-3e01-f605-a45e-bf06e66e9358@GOOGLEMAIL.COM>
References: <27D41B92-7262-4EC3-BA25-E537971221B2@twistedmatrix.com>
 <a07d3c3f-3e01-f605-a45e-bf06e66e9358@GOOGLEMAIL.COM>
Message-ID: <30546D75-070E-4F45-A262-525D769FFF35@twistedmatrix.com>


> On Mar 25, 2017, at 1:21 PM, Chris Norman <chris.norman2 at googlemail.com> wrote:
> 
> Hi,
> 
> What needs taking over on the mailing list side? I'd love to help out if possible.
> 

Hi Chris!

Thanks for volunteering.  If you'd like to help out with infrastructure _generally_, there's a channel on freenode, #twisted-admin, where you can show up to discuss what's going on.

As to mailing lists specifically; over a year ago now, I outlined a plan to migrate our mail infrastructure:

https://twistedmatrix.com/pipermail/twisted-python/2016-March/030189.html <https://twistedmatrix.com/pipermail/twisted-python/2016-March/030189.html>

Unfortunately, I never had nearly as much time to work on that as I'd thought I would; also, Mailgun is no longer a product of Rackspace; also, I no longer work at either Rackspace or Mailgun :).  There's also the issue that the service that https://github.com/twisted-infra/lists.twistedmatrix.com/ <https://github.com/twisted-infra/lists.twistedmatrix.com/> deploys to, Carina, is shutting down: https://getcarina.com <https://getcarina.com/>.  So we need to find a new place for it to migrate to if it's going to be a real thing.

However, the generous open-source discount that Mailgun offers to Twisted remains in place.

Originally, I'd been nervous about migrating twistedmatrix.com <http://twistedmatrix.com/> to Mailgun without having an alternate solution in place for mailing lists, because I didn't want to be blasting out any spam that we were generating via mailman and ruining our sender score there.  I was also under the impression that more of the domain-name configuration had to match up in Mailman than actually does; experiments during the latest OS upgrade indicate to me that it's a relatively small configuration change.

Disabling automatic subscriptions does seem to have mitigated that almost completely, and now we're on a recent enough OS that we'll get security updates for mailman, at least.  Plus, Mailgun will give me better visibility than I currently have if we are generating such bad messages.  As such I'll probably migrate our main mail delivery / forwarder pipeline to mailgun later today, allowing us to migrate individual addresses or lists to some other system rather than doing something all at once.

Users with @twistedmatrix.com email addresses will need to get an SMTP password token from me in order to be able to properly send outbound DKIM-signed messages.  I am pretty sure you all have alternate ways of reaching me :-).

If I manage to screw up mail routing so bad that you can't reach me via this mail address, by the way, and you need to report a problem after this move, you can send messages to mail-admin-315569 at glyph.im <mailto:mail-admin-315569 at glyph.im>.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170325/4423261f/attachment-0002.html>

From glyph at twistedmatrix.com  Sat Mar 25 18:20:21 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 25 Mar 2017 17:20:21 -0700
Subject: [Twisted-Python] Is this turned on right now?
Message-ID: <AC31315D-5D25-467C-8AD4-3E7386DC1186@twistedmatrix.com>

The answer should be "no", I believe it will bounce.

-g



From glyph at twistedmatrix.com  Sat Mar 25 19:06:18 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Sat, 25 Mar 2017 18:06:18 -0700
Subject: [Twisted-Python] Is this turned on right now?
In-Reply-To: <AC31315D-5D25-467C-8AD4-3E7386DC1186@twistedmatrix.com>
References: <AC31315D-5D25-467C-8AD4-3E7386DC1186@twistedmatrix.com>
Message-ID: <D4067282-7E97-463F-9EDE-3A96531FA0E6@twistedmatrix.com>

> On Mar 25, 2017, at 5:20 PM, Glyph Lefkowitz <glyph at twistedmatrix.com> wrote:
> 
> The answer should be "no", I believe it will bounce.

Oops! Mail delivery retries to the rescue :).

Aside from an extremely exciting hour where I accidentally created a suppression for my own address and could not test anything, this went reasonably smoothly.  (Those who might want to help us out with ops: we now exclusively use exim for routing messages to mailman, and maybe delivering some emails from Trac; it no longer sends messages to users.  So we could maybe make a Docker container out of that.)

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170325/522c3df2/attachment-0002.html>

From trac at twistedmatrix.com  Sun Mar 26 00:05:20 2017
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 26 Mar 2017 06:05:20 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1490508320.36.5011797527353855320@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170326/c3fb4cb6/attachment-0002.html>

From jamohamm at cisco.com  Mon Mar 27 03:33:13 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Mon, 27 Mar 2017 09:33:13 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
Message-ID: <D4FED790.297AAF%jamohamm@cisco.com>

Hi Team,

Wanted to bring one code changes which is really required from twisted side otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted is failing when we negotiate any kex algorithm based on SHA1 and we have MAC as hmac-sha2-512. The reason for the failure was the below code

hashProcessor = _kex.getHashProcessor(self.kexAlg)
        k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
        k1 = k1.digest()
        k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
return k1 + k2

For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it will only generate 40 byte key and that induce a failure. So we need to modify the code as below to make it generic and make it comply with RFC (rfc4253 Section 7.2). So that twisted can work irrespective of what kex is been used. Actual code should plot in is like below

hashProcessor = _kex.getHashProcessor(self.kexAlg)
        k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
        k1 = k1.digest()
        k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
return k1 + k2 + k3 + k4

Can somebody help me to plot this fix so that twisted will work fine with all the other servers out there and even make it comply to the RFC. Thanks in advance and this will be my first findings on twisted code ;). Please let me know in case of any doubt on the same. Code changes should be plotted in to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py . Please help me with this commit team.


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Wednesday, 1 March 2017 9:26 am
To: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>
Cc: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>
Subject: Re: Regarding the SHA 512 support in twisted.

This doesn't appear to be a security issue. You can file an issue on the public tracker.

Alex

On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm) <jamohamm at cisco.com<mailto:jamohamm at cisco.com>> wrote:

Thanks Alex for the response. In our server we added support of HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to negotiate this hmac with most of the other client like Paramiko, OpenSSH and other flavours of SSH its working fine. But we are seeing a problem with twisted client that too only with HMAC-SHA-512. We have a limitation from our side to debug this since we dont know what is happening from the client side. We have taken our derived key for the HMAC and as well as the input to derive the MAC using online tools and it matches with whatever we have generated but whatever is been sent across the other Twisted side differs and we are closing the session. This is been tagged critical since most of the customers are migrating to Twisted and will be a deployment blocker for us.

What we suspect is the key or the algorithm itself. Please see the snippet below

This is our inmac Key
----------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: inmac.key
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - a5 cb a5 bb 4c 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010<tel:0010> - 1c e1 3f d9 a7 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020<tel:0020> - 2a bc 53 c6 85 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030<tel:0030> - d9 a5 0e 73 d0 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p<http://s.Dy...2;&..p>

This is our input data to the hmac-sha-512
-----------------------------------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: input.data to HMAC API
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - 00 00 00 03 00 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010<tel:0010> - 68 2d 75 73 65 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020<tel:0020> - ba 7e 56 e5                                       .~V.

The digest which is been sent from the twisted client side(Red)
-----------------------------------------------------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: digest
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - 95 f7 99 27 48 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010<tel:0010> - 93 d1 4d 46 5f d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020<tel:0020> - 84 a9 58 60 5e 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030<tel:0030> - 4b 1d 05 2d a4 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[

The digest which got created from our side using the same key and input data mentioned above(Green)

RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000<tel:0000> - 36 36 5c 6e 2d be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010<tel:0010> - 0e e8 d6 96 6e 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020<tel:0020> - 7c c8 15 b8 5a 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030<tel:0030> - 32 63 61 5e f5 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.

If you see the details this is the useauth first packet and we are not able to proceed because of the failure. We used online tool to do this calculation and we are getting the same output as what we generated so the one marked as red is creating problem.So the root cause could be either the key which is been derived or the algorithm so to debug that we need to enable details logging from client side. We can share the details with respective engineer and show what we are facing. Please help.

Online tool which we used to check our algorithm is: which result in same MAC marked as green.

https://www.liavaag.org/English/SHA-Generator/HMAC/


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Wednesday, 1 March 2017 6:39 am
To: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>
Cc: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>
Subject: Re: FW: Regarding the SHA 512 support in twisted.

Hi,

I think I'm missing some context here, what part of twisted are you trying to use SHA-512 for a MAC with? It sounds like Conch? Can you show how I could reproduce the problem?

Alex

On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>> wrote:
Hi,

Forwarding on to security contact to see if they think it's a security problem; otherwise you can probably just file a normal ticket.


On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
Hi Team,


Wanted to cross check on SHA 512 algorithm as MAC while using twisted. Few of our customers started using Twisted and even we are trying to incorporate some scripts via twisted client. But what we have noticed is that when we negotiate SHA 512 MAC with twisted we always get a failure and other MAC algorithms are working fine with twisted. So wanted to cross check do we have any bug or any issue with SHA 512 and twisted and how we can debug this from twisted side.

We checked the same with other OpenSSH client and even paramiko things work perfectly fine so wanted to debug further from the twisted side. We checked with the same derived key and the output whatever we got from SHA 512 is what we are getting from the online tool so we suspect something to do with the key or hash algorithm from the other side.

We used the twisted 16.6.0 version for testing, thanks in advance for looking in to this email.



Thanks,

Jabir

     \|/

    -------

   (  o o  )

oooO---O---Oooonull



--
Itamar Turner-Trauring





--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6




--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170327/68a79938/attachment-0002.html>

From adi at roiban.ro  Mon Mar 27 04:36:47 2017
From: adi at roiban.ro (Adi Roiban)
Date: Mon, 27 Mar 2017 11:36:47 +0100
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <D4FED790.297AAF%jamohamm@cisco.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
Message-ID: <CAFycZ9cL5k=Hu-S0_ucaK_ZEjDtUMw822ZUmyqsGV2b1wZRwFg@mail.gmail.com>

Hi Jarib,

Thanks for the details.

On 27 March 2017 at 10:33, jabir Mohammed (jamohamm) <jamohamm at cisco.com> wrote:
> Hi Team,
>
> Wanted to bring one code changes which is really required from twisted side
> otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted is
> failing when we negotiate any kex algorithm based on SHA1 and we have MAC as
> hmac-sha2-512. The reason for the failure was the below code
>
> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>         k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
>         k1 = k1.digest()
>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
> return k1 + k2
>
> For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it will
> only generate 40 byte key and that induce a failure. So we need to modify
> the code as below to make it generic and make it comply with RFC (rfc4253
> Section 7.2). So that twisted can work irrespective of what kex is been
> used. Actual code should plot in is like below
>
> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>         k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
>         k1 = k1.digest()
>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
> k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
> k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
> return k1 + k2 + k3 + k4
>
> Can somebody help me to plot this fix so that twisted will work fine with
> all the other servers out there and even make it comply to the RFC. Thanks
> in advance and this will be my first findings on twisted code ;). Please let
> me know in case of any doubt on the same. Code changes should be plotted in
> to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py .
> Please help me with this commit team.

Happy to help.

Here should be the documentation for contributing  (hopefully is up to date)

http://twistedmatrix.com/trac/wiki/TwistedDevelopment

The first thing is to fork twisted/twisted, apply the change on the
branch and then create a PR.

By creating the PR, you will trigger some of the automated tests and
you can get a quick feedback.
.. for example to see if your changes are not introducing any regressions.

In an ideal world before making the changes and creating a simple
example so that we can manually check the changes you start by
updating the existing automated test to make sure that we don't
introduce regressions in the feature (as a non exhaustive list of
reasons)

You can use this file
https://github.com/twisted/twisted/blob/trunk/docs/conch/examples/sshsimpleserver.py
as the foundation for a simple example.
In the PR you can provide the client-side command use for the manual test

Looking forward for you PR.
I can help with the review and/or writing the automated tests.

You can also find me on #twisted-dev

Thanks,
Adi

> From: Alex Gaynor <alex.gaynor at gmail.com>
> Date: Wednesday, 1 March 2017 9:26 am
> To: jabir mohammed <jamohamm at cisco.com>
> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
> "security at twistedmatrix.com" <security at twistedmatrix.com>
> Subject: Re: Regarding the SHA 512 support in twisted.
>
> This doesn't appear to be a security issue. You can file an issue on the
> public tracker.
>
> Alex
>
> On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm)
> <jamohamm at cisco.com> wrote:
>>
>>
>> Thanks Alex for the response. In our server we added support of
>> HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to negotiate this
>> hmac with most of the other client like Paramiko, OpenSSH and other flavours
>> of SSH its working fine. But we are seeing a problem with twisted client
>> that too only with HMAC-SHA-512. We have a limitation from our side to debug
>> this since we dont know what is happening from the client side. We have
>> taken our derived key for the HMAC and as well as the input to derive the
>> MAC using online tools and it matches with whatever we have generated but
>> whatever is been sent across the other Twisted side differs and we are
>> closing the session. This is been tagged critical since most of the
>> customers are migrating to Twisted and will be a deployment blocker for us.
>>
>> What we suspect is the key or the algorithm itself. Please see the snippet
>> below
>>
>> This is our inmac Key
>> ----------------------------
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>> inmac.key
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - a5 cb a5 bb 4c
>> 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 1c e1 3f d9 a7
>> 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - 2a bc 53 c6 85
>> 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030 - d9 a5 0e 73 d0
>> 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p
>>
>> This is our input data to the hmac-sha-512
>> -----------------------------------------------------
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>> input.data to HMAC API
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 00 00 00 03 00
>> 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 68 2d 75 73 65
>> 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - ba 7e 56 e5
>> .~V.
>>
>> The digest which is been sent from the twisted client side(Red)
>> -----------------------------------------------------------------------
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>> digest
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 95 f7 99 27 48
>> 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 93 d1 4d 46 5f
>> d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 84 a9 58 60 5e
>> 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 4b 1d 05 2d a4
>> 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[
>>
>> The digest which got created from our side using the same key and input
>> data mentioned above(Green)
>> 
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000 - 36 36 5c 6e 2d
>> be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 0e e8 d6 96 6e
>> 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 7c c8 15 b8 5a
>> 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 32 63 61 5e f5
>> 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.
>>
>> If you see the details this is the useauth first packet and we are not
>> able to proceed because of the failure. We used online tool to do this
>> calculation and we are getting the same output as what we generated so the
>> one marked as red is creating problem.So the root cause could be either the
>> key which is been derived or the algorithm so to debug that we need to
>> enable details logging from client side. We can share the details with
>> respective engineer and show what we are facing. Please help.
>>
>> Online tool which we used to check our algorithm is: which result in same
>> MAC marked as green.
>>
>> https://www.liavaag.org/English/SHA-Generator/HMAC/
>>
>>
>> Thanks,
>>
>> Jabir
>>
>>      \|/
>>
>>     -------
>>
>>    (  o o  )
>>
>> oooO---O---Oooonull
>>
>>
>> From: Alex Gaynor <alex.gaynor at gmail.com>
>> Date: Wednesday, 1 March 2017 6:39 am
>> To: Itamar Turner-Trauring <itamar at itamarst.org>
>> Cc: jabir mohammed <jamohamm at cisco.com>, "security at twistedmatrix.com"
>> <security at twistedmatrix.com>
>> Subject: Re: FW: Regarding the SHA 512 support in twisted.
>>
>> Hi,
>>
>> I think I'm missing some context here, what part of twisted are you trying
>> to use SHA-512 for a MAC with? It sounds like Conch? Can you show how I
>> could reproduce the problem?
>>
>> Alex
>>
>> On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring
>> <itamar at itamarst.org> wrote:
>>>
>>> Hi,
>>>
>>> Forwarding on to security contact to see if they think it's a security
>>> problem; otherwise you can probably just file a normal ticket.
>>>
>>>
>>> On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
>>>
>>> Hi Team,
>>>
>>>
>>> Wanted to cross check on SHA 512 algorithm as MAC while using twisted.
>>> Few of our customers started using Twisted and even we are trying to
>>> incorporate some scripts via twisted client. But what we have noticed is
>>> that when we negotiate SHA 512 MAC with twisted we always get a failure and
>>> other MAC algorithms are working fine with twisted. So wanted to cross check
>>> do we have any bug or any issue with SHA 512 and twisted and how we can
>>> debug this from twisted side.
>>>
>>> We checked the same with other OpenSSH client and even paramiko things
>>> work perfectly fine so wanted to debug further from the twisted side. We
>>> checked with the same derived key and the output whatever we got from SHA
>>> 512 is what we are getting from the online tool so we suspect something to
>>> do with the key or hash algorithm from the other side.
>>>
>>> We used the twisted 16.6.0 version for testing, thanks in advance for
>>> looking in to this email.
>>>



-- 
Adi Roiban



From jamohamm at cisco.com  Mon Mar 27 05:07:41 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Mon, 27 Mar 2017 11:07:41 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAFRnB2X4MBj1cieSjMRmS-NW9kRcW1yRAPmCC49gm43waja-pA@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAFRnB2X4MBj1cieSjMRmS-NW9kRcW1yRAPmCC49gm43waja-pA@mail.gmail.com>
Message-ID: <D4FEEFD4.297C13%jamohamm@cisco.com>


Its a security issue even you are allowing a weaker key in case of 64 bytes deriving only 40 bytes. Let me know how we issue a tracker bug can you please guide me. Since dont want someone else to waist effort in debugging the same issue.


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Monday, 27 March 2017 4:34 pm
To: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>
Cc: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>, Twisted general discussion <twisted-python at twistedmatrix.com<mailto:twisted-python at twistedmatrix.com>>, "twisted-python-bounces at twistedmatrix.com<mailto:twisted-python-bounces at twistedmatrix.com>" <twisted-python-bounces at twistedmatrix.com<mailto:twisted-python-bounces at twistedmatrix.com>>
Subject: Re: Regarding the SHA 512 support in twisted.

This is not a security issue, so this address isn't the right place for this discussion. Please use the public twisted issue tracker.

Alex

On Mon, Mar 27, 2017 at 5:33 AM, jabir Mohammed (jamohamm) <jamohamm at cisco.com<mailto:jamohamm at cisco.com>> wrote:
Hi Team,

Wanted to bring one code changes which is really required from twisted side otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted is failing when we negotiate any kex algorithm based on SHA1 and we have MAC as hmac-sha2-512. The reason for the failure was the below code

hashProcessor = _kex.getHashProcessor(self.kexAlg)
        k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
        k1 = k1.digest()
        k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
return k1 + k2

For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it will only generate 40 byte key and that induce a failure. So we need to modify the code as below to make it generic and make it comply with RFC (rfc4253 Section 7.2). So that twisted can work irrespective of what kex is been used. Actual code should plot in is like below

hashProcessor = _kex.getHashProcessor(self.kexAlg)
        k1 = hashProcessor(sharedSecret + exchangeHash + c + self.sessionID)
        k1 = k1.digest()
        k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
return k1 + k2 + k3 + k4

Can somebody help me to plot this fix so that twisted will work fine with all the other servers out there and even make it comply to the RFC. Thanks in advance and this will be my first findings on twisted code ;). Please let me know in case of any doubt on the same. Code changes should be plotted in to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py . Please help me with this commit team.


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Wednesday, 1 March 2017 9:26 am
To: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>
Cc: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>
Subject: Re: Regarding the SHA 512 support in twisted.

This doesn't appear to be a security issue. You can file an issue on the public tracker.

Alex

On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm) <jamohamm at cisco.com<mailto:jamohamm at cisco.com>> wrote:

Thanks Alex for the response. In our server we added support of HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to negotiate this hmac with most of the other client like Paramiko, OpenSSH and other flavours of SSH its working fine. But we are seeing a problem with twisted client that too only with HMAC-SHA-512. We have a limitation from our side to debug this since we dont know what is happening from the client side. We have taken our derived key for the HMAC and as well as the input to derive the MAC using online tools and it matches with whatever we have generated but whatever is been sent across the other Twisted side differs and we are closing the session. This is been tagged critical since most of the customers are migrating to Twisted and will be a deployment blocker for us.

What we suspect is the key or the algorithm itself. Please see the snippet below

This is our inmac Key
----------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: inmac.key
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - a5 cb a5 bb 4c 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010<tel:0010> - 1c e1 3f d9 a7 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020<tel:0020> - 2a bc 53 c6 85 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030<tel:0030> - d9 a5 0e 73 d0 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p<http://s.Dy...2;&..p>

This is our input data to the hmac-sha-512
-----------------------------------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: input.data to HMAC API
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - 00 00 00 03 00 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010<tel:0010> - 68 2d 75 73 65 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020<tel:0020> - ba 7e 56 e5                                       .~V.

The digest which is been sent from the twisted client side(Red)
-----------------------------------------------------------------------
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check: digest
RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000<tel:0000> - 95 f7 99 27 48 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010<tel:0010> - 93 d1 4d 46 5f d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020<tel:0020> - 84 a9 58 60 5e 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030<tel:0030> - 4b 1d 05 2d a4 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[

The digest which got created from our side using the same key and input data mentioned above(Green)

RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000<tel:0000> - 36 36 5c 6e 2d be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010<tel:0010> - 0e e8 d6 96 6e 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020<tel:0020> - 7c c8 15 b8 5a 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030<tel:0030> - 32 63 61 5e f5 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.

If you see the details this is the useauth first packet and we are not able to proceed because of the failure. We used online tool to do this calculation and we are getting the same output as what we generated so the one marked as red is creating problem.So the root cause could be either the key which is been derived or the algorithm so to debug that we need to enable details logging from client side. We can share the details with respective engineer and show what we are facing. Please help.

Online tool which we used to check our algorithm is: which result in same MAC marked as green.

https://www.liavaag.org/English/SHA-Generator/HMAC/


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: Alex Gaynor <alex.gaynor at gmail.com<mailto:alex.gaynor at gmail.com>>
Date: Wednesday, 1 March 2017 6:39 am
To: Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>>
Cc: jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>, "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>
Subject: Re: FW: Regarding the SHA 512 support in twisted.

Hi,

I think I'm missing some context here, what part of twisted are you trying to use SHA-512 for a MAC with? It sounds like Conch? Can you show how I could reproduce the problem?

Alex

On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring <itamar at itamarst.org<mailto:itamar at itamarst.org>> wrote:
Hi,

Forwarding on to security contact to see if they think it's a security problem; otherwise you can probably just file a normal ticket.


On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
Hi Team,


Wanted to cross check on SHA 512 algorithm as MAC while using twisted. Few of our customers started using Twisted and even we are trying to incorporate some scripts via twisted client. But what we have noticed is that when we negotiate SHA 512 MAC with twisted we always get a failure and other MAC algorithms are working fine with twisted. So wanted to cross check do we have any bug or any issue with SHA 512 and twisted and how we can debug this from twisted side.

We checked the same with other OpenSSH client and even paramiko things work perfectly fine so wanted to debug further from the twisted side. We checked with the same derived key and the output whatever we got from SHA 512 is what we are getting from the online tool so we suspect something to do with the key or hash algorithm from the other side.

We used the twisted 16.6.0 version for testing, thanks in advance for looking in to this email.



Thanks,

Jabir

     \|/

    -------

   (  o o  )

oooO---O---Oooonull



--
Itamar Turner-Trauring





--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6




--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6




--
"I disapprove of what you say, but I will defend to the death your right to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
"The people's good is the highest law." -- Cicero
GPG Key fingerprint: D1B3 ADC0 E023 8CA6

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170327/2cd6002b/attachment-0002.html>

From jamohamm at cisco.com  Mon Mar 27 05:11:10 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Mon, 27 Mar 2017 11:11:10 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAFycZ9cL5k=Hu-S0_ucaK_ZEjDtUMw822ZUmyqsGV2b1wZRwFg@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAFycZ9cL5k=Hu-S0_ucaK_ZEjDtUMw822ZUmyqsGV2b1wZRwFg@mail.gmail.com>
Message-ID: <D4FEF0BB.297C27%jamohamm@cisco.com>

No probs Adi, can you help me to upload the fix to the twisted since I
dont know the procedure, if you can guide me that helps. Since I was
pretty sure that this a bug in coding twisted set keys part and not comply
to RFC.


Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull




On 27/03/17 4:06 pm, "Twisted-Python on behalf of Adi Roiban"
<twisted-python-bounces at twistedmatrix.com on behalf of adi at roiban.ro>
wrote:

>Hi Jarib,
>
>Thanks for the details.
>
>On 27 March 2017 at 10:33, jabir Mohammed (jamohamm) <jamohamm at cisco.com>
>wrote:
>> Hi Team,
>>
>> Wanted to bring one code changes which is really required from twisted
>>side
>> otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted
>>is
>> failing when we negotiate any kex algorithm based on SHA1 and we have
>>MAC as
>> hmac-sha2-512. The reason for the failure was the below code
>>
>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>>self.sessionID)
>>         k1 = k1.digest()
>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>> return k1 + k2
>>
>> For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it
>>will
>> only generate 40 byte key and that induce a failure. So we need to
>>modify
>> the code as below to make it generic and make it comply with RFC
>>(rfc4253
>> Section 7.2). So that twisted can work irrespective of what kex is been
>> used. Actual code should plot in is like below
>>
>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>>self.sessionID)
>>         k1 = k1.digest()
>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>> k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
>> k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
>> return k1 + k2 + k3 + k4
>>
>> Can somebody help me to plot this fix so that twisted will work fine
>>with
>> all the other servers out there and even make it comply to the RFC.
>>Thanks
>> in advance and this will be my first findings on twisted code ;).
>>Please let
>> me know in case of any doubt on the same. Code changes should be
>>plotted in
>> to  the routine _getKey,  file name is
>>src/twisted/conch/ssh/transport.py .
>> Please help me with this commit team.
>
>Happy to help.
>
>Here should be the documentation for contributing  (hopefully is up to
>date)
>
>http://twistedmatrix.com/trac/wiki/TwistedDevelopment
>
>The first thing is to fork twisted/twisted, apply the change on the
>branch and then create a PR.
>
>By creating the PR, you will trigger some of the automated tests and
>you can get a quick feedback.
>.. for example to see if your changes are not introducing any regressions.
>
>In an ideal world before making the changes and creating a simple
>example so that we can manually check the changes you start by
>updating the existing automated test to make sure that we don't
>introduce regressions in the feature (as a non exhaustive list of
>reasons)
>
>You can use this file
>https://github.com/twisted/twisted/blob/trunk/docs/conch/examples/sshsimpl
>eserver.py
>as the foundation for a simple example.
>In the PR you can provide the client-side command use for the manual test
>
>Looking forward for you PR.
>I can help with the review and/or writing the automated tests.
>
>You can also find me on #twisted-dev
>
>Thanks,
>Adi
>
>> From: Alex Gaynor <alex.gaynor at gmail.com>
>> Date: Wednesday, 1 March 2017 9:26 am
>> To: jabir mohammed <jamohamm at cisco.com>
>> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
>> "security at twistedmatrix.com" <security at twistedmatrix.com>
>> Subject: Re: Regarding the SHA 512 support in twisted.
>>
>> This doesn't appear to be a security issue. You can file an issue on the
>> public tracker.
>>
>> Alex
>>
>> On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm)
>> <jamohamm at cisco.com> wrote:
>>>
>>>
>>> Thanks Alex for the response. In our server we added support of
>>> HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to
>>>negotiate this
>>> hmac with most of the other client like Paramiko, OpenSSH and other
>>>flavours
>>> of SSH its working fine. But we are seeing a problem with twisted
>>>client
>>> that too only with HMAC-SHA-512. We have a limitation from our side to
>>>debug
>>> this since we dont know what is happening from the client side. We
>>>have
>>> taken our derived key for the HMAC and as well as the input to derive
>>>the
>>> MAC using online tools and it matches with whatever we have generated
>>>but
>>> whatever is been sent across the other Twisted side differs and we are
>>> closing the session. This is been tagged critical since most of the
>>> customers are migrating to Twisted and will be a deployment blocker
>>>for us.
>>>
>>> What we suspect is the key or the algorithm itself. Please see the
>>>snippet
>>> below
>>>
>>> This is our inmac Key
>>> ----------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> inmac.key
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - a5 cb a5 bb
>>>4c
>>> 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 1c e1 3f d9
>>>a7
>>> 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - 2a bc 53 c6
>>>85
>>> 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030 - d9 a5 0e 73
>>>d0
>>> 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p
>>>
>>> This is our input data to the hmac-sha-512
>>> -----------------------------------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> input.data to HMAC API
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 00 00 00 03
>>>00
>>> 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 68 2d 75 73
>>>65
>>> 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - ba 7e 56 e5
>>> .~V.
>>>
>>> The digest which is been sent from the twisted client side(Red)
>>> -----------------------------------------------------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> digest
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 95 f7 99 27
>>>48
>>> 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 93 d1 4d 46
>>>5f
>>> d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 84 a9 58 60
>>>5e
>>> 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 4b 1d 05 2d
>>>a4
>>> 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[
>>>
>>> The digest which got created from our side using the same key and input
>>> data mentioned above(Green)
>>> 
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000 - 36 36 5c 6e
>>>2d
>>> be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 0e e8 d6 96
>>>6e
>>> 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 7c c8 15 b8
>>>5a
>>> 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 32 63 61 5e
>>>f5
>>> 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.
>>>
>>> If you see the details this is the useauth first packet and we are not
>>> able to proceed because of the failure. We used online tool to do this
>>> calculation and we are getting the same output as what we generated so
>>>the
>>> one marked as red is creating problem.So the root cause could be
>>>either the
>>> key which is been derived or the algorithm so to debug that we need to
>>> enable details logging from client side. We can share the details with
>>> respective engineer and show what we are facing. Please help.
>>>
>>> Online tool which we used to check our algorithm is: which result in
>>>same
>>> MAC marked as green.
>>>
>>> https://www.liavaag.org/English/SHA-Generator/HMAC/
>>>
>>>
>>> Thanks,
>>>
>>> Jabir
>>>
>>>      \|/
>>>
>>>     -------
>>>
>>>    (  o o  )
>>>
>>> oooO---O---Oooonull
>>>
>>>
>>> From: Alex Gaynor <alex.gaynor at gmail.com>
>>> Date: Wednesday, 1 March 2017 6:39 am
>>> To: Itamar Turner-Trauring <itamar at itamarst.org>
>>> Cc: jabir mohammed <jamohamm at cisco.com>, "security at twistedmatrix.com"
>>> <security at twistedmatrix.com>
>>> Subject: Re: FW: Regarding the SHA 512 support in twisted.
>>>
>>> Hi,
>>>
>>> I think I'm missing some context here, what part of twisted are you
>>>trying
>>> to use SHA-512 for a MAC with? It sounds like Conch? Can you show how I
>>> could reproduce the problem?
>>>
>>> Alex
>>>
>>> On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring
>>> <itamar at itamarst.org> wrote:
>>>>
>>>> Hi,
>>>>
>>>> Forwarding on to security contact to see if they think it's a security
>>>> problem; otherwise you can probably just file a normal ticket.
>>>>
>>>>
>>>> On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
>>>>
>>>> Hi Team,
>>>>
>>>>
>>>> Wanted to cross check on SHA 512 algorithm as MAC while using twisted.
>>>> Few of our customers started using Twisted and even we are trying to
>>>> incorporate some scripts via twisted client. But what we have noticed
>>>>is
>>>> that when we negotiate SHA 512 MAC with twisted we always get a
>>>>failure and
>>>> other MAC algorithms are working fine with twisted. So wanted to
>>>>cross check
>>>> do we have any bug or any issue with SHA 512 and twisted and how we
>>>>can
>>>> debug this from twisted side.
>>>>
>>>> We checked the same with other OpenSSH client and even paramiko things
>>>> work perfectly fine so wanted to debug further from the twisted side.
>>>>We
>>>> checked with the same derived key and the output whatever we got from
>>>>SHA
>>>> 512 is what we are getting from the online tool so we suspect
>>>>something to
>>>> do with the key or hash algorithm from the other side.
>>>>
>>>> We used the twisted 16.6.0 version for testing, thanks in advance for
>>>> looking in to this email.
>>>>
>
>
>
>-- 
>Adi Roiban
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From adi at roiban.ro  Mon Mar 27 07:15:51 2017
From: adi at roiban.ro (Adi Roiban)
Date: Mon, 27 Mar 2017 14:15:51 +0100
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <D4FEEFD4.297C13%jamohamm@cisco.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAFRnB2X4MBj1cieSjMRmS-NW9kRcW1yRAPmCC49gm43waja-pA@mail.gmail.com>
 <D4FEEFD4.297C13%jamohamm@cisco.com>
Message-ID: <CAFycZ9dJH5D3ukSRA42XDkF2p6dyhzzuJQU8095Rv=eU4ZFUsw@mail.gmail.com>

On 27 March 2017 at 12:07, jabir Mohammed (jamohamm) <jamohamm at cisco.com> wrote:
>
> Its a security issue even you are allowing a weaker key in case of 64 bytes
> deriving only 40 bytes. Let me know how we issue a tracker bug can you
> please guide me. Since dont want someone else to waist effort in debugging
> the same issue.

Hi Jabir and sorry for the previous misspelling!

There are a few existing bug reports for KEX related tasks...some are
server side, some are client side

https://twistedmatrix.com/trac/search?q=kex

I think that your bug was already reported (by my) at
https://twistedmatrix.com/trac/ticket/8258

---------

Regarding the help with this patch.

What have you tried so far?
Where are you stuck?
Where/ with what specifically do you need help?



Thanks!

>
> Thanks,
>
> Jabir
>
>      \|/
>
>     -------
>
>    (  o o  )
>
> oooO---O---Oooonull
>
>
> From: Alex Gaynor <alex.gaynor at gmail.com>
> Date: Monday, 27 March 2017 4:34 pm
> To: jabir mohammed <jamohamm at cisco.com>
> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
> "security at twistedmatrix.com" <security at twistedmatrix.com>, Twisted general
> discussion <twisted-python at twistedmatrix.com>,
> "twisted-python-bounces at twistedmatrix.com"
> <twisted-python-bounces at twistedmatrix.com>
> Subject: Re: Regarding the SHA 512 support in twisted.
>
> This is not a security issue, so this address isn't the right place for this
> discussion. Please use the public twisted issue tracker.
>
> Alex
>
> On Mon, Mar 27, 2017 at 5:33 AM, jabir Mohammed (jamohamm)
> <jamohamm at cisco.com> wrote:
>>
>> Hi Team,
>>
>> Wanted to bring one code changes which is really required from twisted
>> side otherwise it is not behaving  as per RFC (rfc4253 Section 7.2), twisted
>> is failing when we negotiate any kex algorithm based on SHA1 and we have MAC
>> as hmac-sha2-512. The reason for the failure was the below code
>>
>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>> self.sessionID)
>>         k1 = k1.digest()
>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>> return k1 + k2
>>
>> For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it
>> will only generate 40 byte key and that induce a failure. So we need to
>> modify the code as below to make it generic and make it comply with RFC
>> (rfc4253 Section 7.2). So that twisted can work irrespective of what kex is
>> been used. Actual code should plot in is like below
>>
>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>> self.sessionID)
>>         k1 = k1.digest()
>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>> k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
>> k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
>> return k1 + k2 + k3 + k4
>>
>> Can somebody help me to plot this fix so that twisted will work fine with
>> all the other servers out there and even make it comply to the RFC. Thanks
>> in advance and this will be my first findings on twisted code ;). Please let
>> me know in case of any doubt on the same. Code changes should be plotted in
>> to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py .
>> Please help me with this commit team.
>>
>>
>> Thanks,
>>
>> Jabir
>>
>>      \|/
>>
>>     -------
>>
>>    (  o o  )
>>
>> oooO---O---Oooonull
>>
>>
>> From: Alex Gaynor <alex.gaynor at gmail.com>
>> Date: Wednesday, 1 March 2017 9:26 am
>> To: jabir mohammed <jamohamm at cisco.com>
>> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
>> "security at twistedmatrix.com" <security at twistedmatrix.com>
>> Subject: Re: Regarding the SHA 512 support in twisted.
>>
>> This doesn't appear to be a security issue. You can file an issue on the
>> public tracker.
>>
>> Alex
>>
>> On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm)
>> <jamohamm at cisco.com> wrote:
>>>
>>>
>>> Thanks Alex for the response. In our server we added support of
>>> HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to negotiate this
>>> hmac with most of the other client like Paramiko, OpenSSH and other flavours
>>> of SSH its working fine. But we are seeing a problem with twisted client
>>> that too only with HMAC-SHA-512. We have a limitation from our side to debug
>>> this since we dont know what is happening from the client side. We have
>>> taken our derived key for the HMAC and as well as the input to derive the
>>> MAC using online tools and it matches with whatever we have generated but
>>> whatever is been sent across the other Twisted side differs and we are
>>> closing the session. This is been tagged critical since most of the
>>> customers are migrating to Twisted and will be a deployment blocker for us.
>>>
>>> What we suspect is the key or the algorithm itself. Please see the
>>> snippet below
>>>
>>> This is our inmac Key
>>> ----------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> inmac.key
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - a5 cb a5 bb 4c
>>> 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 1c e1 3f d9 a7
>>> 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - 2a bc 53 c6 85
>>> 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030 - d9 a5 0e 73 d0
>>> 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p
>>>
>>> This is our input data to the hmac-sha-512
>>> -----------------------------------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> input.data to HMAC API
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 00 00 00 03 00
>>> 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 68 2d 75 73 65
>>> 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - ba 7e 56 e5
>>> .~V.
>>>
>>> The digest which is been sent from the twisted client side(Red)
>>> -----------------------------------------------------------------------
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: ssh_integrity_check:
>>> digest
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 95 f7 99 27 48
>>> 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 93 d1 4d 46 5f
>>> d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 84 a9 58 60 5e
>>> 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 4b 1d 05 2d a4
>>> 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[
>>>
>>> The digest which got created from our side using the same key and input
>>> data mentioned above(Green)
>>> 
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000 - 36 36 5c 6e 2d
>>> be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 0e e8 d6 96 6e
>>> 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 7c c8 15 b8 5a
>>> 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 32 63 61 5e f5
>>> 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.
>>>
>>> If you see the details this is the useauth first packet and we are not
>>> able to proceed because of the failure. We used online tool to do this
>>> calculation and we are getting the same output as what we generated so the
>>> one marked as red is creating problem.So the root cause could be either the
>>> key which is been derived or the algorithm so to debug that we need to
>>> enable details logging from client side. We can share the details with
>>> respective engineer and show what we are facing. Please help.
>>>
>>> Online tool which we used to check our algorithm is: which result in same
>>> MAC marked as green.
>>>
>>> https://www.liavaag.org/English/SHA-Generator/HMAC/
>>>
>>>
>>> Thanks,
>>>
>>> Jabir
>>>
>>>      \|/
>>>
>>>     -------
>>>
>>>    (  o o  )
>>>
>>> oooO---O---Oooonull
>>>
>>>
>>> From: Alex Gaynor <alex.gaynor at gmail.com>
>>> Date: Wednesday, 1 March 2017 6:39 am
>>> To: Itamar Turner-Trauring <itamar at itamarst.org>
>>> Cc: jabir mohammed <jamohamm at cisco.com>, "security at twistedmatrix.com"
>>> <security at twistedmatrix.com>
>>> Subject: Re: FW: Regarding the SHA 512 support in twisted.
>>>
>>> Hi,
>>>
>>> I think I'm missing some context here, what part of twisted are you
>>> trying to use SHA-512 for a MAC with? It sounds like Conch? Can you show how
>>> I could reproduce the problem?
>>>
>>> Alex
>>>
>>> On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring
>>> <itamar at itamarst.org> wrote:
>>>>
>>>> Hi,
>>>>
>>>> Forwarding on to security contact to see if they think it's a security
>>>> problem; otherwise you can probably just file a normal ticket.
>>>>
>>>>
>>>> On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
>>>>
>>>> Hi Team,
>>>>
>>>>
>>>> Wanted to cross check on SHA 512 algorithm as MAC while using twisted.
>>>> Few of our customers started using Twisted and even we are trying to
>>>> incorporate some scripts via twisted client. But what we have noticed is
>>>> that when we negotiate SHA 512 MAC with twisted we always get a failure and
>>>> other MAC algorithms are working fine with twisted. So wanted to cross check
>>>> do we have any bug or any issue with SHA 512 and twisted and how we can
>>>> debug this from twisted side.
>>>>
>>>> We checked the same with other OpenSSH client and even paramiko things
>>>> work perfectly fine so wanted to debug further from the twisted side. We
>>>> checked with the same derived key and the output whatever we got from SHA
>>>> 512 is what we are getting from the online tool so we suspect something to
>>>> do with the key or hash algorithm from the other side.
>>>>
>>>> We used the twisted 16.6.0 version for testing, thanks in advance for
>>>> looking in to this email.
>>>>
>>>>
>>>> Thanks,
>>>>
>>>> Jabir
>>>>
>>>>      \|/
>>>>
>>>>     -------
>>>>
>>>>    (  o o  )
>>>>
>>>> oooO---O---Oooonull
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Itamar Turner-Trauring
>>>>
>>>>
>>>
>>>
>>>
>>> --
>>> "I disapprove of what you say, but I will defend to the death your right
>>> to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>>> "The people's good is the highest law." -- Cicero
>>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>>
>>
>>
>>
>> --
>> "I disapprove of what you say, but I will defend to the death your right
>> to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>> "The people's good is the highest law." -- Cicero
>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>
>
>
>
> --
> "I disapprove of what you say, but I will defend to the death your right to
> say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
> "The people's good is the highest law." -- Cicero
> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



-- 
Adi Roiban



From jamohamm at cisco.com  Mon Mar 27 09:29:30 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Mon, 27 Mar 2017 15:29:30 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAFycZ9dJH5D3ukSRA42XDkF2p6dyhzzuJQU8095Rv=eU4ZFUsw@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAFRnB2X4MBj1cieSjMRmS-NW9kRcW1yRAPmCC49gm43waja-pA@mail.gmail.com>
 <D4FEEFD4.297C13%jamohamm@cisco.com>
 <CAFycZ9dJH5D3ukSRA42XDkF2p6dyhzzuJQU8095Rv=eU4ZFUsw@mail.gmail.com>
Message-ID: <D4FF2CBA.297D89%jamohamm@cisco.com>

Please see inline comments [[>> Jamohamm: <<]]. Thanks for the response
team.

Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull




On 27/03/17 6:45 pm, "Twisted-Python on behalf of Adi Roiban"
<twisted-python-bounces at twistedmatrix.com on behalf of adi at roiban.ro>
wrote:

>On 27 March 2017 at 12:07, jabir Mohammed (jamohamm) <jamohamm at cisco.com>
>wrote:
>>
>> Its a security issue even you are allowing a weaker key in case of 64
>>bytes
>> deriving only 40 bytes. Let me know how we issue a tracker bug can you
>> please guide me. Since dont want someone else to waist effort in
>>debugging
>> the same issue.
>
>Hi Jabir and sorry for the previous misspelling!
>
>There are a few existing bug reports for KEX related tasks...some are
>server side, some are client side
>
>https://twistedmatrix.com/trac/search?q=kex
>
>I think that your bug was already reported (by my) at
>https://twistedmatrix.com/trac/ticket/8258

[[>> Jamohamm: So this is the bug which is tracking the issue, sounds good
but its 12 months old but still nobody fixed this interesting. <<]]

>
>---------
>
>Regarding the help with this patch.
>
>What have you tried so far?

[[>> Jamohamm: We recompiled the twisted SSH client code with the fix and
it working fine with OpenSSH server and our server as well, so wanted to
plot the fix in next maintenance release of twisted. <<]]

>Where are you stuck?

[[>> Jamohamm: Since I didnt get any response from the community we
debugged and figured out the issue with coding in twisted SSH client code.
So as of now I am not stuck and we are good with twisted SSH client and
its working fine with this fix. <<]]

>Where/ with what specifically do you need help?

[[>> Jamohamm: Can we upload the fix and get it committed to twisted,
someone can help me with that. <<]]
>
>
>
>Thanks!
>
>>
>> Thanks,
>>
>> Jabir
>>
>>      \|/
>>
>>     -------
>>
>>    (  o o  )
>>
>> oooO---O---Oooonull
>>
>>
>> From: Alex Gaynor <alex.gaynor at gmail.com>
>> Date: Monday, 27 March 2017 4:34 pm
>> To: jabir mohammed <jamohamm at cisco.com>
>> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
>> "security at twistedmatrix.com" <security at twistedmatrix.com>, Twisted
>>general
>> discussion <twisted-python at twistedmatrix.com>,
>> "twisted-python-bounces at twistedmatrix.com"
>> <twisted-python-bounces at twistedmatrix.com>
>> Subject: Re: Regarding the SHA 512 support in twisted.
>>
>> This is not a security issue, so this address isn't the right place for
>>this
>> discussion. Please use the public twisted issue tracker.
>>
>> Alex
>>
>> On Mon, Mar 27, 2017 at 5:33 AM, jabir Mohammed (jamohamm)
>> <jamohamm at cisco.com> wrote:
>>>
>>> Hi Team,
>>>
>>> Wanted to bring one code changes which is really required from twisted
>>> side otherwise it is not behaving  as per RFC (rfc4253 Section 7.2),
>>>twisted
>>> is failing when we negotiate any kex algorithm based on SHA1 and we
>>>have MAC
>>> as hmac-sha2-512. The reason for the failure was the below code
>>>
>>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>>> self.sessionID)
>>>         k1 = k1.digest()
>>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>>> return k1 + k2
>>>
>>> For SHA512 we need 64 byte key and if the Kex is based on SHA1 then it
>>> will only generate 40 byte key and that induce a failure. So we need to
>>> modify the code as below to make it generic and make it comply with RFC
>>> (rfc4253 Section 7.2). So that twisted can work irrespective of what
>>>kex is
>>> been used. Actual code should plot in is like below
>>>
>>> hashProcessor = _kex.getHashProcessor(self.kexAlg)
>>>         k1 = hashProcessor(sharedSecret + exchangeHash + c +
>>> self.sessionID)
>>>         k1 = k1.digest()
>>>         k2 = hashProcessor(sharedSecret + exchangeHash + k1).digest()
>>> k3 = hashProcessor(sharedSecret + exchangeHash + k1 + k2).digest()
>>> k4 = hashProcessor(sharedSecret + exchangeHash + k1 + k2 + k3).digest()
>>> return k1 + k2 + k3 + k4
>>>
>>> Can somebody help me to plot this fix so that twisted will work fine
>>>with
>>> all the other servers out there and even make it comply to the RFC.
>>>Thanks
>>> in advance and this will be my first findings on twisted code ;).
>>>Please let
>>> me know in case of any doubt on the same. Code changes should be
>>>plotted in
>>> to  the routine _getKey,  file name is
>>>src/twisted/conch/ssh/transport.py .
>>> Please help me with this commit team.
>>>
>>>
>>> Thanks,
>>>
>>> Jabir
>>>
>>>      \|/
>>>
>>>     -------
>>>
>>>    (  o o  )
>>>
>>> oooO---O---Oooonull
>>>
>>>
>>> From: Alex Gaynor <alex.gaynor at gmail.com>
>>> Date: Wednesday, 1 March 2017 9:26 am
>>> To: jabir mohammed <jamohamm at cisco.com>
>>> Cc: Itamar Turner-Trauring <itamar at itamarst.org>,
>>> "security at twistedmatrix.com" <security at twistedmatrix.com>
>>> Subject: Re: Regarding the SHA 512 support in twisted.
>>>
>>> This doesn't appear to be a security issue. You can file an issue on
>>>the
>>> public tracker.
>>>
>>> Alex
>>>
>>> On Tue, Feb 28, 2017 at 10:54 PM, jabir Mohammed (jamohamm)
>>> <jamohamm at cisco.com> wrote:
>>>>
>>>>
>>>> Thanks Alex for the response. In our server we added support of
>>>> HMAC-SHA-512 and HMAC-SHA-256 support for MAC. When we try to
>>>>negotiate this
>>>> hmac with most of the other client like Paramiko, OpenSSH and other
>>>>flavours
>>>> of SSH its working fine. But we are seeing a problem with twisted
>>>>client
>>>> that too only with HMAC-SHA-512. We have a limitation from our side
>>>>to debug
>>>> this since we dont know what is happening from the client side. We
>>>>have
>>>> taken our derived key for the HMAC and as well as the input to derive
>>>>the
>>>> MAC using online tools and it matches with whatever we have generated
>>>>but
>>>> whatever is been sent across the other Twisted side differs and we are
>>>> closing the session. This is been tagged critical since most of the
>>>> customers are migrating to Twisted and will be a deployment blocker
>>>>for us.
>>>>
>>>> What we suspect is the key or the algorithm itself. Please see the
>>>> snippet below
>>>>
>>>> This is our inmac Key
>>>> ----------------------------
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]:
>>>>ssh_integrity_check:
>>>> inmac.key
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - a5 cb a5 bb
>>>>4c
>>>> 34 a7 bf-95 e9 00 23 1e 09 17 0c   ....L4.....#....
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 1c e1 3f d9
>>>>a7
>>>> 42 d9 87-54 23 64 16 e5 e2 c3 76   ..?..B..T#d....v
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - 2a bc 53 c6
>>>>85
>>>> 78 81 eb-e4 3e fb f7 cc a3 1f 6e   *.S..x...>.....n
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0030 - d9 a5 0e 73
>>>>d0
>>>> 44 79 a9-d3 19 32 3b 26 92 bb 70   ...s.Dy...2;&..p
>>>>
>>>> This is our input data to the hmac-sha-512
>>>> -----------------------------------------------------
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]:
>>>>ssh_integrity_check:
>>>> input.data to HMAC API
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 00 00 00 03
>>>>00
>>>> 00 00 1c-0a 05 00 00 00 0c 73 73   ..............ss
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0010 - 68 2d 75 73
>>>>65
>>>> 72 61 75-74 68 64 de 66 fb ab 31   h-userauthd.f..1
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0020 - ba 7e 56 e5
>>>> .~V.
>>>>
>>>> The digest which is been sent from the twisted client side(Red)
>>>> 
>>>>-----------------------------------------------------------------------
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]:
>>>>ssh_integrity_check:
>>>> digest
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.895 : SSHD_[65795]: 0000 - 95 f7 99 27
>>>>48
>>>> 28 35 da-62 92 0e 51 0f af 62 b1   ...'H(5.b..Q..b.
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 93 d1 4d 46
>>>>5f
>>>> d9 21 7a-b9 fb 86 b6 6e 00 a3 aa   ..MF_.!z....n...
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 84 a9 58 60
>>>>5e
>>>> 1c 86 98-b4 1f 00 40 d5 72 aa cf   ..X`^...... at .r..
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 4b 1d 05 2d
>>>>a4
>>>> 68 96 9c-7b c7 9d 83 1d c2 1d 5b   K..-.h..{[
>>>>
>>>> The digest which got created from our side using the same key and
>>>>input
>>>> data mentioned above(Green)
>>>> 
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0000 - 36 36 5c 6e
>>>>2d
>>>> be f1 d8-ae 4f 5a 72 30 2d 25 c0   66\n-....OZr0-%.
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0010 - 0e e8 d6 96
>>>>6e
>>>> 10 38 af-65 15 51 ff a7 ca 7d b4   ....n.8.e.Q...}.
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0020 - 7c c8 15 b8
>>>>5a
>>>> 9b 5e c4-b5 ac 4c 51 7e de 77 41   |...Z.^...LQ~.wA
>>>> RP/0/RSP0/CPU0:Feb 23 18:12:43.896 : SSHD_[65795]: 0030 - 32 63 61 5e
>>>>f5
>>>> 1a 31 d1-f7 89 d0 0b 11 3c 48 f6   2ca^..1......<H.
>>>>
>>>> If you see the details this is the useauth first packet and we are not
>>>> able to proceed because of the failure. We used online tool to do this
>>>> calculation and we are getting the same output as what we generated
>>>>so the
>>>> one marked as red is creating problem.So the root cause could be
>>>>either the
>>>> key which is been derived or the algorithm so to debug that we need to
>>>> enable details logging from client side. We can share the details with
>>>> respective engineer and show what we are facing. Please help.
>>>>
>>>> Online tool which we used to check our algorithm is: which result in
>>>>same
>>>> MAC marked as green.
>>>>
>>>> https://www.liavaag.org/English/SHA-Generator/HMAC/
>>>>
>>>>
>>>> Thanks,
>>>>
>>>> Jabir
>>>>
>>>>      \|/
>>>>
>>>>     -------
>>>>
>>>>    (  o o  )
>>>>
>>>> oooO---O---Oooonull
>>>>
>>>>
>>>> From: Alex Gaynor <alex.gaynor at gmail.com>
>>>> Date: Wednesday, 1 March 2017 6:39 am
>>>> To: Itamar Turner-Trauring <itamar at itamarst.org>
>>>> Cc: jabir mohammed <jamohamm at cisco.com>, "security at twistedmatrix.com"
>>>> <security at twistedmatrix.com>
>>>> Subject: Re: FW: Regarding the SHA 512 support in twisted.
>>>>
>>>> Hi,
>>>>
>>>> I think I'm missing some context here, what part of twisted are you
>>>> trying to use SHA-512 for a MAC with? It sounds like Conch? Can you
>>>>show how
>>>> I could reproduce the problem?
>>>>
>>>> Alex
>>>>
>>>> On Tue, Feb 28, 2017 at 8:06 PM, Itamar Turner-Trauring
>>>> <itamar at itamarst.org> wrote:
>>>>>
>>>>> Hi,
>>>>>
>>>>> Forwarding on to security contact to see if they think it's a
>>>>>security
>>>>> problem; otherwise you can probably just file a normal ticket.
>>>>>
>>>>>
>>>>> On Tue, Feb 28, 2017, at 05:01 AM, jabir Mohammed (jamohamm) wrote:
>>>>>
>>>>> Hi Team,
>>>>>
>>>>>
>>>>> Wanted to cross check on SHA 512 algorithm as MAC while using
>>>>>twisted.
>>>>> Few of our customers started using Twisted and even we are trying to
>>>>> incorporate some scripts via twisted client. But what we have
>>>>>noticed is
>>>>> that when we negotiate SHA 512 MAC with twisted we always get a
>>>>>failure and
>>>>> other MAC algorithms are working fine with twisted. So wanted to
>>>>>cross check
>>>>> do we have any bug or any issue with SHA 512 and twisted and how we
>>>>>can
>>>>> debug this from twisted side.
>>>>>
>>>>> We checked the same with other OpenSSH client and even paramiko
>>>>>things
>>>>> work perfectly fine so wanted to debug further from the twisted
>>>>>side. We
>>>>> checked with the same derived key and the output whatever we got
>>>>>from SHA
>>>>> 512 is what we are getting from the online tool so we suspect
>>>>>something to
>>>>> do with the key or hash algorithm from the other side.
>>>>>
>>>>> We used the twisted 16.6.0 version for testing, thanks in advance for
>>>>> looking in to this email.
>>>>>
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Jabir
>>>>>
>>>>>      \|/
>>>>>
>>>>>     -------
>>>>>
>>>>>    (  o o  )
>>>>>
>>>>> oooO---O---Oooonull
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Itamar Turner-Trauring
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> "I disapprove of what you say, but I will defend to the death your
>>>>right
>>>> to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>>>> "The people's good is the highest law." -- Cicero
>>>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>>>
>>>
>>>
>>>
>>> --
>>> "I disapprove of what you say, but I will defend to the death your
>>>right
>>> to say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>>> "The people's good is the highest law." -- Cicero
>>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>>
>>
>>
>>
>> --
>> "I disapprove of what you say, but I will defend to the death your
>>right to
>> say it." -- Evelyn Beatrice Hall (summarizing Voltaire)
>> "The people's good is the highest law." -- Cicero
>> GPG Key fingerprint: D1B3 ADC0 E023 8CA6
>>
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>
>
>
>-- 
>Adi Roiban
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From rodrigc at crodrigues.org  Mon Mar 27 10:08:27 2017
From: rodrigc at crodrigues.org (Craig Rodrigues)
Date: Mon, 27 Mar 2017 09:08:27 -0700
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <D4FED790.297AAF%jamohamm@cisco.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
Message-ID: <CAG=rPVc5T0FNv0u5Jcx+M+Cei9W5eO+=8oiwHcBx+KB4rRr1tQ@mail.gmail.com>

On Mon, Mar 27, 2017 at 2:33 AM, jabir Mohammed (jamohamm) <
jamohamm at cisco.com> wrote:

>
> Can somebody help me to plot this fix so that twisted will work fine with
> all the other servers out there and even make it comply to the RFC. Thanks
> in advance and this will be my first findings on twisted code ;). Please
> let me know in case of any doubt on the same. Code changes should be
> plotted in to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py
> . Please help me with this commit team.
>
>
You need to follow the procedure at:

https://twistedmatrix.com/trac/wiki/TwistedDevelopment#SubmittingaPatch

That will give you all the details you need about filing a new ticket in
Trac,
forking the repository on GitHub, doing a GitHub pull request, etc.

If you need more help, you should ask Einar Floystad Dorum, who works at
Cisco and has filed multiple Conch patches
for Twisted:
https://github.com/twisted/twisted/pulls?q=is%3Apr+author%3Aeinarfd+is%3Aclosed

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170327/3c98417e/attachment-0002.html>

From jamohamm at cisco.com  Mon Mar 27 22:12:37 2017
From: jamohamm at cisco.com (jabir Mohammed (jamohamm))
Date: Tue, 28 Mar 2017 04:12:37 +0000
Subject: [Twisted-Python] Regarding the SHA 512 support in twisted.
In-Reply-To: <CAG=rPVc5T0FNv0u5Jcx+M+Cei9W5eO+=8oiwHcBx+KB4rRr1tQ@mail.gmail.com>
References: <D4DC4117.28A3A5%jamohamm@cisco.com>
 <CAFRnB2VkXs8UpiCfO=D8TFPAcio+8pPdZhYe80o3aDkZT1myfQ@mail.gmail.com>
 <D4FED790.297AAF%jamohamm@cisco.com>
 <CAG=rPVc5T0FNv0u5Jcx+M+Cei9W5eO+=8oiwHcBx+KB4rRr1tQ@mail.gmail.com>
Message-ID: <D4FFE080.297E8E%jamohamm@cisco.com>


Thanks Craig shall follow up.

Thanks,
Jabir
     \|/
    -------
   (  o o  )
oooO---O---Oooonull

From: <crodr001 at gmail.com<mailto:crodr001 at gmail.com>> on behalf of Craig Rodrigues <rodrigc at crodrigues.org<mailto:rodrigc at crodrigues.org>>
Date: Monday, 27 March 2017 9:38 pm
To: Twisted general discussion <twisted-python at twistedmatrix.com<mailto:twisted-python at twistedmatrix.com>>
Cc: "security at twistedmatrix.com<mailto:security at twistedmatrix.com>" <security at twistedmatrix.com<mailto:security at twistedmatrix.com>>, "twisted-python-bounces at twistedmatrix.com<mailto:twisted-python-bounces at twistedmatrix.com>" <twisted-python-bounces at twistedmatrix.com<mailto:twisted-python-bounces at twistedmatrix.com>>, jabir mohammed <jamohamm at cisco.com<mailto:jamohamm at cisco.com>>
Subject: Re: [Twisted-Python] Regarding the SHA 512 support in twisted.


On Mon, Mar 27, 2017 at 2:33 AM, jabir Mohammed (jamohamm) <jamohamm at cisco.com<mailto:jamohamm at cisco.com>> wrote:

Can somebody help me to plot this fix so that twisted will work fine with all the other servers out there and even make it comply to the RFC. Thanks in advance and this will be my first findings on twisted code ;). Please let me know in case of any doubt on the same. Code changes should be plotted in to  the routine _getKey,  file name is src/twisted/conch/ssh/transport.py . Please help me with this commit team.


You need to follow the procedure at:

https://twistedmatrix.com/trac/wiki/TwistedDevelopment#SubmittingaPatch

That will give you all the details you need about filing a new ticket in Trac,
forking the repository on GitHub, doing a GitHub pull request, etc.

If you need more help, you should ask Einar Floystad Dorum, who works at Cisco and has filed multiple Conch patches
for Twisted: https://github.com/twisted/twisted/pulls?q=is%3Apr+author%3Aeinarfd+is%3Aclosed

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170328/cbb96b62/attachment-0002.html>

From glyph at twistedmatrix.com  Thu Mar 30 02:14:27 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 30 Mar 2017 01:14:27 -0700
Subject: [Twisted-Python] automatic subscription should be working again
Message-ID: <B1B9D422-BABF-4ABF-9797-13078FAB4C36@twistedmatrix.com>

The web forms at https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python <https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python> as well as  https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web <https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web> should now be accepting web-based subscriptions again.

Right now the configuration has not technically changed - just to be safe, for the first day or two, we're going to leave the administrative-approval check in place on new subscribers, but I think that we have managed to address the main problem that was leading to abuse (usually one spam comes in every couple of seconds, and there hasn't been one for nearly an hour now).  If I don't see any more spammer subscription attempts in the next 24h I will likely make it fully self-service again.  Tell your friends, come join us to talk about Twisted!  (Or Twisted's mailing lists, you know, as we do here.)

This is probably a bigger deal to me than anyone else, since making sure our abysmal mail infrastructure didn't fall over and stop delivering messages to project members or DDoS some poor soul on the other side of the planet has been a grindingly tedious intermittent task for me over the last year.  Processing new subscription requests, and trying to disambiguate them from spammers, has been particularly time-consuming and frustrating; I suspect that a few dozen people who would really prefer to be on this list now have bounced off of the byzantine subscription process in the last six months.

The visibility and confidence that Mailgun's deliverability tracking has given me, plus some Mailman upgrades and configuration changes, should vastly reduce the amount of ongoing work that mail infra maintenance requires for me, so that I can get my PyCon talk done in time this year.  Maybe even fix a Twisted bug or two.

My my very heartfelt thanks to M-jimt on the #mailman IRC channel on Freenode for giving me several tips which lead to this final change.

Thank you all for your patience, and I _really_ hope that this is my last posting about meta-level mailing list junk this year :-).

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20170330/f8b63aef/attachment-0002.html>

From contact at evilham.com  Thu Mar 30 05:45:56 2017
From: contact at evilham.com (Evilham)
Date: Thu, 30 Mar 2017 13:45:56 +0200
Subject: [Twisted-Python] automatic subscription should be working again
In-Reply-To: <B1B9D422-BABF-4ABF-9797-13078FAB4C36@twistedmatrix.com>
References: <B1B9D422-BABF-4ABF-9797-13078FAB4C36@twistedmatrix.com>
Message-ID: <8e241ead-3d72-56c5-89b3-2e6520ef3bdd@evilham.com>

Hey Glpyh,

Am 30/03/2017 um 10:14 schrieb Glyph Lefkowitz:
> This is probably a bigger deal to me than anyone else, since making sure
> our abysmal mail infrastructure didn't fall over and stop delivering
> messages to project members or DDoS some poor soul on the other side of
> the planet has been a grindingly tedious intermittent task for me over
> the last year.  Processing new subscription requests, and trying to
> disambiguate them from spammers, has been particularly time-consuming
> and frustrating; I suspect that a few dozen people who would really
> prefer to be on this list now have bounced off of the byzantine
> subscription process in the last six months.
> 
> Thank you all for your patience, and I _really_ hope that this is my
> last posting about meta-level mailing list junk this year :-).

I'm glad to read this, hopefully I was one of your last manual approvals
and you'll have one thing less to think about ^^.

Best wishes,
-- 
Evilham



From glyph at twistedmatrix.com  Fri Mar 31 00:02:39 2017
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Thu, 30 Mar 2017 23:02:39 -0700
Subject: [Twisted-Python] automatic subscription should be working again
In-Reply-To: <8e241ead-3d72-56c5-89b3-2e6520ef3bdd@evilham.com>
References: <B1B9D422-BABF-4ABF-9797-13078FAB4C36@twistedmatrix.com>
 <8e241ead-3d72-56c5-89b3-2e6520ef3bdd@evilham.com>
Message-ID: <3E909244-BA03-4DB1-9A38-CA2B9BE68F61@twistedmatrix.com>


> On Mar 30, 2017, at 4:45 AM, Evilham <contact at evilham.com> wrote:
> 
> Hey Glpyh,
> 
> Am 30/03/2017 um 10:14 schrieb Glyph Lefkowitz:
>> This is probably a bigger deal to me than anyone else, since making sure
>> our abysmal mail infrastructure didn't fall over and stop delivering
>> messages to project members or DDoS some poor soul on the other side of
>> the planet has been a grindingly tedious intermittent task for me over
>> the last year.  Processing new subscription requests, and trying to
>> disambiguate them from spammers, has been particularly time-consuming
>> and frustrating; I suspect that a few dozen people who would really
>> prefer to be on this list now have bounced off of the byzantine
>> subscription process in the last six months.
>> 
>> Thank you all for your patience, and I _really_ hope that this is my
>> last posting about meta-level mailing list junk this year :-).
> 
> I'm glad to read this, hopefully I was one of your last manual approvals
> and you'll have one thing less to think about ^^.

Thanks for the well-wishes.  It's official; after 24h of no discernible subscription spam, I've re-enabled confirmation-based subscriptions.  So you were one last manual approval and this is the last mailing list meta-post :-).  Let's get back to talking about Twisted!

-glyph



