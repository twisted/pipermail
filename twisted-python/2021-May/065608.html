<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to get the client ip when it ask a resolution with twisted.names
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20get%20the%20client%20ip%20when%20it%20ask%20a%0A%20resolution%20with%20twisted.names&In-Reply-To=%3CCAFycZ9d%3DTCnDjuxiE%3DLXpGjquMXxJv%3DDDW7rMvbk%2BpgK7vuqPg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065606.html">
   <LINK REL="Next"  HREF="065610.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to get the client ip when it ask a resolution with twisted.names</H1>
    <B>Adi Roiban</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20get%20the%20client%20ip%20when%20it%20ask%20a%0A%20resolution%20with%20twisted.names&In-Reply-To=%3CCAFycZ9d%3DTCnDjuxiE%3DLXpGjquMXxJv%3DDDW7rMvbk%2BpgK7vuqPg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] How to get the client ip when it ask a resolution with twisted.names">adi at roiban.ro
       </A><BR>
    <I>Sat May  1 03:18:08 MDT 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065606.html">[Twisted-Python] How to get the client ip when it ask a resolution with twisted.names
</A></li>
        <LI>Next message (by thread): <A HREF="065610.html">[Twisted-Python]  How to get the client ip when it ask a resolution with twisted.names
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65608">[ date ]</a>
              <a href="thread.html#65608">[ thread ]</a>
              <a href="subject.html#65608">[ subject ]</a>
              <a href="author.html#65608">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

On Sat, 1 May 2021 at 07:43, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">contact at benoit-laviale.fr</A> &lt;
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">contact at benoit-laviale.fr</A>&gt; wrote:

&gt;<i> Dear all,
</I>&gt;<i>
</I>&gt;<i> I am working on twisted names since some days to make kind of filtering
</I>&gt;<i> system (with domains blacklists).
</I>&gt;<i> So I made my own resolver that can reply defer.fail(error.DomainError())
</I>&gt;<i> to send the query to the next resolver (and in this case, it will be
</I>&gt;<i> resolve) or defer.fail(dns.AuthoritativeDomainError(query.name.name)) to
</I>&gt;<i> reply NXDOMAIN that can &quot;block&quot; the domain to the final client.
</I>&gt;<i>
</I>&gt;<i> That part is working well.
</I>&gt;<i>
</I>&gt;<i> Next, i would like to &quot;block&quot; the resolution regarding the device (Mac
</I>&gt;<i> address/IP/???).
</I>&gt;<i>
</I>&gt;<i> I would like something like that :
</I>&gt;<i>
</I>&gt;<i> if self.query.meta.client.ip == b&quot;192.168.0.5&quot; or
</I>&gt;<i> self.query.meta.client.mac == &quot;XX:YY:ZZ:....&quot;:
</I>&gt;<i>          self.do_something()
</I>&gt;<i>
</I>&gt;<i> My use case is that device of Kelly, (Kelly is a teenager of 12 years)
</I>&gt;<i> cant use youtube.com at all, but other devices are allowed to get the
</I>&gt;<i> resolution.
</I>&gt;<i> How can I get the IP/Name/mac (an identifier) of the device that's
</I>&gt;<i> querying my custom dns?
</I>&gt;<i> I read something about datagrams, but in my case i think i must get this
</I>&gt;<i> information in my resolver...
</I>&gt;<i>
</I>&gt;<i> Thx and cheers.
</I>&gt;<i>
</I>
I think you are using DNS over UDP... so to understand how UDP works with
Twisted you can check this page
<A HREF="https://twistedmatrix.com/documents/current/core/howto/udp.html">https://twistedmatrix.com/documents/current/core/howto/udp.html</A>

 I have never used Twisted names so I am just trying to help based on my
general knowledge of Twisted design
... but I think the entry point is here

<A HREF="https://github.com/twisted/twisted/blob/63649469c1fe46d8a713e8034239ac3cc0498ea7/src/twisted/names/dns.py#L3242">https://github.com/twisted/twisted/blob/63649469c1fe46d8a713e8034239ac3cc0498ea7/src/twisted/names/dns.py#L3242</A>

then it goes to here

<A HREF="https://github.com/twisted/twisted/blob/63649469c1fe46d8a713e8034239ac3cc0498ea7/src/twisted/names/server.py#L538">https://github.com/twisted/twisted/blob/63649469c1fe46d8a713e8034239ac3cc0498ea7/src/twisted/names/server.py#L538</A>

and then in handleQuery where I see that the  query is done without the
`address`...but the address is available again in
`gotResolverResponse`.. so maybe that help

-------

Hope it helps

Cheers

-- 
Adi Roiban
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20210501/8fc7b573/attachment-0001.htm&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065606.html">[Twisted-Python] How to get the client ip when it ask a resolution with twisted.names
</A></li>
	<LI>Next message (by thread): <A HREF="065610.html">[Twisted-Python]  How to get the client ip when it ask a resolution with twisted.names
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65608">[ date ]</a>
              <a href="thread.html#65608">[ thread ]</a>
              <a href="subject.html#65608">[ subject ]</a>
              <a href="author.html#65608">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
