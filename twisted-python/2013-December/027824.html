<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Do%20Viewables%20absolutely%20have%20to%20be%20return%27ed%0A%09by%20Avatars%3F&In-Reply-To=%3C6BB59D03-76D0-40AC-AF3E-2647B5B37254%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027837.html">
   <LINK REL="Next"  HREF="027838.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Do%20Viewables%20absolutely%20have%20to%20be%20return%27ed%0A%09by%20Avatars%3F&In-Reply-To=%3C6BB59D03-76D0-40AC-AF3E-2647B5B37254%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Dec  8 03:15:22 MST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027837.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
        <LI>Next message: <A HREF="027838.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27824">[ date ]</a>
              <a href="thread.html#27824">[ thread ]</a>
              <a href="subject.html#27824">[ subject ]</a>
              <a href="author.html#27824">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Dec 7, 2013, at 9:30 AM, Daniel Sank &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sank.daniel at gmail.com</A>&gt; wrote:

&gt;<i> Glyph,
</I>&gt;<i> 
</I>&gt;<i> It seems to me that the right way to fix this issue with being able to
</I>&gt;<i> pass Cacheable and Viewable instances as arguments to mind.callRemote
</I>&gt;<i> methods would be to &quot;attach&quot; a perspective to that mind, possibly
</I>&gt;<i> during login (with a means for doing in manually as well).
</I>
The mind might be any object, or it might be no object (i.e. None).  This is confusingly documented, as remote_loginAnonymous is the only thing that explicitly spells it out, but given that it's a remote thing coming from the client, and no type-checking is performed, that's implicitly what it is.

&gt;<i> As soon as
</I>&gt;<i> that though crossed my mind I remembered that I've seen &quot;attach&quot; and
</I>&gt;<i> &quot;detach&quot; floating around in the pb documentation as if it were once
</I>&gt;<i> upon a time a real part of the API, but sort of fizzled or was never
</I>&gt;<i> really adopted.
</I>
This part of PB was removed many years ago, and references in the documentation ought to be removed as well.

&gt;<i> I would appreciate your comment on this to help me
</I>&gt;<i> understand the state of pb and whether my idea of how to proceed is
</I>&gt;<i> correct?
</I>
In the case where a 'mind' object has a callRemote method, it's one of two things: a RemoteReference or a RemoteCacheObserver.  Both of these have a (public, given its name, but not super well documented) &quot;perspective&quot; attribute which triggers the serialization behavior you want when calling callRemote.  So 'attaching' that perspective is as simple of setting the attribute.  In your application, I think just setting that attribute is a much better idea than the craziness that I was suggesting with a custom Perspectivize class, and perhaps actually better than manually constructing a ViewPoint, since it generalizes completely to the whole serialization process.

What's slightly more problematic is making this general.  You have to fully deserialize the mind object before login, because it's explicitly provided in order to allow cred implementations to interact with the client during login.  And since you don't know what the avatar is before it's time to log in, there's no way to deserialize it in this way!

This is important if your Mind object were to be a custom Copyable that contained more than one RemoteReference, and, for example, had its own callRemote which could dispatch to different ones depending on what it's being asked to do.

So how about this:

Introduce a new custom interface, IHaveAPerspective (name intentionally terrible so I don't get hung up on naming it well); and then, in _cbLogin, do 'if IHaveAPerspective.providedBy(mind): mind.perspective = avatar'. (Be sure to get the right avatar, of course, the one before it's wrapped in an AsReferenceable.)  If someone had a more elaborately constructed mind object than a RemoteReference, then they could implement the interface and write a property that set it on all the relevant references.

Then, RemoteReference and RemoteCacheObserver can implement this new interface.

For compatibility reasons, you might need to make this behavior disabled by default.  But hey, it would be nice to have a public name for _PortalRoot rather than relying on adapter magic to construct one, so that new name could just do this by default.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20131208/6276a892/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20131208/6276a892/attachment.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027837.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
	<LI>Next message: <A HREF="027838.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27824">[ date ]</a>
              <a href="thread.html#27824">[ thread ]</a>
              <a href="subject.html#27824">[ subject ]</a>
              <a href="author.html#27824">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
