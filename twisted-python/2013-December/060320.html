<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted Endpoints and WebSocket / Autobahn
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20Endpoints%20and%20WebSocket%20/%20Autobahn&In-Reply-To=%3C22CA6ECE-DD43-4C78-9452-2288287260C1%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060319.html">
   <LINK REL="Next"  HREF="060340.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted Endpoints and WebSocket / Autobahn</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20Endpoints%20and%20WebSocket%20/%20Autobahn&In-Reply-To=%3C22CA6ECE-DD43-4C78-9452-2288287260C1%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Twisted Endpoints and WebSocket / Autobahn">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Dec 13 10:23:35 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060319.html">[Twisted-Python] Twisted Endpoints and WebSocket / Autobahn
</A></li>
        <LI>Next message (by thread): <A HREF="060340.html">[Twisted-Python] Twisted Endpoints and WebSocket / Autobahn
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60320">[ date ]</a>
              <a href="thread.html#60320">[ thread ]</a>
              <a href="subject.html#60320">[ subject ]</a>
              <a href="author.html#60320">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Dec 13, 2013, at 7:09 AM, Tobias Oberstein &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tobias.oberstein at tavendo.de</A>&gt; wrote:

&gt;&gt;&gt;<i> I am working on Twisted Endpoint support in Autobahn
</I>&gt;&gt;<i> <A HREF="https://github.com/tavendo/AutobahnPython.">https://github.com/tavendo/AutobahnPython.</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Yay!
</I>&gt;<i> 
</I>&gt;<i> Endpoints are cool.
</I>&gt;<i> 
</I>&gt;<i> FWIW, here is a working example of WebSocket I tested over both Unix domain sockets and the usual TCP/TLS endpoints:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://github.com/tavendo/AutobahnPython/tree/master/examples/websocket/echo_endpoints">https://github.com/tavendo/AutobahnPython/tree/master/examples/websocket/echo_endpoints</A>
</I>&gt;<i> 
</I>&gt;<i> This works with all features Autobahn provides like support for different WebSocket versions (Hixie-76, RFC6455) and
</I>&gt;<i> WebSocket extensions (like permessage-compression with deflate, snappy, bzip2).
</I>
Cool!
&gt;<i> 
</I>&gt;<i> Sure. Can I use:
</I>&gt;<i> 
</I>&gt;<i> &quot;autobahn.websocket&quot;?
</I>&gt;<i> 
</I>&gt;<i> Since Autobahn also provides other protocols (WAMP), and ..
</I>
Sure.

&gt;<i> endpoint = serverFromString(reactor,&quot;autobahn.websocket: tcp:80:url=<A HREF="ws://myhostname.com/somepath">ws://myhostname.com/somepath</A>&quot;)
</I>&gt;<i> 
</I>&gt;<i> Here, a single endpoint descriptor is specifying parameters for both WebSocket, and the underlying transport.
</I>&gt;<i> 
</I>&gt;<i> Underlying transport:
</I>&gt;<i> tcp:80
</I>&gt;<i> 
</I>&gt;<i> WebSocket overlay:
</I>&gt;<i> autobahn.websocket:url=<A HREF="ws://myhostname.com/somepath:extensions:permessage-deflate;permessage-snappy">ws://myhostname.com/somepath:extensions:permessage-deflate;permessage-snappy</A>
</I>&gt;<i> 
</I>&gt;<i> So the plugin needs to parse not only the &quot;overlay transport&quot; spec, but also the underlying spec (&quot;tcp:80&quot;) and all variants thereof?
</I>&gt;<i> 
</I>&gt;<i> Or can I let the existing Twisted machinery do the parsing of the underlying, and only parse off the remaining
</I>&gt;<i> stuff (&quot;url=<A HREF="ws://myhostname.com/somepath:extensions:permessage-deflate;permessage-snappy">ws://myhostname.com/somepath:extensions:permessage-deflate;permessage-snappy</A>&quot; in this case)
</I>
There's some discussion of this here: &lt;<A HREF="http://twistedmatrix.com/trac/ticket/5642">http://twistedmatrix.com/trac/ticket/5642</A>&gt;.

It's probably possible, the rules are reasonably simple.

&gt;<i> 
</I>&gt;<i> And if not, does that mean not only the endpoint main identifier (&quot;tcp&quot; vs &quot;unix&quot; vs &quot;autobahn.websocket&quot;) must
</I>&gt;<i> be non-overlapping, but also all the individual parameters?
</I>
Nope; the first one has to be non-overlapping, then you just have to decide on a definite place where the &quot;wrapped&quot; endpoint begins.

&gt;<i> Like in the case for WebSocket, there is a need
</I>&gt;<i> for a &quot;url&quot; parameter.
</I>&gt;<i> 
</I>&gt;<i> These Qs have brought me to ..
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Variant 2)
</I>&gt;<i> 
</I>&gt;<i> endpoint = serverFromString(reactor, &quot;tcp:80&quot;)
</I>&gt;<i> wrappedEndpoint = serverFromString(reactor, endpoint, &quot;autobahn.websocket:url=<A HREF="ws://myhost.com/mypath">ws://myhost.com/mypath</A>&quot;)
</I>&gt;<i> 
</I>&gt;<i> where I would start a program like
</I>&gt;<i> 
</I>&gt;<i> python myprog.py --transport &quot;tcp:80&quot; --wrappingTransport &quot;autobahn.websocket:url=<A HREF="ws://myhost.com/mypath">ws://myhost.com/mypath</A>&quot;
</I>&gt;<i> 
</I>
This variant is worse because you can't change the command lines of other twistd plugins, which might be able to use websockets unchanged if you could just get it returned by serverFromString.


&gt;<i> Is there such thing as a WrappingEndpoint?
</I>
Not yet, no.  Comment on that ticket :).

&gt;<i> ==
</I>&gt;<i> 
</I>&gt;<i> This is yet another topic/question, but it fits here.
</I>&gt;<i> 
</I>&gt;<i> Twisted has defined interfaces for both stream (and datagram transports).
</I>&gt;<i> 
</I>&gt;<i> WebSocket is essentially a bidirectional, reliable, ordered datagram transport (with 2 payload types: binary and utf8).
</I>&gt;<i> 
</I>&gt;<i> Is there a Twisted Interface for such transports?
</I>
No.  Websockets are incredibly bizarre; most protocols support either arbitrarily typed data or just bytes/just text.  The hybrid weirdness of &quot;binary&quot; (with no additional type information) and &quot;text&quot; is unique.

&gt;<i> I am asking, since I am right now also refactoring the code within Autobahn that lays above raw WebSocket .. a PubSub+RPC protocol, that essentially only assumes a transport like above.
</I>&gt;<i> 
</I>&gt;<i> I want to make it independent of WebSocket and only assume a bidirectional, reliable, ordered, datagram transport.
</I>
You can do this with length prefixing, but arguably Twisted should have such an interface that can express this combination of concepts, because I think these are, technically speaking, the semantics of a UNIX datagram endpoint, but the required interface (actually a superclass, bleh) is the same as for UDP, implying unreliability.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20131213/ce368ff9/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060319.html">[Twisted-Python] Twisted Endpoints and WebSocket / Autobahn
</A></li>
	<LI>Next message (by thread): <A HREF="060340.html">[Twisted-Python] Twisted Endpoints and WebSocket / Autobahn
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60320">[ date ]</a>
              <a href="thread.html#60320">[ thread ]</a>
              <a href="subject.html#60320">[ subject ]</a>
              <a href="author.html#60320">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
