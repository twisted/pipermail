<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Do%20Viewables%20absolutely%20have%20to%20be%20return%27ed%0A%09by%20Avatars%3F&In-Reply-To=%3C0978F6A1-DF4B-44B0-A6E3-7FA72BE9F1E1%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="027802.html">
   <LINK REL="Next"  HREF="060281.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Do%20Viewables%20absolutely%20have%20to%20be%20return%27ed%0A%09by%20Avatars%3F&In-Reply-To=%3C0978F6A1-DF4B-44B0-A6E3-7FA72BE9F1E1%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Dec  4 07:26:29 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027802.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
        <LI>Next message (by thread): <A HREF="060281.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60272">[ date ]</a>
              <a href="thread.html#60272">[ thread ]</a>
              <a href="subject.html#60272">[ subject ]</a>
              <a href="author.html#60272">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Dec 2, 2013, at 11:45 AM, Daniel Sank &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sank.daniel at gmail.com</A>&gt; wrote:

&gt;&gt;<i> One way to fix this is to manually construct a ViewPoint rather than a Viewable and pass that to the client.
</I>&gt;<i> 
</I>&gt;<i> For the sake of trying to get my current project to work and so that I
</I>&gt;<i> can understand what's really going on and fix the bugs in pb: how
</I>&gt;<i> would I do the similar thing for a Cacheable? Looking at the source so
</I>&gt;<i> far I'm having trouble figuring out where things like Viewable come
</I>&gt;<i> into play.
</I>
This isn't quite as clean as with ViewPoint, but it's not all that bad either.  Basically, you need to inject the correct perspective into the RemoteCacheObserver which is constructed; unfortunately it reads it only from the jellier.

So: fix the jellier :-).

So something like this might do the trick:

class Perspectiveize(Jellyable):
    def __init__(self, perspective, obj):
        self.perspective = perspective
        self.obj = obj
    def jellyFor(self, jellier):
        old = jellier.invoker.serializingPerspective
        jellier.invoker.serializingPerspective = self.perspective
        try:
            return self.obj.jellyFor(jellier)
        finally:
            jellier.invoker.serializingPerspective = old

Untested, but I think it should do the trick.  One caveat though; if the 'obj' (in your case, Cacheable) that you wrap with this is serialized twice within the same top-level call to 'jelly', (i.e. if there are multiple references to it from within a single return message or remote method call) the second time it is serialized, it will simply serialize a reference to the first; this means you have to be careful to be sure that the Perspectiveize object is serialized before the Cacheable itself if the Cacheable is to be serialized at all.

Good luck,

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20131204/89326649/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027802.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
	<LI>Next message (by thread): <A HREF="060281.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60272">[ date ]</a>
              <a href="thread.html#60272">[ thread ]</a>
              <a href="subject.html#60272">[ subject ]</a>
              <a href="author.html#60272">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
