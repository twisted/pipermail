<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to forcibly disconnect PB client?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20forcibly%20disconnect%20PB%20client%3F&In-Reply-To=%3C430DDD7D.5090009%40gmx.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043724.html">
   <LINK REL="Next"  HREF="043730.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to forcibly disconnect PB client?</H1>
    <B>David Guaraglia</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20forcibly%20disconnect%20PB%20client%3F&In-Reply-To=%3C430DDD7D.5090009%40gmx.de%3E"
       TITLE="[Twisted-Python] How to forcibly disconnect PB client?">dguaraglia at gmx.de
       </A><BR>
    <I>Thu Aug 25 09:02:21 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043724.html">[Twisted-Python] How to forcibly disconnect PB client?
</A></li>
        <LI>Next message (by thread): <A HREF="043730.html">[Twisted-Python] How to forcibly disconnect PB client?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43727">[ date ]</a>
              <a href="thread.html#43727">[ thread ]</a>
              <a href="subject.html#43727">[ subject ]</a>
              <a href="author.html#43727">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Steve,

Well, in that case you could override connectionMade and connectionLost 
in your protocol to append 'self' to a list in the factory. You don't 
even need to subclass the factory if you are careful enough (this means, 
if you check that the list exists before doing anything). Anyway, the 
simplest thing would be to declare the list in a sublcass of 
PBServerFactory.

Could be something like this:

class MyPBFactory(PBServerFactory):
    protocol = MyBroker
    connections = []
    ....

class MyBroker(Broker):
    def connectionMade(...):
       self.factory.connections.append(self)

    def connectionLost(...):
       self.factory.connections.remove(self)

Then you just use 'factory.connections' to look up for your particular 
connection, and do a 'loseConnection()&quot; on it. I'm not pretty sure, but 
I think some of the protocols do even have this kind of connections list 
built in, but looking into the documentation it does seem that 
PBServerFactory is not one of those.

Hope it helps,

David

Steve Freitas wrote:

&gt;<i>Hi David,
</I>&gt;<i>
</I>&gt;<i>Thanks for the reply. I'm aware of using loseConnection() from inside
</I>&gt;<i>the protocol, but I'm using PBServerFactory. So I'm looking for a way to
</I>&gt;<i>choose an arbitrary PB client that's already connected and logged in
</I>&gt;<i>(cred) through that factory and kill the connection -- in other words,
</I>&gt;<i>of all the clients that may be connected to that factory, I need to know
</I>&gt;<i>how to get the transport that I want, so I can call loseConnection() on
</I>&gt;<i>it.
</I>&gt;<i>
</I>&gt;<i>If I need to subclass PBServerFactory, that's fine, but I'm hoping to
</I>&gt;<i>find something a little more direct.
</I>&gt;<i>
</I>&gt;<i>Thanks,
</I>&gt;<i>
</I>&gt;<i>Steve
</I>&gt;<i>
</I>&gt;<i>On Thu, 2005-08-25 at 11:12 -0300, David Guaraglia wrote:
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>Hi Steve,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>It depends, if you decide you should disconnect the client while 
</I>&gt;&gt;<i>processing data in the Protocol, then you can just 
</I>&gt;&gt;<i>&quot;self.transport.loseConnection()&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>(e.g):
</I>&gt;&gt;<i>class MyProt(Protocol):
</I>&gt;&gt;<i>    dataReceived(data):
</I>&gt;&gt;<i>       if data &lt;&gt; &quot;hello&quot;:
</I>&gt;&gt;<i>          self.transport.loseConnection()
</I>&gt;&gt;<i>       else:
</I>&gt;&gt;<i>          ....
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>So the most important question is: where do you decide that you should 
</I>&gt;&gt;<i>disconnect the client?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Hope this helps,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>David
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Steve Freitas wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>In some cases I need to force a client to disconnect. Is there some
</I>&gt;&gt;&gt;<i>factory call that I can use to do this? On the client side, I know I can
</I>&gt;&gt;&gt;<i>use factory._broker.transport.loseConnection(), but on the server side,
</I>&gt;&gt;&gt;<i>though I've looked at the source a bit, I'm not sure how to get at the
</I>&gt;&gt;&gt;<i>correct transport.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Thanks!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Steve
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043724.html">[Twisted-Python] How to forcibly disconnect PB client?
</A></li>
	<LI>Next message (by thread): <A HREF="043730.html">[Twisted-Python] How to forcibly disconnect PB client?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43727">[ date ]</a>
              <a href="thread.html#43727">[ thread ]</a>
              <a href="subject.html#43727">[ subject ]</a>
              <a href="author.html#43727">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
