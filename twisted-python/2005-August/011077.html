<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Ftp client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Ftp%20client&In-Reply-To=42F0FDAC.6060505%40unipex.it">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011076.html">
   <LINK REL="Next"  HREF="011083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Ftp client</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Ftp%20client&In-Reply-To=42F0FDAC.6060505%40unipex.it"
       TITLE="[Twisted-Python] Ftp client">andrew-twisted at puzzling.org
       </A><BR>
    <I>Wed Aug  3 14:42:58 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011076.html">[Twisted-Python] Ftp client
</A></li>
        <LI>Next message: <A HREF="011083.html">[Twisted-Python] Ftp client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11077">[ date ]</a>
              <a href="thread.html#11077">[ thread ]</a>
              <a href="subject.html#11077">[ subject ]</a>
              <a href="author.html#11077">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Aug 03, 2005 at 07:23:56PM +0200, Michele Petrazzo wrote:
&gt;<i> Andrew Bennetts wrote:
</I>&gt;<i> &gt;&gt;One problem is that if the user has no password, I receive an error [1] 
</I>&gt;<i> &gt;&gt;(if I try to connect with a simple ftp client, when I connect to the 
</I>&gt;<i> &gt;&gt;server, if it see that I have no password, it connect me without 
</I>&gt;<i> &gt;&gt;password request), however if the user _has_ password, the client 
</I>&gt;<i> &gt;&gt;connect correctly.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Before connecting, can you add:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    FTPClient.debug = True
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Then we can see a full transcript of what's going on.
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> I add that line, but I can't see any new line except that I already seen
</I>
Odd.  It should log everything.

&gt;<i> &gt;&gt;Second:
</I>&gt;<i> &gt;&gt;if the user _has_ password, so I can connect, I want to send &quot;LIST 
</I>&gt;<i> &gt;&gt;status&quot; command, if I use:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;ftpClient.queueStringCommand(&quot;LIST&quot;).addCallbacks(success, fail)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;I receive [2], and if I use:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Right.  LIST requires a data connection to be established, and directly
</I>&gt;<i> &gt;issuing a LIST without arranging for a PASV or PORT command and associated
</I>&gt;<i> &gt;connection will fail.
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> Ok, but what I do with to make it work?
</I>
Use FTPClient.list ;)

Seriously, look at the implementation of FTPClient.list, it's very simple:

    def list(self, path, protocol):
        # ...docstring elided...
        if path is None:
            path = ''
        return self.receiveFromConnection(['LIST ' + self.escapePath(path)], protocol)

FTPClient.receiveFromConnection is a helper function that Does The Right
Thing depending on if self.passive is set or not.

[...]
&gt;<i> &gt;
</I>&gt;<i> &gt;I don't understand why you're passing ' status ' instead of just 'status',
</I>&gt;<i> &gt;though.
</I>&gt;<i> 
</I>&gt;<i> But, I don't know :)
</I>&gt;<i> 
</I>&gt;<i> With this change &quot; status &quot; -&gt; &quot;status&quot; now I don't receive any error!
</I>
Ok, I suspect what was happening was that the server was returning an error
like &quot;' status ' does not exist&quot;.  The error reporting from FTPClient is
pretty messy, unfortunately.

&gt;<i> But what I receive is an empty file list [2] (on all status and recvq 
</I>&gt;<i> sub-directory), both case if I change directory with the cwd command and 
</I>&gt;<i> call ftpClient.list(&quot;.&quot;) or, call it with &quot;status/&quot;-&quot;recvq/&quot;.
</I>&gt;<i> But I know that into that sub-directory there are a lot of files...
</I>
Perhaps FTPFileListProtocol can't parse your file listing -- it tries to
parse stuff more-or-less like:

        -rw-r--r--   1 root     other        531 Jan 29 03:26 README

If you have another format, you'll need to write your own.  As a starting
point, you could try:

class LineRecorder(basic.LineReceiver):
    def connectionMade(self):
        self.lines = []
    def lineReceived(self,line):
        self.lines.append(line)

Alternatively, subclass FTPFileListProtocol and override the unknownLine
method.

&gt;<i> [1]
</I>&gt;<i> The return are (on both OS):
</I>&gt;<i> 
</I>&gt;<i> [Failure instance: Traceback (failure with no frames): 
</I>&gt;<i> twisted.internet.defer.FirstError: 
</I>&gt;<i> FirstError(&lt;twisted.python.failure.Failure 
</I>&gt;<i> twisted.internet.defer.FirstError&gt;, 0)
</I>&gt;<i> ]
</I>
Sorry, I was too hasty here -- you also need to change your errback to print
failure.subFailure or perhaps failure.subFailure.subFailure rather than just
failure.  There are several layers of failure here (because of several
layers of DeferredLists), which makes it ugly.  FTPClient shouldn't be
exposing the implementation detail of DeferredLists like this, but at the
moment it does.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011076.html">[Twisted-Python] Ftp client
</A></li>
	<LI>Next message: <A HREF="011083.html">[Twisted-Python] Ftp client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11077">[ date ]</a>
              <a href="thread.html#11077">[ thread ]</a>
              <a href="subject.html#11077">[ subject ]</a>
              <a href="author.html#11077">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
