<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] laxdb - an async dbapi wrapper
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20laxdb%20-%20an%20async%20dbapi%20wrapper&In-Reply-To=%3C43164378.4060707%40pollenation.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043795.html">
   <LINK REL="Next"  HREF="043787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] laxdb - an async dbapi wrapper</H1>
    <B>Matt Goodall</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20laxdb%20-%20an%20async%20dbapi%20wrapper&In-Reply-To=%3C43164378.4060707%40pollenation.net%3E"
       TITLE="[Twisted-Python] laxdb - an async dbapi wrapper">matt at pollenation.net
       </A><BR>
    <I>Wed Aug 31 17:55:36 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043795.html">[Twisted-Python] laxdb - an async dbapi wrapper
</A></li>
        <LI>Next message (by thread): <A HREF="043787.html">[Twisted-Python] laxdb - an async dbapi wrapper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43796">[ date ]</a>
              <a href="thread.html#43796">[ thread ]</a>
              <a href="subject.html#43796">[ subject ]</a>
              <a href="author.html#43796">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Christopher Armstrong wrote:
&gt;<i> On 9/1/05, Itamar Shtull-Trauring &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>On Wed, 2005-08-31 at 13:31 +0100, Matt Goodall wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>A while back, I started messing around with making a standard, blocking
</I>&gt;&gt;&gt;<i>db-api module appear non-blocking but with a deferred API. I called it
</I>&gt;&gt;&gt;<i>laxdb and it's in my sandbox.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  <A HREF="svn://svn.twistedmatrix.com/svn/Twisted/sandbox/mg/laxdb.py">svn://svn.twistedmatrix.com/svn/Twisted/sandbox/mg/laxdb.py</A>
</I>&gt;&gt;&gt;<i>  <A HREF="http://svn.twistedmatrix.com/cvs/sandbox/mg/laxdb.py?view=markup">http://svn.twistedmatrix.com/cvs/sandbox/mg/laxdb.py?view=markup</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I get the impression from your example:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    def connected(conn):
</I>&gt;&gt;<i>        curs = conn.cursor()
</I>&gt;&gt;<i>        d = curs.execute(&quot;select * from test&quot;)
</I>&gt;&gt;<i>        d.addCallback(lambda ignore: curs.fetchall())
</I>&gt;&gt;<i>        d.addCallback(lambda rows: pprint(rows))
</I>&gt;&gt;<i>        # ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>that you keep dispatching to a thread, then passing it back to Twisted
</I>&gt;&gt;<i>thread, repeatedly, unlike runInteraction which only does this once. I
</I>&gt;&gt;<i>would guess that this will slow down complex database interactions
</I>&gt;&gt;<i>somewhat.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Yeah, but the usual way to use adbapi is the same, isn't it? i.e.,
</I>&gt;<i> runQuery calls. Sounds like you're comparing apples to oranges (on the
</I>&gt;<i> other hand, I guess it would be nice if lax-db had a runInteraction).
</I>&gt;<i> 
</I>
Yes, adbapi dispatches to a thread but runInteraction can be used to
keep the number of dispatches to a minimum by allowing you to perform
multiple db operations in one go.

I guess laxdb could have something equivalent to runInteraction that
would let you work with the blocking database objects rather than the
wrappers. I don't think it should ever automatically commit or rollback
(unless explicitly told to, perhaps) like adbapi does.

A laxdb runInteraction might even make naturally sequential database
code easier to read and maintain too - it can get a bit messy at times.


I really see two main benefits of laxdb:

  1. It's just like dbapi only async. Of course, with that comes the
     &quot;complexity&quot; of deferreds.
  2. It gives you tight control over transactions.


Let me give some examples of point 2 ...


When you need multiple bits of information to process something, i.e. a
web request, you have a choice with adbapi:

  1. call runQuery multiple times, in a deferred chain or as a
     DeferredList, and collect all the bits together
  2. call runInteraction once, collect all the bits during the called
     function and return them all from the function as a tuple or some
     other object

Option 1 is not really a good choice. Not only can it get very ugly but,
critically, each of the runQuery calls happens in a different
transaction! It's not difficult to see how that could cause problems for
 some of the bits of ACID, especially consistency and isolation.

Option 2 only works when you know all the data you need which is not
always feasible because, often, you have unrelated bits of the
application wanting unrelated data.


Another scenario is that you need to SELECT ... FOR UPDATE some data,
use that (locked) data to perform other deferred operation, and update
the locked rows using the data we just collected from the &quot;other
deferred operation&quot;.

I believe this is currently impossible with adbapi because it
automatically handles transactions and you can't do deferred stuff from
the runInteraction function because it's not running in the reactor's
thread.


axdb helps in both these scenarios. You can get a connection, do
whatever you want, even mixing database and other async operations, and
commit or rollback when you're complete.


laxdb also allows you to do things like process an entire web request
within a single transaction, if that is a requirement of your application.


Wow, that was a bit of a rant. Hopefully it explains why something like
laxdb may be useful as part of Twisted though. It's just a different way
of working that adbapi.


- Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: <A HREF="http://www.pollenation.net">http://www.pollenation.net</A>
  __/  \__/    e: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">matt at pollenation.net</A>
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \	       Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043795.html">[Twisted-Python] laxdb - an async dbapi wrapper
</A></li>
	<LI>Next message (by thread): <A HREF="043787.html">[Twisted-Python] laxdb - an async dbapi wrapper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43796">[ date ]</a>
              <a href="thread.html#43796">[ thread ]</a>
              <a href="subject.html#43796">[ subject ]</a>
              <a href="author.html#43796">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
