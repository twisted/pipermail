<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to &quot;monitor&quot; parallel executions of Deferreds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20%22monitor%22%20parallel%20executions%20of%20Deferreds&In-Reply-To=1124979050.12847.34.camel%40pcard0ze.ca.nortel.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011225.html">
   <LINK REL="Next"  HREF="011236.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to &quot;monitor&quot; parallel executions of Deferreds</H1>
    <B>Jason Fritcher</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20%22monitor%22%20parallel%20executions%20of%20Deferreds&In-Reply-To=1124979050.12847.34.camel%40pcard0ze.ca.nortel.com"
       TITLE="[Twisted-Python] How to &quot;monitor&quot; parallel executions of Deferreds">fritcher at corp.earthlink.net
       </A><BR>
    <I>Thu Aug 25 18:00:53 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011225.html">[Twisted-Python] Transport for news client
</A></li>
        <LI>Next message: <A HREF="011236.html">[Twisted-Python] How to &quot;monitor&quot; parallel executions of Deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11227">[ date ]</a>
              <a href="thread.html#11227">[ thread ]</a>
              <a href="subject.html#11227">[ subject ]</a>
              <a href="author.html#11227">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Pedro Sanchez wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I need to implement a function (say, myfunc) that fires several
</I>&gt;<i> independent Deferreds (using deferToThread), and that returns a deferred
</I>&gt;<i> itself. A client of this function (say, client) is expected to do
</I>&gt;<i> something like this:
</I>&gt;<i> 
</I>&gt;<i> def client():
</I>&gt;<i>     def done(success)
</I>&gt;<i>         if success:
</I>&gt;<i>            print 'd1 and d2 are done'
</I>&gt;<i> 
</I>&gt;<i>     d = myfunc()
</I>&gt;<i>     d.addCallback(done)
</I>&gt;<i>     ...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> myfuct() above does something like this:
</I>&gt;<i> 
</I>&gt;<i> def myfunc():
</I>&gt;<i>     def checkFunc1(success):
</I>&gt;<i>     ...
</I>&gt;<i> 
</I>&gt;<i>     def checkFunc2(success):
</I>&gt;<i>     ...
</I>&gt;<i> 
</I>&gt;<i>     d = defer.Deferred()
</I>&gt;<i>     d1 = deferToThread(func1).addCallback(checkFunc1)
</I>&gt;<i>     d2 = deferToThread(func2).addCallback(checkFunc2)
</I>&gt;<i>     d.addCallback(????)
</I>&gt;<i> 
</I>&gt;<i>     return d
</I>&gt;<i> 
</I>&gt;<i> Clearly d, d1, and d2 in the above are disconnected. And I don't want to
</I>&gt;<i> serialize d1 and d2 which would be a way to connect them all.
</I>&gt;<i> 
</I>&gt;<i> The problem is I don't know how d should be defined. The idea is that
</I>&gt;<i> the 'done' function in the client function is only called when both
</I>&gt;<i> threads d1 and d2 are done.
</I>
I think what you're looking for is DeferredList. You pass it a list of
deferreds you want to wait on and DeferredList will only fire its
callback method once all of the other deferred are complete. Read the
docs because the first callback you add to it will get a list of results
from all the defereds.

So for your above code, you'd want to do something like...

d1 = deferToThread(...)
d2 = deferToThread(...)
dl = defer.DeferredList([d1, d2])
dl.addCallback(...) # If needed here.
return dl

Just be aware to not add any additional callbacks to d1 or d2 after you
add them to the deferredlist.

Hope this helps. :)

-- 
Jason Fritcher
Software Engineer
Core Infrastructure Services &amp; Strategy
Earthlink, Inc
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fritcher at corp.earthlink.net</A>
(404) 748-7262, x22262
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 253 bytes
Desc: OpenPGP digital signature
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20050825/f1fd0150/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20050825/f1fd0150/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011225.html">[Twisted-Python] Transport for news client
</A></li>
	<LI>Next message: <A HREF="011236.html">[Twisted-Python] How to &quot;monitor&quot; parallel executions of Deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11227">[ date ]</a>
              <a href="thread.html#11227">[ thread ]</a>
              <a href="subject.html#11227">[ subject ]</a>
              <a href="author.html#11227">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
