<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] t.trial.remote -- does anyone use it?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20t.trial.remote%20--%20does%20anyone%20use%20it%3F&In-Reply-To=%3C20050826.014103.07620193.warner%40lothar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043721.html">
   <LINK REL="Next"  HREF="043749.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] t.trial.remote -- does anyone use it?</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20t.trial.remote%20--%20does%20anyone%20use%20it%3F&In-Reply-To=%3C20050826.014103.07620193.warner%40lothar.com%3E"
       TITLE="[Twisted-Python] t.trial.remote -- does anyone use it?">warner at lothar.com
       </A><BR>
    <I>Fri Aug 26 02:41:03 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043721.html">[Twisted-Python] t.trial.remote -- does anyone use it?
</A></li>
        <LI>Next message (by thread): <A HREF="043749.html">[Twisted-Python] t.trial.remote -- does anyone use it?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43741">[ date ]</a>
              <a href="thread.html#43741">[ thread ]</a>
              <a href="subject.html#43741">[ subject ]</a>
              <a href="author.html#43741">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Trial currently does some black magic to support remote reporters,
</I>&gt;<i> defined in t.trial.remote.  What use cases does t.trial.remote
</I>&gt;<i> implement?  Does anyone actually use it?
</I>
Not me.

&gt;<i> Rumour has it that it was originally written to make buildbot easier
</I>&gt;<i> to write.  However, I'm told that buildbot just parses stdio output.
</I>
Both rumors are correct. The buildbot currently just captures stdout/stderr
and parses the last few lines for the test-count summaries.

The original idea was to make a PB connection from the trial process to the
parent buildbot slave, and send fine-grained test results over that
connection. To accomplish this, we (slyphon and I) were planning to write a
Reporter class that would actually be distributed with the buildbot, then use
a trial option like --reporter-class=buildbot.trialreporter.RemoteReporter or
something. Another direction was to use PB running over stdin/stdout, using
the same scheme. The goal was to get a tuple of (testname, results,
exceptions, log.msg output, stdout, stderr, starttime, finishtime) for each
test, over on the buildslave, so that the buildbot status reporting could
give extremely fine-grained information about the tests which failed (perhaps
including full stack traces with local variables for the ERROR cases). The
most important thing to me is that we can get a list of test names and their
individual results, but having the trial.log text for each one separately
would make debugging test failures a lot easier (and the buildbot could
arrange to just mail the relevant parts of the logs to the person responsible
for that test, instead of sending the whole multi-megabyte logfile).

If I remember correctly, the extra Reporter functionality was there to give
buildbot enough feedback about tests starting/stopping to provide useful
status information (specifically to accurately update the ETA timing info: it
could eventually figure out that 45 tests out of 90 total means that it's N%
complete and therefore has an ETA of 2 minutes, etc). It's been a while since
I looked at the code, though.

I gave up on it at some point, mainly because the reactor cleanup routines
were getting in the way. (somewhat embarrassing because I was the one who put
many of those cleanup routines in there in the first place). Basically the PB
connection that was established by our RemoteReporter was torn down with a
vengeance by the clean-up-all-Selectables pass, flunking the first test and
condemning the rest to be run with no hope of ever delivering their status to
the buildslave. I decided to put off the whole clever machine-parseable
status thing until the trial's reactor cleanup had a way to let specific
selectables stick around.

So if that code is in the way, don't keep it around on account of the
buildbot. Having a pluggable reporter will be handy once reactor cleanup is
more convenient, but as long as that feature is retained in some form I think
we'll be able to figure out a way to get the status information to the
buildslave later.

cheers,
 -Brian

PS: another approach (implemented in trial at some point, I think, but I
don't believe I ever got buildbot to use it) was to jelly some status objects
and fling them out stdout in the hopes of being picked up by whoever launched
trial. This might have worked better, because one-way jelly over stdout
wouldn't have involved a Selectable (unlike two-way PB over stdio), so the
cleanup might not have stomped on it. However, I was uncomfortable with the
potential version skew of the code creating these jellied objects (coming
from twisted.trial) and the code that was hoping to interpret them (coming
from buildbot). The pluggable Reporter allowed the buildbot to supply the
code on both sides of the wire, which struck me as a better long-term
solution.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043721.html">[Twisted-Python] t.trial.remote -- does anyone use it?
</A></li>
	<LI>Next message (by thread): <A HREF="043749.html">[Twisted-Python] t.trial.remote -- does anyone use it?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43741">[ date ]</a>
              <a href="thread.html#43741">[ thread ]</a>
              <a href="subject.html#43741">[ subject ]</a>
              <a href="author.html#43741">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
