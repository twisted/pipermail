<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] simple spawnProcess
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20simple%20spawnProcess&In-Reply-To=%3C3E7F9D21F31D094DB7721553EA2CD1B5E72813%40NTXBOIMBX15.micron.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043643.html">
   <LINK REL="Next"  HREF="043609.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] simple spawnProcess</H1>
    <B>jmbenski at micron.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20simple%20spawnProcess&In-Reply-To=%3C3E7F9D21F31D094DB7721553EA2CD1B5E72813%40NTXBOIMBX15.micron.com%3E"
       TITLE="[Twisted-Python] simple spawnProcess">jmbenski at micron.com
       </A><BR>
    <I>Tue Aug  9 16:34:17 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043643.html">[Twisted-Python] twisted-compliant interactive interpreter
</A></li>
        <LI>Next message (by thread): <A HREF="043609.html">[Twisted-Python] simple spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43607">[ date ]</a>
              <a href="thread.html#43607">[ thread ]</a>
              <a href="subject.html#43607">[ subject ]</a>
              <a href="author.html#43607">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm new to twisted, Python, and network programming in general, so this question has probably been answered many times.  Although after searching for a few days I haven't seen it.

 

I'm trying to set up a simple process that accepts data through stdin and prints the response to stdout.  It is a continuously running process that will keep waiting for more input on stdin and will continue writing to stdout until a shutdown command is sent to it.  I started the reactor in a separate thread so that my main thread doesn't block while waiting for a response and I can send commands to the spawned process.

 

If I run this program without the sleep everything works correctly.  If I add the sleeps before the write, the write never registers with the process.  It is almost as if the pipe never gets flushed with the transport write.  I've looked through the API and haven't seen a way to flush the pipes and I have tried using the sys.stdout.flush().

 

What am I doing wrong?  Is there an easier way to setup inter-process communication through Twisted?

 

Thanks,

 

Jon

 

 

from twisted.internet import reactor, protocol

import threading

from twisted.python import threadable

import os

import sys

import time

 

threadable.init( with_threads=1)

 

class procProtocol(protocol.ProcessProtocol):

    def __init__(self):

        pass

    def connectionMade(self):

        print &quot;Connection Made\n&quot;

 

    def outReceived(self, data):

        file = open(&quot;bob.txt&quot;,&quot;a&quot;)

        file.write(&quot;outReceived\n&quot; + data)

        file.close()

          

class ReactorFacade:

 

            def __init__( self ):

                        self.reactorThread = threading.Thread(

                                    target=reactor.run,

                                    name=&quot;ReactorThread&quot;,

                                    kwargs={'installSignalHandlers':0},

                                    )

 

            def start(self):

                        # assume not yet started

                        print &quot;Facade: starting...&quot;

                        self.reactorThread.start()

                        print &quot;Facade: started ok&quot;

 

            def stop(self):

                        # assume already running

                        print &quot;Facade: request stop&quot;

                        reactor.callFromThread(reactor.stop)

                        print &quot;Facade: request stopped ok&quot;

                        self.reactorThread.join()

 

    executable = &quot;foo&quot;

    program = &quot;MSsync&quot;

    args = [&quot;arg1&quot;,&quot;arg2&quot;, &quot;path&quot;, str(os.getpid())]      

 

    #create the handler for the communication

    processProtocol = procProtocol()

    reactor.spawnProcess(processProtocol, executable, args,

                env=os.environ, path=args[2],

                uid=None, gid=None, usePTY=True)

 

    rf = ReactorFacade()

    rf.start()

    

    time.sleep(3)  #If I remove this sleep the following write will register with my process.

    processProtocol.transport.write( &quot;some command \r\n&quot; )

    time.sleep(3)

    processProtocol.transport.write( &quot;some command \r\n&quot; )

    rf.stop()

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20050809/40717143/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043643.html">[Twisted-Python] twisted-compliant interactive interpreter
</A></li>
	<LI>Next message (by thread): <A HREF="043609.html">[Twisted-Python] simple spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43607">[ date ]</a>
              <a href="thread.html#43607">[ thread ]</a>
              <a href="subject.html#43607">[ subject ]</a>
              <a href="author.html#43607">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
