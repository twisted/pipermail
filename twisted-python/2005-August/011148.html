<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] problem with combining deferreds together
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20problem%20with%20combining%20deferreds%20together&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011145.html">
   <LINK REL="Next"  HREF="011149.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] problem with combining deferreds together</H1>
    <B>michal salaban</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20problem%20with%20combining%20deferreds%20together&In-Reply-To="
       TITLE="[Twisted-Python] problem with combining deferreds together">emes at pld-linux.org
       </A><BR>
    <I>Mon Aug 15 12:41:37 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011145.html">[Twisted-Python] Query on Twisted word
</A></li>
        <LI>Next message: <A HREF="011149.html">[Twisted-Python] problem with combining deferreds together
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11148">[ date ]</a>
              <a href="thread.html#11148">[ thread ]</a>
              <a href="subject.html#11148">[ subject ]</a>
              <a href="author.html#11148">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hello all,

i've been playing with twisted adbapi for last three days to figure out if
it's a goot framework for application that i'm going to write soon.

i've stuck on one problem (probably i'm not the first, but couldn't google out
the soultion).

i have an object, which data is spread between two tables - the MainTable with
some data and reference to some row in SubTable with additional things.

what i'm trying to do is to create repository class with method .getByID()
that takes ID from MainTable and returns deferred, which in callback evaluates
to fully instatinated and data-populated object.

i've come up to this:

class ObjectRepository:

    def getById(self, id):
        dMain = self.dbpool.runInteraction(
                fetchOneAndMapToDictionary,
                &quot;SELECT * FROM MainTable WHERE id = '%d'&quot; % (id,)
                )
        dMain.addCallback(self._gotMainData)
        return dMain

    def _gotMainData(self, mappedRow):
        dSub = self.dbpool.runInteraction(
                fetchOneAndMapToDictionary,
                &quot;SELECT * FROM SubTable WHERE id = '%d'&quot; % (mappedRow['SubID'],)
                )
        dSub.addCallback(self._gotSubData)
        return [what to return ????]


how can i return the result that consist of data from both queries?
chaining callbacks is impossible. i cannot have dSub before dMain.callback()
is called, and also cannot do dMain.chainDeferred(dSub) in _gotMainData()
because dMain has already been returned to calling code and contains callbacks
attached there.

i suppose the solution is simple, but im 100% newbie to twisted and
event-driven programming.

thanks in advance :)

-- 
michal salaban -=- emes (at) pld-linux.org -=- jabber: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">emes at jabber.org</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011145.html">[Twisted-Python] Query on Twisted word
</A></li>
	<LI>Next message: <A HREF="011149.html">[Twisted-Python] problem with combining deferreds together
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11148">[ date ]</a>
              <a href="thread.html#11148">[ thread ]</a>
              <a href="subject.html#11148">[ subject ]</a>
              <a href="author.html#11148">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
