<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] simple spawnProcess
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20simple%20spawnProcess&In-Reply-To=%3C3E7F9D21F31D094DB7721553EA2CD1B5E72817%40NTXBOIMBX15.micron.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043609.html">
   <LINK REL="Next"  HREF="043618.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] simple spawnProcess</H1>
    <B>jmbenski at micron.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20simple%20spawnProcess&In-Reply-To=%3C3E7F9D21F31D094DB7721553EA2CD1B5E72817%40NTXBOIMBX15.micron.com%3E"
       TITLE="[Twisted-Python] simple spawnProcess">jmbenski at micron.com
       </A><BR>
    <I>Wed Aug 10 08:53:48 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043609.html">[Twisted-Python] simple spawnProcess
</A></li>
        <LI>Next message (by thread): <A HREF="043618.html">[Twisted-Python] simple spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43613">[ date ]</a>
              <a href="thread.html#43613">[ thread ]</a>
              <a href="subject.html#43613">[ subject ]</a>
              <a href="author.html#43613">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, obviously I'm missing something in the API.  

When I call reactor.run(), my main thread is stuck in the loop.  I tried to set up my code in a thread to get around this.

from twisted.internet import reactor
import os
import sys
import time

class procProtocol(protocol.ProcessProtocol):

    def __init__(self):
        pass

    def connectionMade(self):
        print &quot;Connection Made\n&quot;

    def outReceived(self, data):
        file = open(&quot;bob.txt&quot;,&quot;a&quot;)
        file.write(&quot;outReceived\n&quot; + data)
        file.close()

    executable = &quot;foo&quot;
    program = &quot;MSsync&quot;
    args = [&quot;arg1&quot;,&quot;arg2&quot;, &quot;path&quot;, str(os.getpid())]      

    #create the handler for the communication
    processProtocol = procProtocol()
    reactor.spawnProcess(processProtocol, executable, args,
                env=os.environ, path=args[2],
                uid=None, gid=None, usePTY=True)

    #launch the reactor to grab events.
    reactor.run()    

    ### I will never get here ###

    ##At some unknown point in the future I might need to issue commands
    processProtocol.transport.write( &quot;some command \r\n&quot; )
    processProtocol.transport.write( &quot;some command \r\n&quot; )


-----Original Message-----
From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of Jp Calderone
Sent: Wednesday, August 10, 2005 12:04 AM
To: Twisted general discussion
Subject: Re: [Twisted-Python] simple spawnProcess

On Tue, 9 Aug 2005 16:34:17 -0600, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jmbenski at micron.com</A> wrote:
&gt;<i>I'm new to twisted, Python, and network programming in general, so this question has probably been answered many times.  Although after searching for a few days I haven't seen it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I'm trying to set up a simple process that accepts data through stdin and prints the response to stdout.  It is a continuously running process that will keep waiting for more input on stdin and will continue writing to stdout until a shutdown command is sent to it.  I started the reactor in a separate thread so that my main thread doesn't block while waiting for a response and I can send commands to the spawned process.
</I>&gt;<i>
</I>
Why are you using threads at all?  Twisted's process support presents an asynchronous API, like most other things Twisted does.  You don't need threads here.  Their presence is what is breaking your program.  You cannot call reactor.run() from one thread and /any/ other Twisted API (unless explicitly marked as an exception) from a different thread.  In particular, reactor.spawnProcess() and transport.write() in the code you included are being called from the wrong thread.

Jp

_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043609.html">[Twisted-Python] simple spawnProcess
</A></li>
	<LI>Next message (by thread): <A HREF="043618.html">[Twisted-Python] simple spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43613">[ date ]</a>
              <a href="thread.html#43613">[ thread ]</a>
              <a href="subject.html#43613">[ subject ]</a>
              <a href="author.html#43613">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
