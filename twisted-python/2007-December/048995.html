<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Async file I/O with Linux &amp; Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Async%20file%20I/O%20with%20Linux%20%26%20Twisted&In-Reply-To=%3C20071220034218.20beba97%40dotz-laptop%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049011.html">
   <LINK REL="Next"  HREF="048999.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Async file I/O with Linux &amp; Twisted</H1>
    <B>Micha≈Ç Pasternak</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Async%20file%20I/O%20with%20Linux%20%26%20Twisted&In-Reply-To=%3C20071220034218.20beba97%40dotz-laptop%3E"
       TITLE="[Twisted-Python] Async file I/O with Linux &amp; Twisted">michal.dtz at gmail.com
       </A><BR>
    <I>Wed Dec 19 19:42:18 MST 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049011.html">[Twisted-Python] How to configure setup.py for a twistd TAP app
</A></li>
        <LI>Next message (by thread): <A HREF="048999.html">[Twisted-Python] Async file I/O with Linux &amp; Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48995">[ date ]</a>
              <a href="thread.html#48995">[ thread ]</a>
              <a href="subject.html#48995">[ subject ]</a>
              <a href="author.html#48995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, 

I've spent last few days trying to write a wrapper for libaio.

Libaio is a simple Linux-only library, which should in theory support
async read/write on a file descriptor. In practice - this depends on
many strange requirements and the documentation is basically
nonexistent (if you don't count lwn articles and kernel mailing list
archives), so that last few days of C coding looked like this: (it's
funny how every C coding session looks similar)

	<A HREF="http://youtube.com/watch?v=-JbhMvzeX7s">http://youtube.com/watch?v=-JbhMvzeX7s</A>
	
Just to summarize...
 * no AIO reads from socket 
 * not every filesystem supported 
 * output buffer must be N-pages long and aligned to page start
 * file access is unbuffered (yep, no cache!)
 * ... and it may still - *silently* - block in some circumstances
   (like, when you run out of &quot;block layer requests&quot;, like if 
   I knew, what are those)

Anyways, libaio seems to be a cool idea - maybe someday kernel guys
will do some more work on it (like, commit those patches which add
buffer aio) and it will be possible to do AIO stuff on sockets. On the
other hand, I found no way other to be informed about data
availability, than periodically reaping events (want libaio and epoll
integration? use some more kernel patches...)

You can get the module code and read about current linux aio problems
here:

	<A HREF="http://code.google.com/p/twisted-linux-aio/">http://code.google.com/p/twisted-linux-aio/</A>

It is not a general-purpose module - it's tightly tied to Twisted.
Only reads are supported ATM and there's no Python queue, only that low
level one (see TODO.txt). If you're lucky, you may even see the proof
of concept code running - w/o blocking. There are more things to come,
especially that async shutil.copyfileobj replacement... :)

Sad thing is, that Linux seems to lack much in this area, especially
when compared to FreeBSD...

-- 
m

PS: I feel glad I didn't started with POSIX aio_* implementation - on
Linux it is said to launch a new thread for every fd request!
<A HREF="http://www.atnf.csiro.au/people/rgooch/linux/docs/io-events.html">http://www.atnf.csiro.au/people/rgooch/linux/docs/io-events.html</A> - way
to go, glibc programmers! I hope things are looking better now, than
they were that few years ago...


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049011.html">[Twisted-Python] How to configure setup.py for a twistd TAP app
</A></li>
	<LI>Next message (by thread): <A HREF="048999.html">[Twisted-Python] Async file I/O with Linux &amp; Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48995">[ date ]</a>
              <a href="thread.html#48995">[ thread ]</a>
              <a href="subject.html#48995">[ subject ]</a>
              <a href="author.html#48995">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
