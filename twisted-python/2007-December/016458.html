<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] finer control of deferToThread ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20finer%20control%20of%20deferToThread%20%3F&In-Reply-To=710ff8630712142110x53fa7c05yae6c0fa79db5d522%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016457.html">
   <LINK REL="Next"  HREF="016459.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] finer control of deferToThread ?</H1>
    <B>Ed Suominen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20finer%20control%20of%20deferToThread%20%3F&In-Reply-To=710ff8630712142110x53fa7c05yae6c0fa79db5d522%40mail.gmail.com"
       TITLE="[Twisted-Python] finer control of deferToThread ?">general at eepatents.com
       </A><BR>
    <I>Sat Dec 15 10:50:02 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="016457.html">[Twisted-Python] finer control of deferToThread ?
</A></li>
        <LI>Next message: <A HREF="016459.html">[Twisted-Python] finer control of deferToThread ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16458">[ date ]</a>
              <a href="thread.html#16458">[ thread ]</a>
              <a href="subject.html#16458">[ subject ]</a>
              <a href="author.html#16458">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You can do priority queuing to one or more threads using AsynQueue,
<A HREF="http://foss.eepatents.com/AsynQueue">http://foss.eepatents.com/AsynQueue</A> or python-asynqueue in Debian. Use
multiple threads and queue up the compute-intensive calls with a low
priority and the other stuff with higher priorities.

However, you will need to chop up your compute-intensive stuff into
smaller pieces for this to be helpful. (That's good asynchronous
processing practice, generally.) The priority queuing is only effective
at deciding which calls to dispatch next, and each thread call is on its
own once it is dispatched from the queue. Each call uses an entire
thread for its entire duration, and will keep the queue from dispatching
anything else to that thread while it's squatting on it, no matter how
low-priority it is.

Best regards, Ed

Josef Novak wrote:
&gt;<i> Hi,
</I>&gt;<i>   I am writing a twisted application using StarPY fastagi API for
</I>&gt;<i> Asterisk.  My application involves answering user calls, and then
</I>&gt;<i> based on their responses to an IVR dialogue, running some some
</I>&gt;<i> compute-intensive applications on the same server, after they hang up.
</I>&gt;<i>   At the moment I am running the compute-intensive application (3rd
</I>&gt;<i> party code) in a deferred.deferToThread.  The application works fine,
</I>&gt;<i> however if the number of callers goes above 2-3, and one of the
</I>&gt;<i> compute-intensive applications from a previous call has not finished
</I>&gt;<i> up, the audio for the call gets very jumpy because of CPU usage.
</I>&gt;<i>   This compute-intensive process needs to be run immediately after
</I>&gt;<i> hangup, and I'd prefer to take care of everything on the same machine
</I>&gt;<i> (rather than send the compute-intensive application request somewhere
</I>&gt;<i> else).
</I>&gt;<i> 
</I>&gt;<i>   What I'd like to do is pause the thread with the
</I>&gt;<i> deferred.deferToThread process any time a new  call comes in (this
</I>&gt;<i> sort of violates what I'm saying above but the number of calls going
</I>&gt;<i> to a particular ASterisk trunk is limited so in most cases this would
</I>&gt;<i> never result in more than a couple-seconds delay, which is
</I>&gt;<i> acceptable).
</I>&gt;<i> 
</I>&gt;<i>   Is there any way to control these deferred.deferToThread objects in
</I>&gt;<i> a more fine-grained manner?  Say from a reactor factory?  Can I
</I>&gt;<i> register them separately somehow, and then pause these
</I>&gt;<i> compute-intensive applications temporarily every time a new call comes
</I>&gt;<i> in?  I'm imagining something as simple as as ctrl+z and $ fg linux
</I>&gt;<i> terminal commands... but I appreciate that it is probably not so
</I>&gt;<i> straightforward.
</I>&gt;<i> 
</I>&gt;<i>   -Joe
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016457.html">[Twisted-Python] finer control of deferToThread ?
</A></li>
	<LI>Next message: <A HREF="016459.html">[Twisted-Python] finer control of deferToThread ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16458">[ date ]</a>
              <a href="thread.html#16458">[ thread ]</a>
              <a href="subject.html#16458">[ subject ]</a>
              <a href="author.html#16458">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
