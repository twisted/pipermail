<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adbapi results through xmlrpc
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%20results%20through%20xmlrpc&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007400.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adbapi results through xmlrpc</H1>
    <B>Dave Peticolas</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%20results%20through%20xmlrpc&In-Reply-To="
       TITLE="[Twisted-Python] adbapi results through xmlrpc">dave at krondo.com
       </A><BR>
    <I>Wed Mar 31 16:37:22 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007400.html">[Twisted-Python] adbapi results through xmlrpc
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7397">[ date ]</a>
              <a href="thread.html#7397">[ thread ]</a>
              <a href="subject.html#7397">[ subject ]</a>
              <a href="author.html#7397">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Returning a deferred from the xmlrpc method will work fine -- twisted
will use the result of the deferred and not the deferred itself
when sending the return xml-rpc value.

The problem is that the result of the query is not serializable,
probably because it contains some pgsql objects somewhere.

Instead of sending the result directly, you'll probably want to
add a callback that picks the count value out of the row and column.
Also, the type of the count may not be a regular integer but some
pgsql-specific type. You'll have to do some debugging to see what's
going on.

Also, you probably don't want to create a connection pool for every
call, but if you do, don't forget to close the pool or you may end up
with lots of open connections.

dave

---- Original Message ----
From:		Zach Thompson
Date:		Wed 3/31/04 13:22
To:		<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Subject:	[Twisted-Python] adbapi results through xmlrpc

Hello,

I'm trying to connect 2 scripts (a server and client) xmlrpc.  The 
server just needs to run a db query and return the result set to the 
client for display.  Here's part of the server class:

     def xmlrpc_get_count(self):
         from twisted.enterprise import adbapi
         pool = adbapi.ConnectionPool(&quot;pyPgSQL.PgSQL&quot;, database=&quot;zach&quot;)
         return pool.runQuery(&quot;select count(*) from asdf&quot;)

And part of the client class:

     def OnButton(self, event):
         from twisted.web.xmlrpc import Proxy
         proxy = Proxy(&quot;<A HREF="http://localhost:8080&quot;">http://localhost:8080&quot;</A>)
         proxy.callRemote('get_count').addCallback(self.UpdateCount)

     def UpdateCount(self, count):
         self.label.SetLabel(count)

Here's what the client prints when I press the button:

   Unhandled error in Deferred:
   Failure: xmlrpclib.Fault: &lt;Fault 8002: &quot;can't serialize output&quot;&gt;

I can understand that xmlrpc needs to serialize the Deferred object to 
send it through http.  I'm guessing there's a reference to the 
ConnectionPool object contained in the Deferred, and it makes sense 
that you wouldn't be able to serialize something like that.

Any ideas?

BTW, the client is running on a wxreactor, if that matters..

Thanks,
Zach



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007400.html">[Twisted-Python] adbapi results through xmlrpc
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7397">[ date ]</a>
              <a href="thread.html#7397">[ thread ]</a>
              <a href="subject.html#7397">[ subject ]</a>
              <a href="author.html#7397">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
