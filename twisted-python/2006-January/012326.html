<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Triggering callbacks on raw file descriptors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Triggering%20callbacks%20on%20raw%20file%20descriptors&In-Reply-To=082D9F52-C4A9-422A-B759-8A98A894E041%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012323.html">
   <LINK REL="Next"  HREF="012327.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Triggering callbacks on raw file descriptors</H1>
    <B>Brian Granger</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Triggering%20callbacks%20on%20raw%20file%20descriptors&In-Reply-To=082D9F52-C4A9-422A-B759-8A98A894E041%40fuhm.net"
       TITLE="[Twisted-Python] Triggering callbacks on raw file descriptors">bgranger at scu.edu
       </A><BR>
    <I>Mon Jan  9 11:51:20 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012323.html">[Twisted-Python] Triggering callbacks on raw file descriptors
</A></li>
        <LI>Next message: <A HREF="012327.html">[Twisted-Python] Triggering callbacks on raw file descriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12326">[ date ]</a>
              <a href="thread.html#12326">[ thread ]</a>
              <a href="subject.html#12326">[ subject ]</a>
              <a href="author.html#12326">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jan 8, 2006, at 9:41 PM, James Y Knight wrote:

&gt;<i> On Jan 8, 2006, at 1:46 AM, Brian Granger wrote:
</I>&gt;&gt;<i> When I killed the reactor, I got an exception:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> exceptions.AttributeError: 'BonjourDescriptor' object has no  
</I>&gt;&gt;<i> attribute 'connectionLost'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It looks like the disconnectAll method on the reactor is calling  
</I>&gt;&gt;<i> reader.connectionLost on each reader.  Why is this so?
</I>&gt;&gt;<i> I thought I only needed to implement the IReadDescriptor interface  
</I>&gt;&gt;<i> for my reader, but the connectionLost method is not a part of that  
</I>&gt;&gt;<i> interface.  Hmmm.  Should I implement it?  What interface is that  
</I>&gt;&gt;<i> method in?  This seems confusing.
</I>&gt;<i>
</I>&gt;<i> connectionLost should have been on IFileDescriptor, the superclass  
</I>&gt;<i> of IReadDescriptor. I just added it:
</I>&gt;&gt;<i>     def connectionLost(self, reason):
</I>&gt;&gt;<i>         &quot;&quot;&quot;Called when the connection was lost.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         This is called when the connection on a selectable object  
</I>&gt;&gt;<i> has been
</I>&gt;&gt;<i>         lost.  It will be called whether the connection was closed  
</I>&gt;&gt;<i> explicitly,
</I>&gt;&gt;<i>         an exception occurred in an event handler, or the other  
</I>&gt;&gt;<i> end of the
</I>&gt;&gt;<i>         connection closed it first.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         See also L{IHalfCloseableDescriptor} if your descriptor  
</I>&gt;&gt;<i> wants to be
</I>&gt;&gt;<i>         notified separately of the two halves of the connection  
</I>&gt;&gt;<i> being closed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         @param reason: A failure instance indicating the reason  
</I>&gt;&gt;<i> why the
</I>&gt;&gt;<i>          connection was lost.  L 
</I>&gt;&gt;<i> {twisted.internet.error.ConnectionLost} and
</I>&gt;&gt;<i>          L{twisted.internet.error.ConnectionDone} are of special  
</I>&gt;&gt;<i> note, but
</I>&gt;&gt;<i>          the failure may be of other classes as well.
</I>&gt;&gt;<i>         &quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i> Hope that helps.
</I>
&gt;<i>
</I>&gt;<i> JP seems to disagree that it _should_ be part of the interface  
</I>&gt;<i> (<A HREF="http://twistedmatrix.com/bugs/issue1408">http://twistedmatrix.com/bugs/issue1408</A>), but it _is_ currently  
</I>&gt;<i> (and was previously, just undocumentedly so).
</I>&gt;<i>
</I>
Adding connectionLost to the IFileDescriptor interface does solve the  
problem.  But the situation is more complicated than that - and that  
makes me a little hesitant to just have connectionLost in  
IFileDescriptor as you have done.  Here is why:

The IReactorFDSet interface, specifies that any class that implements  
the IReadDescriptor can be used as a reader.  But, currently, the  
reactor's, which supposedly IReactorFDSet implements also call the  
following on the readers:

logPrefix -- part of twisted.python.log.Logger which FileDescriptor  
(the class) inherits from
connectionLost -- now part of IFileDescriptor

Thus is looks like readers are actually required to also be a  
subclass of the Logger class (the FileDescriptor class, which is used  
for Port does this).  The problem seems to be with the IReactorFDSset  
interface which doesn't actually specify acccurately which interfaces  
(and subclasses) the  readers/writers must implement.  Is there a  
ILogger interface as well?

Also, this makes me worry that developers have been asusming that  
readers are actually a subclass of FileDescriptor.  Is that the case?

I am not that experienced with this part of twisted, so I am not sure  
what is the best solution.

Thanks for looking into this.

Brian


&gt;<i> James
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012323.html">[Twisted-Python] Triggering callbacks on raw file descriptors
</A></li>
	<LI>Next message: <A HREF="012327.html">[Twisted-Python] Triggering callbacks on raw file descriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12326">[ date ]</a>
              <a href="thread.html#12326">[ thread ]</a>
              <a href="subject.html#12326">[ subject ]</a>
              <a href="author.html#12326">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
