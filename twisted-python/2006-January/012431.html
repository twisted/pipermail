<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Still fighting &quot;twisted.names.client&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Still%20fighting%20%22twisted.names.client%22&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012428.html">
   <LINK REL="Next"  HREF="012432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Still fighting &quot;twisted.names.client&quot;</H1>
    <B>Jesus Cea</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Still%20fighting%20%22twisted.names.client%22&In-Reply-To="
       TITLE="[Twisted-Python] Still fighting &quot;twisted.names.client&quot;">jcea at argo.es
       </A><BR>
    <I>Tue Jan 24 11:50:55 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012428.html">[Twisted-Python] newbie question
</A></li>
        <LI>Next message: <A HREF="012432.html">[Twisted-Python] Still fighting &quot;twisted.names.client&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12431">[ date ]</a>
              <a href="thread.html#12431">[ thread ]</a>
              <a href="subject.html#12431">[ subject ]</a>
              <a href="author.html#12431">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I started a thread a month ago, with no luck yet.
&lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/2005-December/012162.html">http://twistedmatrix.com/pipermail/twisted-python/2005-December/012162.html</A>&gt;

I have a reduced test case, for ease diagnosis. I hope Jean-Paul
Calderone can have a look at the issue.

My current &quot;simple&quot; code (not the real application, of course) is:

===== File &quot;dns4.tac&quot; =====

from twisted.application import service

application = service.Application(&quot;DNS test&quot;)

import sys
sys.path=[&quot;.&quot;]+sys.path

from dns4 import DomainResolver
DomainResolver().setServiceParent(application)

====================

===== File &quot;dns4.py&quot; =====

class resolution(object) :
  def __init__(self,domain) :
    global myResolver
    d = myResolver.lookupMailExchange(domain,timeout=(5,))
    d.addCallbacks(self._cbMailExchange, None)

  def _cbMailExchange(self,results):
    # Callback for MX query
    print &quot;XX&quot;,repr(results)
    from twisted.internet import reactor
    reactor.stop()
    return

from twisted.application import service

class DomainResolver(service.Service):
  def startService(self) :
    global myResolver

    from twisted.names import client
    myResolver=client.Resolver(servers=[('127.0.0.1', 53)])

    resolution(&quot;argo.es&quot;)
    #resolution(&quot;argo.es&quot;)

====================

I launch the application with &quot;twistd -n -y dns4.tac&quot;.

I get the following error: &quot;twisted.names.dns.DNSDatagramProtocol (UDP)]
Unexpected message (32863) received from ('127.0.0.1', 53)&quot;. Apparently
Twisted is sending the DNS request (and getting the DNS answer) before
setting up the handling object.

If I uncomment the last line, to do two resolutions, the reactor is not
stoped, but an infinite loop is created, with the following (infinite)
error:

=====

2006/01/24 17:39 CET [twisted.names.dns.DNSDatagramProtocol (UDP)]
Traceback (most recent call last):
          File
&quot;/usr/local/lib/python2.4/site-packages/twisted/python/log.py&quot;, line 43,
in callWithContext
            return context.call({ILogContext: newCtx}, func, *args, **kw)
          File
&quot;/usr/local/lib/python2.4/site-packages/twisted/python/context.py&quot;, line
59, in callWithContext
            return self.currentContext().callWithContext(ctx, func,
*args, **kw)
          File
&quot;/usr/local/lib/python2.4/site-packages/twisted/python/context.py&quot;, line
37, in callWithContext
            return func(*args,**kw)
          File
&quot;/usr/local/lib/python2.4/site-packages/twisted/internet/selectreactor.py&quot;,
line 139, in _doReadOrWrite
            why = getattr(selectable, method)()
        --- &lt;exception caught here&gt; ---
          File
&quot;/usr/local/lib/python2.4/site-packages/twisted/internet/udp.py&quot;, line
113, in doRead
            data, addr = self.socket.recvfrom(self.maxPacketSize)
        exceptions.AttributeError: 'Port' object has no attribute 'socket'

=====

Somebody could help me?. This issue is a showstopper in my twisted
learning :(.

Thanks in advance for your time.

- --
Jesus Cea Avion                         _/_/      _/_/_/        _/_/_/
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jcea at argo.es</A> <A HREF="http://www.argo.es/~jcea/">http://www.argo.es/~jcea/</A> _/_/    _/_/  _/_/    _/_/  _/_/
                                      _/_/    _/_/          _/_/_/_/_/
PGP Key Available at KeyServ   _/_/  _/_/    _/_/          _/_/  _/_/
&quot;Things are not so easy&quot;      _/_/  _/_/    _/_/  _/_/    _/_/  _/_/
&quot;My name is Dump, Core Dump&quot;   _/_/_/        _/_/_/      _/_/  _/_/
&quot;El amor es poner tu felicidad en la felicidad de otro&quot; - Leibniz
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.2 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org">http://enigmail.mozdev.org</A>

iQCVAwUBQ9Za75lgi5GaxT1NAQLNogQAhsMS+inrIuVGuOg+QuP/6qyYMPMg6GRJ
f3s9zUONp9YaPD03uysNA0UfzR4SO4BN5h40mciQUUx4YnxZl1MpSwqf8jHNYnWh
wgJ7FsY6rjYeYNke7exBteMt2eNSdffATv6hpNqPVYx8KpJGDMyN+pkxRN+cJbfy
i0lmC5EXQj8=
=LWe7
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012428.html">[Twisted-Python] newbie question
</A></li>
	<LI>Next message: <A HREF="012432.html">[Twisted-Python] Still fighting &quot;twisted.names.client&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12431">[ date ]</a>
              <a href="thread.html#12431">[ thread ]</a>
              <a href="subject.html#12431">[ subject ]</a>
              <a href="author.html#12431">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
