<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r15665 - Rewritten endpoints (TCP and UNIX) with unittests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r15665%20-%20Rewritten%20endpoints%0A%20%28TCP%20and%20UNIX%29%20with%20unittests&In-Reply-To=E1F0boi-0005We-00%40wolfwood">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012402.html">
   <LINK REL="Next"  HREF="012408.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r15665 - Rewritten endpoints (TCP and UNIX) with unittests</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r15665%20-%20Rewritten%20endpoints%0A%20%28TCP%20and%20UNIX%29%20with%20unittests&In-Reply-To=E1F0boi-0005We-00%40wolfwood"
       TITLE="[Twisted-Python] Re: [Twisted-commits] r15665 - Rewritten endpoints (TCP and UNIX) with unittests">exarkun at divmod.com
       </A><BR>
    <I>Sun Jan 22 14:13:06 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012402.html">[Twisted-Python] Re: [Twisted-web] CPUShare-Twisted
</A></li>
        <LI>Next message: <A HREF="012408.html">[Twisted-Python] Re: [Twisted-commits] r15665 - Rewritten	endpoints (TCP and UNIX) with unittests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12407">[ date ]</a>
              <a href="thread.html#12407">[ thread ]</a>
              <a href="subject.html#12407">[ subject ]</a>
              <a href="author.html#12407">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 22 Jan 2006 02:47:24 -0700, David Reid &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dreid at wolfwood.twistedmatrix.com</A>&gt; wrote:
&gt;<i>Author: dreid
</I>&gt;<i>Date: Sun Jan 22 02:47:23 2006
</I>&gt;<i>New Revision: 15665
</I>&gt;<i>
</I>&gt;<i>Added:
</I>&gt;<i>   branches/dreid/endpoints/twisted/test/test_endpoints.py
</I>&gt;<i>Modified:
</I>&gt;<i>   branches/dreid/endpoints/twisted/internet/endpoints.py
</I>&gt;<i>Log:
</I>&gt;<i>Rewritten endpoints (TCP and UNIX) with unittests
</I>
This branch seems to have no ticket number, so I'm commenting here.

twisted/test/test_endpoints.py:

Several test methods of TestEndpoints define nested functions which discard the Deferred returned by a Port's stopListening method.  These need to be waiting on that Deferred.

Why do some tests bind to 127.0.0.1 and some to 127.0.0.2?

None of the tests assert that the protocol/port is hooked up to the right address, either on the local or remote side.

None of the tests exercise client-side binding.

The TCP and UNIX tests are basically identical, except for the endpoint class being used.  This is a lot of unnecessary code duplication.  Implement the tests with the endpoint class parameterized and then call them all twice, once with TCPEndpoint, once with UNIXEndpoint.

Lots of trailing whitespace throughout the file.

twisted/internet/endpoint.py:

Interface definitions have docstrings - they don't need &quot;pass&quot; (pass is only required to satisfy grammar requirements for /some/ statement, and the docstrings do just fine for that).

The docstrings of neither IClientEndpoint.connect nor IServerEndpoint.listen define the error type which the Deferred may fail with.  Is it really true that IServerEndpoint.listen will never callback its Deferred?  The tests seem to think otherwise.

Typo in IServerEndpoint.listen's docstring - &quot;incomfing&quot;.

Also, these interfaces belong in twisted.internet.interfaces.

_EndpointClientFactory.buildProtocol should not be using callLater(0).  There is no guarantee that will be the correct time to deliver notification, and it is unnecessarily inefficient.  Instead, you probably want something like a ProtocolWrapper from twisted.protocols.policies.

self.callable(addr) in the same buildProtocol is user-code.  It would probably be useful for exceptions it raises to cause the Deferred associated with the factory to errback.  Currently, errors it causes will be logged and the Deferred passed back to the application will never fire or errback.

Similar comment for _EndpointServerFactory.buildProtocol's invocation of self.callable().

TCPEndpoint.listen - try/bareword except?  Why?  This looks like a perfect place for twisted.internet.defer.execute().

AddressToEndpoint looks like it should just be a function that returns either a TCPEndpoint or a UNIXEndpoint.

Trailing whitespace *and tabs* throughout.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012402.html">[Twisted-Python] Re: [Twisted-web] CPUShare-Twisted
</A></li>
	<LI>Next message: <A HREF="012408.html">[Twisted-Python] Re: [Twisted-commits] r15665 - Rewritten	endpoints (TCP and UNIX) with unittests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12407">[ date ]</a>
              <a href="thread.html#12407">[ thread ]</a>
              <a href="subject.html#12407">[ subject ]</a>
              <a href="author.html#12407">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
