<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> making sqlalchemy work with twisted (was Re: [Twisted-Python] SQL	Abstraction Layer_
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20making%20sqlalchemy%20work%20with%20twisted%20%28was%20Re%3A%20%5BTwisted-Python%5D%20SQL%0A%09Abstraction%20Layer_&In-Reply-To=%3C190701c61c86%24820a0d10%246402a8c0%40dcore%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044878.html">
   <LINK REL="Next"  HREF="044880.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>making sqlalchemy work with twisted (was Re: [Twisted-Python] SQL	Abstraction Layer_</H1>
    <B>Paul G</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20making%20sqlalchemy%20work%20with%20twisted%20%28was%20Re%3A%20%5BTwisted-Python%5D%20SQL%0A%09Abstraction%20Layer_&In-Reply-To=%3C190701c61c86%24820a0d10%246402a8c0%40dcore%3E"
       TITLE="making sqlalchemy work with twisted (was Re: [Twisted-Python] SQL	Abstraction Layer_">paul-lists at perforge.com
       </A><BR>
    <I>Wed Jan 18 16:25:17 MST 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044878.html">[Twisted-Python] SQL Abstraction Layer
</A></li>
        <LI>Next message (by thread): <A HREF="044880.html">making sqlalchemy work with twisted (was Re: [Twisted-Python]	SQL Abstraction Layer_
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44879">[ date ]</a>
              <a href="thread.html#44879">[ thread ]</a>
              <a href="subject.html#44879">[ subject ]</a>
              <a href="author.html#44879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
----- Original Message ----- 
From: &quot;Valentino Volonghi aka Dialtone&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dialtone at divmod.com</A>&gt;
To: &quot;Twisted general discussion&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Sent: Wednesday, January 18, 2006 5:28 AM
Subject: Re: [Twisted-Python] SQL Abstraction Layer


On Tue, Jan 17, 2006 at 09:34:11PM -0500, Paul G wrote:
&gt;&gt;<i> correct me if i'm wrong, but hacking/monkeypatching the sqlalchemy
</I>&gt;&gt;<i> accessors which implement this lazy load when attributes are accessed to
</I>&gt;&gt;<i> run their queries with deferToThread() would remove this problem, would 
</I>&gt;&gt;<i> it
</I>&gt;&gt;<i> not? more generally speaking, if you're not going to do explicit
</I>&gt;&gt;<i> deferToThread()s in your code (and avoid all attribute access), but 
</I>&gt;&gt;<i> rather,
</I>&gt;&gt;<i> say, insert them into the appropriate point in sqlalchemy (sqlengine 
</I>&gt;&gt;<i> seems
</I>&gt;&gt;<i> ro tbe the right place, or just a wrapper around the dbapi module), would
</I>&gt;&gt;<i> this not handle the issue as well? am i asking the wrong person/on the
</I>&gt;&gt;<i> wrong list? ;]
</I>
&gt;<i>I don't think it's the right approach to patch sqlalchemy to run attribute
</I>&gt;<i>access in a thread. You would still get a deferred from an attribute access
</I>&gt;<i>and this is pretty hugly to handle.
</I>
i'm not sure we're on the same page here. alternatively, i don't agree with 
your reasoning. if we use eager mode, objects get created when we call the 
mapper. in lazy mode, they can appear as a result of attribute access. to 
me, the fact that the two are different are a language syntax issue - 
semantically, i see both as a message to a slot on an object.  this is, 
iirc, how python allows sqlalchemy to intercept with attribute accessors as 
well ;)

to me, integrating sqlalchemy into twisted would ideally work in a way where 
all sqlalchemy api access is async. as i stated in my original mail, i 
currently believe that this could be possible to achieve by making all of 
sqlalchemy's calls into the dbapi module async with deferToThread(). if one 
does this, and it doesn't break something arcane in sqlalchemy, we shouldn't 
have to worry about deferreds in the client code. is there a reason why this 
wouldn't work or why it shouldn't be done that i am missing?

you could advance the argument that not having a deferToThread() in the 
client code would obscure the fact that the current 'cooperative thread' is 
yielding execution at that point, but that can be elucidated in the comments 
should one have a need to do that, while keeping the code much cleaner.

&gt;<i> Just using the eager mode would be perfect, the reason why I don't believe
</I>&gt;<i> that much in lazy queries is that you will end up using all the 
</I>&gt;<i> information,
</I>&gt;<i> otherwise it's better to query without using the ORM.
</I>
there are plenty of examples where lazy loading is useful in an ORM context 
and where you wouldn't want to do your own queries. in fact, i don't see why 
wanting to control loading behaviour would make the advantages of an ORM 
suddenly go away - to me, the principal advantage is making the code cleaner 
and, in the common case, masking the stuff that's going on under the hood. 
this becomes even more important, imho, when you want to lazy load things - 
not less.

&gt;<i>Currently SQLAlchemy is so good because it doesn't try to be clever but 
</I>&gt;<i>rather
</I>&gt;<i>only exposes the primitives and tries hard to be thread safe so that people
</I>&gt;<i>will be free to use it in the best way they want.
</I>
full agreement here. i love the way it's designed - simple, gives you access 
to the various levels of functionality independent of the others and leaves 
you free to use it however works best for you at any given point in 
time/code. it's one of the best ORMs, design-wise, that i've seen; the only 
thing that's missing is some docs for the UnitOfWork stuff.

-p 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044878.html">[Twisted-Python] SQL Abstraction Layer
</A></li>
	<LI>Next message (by thread): <A HREF="044880.html">making sqlalchemy work with twisted (was Re: [Twisted-Python]	SQL Abstraction Layer_
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44879">[ date ]</a>
              <a href="thread.html#44879">[ thread ]</a>
              <a href="subject.html#44879">[ subject ]</a>
              <a href="author.html#44879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
