<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] parallel callbacks? Or inserting into the callback	chain?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20parallel%20callbacks%3F%20Or%20inserting%20into%20the%20callback%0A%09chain%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012461.html">
   <LINK REL="Next"  HREF="012460.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] parallel callbacks? Or inserting into the callback	chain?</H1>
    <B>Lenny G Arbage</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20parallel%20callbacks%3F%20Or%20inserting%20into%20the%20callback%0A%09chain%3F&In-Reply-To="
       TITLE="[Twisted-Python] parallel callbacks? Or inserting into the callback	chain?">alengarbage at yahoo.com
       </A><BR>
    <I>Fri Jan 27 22:23:50 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012461.html">[Twisted-Python] is it possible to have a (single) twisted	client that
</A></li>
        <LI>Next message: <A HREF="012460.html">[Twisted-Python] Deferred ownership and the Protocols
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12458">[ date ]</a>
              <a href="thread.html#12458">[ thread ]</a>
              <a href="subject.html#12458">[ subject ]</a>
              <a href="author.html#12458">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Is there any way to make a deferred call its callbacks
'in parallel,' or to insert a callback into the
callback chain at a point further up than the end?  Or
maybe there is some other pattern for doing what I
need to accomplish, which is getting the result from a
deferred before it gets modified by the return of
other callbacks that have already been added, but
before it is fired.

Here is an example that illustrates why I need
something like this.  It is almost identical to the
first example in the deferred howto
(<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/defer.html">http://twistedmatrix.com/projects/core/documentation/howto/defer.html</A>):

from twisted.internet import reactor, defer

pending = {}

def getDummyData(queryName, x):
    if pending.has_key(x):
        print &quot;%s piggybacking on pending big
expensive query&quot; 
            % queryName
        return pending[x]

    d = defer.Deferred()
    # simulate a delayed result by asking the reactor
to fire the
    # Deferred in 2 seconds time with the result x*3
    print &quot;%s about to do some big expensive query&quot; %
queryName
    reactor.callLater(2, d.callback, x*3)
    pending[x] = d
    return d

def printData(d, queryName):
    &quot;&quot;&quot;
    Data handling function to be added as a callback:
handles the
    data by printing the result
    &quot;&quot;&quot;
    print &quot;%s received: %s&quot; % (queryName, d)

# simulate two calls (originating from some client[s])
at roughly the same
# time for the same query.
d = getDummyData('query1',3)
d.addCallback(printData,'query1')
d = getDummyData('query2',3)
d.addCallback(printData,'query2')

# manually set up the end of the process by asking the
reactor to
# stop itself in 13 seconds time
reactor.callLater(4, reactor.stop)
# start up the Twisted reactor (event loop handler)
manually
reactor.run()


The output, as you might expect, looks like this:

query1 about to do some big expensive query thing
query2 piggybacking on pending big expensive query
thing
query1 received: 9
query2 received: None

I'd like the output for query2 to match that of
query1.

Of course, this could be accomplished by adding a
'return d' to the end of printData(), but this is not
feasible in this case, because the caller of
getDummyData() might have added his own callbacks (in
addition to printData()) that do whatever it is that
he desires, including changing the return result or
not propogating it up the chain.

In the scenario I am designing for, getDummyData()
will be invoked by client(s), and we don't want to
open up new &quot;big expensive&quot; queries to the source if
one is already pending that matches.  Thus, I'd love
for getDummyData() to return a deferred that
piggybacks on an existing query, if one that matches
is still pending.

Can this be done?  Is there a way to modify the above
[simple] example so that it performs this behavior? 
Is there some other way to approach the problem that
I'm missing?

Thanks,
Lenny G.

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
<A HREF="http://mail.yahoo.com">http://mail.yahoo.com</A> 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012461.html">[Twisted-Python] is it possible to have a (single) twisted	client that
</A></li>
	<LI>Next message: <A HREF="012460.html">[Twisted-Python] Deferred ownership and the Protocols
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12458">[ date ]</a>
              <a href="thread.html#12458">[ thread ]</a>
              <a href="subject.html#12458">[ subject ]</a>
              <a href="author.html#12458">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
