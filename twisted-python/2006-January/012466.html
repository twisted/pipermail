<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Perspective Broker example broken
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Perspective%20Broker%20example%20broken&In-Reply-To=20060129235125.57838.qmail%40web52704.mail.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012463.html">
   <LINK REL="Next"  HREF="012464.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Perspective Broker example broken</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Perspective%20Broker%20example%20broken&In-Reply-To=20060129235125.57838.qmail%40web52704.mail.yahoo.com"
       TITLE="[Twisted-Python] Perspective Broker example broken">exarkun at divmod.com
       </A><BR>
    <I>Tue Jan 31 09:29:15 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012463.html">[Twisted-Python] Perspective Broker example broken
</A></li>
        <LI>Next message: <A HREF="012464.html">[Twisted-Python] How to do cleanup to server on sigint
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12466">[ date ]</a>
              <a href="thread.html#12466">[ thread ]</a>
              <a href="subject.html#12466">[ subject ]</a>
              <a href="author.html#12466">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 29 Jan 2006 15:51:25 -0800 (PST), Peter Stradinger &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">emlprime at yahoo.com</A>&gt; wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I'm trying to get the Authentication with Perspective Broker examples to work, and I'm getting a
</I>&gt;<i>Failure:
</I>&gt;<i>
</I>&gt;<i><A HREF="http://twistedmatrix.com/projects/core/documentation/howto/listings/pb/chatserver.py">http://twistedmatrix.com/projects/core/documentation/howto/listings/pb/chatserver.py</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/projects/core/documentation/howto/listings/pb/chatclient.py">http://twistedmatrix.com/projects/core/documentation/howto/listings/pb/chatclient.py</A>
</I>&gt;<i>
</I>&gt;<i>The server returns this error when you run the client:
</I>&gt;<i>
</I>&gt;<i>Unhandled error in Deferred:
</I>&gt;<i>Traceback (most recent call last):
</I>&gt;<i>Failure: twisted.spread.pb.PBConnectionLost: [Failure instance: Traceback (failure with no
</I>&gt;<i>frames): twisted.internet.error.ConnectionDone: Connection was closed cleanly.
</I>&gt;<i>]
</I>&gt;<i>
</I>&gt;<i>What does this mean?
</I>
PB was doing something, and had possibly exposed a Deferred to application-level code, but suddenly the connection was lost, before a result with which to fire that Deferred could be constructed from bytes received from the network.

&gt;<i>It doesn't occur if I don't call reactor.stop() from the client.  Is there
</I>&gt;<i>some other cleanup I have to do when shutting down the reactor from the 
</I>&gt;<i>client side?
</I>
Most likely, the server's send() call has not had a chance to complete fully when the client decided to exit.  This prevents the client from sending its reply to the send() call.  The server reports exactly what happened.

You can avoid this by only disconnecting (ie, stopping the reactor) when receiving a response to a call (as opposed to doing so when you receive a call but before you respond), although this can be difficult if you have more than one thing happening at a time.

More likely, you just want to handle PBConnectionLost on the server.  In many cases, it is probably appropriate just to trap and ignore it.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012463.html">[Twisted-Python] Perspective Broker example broken
</A></li>
	<LI>Next message: <A HREF="012464.html">[Twisted-Python] How to do cleanup to server on sigint
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12466">[ date ]</a>
              <a href="thread.html#12466">[ thread ]</a>
              <a href="subject.html#12466">[ subject ]</a>
              <a href="author.html#12466">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
