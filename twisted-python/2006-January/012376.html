<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> making sqlalchemy work with twisted (was Re:	[Twisted-Python]SQLAbstraction Layer_
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=making%20sqlalchemy%20work%20with%20twisted%20%28was%20Re%3A%0A%09%5BTwisted-Python%5DSQLAbstraction%20Layer_&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012375.html">
   <LINK REL="Next"  HREF="012377.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>making sqlalchemy work with twisted (was Re:	[Twisted-Python]SQLAbstraction Layer_</H1>
    <B>Paul G</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=making%20sqlalchemy%20work%20with%20twisted%20%28was%20Re%3A%0A%09%5BTwisted-Python%5DSQLAbstraction%20Layer_&In-Reply-To="
       TITLE="making sqlalchemy work with twisted (was Re:	[Twisted-Python]SQLAbstraction Layer_">paul-lists at perforge.com
       </A><BR>
    <I>Wed Jan 18 21:15:28 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012375.html">making sqlalchemy work with twisted (was Re: [Twisted-Python]SQL	Abstraction Layer_
</A></li>
        <LI>Next message: <A HREF="012377.html">making sqlalchemy work with twisted (was Re:	[Twisted-Python]SQLAbstraction Layer_
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12376">[ date ]</a>
              <a href="thread.html#12376">[ thread ]</a>
              <a href="subject.html#12376">[ subject ]</a>
              <a href="author.html#12376">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
----- Original Message ----- 
From: &quot;Jean-Paul Calderone&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt;
To: &quot;Twisted general discussion&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Sent: Wednesday, January 18, 2006 7:55 PM
Subject: Re: making sqlalchemy work with twisted (was Re: 
[Twisted-Python]SQLAbstraction Layer_


&gt;<i> On Wed, 18 Jan 2006 19:31:20 -0500, Paul G &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">paul-lists at perforge.com</A>&gt; 
</I>&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>----- Original Message ----- From: &quot;Jean-Paul Calderone&quot; 
</I>&gt;&gt;<i>&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt;
</I>&gt;&gt;<i>To: &quot;Twisted general discussion&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
</I>&gt;&gt;<i>Sent: Wednesday, January 18, 2006 7:10 PM
</I>&gt;&gt;<i>Subject: Re: making sqlalchemy work with twisted (was Re: [Twisted- 
</I>&gt;&gt;<i>Python]SQL Abstraction Layer_
</I>&gt;&gt;&gt;<i>On Wed, 18 Jan 2006 18:25:17 -0500, Paul G &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">paul-lists at perforge.com</A>&gt; 
</I>&gt;&gt;&gt;<i>wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>to me, integrating sqlalchemy into twisted would ideally work in a way 
</I>&gt;&gt;&gt;&gt;<i>where all sqlalchemy api access is async. as i stated in my original 
</I>&gt;&gt;&gt;&gt;<i>mail, i currently believe that this could be possible to achieve by 
</I>&gt;&gt;&gt;&gt;<i>making all of sqlalchemy's calls into the dbapi module async with 
</I>&gt;&gt;&gt;&gt;<i>deferToThread(). if one does this, and it doesn't break something arcane 
</I>&gt;&gt;&gt;&gt;<i>in sqlalchemy, we shouldn't have to worry about deferreds in the client 
</I>&gt;&gt;&gt;&gt;<i>code. is there a reason why this wouldn't work or why it shouldn't be 
</I>&gt;&gt;&gt;&gt;<i>done that i am missing?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I think you are missing the fact that if you do this, attribute access 
</I>&gt;&gt;&gt;<i>will result in a Deferred, not the value of the attribute from the 
</I>&gt;&gt;&gt;<i>database, which is not available yet.
</I>&gt;&gt;&gt;<i>So client code will have to deal with Deferreds, and in an extremely 
</I>&gt;&gt;&gt;<i>unusual manner - every attribute lookup will return a new Deferred.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>this would be very much like the 'future' in the actor-based concurrency 
</I>&gt;&gt;<i>model, so nothing terribly unusual. however, no, this is not what i want 
</I>&gt;&gt;<i>to do. maybe my (bad) ascii art will help:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>normal: attribute access -&gt; sqlalchemy accessor -&gt; sqlalchemy sqlengine -&gt; 
</I>&gt;&gt;<i>synchronous db query to dbapi -&gt; return to sqlengine -&gt; return to 
</I>&gt;&gt;<i>accessor -&gt; return attribute
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>new: attribute access -&gt; sqlalchemy accessor -&gt; sqlalchemy sqlengine -&gt; 
</I>&gt;&gt;<i>async call into dbapi with deferToThread-&gt; control returned to reactor -&gt; 
</I>&gt;&gt;<i>another coop thread gets control
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>... async dbapi result handler -&gt;  return to sqlengine -&gt; return to 
</I>&gt;&gt;<i>accessor -&gt; return attribute
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>did i explain what i mean well?
</I>&gt;<i>
</I>&gt;<i> Yes.  Unfortunately, this cannot be implemented in CPython without going 
</I>&gt;<i> to extreme lengths.
</I>
it just occurred to me what i was missing. namely, while the dbapi wrapper 
can deferToThread() for calls into the real dbapi module, there's no 
good/obvious way to yield control to the reactor and have the deferred's 
callback return execution to the callsite which invoked the dbapi wrapper in 
the first place. is this what you are alluding to?

if so, i suspect there might be some generator magic which can make this 
work. is this what you meant by 'extreme lengths'?

&gt;<i>  Also, there is some discussion among the core Twisted developers whether 
</I>&gt;<i> it even represents a good idea at all.  I think the split is currently 
</I>&gt;<i> something like 4 to 1 against.  If you look in either my blog or glyph's 
</I>&gt;<i> blog for &quot;concurrency&quot; you will find some exposition on the matter.
</I>
there are indeed very good arguments for not doing this in the general case. 
i believe the decision to make pb users be aware that the objects are remote 
follows from that. i've found that this makes using pb easier and apps using 
it easier to design (from a performance risk perspective) and easier to 
debug, as well as more robust. i wouldn't argue for making attribute access 
implicitly do asynchronous things in the general case, or in most cases 
even.

however, in the sqlalchemy case, at least for my purposes, it would make 
sense to do it to make the integration more seamless.

-p 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012375.html">making sqlalchemy work with twisted (was Re: [Twisted-Python]SQL	Abstraction Layer_
</A></li>
	<LI>Next message: <A HREF="012377.html">making sqlalchemy work with twisted (was Re:	[Twisted-Python]SQLAbstraction Layer_
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12376">[ date ]</a>
              <a href="thread.html#12376">[ thread ]</a>
              <a href="subject.html#12376">[ subject ]</a>
              <a href="author.html#12376">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
