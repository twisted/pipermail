<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SMTP server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20SMTP%20server&In-Reply-To=455322C7.3020605%40int.gl3">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014321.html">
   <LINK REL="Next"  HREF="014327.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SMTP server</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20SMTP%20server&In-Reply-To=455322C7.3020605%40int.gl3"
       TITLE="[Twisted-Python] SMTP server">exarkun at divmod.com
       </A><BR>
    <I>Thu Nov  9 11:05:21 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="014321.html">[Twisted-Python] SMTP server
</A></li>
        <LI>Next message: <A HREF="014327.html">[Twisted-Python] SMTP server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14324">[ date ]</a>
              <a href="thread.html#14324">[ thread ]</a>
              <a href="subject.html#14324">[ subject ]</a>
              <a href="author.html#14324">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 09 Nov 2006 13:44:55 +0100, Jan Bakuwel &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jan.bakuwel at int.greenpeace.org</A>&gt; wrote:
&gt;<i>Hoi all,
</I>&gt;<i>
</I>&gt;<i>This is my first message to the list so I think its appropriate to
</I>&gt;<i>express my appreciation for all the excellent work done by the people
</I>&gt;<i>who created &amp; contributed to the twisted libraries.
</I>&gt;<i>
</I>&gt;<i>I have a small but interesting problem that I'd like to ask your advise
</I>&gt;<i>on, please see the description below. If you notice that I haven't
</I>&gt;<i>understood something properly, I hope you'll correct me :-)
</I>&gt;<i>
</I>&gt;<i>I've implemented a SMTP server (I've called it &quot;xsmtp&quot;) using the
</I>&gt;<i>twisted &amp; python libraries. A MTA (Postfix) delivers email messages to
</I>&gt;<i>the xsmtp server: the MTA opens a single SMTP session to the xsmpt
</I>&gt;<i>server, then multiple &quot;RCPT TO&quot;s follow, one for each recipient.
</I>&gt;<i>
</I>&gt;<i>As a result The &quot;validateFrom&quot; procedure is called by the twisted
</I>&gt;<i>library once, followed by multiple calls to the &quot;validateTo&quot; procedure.
</I>&gt;<i>
</I>&gt;<i>This is creating a small problem for me. Since I must process the email
</I>&gt;<i>in the validateTo procedure, I will now receive multiple copies of the
</I>&gt;<i>same email (albeit for different recipients). One of the tasks of the
</I>&gt;<i>xsmtp server is to transmit these emails to another xsmtp server (SMTP
</I>&gt;<i>cannot be used due to the inherently high latency connection between the
</I>&gt;<i>two). Ideally I do not transfer the same email twice but would like to
</I>&gt;<i>leave the delivery to multiple recipients up to the MTA on the other
</I>&gt;<i>end. In a schema:
</I>&gt;<i>
</I>&gt;<i>-&gt; MTA -&gt; xsmtp -- high latency link --&gt; xsmtp -&gt; MTA -&gt; local delivery
</I>&gt;<i>
</I>&gt;<i>To implement smtp.IMessageDelivery I have to provide for the following
</I>&gt;<i>procedures:
</I>&gt;<i>
</I>&gt;<i>validateFrom:    called once shortly after SMTP session is initiated
</I>&gt;<i>receivedHeader:  called multiple times for each recipient
</I>&gt;<i>validateTo:      called multiple tiems for each recipient
</I>&gt;<i>
</I>&gt;<i>One could say that &quot;validateFrom&quot; is the start of the process (of
</I>&gt;<i>receiving an email) &quot;receivedHeader/validateTo&quot; is the core of the
</I>&gt;<i>process. What I am missing is something that indicates the end of the
</I>&gt;<i>process.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>It would help me tremendously if smtp.IMessageDelivery would also
</I>&gt;<i>provide an abstract method that is called once the message delivery is
</I>&gt;<i>completed.
</I>&gt;<i>
</I>&gt;<i>Any suggestions, thoughts are very welcome; perhaps this is already
</I>&gt;<i>possible with the twisted libraries in a different way as I'm suggesting
</I>&gt;<i>here?
</I>
The situation is not ideal, but I think if you use IMessageDeliveryFactory
instead of IMessageDelivery you'll be able to accomplish your goal.

With IMessageDeliveryFactory, you can create a new IMessageDelivery provider
for each SMTP transaction.  validateTo is still called multiple times on
your IMessageDelivery provider, but because a new one is created for each
transaction, you should be able to avoid making multiple deliveries to your
real backend.

(As I wrote that I realized it was not a very clear explanation at all, but
I cannot think of another way to put it without actually implementing
something).

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014321.html">[Twisted-Python] SMTP server
</A></li>
	<LI>Next message: <A HREF="014327.html">[Twisted-Python] SMTP server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14324">[ date ]</a>
              <a href="thread.html#14324">[ thread ]</a>
              <a href="subject.html#14324">[ subject ]</a>
              <a href="author.html#14324">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
