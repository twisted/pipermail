<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Perspective Broker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Perspective%20Broker&In-Reply-To=cd8fa6f90611270337v78183db3kab4baa58eb079422%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014418.html">
   <LINK REL="Next"  HREF="014417.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Perspective Broker</H1>
    <B>le dahut</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Perspective%20Broker&In-Reply-To=cd8fa6f90611270337v78183db3kab4baa58eb079422%40mail.gmail.com"
       TITLE="[Twisted-Python] Perspective Broker">le.dahut at laposte.net
       </A><BR>
    <I>Tue Nov 28 09:57:01 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="014418.html">[Twisted-Python] Perspective Broker
</A></li>
        <LI>Next message: <A HREF="014417.html">[Twisted-Python] SQLAlchemy integration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14436">[ date ]</a>
              <a href="thread.html#14436">[ thread ]</a>
              <a href="subject.html#14436">[ subject ]</a>
              <a href="author.html#14436">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks, I didn't understand that Callbacks are &quot;chainable&quot; also between 
the different PB actors.

It's a bit difficult to understand but once is done, it's a pleasure to 
use :-) .


christian simms a &#233;crit :
&gt;<i> On 11/27/06, le dahut &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">le.dahut at laposte.net</A>&gt; wrote:
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Using PB, I've setup a system where clients can control other clients in
</I>&gt;&gt;<i> this way :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> client1 executes &quot;remote_do_something&quot; on server1 with &quot;ip_client2&quot; as
</I>&gt;&gt;<i> argument.
</I>&gt;&gt;<i> Then server1 connects to client2 and executes &quot;remote_smthng&quot; on it.
</I>&gt;<i> 
</I>&gt;<i> I haven't used PB before, but I have used other protocols with
</I>&gt;<i> Deferreds.  Assuming your PB code is OK, you're only missing a couple
</I>&gt;<i> lines related to callbacks, which I'll insert below.
</I>&gt;<i> 
</I>&gt;&gt;<i> code is like this :
</I>&gt;&gt;<i> - client1:
</I>&gt;&gt;<i> &quot;&quot;&quot;
</I>&gt;&gt;<i> factory = pb.PBClientFactory()
</I>&gt;&gt;<i> reactor.connectTCP(ip_server1, port, factory)
</I>&gt;&gt;<i> d = factory.getRootObject()
</I>&gt;&gt;<i> d.addCallback(lambda object: object.callRemote(&quot;do_something&quot;, 
</I>&gt;&gt;<i> ip_client2))
</I>&gt;&gt;<i> d.addCallback(client1_call_b)
</I>&gt;&gt;<i> d.addErrback(client1_err_b)
</I>&gt;<i> 
</I>&gt;<i> Please note that above, your client1_call_b function will be called
</I>&gt;<i> with its argument being the result of the remote method call
</I>&gt;<i> &quot;do_something&quot;.
</I>&gt;<i> 
</I>&gt;&gt;<i> &quot;&quot;&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - server1:
</I>&gt;&gt;<i> &quot;&quot;&quot;
</I>&gt;&gt;<i> def remote_do_something(ip):
</I>&gt;&gt;<i>      factory = pb.PBClientFactory()
</I>&gt;&gt;<i>      reactor.connectTCP(ip_client2, port, factory)
</I>&gt;&gt;<i>      d = factory.getRootObject()
</I>&gt;&gt;<i>      d.addCallback(lambda object: object.callRemote(&quot;smthng&quot;))
</I>&gt;&gt;<i>      d.addCallback(server1_call_b)
</I>&gt;&gt;<i>      d.addErrback(server1_err_b)
</I>&gt;<i> 
</I>&gt;<i> Above, you need to add a &quot;return d&quot; statement at the very end of your
</I>&gt;<i> function &quot;remote_do_something&quot;, or else Twisted won't know that the
</I>&gt;<i> output of the function &quot;remote_do_something&quot; should be the end result
</I>&gt;<i> of your Deferred &quot;d&quot;.  Also, your function &quot;server1_call_b&quot; MUST
</I>&gt;<i> return its argument, or else the result will not get passed along.  It
</I>&gt;<i> could look something like this:
</I>&gt;<i> 
</I>&gt;<i> def server1_call_b(out):
</I>&gt;<i>    return out
</I>&gt;<i> 
</I>&gt;<i> The argument to server1_call_b is the result from the
</I>&gt;<i> &quot;object.callRemote('smthng')&quot; statement, and we are simply returning
</I>&gt;<i> it.  In fact, if that's all the function did, you should not even
</I>&gt;<i> define it (or use it in the callback chain) since it's not necessary.
</I>&gt;<i> But if you forgot the return statement then you would get Python's
</I>&gt;<i> default return value from a function, None, instead of the value.
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;&quot;&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - client2:
</I>&gt;&gt;<i> &quot;&quot;&quot;
</I>&gt;&gt;<i> def remote_smthng():
</I>&gt;&gt;<i>      &lt;code&gt;
</I>&gt;&gt;<i>      return &quot;Ok, everything's done&quot;
</I>&gt;&gt;<i> &quot;&quot;&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How can client1 get client2's answer ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> Hopefully that does it.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Christian
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014418.html">[Twisted-Python] Perspective Broker
</A></li>
	<LI>Next message: <A HREF="014417.html">[Twisted-Python] SQLAlchemy integration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14436">[ date ]</a>
              <a href="thread.html#14436">[ thread ]</a>
              <a href="subject.html#14436">[ subject ]</a>
              <a href="author.html#14436">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
