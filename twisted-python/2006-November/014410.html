<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Keeping a list of connected PB clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Keeping%20a%20list%20of%20connected%20PB%20clients&In-Reply-To=3af8969a0611251133o275f120fg9b7eb36867188098%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014407.html">
   <LINK REL="Next"  HREF="014402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Keeping a list of connected PB clients</H1>
    <B>Phil Christensen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Keeping%20a%20list%20of%20connected%20PB%20clients&In-Reply-To=3af8969a0611251133o275f120fg9b7eb36867188098%40mail.gmail.com"
       TITLE="[Twisted-Python] Keeping a list of connected PB clients">phil at bubblehouse.org
       </A><BR>
    <I>Sat Nov 25 22:38:15 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="014407.html">[Twisted-Python] Keeping a list of connected PB clients
</A></li>
        <LI>Next message: <A HREF="014402.html">[Twisted-Python] twisted SNMP problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14410">[ date ]</a>
              <a href="thread.html#14410">[ thread ]</a>
              <a href="subject.html#14410">[ subject ]</a>
              <a href="author.html#14410">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Nov 25, 2006, at 2:33 PM, Yi Qiang wrote:
&gt;<i> What I am having trouble with is getting access to the clients IP  
</I>&gt;<i> address.  This is not something I can pass in in the  
</I>&gt;<i> PBClientFactory's login method, since many computers are NAT'ed.
</I>
I'm not sure if I understand you here, are you saying that you *are*  
passing in the client's IP? There's fundamentally no way for the  
server to know the IP of a NAT'd client unless the client sends it.

&gt;<i> Yes, this is something I do have trouble with.  I will look into  
</I>&gt;<i> the singleton pattern.  It would be nicer if there was a convenient  
</I>&gt;<i> way to bubble up the  list of clients.
</I>
I agree. I would be particularly interested in findnig an direct  
interface into the reactor that allows me to at least view, if not  
manipulate connected clients. Something similar to netstat's output  
would be ideal.

Any other Twisted devs know something I don't in this matter?

&gt;<i> On Nov 24, 2006, at 6:46 PM, Phil Christensen wrote:
</I>&gt;&gt;<i> One thing this approach doesn't do is keep track of clients that  
</I>&gt;&gt;<i> connect, but fail authentication. To do that, you'd need to  
</I>&gt;&gt;<i> subclass Broker, but that's a tough one. I looked into this once  
</I>&gt;&gt;<i> before, and it certainly appears doable -- in the end, a Broker is  
</I>&gt;&gt;<i> still a Protocol, which means it has a transport property you can  
</I>&gt;&gt;<i> get client addresses out of.
</I>&gt;<i>
</I>&gt;<i> This is exactly what I need to do so I can associate a client with  
</I>&gt;<i> both their username and ip address.  I have access to the broker if  
</I>&gt;<i> I subclass PBServerFactory, but I am not sure how to access it from  
</I>&gt;<i> the Realm, or if it is possible at all.
</I>
Well, the actual act of replacing the broker is easy, you just do this:

&gt;<i> from twisted.spread import pb
</I>&gt;<i> pb.PBServerFactory.protocol = MyBrokerSubclass
</I>
This will make all future PB servers you create use your new protocol.

Of course, that's not the hard part ;-).

It should definitely be possible to wedge yourself in there between  
the various connection handlers, but it's non-trivial. There's also a  
high likelihood that you may need to modify/subclass other classes,  
which may or may not have an appropriate interface for doing so.

I think the end result wouldn't really be worth the investment of  
time. If your server *really* needs detailed information about  
connected clients at a very raw level, but also requires the power of  
Perspective Broker, you might try splitting your app into two pieces.

You could mimic the old-school FTP approach, and create a main  
control channel that speaks a custom, albeit simple protocol. All  
this channel would do is handle the connected clients, and provide  
some kind of token to them that they could pass back to the PB server.

If you need to be sure of security, you could generate random names  
for the remote objects you wish your clients to interact with, and  
have the clients provide that name to the PB server on each request.  
There are probably a number of other approaches that could provide  
even tighter security.

If this won't do the trick for you, you might need to provide a  
little more information about what you're actually trying to accomplish.

-phil


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014407.html">[Twisted-Python] Keeping a list of connected PB clients
</A></li>
	<LI>Next message: <A HREF="014402.html">[Twisted-Python] twisted SNMP problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14410">[ date ]</a>
              <a href="thread.html#14410">[ thread ]</a>
              <a href="subject.html#14410">[ subject ]</a>
              <a href="author.html#14410">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
