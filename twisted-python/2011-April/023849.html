<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted Plugins - Implementation Discussion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Plugins%20-%20Implementation%20Discussion&In-Reply-To=20110407003518.GD764%40thorne.id.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023848.html">
   <LINK REL="Next"  HREF="023852.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted Plugins - Implementation Discussion</H1>
    <B>Phil Christensen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Plugins%20-%20Implementation%20Discussion&In-Reply-To=20110407003518.GD764%40thorne.id.au"
       TITLE="[Twisted-Python] Twisted Plugins - Implementation Discussion">phil at bubblehouse.org
       </A><BR>
    <I>Thu Apr  7 00:06:07 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023848.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
        <LI>Next message: <A HREF="023852.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23849">[ date ]</a>
              <a href="thread.html#23849">[ thread ]</a>
              <a href="subject.html#23849">[ subject ]</a>
              <a href="author.html#23849">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 6, 2011, at 8:35 PM, Stephen Thorne wrote:
&gt;<i> For your consideration, and (constructive) critcism, here is a twisted
</I>&gt;<i> plugin that is nearly identical to 6 that I have running in  
</I>&gt;<i> production:
</I>[snip]
&gt;<i> serviceMaker = ExampleServiceMaker()
</I>&gt;<i>
</I>&gt;<i> From these 19 lines of code there are 4 things that are relevent:
</I>&gt;<i> tapname = example
</I>&gt;<i> description = 'Example Twistd Plugin'
</I>&gt;<i> options = {'debug':True} if args == ['--debug'] else {'debug':False}
</I>&gt;<i> service = examplepackage.examplemodule.make_service(**options)
</I>&gt;<i>
</I>&gt;<i> Only 2 of which are relevent for running a twistd daemon other than
</I>&gt;<i> 'example'
</I>&gt;<i>
</I>&gt;<i> So the goal of my post to this mailing list is:
</I>&gt;<i>
</I>&gt;<i> * I would like glyph's goal of having less arbitary code executed at
</I>&gt;<i>  twistd launch time to become a realisation,
</I>
Makes sense. My first inclination is to suggest creating metadata  
files that are found via pkg_resources.

&gt;<i> * I would like the process of creating a twisted plugin to be less  
</I>&gt;<i> of a
</I>&gt;<i>  cut+paste+fill-in-blanks hassle.
</I>
This doesn't bother me so much. To go back in time a bit:

&gt;<i> First, the reason i use twisted plugins is because they're the a way  
</I>&gt;<i> to
</I>&gt;<i> easily do sensible things with logging, daemonisation and interaction
</I>&gt;<i> from init.d files.
</I>&gt;<i>
</I>&gt;<i> * The number of imports required to compose a plugin is annoying. 2
</I>&gt;<i>  interfaces from two different packages, plus needing
</I>&gt;<i>  zope.interface.implements.
</I>&gt;<i>
</I>&gt;<i> * I've never liked the twisted arg parser, I use it only grudingly, it
</I>&gt;<i>  would be nice to be able to throw argv at my make_service call.
</I>
I've got no issues with t.p.usage, and tend to keep its definitions in  
the plugin class. But I agree you should be able to skip it, although  
I have a suspicion you probably already can by being sneaky.

&gt;<i> * The entire task of having this python plugin is to link up the
</I>&gt;<i>  metadata with a more or less standard
</I>
Not sure if I get this part. I tend to think of plugins as the service  
bootstrap file, like an int main(). I would probably *not* be into the  
idea of passing sys.argv directly to a service, for example.

&gt;<i> * It's very easy to accidentally make your plugin load your package  
</I>&gt;<i> for
</I>&gt;<i>  every other twistd daemon running out of the same plugin cache.
</I>
Never had this happen, but I think I can see where it might. It would  
be solved by some kind of external metadata, though, right?

&gt;<i> * The practice of putting a module under twisted/plugins/ 
</I>&gt;<i> $mymodulehere.py
</I>&gt;<i>  upsets my equilibrium, the only reason I tolerate this kind of thing
</I>&gt;<i>  is that I install my python code via rpms and I automatically get
</I>&gt;<i>  installation, ownership and uninstallation done in a stable manner.
</I>
The only issue I've found with this is the issue of having to create  
plugin cache files. Apart from the spurious error messages that were  
(partially?) covered at the sprint recently, the benefit they provide  
is definitely negated by bad permissions. I've done some acrobatics  
inside my setup.py to make it work, but it involves different steps  
depending on whether you're installing or building a package.

Still, it seems like most of their necessity would be negated by using  
external metadata files. It seems to be the way most plugin systems  
end up going in some way or another.

Anyways, that's just my 2/100ths. I'm pretty happy with most of the  
plugin model, but I think there's a lot of room for improvement,  
particularly in the area of dropin.cache files.

-phil

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023848.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
	<LI>Next message: <A HREF="023852.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23849">[ date ]</a>
              <a href="thread.html#23849">[ thread ]</a>
              <a href="subject.html#23849">[ subject ]</a>
              <a href="author.html#23849">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
