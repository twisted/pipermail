<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Creating a hybrid server in Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Creating%20a%20hybrid%20server%20in%20Twisted&In-Reply-To=20110404092821.GC70065%40vk2pj.dyndns.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023806.html">
   <LINK REL="Next"  HREF="023815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Creating a hybrid server in Twisted</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Creating%20a%20hybrid%20server%20in%20Twisted&In-Reply-To=20110404092821.GC70065%40vk2pj.dyndns.org"
       TITLE="[Twisted-Python] Creating a hybrid server in Twisted">andrew at bemusement.org
       </A><BR>
    <I>Mon Apr  4 05:43:20 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023806.html">[Twisted-Python] Creating a hybrid server in Twisted
</A></li>
        <LI>Next message: <A HREF="023815.html">[Twisted-Python] @inlinecallbacks and AlreadyCalledError in test	cases
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23807">[ date ]</a>
              <a href="thread.html#23807">[ thread ]</a>
              <a href="subject.html#23807">[ subject ]</a>
              <a href="author.html#23807">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jashank Jeremy wrote:
[...]
&gt;<i> So I'm pretty much stuck in a rut.  I don't want to totally reinvent the
</I>&gt;<i> wheel just to be able to protocol-switch; I'd prefer to make use of
</I>&gt;<i> existing code from Twisted.  How do I hijack Twisted.Web to add protocol
</I>&gt;<i> switching?
</I>
You could override lineReceived along the lines of:

    def connectionMade(self):
    	self.seenFirstLine = False
	HTTPChannel.connectionMade(self)

    def lineReceived(self, line):
	if not self.seenFirstLine and line == 'CORDELIA':
	    # do your protocol switch; e.g. setRawMode and a flag to
	    # pass all bytes directly to some other protocol.  If you
	    # want to be really hackish here you can reassign
	    # self.__class__&#8230;
	else:
            self.seenFirstLine = True
	    HTTPChannel.lineReceived(self, line)

Alternatively, you could write a protocol decorator to do much the same
thing (i.e. a Protocol that wraps around the HTTPChannel instance).
There's some infrastructure in twisted.protocols.policies that may help
you write that.

(This sort of thing may make an interesting example to add to the
examples in our docs.  I can imagine it'd be possible to add a
ProtocolSwitchingDecoratorBase or similar to twisted.protocols.policies
to make it easier.  It's not a common requirement, but it is something
that people want to do from time to time.  I know I've done it&#8230;)

-Andrew.


</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023806.html">[Twisted-Python] Creating a hybrid server in Twisted
</A></li>
	<LI>Next message: <A HREF="023815.html">[Twisted-Python] @inlinecallbacks and AlreadyCalledError in test	cases
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23807">[ date ]</a>
              <a href="thread.html#23807">[ thread ]</a>
              <a href="subject.html#23807">[ subject ]</a>
              <a href="author.html#23807">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
