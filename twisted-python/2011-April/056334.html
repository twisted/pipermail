<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted Plugins - Implementation Discussion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20Plugins%20-%20Implementation%20Discussion&In-Reply-To=%3C0EC2C32E-05FD-48ED-85DF-900ED6F0EA2C%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056333.html">
   <LINK REL="Next"  HREF="056336.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted Plugins - Implementation Discussion</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20Plugins%20-%20Implementation%20Discussion&In-Reply-To=%3C0EC2C32E-05FD-48ED-85DF-900ED6F0EA2C%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Twisted Plugins - Implementation Discussion">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Apr  6 22:54:45 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056333.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
        <LI>Next message (by thread): <A HREF="056336.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56334">[ date ]</a>
              <a href="thread.html#56334">[ thread ]</a>
              <a href="subject.html#56334">[ subject ]</a>
              <a href="author.html#56334">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Apr 7, 2011, at 12:31 AM, Tim Allen wrote:

&gt;<i> On Thu, Apr 07, 2011 at 10:35:18AM +1000, Stephen Thorne wrote:
</I>&gt;&gt;<i> So the goal of my post to this mailing list is:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> * I would like glyph's goal of having less arbitary code executed at
</I>&gt;&gt;<i>  twistd launch time to become a realisation,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> * I would like the process of creating a twisted plugin to be less of a
</I>&gt;&gt;<i>  cut+paste+fill-in-blanks hassle.
</I>&gt;<i> 
</I>&gt;<i> I notice that Tarek Ziad√©'s &quot;distutils2&quot; is moving away from &quot;load
</I>&gt;<i> a Python module and probe for well-known attributes&quot; toward &quot;define all
</I>&gt;<i> metadata in a static file&quot;. It sounds like you want a similar thing for
</I>&gt;<i> twistd plugins. Perhaps an implementation might look something like
</I>&gt;<i> this:
</I>&gt;<i> 
</I>&gt;<i>    - At startup, twistd scans twisted/plugin directories on sys.path
</I>&gt;<i>      looking for files whose filenames end with '.twistd'.
</I>
While I'm sympathetic to the goal here, I don't like this particular implementation strategy for several reasons.

Right now, in order to properly install a 'twistd' plugin (including those that come with Twisted), you have to do two things:

  1. install some .py files into a package
  2. as the user doing the installation (probably root), run the one-liner at the bottom of &lt;<A HREF="http://twistedmatrix.com/documents/11.0.0/core/howto/plugin.html#auto3">http://twistedmatrix.com/documents/11.0.0/core/howto/plugin.html#auto3</A>&gt;.  If invoking python code in your installation process is too hard, this can be approximated with 'twistd --help 2&gt;&amp;1 &gt; /dev/null'.

This is rocket science.  Nobody can manage it.  Seriously.  After literally _years_ of fighting with conflicting python installation techniques in Debian and Ubuntu, I think that we finally have something that works about half of the time.  I haven't checked up on RedHat in a while and I don't know if they have a working system to do this yet, but they didn't last I checked.

If we invent our own file extension which has to be separately installed, we have to teach distutils, and setuptools, and distribute, and pip, and distutils2, and 'packaging' (as I'm sure that will eventually be incompatible with distutils2 for some silly reason), and easy_install, and dpkg, and rpm, and yum, and apt, and probably five other horrible Python packaging things that I don't even know about yet, how to deal with it.  So I am strongly in favor of keeping everything in .py files and just making a minor tweak to what's stored in dropin.cache (and perhaps allowing dropin.cache to be stored in some location more likely to be writable by individual users, in case the installation process doesn't update it).

Because, frankly, Python installation tools REALLY REALLY SHOULD be able to install Python files into Python packages.  I'm not sure I can make any other assertions quite so strongly.  I'm pretty sure that this is a problem that more than one project is interested in solving.  No other projects are interested in installing '.twistd' files though, I can assure you of that :).

&gt;<i>    - Each such file is loaded with Python's ConfigParser module.
</I>
The first rule of the Twisted cabal is of course &quot;don't talk about the Twisted cabal&quot;, but the second and possibly even more important rule is &quot;no '.ini' files&quot;.  I'd seriously much rather we use XML.  And you can ask Stephen how he feels about XML configuration files.  (Although I'd strongly recommend standing well clear of him when you do that, and making sure that no sharp or otherwise dangerous objects are within easy reach.)

&gt;<i>    - Each section blah blah terrible user interface stuff about 'sections' and other misfeatures of ini files.
</I>
I don't want a solution that is hard-coded to deal with the metadata that 'twistd' specifically needs, as Twisted plugins are already used for more than just twistd plugins, and I'd like them to be used for even more.  An interface that limits the metadata to ConfigParser sections would make it awkward to fit into a management GUI or web page.

Plus, the quoting rules for long strings in ini files make it unsuitable for storing long descriptive strings (which is one of the primary use-cases here).

&gt;<i> ...where the module defined by 'module' exposes a
</I>&gt;<i> 'make_service(options)' function, and an 'options' global variable that
</I>&gt;<i> is an instance of t.p.usage.Options.
</I>&gt;<i> 
</I>&gt;<i> I know you said you didn't like t.p.usage.Options, but I'd be sad to
</I>&gt;<i> lose the ability for twistd to support &quot;twistd $PLUGIN --help&quot;, and for
</I>&gt;<i> that kind of introspection to work, the options data needs to be in
</I>&gt;<i> *some* known format. Maybe this might be the time to move to the
</I>&gt;<i> stdlib's optparse - or maybe not, now that optparse is (presumably)
</I>&gt;<i> deprecated in favour of argparse. Maybe twistd could examine a number of
</I>&gt;<i> different well-known variable-names, for different option-parsing
</I>&gt;<i> libraries.
</I>
For what it's worth, I don't care about this at all.  It's a completely separate issue from the main stuff I care about, and while we should be able to simply delegate to a function that takes a list of strings, I will insist that we fix that separately.

&gt;<i> Just tossing this out as a strawman for people to point and laugh at.
</I>
Ha, ha ha ha.  (point).

Thanks for the feedback though.  These are all very common suggestions, and I'm glad for the opportunity to point out why we haven't already done them.

So as not to make this message too long, I'll defer a description my own preferred implementation strategy for a future post to this thread.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20110407/8cfa7cc7/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056333.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
	<LI>Next message (by thread): <A HREF="056336.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56334">[ date ]</a>
              <a href="thread.html#56334">[ thread ]</a>
              <a href="subject.html#56334">[ subject ]</a>
              <a href="author.html#56334">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
