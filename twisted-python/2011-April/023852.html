<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted Plugins - Implementation Discussion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Plugins%20-%20Implementation%20Discussion&In-Reply-To=7E980D9E-7A4F-4D1B-9D52-FC84E76E05A7%40bubblehouse.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023849.html">
   <LINK REL="Next"  HREF="023850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted Plugins - Implementation Discussion</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Plugins%20-%20Implementation%20Discussion&In-Reply-To=7E980D9E-7A4F-4D1B-9D52-FC84E76E05A7%40bubblehouse.org"
       TITLE="[Twisted-Python] Twisted Plugins - Implementation Discussion">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Apr  7 01:03:20 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023849.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
        <LI>Next message: <A HREF="023850.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23852">[ date ]</a>
              <a href="thread.html#23852">[ thread ]</a>
              <a href="subject.html#23852">[ subject ]</a>
              <a href="author.html#23852">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Apr 7, 2011, at 12:06 AM, Phil Christensen wrote:

&gt;<i> On Apr 6, 2011, at 8:35 PM, Stephen Thorne wrote:
</I>&gt;&gt;<i> For your consideration, and (constructive) critcism, here is a twisted
</I>&gt;&gt;<i> plugin that is nearly identical to 6 that I have running in  
</I>&gt;&gt;<i> production:
</I>&gt;<i> [snip]
</I>&gt;&gt;<i> serviceMaker = ExampleServiceMaker()
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> From these 19 lines of code there are 4 things that are relevent:
</I>&gt;&gt;<i> tapname = example
</I>&gt;&gt;<i> description = 'Example Twistd Plugin'
</I>&gt;&gt;<i> options = {'debug':True} if args == ['--debug'] else {'debug':False}
</I>&gt;&gt;<i> service = examplepackage.examplemodule.make_service(**options)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Only 2 of which are relevent for running a twistd daemon other than
</I>&gt;&gt;<i> 'example'
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> So the goal of my post to this mailing list is:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> * I would like glyph's goal of having less arbitary code executed at
</I>&gt;&gt;<i> twistd launch time to become a realisation,
</I>&gt;<i> 
</I>&gt;<i> Makes sense. My first inclination is to suggest creating metadata  
</I>&gt;<i> files that are found via pkg_resources.
</I>
We already use a similar mechanism, twisted.python.modules, which uses the same underlying standards as pkg_resources (PEP 302) but is somewhat more flexible.  And we create a metadata file (dropin.cache) which is stored and retrieved using this mechanism.

&gt;&gt;<i> * The entire task of having this python plugin is to link up the
</I>&gt;&gt;<i> metadata with a more or less standard
</I>&gt;<i> 
</I>&gt;<i> Not sure if I get this part. I tend to think of plugins as the service  
</I>&gt;<i> bootstrap file, like an int main(). I would probably *not* be into the  
</I>&gt;<i> idea of passing sys.argv directly to a service, for example.
</I>
Why not?  It's just a list of strings.  You should be able to deal with it how you like.  (But as I said in a previous message: this is a separate issue.)

&gt;&gt;<i> * It's very easy to accidentally make your plugin load your package  
</I>&gt;&gt;<i> for every other twistd daemon running out of the same plugin cache.
</I>&gt;<i> 
</I>&gt;<i> Never had this happen, but I think I can see where it might. It would  
</I>&gt;<i> be solved by some kind of external metadata, though, right?
</I>
It already is solved by the external metadata... sort of.  If you look at the implementation of CachedPlugin, you can see that it actually already has a name and description!  There are two problems though: first is that this is hard-coded to be the module's name and docstring, but more importantly, there's just no way to get at those attributes via the getPlugin interface, which implicitly invokes '__conform__' via adaptation (and therefore load()).

&gt;<i> * The practice of putting a module under twisted/plugins/ 
</I>&gt;&gt;<i> $mymodulehere.py
</I>&gt;&gt;<i> upsets my equilibrium, the only reason I tolerate this kind of thing
</I>&gt;&gt;<i> is that I install my python code via rpms and I automatically get
</I>&gt;&gt;<i> installation, ownership and uninstallation done in a stable manner.
</I>&gt;<i> 
</I>&gt;<i> The only issue I've found with this is the issue of having to create  
</I>&gt;<i> plugin cache files. Apart from the spurious error messages that were  
</I>&gt;<i> (partially?) covered at the sprint recently, the benefit they provide  
</I>&gt;<i> is definitely negated by bad permissions. I've done some acrobatics  
</I>&gt;<i> inside my setup.py to make it work, but it involves different steps  
</I>&gt;<i> depending on whether you're installing or building a package.
</I>
What is &quot;this kind of thing&quot;, though?  The plugins have to go in some defined namespace in order to be enumerated.  Even if we were to implement something based on purely static metadata, you'd still have to list a directory to get at that metadata.  Making the namespace be owned by the module doing the importing makes sense.

For what it's worth, bzrlib does this too, but by convention in a bzr plugin you put _all_ your code into bzrlib/plugins/foo/*.py, and your package is bzrlib.plugins.foo.  (This will work fine with Twisted if you want to do it that way.)

&gt;<i> Still, it seems like most of their necessity would be negated by using  
</I>&gt;<i> external metadata files. It seems to be the way most plugin systems  
</I>&gt;<i> end up going in some way or another.
</I>
dropin.cache is an external metadata file ;-).

&gt;<i> Anyways, that's just my 2/100ths. I'm pretty happy with most of the  
</I>&gt;<i> plugin model, but I think there's a lot of room for improvement,  
</I>&gt;<i> particularly in the area of dropin.cache files.
</I>
Thanks for your feedback.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20110407/08426123/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20110407/08426123/attachment.htm</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023849.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
	<LI>Next message: <A HREF="023850.html">[Twisted-Python] Twisted Plugins - Implementation Discussion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23852">[ date ]</a>
              <a href="thread.html#23852">[ thread ]</a>
              <a href="subject.html#23852">[ subject ]</a>
              <a href="author.html#23852">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
