<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] 100% CPU on high opened descriptors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20100%25%20CPU%20on%20high%20opened%20descriptors&In-Reply-To=BANLkTin2_NTrMJunnuZSPKZUWMYPvHwZvA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023923.html">
   <LINK REL="Next"  HREF="023925.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] 100% CPU on high opened descriptors</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20100%25%20CPU%20on%20high%20opened%20descriptors&In-Reply-To=BANLkTin2_NTrMJunnuZSPKZUWMYPvHwZvA%40mail.gmail.com"
       TITLE="[Twisted-Python] 100% CPU on high opened descriptors">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Apr 26 13:48:54 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="023923.html">[Twisted-Python] 100% CPU on high opened descriptors
</A></li>
        <LI>Next message: <A HREF="023925.html">[Twisted-Python] 100% CPU on high opened descriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23924">[ date ]</a>
              <a href="thread.html#23924">[ thread ]</a>
              <a href="subject.html#23924">[ subject ]</a>
              <a href="author.html#23924">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 26, 2011, at 11:42 AM, Juan Antonio Iba&#241;ez Santorum wrote:

&gt;<i>    I have a Linux box serving my twisted app. All works ok except after some days running (where I can see my CPU going to 100%). I saw that CPU goes 100% usage when the app reaches to 1024 opened descriptors (sockets). It seems TM isn't closing some connections when clients loose connection to the server. I have no more than 200 simultaneous clients, each of then using a single connection. Any idea why those connections remain open?
</I>
This is a bug that somebody should really fix.  &lt;<A HREF="http://tm.tl/816">http://tm.tl/816</A>&gt;

To work around it, however: if a connection is closed &quot;uncleanly&quot; (for example: you close your laptop, you rip the ethernet cable out of the wall, you foolishly give your computer to zooko for a minute), and no traffic is going in either direction, it will remain &quot;open&quot; as far as the server is concerned, forever.

If you send a little bit of traffic (an application-level ping) to each client every so often, the server's TCP stack will notice that nobody is acknowledging it and eventually time them out and close the connections.

Alternately, you could fix an even older bug, &lt;<A HREF="http://tm.tl/78">http://tm.tl/78</A>&gt;, which would allow you to immediately terminate &quot;dead&quot; connections without waiting for them to time out.

Good luck,

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20110426/c55ba49c/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20110426/c55ba49c/attachment.htm</A> 
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023923.html">[Twisted-Python] 100% CPU on high opened descriptors
</A></li>
	<LI>Next message: <A HREF="023925.html">[Twisted-Python] 100% CPU on high opened descriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23924">[ date ]</a>
              <a href="thread.html#23924">[ thread ]</a>
              <a href="subject.html#23924">[ subject ]</a>
              <a href="author.html#23924">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
