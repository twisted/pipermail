<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Shared resource manioulation example
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Shared%20resource%20manioulation%20example&In-Reply-To=20100528114600.4827571jfgr8tf48%40216.129.205.5">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022281.html">
   <LINK REL="Next"  HREF="022283.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Shared resource manioulation example</H1>
    <B>John Santos</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Shared%20resource%20manioulation%20example&In-Reply-To=20100528114600.4827571jfgr8tf48%40216.129.205.5"
       TITLE="[Twisted-Python] Shared resource manioulation example">JOHN at egh.com
       </A><BR>
    <I>Fri May 28 13:15:26 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022281.html">[Twisted-Python] Shared resource manioulation example
</A></li>
        <LI>Next message: <A HREF="022283.html">[Twisted-Python] Shared resource manioulation example
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22282">[ date ]</a>
              <a href="thread.html#22282">[ thread ]</a>
              <a href="subject.html#22282">[ subject ]</a>
              <a href="author.html#22282">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 28 May 2010 <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">vitaly at synapticvision.com</A> wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm looking for a Twisted based example how
</I>&gt;<i> it should be properly done update/delete of global dictionary's
</I>&gt;<i> SAME key:value pair from different functions all together.
</I>&gt;<i> Or by another words, two functions are trying to update the same  
</I>&gt;<i> key:value pair of the same dictionary at the same time, than how to do  
</I>&gt;<i> it properly with Twisted?
</I>&gt;<i> 
</I>&gt;<i> Thanks a lot.
</I>&gt;<i> 
</I>
Vitaly,

As a relative newbie to both Twisted and Python (I wish I had more time
to play with it, as there are lots of things I don't really understand
yet, but other work intervenes), I *think* the whole point of the
Twisted reactor is to serialize the callbacks.

So two functions *can't* be trying to update the same Python object
(dictionary or anything else, global or local) at the same time.
While one thread has control, it can do anything it wants to the
global dictionary, and no other function can see anything but the
final result.

So &quot;just do it&quot;!

This assumes you aren't using threads, which are *not* compatible
with Twisted anyway.

The only more complicated scenario I can see is if some desired
process uses the current value in a dictionary to initiate a
request to something else (for example, a TCP/IP messages to another
system) which returns its result in another callback which then stores
the result (or some value that depends on the result) in the same
dictionary element.  If two such sequences can overlap at the same
time, but using the initial value of dictionary element in the 2nd
sequence would produce an incorrect final result, but instead it
should be defered until the 1st sequence completes, then you would
need to use some sort of locking mechanism.

A very simple mechanism would be to add a boolean to each object
(i.e. each dictionary value.)  When the first callback executes, it
checks the boolean.  If set, it waits by calling reactor.callLater,
passing itself as the callback.  If the boolean is clear, it sets
it and initiates the processing.  When the final callback executes,
it sets the new value in the dictionary and clears the boolean.

More sophisticated mechanisms could use an exponential waiting
period for the reactor.callLater time; add a timeout (producing
an error if the whole process takes too long, perhaps saving the
initial value so the process could be rolled back if it fails);
replace the callLater's with a different deferal mechanism that
could be called immediately when the lock gets released; check
for deadlocks amoung multiple locks, etc.  There may very well
already exist a Twisted package for doing all this already (complete
with debugging hooks, statistics, etc.)  Someone with more Twisted
experience could probably point you right at it.  If no such
package exists, I think it would be a very nice thing to have.
If people wouldn't mind waiting for a very long (possibly infinite)
time for it, I could probably be coerced into taking a stab at
producing one.


-- 
John Santos
Evans Griffiths &amp; Hart, Inc.
781-861-0670 ext 539


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022281.html">[Twisted-Python] Shared resource manioulation example
</A></li>
	<LI>Next message: <A HREF="022283.html">[Twisted-Python] Shared resource manioulation example
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22282">[ date ]</a>
              <a href="thread.html#22282">[ thread ]</a>
              <a href="subject.html#22282">[ subject ]</a>
              <a href="author.html#22282">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
