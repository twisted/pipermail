<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Reactor Spinning?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Reactor%20Spinning%3F&In-Reply-To=%3C20100524195332.1902.1609577663.divmod.xquotient.4%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054738.html">
   <LINK REL="Next"  HREF="054649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Reactor Spinning?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Reactor%20Spinning%3F&In-Reply-To=%3C20100524195332.1902.1609577663.divmod.xquotient.4%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] Reactor Spinning?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon May 24 13:53:32 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054738.html">[Twisted-Python] Reactor Spinning?
</A></li>
        <LI>Next message (by thread): <A HREF="054649.html">[Twisted-Python] print unicode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54747">[ date ]</a>
              <a href="thread.html#54747">[ thread ]</a>
              <a href="subject.html#54747">[ subject ]</a>
              <a href="author.html#54747">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23 May, 03:42 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">moxie at thoughtcrime.org</A> wrote:
&gt;<i>
</I>&gt;<i>Hey everyone, I've still been trying to track down this spin bug.  What
</I>&gt;<i>I probably should have mentioned before is that these are SSL
</I>&gt;<i>connections.  Looking through the 10.0 release code, I found the
</I>&gt;<i>_sendCloseAlert method in tcp.py: <A HREF="http://pastebin.com/gZKxHtN5">http://pastebin.com/gZKxHtN5</A>
</I>&gt;<i>
</I>&gt;<i>I feel like this is almost certainly the culprit.  Most suspiciously,
</I>&gt;<i>there's an explicit empty write on pastebin-line 23:
</I>&gt;<i>
</I>&gt;<i>os.write(self.socket.fileno(), '')
</I>&gt;<i>
</I>&gt;<i>It looks to me like there's a code path where this write &quot;succeeds,&quot; 
</I>&gt;<i>the
</I>&gt;<i>SSL socket reports that the connection is still not shut down, and then
</I>&gt;<i>the transport is resumed via startWriting and startReading.  I assume
</I>&gt;<i>that this then repeats for as long as that socket is up.
</I>&gt;<i>This directly corresponds with the system calls I'm seeing (poll, empty
</I>&gt;<i>write, poll, empty write...)
</I>&gt;<i>
</I>&gt;<i>I still don't have an entirely comprehensive grasp of whats' going on
</I>&gt;<i>here, but while these efforts to &quot;cleanly&quot; shut down the SSL connection
</I>&gt;<i>by exchanging alerts are heroic, I feel like it's much more common (and
</I>&gt;<i>probably good enough) to just send an alert and immediately close the
</I>&gt;<i>underlying socket.
</I>
It'd be great if you could attach a minimal example which demonstrates 
this behavior to a ticket in the issue tracker (threads on the mailing 
list usually lead to ignored issues).

It's probably also worth reporting your version of OpenSSL and 
pyOpenSSL, since that might be related.  I've not seen this kind of 
behavior before, which may just mean I'm running an older version of 
OpenSSL than you.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054738.html">[Twisted-Python] Reactor Spinning?
</A></li>
	<LI>Next message (by thread): <A HREF="054649.html">[Twisted-Python] print unicode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54747">[ date ]</a>
              <a href="thread.html#54747">[ thread ]</a>
              <a href="subject.html#54747">[ subject ]</a>
              <a href="author.html#54747">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
