<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] inlineCallbacks vs explicit callbacks: performance	concerns?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20inlineCallbacks%20vs%20explicit%20callbacks%3A%20performance%0A%09concerns%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022216.html">
   <LINK REL="Next"  HREF="022207.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] inlineCallbacks vs explicit callbacks: performance	concerns?</H1>
    <B>Paul Goins</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20inlineCallbacks%20vs%20explicit%20callbacks%3A%20performance%0A%09concerns%3F&In-Reply-To="
       TITLE="[Twisted-Python] inlineCallbacks vs explicit callbacks: performance	concerns?">general at vultaire.net
       </A><BR>
    <I>Sun May  9 23:16:55 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022216.html">[Twisted-Python] Comparing &quot;Stackless Python +	Nonblocking	Stackless Modules&quot; with Twisted.
</A></li>
        <LI>Next message: <A HREF="022207.html">[Twisted-Python] inlineCallbacks vs explicit callbacks:	performance concerns?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22206">[ date ]</a>
              <a href="thread.html#22206">[ thread ]</a>
              <a href="subject.html#22206">[ subject ]</a>
              <a href="author.html#22206">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Question: Is there a performance related reason why Twisted core does
not use inlineCallbacks?

-----

I'm trying to figure out how to reduce the CPU load of an app.  I've
already done a lot of profiling and have trimmed a lot of fat, but we're
still not getting as much throughput as we'd like.  We don't seem to
really be I/O bound in our application, but mostly CPU bound.

One thing we use a lot in our code is the inlineCallbacks decorator.
It's also used by txAMQP, at least in the 0.2 version we are currently
using.  However, I notice it doesn't seem to really be used anywhere in
the Twisted core code; I only see its definition and the defgen test
which uses it.

I'm curious of the reason why Twisted core does not use it.  Is it
performance related?  Compatibility with older Python versions?  Or
something else?

Thanks.

- Paul Goins

----

For those curious, here's what I'm currently facing:

If I count total &quot;internal time&quot; per module (NOT cumulative time), the
current hotspot is twisted.internet.defer with 27.88% of all CPU time.
The per-function breakdown is something like this:

======================= =====================
Line(Function)          Time (total time pct)
======================= =====================
314(_runCallbacks)      7.657
733(_inlineCallbacks)   6.246
833(unwindGenerator)    2.864
172(addCallbacks)       2.103
291(_startRunCallbacks) 1.940
206(addBoth)            1.369
766(gotResult)          1.165
233(callback)           1.014
======================= =====================

Twisted version: 8.2.0.  Profiler: cProfile.

I'm trying to find the best way of getting this down.  It seems like
reducing the raw number of callbacks is probably the best way if
possible.  However, unwindGenerator/_inlineCallbacks by itself takes
almost 10% of the time... hence the above question.

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022216.html">[Twisted-Python] Comparing &quot;Stackless Python +	Nonblocking	Stackless Modules&quot; with Twisted.
</A></li>
	<LI>Next message: <A HREF="022207.html">[Twisted-Python] inlineCallbacks vs explicit callbacks:	performance concerns?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22206">[ date ]</a>
              <a href="thread.html#22206">[ thread ]</a>
              <a href="subject.html#22206">[ subject ]</a>
              <a href="author.html#22206">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
