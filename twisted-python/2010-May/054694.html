<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SQLAlchemy and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SQLAlchemy%20and%20Twisted&In-Reply-To=%3Cn2k3db160681005090854r36dbf4f8neb6fd44f8f184c69%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054689.html">
   <LINK REL="Next"  HREF="054696.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SQLAlchemy and Twisted</H1>
    <B>Daniel Griffin</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SQLAlchemy%20and%20Twisted&In-Reply-To=%3Cn2k3db160681005090854r36dbf4f8neb6fd44f8f184c69%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] SQLAlchemy and Twisted">dgriff1 at gmail.com
       </A><BR>
    <I>Sun May  9 09:54:26 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054689.html">[Twisted-Python] SQLAlchemy and Twisted
</A></li>
        <LI>Next message (by thread): <A HREF="054696.html">[Twisted-Python] SQLAlchemy and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54694">[ date ]</a>
              <a href="thread.html#54694">[ thread ]</a>
              <a href="subject.html#54694">[ subject ]</a>
              <a href="author.html#54694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That is kind of what I found. In my app I basically have the following
triggered using callLater:

do a select and create a new SSL connection  for each item returned
Wait for the response
Do between 2 and 4 inserts depending on results
Close the connection.

As measured in connections completed per seconds my results have been:

15/second with blocking twisted
7/second using deferred to thread
18/second using SQLalchemy in another process over PB.

I know these are anecdotal but they might help someone else.

The two problems with PB are that you quickly overrun the maximum amount of
FD's available for select reactors and you end up roughly doubling the
amount of DB querying you are doing.

I intend to try using something like ampoule(deferToProcess) but I think I
will have the same problems as with PB since it just uses TCP sockets
anyways.


Dan



On Sun, May 9, 2010 at 4:45 AM, Phil Mayers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">p.mayers at imperial.ac.uk</A>&gt; wrote:

&gt;<i> On 05/09/2010 07:07 AM, Daniel Griffin wrote:
</I>&gt;<i> &gt; If you let SQLAlchemy block twisted would there be any impact besides
</I>&gt;<i> &gt; performance?
</I>&gt;<i>
</I>&gt;<i> Depends how long it blocks for, and what else your process is doing.
</I>&gt;<i>
</I>&gt;<i> With the reactor blocked:
</I>&gt;<i>
</I>&gt;<i>  * no socket reads or accepts can be done
</I>&gt;<i>  * no callLater or LoopingCall can be scheduled
</I>&gt;<i>
</I>&gt;<i> ...and so on.
</I>&gt;<i>
</I>&gt;<i> If you've only got a small number of clients and no time-based
</I>&gt;<i> scheduling and you're only blocking for a short time (tens or hundreds
</I>&gt;<i> of milliseconds, say) it may be tolerable.
</I>&gt;<i>
</I>&gt;<i> If the server has a lot of clients, or needs to accept new ones in a
</I>&gt;<i> timely fashion, or has time-based work to do, and your blocking might go
</I>&gt;<i> on for a while, it's probably not tolerable.
</I>&gt;<i>
</I>&gt;<i> I'd avoid it personally (but then I'm utterly unconvinced by ORMs) and
</I>&gt;<i> stick to using SA in a thread as your SQL query layer.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20100509/9c828ec3/attachment-0001.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054689.html">[Twisted-Python] SQLAlchemy and Twisted
</A></li>
	<LI>Next message (by thread): <A HREF="054696.html">[Twisted-Python] SQLAlchemy and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54694">[ date ]</a>
              <a href="thread.html#54694">[ thread ]</a>
              <a href="subject.html#54694">[ subject ]</a>
              <a href="author.html#54694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
