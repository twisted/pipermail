<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Sending large files over network with perspective	broker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Sending%20large%20files%20over%20network%20with%20perspective%0A%09broker&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022232.html">
   <LINK REL="Next"  HREF="022234.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Sending large files over network with perspective	broker</H1>
    <B>Gabriele Lanaro</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Sending%20large%20files%20over%20network%20with%20perspective%0A%09broker&In-Reply-To="
       TITLE="[Twisted-Python] Sending large files over network with perspective	broker">gabriele.lanaro at gmail.com
       </A><BR>
    <I>Sat May 22 14:35:16 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022232.html">[Twisted-Python] Test, plz ignore
</A></li>
        <LI>Next message: <A HREF="022234.html">[Twisted-Python] Sending large files over network with	perspective broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22233">[ date ]</a>
              <a href="thread.html#22233">[ thread ]</a>
              <a href="subject.html#22233">[ subject ]</a>
              <a href="author.html#22233">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm writing a gtk application that transfer files in LAN. The application
has a server and can spawn different clients (one for each file to send) .
The flow between client and server is something like that:

client asks pb.Root a FileSender ( that is conceptually a perspective).
The client receive the file sender.
The client declares the size and the basename of the file he is sending,
requiring authorization to send.
The server perform authorization and passes to the client a unique key to
start the file transfer.
The client performs the file transfer in &quot;chunks&quot;. Each chunk is passed
throught a remote method, send_chunk.

The file transfer is done &quot;recursively&quot;, each send_chunk deferred generates
a new deferred for the next chunk.

Some pseudocode to understand better my solution.

FileSender:
    remote_get_auth():
    remote_request_for_sending(filename, size): return secret
    remote send_chunk(secred, chunk_no, data): save the chunk somewhere

Client()
    proceed_sending():

          chunk_tot = CHUNK_TOT
          chunk_no = 0

          def send(_)
                if chunk_no == CHUNK_TOT: return
                else:
                     ... read data...
                    d = filesender.callRemote(&quot;send_chunk&quot;, secret,
chunk_no, data)
                    d.addCallback(send)

I've done in this way so a new chunk is sent only if the previous chunk was
sent.
The problem of this approach is that this blocks my GUI, I can't figure out
why because I'm just generating deffereds so it souldn't block.

I've seen the page about Consumer and Producer, however I can't figure out
how to integrate producer and consumers in a Perspective Broker based code.

Can someone help me?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100522/0650ce3c/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100522/0650ce3c/attachment.htm</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022232.html">[Twisted-Python] Test, plz ignore
</A></li>
	<LI>Next message: <A HREF="022234.html">[Twisted-Python] Sending large files over network with	perspective broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22233">[ date ]</a>
              <a href="thread.html#22233">[ thread ]</a>
              <a href="subject.html#22233">[ subject ]</a>
              <a href="author.html#22233">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
