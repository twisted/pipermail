<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Reactor Spinning?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Reactor%20Spinning%3F&In-Reply-To=%3C4BE076E3.2080703%40thoughtcrime.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054644.html">
   <LINK REL="Next"  HREF="054646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Reactor Spinning?</H1>
    <B>Moxie Marlinspike</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Reactor%20Spinning%3F&In-Reply-To=%3C4BE076E3.2080703%40thoughtcrime.org%3E"
       TITLE="[Twisted-Python] Reactor Spinning?">moxie at thoughtcrime.org
       </A><BR>
    <I>Tue May  4 13:34:59 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054644.html">[Twisted-Python] Reactor Spinning?
</A></li>
        <LI>Next message (by thread): <A HREF="054646.html">[Twisted-Python] Reactor Spinning?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54645">[ date ]</a>
              <a href="thread.html#54645">[ thread ]</a>
              <a href="subject.html#54645">[ subject ]</a>
              <a href="author.html#54645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I've seen it clear up before, but it will normally spin for days.  This
state doesn't really impact performance at all (requests are still
snappy), but it is annoying how much CPU time it eats through before a
restart.

- moxie

-- 
<A HREF="http://www.thoughtcrime.org">http://www.thoughtcrime.org</A>


Werner Thie wrote:
&gt;<i> Does it spin forever or does it clear up after some time?
</I>&gt;<i> 
</I>&gt;<i> I have occasional 'hickups' with heavy loads with responses taking 
</I>&gt;<i> several ten seconds for no apparent reason, the server then working 
</I>&gt;<i> again like nothing happened.
</I>&gt;<i> 
</I>&gt;<i> Werner
</I>&gt;<i> 
</I>&gt;<i> Moxie Marlinspike wrote:
</I>&gt;&gt;<i> Hey Twisted folks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm using the twisted.web framework for a high performance HTTP proxy
</I>&gt;&gt;<i> server that very closely resembles the HTTP proxy server example that
</I>&gt;&gt;<i> comes with the twisted package.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Under heavy load, I occasionally run into a problem where the reactor
</I>&gt;&gt;<i> appears to start spinning on an &quot;empty&quot; write.  An strace of the process
</I>&gt;&gt;<i> reveals these system calls:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 8) = 1
</I>&gt;&gt;<i> write(81, &quot;&quot;, 0)                        = 0
</I>&gt;&gt;<i> gettimeofday({1272980323, 567613}, NULL) = 0
</I>&gt;&gt;<i> gettimeofday({1272980323, 567696}, NULL) = 0
</I>&gt;&gt;<i> epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 8) = 1
</I>&gt;&gt;<i> write(81, &quot;&quot;, 0)                        = 0
</I>&gt;&gt;<i> gettimeofday({1272980323, 567988}, NULL) = 0
</I>&gt;&gt;<i> gettimeofday({1272980323, 568071}, NULL) = 0
</I>&gt;&gt;<i> epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 7) = 1
</I>&gt;&gt;<i> write(81, &quot;&quot;, 0)                        = 0
</I>&gt;&gt;<i> gettimeofday({1272980323, 568501}, NULL) = 0
</I>&gt;&gt;<i> gettimeofday({1272980323, 568613}, NULL) = 0
</I>&gt;&gt;<i> epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 7) = 1
</I>&gt;&gt;<i> write(81, &quot;&quot;, 0)                        = 0
</I>&gt;&gt;<i> gettimeofday({1272980323, 568978}, NULL) = 0
</I>&gt;&gt;<i> gettimeofday({1272980323, 569084}, NULL) = 0
</I>&gt;&gt;<i> epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 6) = 1
</I>&gt;&gt;<i> write(81, &quot;&quot;, 0)                        = 0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ...it seems to be waiting for write availability on a FD, trying to
</I>&gt;&gt;<i> write an empty buffer, seeing that it wrote zero bytes, and so waiting
</I>&gt;&gt;<i> for availability again.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've confirmed that when this occurs, whatever FD it is spinning on does
</I>&gt;&gt;<i> correspond with a network socket connected to the proxy.  I've seen this
</I>&gt;&gt;<i> with both Twisted 8.2 and 9.0 running on Linux using both the epoll and
</I>&gt;&gt;<i> select reactors.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If anyone has any thoughts about this problem or has seen it before, I'd
</I>&gt;&gt;<i> appreciate any insight that anyone might have.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - moxie
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054644.html">[Twisted-Python] Reactor Spinning?
</A></li>
	<LI>Next message (by thread): <A HREF="054646.html">[Twisted-Python] Reactor Spinning?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54645">[ date ]</a>
              <a href="thread.html#54645">[ thread ]</a>
              <a href="subject.html#54645">[ subject ]</a>
              <a href="author.html#54645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
