<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Shared resource manioulation example
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Shared%20resource%20manioulation%20example&In-Reply-To=%3C20100528143439.903440cxu8o55qyo%40216.129.205.5%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054777.html">
   <LINK REL="Next"  HREF="054779.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Shared resource manioulation example</H1>
    <B>vitaly at synapticvision.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Shared%20resource%20manioulation%20example&In-Reply-To=%3C20100528143439.903440cxu8o55qyo%40216.129.205.5%3E"
       TITLE="[Twisted-Python] Shared resource manioulation example">vitaly at synapticvision.com
       </A><BR>
    <I>Fri May 28 12:34:39 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054777.html">[Twisted-Python] Shared resource manioulation example
</A></li>
        <LI>Next message (by thread): <A HREF="054779.html">[Twisted-Python] Shared resource manioulation example
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54778">[ date ]</a>
              <a href="thread.html#54778">[ thread ]</a>
              <a href="subject.html#54778">[ subject ]</a>
              <a href="author.html#54778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi,

Callbacks serialization is clear to me.

I'll try to rephrase the question: two requests are incoming for reactor()
to handle. Each request has its own chain of callbacks.
At some point one of the requests need to update the same
global data structure, and another request need to delete from the same
global data structure.
So theoretically, correct me if I wrong, will be a data collision.
If it is, than how can I prevent it? Example please.

thank you.

Quoting &quot;John Santos&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">JOHN at egh.com</A>&gt;:

&gt;<i> On Fri, 28 May 2010 <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">vitaly at synapticvision.com</A> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm looking for a Twisted based example how
</I>&gt;&gt;<i> it should be properly done update/delete of global dictionary's
</I>&gt;&gt;<i> SAME key:value pair from different functions all together.
</I>&gt;&gt;<i> Or by another words, two functions are trying to update the same
</I>&gt;&gt;<i> key:value pair of the same dictionary at the same time, than how to do
</I>&gt;&gt;<i> it properly with Twisted?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks a lot.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Vitaly,
</I>&gt;<i>
</I>&gt;<i> As a relative newbie to both Twisted and Python (I wish I had more time
</I>&gt;<i> to play with it, as there are lots of things I don't really understand
</I>&gt;<i> yet, but other work intervenes), I *think* the whole point of the
</I>&gt;<i> Twisted reactor is to serialize the callbacks.
</I>&gt;<i>
</I>&gt;<i> So two functions *can't* be trying to update the same Python object
</I>&gt;<i> (dictionary or anything else, global or local) at the same time.
</I>&gt;<i> While one thread has control, it can do anything it wants to the
</I>&gt;<i> global dictionary, and no other function can see anything but the
</I>&gt;<i> final result.
</I>&gt;<i>
</I>&gt;<i> So &quot;just do it&quot;!
</I>&gt;<i>
</I>&gt;<i> This assumes you aren't using threads, which are *not* compatible
</I>&gt;<i> with Twisted anyway.
</I>&gt;<i>
</I>&gt;<i> The only more complicated scenario I can see is if some desired
</I>&gt;<i> process uses the current value in a dictionary to initiate a
</I>&gt;<i> request to something else (for example, a TCP/IP messages to another
</I>&gt;<i> system) which returns its result in another callback which then stores
</I>&gt;<i> the result (or some value that depends on the result) in the same
</I>&gt;<i> dictionary element.  If two such sequences can overlap at the same
</I>&gt;<i> time, but using the initial value of dictionary element in the 2nd
</I>&gt;<i> sequence would produce an incorrect final result, but instead it
</I>&gt;<i> should be defered until the 1st sequence completes, then you would
</I>&gt;<i> need to use some sort of locking mechanism.
</I>&gt;<i>
</I>&gt;<i> A very simple mechanism would be to add a boolean to each object
</I>&gt;<i> (i.e. each dictionary value.)  When the first callback executes, it
</I>&gt;<i> checks the boolean.  If set, it waits by calling reactor.callLater,
</I>&gt;<i> passing itself as the callback.  If the boolean is clear, it sets
</I>&gt;<i> it and initiates the processing.  When the final callback executes,
</I>&gt;<i> it sets the new value in the dictionary and clears the boolean.
</I>&gt;<i>
</I>&gt;<i> More sophisticated mechanisms could use an exponential waiting
</I>&gt;<i> period for the reactor.callLater time; add a timeout (producing
</I>&gt;<i> an error if the whole process takes too long, perhaps saving the
</I>&gt;<i> initial value so the process could be rolled back if it fails);
</I>&gt;<i> replace the callLater's with a different deferal mechanism that
</I>&gt;<i> could be called immediately when the lock gets released; check
</I>&gt;<i> for deadlocks amoung multiple locks, etc.  There may very well
</I>&gt;<i> already exist a Twisted package for doing all this already (complete
</I>&gt;<i> with debugging hooks, statistics, etc.)  Someone with more Twisted
</I>&gt;<i> experience could probably point you right at it.  If no such
</I>&gt;<i> package exists, I think it would be a very nice thing to have.
</I>&gt;<i> If people wouldn't mind waiting for a very long (possibly infinite)
</I>&gt;<i> time for it, I could probably be coerced into taking a stab at
</I>&gt;<i> producing one.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> John Santos
</I>&gt;<i> Evans Griffiths &amp; Hart, Inc.
</I>&gt;<i> 781-861-0670 ext 539
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054777.html">[Twisted-Python] Shared resource manioulation example
</A></li>
	<LI>Next message (by thread): <A HREF="054779.html">[Twisted-Python] Shared resource manioulation example
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54778">[ date ]</a>
              <a href="thread.html#54778">[ thread ]</a>
              <a href="subject.html#54778">[ subject ]</a>
              <a href="author.html#54778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
