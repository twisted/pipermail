<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Reactor Spinning?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Reactor%20Spinning%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022201.html">
   <LINK REL="Next"  HREF="022148.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Reactor Spinning?</H1>
    <B>Moxie Marlinspike</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Reactor%20Spinning%3F&In-Reply-To="
       TITLE="[Twisted-Python] Reactor Spinning?">moxie at thoughtcrime.org
       </A><BR>
    <I>Tue May  4 09:48:50 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022201.html">[Twisted-Python] win32com client in a twisted thread
</A></li>
        <LI>Next message: <A HREF="022148.html">[Twisted-Python] Reactor Spinning?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22147">[ date ]</a>
              <a href="thread.html#22147">[ thread ]</a>
              <a href="subject.html#22147">[ subject ]</a>
              <a href="author.html#22147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hey Twisted folks,

I'm using the twisted.web framework for a high performance HTTP proxy
server that very closely resembles the HTTP proxy server example that
comes with the twisted package.

Under heavy load, I occasionally run into a problem where the reactor
appears to start spinning on an &quot;empty&quot; write.  An strace of the process
reveals these system calls:

epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 8) = 1
write(81, &quot;&quot;, 0)                        = 0
gettimeofday({1272980323, 567613}, NULL) = 0
gettimeofday({1272980323, 567696}, NULL) = 0
epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 8) = 1
write(81, &quot;&quot;, 0)                        = 0
gettimeofday({1272980323, 567988}, NULL) = 0
gettimeofday({1272980323, 568071}, NULL) = 0
epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 7) = 1
write(81, &quot;&quot;, 0)                        = 0
gettimeofday({1272980323, 568501}, NULL) = 0
gettimeofday({1272980323, 568613}, NULL) = 0
epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 7) = 1
write(81, &quot;&quot;, 0)                        = 0
gettimeofday({1272980323, 568978}, NULL) = 0
gettimeofday({1272980323, 569084}, NULL) = 0
epoll_wait(3, {{EPOLLOUT, {u32=81, u64=13194703840475086929}}}, 269, 6) = 1
write(81, &quot;&quot;, 0)                        = 0

...it seems to be waiting for write availability on a FD, trying to
write an empty buffer, seeing that it wrote zero bytes, and so waiting
for availability again.

I've confirmed that when this occurs, whatever FD it is spinning on does
correspond with a network socket connected to the proxy.  I've seen this
with both Twisted 8.2 and 9.0 running on Linux using both the epoll and
select reactors.

If anyone has any thoughts about this problem or has seen it before, I'd
appreciate any insight that anyone might have.

Thanks,

- moxie

-- 
<A HREF="http://www.thoughtcrime.org">http://www.thoughtcrime.org</A>

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022201.html">[Twisted-Python] win32com client in a twisted thread
</A></li>
	<LI>Next message: <A HREF="022148.html">[Twisted-Python] Reactor Spinning?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22147">[ date ]</a>
              <a href="thread.html#22147">[ thread ]</a>
              <a href="subject.html#22147">[ subject ]</a>
              <a href="author.html#22147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
