<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Asynchronously reading posted data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Asynchronously%20reading%20posted%20data&In-Reply-To=%3C21D6AB74-60E0-45C5-A5C6-484C91DE0480%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027396.html">
   <LINK REL="Next"  HREF="027402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Asynchronously reading posted data</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Asynchronously%20reading%20posted%20data&In-Reply-To=%3C21D6AB74-60E0-45C5-A5C6-484C91DE0480%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Asynchronously reading posted data">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Sep  4 15:45:13 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027396.html">[Twisted-Python] Asynchronously reading posted data
</A></li>
        <LI>Next message: <A HREF="027402.html">[Twisted-Python] Asynchronously reading posted data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27397">[ date ]</a>
              <a href="thread.html#27397">[ thread ]</a>
              <a href="subject.html#27397">[ subject ]</a>
              <a href="author.html#27397">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Sep 4, 2013, at 10:48 AM, Paul Wiseman &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">poalman at gmail.com</A>&gt; wrote:

&gt;<i> I'm still pretty new to twisted and feel I'm slowly getting the hang of it, enough to realise that this line of code is probably going to block and not do me any favours, the line is the first line in a resource.Resource render_POST.
</I>&gt;<i> 
</I>&gt;<i> json_request = json.loads(request.content.read())
</I>&gt;<i> 
</I>&gt;<i> The resource.Resource is a child of another resource which is passed to server.Site which is passed to internent.TCPServer.
</I>&gt;<i> 
</I>&gt;<i> The problem is I can't work out how I can read the post data from the request in an async way.
</I>&gt;<i> 
</I>&gt;<i> I have a feeling I need to implement a protocol, I'm guessing a LineReceiver but I can't figure out how I'd tie that in with my current solution or specifically how the LineReceiver would even read asynchronously to be honest..
</I>&gt;<i> 
</I>&gt;<i> Maybe the read is fine? I need the whole post data to do anything useful I guess as I can't string to a json decoder that I'm aware of. Just it will block everything up while I read, which shouldn't be long but I guess I'm bound to the speed of the person posting.
</I>&gt;<i> 
</I>&gt;<i> Thanks all!
</I>
If you're parsing a JSON object, you're going to be representing the whole thing in memory at the end of the interaction regardless, even if you parsed it and buffered it in an event-driven way.

That means you need to keep this data relatively small no matter what; if it's arbitrarily large, you are going to start swapping anyway.

So probably, just doing the blocking parse is fine.  You might be able to save a *little* memory by parsing it as it comes in, but you're also going to have to write your own JSON parser, which is probably going to take more programmer time than you will ever save in execution time by this marginal memory reduction :-).  Better would be to spend that effort enforcing stringent resource limits so that you will give up reading before you ever get to the parse in the case where it's big enough to cause a problem.

-glyph


</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027396.html">[Twisted-Python] Asynchronously reading posted data
</A></li>
	<LI>Next message: <A HREF="027402.html">[Twisted-Python] Asynchronously reading posted data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27397">[ date ]</a>
              <a href="thread.html#27397">[ thread ]</a>
              <a href="subject.html#27397">[ subject ]</a>
              <a href="author.html#27397">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
