<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to disconnect an HTTP connection and	notify the far end
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20disconnect%20an%20HTTP%20connection%20and%0A%09notify%20the%20far%20end&In-Reply-To=%3CE34EAEBF-D227-4CD9-9F10-C890BD02C6CC%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="027449.html">
   <LINK REL="Next"  HREF="027453.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to disconnect an HTTP connection and	notify the far end</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20disconnect%20an%20HTTP%20connection%20and%0A%09notify%20the%20far%20end&In-Reply-To=%3CE34EAEBF-D227-4CD9-9F10-C890BD02C6CC%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] How to disconnect an HTTP connection and	notify the far end">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Sep 20 17:26:03 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027449.html">[Twisted-Python] How to disconnect an HTTP connection and notify	the far end
</A></li>
        <LI>Next message (by thread): <A HREF="027453.html">[Twisted-Python] txThings - simple library for CoAP protocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59916">[ date ]</a>
              <a href="thread.html#59916">[ thread ]</a>
              <a href="subject.html#59916">[ subject ]</a>
              <a href="author.html#59916">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Sep 18, 2013, at 1:59 PM, Bob Novas &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bob.novas at shinkuro.com</A>&gt; wrote:

&gt;<i> I’ve got a question on how to explicitly disconnect a connection from the client side so that the server side knows that the connection has been disconnected. I’d be happy if this worked even with no guarantees, i.e., only when the client and server were in fact well-connected. It’s just an optimization to allow the server to cleanup.
</I>&gt;<i>  
</I>&gt;<i> I’ve got an HTTP client that uses HTTPConnectionPool to get an Agent, gets a Request from the Agent, and sends the Request to a WebServer on a linux box. 
</I>&gt;<i>  
</I>&gt;<i> On a Mac client, if I call closeCachedConnections() on the HTTPConnectionPool, the client immediately sends FIN on the port with the Request outstanding, the server delivers a callback registered on the Request via NotifyFinish() and the server knows the client has disconnected.
</I>
Sounds right...

&gt;<i>  On a Windows client, if I do the same, same code, the client waits until the outstanding Request finishes and then sends FIN. Nothing happens at the server – there’s no Request outstanding on which to deliver a callback, twisted.internet.tcp.Port.connectionLost() doesn’t get called, nada.
</I>
So, tcp.Port.connectionLost is only called when the *listening port* is shut down, i.e. when the server stops listening entirely.  What you should be looking for is connectionLost on your particular Protocol.

&gt;<i>  Am I missing something?  Is there a way to send a FIN on a connection on which there is an outstanding Request on Windows?
</I>
Twisted should behave the same way on all platforms, at least, if you're using portable APIs.

Usually, when the TCP stack completely goes out to lunch on Windows, it's due to some bizarre antivirus software that's just buggy.  For a while, possibly still today, Twisted just completely dies with certain versions of AVG installed, because they completely break the expected behavior of certain socket APIs.

Have you tried with multiple Windows clients yet? Different versions of Windows? Different software installed?

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130920/ba632204/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027449.html">[Twisted-Python] How to disconnect an HTTP connection and notify	the far end
</A></li>
	<LI>Next message (by thread): <A HREF="027453.html">[Twisted-Python] txThings - simple library for CoAP protocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59916">[ date ]</a>
              <a href="thread.html#59916">[ thread ]</a>
              <a href="subject.html#59916">[ subject ]</a>
              <a href="author.html#59916">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
