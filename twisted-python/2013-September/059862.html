<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Passing additional arguments to errback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Passing%20additional%20arguments%20to%20errback&In-Reply-To=%3CCAE_Hg6Z4pYBpFnBJmG_VCLd8Bph-Xv_DKEt5NZpCJuTkE8g3xg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059860.html">
   <LINK REL="Next"  HREF="059864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Passing additional arguments to errback</H1>
    <B>Laurens Van Houtven</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Passing%20additional%20arguments%20to%20errback&In-Reply-To=%3CCAE_Hg6Z4pYBpFnBJmG_VCLd8Bph-Xv_DKEt5NZpCJuTkE8g3xg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Passing additional arguments to errback">_ at lvh.io
       </A><BR>
    <I>Thu Sep  5 01:57:00 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059860.html">[Twisted-Python] Passing additional arguments to errback
</A></li>
        <LI>Next message (by thread): <A HREF="059864.html">[Twisted-Python] Passing additional arguments to errback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59862">[ date ]</a>
              <a href="thread.html#59862">[ thread ]</a>
              <a href="subject.html#59862">[ subject ]</a>
              <a href="author.html#59862">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,


On Thu, Sep 5, 2013 at 9:24 AM, Maciej Wasilak &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wasilak at gmail.com</A>&gt; wrote:

&gt;<i> Thank you for your answer. I'm explicitly interested in the following
</I>&gt;<i> combination:
</I>&gt;<i>
</I>&gt;<i> &gt; .addCallback(cb).addErrback(eb)
</I>&gt;<i>
</I>&gt;<i> If I understand correctly errback &quot;eb&quot; catches errors from both callback
</I>&gt;<i> &quot;cb&quot;, and from agent.request (agent.request errors pass through default
</I>&gt;<i> empty errback that re-raises them).
</I>&gt;<i>
</I>
Yes, that's exactly what it does :) The difference being that with
.addCallbacks(cb, eb), errors in cb would not be caught by eb.

&gt;<i> &gt; Also, if you want to do scraping with Twisted, consider looking at
</I>&gt;<i> Scrapy, a fully-featured web scraper that uses Twisted internally.
</I>&gt;<i>
</I>&gt;<i> I'm working on CoAP protocol which runs on top of UDP. My actual code is
</I>&gt;<i> request processing (but the problem is the same as in my previous post):
</I>&gt;<i>
</I>&gt;<i> _________________________________________________
</I>&gt;<i>  def processRequest(self, request):
</I>&gt;<i>         (...)
</I>&gt;<i>         d = defer.succeed(request)
</I>&gt;<i>         d.addCallback(self.processBlock1)
</I>&gt;<i>         d.addCallback(self.dispatchRequest)
</I>&gt;<i> def dispatchRequest(self, request):
</I>&gt;<i>         (...)
</I>&gt;<i>         resource = self.endpoint.getResourceFor(request)
</I>&gt;<i>         if resource is None:
</I>&gt;<i>             response = Message(code=NOT_FOUND, payload='Resource not
</I>&gt;<i> found!')
</I>&gt;<i>             self.respond(response, request)
</I>&gt;<i>             return
</I>&gt;<i>         try:
</I>&gt;<i>             d = resource.render(request)
</I>&gt;<i>         except iot.error.UnallowedMethod:
</I>&gt;<i>             response = Message(code=METHOD_NOT_ALLOWED, payload='Method
</I>&gt;<i> not allowed!')
</I>&gt;<i>             self.respond(response, request)
</I>&gt;<i>             return
</I>&gt;<i>         except iot.error.UnsupportedMethod:
</I>&gt;<i>             response = Message(code=NOT_IMPLEMENTED, payload='Method not
</I>&gt;<i> implemented!')
</I>&gt;<i>             self.respond(response, request)
</I>&gt;<i>             return
</I>&gt;<i>         delayed_ack = reactor.callLater(EMPTY_ACK_DELAY, self.sendEmptyAck
</I>&gt;<i> , request)
</I>&gt;<i>         d.addCallback(self.respond, request, delayed_ack)
</I>&gt;<i>         return d
</I>&gt;<i>
</I>&gt;<i> __________________________________________________
</I>&gt;<i>
</I>&gt;<i> I would like to rewrite it to:
</I>&gt;<i>
</I>&gt;<i> __________________________________________________
</I>&gt;<i> def processRequest(self, request):
</I>&gt;<i>         (...)
</I>&gt;<i>         d = defer.succeed(request)
</I>&gt;<i>         d.addCallback(self.processBlock1)
</I>&gt;<i>         d.addCallback(self.dispatchRequest
</I>&gt;<i> ).addErrback(self.handleRequestError)
</I>&gt;<i>
</I>&gt;<i> def dispatchRequest(self, request):
</I>&gt;<i>         (...)
</I>&gt;<i>         resource = self.endpoint.getResourceFor(request)
</I>&gt;<i>         if resource is None:
</I>&gt;<i>             raise NoResource()
</I>&gt;<i>         try:
</I>&gt;<i>             d = resource.render(request)
</I>&gt;<i>         except iot.error.UnallowedMethod:      #Explicit re-rise for this
</I>&gt;<i> example only
</I>&gt;<i>             raise UnallowedMethod()
</I>&gt;<i>         except iot.error.UnsupportedMethod:
</I>&gt;<i>             raise UnsupportedMethod()
</I>&gt;<i>         d.addCallback(self.respond, request)
</I>&gt;<i>         return d
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> def handleRequestErrors(self, failure, request???)
</I>&gt;<i>         # handle exceptions, send error response to client
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i>
</I>&gt;<i> I would like to handle Exceptions in handleRequestErrors(). However
</I>&gt;<i> handleRequestErrors() has to send a response to the client, so it needs the
</I>&gt;<i> request, and I don't know how to pass it from inside dispatchRequest().
</I>&gt;<i>
</I>You don't have to do it from in there. You can do .addErrback(handleErrors,
request), since it's all the same request object, right?

&gt;<i>  I see two possibilities:
</I>&gt;<i>     1. Pass request inside Failure object
</I>&gt;<i>     2. Leave the original code (process errors inside callback)
</I>&gt;<i>
</I>Both of those would work, but see above :)

Two random pieces of code review:

1. It seems self.endpoint is a t.w.s.Site object. That's kind of confusing,
since twisted has an &quot;endpoint&quot; concept that's one step removed from a Site
(endpoints connect or listen with factories, a Site is a factory). You
might want to reconsider that name :)
2. It's kind of strange to start with defer.succeed() and then start making
a callback chain IMHO, but it's not wrong, really.

cheers
lvh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130905/9051c3e0/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059860.html">[Twisted-Python] Passing additional arguments to errback
</A></li>
	<LI>Next message (by thread): <A HREF="059864.html">[Twisted-Python] Passing additional arguments to errback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59862">[ date ]</a>
              <a href="thread.html#59862">[ thread ]</a>
              <a href="subject.html#59862">[ subject ]</a>
              <a href="author.html#59862">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
