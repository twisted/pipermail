<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] [ANN] structlog – bring context &amp; structure to your logs without boilerplate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%3D%3Fwindows-1252%3Fq%3F%3D5BANN%3D5D_structlog_%3D96_bring_c%3F%3D%0A%20%3D%3Fwindows-1252%3Fq%3Fontext_%3D26_structure_to_your_logs_without_boilerplate%3F%3D&In-Reply-To=%3C30617339-A558-44C6-8AEF-19870948A9D5%40ox.cx%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059911.html">
   <LINK REL="Next"  HREF="027428.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] [ANN] structlog – bring context &amp; structure to your logs without boilerplate</H1>
    <B>Hynek Schlawack</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%3D%3Fwindows-1252%3Fq%3F%3D5BANN%3D5D_structlog_%3D96_bring_c%3F%3D%0A%20%3D%3Fwindows-1252%3Fq%3Fontext_%3D26_structure_to_your_logs_without_boilerplate%3F%3D&In-Reply-To=%3C30617339-A558-44C6-8AEF-19870948A9D5%40ox.cx%3E"
       TITLE="[Twisted-Python] [ANN] structlog – bring context &amp; structure to your logs without boilerplate">hs at ox.cx
       </A><BR>
    <I>Tue Sep 17 10:12:01 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059911.html">[Twisted-Python] Twisted at PyConUK 2013
</A></li>
        <LI>Next message (by thread): <A HREF="027428.html">[Twisted-Python] Twisted Names EDNS(0) support [Was Twisted at	PyConUK 2013]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27427">[ date ]</a>
              <a href="thread.html#27427">[ thread ]</a>
              <a href="subject.html#27427">[ subject ]</a>
              <a href="author.html#27427">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi folks,

today, I&#8217;ve release the 0.2.0 of my structlog project whose ambition is no less than changing the way we log in Python. :)

And since it sports dedicated support for Twisted &lt;<A HREF="http://www.structlog.org/en/latest/twisted.html">http://www.structlog.org/en/latest/twisted.html</A>&gt; (but is not limited to it, it wraps *any* logger), I&#8217;d like to introduce you to it.

Basically, its premise is that events happen in a context and you want to log out both effortlessly.  Nowadays logs are usually consumed by parsers anyway, so regular, easily parsable logs are a good thing&#8482;.

This is a nice example of a Twisted application showing off a bit what structlog is capable of:

import sys
import uuid

import structlog
import twisted

from twisted.internet import protocol, reactor

logger = structlog.getLogger()


class Counter(object):
    i = 0

    def inc(self):
        self.i += 1

    def __repr__(self):
        return str(self.i)


class Echo(protocol.Protocol):
    def connectionMade(self):
        self._counter = Counter()
        self._log = logger.new(
            connection_id=str(uuid.uuid4()),
            peer=self.transport.getPeer().host,
            count=self._counter,
        )

    def dataReceived(self, data):
        self._counter.inc()
        log = self._log.bind(data=data)
        self.transport.write(data)
        log.msg('echoed data!')


if __name__ == &quot;__main__&quot;:
    structlog.configure(
        processors=[structlog.twisted.EventAdapter()],
        logger_factory=structlog.twisted.LoggerFactory(),
    )
    twisted.python.log.startLogging(sys.stderr)
    reactor.listenTCP(1234, protocol.Factory.forProtocol(Echo))
    reactor.run()


It will give you an output like:

2013-09-17 17:40:23+0200 [-] Log opened.
2013-09-17 17:40:23+0200 [-] Factory starting on 1234
2013-09-17 17:40:23+0200 [-] Starting factory &lt;twisted.internet.protocol.Factory instance at 0x108301488&gt;
2013-09-17 17:40:28+0200 [Echo,0,127.0.0.1] peer='127.0.0.1' count=1 connection_id='4e2ee31c-b3ff-478e-ae06-7b1a492fce45' data='foo\n' event='echoed data!'
2013-09-17 17:40:33+0200 [Echo,0,127.0.0.1] peer='127.0.0.1' count=2 connection_id='4e2ee31c-b3ff-478e-ae06-7b1a492fce45' data='bar\n' event='echoed data!'
2013-09-17 17:40:44+0200 [Echo,1,127.0.0.1] peer='127.0.0.1' count=1 connection_id='3118f673-482b-471f-a206-e8f97f9a9c2c' data='qux\n' event='echoed data!'
2013-09-17 17:40:53+0200 [Echo,0,127.0.0.1] peer='127.0.0.1' count=3 connection_id='4e2ee31c-b3ff-478e-ae06-7b1a492fce45' data='twisted prevails\n' event='echoed data!'

(you can find this and more examples at &lt;<A HREF="http://www.structlog.org/en/latest/examples.html">http://www.structlog.org/en/latest/examples.html</A>&gt;)

In short:

- It allows you to build context by binding values to loggers. This context is just a dictionary. Once you log an event out (again, arbitrary number of key/value pairs), it gets merged with the context, processed by configurable processor chain and passed to your original logger.
- Your loggers are immutable (by default infidels can use thread local storage) and you&#8217;ll get a new one on each binding. Immutable local data is awesome.
- You can define processors that can mangle, filter, and format your log entries.
- Configure once, then just call getLogger (which is a Twisted-friendly alias for get_logger) in regular code.
- Of course there is a JSON renderer built right in &#8211; just tell log stash about it and be merry.

*Please* have a look at &lt;<A HREF="http://www.structlog.org/en/0.2.0-0/getting-started.html">http://www.structlog.org/en/0.2.0-0/getting-started.html</A>&gt;, I don&#8217;t want to reproduce it here. :)

Credit where credit is due: I picked up the idea of bound loggers from David Reid&#8217;s work on otter &lt;<A HREF="https://github.com/rackerlabs/otter/tree/master/otter/log">https://github.com/rackerlabs/otter/tree/master/otter/log</A>&gt; which in turn was based on ideas by JP (I&#8217;ve been told).

You can find everything you need to know at <A HREF="http://www.structlog.org/">http://www.structlog.org/</A> &#8211; I&#8217;d be happy about any constructive feedback and even more so about contributions!

Cheers,
Hynek
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 235 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130917/6641f382/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130917/6641f382/attachment.pgp</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059911.html">[Twisted-Python] Twisted at PyConUK 2013
</A></li>
	<LI>Next message (by thread): <A HREF="027428.html">[Twisted-Python] Twisted Names EDNS(0) support [Was Twisted at	PyConUK 2013]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27427">[ date ]</a>
              <a href="thread.html#27427">[ thread ]</a>
              <a href="subject.html#27427">[ subject ]</a>
              <a href="author.html#27427">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
