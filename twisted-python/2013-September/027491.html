<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] AMP Argument.toBox's proto argument is a	locator, not the proto?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMP%20Argument.toBox%27s%20proto%20argument%20is%20a%0A%09locator%2C%20not%20the%20proto%3F&In-Reply-To=%3C8E13BB54-88C0-4647-B785-D44323091B88%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027489.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] AMP Argument.toBox's proto argument is a	locator, not the proto?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMP%20Argument.toBox%27s%20proto%20argument%20is%20a%0A%09locator%2C%20not%20the%20proto%3F&In-Reply-To=%3C8E13BB54-88C0-4647-B785-D44323091B88%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] AMP Argument.toBox's proto argument is a	locator, not the proto?">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Sep 30 16:59:22 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027489.html">[Twisted-Python] AMP Argument.toBox's proto argument is a locator, not the proto?
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27491">[ date ]</a>
              <a href="thread.html#27491">[ thread ]</a>
              <a href="subject.html#27491">[ subject ]</a>
              <a href="author.html#27491">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Sep 30, 2013, at 12:09 PM, Laurens Van Houtven &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.io</A>&gt; wrote:

&gt;<i> Hi Glyph,
</I>&gt;<i> 
</I>&gt;<i> Thanks for your response!
</I>&gt;<i> 
</I>&gt;<i> On Mon, Sep 30, 2013 at 8:41 PM, Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> On Sep 30, 2013, at 2:45 AM, Laurens Van Houtven &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.io</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> What am I doing wrong? Is this a bug?
</I>&gt;<i> 
</I>&gt;<i> I think it's pretty clearly a bug.  Calling the argument &quot;proto&quot; in the first place indicates the nature of the confusion.
</I>&gt;<i> 
</I>&gt;<i> There are parts of the flow here from bytes to method execution and back (like _wrapWithSerialization) which are nice for composition, but the fact that they're private sort of ruins their utility for extensibility.
</I>&gt;<i> 
</I>&gt;<i> Looking at the code you're trying to write in txampext though, the problem appears to be simply that you're writing functionality close enough to AMP's core that you should be making the changes to AMP directly, and fixing the issue by making changes to AMP itself rather than trying to work around it externally.  The way I was going to recommend fixing it before I clicked on your link was by writing something like ExposingArgument and accessing the locator/receiver/sender via that new API rather than via the 'proto' argument at all :)
</I>&gt;<i> 
</I>&gt;<i> I'm a little confused why that would help; you're saying there should be a new API that gives arguments access to the locator, receiver, sender? What would that look like? Something along the lines of fromBox/toBox, or are you thinking of a more direct approach where the locator has a reference to the other components? (Given your suggestion of not going through the proto argument, I imagine something closer to the latter.)
</I>
For someone confused about why it would help, you are pretty close to the mark :).

I am not trying to propose a specific new implementation mechanism, but rather to say that fromBox/toBox are broken, in that the contract of the 'proto' argument is incompletely specified.  Most of the code I can think of that wants to use that really wants the transport rather than the &quot;protocol&quot;, but nothing within AMP itself actually uses those arguments; in fact, searching the usual suspects (epsilon, vertex) I can't even find any Arguments that use the 'proto' argument for anything useful.

If I recall, I believe the idea behind it was to allow an AMP responder within Vertex to return the peer's IP address back to the peer, from within an authenticated AMP route that (because it was a route) wasn't necessarily connected directly to the transport (and therefore couldn't just do self.transport.getPeer()).  Ironically I don't think it'll actually work for that now :-).

When we pull the authentication logic in from &lt;<A HREF="http://bazaar.launchpad.net/~divmod-dev/divmod.org/trunk/view/head:/Epsilon/epsilon/ampauth.py">http://bazaar.launchpad.net/~divmod-dev/divmod.org/trunk/view/head:/Epsilon/epsilon/ampauth.py</A>&gt;, you might write a responder that's interested in authentication information that lives in some other relation to the protocol.

So in order to fix fromBox/toBox, we need to do a fix that firms up that contract and perhaps exposes more than a Protocol object.  The *recommended* API should be more or less like what ExposingArgument is doing - specify an Argument that asks for a particular attribute of the transport or the protocol or the authentication context or whatever, the implementation details may involve other lower-level public APIs.

&gt;<i> My contributions to AMP have been more of the defect-findy kind, but I could certainly turn them more into the code-contributy kind. I imagine I'm not the first person to want tests for command classes (<A HREF="https://github.com/lvh/txampext/blob/master/txampext/commandtests.py">https://github.com/lvh/txampext/blob/master/txampext/commandtests.py</A>) or a nested AMP box (<A HREF="https://github.com/lvh/txampext/blob/master/txampext/nested.py">https://github.com/lvh/txampext/blob/master/txampext/nested.py</A>).
</I>
That would be cool.  And, you know, that auth thing I said :-).

&gt;<i> I look forward to being in the same locality as you, I presume it will make me more productive ;)
</I>
Living in that particular locale is going to spoil me.  I feel like I may need to move somewhere more remote so that I am forced to have nice transparent discussions on the record like this one, on mailing lists on IRC :-).

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130930/164dd613/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130930/164dd613/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027489.html">[Twisted-Python] AMP Argument.toBox's proto argument is a locator, not the proto?
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27491">[ date ]</a>
              <a href="thread.html#27491">[ thread ]</a>
              <a href="subject.html#27491">[ subject ]</a>
              <a href="author.html#27491">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
