<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Clean pb solution for two-way object sync?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Clean%20pb%20solution%20for%20two-way%20object%20sync%3F&In-Reply-To=%3CCAKN9TDL-Jg8-FUZZzo%3DRthsncn3ZzMMCD9xvPirCRCZb8%2BBaMg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Clean pb solution for two-way object sync?</H1>
    <B>Daniel Sank</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Clean%20pb%20solution%20for%20two-way%20object%20sync%3F&In-Reply-To=%3CCAKN9TDL-Jg8-FUZZzo%3DRthsncn3ZzMMCD9xvPirCRCZb8%2BBaMg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Clean pb solution for two-way object sync?">sank.daniel at gmail.com
       </A><BR>
    <I>Thu Sep 26 00:05:38 MDT 2013</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59931">[ date ]</a>
              <a href="thread.html#59931">[ thread ]</a>
              <a href="subject.html#59931">[ subject ]</a>
              <a href="author.html#59931">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(Apologies for double send but I forgot the subject line)

Dear Twisted users,

I recently found myself implementing a design pattern that I think
twisted.pb was specifically designed to address. I think I'm not using pb
correctly so I'd like advice. This is a somewhat longish post because I
need to describe the problem I'm trying to solve.

I have done internet searches on Stack Overflow and this list but have not
found the answer to my question. If I've missed something kindly direct me
to the appropriate reference.

I want to implement something functionally equivalent to a network chess
game. I first consider how I would do this on a single computer with no
network (maybe this is bad thinking). Each piece in the game is represented
by an instance of class Agent. Each agent has a .graphics attribute which
is an instance of a class from a GUI toolkit library or equivalent.
Whenever an agent in the game needs to do something there will be business
logic executed by the game objects proper (ie the agents) which will invoke
methods on the .graphics objects to update the screen. This sort of
structure seems natural as it allows easy integration of drag/drop, mouse
click detection etc. It also nicely separates the real business logic from
the GUI.

Now I want to run over the network. The question is how should I set up
references between the client and server objects?

Surely the server will maintain a set of objects representing the pieces in
the game. It seems reasonable that each user's program will have a
corresponding set of objects (with .graphics attributes). The issue is,
what do we mean by &quot;corresponding&quot; and how do these objects talk to one
another? Following is my idea so far:

Each instance of AgentClient has a .server attribute which is a remote
reference to an instance of AgentServer, and each instance of AgentServer
has a .clients attribute which is a list of remote references to instances
of AgentClient.

class AgentServer(pb.referenceable):

    def remote_move(self, targetSquare):
        &quot;&quot;&quot;Handle move request from client&quot;&quot;&quot;
        if self.thisMoveIsLegal(targetSquare):
            self.position = targetSquare
            for client in self.clients:
                client.callRemote(&quot;move&quot;, targetSquare)

    def thisMoveIsLegal(self, targetSquare):
        &lt;check that this is a legal move&gt;

class AgentClient(pb.referenceable):

    def requestMove(self, targetSquare):
        &quot;&quot;&quot;Tell server we'd like to move&quot;&quot;&quot;
        self.server.callRemote(&quot;move&quot;, targetSquare)

    def remote_move(self, targetSquare):
        &quot;&quot;&quot;Server told us we moved&quot;&quot;&quot;
        self.position = targetSquare
        self.graphics.setNewPosition(targetSquare)

This isn't THAT bad. The client's requestMove is thin and unecessary (I put
it there for illustration). Still I need to have two separate classes with
corresponding methods to handle moving the piece. This seems like the kind
of thing I could twisted.pb to solve more cleanly if I only would look in
the right place.

This problem gets even worse when I think about how to birth new in-game
objects. It would have to look like this:

class PlayerServer(pb.referenceable):

    def newAgent(self, asker):
        &quot;&quot;&quot;Client told us it wants a new Agent&quot;&quot;&quot;
        if self.thisIsLegal():
            a = AgentServer()
            self.agents.append(a)
            for client in self.clients:
                d = client.callRemote(&quot;newAgent&quot;, a)
                d.addCallback(lambda obj: a.clients.append(obj))

class PlayerClient(bp.referenceable):

    def requestNewAgent(self):
        &quot;&quot;&quot;Tell the server we want to spawn a new Agent&quot;&quot;&quot;
        self.server.callRemote(&quot;newAgent&quot;, self)

    def newAgent(self, serverObj):
        a = AgentClient()
        self.agents.append(a)
        a.server = serverObj
        return a

This just looks wrong. Any advice?

Thank you in advance for your help.

Regards,
Daniel Sank
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130925/5fa99ba8/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59931">[ date ]</a>
              <a href="thread.html#59931">[ thread ]</a>
              <a href="subject.html#59931">[ subject ]</a>
              <a href="author.html#59931">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
