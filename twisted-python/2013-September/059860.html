<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Passing additional arguments to errback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Passing%20additional%20arguments%20to%20errback&In-Reply-To=%3CCAFUtXGz1GrbfopsYLeQyRfFfNZdSwyteuUhq35oVN7-QAa7zxQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="059855.html">
   <LINK REL="Next"  HREF="059862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Passing additional arguments to errback</H1>
    <B>Maciej Wasilak</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Passing%20additional%20arguments%20to%20errback&In-Reply-To=%3CCAFUtXGz1GrbfopsYLeQyRfFfNZdSwyteuUhq35oVN7-QAa7zxQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Passing additional arguments to errback">wasilak at gmail.com
       </A><BR>
    <I>Thu Sep  5 01:24:06 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="059855.html">[Twisted-Python] Passing additional arguments to errback
</A></li>
        <LI>Next message (by thread): <A HREF="059862.html">[Twisted-Python] Passing additional arguments to errback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59860">[ date ]</a>
              <a href="thread.html#59860">[ thread ]</a>
              <a href="subject.html#59860">[ subject ]</a>
              <a href="author.html#59860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Laurens,

&gt;<i> Cześć
</I>
Cześć! :)

Thank you for your answer. I'm explicitly interested in the following
combination:

&gt;<i> .addCallback(cb).addErrback(eb)
</I>
If I understand correctly errback &quot;eb&quot; catches errors from both callback
&quot;cb&quot;, and from agent.request (agent.request errors pass through default
empty errback that re-raises them).

&gt;<i> Also, if you want to do scraping with Twisted, consider looking at
</I>Scrapy, a fully-featured web scraper that uses Twisted internally.

I'm working on CoAP protocol which runs on top of UDP. My actual code is
request processing (but the problem is the same as in my previous post):

_________________________________________________
def processRequest(self, request):
        (...)
        d = defer.succeed(request)
        d.addCallback(self.processBlock1)
        d.addCallback(self.dispatchRequest)
def dispatchRequest(self, request):
        (...)
        resource = self.endpoint.getResourceFor(request)
        if resource is None:
            response = Message(code=NOT_FOUND, payload='Resource not found!'
)
            self.respond(response, request)
            return
        try:
            d = resource.render(request)
        except iot.error.UnallowedMethod:
            response = Message(code=METHOD_NOT_ALLOWED, payload='Method not
allowed!')
            self.respond(response, request)
            return
        except iot.error.UnsupportedMethod:
            response = Message(code=NOT_IMPLEMENTED, payload='Method not
implemented!')
            self.respond(response, request)
            return
        delayed_ack = reactor.callLater(EMPTY_ACK_DELAY, self.sendEmptyAck,
request)
        d.addCallback(self.respond, request, delayed_ack)
        return d

__________________________________________________

I would like to rewrite it to:

__________________________________________________
def processRequest(self, request):
        (...)
        d = defer.succeed(request)
        d.addCallback(self.processBlock1)
        d.addCallback(self.dispatchRequest
).addErrback(self.handleRequestError)

def dispatchRequest(self, request):
        (...)
        resource = self.endpoint.getResourceFor(request)
        if resource is None:
            raise NoResource()
        try:
            d = resource.render(request)
        except iot.error.UnallowedMethod:      #Explicit re-rise for this
example only
            raise UnallowedMethod()
        except iot.error.UnsupportedMethod:
            raise UnsupportedMethod()
        d.addCallback(self.respond, request)
        return d


def handleRequestErrors(self, failure, request???)
        # handle exceptions, send error response to client

_______________________________________________

I would like to handle Exceptions in handleRequestErrors(). However
handleRequestErrors() has to send a response to the client, so it needs the
request, and I don't know how to pass it from inside dispatchRequest().

I see two possibilities:
    1. Pass request inside Failure object
    2. Leave the original code (process errors inside callback)

Which solution is more elegant?

Best Regards

Maciek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130905/e3d386c4/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="059855.html">[Twisted-Python] Passing additional arguments to errback
</A></li>
	<LI>Next message (by thread): <A HREF="059862.html">[Twisted-Python] Passing additional arguments to errback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59860">[ date ]</a>
              <a href="thread.html#59860">[ thread ]</a>
              <a href="subject.html#59860">[ subject ]</a>
              <a href="author.html#59860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
