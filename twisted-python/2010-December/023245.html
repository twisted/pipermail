<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Obtaining connection information for SSH	connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Obtaining%20connection%20information%20for%20SSH%0A%09connections&In-Reply-To=B3FB653A-2AC0-4E52-8166-5C25D4C36C77%40bubblehouse.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023242.html">
   <LINK REL="Next"  HREF="023243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Obtaining connection information for SSH	connections</H1>
    <B>John Santos</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Obtaining%20connection%20information%20for%20SSH%0A%09connections&In-Reply-To=B3FB653A-2AC0-4E52-8166-5C25D4C36C77%40bubblehouse.org"
       TITLE="[Twisted-Python] Obtaining connection information for SSH	connections">JOHN at egh.com
       </A><BR>
    <I>Mon Dec 20 17:26:32 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="023242.html">[Twisted-Python] ANN: antioch 1.0 developer preview released
</A></li>
        <LI>Next message: <A HREF="023243.html">[Twisted-Python] py2exe cannot find zope.interface -- fixed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23245">[ date ]</a>
              <a href="thread.html#23245">[ thread ]</a>
              <a href="subject.html#23245">[ subject ]</a>
              <a href="author.html#23245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, everyone -

I have an application written in Twisted which allows clients to
connect using SSH (any SSH2 client that I've tried works), to send
it commands and to bridge through it to target devices (connected
via telnet on a LAN or via telnet through a terminal server to serial
ports on the target.)  It's sort of a console monitor/logger/remote
access controller for a random bunch of remote equipment.

For the remote access part, I started from the SSH server examples
in the Twisted book, but modified it to use public key authentication
instead of the username/password authentication in the example.

This part works fine.  The application keeps its own key directory;
if a remote user has a &lt;user&gt;.pub file in the key directory, and the
authentication works with that key, then the user gets remote access...

I'm cleaning up a couple of rough edges, and can't find the info
I need...

1) logging/status information:  I would like to grab the remote
host info so I can log connections/connection failures/disconnections
and include the host name and/or IP address.  I would also like to
be able to display the current list of open connections to the server
in a status display.

I know this info has to be there somewhere, but I can't find it.
Spent several days wandering through a twisted maze of little passages,
looking for anything with a working getPeer() method or likely data,
with no luck.  I know it has to be somewhere, because somewhere deep
down underneath there has to be a TCP socket!

One problem is I don't have a good mental picture of how the peices
all fit together to build an SSH connection.  I think part of the
problem is that not all the pieces are there yet as data elements
get added on the fly to various objects (due to the dynamic nature
of Python, which I am still getting used to.)

So I think it would be very valuable to find some documentation
that explains how all the SSH pieces (conn's, avatars, etc.) all
fit together.

2) Similarly, when authenticating a key (in requestAvatarID()
in the PublicKeyCredentialsChecker, it would be useful to see
the remote host name so I could provide different keys for the
same user coming from different hosts.

Most or all SSH2 servers have a mechanism where you can have
a default public key for a given user, and host-specific keys
for that same user.  Typically, stored in a key file or directory
with names (or tags) like &lt;user&gt;_&lt;host&gt;.pub for the host-specific
key, and with &lt;user&gt;.pub for the default key.  If user FOO is
connecting from host XXX, it looks for ./keys/FOO_XXX.pub, and if
that file is not found, it looks for ./keys/FOO.pub.

Obviously, the credentials checker needs to know the remote host
name for this to work.

Thanks to anyone who can point me in the right direction!


-- 
John Santos
Evans Griffiths &amp; Hart, Inc.
781-861-0670 ext 539


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023242.html">[Twisted-Python] ANN: antioch 1.0 developer preview released
</A></li>
	<LI>Next message: <A HREF="023243.html">[Twisted-Python] py2exe cannot find zope.interface -- fixed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23245">[ date ]</a>
              <a href="thread.html#23245">[ thread ]</a>
              <a href="subject.html#23245">[ subject ]</a>
              <a href="author.html#23245">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
