<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Status of current proxy support (of various	kinds)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Status%20of%20current%20proxy%20support%20%28of%20various%0A%09kinds%29&In-Reply-To=%3C9C5743A2-0141-459B-B014-1B256A045B97%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056854.html">
   <LINK REL="Next"  HREF="056856.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Status of current proxy support (of various	kinds)</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Status%20of%20current%20proxy%20support%20%28of%20various%0A%09kinds%29&In-Reply-To=%3C9C5743A2-0141-459B-B014-1B256A045B97%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Status of current proxy support (of various	kinds)">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Aug  8 22:31:19 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056854.html">[Twisted-Python] Status of current proxy support (of various	kinds)
</A></li>
        <LI>Next message (by thread): <A HREF="056856.html">[Twisted-Python] Status of current proxy support (of various	kinds)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56855">[ date ]</a>
              <a href="thread.html#56855">[ thread ]</a>
              <a href="subject.html#56855">[ subject ]</a>
              <a href="author.html#56855">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 8, 2011, at 10:10 PM, Peter Le Bek wrote:

&gt;<i> Myself and another are working on adding SOCKS client support to Twisted for 
</I>&gt;<i> use in Tor related projects. I'm also convinced there's an abstraction that would 
</I>&gt;<i> make it easier to implement proxy clients (or any transparent data/endpoint 
</I>&gt;<i> modifying protocol) in Twisted. I agree that it's difficult to generalise, but there's a 
</I>&gt;<i> class of protocol that does one or more of the following, transparently, and little 
</I>&gt;<i> else:
</I>&gt;<i> 
</I>&gt;<i> - append data, before switching to application protocol (SSL handshake, SOCKS connect/bind)
</I>&gt;<i> - prepend data, after losing connection on application protocol (SSL shutdown)
</I>&gt;<i> - modify application data (SSL &quot;recordification&quot;, encryption)
</I>&gt;<i> - modify the endpoint (any proxy)
</I>&gt;<i> 
</I>&gt;<i> Endpoints can do all these things - SSL4ClientEndpoint, for example, does the first 
</I>&gt;<i> three - but does it make sense to use Endpoints for this purpose? 
</I>
I think so.

&gt;<i> Endpoints aren't stackable, so no good if I want to run a SOCKS client over SSL.
</I>
Sure they are.  There's no SOCKS endpoint yet, but if you were to implement one, you could make it take another endpoint (or endpoint factory, as the case may be) as an argument to its constructor.  The implementation of the various current SSL* enpdoints would set a better example if it weren't for the legacy connectSSL/listenSSL APIs.  However, those APIs are being slowly phased out in favor of the endpoints themselves, as well as the internal implementation being moved to use a wrapping / delegation approach &lt;<A HREF="http://twistedmatrix.com/trac/ticket/4854">http://twistedmatrix.com/trac/ticket/4854</A>&gt; between transports and protocols instead of OpenSSL's SSL-is-a-socket-except-when-it-isn't strategy.

&gt;<i> Also, with a proxied connection you have two Endpoints, one to the proxy server 
</I>&gt;<i> and one 'virtual Endpoint' to wherever. The Endpoints API doesn't accommodate 
</I>&gt;<i> this.
</I>
How doesn't it?  It's exactly this kind of API that endpoints were _designed_ to accommodate - the original impetus to create them was the Vertex project (now part of &lt;<A HREF="https://launchpad.net/divmod.org/">https://launchpad.net/divmod.org/</A>&gt;), which proxies traffic in a variety of different ways.

&gt;<i> Would it make sense to have Endpoint wrappers for this purpose? A sort of 
</I>&gt;<i> middleware (hate that word) to intercept transport events (including transport 
</I>&gt;<i> formation, i.e. Endpoint.connect()).
</I>
It might make sense to have some utilities around this area.  There are definitely parts of the process - especially producers and consumers - where you have to write a lot of boilerplate code to make sure everything's hooked up properly.  But it's all certainly _possible_ now with the existing interfaces.

You'd probably be interested in this ticket: &lt;<A HREF="http://twistedmatrix.com/trac/ticket/3204">http://twistedmatrix.com/trac/ticket/3204</A>&gt;.  Perhaps you could submit a patch? :)

&gt;<i> I'm looking forward to being proven wrong on this as it will make my SOCKS work 
</I>&gt;<i> easier, or else if this turns out to be interesting then I have more ideas on how it 
</I>&gt;<i> should be implemented.
</I>
It would help with that proof if you would be a bit more precise about where you think the current code falls short.

-glyph

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056854.html">[Twisted-Python] Status of current proxy support (of various	kinds)
</A></li>
	<LI>Next message (by thread): <A HREF="056856.html">[Twisted-Python] Status of current proxy support (of various	kinds)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56855">[ date ]</a>
              <a href="thread.html#56855">[ thread ]</a>
              <a href="subject.html#56855">[ subject ]</a>
              <a href="author.html#56855">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
