<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SFTP Server sample
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SFTP%20Server%20sample&In-Reply-To=%3CCAPrioPNp9dyhgqNM4n%2BpP2hXMbS9mv%3DUw06yg8xMVZ3TEH7kKA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056912.html">
   <LINK REL="Next"  HREF="056915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SFTP Server sample</H1>
    <B>Michal Mach</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SFTP%20Server%20sample&In-Reply-To=%3CCAPrioPNp9dyhgqNM4n%2BpP2hXMbS9mv%3DUw06yg8xMVZ3TEH7kKA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] SFTP Server sample">michal.mach at gmail.com
       </A><BR>
    <I>Mon Aug 22 16:31:00 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056912.html">[Twisted-Python] SFTP Server sample
</A></li>
        <LI>Next message (by thread): <A HREF="056915.html">[Twisted-Python] SFTP Server sample
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56914">[ date ]</a>
              <a href="thread.html#56914">[ thread ]</a>
              <a href="subject.html#56914">[ subject ]</a>
              <a href="author.html#56914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Not sure what you mean, but here is a basic example:

from zope.interface import implements

from twisted.application import service, internet
from twisted.conch.ssh.keys import Key
from twisted.conch.ssh.factory import SSHFactory
from twisted.conch.unix import UnixSSHRealm
from twisted.cred.checkers import ICredentialsChecker
from twisted.cred.credentials import IUsernamePassword
from twisted.cred.portal import Portal


def get_key(path):
    return Key.fromString(data=open(path).read())


class DummyChecker(object):
    credentialInterfaces = (IUsernamePassword,)
    implements(ICredentialsChecker)

    def requestAvatarId(self, credentials):
        return credentials.username


def makeService():
    public_key = get_key('id_rsa.pub')
    private_key = get_key('id_rsa')

    factory = SSHFactory()
    factory.privateKeys = {'ssh-rsa': private_key}
    factory.publicKeys = {'ssh-rsa': public_key}
    factory.portal = Portal(UnixSSHRealm())
    factory.portal.registerChecker(DummyChecker())

    return internet.TCPServer(2200, factory)


application = service.Application(&quot;sftp server&quot;)
sftp_server = makeService()
sftp_server.setServiceParent(application)


Put this content into a file like sftp.tac
The keys can be generated by ckeygen utility which is part of Twisted
(e.g. ckeygen -b 2048 -t rsa -f id_rsa)
and run with twistd -ny sftp.tac

If you want more background on Twisted conch i suggest the &quot;Twisted Conch in
60 Seconds&quot; series by
Jean-Paul Calderone on his blog <A HREF="http://as.ynchrono.us/">http://as.ynchrono.us/</A>

Michal Mach


On Mon, Aug 22, 2011 at 10:31 PM, Osborn Chan &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ychan at quova.com</A>&gt; wrote:

&gt;<i> Yes. It is SFTP, and I found that filetransfer.FileTransferServer is a
</I>&gt;<i> subsystem under UnixConchUser.
</I>&gt;<i>
</I>&gt;<i>        self.subsystemLookup.update({&quot;sftp&quot;:
</I>&gt;<i> filetransfer.FileTransferServer})
</I>&gt;<i>
</I>&gt;<i> However, I was able to start a ssh shell by using SSHFactory and
</I>&gt;<i> UnixSSHReam, but I was not able to start SFTP as sub system.
</I>&gt;<i>
</I>&gt;<i> Do I need to do anything explicitly to start sftp subsystem?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> -Osborn
</I>&gt;<i> newbie in Python and Twisted.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 8/22/11 12:50 PM, &quot;Jasper St. Pierre&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jstpierre at mecheye.net</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;What about twisted.conch.ssh.filetransfer? Is that not SFTP?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;On Mon, Aug 22, 2011 at 3:36 PM, Drew Smathers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">drew.smathers at gmail.com</A>&gt;
</I>&gt;<i> &gt;wrote:
</I>&gt;<i> &gt;&gt; On Fri, Aug 19, 2011 at 2:43 PM, Osborn Chan &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ychan at quova.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;&gt; Hi,
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; I am a newbie in twisted and python.
</I>&gt;<i> &gt;&gt;&gt; I would like to create a python SFTP server with twisted, but I cannot
</I>&gt;<i> &gt;&gt;&gt;find any sample.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Can someone give me some advise?
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I don't believe there are any examples of building an SFTP server
</I>&gt;<i> &gt;&gt; aimed at newcomers to twisted and python but there are existing
</I>&gt;<i> &gt;&gt; implementations in the wild--which might honestly be difficult to
</I>&gt;<i> &gt;&gt; digest if you don't know python well enough. I think zope at one time
</I>&gt;<i> &gt;&gt; has SFTP server based on twisted (which I can't seem to summon with
</I>&gt;<i> &gt;&gt; google) and there's also SFTP server implementation in tahoe-lafs
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;(
</I>&gt;<i> <A HREF="https://github.com/warner/tahoe-lafs/blob/master/src/allmydata/frontends">https://github.com/warner/tahoe-lafs/blob/master/src/allmydata/frontends</A>
</I>&gt;<i> &gt;&gt;/sftpd.py).
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; -Drew
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Twisted-Python mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;--
</I>&gt;<i> &gt;  Jasper
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;_______________________________________________
</I>&gt;<i> &gt;Twisted-Python mailing list
</I>&gt;<i> &gt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20110823/fa0e3929/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056912.html">[Twisted-Python] SFTP Server sample
</A></li>
	<LI>Next message (by thread): <A HREF="056915.html">[Twisted-Python] SFTP Server sample
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56914">[ date ]</a>
              <a href="thread.html#56914">[ thread ]</a>
              <a href="subject.html#56914">[ subject ]</a>
              <a href="author.html#56914">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
