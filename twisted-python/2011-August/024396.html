<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Flush socket
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Flush%20socket&In-Reply-To=CA6A1C23.47CE%25tobias.oberstein%40tavendo.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024398.html">
   <LINK REL="Next"  HREF="024397.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Flush socket</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Flush%20socket&In-Reply-To=CA6A1C23.47CE%25tobias.oberstein%40tavendo.de"
       TITLE="[Twisted-Python] Flush socket">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Aug 11 19:43:34 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024398.html">[Twisted-Python] Flush socket
</A></li>
        <LI>Next message: <A HREF="024397.html">[Twisted-Python] Flush socket
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24396">[ date ]</a>
              <a href="thread.html#24396">[ thread ]</a>
              <a href="subject.html#24396">[ subject ]</a>
              <a href="author.html#24396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09:54 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tobias.oberstein at tavendo.de</A> wrote:
&gt;<i>sorry, my question wasn't clear:
</I>&gt;<i>
</I>&gt;<i>I do already disable Nagle by setting TCP NoDelay.
</I>&gt;<i>
</I>&gt;<i>And I do a reactor.select(0), which sometimes breaks I guess
</I>&gt;<i>because of reactor reentry not expected, and it will break
</I>&gt;<i>when the reactor is not select() based I guess.
</I>&gt;<i>
</I>&gt;<i>So the question is: is there an alternative to reactor.select(0)
</I>&gt;<i>after a transport.write() to make the reactor call write() on
</I>&gt;<i>the underlying socket for all stuff buffered within Twisted?
</I>
Sure.  Implement your own IFileDescriptor.  When you add the descriptor 
to the reactor using IReactorFDSet.addWriter, it will call back onto 
your object's doWrite method to tell it there is space in the write 
buffer.  Then you can write exactly as many bytes as you want, as well 
as implementing other policies - for example you can remove the 
descriptor from the reactor's write set using 
IReactorFDSet.removeWriter, thus delaying future writes until it is re- 
added.

This will always be a somewhat unreliable way to test a remote process's 
handling of packetization, since there are still two TCP/IP stacks which 
can mess around with the data in a variety of ways, but it's as good as 
you can do if you want to use normal sockets for this testing.

A more reliable way might be to synthesize the IP datagrams yourself, 
and inject them into the recipient's TCP/IP stack.  Or skip the TCP/IP 
stack and inject them into the recipient process directly, by replacing 
the BSD socket APIs with an alternate implementation you control 
(perhaps using an LD_PRELOAD hook, for example).

Twisted doesn't offer much in the way of assistance for those latter 
approaches, though.

Jean-Paul
&gt;<i>
</I>&gt;<i>On 11.08.11 23:47, &quot;Itamar Turner-Trauring&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>&gt; 
</I>&gt;<i>wrote:
</I>&gt;&gt;<i>so there is no Twisted sanctioned (reactor independent and reentry 
</I>&gt;&gt;<i>safe)
</I>&gt;&gt;<i>alternative to disable nagle (tcp nodelay) and doing a select()?
</I>&gt;<i>
</I>&gt;<i>You can disable nagle in Twisted, if that's the question
</I>&gt;<i>(transport.setTcpNoDelay(True)). But you can't determine TCP packet 
</I>&gt;<i>size,
</I>&gt;<i>that's up to the operating system.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-Python mailing list
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024398.html">[Twisted-Python] Flush socket
</A></li>
	<LI>Next message: <A HREF="024397.html">[Twisted-Python] Flush socket
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24396">[ date ]</a>
              <a href="thread.html#24396">[ thread ]</a>
              <a href="subject.html#24396">[ subject ]</a>
              <a href="author.html#24396">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
