<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SFTP Server sample
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SFTP%20Server%20sample&In-Reply-To=%3CCA782F82.1418%25ychan%40quova.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056914.html">
   <LINK REL="Next"  HREF="056919.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SFTP Server sample</H1>
    <B>Osborn Chan</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SFTP%20Server%20sample&In-Reply-To=%3CCA782F82.1418%25ychan%40quova.com%3E"
       TITLE="[Twisted-Python] SFTP Server sample">ychan at quova.com
       </A><BR>
    <I>Mon Aug 22 17:10:48 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056914.html">[Twisted-Python] SFTP Server sample
</A></li>
        <LI>Next message (by thread): <A HREF="056919.html">[Twisted-Python] SFTP Server sample
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56915">[ date ]</a>
              <a href="thread.html#56915">[ thread ]</a>
              <a href="subject.html#56915">[ subject ]</a>
              <a href="author.html#56915">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michal,

Thanks a lot!
It is a very nice working example, and it is good for newbie as well.

Regards,

Osborn

From: Michal Mach &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">michal.mach at gmail.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">michal.mach at gmail.com</A>&gt;&gt;
Reply-To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;&gt;
Date: Tue, 23 Aug 2011 00:31:00 +0200
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;&gt;
Subject: Re: [Twisted-Python] SFTP Server sample

Not sure what you mean, but here is a basic example:

from zope.interface import implements

from twisted.application import service, internet
from twisted.conch.ssh.keys import Key
from twisted.conch.ssh.factory import SSHFactory
from twisted.conch.unix import UnixSSHRealm
from twisted.cred.checkers import ICredentialsChecker
from twisted.cred.credentials import IUsernamePassword
from twisted.cred.portal import Portal


def get_key(path):
    return Key.fromString(data=open(path).read())


class DummyChecker(object):
    credentialInterfaces = (IUsernamePassword,)
    implements(ICredentialsChecker)

    def requestAvatarId(self, credentials):
        return credentials.username


def makeService():
    public_key = get_key('id_rsa.pub')
    private_key = get_key('id_rsa')

    factory = SSHFactory()
    factory.privateKeys = {'ssh-rsa': private_key}
    factory.publicKeys = {'ssh-rsa': public_key}
    factory.portal = Portal(UnixSSHRealm())
    factory.portal.registerChecker(DummyChecker())

    return internet.TCPServer(2200, factory)


application = service.Application(&quot;sftp server&quot;)
sftp_server = makeService()
sftp_server.setServiceParent(application)


Put this content into a file like sftp.tac
The keys can be generated by ckeygen utility which is part of Twisted (e.g. ckeygen -b 2048 -t rsa -f id_rsa)
and run with twistd -ny sftp.tac

If you want more background on Twisted conch i suggest the &quot;Twisted Conch in 60 Seconds&quot; series by
Jean-Paul Calderone on his blog <A HREF="http://as.ynchrono.us/">http://as.ynchrono.us/</A>

Michal Mach


On Mon, Aug 22, 2011 at 10:31 PM, Osborn Chan &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ychan at quova.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ychan at quova.com</A>&gt;&gt; wrote:
Yes. It is SFTP, and I found that filetransfer.FileTransferServer is a
subsystem under UnixConchUser.

       self.subsystemLookup.update({&quot;sftp&quot;:
filetransfer.FileTransferServer})

However, I was able to start a ssh shell by using SSHFactory and
UnixSSHReam, but I was not able to start SFTP as sub system.

Do I need to do anything explicitly to start sftp subsystem?

Thanks,

-Osborn
newbie in Python and Twisted.


On 8/22/11 12:50 PM, &quot;Jasper St. Pierre&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jstpierre at mecheye.net</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jstpierre at mecheye.net</A>&gt;&gt; wrote:

&gt;<i>What about twisted.conch.ssh.filetransfer? Is that not SFTP?
</I>&gt;<i>
</I>&gt;<i>On Mon, Aug 22, 2011 at 3:36 PM, Drew Smathers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">drew.smathers at gmail.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">drew.smathers at gmail.com</A>&gt;&gt;
</I>&gt;<i>wrote:
</I>&gt;&gt;<i> On Fri, Aug 19, 2011 at 2:43 PM, Osborn Chan &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ychan at quova.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ychan at quova.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I am a newbie in twisted and python.
</I>&gt;&gt;&gt;<i> I would like to create a python SFTP server with twisted, but I cannot
</I>&gt;&gt;&gt;<i>find any sample.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Can someone give me some advise?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I don't believe there are any examples of building an SFTP server
</I>&gt;&gt;<i> aimed at newcomers to twisted and python but there are existing
</I>&gt;&gt;<i> implementations in the wild--which might honestly be difficult to
</I>&gt;&gt;<i> digest if you don't know python well enough. I think zope at one time
</I>&gt;&gt;<i> has SFTP server based on twisted (which I can't seem to summon with
</I>&gt;&gt;<i> google) and there's also SFTP server implementation in tahoe-lafs
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>(<A HREF="https://github.com/warner/tahoe-lafs/blob/master/src/allmydata/frontends">https://github.com/warner/tahoe-lafs/blob/master/src/allmydata/frontends</A>
</I>&gt;&gt;<i>/sftpd.py).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Drew
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>  Jasper
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-Python mailing list
</I>&gt;<i><A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt;
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>

_______________________________________________ Twisted-Python mailing list <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>&gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056914.html">[Twisted-Python] SFTP Server sample
</A></li>
	<LI>Next message (by thread): <A HREF="056919.html">[Twisted-Python] SFTP Server sample
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56915">[ date ]</a>
              <a href="thread.html#56915">[ thread ]</a>
              <a href="subject.html#56915">[ subject ]</a>
              <a href="author.html#56915">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
