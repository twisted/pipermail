<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> InlineCallback Friendly ? Re: [Twisted-Python] Question about Using	in ServerProtocol request Handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=InlineCallback%20Friendly%20%3F%20Re%3A%20%5BTwisted-Python%5D%20Question%20about%20Using%0A%09in%20ServerProtocol%20request%20Handler&In-Reply-To=E1JRsId-0006pX-Qn%40cube.twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016828.html">
   <LINK REL="Next"  HREF="016825.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>InlineCallback Friendly ? Re: [Twisted-Python] Question about Using	in ServerProtocol request Handler</H1>
    <B>Andrew Francis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=InlineCallback%20Friendly%20%3F%20Re%3A%20%5BTwisted-Python%5D%20Question%20about%20Using%0A%09in%20ServerProtocol%20request%20Handler&In-Reply-To=E1JRsId-0006pX-Qn%40cube.twistedmatrix.com"
       TITLE="InlineCallback Friendly ? Re: [Twisted-Python] Question about Using	in ServerProtocol request Handler">andrewfr_ice at yahoo.com
       </A><BR>
    <I>Wed Feb 20 14:50:08 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016828.html">[Twisted-Python] Question about Using Deferreds in	ServerProtocol request Handler
</A></li>
        <LI>Next message: <A HREF="016825.html">InlineCallback Friendly ? Re: [Twisted-Python] Question about	Using in ServerProtocol request Handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16824">[ date ]</a>
              <a href="thread.html#16824">[ thread ]</a>
              <a href="subject.html#16824">[ subject ]</a>
              <a href="author.html#16824">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jean-Paul:

&gt;<i>However, how is this done with just deferreds and
</I>&gt;<i>callbacks without Stackless or inlineCallbacks?
</I>
Thanks for the response. And thanks for the
explanation of inlineCallbacks. Annotating your
example, I get  the following:

 def process(self):
        def callback(result):
            print &quot;second&quot;
            self.setHeader('Content-Type',
'text/html')
            self.write(result)
            self.finish()
        def errback(err):
            err.trap(Exception)
            log.err(err, &quot;process getPage call
failed&quot;)
        try:
            d =
client.getPage(&quot;<A HREF="http://www.google.com&quot;">http://www.google.com&quot;</A>)
        except Exception:
            d = failure.Failure()
        d.addCallbacks(callback, errback)
        print &quot;first&quot;

running this I get what I expected

&quot;first&quot;
&quot;second&quot;


This example I can follow. The server protocol handler
terminates. The callback eventually fires. Since the
callback has a reference to the request, it can write
back the response.

Bear with me, I am just starting to read up on
protocols... 

What I am unclear on, is why some Server Protocols
depend on 'return' and others don't (I assume with
HTTP, you can stream a response). What is the right
way to design a ServerProtocol? Is there an
'inclineCallback' friendly protocol

Unless I am fundamentally missing something it seems
that there are advantages to designing a Server
Protocol not to depend on 'return'

As I alluded to in other posts, I get confused over
this variation.

This is pyAMF

class pyAMFTest(TwistedGateway):
    def __init__(self):
        super(TubeTest, self).__init__()
        return
        
    def echo(self, x):
        print x
        return x

pretend I wish to do a callRemote(...)

def echo(self, x):
    def callback(result):
        print &quot;second&quot;
        &quot;&quot;&quot;
        How do I return x?
        &quot;&quot;&quot;        

    def errback(err):
        err.trap(Exception)
        log.err(err, &quot;process getPage call failed&quot;)
    try:
        proxy = ....
        d = proxy.callRemote(...)
    except Exception:
        d = failure.Failure()
    d.addCallbacks(callback, errback)
    print &quot;first&quot;

In this case, how is 'x' transmitted back to the
reactor and the client? What is the proper way of
structuring this code. 

By the way, the inlineCallback and the Stackless
versions also have problems handling this.

This is starting to stimulate my interest in writing a
Stackless solution that handles this case....

Cheers,
Andrew



      ____________________________________________________________________________________
Looking for last minute shopping deals?  
Find them fast with Yahoo! Search.  <A HREF="http://tools.search.yahoo.com/newsearch/category.php?category=shopping">http://tools.search.yahoo.com/newsearch/category.php?category=shopping</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016828.html">[Twisted-Python] Question about Using Deferreds in	ServerProtocol request Handler
</A></li>
	<LI>Next message: <A HREF="016825.html">InlineCallback Friendly ? Re: [Twisted-Python] Question about	Using in ServerProtocol request Handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16824">[ date ]</a>
              <a href="thread.html#16824">[ thread ]</a>
              <a href="subject.html#16824">[ subject ]</a>
              <a href="author.html#16824">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
