<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Reactor is left dirty after calling	twisted.mail.smtp.sendmail via trial
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Reactor%20is%20left%20dirty%20after%20calling%0A%09twisted.mail.smtp.sendmail%20via%20trial&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016866.html">
   <LINK REL="Next"  HREF="016869.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Reactor is left dirty after calling	twisted.mail.smtp.sendmail via trial</H1>
    <B>Marcin Kasperski</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Reactor%20is%20left%20dirty%20after%20calling%0A%09twisted.mail.smtp.sendmail%20via%20trial&In-Reply-To="
       TITLE="[Twisted-Python] Re: Reactor is left dirty after calling	twisted.mail.smtp.sendmail via trial">Marcin.Kasperski at softax.com.pl
       </A><BR>
    <I>Tue Feb 26 09:40:54 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016866.html">[Twisted-Python] Re: Reactor is left dirty after calling	twisted.mail.smtp.sendmail via trial
</A></li>
        <LI>Next message: <A HREF="016869.html">[Twisted-Python] Re: Reactor is left dirty after calling	twisted.mail.smtp.sendmail via trial
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16867">[ date ]</a>
              <a href="thread.html#16867">[ thread ]</a>
              <a href="subject.html#16867">[ subject ]</a>
              <a href="author.html#16867">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Am I wrong?
</I>
I took a deeper look. Looks like it is caused by the way smtp.py
works. More or less, at least for my naive eye, it seems to me
that the deferred returned from sendmail/sendEmail is fired as
soon as email sending is done, and cleanup (closing smtp connection,
removing factory etc) proceeds asynchronously.

In real code it is likely good thing as you need not to wait for
final message exchanges.

Not sure whether it is possible to do anything with that (without 
rewriting the module deeply) :-(

  { it would be test-friendly if sendmail either returned two
    deferreds, one fired after send, second after cleanup, or
    had option to sync returned deferred on cleanup... }


-- 
----------------------------------------------------------------------
|<i> Marcin Kasperski   |    You have the right to accept your
</I>|<i> <A HREF="http://mekk.waw.pl">http://mekk.waw.pl</A> | responsibilites instead of having them
</I>|<i>                    |         assigned to you. (Beck)
</I>----------------------------------------------------------------------



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016866.html">[Twisted-Python] Re: Reactor is left dirty after calling	twisted.mail.smtp.sendmail via trial
</A></li>
	<LI>Next message: <A HREF="016869.html">[Twisted-Python] Re: Reactor is left dirty after calling	twisted.mail.smtp.sendmail via trial
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16867">[ date ]</a>
              <a href="thread.html#16867">[ thread ]</a>
              <a href="subject.html#16867">[ subject ]</a>
              <a href="author.html#16867">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
