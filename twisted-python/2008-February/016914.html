<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Factory question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Factory%20question&In-Reply-To=47C6C838.4020308%40evotex.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016913.html">
   <LINK REL="Next"  HREF="016915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Factory question</H1>
    <B>Drew Smathers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Factory%20question&In-Reply-To=47C6C838.4020308%40evotex.ch"
       TITLE="[Twisted-Python] Factory question">drew.smathers at gmail.com
       </A><BR>
    <I>Thu Feb 28 10:39:52 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016913.html">[Twisted-Python] Factory question
</A></li>
        <LI>Next message: <A HREF="016915.html">[Twisted-Python] Factory question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16914">[ date ]</a>
              <a href="thread.html#16914">[ thread ]</a>
              <a href="subject.html#16914">[ subject ]</a>
              <a href="author.html#16914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Feb 28, 2008 at 9:42 AM, Gabriel Rossetti
&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mailing_lists at evotex.ch</A>&gt; wrote:
&gt;<i> Drew Smathers wrote:
</I>&gt;<i>  &gt; On Wed, Feb 27, 2008 at 3:32 AM, Gabriel Rossetti
</I>&gt;<i>  &gt; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mailing_lists at evotex.ch</A>&gt; wrote:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;&gt; Hello everyone,
</I>&gt;<i>  &gt;&gt;
</I>&gt;<i>  &gt;&gt;  I have a small question, I have a service which needs to sometimes send
</I>&gt;<i>  &gt;&gt;  data (without having received any prior to sending) and sometimes
</I>&gt;<i>  &gt;&gt;  receive data, which is better :
</I>&gt;<i>  &gt;&gt;
</I>&gt;<i>  &gt;&gt;  1) create a factory that inherits from ServerFactory and ClientFactory,
</I>&gt;<i>  &gt;&gt;  thus it can listen and send data
</I>&gt;<i>  &gt;&gt;
</I>&gt;<i>  &gt;&gt;  2) create a factory that inherits from ServerFactory only and uses a
</I>&gt;<i>  &gt;&gt;  single-use client (ClientCreator, as shown in the writing clients howto)
</I>&gt;<i>  &gt;&gt;  when it needs to send data
</I>&gt;<i>  &gt;&gt;
</I>&gt;<i>  &gt;&gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; I'm not sure of there's a single right way to do it, but I wouldn't
</I>&gt;<i>  &gt; bother inheriting from both ClientFactory and ServerFactory.  I think
</I>&gt;<i>  &gt; you're on the write track with 2, though.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  I had taken route 1 up until now (I'm thinking about switching...)
</I>&gt;<i>
</I>&gt;<i>  Maybe there's something I haven't quite gotten, when ClientA initially
</I>&gt;<i>  connects to the server, the factory creates an instance of the protocol,
</I>&gt;<i>  correct?
</I>
Yes.

&gt;<i> Now ClientA sends some data to the server, which processes it
</I>&gt;<i>  and sends something back. After that, the TCP session ends, and the
</I>&gt;<i>  client disconnects, and the protocols instance dies. Is this correct or
</I>&gt;<i>  does it live on and get reused somehow?
</I>
The protocol instance does not get reused.

&gt;<i>  I ask this because since
</I>&gt;<i>  initially the clients send data to the server (registration), the server
</I>&gt;<i>  will there after send data to the clients. This makes the client have to
</I>&gt;<i>  connect to the server initially though a port using reactor.connectTCP()
</I>&gt;<i>  and listen to a port (that the server now knows since the client
</I>&gt;<i>  registered itself) using reactor.listenTCP().
</I>
This is might be a bad idea - depending on the locality of your
servers and clients. Why not just use the established connection?  If
the *client* is listening on a port then it isn't just a client - it's
a server, or a peer in a clustered system.

&gt;<i>  I think I have to use
</I>&gt;<i>  reactor.connectTCP() instead of  ClientCreator since the connection has
</I>&gt;<i>  to happen at the beginning and a transport needs to exist before I can
</I>&gt;<i>  send anything. Well...now that I think about it, I could have the
</I>&gt;<i>  factory register the client...... that would make me not have to inherit
</I>&gt;<i>  from the Client factory.... (I've now switched to solution 2, see last
</I>&gt;<i>  part of this email).
</I>&gt;<i>
</I>
Ok.

&gt;<i> &gt; In most use cases you shouldn't have to create custom factories.
</I>&gt;<i>  I have to since I need a non-reconnecting client xmlstream, and the
</I>&gt;<i>  factory used with xmlstreams is a reconnecting client.
</I>&gt;<i>
</I>&gt;<i> &gt; Just
</I>&gt;<i>  &gt; write the protocol to support bidirectional comm and to create the
</I>&gt;<i>  &gt; server:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; f = Factory()
</I>&gt;<i>  &gt; f.protocol = YourBidirectionalProtocol
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Regarding the client, how you implement it depends on whether or not
</I>&gt;<i>  &gt; the server is establishing the connection vs. reusing the existing
</I>&gt;<i>  &gt; connection.
</I>&gt;<i>  What exactly do you mean by reusing an existing connection?
</I>&gt;<i>
</I>&gt;<i> &gt; If you're establishing the connection (like in a cluster
</I>&gt;<i>  &gt; app with known peers), just use ClientCreator.  If you're reusing the
</I>&gt;<i>  &gt; existing connection, then you might not have to anything, unless you
</I>&gt;<i>  &gt; have some state to set up which could be done by overriding
</I>&gt;<i>  &gt; connectionMade on your Protocol.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Finally, take everything I've stated above with a grain of salt.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  Thanks, I find it fairly hard to get used to Twisted, I wanted to buy
</I>&gt;<i>  the book, but it was written in 2005 and I'm not sure if it's still
</I>&gt;<i>  valid with today's version.
</I>&gt;<i>
</I>
The book it is not up to date.

&gt;<i>  BTW, any idea why I'm getting this type of behavior (one server, 3
</I>&gt;<i>  distinct connections from clients) :
</I>&gt;<i>
</I>
Without seeing your code, no.

&gt;<i>  Daemon listening for connections...
</I>&gt;<i>
</I>&gt;<i>  daemon proto instance 1
</I>&gt;<i>  Connection from 127.0.0.1:57821! &lt;-- ok, Client1
</I>&gt;<i>  ....
</I>&gt;<i>  daemon proto instance 2
</I>&gt;<i>  Connection from 127.0.0.1:57821! &lt;-- Client1 again????? why?
</I>&gt;<i>  Connection from 127.0.0.1:57823! &lt;-- ok, Client2
</I>&gt;<i>  ....
</I>&gt;<i>  daemon proto instance 3
</I>&gt;<i>  Connection from 127.0.0.1:57821! &lt;-- ok, Client1 again????? why?
</I>&gt;<i>  Connection from 127.0.0.1:57823! &lt;-- ok, Client2 again????? why?
</I>&gt;<i>  Connection from 127.0.0.1:57824! &lt;-- ok, Client3
</I>&gt;<i>
</I>&gt;<i>  Oh, and by the time I finished writing this email, I've switched to
</I>&gt;<i>  solution 2, but I still get the  behavior above.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  _______________________________________________
</I>&gt;<i>  Twisted-Python mailing list
</I>&gt;<i>  <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i>  <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


-- 
\\\\\/\&quot;/\\\\\\\\\\\
\\\\/ // //\/\\\\\\\
\\\/  \\// /\ \/\\\\
\\/ /\/ / /\/ /\ \\\
\/ / /\/ /\  /\\\ \\
/ /\\\  /\\\ \\\\\/\
\/\\\\\/\\\\\/\\\\\\
               d.p.s


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016913.html">[Twisted-Python] Factory question
</A></li>
	<LI>Next message: <A HREF="016915.html">[Twisted-Python] Factory question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16914">[ date ]</a>
              <a href="thread.html#16914">[ thread ]</a>
              <a href="subject.html#16914">[ subject ]</a>
              <a href="author.html#16914">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
