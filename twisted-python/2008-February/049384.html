<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Throttling a web2 server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Throttling%20a%20web2%20server&In-Reply-To=%3Cf4438a6a0802261841p3bbc2a18p41030dbec102e66a%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049380.html">
   <LINK REL="Next"  HREF="049386.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Throttling a web2 server</H1>
    <B>Cameron Dale</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Throttling%20a%20web2%20server&In-Reply-To=%3Cf4438a6a0802261841p3bbc2a18p41030dbec102e66a%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Throttling a web2 server">camrdale at gmail.com
       </A><BR>
    <I>Tue Feb 26 19:41:47 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049380.html">[Twisted-Python] Throttling a web2 server
</A></li>
        <LI>Next message (by thread): <A HREF="049386.html">[Twisted-Python] Throttling a web2 server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49384">[ date ]</a>
              <a href="thread.html#49384">[ thread ]</a>
              <a href="subject.html#49384">[ subject ]</a>
              <a href="author.html#49384">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/26/08, Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; wrote:
&gt;<i> On Tue, 26 Feb 2008 12:12:22 -0800, Cameron Dale &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">camrdale at gmail.com</A>&gt; wrote:
</I>&gt;<i>  &gt;The trouble I'm having is that the ThrottlingFactory doesn't throttle
</I>&gt;<i>  &gt;the server at all. I've traced the output, and it seems to be due to
</I>&gt;<i>  &gt;the twisted.internet.tcp.Server also calling the pauseProducing() and
</I>&gt;<i>  &gt;resumeProducing() methods of the producer.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;The way the ThrottlingFactory works, is that it schedules periodic
</I>&gt;<i>  &gt;checks of the number of bytes written using reactor.callLater. If too
</I>&gt;<i>  &gt;many bytes have been written, then the producer is paused. However,
</I>&gt;<i>  &gt;these periodic checks always occur when the producer is already paused
</I>&gt;<i>  &gt;by the twisted.internet.tcp.Server, and so have no effect. Later the
</I>&gt;<i>  &gt;producer is resumed by the twisted.internet.tcp.Server, and so the
</I>&gt;<i>  &gt;throttling is non-existent.
</I>&gt;<i>
</I>&gt;<i> Yes.  It would be good if ThrottlingFactory were fixed.  Would you like
</I>&gt;<i>  to fix it? :)
</I>
I will have to do something as throttling is needed, but I'm just not
sure how to go about it. Do you have an idea of how it could be fixed?

The ThrottlingFactory methodology would seem to be broken and unusable
due to this behaviour. The only workaround I can think of is to modify
the push producer to keep a tally of the number of pauses received,
and only resume when it gets back to 0. That obviously requires
modifying the underlying producer, and is far from ideal as I believe
the pauseProducing() call is expected to be idempotent.

Or perhaps the ThrottlingFactory should create a dummy producer that
gets data from the real producer, but then throttles it before sending
it out to the twisted.internet.tcp.Server. That is complicated by the
fact that the producer would not be available to be modified by the
factory before it is passed to the Server, so exchanging it for the
dummy producer would also be a problem.

So, are there any other ideas of how throttling can be accomplished
with Twisted? I'm sure someone must have used throttling at some
point.

Thanks,
Cameron


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049380.html">[Twisted-Python] Throttling a web2 server
</A></li>
	<LI>Next message (by thread): <A HREF="049386.html">[Twisted-Python] Throttling a web2 server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49384">[ date ]</a>
              <a href="thread.html#49384">[ thread ]</a>
              <a href="subject.html#49384">[ subject ]</a>
              <a href="author.html#49384">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
