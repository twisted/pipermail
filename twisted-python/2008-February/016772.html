<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted and python-ogre 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20and%20python-ogre%20&In-Reply-To=47B45F0E.6030307%40student.ecp.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016771.html">
   <LINK REL="Next"  HREF="016775.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted and python-ogre </H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20and%20python-ogre%20&In-Reply-To=47B45F0E.6030307%40student.ecp.fr"
       TITLE="[Twisted-Python] Twisted and python-ogre ">exarkun at divmod.com
       </A><BR>
    <I>Thu Feb 14 11:01:58 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016771.html">[Twisted-Python] Twisted and python-ogre 
</A></li>
        <LI>Next message: <A HREF="016775.html">[Twisted-Python] Re: Twisted and python-ogre
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16772">[ date ]</a>
              <a href="thread.html#16772">[ thread ]</a>
              <a href="subject.html#16772">[ subject ]</a>
              <a href="author.html#16772">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 14 Feb 2008 16:32:30 +0100, Thomas Boucher &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">thomas.boucher at student.ecp.fr</A>&gt; wrote:
&gt;<i>Hello,
</I>&gt;<i>
</I>&gt;<i>I am currently part of a MMORPG project in python, using Twisted
</I>&gt;<i>and python-ogre. I found some posts talking about the cohabitation between 
</I>&gt;<i>the two. However I couldn't find a definitive answer. What I am seeking for 
</I>&gt;<i>is more a general method than technical details.
</I>&gt;<i>
</I>&gt;<i>What I would like to do is to put properly Twisted and python-ogre
</I>&gt;<i>together. To do that I have already tried the following ways :
</I>&gt;<i>
</I>&gt;<i>  - First run python-ogre in the main loop. At a time, this loop launches
</I>&gt;<i>the twisted reactor in another thread with Thread(target =
</I>&gt;<i>sthg_which_runs_reactor.run).
</I>&gt;<i>The problem I am experiencing is described here [1]. The sendLine method
</I>&gt;<i>is executed immediately, but the data is received by the other side only
</I>&gt;<i>20/30 seconds after.
</I>
Chris Armstrong's response to the post you refer to is accurate.  Twisted
APIs are not threadsafe.  In order to call them from a thread other than
the one in which the reactor is running, it is absolutely required that you
use reactor.callFromThread.  This is quite simple.  Instead of:

    proto.sendLine(&quot;line&quot;)

Simple do:

    reactor.callFromThread(proto.sendLine, &quot;line&quot;)

You will have to do this for every call you make to a Twisted API (except
for reactor.callFromThread, of course ;).

Since this is quite inconvenient, inefficient, and error prone, it's best
if you keep the interaction between different threads to the barest minumum
you can manage.

&gt;<i>
</I>&gt;<i>  - So I tried not to run Twisted in another thread, by using the way
</I>&gt;<i>described here [2]. Twisted is given the main loop and the
</I>&gt;<i>rendering is done frame by frame with the coiterate. It works sometimes,
</I>&gt;<i>the renderOneFrame in the coiterration is not really working.
</I>&gt;<i>
</I>
What do you mean &quot;not really working&quot;?

&gt;<i>
</I>&gt;<i>But it seems more logical to run ptyhon-ogre in the main loop and
</I>&gt;<i>twisted on the side (in another thread for example, as soon as the client 
</I>&gt;<i>has decided to connect to the server). Have you any ideas how I could do 
</I>&gt;<i>this properly (with threads, without threads, with the coiterrate ...)?
</I>
The best solution would be to really integrate the two loops.  I don't know
the details of OGRE though, so I can't tell you specifically how to do this.
It is tightly dependent on the details of the loops being integrated.

&gt;<i>
</I>&gt;<i>If Twisted was originally made for MMORPGs, why the reactor wants so much to 
</I>&gt;<i>be in the main loop and to manage itself the other threads (with 
</I>&gt;<i>callInThread for example)?
</I>&gt;<i>
</I>
Because most other event loops are very bad at managing events. :)  If you
want reasonable network performance, you need a good network event loop to
be in control.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016771.html">[Twisted-Python] Twisted and python-ogre 
</A></li>
	<LI>Next message: <A HREF="016775.html">[Twisted-Python] Re: Twisted and python-ogre
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16772">[ date ]</a>
              <a href="thread.html#16772">[ thread ]</a>
              <a href="subject.html#16772">[ subject ]</a>
              <a href="author.html#16772">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
