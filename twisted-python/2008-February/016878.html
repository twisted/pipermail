<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Throttling a web2 server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Throttling%20a%20web2%20server&In-Reply-To=20080226211703.6859.1386486097.divmod.quotient.13619%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016876.html">
   <LINK REL="Next"  HREF="016884.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Throttling a web2 server</H1>
    <B>Cameron Dale</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Throttling%20a%20web2%20server&In-Reply-To=20080226211703.6859.1386486097.divmod.quotient.13619%40ohm"
       TITLE="[Twisted-Python] Throttling a web2 server">camrdale at gmail.com
       </A><BR>
    <I>Wed Feb 27 02:20:17 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016876.html">[Twisted-Python] Throttling a web2 server
</A></li>
        <LI>Next message: <A HREF="016884.html">[Twisted-Python] Throttling a web2 server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16878">[ date ]</a>
              <a href="thread.html#16878">[ thread ]</a>
              <a href="subject.html#16878">[ subject ]</a>
              <a href="author.html#16878">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/26/08, Jean-Paul Calderone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; wrote:
&gt;<i> Yes.  It would be good if ThrottlingFactory were fixed.  Would you like
</I>&gt;<i>  to fix it? :)
</I>
Well, I took a stab at fixing it. Attached is my first attempt, as a
patch against the current SVN version. I only fixed the write
throttling, as that's the one I'm interested in. A similar technique
may work for reads as well.

It does throttle correctly, by buffering any throttled packets and
pausing the producer. If the Sever then unpauses the producer, it will
only result in an extra packet being buffered. I also implemented a
protocol queue so that the producers are all given a fair portion of
the bandwidth.

The only thing it requires currently is that the producers don't try
and write too large of a piece of data at once. I had to modify the
twisted.web2.stream.FileSream slightly to make it do this, as
otherwise it would 'stream' the entire file in one write() request. In
theory, a single large write could be chunked and buffered, but that
would add a lot of memory overhead to the buffering.

Anyway, I'm sure it's not great, but I'd appreciate any feedback,
especially on how I could make it better. :)

Thanks,
Cameron
-------------- next part --------------
A non-text attachment was scrubbed...
Name: policies.py.patch
Type: text/x-diff
Size: 7324 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20080226/1b95844b/attachment.patch">http://twistedmatrix.com/pipermail/twisted-python/attachments/20080226/1b95844b/attachment.patch</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016876.html">[Twisted-Python] Throttling a web2 server
</A></li>
	<LI>Next message: <A HREF="016884.html">[Twisted-Python] Throttling a web2 server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16878">[ date ]</a>
              <a href="thread.html#16878">[ thread ]</a>
              <a href="subject.html#16878">[ subject ]</a>
              <a href="author.html#16878">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
