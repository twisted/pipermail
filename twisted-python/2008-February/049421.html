<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Factory question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Factory%20question&In-Reply-To=%3C47C6C838.4020308%40evotex.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049402.html">
   <LINK REL="Next"  HREF="049422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Factory question</H1>
    <B>Gabriel Rossetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Factory%20question&In-Reply-To=%3C47C6C838.4020308%40evotex.ch%3E"
       TITLE="[Twisted-Python] Factory question">mailing_lists at evotex.ch
       </A><BR>
    <I>Thu Feb 28 07:42:00 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049402.html">[Twisted-Python] Factory question
</A></li>
        <LI>Next message (by thread): <A HREF="049422.html">[Twisted-Python] Factory question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49421">[ date ]</a>
              <a href="thread.html#49421">[ thread ]</a>
              <a href="subject.html#49421">[ subject ]</a>
              <a href="author.html#49421">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Drew Smathers wrote:
&gt;<i> On Wed, Feb 27, 2008 at 3:32 AM, Gabriel Rossetti
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mailing_lists at evotex.ch</A>&gt; wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> Hello everyone,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  I have a small question, I have a service which needs to sometimes send
</I>&gt;&gt;<i>  data (without having received any prior to sending) and sometimes
</I>&gt;&gt;<i>  receive data, which is better :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  1) create a factory that inherits from ServerFactory and ClientFactory,
</I>&gt;&gt;<i>  thus it can listen and send data
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  2) create a factory that inherits from ServerFactory only and uses a
</I>&gt;&gt;<i>  single-use client (ClientCreator, as shown in the writing clients howto)
</I>&gt;&gt;<i>  when it needs to send data
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> I'm not sure of there's a single right way to do it, but I wouldn't
</I>&gt;<i> bother inheriting from both ClientFactory and ServerFactory.  I think
</I>&gt;<i> you're on the write track with 2, though.
</I>&gt;<i>
</I>&gt;<i>   
</I>I had taken route 1 up until now (I'm thinking about switching...)

Maybe there's something I haven't quite gotten, when ClientA initially 
connects to the server, the factory creates an instance of the protocol, 
correct? Now ClientA sends some data to the server, which processes it 
and sends something back. After that, the TCP session ends, and the 
client disconnects, and the protocols instance dies. Is this correct or 
does it live on and get reused somehow? I ask this because since 
initially the clients send data to the server (registration), the server 
will there after send data to the clients. This makes the client have to 
connect to the server initially though a port using reactor.connectTCP() 
and listen to a port (that the server now knows since the client 
registered itself) using reactor.listenTCP(). I think I have to use 
reactor.connectTCP() instead of  ClientCreator since the connection has 
to happen at the beginning and a transport needs to exist before I can 
send anything. Well...now that I think about it, I could have the 
factory register the client...... that would make me not have to inherit 
from the Client factory.... (I've now switched to solution 2, see last 
part of this email).
&gt;<i> In most use cases you shouldn't have to create custom factories.  
</I>I have to since I need a non-reconnecting client xmlstream, and the 
factory used with xmlstreams is a reconnecting client.
&gt;<i> Just
</I>&gt;<i> write the protocol to support bidirectional comm and to create the
</I>&gt;<i> server:
</I>&gt;<i>
</I>&gt;<i> f = Factory()
</I>&gt;<i> f.protocol = YourBidirectionalProtocol
</I>&gt;<i>
</I>&gt;<i> Regarding the client, how you implement it depends on whether or not
</I>&gt;<i> the server is establishing the connection vs. reusing the existing
</I>&gt;<i> connection.  
</I>What exactly do you mean by reusing an existing connection?
&gt;<i> If you're establishing the connection (like in a cluster
</I>&gt;<i> app with known peers), just use ClientCreator.  If you're reusing the
</I>&gt;<i> existing connection, then you might not have to anything, unless you
</I>&gt;<i> have some state to set up which could be done by overriding
</I>&gt;<i> connectionMade on your Protocol.
</I>&gt;<i>
</I>&gt;<i> Finally, take everything I've stated above with a grain of salt.
</I>&gt;<i>
</I>&gt;<i>   
</I>Thanks, I find it fairly hard to get used to Twisted, I wanted to buy 
the book, but it was written in 2005 and I'm not sure if it's still 
valid with today's version.

BTW, any idea why I'm getting this type of behavior (one server, 3 
distinct connections from clients) :

Daemon listening for connections...

daemon proto instance 1
Connection from 127.0.0.1:57821! &lt;-- ok, Client1
....
daemon proto instance 2
Connection from 127.0.0.1:57821! &lt;-- Client1 again????? why?
Connection from 127.0.0.1:57823! &lt;-- ok, Client2
....
daemon proto instance 3
Connection from 127.0.0.1:57821! &lt;-- ok, Client1 again????? why?
Connection from 127.0.0.1:57823! &lt;-- ok, Client2 again????? why?
Connection from 127.0.0.1:57824! &lt;-- ok, Client3

Oh, and by the time I finished writing this email, I've switched to 
solution 2, but I still get the  behavior above.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049402.html">[Twisted-Python] Factory question
</A></li>
	<LI>Next message (by thread): <A HREF="049422.html">[Twisted-Python] Factory question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49421">[ date ]</a>
              <a href="thread.html#49421">[ thread ]</a>
              <a href="subject.html#49421">[ subject ]</a>
              <a href="author.html#49421">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
