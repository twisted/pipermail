<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] using conch to create a &quot;chrooted&quot; sftp server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20using%20conch%20to%20create%20a%20%22chrooted%22%20sftp%20server&In-Reply-To=%3C324cfb540802121446x1e197b3et5278261609808089%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049244.html">
   <LINK REL="Next"  HREF="049246.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] using conch to create a &quot;chrooted&quot; sftp server</H1>
    <B>Paul Swartz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20using%20conch%20to%20create%20a%20%22chrooted%22%20sftp%20server&In-Reply-To=%3C324cfb540802121446x1e197b3et5278261609808089%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] using conch to create a &quot;chrooted&quot; sftp server">paulswartz at gmail.com
       </A><BR>
    <I>Tue Feb 12 15:46:06 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049244.html">[Twisted-Python] using conch to create a &quot;chrooted&quot; sftp server
</A></li>
        <LI>Next message (by thread): <A HREF="049246.html">[Twisted-Python] simple tcpgate in Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49267">[ date ]</a>
              <a href="thread.html#49267">[ thread ]</a>
              <a href="subject.html#49267">[ subject ]</a>
              <a href="author.html#49267">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 4, 2008 at 10:19 PM,  &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>  I'd like to provide file-server access on my home network to a machine
</I>&gt;<i>  which hosts a variety of media, without exposing its entire filesystem.
</I>&gt;<i>  OpenSSH's sftp-server doesn't allow this, so of course I thought, I
</I>&gt;<i>  should use conch.
</I>&gt;<i>
</I>&gt;<i>  Completely replacing OpenSSH with Conch is inconvenient, however, and it
</I>&gt;<i>  is my only means to administer these machines, so both for the sake of
</I>&gt;<i>  easy packaging and making sure I don't make a mistake, I'd really like
</I>&gt;<i>  to keep the main SSH daemon in place but replace the sftp channel.
</I>&gt;<i>
</I>&gt;<i>  I *think* that means I'd need to do something with sshd_config,
</I>&gt;<i>  twisted.conch.ssh.filetransfer, and twisted.internet.stdio.  However,
</I>&gt;<i>  I'm a bit at a loss what that thing would be.
</I>
On the OpenSSH side, you'll want to change the 'Subsystem sftp
/usr/lib/openssh/sftp-server' line in /etc/ssh/sshd_config (on
Debian/Ubuntu) to some script that you write.

On the Twisted side, you'll want to connect
twisted.conch.ssh.filetransfer.FileTransferServer to
twisted.internet.stdio.StandardIO.  You'll have to create your own
avatar based on the current user and pass that to the constructor.

&gt;<i>  Can someone with stronger conch-fu than I give a brief description of
</I>&gt;<i>  how this could be done?  Ideally, I'd like some users (myself) to be
</I>&gt;<i>  able to access the entire filesystem, but others (the &quot;storage&quot; user,
</I>&gt;<i>  who has no shell) to only be able to access /public.  Finally I'd like
</I>&gt;<i>  the &quot;guest&quot; user to be able to access /public, but read-only, and
</I>&gt;<i>  /public/drop-box read-write.  I don't mind setting up UNIX permissions
</I>&gt;<i>  to enforce that last bit.
</I>
You'll probably want to hack up
twisted.conch.unix.SFTPServerForUnixConchUser to do that.  It's an
adapter for whatever the avatar passed to FileTransferServer is to
ISFTPServer, and FileTransferServer calls the methods on that to
implement the actual file mechanics.

hth,
-p
-- 
Paul Swartz
paulswartz at gmail dot com
<A HREF="http://z3p.jot.com/">http://z3p.jot.com/</A>
AIM: z3penguin


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049244.html">[Twisted-Python] using conch to create a &quot;chrooted&quot; sftp server
</A></li>
	<LI>Next message (by thread): <A HREF="049246.html">[Twisted-Python] simple tcpgate in Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49267">[ date ]</a>
              <a href="thread.html#49267">[ thread ]</a>
              <a href="subject.html#49267">[ subject ]</a>
              <a href="author.html#49267">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
