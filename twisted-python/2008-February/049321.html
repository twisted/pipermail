<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Help using XmlStreamFactory &amp; XmlStream	:	XPathQuery error?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Help%20using%20XmlStreamFactory%20%26%20XmlStream%0A%09%3A%09XPathQuery%20error%3F&In-Reply-To=%3C1203503377.8278.14.camel%40localhost%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049320.html">
   <LINK REL="Next"  HREF="049323.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Help using XmlStreamFactory &amp; XmlStream	:	XPathQuery error?</H1>
    <B>Ralph Meijer</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Help%20using%20XmlStreamFactory%20%26%20XmlStream%0A%09%3A%09XPathQuery%20error%3F&In-Reply-To=%3C1203503377.8278.14.camel%40localhost%3E"
       TITLE="[Twisted-Python] Help using XmlStreamFactory &amp; XmlStream	:	XPathQuery error?">twisted at ralphm.ik.nu
       </A><BR>
    <I>Wed Feb 20 03:29:37 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049320.html">[Twisted-Python] Help using XmlStreamFactory &amp; XmlStream	:	XPathQuery error?
</A></li>
        <LI>Next message (by thread): <A HREF="049323.html">[Twisted-Python] Help using XmlStreamFactory &amp;	XmlStream	:	XPathQuery error?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49321">[ date ]</a>
              <a href="thread.html#49321">[ thread ]</a>
              <a href="subject.html#49321">[ subject ]</a>
              <a href="author.html#49321">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Wed, 2008-02-20 at 10:36 +0100, Gabriel Rossetti wrote:
&gt;<i> [..]
</I>&gt;<i>
</I>&gt;<i> I'm having some trouble with the XPath I think when trying to react on 
</I>&gt;<i> xml messages. I am feeding the twisted.words.xish.xmlstream.XmlStream 
</I>&gt;<i> the following :
</I>&gt;<i> 
</I>&gt;<i>     &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
</I>&gt;<i>     &lt;test&gt;&lt;feed name='monNom'&gt;toto&lt;/feed&gt;&lt;/test&gt;
</I>&gt;<i> 
</I>&gt;<i> and the callback functions are :
</I>&gt;<i> 
</I>&gt;<i>     def onTest(self, element):
</I>&gt;<i>         print &quot;got test : &quot;, element
</I>&gt;<i> 
</I>&gt;<i>     def onFeed(self, element):
</I>&gt;<i>         print &quot;got feed : &quot;, element
</I>&gt;<i> 
</I>&gt;<i>     def onFeedFilteredByName(self, element):
</I>&gt;<i>         print &quot;got feed name : &quot;, element
</I>&gt;<i> 
</I>&gt;<i>     def onWildcard(self, element):
</I>&gt;<i>         print &quot;got wildcard : &quot;, element
</I>&gt;<i> 
</I>&gt;<i> and the bootstrap is added like so :
</I>&gt;<i> 
</I>&gt;<i>     f.addBootstrap(xmlstream.STREAM_START_EVENT, connected)
</I>&gt;<i> 
</I>&gt;<i> and the bootstrap callback is :
</I>&gt;<i> 
</I>&gt;<i>     def connected(self, xs):
</I>&gt;<i>         print 'Connected!'
</I>&gt;<i>         xs.addObserver(&quot;/test&quot;, self.onTest)
</I>&gt;<i>         xs.addObserver(&quot;/test/feed&quot;, self.onFeed)
</I>&gt;<i>         xs.addObserver(&quot;/test/feed[@name]&quot;, self.onFeedFilteredByName)
</I>&gt;<i>         xs.addObserver(&quot;/*&quot;, self.onWildcard)
</I>&gt;<i> 
</I>&gt;<i> The only one that gets called is &quot;/*&quot;. I tested out the others using 
</I>&gt;<i> XPathQuery manually with :
</I>&gt;<i> 
</I>&gt;<i>     xpath.XPathQuery(&quot;//feed[@name]&quot;).queryForNodes(root)[0]
</I>&gt;<i> 
</I>&gt;<i> root being the above xml, and they work, I can even get the attributes 
</I>&gt;<i> (which is what  I really need to get) like so :
</I>&gt;<i> 
</I>&gt;<i>     
</I>&gt;<i> xpath.XPathQuery(&quot;//feed[@name]&quot;).queryForNodes(root)[0].getAttribute(&quot;name&quot;)
</I>&gt;<i> 
</I>&gt;<i> What am I doing wrong when adding observers? How can I get them to react 
</I>&gt;<i> on attribute names too?
</I>
Hi,

A somewhat lengthy explanation follows,

XML Streams are a result of the work on Jabber. As such, the generalized
version of XmlStream in xish works similarly, but without the Jabber
specifics in terms of namespaces and elements. However, the concept
behind XML Streams is that you open the stream with a root element, and
after that the units of exchange are the first-level childs of that root
element, or so-called XML Stanzas.

EventDispatcher, a superclass of XmlStream, is responsible for calling
back observers upon calls to its dispatch method. For each XML Stanza,
XmlStream will dispatch the DOM object at the root of that snippet of
XML (domish.Element) for the XML Stanza. Observers are registered to
XPath (-like) queries to match those Elements.

Now that's out of the way, in your specific example, the &lt;feed/&gt; element
would be an XML Stanza. So you can only register an observer to that,
like this:

   xs.addObserver('/feed', self.onFeed)

If some &lt;feed/&gt;'s would have child &lt;title/&gt;, you could add an observer
on just those &lt;feed/&gt;'s with a title like this:

   xs.addObserver('/feed/title', self.onFeedWithTitle)

The observer would still get the whole &lt;feed/&gt; element passed. So, to be
clear: the XPath-like queries are for matching against XML Stanzas, and
each XML Stanza that matches is then passed to the callbacks registered
to that query.

For completeness, ff you want to hook up an event to the start tag of
the root element having been received, you'd do this:

  xs.addObserver(STREAM_START_EVENT, self.onTest)

In that case, you need to do change the bootstrap registration to this:

  f.addBootstrap(xmlstream.STREAM_CONNECTED_EVENT, connected)

Hope that clears some things up.

-- 
Groetjes,

ralphm



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049320.html">[Twisted-Python] Help using XmlStreamFactory &amp; XmlStream	:	XPathQuery error?
</A></li>
	<LI>Next message (by thread): <A HREF="049323.html">[Twisted-Python] Help using XmlStreamFactory &amp;	XmlStream	:	XPathQuery error?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49321">[ date ]</a>
              <a href="thread.html#49321">[ thread ]</a>
              <a href="subject.html#49321">[ subject ]</a>
              <a href="author.html#49321">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
