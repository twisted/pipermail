<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted and python-ogre
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20and%20python-ogre&In-Reply-To=%3C20080215142557.6859.1357815474.divmod.quotient.9847%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049284.html">
   <LINK REL="Next"  HREF="049292.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted and python-ogre</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20and%20python-ogre&In-Reply-To=%3C20080215142557.6859.1357815474.divmod.quotient.9847%40ohm%3E"
       TITLE="[Twisted-Python] Twisted and python-ogre">exarkun at divmod.com
       </A><BR>
    <I>Fri Feb 15 07:25:57 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049284.html">[Twisted-Python] Twisted and python-ogre
</A></li>
        <LI>Next message (by thread): <A HREF="049292.html">[Twisted-Python] Re: Twisted and python-ogre
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49285">[ date ]</a>
              <a href="thread.html#49285">[ thread ]</a>
              <a href="subject.html#49285">[ subject ]</a>
              <a href="author.html#49285">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 15 Feb 2008 15:01:21 +0100, Thomas Boucher &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">thomas.boucher at student.ecp.fr</A>&gt; wrote:
&gt;<i>Jean-Paul Calderone a Ã©crit :
</I>&gt;&gt;<i>Chris Armstrong's response to the post you refer to is accurate.  Twisted
</I>&gt;&gt;<i>APIs are not threadsafe.  In order to call them from a thread other than
</I>&gt;&gt;<i>the one in which the reactor is running, it is absolutely required that you
</I>&gt;&gt;<i>use reactor.callFromThread.  This is quite simple.  Instead of:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    proto.sendLine(&quot;line&quot;)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Simple do:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    reactor.callFromThread(proto.sendLine, &quot;line&quot;)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>You will have to do this for every call you make to a Twisted API (except
</I>&gt;&gt;<i>for reactor.callFromThread, of course ;).
</I>&gt;<i>
</I>&gt;<i>I have just tried this method, and it perfectly works.
</I>&gt;<i>The twisted reactor is run in another thread and the calls to Twisted are 
</I>&gt;<i>managed by the callFromThread method. The main advantage I see to it 
</I>&gt;<i>(excepting the fact that it works) is that it does not require changes in 
</I>&gt;<i>the way the graphic rendering is done : you do not care about how python- 
</I>&gt;<i>ogre runs to code the twisted part.
</I>&gt;&gt;<i>The best solution would be to really integrate the two loops.  I don't know
</I>&gt;&gt;<i>the details of OGRE though, so I can't tell you specifically how to do 
</I>&gt;&gt;<i>this.
</I>&gt;&gt;<i>It is tightly dependent on the details of the loops being integrated.
</I>&gt;<i>
</I>&gt;<i>What I can't see for the moment is how much better it would be to do like 
</I>&gt;<i>the other ways delivered in the discussion thread (by Werner, Bernie an 
</I>&gt;<i>Stefan). These ways consist in running Twisted first and in letting it 
</I>&gt;<i>manage python-ogre (by doing the rendering frame by frame with coiteration, 
</I>&gt;<i>or loopingcalls).
</I>&gt;<i>Is this better than doing separate threads ?
</I>
There are arguments about efficiency.  Using threads has overhead which is
not present when not using threads.  These arguments are probably not very
convincing in this case, since you would only have two threads and their
overhead will be dwarfed by your rendering costs.  You should be aware that
reactor.callFromThread _does_ have some non-trivial overhead.  Using it for
each sendLine call _could_ have a noticable detrimental impact on your app's
performance.

There are arguments about simplicity.  It's harder to understand what a
multithreaded program is doing.  It's harder to debug a multithreaded
program.  It's very, very hard to unit test a multithreaded program.  This
is probably the compelling argument to try to avoid threads.

&gt;&gt;<i>Because most other event loops are very bad at managing events. :)  If you
</I>&gt;&gt;<i>want reasonable network performance, you need a good network event loop to
</I>&gt;&gt;<i>be in control.
</I>&gt;<i>
</I>&gt;<i>Don't you think using basic sockets (easy to code in Python) to make the 
</I>&gt;<i>network connection from a client to a server is more efficient (considering 
</I>&gt;<i>the time spent to do it or the complexity of the code) and more easy to keep 
</I>&gt;<i>in a project ?
</I>
That might be nice.  However, almost without exception, the network code I
read which does not use Twisted is buggy in the most trivial ways.  It is
rare for it to take more than a cursory glance to notice critical bugs
(the sort which will result in data being lost).  Of course, this doesn't
mean that all network code written without Twisted is fatally flawed, but
it does give me a reasonable basis to assume that it will have issues. :)

Twisted's APIs aren't just easier to use correctly than the BSD socket APIs,
they're also consistent across platforms.  Are you sure you know the BSD
APIs well enough to write some that is correct on Linux and on Windows?
(Let alone on OS X or FreeBSD)  Even if you are, would you rather spend your
time writing the error handling logic for each of these platforms or adding
features to your game?

Twisted may seems to be harder than the socket module.  It probably does
have a higher up-front cost.  However, in the long run, I think that you'll
save yourself a lot of time using it rather than using sockets directly.

You also get the advantages which the structure Twisted attempts to impose
on your application confers.  For example, protocol/transport separation
means that you can unit test your protocol implementation very easily.  And
that's assuming you even need to implement your own protocol, rather than
using one of the protocols Twisted already includes an implementation of.

You also leave open the possibility of easily taking advantage of some other
Twisted features which don't seem useful now but which you may benefit from
later in development.

Hope this helps,

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049284.html">[Twisted-Python] Twisted and python-ogre
</A></li>
	<LI>Next message (by thread): <A HREF="049292.html">[Twisted-Python] Re: Twisted and python-ogre
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49285">[ date ]</a>
              <a href="thread.html#49285">[ thread ]</a>
              <a href="subject.html#49285">[ subject ]</a>
              <a href="author.html#49285">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
