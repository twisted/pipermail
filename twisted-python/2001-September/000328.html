<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Another tcp.Client question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Another%20tcp.Client%20question&In-Reply-To=007001c13402%24a6129860%24bdc5d9c1%40phed">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000325.html">
   <LINK REL="Next"  HREF="000318.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Another tcp.Client question</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Another%20tcp.Client%20question&In-Reply-To=007001c13402%24a6129860%24bdc5d9c1%40phed"
       TITLE="[Twisted-Python] Another tcp.Client question">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Sep  3 02:01:16 EDT 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="000325.html">[Twisted-Python] Another tcp.Client question
</A></li>
        <LI>Next message: <A HREF="000318.html">[Twisted-Python] Another tcp.Client question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#328">[ date ]</a>
              <a href="thread.html#328">[ thread ]</a>
              <a href="subject.html#328">[ subject ]</a>
              <a href="author.html#328">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Sep 03, 2001 at 12:57:31AM +0200, Benjamin Bruheim wrote:
&gt;<i> yes, it shall accept one connection, and after the transfer is done, it shall
</I>&gt;<i> close the connection (and in this way tell the user that the transfer is
</I>&gt;<i> done). it shall let the tcp time-out, and that's why we change the port; less
</I>&gt;<i> time is wasted between each new file. I am thinking of letting the user
</I>&gt;<i> define a range of ports, and cycle through that instead of using port 0.
</I>
OK.  That isn't really happening.  :-)

&gt;<i> &gt; You have committed it.  Still: I see no loseConnection being called on a
</I>&gt;<i> &gt; *Port*, only on a *Server*, which is a connection that got accepted from a
</I>&gt;<i> &gt; port.
</I>&gt;<i> 
</I>&gt;<i> Isn't 'self.dtpPort = tcp.Port(0, self)' a Port?
</I>
Yes.

&gt;<i> self.dtp.transport is self.dtpPort,
</I>
No.

&gt;<i> and its method loseConnection is used.
</I>
Yes, for some values of &quot;its&quot; :-)

&gt;<i> Besides, isn't Port the same as a server?
</I>
No.

Here's the deal -- tcp.Port creates a _listening socket on a port_.  That
_listening socket on a Port_ creates a _Server connection_; the class Server
represents the byte-stream connection socket, the class Port represents the
listening on a port socket.  Servers are created by a Port.

self.dtp.transport is a twisted.internet.tcp.Server; self.dtpPort is a
twisted.internet.tcp.Port (repr 'em sometime ^_^).  Both must have their
connections lost, at different points.

Port.loseConnection() will cause the socket to stop listening.
Server.loseConnection() will cause that particular connection to be closed.
Port.loseConnection should probably happen in the buildProtocol method of your
ProtocolFactory, since it's explicitly only ever supposed to accept one
connection.

Does this make more sense?

&gt;<i> &gt; Yes, and my point is that, as far as I understand FTP, you *should* be
</I>&gt;<i> &gt; exercising that code.  I still don't understand why you're not.
</I>&gt;<i> 
</I>&gt;<i> Well, if I could. And how come nobody ever have run into that removeReader
</I>&gt;<i> with an NameError or something?
</I>
Itamar says he did, I think.  I sure did, when I tried it.  That particular
path of code was never exercised -- although hopefully it will be in FTP fairly
soon.  twisted.protocols.ftp was never calling it, only Server.loseConnection,
which is the source of most of your current troubles, I believe.


-- 
                      ______      __   __  _____  _     _
                     |  ____ |      \_/   |_____] |_____|
                     |_____| |_____  |    |       |     |
                     @ t w i s t e d m a t r i x  . c o m
                     <A HREF="http://twistedmatrix.com/users/glyph">http://twistedmatrix.com/users/glyph</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000325.html">[Twisted-Python] Another tcp.Client question
</A></li>
	<LI>Next message: <A HREF="000318.html">[Twisted-Python] Another tcp.Client question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#328">[ date ]</a>
              <a href="thread.html#328">[ thread ]</a>
              <a href="subject.html#328">[ subject ]</a>
              <a href="author.html#328">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
