<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Server not shutting down in Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Server%20not%20shutting%20down%20in%20Windows&In-Reply-To=%3C3B9D02FC.9090709%40itamarst.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="032865.html">
   <LINK REL="Next"  HREF="032869.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Server not shutting down in Windows</H1>
    <B>Itamar</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Server%20not%20shutting%20down%20in%20Windows&In-Reply-To=%3C3B9D02FC.9090709%40itamarst.org%3E"
       TITLE="[Twisted-Python] Server not shutting down in Windows">twisted at itamarst.org
       </A><BR>
    <I>Mon Sep 10 12:14:20 MDT 2001</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="032865.html">[Twisted-Python] twisted.wed.widgets and defer.Deferred() giving a list.
</A></li>
        <LI>Next message (by thread): <A HREF="032869.html">[Twisted-Python] UDP patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32866">[ date ]</a>
              <a href="thread.html#32866">[ thread ]</a>
              <a href="subject.html#32866">[ subject ]</a>
              <a href="author.html#32866">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

In windows 2000, threaded server, my server does nut shutdown when 
main.shutDown() is called. It seens that main.waker is the problem, 
since it is not removed from the list of readers registered with the 
event loop.

Does the following patch seem reasonable (someone better test on unix) 
or does someone have a better suggestion? It does seem to solve the problem:

Index: main.py
===================================================================
RCS file: /cvs/Twisted/twisted/internet/main.py,v
retrieving revision 1.23
diff -c -r1.23 main.py
*** main.py	2001/09/02 14:42:10	1.23
--- main.py	2001/09/10 18:19:29
***************
*** 198,203 ****
--- 198,204 ----
       &quot;&quot;&quot;
       global running
       if running:
+         removeReader(waker)
           running = 0
           log.msg('Starting Shutdown Sequence.')
           threadable.dispatcher.stop()





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="032865.html">[Twisted-Python] twisted.wed.widgets and defer.Deferred() giving a list.
</A></li>
	<LI>Next message (by thread): <A HREF="032869.html">[Twisted-Python] UDP patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32866">[ date ]</a>
              <a href="thread.html#32866">[ thread ]</a>
              <a href="subject.html#32866">[ subject ]</a>
              <a href="author.html#32866">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
