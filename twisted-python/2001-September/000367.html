<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Suggested API addition to threadtask
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Suggested%20API%20addition%20to%20threadtask&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000366.html">
   <LINK REL="Next"  HREF="000368.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Suggested API addition to threadtask</H1>
    <B>Itamar Shtull-Trauring</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Suggested%20API%20addition%20to%20threadtask&In-Reply-To="
       TITLE="[Twisted-Python] Suggested API addition to threadtask">lists at itamarst.org
       </A><BR>
    <I>Sun Sep 16 06:23:53 EDT 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="000366.html">[Twisted-Python] Twisted Jython
</A></li>
        <LI>Next message: <A HREF="000368.html">[Twisted-Python] Patterns in Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#367">[ date ]</a>
              <a href="thread.html#367">[ thread ]</a>
              <a href="subject.html#367">[ subject ]</a>
              <a href="author.html#367">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

Background:
internet.threadtask lets threads schedule tasks that are then executed by 
the main event loop (Active Object pattern).

Problem:
The results of these tasks are not returned to the threads, nor do the 
threads have any way of seeing if any exceptions were raised when doing the 
task. In most cases this is not an issue (e.g. writing data to a connection) 
but it is a problem with things like opening a new tcp.Client connection.

Suggested Solution:
Optionally allow returning a DeferredResult object when scheduling tasks, 
which can then be used to get the result (or exception) of the task when it 
is eventually executed by the event loop thread.

Example:
Notice how we can catch the exceptions raised by the scheduled task.

==================================================
def toInt(x):
    return int(x)

dresult = threadtask.scheduleWithResult(toInt, args=(&quot;23&quot;,))
if dresult.haveResult():
     try:
         result = dresult.get()
     except ValueError:
         print &quot;Not an integer&quot;
     else:
         print &quot;It's an integer: %d&quot; % result

===================================================

Feedback I'm looking for:
1) Initially I had the operation that gets the result (DeferredResult.get) 
block, but this is a bad idea since it can deadlock threads waiting for a 
result that will never be returned, e.g. when shutting down the server. 
Instead now I raise a NotReady exception if no result is available. Would 
callbacks be better?

2) Better method names, &quot;scheduleWithResult&quot; is ugly.

3) Is this idea (DeferredResults) applicable to internet.task as well?

Attached is my updated code.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: threadtask.py
Url: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20010916/6470e294/attachment.txt">http://twistedmatrix.com/pipermail/twisted-python/attachments/20010916/6470e294/attachment.txt</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000366.html">[Twisted-Python] Twisted Jython
</A></li>
	<LI>Next message: <A HREF="000368.html">[Twisted-Python] Patterns in Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#367">[ date ]</a>
              <a href="thread.html#367">[ thread ]</a>
              <a href="subject.html#367">[ subject ]</a>
              <a href="author.html#367">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
