<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] libusb-1 file descriptors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20libusb-1%20file%20descriptors&In-Reply-To=%3C201203162056.41353.plr.vincent%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057831.html">
   <LINK REL="Next"  HREF="057835.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] libusb-1 file descriptors</H1>
    <B>Vincent Pelletier</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20libusb-1%20file%20descriptors&In-Reply-To=%3C201203162056.41353.plr.vincent%40gmail.com%3E"
       TITLE="[Twisted-Python] libusb-1 file descriptors">plr.vincent at gmail.com
       </A><BR>
    <I>Fri Mar 16 13:56:40 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057831.html">[Twisted-Python] Twisted Log Efficiency is poor?
</A></li>
        <LI>Next message (by thread): <A HREF="057835.html">[Twisted-Python] [Twisted-commits] r33889 - Merge elementresource-5395: Add renderElement, for rendering Elements.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57833">[ date ]</a>
              <a href="thread.html#57833">[ thread ]</a>
              <a href="subject.html#57833">[ subject ]</a>
              <a href="author.html#57833">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi.

First, sorry for non-threaded reply. I found the thread on gmane while 
googling a bit.

I'll try to explain the design and intended use of python-libusb1 polling 
integration. I lack twisted knowledge to tell how it could be integrated, 
though.

As for the &quot;poller&quot; interface, it's python's select.poll interface.

Basically, libusb needs to be called into explicitly[1] whenever events 
needing some handling occur. It signals those events through a set of poll-
able file descriptors[2]. Alternatively (for OSes which cannot poll arbitrary 
file descriptors), LibUSBContext.getNextTimeout can be used to know for how 
long app can sleep (or do its own business) before next libusb event handling 
time... But that only works when libusb calls (transfer submission, 
synchronous or not) are all done in a single thread, otherwise they might last 
too long.

When several threads can simultaneously wait for events to occur (ex: a poller 
waiting on an asynchronous transfer with long timeout, then in a second thread 
a synchronous call expected to return quickly) a more complex scheme needs to 
be used. See libusb doc for the whole story.
In short, I decided to just write a stand-alone polling thread to support 
multi-thread access, as I couldn't figure a pythonic way of supporting several 
concurrent libusb-oriented pollers: C API relies on a mutable boolean-ish set 
by libusb code, and read by application code. As I try to never expose ctype 
instances to application code, and thought it should be enough to provide 
module user with a &quot;start once, then forget&quot; thread for handling this (much 
easier in python than in C), I went that way.
Besides the functions working with that boolean, I exposed all needed methods 
on LibUSBContext class, so different implementations can be done without 
hacking/working around, and hopefully without using libusb1 module directly 
(except for symbolic constants). I am opened to suggestions on how to expose 
the few missing functions in a pythonic way.

[1] LibUSBContext.handleEvents &amp; co.
[2] LibUSBContext.getPollFDList, LibUSBContext.setPollFDNotifiers

Regards,
-- 
Vincent Pelletier


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057831.html">[Twisted-Python] Twisted Log Efficiency is poor?
</A></li>
	<LI>Next message (by thread): <A HREF="057835.html">[Twisted-Python] [Twisted-commits] r33889 - Merge elementresource-5395: Add renderElement, for rendering Elements.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57833">[ date ]</a>
              <a href="thread.html#57833">[ thread ]</a>
              <a href="subject.html#57833">[ subject ]</a>
              <a href="author.html#57833">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
