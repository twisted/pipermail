<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] questions about twisted usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20questions%20about%20twisted%20usage&In-Reply-To=CAB%3DFgnPCRv3LUOL7msHV3JzzsKXt1Yywk5f5d_rqtua5ue%2Bk0g%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025389.html">
   <LINK REL="Next"  HREF="025391.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] questions about twisted usage</H1>
    <B>Tim Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20questions%20about%20twisted%20usage&In-Reply-To=CAB%3DFgnPCRv3LUOL7msHV3JzzsKXt1Yywk5f5d_rqtua5ue%2Bk0g%40mail.gmail.com"
       TITLE="[Twisted-Python] questions about twisted usage">screwtape at froup.com
       </A><BR>
    <I>Thu Mar 22 09:04:22 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025389.html">[Twisted-Python] questions about twisted usage
</A></li>
        <LI>Next message: <A HREF="025391.html">[Twisted-Python] questions about twisted usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25390">[ date ]</a>
              <a href="thread.html#25390">[ thread ]</a>
              <a href="subject.html#25390">[ subject ]</a>
              <a href="author.html#25390">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Mar 22, 2012 at 02:34:41PM +0200, Uri Okrent wrote:
&gt;<i> Maybe I should clarify my question:
</I>&gt;<i> 
</I>&gt;<i> thing = 0
</I>&gt;<i> def a():
</I>&gt;<i>     thing += 1
</I>&gt;<i>     thing += 1
</I>&gt;<i>     thing += 1
</I>&gt;<i>     thing += 1
</I>&gt;<i>     thing += 1
</I>&gt;<i> 
</I>&gt;<i> def b():
</I>&gt;<i>     thing = 0
</I>&gt;<i> 
</I>&gt;<i> def show_thing():
</I>&gt;<i>     print thing
</I>&gt;<i> 
</I>&gt;<i> a.addCallback(show_thing)
</I>&gt;<i> b.addCallback(show_thing)
</I>&gt;<i> 
</I>&gt;<i> given the two deferreds 'a' and 'b', with 'a' being called first, it
</I>&gt;<i> is possible for twisted to jump to 'b' in the middle of 'a' correct?
</I>
No.

The situation above doesn't actually work because a and b don't return
Deferreds, but during the execution of a, it's the only thing running
(unless you have other threads running... but since Twisted is largely
a way of avoiding thread-programming, that's not often the case).

In the real world, things aren't so simple, because nobody writes
Deferreds for code that can just execute in a straight line. People use
Deferreds when they want to wait for some external event before going
further, and you generally don't have control over the order those
events occur in.

For example, here we have a function that does some work, then does
a deferred operation, then does some more work in the callback:

    thing = 0

    def a():
	global thing

	# Do some work.
	thing += 1

	# Cause some_db to do some work on another machine, or in
	# another thread, or something.
	d = some_db.do_work(&quot;a&quot;)

	def add_more(res):
	    global thing

	    thing += 1
	    thing += 1
	    thing += 1

	    return res

	# When some_db is done, call this callback.
	d.addBoth(add_more)

	# Do more work.
	thing += 1

	return d

    def b():
	d = some_db.do_work(&quot;b&quot;)

	def clear_thing(res):
	    global thing
	    thing = 0
	    return res

	d.addBoth(clear_thing)
	return d

The pattern of events would go like this:

- Initially, thing is 0.
- Somebody calls a(), which increments thing twice (under the comment
  &quot;do some work&quot; and &quot;do more work&quot;, and launches a database call.
- thing is now 2.
- Somebody calls b(), which launches a different database call.
- Sometime later, the database gets back to us with an answer, and
  either a or b's callback will be fired first.
- If a's callback is fired before b's callback, thing will be
  incremented three more times then (some time later) set to 0.
- IF b's callback is fired before a's callback, thing will be set to 0,
  then (some time later) incremented 3 more times, resulting in 3.

So the only possible results are 0 and 3, because the 'synchronisation
points' are at the edges of callbacks. There's no way to get a result of
1 or 2, because a callback can't be interrupted while it's running
(again, unless threads are involved).


Tim.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025389.html">[Twisted-Python] questions about twisted usage
</A></li>
	<LI>Next message: <A HREF="025391.html">[Twisted-Python] questions about twisted usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25390">[ date ]</a>
              <a href="thread.html#25390">[ thread ]</a>
              <a href="subject.html#25390">[ subject ]</a>
              <a href="author.html#25390">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
