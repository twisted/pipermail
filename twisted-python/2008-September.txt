From gabriel.rossetti at arimaz.com  Mon Sep  1 03:47:20 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Mon, 01 Sep 2008 09:47:20 +0200
Subject: [Twisted-Python] Processes in Twisted,
	only possible to run external prog?
In-Reply-To: <20080829133524.25821.2120076452.divmod.xquotient.15068@joule.divmod.com>
References: <48B7BC33.7090501@arimaz.com>
	<20080829133524.25821.2120076452.divmod.xquotient.15068@joule.divmod.com>
Message-ID: <48BB9E08.6090903@arimaz.com>

glyph at divmod.com wrote:
> On 09:06 am, gabriel.rossetti at arimaz.com wrote:
>> http://www.biais.org/blog/index.php/2007/01/23/19-python-threads-and- 
>> oschdir
>> http://bugs.python.org/issue1367
>>
>> so I need to use processes instead, as they each have their own 
>> current dir. The thing is that from what I understand, Twisted's 
>> process API is intended to be used with external executables only, 
>> correct? I wasn' t able to fins anything that allowed me to do stuff 
>> like I would using fork(). Should I just use python's fock() instead? 
>> Is it safe with Twisted?
>
> As it happens, "python" is an "external executable".  Here's an 
> example of spawning it in such a way as to make sure that sys.path is 
> set properly: 
> http://divmod.org/trac/browser/trunk/Epsilon/epsilon/process.py#L7
>
Ok, thanks
> However, Wine is also an external process.  Perhaps you just want to 
> spawn the Wine command-line using spawnProcess using the 'path' 
> parameter set to a directory that you have created in the main 
> process, then clean it up when the process exits?
>
> http://twistedmatrix.com/documents/8.1.0/api/twisted.internet.interfaces.IReactorProcess.spawnProcess.html 
>
>
mmmm, yes, that sounds nice, I'll try that, thanks!
> Using fork() in Python has a lot of confusing issues associated with 
> it unless you're going to exec() immediately afterwards.  You probably 
> want to stick to one of these other approaches.
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From gabriel.rossetti at arimaz.com  Mon Sep  1 03:53:04 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Mon, 01 Sep 2008 09:53:04 +0200
Subject: [Twisted-Python] twistd,
	does it use processes? Anything to watch out for?
Message-ID: <48BB9F60.4000209@arimaz.com>

Hello everyone,

Just a little question about Twistd & the Application framework. I'm 
using the service collection app mechanism
and I was wondering how Twistd handles it. Is there anything special to 
watch out for? Any differences in between running each server as a
separate process (i.e. launching it from a diff term without twistd) and 
with Twistd? Does it spawn a process for each Service/Server?

Thank you,
Gabriel




From glyph at divmod.com  Mon Sep  1 07:57:00 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Mon, 01 Sep 2008 11:57:00 -0000
Subject: [Twisted-Python] twistd,
	does it use processes? Anything to watch out for?
In-Reply-To: <48BB9F60.4000209@arimaz.com>
References: <48BB9F60.4000209@arimaz.com>
Message-ID: <20080901115700.25821.1503840134.divmod.xquotient.15164@joule.divmod.com>

On 07:53 am, gabriel.rossetti at arimaz.com wrote:
>Hello everyone,
>
>Just a little question about Twistd & the Application framework. I'm 
>using the service collection app mechanism
>and I was wondering how Twistd handles it. Is there anything special to 
>watch out for? Any differences in between running each server as a
>separate process (i.e. launching it from a diff term without twistd) 
>and with Twistd? Does it spawn a process for each Service/Server?

twistd runs all services in a single process.  In fact, twistd only runs 
one service.  Although that service may be a MultiService which contains 
other services, MultiService does not do anything special to run things 
in other processes either.



From alpha04 at netvigator.com  Mon Sep  1 18:43:22 2008
From: alpha04 at netvigator.com (Andrey)
Date: Tue, 2 Sep 2008 06:43:22 +0800
Subject: [Twisted-Python] fileReceive in msn.py 
Message-ID: <g9hr6d$v67$1@ger.gmane.org>

Hello

anyone able to get the fileReceive() in the msn.py working? I tried many 
times but it keep lossing connection
to the server everytime after the confirmation is 
sent -fileInvitationReply()

any help or couple lines of sample code will be appreciated

Andrey K 





From gabriel.rossetti at arimaz.com  Tue Sep  2 02:22:22 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 02 Sep 2008 08:22:22 +0200
Subject: [Twisted-Python] twistd, does it use processes? Anything to watch
	out for?
In-Reply-To: <20080901115700.25821.1503840134.divmod.xquotient.15164@joule.divmod.com>
References: <48BB9F60.4000209@arimaz.com>
	<20080901115700.25821.1503840134.divmod.xquotient.15164@joule.divmod.com>
Message-ID: <48BCDB9E.8010205@arimaz.com>

glyph at divmod.com wrote:
> On 07:53 am, gabriel.rossetti at arimaz.com wrote:
>> Hello everyone,
>>
>> Just a little question about Twistd & the Application framework. I'm 
>> using the service collection app mechanism
>> and I was wondering how Twistd handles it. Is there anything special 
>> to watch out for? Any differences in between running each server as a
>> separate process (i.e. launching it from a diff term without twistd) 
>> and with Twistd? Does it spawn a process for each Service/Server?
>
> twistd runs all services in a single process.  In fact, twistd only 
> runs one service.  Although that service may be a MultiService which 
> contains other services, MultiService does not do anything special to 
> run things in other processes either.
>
>
Ok, thank you.

Gabriel



From gabriel.rossetti at arimaz.com  Tue Sep  2 04:35:05 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 02 Sep 2008 10:35:05 +0200
Subject: [Twisted-Python] create new domish.Element from string XML
Message-ID: <48BCFAB9.2070203@arimaz.com>

Hello everyone,

I sometimes have to create domish.Element from a string and I can't find 
any way of doing this. I saw that I can add children from a string but 
not create a whole XML tree.
Is there a way of doing this other than creating a dummy element, adding 
the XML string as a child and then extracting the child?

Thank you,
Gabriel



From gabriel.rossetti at arimaz.com  Tue Sep  2 05:45:22 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 02 Sep 2008 11:45:22 +0200
Subject: [Twisted-Python] create new domish.Element from string XML
In-Reply-To: <48BCFAB9.2070203@arimaz.com>
References: <48BCFAB9.2070203@arimaz.com>
Message-ID: <48BD0B32.7070500@arimaz.com>

Gabriel Rossetti wrote:
> Hello everyone,
>
> I sometimes have to create domish.Element from a string and I can't 
> find any way of doing this. I saw that I can add children from a 
> string but not create a whole XML tree.
> Is there a way of doing this other than creating a dummy element, 
> adding the XML string as a child and then extracting the child?
>
> Thank you,
> Gabriel
>
I tried creating a dummy element, adding the raw string as a child using 
"addRawXml()" and then extracting the first child, and this does not 
work because the raw xml string is just added without being parsed. I 
write this up, if anybody is interested, that does what I need. If a 
better method exists, please tell me.

Gabriel


# 
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

def rawXmlToElement(s):
    """
    Turn a raw string XML document into a XML element
   
    @param s: the raw string XML document
    @type s: C{str}
   
    @return: the XML element
    @rtype: 
U{twisted.words.xish.domish.Element<http://twistedmatrix.com/documents/current/api/twisted.words.xish.domish.Element.html>}
   
    @raise ParserError: if there was an error parsing the raw string XML 
document
    """
    result = None
    def onStart(el):
        result = el
    def onEnd():
        pass
    def onElement(el):
        result.addChild(el)
       
    parser = domish.elementStream()
    parser.DocumentStartEvent = onStart
    parser.ElementEvent = onElement
    parser.DocumentEndEvent = onEnd
    parser.parse(s)
   
    return result




From rlott at evertz.com  Tue Sep  2 08:43:38 2008
From: rlott at evertz.com (Rodney Lott)
Date: Tue, 2 Sep 2008 08:43:38 -0400
Subject: [Twisted-Python] How does the pollreactor work?
In-Reply-To: <20080829212034.25821.1674589899.divmod.xquotient.15110@joule.divmod.com>
Message-ID: <069B6B31F6201B4389D7EEB9AD827BCA05005AFD@otis.burlington.evertz.tv>

Thanks!  That makes sense.  I appreciate the detailed example.

Best regards.

Rodney

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com]On Behalf Of
glyph at divmod.com
Sent: Friday, August 29, 2008 5:21 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] How does the pollreactor work?



On 03:35 pm, rlott at evertz.com wrote:
>I have been trying to figure out how to use the 
>twisted.internet.pollreactor so that I can use it to monitor a Linux 
>named PIPE (i.e. a FIFO created using mkfifo()).  I tried without 
>success to Google some examples but I couldn't find anything.

This doesn't really have anything to do with pollreactor.  Any reactor 
that implements IReactorFDSet can monitor a pipe.

It was easier for me to implement this than to explain what to do, so 
here's the code for monitoring a named pipe for read, given its name. 
I'm pretty sure it's not 100% correct, but if you want to read about 
handling I/O events from fifos on your platform, you are welcome to do 
so.

    import os
    from twisted.internet.abstract import FileDescriptor
    from twisted.internet.main import CONNECTION_DONE

    class FIFODescriptor(FileDescriptor):
        def __init__(self, reactor, fifoname, protocol):
            FileDescriptor.__init__(self, reactor)
            self.fifo = os.open(fifoname, os.O_NONBLOCK | os.O_RDONLY)
            self.protocol = protocol
            self.protocol.makeConnection(self)

        def connectionLost(self, reason):
            self.protocol.connectionLost(reason)

        def doRead(self):
            data = os.read(self.fifo, 1024)
            if data:
                self.protocol.dataReceived(data)
            else:
                self.stopReading()
                self.connectionLost(CONNECTION_DONE)

        def fileno(self):
            return self.fifo


And here's a brief program that uses it:

    import sys
    from twisted.internet import reactor
    from twisted.internet.protocol import Protocol
    class PrintingProtocol(Protocol):
        def dataReceived(self, data):
            print 'data', repr(data)
        def connectionMade(self):
            print 'hi'
        def connectionLost(self, reason):
            print 'bye', reason
    fifd = FIFODescriptor(reactor, sys.argv[1], PrintingProtocol())
    fifd.startReading()
    reactor.run()

I tested this by doing 'mkfifo x; python fifo.py x', and in another 
terminal, 'cat > x'.  It should be pretty self-explanitory.

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

From aldoogy at gmail.com  Tue Sep  2 10:23:13 2008
From: aldoogy at gmail.com (A)
Date: Tue, 02 Sep 2008 15:23:13 +0100
Subject: [Twisted-Python] license / copyright questions about Twisted
	Perspective Broker client
Message-ID: <48BD4C51.6030303@gmail.com>

Hi,
After looking around for the last 6 months for an Actionscript 3 library 
that would work as a client for use with Twisted Perspective Broker
, and hoping someone more skilled than myself would get around to 
creating one, I decided to get the ball rolling.

It currently works as a client for the example here.
http://twistedmatrix.com/projects/core/documentation/howto/pb-cred.html#auto18

There is a long way to go. . . but it's a start.

I aim to release the library under the same license as Twisted (MIT) but 
I'm wondering about some of the details.
Since all I have done is just ported the original Twisted code from 
Python to Actionscript what does that mean in terms of copyright and 
credits ?
Should I give credit in every file according to original author ?
I still have most of the original doc strings in my version - am I 
allowed to use those ?
There are also sections where I have the original python code commented 
out (as a guide to what still needs to done). I can't really be arsed to 
delete all that while it's still in heavy development. Is that a problem 
? Would I have to put the credits for the code in each snippet ?

I have created a Google code project and will get the code up there as 
soon as I have got the paperwork in order.
Cheers,
Al.



From radix at twistedmatrix.com  Tue Sep  2 14:45:00 2008
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Tue, 2 Sep 2008 14:45:00 -0400
Subject: [Twisted-Python] license / copyright questions about Twisted
	Perspective Broker client
In-Reply-To: <48BD4C51.6030303@gmail.com>
References: <48BD4C51.6030303@gmail.com>
Message-ID: <60ed19d40809021145vb0110a6x98e20bfa47357039@mail.gmail.com>

On Tue, Sep 2, 2008 at 10:23 AM, A <aldoogy at gmail.com> wrote:

> I aim to release the library under the same license as Twisted (MIT) but I'm
> wondering about some of the details.
> Since all I have done is just ported the original Twisted code from Python
> to Actionscript what does that mean in terms of copyright and credits ?
> Should I give credit in every file according to original author ?
> I still have most of the original doc strings in my version - am I allowed
> to use those ?
> There are also sections where I have the original python code commented out
> (as a guide to what still needs to done). I can't really be arsed to delete
> all that while it's still in heavy development. Is that a problem ? Would I
> have to put the credits for the code in each snippet ?

I don't feel like analyzing a work today to determine whether it is a
derivative of Twisted, but if you think it is and you want to comply
with being a derivative, all you need to do is include the Twisted
copyright notice.

-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From aldoogy at gmail.com  Tue Sep  2 15:41:21 2008
From: aldoogy at gmail.com (A)
Date: Tue, 02 Sep 2008 20:41:21 +0100
Subject: [Twisted-Python] license / copyright questions about Twisted
	Perspective Broker client
In-Reply-To: <60ed19d40809021145vb0110a6x98e20bfa47357039@mail.gmail.com>
References: <48BD4C51.6030303@gmail.com>
	<60ed19d40809021145vb0110a6x98e20bfa47357039@mail.gmail.com>
Message-ID: <48BD96E1.6060609@gmail.com>

Christopher Armstrong wrote:
> I don't feel like analyzing a work today to determine whether it is a
> derivative of Twisted, but if you think it is and you want to comply
> with being a derivative, all you need to do is include the Twisted
> copyright notice.
>   
nice and simple
cheers.



From mael.le.lannou at newlc.com  Wed Sep  3 05:09:22 2008
From: mael.le.lannou at newlc.com (Mael Le Lannou)
Date: Wed, 03 Sep 2008 11:09:22 +0200
Subject: [Twisted-Python] Asking about architecture advice
Message-ID: <48BE5442.9080307@newlc.com>

Hello,

I'm a bit lost with api.
I'have to create a web application that allow this :

-1 server
-Some clients

-Server listen on server_ip:port_x for client datas
-Client listen on client_ip:port_x for server datas

Server and client can have initiative into sending data, that's my 
trouble and i don't know what transport to use.

can someone help me please

Thanks a lot




From gabriel.rossetti at arimaz.com  Wed Sep  3 10:59:58 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Wed, 03 Sep 2008 16:59:58 +0200
Subject: [Twisted-Python] create new domish.Element from string XML
In-Reply-To: <48BD0B32.7070500@arimaz.com>
References: <48BCFAB9.2070203@arimaz.com> <48BD0B32.7070500@arimaz.com>
Message-ID: <48BEA66E.7010505@arimaz.com>

Gabriel Rossetti wrote:
> Gabriel Rossetti wrote:
>> Hello everyone,
>>
>> I sometimes have to create domish.Element from a string and I can't 
>> find any way of doing this. I saw that I can add children from a 
>> string but not create a whole XML tree.
>> Is there a way of doing this other than creating a dummy element, 
>> adding the XML string as a child and then extracting the child?
>>
>> Thank you,
>> Gabriel
>>
> I tried creating a dummy element, adding the raw string as a child 
> using "addRawXml()" and then extracting the first child, and this does 
> not work because the raw xml string is just added without being 
> parsed. I write this up, if anybody is interested, that does what I 
> need. If a better method exists, please tell me.
>
> Gabriel
>
>
> # 
> ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
>
>
> def rawXmlToElement(s):
>    """
>    Turn a raw string XML document into a XML element
>      @param s: the raw string XML document
>    @type s: C{str}
>      @return: the XML element
>    @rtype: 
> U{twisted.words.xish.domish.Element<http://twistedmatrix.com/documents/current/api/twisted.words.xish.domish.Element.html>} 
>
>      @raise ParserError: if there was an error parsing the raw string 
> XML document
>    """
>    result = None
>    def onStart(el):
>        result = el
>    def onEnd():
>        pass
>    def onElement(el):
>        result.addChild(el)
>          parser = domish.elementStream()
>    parser.DocumentStartEvent = onStart
>    parser.ElementEvent = onElement
>    parser.DocumentEndEvent = onEnd
>    parser.parse(s)
>      return result
>
Hmmm, this code worked when I posted it, and it no longer does... maybe 
the interpreter I was testing it in had an old version cached, but now 
it tells me that "result" is None when "onElement" is called, what I 
don't get is that a clusure should have been created with those internal 
functions, no? When "DocumentStartEvent" is called, It does set 
"result", but when "ElementEvent" is called, "result" no longer exists. 
Does anyone know what's going on?

Thank you,
Gabriel



From samson at editshare.com  Wed Sep  3 13:41:39 2008
From: samson at editshare.com (Samson Yeung)
Date: Wed, 3 Sep 2008 13:41:39 -0400
Subject: [Twisted-Python] FilePaging not working?
Message-ID: <c038f5910809031041x8f48448mf6e341f6c7fbef03@mail.gmail.com>

Hello all,

I am trying to transfer files over a PerspectiveBroker connection with
FilePager and I've run into a problem. The attached cut-down example
works fine with Twisted-2.5.0, but not with Twisted-8.0 or
Twisted-8.1.0. This is with python 2.5.

On version 8 of twisted, a 0-byte file is created and the client never
finished; but with version 2.5, the full file is transferred.

What am I doing wrong; or is this a bug?

Thanks all,

-Samson
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pbecho.py
Type: text/x-python
Size: 1822 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20080903/87230d15/attachment.py 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pbechoclient.py
Type: text/x-python
Size: 1011 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20080903/87230d15/attachment-0001.py 

From duncan.mcgreggor at gmail.com  Wed Sep  3 18:49:45 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Wed, 3 Sep 2008 17:49:45 -0500
Subject: [Twisted-Python] Twisted XMPP Roadmap
Message-ID: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>

Hey all,

I wanted to take a quick moment to share some stuff with the general
email audience that is interested in XMPP/Jabber in Twisted.

First off, some folks don't realize that there is a dedicated
Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
check out the archives here:
  https://mailman.ik.nu/mailman/listinfo/twisted-jabber

Secondly, we've been having some interesting discussions with Twisted
sponsors lately about deep and abiding interests in Twisted XMPP: many
sponsors want us to spend time creating docs and tutorials, improving
support and adding new features. This interest was spearheaded by Jack
Moffitt of Chesspark and given additional momentum by Dhris DiBona of
Google. Furthermore, we've received vocal support for XMPP
improvements from Hydra Labs, Lucasfilm, Security Metrics, and
individual sponsors.

Thirdly, today on #twisted, we had an intense and very productive
discussion about XMPP in general, about it's current support in
Twisted, and then a provisional roadmap for future developments. It
was an excellent experience for all, and one that can be relived by
everyone, thanks to IRC logs :-) A new ticket was created to address
the next step that will to be taken, and that ticket is here:
  http://twistedmatrix.com/trac/ticket/3407

In that ticket, I linked to the notes and IRC log of our chat:
  http://twistedmatrix.com/trac/wiki/XMPPServerArchitecture
  http://twistedmatrix.com/trac/wiki/XMPPIRCTranscript20080903

There's lots to do and we're all quite excited about both the
immediate and long-term benefits to be had by Twisted users, community
members, and the project itself with regard to XMPP and messaging
development efforts.

Thanks,

d



From radix at twistedmatrix.com  Wed Sep  3 19:32:10 2008
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Wed, 3 Sep 2008 19:32:10 -0400
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
Message-ID: <60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>

On Wed, Sep 3, 2008 at 6:49 PM, Duncan McGreggor
<duncan.mcgreggor at gmail.com> wrote:
> Hey all,
>
> I wanted to take a quick moment to share some stuff with the general
> email audience that is interested in XMPP/Jabber in Twisted.
>
> First off, some folks don't realize that there is a dedicated
> Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
> is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
> check out the archives here:
>  https://mailman.ik.nu/mailman/listinfo/twisted-jabber

Given that it's got such little traffic, maybe it's proven to not be a
good idea to have that mailing list separate from this one. It hides
the conversation that goes on there from a larger audience, and anyone
who reads the archives is going to think that the project is, if not
dead, not very active.


-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From exarkun at divmod.com  Wed Sep  3 20:39:20 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 3 Sep 2008 20:39:20 -0400
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
Message-ID: <20080904003920.29191.1168982203.divmod.quotient.21318@ohm>

On Wed, 3 Sep 2008 19:32:10 -0400, Christopher Armstrong <radix at twistedmatrix.com> wrote:
>On Wed, Sep 3, 2008 at 6:49 PM, Duncan McGreggor
><duncan.mcgreggor at gmail.com> wrote:
>> Hey all,
>>
>> I wanted to take a quick moment to share some stuff with the general
>> email audience that is interested in XMPP/Jabber in Twisted.
>>
>> First off, some folks don't realize that there is a dedicated
>> Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
>> is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
>> check out the archives here:
>>  https://mailman.ik.nu/mailman/listinfo/twisted-jabber
>
>Given that it's got such little traffic, maybe it's proven to not be a
>good idea to have that mailing list separate from this one. It hides
>the conversation that goes on there from a larger audience, and anyone
>who reads the archives is going to think that the project is, if not
>dead, not very active.
>

+1 for Twisted XMPP discussions on Twisted Python, at least until the
XMPP code in Twisted is so great and popular that we start getting the
kind of repetitive, uninteresting posts that led to the twisted-web
split.

Jean-Paul



From adelagon at gmail.com  Wed Sep  3 21:22:26 2008
From: adelagon at gmail.com (Alvin Delagon)
Date: Thu, 4 Sep 2008 09:22:26 +0800
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <20080904003920.29191.1168982203.divmod.quotient.21318@ohm>
References: <60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904003920.29191.1168982203.divmod.quotient.21318@ohm>
Message-ID: <7a01f6c00809031822o2b35ae81sd3cf060c28aa106b@mail.gmail.com>

This is really great. We've been using Twisted-XMPP that acts as a Mobile IM
server (now taking 5k simultaneous connections). I'd be glad to share some
of the experiences and help out with with the development.



On Thu, Sep 4, 2008 at 8:39 AM, Jean-Paul Calderone <exarkun at divmod.com>wrote:

> On Wed, 3 Sep 2008 19:32:10 -0400, Christopher Armstrong <
> radix at twistedmatrix.com> wrote:
>
>> On Wed, Sep 3, 2008 at 6:49 PM, Duncan McGreggor
>> <duncan.mcgreggor at gmail.com> wrote:
>>
>>> Hey all,
>>>
>>> I wanted to take a quick moment to share some stuff with the general
>>> email audience that is interested in XMPP/Jabber in Twisted.
>>>
>>> First off, some folks don't realize that there is a dedicated
>>> Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
>>> is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
>>> check out the archives here:
>>>  https://mailman.ik.nu/mailman/listinfo/twisted-jabber
>>>
>>
>> Given that it's got such little traffic, maybe it's proven to not be a
>> good idea to have that mailing list separate from this one. It hides
>> the conversation that goes on there from a larger audience, and anyone
>> who reads the archives is going to think that the project is, if not
>> dead, not very active.
>>
>>
> +1 for Twisted XMPP discussions on Twisted Python, at least until the
> XMPP code in Twisted is so great and popular that we start getting the
> kind of repetitive, uninteresting posts that led to the twisted-web
> split.
>
> Jean-Paul
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



-- 
http://www.alvinatorsplayground.blogspot.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080904/df9f5f36/attachment.htm 

From p.mayers at imperial.ac.uk  Thu Sep  4 03:55:47 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Thu, 4 Sep 2008 08:55:47 +0100
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
Message-ID: <20080904075546.GB11595@wildfire.net.ic.ac.uk>

On Wed, Sep 03, 2008 at 07:32:10PM -0400, Christopher Armstrong wrote:
>On Wed, Sep 3, 2008 at 6:49 PM, Duncan McGreggor
><duncan.mcgreggor at gmail.com> wrote:
>> Hey all,
>>
>> I wanted to take a quick moment to share some stuff with the general
>> email audience that is interested in XMPP/Jabber in Twisted.
>>
>> First off, some folks don't realize that there is a dedicated
>> Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
>> is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
>> check out the archives here:
>>  https://mailman.ik.nu/mailman/listinfo/twisted-jabber
>
>Given that it's got such little traffic, maybe it's proven to not be a
>good idea to have that mailing list separate from this one. It hides
>the conversation that goes on there from a larger audience, and anyone
>who reads the archives is going to think that the project is, if not
>dead, not very active.

Agreed. When I did some work recently to implement the client side of 
pubsub, I found that mailing list moribund and gave up on the idea of 
asking for help there.





From twisted at ralphm.ik.nu  Thu Sep  4 04:57:56 2008
From: twisted at ralphm.ik.nu (Ralph Meijer)
Date: Thu, 04 Sep 2008 10:57:56 +0200
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <20080904075546.GB11595@wildfire.net.ic.ac.uk>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
Message-ID: <48BFA314.2080300@ralphm.ik.nu>

On 2008-09-04 09:55, Phil Mayers wrote:
> Agreed. When I did some work recently to implement the client side of 
> pubsub, I found that mailing list moribund and gave up on the idea of 
> asking for help there.

Hey Phil,

that sounds nice. Have you looked at all at the stuff that currently 
resides in Wokkel (and, as part of this grand effort will eventually end 
up in Twisted Words)? The pubsub protocol there is the stuff I've been 
working on most. I mostly focused on the component side (for 
implementing Idavoll), but there is good client support in there as 
well. You can also drop me a line via Jabber.

That said, yeah the list might have been somewhat quiet, partly because 
I have been bad at communicating what I've been up to recently. It does 
have about 50 people subscribing to it, and I am so far not convinced 
that all of them would want to be dragged into general Twisted discussions.

ralphm





From p.mayers at imperial.ac.uk  Thu Sep  4 06:58:14 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Thu, 04 Sep 2008 11:58:14 +0100
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <48BFA314.2080300@ralphm.ik.nu>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
	<48BFA314.2080300@ralphm.ik.nu>
Message-ID: <48BFBF46.10509@imperial.ac.uk>

Ralph Meijer wrote:
> On 2008-09-04 09:55, Phil Mayers wrote:
>> Agreed. When I did some work recently to implement the client side of 
>> pubsub, I found that mailing list moribund and gave up on the idea of 
>> asking for help there.
> 
> Hey Phil,
> 
> that sounds nice. Have you looked at all at the stuff that currently 
> resides in Wokkel (and, as part of this grand effort will eventually end 
> up in Twisted Words)? The pubsub protocol there is the stuff I've been 
> working on most. I mostly focused on the component side (for 
> implementing Idavoll), but there is good client support in there as 
> well. You can also drop me a line via Jabber.

I did look at wokkel. I must be honest, first time round I found it a 
bit difficult to decipher, though that might be because it took a while 
to realise that lots of the pieces were in fact server-side ;o)

Once I'd gone to the effort of re-inventing the wheel however, a 2nd 
look back at wokkel made a lot more sense, and I'll certainly use it 
instead of the code I wrote.

The actual project was for ESB-like use, though that's now been put on 
hold (frankly I think XMPP pubsub might be a little new for that, and 
will probably look at ActiveMQ. It didn't help that ejabberd's 
collections are "funny").

What I *did* end up doing was start on a basic Nevow/Athena XMPP client 
with basic roster/message functions and also pubsub support. That might 
make a nice example app.

The notion of an all-twisted XMPP server is intriguing, especially if 
some integration with http://pypi.python.org/pypi/txLoadBalancer were to 
appear!

> 
> That said, yeah the list might have been somewhat quiet, partly because 
> I have been bad at communicating what I've been up to recently. It does 
> have about 50 people subscribing to it, and I am so far not convinced 
> that all of them would want to be dragged into general Twisted discussions.

Thinking about it, you're probably right - the list has been quiet 
because not much has been going on, but that doesn't mean it need remain 
quiet if things are now going to be moving.



From glyph at divmod.com  Thu Sep  4 09:37:13 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 04 Sep 2008 13:37:13 -0000
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <48BFA314.2080300@ralphm.ik.nu>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
	<48BFA314.2080300@ralphm.ik.nu>
Message-ID: <20080904133713.25821.287702513.divmod.xquotient.15374@joule.divmod.com>

On 08:57 am, twisted at ralphm.ik.nu wrote:
>On 2008-09-04 09:55, Phil Mayers wrote:
>>Agreed. When I did some work recently to implement the client side of 
>>pubsub, I found that mailing list moribund and gave up on the idea of 
>>asking for help there.

>That said, yeah the list might have been somewhat quiet, partly because 
>I have been bad at communicating what I've been up to recently. It does 
>have about 50 people subscribing to it, and I am so far not convinced 
>that all of them would want to be dragged into general Twisted 
>discussions.

I agree with Chris and JP here: I certainly plan to discuss XMPP issues 
here on the main Twisted mailing list.  I _want_ to "drag" these folks 
into general Twisted discussions - and with over 1000 people on this 
list already, with a hugely divergent array of interests in Twisted, 
somehow I am guessing those 50 won't need to be dragged too hard :).

There is still a lot to be decided as to how Twisted's XMPP code will 
integrate with the rest of Twisted: what is the (protocol-agnostic) 
common domain model for chat?  How should different XMPP components and 
modules use twisted.cred?  I think that these core integration 
mechanisms are a huge part of what makes Twisted great.  These questions 
need to be answered by people who know Twisted's abstractions as well as 
those who know XMPP's.

What to do with the twisted-jabber mailing list is certainly up to you, 
and perhaps current discussion of wokkel, palaver, and idavoll does not 
belong here; but certainly development of twisted.words should be 
discussed in as general a forum as possible.



From duncan.mcgreggor at gmail.com  Thu Sep  4 12:08:48 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Thu, 4 Sep 2008 11:08:48 -0500
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <48BFBF46.10509@imperial.ac.uk>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
	<48BFA314.2080300@ralphm.ik.nu> <48BFBF46.10509@imperial.ac.uk>
Message-ID: <4327dfbd0809040908w45819a96w917425553992bb40@mail.gmail.com>

On Thu, Sep 4, 2008 at 5:58 AM, Phil Mayers <p.mayers at imperial.ac.uk> wrote:
> Ralph Meijer wrote:
>>
>> On 2008-09-04 09:55, Phil Mayers wrote:
>>>
>>> Agreed. When I did some work recently to implement the client side of
>>> pubsub, I found that mailing list moribund and gave up on the idea of asking
>>> for help there.
>>
>> Hey Phil,
>>
>> that sounds nice. Have you looked at all at the stuff that currently
>> resides in Wokkel (and, as part of this grand effort will eventually end up
>> in Twisted Words)? The pubsub protocol there is the stuff I've been working
>> on most. I mostly focused on the component side (for implementing Idavoll),
>> but there is good client support in there as well. You can also drop me a
>> line via Jabber.
>
> I did look at wokkel. I must be honest, first time round I found it a bit
> difficult to decipher, though that might be because it took a while to
> realise that lots of the pieces were in fact server-side ;o)
>
> Once I'd gone to the effort of re-inventing the wheel however, a 2nd look
> back at wokkel made a lot more sense, and I'll certainly use it instead of
> the code I wrote.
>
> The actual project was for ESB-like use, though that's now been put on hold
> (frankly I think XMPP pubsub might be a little new for that, and will
> probably look at ActiveMQ. It didn't help that ejabberd's collections are
> "funny").
>
> What I *did* end up doing was start on a basic Nevow/Athena XMPP client with
> basic roster/message functions and also pubsub support. That might make a
> nice example app.
>
> The notion of an all-twisted XMPP server is intriguing, especially if some
> integration with http://pypi.python.org/pypi/txLoadBalancer were to appear!

Phil, you're reading my mind :-) That's just the sort of thing I have
planned for txLB's future.

d



From duncan.mcgreggor at gmail.com  Thu Sep  4 12:09:02 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Thu, 4 Sep 2008 11:09:02 -0500
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <20080904133713.25821.287702513.divmod.xquotient.15374@joule.divmod.com>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
	<48BFA314.2080300@ralphm.ik.nu>
	<20080904133713.25821.287702513.divmod.xquotient.15374@joule.divmod.com>
Message-ID: <4327dfbd0809040909j22436fe5p524a34f9d649036d@mail.gmail.com>

On Thu, Sep 4, 2008 at 8:37 AM,  <glyph at divmod.com> wrote:
> On 08:57 am, twisted at ralphm.ik.nu wrote:
>>
>> On 2008-09-04 09:55, Phil Mayers wrote:
>>>
>>> Agreed. When I did some work recently to implement the client side of
>>> pubsub, I found that mailing list moribund and gave up on the idea of asking
>>> for help there.
>
>> That said, yeah the list might have been somewhat quiet, partly because I
>> have been bad at communicating what I've been up to recently. It does have
>> about 50 people subscribing to it, and I am so far not convinced that all of
>> them would want to be dragged into general Twisted discussions.
>
> I agree with Chris and JP here: I certainly plan to discuss XMPP issues here
> on the main Twisted mailing list.  I _want_ to "drag" these folks into
> general Twisted discussions - and with over 1000 people on this list
> already, with a hugely divergent array of interests in Twisted, somehow I am
> guessing those 50 won't need to be dragged too hard :).
>
> There is still a lot to be decided as to how Twisted's XMPP code will
> integrate with the rest of Twisted: what is the (protocol-agnostic) common
> domain model for chat?  How should different XMPP components and modules use
> twisted.cred?  I think that these core integration mechanisms are a huge
> part of what makes Twisted great.  These questions need to be answered by
> people who know Twisted's abstractions as well as those who know XMPP's.
>
> What to do with the twisted-jabber mailing list is certainly up to you, and
> perhaps current discussion of wokkel, palaver, and idavoll does not belong
> here; but certainly development of twisted.words should be discussed in as
> general a forum as possible.

+1

d



From duncan.mcgreggor at gmail.com  Fri Sep  5 02:51:03 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Fri, 5 Sep 2008 01:51:03 -0500
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
References: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
Message-ID: <4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>

On Tue, Aug 19, 2008 at 6:59 AM, Henrik Thostrup Jensen
<thostrup at gmail.com> wrote:
> Hi
>
> I've written a small python/twisted client library for CouchDB.
>
> It's mostly a toy, but it can be fetched from here:
> http://www.cs.aau.dk/~htj/code/couched-0.1.tar.gz if anyone is interested.
> License: MIT
>
> I'm aware of paisley  (https://launchpad.net/paisley),
> The main difference from paisley is that the connection and database
> abstraction are separated.
> Also couched does connection caching and uses web2 instead of web.
> Currently paisley is more feature rich, but couched has slightly nicer error
> handling.

Hey Henrik,

Thanks for sharing!

I would, however, encourage you to create a Paisley branch in
Launchpad and improve the error handling and connection abstraction
there. This would make it much easier for us to merge your changes
into Paisley.

At the very least, you may want to register your project with
Launchpad and associate it with the tx project group, so people can
find it easily (the tx project group, or "super project" is for
Twisted community code).

Also, are you aware that web2 features are being slowly ported to web,
and that twisted.web will continue to be the official web library?

Thanks again!

d



From thostrup at gmail.com  Fri Sep  5 03:48:08 2008
From: thostrup at gmail.com (Henrik Thostrup Jensen)
Date: Fri, 5 Sep 2008 09:48:08 +0200
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>
References: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
	<4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>
Message-ID: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>

Hi Duncan, thanks for heads up.

2008/9/5 Duncan McGreggor <duncan.mcgreggor at gmail.com>

>
> I would, however, encourage you to create a Paisley branch in
> Launchpad and improve the error handling and connection abstraction
> there. This would make it much easier for us to merge your changes
> into Paisley.
>

Changing the connection abstraction and error handling in paisley would make
it extremely similar to couched. The main difference would be the name :-).

I might do it.

Btw. I've created a second release of couched which supports views and
probably fixes a few other things. Just forgot to release it. Couched was
mainly an exercise in understanding the CouchDB interface.

At the very least, you may want to register your project with
> Launchpad and associate it with the tx project group, so people can
> find it easily (the tx project group, or "super project" is for
> Twisted community code).
>

I'll try to do this over the weekend.


> Also, are you aware that web2 features are being slowly ported to web,
> and that twisted.web will continue to be the official web library?
>

I'm aware that something might or might not happen in the twisted web world
:-).

<begin twisted web rant which would be much better suited for twisted-web>
Frankly I've given up following the web vs. web2 discussions. I used web2 as
it is what I am familiar with, and I wanted connection caching. I have a
significant code base using web2 and beside a few issues (for which I've
submitted patches and bugs, but nothing happens) it works fine, though I
have to maintain a patchset for it :-/. Twisted web is currently not an
option (I need request pipelining and http 1.1).
<end twisted web rant>


-- 
- Henrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080905/dfb4c188/attachment.htm 

From exarkun at divmod.com  Fri Sep  5 06:51:16 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 5 Sep 2008 06:51:16 -0400
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
Message-ID: <20080905105116.29191.1735349546.divmod.quotient.21964@ohm>

On Fri, 5 Sep 2008 09:48:08 +0200, Henrik Thostrup Jensen <thostrup at gmail.com> wrote:
> [snip]
> Twisted web is currently not an option (I need request pipelining and http 
> 1.1).

Which other HTTP 1.1 features do you need?

Jean-Paul



From gabriel.rossetti at arimaz.com  Fri Sep  5 09:35:15 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Fri, 05 Sep 2008 15:35:15 +0200
Subject: [Twisted-Python] XMPP authentication question : when is the
	username sent?
Message-ID: <48C13593.8050409@arimaz.com>

Hello everyone,

I am trying to figure out how the auth works, for this I used the simple 
example client. The question is, when is the username sent? In the 
output I never see the username being sent, I see the server at some 
point sending it to me.

Thank you,
Gabriel

Username is : test_user at localhost

Output :

    Connected.
    SEND: <stream:stream xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:client' to='localhost' version='1.0'>
    RECV: <?xml version='1.0'?><stream:stream xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams' id='4203649965'
    from='localhost' version='1.0' xml:lang='en'>
    RECV: <stream:features><starttls
    xmlns='urn:ietf:params:xml:ns:xmpp-tls'/><mechanisms
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'><mechanism>DIGEST-MD5</mechanism><mechanism>PLAIN</mechanism></mechanisms><register
    xmlns='http://jabber.org/features/iq-register'/></stream:features>
    SEND: <starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'/>
    RECV: <proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/>
    SEND: <stream:stream xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:client' to='localhost' version='1.0'>
    RECV: <?xml version='1.0'?><stream:stream xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams' id='1885368444'
    from='localhost' version='1.0' xml:lang='en'>
    RECV: <stream:features><mechanisms
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'><mechanism>DIGEST-MD5</mechanism><mechanism>PLAIN</mechanism></mechanisms><register
    xmlns='http://jabber.org/features/iq-register'/></stream:features>
    SEND: <auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
    mechanism='DIGEST-MD5'/>
    RECV: <challenge
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>bm9uY2U9IjE0NTM4NDY3NDMiLHFvcD0iYXV0aCIsY2hhcnNldD11dGYtOCxhbGdvcml0aG09bWQ1LXNlc3M=</challenge>
    SEND: <response
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>dXNlcm5hbWU9InRlc3RfdXNlciIsbm9uY2U9IjE0NTM4NDY3NDMiLGNoYXJzZXQ9dXRmLTgscmVhbG09ImxvY2FsaG9zdCIscW9wPWF1dGgsY25vbmNlPSJhN2RkOTY1MGFmNTA4MTU2YTc1ZjE3ODQwMzZmNTQ0OCIsbmM9MDAwMDAwMDEsZGlnZXN0LXVyaT0ieG1wcC9sb2NhbGhvc3QiLHJlc3BvbnNlPTg1MWZiZmMwYTczNWRmZDFiODZkNmMzZDg0MmI2NWQ3</response>
    RECV: <challenge
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>cnNwYXV0aD03ZWQ3ZWZmNTI2NWRmMTE2MmZlNTdjNGE0NDI1ZGEwMA==</challenge>
    SEND: <response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>
    RECV: <success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>
    SEND: <stream:stream xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:client' to='localhost' version='1.0'>
    RECV: <?xml version='1.0'?><stream:stream xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams' id='4179606135'
    from='localhost' version='1.0' xml:lang='en'>
    RECV: <stream:features><bind
    xmlns='urn:ietf:params:xml:ns:xmpp-bind'/><session
    xmlns='urn:ietf:params:xml:ns:xmpp-session'/></stream:features>
    SEND: <iq type='set' id='H_0'><bind
    xmlns='urn:ietf:params:xml:ns:xmpp-bind'/></iq>
    RECV: <iq id='H_0' type='result'><bind
    xmlns='urn:ietf:params:xml:ns:xmpp-bind'><jid>test_user at localhost/26511133671220620792673712</jid></bind></iq>
    SEND: <iq type='set' id='H_1'><session
    xmlns='urn:ietf:params:xml:ns:xmpp-session'/></iq>
    RECV: <iq type='result' id='H_1'><session
    xmlns='urn:ietf:params:xml:ns:xmpp-session'/></iq>
    Authenticated.




From exarkun at divmod.com  Fri Sep  5 09:39:26 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 5 Sep 2008 09:39:26 -0400
Subject: [Twisted-Python] XMPP authentication question : when is the
	username sent?
In-Reply-To: <48C13593.8050409@arimaz.com>
Message-ID: <20080905133926.29191.814244174.divmod.quotient.22019@ohm>

On Fri, 05 Sep 2008 15:35:15 +0200, Gabriel Rossetti <gabriel.rossetti at arimaz.com> wrote:
>Hello everyone,
>
>I am trying to figure out how the auth works, for this I used the simple 
>example client. The question is, when is the username sent? In the output I 
>never see the username being sent, I see the server at some point sending it 
>to me.
>
>Thank you,
>Gabriel
>
>Username is : test_user at localhost
>
>Output :
>
> [snip]
>sasl'>dXNlcm5hbWU9InRlc3RfdXNlciIsbm9uY2U9IjE0NTM4NDY3NDMiLGNoYXJzZXQ9dXRmLTgscmVhbG09ImxvY2FsaG9zdCIscW9wPWF1dGgsY25vbmNlPSJhN2RkOTY1MGFmNTA4MTU2YTc1ZjE3ODQwMzZmNTQ0OCIsbmM9MDAwMDAwMDEsZGlnZXN0LXVyaT0ieG1wcC9sb2NhbGhvc3QiLHJlc3BvbnNlPTg1MWZiZmMwYTczNWRmZDFiODZkNmMzZDg0MmI2NWQ3</response>

There it is.  'dXNlcm...'.decode('base64') == 'username="test_user",...'

Jean-Paul



From gabriel.rossetti at arimaz.com  Fri Sep  5 09:55:36 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Fri, 05 Sep 2008 15:55:36 +0200
Subject: [Twisted-Python] XMPP authentication question : when is
	the	username sent?
In-Reply-To: <20080905133926.29191.814244174.divmod.quotient.22019@ohm>
References: <20080905133926.29191.814244174.divmod.quotient.22019@ohm>
Message-ID: <48C13A58.1010201@arimaz.com>

Jean-Paul Calderone wrote:
> On Fri, 05 Sep 2008 15:35:15 +0200, Gabriel Rossetti 
> <gabriel.rossetti at arimaz.com> wrote:
>> Hello everyone,
>>
>> I am trying to figure out how the auth works, for this I used the 
>> simple example client. The question is, when is the username sent? In 
>> the output I never see the username being sent, I see the server at 
>> some point sending it to me.
>>
>> Thank you,
>> Gabriel
>>
>> Username is : test_user at localhost
>>
>> Output :
>>
>> [snip]
>> sasl'>dXNlcm5hbWU9InRlc3RfdXNlciIsbm9uY2U9IjE0NTM4NDY3NDMiLGNoYXJzZXQ9dXRmLTgscmVhbG09ImxvY2FsaG9zdCIscW9wPWF1dGgsY25vbmNlPSJhN2RkOTY1MGFmNTA4MTU2YTc1ZjE3ODQwMzZmNTQ0OCIsbmM9MDAwMDAwMDEsZGlnZXN0LXVyaT0ieG1wcC9sb2NhbGhvc3QiLHJlc3BvbnNlPTg1MWZiZmMwYTczNWRmZDFiODZkNmMzZDg0MmI2NWQ3</response> 
>>
>
> There it is.  'dXNlcm...'.decode('base64') == 'username="test_user",...'
>
> Jean-Paul
>
Ok, I thought that was the password, and that something maybe wasn't 
printing out to stdout, makes sense now. Thank you,

Gabriel



From spiritualmechanic at yahoo.com  Fri Sep  5 12:51:15 2008
From: spiritualmechanic at yahoo.com (Steve Lewis)
Date: Fri, 5 Sep 2008 09:51:15 -0700 (PDT)
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
Message-ID: <378675.35498.qm@web33706.mail.mud.yahoo.com>

We're trying to use twisted as a sort of bus, a centralized place to manage all of our SOA enpoints (mostly through XML-RPC). We have a few services that access the Oracle DB directly (adbapi). In production we're getting intermittent ConnectionLost exceptions from cx_Oracle. Most of these are queries that take a couple of seconds.

Has anyone seen this kind of behavior before? What we're probably going to do in the short term is just remove twisted from the equation for these methods that seem to be timing out. But we're relatively new to twisted and I wonder if we're doing something that's obviously wrong.

Steve



      



From dreid at dreid.org  Fri Sep  5 13:10:08 2008
From: dreid at dreid.org (David Reid)
Date: Fri, 5 Sep 2008 10:10:08 -0700
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
References: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
	<4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>
	<f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
Message-ID: <508B395E-6BF7-459E-8F1E-7B37D80A10DE@dreid.org>

Hi Henrik,

Patches to Paisley would be greatly appreciated.

On Sep 5, 2008, at 12:48 AM, Henrik Thostrup Jensen wrote:
>
> Also, are you aware that web2 features are being slowly ported to web,
> and that twisted.web will continue to be the official web library?
>
> I'm aware that something might or might not happen in the twisted  
> web world :-).
>
> <begin twisted web rant which would be much better suited for  
> twisted-web>
> Frankly I've given up following the web vs. web2 discussions. I used  
> web2 as it is what I am familiar with, and I wanted connection  
> caching. I have a significant code base using web2 and beside a few  
> issues (for which I've submitted patches and bugs, but nothing  
> happens) it works fine, though I have to maintain a patchset for  
> it :-/. Twisted web is currently not an option (I need request  
> pipelining and http 1.1).

Please file tickets about making twisted.web support the HTTP/1.1  
features you need, this is the best way to get that support into  
Paisley.

It just saddens me to see a 3rd couchdb python client library spring  
up.  2 is bad enough but one being asynchronous and one being  
synchronous means it can't really be helped.  Paisley development  
hasn't stopped it just hasn't really needed much work.

-David
"The Unmaintainer of Web2"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080905/5646f7ab/attachment.htm 

From ldanielburr at mac.com  Fri Sep  5 13:15:40 2008
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Fri, 05 Sep 2008 12:15:40 -0500
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
In-Reply-To: <378675.35498.qm@web33706.mail.mud.yahoo.com>
References: <378675.35498.qm@web33706.mail.mud.yahoo.com>
Message-ID: <op.ug0p8eyv3oj628@l-daniel-burrs-computer.local>

Hi Steve,

On Fri, 05 Sep 2008 11:51:15 -0500, Steve Lewis  
<spiritualmechanic at yahoo.com> wrote:

> We're trying to use twisted as a sort of bus, a centralized place to  
> manage all of our SOA enpoints (mostly through XML-RPC). We have a few  
> services that access the Oracle DB directly (adbapi). In production  
> we're getting intermittent ConnectionLost exceptions from cx_Oracle.  
> Most of these are queries that take a couple of seconds.
>

Hmm, it is kind of hard to say what the problem could be, without
seeing the code that is using adbapi and cx_Oracle.

When you say you are receiving ConnectionLost exceptions from cx_Oracle,
are they *really* from cx_Oracle, i.e., "ORA-03135 - Connection lost...",
or are they just the result of adbapi calling its connectionLost method?

> Has anyone seen this kind of behavior before? What we're probably going  
> to do in the short term is just remove twisted from the equation for  
> these methods that seem to be timing out. But we're relatively new to  
> twisted and I wonder if we're doing something that's obviously wrong.
>

I've used cx_Oracle with twisted many times, with many different workloads,
including stored procedures with OUT parameters, and it has always worked
as expected.  If you are able to provide some code, this list might be
able to provide you with more prescriptive advice.

Hope this helps,

L. Daniel Burr



From spiritualmechanic at yahoo.com  Fri Sep  5 14:06:25 2008
From: spiritualmechanic at yahoo.com (Steve Lewis)
Date: Fri, 5 Sep 2008 11:06:25 -0700 (PDT)
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
Message-ID: <202751.42289.qm@web33701.mail.mud.yahoo.com>

I looked at the adbapi code and it appears the ConnectionLost exception is coming from there, not from cx_Oracle. At least that's what is in the error log:

2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] adbapi closing: cx_Oracle
2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] Connection lost.
2008-09-05 12:25:48-0400 [-] Unhandled Error
        Traceback (most recent call last):
          File "/opt/Python25/lib/python2.5/threading.py", line 440, in run
            self.__target(*self.__args, **self.__kwargs)
          File "/opt/python/lib/python2.5/site-packages/twisted/python/threadpool.py", line 161, in _worker
            context.call(ctx, function, *args, **kwargs)
          File "/opt/python/lib/python2.5/site-packages/twisted/python/context.py", line 59, in callWithContext
            return self.currentContext().callWithContext(ctx, func, *args, **kw)
          File "/opt/python/lib/python2.5/site-packages/twisted/python/context.py", line 37, in callWithContext
            return func(*args,**kw)
        --- <exception caught here> ---
          File "/opt/python/lib/python2.5/site-packages/twisted/internet/threads.py", line 24, in _putResultInDeferred
            result = f(*args, **kwargs)
          File "/opt/python/lib/python2.5/site-packages/twisted/enterprise/adbapi.py", line 380, in _runInteraction
            conn.rollback()
          File "/opt/python/lib/python2.5/site-packages/twisted/enterprise/adbapi.py", line 65, in rollback
            raise ConnectionLost()
        twisted.enterprise.adbapi.ConnectionLost:

I don't know what 

        --- <exception caught here> ---

means. I'm guessing there's some sort of issue with Oracle but our DBA didn't see anything obvious in his logs. Is there a way for me to tell what exactly the "exception caught here" is?

Steve



----- Original Message ----
From: L. Daniel Burr <ldanielburr at mac.com>
To: Twisted general discussion <twisted-python at twistedmatrix.com>
Sent: Friday, September 5, 2008 1:15:40 PM
Subject: Re: [Twisted-Python] Moderately-long running processes timing out in Twisted

Hi Steve,

On Fri, 05 Sep 2008 11:51:15 -0500, Steve Lewis  
<spiritualmechanic at yahoo.com> wrote:

> We're trying to use twisted as a sort of bus, a centralized place to  
> manage all of our SOA enpoints (mostly through XML-RPC). We have a few  
> services that access the Oracle DB directly (adbapi). In production  
> we're getting intermittent ConnectionLost exceptions from cx_Oracle.  
> Most of these are queries that take a couple of seconds.
>

Hmm, it is kind of hard to say what the problem could be, without
seeing the code that is using adbapi and cx_Oracle.

When you say you are receiving ConnectionLost exceptions from cx_Oracle,
are they *really* from cx_Oracle, i.e., "ORA-03135 - Connection lost...",
or are they just the result of adbapi calling its connectionLost method?

> Has anyone seen this kind of behavior before? What we're probably going  
> to do in the short term is just remove twisted from the equation for  
> these methods that seem to be timing out. But we're relatively new to  
> twisted and I wonder if we're doing something that's obviously wrong.
>

I've used cx_Oracle with twisted many times, with many different workloads,
including stored procedures with OUT parameters, and it has always worked
as expected.  If you are able to provide some code, this list might be
able to provide you with more prescriptive advice.

Hope this helps,

L. Daniel Burr

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



      



From exarkun at divmod.com  Fri Sep  5 14:20:01 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 5 Sep 2008 14:20:01 -0400
Subject: [Twisted-Python] Moderately-long running processes timing out
	in Twisted
In-Reply-To: <202751.42289.qm@web33701.mail.mud.yahoo.com>
Message-ID: <20080905182001.29191.193291293.divmod.quotient.22103@ohm>

On Fri, 5 Sep 2008 11:06:25 -0700 (PDT), Steve Lewis <spiritualmechanic at yahoo.com> wrote:
>I looked at the adbapi code and it appears the ConnectionLost exception is coming from there, not from cx_Oracle. At least that's what is in the error log:
>
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] adbapi closing: cx_Oracle
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] Connection lost.
>2008-09-05 12:25:48-0400 [-] Unhandled Error
>        Traceback (most recent call last):
>          File "/opt/Python25/lib/python2.5/threading.py", line 440, in run
>            self.__target(*self.__args, **self.__kwargs)
>          File "/opt/python/lib/python2.5/site-packages/twisted/python/threadpool.py", line 161, in _worker
>            context.call(ctx, function, *args, **kwargs)
>          File "/opt/python/lib/python2.5/site-packages/twisted/python/context.py", line 59, in callWithContext
>            return self.currentContext().callWithContext(ctx, func, *args, **kw)
>          File "/opt/python/lib/python2.5/site-packages/twisted/python/context.py", line 37, in callWithContext
>            return func(*args,**kw)
>        --- <exception caught here> ---
>          File "/opt/python/lib/python2.5/site-packages/twisted/internet/threads.py", line 24, in _putResultInDeferred
>            result = f(*args, **kwargs)
>          File "/opt/python/lib/python2.5/site-packages/twisted/enterprise/adbapi.py", line 380, in _runInteraction
>            conn.rollback()
>          File "/opt/python/lib/python2.5/site-packages/twisted/enterprise/adbapi.py", line 65, in rollback
>            raise ConnectionLost()
>        twisted.enterprise.adbapi.ConnectionLost:
>
>I don't know what
>
>        --- <exception caught here> ---
>
>means. I'm guessing there's some sort of issue with Oracle but our DBA didn't see anything obvious in his logs. Is there a way for me to tell what exactly the "exception caught here" is?
>

"exception caught here" is telling you where in the call stack the exception
was caught. Frames above it weren't escaped by the exception. Frames below
it were.

I think you're seeing an example of poor error reporting in adbapi.  This
has recently been improved and the improvements will be included in the
next release of Twisted.  If you can somehow test a recent trunk revision
of Twisted, you might find that it reports a more specific problem which
points to the actual cause of the failure.

What this does indicate, I think, is that you had a transaction which
could not be committed for some reason.  adbapi is rolling back the
transaction before reporting the reason the commit failed.  However,
the ConnectionLost exception, which is boring and not really relevant
to anything you're doing, is happening before the real exception can be
reported.

Jean-Paul



From glyph at divmod.com  Fri Sep  5 14:22:08 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Fri, 05 Sep 2008 18:22:08 -0000
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
In-Reply-To: <202751.42289.qm@web33701.mail.mud.yahoo.com>
References: <202751.42289.qm@web33701.mail.mud.yahoo.com>
Message-ID: <20080905182208.25821.961475070.divmod.xquotient.15608@joule.divmod.com>



It seems that you have been a victim of at least one recently-fixed bug:

    http://twistedmatrix.com/trac/ticket/3244

and at least one long-standing one:

    http://twistedmatrix.com/trac/ticket/1753

As you can see from the tone of my (unfortunate) comment on the latter 
ticket, I don't think a lot of people use Oracle with Twisted.

However, the issue is simple to hack around temporarily: set your 
ConnectionPool's "good_sql" attribute to 'select 1 from dual' as itamar 
suggests on #1753.

Then, please submit a patch, and ideally a buildslave with a copy of 
oracle installed so that we can maintain support for it :).

On 06:06 pm, spiritualmechanic at yahoo.com wrote:
>I looked at the adbapi code and it appears the ConnectionLost exception 
>is coming from there, not from cx_Oracle. At least that's what is in 
>the error log:
>
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] adbapi closing: 
>cx_Oracle
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] Connection lost.
>2008-09-05 12:25:48-0400 [-] Unhandled Error
>        Traceback (most recent call last):
>          File "/opt/Python25/lib/python2.5/threading.py", line 440, in 
>run
>            self.__target(*self.__args, **self.__kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/threadpool.py", line 161, in _worker
>            context.call(ctx, function, *args, **kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/context.py", line 59, in callWithContext
>            return self.currentContext().callWithContext(ctx, func, 
>*args, **kw)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/context.py", line 37, in callWithContext
>            return func(*args,**kw)
>        --- <exception caught here> ---
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/internet/threads.py", line 24, in _putResultInDeferred
>            result = f(*args, **kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/enterprise/adbapi.py", line 380, in _runInteraction
>            conn.rollback()
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/enterprise/adbapi.py", line 65, in rollback
>            raise ConnectionLost()
>        twisted.enterprise.adbapi.ConnectionLost:
>
>I don't know what
>
>        --- <exception caught here> ---
>
>means. I'm guessing there's some sort of issue with Oracle but our DBA 
>didn't see anything obvious in his logs. Is there a way for me to tell 
>what exactly the "exception caught here" is?
>
>Steve
>
>
>
>----- Original Message ----
>From: L. Daniel Burr <ldanielburr at mac.com>
>To: Twisted general discussion <twisted-python at twistedmatrix.com>
>Sent: Friday, September 5, 2008 1:15:40 PM
>Subject: Re: [Twisted-Python] Moderately-long running processes timing 
>out in Twisted
>
>Hi Steve,
>
>On Fri, 05 Sep 2008 11:51:15 -0500, Steve Lewis
><spiritualmechanic at yahoo.com> wrote:
>>We're trying to use twisted as a sort of bus, a centralized place to
>>manage all of our SOA enpoints (mostly through XML-RPC). We have a few
>>services that access the Oracle DB directly (adbapi). In production
>>we're getting intermittent ConnectionLost exceptions from cx_Oracle.
>>Most of these are queries that take a couple of seconds.
>
>Hmm, it is kind of hard to say what the problem could be, without
>seeing the code that is using adbapi and cx_Oracle.
>
>When you say you are receiving ConnectionLost exceptions from 
>cx_Oracle,
>are they *really* from cx_Oracle, i.e., "ORA-03135 - Connection 
>lost...",
>or are they just the result of adbapi calling its connectionLost 
>method?
>>Has anyone seen this kind of behavior before? What we're probably 
>>going
>>to do in the short term is just remove twisted from the equation for
>>these methods that seem to be timing out. But we're relatively new to
>>twisted and I wonder if we're doing something that's obviously wrong.
>
>I've used cx_Oracle with twisted many times, with many different 
>workloads,
>including stored procedures with OUT parameters, and it has always 
>worked
>as expected.  If you are able to provide some code, this list might be
>able to provide you with more prescriptive advice.
>
>Hope this helps,
>
>L. Daniel Burr
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From spiritualmechanic at yahoo.com  Fri Sep  5 14:31:12 2008
From: spiritualmechanic at yahoo.com (Steve Lewis)
Date: Fri, 5 Sep 2008 11:31:12 -0700 (PDT)
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
Message-ID: <565425.32565.qm@web33705.mail.mud.yahoo.com>

We're using good_sql already. We're doing our best to move away from Oracle, honest! ;)
Steve



----- Original Message ----
From: "glyph at divmod.com" <glyph at divmod.com>
To: Twisted general discussion <twisted-python at twistedmatrix.com>
Sent: Friday, September 5, 2008 2:22:08 PM
Subject: Re: [Twisted-Python] Moderately-long running processes timing out in Twisted



It seems that you have been a victim of at least one recently-fixed bug:

    http://twistedmatrix.com/trac/ticket/3244

and at least one long-standing one:

    http://twistedmatrix.com/trac/ticket/1753

As you can see from the tone of my (unfortunate) comment on the latter 
ticket, I don't think a lot of people use Oracle with Twisted.

However, the issue is simple to hack around temporarily: set your 
ConnectionPool's "good_sql" attribute to 'select 1 from dual' as itamar 
suggests on #1753.

Then, please submit a patch, and ideally a buildslave with a copy of 
oracle installed so that we can maintain support for it :).

On 06:06 pm, spiritualmechanic at yahoo.com wrote:
>I looked at the adbapi code and it appears the ConnectionLost exception 
>is coming from there, not from cx_Oracle. At least that's what is in 
>the error log:
>
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] adbapi closing: 
>cx_Oracle
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] Connection lost.
>2008-09-05 12:25:48-0400 [-] Unhandled Error
>        Traceback (most recent call last):
>          File "/opt/Python25/lib/python2.5/threading.py", line 440, in 
>run
>            self.__target(*self.__args, **self.__kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/threadpool.py", line 161, in _worker
>            context.call(ctx, function, *args, **kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/context.py", line 59, in callWithContext
>            return self.currentContext().callWithContext(ctx, func, 
>*args, **kw)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/context.py", line 37, in callWithContext
>            return func(*args,**kw)
>        --- <exception caught here> ---
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/internet/threads.py", line 24, in _putResultInDeferred
>            result = f(*args, **kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/enterprise/adbapi.py", line 380, in _runInteraction
>            conn.rollback()
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/enterprise/adbapi.py", line 65, in rollback
>            raise ConnectionLost()
>        twisted.enterprise.adbapi.ConnectionLost:
>
>I don't know what
>
>        --- <exception caught here> ---
>
>means. I'm guessing there's some sort of issue with Oracle but our DBA 
>didn't see anything obvious in his logs. Is there a way for me to tell 
>what exactly the "exception caught here" is?
>
>Steve
>
>
>
>----- Original Message ----
>From: L. Daniel Burr <ldanielburr at mac.com>
>To: Twisted general discussion <twisted-python at twistedmatrix.com>
>Sent: Friday, September 5, 2008 1:15:40 PM
>Subject: Re: [Twisted-Python] Moderately-long running processes timing 
>out in Twisted
>
>Hi Steve,
>
>On Fri, 05 Sep 2008 11:51:15 -0500, Steve Lewis
><spiritualmechanic at yahoo.com> wrote:
>>We're trying to use twisted as a sort of bus, a centralized place to
>>manage all of our SOA enpoints (mostly through XML-RPC). We have a few
>>services that access the Oracle DB directly (adbapi). In production
>>we're getting intermittent ConnectionLost exceptions from cx_Oracle.
>>Most of these are queries that take a couple of seconds.
>
>Hmm, it is kind of hard to say what the problem could be, without
>seeing the code that is using adbapi and cx_Oracle.
>
>When you say you are receiving ConnectionLost exceptions from 
>cx_Oracle,
>are they *really* from cx_Oracle, i.e., "ORA-03135 - Connection 
>lost...",
>or are they just the result of adbapi calling its connectionLost 
>method?
>>Has anyone seen this kind of behavior before? What we're probably 
>>going
>>to do in the short term is just remove twisted from the equation for
>>these methods that seem to be timing out. But we're relatively new to
>>twisted and I wonder if we're doing something that's obviously wrong.
>
>I've used cx_Oracle with twisted many times, with many different 
>workloads,
>including stored procedures with OUT parameters, and it has always 
>worked
>as expected.  If you are able to provide some code, this list might be
>able to provide you with more prescriptive advice.
>
>Hope this helps,
>
>L. Daniel Burr
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



      



From glyph at divmod.com  Fri Sep  5 15:33:21 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Fri, 05 Sep 2008 19:33:21 -0000
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
In-Reply-To: <565425.32565.qm@web33705.mail.mud.yahoo.com>
References: <565425.32565.qm@web33705.mail.mud.yahoo.com>
Message-ID: <20080905193321.25821.763058873.divmod.xquotient.15611@joule.divmod.com>




On 06:31 pm, spiritualmechanic at yahoo.com wrote:
>We're using good_sql already. We're doing our best to move away from 
>Oracle, honest! ;)
>Steve

(lots of stuff snipped)

Hmm.  I was guessing about the most likely cause since the other (fixed) 
bug inhibits error reporting.

Do you get a more useful traceback out of twisted trunk at HEAD?  I 
wouldn't advocate using that in production, but the error-logging bugfix 
would tell you at least what's really going wrong.



From jeff.dyke at gmail.com  Fri Sep  5 17:56:14 2008
From: jeff.dyke at gmail.com (Jeff Dyke)
Date: Fri, 5 Sep 2008 17:56:14 -0400
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
In-Reply-To: <20080905193321.25821.763058873.divmod.xquotient.15611@joule.divmod.com>
References: <565425.32565.qm@web33705.mail.mud.yahoo.com>
	<20080905193321.25821.763058873.divmod.xquotient.15611@joule.divmod.com>
Message-ID: <8496caf30809051456y2735ef5ek5eb8c353d2a36922@mail.gmail.com>

On Fri, Sep 5, 2008 at 3:33 PM,  <glyph at divmod.com> wrote:
>
>
>
> On 06:31 pm, spiritualmechanic at yahoo.com wrote:
>>
>> We're using good_sql already. We're doing our best to move away from
>> Oracle, honest! ;)
>> Steve
>
> (lots of stuff snipped)
>
> Hmm.  I was guessing about the most likely cause since the other (fixed) bug
> inhibits error reporting.
>
> Do you get a more useful traceback out of twisted trunk at HEAD?  I wouldn't
> advocate using that in production, but the error-logging bugfix would tell
> you at least what's really going wrong.
>

This could be way off base, but i used to see this on stale
connections being  utilized again in the next xmlrpc job, basically
timing out. (mysqldb- Mysql Server has gone away). Using db.ping()
could keep them alive, or testing the connection/recreating before
executing a new xmlrpc job.

do these exceptions occur when they are running not through the xmlrpc.

Jeff
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From ellisonbg.net at gmail.com  Fri Sep  5 18:46:29 2008
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Fri, 5 Sep 2008 15:46:29 -0700
Subject: [Twisted-Python] "_wait" is blowing up?!
In-Reply-To: <20080828191133.29191.157249331.divmod.quotient.19100@ohm>
References: <6ce0ac130808281152x5b10b6baq67020919e15dd4d2@mail.gmail.com>
	<20080828191133.29191.157249331.divmod.quotient.19100@ohm>
Message-ID: <6ce0ac130809051546w412be51eh87ca78de9dd797e2@mail.gmail.com>

By random chance I found the problem in this case.  Thanks for the
suggestions though!

Cheers,

Brian

On Thu, Aug 28, 2008 at 12:11 PM, Jean-Paul Calderone
<exarkun at divmod.com> wrote:
>
>
> On Thu, 28 Aug 2008 11:52:02 -0700, Brian Granger <ellisonbg.net at gmail.com>
> wrote:
>>>
>>> Is your code available somewhere?
>>
>> yes, the code is the IPython mainline, on launchpad:
>>
>> $ bzr branch lp:ipython
>>
>> Then, simply
>>
>> $ trial IPython
>>
>> Will show the problem.  You will also need foolcap to run the test suite.
>>
>>> Do you reliably see this error eventually if you use trial --until-
>>> failure?
>>
>> It shows up as an Error rather than a Failure.  But yes, it still shows
>> up.
>>
>>> Exactly what version of Twisted are you using?
>>
>> Latest stable.
>>
>>> What reactor do you typically run your tests under?
>>
>> Default on all platforms.
>>
>>> Not sure that I'd be able to tell you what's going on even with an answer
>>> to
>>> all of these questions, but they'd be a start :).
>>
>> Thanks, I know this type of thing is tough to debug.  Any clever
>> tricks I could use to track it down?
>
> You can try running with trial --debug (possibly also --nopm).  This will
> cause Deferred debugging to be enabled, which will cause the call site of
> each Deferred's creation to be saved.  Then you can inspect this to learn
> which Deferred is being called back multiple times.  Once you learn this,
> further debugging approaches may become apparent (like looking at all the
> call sites which can call back a Deferred created there, and figuring out
> how more than one of them can be executed).
>
> Jean-Paul
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From thostrup at gmail.com  Fri Sep  5 19:25:36 2008
From: thostrup at gmail.com (Henrik Thostrup Jensen)
Date: Sat, 6 Sep 2008 01:25:36 +0200
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <20080905105116.29191.1735349546.divmod.quotient.21964@ohm>
References: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
	<20080905105116.29191.1735349546.divmod.quotient.21964@ohm>
Message-ID: <f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>

2008/9/5 Jean-Paul Calderone <exarkun at divmod.com>

> On Fri, 5 Sep 2008 09:48:08 +0200, Henrik Thostrup Jensen <
> thostrup at gmail.com> wrote:
>
>> [snip]
>> Twisted web is currently not an option (I need request pipelining and http
>> 1.1).
>>
>
> Which other HTTP 1.1 features do you need?
>

HTTP 1.1 status codes, notable 303 (see other). I could probably use 302,
but 303 is the "correct" behaviour for my case. This should be relatively
easy to implement.

Furthermore I need the server to support large uploads (last i checked the
640K limitation was still there) and downloads, and with reasonable
efficiancy.  I'm not saying streams are the answer but it works for me
(actually I use the producer/consumer interface in my lower level code and
then adapt it in the web layer). Unfortunately I've had to rewrite a lot of
the producer/consumer code and stream stuff and glue it together, as some of
the stuff in twisted (not just in web2) is rather broken. For complete
insanity (sorry to whoever wrote it ) see
twisted.protocols.basic.FileSender, which implements its own magic method
beginFileTransfer, which takes BOTH a file and a consumer as argument. This
makes is impossible to seperate the construction of the producer and
starting the transfer.

Ticket #1956 fixes some of these things. I'm not quite sure how it handles
errors (which can happen both ways), but I've just had a quick look. It's
been a whlie since i've had a look at all this. I write a bit about it,
which I've placed here: http://www.cs.aau.dk/~htj/prodcons.txt

IMHO, getting (and deciding on) a proper producer/consumer interface need to
happen, to make whatever web things twisted will have usefull. Changing the
producer/consumer might be massive API break, however it is a needed one.
There are simply things the current API cannot do (i usually return a
deferred along with any producer/consumer object to indiciate how the data
moving went). I might be interested in participating in this, however I'm
rather work struck as I have to hand my ph.d. thesis at the end of this
year.

Btw. I really am a huge fan of twisted, however the web and
producer/consumer is a rather dark spot in an otherwise bright world :-)


-- 
- Henrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080906/8bbc5c3a/attachment.htm 

From thostrup at gmail.com  Fri Sep  5 19:35:17 2008
From: thostrup at gmail.com (Henrik Thostrup Jensen)
Date: Sat, 6 Sep 2008 01:35:17 +0200
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <508B395E-6BF7-459E-8F1E-7B37D80A10DE@dreid.org>
References: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
	<4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>
	<f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
	<508B395E-6BF7-459E-8F1E-7B37D80A10DE@dreid.org>
Message-ID: <f33a4da20809051635i3ddaf3f1m8358e991e572ef18@mail.gmail.com>

2008/9/5 David Reid <dreid at dreid.org>

> Hi Henrik,
> Patches to Paisley would be greatly appreciated.
>

Will you accept a switch to web2, otherwise there is very little point to
it. Otherwise the patch kit needs to look like this:

Proper producer/consumer infrastructure in twisted
Integrate the above in twisted.web along with http 1.1 response codes, and
request pipelining.
Some patches to paisley, which would be quite small compared to the other.

Sorry, but it is not that simple :-)

Please file tickets about making twisted.web support the HTTP/1.1 features
> you need, this is the best way to get that support into Paisley.
>

See my response to JP.


> It just saddens me to see a 3rd couchdb python client library spring up.  2
> is bad enough but one being asynchronous and one being synchronous means it
> can't really be helped.  Paisley development hasn't stopped it just hasn't
> really needed much work.
>

Without getting into some large discussion here, I think that some diversity
is actually a good thing. Of course it is no use having several half
implementations lying around (the python community excels at this :-)), than
having a single working library. However. the interface of couchdb is simple
enough that a full client library can be written rather fast. This is not
sad, but very nice :-).


-- 
- Henrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080906/bb2e5be8/attachment.htm 

From glyph at divmod.com  Fri Sep  5 21:12:13 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Sat, 06 Sep 2008 01:12:13 -0000
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>
References: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
	<20080905105116.29191.1735349546.divmod.quotient.21964@ohm>
	<f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>
Message-ID: <20080906011213.25821.1308765536.divmod.xquotient.15694@joule.divmod.com>


On 5 Sep, 11:25 pm, thostrup at gmail.com wrote:
>2008/9/5 Jean-Paul Calderone <exarkun at divmod.com>
>>On Fri, 5 Sep 2008 09:48:08 +0200, Henrik Thostrup Jensen <
>>thostrup at gmail.com> wrote:
>>>[snip]
>>>Twisted web is currently not an option (I need request pipelining and 
>>>http
>>>1.1).

Please feel free to use twisted.web2 if it is meeting your needs 
currently.  However, our goal remains to focus maintenance effort on 
twisted.web and provide a gradual, compatible evolution to a better 
webserver.  The HTTP 1.1 features that you need will eventually be added 
to twisted.web, and I hope that the split with paisley can be resolved 
at that point.

I personally don't use couchdb or have any interest in its bindings, but 
it sounds like you have some other misconceptions about twisted and its 
development process which I'd like to correct.
>>Which other HTTP 1.1 features do you need?

>Furthermore I need the server to support large uploads (last i checked 
>the
>640K limitation was still there) and downloads, and with reasonable
>efficiancy.

640k limitation?  In twisted.web?  As far as I know there's no such 
thing; the only 640k limitation I know of anywhere in Twisted is in PB, 
and that's just on individual message size.  A brief skim through the 
twisted.web client and server code doesn't reveal any obvious size 
limitations that I can see.  (Is there some 640k limitation in the 'cgi' 
module?)

If there is such a limitation it should be more clearly documented 
somewhere.

True, twisted.web doesn't provide a graceful way for resources to handle 
streaming file uploads as they arrive, but for dedicated servers it is 
certainly *possible*; Request.handleContentChunk says it's "not for 
users", but you could easily write a few simple patches which would make 
it "for users", or just subclass it and ignore the docstring.  Nothing 
in twisted.web is really that hard to fix.
>Ticket #1956 fixes some of these things. I'm not quite sure how it 
>handles
>errors (which can happen both ways), but I've just had a quick look. 
>It's
>been a whlie since i've had a look at all this. I write a bit about it,
>which I've placed here: http://www.cs.aau.dk/~htj/prodcons.txt

Ticket #1956 is still kind of stuck defining the problem.

If you have comments or thoughts on #1956, please feel free to add them 
as comments.  Text files lying around the web are not as helpful as 
discussions on tickets.

Your text file suffers from the same problems as the existing discussion 
on the ticket, though: a lack of concrete use-cases and example code. 
There are lots of proposed solutions but not a lot of proposed problems. 
(I am certainly a guilty party here, I really should describe the 
problem in more detail.)  We all feel there is some inelegance, but 
there is no example of some code that we can all agree is gross and 
would be fixed by some better API.

Please come up with an example - the shorter the better - of a 
deficiency in the streaming API and put it on the ticket.  Hopefully 
that will further the discussion there.
>IMHO, getting (and deciding on) a proper producer/consumer interface 
>need to
>happen, to make whatever web things twisted will have usefull. Changing 
>the
>producer/consumer might be massive API break, however it is a needed 
>one.

No.

1. We will never break compatibility with an API this old and this 
stable.  When we do start to move over to a new API, the transition will 
be particularly gradual and slow given the core nature of this API and 
the fact that pretty much everything uses it.  Even if it were only 
around for one release, see 
http://twistedmatrix.com/trac/wiki/CompatibilityPolicy

2. It's not clear what the new API would be.  Every suggestion proposed 
thus far has some issues, and there's no clear winner.  Unless someone 
takes the time to really thoroughly explain the problem and describe 
what effect the solution would have, with examples, then we're not going 
to make any progress.

3. There isn't anything that you *can't do* with 
ITransport/IProducer/IConsumer/IProtocol.  It can be slightly awkward 
sometimes, but I have yet to see an example where you really can't make 
something work.  For example, IConsumer doesn't have .finish(), but 
that's fine, because you probably mean IProtocol.connectionLost(...) 
anyway.  Some users of these interfaces don't provide nice ways to get 
data in and out, and yes, a uniform and consistent way to deal with 
slinging data between endpoints (for example, a standard, featureful 
object to remix a 'protocol' into a 'transport' and vice versa) would 
probably help with that.  Given that the deficiency creates momentary 
inconveniences rather than impossibilities, there's no way we're going 
to break *every single twisted program ever* just to make it slightly 
more convenient.

4. Given that the semantics are already there, it will be very easy to 
evolve new code to call old interfaces, provide adapters which wrap 
around things and generally make it easy to have some hypothetical shiny 
new interface cooperate just fine with the crufty old ones.



From exarkun at twistedmatrix.com  Sun Sep  7 00:05:10 2008
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 07 Sep 2008 04:05:10 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1220760310.49.448219891@twistedmatrix.com

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080907/6f8d7af7/attachment.htm 

From manlio_perillo at libero.it  Wed Sep 10 04:00:59 2008
From: manlio_perillo at libero.it (Manlio Perillo)
Date: Wed, 10 Sep 2008 10:00:59 +0200
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>
References: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>	<20080905105116.29191.1735349546.divmod.quotient.21964@ohm>
	<f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>
Message-ID: <48C77EBB.2080903@libero.it>

Henrik Thostrup Jensen ha scritto:
> 2008/9/5 Jean-Paul Calderone <exarkun at divmod.com 
> <mailto:exarkun at divmod.com>>
> 
>     On Fri, 5 Sep 2008 09:48:08 +0200, Henrik Thostrup Jensen
>     <thostrup at gmail.com <mailto:thostrup at gmail.com>> wrote:
> 
>         [snip]
> 
>         Twisted web is currently not an option (I need request
>         pipelining and http 1.1).
> 
> 
>     Which other HTTP 1.1 features do you need?
> 
> 
> HTTP 1.1 status codes, notable 303 (see other). I could probably use 
> 302, but 303 is the "correct" behaviour for my case. This should be 
> relatively easy to implement.
> 
> Furthermore I need the server to support large uploads (last i checked 
> the 640K limitation was still there) and downloads, and with reasonable 
> efficiancy.  

You can try to use Nginx with the upload module
http://www.grid.net.ru/nginx/upload.en.html

The upload module parse the multipart/form-data entity body, and saves 
all file fields to temporary files.

The backend server receive a multipart/form-data entity body where each 
file field is replaced with several fields: *_name, *_content_type, 
*_file_name, *_tmp_path (names are configurable).


 > [...]


Manlio Perillo



From matusis at yahoo.com  Wed Sep 10 16:32:06 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Wed, 10 Sep 2008 13:32:06 -0700
Subject: [Twisted-Python] intermittent problem: not accepting new connections
Message-ID: <043501c91384$4c2c6b00$e4854100$@com>

I have had a twisted epoll server that was heavily used, such that it
saturated CPU (100% shown by "top", about 5000 connections, intense message
relaying).
I am using twisted 2.5.0 that I patched for epoll bug.
It was run on python 2.4.4 , 2.6.11 kernel on a single core xeon 3.0 GHz
CPU. This server has been on for many months, and it has been rock-stable.

A couple of days ago I migrated that server to a newer machine: same patched
twisted 2.5.0, same python 2.4.4, newer 2.6.24 kernel and a quad core xeon
L5420 CPU. 
CPU usage dropped from 100% to 30%, as expected, with the same rate of
client connections.

However the server now has the following intermittent problem: about twice a
day, it stops accepting new connections for a short period of 5-10 minutes.

telnet times out, I get this:
root at serv2:/proc/net/netfilter# telnet localhost 5229

Trying 127.0.0.1...

Existing connections are not cut, they server receives/delivers messages
to/from them just fine.
These short periods of not accepting connections do not correlate with
increased CPU load or with the overall number of connections to the server.

I have had a problem with the same symptoms before, when a server process
run out of its quota of file descriptors.
However, there were clear messages in the twisted log at that time, and
upping the ulimits solved the problem.
This time, there are no errors in ANY logs (twisted log. /var/log/messages,
etc)

I am out of ideas on what this could be, because my setup is exactly the
same as I have been using in the last year, except for a faster CPU and a
newer kernel?

I suspect that there are some new uncaught accept() exceptions in
internet/tcp.py in the part where it's looking for EMFILE, ENOBUFS, ENFILE,
ENOMEM, ECONNABORTED errors.




From exarkun at divmod.com  Wed Sep 10 16:44:15 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 10 Sep 2008 16:44:15 -0400
Subject: [Twisted-Python] intermittent problem: not accepting new
	connections
In-Reply-To: <043501c91384$4c2c6b00$e4854100$@com>
Message-ID: <20080910204415.29191.1876254162.divmod.quotient.24247@ohm>

On Wed, 10 Sep 2008 13:32:06 -0700, Alec Matusis <matusis at yahoo.com> wrote:
>I have had a twisted epoll server that was heavily used, such that it
>saturated CPU (100% shown by "top", about 5000 connections, intense message
>relaying).
>I am using twisted 2.5.0 that I patched for epoll bug.
>It was run on python 2.4.4 , 2.6.11 kernel on a single core xeon 3.0 GHz
>CPU. This server has been on for many months, and it has been rock-stable.
>
>A couple of days ago I migrated that server to a newer machine: same patched
>twisted 2.5.0, same python 2.4.4, newer 2.6.24 kernel and a quad core xeon
>L5420 CPU.
>CPU usage dropped from 100% to 30%, as expected, with the same rate of
>client connections.
>
>However the server now has the following intermittent problem: about twice a
>day, it stops accepting new connections for a short period of 5-10 minutes.
>
>telnet times out, I get this:
>root at serv2:/proc/net/netfilter# telnet localhost 5229
>
>Trying 127.0.0.1...
>
>Existing connections are not cut, they server receives/delivers messages
>to/from them just fine.
>These short periods of not accepting connections do not correlate with
>increased CPU load or with the overall number of connections to the server.
>
>I have had a problem with the same symptoms before, when a server process
>run out of its quota of file descriptors.
>However, there were clear messages in the twisted log at that time, and
>upping the ulimits solved the problem.
>This time, there are no errors in ANY logs (twisted log. /var/log/messages,
>etc)

Do non-error log messages continue to appear in the Twisted log?  ie, is
it clear that the logging system is still working, or could it have failed
in some way, obscuring any exception reports?

>
>I am out of ideas on what this could be, because my setup is exactly the
>same as I have been using in the last year, except for a faster CPU and a
>newer kernel?
>
>I suspect that there are some new uncaught accept() exceptions in
>internet/tcp.py in the part where it's looking for EMFILE, ENOBUFS, ENFILE,
>ENOMEM, ECONNABORTED errors.
>

Any new unhandled errno values should definitely result in an exception
being logged (notice that the `raise? which follows the checks for
various errno values is inside a try/except which logs any exception).

Jean-Paul



From matusis at yahoo.com  Wed Sep 10 17:01:27 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Wed, 10 Sep 2008 14:01:27 -0700
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <20080910204415.29191.1876254162.divmod.quotient.24247@ohm>
References: <043501c91384$4c2c6b00$e4854100$@com>
	<20080910204415.29191.1876254162.divmod.quotient.24247@ohm>
Message-ID: <045201c91388$67f836d0$37e8a470$@com>

> Do non-error log messages continue to appear in the Twisted log?  ie,
> is
> it clear that the logging system is still working, or could it have
> failed
> in some way, obscuring any exception reports?

Yes, I print the results of garbage collection every 10 min like this:

print "number of objects tracked by the garbage collector is:", len(gc.get_objects())

and they appear in the main twisted log.

2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage collector is: 860021
2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage collector is: 864316

> Any new unhandled errno values should definitely result in an exception
> being logged (notice that the `raise? which follows the checks for
> various errno values is inside a try/except which logs any exception).

I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or EPERM?

                except socket.error, e:
                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
                        self.numberAccepts = i
                        break
                    elif e.args[0] == EPERM:
                        # Netfilter on Linux may have rejected the
                        # connection, but we get told to try to accept()
                        # anyway.
                        continue


I am not sure how to debug this problem- I have another twisted server of a different type on that machine, and while the problematic server stops accepting connections, the second one works just fine, so this is not a machine-wide issue.
What could it be?

> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Wednesday, September 10, 2008 1:44 PM
> To: Twisted general discussion
> Subject: Re: [Twisted-Python] intermittent problem: not accepting new
> connections
> 
> On Wed, 10 Sep 2008 13:32:06 -0700, Alec Matusis <matusis at yahoo.com>
> wrote:
> >I have had a twisted epoll server that was heavily used, such that it
> >saturated CPU (100% shown by "top", about 5000 connections, intense
> message
> >relaying).
> >I am using twisted 2.5.0 that I patched for epoll bug.
> >It was run on python 2.4.4 , 2.6.11 kernel on a single core xeon 3.0
> GHz
> >CPU. This server has been on for many months, and it has been rock-
> stable.
> >
> >A couple of days ago I migrated that server to a newer machine: same
> patched
> >twisted 2.5.0, same python 2.4.4, newer 2.6.24 kernel and a quad core
> xeon
> >L5420 CPU.
> >CPU usage dropped from 100% to 30%, as expected, with the same rate of
> >client connections.
> >
> >However the server now has the following intermittent problem: about
> twice a
> >day, it stops accepting new connections for a short period of 5-10
> minutes.
> >
> >telnet times out, I get this:
> >root at serv2:/proc/net/netfilter# telnet localhost 5229
> >
> >Trying 127.0.0.1...
> >
> >Existing connections are not cut, they server receives/delivers
> messages
> >to/from them just fine.
> >These short periods of not accepting connections do not correlate with
> >increased CPU load or with the overall number of connections to the
> server.
> >
> >I have had a problem with the same symptoms before, when a server
> process
> >run out of its quota of file descriptors.
> >However, there were clear messages in the twisted log at that time,
> and
> >upping the ulimits solved the problem.
> >This time, there are no errors in ANY logs (twisted log.
> /var/log/messages,
> >etc)
> 
> Do non-error log messages continue to appear in the Twisted log?  ie,
> is
> it clear that the logging system is still working, or could it have
> failed
> in some way, obscuring any exception reports?
> 
> >
> >I am out of ideas on what this could be, because my setup is exactly
> the
> >same as I have been using in the last year, except for a faster CPU
> and a
> >newer kernel?
> >
> >I suspect that there are some new uncaught accept() exceptions in
> >internet/tcp.py in the part where it's looking for EMFILE, ENOBUFS,
> ENFILE,
> >ENOMEM, ECONNABORTED errors.
> >
> 
> Any new unhandled errno values should definitely result in an exception
> being logged (notice that the `raise? which follows the checks for
> various errno values is inside a try/except which logs any exception).
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Wed Sep 10 17:46:40 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 10 Sep 2008 17:46:40 -0400
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <045201c91388$67f836d0$37e8a470$@com>
Message-ID: <20080910214640.29191.1309907171.divmod.quotient.24266@ohm>

On Wed, 10 Sep 2008 14:01:27 -0700, Alec Matusis <matusis at yahoo.com> wrote:
>> Do non-error log messages continue to appear in the Twisted log?  ie,
>> is
>> it clear that the logging system is still working, or could it have
>> failed
>> in some way, obscuring any exception reports?
>
>Yes, I print the results of garbage collection every 10 min like this:
>
>print "number of objects tracked by the garbage collector is:", len(gc.get_objects())
>
>and they appear in the main twisted log.
>
>2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage collector is: 860021
>2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage collector is: 864316
>
>> Any new unhandled errno values should definitely result in an exception
>> being logged (notice that the `raise? which follows the checks for
>> various errno values is inside a try/except which logs any exception).
>
>I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or EPERM?
>
>                except socket.error, e:
>                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
>                        self.numberAccepts = i
>                        break
>                    elif e.args[0] == EPERM:
>                        # Netfilter on Linux may have rejected the
>                        # connection, but we get told to try to accept()
>                        # anyway.
>                        continue
>
>
>I am not sure how to debug this problem- I have another twisted server of a different type on that machine, and while the problematic server stops accepting connections, the second one works just fine, so this is not a machine-wide issue.
>What could it be?

You could try running strace against the server while it's not accepting
connections.  You can limit the output to just accept calls, too:

   strace -p <pid> -etrace=accept

Maybe this will show you that accept calls are happening but failing in
some way.  If it produces no output, you can widen it and see if you can
tell what the server is doing if it isn't calling accept().

Jean-Paul



From matusis at yahoo.com  Wed Sep 10 18:04:40 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Wed, 10 Sep 2008 15:04:40 -0700
Subject: [Twisted-Python] intermittent problem: not
	accepting	new	connections
In-Reply-To: <20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
References: <045201c91388$67f836d0$37e8a470$@com>
	<20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
Message-ID: <048001c91391$3991ec60$acb5c520$@com>

> You could try running strace against the server while it's not
> accepting
> connections.  

I have one short question before I try strace on live:

I have been playing with strace this morning on my dev, and I observe that for every second connection, there are two accept calls, one is success and one is a failure:

1st connection:

accept(9, {sa_family=AF_INET, sin_port=htons(33375), sin_addr=inet_addr("10.14.0.2")}, [16]) = 22
(client disconnects)

2nd connection:
accept(9, {sa_family=AF_INET, sin_port=htons(33519), sin_addr=inet_addr("10.14.0.2")}, [16]) = 22
accept(9, 0xbfaada10, [16])             = -1 EAGAIN (Resource temporarily unavailable)
(client disconnects)

3d connection:
accept(9, {sa_family=AF_INET, sin_port=htons(33375), sin_addr=inet_addr("10.14.0.2")}, [16]) = 22
(client disconnects)

4th connection:
accept(9, {sa_family=AF_INET, sin_port=htons(33519), sin_addr=inet_addr("10.14.0.2")}, [16]) = 22
accept(9, 0xbfaada10, [16])             = -1 EAGAIN (Resource temporarily unavailable)
....
and so on.

What is the meaning of 
accept(9, 0xbfaada10, [16])             = -1 EAGAIN (Resource temporarily unavailable) 
that occurs every second connection?


> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Wednesday, September 10, 2008 2:47 PM
> To: Twisted general discussion
> Subject: RE: [Twisted-Python] intermittent problem: not accepting new
> connections
> 
> On Wed, 10 Sep 2008 14:01:27 -0700, Alec Matusis <matusis at yahoo.com>
> wrote:
> >> Do non-error log messages continue to appear in the Twisted log?
> ie,
> >> is
> >> it clear that the logging system is still working, or could it have
> >> failed
> >> in some way, obscuring any exception reports?
> >
> >Yes, I print the results of garbage collection every 10 min like this:
> >
> >print "number of objects tracked by the garbage collector is:",
> len(gc.get_objects())
> >
> >and they appear in the main twisted log.
> >
> >2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage
> collector is: 860021
> >2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage
> collector is: 864316
> >
> >> Any new unhandled errno values should definitely result in an
> exception
> >> being logged (notice that the `raise? which follows the checks for
> >> various errno values is inside a try/except which logs any
> exception).
> >
> >I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or
> EPERM?
> >
> >                except socket.error, e:
> >                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
> >                        self.numberAccepts = i
> >                        break
> >                    elif e.args[0] == EPERM:
> >                        # Netfilter on Linux may have rejected the
> >                        # connection, but we get told to try to
> accept()
> >                        # anyway.
> >                        continue
> >
> >
> >I am not sure how to debug this problem- I have another twisted server
> of a different type on that machine, and while the problematic server
> stops accepting connections, the second one works just fine, so this is
> not a machine-wide issue.
> >What could it be?
> 
> You could try running strace against the server while it's not
> accepting
> connections.  You can limit the output to just accept calls, too:
> 
>    strace -p <pid> -etrace=accept
> 
> Maybe this will show you that accept calls are happening but failing in
> some way.  If it produces no output, you can widen it and see if you
> can
> tell what the server is doing if it isn't calling accept().
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Wed Sep 10 18:16:21 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 10 Sep 2008 18:16:21 -0400
Subject: [Twisted-Python] intermittent problem: not
	accepting	new	connections
In-Reply-To: <048001c91391$3991ec60$acb5c520$@com>
Message-ID: <20080910221621.29191.905092360.divmod.quotient.24276@ohm>

On Wed, 10 Sep 2008 15:04:40 -0700, Alec Matusis <matusis at yahoo.com> wrote:
>> You could try running strace against the server while it's not
>> accepting
>> connections.
>
>I have one short question before I try strace on live:
>
>I have been playing with strace this morning on my dev, and I observe that for every second connection, there are two accept calls, one is success and one is a failure:

I'm pretty sure this is a consequence of a heuristic optimization in the
accept loop.  When one connection is successfully accepted, a counter is
incremented.  Whenever it tries to accept connections, it will try up to
the number of times indicated by the current value of the counter.  When
it fails to get a new connection, it drops the counter to the number of
connections it did accept.  So in a lot of cases, it's flipping back and
forth between 1 and 2 attempts.

The point of this is that if you're receiving lots of connection attempts,
it'd be faster to accept many of them at once instead of only accepting one
each time around the reactor loop.  It's not clear the current implementation
is the best way to implement this optimization, but at least the code is very
old and hasn't changed in quite a while, so it's probably not actually causing
any problems.

Jean-Paul



From matusis at yahoo.com  Wed Sep 10 20:28:07 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Wed, 10 Sep 2008 17:28:07 -0700
Subject: [Twisted-Python] intermittent problem: not
	accepting	new	connections
In-Reply-To: <20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
References: <045201c91388$67f836d0$37e8a470$@com>
	<20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
Message-ID: <04d701c913a5$44074af0$cc15e0d0$@com>

> You could try running strace against the server while it's not
> accepting
> connections.  


It went into this regime again tonight, and I captured strace.

A few remarks first:

The outage was brief, it lasted about 3 min. It did not correspond to the peak number of connections.
The application has several protocols (like manhole and various control ports), that are listening on different ports.
When the server stopped accepting connections on the main port (where external internet clients connect), telnet connection to manhole and control ports are still possible.
Also, I think when it is in this bad state, it does accept some external connections, maybe 50%.

Anyway, here's the strace in the bad state:

accept(9, {sa_family=AF_INET, sin_port=htons(1474), sin_addr=inet_addr("83.153.87.198")}, [13980580626831507472]) = 491
accept(13, {sa_family=AF_INET, sin_port=htons(40953), sin_addr=inet_addr("10.18.2.10")}, [17987095445330984976]) = 491
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(9, {sa_family=AF_INET, sin_port=htons(50679), sin_addr=inet_addr("24.166.18.207")}, [17853676306370134032]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(52873), sin_addr=inet_addr("67.87.61.193")}, [9929874236988456976]) = 493
accept(9, {sa_family=AF_INET, sin_port=htons(54305), sin_addr=inet_addr("200.114.45.212")}, [2437573306904215568]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2246), sin_addr=inet_addr("76.11.66.253")}, [14269655427913351184]) = 491
accept(9, {sa_family=AF_INET, sin_port=htons(32824), sin_addr=inet_addr("75.62.105.81")}, [4071254071732862992]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2262), sin_addr=inet_addr("76.11.66.253")}, [15422576932520198160]) = 491
accept(9, {sa_family=AF_INET, sin_port=htons(3316), sin_addr=inet_addr("24.127.249.90")}, [17585430653564878864]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(4466), sin_addr=inet_addr("72.241.229.233")}, [8219350803517800464]) = 491
accept(9, {sa_family=AF_INET, sin_port=htons(1651), sin_addr=inet_addr("67.82.141.97")}, [8288312172811911184]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2669), sin_addr=inet_addr("24.94.231.135")}, [7857092508491186192]) = 398
accept(9, {sa_family=AF_INET, sin_port=htons(50252), sin_addr=inet_addr("97.119.52.164")}, [5531546250907746320]) = 398
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2675), sin_addr=inet_addr("70.4.222.71")}, [8289438072718753808]) = 398
accept(9, {sa_family=AF_INET, sin_port=htons(63671), sin_addr=inet_addr("69.22.255.174")}, [13256345511754989584]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(54520), sin_addr=inet_addr("92.130.148.171")}, [17929956025058721808]) = 491
accept(13, {sa_family=AF_INET, sin_port=htons(41056), sin_addr=inet_addr("10.18.2.10")}, [6962565032504721424]) = 491
accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(49296), sin_addr=inet_addr("66.214.238.42")}, [10430336745580003344]) = 161
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(13, {sa_family=AF_INET, sin_port=htons(41199), sin_addr=inet_addr("10.18.2.10")}, [17266800979928416272]) = 161
accept(9, {sa_family=AF_INET, sin_port=htons(49376), sin_addr=inet_addr("68.34.251.86")}, [16194944268614238224]) = 161
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(13, {sa_family=AF_INET, sin_port=htons(41497), sin_addr=inet_addr("10.18.2.10")}, [1847038805765259280]) = 161
accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(9, {sa_family=AF_INET, sin_port=htons(50013), sin_addr=inet_addr("71.241.76.86")}, [6756243874575810576]) = 161
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
--- SIGCHLD (Child exited) @ 0 (0) ---
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(9, {sa_family=AF_INET, sin_port=htons(2594), sin_addr=inet_addr("24.27.123.223")}, [2452772955646590992]) = 161
accept(9, {sa_family=AF_INET, sin_port=htons(1690), sin_addr=inet_addr("67.242.75.46")}, [11098558340291100688]) = 276
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(41825), sin_addr=inet_addr("10.18.2.10")}, [7035467051472781328]) = 276
accept(13, {sa_family=AF_INET, sin_port=htons(41910), sin_addr=inet_addr("10.18.2.10")}, [13160362544696655888]) = 276



here's the strace in the normal state:


accept(9, {sa_family=AF_INET, sin_port=htons(40442), sin_addr=inet_addr("74.140.139.210")}, [18058590089415491600]) = 2218
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(58477), sin_addr=inet_addr("99.194.115.132")}, [7918454053414109200]) = 431
accept(13, {sa_family=AF_INET, sin_port=htons(50878), sin_addr=inet_addr("10.18.2.10")}, [13746674921184952336]) = 356
accept(9, {sa_family=AF_INET, sin_port=htons(1154), sin_addr=inet_addr("190.37.68.45")}, [9368613133427408912]) = 356
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(9, {sa_family=AF_INET, sin_port=htons(1212), sin_addr=inet_addr("125.60.240.211")}, [13547953587627229200]) = 356
accept(9, {sa_family=AF_INET, sin_port=htons(1158), sin_addr=inet_addr("190.37.68.45")}, [9656843509579120656]) = 2223
accept(9, {sa_family=AF_INET, sin_port=htons(52008), sin_addr=inet_addr("24.189.205.204")}, [2939443190379315216]) = 2224
accept(9, {sa_family=AF_INET, sin_port=htons(50808), sin_addr=inet_addr("72.155.68.155")}, [8702643338529996816]) = 2253
accept(9, {sa_family=AF_INET, sin_port=htons(2545), sin_addr=inet_addr("24.10.61.223")}, [17368413446520963088]) = 2263
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2547), sin_addr=inet_addr("24.10.61.223")}, [17512528634596818960]) = 356
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(52012), sin_addr=inet_addr("24.189.205.204")}, [3227673566531026960]) = 180
accept(9, {sa_family=AF_INET, sin_port=htons(50809), sin_addr=inet_addr("72.155.68.155")}, [8774700932567924752]) = 2224
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1223), sin_addr=inet_addr("125.60.240.211")}, [14340587122044436496]) = 2253
accept(9, {sa_family=AF_INET, sin_port=htons(2462), sin_addr=inet_addr("206.74.170.35")}, [11387633141372944400]) = 2263
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2464), sin_addr=inet_addr("206.74.170.35")}, [11531748329448800272]) = 2263
accept(9, {sa_family=AF_INET, sin_port=htons(1645), sin_addr=inet_addr("61.145.215.253")}, [7855966608584343568]) = 2224
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(4172), sin_addr=inet_addr("68.188.149.222")}, [5480880755099828240]) = 1283
accept(9, {sa_family=AF_INET, sin_port=htons(50931), sin_addr=inet_addr("70.129.57.218")}, [17565727405195132944]) = 1283
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(4173), sin_addr=inet_addr("68.188.149.222")}, [5552938349137756176]) = 2224
accept(9, {sa_family=AF_INET, sin_port=htons(1122), sin_addr=inet_addr("76.127.204.185")}, [7062770124213714960]) = 1283
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(51062), sin_addr=inet_addr("10.18.2.10")}, [8558809625430851600]) = 2292
accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1646), sin_addr=inet_addr("61.145.215.253")}, [7928024202622271504]) = 2292
accept(9, {sa_family=AF_INET, sin_port=htons(50932), sin_addr=inet_addr("70.129.57.218")}, [17637784999233060880]) = 2310
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(4001), sin_addr=inet_addr("99.13.103.221")}, [11605494773346992144]) = 507
accept(9, {sa_family=AF_INET, sin_port=htons(4004), sin_addr=inet_addr("99.13.103.221")}, [11821667555460775952]) = 507
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1131), sin_addr=inet_addr("76.127.204.185")}, [7711288470555066384]) = 1283
accept(9, {sa_family=AF_INET, sin_port=htons(2143), sin_addr=inet_addr("202.156.50.129")}, [6847723242006773776]) = 1894
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2146), sin_addr=inet_addr("202.156.50.129")}, [7063896024120557584]) = 1894
accept(9, {sa_family=AF_INET, sin_port=htons(1779), sin_addr=inet_addr("222.165.66.136")}, [17511684209666686992]) = 1278
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(61674), sin_addr=inet_addr("99.230.169.52")}, [16929031007875629072]) = 1278
accept(9, {sa_family=AF_INET, sin_port=htons(61679), sin_addr=inet_addr("99.230.169.52")}, [17289318978065268752]) = 1278
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1780), sin_addr=inet_addr("222.165.66.136")}, [17583741803704614928]) = 1913
accept(9, {sa_family=AF_INET, sin_port=htons(52495), sin_addr=inet_addr("190.40.52.74")}, [1138566289384538128]) = 2310
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(51181), sin_addr=inet_addr("10.18.2.10")}, [17133663315944275984]) = 2310
accept(9, {sa_family=AF_INET, sin_port=htons(60995), sin_addr=inet_addr("88.105.44.33")}, [4894849853588242448]) = 2310
accept(9, {sa_family=AF_INET, sin_port=htons(3636), sin_addr=inet_addr("71.64.15.79")}, [3750935548236136464]) = 2310
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(51273), sin_addr=inet_addr("10.18.2.10")}, [5316499368700805136]) = 2334
accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(52498), sin_addr=inet_addr("190.40.52.74")}, [1354739071498321936]) = 2334
accept(9, {sa_family=AF_INET, sin_port=htons(1440), sin_addr=inet_addr("24.21.117.196")}, [11530622429541957648]) = 2334
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1442), sin_addr=inet_addr("24.21.117.196")}, [11674737617617813520]) = 2334
accept(9, {sa_family=AF_INET, sin_port=htons(60996), sin_addr=inet_addr("88.105.44.33")}, [4966907447626170384]) = 2336
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(51345), sin_addr=inet_addr("10.18.2.10")}, [10504646139431616528]) = 2337
accept(13, {sa_family=AF_INET, sin_port=htons(51348), sin_addr=inet_addr("10.18.2.10")}, [10720818921545400336]) = 2337

The only noticeable difference is the frequency of 
--- SIGCHLD (Child exited) @ 0 (0) ---
but it occurred in the normal state as well.
The server sends emails via child subprocesses, so I suspect Child exited may be due to that.

If that's the case, the strace output is identical, and I do not understand what's causing the problem at all.


> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Wednesday, September 10, 2008 2:47 PM
> To: Twisted general discussion
> Subject: RE: [Twisted-Python] intermittent problem: not accepting new
> connections
> 
> On Wed, 10 Sep 2008 14:01:27 -0700, Alec Matusis <matusis at yahoo.com>
> wrote:
> >> Do non-error log messages continue to appear in the Twisted log?
> ie,
> >> is
> >> it clear that the logging system is still working, or could it have
> >> failed
> >> in some way, obscuring any exception reports?
> >
> >Yes, I print the results of garbage collection every 10 min like this:
> >
> >print "number of objects tracked by the garbage collector is:",
> len(gc.get_objects())
> >
> >and they appear in the main twisted log.
> >
> >2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage
> collector is: 860021
> >2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage
> collector is: 864316
> >
> >> Any new unhandled errno values should definitely result in an
> exception
> >> being logged (notice that the `raise? which follows the checks for
> >> various errno values is inside a try/except which logs any
> exception).
> >
> >I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or
> EPERM?
> >
> >                except socket.error, e:
> >                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
> >                        self.numberAccepts = i
> >                        break
> >                    elif e.args[0] == EPERM:
> >                        # Netfilter on Linux may have rejected the
> >                        # connection, but we get told to try to
> accept()
> >                        # anyway.
> >                        continue
> >
> >
> >I am not sure how to debug this problem- I have another twisted server
> of a different type on that machine, and while the problematic server
> stops accepting connections, the second one works just fine, so this is
> not a machine-wide issue.
> >What could it be?
> 
> You could try running strace against the server while it's not
> accepting
> connections.  You can limit the output to just accept calls, too:
> 
>    strace -p <pid> -etrace=accept
> 
> Maybe this will show you that accept calls are happening but failing in
> some way.  If it produces no output, you can widen it and see if you
> can
> tell what the server is doing if it isn't calling accept().
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From wthie at thiengineering.ch  Thu Sep 11 06:23:10 2008
From: wthie at thiengineering.ch (Werner Thie)
Date: Thu, 11 Sep 2008 12:23:10 +0200
Subject: [Twisted-Python] intermittent problem:
	not	accepting	new	connections
In-Reply-To: <04d701c913a5$44074af0$cc15e0d0$@com>
References: <045201c91388$67f836d0$37e8a470$@com>	<20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
	<04d701c913a5$44074af0$cc15e0d0$@com>
Message-ID: <48C8F18E.8090807@thiengineering.ch>

Hi Alec

just wondering...

How does netstat look like?

We ran into problems resource wise with the number of open connections 
aka file descriptors per process and observed similar problems to yours, 
also by switching to a new server.

How does ulimit -a compare between old and new machine?

HTH, Werner

Alec Matusis wrote:
>> You could try running strace against the server while it's not
>> accepting
>> connections.  
> 
> 
> It went into this regime again tonight, and I captured strace.
> 
> A few remarks first:
> 
> The outage was brief, it lasted about 3 min. It did not correspond to the peak number of connections.
> The application has several protocols (like manhole and various control ports), that are listening on different ports.
> When the server stopped accepting connections on the main port (where external internet clients connect), telnet connection to manhole and control ports are still possible.
> Also, I think when it is in this bad state, it does accept some external connections, maybe 50%.
> 
> Anyway, here's the strace in the bad state:
> 
> accept(9, {sa_family=AF_INET, sin_port=htons(1474), sin_addr=inet_addr("83.153.87.198")}, [13980580626831507472]) = 491
> accept(13, {sa_family=AF_INET, sin_port=htons(40953), sin_addr=inet_addr("10.18.2.10")}, [17987095445330984976]) = 491
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(9, {sa_family=AF_INET, sin_port=htons(50679), sin_addr=inet_addr("24.166.18.207")}, [17853676306370134032]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(52873), sin_addr=inet_addr("67.87.61.193")}, [9929874236988456976]) = 493
> accept(9, {sa_family=AF_INET, sin_port=htons(54305), sin_addr=inet_addr("200.114.45.212")}, [2437573306904215568]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2246), sin_addr=inet_addr("76.11.66.253")}, [14269655427913351184]) = 491
> accept(9, {sa_family=AF_INET, sin_port=htons(32824), sin_addr=inet_addr("75.62.105.81")}, [4071254071732862992]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2262), sin_addr=inet_addr("76.11.66.253")}, [15422576932520198160]) = 491
> accept(9, {sa_family=AF_INET, sin_port=htons(3316), sin_addr=inet_addr("24.127.249.90")}, [17585430653564878864]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(4466), sin_addr=inet_addr("72.241.229.233")}, [8219350803517800464]) = 491
> accept(9, {sa_family=AF_INET, sin_port=htons(1651), sin_addr=inet_addr("67.82.141.97")}, [8288312172811911184]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2669), sin_addr=inet_addr("24.94.231.135")}, [7857092508491186192]) = 398
> accept(9, {sa_family=AF_INET, sin_port=htons(50252), sin_addr=inet_addr("97.119.52.164")}, [5531546250907746320]) = 398
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2675), sin_addr=inet_addr("70.4.222.71")}, [8289438072718753808]) = 398
> accept(9, {sa_family=AF_INET, sin_port=htons(63671), sin_addr=inet_addr("69.22.255.174")}, [13256345511754989584]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(54520), sin_addr=inet_addr("92.130.148.171")}, [17929956025058721808]) = 491
> accept(13, {sa_family=AF_INET, sin_port=htons(41056), sin_addr=inet_addr("10.18.2.10")}, [6962565032504721424]) = 491
> accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(49296), sin_addr=inet_addr("66.214.238.42")}, [10430336745580003344]) = 161
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(13, {sa_family=AF_INET, sin_port=htons(41199), sin_addr=inet_addr("10.18.2.10")}, [17266800979928416272]) = 161
> accept(9, {sa_family=AF_INET, sin_port=htons(49376), sin_addr=inet_addr("68.34.251.86")}, [16194944268614238224]) = 161
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(13, {sa_family=AF_INET, sin_port=htons(41497), sin_addr=inet_addr("10.18.2.10")}, [1847038805765259280]) = 161
> accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(9, {sa_family=AF_INET, sin_port=htons(50013), sin_addr=inet_addr("71.241.76.86")}, [6756243874575810576]) = 161
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> --- SIGCHLD (Child exited) @ 0 (0) ---
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(9, {sa_family=AF_INET, sin_port=htons(2594), sin_addr=inet_addr("24.27.123.223")}, [2452772955646590992]) = 161
> accept(9, {sa_family=AF_INET, sin_port=htons(1690), sin_addr=inet_addr("67.242.75.46")}, [11098558340291100688]) = 276
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(41825), sin_addr=inet_addr("10.18.2.10")}, [7035467051472781328]) = 276
> accept(13, {sa_family=AF_INET, sin_port=htons(41910), sin_addr=inet_addr("10.18.2.10")}, [13160362544696655888]) = 276
> 
> 
> 
> here's the strace in the normal state:
> 
> 
> accept(9, {sa_family=AF_INET, sin_port=htons(40442), sin_addr=inet_addr("74.140.139.210")}, [18058590089415491600]) = 2218
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(58477), sin_addr=inet_addr("99.194.115.132")}, [7918454053414109200]) = 431
> accept(13, {sa_family=AF_INET, sin_port=htons(50878), sin_addr=inet_addr("10.18.2.10")}, [13746674921184952336]) = 356
> accept(9, {sa_family=AF_INET, sin_port=htons(1154), sin_addr=inet_addr("190.37.68.45")}, [9368613133427408912]) = 356
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(9, {sa_family=AF_INET, sin_port=htons(1212), sin_addr=inet_addr("125.60.240.211")}, [13547953587627229200]) = 356
> accept(9, {sa_family=AF_INET, sin_port=htons(1158), sin_addr=inet_addr("190.37.68.45")}, [9656843509579120656]) = 2223
> accept(9, {sa_family=AF_INET, sin_port=htons(52008), sin_addr=inet_addr("24.189.205.204")}, [2939443190379315216]) = 2224
> accept(9, {sa_family=AF_INET, sin_port=htons(50808), sin_addr=inet_addr("72.155.68.155")}, [8702643338529996816]) = 2253
> accept(9, {sa_family=AF_INET, sin_port=htons(2545), sin_addr=inet_addr("24.10.61.223")}, [17368413446520963088]) = 2263
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2547), sin_addr=inet_addr("24.10.61.223")}, [17512528634596818960]) = 356
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(52012), sin_addr=inet_addr("24.189.205.204")}, [3227673566531026960]) = 180
> accept(9, {sa_family=AF_INET, sin_port=htons(50809), sin_addr=inet_addr("72.155.68.155")}, [8774700932567924752]) = 2224
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1223), sin_addr=inet_addr("125.60.240.211")}, [14340587122044436496]) = 2253
> accept(9, {sa_family=AF_INET, sin_port=htons(2462), sin_addr=inet_addr("206.74.170.35")}, [11387633141372944400]) = 2263
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2464), sin_addr=inet_addr("206.74.170.35")}, [11531748329448800272]) = 2263
> accept(9, {sa_family=AF_INET, sin_port=htons(1645), sin_addr=inet_addr("61.145.215.253")}, [7855966608584343568]) = 2224
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(4172), sin_addr=inet_addr("68.188.149.222")}, [5480880755099828240]) = 1283
> accept(9, {sa_family=AF_INET, sin_port=htons(50931), sin_addr=inet_addr("70.129.57.218")}, [17565727405195132944]) = 1283
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(4173), sin_addr=inet_addr("68.188.149.222")}, [5552938349137756176]) = 2224
> accept(9, {sa_family=AF_INET, sin_port=htons(1122), sin_addr=inet_addr("76.127.204.185")}, [7062770124213714960]) = 1283
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(51062), sin_addr=inet_addr("10.18.2.10")}, [8558809625430851600]) = 2292
> accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1646), sin_addr=inet_addr("61.145.215.253")}, [7928024202622271504]) = 2292
> accept(9, {sa_family=AF_INET, sin_port=htons(50932), sin_addr=inet_addr("70.129.57.218")}, [17637784999233060880]) = 2310
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(4001), sin_addr=inet_addr("99.13.103.221")}, [11605494773346992144]) = 507
> accept(9, {sa_family=AF_INET, sin_port=htons(4004), sin_addr=inet_addr("99.13.103.221")}, [11821667555460775952]) = 507
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1131), sin_addr=inet_addr("76.127.204.185")}, [7711288470555066384]) = 1283
> accept(9, {sa_family=AF_INET, sin_port=htons(2143), sin_addr=inet_addr("202.156.50.129")}, [6847723242006773776]) = 1894
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2146), sin_addr=inet_addr("202.156.50.129")}, [7063896024120557584]) = 1894
> accept(9, {sa_family=AF_INET, sin_port=htons(1779), sin_addr=inet_addr("222.165.66.136")}, [17511684209666686992]) = 1278
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(61674), sin_addr=inet_addr("99.230.169.52")}, [16929031007875629072]) = 1278
> accept(9, {sa_family=AF_INET, sin_port=htons(61679), sin_addr=inet_addr("99.230.169.52")}, [17289318978065268752]) = 1278
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1780), sin_addr=inet_addr("222.165.66.136")}, [17583741803704614928]) = 1913
> accept(9, {sa_family=AF_INET, sin_port=htons(52495), sin_addr=inet_addr("190.40.52.74")}, [1138566289384538128]) = 2310
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(51181), sin_addr=inet_addr("10.18.2.10")}, [17133663315944275984]) = 2310
> accept(9, {sa_family=AF_INET, sin_port=htons(60995), sin_addr=inet_addr("88.105.44.33")}, [4894849853588242448]) = 2310
> accept(9, {sa_family=AF_INET, sin_port=htons(3636), sin_addr=inet_addr("71.64.15.79")}, [3750935548236136464]) = 2310
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(51273), sin_addr=inet_addr("10.18.2.10")}, [5316499368700805136]) = 2334
> accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(52498), sin_addr=inet_addr("190.40.52.74")}, [1354739071498321936]) = 2334
> accept(9, {sa_family=AF_INET, sin_port=htons(1440), sin_addr=inet_addr("24.21.117.196")}, [11530622429541957648]) = 2334
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1442), sin_addr=inet_addr("24.21.117.196")}, [11674737617617813520]) = 2334
> accept(9, {sa_family=AF_INET, sin_port=htons(60996), sin_addr=inet_addr("88.105.44.33")}, [4966907447626170384]) = 2336
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(51345), sin_addr=inet_addr("10.18.2.10")}, [10504646139431616528]) = 2337
> accept(13, {sa_family=AF_INET, sin_port=htons(51348), sin_addr=inet_addr("10.18.2.10")}, [10720818921545400336]) = 2337
> 
> The only noticeable difference is the frequency of 
> --- SIGCHLD (Child exited) @ 0 (0) ---
> but it occurred in the normal state as well.
> The server sends emails via child subprocesses, so I suspect Child exited may be due to that.
> 
> If that's the case, the strace output is identical, and I do not understand what's causing the problem at all.
> 
> 
>> -----Original Message-----
>> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
>> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
>> Sent: Wednesday, September 10, 2008 2:47 PM
>> To: Twisted general discussion
>> Subject: RE: [Twisted-Python] intermittent problem: not accepting new
>> connections
>>
>> On Wed, 10 Sep 2008 14:01:27 -0700, Alec Matusis <matusis at yahoo.com>
>> wrote:
>>>> Do non-error log messages continue to appear in the Twisted log?
>> ie,
>>>> is
>>>> it clear that the logging system is still working, or could it have
>>>> failed
>>>> in some way, obscuring any exception reports?
>>> Yes, I print the results of garbage collection every 10 min like this:
>>>
>>> print "number of objects tracked by the garbage collector is:",
>> len(gc.get_objects())
>>> and they appear in the main twisted log.
>>>
>>> 2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage
>> collector is: 860021
>>> 2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage
>> collector is: 864316
>>>> Any new unhandled errno values should definitely result in an
>> exception
>>>> being logged (notice that the `raise? which follows the checks for
>>>> various errno values is inside a try/except which logs any
>> exception).
>>> I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or
>> EPERM?
>>>                except socket.error, e:
>>>                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
>>>                        self.numberAccepts = i
>>>                        break
>>>                    elif e.args[0] == EPERM:
>>>                        # Netfilter on Linux may have rejected the
>>>                        # connection, but we get told to try to
>> accept()
>>>                        # anyway.
>>>                        continue
>>>
>>>
>>> I am not sure how to debug this problem- I have another twisted server
>> of a different type on that machine, and while the problematic server
>> stops accepting connections, the second one works just fine, so this is
>> not a machine-wide issue.
>>> What could it be?
>> You could try running strace against the server while it's not
>> accepting
>> connections.  You can limit the output to just accept calls, too:
>>
>>    strace -p <pid> -etrace=accept
>>
>> Maybe this will show you that accept calls are happening but failing in
>> some way.  If it produces no output, you can widen it and see if you
>> can
>> tell what the server is doing if it isn't calling accept().
>>
>> Jean-Paul
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From paul.nendick at gmail.com  Thu Sep 11 09:31:38 2008
From: paul.nendick at gmail.com (Paul C. Nendick)
Date: Thu, 11 Sep 2008 14:31:38 +0100
Subject: [Twisted-Python] intermittent problem: not accepting new
	connections
In-Reply-To: <48C8F18E.8090807@thiengineering.ch>
References: <045201c91388$67f836d0$37e8a470$@com>
	<20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
	<04d701c913a5$44074af0$cc15e0d0$@com>
	<48C8F18E.8090807@thiengineering.ch>
Message-ID: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>

Not necessarily related to what you've described, but I'll share
something that's helped a good deal on my most-heavily hit twisted
servers. Presuming you're using Linux:

 echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle


from http://lartc.org/howto/lartc.kernel.obscure.html :

"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
should not be changed without advice/request of technical experts"

My expert advice: only use this on machines connected on a low-latency
LAN. It *will* break internet-facing interfaces. It halves the
constant used by the Nagle algorithm:

http://en.wikipedia.org/wiki/Nagle's_algorithm

Kind regards,

/p



From exarkun at divmod.com  Thu Sep 11 09:46:51 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 11 Sep 2008 09:46:51 -0400
Subject: [Twisted-Python] intermittent problem: not accepting new
	connections
In-Reply-To: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>
Message-ID: <20080911134651.29191.1030196475.divmod.quotient.24599@ohm>

On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick" <paul.nendick at gmail.com> wrote:
>Not necessarily related to what you've described, but I'll share
>something that's helped a good deal on my most-heavily hit twisted
>servers. Presuming you're using Linux:
>
> echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
>
>
>from http://lartc.org/howto/lartc.kernel.obscure.html :
>
>"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
>should not be changed without advice/request of technical experts"
>
>My expert advice: only use this on machines connected on a low-latency
>LAN. It *will* break internet-facing interfaces. It halves the
>constant used by the Nagle algorithm:
>
>http://en.wikipedia.org/wiki/Nagle's_algorithm
>

This is somewhat interesting.  It suggests a potential problem which
I hadn't thought about before.  If you need to accept more than about
64k connections (not necessarily concurrent) in less than TIME-WAIT
seconds, you might run out of ports.  Anyone know what happens to new
connection attempts to a server in this condition?

Alec, any idea if your server could be getting into this state every
once in a while?  This is an appealing hypothesis, since it wouldn't
necessarily happen at peak connection time (but potentially shortly
after a peak), would resolve itself given a short period of time,
wouldn't necessarily prevent all new connection attempts, since old
TIME-WAIT sockets would be gradually timing out (so your other low-
volume servers might still appear to be working normally), wouldn't
interfere with already established connections, and might not change
the userspace-visible syscall behavior (depending on what Linux does
in this case, but I wouldn't be surprised if connection failures due
to this never showed up in an accept(2) result).

Jean-Paul



From p.mayers at imperial.ac.uk  Thu Sep 11 10:38:06 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Thu, 11 Sep 2008 15:38:06 +0100
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
References: <20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
Message-ID: <48C92D4E.4050301@imperial.ac.uk>

Jean-Paul Calderone wrote:
> On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick" 
> <paul.nendick at gmail.com> wrote:
>> Not necessarily related to what you've described, but I'll share
>> something that's helped a good deal on my most-heavily hit twisted
>> servers. Presuming you're using Linux:
>>
>> echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
>>
>>
>> from http://lartc.org/howto/lartc.kernel.obscure.html :
>>
>> "Enable fast recycling TIME-WAIT sockets. Default value is 1. It
>> should not be changed without advice/request of technical experts"
>>
>> My expert advice: only use this on machines connected on a low-latency
>> LAN. It *will* break internet-facing interfaces. It halves the
>> constant used by the Nagle algorithm:
>>
>> http://en.wikipedia.org/wiki/Nagle's_algorithm
>>
> 
> This is somewhat interesting.  It suggests a potential problem which
> I hadn't thought about before.  If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports.  Anyone know what happens to new
> connection attempts to a server in this condition?

Why would you run out of ports? accept()ed sockets use the same port as 
the listen()ing socket.

Shortening TIME_WAIT just saves on kernel memory.



From exarkun at divmod.com  Thu Sep 11 10:44:36 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 11 Sep 2008 10:44:36 -0400
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <48C92D4E.4050301@imperial.ac.uk>
Message-ID: <20080911144436.29191.1117458156.divmod.quotient.24620@ohm>

On Thu, 11 Sep 2008 15:38:06 +0100, Phil Mayers <p.mayers at imperial.ac.uk> wrote:
>Jean-Paul Calderone wrote:
>>On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick" 
>><paul.nendick at gmail.com> wrote:
>>>Not necessarily related to what you've described, but I'll share
>>>something that's helped a good deal on my most-heavily hit twisted
>>>servers. Presuming you're using Linux:
>>>
>>>echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
>>>
>>>
>>>from http://lartc.org/howto/lartc.kernel.obscure.html :
>>>
>>>"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
>>>should not be changed without advice/request of technical experts"
>>>
>>>My expert advice: only use this on machines connected on a low-latency
>>>LAN. It *will* break internet-facing interfaces. It halves the
>>>constant used by the Nagle algorithm:
>>>
>>>http://en.wikipedia.org/wiki/Nagle's_algorithm
>>
>>This is somewhat interesting.  It suggests a potential problem which
>>I hadn't thought about before.  If you need to accept more than about
>>64k connections (not necessarily concurrent) in less than TIME-WAIT
>>seconds, you might run out of ports.  Anyone know what happens to new
>>connection attempts to a server in this condition?
>
>Why would you run out of ports? accept()ed sockets use the same port as the 
>listen()ing socket.

Uh yes, I guess that would be a fatal flaw in this hypothesis.  Woops. :)

Jean-Paul



From matusis at yahoo.com  Thu Sep 11 15:57:51 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Thu, 11 Sep 2008 12:57:51 -0700
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
References: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>
	<20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
Message-ID: <06c801c91448$b1a8f290$14fad7b0$@com>

> How does ulimit -a compare between old and new machine?

ulimit is only higher on the new machine, I upped it. Also, from my
experience, running into  ulimits produces log messages. 

alecm at serv2 ~> cat /proc/23678/limits 

Limit                     Soft Limit           Hard Limit           Units

Max cpu time              unlimited            unlimited            ms

Max file size             unlimited            unlimited            bytes

Max data size             unlimited            unlimited            bytes

Max stack size            8388608              unlimited            bytes

Max core file size        0                    unlimited            bytes

Max resident set          1073741824           1073741824           bytes

Max processes             126976               126976
processes 
Max open files            25000                25000                files

Max locked memory         32768                32768                bytes

Max address space         unlimited            unlimited            bytes

Max file locks            unlimited            unlimited            locks

Max pending signals       126976               126976               signals

Max msgqueue size         819200               819200               bytes

Max nice priority         0                    0                    
Max realtime priority     0                    0                    


> If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports.  

> How does netstat look like?

I have to wait for another outage tonight, to get more definite results on
this.
So far, I have had only one very brief outage at 7:46am
I was asleep, but I have some new data logged.
I have two servers, one on port 5222 (problematic one, let's call it serv1
), and one on 5228 (that has no problems, call it serv2 ).
I made a script that measures the number of connections on each type of
server respectively like this:

while [ 1 ]
do
 sleep 5
 netstat -ant | grep ESTABLISHED | awk '/:5228 /{a += 1}/:5222 /{b += 1} END
{print strftime(" %d %b %Y %H:%M:%S", systime(
))"   serv2: "a"   serv1: "b" total: "a+b }'
done

This is what happened around 7:46am (lines that have "+" in front indicate
anomaly):

 11 Sep 2008 07:41:29   serv2: 2756   serv1: 1064 total: 3820
 11 Sep 2008 07:41:36   serv2: 2764   serv1: 1062 total: 3826
 11 Sep 2008 07:41:44   serv2: 2784   serv1: 1049 total: 3833
 11 Sep 2008 07:41:51   serv2: 2756   serv1: 1055 total: 3811
 11 Sep 2008 07:41:59   serv2: 2760   serv1: 1066 total: 3826
 11 Sep 2008 07:42:06   serv2: 2777   serv1: 1050 total: 3827
 11 Sep 2008 07:42:14   serv2: 2769   serv1: 1054 total: 3823
 11 Sep 2008 07:42:21   serv2: 2751   serv1: 1055 total: 3806
 11 Sep 2008 07:42:29   serv2: 2760   serv1: 1050 total: 3810
 11 Sep 2008 07:42:36   serv2: 2747   serv1: 1040 total: 3787
 11 Sep 2008 07:42:44   serv2: 2737   serv1: 1046 total: 3783
 11 Sep 2008 07:42:51   serv2: 2739   serv1: 1046 total: 3785
 11 Sep 2008 07:42:59   serv2: 2743   serv1: 1037 total: 3780
 11 Sep 2008 07:43:07   serv2: 2720   serv1: 1041 total: 3761
 11 Sep 2008 07:43:14   serv2: 2714   serv1: 1047 total: 3761
 11 Sep 2008 07:43:22   serv2: 2721   serv1: 1045 total: 3766
 11 Sep 2008 07:43:29   serv2: 2697   serv1: 1056 total: 3753
 11 Sep 2008 07:43:37   serv2: 2710   serv1: 1059 total: 3769
+11 Sep 2008 07:43:44   serv2: 2765   serv1: 1304 total: 4069
+11 Sep 2008 07:43:53   serv2: 2854   serv1: 1904 total: 4758
+11 Sep 2008 07:44:01   serv2: 2714   serv1: 2190 total: 4904
+11 Sep 2008 07:44:09   serv2: 2715   serv1: 2202 total: 4917
+11 Sep 2008 07:44:17   serv2: 2779   serv1: 1891 total: 4670
+11 Sep 2008 07:44:26   serv2: 2812   serv1: 2284 total: 5096
+11 Sep 2008 07:44:36   serv2: 2828   serv1: 3496 total: 6324
+11 Sep 2008 07:44:46   serv2: 2715   serv1: 4327 total: 7042
+11 Sep 2008 07:44:56   serv2: 2638   serv1: 3499 total: 6137
+11 Sep 2008 07:45:05   serv2: 2714   serv1: 2396 total: 5110
+11 Sep 2008 07:45:15   serv2: 2776   serv1: 1464 total: 4240
+11 Sep 2008 07:45:25   serv2: 2728   serv1: 1604 total: 4332
+11 Sep 2008 07:45:35   serv2: 2708   serv1: 1566 total: 4274
+11 Sep 2008 07:45:45   serv2: 2750   serv1: 1680 total: 4430
+11 Sep 2008 07:45:54   serv2: 2755   serv1: 1311 total: 4066
+11 Sep 2008 07:46:04   serv2: 2704   serv1: 1178 total: 3882
 11 Sep 2008 07:46:13   serv2: 2644   serv1: 1024 total: 3668
 11 Sep 2008 07:46:22   serv2: 2573   serv1: 981 total: 3554
 11 Sep 2008 07:46:30   serv2: 2739   serv1: 1051 total: 3790
 11 Sep 2008 07:46:39   serv2: 2773   serv1: 1043 total: 3816
 11 Sep 2008 07:46:46   serv2: 2548   serv1: 959 total: 3507
 11 Sep 2008 07:46:54   serv2: 2773   serv1: 1044 total: 3817
 11 Sep 2008 07:47:02   serv2: 2745   serv1: 1027 total: 3772
 11 Sep 2008 07:47:10   serv2: 2591   serv1: 960 total: 3551
 11 Sep 2008 07:47:17   serv2: 2721   serv1: 1002 total: 3723
 11 Sep 2008 07:47:25   serv2: 2753   serv1: 1030 total: 3783
 11 Sep 2008 07:47:32   serv2: 2773   serv1: 1029 total: 3802
 11 Sep 2008 07:47:40   serv2: 2768   serv1: 1025 total: 3793
 11 Sep 2008 07:47:47   serv2: 2764   serv1: 1021 total: 3785
 11 Sep 2008 07:47:55   serv2: 2750   serv1: 1021 total: 3771


Each server also reports the maximum numbers of authenticated connected
clients to the database.
Even though serv1 peaked at 07:44:46  at 4327 "ESTABLISHED" connections, the
number of normally authenticated clients in the database for this time
period is only 1100, which does not reflect this weird connections spike. 
Since I was asleep at 7:46am, I did not have a chance to investigate what
those connections actually were.

> Anyone know what happens to new
> connection attempts to a server in this condition?

One thing that I noticed yesterday, that when server was in this condition,
telnet simply hang, as if no ACK packet was received back:

alecm at serv2 ~> telnet localhost 5222
Trying 127.0.0.1...

and nothing

This behavior or telnet seems to be unique to the case when ACK is not
received in the handshake, I verified that with tcpdump. To contrast that,
if nothing listens on the destination port for example, telnet gives:

alecm at serv2 ~> telnet localhost 50007
Trying 127.0.0.1...
telnet: connect to address 127.0.0.1: Connection refused
telnet: Unable to connect to remote host: Connection refused

which corresponds to RST packet that kernel returns in that case.
I tried to write a 5 line mucked up server with accept() not returning any
packets, and failed.

> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Thursday, September 11, 2008 6:47 AM
> To: Twisted general discussion
> Subject: Re: [Twisted-Python] intermittent problem: not accepting new
> connections
> 
> On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick"
> <paul.nendick at gmail.com> wrote:
> >Not necessarily related to what you've described, but I'll share
> >something that's helped a good deal on my most-heavily hit twisted
> >servers. Presuming you're using Linux:
> >
> > echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
> >
> >
> >from http://lartc.org/howto/lartc.kernel.obscure.html :
> >
> >"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
> >should not be changed without advice/request of technical experts"
> >
> >My expert advice: only use this on machines connected on a low-latency
> >LAN. It *will* break internet-facing interfaces. It halves the
> >constant used by the Nagle algorithm:
> >
> >http://en.wikipedia.org/wiki/Nagle's_algorithm
> >
> 
> This is somewhat interesting.  It suggests a potential problem which
> I hadn't thought about before.  If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports.  Anyone know what happens to new
> connection attempts to a server in this condition?
> 
> Alec, any idea if your server could be getting into this state every
> once in a while?  This is an appealing hypothesis, since it wouldn't
> necessarily happen at peak connection time (but potentially shortly
> after a peak), would resolve itself given a short period of time,
> wouldn't necessarily prevent all new connection attempts, since old
> TIME-WAIT sockets would be gradually timing out (so your other low-
> volume servers might still appear to be working normally), wouldn't
> interfere with already established connections, and might not change
> the userspace-visible syscall behavior (depending on what Linux does
> in this case, but I wouldn't be surprised if connection failures due
> to this never showed up in an accept(2) result).
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From adelagon at gmail.com  Thu Sep 11 21:17:13 2008
From: adelagon at gmail.com (Alvin Delagon)
Date: Fri, 12 Sep 2008 09:17:13 +0800
Subject: [Twisted-Python] intermittent problem: not accepting new
	connections
In-Reply-To: <06c801c91448$b1a8f290$14fad7b0$@com>
References: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>
	<20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
	<06c801c91448$b1a8f290$14fad7b0$@com>
Message-ID: <7a01f6c00809111817v609ff43kede137ed7ab900a5@mail.gmail.com>

We had a similar problem like this, might as well share it with you guys:

Our Jabber server stopped taking in new connections due to our iptables at
some point in time (even lost some packets). We have an ip routing scheme
where ports 25,80,5223,10873 routed to 5222. Whenever this happens, we get
error error from our syslogs:

""ip_conntrack: table full, dropping packet"

http://support.imagestream.com/Resolving_ip_conntrack_table_full_Errors.html

Might as well check dmesg if you have something like this. What we did is
disable iptables and removed its kernel modules.

On Fri, Sep 12, 2008 at 3:57 AM, Alec Matusis <matusis at yahoo.com> wrote:

> > How does ulimit -a compare between old and new machine?
>
> ulimit is only higher on the new machine, I upped it. Also, from my
> experience, running into  ulimits produces log messages.
>
> alecm at serv2 ~> cat /proc/23678/limits
>
> Limit                     Soft Limit           Hard Limit           Units
>
> Max cpu time              unlimited            unlimited            ms
>
> Max file size             unlimited            unlimited            bytes
>
> Max data size             unlimited            unlimited            bytes
>
> Max stack size            8388608              unlimited            bytes
>
> Max core file size        0                    unlimited            bytes
>
> Max resident set          1073741824           1073741824           bytes
>
> Max processes             126976               126976
> processes
> Max open files            25000                25000                files
>
> Max locked memory         32768                32768                bytes
>
> Max address space         unlimited            unlimited            bytes
>
> Max file locks            unlimited            unlimited            locks
>
> Max pending signals       126976               126976               signals
>
> Max msgqueue size         819200               819200               bytes
>
> Max nice priority         0                    0
> Max realtime priority     0                    0
>
>
> > If you need to accept more than about
> > 64k connections (not necessarily concurrent) in less than TIME-WAIT
> > seconds, you might run out of ports.
>
> > How does netstat look like?
>
> I have to wait for another outage tonight, to get more definite results on
> this.
> So far, I have had only one very brief outage at 7:46am
> I was asleep, but I have some new data logged.
> I have two servers, one on port 5222 (problematic one, let's call it serv1
> ), and one on 5228 (that has no problems, call it serv2 ).
> I made a script that measures the number of connections on each type of
> server respectively like this:
>
> while [ 1 ]
> do
>  sleep 5
>  netstat -ant | grep ESTABLISHED | awk '/:5228 /{a += 1}/:5222 /{b += 1}
> END
> {print strftime(" %d %b %Y %H:%M:%S", systime(
> ))"   serv2: "a"   serv1: "b" total: "a+b }'
> done
>
> This is what happened around 7:46am (lines that have "+" in front indicate
> anomaly):
>
>  11 Sep 2008 07:41:29   serv2: 2756   serv1: 1064 total: 3820
>  11 Sep 2008 07:41:36   serv2: 2764   serv1: 1062 total: 3826
>  11 Sep 2008 07:41:44   serv2: 2784   serv1: 1049 total: 3833
>  11 Sep 2008 07:41:51   serv2: 2756   serv1: 1055 total: 3811
>  11 Sep 2008 07:41:59   serv2: 2760   serv1: 1066 total: 3826
>  11 Sep 2008 07:42:06   serv2: 2777   serv1: 1050 total: 3827
>  11 Sep 2008 07:42:14   serv2: 2769   serv1: 1054 total: 3823
>  11 Sep 2008 07:42:21   serv2: 2751   serv1: 1055 total: 3806
>  11 Sep 2008 07:42:29   serv2: 2760   serv1: 1050 total: 3810
>  11 Sep 2008 07:42:36   serv2: 2747   serv1: 1040 total: 3787
>  11 Sep 2008 07:42:44   serv2: 2737   serv1: 1046 total: 3783
>  11 Sep 2008 07:42:51   serv2: 2739   serv1: 1046 total: 3785
>  11 Sep 2008 07:42:59   serv2: 2743   serv1: 1037 total: 3780
>  11 Sep 2008 07:43:07   serv2: 2720   serv1: 1041 total: 3761
>  11 Sep 2008 07:43:14   serv2: 2714   serv1: 1047 total: 3761
>  11 Sep 2008 07:43:22   serv2: 2721   serv1: 1045 total: 3766
>  11 Sep 2008 07:43:29   serv2: 2697   serv1: 1056 total: 3753
>  11 Sep 2008 07:43:37   serv2: 2710   serv1: 1059 total: 3769
> +11 Sep 2008 07:43:44   serv2: 2765   serv1: 1304 total: 4069
> +11 Sep 2008 07:43:53   serv2: 2854   serv1: 1904 total: 4758
> +11 Sep 2008 07:44:01   serv2: 2714   serv1: 2190 total: 4904
> +11 Sep 2008 07:44:09   serv2: 2715   serv1: 2202 total: 4917
> +11 Sep 2008 07:44:17   serv2: 2779   serv1: 1891 total: 4670
> +11 Sep 2008 07:44:26   serv2: 2812   serv1: 2284 total: 5096
> +11 Sep 2008 07:44:36   serv2: 2828   serv1: 3496 total: 6324
> +11 Sep 2008 07:44:46   serv2: 2715   serv1: 4327 total: 7042
> +11 Sep 2008 07:44:56   serv2: 2638   serv1: 3499 total: 6137
> +11 Sep 2008 07:45:05   serv2: 2714   serv1: 2396 total: 5110
> +11 Sep 2008 07:45:15   serv2: 2776   serv1: 1464 total: 4240
> +11 Sep 2008 07:45:25   serv2: 2728   serv1: 1604 total: 4332
> +11 Sep 2008 07:45:35   serv2: 2708   serv1: 1566 total: 4274
> +11 Sep 2008 07:45:45   serv2: 2750   serv1: 1680 total: 4430
> +11 Sep 2008 07:45:54   serv2: 2755   serv1: 1311 total: 4066
> +11 Sep 2008 07:46:04   serv2: 2704   serv1: 1178 total: 3882
>  11 Sep 2008 07:46:13   serv2: 2644   serv1: 1024 total: 3668
>  11 Sep 2008 07:46:22   serv2: 2573   serv1: 981 total: 3554
>  11 Sep 2008 07:46:30   serv2: 2739   serv1: 1051 total: 3790
>  11 Sep 2008 07:46:39   serv2: 2773   serv1: 1043 total: 3816
>  11 Sep 2008 07:46:46   serv2: 2548   serv1: 959 total: 3507
>  11 Sep 2008 07:46:54   serv2: 2773   serv1: 1044 total: 3817
>  11 Sep 2008 07:47:02   serv2: 2745   serv1: 1027 total: 3772
>  11 Sep 2008 07:47:10   serv2: 2591   serv1: 960 total: 3551
>  11 Sep 2008 07:47:17   serv2: 2721   serv1: 1002 total: 3723
>  11 Sep 2008 07:47:25   serv2: 2753   serv1: 1030 total: 3783
>  11 Sep 2008 07:47:32   serv2: 2773   serv1: 1029 total: 3802
>  11 Sep 2008 07:47:40   serv2: 2768   serv1: 1025 total: 3793
>  11 Sep 2008 07:47:47   serv2: 2764   serv1: 1021 total: 3785
>  11 Sep 2008 07:47:55   serv2: 2750   serv1: 1021 total: 3771
>
>
> Each server also reports the maximum numbers of authenticated connected
> clients to the database.
> Even though serv1 peaked at 07:44:46  at 4327 "ESTABLISHED" connections,
> the
> number of normally authenticated clients in the database for this time
> period is only 1100, which does not reflect this weird connections spike.
> Since I was asleep at 7:46am, I did not have a chance to investigate what
> those connections actually were.
>
> > Anyone know what happens to new
> > connection attempts to a server in this condition?
>
> One thing that I noticed yesterday, that when server was in this condition,
> telnet simply hang, as if no ACK packet was received back:
>
> alecm at serv2 ~> telnet localhost 5222
> Trying 127.0.0.1...
>
> and nothing
>
> This behavior or telnet seems to be unique to the case when ACK is not
> received in the handshake, I verified that with tcpdump. To contrast that,
> if nothing listens on the destination port for example, telnet gives:
>
> alecm at serv2 ~> telnet localhost 50007
> Trying 127.0.0.1...
> telnet: connect to address 127.0.0.1: Connection refused
> telnet: Unable to connect to remote host: Connection refused
>
> which corresponds to RST packet that kernel returns in that case.
> I tried to write a 5 line mucked up server with accept() not returning any
> packets, and failed.
>
> > -----Original Message-----
> > From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> > bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> > Sent: Thursday, September 11, 2008 6:47 AM
> > To: Twisted general discussion
> > Subject: Re: [Twisted-Python] intermittent problem: not accepting new
> > connections
> >
> > On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick"
> > <paul.nendick at gmail.com> wrote:
> > >Not necessarily related to what you've described, but I'll share
> > >something that's helped a good deal on my most-heavily hit twisted
> > >servers. Presuming you're using Linux:
> > >
> > > echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
> > >
> > >
> > >from http://lartc.org/howto/lartc.kernel.obscure.html :
> > >
> > >"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
> > >should not be changed without advice/request of technical experts"
> > >
> > >My expert advice: only use this on machines connected on a low-latency
> > >LAN. It *will* break internet-facing interfaces. It halves the
> > >constant used by the Nagle algorithm:
> > >
> > >http://en.wikipedia.org/wiki/Nagle's_algorithm<http://en.wikipedia.org/wiki/Nagle%27s_algorithm>
> > >
> >
> > This is somewhat interesting.  It suggests a potential problem which
> > I hadn't thought about before.  If you need to accept more than about
> > 64k connections (not necessarily concurrent) in less than TIME-WAIT
> > seconds, you might run out of ports.  Anyone know what happens to new
> > connection attempts to a server in this condition?
> >
> > Alec, any idea if your server could be getting into this state every
> > once in a while?  This is an appealing hypothesis, since it wouldn't
> > necessarily happen at peak connection time (but potentially shortly
> > after a peak), would resolve itself given a short period of time,
> > wouldn't necessarily prevent all new connection attempts, since old
> > TIME-WAIT sockets would be gradually timing out (so your other low-
> > volume servers might still appear to be working normally), wouldn't
> > interfere with already established connections, and might not change
> > the userspace-visible syscall behavior (depending on what Linux does
> > in this case, but I wouldn't be surprised if connection failures due
> > to this never showed up in an accept(2) result).
> >
> > Jean-Paul
> >
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



-- 
http://www.alvinatorsplayground.blogspot.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080912/f608c826/attachment.htm 

From exarkun at twistedmatrix.com  Sun Sep 14 00:05:10 2008
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 14 Sep 2008 04:05:10 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1221365110.92.2408979@twistedmatrix.com

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080914/f73917ae/attachment.htm 

From vvangelovski at gmail.com  Mon Sep 15 07:05:57 2008
From: vvangelovski at gmail.com (Vasil Vangelovski)
Date: Mon, 15 Sep 2008 13:05:57 +0200
Subject: [Twisted-Python] twisted.web.client POST data
Message-ID: <48CE4195.8080603@gmail.com>

I'm trying to send a post request like so
 getPage('http://localhost/test/test/', method='POST' postdata='test=asdf')

But the server script doesnt get any post arguments.
I was looking at the code for web.client and cant see where im doing
wrong here.
Any ideas what might be the problem? I'm using an svn checkout of Twisted.



From dotecho at gmail.com  Mon Sep 15 07:31:59 2008
From: dotecho at gmail.com (echo)
Date: Mon, 15 Sep 2008 19:31:59 +0800
Subject: [Twisted-Python] =?utf-8?q?Use_twisted=2Epython=2Elogfile=2ELogF?=
	=?utf-8?q?ile_wirte_log=EF=BC=8CMemory_can_not_be_released=2C_does?=
	=?utf-8?q?_anybody_familiar_with_or_encounter_such_a_situation=3F?=
Message-ID: <c9bd7f5f0809150431s2d31b1ayd00c1cf3ba36bab0@mail.gmail.com>

Use twisted.python.logfile.LogFile wirte log?Memory can not be released,
does anybody familiar with or encounter such a situation?

Environment: FREEBSD 6.3 RELEASE
twisted svn trunk today


Description of the problem
Use "TOP" command observe the used memory, memory first use the BUF, if
buf>111M, then don't use buf
and use WIRED, Wired to around 132 M? and then use Inact
If during the service  manually delete the generated file. Memory will be
released.
twisted.python.logfile.LogFile default  log file will be closed at 1 M size,
and re-open a file, how the file is closed? but the memory still not
released?

sorry for my poor english.. thank you


**test code?

#!/usr/local/bin/python
import datetime
import os
from twisted.python import logfile

class LogFile2(logfile.LogFile):
    '''
    '''
    def rotate(self):
        """
        Rotate the file and create a new one.

        If it's not possible to open new logfile, this will fail silently,
        and continue logging to old logfile.
        """
        if not (os.access(self.directory, os.W_OK) and os.access(self.path,
os.W_OK)):
            return
        logs = self.listLogs()
        logs.reverse()
        for i in logs:
            if self.maxRotatedFiles is not None and i >=
self.maxRotatedFiles:
                os.remove("%s.%d" % (self.path, i))
            else:
                os.rename("%s.%d" % (self.path, i), "%s.%d" % (self.path, i
+ 1))

        self._file.close()
        print self._file, 'closed'
        os.rename(self.path, "%s.1" % self.path)
        self._openFile()


i=10000000
log = LogFile2('test_logfile.log', '/home/echo/tmp/test/')

while i:
    msg = '%s: test_test_test_test\r\n' % str(i)
    log.write(msg)
    i=i-1


log.close()

**result?

<closed file '/home/echo/tmp/test/test_logfile.log', mode 'r+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
.......
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080915/0b6cfde1/attachment.htm 

From tarjei at nu.no  Mon Sep 15 07:35:56 2008
From: tarjei at nu.no (tarjei)
Date: Mon, 15 Sep 2008 13:35:56 +0200
Subject: [Twisted-Python] twisted.web.client POST data
In-Reply-To: <48CE4195.8080603@gmail.com>
References: <48CE4195.8080603@gmail.com>
Message-ID: <48CE489C.3040208@nu.no>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Vasil Vangelovski wrote:
> I'm trying to send a post request like so
>  getPage('http://localhost/test/test/', method='POST' postdata='test=asdf')
> 
> But the server script doesnt get any post arguments.
> I was looking at the code for web.client and cant see where im doing
> wrong here.
> Any ideas what might be the problem? I'm using an svn checkout of Twisted.
Try:
getPage('http://localhost/test/test/?test=asdf', method='POST' postdata='')

If you want to use postdata, you'll have to encode it yourself. AFAIK
there is no method for doing this in twisted.web. I've used the
following which is based on[1]:


def encode_multipart_formdata(fields, files, content_type=
'application/octet-stream'):
    """
    fields is a sequence of (name, value) elements for regular form fields.
    files is a sequence of (name, filename, value) elements for data to
be uploaded as files
    content_type is the contentype to send
    Return (content_type, body) ready for httplib.HTTP instance
    """
    BOUNDARY = '----------ThIs_Is_tHe_bouNdaRY_$'
    CRLF = '\r\n'
    L = []
    for (key, value) in fields:
        L.append('--' + BOUNDARY)
        L.append('Content-Disposition: form-data; name="%s"' % key)
        L.append('')
        L.append(value)
    for (key, filename, value) in files:
        L.append('--' + BOUNDARY)
        L.append('Content-Disposition: form-data; name="%s";
filename="%s"' % (key, filename))
        L.append('Content-Type: %s' % content_type)
        L.append('')
        L.append(value)
    L.append('--' + BOUNDARY + '--')
    L.append('')
    body = CRLF.join(L)
    content_type = 'multipart/form-data; boundary=%s' % BOUNDARY
    return content_type, body

This code makes it possible to also add files to the post.

1. http://code.activestate.com/recipes/146306/

Regards,
Tarjei

> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIzkicYVRKCnSvzfIRArU/AJ0XG6qKXbRYxj1fnwE3sm+xh0tJ6wCdEoYL
XqwNVrfspaKo2r76hSug01I=
=UpmN
-----END PGP SIGNATURE-----



From matusis at yahoo.com  Mon Sep 15 07:43:23 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Mon, 15 Sep 2008 04:43:23 -0700
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <7a01f6c00809111817v609ff43kede137ed7ab900a5@mail.gmail.com>
References: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>	<20080911134651.29191.1030196475.divmod.quotient.24599@ohm>	<06c801c91448$b1a8f290$14fad7b0$@com>
	<7a01f6c00809111817v609ff43kede137ed7ab900a5@mail.gmail.com>
Message-ID: <030c01c91728$47d76940$d7863bc0$@com>

I wanted to post that I solved the problem, and it's unrelated to Twisted.

I noticed that this server had sudden increases in the numbers of
ESTABLISHED connections in netstat, but not in the number of authenticated
connections reported by twisted to the database. These increases correlated
with the connection outages.
Creating a shell script that monitors the connection rate, and invoking
tcpdump and sorting/counting the source IPs when it increases, showed that
this server was pounded twice a day for 3-5min from a small set of IPs with
new connections at about 100 conns/sec, that sent some junk data (these
connections timed out in twisted, because that junk never contained my line
separator, and I am using LineOnlyReceiver protocol). This was hardly an
attack against my server, because this new server was assigned an IP that I
have never used before- I guess this is just an internet reality ;)

Even though this does not look like SYN attacks (few connections were in
SYN_RCVD state), for some reason enabling net.ipv4.tcp_syncookies=1 made
everything normal. When these bizarre connections began to pile uo, I
started seeing 
"possible SYN flooding on port 5222. Sending cookies."
in /var/log/messages , and the connectivity outages stopped

I am sorry for the confusion, I was emboldened by finding the epoll bug back
in April, but this time Twisted continues to rock, and it's just a stupid
Ubuntu's tcp setting.



From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Alvin Delagon
Sent: Thursday, September 11, 2008 6:17 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] intermittent problem: not accepting new
connections

We had a similar problem like this, might as well share it with you guys:

Our Jabber server stopped taking in new connections due to our iptables at
some point in time (even lost some packets). We have an ip routing scheme
where ports 25,80,5223,10873 routed to 5222. Whenever this happens, we get
error error from our syslogs:

""ip_conntrack: table full, dropping packet"

http://support.imagestream.com/Resolving_ip_conntrack_table_full_Errors.html

Might as well check dmesg if you have something like this. What we did is
disable iptables and removed its kernel modules.
On Fri, Sep 12, 2008 at 3:57 AM, Alec Matusis <matusis at yahoo.com> wrote:
> How does ulimit -a compare between old and new machine?
ulimit is only higher on the new machine, I upped it. Also, from my
experience, running into ?ulimits produces log messages.

alecm at serv2 ~> cat /proc/23678/limits

Limit ? ? ? ? ? ? ? ? ? ? Soft Limit ? ? ? ? ? Hard Limit ? ? ? ? ? Units

Max cpu time ? ? ? ? ? ? ?unlimited ? ? ? ? ? ?unlimited ? ? ? ? ? ?ms

Max file size ? ? ? ? ? ? unlimited ? ? ? ? ? ?unlimited ? ? ? ? ? ?bytes

Max data size ? ? ? ? ? ? unlimited ? ? ? ? ? ?unlimited ? ? ? ? ? ?bytes

Max stack size ? ? ? ? ? ?8388608 ? ? ? ? ? ? ?unlimited ? ? ? ? ? ?bytes

Max core file size ? ? ? ?0 ? ? ? ? ? ? ? ? ? ?unlimited ? ? ? ? ? ?bytes

Max resident set ? ? ? ? ?1073741824 ? ? ? ? ? 1073741824 ? ? ? ? ? bytes

Max processes ? ? ? ? ? ? 126976 ? ? ? ? ? ? ? 126976
processes
Max open files ? ? ? ? ? ?25000 ? ? ? ? ? ? ? ?25000 ? ? ? ? ? ? ? ?files

Max locked memory ? ? ? ? 32768 ? ? ? ? ? ? ? ?32768 ? ? ? ? ? ? ? ?bytes

Max address space ? ? ? ? unlimited ? ? ? ? ? ?unlimited ? ? ? ? ? ?bytes

Max file locks ? ? ? ? ? ?unlimited ? ? ? ? ? ?unlimited ? ? ? ? ? ?locks

Max pending signals ? ? ? 126976 ? ? ? ? ? ? ? 126976 ? ? ? ? ? ? ? signals

Max msgqueue size ? ? ? ? 819200 ? ? ? ? ? ? ? 819200 ? ? ? ? ? ? ? bytes

Max nice priority ? ? ? ? 0 ? ? ? ? ? ? ? ? ? ?0
Max realtime priority ? ? 0 ? ? ? ? ? ? ? ? ? ?0


> If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports.
> How does netstat look like?
I have to wait for another outage tonight, to get more definite results on
this.
So far, I have had only one very brief outage at 7:46am
I was asleep, but I have some new data logged.
I have two servers, one on port 5222 (problematic one, let's call it serv1
), and one on 5228 (that has no problems, call it serv2 ).
I made a script that measures the number of connections on each type of
server respectively like this:

while [ 1 ]
do
?sleep 5
?netstat -ant | grep ESTABLISHED | awk '/:5228 /{a += 1}/:5222 /{b += 1} END
{print strftime(" %d %b %Y %H:%M:%S", systime(
))" ? serv2: "a" ? serv1: "b" total: "a+b }'
done

This is what happened around 7:46am (lines that have "+" in front indicate
anomaly):

?11 Sep 2008 07:41:29 ? serv2: 2756 ? serv1: 1064 total: 3820
?11 Sep 2008 07:41:36 ? serv2: 2764 ? serv1: 1062 total: 3826
?11 Sep 2008 07:41:44 ? serv2: 2784 ? serv1: 1049 total: 3833
?11 Sep 2008 07:41:51 ? serv2: 2756 ? serv1: 1055 total: 3811
?11 Sep 2008 07:41:59 ? serv2: 2760 ? serv1: 1066 total: 3826
?11 Sep 2008 07:42:06 ? serv2: 2777 ? serv1: 1050 total: 3827
?11 Sep 2008 07:42:14 ? serv2: 2769 ? serv1: 1054 total: 3823
?11 Sep 2008 07:42:21 ? serv2: 2751 ? serv1: 1055 total: 3806
?11 Sep 2008 07:42:29 ? serv2: 2760 ? serv1: 1050 total: 3810
?11 Sep 2008 07:42:36 ? serv2: 2747 ? serv1: 1040 total: 3787
?11 Sep 2008 07:42:44 ? serv2: 2737 ? serv1: 1046 total: 3783
?11 Sep 2008 07:42:51 ? serv2: 2739 ? serv1: 1046 total: 3785
?11 Sep 2008 07:42:59 ? serv2: 2743 ? serv1: 1037 total: 3780
?11 Sep 2008 07:43:07 ? serv2: 2720 ? serv1: 1041 total: 3761
?11 Sep 2008 07:43:14 ? serv2: 2714 ? serv1: 1047 total: 3761
?11 Sep 2008 07:43:22 ? serv2: 2721 ? serv1: 1045 total: 3766
?11 Sep 2008 07:43:29 ? serv2: 2697 ? serv1: 1056 total: 3753
?11 Sep 2008 07:43:37 ? serv2: 2710 ? serv1: 1059 total: 3769
+11 Sep 2008 07:43:44 ? serv2: 2765 ? serv1: 1304 total: 4069
+11 Sep 2008 07:43:53 ? serv2: 2854 ? serv1: 1904 total: 4758
+11 Sep 2008 07:44:01 ? serv2: 2714 ? serv1: 2190 total: 4904
+11 Sep 2008 07:44:09 ? serv2: 2715 ? serv1: 2202 total: 4917
+11 Sep 2008 07:44:17 ? serv2: 2779 ? serv1: 1891 total: 4670
+11 Sep 2008 07:44:26 ? serv2: 2812 ? serv1: 2284 total: 5096
+11 Sep 2008 07:44:36 ? serv2: 2828 ? serv1: 3496 total: 6324
+11 Sep 2008 07:44:46 ? serv2: 2715 ? serv1: 4327 total: 7042
+11 Sep 2008 07:44:56 ? serv2: 2638 ? serv1: 3499 total: 6137
+11 Sep 2008 07:45:05 ? serv2: 2714 ? serv1: 2396 total: 5110
+11 Sep 2008 07:45:15 ? serv2: 2776 ? serv1: 1464 total: 4240
+11 Sep 2008 07:45:25 ? serv2: 2728 ? serv1: 1604 total: 4332
+11 Sep 2008 07:45:35 ? serv2: 2708 ? serv1: 1566 total: 4274
+11 Sep 2008 07:45:45 ? serv2: 2750 ? serv1: 1680 total: 4430
+11 Sep 2008 07:45:54 ? serv2: 2755 ? serv1: 1311 total: 4066
+11 Sep 2008 07:46:04 ? serv2: 2704 ? serv1: 1178 total: 3882
?11 Sep 2008 07:46:13 ? serv2: 2644 ? serv1: 1024 total: 3668
?11 Sep 2008 07:46:22 ? serv2: 2573 ? serv1: 981 total: 3554
?11 Sep 2008 07:46:30 ? serv2: 2739 ? serv1: 1051 total: 3790
?11 Sep 2008 07:46:39 ? serv2: 2773 ? serv1: 1043 total: 3816
?11 Sep 2008 07:46:46 ? serv2: 2548 ? serv1: 959 total: 3507
?11 Sep 2008 07:46:54 ? serv2: 2773 ? serv1: 1044 total: 3817
?11 Sep 2008 07:47:02 ? serv2: 2745 ? serv1: 1027 total: 3772
?11 Sep 2008 07:47:10 ? serv2: 2591 ? serv1: 960 total: 3551
?11 Sep 2008 07:47:17 ? serv2: 2721 ? serv1: 1002 total: 3723
?11 Sep 2008 07:47:25 ? serv2: 2753 ? serv1: 1030 total: 3783
?11 Sep 2008 07:47:32 ? serv2: 2773 ? serv1: 1029 total: 3802
?11 Sep 2008 07:47:40 ? serv2: 2768 ? serv1: 1025 total: 3793
?11 Sep 2008 07:47:47 ? serv2: 2764 ? serv1: 1021 total: 3785
?11 Sep 2008 07:47:55 ? serv2: 2750 ? serv1: 1021 total: 3771


Each server also reports the maximum numbers of authenticated connected
clients to the database.
Even though serv1 peaked at 07:44:46 ?at 4327 "ESTABLISHED" connections, the
number of normally authenticated clients in the database for this time
period is only 1100, which does not reflect this weird connections spike.
Since I was asleep at 7:46am, I did not have a chance to investigate what
those connections actually were.

> Anyone know what happens to new
> connection attempts to a server in this condition?
One thing that I noticed yesterday, that when server was in this condition,
telnet simply hang, as if no ACK packet was received back:

alecm at serv2 ~> telnet localhost 5222
Trying 127.0.0.1...
and nothing

This behavior or telnet seems to be unique to the case when ACK is not
received in the handshake, I verified that with tcpdump. To contrast that,
if nothing listens on the destination port for example, telnet gives:

alecm at serv2 ~> telnet localhost 50007
Trying 127.0.0.1...
telnet: connect to address 127.0.0.1: Connection refused
telnet: Unable to connect to remote host: Connection refused

which corresponds to RST packet that kernel returns in that case.
I tried to write a 5 line mucked up server with accept() not returning any
packets, and failed.

> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Thursday, September 11, 2008 6:47 AM
> To: Twisted general discussion
> Subject: Re: [Twisted-Python] intermittent problem: not accepting new
> connections
>
> On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick"
> <paul.nendick at gmail.com> wrote:
> >Not necessarily related to what you've described, but I'll share
> >something that's helped a good deal on my most-heavily hit twisted
> >servers. Presuming you're using Linux:
> >
> > echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
> >
> >
> >from http://lartc.org/howto/lartc.kernel.obscure.html :
> >
> >"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
> >should not be changed without advice/request of technical experts"
> >
> >My expert advice: only use this on machines connected on a low-latency
> >LAN. It *will* break internet-facing interfaces. It halves the
> >constant used by the Nagle algorithm:
> >
> >http://en.wikipedia.org/wiki/Nagle's_algorithm
> >
>
> This is somewhat interesting. ?It suggests a potential problem which
> I hadn't thought about before. ?If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports. ?Anyone know what happens to new
> connection attempts to a server in this condition?
>
> Alec, any idea if your server could be getting into this state every
> once in a while? ?This is an appealing hypothesis, since it wouldn't
> necessarily happen at peak connection time (but potentially shortly
> after a peak), would resolve itself given a short period of time,
> wouldn't necessarily prevent all new connection attempts, since old
> TIME-WAIT sockets would be gradually timing out (so your other low-
> volume servers might still appear to be working normally), wouldn't
> interfere with already established connections, and might not change
> the userspace-visible syscall behavior (depending on what Linux does
> in this case, but I wouldn't be surprised if connection failures due
> to this never showed up in an accept(2) result).
>
> Jean-Paul
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



-- 
http://www.alvinatorsplayground.blogspot.com/




From exarkun at divmod.com  Mon Sep 15 08:43:39 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 15 Sep 2008 08:43:39 -0400
Subject: =?utf-8?q?Re=3A_=5BTwisted-Python=5D_Use_twisted=2Epython=2Elogf?=
	=?utf-8?q?ile=2ELogFile_wirte_log=EF=BC=8CMemory_can_not_be_released=2C_d?=
	=?utf-8?q?oes_anybody_familiar_with_or_encounter_such_a_situation=3F?=
In-Reply-To: <c9bd7f5f0809150431s2d31b1ayd00c1cf3ba36bab0@mail.gmail.com>
Message-ID: <20080915124339.29191.1041623863.divmod.quotient.26365@ohm>

On Mon, 15 Sep 2008 19:31:59 +0800, echo <dotecho at gmail.com> wrote:
>Use twisted.python.logfile.LogFile wirte log?Memory can not be released,
>does anybody familiar with or encounter such a situation?
>
>Environment: FREEBSD 6.3 RELEASE
>twisted svn trunk today
>

I ran the test code on Ubuntu Hardy but I don't see any memory problems.
I let the program run for about two minutes and memory remained constant
for the entire time.

LogFile doesn't do very much besides write to a Python file object.  Can
you reproduce the memory problem just using a file without using LogFile?

Jean-Paul



From exarkun at divmod.com  Mon Sep 15 08:44:53 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 15 Sep 2008 08:44:53 -0400
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <030c01c91728$47d76940$d7863bc0$@com>
Message-ID: <20080915124453.29191.666349400.divmod.quotient.26366@ohm>

On Mon, 15 Sep 2008 04:43:23 -0700, Alec Matusis <matusis at yahoo.com> wrote:
>I wanted to post that I solved the problem, and it's unrelated to Twisted.
>
> [snip]
>
>I am sorry for the confusion, I was emboldened by finding the epoll bug back
>in April, but this time Twisted continues to rock, and it's just a stupid
>Ubuntu's tcp setting.
>

Thanks for the follow up and explaination.  It's good to know what was
going on here and what the fix was, even though it wasn't anything in
Twisted.

Jean-Paul



From andrewfr_ice at yahoo.com  Mon Sep 15 10:33:41 2008
From: andrewfr_ice at yahoo.com (Andrew Francis)
Date: Mon, 15 Sep 2008 07:33:41 -0700 (PDT)
Subject: [Twisted-Python] twisted.web.client POST data
In-Reply-To: <E1KfCV6-0002XQ-K1@cube.twistedmatrix.com>
Message-ID: <27951.5580.qm@web34201.mail.mud.yahoo.com>

Hi Vasil:

>I'm trying to send a post request like so
>getPage('http://localhost/test/test/', method='POST' postdata='test=asdf')

>But the server script doesnt get any post arguments.
>I was looking at the code for web.client and cant see where im doing
>wrong here.
>Any ideas what might be the problem? I'm using an svn checkout of Twisted.

I will assume you did things like check your web server's log to see if a connection was made and if there was an error.....

Since you are using the POST method, I would expect you would have to set the headers argument (a dictionary). I notice the header argument is missing. I would expect entries such as Content-Type and Content-Length.

Cheers,
Andrew




      



From dotecho at gmail.com  Mon Sep 15 10:35:22 2008
From: dotecho at gmail.com (echo)
Date: Mon, 15 Sep 2008 22:35:22 +0800
Subject: =?UTF-8?Q?Re:_[Twisted-Python]_Use_twisted.pyth?=
	=?UTF-8?Q?on.logfile.LogFile_wirte_log=EF=BC=8CMemory_ca?=
	=?UTF-8?Q?n_not_be_released, _does_anybody_famili?=
	=?UTF-8?Q?ar_with_or_encounter_such_a_situation=3F?=
In-Reply-To: <20080915124339.29191.1041623863.divmod.quotient.26365@ohm>
References: <c9bd7f5f0809150431s2d31b1ayd00c1cf3ba36bab0@mail.gmail.com>
	<20080915124339.29191.1041623863.divmod.quotient.26365@ohm>
Message-ID: <c9bd7f5f0809150735q7640ceb1p75a261b3d356da1e@mail.gmail.com>

2008/9/15 Jean-Paul Calderone <exarkun at divmod.com>

> I ran the test code on Ubuntu Hardy but I don't see any memory problems.
> I let the program run for about two minutes and memory remained constant
> for the entire time.
>
> LogFile doesn't do very much besides write to a Python file object.  Can
> you reproduce the memory problem just using a file without using LogFile?


Hi, Jean-Paul, thank you for reply and test;)

I open a single file, write the same data, memory is not automatically
released, after i delete the file, memory released..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080915/4831d865/attachment.htm 

From vvangelovski at gmail.com  Tue Sep 16 03:41:40 2008
From: vvangelovski at gmail.com (Vasil Vangelovski)
Date: Tue, 16 Sep 2008 09:41:40 +0200
Subject: [Twisted-Python] twisted.web.client POST data
In-Reply-To: <27951.5580.qm@web34201.mail.mud.yahoo.com>
References: <27951.5580.qm@web34201.mail.mud.yahoo.com>
Message-ID: <48CF6334.5020209@gmail.com>

Problem was I was missing the content type header. The content length
value is calculated somewhere in twisted.web.client
I just put in there the same content type firefox sends when posting a
form. Now it works.


getPage(url,method='POST',postdata=urllib.urlencode({'check_data':check_data}),headers={'Content-Type':'application/x-www-form-urlencoded'})

Thanks for the suggestions.

Andrew Francis wrote:
> Hi Vasil:
> 
>> I'm trying to send a post request like so
>> getPage('http://localhost/test/test/', method='POST' postdata='test=asdf')
> 
>> But the server script doesnt get any post arguments.
>> I was looking at the code for web.client and cant see where im doing
>> wrong here.
>> Any ideas what might be the problem? I'm using an svn checkout of Twisted.
> 
> I will assume you did things like check your web server's log to see if a connection was made and if there was an error.....
> 
> Since you are using the POST method, I would expect you would have to set the headers argument (a dictionary). I notice the header argument is missing. I would expect entries such as Content-Type and Content-Length.
> 
> Cheers,
> Andrew
> 
> 
> 
> 
>       
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From davedrouin at hotmail.com  Tue Sep 16 09:50:53 2008
From: davedrouin at hotmail.com (David Drouin)
Date: Tue, 16 Sep 2008 13:50:53 +0000
Subject: [Twisted-Python] Using the Oscar protocol to send SMS text msgs
Message-ID: <BLU121-W10612CDD20ECDB5D0FF2C4D24D0@phx.gbl>

I'm wondering if anyone happens to have an example of how to send an SMS message through AIM using twisted.words.protocols.oscar.  Sending instant messages based on the code in oscardemo.py was simple enough, but when I tried to send a message to a phone number through an oscar.BOSConnection.sendMessage method such as:

self.sendMessage("+19995551212", [(msg,)], wantAck=0, autoResponse=False)

an SMS text message does not appear to be sent to the specified phone number, however, the number I tried to send the message to did end up appearing under "Recent Buddies" in AIM after trying this.  If I then attempt to send an SMS manually through version 6.9.1.2 of the AIM client it works as expected.  I'm guessing that perhaps a connection or ICBM parameter needs to be set to enable SMS messaging for the client connection made through oscar.  I looked at the code for the oscar protocol in Pidgin to see if that would shed any light on what I could be doing incorrectly and didn't see anything special being done for SMS text messages there aside from converting them to plain text before sending the message along in the same way as IM's are sent except that the user name is a phone number in the +<area code><number> format I've been trying with.  

thanks,

Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080916/8b4fdfac/attachment.htm 

From rlotun at gmail.com  Thu Sep 18 05:42:35 2008
From: rlotun at gmail.com (Reza Lotun)
Date: Thu, 18 Sep 2008 10:42:35 +0100
Subject: [Twisted-Python] Calling deferToThread from a thread
Message-ID: <95bb10690809180242r7688b554u3dd05c33f69a642d@mail.gmail.com>

Hi All,

I have a data store api that mandates the return of deferreds for each
call. I have a number of implementations for the api - an in-memory
one for testing, and a number of other network + disk based apis.

My issue is this - I'm using py.test for unit testing (I'm aware of
trial, but for compatibility reasons with the rest of the project I
haven't looked into using it). To test deferred-based code I have set
up a separate thread which the reactor runs in (the setup and teardown
code is shown below for anyone who is interested).

def net():
    reactor.run(installSignalHandlers=0)

def setup_module(mod):
    global net_thread
    net_thread = threading.Thread(target=net)
    net_thread.start()
    time.sleep(1)

def teardown_module(module):
    reactor.callFromThread(reactor.stop)

This seems to work generally fine. The problem (or at least I *think*
it's the problem) is that in one of my implementations uses
deferToThread internally to create a deferred which it then returns to
the caller. Is it thread safe to call a deferToThread in a separate
thread? Normally I'd do a reactor.callFromThread, but I'm not sure how
to get a deferred by this construct.

I see two options:
1. In my unit test I write a function f which makes the api call and
gets the deferred, and sets it to a local variable within the test
instance. Then I schedule f to run in the reactor thread via
reactor.callFromThread
2. I look into trial which has support for this kind of stuff??

Thanks for any help.

Cheers,
Reza



From exarkun at divmod.com  Thu Sep 18 08:22:12 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 18 Sep 2008 08:22:12 -0400
Subject: [Twisted-Python] Calling deferToThread from a thread
In-Reply-To: <95bb10690809180242r7688b554u3dd05c33f69a642d@mail.gmail.com>
Message-ID: <20080918122212.29191.936281590.divmod.quotient.27794@ohm>

On Thu, 18 Sep 2008 10:42:35 +0100, Reza Lotun <rlotun at gmail.com> wrote:
>Hi All,
>
>I have a data store api that mandates the return of deferreds for each
>call. I have a number of implementations for the api - an in-memory
>one for testing, and a number of other network + disk based apis.
>

deferToThread isn't special.  Like pretty much any Twisted API, it is
only safe to call in the reactor thread.  It doesn't matter if the
reactor thread is the main thread or another one - whichever, that's
the only thread Twisted APIs are safe in.

> [snip]
>
>I see two options:
>1. In my unit test I write a function f which makes the api call and
>gets the deferred, and sets it to a local variable within the test
>instance. Then I schedule f to run in the reactor thread via
>reactor.callFromThread
>2. I look into trial which has support for this kind of stuff??

Your best bet is to look at py.test's support for xunit style tests.
Whenever you need to deal with Deferreds, you should be using trial's
TestCase.  Anything else you do will be fragile and prone to break (as
trial is, but at least we will fix it when it breaks so that you don't
have to).

Jean-Paul



From vvangelovski at gmail.com  Thu Sep 18 10:38:24 2008
From: vvangelovski at gmail.com (Vasil Vangelovski)
Date: Thu, 18 Sep 2008 16:38:24 +0200
Subject: [Twisted-Python] distributing a commercial project based on twisted
Message-ID: <406b9fda0809180738u3a4ee105le680d0079b7076ae@mail.gmail.com>

Hi
Can anyone tell me which is the best way to distribute a commercial
project based on Twisted for Linux.
It would be great if I can make .rpm and .deb packages which will
include twisted and some compiled modules of the project.
But I'm not sure how to do this. Should i turn to distutils or tap2rpm?



From dripton at ripton.net  Thu Sep 18 11:16:23 2008
From: dripton at ripton.net (David Ripton)
Date: Thu, 18 Sep 2008 08:16:23 -0700
Subject: [Twisted-Python] Calling deferToThread from a thread
In-Reply-To: <95bb10690809180242r7688b554u3dd05c33f69a642d@mail.gmail.com>
References: <95bb10690809180242r7688b554u3dd05c33f69a642d@mail.gmail.com>
Message-ID: <20080918151623.GB23767@vidar.dreamhost.com>

On 2008.09.18 10:42:35 +0100, Reza Lotun wrote:
> My issue is this - I'm using py.test for unit testing (I'm aware of
> trial, but for compatibility reasons with the rest of the project I
> haven't looked into using it). To test deferred-based code I have set
> up a separate thread which the reactor runs in (the setup and teardown
> code is shown below for anyone who is interested).

> I see two options:
> 1. In my unit test I write a function f which makes the api call and
> gets the deferred, and sets it to a local variable within the test
> instance. Then I schedule f to run in the reactor thread via
> reactor.callFromThread
> 2. I look into trial which has support for this kind of stuff??

trial has very good support for deferreds.  If your test method returns
a deferred then trial magically does the right thing.  You don't need to
manage the reactor yourself.  See Twisted's docs and unit tests for
examples.

trial's API is based on unittest's, which is based on JUnit's.  Works
fine, but it has the Java nature.

I recommend trying nose.  It has support for deferreds, using a
decorator.  And its API is based on the py.test API.  Unfortunately they
chose to spell setup and teardown differently, so you can't use your
py.test test modules unchanged, but the changes are usually trivial.

-- 
David Ripton    dripton at ripton.net



From david.craig.wilson at gmail.com  Sat Sep 20 00:28:27 2008
From: david.craig.wilson at gmail.com (David Wilson)
Date: Fri, 19 Sep 2008 23:28:27 -0500
Subject: [Twisted-Python] Looping
Message-ID: <24dc0be10809192128l57802301q599aeeb016f2d916@mail.gmail.com>

Hi All,
I'm trying to pick up Twisted and I'm having trouble with looping.

I expected that a Deferred returned from a looping call would be available
after each call.  But it's only available after the loop is stopped.  Am I
looking for a different class?

Thanks,
Dave

p.s.  Ultimately I'd like to watch a file and post any new lines up to an
HTTP server.  If there is a direct way to get there, please let me know.
Thanks!


from twisted.internet import task, defer
from twisted.internet import reactor
import sys
import time

def check_file_p(fp):
    time.sleep(2)
    #print fp
    sys.stdout.write('starting check...\n')
    fp.seek(fp.tell())
    list = []
    for line in fp.readlines():
        #sys.stdout.write(line)
        list.append(line)
    str_list = str(list)
    d = defer.Deferred()
    #print str_list
    d.callback(str_list)
    print d
    return d

def print_list(string):
    print 'calling string list...'
    sys.stdout.write('string: ' + string)

fn = r"C:\var\twisted.txt"
f = open(fn, 'r')
#l = task.LoopingCall(runEverySecond)
"""
didn't work
l = task.LoopingCall(check_file_p, f)
d = l.start(5.0, False) # call every x seconds
"""
d = task.deferLater(reactor, 3.5, check_file_p, f)

print d
d.addCallback(print_list)
print d
print 'starting reactor'
#l.stop() #will stop the looping calls
reactor.run()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080919/e183eeea/attachment.htm 

From rlotun at gmail.com  Sat Sep 20 05:06:22 2008
From: rlotun at gmail.com (Reza Lotun)
Date: Sat, 20 Sep 2008 10:06:22 +0100
Subject: [Twisted-Python] distributing a commercial project based on
	twisted
Message-ID: <95bb10690809200206k36cec63ak69fcd8b0d01e9b4e@mail.gmail.com>

Hi,

We've successfully used bbfreeze
(http://pypi.python.org/pypi/bbfreeze/0.95.4) to build binaries with
twisted on linux. To make a deb from that binary is pretty easy, read
up on the 'dpkg-deb' command. You can also convert that .deb to an
.rpm using a tool called 'alien'.

Cheers,
Reza



From p.mayers at imperial.ac.uk  Sat Sep 20 06:37:46 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sat, 20 Sep 2008 11:37:46 +0100
Subject: [Twisted-Python] Looping
In-Reply-To: <24dc0be10809192128l57802301q599aeeb016f2d916@mail.gmail.com>
References: <24dc0be10809192128l57802301q599aeeb016f2d916@mail.gmail.com>
Message-ID: <48D4D27A.3020905@imperial.ac.uk>

David Wilson wrote:
> Hi All,
> I'm trying to pick up Twisted and I'm having trouble with looping.
>  
> I expected that a Deferred returned from a looping call would be 
> available after each call.  But it's only available after the loop is 

It's not, and if you think about it, it can't - a loopingcall is setup 
once and run indefinitely, who would you be "returning" the deferreds 
to, and how?

Just call your handler from within your loopingcall i.e.

def check_file(fp, cb):
   # blah blah
   for line in lines:
     cb(line)



> stopped.  Am I looking for a different class?
>  
> Thanks,
> Dave
>  
> p.s.  Ultimately I'd like to watch a file and post any new lines up to 
> an HTTP server.  If there is a direct way to get there, please let me 
> know.  Thanks!

The code you show isn't a very robust way of following a file. My advice 
would be to run "tail -F -q name" in a sub-process and accumulate the 
output.

You need to be aware when watching an external file that when you read, 
the whole line might not have been written, so you need to do something 
like this:

buffer = ''
def check(file, handler):
   buffer += file.read()
   if not '\n' in buffer:
     return

   lines = buffer.split('\n')
   # the final "line" in the buffer doesn't have a terminating
   # \n, make it be the buffer and drop it from out list
   buffer = lines.pop()
   for line in lines:
     handler(line)



From zooko at zooko.com  Sat Sep 20 10:49:21 2008
From: zooko at zooko.com (zooko)
Date: Sat, 20 Sep 2008 08:49:21 -0600
Subject: [Twisted-Python] distributing a commercial project based on
	twisted
In-Reply-To: <95bb10690809200206k36cec63ak69fcd8b0d01e9b4e@mail.gmail.com>
References: <95bb10690809200206k36cec63ak69fcd8b0d01e9b4e@mail.gmail.com>
Message-ID: <3FDE6B35-E4D9-4D75-BB61-4507540B61B8@zooko.com>

See also the stdeb tool [1] which produces .deb's from setup.py's  
(assuming that the setup.py's use the standard distutils or setuptools).

Regards,

Zooko

[1] http://stdeb.python-hosting.com/
---
http://allmydata.org -- Tahoe, the Least-Authority Filesystem
http://allmydata.com -- back up all your files for $5/month



From exarkun at twistedmatrix.com  Sun Sep 21 00:05:09 2008
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 21 Sep 2008 04:05:09 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1221969909.17.825450898@twistedmatrix.com

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080921/09fb68c3/attachment.htm 

From tiredashell at gmail.com  Sun Sep 21 20:35:42 2008
From: tiredashell at gmail.com (Z. S. O.)
Date: Sun, 21 Sep 2008 20:35:42 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
Message-ID: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>

Hi list, I'd like to revive a topic touched on in the past. I'm playing with
python socket programming and decided I want to make a simplistic bittorrent
clone that uses UDP instead of TCP. My main reasons for the protocol choice
are (1) I don't need guaranteed in-order delivery, and (2) I need to get
around NAT restrictions without making the user manually forward ports.
Couple questions...

1. Are those good reasons to ditch TCP, or am I being an idiot? (Always a
possibility.)

2. Even though I don't need TCP's in-order guarantee, I still need an
ACKing mechanism to make sure all the packets eventually arrive. Is there
any (simple) code written that accomplishes this with UDP?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080921/bc0ea1f0/attachment.htm 

From exarkun at divmod.com  Sun Sep 21 20:44:22 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 21 Sep 2008 20:44:22 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>
Message-ID: <20080922004422.29191.1404108468.divmod.quotient.29504@ohm>

On Sun, 21 Sep 2008 20:35:42 -0400, "Z. S. O." <tiredashell at gmail.com> wrote:
>Hi list, I'd like to revive a topic touched on in the past. I'm playing with
>python socket programming and decided I want to make a simplistic bittorrent
>clone that uses UDP instead of TCP. My main reasons for the protocol choice
>are (1) I don't need guaranteed in-order delivery, and (2) I need to get
>around NAT restrictions without making the user manually forward ports.
>Couple questions...
>
>1. Are those good reasons to ditch TCP, or am I being an idiot? (Always a
>possibility.)

It's not easier to get UDP through NATs.  It's just as hard or harder.

>
>2. Even though I don't need TCP's in-order guarantee, I still need an
>ACKing mechanism to make sure all the packets eventually arrive. Is there
>any (simple) code written that accomplishes this with UDP?
>

Jean-Paul



From itamar at itamarst.org  Sun Sep 21 20:55:56 2008
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 21 Sep 2008 20:55:56 -0400
Subject: [Twisted-Python] Twisted sprint next Sunday
Message-ID: <48D6ED1C.1080508@itamarst.org>

Unless someone vetoes this, I am going to take glyph up on his offer and 
preemptively declare a Twisted sprint for next Sunday, September 28, to 
take place at the Divmod offices in Cambridge, MA. Unfortunately I don't 
actually know what the address of the Divmod office is, or what the 
earliest hour we can expect someone to be there, so I will leave these 
details up to someone else.

Those who cannot make it to Boston are of course welcome to work in 
parallel elsewhere. Those who can't work on that day are of course 
welcome to work any day they feel like :)



From tiredashell at gmail.com  Sun Sep 21 21:06:12 2008
From: tiredashell at gmail.com (Z. S. O.)
Date: Sun, 21 Sep 2008 21:06:12 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <20080922004422.29191.1404108468.divmod.quotient.29504@ohm>
References: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>
	<20080922004422.29191.1404108468.divmod.quotient.29504@ohm>
Message-ID: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>

> It's not easier to get UDP through NATs.  It's just as hard or harder.


It must be a widely held error, then, because it's what I hear every time
the subject arises. My understanding was that since UDP doesn't have the
concept of "streams," most NATs will allow all UDP packets through to a
given port one it is first hole-punched.

Nat traversal aside, I'm also concerned about performance, and since TCP
doesn't make in-order delivery optional, I'm still tempted to stick with
UDP...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080921/e1e8430f/attachment.htm 

From exarkun at divmod.com  Sun Sep 21 21:12:27 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 21 Sep 2008 21:12:27 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
Message-ID: <20080922011227.29191.861647876.divmod.quotient.29517@ohm>

On Sun, 21 Sep 2008 21:06:12 -0400, "Z. S. O." <tiredashell at gmail.com> wrote:
>> It's not easier to get UDP through NATs.  It's just as hard or harder.
>
>
>It must be a widely held error, then, because it's what I hear every time
>the subject arises. My understanding was that since UDP doesn't have the
>concept of "streams," most NATs will allow all UDP packets through to a
>given port one it is first hole-punched.
>
>Nat traversal aside, I'm also concerned about performance, and since TCP
>doesn't make in-order delivery optional, I'm still tempted to stick with
>UDP...
>

For a bittorrent-like application, you're also not particularly concerned
with *latency*, just throughput.  Allowing out-of-order delivery primarily
reduces latency, it doesn't do a whole lot for throughput.

Jean-Paul



From tiredashell at gmail.com  Sun Sep 21 21:33:43 2008
From: tiredashell at gmail.com (Z. S. O.)
Date: Sun, 21 Sep 2008 21:33:43 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <20080922011227.29191.861647876.divmod.quotient.29517@ohm>
References: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
	<20080922011227.29191.861647876.divmod.quotient.29517@ohm>
Message-ID: <d6bdc39c0809211833x61516a80u77244b1e0efac734@mail.gmail.com>

>
> For a bittorrent-like application, you're also not particularly concerned
> with *latency*, just throughput.  Allowing out-of-order delivery primarily
> reduces latency, it doesn't do a whole lot for throughput.


That's a good point, I didn't consider that. Latency is only really
important for streaming media and gaming, so this probably is a bad idea
after all. Well anyway thanks for the input, I appreciate it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080921/de20ccc4/attachment.htm 

From paulalexwilson at gmail.com  Mon Sep 22 04:37:10 2008
From: paulalexwilson at gmail.com (Paul Wilson)
Date: Mon, 22 Sep 2008 09:37:10 +0100
Subject: [Twisted-Python] Twisted Plugins that for classes that implement
	interfaces
Message-ID: <3c3d11cf0809220137w6391a96anb759ff83f20f602e@mail.gmail.com>

Hi all,

I'd like to be able to use the twisted plugin mechanism to extract
classes that implement given interfaces. I've successfully followed
the examples to get an iterator over _objects_ that provide my
interfaces, but can't find a way to get just the classes.

Does such a facility exist or am I going to need a rethink? Thanks in advance...

Paul



From phil at bubblehouse.org  Mon Sep 22 08:32:50 2008
From: phil at bubblehouse.org (Phil Christensen)
Date: Mon, 22 Sep 2008 08:32:50 -0400
Subject: [Twisted-Python] Twisted Plugins that for classes that implement
	interfaces
In-Reply-To: <3c3d11cf0809220137w6391a96anb759ff83f20f602e@mail.gmail.com>
References: <3c3d11cf0809220137w6391a96anb759ff83f20f602e@mail.gmail.com>
Message-ID: <9950F874-E253-49EC-808D-E572FC9CAE4E@bubblehouse.org>

On Sep 22, 2008, at 4:37 AM, Paul Wilson wrote:
> Hi all,
>
> I'd like to be able to use the twisted plugin mechanism to extract
> classes that implement given interfaces. I've successfully followed
> the examples to get an iterator over _objects_ that provide my
> interfaces, but can't find a way to get just the classes.
>
> Does such a facility exist or am I going to need a rethink? Thanks  
> in advance...

Hi Paul,

Try using classProvides() instead of implements() in your class  
definition. That should result in the plugin system returning the  
class itself, instead of the instance.

-phil



From paulalexwilson at gmail.com  Mon Sep 22 08:45:31 2008
From: paulalexwilson at gmail.com (Paul Wilson)
Date: Mon, 22 Sep 2008 13:45:31 +0100
Subject: [Twisted-Python] Twisted Plugins that for classes that implement
	interfaces
In-Reply-To: <9950F874-E253-49EC-808D-E572FC9CAE4E@bubblehouse.org>
References: <3c3d11cf0809220137w6391a96anb759ff83f20f602e@mail.gmail.com>
	<9950F874-E253-49EC-808D-E572FC9CAE4E@bubblehouse.org>
Message-ID: <3c3d11cf0809220545n595f4a97k95969e86d6ddd4e@mail.gmail.com>

2008/9/22 Phil Christensen <phil at bubblehouse.org>:
> On Sep 22, 2008, at 4:37 AM, Paul Wilson wrote:
>>
>> Hi all,
>>
>> I'd like to be able to use the twisted plugin mechanism to extract
>> classes that implement given interfaces. I've successfully followed
>> the examples to get an iterator over _objects_ that provide my
>> interfaces, but can't find a way to get just the classes.
>>
>> Does such a facility exist or am I going to need a rethink? Thanks in
>> advance...
>
> Hi Paul,
>
> Try using classProvides() instead of implements() in your class definition.
> That should result in the plugin system returning the class itself, instead
> of the instance.
>
> -phil
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>

Brilliant. Thank's fixed it!



From bernat at luffy.cx  Mon Sep 22 09:12:53 2008
From: bernat at luffy.cx (Vincent Bernat)
Date: Mon, 22 Sep 2008 15:12:53 +0200
Subject: [Twisted-Python] Having some kind of "finally" clause
Message-ID: <145518663ff04ce4300f2ccdf3b2ee4a@chopper.luffy.cx>


Hi!

I would like to do something like this with Twisted:

x.open()
try:
 x.someoperations()
 x.otheroperations()
finally:
 x.close()

I could do something like this :

d = open_and_get_x()
d.addCallback(someoperations)
d.addCallback(otheroperations)
d.addBoth(closeAndReRaiseIfError)
return d

Each callback would return x to let the next callback proceed it. However,
if there is an error, I have no "x" to close in "closeAndReRaiseIfError".
How can I do that?

Thanks.



From exarkun at divmod.com  Mon Sep 22 09:23:31 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 22 Sep 2008 09:23:31 -0400
Subject: [Twisted-Python] Having some kind of "finally" clause
In-Reply-To: <145518663ff04ce4300f2ccdf3b2ee4a@chopper.luffy.cx>
Message-ID: <20080922132331.29191.1456701601.divmod.quotient.29703@ohm>

On Mon, 22 Sep 2008 15:12:53 +0200, Vincent Bernat <bernat at luffy.cx> wrote:
>
>Hi!
>
>I would like to do something like this with Twisted:
>
>x.open()
>try:
> x.someoperations()
> x.otheroperations()
>finally:
> x.close()
>
>I could do something like this :
>
>d = open_and_get_x()
>d.addCallback(someoperations)
>d.addCallback(otheroperations)
>d.addBoth(closeAndReRaiseIfError)
>return d
>
>Each callback would return x to let the next callback proceed it. However,
>if there is an error, I have no "x" to close in "closeAndReRaiseIfError".
>How can I do that?

There are a lot of ways.  You could make x an attribute of a shared object,
or you could close over it in the first callback to create the "finally"
handler, or you could pass it along as an argument to the `addBoth? call
(again, in the first callback).

Notice that there's a slight difference between the two code examples you
gave.  The first won't close x in response to errors from `x.open()?, but
`closeAndReRaiseIfError? will be called even for errors from `open_and_get_x?.
If you only add the finally handler in the first callback attached to `d?,
then this difference goes away.

Jean-Paul



>
>Thanks.
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From foom at fuhm.net  Mon Sep 22 10:07:04 2008
From: foom at fuhm.net (James Y Knight)
Date: Mon, 22 Sep 2008 10:07:04 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
References: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>
	<20080922004422.29191.1404108468.divmod.quotient.29504@ohm>
	<d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
Message-ID: <1B92D686-C00A-47DD-A9BC-C3202F1C7DC4@fuhm.net>


On Sep 21, 2008, at 9:06 PM, Z. S. O. wrote:
> It's not easier to get UDP through NATs.  It's just as hard or harder.
>
> It must be a widely held error, then, because it's what I hear every  
> time the subject arises. My understanding was that since UDP doesn't  
> have the concept of "streams," most NATs will allow all UDP packets  
> through to a given port one it is first hole-punched.

Yes, that's usually true, especially for home NATs. Some NATs do  
actually track UDP conversations between endpoints just like TCP  
streams, though. Traversing a NAT with UDP is /usually/ easier, when  
you have multiple endpoints you wish to hear from. But don't forget  
about the other kinds of NATs too, which you'll also have to implement  
support for. That's what makes it hard: implementing things multiple  
times for all the different network topologies.

> Nat traversal aside, I'm also concerned about performance, and since  
> TCP doesn't make in-order delivery optional, I'm still tempted to  
> stick with UDP...

Not entirely true. In order delivery is preserved to your application,  
but out-of-order delivery between the host endpoints is supported.  
Read up on the TCP "selective ACK" feature [1], which basically all  
OSes made since 1998 or so support. So a missed packet or two doesn't  
actually require all later data to always be retransmitted.

James

[1] http://www.ietf.org/rfc/rfc2018.txt




From andreengels at gmail.com  Mon Sep 22 10:30:55 2008
From: andreengels at gmail.com (Andre Engels)
Date: Mon, 22 Sep 2008 16:30:55 +0200
Subject: [Twisted-Python] UDP & TCP
Message-ID: <6faf39c90809220730l19a4ec97p45952ddb5a5f1a01@mail.gmail.com>

How can I program a service in Twisted that listens for both UDP and
TCP traffic at the same port? I naively created two services for it,
but then got into an error message because I was listening the same
port twice.

-- 
Andr? Engels, andreengels at gmail.com

From andreengels at gmail.com  Mon Sep 22 10:34:33 2008
From: andreengels at gmail.com (Andre Engels)
Date: Mon, 22 Sep 2008 16:34:33 +0200
Subject: [Twisted-Python] Re: UDP & TCP
In-Reply-To: <6faf39c90809220730l19a4ec97p45952ddb5a5f1a01@mail.gmail.com>
References: <6faf39c90809220730l19a4ec97p45952ddb5a5f1a01@mail.gmail.com>
Message-ID: <6faf39c90809220734j480acbcfn12207badcd335e6a@mail.gmail.com>

Disregard my message; it seems the problem was that the port I tried
to use was really in use, because using the same setup on another port
DID work.

On Mon, Sep 22, 2008 at 4:30 PM, Andre Engels <andreengels at gmail.com> wrote:
> How can I program a service in Twisted that listens for both UDP and
> TCP traffic at the same port? I naively created two services for it,
> but then got into an error message because I was listening the same
> port twice.
>
> --
> Andr? Engels, andreengels at gmail.com
>



-- 
Andr? Engels, andreengels at gmail.com

From bernat at luffy.cx  Mon Sep 22 12:48:37 2008
From: bernat at luffy.cx (Vincent Bernat)
Date: Mon, 22 Sep 2008 18:48:37 +0200
Subject: [Twisted-Python] Having some kind of "finally" clause
In-Reply-To: <20080922132331.29191.1456701601.divmod.quotient.29703@ohm>
	(Jean-Paul Calderone's message of "Mon, 22 Sep 2008 09:23:31 -0400")
References: <20080922132331.29191.1456701601.divmod.quotient.29703@ohm>
Message-ID: <m3bpygnn2y.fsf@neo.luffy.cx>

OoO En ce d?but d'apr?s-midi ensoleill? du lundi 22 septembre 2008, vers
15:23, Jean-Paul Calderone <exarkun at divmod.com> disait?:

> There are a lot of ways.  You could make x an attribute of a shared object,
> or you could close over it in the first callback to create the "finally"
> handler, or you could pass it along as an argument to the `addBoth? call
> (again, in the first callback).

Thanks for the tip. I am now using the last approach.
-- 
 /* Nobody will ever see this message :-) */
panic("Cannot initialize video hardware\n");
	2.0.38 /usr/src/linux/arch/m68k/atari/atafb.c



From glyph at divmod.com  Mon Sep 22 14:24:52 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Mon, 22 Sep 2008 18:24:52 -0000
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
References: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>
	<20080922004422.29191.1404108468.divmod.quotient.29504@ohm>
	<d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
Message-ID: <20080922182452.31635.1446250201.divmod.xquotient.44@weber.divmod.com>

On 01:06 am, tiredashell at gmail.com wrote:
>>It's not easier to get UDP through NATs.  It's just as hard or harder.
>
>It must be a widely held error, then, because it's what I hear every 
>time
>the subject arises. My understanding was that since UDP doesn't have 
>the
>concept of "streams," most NATs will allow all UDP packets through to a
>given port one it is first hole-punched.

If you are a piece of software behind a NAT, and you want to accept a 
connection from a peer, there are three things you can do:

  1. Require some explicit configuration from the user; ask them to punch 
a hole through their NAT and tell you what port to use.  This is by far 
the easiest for you, but considered unacceptable since its default 
configuration will usually be broken.
  2. Use a protocol like UPnP or Nat-PMP to get around the user's router. 
This will work on a minority of deployed endpoints, but when it does 
work it will work great, and your application can just make regular TCP 
connections.
  3. Punch a hole, abusing the router's NAT routing rules in order to get 
it to think it's making a connection when it is actually accepting one. 
There are about six different ways to do this, but you can do it with 
UDP *or* TCP.  Different routers support different schemes, and I don't 
just mean "some support TCP, some support UDP": UDP port mapping 
_usually_ works a certain way, but there are exceptions.  You should at 
least read the papers referenced here:  http://midcom- 
p2p.sourceforge.net/

In order to build a truly robust application you will need to do all of 
the above.  Even if you do #2 and #3 perfectly, there are a surprising 
percentage of home routers (say, 5-10%) which are just buggy and won't 
route your traffic properly to another NAT no matter what you do, so you 
always need to provide a "just tell the NAT what to do manually" option. 
(Or, forward your traffic through some known-to-work intermediary.)
>Nat traversal aside, I'm also concerned about performance, and since 
>TCP
>doesn't make in-order delivery optional, I'm still tempted to stick 
>with
>UDP...

TCP will, in general, "perform" better than UDP, because TCP can cheat 
whereas UDP can't.  Your ISP can (and probably does, according to rumors 
I've heard from people who have worked on such things) deploy "smart" 
routers which can prioritize traffic using the additional information 
present in TCP headers which UDP doesn't provide.  Plus, there are 
things that your operating system is doing (as James already mentioned) 
that are extensions to the core TCP spec.

If you don't understand _at least_ enough about TCP to have implemented 
it yourself once, then you probably don't understand enough to make the 
decision to use UDP for performance reasons.  I am saying this because 
it was at the point where I actually implemented TCP myself that I 
gained this insight :).

I started a project a while ago to try to abstract away all this NAT- 
traversal nonsense and present an API for making a connection to a peer- 
to-peer user over whatever methods are available.  It's definitely in 
need of some maintenance, but if you're already using Twisted I think 
you'll find it easier to get started with this than to build your own 
P2P framework from the ground up: 
http://divmod.org/trac/wiki/DivmodVertex

Good luck!



From gabriel.rossetti at arimaz.com  Tue Sep 23 05:24:54 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 23 Sep 2008 11:24:54 +0200
Subject: [Twisted-Python] Multi-service install
Message-ID: <48D8B5E6.1050502@arimaz.com>

Hello everyone,

I have written an application that has one server and multiple clients 
using twisted. I would need to be able to install/run it under windows 
(for now) as an executable or a service. I can't have to have to install 
python and all the deps, this needs to be a drag-n-drop-n-execute-it-n- 
it-works deal, sort of like apple "app" files. I personally run each 
service (client) and the server as a diff. process as using twistd with 
one tac file seems slower. One of the services has a wx GUI too. Does 
anyone have any pointers/ideas/links concerning this? I saw that py2exe 
and freeze exists, but from the mailing list archives I couldn't tell it 
it really works.

Thank you,
Gabriel



From kevin.horn at gmail.com  Tue Sep 23 15:03:24 2008
From: kevin.horn at gmail.com (Kevin Horn)
Date: Tue, 23 Sep 2008 14:03:24 -0500
Subject: [Twisted-Python] Multi-service install
In-Reply-To: <48D8B5E6.1050502@arimaz.com>
References: <48D8B5E6.1050502@arimaz.com>
Message-ID: <562bcc10809231203q65187f57o3cf5678bf2d7bacf@mail.gmail.com>

I would probably try to use py2exe, possibly with moonfallen's ntsvc code
here:
http://twistedmatrix.com/trac/browser/sandbox/moonfallen

That should at least get you started.

Kevin Horn

On Tue, Sep 23, 2008 at 4:24 AM, Gabriel Rossetti <
gabriel.rossetti at arimaz.com> wrote:

> Hello everyone,
>
> I have written an application that has one server and multiple clients
> using twisted. I would need to be able to install/run it under windows (for
> now) as an executable or a service. I can't have to have to install python
> and all the deps, this needs to be a drag-n-drop-n-execute-it-n- it-works
> deal, sort of like apple "app" files. I personally run each service (client)
> and the server as a diff. process as using twistd with one tac file seems
> slower. One of the services has a wx GUI too. Does anyone have any
> pointers/ideas/links concerning this? I saw that py2exe and freeze exists,
> but from the mailing list archives I couldn't tell it it really works.
>
> Thank you,
> Gabriel
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080923/40059317/attachment.htm 

From glen.mabey at swri.org  Tue Sep 23 17:58:48 2008
From: glen.mabey at swri.org (Glen Mabey)
Date: Tue, 23 Sep 2008 16:58:48 -0500
Subject: [Twisted-Python] failure to connect to sshsimpleserver.py
Message-ID: <67BD154E-3A46-47CA-ACE8-3753732A9172@swri.org>

Hello,

I'm just starting to use twisted (having quickly read through the book  
"Twisted: Network Programming Essentials"), and I am unable to  
successfully use one of the example scripts:  doc/conch/examples/ 
sshsimpleserver.py .

I am using python 2.5.2 and today's svn of twisted and pycrypto on  
RedHat AS5 x84-64.  I experienced similar results with 8.1.0 .

I am able to start the server with no problem, but when I start a  
client that connects to it, I get:


2008-09-23 21:51:08+0000 [-] Log opened.
2008-09-23 21:51:08+0000 [-] __main__.ExampleFactory starting on 5022
2008-09-23 21:51:08+0000 [-] Starting factory <__main__.ExampleFactory  
instance at 0x17e60a28>
2008-09-23 21:51:10+0000 [__main__.ExampleFactory] disabling diffie- 
hellman-group-exchange because we cannot find moduli file
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] kex alg, key  
alg: diffie-hellman-group1-sha1 ssh-rsa
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] outgoing:  
aes256-ctr hmac-sha1 none
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] incoming:  
aes256-ctr hmac-sha1 none
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] Unhandled  
Error
	Traceback (most recent call last):
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/python/log.py", line 51, in  
callWithLogger
	    return callWithContext({"system": lp}, func, *args, **kw)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/python/log.py", line 36, in  
callWithContext
	    return context.call({ILogContext: newCtx}, func, *args, **kw)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/python/context.py", line 59, in  
callWithContext
	    return self.currentContext().callWithContext(ctx, func, *args,  
**kw)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/python/context.py", line 37, in  
callWithContext
	    return func(*args,**kw)
	--- <exception caught here> ---
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/internet/selectreactor.py", line 146,  
in _doReadOrWrite
	    why = getattr(selectable, method)()
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/internet/tcp.py", line 463, in doRead
	    return self.protocol.dataReceived(data)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/conch/ssh/transport.py", line 314, in  
dataReceived
	    self.dispatchMessage(messageNum, packet[1:])
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/conch/ssh/transport.py", line 329, in  
dispatchMessage
	    f(payload)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/conch/ssh/transport.py", line 740, in  
ssh_KEX_DH_GEX_REQUEST_OLD
	    NS(self.factory.privateKeys[self.keyAlg].sign(exchangeHash)))
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/conch/ssh/keys.py", line 659, in sign
	    signature = self.keyObject.sign(digest, '')[0]
	  File "/usr/DiamondBack/stow/pycrypto-20080923_git-py2.5/lib/ 
python2.5/site-packages/Crypto/PublicKey/pubkey.py", line 76, in sign
	    return self._sign(M, K)
	exceptions.TypeError: _sign() takes exactly 2 arguments (3 given)
	
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] connection  
lost



I have tried starting the client both as 'ssh localhost -p 5022' as  
well as running the sshsimpleclient.py script with the same results.

I have also tried connecting from a different host into the server,  
with the same results.

Any help in resolving this issue and realizing a working example of an  
ssh server would be greatly appreciated.

Thank you,
Glen Mabey



From exarkun at divmod.com  Tue Sep 23 18:06:07 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 23 Sep 2008 18:06:07 -0400
Subject: [Twisted-Python] failure to connect to sshsimpleserver.py
In-Reply-To: <67BD154E-3A46-47CA-ACE8-3753732A9172@swri.org>
Message-ID: <20080923220607.29191.505826685.divmod.quotient.30030@ohm>

On Tue, 23 Sep 2008 16:58:48 -0500, Glen Mabey <glen.mabey at swri.org> wrote:
>Hello,
>
>I'm just starting to use twisted (having quickly read through the book 
>"Twisted: Network Programming Essentials"), and I am unable to  successfully 
>use one of the example scripts:  doc/conch/examples/ sshsimpleserver.py .
>
>I am using python 2.5.2 and today's svn of twisted and pycrypto on  RedHat 
>AS5 x84-64.  I experienced similar results with 8.1.0 .

This looks a lot like a bug in PyCrypto:

>
>I am able to start the server with no problem, but when I start a  client 
>that connects to it, I get:
>
> [snip]
>           File "/usr/DiamondBack/stow/pycrypto-20080923_git-py2.5/lib/ 
>python2.5/site-packages/Crypto/PublicKey/pubkey.py", line 76, in sign
>             return self._sign(M, K)
>         exceptions.TypeError: _sign() takes exactly 2 arguments (3 given)

This is a file in PyCrypto itself, calling a method in PyCrypto itself,
and passing the wrong arguments.

You might want to try using the last release of PyCrypto instead of the
latest development snapshot.  You might also want to file a bug with the
PyCrypto maintainer (it seems there's a new one now) to get this fixed.

Jean-Paul



From glen.mabey at swri.org  Tue Sep 23 18:13:43 2008
From: glen.mabey at swri.org (Glen Mabey)
Date: Tue, 23 Sep 2008 17:13:43 -0500
Subject: [Twisted-Python] failure to connect to sshsimpleserver.py
In-Reply-To: <20080923220607.29191.505826685.divmod.quotient.30030@ohm>
References: <20080923220607.29191.505826685.divmod.quotient.30030@ohm>
Message-ID: <4CA35971-713B-4D0A-8F52-5EEE42CA6981@swri.org>

Hi Jean-Paul,

On Sep 23, 2008, at 5:06 PM, Jean-Paul Calderone wrote:

> This looks a lot like a bug in PyCrypto:

Yeah, I should have noticed that myself.

> This is a file in PyCrypto itself, calling a method in PyCrypto  
> itself,
> and passing the wrong arguments.
>
> You might want to try using the last release of PyCrypto instead of  
> the
> latest development snapshot.  You might also want to file a bug with  
> the
> PyCrypto maintainer (it seems there's a new one now) to get this  
> fixed.

I did revert to 2.0.1 and the problem did go away.

I will file a bug report to the PyCrypto guy.

Thank you,
Glen Mabey




From gabriel.rossetti at arimaz.com  Wed Sep 24 02:24:17 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Wed, 24 Sep 2008 08:24:17 +0200
Subject: [Twisted-Python] Multi-service install
In-Reply-To: <562bcc10809231203q65187f57o3cf5678bf2d7bacf@mail.gmail.com>
References: <48D8B5E6.1050502@arimaz.com>
	<562bcc10809231203q65187f57o3cf5678bf2d7bacf@mail.gmail.com>
Message-ID: <48D9DD11.4060401@arimaz.com>

Ok, thank you, I'll have a look at that.

Gabriel Rossetti

Kevin Horn wrote:
> I would probably try to use py2exe, possibly with moonfallen's ntsvc 
> code here:
> http://twistedmatrix.com/trac/browser/sandbox/moonfallen
>
> That should at least get you started.
>
> Kevin Horn
>
> On Tue, Sep 23, 2008 at 4:24 AM, Gabriel Rossetti 
> <gabriel.rossetti at arimaz.com <mailto:gabriel.rossetti at arimaz.com>> wrote:
>
>     Hello everyone,
>
>     I have written an application that has one server and multiple
>     clients using twisted. I would need to be able to install/run it
>     under windows (for now) as an executable or a service. I can't
>     have to have to install python and all the deps, this needs to be
>     a drag-n-drop-n-execute-it-n- it-works deal, sort of like apple
>     "app" files. I personally run each service (client) and the server
>     as a diff. process as using twistd with one tac file seems slower.
>     One of the services has a wx GUI too. Does anyone have any
>     pointers/ideas/links concerning this? I saw that py2exe and freeze
>     exists, but from the mailing list archives I couldn't tell it it
>     really works.
>
>     Thank you,
>     Gabriel
>
>     _______________________________________________
>     Twisted-Python mailing list
>     Twisted-Python at twistedmatrix.com
>     <mailto:Twisted-Python at twistedmatrix.com>
>     http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>   



From vvangelovski at gmail.com  Wed Sep 24 08:47:02 2008
From: vvangelovski at gmail.com (Vasil Vangelovski)
Date: Wed, 24 Sep 2008 14:47:02 +0200
Subject: [Twisted-Python] A question about errorback failure objects
Message-ID: <406b9fda0809240547y4bbf7234jbd79c228bddc5ab4@mail.gmail.com>

When an errorback gets called with a failure parameter what is the
best way to get the stack trace (to see what lines at what files
caused the error)?



From exarkun at divmod.com  Wed Sep 24 10:01:23 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 24 Sep 2008 10:01:23 -0400
Subject: [Twisted-Python] A question about errorback failure objects
In-Reply-To: <406b9fda0809240547y4bbf7234jbd79c228bddc5ab4@mail.gmail.com>
Message-ID: <20080924140123.29191.1528701373.divmod.quotient.30166@ohm>

On Wed, 24 Sep 2008 14:47:02 +0200, Vasil Vangelovski <vvangelovski at gmail.com> wrote:
>When an errorback gets called with a failure parameter what is the
>best way to get the stack trace (to see what lines at what files
>caused the error)?
>

You can find the API documentation for failures here:

  http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html

You might be interested in the printTraceback method.  You can also
pass a failure to twisted.python.log.err and a traceback will be written.

Keep in mind, however, that not all failures have tracebacks.  If you try
printing a failure's traceback and don't see anything interesting, this
may be because the failure wasn't created with a traceback.  In this case,
running with failure debugging enabled (eg, with twistd --debug) may provide
more useful information, since it will set a breakpoint on failure creation,
letting you inspect the creation context.

Jean-Paul



From krokodil at gmail.com  Wed Sep 24 15:16:29 2008
From: krokodil at gmail.com (Vadim Zaliva)
Date: Wed, 24 Sep 2008 12:16:29 -0700
Subject: [Twisted-Python] concurrency via reactor
Message-ID: <3d7addec0809241216n1290b817x6049ce66c0df197f@mail.gmail.com>

Hi!

I am writing some code which requires synchronization between several
TCP clients. I have several connections and at some point I have to
wait for data becoming availiable from several of them. Kind of
"barrier" pattern. I am twising my head how to do it with twisted
using reactor. Could somebody point me into right direction? Thanks!

Vadim



From exarkun at divmod.com  Wed Sep 24 15:19:40 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 24 Sep 2008 15:19:40 -0400
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <3d7addec0809241216n1290b817x6049ce66c0df197f@mail.gmail.com>
Message-ID: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>

On Wed, 24 Sep 2008 12:16:29 -0700, Vadim Zaliva <krokodil at gmail.com> wrote:
>Hi!
>
>I am writing some code which requires synchronization between several
>TCP clients. I have several connections and at some point I have to
>wait for data becoming availiable from several of them. Kind of
>"barrier" pattern. I am twising my head how to do it with twisted
>using reactor. Could somebody point me into right direction? Thanks!

You might want twisted.internet.defer.gatherResults().  It accepts a
list of Deferreds and returns a Deferred that fires when they all fire.

Jean-Paul



From krokodil at gmail.com  Wed Sep 24 17:57:04 2008
From: krokodil at gmail.com (Vadim Zaliva)
Date: Wed, 24 Sep 2008 14:57:04 -0700
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
References: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
Message-ID: <B47F518B-4487-4F88-ABBA-9ADEC9AD72C0@gmail.com>


On Sep 24, 2008, at 12:19, Jean-Paul Calderone wrote:

>> Hi!
>>
>> I am writing some code which requires synchronization between several
>> TCP clients. I have several connections and at some point I have to
>> wait for data becoming availiable from several of them. Kind of
>> "barrier" pattern. I am twising my head how to do it with twisted
>> using reactor. Could somebody point me into right direction? Thanks!
>
> You might want twisted.internet.defer.gatherResults().  It accepts a
> list of Deferreds and returns a Deferred that fires when they all  
> fire.


Jean-Paul,

Thanks! Seems like what I need. The only thing missing is ability to  
specify
timeout parameters, how long to wait for deferred to fire.

Sincerely,
Vadim



From mike at mkp.ca  Wed Sep 24 18:00:19 2008
From: mike at mkp.ca (Mike Pelletier)
Date: Wed, 24 Sep 2008 18:00:19 -0400
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <B47F518B-4487-4F88-ABBA-9ADEC9AD72C0@gmail.com>
References: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
	<B47F518B-4487-4F88-ABBA-9ADEC9AD72C0@gmail.com>
Message-ID: <273093d80809241500h715b88e3rc7e297fd9e75b9b8@mail.gmail.com>

> Thanks! Seems like what I need. The only thing missing is ability to specify
> timeout parameters, how long to wait for deferred to fire.

since gatherResults won't block you can implement your own timeout
with callLater.



From krokodil at gmail.com  Wed Sep 24 19:22:43 2008
From: krokodil at gmail.com (Vadim Zaliva)
Date: Wed, 24 Sep 2008 16:22:43 -0700
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
References: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
Message-ID: <1867458E-38D8-4183-BC08-DB6963017F5A@gmail.com>


On Sep 24, 2008, at 12:19, Jean-Paul Calderone wrote:

> You might want twisted.internet.defer.gatherResults().  It accepts a
> list of Deferreds and returns a Deferred that fires when they all  
> fire.


Pardon my naive questions, but how I can easily call gatherResults() to
wait for all deferred to fire and to return list of results in form of  
list
of (success,result) tuples?

Vadim



From krokodil at gmail.com  Wed Sep 24 20:12:35 2008
From: krokodil at gmail.com (Vadim Zaliva)
Date: Wed, 24 Sep 2008 17:12:35 -0700
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <1867458E-38D8-4183-BC08-DB6963017F5A@gmail.com>
References: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
	<1867458E-38D8-4183-BC08-DB6963017F5A@gmail.com>
Message-ID: <BDAA757A-6A5B-48FB-B465-E03543F1BD7F@gmail.com>


On Sep 24, 2008, at 16:22, Vadim Zaliva wrote:

> Pardon my naive questions, but how I can easily call gatherResults()  
> to
> wait for all deferred to fire and to return list of results in form  
> of list
> of (success,result) tuples?

Never mind. I have managed to do it in asynchronous manner, via  
callbacks.

Vadim



From gabriel.rossetti at arimaz.com  Thu Sep 25 05:33:39 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Thu, 25 Sep 2008 11:33:39 +0200
Subject: [Twisted-Python] LoopingCall question : ping w/ timeout using
	shared variable -> problem
Message-ID: <48DB5AF3.1030300@arimaz.com>

Hello everyone!

I have written some code uses a LoopingCall to send a "ping" at regular 
intervals. If it hasn't received an answer before the next call, it 
notifies me that the destination isn't available, if it does then it 
does nothing. I am getting lots of "unavailables" on hosts that are, I 
tried augmenting the timeout (the ping interval) and it doesn't change 
anything. I think what is happening is I'm using a simple variable to 
keep the availability state and that since protocol and the 
LoopingCall's callback both access the variable, this causes problems. 
Is there a better way of doing things or am I bound to use some sort of 
locking mechanism? If I have to use locking, which one do you recommend?

Thank you,
Gabriel



From gabriel.rossetti at arimaz.com  Thu Sep 25 08:40:01 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Thu, 25 Sep 2008 14:40:01 +0200
Subject: [Twisted-Python] LoopingCall question : ping w/ timeout using
	shared variable -> problem
In-Reply-To: <48DB5AF3.1030300@arimaz.com>
References: <48DB5AF3.1030300@arimaz.com>
Message-ID: <48DB86A1.4090902@arimaz.com>

Gabriel Rossetti wrote:
> Hello everyone!
>
> I have written some code uses a LoopingCall to send a "ping" at 
> regular intervals. If it hasn't received an answer before the next 
> call, it notifies me that the destination isn't available, if it does 
> then it does nothing. I am getting lots of "unavailables" on hosts 
> that are, I tried augmenting the timeout (the ping interval) and it 
> doesn't change anything. I think what is happening is I'm using a 
> simple variable to keep the availability state and that since protocol 
> and the LoopingCall's callback both access the variable, this causes 
> problems. Is there a better way of doing things or am I bound to use 
> some sort of locking mechanism? If I have to use locking, which one do 
> you recommend?
>
> Thank you,
> Gabriel
>
I tried using a reactor.callLater call and if it fires then it notifies 
me (unavailable) and if I get the response I cancel it and start over, 
this seams like a better approach.

Gabriel



From wyhross at gmail.com  Thu Sep 25 21:18:55 2008
From: wyhross at gmail.com (ross ross)
Date: Fri, 26 Sep 2008 09:18:55 +0800
Subject: [Twisted-Python] leave this maillist!
Message-ID: <ae5f1a540809251818j26ad4083t7765debc48dfaa3@mail.gmail.com>

plaease delete my mail address from this maillist, thanks!

Ross!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080926/448328eb/attachment.htm 

From gabriel.rossetti at arimaz.com  Fri Sep 26 10:13:34 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Fri, 26 Sep 2008 16:13:34 +0200
Subject: [Twisted-Python] py2exe with Twisted and plugins, plugins not found
Message-ID: <48DCEE0E.7030708@arimaz.com>

Hello everybody,

I am trying to use py2exe with twisted, but I'm running into a problem : 
one of my classes uses twisted's plugin mechanism and they aren't 
loaded. I tried the python version and it works correctly. I saw that to 
use sqlite with storm I have to explicitly import it somewhere like so :

 import storm.databases.sqlite

because py2exe wasn't finding it since it's imported using __import__(), 
do I have to do something like that with twisted?

Thank you,
Gabriel



From exarkun at divmod.com  Fri Sep 26 10:30:27 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 26 Sep 2008 10:30:27 -0400
Subject: [Twisted-Python] Twisted sprint next Sunday
In-Reply-To: <48D6ED1C.1080508@itamarst.org>
Message-ID: <20080926143027.29191.1999853794.divmod.quotient.30592@ohm>

On Sun, 21 Sep 2008 20:55:56 -0400, Itamar Shtull-Trauring <itamar at itamarst.org> wrote:
>Unless someone vetoes this, I am going to take glyph up on his offer and 
>preemptively declare a Twisted sprint for next Sunday, September 28, to take 
>place at the Divmod offices in Cambridge, MA. Unfortunately I don't actually 
>know what the address of the Divmod office is, or what the earliest hour we 
>can expect someone to be there, so I will leave these details up to someone 
>else.

Where: 5 Upland Rd, 2nd Floor, Porter Square, Cambridge, MA
When: 10 AM - whenever

The tentative focus is release automation, but any topics are welcome.

Jean-Paul



From dialtone at gmail.com  Sat Sep 27 03:42:45 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Sat, 27 Sep 2008 00:42:45 -0700
Subject: [Twisted-Python] Ampoule - 0.0.2
Message-ID: <8B49DB20-0642-4A7F-B7E6-B30A6EEF47A4@gmail.com>

I just released Ampoule 0.0.2 on pypi and launchpad

http://pypi.python.org/pypi/ampoule/0.0.2
https://launchpad.net/ampoule/ampoule/0.0.2

Ampoule is a process pool implementation written
on top of Twisted Matrix. Its name comes from the
use of AMP as the default communication protocol
between the pool and all its children.

It's different from other alternative solutions because it
provides an API very close to that of the Twisted ThreadPool.
As an helper function it also provides a deferToAMPProcess
function that creates the ProcessPool and submits jobs to it.

The code is pretty well tested, in fact it contains more test lines
than actual code lines, and it's pretty well documented.

Speedwise on my macbook pro I was able to run about 1700 Ping
calls per second without recycling processes and about 1500 with
a recycling value of about 10000 calls per process.
If anyone wants to contribute a C implementation of amp
serializer/deserializer I'm pretty sure that Ampoule would benefit a
lot from it but for my current tasks 1500 calls per second is more
than fast enough, it's actually pretty fast.

A usage example is the following:

from ampoule import child, util
from twisted.protocols import amp

class Pid(amp.Command):
     response = [("pid", amp.Integer())]

class MyChild(child.AMPChild):
     @Pid.responder
     def pid(self):
         import os
         return {"pid": os.getpid()}

@util.mainpoint
def main(args):
     import sys
     from twisted.internet import reactor, defer
     from twisted.python import log
     log.startLogging(sys.stdout)

     from ampoule import pool

     @defer.inlineCallbacks
     def _run():
         pp = pool.ProcessPool(MyChild)
         yield pp.start()
         result = yield pp.doWork(Pid)
         print "The Child process PID is:", result['pid']
         yield pp.stop()
         reactor.stop()

     reactor.callLater(1, _run)
     reactor.run()

What's new in this version:

Ampoule 0.0.2 (2008-09-26)
==========================

Features
--------
  - Support process recycling after predefined number of calls.

Changes
-------
  - ProcessPool argument max_idle is now maxIdle to comply with Twisted
    style guidelines.

  - removed ampoule.runner module because it was essentially useless,
    if you want to change subprocess startup behavior pass a string that
    contains the new code as an argument by overriding the default
    processFactory for example with a closure like this:

        from ampoule.main import startAMPProcess
        from ampoule.pool import ProcessPool
        pp = ProcessPool()
        def myProcessFactory(*args, **kwargs):
            kwargs['bootstrap'] = myBootstrapCode
            return startAMPProcess(*args, **kwargs)
        pp.processFactory = staticmethod(myProcessFactory)

Have fun with ampoule! :)

--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080927/989e1970/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://twistedmatrix.com/pipermail/twisted-python/attachments/20080927/989e1970/attachment.pgp 

From john.mangual at gmail.com  Sat Sep 27 14:40:51 2008
From: john.mangual at gmail.com (John Mangual)
Date: Sat, 27 Sep 2008 14:40:51 -0400
Subject: [Twisted-Python] jabber_client.py
Message-ID: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>

I looking at all the code libraries for writing jabber clients and I found
twistedwords.  I found jabber_client.py from
http://twistedmatrix.com/projects/words/documentation/examples/jabber_client.pyand
i ran it on my command line but nothing happens.  It's running, but
nothing's happening.  Please help. - john
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080927/d1e72c75/attachment.htm 

From exarkun at twistedmatrix.com  Sun Sep 28 00:05:15 2008
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 28 Sep 2008 04:05:15 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1222574715.14.1125212783@twistedmatrix.com

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080928/3de395e6/attachment.htm 

From shweta3230 at gmail.com  Sun Sep 28 07:13:25 2008
From: shweta3230 at gmail.com (shweta mani)
Date: Sun, 28 Sep 2008 16:43:25 +0530
Subject: [Twisted-Python] DOUBTS PLEASE SOLVE
Message-ID: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>

Hi al i am new to twisted. I had been assigned a project on SSH.
the project is as follows.
i have to login to a remote Linux machine through Windows
i have to execute a shell script  and print the output back in Windows
machine
this needs to be done through SSH.
Any clues . please help. i need it urgently
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080928/33e65bac/attachment.htm 

From exarkun at divmod.com  Sun Sep 28 09:03:18 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 28 Sep 2008 09:03:18 -0400
Subject: [Twisted-Python] DOUBTS PLEASE SOLVE
In-Reply-To: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
Message-ID: <20080928130318.29191.1562573282.divmod.quotient.31312@ohm>

On Sun, 28 Sep 2008 16:43:25 +0530, shweta mani <shweta3230 at gmail.com> wrote:
>Hi al i am new to twisted. I had been assigned a project on SSH.
>the project is as follows.
>i have to login to a remote Linux machine through Windows
>i have to execute a shell script  and print the output back in Windows
>machine
>this needs to be done through SSH.
>Any clues . please help. i need it urgently
>

Take a look at the API docs and the examples.  Perhaps get a copy of
_Twisted Network Programming Essentials_ or find the Conch chapter
online.  If you get stuck, come back with specific questions.

Jean-Paul



From dr.marc.byrd at gmail.com  Sun Sep 28 14:18:48 2008
From: dr.marc.byrd at gmail.com (Marc Byrd)
Date: Sun, 28 Sep 2008 11:18:48 -0700
Subject: [Twisted-Python] Syslog Listener UDP
Message-ID: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>

Hi,

I would like to build a syslog(udp port 514) listener in twisted.  The goal
is to make it compatible with syslog and syslog-ng, which may be configured
on a "client" to send log entries (as they occur) via udp (fire and forget)
to a remote server (my twisted server).

Is there already something out there that would do this or that would be a
good start?

Thanks,


Marc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080928/8ca908ef/attachment.htm 

From ntoper at gmail.com  Sun Sep 28 14:22:57 2008
From: ntoper at gmail.com (Nicolas Toper)
Date: Sun, 28 Sep 2008 20:22:57 +0200
Subject: [Twisted-Python] Syslog Listener UDP
In-Reply-To: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>
References: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>
Message-ID: <fcbb46050809281122m5fed6b9by2d9d7a8ff7b045ce@mail.gmail.com>

Hi,

Is this going to be an open source project?

Best,
Nicolas

On Sun, Sep 28, 2008 at 8:18 PM, Marc Byrd <dr.marc.byrd at gmail.com> wrote:

> Hi,
>
> I would like to build a syslog(udp port 514) listener in twisted.  The goal
> is to make it compatible with syslog and syslog-ng, which may be configured
> on a "client" to send log entries (as they occur) via udp (fire and forget)
> to a remote server (my twisted server).
>
> Is there already something out there that would do this or that would be a
> good start?
>
> Thanks,
>
>
> Marc
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>


-- 
A+
Nico
http://www.deviant-abstraction.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080928/a7633e83/attachment.htm 

From bernat at luffy.cx  Sun Sep 28 17:14:04 2008
From: bernat at luffy.cx (Vincent Bernat)
Date: Sun, 28 Sep 2008 23:14:04 +0200
Subject: [Twisted-Python] Syslog Listener UDP
In-Reply-To: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>
	(Marc Byrd's message of "Sun, 28 Sep 2008 11:18:48 -0700")
References: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>
Message-ID: <m3abdsht2b.fsf@neo.luffy.cx>

OoO  Pendant le  journal t?l?vis?  du dimanche  28 septembre  2008, vers
20:18, "Marc Byrd" <dr.marc.byrd at gmail.com> disait?:

> I would like to build a syslog(udp port 514) listener in twisted.  The goal is
> to make it compatible with syslog and syslog-ng, which may be configured on a
> "client" to send log entries (as they occur) via udp (fire and forget) to a
> remote server (my twisted server). 

> Is there already something out there that would do this or that would be a good
> start?

Because  of the  simplicity of  the syslog  protocol, you  can  just use
UDPServer with  a protocol derived from DatagramProtocol.  You just need
to overload datagramReceived to do  something sensible with the log line
received.

In short:

class SyslogInput(protocol.DatagramProtocol):

      def datagramReceived(self, data):
          print "I have received %r" % data

service = internet.UDPServer(514, SyslogInput())
-- 
I WILL NOT BRING SHEEP TO CLASS
I WILL NOT BRING SHEEP TO CLASS
I WILL NOT BRING SHEEP TO CLASS
-+- Bart Simpson on chalkboard in episode 9F06



From paul at subsignal.org  Sat Sep 27 20:11:49 2008
From: paul at subsignal.org (paul)
Date: Sun, 28 Sep 2008 02:11:49 +0200
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
Message-ID: <gbp2uu$7pr$1@ger.gmane.org>

Jean-Paul Calderone schrieb:
> On Sun, 28 Sep 2008 16:43:25 +0530, shweta mani <shweta3230 at gmail.com> 
> wrote:
>> Hi al i am new to twisted. I had been assigned a project on SSH.
>> the project is as follows.
>> i have to login to a remote Linux machine through Windows
>> i have to execute a shell script  and print the output back in Windows
>> machine
>> this needs to be done through SSH.
>> Any clues . please help. i need it urgently
>>
> 
> Take a look at the API docs and the examples.  Perhaps get a copy of
> _Twisted Network Programming Essentials_ or find the Conch chapter
> online.  If you get stuck, come back with specific questions.

Hope this isn't too offensive but last time I checked conch didn't work 
on win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users 
would be happy with a basic "secure RPC" implementation, no console 
stuff. No idea how much work that is though ...

cheers
  Paul




From exarkun at divmod.com  Sun Sep 28 20:23:42 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 28 Sep 2008 20:23:42 -0400
Subject: [Twisted-Python] Re: doubts please solve
In-Reply-To: <gbp2uu$7pr$1@ger.gmane.org>
Message-ID: <20080929002342.29191.418228950.divmod.quotient.31554@ohm>

On Sun, 28 Sep 2008 02:11:49 +0200, paul <paul at subsignal.org> wrote:
>Jean-Paul Calderone schrieb:
>>On Sun, 28 Sep 2008 16:43:25 +0530, shweta mani <shweta3230 at gmail.com> 
>>wrote:
>>>Hi al i am new to twisted. I had been assigned a project on SSH.
>>>the project is as follows.
>>>i have to login to a remote Linux machine through Windows
>>>i have to execute a shell script  and print the output back in Windows
>>>machine
>>>this needs to be done through SSH.
>>>Any clues . please help. i need it urgently
>>
>>Take a look at the API docs and the examples.  Perhaps get a copy of
>>_Twisted Network Programming Essentials_ or find the Conch chapter
>>online.  If you get stuck, come back with specific questions.
>
>Hope this isn't too offensive but last time I checked conch didn't work on 
>win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users would be 
>happy with a basic "secure RPC" implementation, no console stuff. No idea 
>how much work that is though ...

Ticket 50 is about the conch command line client.  I'm not sure if the
rest of conch, the part you would use to automate an SSH login, works on
Windows or not.  It shouldn't be affected by the lack of an fcntl module
(or any of the other modules missing on Windows), but it may accidentally
import them, preventing the code from working out of the box, even though
it doesn't use them.  This is probably simpler to fix than actually writing
a command line client.  However, it may already work; I don't have a Windows
machine handy to try, but by looking at buildbot I can see that a significant
portion of the Conch test suite runs and passes on there.

Jean-Paul



From christopher.zorn at gmail.com  Mon Sep 29 08:40:41 2008
From: christopher.zorn at gmail.com (Christopher Zorn)
Date: Mon, 29 Sep 2008 08:40:41 -0400
Subject: [Twisted-Python] jabber_client.py
In-Reply-To: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>
References: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>
Message-ID: <149014b90809290540g114a4edn52378db9c195706a@mail.gmail.com>

On Sat, Sep 27, 2008 at 2:40 PM, John Mangual <john.mangual at gmail.com>wrote:

> I looking at all the code libraries for writing jabber clients and I found
> twistedwords.  I found jabber_client.py from
> http://twistedmatrix.com/projects/words/documentation/examples/jabber_client.pyand i ran it on my command line but nothing happens.  It's running, but
> nothing's happening.  Please help. - john
>

There could be a few things that could not be happening. Do you have the
correct username and password?
Do you have the correct server? Does the server use srv records?

If you have the ability you can check your xmpp server logs to see if it
connected.



>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080929/6ab9f211/attachment.htm 

From kevin.horn at gmail.com  Mon Sep 29 16:11:12 2008
From: kevin.horn at gmail.com (Kevin Horn)
Date: Mon, 29 Sep 2008 15:11:12 -0500
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <gbp2uu$7pr$1@ger.gmane.org>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
	<gbp2uu$7pr$1@ger.gmane.org>
Message-ID: <562bcc10809291311m7e6bf4b9qb37f1367dc6cfd57@mail.gmail.com>

For a non-twisted solution, you can also try paramiko:
http://www.lag.net/paramiko/

It might be a bit easier to wrap your brain around if you are very new to
the twisted way of doing things.

It should also work nicely on Win32 (I haven't checked in a while but the
last time I used it it worked fine).

Kevin Horn

On Sat, Sep 27, 2008 at 7:11 PM, paul <paul at subsignal.org> wrote:

> Jean-Paul Calderone schrieb:
>
>> On Sun, 28 Sep 2008 16:43:25 +0530, shweta mani <shweta3230 at gmail.com>
>> wrote:
>>
>>> Hi al i am new to twisted. I had been assigned a project on SSH.
>>> the project is as follows.
>>> i have to login to a remote Linux machine through Windows
>>> i have to execute a shell script  and print the output back in Windows
>>> machine
>>> this needs to be done through SSH.
>>> Any clues . please help. i need it urgently
>>>
>>>
>> Take a look at the API docs and the examples.  Perhaps get a copy of
>> _Twisted Network Programming Essentials_ or find the Conch chapter
>> online.  If you get stuck, come back with specific questions.
>>
>
> Hope this isn't too offensive but last time I checked conch didn't work on
> win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users would
> be happy with a basic "secure RPC" implementation, no console stuff. No idea
> how much work that is though ...
>
> cheers
>
>  Paul
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080929/11c0a442/attachment.htm 

From esteve at fluidinfo.com  Mon Sep 29 16:37:28 2008
From: esteve at fluidinfo.com (Esteve Fernandez)
Date: Mon, 29 Sep 2008 22:37:28 +0200
Subject: [Twisted-Python] txThrift released
Message-ID: <200809292237.28827.esteve@fluidinfo.com>

Hi all,

I'm pleased to announce that Fluidinfo [1] is releasing support for Twisted in 
Apache/Facebook Thrift [2]

Download from https://issues.apache.org/jira/browse/THRIFT-148

We hope to get it accepted into the Thrift core, but in the meantime you can 
apply the patch. There's also a simple example based on the Thrift calculator 
demo.

To add support for Twisted in a Thrift service, simply run "thrift --gen 
py:twisted specfile.thrift" from the command line. For more details, you can 
follow the calculator example, as it covers Thrift extensively.

Feedback and contributions will be greatly appreciated! :-)

Cheers.

PS: the JIRA web page lets you vote issues, so just show your support if you 
think this patch is useful :-)

[1] - Fluidinfo - http://www.fluidinfo.com
[2] - Thrift - http://incubator.apache.org/thrift/



From jack-tp at cs.york.ac.uk  Mon Sep 29 16:37:53 2008
From: jack-tp at cs.york.ac.uk (Jack Whitham)
Date: Mon, 29 Sep 2008 21:37:53 +0100
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <gbp2uu$7pr$1@ger.gmane.org>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
	<gbp2uu$7pr$1@ger.gmane.org>
Message-ID: <20080929203753.GA20132@cs.york.ac.uk>

On Sun, Sep 28, 2008 at 02:11:49AM +0200, paul wrote:
> Hope this isn't too offensive but last time I checked conch didn't work 
> on win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users 
> would be happy with a basic "secure RPC" implementation, no console 
> stuff. No idea how much work that is though ...

Conch does work on Win32, I have written an application that uses
it (not the command line client). You have to install pycrypto 
in addition to Twisted.


-- 
Jack Whitham
jack at cs.york.ac.uk




From iammegatron at gmail.com  Mon Sep 29 18:11:33 2008
From: iammegatron at gmail.com (Zhe Hu)
Date: Mon, 29 Sep 2008 17:11:33 -0500
Subject: [Twisted-Python] twisted reactor under win32 (test SerialPort)
Message-ID: <6bea62950809291511r76a43d4fi117231d9c6455f61@mail.gmail.com>

Hi,I try to use twisted for asynchronous serial port read().

Here is my simple twisted code:
==========================
from twisted.internet import reactor
from twisted.internet.serialport import SerialPort
from twisted.internet.protocol import Protocol

class Client(Protocol):
    def connectionMade(self):
        print 'connected'

    def dataReceived(self, data):
        print data

SerialPort(Client(), 'COM4', reactor)
reactor.callLater(20, reactor.stop())
reactor.run()

==========================

It runs on my Mac with this line changed to SerialPort(Client,
'dev/tty.usbserial-A4001mLL', reactor) which is my Arduino board device.

But on Windows XP, it gave the error message:
"AttributeError: 'module' object has no attribute 'addEvent' "

I tried to used different reactor, such as selectreactor, win32eventreactor,
but the error message became "AssertionError: reactor already installed"

Please help. Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080929/d1f0cd60/attachment.htm 

From gabriel.rossetti at arimaz.com  Tue Sep 30 01:57:09 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 30 Sep 2008 07:57:09 +0200
Subject: [Twisted-Python] jabber_client.py
In-Reply-To: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>
References: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>
Message-ID: <48E1BFB5.1010508@arimaz.com>

John Mangual wrote:
> I looking at all the code libraries for writing jabber clients and I 
> found twistedwords.  I found jabber_client.py from 
> http://twistedmatrix.com/projects/words/documentation/examples/jabber_client.py 
> and i ran it on my command line but nothing happens.  It's running, 
> but nothing's happening.  Please help. - john
> ------------------------------------------------------------------------
>
>   
I had the exact same thing, try the XMPP client, it works great : 
http://twistedmatrix.com/projects/words/documentation/examples/xmpp_client.py

Gabriel



From terry at jon.es  Tue Sep 30 08:53:18 2008
From: terry at jon.es (Terry Jones)
Date: Tue, 30 Sep 2008 14:53:18 +0200
Subject: [Twisted-Python] Question on default t.p.log output
Message-ID: <18658.8510.659765.567315@jon.es>

Greetings Twisted superheroes!

I have a simple question about logging. Here's a snippet of code:

    from twisted.python import log
    from twisted.web import client
    from twisted.internet import reactor
    import sys

    log.startLogging(sys.stdout)
    def stop(x): reactor.callLater(0, reactor.stop)
    client.getPage('http://www.divmod.com').addBoth(stop)
    reactor.run()

This produces the output

    2008/09/30 14:16 +0200 [-] Log opened.
    2008/09/30 14:16 +0200 [-] Starting factory <HTTPClientFactory: http://www.divmod.com>
    2008/09/30 14:16 +0200 [HTTPPageGetter,client] Stopping factory <HTTPClientFactory: http://divmod.com/?__session_just_started__=1>
    2008/09/30 14:16 +0200 [-] Main loop terminated.

I had a look around and can see where (most) of this is coming from.

First off, the start/stop factory messages are surprising and feel ugly to
me. I mean that's my stdout you're scribbling that stuff all over. The
starting and stopping factory methods, despite appearing next to each other
in the same base Factory class, don't give the same [...] component in
their output. Sometimes I get [Uninitialized], sometimes [-], and sometimes
[HTTPPageGetter,client] as above - with both starting and stopping
messages.

And then, and misleading IMO, is that in a callback attached to the
deferred from getPage, the log output (to the uninitiated, a class I am
arguably a prime member of) still appears to have something to do with
HTTPPageGetter,client when in fact the page has been retrieved, and the
callback fired. It's like HTTPPageGetter,client refuses to lie down and die
quietly, and insists on sitting up in the casket to holler at its
ungrateful descendant callbacks: Hey, I'm the one that kicked this off and
don't you forget it!

Ahem. I see that output is controlled by a var called noisy in the base
Factory class. By why is it True by default if it really is just noise?
Judging from the code (and the use of log.msg not log.err) it's not an
error.

In my actual use case, I see my log filling up with output like this:

2008/09/29 23:55 +0200 [HTTPPageGetter,client] Stopping factory <HTTPClientFactory: https://ec2.amazonaws.com:443/?Action=RunInstances&AWSAccessKeyId=92383292629273839262&ImageId=ami-6bd03402&InstanceType=m1.small&KeyName=xxx-keypair&MaxCount=1&MinCount=1&SecurityGroup.1=coordinator&SignatureVersion=1&Timestamp=2008-09-29T21%3A55%3A23&UserData=QVdTX0FDQ0VTU19LRVlfSUQ6IDBKU1NNSzVOS000N0RHN1dTRDAyCkFXU19TRUNSRVRfQUNDRVNTX0tFWTogZ3J3UDFWaTdHbjg4Y3hMdy9UcDIrdWIxeENUdWVwUmUvV3JHdXRGYQpTM0J1Y2tldE5hbWU6IGZsdWlkaW5mby5jb20KaW5pdEtleU5hbWU6IG9wdC9mbHVpZGluZm8vYmluL2luaXQucHkKcHJvY2Vzc0FyZ3M6IFstLWxvZ2ZpbGUsIC9tbnQvdG1wLzEyMjI3MjUzMjIuNi5sb2csIC0tcGlkZmlsZSwgL21udC90bXAvMTIyMjcyNTMyMi42LnBpZCwKICAtLW5vX3NhdmUsIC0tbm9kYWVtb24sIGF0dHJpYmFzZS1odHRwLXByb2Nlc3MtcG9vbCwgLS1wb3J0LCAnODAwMSddCnJlc3VsdHNLZXlOYW1lOiBpbnN0YW5jZXMvMC9yZXN1bHRzLwpzY3JpcHRQYXRoOiAvdXNyL2Jpbi90d2lzdGQKc291cmNlTGlicmFyeUtleU5hbWU6IGluc3RhbmNlcy8wL3NyYy8yMDA4MDkyNwo%3D&Version=2008-05-05&Signature=mPRws2HDxQaF4lMcmL7Ikc8Txqo%3D>

I guess the answer might be that I should make my own version of getPage
that sets noisy to False after making its HTTPClientFactory, or maybe
subclass FileLogObserver and override emit. Or I guess I could be calling
functions with log.callWithContext.

But those approached seem to be wheeling in a lot of machinery just to set
to False a variable that (arguably?) should be False to begin with.

See - told you it was simple. I'm at my very best nibbling away on the very
edges of the Twist-o-verse.

Terry

From glyph at divmod.com  Tue Sep 30 09:45:39 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 30 Sep 2008 13:45:39 -0000
Subject: [Twisted-Python] Question on default t.p.log output
In-Reply-To: <18658.8510.659765.567315@jon.es>
References: <18658.8510.659765.567315@jon.es>
Message-ID: <20080930134539.31635.525127464.divmod.xquotient.460@weber.divmod.com>

On 12:53 pm, terry at jon.es wrote:
>Greetings Twisted superheroes!

Hi Terry!
>I have a simple question about logging. Here's a snippet of code:

>First off, the start/stop factory messages are surprising and feel ugly 
>to
>me. I mean that's my stdout you're scribbling that stuff all over. The
>starting and stopping factory methods, despite appearing next to each 
>other
>in the same base Factory class, don't give the same [...] component in
>their output. Sometimes I get [Uninitialized], sometimes [-], and 
>sometimes
>[HTTPPageGetter,client] as above - with both starting and stopping
>messages.

Thank you for at least noticing this ;-).

The logging code is quite ugly, but unfortunately, almost nobody cares. 
If you could dedicate any time at all to improving it, even a little, 
we'd all really appreciate it.
>And then, and misleading IMO, is that in a callback attached to the
>deferred from getPage, the log output (to the uninitiated, a class I am
>arguably a prime member of) still appears to have something to do with
>HTTPPageGetter,client when in fact the page has been retrieved, and the
>callback fired. It's like HTTPPageGetter,client refuses to lie down and 
>die
>quietly, and insists on sitting up in the casket to holler at its
>ungrateful descendant callbacks: Hey, I'm the one that kicked this off 
>and
>don't you forget it!

The way the log prefix is calculated is based on what actual event is 
firing from the reactor.  So, whatever object *generates* the callback 
is the one whose log prefix will be used.

It would definitely be nice if the log could follow the asynchronous 
thread of execution.  Patches accepted :).
>Ahem. I see that output is controlled by a var called noisy in the base
>Factory class. By why is it True by default if it really is just noise?
>Judging from the code (and the use of log.msg not log.err) it's not an
>error.

It sounds like you have several complaints here.

1.) You don't want logs to go to stdout.

This is easy.  You can direct the log wherever you want, and overriding 
stdout is optional; take a look at the arguments to startLogging. 
(Unless you're talking about customizing logging in twistd, which is a 
whole other mess that there is a universe of tickets for.)

2.) Factories are too noisy by default.

Knowing when factories start up and shut down can actually be incredibly 
useful.  It's a pain when they're filling up your logs with spam, but a 
better solution would be some kind of structured log format with a log 
viewer application, not destroying the information so that viewing logs 
with 'less' is easier.

3.) Factories' start and stop messages do not include useful 
information.

Quite so.  It would be nicer if they did.

4.) The log prefix isn't always useful or correct.

This may be true, but we'd need a ticket filed that includes a complete 
enumeration of exactly _how_ they aren't useful or correct, and each 
case would need to be fixed.

5.) The log prefix for Deferred callbacks doesn't follow the 
asynchronous origin of the callback.

Figuring out how to do this is really tricky, because in different cases 
you want different things.  However, twisted.python.context provides a 
hook for you to potentially capture some state when Deferreds, at least 
certain Deferreds, are spun up.  If you can come up with a really clear 
statement of requirements for a particular log prefix, you can probably 
get it.

6.) The HTTP client is too noisy and should emit fewer log messages.

Possibly - but then I recently discovered some very interesting 
information by watching a server which had a bunch of outstanding 
getPage connections spew out thousands of 'stopping factory' messages in 
their output - and seeing those URLs was an invaluable debugging aid.

7.) Twisted's log messages are generally ugly and difficult to 
understand.

Touche - but again, this needs to be fixed on a case-by-case basis; 
nothing to be done in general.  Except, of course, to come up with some 
kind of standard for what makes up a useful / helpful log message; and 
that's probably not going to be the unstructured mess of strings that 
currently goes into the log.  (Can you tell I'm pushing a structured log 
format that can be parsed?)

Please feel free to file some tickets for areas of this behavior that 
you have noticed.  I wish I had time to pour into the logging system, 
but neither I (nor any of our sponsors) _really_ needs it to be any 
better; it's just a constant annoyance.



From terry at jon.es  Tue Sep 30 10:16:31 2008
From: terry at jon.es (Terry Jones)
Date: Tue, 30 Sep 2008 16:16:31 +0200
Subject: [Twisted-Python] Question on default t.p.log output
In-Reply-To: Your message at 13:45:39 on Tuesday, 30 September 2008
References: <18658.8510.659765.567315@jon.es>
	<20080930134539.31635.525127464.divmod.xquotient.460@weber.divmod.com>
Message-ID: <18658.13503.272813.702776@jon.es>

>>>>> "glyph" == glyph  <glyph at divmod.com> writes:
glyph> Thank you for at least noticing this ;-).

The 1K char log lines were hard to miss :-)

glyph> The logging code is quite ugly, but unfortunately, almost nobody
glyph> cares.  If you could dedicate any time at all to improving it, even
glyph> a little, we'd all really appreciate it.

You'd all appreciate it but OTOH almost nobody cares??? Hmmm. Hard to
resist :-)

glyph> The way the log prefix is calculated is based on what actual event is 
glyph> firing from the reactor.  So, whatever object *generates* the callback 
glyph> is the one whose log prefix will be used.

But I also see lines like this:

2008/09/29 23:56 +0200 [-] Starting factory <HTTPClientFactory: http://ec2-75-101-219-127.compute-1.amazonaws.com:8001/dummy>
2008/09/29 23:56 +0200 [Uninitialized] Stopping factory <HTTPClientFactory: http://ec2-75-101-219-127.compute-1.amazonaws.com:8001/dummy>

And - and Uninitialized do not have any clear correspondence with reactor
events. (BTW, I do see where these are coming from.)

glyph> It would definitely be nice if the log could follow the asynchronous 
glyph> thread of execution.  Patches accepted :).

Yes, agreed that would be nice. From my memory of defer.py... (insert vague
comment about how this might not be so hard - for you :-)).

glyph> It sounds like you have several complaints here.

glyph> 1.) You don't want logs to go to stdout.

I do want that, that's why I used sys.stdout.

glyph> 2.) Factories are too noisy by default.

glyph> Knowing when factories start up and shut down can actually be incredibly 
glyph> useful.  It's a pain when they're filling up your logs with spam, but a 
glyph> better solution would be some kind of structured log format with a log 
glyph> viewer application, not destroying the information so that viewing logs 
glyph> with 'less' is easier.

Right, and so viewing them when running a script from the command line that
wants to do some logging to stdout is also fine.

glyph> 4.) The log prefix isn't always useful or correct.

glyph> This may be true, but we'd need a ticket filed that includes a
glyph> complete enumeration of exactly _how_ they aren't useful or correct,
glyph> and each case would need to be fixed.

OK, thinking about that.

glyph> 5.) The log prefix for Deferred callbacks doesn't follow the
glyph> asynchronous origin of the callback.

glyph> Figuring out how to do this is really tricky, because in different cases 
glyph> you want different things.  However, twisted.python.context provides a 
glyph> hook for you to potentially capture some state when Deferreds, at least 
glyph> certain Deferreds, are spun up.  If you can come up with a really clear 
glyph> statement of requirements for a particular log prefix, you can probably 
glyph> get it.

And this.

glyph> 6.) The HTTP client is too noisy and should emit fewer log messages.

glyph> Possibly - but then I recently discovered some very interesting
glyph> information by watching a server which had a bunch of outstanding
glyph> getPage connections spew out thousands of 'stopping factory'
glyph> messages in their output - and seeing those URLs was an invaluable
glyph> debugging aid.

OK, but by your own description that's output that's useful for debugging
(and above you call it spam). My only real question was why that output is
on by default instead of off (especially seeing as it's often adding 1K of
output to my log file for a single logged message).

glyph> 7.) Twisted's log messages are generally ugly and difficult to 
glyph> understand.

glyph> Touche

But I didn't say that... I'm very happy to not have to write logging
code. Sure, the [HTTPPageGetter,client] speaking from beyond the grave is a
bit unsettling, but that's minor.

glyph> Except, of course, to come up with some kind of standard for what
glyph> makes up a useful / helpful log message; and that's probably not
glyph> going to be the unstructured mess of strings that currently goes
glyph> into the log.  (Can you tell I'm pushing a structured log format
glyph> that can be parsed?)

Yes, agreed that would be good.

glyph> Please feel free to file some tickets for areas of this behavior that 
glyph> you have noticed.  I wish I had time to pour into the logging system, 
glyph> but neither I (nor any of our sponsors) _really_ needs it to be any 
glyph> better; it's just a constant annoyance.

Understood, thanks. I'm mainly just trying to understand what's going on
and why.

I will have a bit more of a poke around. As I was going to say, from what I
remember about the callback mechanism in defer.py it seems like one should
be able to have some kind of data structure that's being maintained
(pushed, popped) there that could be updating a log prefix in some way.

Thanks!

Terry



From exarkun at divmod.com  Tue Sep 30 10:30:15 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 30 Sep 2008 10:30:15 -0400
Subject: [Twisted-Python] September 28 2008 Twisted Sprint Report
In-Reply-To: 0
Message-ID: <20080930143015.29191.1292467146.divmod.quotient.32227@ohm>

Hello all,

Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
and myself accomplished this past Sunday at the Twisted sprint.

Itamar took turns pairing with Chris and I.  He and Chris worked on
creating command line tools to invoke the release automation libraries
which we've already written.  You can find the results in a branch linked
from ticket #3439.

Itamar and I (and later Chris and I) worked on providing improved support
in Trial for inspecting warnings which have been emitted over the course
of a test.  This is in support of the high-level deprecation API described
in ticket #3266.

Jean-Paul



From shweta3230 at gmail.com  Tue Sep 30 11:42:49 2008
From: shweta3230 at gmail.com (shweta mani)
Date: Tue, 30 Sep 2008 21:12:49 +0530
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <20080929203753.GA20132@cs.york.ac.uk>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
	<gbp2uu$7pr$1@ger.gmane.org> <20080929203753.GA20132@cs.york.ac.uk>
Message-ID: <d13e157d0809300842q70838c3ex55c09e56c57c6213@mail.gmail.com>

hi friends thanks for immediate reply.
i have referred the book twisted..........
currently i am facing the problem.
i have to show ls -l output in a listbox using Tkinter
but because of TCP it first stores information in a window or some packet
format.
so it doesnot show the output in a continuous manner.



On Tue, Sep 30, 2008 at 2:07 AM, Jack Whitham <jack-tp at cs.york.ac.uk> wrote:

> On Sun, Sep 28, 2008 at 02:11:49AM +0200, paul wrote:
> > Hope this isn't too offensive but last time I checked conch didn't work
> > on win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users
> > would be happy with a basic "secure RPC" implementation, no console
> > stuff. No idea how much work that is though ...
>
> Conch does work on Win32, I have written an application that uses
> it (not the command line client). You have to install pycrypto
> in addition to Twisted.
>
>
> --
> Jack Whitham
> jack at cs.york.ac.uk
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080930/0bda2305/attachment.htm 

From shweta3230 at gmail.com  Tue Sep 30 11:54:03 2008
From: shweta3230 at gmail.com (shweta mani)
Date: Tue, 30 Sep 2008 21:24:03 +0530
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <d13e157d0809300842q70838c3ex55c09e56c57c6213@mail.gmail.com>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
	<gbp2uu$7pr$1@ger.gmane.org> <20080929203753.GA20132@cs.york.ac.uk>
	<d13e157d0809300842q70838c3ex55c09e56c57c6213@mail.gmail.com>
Message-ID: <d13e157d0809300854n6799f385l87d851c096befc7d@mail.gmail.com>

from twisted.conch import error

from twisted.conch.ssh import transport, connection, keys, userauth,
channel, common

from twisted.internet import defer, protocol, reactor
import re
import Tkinter
from Tkinter import *
from tkMessageBox import *
from os.path import exists
from Tkinter import *
import commands
#from DT import demo
import shutil
from os.path import exists
import ftplib
import sys
from ftplib import FTP
from tkMessageBox import *
from tkFileDialog import asksaveasfilename
import string
from os import popen
from re import split
import Tkinter
import os

win = Tkinter.Tk();
Label(win,text='CARD UPLOAD UTILITY').pack(side=TOP)








        #btn=Tkinter.Button(win,text='LIST ALL SUB FILES',command =(lambda :
slist()))
        #btn.pack(side=BOTTOM)



def submit():
    login=textlog.get()
    password=textpass.get()
    if login=="" or password=="":
        showinfo('ERROR','PLEASE FILL THE NECESSARY DETAILS ')
    elif login=='m' and password=='m':

        print 'HELLO USER'
        top.withdraw()#closes current window
        import sys, getpass

        server = '10.144.17.2'

        command = 'ls -l'

        username = 'cteam'

        password = 'cteam'



        factory = ClientCommandFactory( username, password, command)

        reactor.connectTCP(server, 22, factory)

        reactor.run( )



class ClientCommandTransport(transport.SSHClientTransport):


    def __init__(self, username, password, command):

        self.username = username

        self.password = password

        self.command = command
        print "username",username
        print "password",password
        print "command",command


    def verifyHostKey(self, pubKey, fingerprint):

        # in a real app, you should verify that the fingerprint matches

        # the one you expected to get from this server

        return defer.succeed(True)



    def connectionSecure(self):

        self.requestService(

            PasswordAuth(self.username, self.password,

                         ClientConnection(self.command)))



class PasswordAuth(userauth.SSHUserAuthClient):

    def __init__(self, user, password, connection):

        userauth.SSHUserAuthClient.__init__(self, user, connection)

        self.password = password



    def getPassword(self, prompt=None):

        return defer.succeed(self.password)



class ClientConnection(connection.SSHConnection):

    def __init__(self, cmd, *args, **kwargs):

        connection.SSHConnection.__init__(self)

        self.command = cmd



    def serviceStarted(self):

        self.openChannel(CommandChannel(self.command, conn=self))



class CommandChannel(channel.SSHChannel):

    name = 'session'



    def __init__(self, command, *args, **kwargs):

        channel.SSHChannel.__init__(self, *args, **kwargs)

        self.command = command



    def channelOpen(self, data):

        self.conn.sendRequest(

            self, 'exec', common.NS(self.command),
wantReply=True).addCallback(

            self._gotResponse)



    def _gotResponse(self, _):

        self.conn.sendEOF(self)

    def dataReceived(self, data):
        #self.dat=date
        print "nenu",data
        dat=data
        #print"nenu1",dat
        lis(dat)
def lis(m):


        Label(win,text='%s'%m).pack(side=TOP)

        dirfm = Frame(win)
        dirsa=Scrollbar(dirfm)
        dirsb= Scrollbar(dirfm)
        dirsb.pack(side = RIGHT, fill =Y)

        dirs = Listbox(dirfm,height = 50, width = 70, yscrollcommand =
dirsb.set)
        textsfile = Entry(dirfm)
        def closed(self):

            reactor.stop( )
            print "nenuclose"


        #print"nenu" ,data[56]
        #print"nenu" ,data[57]
        #print"nenu" ,data[58]
        #print"nenu" ,data[59]
        #print"nenu" ,data[63]
        '''p=1
        for i in range(40,100):
            if(data[i]=='-' or data[i]=='x'):
                p=i
        print"nenu" ,data[p-9]
        #ClientCommandFactory(username, password, command)



        #__init__(self, username, password, command)'''






class ClientCommandFactory(protocol.ClientFactory):

    def __init__(self, username, password, command):

            self.username = username

            self.password = password

            self.command = command



    def buildProtocol(self, addr):

            protocol = ClientCommandTransport(

                self.username, self.password, self.command)

            return protocol



if __name__ == "__main__":
    top = Tkinter.Tk()
#to draw Label in the main page

    label = Tkinter.Label(top, text=' CARD UPLOAD UTILITY ' )
    label.pack()

#to draw Label

    label = Tkinter.Label(top, text='ENTER LOGIN  ')
    label.pack(side=LEFT,fill=X)

#to draw Textbox
    tv = Tkinter.StringVar( )
    textlog=Entry(top,width=20,textvariable=tv)
    textlog.pack(side=LEFT)


#to draw Label

    label = Tkinter.Label(top, text=' ENTER PASSWORD  ')
    label.pack(side=LEFT)

#to draw Textbox
    tv1 = Tkinter.StringVar( )
    textpass=Entry(top,width=20,textvariable=tv1)
    textpass.pack(side=LEFT)

#to draw submit
    submit=Tkinter.Button(top, text=' SUBMIT ',command=submit)
    submit.pack(side=LEFT)
    top.bind_all('<Return>',(lambda event: submit()))



#to draw Quit
    quit = Tkinter.Button(top, text='  QUIT  ',command=top.quit)
    quit.pack(side=LEFT)




    Tkinter.mainloop()


#put m as username and m as password

On Tue, Sep 30, 2008 at 9:12 PM, shweta mani <shweta3230 at gmail.com> wrote:

>  hi friends thanks for immediate reply.
> i have referred the book twisted..........
> currently i am facing the problem.
> i have to show ls -l output in a listbox using Tkinter
> but because of TCP it first stores information in a window or some packet
> format.
> so it doesnot show the output in a continuous manner.
>
>
>
> On Tue, Sep 30, 2008 at 2:07 AM, Jack Whitham <jack-tp at cs.york.ac.uk>wrote:
>
>> On Sun, Sep 28, 2008 at 02:11:49AM +0200, paul wrote:
>> > Hope this isn't too offensive but last time I checked conch didn't work
>> > on win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users
>> > would be happy with a basic "secure RPC" implementation, no console
>> > stuff. No idea how much work that is though ...
>>
>> Conch does work on Win32, I have written an application that uses
>> it (not the command line client). You have to install pycrypto
>> in addition to Twisted.
>>
>>
>> --
>> Jack Whitham
>> jack at cs.york.ac.uk
>>
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-python/attachments/20080930/909ab3b1/attachment.htm 

From exarkun at divmod.com  Tue Sep 30 12:04:28 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 30 Sep 2008 12:04:28 -0400
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <d13e157d0809300854n6799f385l87d851c096befc7d@mail.gmail.com>
Message-ID: <20080930160428.29191.46084701.divmod.quotient.32247@ohm>

On Tue, 30 Sep 2008 21:24:03 +0530, shweta mani <shweta3230 at gmail.com> wrote:
> [snip]

This isn't the right way to use Tk with Twisted.

See http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html#auto14

Jean-Paul



From frans.martensson at gmail.com  Tue Sep 30 12:06:58 2008
From: frans.martensson at gmail.com (=?ISO-8859-1?Q?Frans_M=E5rtensson?=)
Date: Tue, 30 Sep 2008 18:06:58 +0200
Subject: [Twisted-Python] sending signal through SSHChannel
Message-ID: <8cc9d3030809300906u1db77d9ag2abb2e5257ab6a57@mail.gmail.com>

Hello!

I have written a python program that executes shell scripts on remote
computers using the twisted conch SSHChannel. Several shell scripts
are executed at once on several machines and the scripts range in
execution time from minutes to hours.

My question is regarding the behavior of Conch when it is shut down.
What i would like to do is to send a SIGINT or SIGKILL to the remote
script so that it can terminate in an orderly fashion. I am using the
channel.SSHChannel as a base class for my task. Is there a mechanism
in Conch for sending this signal?

best regards

frans



From terry at jon.es  Tue Sep 30 12:25:14 2008
From: terry at jon.es (Terry Jones)
Date: Tue, 30 Sep 2008 18:25:14 +0200
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: Your message at 12:04:28 on Tuesday, 30 September 2008
References: <d13e157d0809300854n6799f385l87d851c096befc7d@mail.gmail.com>
	<20080930160428.29191.46084701.divmod.quotient.32247@ohm>
Message-ID: <18658.21226.698619.512438@jon.es>

On Tue, 
[snip]



From glyph at divmod.com  Tue Sep 30 13:46:02 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 30 Sep 2008 17:46:02 -0000
Subject: [Twisted-Python] September 28 2008 Twisted Sprint Report
In-Reply-To: <20080930143015.29191.1292467146.divmod.quotient.32227@ohm>
References: 0
	<20080930143015.29191.1292467146.divmod.quotient.32227@ohm>
Message-ID: <20080930174602.31635.985444747.divmod.xquotient.461@weber.divmod.com>

On 02:30 pm, exarkun at divmod.com wrote:
>Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
>and myself accomplished this past Sunday at the Twisted sprint.

Great work, guys.  Sorry I couldn't make it.  Let's have another one 
soon :).



From exarkun at divmod.com  Tue Sep 30 13:45:14 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 30 Sep 2008 13:45:14 -0400
Subject: [Twisted-Python] October Twisted Sprint
In-Reply-To: <20080930174602.31635.985444747.divmod.xquotient.461@weber.divmod.com>
Message-ID: <20080930174514.29191.1502014325.divmod.quotient.32289@ohm>

On Tue, 30 Sep 2008 17:46:02 -0000, glyph at divmod.com wrote:
>On 02:30 pm, exarkun at divmod.com wrote:
>>Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
>>and myself accomplished this past Sunday at the Twisted sprint.
>
>Great work, guys.  Sorry I couldn't make it.  Let's have another one soon 
>:).
>

Yes, let's.  Who would be interested in attending a sprint on the 25th or
the 26th of October?

Jean-Paul



From radix at twistedmatrix.com  Tue Sep 30 14:04:19 2008
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Tue, 30 Sep 2008 14:04:19 -0400
Subject: [Twisted-Python] October Twisted Sprint
In-Reply-To: <20080930174514.29191.1502014325.divmod.quotient.32289@ohm>
References: <20080930174602.31635.985444747.divmod.xquotient.461@weber.divmod.com>
	<20080930174514.29191.1502014325.divmod.quotient.32289@ohm>
Message-ID: <60ed19d40809301104g733dcaf8k85b343a3c85ccc02@mail.gmail.com>

On Tue, Sep 30, 2008 at 1:45 PM, Jean-Paul Calderone <exarkun at divmod.com> wrote:
> On Tue, 30 Sep 2008 17:46:02 -0000, glyph at divmod.com wrote:
>>
>> On 02:30 pm, exarkun at divmod.com wrote:
>>>
>>> Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
>>> and myself accomplished this past Sunday at the Twisted sprint.
>>
>> Great work, guys.  Sorry I couldn't make it.  Let's have another one soon
>> :).
>>
>
> Yes, let's.  Who would be interested in attending a sprint on the 25th or
> the 26th of October?

That's particularly good timing for me, because I'm going to be taking
the following week as holiday from work. I'll be there.



-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From glyph at divmod.com  Tue Sep 30 14:49:33 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 30 Sep 2008 18:49:33 -0000
Subject: [Twisted-Python] October Twisted Sprint
In-Reply-To: <60ed19d40809301104g733dcaf8k85b343a3c85ccc02@mail.gmail.com>
References: <20080930174602.31635.985444747.divmod.xquotient.461@weber.divmod.com>
	<20080930174514.29191.1502014325.divmod.quotient.32289@ohm>
	<60ed19d40809301104g733dcaf8k85b343a3c85ccc02@mail.gmail.com>
Message-ID: <20080930184933.31635.727913623.divmod.xquotient.521@weber.divmod.com>

On 06:04 pm, radix at twistedmatrix.com wrote:
>On Tue, Sep 30, 2008 at 1:45 PM, Jean-Paul Calderone 
><exarkun at divmod.com> wrote:
>>On Tue, 30 Sep 2008 17:46:02 -0000, glyph at divmod.com wrote:
>>>
>>>On 02:30 pm, exarkun at divmod.com wrote:
>>>>
>>>>Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
>>>>and myself accomplished this past Sunday at the Twisted sprint.
>>>
>>>Great work, guys.  Sorry I couldn't make it.  Let's have another one 
>>>soon
>>>:).
>>
>>Yes, let's.  Who would be interested in attending a sprint on the 25th 
>>or
>>the 26th of October?
>
>That's particularly good timing for me, because I'm going to be taking
>the following week as holiday from work. I'll be there.

That looks like a good time for me as well.



From gabriel.rossetti at arimaz.com  Mon Sep  1 01:47:20 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Mon, 01 Sep 2008 09:47:20 +0200
Subject: [Twisted-Python] Processes in Twisted,
	only possible to run external prog?
In-Reply-To: <20080829133524.25821.2120076452.divmod.xquotient.15068@joule.divmod.com>
References: <48B7BC33.7090501@arimaz.com>
	<20080829133524.25821.2120076452.divmod.xquotient.15068@joule.divmod.com>
Message-ID: <48BB9E08.6090903@arimaz.com>

glyph at divmod.com wrote:
> On 09:06 am, gabriel.rossetti at arimaz.com wrote:
>> http://www.biais.org/blog/index.php/2007/01/23/19-python-threads-and- 
>> oschdir
>> http://bugs.python.org/issue1367
>>
>> so I need to use processes instead, as they each have their own 
>> current dir. The thing is that from what I understand, Twisted's 
>> process API is intended to be used with external executables only, 
>> correct? I wasn' t able to fins anything that allowed me to do stuff 
>> like I would using fork(). Should I just use python's fock() instead? 
>> Is it safe with Twisted?
>
> As it happens, "python" is an "external executable".  Here's an 
> example of spawning it in such a way as to make sure that sys.path is 
> set properly: 
> http://divmod.org/trac/browser/trunk/Epsilon/epsilon/process.py#L7
>
Ok, thanks
> However, Wine is also an external process.  Perhaps you just want to 
> spawn the Wine command-line using spawnProcess using the 'path' 
> parameter set to a directory that you have created in the main 
> process, then clean it up when the process exits?
>
> http://twistedmatrix.com/documents/8.1.0/api/twisted.internet.interfaces.IReactorProcess.spawnProcess.html 
>
>
mmmm, yes, that sounds nice, I'll try that, thanks!
> Using fork() in Python has a lot of confusing issues associated with 
> it unless you're going to exec() immediately afterwards.  You probably 
> want to stick to one of these other approaches.
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From gabriel.rossetti at arimaz.com  Mon Sep  1 01:53:04 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Mon, 01 Sep 2008 09:53:04 +0200
Subject: [Twisted-Python] twistd,
	does it use processes? Anything to watch out for?
Message-ID: <48BB9F60.4000209@arimaz.com>

Hello everyone,

Just a little question about Twistd & the Application framework. I'm 
using the service collection app mechanism
and I was wondering how Twistd handles it. Is there anything special to 
watch out for? Any differences in between running each server as a
separate process (i.e. launching it from a diff term without twistd) and 
with Twistd? Does it spawn a process for each Service/Server?

Thank you,
Gabriel




From glyph at divmod.com  Mon Sep  1 05:57:00 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Mon, 01 Sep 2008 11:57:00 -0000
Subject: [Twisted-Python] twistd,
	does it use processes? Anything to watch out for?
In-Reply-To: <48BB9F60.4000209@arimaz.com>
References: <48BB9F60.4000209@arimaz.com>
Message-ID: <20080901115700.25821.1503840134.divmod.xquotient.15164@joule.divmod.com>

On 07:53 am, gabriel.rossetti at arimaz.com wrote:
>Hello everyone,
>
>Just a little question about Twistd & the Application framework. I'm 
>using the service collection app mechanism
>and I was wondering how Twistd handles it. Is there anything special to 
>watch out for? Any differences in between running each server as a
>separate process (i.e. launching it from a diff term without twistd) 
>and with Twistd? Does it spawn a process for each Service/Server?

twistd runs all services in a single process.  In fact, twistd only runs 
one service.  Although that service may be a MultiService which contains 
other services, MultiService does not do anything special to run things 
in other processes either.



From alpha04 at netvigator.com  Mon Sep  1 16:43:22 2008
From: alpha04 at netvigator.com (Andrey)
Date: Tue, 2 Sep 2008 06:43:22 +0800
Subject: [Twisted-Python] fileReceive in msn.py 
Message-ID: <g9hr6d$v67$1@ger.gmane.org>

Hello

anyone able to get the fileReceive() in the msn.py working? I tried many 
times but it keep lossing connection
to the server everytime after the confirmation is 
sent -fileInvitationReply()

any help or couple lines of sample code will be appreciated

Andrey K 





From gabriel.rossetti at arimaz.com  Tue Sep  2 00:22:22 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 02 Sep 2008 08:22:22 +0200
Subject: [Twisted-Python] twistd, does it use processes? Anything to watch
	out for?
In-Reply-To: <20080901115700.25821.1503840134.divmod.xquotient.15164@joule.divmod.com>
References: <48BB9F60.4000209@arimaz.com>
	<20080901115700.25821.1503840134.divmod.xquotient.15164@joule.divmod.com>
Message-ID: <48BCDB9E.8010205@arimaz.com>

glyph at divmod.com wrote:
> On 07:53 am, gabriel.rossetti at arimaz.com wrote:
>> Hello everyone,
>>
>> Just a little question about Twistd & the Application framework. I'm 
>> using the service collection app mechanism
>> and I was wondering how Twistd handles it. Is there anything special 
>> to watch out for? Any differences in between running each server as a
>> separate process (i.e. launching it from a diff term without twistd) 
>> and with Twistd? Does it spawn a process for each Service/Server?
>
> twistd runs all services in a single process.  In fact, twistd only 
> runs one service.  Although that service may be a MultiService which 
> contains other services, MultiService does not do anything special to 
> run things in other processes either.
>
>
Ok, thank you.

Gabriel



From gabriel.rossetti at arimaz.com  Tue Sep  2 02:35:05 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 02 Sep 2008 10:35:05 +0200
Subject: [Twisted-Python] create new domish.Element from string XML
Message-ID: <48BCFAB9.2070203@arimaz.com>

Hello everyone,

I sometimes have to create domish.Element from a string and I can't find 
any way of doing this. I saw that I can add children from a string but 
not create a whole XML tree.
Is there a way of doing this other than creating a dummy element, adding 
the XML string as a child and then extracting the child?

Thank you,
Gabriel



From gabriel.rossetti at arimaz.com  Tue Sep  2 03:45:22 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 02 Sep 2008 11:45:22 +0200
Subject: [Twisted-Python] create new domish.Element from string XML
In-Reply-To: <48BCFAB9.2070203@arimaz.com>
References: <48BCFAB9.2070203@arimaz.com>
Message-ID: <48BD0B32.7070500@arimaz.com>

Gabriel Rossetti wrote:
> Hello everyone,
>
> I sometimes have to create domish.Element from a string and I can't 
> find any way of doing this. I saw that I can add children from a 
> string but not create a whole XML tree.
> Is there a way of doing this other than creating a dummy element, 
> adding the XML string as a child and then extracting the child?
>
> Thank you,
> Gabriel
>
I tried creating a dummy element, adding the raw string as a child using 
"addRawXml()" and then extracting the first child, and this does not 
work because the raw xml string is just added without being parsed. I 
write this up, if anybody is interested, that does what I need. If a 
better method exists, please tell me.

Gabriel


# 
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

def rawXmlToElement(s):
    """
    Turn a raw string XML document into a XML element
   
    @param s: the raw string XML document
    @type s: C{str}
   
    @return: the XML element
    @rtype: 
U{twisted.words.xish.domish.Element<http://twistedmatrix.com/documents/current/api/twisted.words.xish.domish.Element.html>}
   
    @raise ParserError: if there was an error parsing the raw string XML 
document
    """
    result = None
    def onStart(el):
        result = el
    def onEnd():
        pass
    def onElement(el):
        result.addChild(el)
       
    parser = domish.elementStream()
    parser.DocumentStartEvent = onStart
    parser.ElementEvent = onElement
    parser.DocumentEndEvent = onEnd
    parser.parse(s)
   
    return result




From rlott at evertz.com  Tue Sep  2 06:43:38 2008
From: rlott at evertz.com (Rodney Lott)
Date: Tue, 2 Sep 2008 08:43:38 -0400
Subject: [Twisted-Python] How does the pollreactor work?
In-Reply-To: <20080829212034.25821.1674589899.divmod.xquotient.15110@joule.divmod.com>
Message-ID: <069B6B31F6201B4389D7EEB9AD827BCA05005AFD@otis.burlington.evertz.tv>

Thanks!  That makes sense.  I appreciate the detailed example.

Best regards.

Rodney

-----Original Message-----
From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com]On Behalf Of
glyph at divmod.com
Sent: Friday, August 29, 2008 5:21 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] How does the pollreactor work?



On 03:35 pm, rlott at evertz.com wrote:
>I have been trying to figure out how to use the 
>twisted.internet.pollreactor so that I can use it to monitor a Linux 
>named PIPE (i.e. a FIFO created using mkfifo()).  I tried without 
>success to Google some examples but I couldn't find anything.

This doesn't really have anything to do with pollreactor.  Any reactor 
that implements IReactorFDSet can monitor a pipe.

It was easier for me to implement this than to explain what to do, so 
here's the code for monitoring a named pipe for read, given its name. 
I'm pretty sure it's not 100% correct, but if you want to read about 
handling I/O events from fifos on your platform, you are welcome to do 
so.

    import os
    from twisted.internet.abstract import FileDescriptor
    from twisted.internet.main import CONNECTION_DONE

    class FIFODescriptor(FileDescriptor):
        def __init__(self, reactor, fifoname, protocol):
            FileDescriptor.__init__(self, reactor)
            self.fifo = os.open(fifoname, os.O_NONBLOCK | os.O_RDONLY)
            self.protocol = protocol
            self.protocol.makeConnection(self)

        def connectionLost(self, reason):
            self.protocol.connectionLost(reason)

        def doRead(self):
            data = os.read(self.fifo, 1024)
            if data:
                self.protocol.dataReceived(data)
            else:
                self.stopReading()
                self.connectionLost(CONNECTION_DONE)

        def fileno(self):
            return self.fifo


And here's a brief program that uses it:

    import sys
    from twisted.internet import reactor
    from twisted.internet.protocol import Protocol
    class PrintingProtocol(Protocol):
        def dataReceived(self, data):
            print 'data', repr(data)
        def connectionMade(self):
            print 'hi'
        def connectionLost(self, reason):
            print 'bye', reason
    fifd = FIFODescriptor(reactor, sys.argv[1], PrintingProtocol())
    fifd.startReading()
    reactor.run()

I tested this by doing 'mkfifo x; python fifo.py x', and in another 
terminal, 'cat > x'.  It should be pretty self-explanitory.

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

From aldoogy at gmail.com  Tue Sep  2 08:23:13 2008
From: aldoogy at gmail.com (A)
Date: Tue, 02 Sep 2008 15:23:13 +0100
Subject: [Twisted-Python] license / copyright questions about Twisted
	Perspective Broker client
Message-ID: <48BD4C51.6030303@gmail.com>

Hi,
After looking around for the last 6 months for an Actionscript 3 library 
that would work as a client for use with Twisted Perspective Broker
, and hoping someone more skilled than myself would get around to 
creating one, I decided to get the ball rolling.

It currently works as a client for the example here.
http://twistedmatrix.com/projects/core/documentation/howto/pb-cred.html#auto18

There is a long way to go. . . but it's a start.

I aim to release the library under the same license as Twisted (MIT) but 
I'm wondering about some of the details.
Since all I have done is just ported the original Twisted code from 
Python to Actionscript what does that mean in terms of copyright and 
credits ?
Should I give credit in every file according to original author ?
I still have most of the original doc strings in my version - am I 
allowed to use those ?
There are also sections where I have the original python code commented 
out (as a guide to what still needs to done). I can't really be arsed to 
delete all that while it's still in heavy development. Is that a problem 
? Would I have to put the credits for the code in each snippet ?

I have created a Google code project and will get the code up there as 
soon as I have got the paperwork in order.
Cheers,
Al.



From radix at twistedmatrix.com  Tue Sep  2 12:45:00 2008
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Tue, 2 Sep 2008 14:45:00 -0400
Subject: [Twisted-Python] license / copyright questions about Twisted
	Perspective Broker client
In-Reply-To: <48BD4C51.6030303@gmail.com>
References: <48BD4C51.6030303@gmail.com>
Message-ID: <60ed19d40809021145vb0110a6x98e20bfa47357039@mail.gmail.com>

On Tue, Sep 2, 2008 at 10:23 AM, A <aldoogy at gmail.com> wrote:

> I aim to release the library under the same license as Twisted (MIT) but I'm
> wondering about some of the details.
> Since all I have done is just ported the original Twisted code from Python
> to Actionscript what does that mean in terms of copyright and credits ?
> Should I give credit in every file according to original author ?
> I still have most of the original doc strings in my version - am I allowed
> to use those ?
> There are also sections where I have the original python code commented out
> (as a guide to what still needs to done). I can't really be arsed to delete
> all that while it's still in heavy development. Is that a problem ? Would I
> have to put the credits for the code in each snippet ?

I don't feel like analyzing a work today to determine whether it is a
derivative of Twisted, but if you think it is and you want to comply
with being a derivative, all you need to do is include the Twisted
copyright notice.

-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From aldoogy at gmail.com  Tue Sep  2 13:41:21 2008
From: aldoogy at gmail.com (A)
Date: Tue, 02 Sep 2008 20:41:21 +0100
Subject: [Twisted-Python] license / copyright questions about Twisted
	Perspective Broker client
In-Reply-To: <60ed19d40809021145vb0110a6x98e20bfa47357039@mail.gmail.com>
References: <48BD4C51.6030303@gmail.com>
	<60ed19d40809021145vb0110a6x98e20bfa47357039@mail.gmail.com>
Message-ID: <48BD96E1.6060609@gmail.com>

Christopher Armstrong wrote:
> I don't feel like analyzing a work today to determine whether it is a
> derivative of Twisted, but if you think it is and you want to comply
> with being a derivative, all you need to do is include the Twisted
> copyright notice.
>   
nice and simple
cheers.



From mael.le.lannou at newlc.com  Wed Sep  3 03:09:22 2008
From: mael.le.lannou at newlc.com (Mael Le Lannou)
Date: Wed, 03 Sep 2008 11:09:22 +0200
Subject: [Twisted-Python] Asking about architecture advice
Message-ID: <48BE5442.9080307@newlc.com>

Hello,

I'm a bit lost with api.
I'have to create a web application that allow this :

-1 server
-Some clients

-Server listen on server_ip:port_x for client datas
-Client listen on client_ip:port_x for server datas

Server and client can have initiative into sending data, that's my 
trouble and i don't know what transport to use.

can someone help me please

Thanks a lot




From gabriel.rossetti at arimaz.com  Wed Sep  3 08:59:58 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Wed, 03 Sep 2008 16:59:58 +0200
Subject: [Twisted-Python] create new domish.Element from string XML
In-Reply-To: <48BD0B32.7070500@arimaz.com>
References: <48BCFAB9.2070203@arimaz.com> <48BD0B32.7070500@arimaz.com>
Message-ID: <48BEA66E.7010505@arimaz.com>

Gabriel Rossetti wrote:
> Gabriel Rossetti wrote:
>> Hello everyone,
>>
>> I sometimes have to create domish.Element from a string and I can't 
>> find any way of doing this. I saw that I can add children from a 
>> string but not create a whole XML tree.
>> Is there a way of doing this other than creating a dummy element, 
>> adding the XML string as a child and then extracting the child?
>>
>> Thank you,
>> Gabriel
>>
> I tried creating a dummy element, adding the raw string as a child 
> using "addRawXml()" and then extracting the first child, and this does 
> not work because the raw xml string is just added without being 
> parsed. I write this up, if anybody is interested, that does what I 
> need. If a better method exists, please tell me.
>
> Gabriel
>
>
> # 
> ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
>
>
> def rawXmlToElement(s):
>    """
>    Turn a raw string XML document into a XML element
>      @param s: the raw string XML document
>    @type s: C{str}
>      @return: the XML element
>    @rtype: 
> U{twisted.words.xish.domish.Element<http://twistedmatrix.com/documents/current/api/twisted.words.xish.domish.Element.html>} 
>
>      @raise ParserError: if there was an error parsing the raw string 
> XML document
>    """
>    result = None
>    def onStart(el):
>        result = el
>    def onEnd():
>        pass
>    def onElement(el):
>        result.addChild(el)
>          parser = domish.elementStream()
>    parser.DocumentStartEvent = onStart
>    parser.ElementEvent = onElement
>    parser.DocumentEndEvent = onEnd
>    parser.parse(s)
>      return result
>
Hmmm, this code worked when I posted it, and it no longer does... maybe 
the interpreter I was testing it in had an old version cached, but now 
it tells me that "result" is None when "onElement" is called, what I 
don't get is that a clusure should have been created with those internal 
functions, no? When "DocumentStartEvent" is called, It does set 
"result", but when "ElementEvent" is called, "result" no longer exists. 
Does anyone know what's going on?

Thank you,
Gabriel



From samson at editshare.com  Wed Sep  3 11:41:39 2008
From: samson at editshare.com (Samson Yeung)
Date: Wed, 3 Sep 2008 13:41:39 -0400
Subject: [Twisted-Python] FilePaging not working?
Message-ID: <c038f5910809031041x8f48448mf6e341f6c7fbef03@mail.gmail.com>

Hello all,

I am trying to transfer files over a PerspectiveBroker connection with
FilePager and I've run into a problem. The attached cut-down example
works fine with Twisted-2.5.0, but not with Twisted-8.0 or
Twisted-8.1.0. This is with python 2.5.

On version 8 of twisted, a 0-byte file is created and the client never
finished; but with version 2.5, the full file is transferred.

What am I doing wrong; or is this a bug?

Thanks all,

-Samson
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pbecho.py
Type: text/x-python
Size: 1822 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20080903/87230d15/attachment-0004.py>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pbechoclient.py
Type: text/x-python
Size: 1012 bytes
Desc: not available
URL: </pipermail/twisted-python/attachments/20080903/87230d15/attachment-0005.py>

From duncan.mcgreggor at gmail.com  Wed Sep  3 16:49:45 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Wed, 3 Sep 2008 17:49:45 -0500
Subject: [Twisted-Python] Twisted XMPP Roadmap
Message-ID: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>

Hey all,

I wanted to take a quick moment to share some stuff with the general
email audience that is interested in XMPP/Jabber in Twisted.

First off, some folks don't realize that there is a dedicated
Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
check out the archives here:
  https://mailman.ik.nu/mailman/listinfo/twisted-jabber

Secondly, we've been having some interesting discussions with Twisted
sponsors lately about deep and abiding interests in Twisted XMPP: many
sponsors want us to spend time creating docs and tutorials, improving
support and adding new features. This interest was spearheaded by Jack
Moffitt of Chesspark and given additional momentum by Dhris DiBona of
Google. Furthermore, we've received vocal support for XMPP
improvements from Hydra Labs, Lucasfilm, Security Metrics, and
individual sponsors.

Thirdly, today on #twisted, we had an intense and very productive
discussion about XMPP in general, about it's current support in
Twisted, and then a provisional roadmap for future developments. It
was an excellent experience for all, and one that can be relived by
everyone, thanks to IRC logs :-) A new ticket was created to address
the next step that will to be taken, and that ticket is here:
  http://twistedmatrix.com/trac/ticket/3407

In that ticket, I linked to the notes and IRC log of our chat:
  http://twistedmatrix.com/trac/wiki/XMPPServerArchitecture
  http://twistedmatrix.com/trac/wiki/XMPPIRCTranscript20080903

There's lots to do and we're all quite excited about both the
immediate and long-term benefits to be had by Twisted users, community
members, and the project itself with regard to XMPP and messaging
development efforts.

Thanks,

d



From radix at twistedmatrix.com  Wed Sep  3 17:32:10 2008
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Wed, 3 Sep 2008 19:32:10 -0400
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
Message-ID: <60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>

On Wed, Sep 3, 2008 at 6:49 PM, Duncan McGreggor
<duncan.mcgreggor at gmail.com> wrote:
> Hey all,
>
> I wanted to take a quick moment to share some stuff with the general
> email audience that is interested in XMPP/Jabber in Twisted.
>
> First off, some folks don't realize that there is a dedicated
> Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
> is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
> check out the archives here:
>  https://mailman.ik.nu/mailman/listinfo/twisted-jabber

Given that it's got such little traffic, maybe it's proven to not be a
good idea to have that mailing list separate from this one. It hides
the conversation that goes on there from a larger audience, and anyone
who reads the archives is going to think that the project is, if not
dead, not very active.


-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From exarkun at divmod.com  Wed Sep  3 18:39:20 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 3 Sep 2008 20:39:20 -0400
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
Message-ID: <20080904003920.29191.1168982203.divmod.quotient.21318@ohm>

On Wed, 3 Sep 2008 19:32:10 -0400, Christopher Armstrong <radix at twistedmatrix.com> wrote:
>On Wed, Sep 3, 2008 at 6:49 PM, Duncan McGreggor
><duncan.mcgreggor at gmail.com> wrote:
>> Hey all,
>>
>> I wanted to take a quick moment to share some stuff with the general
>> email audience that is interested in XMPP/Jabber in Twisted.
>>
>> First off, some folks don't realize that there is a dedicated
>> Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
>> is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
>> check out the archives here:
>>  https://mailman.ik.nu/mailman/listinfo/twisted-jabber
>
>Given that it's got such little traffic, maybe it's proven to not be a
>good idea to have that mailing list separate from this one. It hides
>the conversation that goes on there from a larger audience, and anyone
>who reads the archives is going to think that the project is, if not
>dead, not very active.
>

+1 for Twisted XMPP discussions on Twisted Python, at least until the
XMPP code in Twisted is so great and popular that we start getting the
kind of repetitive, uninteresting posts that led to the twisted-web
split.

Jean-Paul



From adelagon at gmail.com  Wed Sep  3 19:22:26 2008
From: adelagon at gmail.com (Alvin Delagon)
Date: Thu, 4 Sep 2008 09:22:26 +0800
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <20080904003920.29191.1168982203.divmod.quotient.21318@ohm>
References: <60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904003920.29191.1168982203.divmod.quotient.21318@ohm>
Message-ID: <7a01f6c00809031822o2b35ae81sd3cf060c28aa106b@mail.gmail.com>

This is really great. We've been using Twisted-XMPP that acts as a Mobile IM
server (now taking 5k simultaneous connections). I'd be glad to share some
of the experiences and help out with with the development.



On Thu, Sep 4, 2008 at 8:39 AM, Jean-Paul Calderone <exarkun at divmod.com>wrote:

> On Wed, 3 Sep 2008 19:32:10 -0400, Christopher Armstrong <
> radix at twistedmatrix.com> wrote:
>
>> On Wed, Sep 3, 2008 at 6:49 PM, Duncan McGreggor
>> <duncan.mcgreggor at gmail.com> wrote:
>>
>>> Hey all,
>>>
>>> I wanted to take a quick moment to share some stuff with the general
>>> email audience that is interested in XMPP/Jabber in Twisted.
>>>
>>> First off, some folks don't realize that there is a dedicated
>>> Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
>>> is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
>>> check out the archives here:
>>>  https://mailman.ik.nu/mailman/listinfo/twisted-jabber
>>>
>>
>> Given that it's got such little traffic, maybe it's proven to not be a
>> good idea to have that mailing list separate from this one. It hides
>> the conversation that goes on there from a larger audience, and anyone
>> who reads the archives is going to think that the project is, if not
>> dead, not very active.
>>
>>
> +1 for Twisted XMPP discussions on Twisted Python, at least until the
> XMPP code in Twisted is so great and popular that we start getting the
> kind of repetitive, uninteresting posts that led to the twisted-web
> split.
>
> Jean-Paul
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



-- 
http://www.alvinatorsplayground.blogspot.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080904/df9f5f36/attachment.html>

From p.mayers at imperial.ac.uk  Thu Sep  4 01:55:47 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Thu, 4 Sep 2008 08:55:47 +0100
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
Message-ID: <20080904075546.GB11595@wildfire.net.ic.ac.uk>

On Wed, Sep 03, 2008 at 07:32:10PM -0400, Christopher Armstrong wrote:
>On Wed, Sep 3, 2008 at 6:49 PM, Duncan McGreggor
><duncan.mcgreggor at gmail.com> wrote:
>> Hey all,
>>
>> I wanted to take a quick moment to share some stuff with the general
>> email audience that is interested in XMPP/Jabber in Twisted.
>>
>> First off, some folks don't realize that there is a dedicated
>> Twisted-Jabber email list for discussing XMPP/Jabber topics. This list
>> is managed by Twisted's XMPP guru, Ralph Meijer. You can subscribe and
>> check out the archives here:
>>  https://mailman.ik.nu/mailman/listinfo/twisted-jabber
>
>Given that it's got such little traffic, maybe it's proven to not be a
>good idea to have that mailing list separate from this one. It hides
>the conversation that goes on there from a larger audience, and anyone
>who reads the archives is going to think that the project is, if not
>dead, not very active.

Agreed. When I did some work recently to implement the client side of 
pubsub, I found that mailing list moribund and gave up on the idea of 
asking for help there.





From twisted at ralphm.ik.nu  Thu Sep  4 02:57:56 2008
From: twisted at ralphm.ik.nu (Ralph Meijer)
Date: Thu, 04 Sep 2008 10:57:56 +0200
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <20080904075546.GB11595@wildfire.net.ic.ac.uk>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
Message-ID: <48BFA314.2080300@ralphm.ik.nu>

On 2008-09-04 09:55, Phil Mayers wrote:
> Agreed. When I did some work recently to implement the client side of 
> pubsub, I found that mailing list moribund and gave up on the idea of 
> asking for help there.

Hey Phil,

that sounds nice. Have you looked at all at the stuff that currently 
resides in Wokkel (and, as part of this grand effort will eventually end 
up in Twisted Words)? The pubsub protocol there is the stuff I've been 
working on most. I mostly focused on the component side (for 
implementing Idavoll), but there is good client support in there as 
well. You can also drop me a line via Jabber.

That said, yeah the list might have been somewhat quiet, partly because 
I have been bad at communicating what I've been up to recently. It does 
have about 50 people subscribing to it, and I am so far not convinced 
that all of them would want to be dragged into general Twisted discussions.

ralphm





From p.mayers at imperial.ac.uk  Thu Sep  4 04:58:14 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Thu, 04 Sep 2008 11:58:14 +0100
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <48BFA314.2080300@ralphm.ik.nu>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
	<48BFA314.2080300@ralphm.ik.nu>
Message-ID: <48BFBF46.10509@imperial.ac.uk>

Ralph Meijer wrote:
> On 2008-09-04 09:55, Phil Mayers wrote:
>> Agreed. When I did some work recently to implement the client side of 
>> pubsub, I found that mailing list moribund and gave up on the idea of 
>> asking for help there.
> 
> Hey Phil,
> 
> that sounds nice. Have you looked at all at the stuff that currently 
> resides in Wokkel (and, as part of this grand effort will eventually end 
> up in Twisted Words)? The pubsub protocol there is the stuff I've been 
> working on most. I mostly focused on the component side (for 
> implementing Idavoll), but there is good client support in there as 
> well. You can also drop me a line via Jabber.

I did look at wokkel. I must be honest, first time round I found it a 
bit difficult to decipher, though that might be because it took a while 
to realise that lots of the pieces were in fact server-side ;o)

Once I'd gone to the effort of re-inventing the wheel however, a 2nd 
look back at wokkel made a lot more sense, and I'll certainly use it 
instead of the code I wrote.

The actual project was for ESB-like use, though that's now been put on 
hold (frankly I think XMPP pubsub might be a little new for that, and 
will probably look at ActiveMQ. It didn't help that ejabberd's 
collections are "funny").

What I *did* end up doing was start on a basic Nevow/Athena XMPP client 
with basic roster/message functions and also pubsub support. That might 
make a nice example app.

The notion of an all-twisted XMPP server is intriguing, especially if 
some integration with http://pypi.python.org/pypi/txLoadBalancer were to 
appear!

> 
> That said, yeah the list might have been somewhat quiet, partly because 
> I have been bad at communicating what I've been up to recently. It does 
> have about 50 people subscribing to it, and I am so far not convinced 
> that all of them would want to be dragged into general Twisted discussions.

Thinking about it, you're probably right - the list has been quiet 
because not much has been going on, but that doesn't mean it need remain 
quiet if things are now going to be moving.



From glyph at divmod.com  Thu Sep  4 07:37:13 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Thu, 04 Sep 2008 13:37:13 -0000
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <48BFA314.2080300@ralphm.ik.nu>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
	<48BFA314.2080300@ralphm.ik.nu>
Message-ID: <20080904133713.25821.287702513.divmod.xquotient.15374@joule.divmod.com>

On 08:57 am, twisted at ralphm.ik.nu wrote:
>On 2008-09-04 09:55, Phil Mayers wrote:
>>Agreed. When I did some work recently to implement the client side of 
>>pubsub, I found that mailing list moribund and gave up on the idea of 
>>asking for help there.

>That said, yeah the list might have been somewhat quiet, partly because 
>I have been bad at communicating what I've been up to recently. It does 
>have about 50 people subscribing to it, and I am so far not convinced 
>that all of them would want to be dragged into general Twisted 
>discussions.

I agree with Chris and JP here: I certainly plan to discuss XMPP issues 
here on the main Twisted mailing list.  I _want_ to "drag" these folks 
into general Twisted discussions - and with over 1000 people on this 
list already, with a hugely divergent array of interests in Twisted, 
somehow I am guessing those 50 won't need to be dragged too hard :).

There is still a lot to be decided as to how Twisted's XMPP code will 
integrate with the rest of Twisted: what is the (protocol-agnostic) 
common domain model for chat?  How should different XMPP components and 
modules use twisted.cred?  I think that these core integration 
mechanisms are a huge part of what makes Twisted great.  These questions 
need to be answered by people who know Twisted's abstractions as well as 
those who know XMPP's.

What to do with the twisted-jabber mailing list is certainly up to you, 
and perhaps current discussion of wokkel, palaver, and idavoll does not 
belong here; but certainly development of twisted.words should be 
discussed in as general a forum as possible.



From duncan.mcgreggor at gmail.com  Thu Sep  4 10:08:48 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Thu, 4 Sep 2008 11:08:48 -0500
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <48BFBF46.10509@imperial.ac.uk>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
	<48BFA314.2080300@ralphm.ik.nu> <48BFBF46.10509@imperial.ac.uk>
Message-ID: <4327dfbd0809040908w45819a96w917425553992bb40@mail.gmail.com>

On Thu, Sep 4, 2008 at 5:58 AM, Phil Mayers <p.mayers at imperial.ac.uk> wrote:
> Ralph Meijer wrote:
>>
>> On 2008-09-04 09:55, Phil Mayers wrote:
>>>
>>> Agreed. When I did some work recently to implement the client side of
>>> pubsub, I found that mailing list moribund and gave up on the idea of asking
>>> for help there.
>>
>> Hey Phil,
>>
>> that sounds nice. Have you looked at all at the stuff that currently
>> resides in Wokkel (and, as part of this grand effort will eventually end up
>> in Twisted Words)? The pubsub protocol there is the stuff I've been working
>> on most. I mostly focused on the component side (for implementing Idavoll),
>> but there is good client support in there as well. You can also drop me a
>> line via Jabber.
>
> I did look at wokkel. I must be honest, first time round I found it a bit
> difficult to decipher, though that might be because it took a while to
> realise that lots of the pieces were in fact server-side ;o)
>
> Once I'd gone to the effort of re-inventing the wheel however, a 2nd look
> back at wokkel made a lot more sense, and I'll certainly use it instead of
> the code I wrote.
>
> The actual project was for ESB-like use, though that's now been put on hold
> (frankly I think XMPP pubsub might be a little new for that, and will
> probably look at ActiveMQ. It didn't help that ejabberd's collections are
> "funny").
>
> What I *did* end up doing was start on a basic Nevow/Athena XMPP client with
> basic roster/message functions and also pubsub support. That might make a
> nice example app.
>
> The notion of an all-twisted XMPP server is intriguing, especially if some
> integration with http://pypi.python.org/pypi/txLoadBalancer were to appear!

Phil, you're reading my mind :-) That's just the sort of thing I have
planned for txLB's future.

d



From duncan.mcgreggor at gmail.com  Thu Sep  4 10:09:02 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Thu, 4 Sep 2008 11:09:02 -0500
Subject: [Twisted-Python] Twisted XMPP Roadmap
In-Reply-To: <20080904133713.25821.287702513.divmod.xquotient.15374@joule.divmod.com>
References: <4327dfbd0809031549m17222018xdc533f350f04b083@mail.gmail.com>
	<60ed19d40809031632q4d62285ah3fded813c39916b3@mail.gmail.com>
	<20080904075546.GB11595@wildfire.net.ic.ac.uk>
	<48BFA314.2080300@ralphm.ik.nu>
	<20080904133713.25821.287702513.divmod.xquotient.15374@joule.divmod.com>
Message-ID: <4327dfbd0809040909j22436fe5p524a34f9d649036d@mail.gmail.com>

On Thu, Sep 4, 2008 at 8:37 AM,  <glyph at divmod.com> wrote:
> On 08:57 am, twisted at ralphm.ik.nu wrote:
>>
>> On 2008-09-04 09:55, Phil Mayers wrote:
>>>
>>> Agreed. When I did some work recently to implement the client side of
>>> pubsub, I found that mailing list moribund and gave up on the idea of asking
>>> for help there.
>
>> That said, yeah the list might have been somewhat quiet, partly because I
>> have been bad at communicating what I've been up to recently. It does have
>> about 50 people subscribing to it, and I am so far not convinced that all of
>> them would want to be dragged into general Twisted discussions.
>
> I agree with Chris and JP here: I certainly plan to discuss XMPP issues here
> on the main Twisted mailing list.  I _want_ to "drag" these folks into
> general Twisted discussions - and with over 1000 people on this list
> already, with a hugely divergent array of interests in Twisted, somehow I am
> guessing those 50 won't need to be dragged too hard :).
>
> There is still a lot to be decided as to how Twisted's XMPP code will
> integrate with the rest of Twisted: what is the (protocol-agnostic) common
> domain model for chat?  How should different XMPP components and modules use
> twisted.cred?  I think that these core integration mechanisms are a huge
> part of what makes Twisted great.  These questions need to be answered by
> people who know Twisted's abstractions as well as those who know XMPP's.
>
> What to do with the twisted-jabber mailing list is certainly up to you, and
> perhaps current discussion of wokkel, palaver, and idavoll does not belong
> here; but certainly development of twisted.words should be discussed in as
> general a forum as possible.

+1

d



From duncan.mcgreggor at gmail.com  Fri Sep  5 00:51:03 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Fri, 5 Sep 2008 01:51:03 -0500
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
References: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
Message-ID: <4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>

On Tue, Aug 19, 2008 at 6:59 AM, Henrik Thostrup Jensen
<thostrup at gmail.com> wrote:
> Hi
>
> I've written a small python/twisted client library for CouchDB.
>
> It's mostly a toy, but it can be fetched from here:
> http://www.cs.aau.dk/~htj/code/couched-0.1.tar.gz if anyone is interested.
> License: MIT
>
> I'm aware of paisley  (https://launchpad.net/paisley),
> The main difference from paisley is that the connection and database
> abstraction are separated.
> Also couched does connection caching and uses web2 instead of web.
> Currently paisley is more feature rich, but couched has slightly nicer error
> handling.

Hey Henrik,

Thanks for sharing!

I would, however, encourage you to create a Paisley branch in
Launchpad and improve the error handling and connection abstraction
there. This would make it much easier for us to merge your changes
into Paisley.

At the very least, you may want to register your project with
Launchpad and associate it with the tx project group, so people can
find it easily (the tx project group, or "super project" is for
Twisted community code).

Also, are you aware that web2 features are being slowly ported to web,
and that twisted.web will continue to be the official web library?

Thanks again!

d



From thostrup at gmail.com  Fri Sep  5 01:48:08 2008
From: thostrup at gmail.com (Henrik Thostrup Jensen)
Date: Fri, 5 Sep 2008 09:48:08 +0200
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>
References: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
	<4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>
Message-ID: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>

Hi Duncan, thanks for heads up.

2008/9/5 Duncan McGreggor <duncan.mcgreggor at gmail.com>

>
> I would, however, encourage you to create a Paisley branch in
> Launchpad and improve the error handling and connection abstraction
> there. This would make it much easier for us to merge your changes
> into Paisley.
>

Changing the connection abstraction and error handling in paisley would make
it extremely similar to couched. The main difference would be the name :-).

I might do it.

Btw. I've created a second release of couched which supports views and
probably fixes a few other things. Just forgot to release it. Couched was
mainly an exercise in understanding the CouchDB interface.

At the very least, you may want to register your project with
> Launchpad and associate it with the tx project group, so people can
> find it easily (the tx project group, or "super project" is for
> Twisted community code).
>

I'll try to do this over the weekend.


> Also, are you aware that web2 features are being slowly ported to web,
> and that twisted.web will continue to be the official web library?
>

I'm aware that something might or might not happen in the twisted web world
:-).

<begin twisted web rant which would be much better suited for twisted-web>
Frankly I've given up following the web vs. web2 discussions. I used web2 as
it is what I am familiar with, and I wanted connection caching. I have a
significant code base using web2 and beside a few issues (for which I've
submitted patches and bugs, but nothing happens) it works fine, though I
have to maintain a patchset for it :-/. Twisted web is currently not an
option (I need request pipelining and http 1.1).
<end twisted web rant>


-- 
- Henrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080905/dfb4c188/attachment.html>

From exarkun at divmod.com  Fri Sep  5 04:51:16 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 5 Sep 2008 06:51:16 -0400
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
Message-ID: <20080905105116.29191.1735349546.divmod.quotient.21964@ohm>

On Fri, 5 Sep 2008 09:48:08 +0200, Henrik Thostrup Jensen <thostrup at gmail.com> wrote:
> [snip]
> Twisted web is currently not an option (I need request pipelining and http 
> 1.1).

Which other HTTP 1.1 features do you need?

Jean-Paul



From gabriel.rossetti at arimaz.com  Fri Sep  5 07:35:15 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Fri, 05 Sep 2008 15:35:15 +0200
Subject: [Twisted-Python] XMPP authentication question : when is the
	username sent?
Message-ID: <48C13593.8050409@arimaz.com>

Hello everyone,

I am trying to figure out how the auth works, for this I used the simple 
example client. The question is, when is the username sent? In the 
output I never see the username being sent, I see the server at some 
point sending it to me.

Thank you,
Gabriel

Username is : test_user at localhost

Output :

    Connected.
    SEND: <stream:stream xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:client' to='localhost' version='1.0'>
    RECV: <?xml version='1.0'?><stream:stream xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams' id='4203649965'
    from='localhost' version='1.0' xml:lang='en'>
    RECV: <stream:features><starttls
    xmlns='urn:ietf:params:xml:ns:xmpp-tls'/><mechanisms
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'><mechanism>DIGEST-MD5</mechanism><mechanism>PLAIN</mechanism></mechanisms><register
    xmlns='http://jabber.org/features/iq-register'/></stream:features>
    SEND: <starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'/>
    RECV: <proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/>
    SEND: <stream:stream xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:client' to='localhost' version='1.0'>
    RECV: <?xml version='1.0'?><stream:stream xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams' id='1885368444'
    from='localhost' version='1.0' xml:lang='en'>
    RECV: <stream:features><mechanisms
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'><mechanism>DIGEST-MD5</mechanism><mechanism>PLAIN</mechanism></mechanisms><register
    xmlns='http://jabber.org/features/iq-register'/></stream:features>
    SEND: <auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
    mechanism='DIGEST-MD5'/>
    RECV: <challenge
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>bm9uY2U9IjE0NTM4NDY3NDMiLHFvcD0iYXV0aCIsY2hhcnNldD11dGYtOCxhbGdvcml0aG09bWQ1LXNlc3M=</challenge>
    SEND: <response
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>dXNlcm5hbWU9InRlc3RfdXNlciIsbm9uY2U9IjE0NTM4NDY3NDMiLGNoYXJzZXQ9dXRmLTgscmVhbG09ImxvY2FsaG9zdCIscW9wPWF1dGgsY25vbmNlPSJhN2RkOTY1MGFmNTA4MTU2YTc1ZjE3ODQwMzZmNTQ0OCIsbmM9MDAwMDAwMDEsZGlnZXN0LXVyaT0ieG1wcC9sb2NhbGhvc3QiLHJlc3BvbnNlPTg1MWZiZmMwYTczNWRmZDFiODZkNmMzZDg0MmI2NWQ3</response>
    RECV: <challenge
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>cnNwYXV0aD03ZWQ3ZWZmNTI2NWRmMTE2MmZlNTdjNGE0NDI1ZGEwMA==</challenge>
    SEND: <response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>
    RECV: <success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>
    SEND: <stream:stream xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:client' to='localhost' version='1.0'>
    RECV: <?xml version='1.0'?><stream:stream xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams' id='4179606135'
    from='localhost' version='1.0' xml:lang='en'>
    RECV: <stream:features><bind
    xmlns='urn:ietf:params:xml:ns:xmpp-bind'/><session
    xmlns='urn:ietf:params:xml:ns:xmpp-session'/></stream:features>
    SEND: <iq type='set' id='H_0'><bind
    xmlns='urn:ietf:params:xml:ns:xmpp-bind'/></iq>
    RECV: <iq id='H_0' type='result'><bind
    xmlns='urn:ietf:params:xml:ns:xmpp-bind'><jid>test_user at localhost/26511133671220620792673712</jid></bind></iq>
    SEND: <iq type='set' id='H_1'><session
    xmlns='urn:ietf:params:xml:ns:xmpp-session'/></iq>
    RECV: <iq type='result' id='H_1'><session
    xmlns='urn:ietf:params:xml:ns:xmpp-session'/></iq>
    Authenticated.




From exarkun at divmod.com  Fri Sep  5 07:39:26 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 5 Sep 2008 09:39:26 -0400
Subject: [Twisted-Python] XMPP authentication question : when is the
	username sent?
In-Reply-To: <48C13593.8050409@arimaz.com>
Message-ID: <20080905133926.29191.814244174.divmod.quotient.22019@ohm>

On Fri, 05 Sep 2008 15:35:15 +0200, Gabriel Rossetti <gabriel.rossetti at arimaz.com> wrote:
>Hello everyone,
>
>I am trying to figure out how the auth works, for this I used the simple 
>example client. The question is, when is the username sent? In the output I 
>never see the username being sent, I see the server at some point sending it 
>to me.
>
>Thank you,
>Gabriel
>
>Username is : test_user at localhost
>
>Output :
>
> [snip]
>sasl'>dXNlcm5hbWU9InRlc3RfdXNlciIsbm9uY2U9IjE0NTM4NDY3NDMiLGNoYXJzZXQ9dXRmLTgscmVhbG09ImxvY2FsaG9zdCIscW9wPWF1dGgsY25vbmNlPSJhN2RkOTY1MGFmNTA4MTU2YTc1ZjE3ODQwMzZmNTQ0OCIsbmM9MDAwMDAwMDEsZGlnZXN0LXVyaT0ieG1wcC9sb2NhbGhvc3QiLHJlc3BvbnNlPTg1MWZiZmMwYTczNWRmZDFiODZkNmMzZDg0MmI2NWQ3</response>

There it is.  'dXNlcm...'.decode('base64') == 'username="test_user",...'

Jean-Paul



From gabriel.rossetti at arimaz.com  Fri Sep  5 07:55:36 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Fri, 05 Sep 2008 15:55:36 +0200
Subject: [Twisted-Python] XMPP authentication question : when is
	the	username sent?
In-Reply-To: <20080905133926.29191.814244174.divmod.quotient.22019@ohm>
References: <20080905133926.29191.814244174.divmod.quotient.22019@ohm>
Message-ID: <48C13A58.1010201@arimaz.com>

Jean-Paul Calderone wrote:
> On Fri, 05 Sep 2008 15:35:15 +0200, Gabriel Rossetti 
> <gabriel.rossetti at arimaz.com> wrote:
>> Hello everyone,
>>
>> I am trying to figure out how the auth works, for this I used the 
>> simple example client. The question is, when is the username sent? In 
>> the output I never see the username being sent, I see the server at 
>> some point sending it to me.
>>
>> Thank you,
>> Gabriel
>>
>> Username is : test_user at localhost
>>
>> Output :
>>
>> [snip]
>> sasl'>dXNlcm5hbWU9InRlc3RfdXNlciIsbm9uY2U9IjE0NTM4NDY3NDMiLGNoYXJzZXQ9dXRmLTgscmVhbG09ImxvY2FsaG9zdCIscW9wPWF1dGgsY25vbmNlPSJhN2RkOTY1MGFmNTA4MTU2YTc1ZjE3ODQwMzZmNTQ0OCIsbmM9MDAwMDAwMDEsZGlnZXN0LXVyaT0ieG1wcC9sb2NhbGhvc3QiLHJlc3BvbnNlPTg1MWZiZmMwYTczNWRmZDFiODZkNmMzZDg0MmI2NWQ3</response> 
>>
>
> There it is.  'dXNlcm...'.decode('base64') == 'username="test_user",...'
>
> Jean-Paul
>
Ok, I thought that was the password, and that something maybe wasn't 
printing out to stdout, makes sense now. Thank you,

Gabriel



From spiritualmechanic at yahoo.com  Fri Sep  5 10:51:15 2008
From: spiritualmechanic at yahoo.com (Steve Lewis)
Date: Fri, 5 Sep 2008 09:51:15 -0700 (PDT)
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
Message-ID: <378675.35498.qm@web33706.mail.mud.yahoo.com>

We're trying to use twisted as a sort of bus, a centralized place to manage all of our SOA enpoints (mostly through XML-RPC). We have a few services that access the Oracle DB directly (adbapi). In production we're getting intermittent ConnectionLost exceptions from cx_Oracle. Most of these are queries that take a couple of seconds.

Has anyone seen this kind of behavior before? What we're probably going to do in the short term is just remove twisted from the equation for these methods that seem to be timing out. But we're relatively new to twisted and I wonder if we're doing something that's obviously wrong.

Steve



      



From dreid at dreid.org  Fri Sep  5 11:10:08 2008
From: dreid at dreid.org (David Reid)
Date: Fri, 5 Sep 2008 10:10:08 -0700
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
References: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
	<4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>
	<f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
Message-ID: <508B395E-6BF7-459E-8F1E-7B37D80A10DE@dreid.org>

Hi Henrik,

Patches to Paisley would be greatly appreciated.

On Sep 5, 2008, at 12:48 AM, Henrik Thostrup Jensen wrote:
>
> Also, are you aware that web2 features are being slowly ported to web,
> and that twisted.web will continue to be the official web library?
>
> I'm aware that something might or might not happen in the twisted  
> web world :-).
>
> <begin twisted web rant which would be much better suited for  
> twisted-web>
> Frankly I've given up following the web vs. web2 discussions. I used  
> web2 as it is what I am familiar with, and I wanted connection  
> caching. I have a significant code base using web2 and beside a few  
> issues (for which I've submitted patches and bugs, but nothing  
> happens) it works fine, though I have to maintain a patchset for  
> it :-/. Twisted web is currently not an option (I need request  
> pipelining and http 1.1).

Please file tickets about making twisted.web support the HTTP/1.1  
features you need, this is the best way to get that support into  
Paisley.

It just saddens me to see a 3rd couchdb python client library spring  
up.  2 is bad enough but one being asynchronous and one being  
synchronous means it can't really be helped.  Paisley development  
hasn't stopped it just hasn't really needed much work.

-David
"The Unmaintainer of Web2"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080905/5646f7ab/attachment.html>

From ldanielburr at mac.com  Fri Sep  5 11:15:40 2008
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Fri, 05 Sep 2008 12:15:40 -0500
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
In-Reply-To: <378675.35498.qm@web33706.mail.mud.yahoo.com>
References: <378675.35498.qm@web33706.mail.mud.yahoo.com>
Message-ID: <op.ug0p8eyv3oj628@l-daniel-burrs-computer.local>

Hi Steve,

On Fri, 05 Sep 2008 11:51:15 -0500, Steve Lewis  
<spiritualmechanic at yahoo.com> wrote:

> We're trying to use twisted as a sort of bus, a centralized place to  
> manage all of our SOA enpoints (mostly through XML-RPC). We have a few  
> services that access the Oracle DB directly (adbapi). In production  
> we're getting intermittent ConnectionLost exceptions from cx_Oracle.  
> Most of these are queries that take a couple of seconds.
>

Hmm, it is kind of hard to say what the problem could be, without
seeing the code that is using adbapi and cx_Oracle.

When you say you are receiving ConnectionLost exceptions from cx_Oracle,
are they *really* from cx_Oracle, i.e., "ORA-03135 - Connection lost...",
or are they just the result of adbapi calling its connectionLost method?

> Has anyone seen this kind of behavior before? What we're probably going  
> to do in the short term is just remove twisted from the equation for  
> these methods that seem to be timing out. But we're relatively new to  
> twisted and I wonder if we're doing something that's obviously wrong.
>

I've used cx_Oracle with twisted many times, with many different workloads,
including stored procedures with OUT parameters, and it has always worked
as expected.  If you are able to provide some code, this list might be
able to provide you with more prescriptive advice.

Hope this helps,

L. Daniel Burr



From spiritualmechanic at yahoo.com  Fri Sep  5 12:06:25 2008
From: spiritualmechanic at yahoo.com (Steve Lewis)
Date: Fri, 5 Sep 2008 11:06:25 -0700 (PDT)
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
Message-ID: <202751.42289.qm@web33701.mail.mud.yahoo.com>

I looked at the adbapi code and it appears the ConnectionLost exception is coming from there, not from cx_Oracle. At least that's what is in the error log:

2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] adbapi closing: cx_Oracle
2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] Connection lost.
2008-09-05 12:25:48-0400 [-] Unhandled Error
        Traceback (most recent call last):
          File "/opt/Python25/lib/python2.5/threading.py", line 440, in run
            self.__target(*self.__args, **self.__kwargs)
          File "/opt/python/lib/python2.5/site-packages/twisted/python/threadpool.py", line 161, in _worker
            context.call(ctx, function, *args, **kwargs)
          File "/opt/python/lib/python2.5/site-packages/twisted/python/context.py", line 59, in callWithContext
            return self.currentContext().callWithContext(ctx, func, *args, **kw)
          File "/opt/python/lib/python2.5/site-packages/twisted/python/context.py", line 37, in callWithContext
            return func(*args,**kw)
        --- <exception caught here> ---
          File "/opt/python/lib/python2.5/site-packages/twisted/internet/threads.py", line 24, in _putResultInDeferred
            result = f(*args, **kwargs)
          File "/opt/python/lib/python2.5/site-packages/twisted/enterprise/adbapi.py", line 380, in _runInteraction
            conn.rollback()
          File "/opt/python/lib/python2.5/site-packages/twisted/enterprise/adbapi.py", line 65, in rollback
            raise ConnectionLost()
        twisted.enterprise.adbapi.ConnectionLost:

I don't know what 

        --- <exception caught here> ---

means. I'm guessing there's some sort of issue with Oracle but our DBA didn't see anything obvious in his logs. Is there a way for me to tell what exactly the "exception caught here" is?

Steve



----- Original Message ----
From: L. Daniel Burr <ldanielburr at mac.com>
To: Twisted general discussion <twisted-python at twistedmatrix.com>
Sent: Friday, September 5, 2008 1:15:40 PM
Subject: Re: [Twisted-Python] Moderately-long running processes timing out in Twisted

Hi Steve,

On Fri, 05 Sep 2008 11:51:15 -0500, Steve Lewis  
<spiritualmechanic at yahoo.com> wrote:

> We're trying to use twisted as a sort of bus, a centralized place to  
> manage all of our SOA enpoints (mostly through XML-RPC). We have a few  
> services that access the Oracle DB directly (adbapi). In production  
> we're getting intermittent ConnectionLost exceptions from cx_Oracle.  
> Most of these are queries that take a couple of seconds.
>

Hmm, it is kind of hard to say what the problem could be, without
seeing the code that is using adbapi and cx_Oracle.

When you say you are receiving ConnectionLost exceptions from cx_Oracle,
are they *really* from cx_Oracle, i.e., "ORA-03135 - Connection lost...",
or are they just the result of adbapi calling its connectionLost method?

> Has anyone seen this kind of behavior before? What we're probably going  
> to do in the short term is just remove twisted from the equation for  
> these methods that seem to be timing out. But we're relatively new to  
> twisted and I wonder if we're doing something that's obviously wrong.
>

I've used cx_Oracle with twisted many times, with many different workloads,
including stored procedures with OUT parameters, and it has always worked
as expected.  If you are able to provide some code, this list might be
able to provide you with more prescriptive advice.

Hope this helps,

L. Daniel Burr

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



      



From exarkun at divmod.com  Fri Sep  5 12:20:01 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 5 Sep 2008 14:20:01 -0400
Subject: [Twisted-Python] Moderately-long running processes timing out
	in Twisted
In-Reply-To: <202751.42289.qm@web33701.mail.mud.yahoo.com>
Message-ID: <20080905182001.29191.193291293.divmod.quotient.22103@ohm>

On Fri, 5 Sep 2008 11:06:25 -0700 (PDT), Steve Lewis <spiritualmechanic at yahoo.com> wrote:
>I looked at the adbapi code and it appears the ConnectionLost exception is coming from there, not from cx_Oracle. At least that's what is in the error log:
>
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] adbapi closing: cx_Oracle
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] Connection lost.
>2008-09-05 12:25:48-0400 [-] Unhandled Error
>        Traceback (most recent call last):
>          File "/opt/Python25/lib/python2.5/threading.py", line 440, in run
>            self.__target(*self.__args, **self.__kwargs)
>          File "/opt/python/lib/python2.5/site-packages/twisted/python/threadpool.py", line 161, in _worker
>            context.call(ctx, function, *args, **kwargs)
>          File "/opt/python/lib/python2.5/site-packages/twisted/python/context.py", line 59, in callWithContext
>            return self.currentContext().callWithContext(ctx, func, *args, **kw)
>          File "/opt/python/lib/python2.5/site-packages/twisted/python/context.py", line 37, in callWithContext
>            return func(*args,**kw)
>        --- <exception caught here> ---
>          File "/opt/python/lib/python2.5/site-packages/twisted/internet/threads.py", line 24, in _putResultInDeferred
>            result = f(*args, **kwargs)
>          File "/opt/python/lib/python2.5/site-packages/twisted/enterprise/adbapi.py", line 380, in _runInteraction
>            conn.rollback()
>          File "/opt/python/lib/python2.5/site-packages/twisted/enterprise/adbapi.py", line 65, in rollback
>            raise ConnectionLost()
>        twisted.enterprise.adbapi.ConnectionLost:
>
>I don't know what
>
>        --- <exception caught here> ---
>
>means. I'm guessing there's some sort of issue with Oracle but our DBA didn't see anything obvious in his logs. Is there a way for me to tell what exactly the "exception caught here" is?
>

"exception caught here" is telling you where in the call stack the exception
was caught. Frames above it weren't escaped by the exception. Frames below
it were.

I think you're seeing an example of poor error reporting in adbapi.  This
has recently been improved and the improvements will be included in the
next release of Twisted.  If you can somehow test a recent trunk revision
of Twisted, you might find that it reports a more specific problem which
points to the actual cause of the failure.

What this does indicate, I think, is that you had a transaction which
could not be committed for some reason.  adbapi is rolling back the
transaction before reporting the reason the commit failed.  However,
the ConnectionLost exception, which is boring and not really relevant
to anything you're doing, is happening before the real exception can be
reported.

Jean-Paul



From glyph at divmod.com  Fri Sep  5 12:22:08 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Fri, 05 Sep 2008 18:22:08 -0000
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
In-Reply-To: <202751.42289.qm@web33701.mail.mud.yahoo.com>
References: <202751.42289.qm@web33701.mail.mud.yahoo.com>
Message-ID: <20080905182208.25821.961475070.divmod.xquotient.15608@joule.divmod.com>



It seems that you have been a victim of at least one recently-fixed bug:

    http://twistedmatrix.com/trac/ticket/3244

and at least one long-standing one:

    http://twistedmatrix.com/trac/ticket/1753

As you can see from the tone of my (unfortunate) comment on the latter 
ticket, I don't think a lot of people use Oracle with Twisted.

However, the issue is simple to hack around temporarily: set your 
ConnectionPool's "good_sql" attribute to 'select 1 from dual' as itamar 
suggests on #1753.

Then, please submit a patch, and ideally a buildslave with a copy of 
oracle installed so that we can maintain support for it :).

On 06:06 pm, spiritualmechanic at yahoo.com wrote:
>I looked at the adbapi code and it appears the ConnectionLost exception 
>is coming from there, not from cx_Oracle. At least that's what is in 
>the error log:
>
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] adbapi closing: 
>cx_Oracle
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] Connection lost.
>2008-09-05 12:25:48-0400 [-] Unhandled Error
>        Traceback (most recent call last):
>          File "/opt/Python25/lib/python2.5/threading.py", line 440, in 
>run
>            self.__target(*self.__args, **self.__kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/threadpool.py", line 161, in _worker
>            context.call(ctx, function, *args, **kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/context.py", line 59, in callWithContext
>            return self.currentContext().callWithContext(ctx, func, 
>*args, **kw)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/context.py", line 37, in callWithContext
>            return func(*args,**kw)
>        --- <exception caught here> ---
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/internet/threads.py", line 24, in _putResultInDeferred
>            result = f(*args, **kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/enterprise/adbapi.py", line 380, in _runInteraction
>            conn.rollback()
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/enterprise/adbapi.py", line 65, in rollback
>            raise ConnectionLost()
>        twisted.enterprise.adbapi.ConnectionLost:
>
>I don't know what
>
>        --- <exception caught here> ---
>
>means. I'm guessing there's some sort of issue with Oracle but our DBA 
>didn't see anything obvious in his logs. Is there a way for me to tell 
>what exactly the "exception caught here" is?
>
>Steve
>
>
>
>----- Original Message ----
>From: L. Daniel Burr <ldanielburr at mac.com>
>To: Twisted general discussion <twisted-python at twistedmatrix.com>
>Sent: Friday, September 5, 2008 1:15:40 PM
>Subject: Re: [Twisted-Python] Moderately-long running processes timing 
>out in Twisted
>
>Hi Steve,
>
>On Fri, 05 Sep 2008 11:51:15 -0500, Steve Lewis
><spiritualmechanic at yahoo.com> wrote:
>>We're trying to use twisted as a sort of bus, a centralized place to
>>manage all of our SOA enpoints (mostly through XML-RPC). We have a few
>>services that access the Oracle DB directly (adbapi). In production
>>we're getting intermittent ConnectionLost exceptions from cx_Oracle.
>>Most of these are queries that take a couple of seconds.
>
>Hmm, it is kind of hard to say what the problem could be, without
>seeing the code that is using adbapi and cx_Oracle.
>
>When you say you are receiving ConnectionLost exceptions from 
>cx_Oracle,
>are they *really* from cx_Oracle, i.e., "ORA-03135 - Connection 
>lost...",
>or are they just the result of adbapi calling its connectionLost 
>method?
>>Has anyone seen this kind of behavior before? What we're probably 
>>going
>>to do in the short term is just remove twisted from the equation for
>>these methods that seem to be timing out. But we're relatively new to
>>twisted and I wonder if we're doing something that's obviously wrong.
>
>I've used cx_Oracle with twisted many times, with many different 
>workloads,
>including stored procedures with OUT parameters, and it has always 
>worked
>as expected.  If you are able to provide some code, this list might be
>able to provide you with more prescriptive advice.
>
>Hope this helps,
>
>L. Daniel Burr
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From spiritualmechanic at yahoo.com  Fri Sep  5 12:31:12 2008
From: spiritualmechanic at yahoo.com (Steve Lewis)
Date: Fri, 5 Sep 2008 11:31:12 -0700 (PDT)
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
Message-ID: <565425.32565.qm@web33705.mail.mud.yahoo.com>

We're using good_sql already. We're doing our best to move away from Oracle, honest! ;)
Steve



----- Original Message ----
From: "glyph at divmod.com" <glyph at divmod.com>
To: Twisted general discussion <twisted-python at twistedmatrix.com>
Sent: Friday, September 5, 2008 2:22:08 PM
Subject: Re: [Twisted-Python] Moderately-long running processes timing out in Twisted



It seems that you have been a victim of at least one recently-fixed bug:

    http://twistedmatrix.com/trac/ticket/3244

and at least one long-standing one:

    http://twistedmatrix.com/trac/ticket/1753

As you can see from the tone of my (unfortunate) comment on the latter 
ticket, I don't think a lot of people use Oracle with Twisted.

However, the issue is simple to hack around temporarily: set your 
ConnectionPool's "good_sql" attribute to 'select 1 from dual' as itamar 
suggests on #1753.

Then, please submit a patch, and ideally a buildslave with a copy of 
oracle installed so that we can maintain support for it :).

On 06:06 pm, spiritualmechanic at yahoo.com wrote:
>I looked at the adbapi code and it appears the ConnectionLost exception 
>is coming from there, not from cx_Oracle. At least that's what is in 
>the error log:
>
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] adbapi closing: 
>cx_Oracle
>2008-09-05 12:25:48-0400 [HTTPChannel,9003,127.0.0.1] Connection lost.
>2008-09-05 12:25:48-0400 [-] Unhandled Error
>        Traceback (most recent call last):
>          File "/opt/Python25/lib/python2.5/threading.py", line 440, in 
>run
>            self.__target(*self.__args, **self.__kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/threadpool.py", line 161, in _worker
>            context.call(ctx, function, *args, **kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/context.py", line 59, in callWithContext
>            return self.currentContext().callWithContext(ctx, func, 
>*args, **kw)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/python/context.py", line 37, in callWithContext
>            return func(*args,**kw)
>        --- <exception caught here> ---
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/internet/threads.py", line 24, in _putResultInDeferred
>            result = f(*args, **kwargs)
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/enterprise/adbapi.py", line 380, in _runInteraction
>            conn.rollback()
>          File "/opt/python/lib/python2.5/site- 
>packages/twisted/enterprise/adbapi.py", line 65, in rollback
>            raise ConnectionLost()
>        twisted.enterprise.adbapi.ConnectionLost:
>
>I don't know what
>
>        --- <exception caught here> ---
>
>means. I'm guessing there's some sort of issue with Oracle but our DBA 
>didn't see anything obvious in his logs. Is there a way for me to tell 
>what exactly the "exception caught here" is?
>
>Steve
>
>
>
>----- Original Message ----
>From: L. Daniel Burr <ldanielburr at mac.com>
>To: Twisted general discussion <twisted-python at twistedmatrix.com>
>Sent: Friday, September 5, 2008 1:15:40 PM
>Subject: Re: [Twisted-Python] Moderately-long running processes timing 
>out in Twisted
>
>Hi Steve,
>
>On Fri, 05 Sep 2008 11:51:15 -0500, Steve Lewis
><spiritualmechanic at yahoo.com> wrote:
>>We're trying to use twisted as a sort of bus, a centralized place to
>>manage all of our SOA enpoints (mostly through XML-RPC). We have a few
>>services that access the Oracle DB directly (adbapi). In production
>>we're getting intermittent ConnectionLost exceptions from cx_Oracle.
>>Most of these are queries that take a couple of seconds.
>
>Hmm, it is kind of hard to say what the problem could be, without
>seeing the code that is using adbapi and cx_Oracle.
>
>When you say you are receiving ConnectionLost exceptions from 
>cx_Oracle,
>are they *really* from cx_Oracle, i.e., "ORA-03135 - Connection 
>lost...",
>or are they just the result of adbapi calling its connectionLost 
>method?
>>Has anyone seen this kind of behavior before? What we're probably 
>>going
>>to do in the short term is just remove twisted from the equation for
>>these methods that seem to be timing out. But we're relatively new to
>>twisted and I wonder if we're doing something that's obviously wrong.
>
>I've used cx_Oracle with twisted many times, with many different 
>workloads,
>including stored procedures with OUT parameters, and it has always 
>worked
>as expected.  If you are able to provide some code, this list might be
>able to provide you with more prescriptive advice.
>
>Hope this helps,
>
>L. Daniel Burr
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
>
>
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



      



From glyph at divmod.com  Fri Sep  5 13:33:21 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Fri, 05 Sep 2008 19:33:21 -0000
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
In-Reply-To: <565425.32565.qm@web33705.mail.mud.yahoo.com>
References: <565425.32565.qm@web33705.mail.mud.yahoo.com>
Message-ID: <20080905193321.25821.763058873.divmod.xquotient.15611@joule.divmod.com>




On 06:31 pm, spiritualmechanic at yahoo.com wrote:
>We're using good_sql already. We're doing our best to move away from 
>Oracle, honest! ;)
>Steve

(lots of stuff snipped)

Hmm.  I was guessing about the most likely cause since the other (fixed) 
bug inhibits error reporting.

Do you get a more useful traceback out of twisted trunk at HEAD?  I 
wouldn't advocate using that in production, but the error-logging bugfix 
would tell you at least what's really going wrong.



From jeff.dyke at gmail.com  Fri Sep  5 15:56:14 2008
From: jeff.dyke at gmail.com (Jeff Dyke)
Date: Fri, 5 Sep 2008 17:56:14 -0400
Subject: [Twisted-Python] Moderately-long running processes timing out in
	Twisted
In-Reply-To: <20080905193321.25821.763058873.divmod.xquotient.15611@joule.divmod.com>
References: <565425.32565.qm@web33705.mail.mud.yahoo.com>
	<20080905193321.25821.763058873.divmod.xquotient.15611@joule.divmod.com>
Message-ID: <8496caf30809051456y2735ef5ek5eb8c353d2a36922@mail.gmail.com>

On Fri, Sep 5, 2008 at 3:33 PM,  <glyph at divmod.com> wrote:
>
>
>
> On 06:31 pm, spiritualmechanic at yahoo.com wrote:
>>
>> We're using good_sql already. We're doing our best to move away from
>> Oracle, honest! ;)
>> Steve
>
> (lots of stuff snipped)
>
> Hmm.  I was guessing about the most likely cause since the other (fixed) bug
> inhibits error reporting.
>
> Do you get a more useful traceback out of twisted trunk at HEAD?  I wouldn't
> advocate using that in production, but the error-logging bugfix would tell
> you at least what's really going wrong.
>

This could be way off base, but i used to see this on stale
connections being  utilized again in the next xmlrpc job, basically
timing out. (mysqldb- Mysql Server has gone away). Using db.ping()
could keep them alive, or testing the connection/recreating before
executing a new xmlrpc job.

do these exceptions occur when they are running not through the xmlrpc.

Jeff
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From ellisonbg.net at gmail.com  Fri Sep  5 16:46:29 2008
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Fri, 5 Sep 2008 15:46:29 -0700
Subject: [Twisted-Python] "_wait" is blowing up?!
In-Reply-To: <20080828191133.29191.157249331.divmod.quotient.19100@ohm>
References: <6ce0ac130808281152x5b10b6baq67020919e15dd4d2@mail.gmail.com>
	<20080828191133.29191.157249331.divmod.quotient.19100@ohm>
Message-ID: <6ce0ac130809051546w412be51eh87ca78de9dd797e2@mail.gmail.com>

By random chance I found the problem in this case.  Thanks for the
suggestions though!

Cheers,

Brian

On Thu, Aug 28, 2008 at 12:11 PM, Jean-Paul Calderone
<exarkun at divmod.com> wrote:
>
>
> On Thu, 28 Aug 2008 11:52:02 -0700, Brian Granger <ellisonbg.net at gmail.com>
> wrote:
>>>
>>> Is your code available somewhere?
>>
>> yes, the code is the IPython mainline, on launchpad:
>>
>> $ bzr branch lp:ipython
>>
>> Then, simply
>>
>> $ trial IPython
>>
>> Will show the problem.  You will also need foolcap to run the test suite.
>>
>>> Do you reliably see this error eventually if you use trial --until-
>>> failure?
>>
>> It shows up as an Error rather than a Failure.  But yes, it still shows
>> up.
>>
>>> Exactly what version of Twisted are you using?
>>
>> Latest stable.
>>
>>> What reactor do you typically run your tests under?
>>
>> Default on all platforms.
>>
>>> Not sure that I'd be able to tell you what's going on even with an answer
>>> to
>>> all of these questions, but they'd be a start :).
>>
>> Thanks, I know this type of thing is tough to debug.  Any clever
>> tricks I could use to track it down?
>
> You can try running with trial --debug (possibly also --nopm).  This will
> cause Deferred debugging to be enabled, which will cause the call site of
> each Deferred's creation to be saved.  Then you can inspect this to learn
> which Deferred is being called back multiple times.  Once you learn this,
> further debugging approaches may become apparent (like looking at all the
> call sites which can call back a Deferred created there, and figuring out
> how more than one of them can be executed).
>
> Jean-Paul
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From thostrup at gmail.com  Fri Sep  5 17:25:36 2008
From: thostrup at gmail.com (Henrik Thostrup Jensen)
Date: Sat, 6 Sep 2008 01:25:36 +0200
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <20080905105116.29191.1735349546.divmod.quotient.21964@ohm>
References: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
	<20080905105116.29191.1735349546.divmod.quotient.21964@ohm>
Message-ID: <f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>

2008/9/5 Jean-Paul Calderone <exarkun at divmod.com>

> On Fri, 5 Sep 2008 09:48:08 +0200, Henrik Thostrup Jensen <
> thostrup at gmail.com> wrote:
>
>> [snip]
>> Twisted web is currently not an option (I need request pipelining and http
>> 1.1).
>>
>
> Which other HTTP 1.1 features do you need?
>

HTTP 1.1 status codes, notable 303 (see other). I could probably use 302,
but 303 is the "correct" behaviour for my case. This should be relatively
easy to implement.

Furthermore I need the server to support large uploads (last i checked the
640K limitation was still there) and downloads, and with reasonable
efficiancy.  I'm not saying streams are the answer but it works for me
(actually I use the producer/consumer interface in my lower level code and
then adapt it in the web layer). Unfortunately I've had to rewrite a lot of
the producer/consumer code and stream stuff and glue it together, as some of
the stuff in twisted (not just in web2) is rather broken. For complete
insanity (sorry to whoever wrote it ) see
twisted.protocols.basic.FileSender, which implements its own magic method
beginFileTransfer, which takes BOTH a file and a consumer as argument. This
makes is impossible to seperate the construction of the producer and
starting the transfer.

Ticket #1956 fixes some of these things. I'm not quite sure how it handles
errors (which can happen both ways), but I've just had a quick look. It's
been a whlie since i've had a look at all this. I write a bit about it,
which I've placed here: http://www.cs.aau.dk/~htj/prodcons.txt

IMHO, getting (and deciding on) a proper producer/consumer interface need to
happen, to make whatever web things twisted will have usefull. Changing the
producer/consumer might be massive API break, however it is a needed one.
There are simply things the current API cannot do (i usually return a
deferred along with any producer/consumer object to indiciate how the data
moving went). I might be interested in participating in this, however I'm
rather work struck as I have to hand my ph.d. thesis at the end of this
year.

Btw. I really am a huge fan of twisted, however the web and
producer/consumer is a rather dark spot in an otherwise bright world :-)


-- 
- Henrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080906/8bbc5c3a/attachment.html>

From thostrup at gmail.com  Fri Sep  5 17:35:17 2008
From: thostrup at gmail.com (Henrik Thostrup Jensen)
Date: Sat, 6 Sep 2008 01:35:17 +0200
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <508B395E-6BF7-459E-8F1E-7B37D80A10DE@dreid.org>
References: <f33a4da20808190459g1b6cd1fav4ef720a7c526503f@mail.gmail.com>
	<4327dfbd0809042351k3e102f12ma07a3e2d9ff876ea@mail.gmail.com>
	<f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
	<508B395E-6BF7-459E-8F1E-7B37D80A10DE@dreid.org>
Message-ID: <f33a4da20809051635i3ddaf3f1m8358e991e572ef18@mail.gmail.com>

2008/9/5 David Reid <dreid at dreid.org>

> Hi Henrik,
> Patches to Paisley would be greatly appreciated.
>

Will you accept a switch to web2, otherwise there is very little point to
it. Otherwise the patch kit needs to look like this:

Proper producer/consumer infrastructure in twisted
Integrate the above in twisted.web along with http 1.1 response codes, and
request pipelining.
Some patches to paisley, which would be quite small compared to the other.

Sorry, but it is not that simple :-)

Please file tickets about making twisted.web support the HTTP/1.1 features
> you need, this is the best way to get that support into Paisley.
>

See my response to JP.


> It just saddens me to see a 3rd couchdb python client library spring up.  2
> is bad enough but one being asynchronous and one being synchronous means it
> can't really be helped.  Paisley development hasn't stopped it just hasn't
> really needed much work.
>

Without getting into some large discussion here, I think that some diversity
is actually a good thing. Of course it is no use having several half
implementations lying around (the python community excels at this :-)), than
having a single working library. However. the interface of couchdb is simple
enough that a full client library can be written rather fast. This is not
sad, but very nice :-).


-- 
- Henrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080906/bb2e5be8/attachment.html>

From glyph at divmod.com  Fri Sep  5 19:12:13 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Sat, 06 Sep 2008 01:12:13 -0000
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>
References: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>
	<20080905105116.29191.1735349546.divmod.quotient.21964@ohm>
	<f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>
Message-ID: <20080906011213.25821.1308765536.divmod.xquotient.15694@joule.divmod.com>


On 5 Sep, 11:25 pm, thostrup at gmail.com wrote:
>2008/9/5 Jean-Paul Calderone <exarkun at divmod.com>
>>On Fri, 5 Sep 2008 09:48:08 +0200, Henrik Thostrup Jensen <
>>thostrup at gmail.com> wrote:
>>>[snip]
>>>Twisted web is currently not an option (I need request pipelining and 
>>>http
>>>1.1).

Please feel free to use twisted.web2 if it is meeting your needs 
currently.  However, our goal remains to focus maintenance effort on 
twisted.web and provide a gradual, compatible evolution to a better 
webserver.  The HTTP 1.1 features that you need will eventually be added 
to twisted.web, and I hope that the split with paisley can be resolved 
at that point.

I personally don't use couchdb or have any interest in its bindings, but 
it sounds like you have some other misconceptions about twisted and its 
development process which I'd like to correct.
>>Which other HTTP 1.1 features do you need?

>Furthermore I need the server to support large uploads (last i checked 
>the
>640K limitation was still there) and downloads, and with reasonable
>efficiancy.

640k limitation?  In twisted.web?  As far as I know there's no such 
thing; the only 640k limitation I know of anywhere in Twisted is in PB, 
and that's just on individual message size.  A brief skim through the 
twisted.web client and server code doesn't reveal any obvious size 
limitations that I can see.  (Is there some 640k limitation in the 'cgi' 
module?)

If there is such a limitation it should be more clearly documented 
somewhere.

True, twisted.web doesn't provide a graceful way for resources to handle 
streaming file uploads as they arrive, but for dedicated servers it is 
certainly *possible*; Request.handleContentChunk says it's "not for 
users", but you could easily write a few simple patches which would make 
it "for users", or just subclass it and ignore the docstring.  Nothing 
in twisted.web is really that hard to fix.
>Ticket #1956 fixes some of these things. I'm not quite sure how it 
>handles
>errors (which can happen both ways), but I've just had a quick look. 
>It's
>been a whlie since i've had a look at all this. I write a bit about it,
>which I've placed here: http://www.cs.aau.dk/~htj/prodcons.txt

Ticket #1956 is still kind of stuck defining the problem.

If you have comments or thoughts on #1956, please feel free to add them 
as comments.  Text files lying around the web are not as helpful as 
discussions on tickets.

Your text file suffers from the same problems as the existing discussion 
on the ticket, though: a lack of concrete use-cases and example code. 
There are lots of proposed solutions but not a lot of proposed problems. 
(I am certainly a guilty party here, I really should describe the 
problem in more detail.)  We all feel there is some inelegance, but 
there is no example of some code that we can all agree is gross and 
would be fixed by some better API.

Please come up with an example - the shorter the better - of a 
deficiency in the streaming API and put it on the ticket.  Hopefully 
that will further the discussion there.
>IMHO, getting (and deciding on) a proper producer/consumer interface 
>need to
>happen, to make whatever web things twisted will have usefull. Changing 
>the
>producer/consumer might be massive API break, however it is a needed 
>one.

No.

1. We will never break compatibility with an API this old and this 
stable.  When we do start to move over to a new API, the transition will 
be particularly gradual and slow given the core nature of this API and 
the fact that pretty much everything uses it.  Even if it were only 
around for one release, see 
http://twistedmatrix.com/trac/wiki/CompatibilityPolicy

2. It's not clear what the new API would be.  Every suggestion proposed 
thus far has some issues, and there's no clear winner.  Unless someone 
takes the time to really thoroughly explain the problem and describe 
what effect the solution would have, with examples, then we're not going 
to make any progress.

3. There isn't anything that you *can't do* with 
ITransport/IProducer/IConsumer/IProtocol.  It can be slightly awkward 
sometimes, but I have yet to see an example where you really can't make 
something work.  For example, IConsumer doesn't have .finish(), but 
that's fine, because you probably mean IProtocol.connectionLost(...) 
anyway.  Some users of these interfaces don't provide nice ways to get 
data in and out, and yes, a uniform and consistent way to deal with 
slinging data between endpoints (for example, a standard, featureful 
object to remix a 'protocol' into a 'transport' and vice versa) would 
probably help with that.  Given that the deficiency creates momentary 
inconveniences rather than impossibilities, there's no way we're going 
to break *every single twisted program ever* just to make it slightly 
more convenient.

4. Given that the semantics are already there, it will be very easy to 
evolve new code to call old interfaces, provide adapters which wrap 
around things and generally make it easy to have some hypothetical shiny 
new interface cooperate just fine with the crufty old ones.



From exarkun at twistedmatrix.com  Sat Sep  6 22:05:10 2008
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 07 Sep 2008 04:05:10 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1220760310.49.448219891@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080907/6f8d7af7/attachment.html>

From manlio_perillo at libero.it  Wed Sep 10 02:00:59 2008
From: manlio_perillo at libero.it (Manlio Perillo)
Date: Wed, 10 Sep 2008 10:00:59 +0200
Subject: [Twisted-Python] Couched 0.1: CouchDB twisted client
In-Reply-To: <f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>
References: <f33a4da20809050048u71e2b514l9c13e3587e684e0c@mail.gmail.com>	<20080905105116.29191.1735349546.divmod.quotient.21964@ohm>
	<f33a4da20809051625v66eea95cn33b98b9f1355d11d@mail.gmail.com>
Message-ID: <48C77EBB.2080903@libero.it>

Henrik Thostrup Jensen ha scritto:
> 2008/9/5 Jean-Paul Calderone <exarkun at divmod.com 
> <mailto:exarkun at divmod.com>>
> 
>     On Fri, 5 Sep 2008 09:48:08 +0200, Henrik Thostrup Jensen
>     <thostrup at gmail.com <mailto:thostrup at gmail.com>> wrote:
> 
>         [snip]
> 
>         Twisted web is currently not an option (I need request
>         pipelining and http 1.1).
> 
> 
>     Which other HTTP 1.1 features do you need?
> 
> 
> HTTP 1.1 status codes, notable 303 (see other). I could probably use 
> 302, but 303 is the "correct" behaviour for my case. This should be 
> relatively easy to implement.
> 
> Furthermore I need the server to support large uploads (last i checked 
> the 640K limitation was still there) and downloads, and with reasonable 
> efficiancy.  

You can try to use Nginx with the upload module
http://www.grid.net.ru/nginx/upload.en.html

The upload module parse the multipart/form-data entity body, and saves 
all file fields to temporary files.

The backend server receive a multipart/form-data entity body where each 
file field is replaced with several fields: *_name, *_content_type, 
*_file_name, *_tmp_path (names are configurable).


 > [...]


Manlio Perillo



From matusis at yahoo.com  Wed Sep 10 14:32:06 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Wed, 10 Sep 2008 13:32:06 -0700
Subject: [Twisted-Python] intermittent problem: not accepting new connections
Message-ID: <043501c91384$4c2c6b00$e4854100$@com>

I have had a twisted epoll server that was heavily used, such that it
saturated CPU (100% shown by "top", about 5000 connections, intense message
relaying).
I am using twisted 2.5.0 that I patched for epoll bug.
It was run on python 2.4.4 , 2.6.11 kernel on a single core xeon 3.0 GHz
CPU. This server has been on for many months, and it has been rock-stable.

A couple of days ago I migrated that server to a newer machine: same patched
twisted 2.5.0, same python 2.4.4, newer 2.6.24 kernel and a quad core xeon
L5420 CPU. 
CPU usage dropped from 100% to 30%, as expected, with the same rate of
client connections.

However the server now has the following intermittent problem: about twice a
day, it stops accepting new connections for a short period of 5-10 minutes.

telnet times out, I get this:
root at serv2:/proc/net/netfilter# telnet localhost 5229

Trying 127.0.0.1...

Existing connections are not cut, they server receives/delivers messages
to/from them just fine.
These short periods of not accepting connections do not correlate with
increased CPU load or with the overall number of connections to the server.

I have had a problem with the same symptoms before, when a server process
run out of its quota of file descriptors.
However, there were clear messages in the twisted log at that time, and
upping the ulimits solved the problem.
This time, there are no errors in ANY logs (twisted log. /var/log/messages,
etc)

I am out of ideas on what this could be, because my setup is exactly the
same as I have been using in the last year, except for a faster CPU and a
newer kernel?

I suspect that there are some new uncaught accept() exceptions in
internet/tcp.py in the part where it's looking for EMFILE, ENOBUFS, ENFILE,
ENOMEM, ECONNABORTED errors.




From exarkun at divmod.com  Wed Sep 10 14:44:15 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 10 Sep 2008 16:44:15 -0400
Subject: [Twisted-Python] intermittent problem: not accepting new
	connections
In-Reply-To: <043501c91384$4c2c6b00$e4854100$@com>
Message-ID: <20080910204415.29191.1876254162.divmod.quotient.24247@ohm>

On Wed, 10 Sep 2008 13:32:06 -0700, Alec Matusis <matusis at yahoo.com> wrote:
>I have had a twisted epoll server that was heavily used, such that it
>saturated CPU (100% shown by "top", about 5000 connections, intense message
>relaying).
>I am using twisted 2.5.0 that I patched for epoll bug.
>It was run on python 2.4.4 , 2.6.11 kernel on a single core xeon 3.0 GHz
>CPU. This server has been on for many months, and it has been rock-stable.
>
>A couple of days ago I migrated that server to a newer machine: same patched
>twisted 2.5.0, same python 2.4.4, newer 2.6.24 kernel and a quad core xeon
>L5420 CPU.
>CPU usage dropped from 100% to 30%, as expected, with the same rate of
>client connections.
>
>However the server now has the following intermittent problem: about twice a
>day, it stops accepting new connections for a short period of 5-10 minutes.
>
>telnet times out, I get this:
>root at serv2:/proc/net/netfilter# telnet localhost 5229
>
>Trying 127.0.0.1...
>
>Existing connections are not cut, they server receives/delivers messages
>to/from them just fine.
>These short periods of not accepting connections do not correlate with
>increased CPU load or with the overall number of connections to the server.
>
>I have had a problem with the same symptoms before, when a server process
>run out of its quota of file descriptors.
>However, there were clear messages in the twisted log at that time, and
>upping the ulimits solved the problem.
>This time, there are no errors in ANY logs (twisted log. /var/log/messages,
>etc)

Do non-error log messages continue to appear in the Twisted log?  ie, is
it clear that the logging system is still working, or could it have failed
in some way, obscuring any exception reports?

>
>I am out of ideas on what this could be, because my setup is exactly the
>same as I have been using in the last year, except for a faster CPU and a
>newer kernel?
>
>I suspect that there are some new uncaught accept() exceptions in
>internet/tcp.py in the part where it's looking for EMFILE, ENOBUFS, ENFILE,
>ENOMEM, ECONNABORTED errors.
>

Any new unhandled errno values should definitely result in an exception
being logged (notice that the `raise which follows the checks for
various errno values is inside a try/except which logs any exception).

Jean-Paul



From matusis at yahoo.com  Wed Sep 10 15:01:27 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Wed, 10 Sep 2008 14:01:27 -0700
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <20080910204415.29191.1876254162.divmod.quotient.24247@ohm>
References: <043501c91384$4c2c6b00$e4854100$@com>
	<20080910204415.29191.1876254162.divmod.quotient.24247@ohm>
Message-ID: <045201c91388$67f836d0$37e8a470$@com>

> Do non-error log messages continue to appear in the Twisted log?  ie,
> is
> it clear that the logging system is still working, or could it have
> failed
> in some way, obscuring any exception reports?

Yes, I print the results of garbage collection every 10 min like this:

print "number of objects tracked by the garbage collector is:", len(gc.get_objects())

and they appear in the main twisted log.

2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage collector is: 860021
2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage collector is: 864316

> Any new unhandled errno values should definitely result in an exception
> being logged (notice that the `raise which follows the checks for
> various errno values is inside a try/except which logs any exception).

I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or EPERM?

                except socket.error, e:
                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
                        self.numberAccepts = i
                        break
                    elif e.args[0] == EPERM:
                        # Netfilter on Linux may have rejected the
                        # connection, but we get told to try to accept()
                        # anyway.
                        continue


I am not sure how to debug this problem- I have another twisted server of a different type on that machine, and while the problematic server stops accepting connections, the second one works just fine, so this is not a machine-wide issue.
What could it be?

> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Wednesday, September 10, 2008 1:44 PM
> To: Twisted general discussion
> Subject: Re: [Twisted-Python] intermittent problem: not accepting new
> connections
> 
> On Wed, 10 Sep 2008 13:32:06 -0700, Alec Matusis <matusis at yahoo.com>
> wrote:
> >I have had a twisted epoll server that was heavily used, such that it
> >saturated CPU (100% shown by "top", about 5000 connections, intense
> message
> >relaying).
> >I am using twisted 2.5.0 that I patched for epoll bug.
> >It was run on python 2.4.4 , 2.6.11 kernel on a single core xeon 3.0
> GHz
> >CPU. This server has been on for many months, and it has been rock-
> stable.
> >
> >A couple of days ago I migrated that server to a newer machine: same
> patched
> >twisted 2.5.0, same python 2.4.4, newer 2.6.24 kernel and a quad core
> xeon
> >L5420 CPU.
> >CPU usage dropped from 100% to 30%, as expected, with the same rate of
> >client connections.
> >
> >However the server now has the following intermittent problem: about
> twice a
> >day, it stops accepting new connections for a short period of 5-10
> minutes.
> >
> >telnet times out, I get this:
> >root at serv2:/proc/net/netfilter# telnet localhost 5229
> >
> >Trying 127.0.0.1...
> >
> >Existing connections are not cut, they server receives/delivers
> messages
> >to/from them just fine.
> >These short periods of not accepting connections do not correlate with
> >increased CPU load or with the overall number of connections to the
> server.
> >
> >I have had a problem with the same symptoms before, when a server
> process
> >run out of its quota of file descriptors.
> >However, there were clear messages in the twisted log at that time,
> and
> >upping the ulimits solved the problem.
> >This time, there are no errors in ANY logs (twisted log.
> /var/log/messages,
> >etc)
> 
> Do non-error log messages continue to appear in the Twisted log?  ie,
> is
> it clear that the logging system is still working, or could it have
> failed
> in some way, obscuring any exception reports?
> 
> >
> >I am out of ideas on what this could be, because my setup is exactly
> the
> >same as I have been using in the last year, except for a faster CPU
> and a
> >newer kernel?
> >
> >I suspect that there are some new uncaught accept() exceptions in
> >internet/tcp.py in the part where it's looking for EMFILE, ENOBUFS,
> ENFILE,
> >ENOMEM, ECONNABORTED errors.
> >
> 
> Any new unhandled errno values should definitely result in an exception
> being logged (notice that the `raise which follows the checks for
> various errno values is inside a try/except which logs any exception).
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Wed Sep 10 15:46:40 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 10 Sep 2008 17:46:40 -0400
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <045201c91388$67f836d0$37e8a470$@com>
Message-ID: <20080910214640.29191.1309907171.divmod.quotient.24266@ohm>

On Wed, 10 Sep 2008 14:01:27 -0700, Alec Matusis <matusis at yahoo.com> wrote:
>> Do non-error log messages continue to appear in the Twisted log?  ie,
>> is
>> it clear that the logging system is still working, or could it have
>> failed
>> in some way, obscuring any exception reports?
>
>Yes, I print the results of garbage collection every 10 min like this:
>
>print "number of objects tracked by the garbage collector is:", len(gc.get_objects())
>
>and they appear in the main twisted log.
>
>2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage collector is: 860021
>2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage collector is: 864316
>
>> Any new unhandled errno values should definitely result in an exception
>> being logged (notice that the `raise which follows the checks for
>> various errno values is inside a try/except which logs any exception).
>
>I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or EPERM?
>
>                except socket.error, e:
>                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
>                        self.numberAccepts = i
>                        break
>                    elif e.args[0] == EPERM:
>                        # Netfilter on Linux may have rejected the
>                        # connection, but we get told to try to accept()
>                        # anyway.
>                        continue
>
>
>I am not sure how to debug this problem- I have another twisted server of a different type on that machine, and while the problematic server stops accepting connections, the second one works just fine, so this is not a machine-wide issue.
>What could it be?

You could try running strace against the server while it's not accepting
connections.  You can limit the output to just accept calls, too:

   strace -p <pid> -etrace=accept

Maybe this will show you that accept calls are happening but failing in
some way.  If it produces no output, you can widen it and see if you can
tell what the server is doing if it isn't calling accept().

Jean-Paul



From matusis at yahoo.com  Wed Sep 10 16:04:40 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Wed, 10 Sep 2008 15:04:40 -0700
Subject: [Twisted-Python] intermittent problem: not
	accepting	new	connections
In-Reply-To: <20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
References: <045201c91388$67f836d0$37e8a470$@com>
	<20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
Message-ID: <048001c91391$3991ec60$acb5c520$@com>

> You could try running strace against the server while it's not
> accepting
> connections.  

I have one short question before I try strace on live:

I have been playing with strace this morning on my dev, and I observe that for every second connection, there are two accept calls, one is success and one is a failure:

1st connection:

accept(9, {sa_family=AF_INET, sin_port=htons(33375), sin_addr=inet_addr("10.14.0.2")}, [16]) = 22
(client disconnects)

2nd connection:
accept(9, {sa_family=AF_INET, sin_port=htons(33519), sin_addr=inet_addr("10.14.0.2")}, [16]) = 22
accept(9, 0xbfaada10, [16])             = -1 EAGAIN (Resource temporarily unavailable)
(client disconnects)

3d connection:
accept(9, {sa_family=AF_INET, sin_port=htons(33375), sin_addr=inet_addr("10.14.0.2")}, [16]) = 22
(client disconnects)

4th connection:
accept(9, {sa_family=AF_INET, sin_port=htons(33519), sin_addr=inet_addr("10.14.0.2")}, [16]) = 22
accept(9, 0xbfaada10, [16])             = -1 EAGAIN (Resource temporarily unavailable)
....
and so on.

What is the meaning of 
accept(9, 0xbfaada10, [16])             = -1 EAGAIN (Resource temporarily unavailable) 
that occurs every second connection?


> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Wednesday, September 10, 2008 2:47 PM
> To: Twisted general discussion
> Subject: RE: [Twisted-Python] intermittent problem: not accepting new
> connections
> 
> On Wed, 10 Sep 2008 14:01:27 -0700, Alec Matusis <matusis at yahoo.com>
> wrote:
> >> Do non-error log messages continue to appear in the Twisted log?
> ie,
> >> is
> >> it clear that the logging system is still working, or could it have
> >> failed
> >> in some way, obscuring any exception reports?
> >
> >Yes, I print the results of garbage collection every 10 min like this:
> >
> >print "number of objects tracked by the garbage collector is:",
> len(gc.get_objects())
> >
> >and they appear in the main twisted log.
> >
> >2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage
> collector is: 860021
> >2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage
> collector is: 864316
> >
> >> Any new unhandled errno values should definitely result in an
> exception
> >> being logged (notice that the `raise which follows the checks for
> >> various errno values is inside a try/except which logs any
> exception).
> >
> >I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or
> EPERM?
> >
> >                except socket.error, e:
> >                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
> >                        self.numberAccepts = i
> >                        break
> >                    elif e.args[0] == EPERM:
> >                        # Netfilter on Linux may have rejected the
> >                        # connection, but we get told to try to
> accept()
> >                        # anyway.
> >                        continue
> >
> >
> >I am not sure how to debug this problem- I have another twisted server
> of a different type on that machine, and while the problematic server
> stops accepting connections, the second one works just fine, so this is
> not a machine-wide issue.
> >What could it be?
> 
> You could try running strace against the server while it's not
> accepting
> connections.  You can limit the output to just accept calls, too:
> 
>    strace -p <pid> -etrace=accept
> 
> Maybe this will show you that accept calls are happening but failing in
> some way.  If it produces no output, you can widen it and see if you
> can
> tell what the server is doing if it isn't calling accept().
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From exarkun at divmod.com  Wed Sep 10 16:16:21 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 10 Sep 2008 18:16:21 -0400
Subject: [Twisted-Python] intermittent problem: not
	accepting	new	connections
In-Reply-To: <048001c91391$3991ec60$acb5c520$@com>
Message-ID: <20080910221621.29191.905092360.divmod.quotient.24276@ohm>

On Wed, 10 Sep 2008 15:04:40 -0700, Alec Matusis <matusis at yahoo.com> wrote:
>> You could try running strace against the server while it's not
>> accepting
>> connections.
>
>I have one short question before I try strace on live:
>
>I have been playing with strace this morning on my dev, and I observe that for every second connection, there are two accept calls, one is success and one is a failure:

I'm pretty sure this is a consequence of a heuristic optimization in the
accept loop.  When one connection is successfully accepted, a counter is
incremented.  Whenever it tries to accept connections, it will try up to
the number of times indicated by the current value of the counter.  When
it fails to get a new connection, it drops the counter to the number of
connections it did accept.  So in a lot of cases, it's flipping back and
forth between 1 and 2 attempts.

The point of this is that if you're receiving lots of connection attempts,
it'd be faster to accept many of them at once instead of only accepting one
each time around the reactor loop.  It's not clear the current implementation
is the best way to implement this optimization, but at least the code is very
old and hasn't changed in quite a while, so it's probably not actually causing
any problems.

Jean-Paul



From matusis at yahoo.com  Wed Sep 10 18:28:07 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Wed, 10 Sep 2008 17:28:07 -0700
Subject: [Twisted-Python] intermittent problem: not
	accepting	new	connections
In-Reply-To: <20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
References: <045201c91388$67f836d0$37e8a470$@com>
	<20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
Message-ID: <04d701c913a5$44074af0$cc15e0d0$@com>

> You could try running strace against the server while it's not
> accepting
> connections.  


It went into this regime again tonight, and I captured strace.

A few remarks first:

The outage was brief, it lasted about 3 min. It did not correspond to the peak number of connections.
The application has several protocols (like manhole and various control ports), that are listening on different ports.
When the server stopped accepting connections on the main port (where external internet clients connect), telnet connection to manhole and control ports are still possible.
Also, I think when it is in this bad state, it does accept some external connections, maybe 50%.

Anyway, here's the strace in the bad state:

accept(9, {sa_family=AF_INET, sin_port=htons(1474), sin_addr=inet_addr("83.153.87.198")}, [13980580626831507472]) = 491
accept(13, {sa_family=AF_INET, sin_port=htons(40953), sin_addr=inet_addr("10.18.2.10")}, [17987095445330984976]) = 491
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(9, {sa_family=AF_INET, sin_port=htons(50679), sin_addr=inet_addr("24.166.18.207")}, [17853676306370134032]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(52873), sin_addr=inet_addr("67.87.61.193")}, [9929874236988456976]) = 493
accept(9, {sa_family=AF_INET, sin_port=htons(54305), sin_addr=inet_addr("200.114.45.212")}, [2437573306904215568]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2246), sin_addr=inet_addr("76.11.66.253")}, [14269655427913351184]) = 491
accept(9, {sa_family=AF_INET, sin_port=htons(32824), sin_addr=inet_addr("75.62.105.81")}, [4071254071732862992]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2262), sin_addr=inet_addr("76.11.66.253")}, [15422576932520198160]) = 491
accept(9, {sa_family=AF_INET, sin_port=htons(3316), sin_addr=inet_addr("24.127.249.90")}, [17585430653564878864]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(4466), sin_addr=inet_addr("72.241.229.233")}, [8219350803517800464]) = 491
accept(9, {sa_family=AF_INET, sin_port=htons(1651), sin_addr=inet_addr("67.82.141.97")}, [8288312172811911184]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2669), sin_addr=inet_addr("24.94.231.135")}, [7857092508491186192]) = 398
accept(9, {sa_family=AF_INET, sin_port=htons(50252), sin_addr=inet_addr("97.119.52.164")}, [5531546250907746320]) = 398
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2675), sin_addr=inet_addr("70.4.222.71")}, [8289438072718753808]) = 398
accept(9, {sa_family=AF_INET, sin_port=htons(63671), sin_addr=inet_addr("69.22.255.174")}, [13256345511754989584]) = 491
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(54520), sin_addr=inet_addr("92.130.148.171")}, [17929956025058721808]) = 491
accept(13, {sa_family=AF_INET, sin_port=htons(41056), sin_addr=inet_addr("10.18.2.10")}, [6962565032504721424]) = 491
accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(49296), sin_addr=inet_addr("66.214.238.42")}, [10430336745580003344]) = 161
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(13, {sa_family=AF_INET, sin_port=htons(41199), sin_addr=inet_addr("10.18.2.10")}, [17266800979928416272]) = 161
accept(9, {sa_family=AF_INET, sin_port=htons(49376), sin_addr=inet_addr("68.34.251.86")}, [16194944268614238224]) = 161
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(13, {sa_family=AF_INET, sin_port=htons(41497), sin_addr=inet_addr("10.18.2.10")}, [1847038805765259280]) = 161
accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(9, {sa_family=AF_INET, sin_port=htons(50013), sin_addr=inet_addr("71.241.76.86")}, [6756243874575810576]) = 161
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
--- SIGCHLD (Child exited) @ 0 (0) ---
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(9, {sa_family=AF_INET, sin_port=htons(2594), sin_addr=inet_addr("24.27.123.223")}, [2452772955646590992]) = 161
accept(9, {sa_family=AF_INET, sin_port=htons(1690), sin_addr=inet_addr("67.242.75.46")}, [11098558340291100688]) = 276
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(41825), sin_addr=inet_addr("10.18.2.10")}, [7035467051472781328]) = 276
accept(13, {sa_family=AF_INET, sin_port=htons(41910), sin_addr=inet_addr("10.18.2.10")}, [13160362544696655888]) = 276



here's the strace in the normal state:


accept(9, {sa_family=AF_INET, sin_port=htons(40442), sin_addr=inet_addr("74.140.139.210")}, [18058590089415491600]) = 2218
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(58477), sin_addr=inet_addr("99.194.115.132")}, [7918454053414109200]) = 431
accept(13, {sa_family=AF_INET, sin_port=htons(50878), sin_addr=inet_addr("10.18.2.10")}, [13746674921184952336]) = 356
accept(9, {sa_family=AF_INET, sin_port=htons(1154), sin_addr=inet_addr("190.37.68.45")}, [9368613133427408912]) = 356
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
--- SIGCHLD (Child exited) @ 0 (0) ---
accept(9, {sa_family=AF_INET, sin_port=htons(1212), sin_addr=inet_addr("125.60.240.211")}, [13547953587627229200]) = 356
accept(9, {sa_family=AF_INET, sin_port=htons(1158), sin_addr=inet_addr("190.37.68.45")}, [9656843509579120656]) = 2223
accept(9, {sa_family=AF_INET, sin_port=htons(52008), sin_addr=inet_addr("24.189.205.204")}, [2939443190379315216]) = 2224
accept(9, {sa_family=AF_INET, sin_port=htons(50808), sin_addr=inet_addr("72.155.68.155")}, [8702643338529996816]) = 2253
accept(9, {sa_family=AF_INET, sin_port=htons(2545), sin_addr=inet_addr("24.10.61.223")}, [17368413446520963088]) = 2263
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2547), sin_addr=inet_addr("24.10.61.223")}, [17512528634596818960]) = 356
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(52012), sin_addr=inet_addr("24.189.205.204")}, [3227673566531026960]) = 180
accept(9, {sa_family=AF_INET, sin_port=htons(50809), sin_addr=inet_addr("72.155.68.155")}, [8774700932567924752]) = 2224
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1223), sin_addr=inet_addr("125.60.240.211")}, [14340587122044436496]) = 2253
accept(9, {sa_family=AF_INET, sin_port=htons(2462), sin_addr=inet_addr("206.74.170.35")}, [11387633141372944400]) = 2263
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2464), sin_addr=inet_addr("206.74.170.35")}, [11531748329448800272]) = 2263
accept(9, {sa_family=AF_INET, sin_port=htons(1645), sin_addr=inet_addr("61.145.215.253")}, [7855966608584343568]) = 2224
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(4172), sin_addr=inet_addr("68.188.149.222")}, [5480880755099828240]) = 1283
accept(9, {sa_family=AF_INET, sin_port=htons(50931), sin_addr=inet_addr("70.129.57.218")}, [17565727405195132944]) = 1283
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(4173), sin_addr=inet_addr("68.188.149.222")}, [5552938349137756176]) = 2224
accept(9, {sa_family=AF_INET, sin_port=htons(1122), sin_addr=inet_addr("76.127.204.185")}, [7062770124213714960]) = 1283
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(51062), sin_addr=inet_addr("10.18.2.10")}, [8558809625430851600]) = 2292
accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1646), sin_addr=inet_addr("61.145.215.253")}, [7928024202622271504]) = 2292
accept(9, {sa_family=AF_INET, sin_port=htons(50932), sin_addr=inet_addr("70.129.57.218")}, [17637784999233060880]) = 2310
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(4001), sin_addr=inet_addr("99.13.103.221")}, [11605494773346992144]) = 507
accept(9, {sa_family=AF_INET, sin_port=htons(4004), sin_addr=inet_addr("99.13.103.221")}, [11821667555460775952]) = 507
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1131), sin_addr=inet_addr("76.127.204.185")}, [7711288470555066384]) = 1283
accept(9, {sa_family=AF_INET, sin_port=htons(2143), sin_addr=inet_addr("202.156.50.129")}, [6847723242006773776]) = 1894
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(2146), sin_addr=inet_addr("202.156.50.129")}, [7063896024120557584]) = 1894
accept(9, {sa_family=AF_INET, sin_port=htons(1779), sin_addr=inet_addr("222.165.66.136")}, [17511684209666686992]) = 1278
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(61674), sin_addr=inet_addr("99.230.169.52")}, [16929031007875629072]) = 1278
accept(9, {sa_family=AF_INET, sin_port=htons(61679), sin_addr=inet_addr("99.230.169.52")}, [17289318978065268752]) = 1278
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1780), sin_addr=inet_addr("222.165.66.136")}, [17583741803704614928]) = 1913
accept(9, {sa_family=AF_INET, sin_port=htons(52495), sin_addr=inet_addr("190.40.52.74")}, [1138566289384538128]) = 2310
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(51181), sin_addr=inet_addr("10.18.2.10")}, [17133663315944275984]) = 2310
accept(9, {sa_family=AF_INET, sin_port=htons(60995), sin_addr=inet_addr("88.105.44.33")}, [4894849853588242448]) = 2310
accept(9, {sa_family=AF_INET, sin_port=htons(3636), sin_addr=inet_addr("71.64.15.79")}, [3750935548236136464]) = 2310
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(51273), sin_addr=inet_addr("10.18.2.10")}, [5316499368700805136]) = 2334
accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(52498), sin_addr=inet_addr("190.40.52.74")}, [1354739071498321936]) = 2334
accept(9, {sa_family=AF_INET, sin_port=htons(1440), sin_addr=inet_addr("24.21.117.196")}, [11530622429541957648]) = 2334
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(9, {sa_family=AF_INET, sin_port=htons(1442), sin_addr=inet_addr("24.21.117.196")}, [11674737617617813520]) = 2334
accept(9, {sa_family=AF_INET, sin_port=htons(60996), sin_addr=inet_addr("88.105.44.33")}, [4966907447626170384]) = 2336
accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
accept(13, {sa_family=AF_INET, sin_port=htons(51345), sin_addr=inet_addr("10.18.2.10")}, [10504646139431616528]) = 2337
accept(13, {sa_family=AF_INET, sin_port=htons(51348), sin_addr=inet_addr("10.18.2.10")}, [10720818921545400336]) = 2337

The only noticeable difference is the frequency of 
--- SIGCHLD (Child exited) @ 0 (0) ---
but it occurred in the normal state as well.
The server sends emails via child subprocesses, so I suspect Child exited may be due to that.

If that's the case, the strace output is identical, and I do not understand what's causing the problem at all.


> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Wednesday, September 10, 2008 2:47 PM
> To: Twisted general discussion
> Subject: RE: [Twisted-Python] intermittent problem: not accepting new
> connections
> 
> On Wed, 10 Sep 2008 14:01:27 -0700, Alec Matusis <matusis at yahoo.com>
> wrote:
> >> Do non-error log messages continue to appear in the Twisted log?
> ie,
> >> is
> >> it clear that the logging system is still working, or could it have
> >> failed
> >> in some way, obscuring any exception reports?
> >
> >Yes, I print the results of garbage collection every 10 min like this:
> >
> >print "number of objects tracked by the garbage collector is:",
> len(gc.get_objects())
> >
> >and they appear in the main twisted log.
> >
> >2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage
> collector is: 860021
> >2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage
> collector is: 864316
> >
> >> Any new unhandled errno values should definitely result in an
> exception
> >> being logged (notice that the `raise which follows the checks for
> >> various errno values is inside a try/except which logs any
> exception).
> >
> >I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or
> EPERM?
> >
> >                except socket.error, e:
> >                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
> >                        self.numberAccepts = i
> >                        break
> >                    elif e.args[0] == EPERM:
> >                        # Netfilter on Linux may have rejected the
> >                        # connection, but we get told to try to
> accept()
> >                        # anyway.
> >                        continue
> >
> >
> >I am not sure how to debug this problem- I have another twisted server
> of a different type on that machine, and while the problematic server
> stops accepting connections, the second one works just fine, so this is
> not a machine-wide issue.
> >What could it be?
> 
> You could try running strace against the server while it's not
> accepting
> connections.  You can limit the output to just accept calls, too:
> 
>    strace -p <pid> -etrace=accept
> 
> Maybe this will show you that accept calls are happening but failing in
> some way.  If it produces no output, you can widen it and see if you
> can
> tell what the server is doing if it isn't calling accept().
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From wthie at thiengineering.ch  Thu Sep 11 04:23:10 2008
From: wthie at thiengineering.ch (Werner Thie)
Date: Thu, 11 Sep 2008 12:23:10 +0200
Subject: [Twisted-Python] intermittent problem:
	not	accepting	new	connections
In-Reply-To: <04d701c913a5$44074af0$cc15e0d0$@com>
References: <045201c91388$67f836d0$37e8a470$@com>	<20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
	<04d701c913a5$44074af0$cc15e0d0$@com>
Message-ID: <48C8F18E.8090807@thiengineering.ch>

Hi Alec

just wondering...

How does netstat look like?

We ran into problems resource wise with the number of open connections 
aka file descriptors per process and observed similar problems to yours, 
also by switching to a new server.

How does ulimit -a compare between old and new machine?

HTH, Werner

Alec Matusis wrote:
>> You could try running strace against the server while it's not
>> accepting
>> connections.  
> 
> 
> It went into this regime again tonight, and I captured strace.
> 
> A few remarks first:
> 
> The outage was brief, it lasted about 3 min. It did not correspond to the peak number of connections.
> The application has several protocols (like manhole and various control ports), that are listening on different ports.
> When the server stopped accepting connections on the main port (where external internet clients connect), telnet connection to manhole and control ports are still possible.
> Also, I think when it is in this bad state, it does accept some external connections, maybe 50%.
> 
> Anyway, here's the strace in the bad state:
> 
> accept(9, {sa_family=AF_INET, sin_port=htons(1474), sin_addr=inet_addr("83.153.87.198")}, [13980580626831507472]) = 491
> accept(13, {sa_family=AF_INET, sin_port=htons(40953), sin_addr=inet_addr("10.18.2.10")}, [17987095445330984976]) = 491
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(9, {sa_family=AF_INET, sin_port=htons(50679), sin_addr=inet_addr("24.166.18.207")}, [17853676306370134032]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(52873), sin_addr=inet_addr("67.87.61.193")}, [9929874236988456976]) = 493
> accept(9, {sa_family=AF_INET, sin_port=htons(54305), sin_addr=inet_addr("200.114.45.212")}, [2437573306904215568]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2246), sin_addr=inet_addr("76.11.66.253")}, [14269655427913351184]) = 491
> accept(9, {sa_family=AF_INET, sin_port=htons(32824), sin_addr=inet_addr("75.62.105.81")}, [4071254071732862992]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2262), sin_addr=inet_addr("76.11.66.253")}, [15422576932520198160]) = 491
> accept(9, {sa_family=AF_INET, sin_port=htons(3316), sin_addr=inet_addr("24.127.249.90")}, [17585430653564878864]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(4466), sin_addr=inet_addr("72.241.229.233")}, [8219350803517800464]) = 491
> accept(9, {sa_family=AF_INET, sin_port=htons(1651), sin_addr=inet_addr("67.82.141.97")}, [8288312172811911184]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2669), sin_addr=inet_addr("24.94.231.135")}, [7857092508491186192]) = 398
> accept(9, {sa_family=AF_INET, sin_port=htons(50252), sin_addr=inet_addr("97.119.52.164")}, [5531546250907746320]) = 398
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2675), sin_addr=inet_addr("70.4.222.71")}, [8289438072718753808]) = 398
> accept(9, {sa_family=AF_INET, sin_port=htons(63671), sin_addr=inet_addr("69.22.255.174")}, [13256345511754989584]) = 491
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(54520), sin_addr=inet_addr("92.130.148.171")}, [17929956025058721808]) = 491
> accept(13, {sa_family=AF_INET, sin_port=htons(41056), sin_addr=inet_addr("10.18.2.10")}, [6962565032504721424]) = 491
> accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(49296), sin_addr=inet_addr("66.214.238.42")}, [10430336745580003344]) = 161
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(13, {sa_family=AF_INET, sin_port=htons(41199), sin_addr=inet_addr("10.18.2.10")}, [17266800979928416272]) = 161
> accept(9, {sa_family=AF_INET, sin_port=htons(49376), sin_addr=inet_addr("68.34.251.86")}, [16194944268614238224]) = 161
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(13, {sa_family=AF_INET, sin_port=htons(41497), sin_addr=inet_addr("10.18.2.10")}, [1847038805765259280]) = 161
> accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(9, {sa_family=AF_INET, sin_port=htons(50013), sin_addr=inet_addr("71.241.76.86")}, [6756243874575810576]) = 161
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> --- SIGCHLD (Child exited) @ 0 (0) ---
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(9, {sa_family=AF_INET, sin_port=htons(2594), sin_addr=inet_addr("24.27.123.223")}, [2452772955646590992]) = 161
> accept(9, {sa_family=AF_INET, sin_port=htons(1690), sin_addr=inet_addr("67.242.75.46")}, [11098558340291100688]) = 276
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(41825), sin_addr=inet_addr("10.18.2.10")}, [7035467051472781328]) = 276
> accept(13, {sa_family=AF_INET, sin_port=htons(41910), sin_addr=inet_addr("10.18.2.10")}, [13160362544696655888]) = 276
> 
> 
> 
> here's the strace in the normal state:
> 
> 
> accept(9, {sa_family=AF_INET, sin_port=htons(40442), sin_addr=inet_addr("74.140.139.210")}, [18058590089415491600]) = 2218
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(58477), sin_addr=inet_addr("99.194.115.132")}, [7918454053414109200]) = 431
> accept(13, {sa_family=AF_INET, sin_port=htons(50878), sin_addr=inet_addr("10.18.2.10")}, [13746674921184952336]) = 356
> accept(9, {sa_family=AF_INET, sin_port=htons(1154), sin_addr=inet_addr("190.37.68.45")}, [9368613133427408912]) = 356
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> --- SIGCHLD (Child exited) @ 0 (0) ---
> accept(9, {sa_family=AF_INET, sin_port=htons(1212), sin_addr=inet_addr("125.60.240.211")}, [13547953587627229200]) = 356
> accept(9, {sa_family=AF_INET, sin_port=htons(1158), sin_addr=inet_addr("190.37.68.45")}, [9656843509579120656]) = 2223
> accept(9, {sa_family=AF_INET, sin_port=htons(52008), sin_addr=inet_addr("24.189.205.204")}, [2939443190379315216]) = 2224
> accept(9, {sa_family=AF_INET, sin_port=htons(50808), sin_addr=inet_addr("72.155.68.155")}, [8702643338529996816]) = 2253
> accept(9, {sa_family=AF_INET, sin_port=htons(2545), sin_addr=inet_addr("24.10.61.223")}, [17368413446520963088]) = 2263
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2547), sin_addr=inet_addr("24.10.61.223")}, [17512528634596818960]) = 356
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(52012), sin_addr=inet_addr("24.189.205.204")}, [3227673566531026960]) = 180
> accept(9, {sa_family=AF_INET, sin_port=htons(50809), sin_addr=inet_addr("72.155.68.155")}, [8774700932567924752]) = 2224
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1223), sin_addr=inet_addr("125.60.240.211")}, [14340587122044436496]) = 2253
> accept(9, {sa_family=AF_INET, sin_port=htons(2462), sin_addr=inet_addr("206.74.170.35")}, [11387633141372944400]) = 2263
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2464), sin_addr=inet_addr("206.74.170.35")}, [11531748329448800272]) = 2263
> accept(9, {sa_family=AF_INET, sin_port=htons(1645), sin_addr=inet_addr("61.145.215.253")}, [7855966608584343568]) = 2224
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(4172), sin_addr=inet_addr("68.188.149.222")}, [5480880755099828240]) = 1283
> accept(9, {sa_family=AF_INET, sin_port=htons(50931), sin_addr=inet_addr("70.129.57.218")}, [17565727405195132944]) = 1283
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(4173), sin_addr=inet_addr("68.188.149.222")}, [5552938349137756176]) = 2224
> accept(9, {sa_family=AF_INET, sin_port=htons(1122), sin_addr=inet_addr("76.127.204.185")}, [7062770124213714960]) = 1283
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(51062), sin_addr=inet_addr("10.18.2.10")}, [8558809625430851600]) = 2292
> accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1646), sin_addr=inet_addr("61.145.215.253")}, [7928024202622271504]) = 2292
> accept(9, {sa_family=AF_INET, sin_port=htons(50932), sin_addr=inet_addr("70.129.57.218")}, [17637784999233060880]) = 2310
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(4001), sin_addr=inet_addr("99.13.103.221")}, [11605494773346992144]) = 507
> accept(9, {sa_family=AF_INET, sin_port=htons(4004), sin_addr=inet_addr("99.13.103.221")}, [11821667555460775952]) = 507
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1131), sin_addr=inet_addr("76.127.204.185")}, [7711288470555066384]) = 1283
> accept(9, {sa_family=AF_INET, sin_port=htons(2143), sin_addr=inet_addr("202.156.50.129")}, [6847723242006773776]) = 1894
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(2146), sin_addr=inet_addr("202.156.50.129")}, [7063896024120557584]) = 1894
> accept(9, {sa_family=AF_INET, sin_port=htons(1779), sin_addr=inet_addr("222.165.66.136")}, [17511684209666686992]) = 1278
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(61674), sin_addr=inet_addr("99.230.169.52")}, [16929031007875629072]) = 1278
> accept(9, {sa_family=AF_INET, sin_port=htons(61679), sin_addr=inet_addr("99.230.169.52")}, [17289318978065268752]) = 1278
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1780), sin_addr=inet_addr("222.165.66.136")}, [17583741803704614928]) = 1913
> accept(9, {sa_family=AF_INET, sin_port=htons(52495), sin_addr=inet_addr("190.40.52.74")}, [1138566289384538128]) = 2310
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(51181), sin_addr=inet_addr("10.18.2.10")}, [17133663315944275984]) = 2310
> accept(9, {sa_family=AF_INET, sin_port=htons(60995), sin_addr=inet_addr("88.105.44.33")}, [4894849853588242448]) = 2310
> accept(9, {sa_family=AF_INET, sin_port=htons(3636), sin_addr=inet_addr("71.64.15.79")}, [3750935548236136464]) = 2310
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(51273), sin_addr=inet_addr("10.18.2.10")}, [5316499368700805136]) = 2334
> accept(13, 0x7fffc3d5ca30, [16])        = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(52498), sin_addr=inet_addr("190.40.52.74")}, [1354739071498321936]) = 2334
> accept(9, {sa_family=AF_INET, sin_port=htons(1440), sin_addr=inet_addr("24.21.117.196")}, [11530622429541957648]) = 2334
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(9, {sa_family=AF_INET, sin_port=htons(1442), sin_addr=inet_addr("24.21.117.196")}, [11674737617617813520]) = 2334
> accept(9, {sa_family=AF_INET, sin_port=htons(60996), sin_addr=inet_addr("88.105.44.33")}, [4966907447626170384]) = 2336
> accept(9, 0x7fffc3d5ca30, [16])         = -1 EAGAIN (Resource temporarily unavailable)
> accept(13, {sa_family=AF_INET, sin_port=htons(51345), sin_addr=inet_addr("10.18.2.10")}, [10504646139431616528]) = 2337
> accept(13, {sa_family=AF_INET, sin_port=htons(51348), sin_addr=inet_addr("10.18.2.10")}, [10720818921545400336]) = 2337
> 
> The only noticeable difference is the frequency of 
> --- SIGCHLD (Child exited) @ 0 (0) ---
> but it occurred in the normal state as well.
> The server sends emails via child subprocesses, so I suspect Child exited may be due to that.
> 
> If that's the case, the strace output is identical, and I do not understand what's causing the problem at all.
> 
> 
>> -----Original Message-----
>> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
>> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
>> Sent: Wednesday, September 10, 2008 2:47 PM
>> To: Twisted general discussion
>> Subject: RE: [Twisted-Python] intermittent problem: not accepting new
>> connections
>>
>> On Wed, 10 Sep 2008 14:01:27 -0700, Alec Matusis <matusis at yahoo.com>
>> wrote:
>>>> Do non-error log messages continue to appear in the Twisted log?
>> ie,
>>>> is
>>>> it clear that the logging system is still working, or could it have
>>>> failed
>>>> in some way, obscuring any exception reports?
>>> Yes, I print the results of garbage collection every 10 min like this:
>>>
>>> print "number of objects tracked by the garbage collector is:",
>> len(gc.get_objects())
>>> and they appear in the main twisted log.
>>>
>>> 2008/09/10 13:21 -0700 [-] number of objects tracked by the garbage
>> collector is: 860021
>>> 2008/09/10 13:31 -0700 [-] number of objects tracked by the garbage
>> collector is: 864316
>>>> Any new unhandled errno values should definitely result in an
>> exception
>>>> being logged (notice that the `raise which follows the checks for
>>>> various errno values is inside a try/except which logs any
>> exception).
>>> I noticed that raise too... Could it then be EWOULDBLOCK, EAGAIN or
>> EPERM?
>>>                except socket.error, e:
>>>                    if e.args[0] in (EWOULDBLOCK, EAGAIN):
>>>                        self.numberAccepts = i
>>>                        break
>>>                    elif e.args[0] == EPERM:
>>>                        # Netfilter on Linux may have rejected the
>>>                        # connection, but we get told to try to
>> accept()
>>>                        # anyway.
>>>                        continue
>>>
>>>
>>> I am not sure how to debug this problem- I have another twisted server
>> of a different type on that machine, and while the problematic server
>> stops accepting connections, the second one works just fine, so this is
>> not a machine-wide issue.
>>> What could it be?
>> You could try running strace against the server while it's not
>> accepting
>> connections.  You can limit the output to just accept calls, too:
>>
>>    strace -p <pid> -etrace=accept
>>
>> Maybe this will show you that accept calls are happening but failing in
>> some way.  If it produces no output, you can widen it and see if you
>> can
>> tell what the server is doing if it isn't calling accept().
>>
>> Jean-Paul
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



From paul.nendick at gmail.com  Thu Sep 11 07:31:38 2008
From: paul.nendick at gmail.com (Paul C. Nendick)
Date: Thu, 11 Sep 2008 14:31:38 +0100
Subject: [Twisted-Python] intermittent problem: not accepting new
	connections
In-Reply-To: <48C8F18E.8090807@thiengineering.ch>
References: <045201c91388$67f836d0$37e8a470$@com>
	<20080910214640.29191.1309907171.divmod.quotient.24266@ohm>
	<04d701c913a5$44074af0$cc15e0d0$@com>
	<48C8F18E.8090807@thiengineering.ch>
Message-ID: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>

Not necessarily related to what you've described, but I'll share
something that's helped a good deal on my most-heavily hit twisted
servers. Presuming you're using Linux:

 echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle


from http://lartc.org/howto/lartc.kernel.obscure.html :

"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
should not be changed without advice/request of technical experts"

My expert advice: only use this on machines connected on a low-latency
LAN. It *will* break internet-facing interfaces. It halves the
constant used by the Nagle algorithm:

http://en.wikipedia.org/wiki/Nagle's_algorithm

Kind regards,

/p



From exarkun at divmod.com  Thu Sep 11 07:46:51 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 11 Sep 2008 09:46:51 -0400
Subject: [Twisted-Python] intermittent problem: not accepting new
	connections
In-Reply-To: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>
Message-ID: <20080911134651.29191.1030196475.divmod.quotient.24599@ohm>

On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick" <paul.nendick at gmail.com> wrote:
>Not necessarily related to what you've described, but I'll share
>something that's helped a good deal on my most-heavily hit twisted
>servers. Presuming you're using Linux:
>
> echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
>
>
>from http://lartc.org/howto/lartc.kernel.obscure.html :
>
>"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
>should not be changed without advice/request of technical experts"
>
>My expert advice: only use this on machines connected on a low-latency
>LAN. It *will* break internet-facing interfaces. It halves the
>constant used by the Nagle algorithm:
>
>http://en.wikipedia.org/wiki/Nagle's_algorithm
>

This is somewhat interesting.  It suggests a potential problem which
I hadn't thought about before.  If you need to accept more than about
64k connections (not necessarily concurrent) in less than TIME-WAIT
seconds, you might run out of ports.  Anyone know what happens to new
connection attempts to a server in this condition?

Alec, any idea if your server could be getting into this state every
once in a while?  This is an appealing hypothesis, since it wouldn't
necessarily happen at peak connection time (but potentially shortly
after a peak), would resolve itself given a short period of time,
wouldn't necessarily prevent all new connection attempts, since old
TIME-WAIT sockets would be gradually timing out (so your other low-
volume servers might still appear to be working normally), wouldn't
interfere with already established connections, and might not change
the userspace-visible syscall behavior (depending on what Linux does
in this case, but I wouldn't be surprised if connection failures due
to this never showed up in an accept(2) result).

Jean-Paul



From p.mayers at imperial.ac.uk  Thu Sep 11 08:38:06 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Thu, 11 Sep 2008 15:38:06 +0100
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
References: <20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
Message-ID: <48C92D4E.4050301@imperial.ac.uk>

Jean-Paul Calderone wrote:
> On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick" 
> <paul.nendick at gmail.com> wrote:
>> Not necessarily related to what you've described, but I'll share
>> something that's helped a good deal on my most-heavily hit twisted
>> servers. Presuming you're using Linux:
>>
>> echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
>>
>>
>> from http://lartc.org/howto/lartc.kernel.obscure.html :
>>
>> "Enable fast recycling TIME-WAIT sockets. Default value is 1. It
>> should not be changed without advice/request of technical experts"
>>
>> My expert advice: only use this on machines connected on a low-latency
>> LAN. It *will* break internet-facing interfaces. It halves the
>> constant used by the Nagle algorithm:
>>
>> http://en.wikipedia.org/wiki/Nagle's_algorithm
>>
> 
> This is somewhat interesting.  It suggests a potential problem which
> I hadn't thought about before.  If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports.  Anyone know what happens to new
> connection attempts to a server in this condition?

Why would you run out of ports? accept()ed sockets use the same port as 
the listen()ing socket.

Shortening TIME_WAIT just saves on kernel memory.



From exarkun at divmod.com  Thu Sep 11 08:44:36 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 11 Sep 2008 10:44:36 -0400
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <48C92D4E.4050301@imperial.ac.uk>
Message-ID: <20080911144436.29191.1117458156.divmod.quotient.24620@ohm>

On Thu, 11 Sep 2008 15:38:06 +0100, Phil Mayers <p.mayers at imperial.ac.uk> wrote:
>Jean-Paul Calderone wrote:
>>On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick" 
>><paul.nendick at gmail.com> wrote:
>>>Not necessarily related to what you've described, but I'll share
>>>something that's helped a good deal on my most-heavily hit twisted
>>>servers. Presuming you're using Linux:
>>>
>>>echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
>>>
>>>
>>>from http://lartc.org/howto/lartc.kernel.obscure.html :
>>>
>>>"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
>>>should not be changed without advice/request of technical experts"
>>>
>>>My expert advice: only use this on machines connected on a low-latency
>>>LAN. It *will* break internet-facing interfaces. It halves the
>>>constant used by the Nagle algorithm:
>>>
>>>http://en.wikipedia.org/wiki/Nagle's_algorithm
>>
>>This is somewhat interesting.  It suggests a potential problem which
>>I hadn't thought about before.  If you need to accept more than about
>>64k connections (not necessarily concurrent) in less than TIME-WAIT
>>seconds, you might run out of ports.  Anyone know what happens to new
>>connection attempts to a server in this condition?
>
>Why would you run out of ports? accept()ed sockets use the same port as the 
>listen()ing socket.

Uh yes, I guess that would be a fatal flaw in this hypothesis.  Woops. :)

Jean-Paul



From matusis at yahoo.com  Thu Sep 11 13:57:51 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Thu, 11 Sep 2008 12:57:51 -0700
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
References: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>
	<20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
Message-ID: <06c801c91448$b1a8f290$14fad7b0$@com>

> How does ulimit -a compare between old and new machine?

ulimit is only higher on the new machine, I upped it. Also, from my
experience, running into  ulimits produces log messages. 

alecm at serv2 ~> cat /proc/23678/limits 

Limit                     Soft Limit           Hard Limit           Units

Max cpu time              unlimited            unlimited            ms

Max file size             unlimited            unlimited            bytes

Max data size             unlimited            unlimited            bytes

Max stack size            8388608              unlimited            bytes

Max core file size        0                    unlimited            bytes

Max resident set          1073741824           1073741824           bytes

Max processes             126976               126976
processes 
Max open files            25000                25000                files

Max locked memory         32768                32768                bytes

Max address space         unlimited            unlimited            bytes

Max file locks            unlimited            unlimited            locks

Max pending signals       126976               126976               signals

Max msgqueue size         819200               819200               bytes

Max nice priority         0                    0                    
Max realtime priority     0                    0                    


> If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports.  

> How does netstat look like?

I have to wait for another outage tonight, to get more definite results on
this.
So far, I have had only one very brief outage at 7:46am
I was asleep, but I have some new data logged.
I have two servers, one on port 5222 (problematic one, let's call it serv1
), and one on 5228 (that has no problems, call it serv2 ).
I made a script that measures the number of connections on each type of
server respectively like this:

while [ 1 ]
do
 sleep 5
 netstat -ant | grep ESTABLISHED | awk '/:5228 /{a += 1}/:5222 /{b += 1} END
{print strftime(" %d %b %Y %H:%M:%S", systime(
))"   serv2: "a"   serv1: "b" total: "a+b }'
done

This is what happened around 7:46am (lines that have "+" in front indicate
anomaly):

 11 Sep 2008 07:41:29   serv2: 2756   serv1: 1064 total: 3820
 11 Sep 2008 07:41:36   serv2: 2764   serv1: 1062 total: 3826
 11 Sep 2008 07:41:44   serv2: 2784   serv1: 1049 total: 3833
 11 Sep 2008 07:41:51   serv2: 2756   serv1: 1055 total: 3811
 11 Sep 2008 07:41:59   serv2: 2760   serv1: 1066 total: 3826
 11 Sep 2008 07:42:06   serv2: 2777   serv1: 1050 total: 3827
 11 Sep 2008 07:42:14   serv2: 2769   serv1: 1054 total: 3823
 11 Sep 2008 07:42:21   serv2: 2751   serv1: 1055 total: 3806
 11 Sep 2008 07:42:29   serv2: 2760   serv1: 1050 total: 3810
 11 Sep 2008 07:42:36   serv2: 2747   serv1: 1040 total: 3787
 11 Sep 2008 07:42:44   serv2: 2737   serv1: 1046 total: 3783
 11 Sep 2008 07:42:51   serv2: 2739   serv1: 1046 total: 3785
 11 Sep 2008 07:42:59   serv2: 2743   serv1: 1037 total: 3780
 11 Sep 2008 07:43:07   serv2: 2720   serv1: 1041 total: 3761
 11 Sep 2008 07:43:14   serv2: 2714   serv1: 1047 total: 3761
 11 Sep 2008 07:43:22   serv2: 2721   serv1: 1045 total: 3766
 11 Sep 2008 07:43:29   serv2: 2697   serv1: 1056 total: 3753
 11 Sep 2008 07:43:37   serv2: 2710   serv1: 1059 total: 3769
+11 Sep 2008 07:43:44   serv2: 2765   serv1: 1304 total: 4069
+11 Sep 2008 07:43:53   serv2: 2854   serv1: 1904 total: 4758
+11 Sep 2008 07:44:01   serv2: 2714   serv1: 2190 total: 4904
+11 Sep 2008 07:44:09   serv2: 2715   serv1: 2202 total: 4917
+11 Sep 2008 07:44:17   serv2: 2779   serv1: 1891 total: 4670
+11 Sep 2008 07:44:26   serv2: 2812   serv1: 2284 total: 5096
+11 Sep 2008 07:44:36   serv2: 2828   serv1: 3496 total: 6324
+11 Sep 2008 07:44:46   serv2: 2715   serv1: 4327 total: 7042
+11 Sep 2008 07:44:56   serv2: 2638   serv1: 3499 total: 6137
+11 Sep 2008 07:45:05   serv2: 2714   serv1: 2396 total: 5110
+11 Sep 2008 07:45:15   serv2: 2776   serv1: 1464 total: 4240
+11 Sep 2008 07:45:25   serv2: 2728   serv1: 1604 total: 4332
+11 Sep 2008 07:45:35   serv2: 2708   serv1: 1566 total: 4274
+11 Sep 2008 07:45:45   serv2: 2750   serv1: 1680 total: 4430
+11 Sep 2008 07:45:54   serv2: 2755   serv1: 1311 total: 4066
+11 Sep 2008 07:46:04   serv2: 2704   serv1: 1178 total: 3882
 11 Sep 2008 07:46:13   serv2: 2644   serv1: 1024 total: 3668
 11 Sep 2008 07:46:22   serv2: 2573   serv1: 981 total: 3554
 11 Sep 2008 07:46:30   serv2: 2739   serv1: 1051 total: 3790
 11 Sep 2008 07:46:39   serv2: 2773   serv1: 1043 total: 3816
 11 Sep 2008 07:46:46   serv2: 2548   serv1: 959 total: 3507
 11 Sep 2008 07:46:54   serv2: 2773   serv1: 1044 total: 3817
 11 Sep 2008 07:47:02   serv2: 2745   serv1: 1027 total: 3772
 11 Sep 2008 07:47:10   serv2: 2591   serv1: 960 total: 3551
 11 Sep 2008 07:47:17   serv2: 2721   serv1: 1002 total: 3723
 11 Sep 2008 07:47:25   serv2: 2753   serv1: 1030 total: 3783
 11 Sep 2008 07:47:32   serv2: 2773   serv1: 1029 total: 3802
 11 Sep 2008 07:47:40   serv2: 2768   serv1: 1025 total: 3793
 11 Sep 2008 07:47:47   serv2: 2764   serv1: 1021 total: 3785
 11 Sep 2008 07:47:55   serv2: 2750   serv1: 1021 total: 3771


Each server also reports the maximum numbers of authenticated connected
clients to the database.
Even though serv1 peaked at 07:44:46  at 4327 "ESTABLISHED" connections, the
number of normally authenticated clients in the database for this time
period is only 1100, which does not reflect this weird connections spike. 
Since I was asleep at 7:46am, I did not have a chance to investigate what
those connections actually were.

> Anyone know what happens to new
> connection attempts to a server in this condition?

One thing that I noticed yesterday, that when server was in this condition,
telnet simply hang, as if no ACK packet was received back:

alecm at serv2 ~> telnet localhost 5222
Trying 127.0.0.1...

and nothing

This behavior or telnet seems to be unique to the case when ACK is not
received in the handshake, I verified that with tcpdump. To contrast that,
if nothing listens on the destination port for example, telnet gives:

alecm at serv2 ~> telnet localhost 50007
Trying 127.0.0.1...
telnet: connect to address 127.0.0.1: Connection refused
telnet: Unable to connect to remote host: Connection refused

which corresponds to RST packet that kernel returns in that case.
I tried to write a 5 line mucked up server with accept() not returning any
packets, and failed.

> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Thursday, September 11, 2008 6:47 AM
> To: Twisted general discussion
> Subject: Re: [Twisted-Python] intermittent problem: not accepting new
> connections
> 
> On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick"
> <paul.nendick at gmail.com> wrote:
> >Not necessarily related to what you've described, but I'll share
> >something that's helped a good deal on my most-heavily hit twisted
> >servers. Presuming you're using Linux:
> >
> > echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
> >
> >
> >from http://lartc.org/howto/lartc.kernel.obscure.html :
> >
> >"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
> >should not be changed without advice/request of technical experts"
> >
> >My expert advice: only use this on machines connected on a low-latency
> >LAN. It *will* break internet-facing interfaces. It halves the
> >constant used by the Nagle algorithm:
> >
> >http://en.wikipedia.org/wiki/Nagle's_algorithm
> >
> 
> This is somewhat interesting.  It suggests a potential problem which
> I hadn't thought about before.  If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports.  Anyone know what happens to new
> connection attempts to a server in this condition?
> 
> Alec, any idea if your server could be getting into this state every
> once in a while?  This is an appealing hypothesis, since it wouldn't
> necessarily happen at peak connection time (but potentially shortly
> after a peak), would resolve itself given a short period of time,
> wouldn't necessarily prevent all new connection attempts, since old
> TIME-WAIT sockets would be gradually timing out (so your other low-
> volume servers might still appear to be working normally), wouldn't
> interfere with already established connections, and might not change
> the userspace-visible syscall behavior (depending on what Linux does
> in this case, but I wouldn't be surprised if connection failures due
> to this never showed up in an accept(2) result).
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From adelagon at gmail.com  Thu Sep 11 19:17:13 2008
From: adelagon at gmail.com (Alvin Delagon)
Date: Fri, 12 Sep 2008 09:17:13 +0800
Subject: [Twisted-Python] intermittent problem: not accepting new
	connections
In-Reply-To: <06c801c91448$b1a8f290$14fad7b0$@com>
References: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>
	<20080911134651.29191.1030196475.divmod.quotient.24599@ohm>
	<06c801c91448$b1a8f290$14fad7b0$@com>
Message-ID: <7a01f6c00809111817v609ff43kede137ed7ab900a5@mail.gmail.com>

We had a similar problem like this, might as well share it with you guys:

Our Jabber server stopped taking in new connections due to our iptables at
some point in time (even lost some packets). We have an ip routing scheme
where ports 25,80,5223,10873 routed to 5222. Whenever this happens, we get
error error from our syslogs:

""ip_conntrack: table full, dropping packet"

http://support.imagestream.com/Resolving_ip_conntrack_table_full_Errors.html

Might as well check dmesg if you have something like this. What we did is
disable iptables and removed its kernel modules.

On Fri, Sep 12, 2008 at 3:57 AM, Alec Matusis <matusis at yahoo.com> wrote:

> > How does ulimit -a compare between old and new machine?
>
> ulimit is only higher on the new machine, I upped it. Also, from my
> experience, running into  ulimits produces log messages.
>
> alecm at serv2 ~> cat /proc/23678/limits
>
> Limit                     Soft Limit           Hard Limit           Units
>
> Max cpu time              unlimited            unlimited            ms
>
> Max file size             unlimited            unlimited            bytes
>
> Max data size             unlimited            unlimited            bytes
>
> Max stack size            8388608              unlimited            bytes
>
> Max core file size        0                    unlimited            bytes
>
> Max resident set          1073741824           1073741824           bytes
>
> Max processes             126976               126976
> processes
> Max open files            25000                25000                files
>
> Max locked memory         32768                32768                bytes
>
> Max address space         unlimited            unlimited            bytes
>
> Max file locks            unlimited            unlimited            locks
>
> Max pending signals       126976               126976               signals
>
> Max msgqueue size         819200               819200               bytes
>
> Max nice priority         0                    0
> Max realtime priority     0                    0
>
>
> > If you need to accept more than about
> > 64k connections (not necessarily concurrent) in less than TIME-WAIT
> > seconds, you might run out of ports.
>
> > How does netstat look like?
>
> I have to wait for another outage tonight, to get more definite results on
> this.
> So far, I have had only one very brief outage at 7:46am
> I was asleep, but I have some new data logged.
> I have two servers, one on port 5222 (problematic one, let's call it serv1
> ), and one on 5228 (that has no problems, call it serv2 ).
> I made a script that measures the number of connections on each type of
> server respectively like this:
>
> while [ 1 ]
> do
>  sleep 5
>  netstat -ant | grep ESTABLISHED | awk '/:5228 /{a += 1}/:5222 /{b += 1}
> END
> {print strftime(" %d %b %Y %H:%M:%S", systime(
> ))"   serv2: "a"   serv1: "b" total: "a+b }'
> done
>
> This is what happened around 7:46am (lines that have "+" in front indicate
> anomaly):
>
>  11 Sep 2008 07:41:29   serv2: 2756   serv1: 1064 total: 3820
>  11 Sep 2008 07:41:36   serv2: 2764   serv1: 1062 total: 3826
>  11 Sep 2008 07:41:44   serv2: 2784   serv1: 1049 total: 3833
>  11 Sep 2008 07:41:51   serv2: 2756   serv1: 1055 total: 3811
>  11 Sep 2008 07:41:59   serv2: 2760   serv1: 1066 total: 3826
>  11 Sep 2008 07:42:06   serv2: 2777   serv1: 1050 total: 3827
>  11 Sep 2008 07:42:14   serv2: 2769   serv1: 1054 total: 3823
>  11 Sep 2008 07:42:21   serv2: 2751   serv1: 1055 total: 3806
>  11 Sep 2008 07:42:29   serv2: 2760   serv1: 1050 total: 3810
>  11 Sep 2008 07:42:36   serv2: 2747   serv1: 1040 total: 3787
>  11 Sep 2008 07:42:44   serv2: 2737   serv1: 1046 total: 3783
>  11 Sep 2008 07:42:51   serv2: 2739   serv1: 1046 total: 3785
>  11 Sep 2008 07:42:59   serv2: 2743   serv1: 1037 total: 3780
>  11 Sep 2008 07:43:07   serv2: 2720   serv1: 1041 total: 3761
>  11 Sep 2008 07:43:14   serv2: 2714   serv1: 1047 total: 3761
>  11 Sep 2008 07:43:22   serv2: 2721   serv1: 1045 total: 3766
>  11 Sep 2008 07:43:29   serv2: 2697   serv1: 1056 total: 3753
>  11 Sep 2008 07:43:37   serv2: 2710   serv1: 1059 total: 3769
> +11 Sep 2008 07:43:44   serv2: 2765   serv1: 1304 total: 4069
> +11 Sep 2008 07:43:53   serv2: 2854   serv1: 1904 total: 4758
> +11 Sep 2008 07:44:01   serv2: 2714   serv1: 2190 total: 4904
> +11 Sep 2008 07:44:09   serv2: 2715   serv1: 2202 total: 4917
> +11 Sep 2008 07:44:17   serv2: 2779   serv1: 1891 total: 4670
> +11 Sep 2008 07:44:26   serv2: 2812   serv1: 2284 total: 5096
> +11 Sep 2008 07:44:36   serv2: 2828   serv1: 3496 total: 6324
> +11 Sep 2008 07:44:46   serv2: 2715   serv1: 4327 total: 7042
> +11 Sep 2008 07:44:56   serv2: 2638   serv1: 3499 total: 6137
> +11 Sep 2008 07:45:05   serv2: 2714   serv1: 2396 total: 5110
> +11 Sep 2008 07:45:15   serv2: 2776   serv1: 1464 total: 4240
> +11 Sep 2008 07:45:25   serv2: 2728   serv1: 1604 total: 4332
> +11 Sep 2008 07:45:35   serv2: 2708   serv1: 1566 total: 4274
> +11 Sep 2008 07:45:45   serv2: 2750   serv1: 1680 total: 4430
> +11 Sep 2008 07:45:54   serv2: 2755   serv1: 1311 total: 4066
> +11 Sep 2008 07:46:04   serv2: 2704   serv1: 1178 total: 3882
>  11 Sep 2008 07:46:13   serv2: 2644   serv1: 1024 total: 3668
>  11 Sep 2008 07:46:22   serv2: 2573   serv1: 981 total: 3554
>  11 Sep 2008 07:46:30   serv2: 2739   serv1: 1051 total: 3790
>  11 Sep 2008 07:46:39   serv2: 2773   serv1: 1043 total: 3816
>  11 Sep 2008 07:46:46   serv2: 2548   serv1: 959 total: 3507
>  11 Sep 2008 07:46:54   serv2: 2773   serv1: 1044 total: 3817
>  11 Sep 2008 07:47:02   serv2: 2745   serv1: 1027 total: 3772
>  11 Sep 2008 07:47:10   serv2: 2591   serv1: 960 total: 3551
>  11 Sep 2008 07:47:17   serv2: 2721   serv1: 1002 total: 3723
>  11 Sep 2008 07:47:25   serv2: 2753   serv1: 1030 total: 3783
>  11 Sep 2008 07:47:32   serv2: 2773   serv1: 1029 total: 3802
>  11 Sep 2008 07:47:40   serv2: 2768   serv1: 1025 total: 3793
>  11 Sep 2008 07:47:47   serv2: 2764   serv1: 1021 total: 3785
>  11 Sep 2008 07:47:55   serv2: 2750   serv1: 1021 total: 3771
>
>
> Each server also reports the maximum numbers of authenticated connected
> clients to the database.
> Even though serv1 peaked at 07:44:46  at 4327 "ESTABLISHED" connections,
> the
> number of normally authenticated clients in the database for this time
> period is only 1100, which does not reflect this weird connections spike.
> Since I was asleep at 7:46am, I did not have a chance to investigate what
> those connections actually were.
>
> > Anyone know what happens to new
> > connection attempts to a server in this condition?
>
> One thing that I noticed yesterday, that when server was in this condition,
> telnet simply hang, as if no ACK packet was received back:
>
> alecm at serv2 ~> telnet localhost 5222
> Trying 127.0.0.1...
>
> and nothing
>
> This behavior or telnet seems to be unique to the case when ACK is not
> received in the handshake, I verified that with tcpdump. To contrast that,
> if nothing listens on the destination port for example, telnet gives:
>
> alecm at serv2 ~> telnet localhost 50007
> Trying 127.0.0.1...
> telnet: connect to address 127.0.0.1: Connection refused
> telnet: Unable to connect to remote host: Connection refused
>
> which corresponds to RST packet that kernel returns in that case.
> I tried to write a 5 line mucked up server with accept() not returning any
> packets, and failed.
>
> > -----Original Message-----
> > From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> > bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> > Sent: Thursday, September 11, 2008 6:47 AM
> > To: Twisted general discussion
> > Subject: Re: [Twisted-Python] intermittent problem: not accepting new
> > connections
> >
> > On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick"
> > <paul.nendick at gmail.com> wrote:
> > >Not necessarily related to what you've described, but I'll share
> > >something that's helped a good deal on my most-heavily hit twisted
> > >servers. Presuming you're using Linux:
> > >
> > > echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
> > >
> > >
> > >from http://lartc.org/howto/lartc.kernel.obscure.html :
> > >
> > >"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
> > >should not be changed without advice/request of technical experts"
> > >
> > >My expert advice: only use this on machines connected on a low-latency
> > >LAN. It *will* break internet-facing interfaces. It halves the
> > >constant used by the Nagle algorithm:
> > >
> > >http://en.wikipedia.org/wiki/Nagle's_algorithm<http://en.wikipedia.org/wiki/Nagle%27s_algorithm>
> > >
> >
> > This is somewhat interesting.  It suggests a potential problem which
> > I hadn't thought about before.  If you need to accept more than about
> > 64k connections (not necessarily concurrent) in less than TIME-WAIT
> > seconds, you might run out of ports.  Anyone know what happens to new
> > connection attempts to a server in this condition?
> >
> > Alec, any idea if your server could be getting into this state every
> > once in a while?  This is an appealing hypothesis, since it wouldn't
> > necessarily happen at peak connection time (but potentially shortly
> > after a peak), would resolve itself given a short period of time,
> > wouldn't necessarily prevent all new connection attempts, since old
> > TIME-WAIT sockets would be gradually timing out (so your other low-
> > volume servers might still appear to be working normally), wouldn't
> > interfere with already established connections, and might not change
> > the userspace-visible syscall behavior (depending on what Linux does
> > in this case, but I wouldn't be surprised if connection failures due
> > to this never showed up in an accept(2) result).
> >
> > Jean-Paul
> >
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



-- 
http://www.alvinatorsplayground.blogspot.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080912/f608c826/attachment.html>

From exarkun at twistedmatrix.com  Sat Sep 13 22:05:10 2008
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 14 Sep 2008 04:05:10 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1221365110.92.2408979@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080914/f73917ae/attachment.html>

From vvangelovski at gmail.com  Mon Sep 15 05:05:57 2008
From: vvangelovski at gmail.com (Vasil Vangelovski)
Date: Mon, 15 Sep 2008 13:05:57 +0200
Subject: [Twisted-Python] twisted.web.client POST data
Message-ID: <48CE4195.8080603@gmail.com>

I'm trying to send a post request like so
 getPage('http://localhost/test/test/', method='POST' postdata='test=asdf')

But the server script doesnt get any post arguments.
I was looking at the code for web.client and cant see where im doing
wrong here.
Any ideas what might be the problem? I'm using an svn checkout of Twisted.



From dotecho at gmail.com  Mon Sep 15 05:31:59 2008
From: dotecho at gmail.com (echo)
Date: Mon, 15 Sep 2008 19:31:59 +0800
Subject: [Twisted-Python] =?utf-8?q?Use_twisted=2Epython=2Elogfile=2ELogF?=
	=?utf-8?q?ile_wirte_log=EF=BC=8CMemory_can_not_be_released=2C_does?=
	=?utf-8?q?_anybody_familiar_with_or_encounter_such_a_situation=3F?=
Message-ID: <c9bd7f5f0809150431s2d31b1ayd00c1cf3ba36bab0@mail.gmail.com>

Use twisted.python.logfile.LogFile wirte logMemory can not be released,
does anybody familiar with or encounter such a situation?

Environment: FREEBSD 6.3 RELEASE
twisted svn trunk today


Description of the problem
Use "TOP" command observe the used memory, memory first use the BUF, if
buf>111M, then don't use buf
and use WIRED, Wired to around 132 M and then use Inact
If during the service  manually delete the generated file. Memory will be
released.
twisted.python.logfile.LogFile default  log file will be closed at 1 M size,
and re-open a file, how the file is closed but the memory still not
released

sorry for my poor english.. thank you


**test code

#!/usr/local/bin/python
import datetime
import os
from twisted.python import logfile

class LogFile2(logfile.LogFile):
    '''
    '''
    def rotate(self):
        """
        Rotate the file and create a new one.

        If it's not possible to open new logfile, this will fail silently,
        and continue logging to old logfile.
        """
        if not (os.access(self.directory, os.W_OK) and os.access(self.path,
os.W_OK)):
            return
        logs = self.listLogs()
        logs.reverse()
        for i in logs:
            if self.maxRotatedFiles is not None and i >=
self.maxRotatedFiles:
                os.remove("%s.%d" % (self.path, i))
            else:
                os.rename("%s.%d" % (self.path, i), "%s.%d" % (self.path, i
+ 1))

        self._file.close()
        print self._file, 'closed'
        os.rename(self.path, "%s.1" % self.path)
        self._openFile()


i=10000000
log = LogFile2('test_logfile.log', '/home/echo/tmp/test/')

while i:
    msg = '%s: test_test_test_test\r\n' % str(i)
    log.write(msg)
    i=i-1


log.close()

**result

<closed file '/home/echo/tmp/test/test_logfile.log', mode 'r+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8>
closeed
<closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458>
closeed
.......
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080915/0b6cfde1/attachment.html>

From tarjei at nu.no  Mon Sep 15 05:35:56 2008
From: tarjei at nu.no (tarjei)
Date: Mon, 15 Sep 2008 13:35:56 +0200
Subject: [Twisted-Python] twisted.web.client POST data
In-Reply-To: <48CE4195.8080603@gmail.com>
References: <48CE4195.8080603@gmail.com>
Message-ID: <48CE489C.3040208@nu.no>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Vasil Vangelovski wrote:
> I'm trying to send a post request like so
>  getPage('http://localhost/test/test/', method='POST' postdata='test=asdf')
> 
> But the server script doesnt get any post arguments.
> I was looking at the code for web.client and cant see where im doing
> wrong here.
> Any ideas what might be the problem? I'm using an svn checkout of Twisted.
Try:
getPage('http://localhost/test/test/?test=asdf', method='POST' postdata='')

If you want to use postdata, you'll have to encode it yourself. AFAIK
there is no method for doing this in twisted.web. I've used the
following which is based on[1]:


def encode_multipart_formdata(fields, files, content_type=
'application/octet-stream'):
    """
    fields is a sequence of (name, value) elements for regular form fields.
    files is a sequence of (name, filename, value) elements for data to
be uploaded as files
    content_type is the contentype to send
    Return (content_type, body) ready for httplib.HTTP instance
    """
    BOUNDARY = '----------ThIs_Is_tHe_bouNdaRY_$'
    CRLF = '\r\n'
    L = []
    for (key, value) in fields:
        L.append('--' + BOUNDARY)
        L.append('Content-Disposition: form-data; name="%s"' % key)
        L.append('')
        L.append(value)
    for (key, filename, value) in files:
        L.append('--' + BOUNDARY)
        L.append('Content-Disposition: form-data; name="%s";
filename="%s"' % (key, filename))
        L.append('Content-Type: %s' % content_type)
        L.append('')
        L.append(value)
    L.append('--' + BOUNDARY + '--')
    L.append('')
    body = CRLF.join(L)
    content_type = 'multipart/form-data; boundary=%s' % BOUNDARY
    return content_type, body

This code makes it possible to also add files to the post.

1. http://code.activestate.com/recipes/146306/

Regards,
Tarjei

> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIzkicYVRKCnSvzfIRArU/AJ0XG6qKXbRYxj1fnwE3sm+xh0tJ6wCdEoYL
XqwNVrfspaKo2r76hSug01I=
=UpmN
-----END PGP SIGNATURE-----



From matusis at yahoo.com  Mon Sep 15 05:43:23 2008
From: matusis at yahoo.com (Alec Matusis)
Date: Mon, 15 Sep 2008 04:43:23 -0700
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <7a01f6c00809111817v609ff43kede137ed7ab900a5@mail.gmail.com>
References: <d437de8f0809110631wf3fd46bn65b6d965e913dc87@mail.gmail.com>	<20080911134651.29191.1030196475.divmod.quotient.24599@ohm>	<06c801c91448$b1a8f290$14fad7b0$@com>
	<7a01f6c00809111817v609ff43kede137ed7ab900a5@mail.gmail.com>
Message-ID: <030c01c91728$47d76940$d7863bc0$@com>

I wanted to post that I solved the problem, and it's unrelated to Twisted.

I noticed that this server had sudden increases in the numbers of
ESTABLISHED connections in netstat, but not in the number of authenticated
connections reported by twisted to the database. These increases correlated
with the connection outages.
Creating a shell script that monitors the connection rate, and invoking
tcpdump and sorting/counting the source IPs when it increases, showed that
this server was pounded twice a day for 3-5min from a small set of IPs with
new connections at about 100 conns/sec, that sent some junk data (these
connections timed out in twisted, because that junk never contained my line
separator, and I am using LineOnlyReceiver protocol). This was hardly an
attack against my server, because this new server was assigned an IP that I
have never used before- I guess this is just an internet reality ;)

Even though this does not look like SYN attacks (few connections were in
SYN_RCVD state), for some reason enabling net.ipv4.tcp_syncookies=1 made
everything normal. When these bizarre connections began to pile uo, I
started seeing 
"possible SYN flooding on port 5222. Sending cookies."
in /var/log/messages , and the connectivity outages stopped

I am sorry for the confusion, I was emboldened by finding the epoll bug back
in April, but this time Twisted continues to rock, and it's just a stupid
Ubuntu's tcp setting.



From: twisted-python-bounces at twistedmatrix.com
[mailto:twisted-python-bounces at twistedmatrix.com] On Behalf Of Alvin Delagon
Sent: Thursday, September 11, 2008 6:17 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] intermittent problem: not accepting new
connections

We had a similar problem like this, might as well share it with you guys:

Our Jabber server stopped taking in new connections due to our iptables at
some point in time (even lost some packets). We have an ip routing scheme
where ports 25,80,5223,10873 routed to 5222. Whenever this happens, we get
error error from our syslogs:

""ip_conntrack: table full, dropping packet"

http://support.imagestream.com/Resolving_ip_conntrack_table_full_Errors.html

Might as well check dmesg if you have something like this. What we did is
disable iptables and removed its kernel modules.
On Fri, Sep 12, 2008 at 3:57 AM, Alec Matusis <matusis at yahoo.com> wrote:
> How does ulimit -a compare between old and new machine?
ulimit is only higher on the new machine, I upped it. Also, from my
experience, running into ulimits produces log messages.

alecm at serv2 ~> cat /proc/23678/limits

Limit           Soft Limit      Hard Limit      Units

Max cpu time       unlimited      unlimited      ms

Max file size       unlimited      unlimited      bytes

Max data size       unlimited      unlimited      bytes

Max stack size      8388608       unlimited      bytes

Max core file size    0          unlimited      bytes

Max resident set     1073741824      1073741824      bytes

Max processes       126976        126976
processes
Max open files      25000        25000        files

Max locked memory     32768        32768        bytes

Max address space     unlimited      unlimited      bytes

Max file locks      unlimited      unlimited      locks

Max pending signals    126976        126976        signals

Max msgqueue size     819200        819200        bytes

Max nice priority     0          0
Max realtime priority   0          0


> If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports.
> How does netstat look like?
I have to wait for another outage tonight, to get more definite results on
this.
So far, I have had only one very brief outage at 7:46am
I was asleep, but I have some new data logged.
I have two servers, one on port 5222 (problematic one, let's call it serv1
), and one on 5228 (that has no problems, call it serv2 ).
I made a script that measures the number of connections on each type of
server respectively like this:

while [ 1 ]
do
sleep 5
netstat -ant | grep ESTABLISHED | awk '/:5228 /{a += 1}/:5222 /{b += 1} END
{print strftime(" %d %b %Y %H:%M:%S", systime(
))"  serv2: "a"  serv1: "b" total: "a+b }'
done

This is what happened around 7:46am (lines that have "+" in front indicate
anomaly):

11 Sep 2008 07:41:29  serv2: 2756  serv1: 1064 total: 3820
11 Sep 2008 07:41:36  serv2: 2764  serv1: 1062 total: 3826
11 Sep 2008 07:41:44  serv2: 2784  serv1: 1049 total: 3833
11 Sep 2008 07:41:51  serv2: 2756  serv1: 1055 total: 3811
11 Sep 2008 07:41:59  serv2: 2760  serv1: 1066 total: 3826
11 Sep 2008 07:42:06  serv2: 2777  serv1: 1050 total: 3827
11 Sep 2008 07:42:14  serv2: 2769  serv1: 1054 total: 3823
11 Sep 2008 07:42:21  serv2: 2751  serv1: 1055 total: 3806
11 Sep 2008 07:42:29  serv2: 2760  serv1: 1050 total: 3810
11 Sep 2008 07:42:36  serv2: 2747  serv1: 1040 total: 3787
11 Sep 2008 07:42:44  serv2: 2737  serv1: 1046 total: 3783
11 Sep 2008 07:42:51  serv2: 2739  serv1: 1046 total: 3785
11 Sep 2008 07:42:59  serv2: 2743  serv1: 1037 total: 3780
11 Sep 2008 07:43:07  serv2: 2720  serv1: 1041 total: 3761
11 Sep 2008 07:43:14  serv2: 2714  serv1: 1047 total: 3761
11 Sep 2008 07:43:22  serv2: 2721  serv1: 1045 total: 3766
11 Sep 2008 07:43:29  serv2: 2697  serv1: 1056 total: 3753
11 Sep 2008 07:43:37  serv2: 2710  serv1: 1059 total: 3769
+11 Sep 2008 07:43:44  serv2: 2765  serv1: 1304 total: 4069
+11 Sep 2008 07:43:53  serv2: 2854  serv1: 1904 total: 4758
+11 Sep 2008 07:44:01  serv2: 2714  serv1: 2190 total: 4904
+11 Sep 2008 07:44:09  serv2: 2715  serv1: 2202 total: 4917
+11 Sep 2008 07:44:17  serv2: 2779  serv1: 1891 total: 4670
+11 Sep 2008 07:44:26  serv2: 2812  serv1: 2284 total: 5096
+11 Sep 2008 07:44:36  serv2: 2828  serv1: 3496 total: 6324
+11 Sep 2008 07:44:46  serv2: 2715  serv1: 4327 total: 7042
+11 Sep 2008 07:44:56  serv2: 2638  serv1: 3499 total: 6137
+11 Sep 2008 07:45:05  serv2: 2714  serv1: 2396 total: 5110
+11 Sep 2008 07:45:15  serv2: 2776  serv1: 1464 total: 4240
+11 Sep 2008 07:45:25  serv2: 2728  serv1: 1604 total: 4332
+11 Sep 2008 07:45:35  serv2: 2708  serv1: 1566 total: 4274
+11 Sep 2008 07:45:45  serv2: 2750  serv1: 1680 total: 4430
+11 Sep 2008 07:45:54  serv2: 2755  serv1: 1311 total: 4066
+11 Sep 2008 07:46:04  serv2: 2704  serv1: 1178 total: 3882
11 Sep 2008 07:46:13  serv2: 2644  serv1: 1024 total: 3668
11 Sep 2008 07:46:22  serv2: 2573  serv1: 981 total: 3554
11 Sep 2008 07:46:30  serv2: 2739  serv1: 1051 total: 3790
11 Sep 2008 07:46:39  serv2: 2773  serv1: 1043 total: 3816
11 Sep 2008 07:46:46  serv2: 2548  serv1: 959 total: 3507
11 Sep 2008 07:46:54  serv2: 2773  serv1: 1044 total: 3817
11 Sep 2008 07:47:02  serv2: 2745  serv1: 1027 total: 3772
11 Sep 2008 07:47:10  serv2: 2591  serv1: 960 total: 3551
11 Sep 2008 07:47:17  serv2: 2721  serv1: 1002 total: 3723
11 Sep 2008 07:47:25  serv2: 2753  serv1: 1030 total: 3783
11 Sep 2008 07:47:32  serv2: 2773  serv1: 1029 total: 3802
11 Sep 2008 07:47:40  serv2: 2768  serv1: 1025 total: 3793
11 Sep 2008 07:47:47  serv2: 2764  serv1: 1021 total: 3785
11 Sep 2008 07:47:55  serv2: 2750  serv1: 1021 total: 3771


Each server also reports the maximum numbers of authenticated connected
clients to the database.
Even though serv1 peaked at 07:44:46 at 4327 "ESTABLISHED" connections, the
number of normally authenticated clients in the database for this time
period is only 1100, which does not reflect this weird connections spike.
Since I was asleep at 7:46am, I did not have a chance to investigate what
those connections actually were.

> Anyone know what happens to new
> connection attempts to a server in this condition?
One thing that I noticed yesterday, that when server was in this condition,
telnet simply hang, as if no ACK packet was received back:

alecm at serv2 ~> telnet localhost 5222
Trying 127.0.0.1...
and nothing

This behavior or telnet seems to be unique to the case when ACK is not
received in the handshake, I verified that with tcpdump. To contrast that,
if nothing listens on the destination port for example, telnet gives:

alecm at serv2 ~> telnet localhost 50007
Trying 127.0.0.1...
telnet: connect to address 127.0.0.1: Connection refused
telnet: Unable to connect to remote host: Connection refused

which corresponds to RST packet that kernel returns in that case.
I tried to write a 5 line mucked up server with accept() not returning any
packets, and failed.

> -----Original Message-----
> From: twisted-python-bounces at twistedmatrix.com [mailto:twisted-python-
> bounces at twistedmatrix.com] On Behalf Of Jean-Paul Calderone
> Sent: Thursday, September 11, 2008 6:47 AM
> To: Twisted general discussion
> Subject: Re: [Twisted-Python] intermittent problem: not accepting new
> connections
>
> On Thu, 11 Sep 2008 14:31:38 +0100, "Paul C. Nendick"
> <paul.nendick at gmail.com> wrote:
> >Not necessarily related to what you've described, but I'll share
> >something that's helped a good deal on my most-heavily hit twisted
> >servers. Presuming you're using Linux:
> >
> > echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle
> >
> >
> >from http://lartc.org/howto/lartc.kernel.obscure.html :
> >
> >"Enable fast recycling TIME-WAIT sockets. Default value is 1. It
> >should not be changed without advice/request of technical experts"
> >
> >My expert advice: only use this on machines connected on a low-latency
> >LAN. It *will* break internet-facing interfaces. It halves the
> >constant used by the Nagle algorithm:
> >
> >http://en.wikipedia.org/wiki/Nagle's_algorithm
> >
>
> This is somewhat interesting. It suggests a potential problem which
> I hadn't thought about before. If you need to accept more than about
> 64k connections (not necessarily concurrent) in less than TIME-WAIT
> seconds, you might run out of ports. Anyone know what happens to new
> connection attempts to a server in this condition?
>
> Alec, any idea if your server could be getting into this state every
> once in a while? This is an appealing hypothesis, since it wouldn't
> necessarily happen at peak connection time (but potentially shortly
> after a peak), would resolve itself given a short period of time,
> wouldn't necessarily prevent all new connection attempts, since old
> TIME-WAIT sockets would be gradually timing out (so your other low-
> volume servers might still appear to be working normally), wouldn't
> interfere with already established connections, and might not change
> the userspace-visible syscall behavior (depending on what Linux does
> in this case, but I wouldn't be surprised if connection failures due
> to this never showed up in an accept(2) result).
>
> Jean-Paul
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


_______________________________________________
Twisted-Python mailing list
Twisted-Python at twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python



-- 
http://www.alvinatorsplayground.blogspot.com/




From exarkun at divmod.com  Mon Sep 15 06:43:39 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 15 Sep 2008 08:43:39 -0400
Subject: =?utf-8?q?Re=3A_=5BTwisted-Python=5D_Use_twisted=2Epython=2Elogf?=
	=?utf-8?q?ile=2ELogFile_wirte_log=EF=BC=8CMemory_can_not_be_released=2C_d?=
	=?utf-8?q?oes_anybody_familiar_with_or_encounter_such_a_situation=3F?=
In-Reply-To: <c9bd7f5f0809150431s2d31b1ayd00c1cf3ba36bab0@mail.gmail.com>
Message-ID: <20080915124339.29191.1041623863.divmod.quotient.26365@ohm>

On Mon, 15 Sep 2008 19:31:59 +0800, echo <dotecho at gmail.com> wrote:
>Use twisted.python.logfile.LogFile wirte logMemory can not be released,
>does anybody familiar with or encounter such a situation?
>
>Environment: FREEBSD 6.3 RELEASE
>twisted svn trunk today
>

I ran the test code on Ubuntu Hardy but I don't see any memory problems.
I let the program run for about two minutes and memory remained constant
for the entire time.

LogFile doesn't do very much besides write to a Python file object.  Can
you reproduce the memory problem just using a file without using LogFile?

Jean-Paul



From exarkun at divmod.com  Mon Sep 15 06:44:53 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 15 Sep 2008 08:44:53 -0400
Subject: [Twisted-Python] intermittent problem: not accepting
	new	connections
In-Reply-To: <030c01c91728$47d76940$d7863bc0$@com>
Message-ID: <20080915124453.29191.666349400.divmod.quotient.26366@ohm>

On Mon, 15 Sep 2008 04:43:23 -0700, Alec Matusis <matusis at yahoo.com> wrote:
>I wanted to post that I solved the problem, and it's unrelated to Twisted.
>
> [snip]
>
>I am sorry for the confusion, I was emboldened by finding the epoll bug back
>in April, but this time Twisted continues to rock, and it's just a stupid
>Ubuntu's tcp setting.
>

Thanks for the follow up and explaination.  It's good to know what was
going on here and what the fix was, even though it wasn't anything in
Twisted.

Jean-Paul



From andrewfr_ice at yahoo.com  Mon Sep 15 08:33:41 2008
From: andrewfr_ice at yahoo.com (Andrew Francis)
Date: Mon, 15 Sep 2008 07:33:41 -0700 (PDT)
Subject: [Twisted-Python] twisted.web.client POST data
In-Reply-To: <E1KfCV6-0002XQ-K1@cube.twistedmatrix.com>
Message-ID: <27951.5580.qm@web34201.mail.mud.yahoo.com>

Hi Vasil:

>I'm trying to send a post request like so
>getPage('http://localhost/test/test/', method='POST' postdata='test=asdf')

>But the server script doesnt get any post arguments.
>I was looking at the code for web.client and cant see where im doing
>wrong here.
>Any ideas what might be the problem? I'm using an svn checkout of Twisted.

I will assume you did things like check your web server's log to see if a connection was made and if there was an error.....

Since you are using the POST method, I would expect you would have to set the headers argument (a dictionary). I notice the header argument is missing. I would expect entries such as Content-Type and Content-Length.

Cheers,
Andrew




      



From dotecho at gmail.com  Mon Sep 15 08:35:22 2008
From: dotecho at gmail.com (echo)
Date: Mon, 15 Sep 2008 22:35:22 +0800
Subject: =?UTF-8?Q?Re:_[Twisted-Python]_Use_twisted.pyth?=
	=?UTF-8?Q?on.logfile.LogFile_wirte_log=EF=BC=8CMemory_ca?=
	=?UTF-8?Q?n_not_be_released, _does_anybody_famili?=
	=?UTF-8?Q?ar_with_or_encounter_such_a_situation=3F?=
In-Reply-To: <20080915124339.29191.1041623863.divmod.quotient.26365@ohm>
References: <c9bd7f5f0809150431s2d31b1ayd00c1cf3ba36bab0@mail.gmail.com>
	<20080915124339.29191.1041623863.divmod.quotient.26365@ohm>
Message-ID: <c9bd7f5f0809150735q7640ceb1p75a261b3d356da1e@mail.gmail.com>

2008/9/15 Jean-Paul Calderone <exarkun at divmod.com>

> I ran the test code on Ubuntu Hardy but I don't see any memory problems.
> I let the program run for about two minutes and memory remained constant
> for the entire time.
>
> LogFile doesn't do very much besides write to a Python file object.  Can
> you reproduce the memory problem just using a file without using LogFile?


Hi, Jean-Paul, thank you for reply and test;)

I open a single file, write the same data, memory is not automatically
released, after i delete the file, memory released..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080915/4831d865/attachment.html>

From vvangelovski at gmail.com  Tue Sep 16 01:41:40 2008
From: vvangelovski at gmail.com (Vasil Vangelovski)
Date: Tue, 16 Sep 2008 09:41:40 +0200
Subject: [Twisted-Python] twisted.web.client POST data
In-Reply-To: <27951.5580.qm@web34201.mail.mud.yahoo.com>
References: <27951.5580.qm@web34201.mail.mud.yahoo.com>
Message-ID: <48CF6334.5020209@gmail.com>

Problem was I was missing the content type header. The content length
value is calculated somewhere in twisted.web.client
I just put in there the same content type firefox sends when posting a
form. Now it works.


getPage(url,method='POST',postdata=urllib.urlencode({'check_data':check_data}),headers={'Content-Type':'application/x-www-form-urlencoded'})

Thanks for the suggestions.

Andrew Francis wrote:
> Hi Vasil:
> 
>> I'm trying to send a post request like so
>> getPage('http://localhost/test/test/', method='POST' postdata='test=asdf')
> 
>> But the server script doesnt get any post arguments.
>> I was looking at the code for web.client and cant see where im doing
>> wrong here.
>> Any ideas what might be the problem? I'm using an svn checkout of Twisted.
> 
> I will assume you did things like check your web server's log to see if a connection was made and if there was an error.....
> 
> Since you are using the POST method, I would expect you would have to set the headers argument (a dictionary). I notice the header argument is missing. I would expect entries such as Content-Type and Content-Length.
> 
> Cheers,
> Andrew
> 
> 
> 
> 
>       
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python




From davedrouin at hotmail.com  Tue Sep 16 07:50:53 2008
From: davedrouin at hotmail.com (David Drouin)
Date: Tue, 16 Sep 2008 13:50:53 +0000
Subject: [Twisted-Python] Using the Oscar protocol to send SMS text msgs
Message-ID: <BLU121-W10612CDD20ECDB5D0FF2C4D24D0@phx.gbl>

I'm wondering if anyone happens to have an example of how to send an SMS message through AIM using twisted.words.protocols.oscar.  Sending instant messages based on the code in oscardemo.py was simple enough, but when I tried to send a message to a phone number through an oscar.BOSConnection.sendMessage method such as:

self.sendMessage("+19995551212", [(msg,)], wantAck=0, autoResponse=False)

an SMS text message does not appear to be sent to the specified phone number, however, the number I tried to send the message to did end up appearing under "Recent Buddies" in AIM after trying this.  If I then attempt to send an SMS manually through version 6.9.1.2 of the AIM client it works as expected.  I'm guessing that perhaps a connection or ICBM parameter needs to be set to enable SMS messaging for the client connection made through oscar.  I looked at the code for the oscar protocol in Pidgin to see if that would shed any light on what I could be doing incorrectly and didn't see anything special being done for SMS text messages there aside from converting them to plain text before sending the message along in the same way as IM's are sent except that the user name is a phone number in the +<area code><number> format I've been trying with.  

thanks,

Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080916/8b4fdfac/attachment.html>

From rlotun at gmail.com  Thu Sep 18 03:42:35 2008
From: rlotun at gmail.com (Reza Lotun)
Date: Thu, 18 Sep 2008 10:42:35 +0100
Subject: [Twisted-Python] Calling deferToThread from a thread
Message-ID: <95bb10690809180242r7688b554u3dd05c33f69a642d@mail.gmail.com>

Hi All,

I have a data store api that mandates the return of deferreds for each
call. I have a number of implementations for the api - an in-memory
one for testing, and a number of other network + disk based apis.

My issue is this - I'm using py.test for unit testing (I'm aware of
trial, but for compatibility reasons with the rest of the project I
haven't looked into using it). To test deferred-based code I have set
up a separate thread which the reactor runs in (the setup and teardown
code is shown below for anyone who is interested).

def net():
    reactor.run(installSignalHandlers=0)

def setup_module(mod):
    global net_thread
    net_thread = threading.Thread(target=net)
    net_thread.start()
    time.sleep(1)

def teardown_module(module):
    reactor.callFromThread(reactor.stop)

This seems to work generally fine. The problem (or at least I *think*
it's the problem) is that in one of my implementations uses
deferToThread internally to create a deferred which it then returns to
the caller. Is it thread safe to call a deferToThread in a separate
thread? Normally I'd do a reactor.callFromThread, but I'm not sure how
to get a deferred by this construct.

I see two options:
1. In my unit test I write a function f which makes the api call and
gets the deferred, and sets it to a local variable within the test
instance. Then I schedule f to run in the reactor thread via
reactor.callFromThread
2. I look into trial which has support for this kind of stuff??

Thanks for any help.

Cheers,
Reza



From exarkun at divmod.com  Thu Sep 18 06:22:12 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu, 18 Sep 2008 08:22:12 -0400
Subject: [Twisted-Python] Calling deferToThread from a thread
In-Reply-To: <95bb10690809180242r7688b554u3dd05c33f69a642d@mail.gmail.com>
Message-ID: <20080918122212.29191.936281590.divmod.quotient.27794@ohm>

On Thu, 18 Sep 2008 10:42:35 +0100, Reza Lotun <rlotun at gmail.com> wrote:
>Hi All,
>
>I have a data store api that mandates the return of deferreds for each
>call. I have a number of implementations for the api - an in-memory
>one for testing, and a number of other network + disk based apis.
>

deferToThread isn't special.  Like pretty much any Twisted API, it is
only safe to call in the reactor thread.  It doesn't matter if the
reactor thread is the main thread or another one - whichever, that's
the only thread Twisted APIs are safe in.

> [snip]
>
>I see two options:
>1. In my unit test I write a function f which makes the api call and
>gets the deferred, and sets it to a local variable within the test
>instance. Then I schedule f to run in the reactor thread via
>reactor.callFromThread
>2. I look into trial which has support for this kind of stuff??

Your best bet is to look at py.test's support for xunit style tests.
Whenever you need to deal with Deferreds, you should be using trial's
TestCase.  Anything else you do will be fragile and prone to break (as
trial is, but at least we will fix it when it breaks so that you don't
have to).

Jean-Paul



From vvangelovski at gmail.com  Thu Sep 18 08:38:24 2008
From: vvangelovski at gmail.com (Vasil Vangelovski)
Date: Thu, 18 Sep 2008 16:38:24 +0200
Subject: [Twisted-Python] distributing a commercial project based on twisted
Message-ID: <406b9fda0809180738u3a4ee105le680d0079b7076ae@mail.gmail.com>

Hi
Can anyone tell me which is the best way to distribute a commercial
project based on Twisted for Linux.
It would be great if I can make .rpm and .deb packages which will
include twisted and some compiled modules of the project.
But I'm not sure how to do this. Should i turn to distutils or tap2rpm?



From dripton at ripton.net  Thu Sep 18 09:16:23 2008
From: dripton at ripton.net (David Ripton)
Date: Thu, 18 Sep 2008 08:16:23 -0700
Subject: [Twisted-Python] Calling deferToThread from a thread
In-Reply-To: <95bb10690809180242r7688b554u3dd05c33f69a642d@mail.gmail.com>
References: <95bb10690809180242r7688b554u3dd05c33f69a642d@mail.gmail.com>
Message-ID: <20080918151623.GB23767@vidar.dreamhost.com>

On 2008.09.18 10:42:35 +0100, Reza Lotun wrote:
> My issue is this - I'm using py.test for unit testing (I'm aware of
> trial, but for compatibility reasons with the rest of the project I
> haven't looked into using it). To test deferred-based code I have set
> up a separate thread which the reactor runs in (the setup and teardown
> code is shown below for anyone who is interested).

> I see two options:
> 1. In my unit test I write a function f which makes the api call and
> gets the deferred, and sets it to a local variable within the test
> instance. Then I schedule f to run in the reactor thread via
> reactor.callFromThread
> 2. I look into trial which has support for this kind of stuff??

trial has very good support for deferreds.  If your test method returns
a deferred then trial magically does the right thing.  You don't need to
manage the reactor yourself.  See Twisted's docs and unit tests for
examples.

trial's API is based on unittest's, which is based on JUnit's.  Works
fine, but it has the Java nature.

I recommend trying nose.  It has support for deferreds, using a
decorator.  And its API is based on the py.test API.  Unfortunately they
chose to spell setup and teardown differently, so you can't use your
py.test test modules unchanged, but the changes are usually trivial.

-- 
David Ripton    dripton at ripton.net



From david.craig.wilson at gmail.com  Fri Sep 19 22:28:27 2008
From: david.craig.wilson at gmail.com (David Wilson)
Date: Fri, 19 Sep 2008 23:28:27 -0500
Subject: [Twisted-Python] Looping
Message-ID: <24dc0be10809192128l57802301q599aeeb016f2d916@mail.gmail.com>

Hi All,
I'm trying to pick up Twisted and I'm having trouble with looping.

I expected that a Deferred returned from a looping call would be available
after each call.  But it's only available after the loop is stopped.  Am I
looking for a different class?

Thanks,
Dave

p.s.  Ultimately I'd like to watch a file and post any new lines up to an
HTTP server.  If there is a direct way to get there, please let me know.
Thanks!


from twisted.internet import task, defer
from twisted.internet import reactor
import sys
import time

def check_file_p(fp):
    time.sleep(2)
    #print fp
    sys.stdout.write('starting check...\n')
    fp.seek(fp.tell())
    list = []
    for line in fp.readlines():
        #sys.stdout.write(line)
        list.append(line)
    str_list = str(list)
    d = defer.Deferred()
    #print str_list
    d.callback(str_list)
    print d
    return d

def print_list(string):
    print 'calling string list...'
    sys.stdout.write('string: ' + string)

fn = r"C:\var\twisted.txt"
f = open(fn, 'r')
#l = task.LoopingCall(runEverySecond)
"""
didn't work
l = task.LoopingCall(check_file_p, f)
d = l.start(5.0, False) # call every x seconds
"""
d = task.deferLater(reactor, 3.5, check_file_p, f)

print d
d.addCallback(print_list)
print d
print 'starting reactor'
#l.stop() #will stop the looping calls
reactor.run()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080919/e183eeea/attachment.html>

From rlotun at gmail.com  Sat Sep 20 03:06:22 2008
From: rlotun at gmail.com (Reza Lotun)
Date: Sat, 20 Sep 2008 10:06:22 +0100
Subject: [Twisted-Python] distributing a commercial project based on
	twisted
Message-ID: <95bb10690809200206k36cec63ak69fcd8b0d01e9b4e@mail.gmail.com>

Hi,

We've successfully used bbfreeze
(http://pypi.python.org/pypi/bbfreeze/0.95.4) to build binaries with
twisted on linux. To make a deb from that binary is pretty easy, read
up on the 'dpkg-deb' command. You can also convert that .deb to an
.rpm using a tool called 'alien'.

Cheers,
Reza



From p.mayers at imperial.ac.uk  Sat Sep 20 04:37:46 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sat, 20 Sep 2008 11:37:46 +0100
Subject: [Twisted-Python] Looping
In-Reply-To: <24dc0be10809192128l57802301q599aeeb016f2d916@mail.gmail.com>
References: <24dc0be10809192128l57802301q599aeeb016f2d916@mail.gmail.com>
Message-ID: <48D4D27A.3020905@imperial.ac.uk>

David Wilson wrote:
> Hi All,
> I'm trying to pick up Twisted and I'm having trouble with looping.
>  
> I expected that a Deferred returned from a looping call would be 
> available after each call.  But it's only available after the loop is 

It's not, and if you think about it, it can't - a loopingcall is setup 
once and run indefinitely, who would you be "returning" the deferreds 
to, and how?

Just call your handler from within your loopingcall i.e.

def check_file(fp, cb):
   # blah blah
   for line in lines:
     cb(line)



> stopped.  Am I looking for a different class?
>  
> Thanks,
> Dave
>  
> p.s.  Ultimately I'd like to watch a file and post any new lines up to 
> an HTTP server.  If there is a direct way to get there, please let me 
> know.  Thanks!

The code you show isn't a very robust way of following a file. My advice 
would be to run "tail -F -q name" in a sub-process and accumulate the 
output.

You need to be aware when watching an external file that when you read, 
the whole line might not have been written, so you need to do something 
like this:

buffer = ''
def check(file, handler):
   buffer += file.read()
   if not '\n' in buffer:
     return

   lines = buffer.split('\n')
   # the final "line" in the buffer doesn't have a terminating
   # \n, make it be the buffer and drop it from out list
   buffer = lines.pop()
   for line in lines:
     handler(line)



From zooko at zooko.com  Sat Sep 20 08:49:21 2008
From: zooko at zooko.com (zooko)
Date: Sat, 20 Sep 2008 08:49:21 -0600
Subject: [Twisted-Python] distributing a commercial project based on
	twisted
In-Reply-To: <95bb10690809200206k36cec63ak69fcd8b0d01e9b4e@mail.gmail.com>
References: <95bb10690809200206k36cec63ak69fcd8b0d01e9b4e@mail.gmail.com>
Message-ID: <3FDE6B35-E4D9-4D75-BB61-4507540B61B8@zooko.com>

See also the stdeb tool [1] which produces .deb's from setup.py's  
(assuming that the setup.py's use the standard distutils or setuptools).

Regards,

Zooko

[1] http://stdeb.python-hosting.com/
---
http://allmydata.org -- Tahoe, the Least-Authority Filesystem
http://allmydata.com -- back up all your files for $5/month



From exarkun at twistedmatrix.com  Sat Sep 20 22:05:09 2008
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 21 Sep 2008 04:05:09 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1221969909.17.825450898@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080921/09fb68c3/attachment.html>

From tiredashell at gmail.com  Sun Sep 21 18:35:42 2008
From: tiredashell at gmail.com (Z. S. O.)
Date: Sun, 21 Sep 2008 20:35:42 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
Message-ID: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>

Hi list, I'd like to revive a topic touched on in the past. I'm playing with
python socket programming and decided I want to make a simplistic bittorrent
clone that uses UDP instead of TCP. My main reasons for the protocol choice
are (1) I don't need guaranteed in-order delivery, and (2) I need to get
around NAT restrictions without making the user manually forward ports.
Couple questions...

1. Are those good reasons to ditch TCP, or am I being an idiot? (Always a
possibility.)

2. Even though I don't need TCP's in-order guarantee, I still need an
ACKing mechanism to make sure all the packets eventually arrive. Is there
any (simple) code written that accomplishes this with UDP?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080921/bc0ea1f0/attachment.html>

From exarkun at divmod.com  Sun Sep 21 18:44:22 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 21 Sep 2008 20:44:22 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>
Message-ID: <20080922004422.29191.1404108468.divmod.quotient.29504@ohm>

On Sun, 21 Sep 2008 20:35:42 -0400, "Z. S. O." <tiredashell at gmail.com> wrote:
>Hi list, I'd like to revive a topic touched on in the past. I'm playing with
>python socket programming and decided I want to make a simplistic bittorrent
>clone that uses UDP instead of TCP. My main reasons for the protocol choice
>are (1) I don't need guaranteed in-order delivery, and (2) I need to get
>around NAT restrictions without making the user manually forward ports.
>Couple questions...
>
>1. Are those good reasons to ditch TCP, or am I being an idiot? (Always a
>possibility.)

It's not easier to get UDP through NATs.  It's just as hard or harder.

>
>2. Even though I don't need TCP's in-order guarantee, I still need an
>ACKing mechanism to make sure all the packets eventually arrive. Is there
>any (simple) code written that accomplishes this with UDP?
>

Jean-Paul



From itamar at itamarst.org  Sun Sep 21 18:55:56 2008
From: itamar at itamarst.org (Itamar Shtull-Trauring)
Date: Sun, 21 Sep 2008 20:55:56 -0400
Subject: [Twisted-Python] Twisted sprint next Sunday
Message-ID: <48D6ED1C.1080508@itamarst.org>

Unless someone vetoes this, I am going to take glyph up on his offer and 
preemptively declare a Twisted sprint for next Sunday, September 28, to 
take place at the Divmod offices in Cambridge, MA. Unfortunately I don't 
actually know what the address of the Divmod office is, or what the 
earliest hour we can expect someone to be there, so I will leave these 
details up to someone else.

Those who cannot make it to Boston are of course welcome to work in 
parallel elsewhere. Those who can't work on that day are of course 
welcome to work any day they feel like :)



From tiredashell at gmail.com  Sun Sep 21 19:06:12 2008
From: tiredashell at gmail.com (Z. S. O.)
Date: Sun, 21 Sep 2008 21:06:12 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <20080922004422.29191.1404108468.divmod.quotient.29504@ohm>
References: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>
	<20080922004422.29191.1404108468.divmod.quotient.29504@ohm>
Message-ID: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>

> It's not easier to get UDP through NATs.  It's just as hard or harder.


It must be a widely held error, then, because it's what I hear every time
the subject arises. My understanding was that since UDP doesn't have the
concept of "streams," most NATs will allow all UDP packets through to a
given port one it is first hole-punched.

Nat traversal aside, I'm also concerned about performance, and since TCP
doesn't make in-order delivery optional, I'm still tempted to stick with
UDP...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080921/e1e8430f/attachment.html>

From exarkun at divmod.com  Sun Sep 21 19:12:27 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 21 Sep 2008 21:12:27 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
Message-ID: <20080922011227.29191.861647876.divmod.quotient.29517@ohm>

On Sun, 21 Sep 2008 21:06:12 -0400, "Z. S. O." <tiredashell at gmail.com> wrote:
>> It's not easier to get UDP through NATs.  It's just as hard or harder.
>
>
>It must be a widely held error, then, because it's what I hear every time
>the subject arises. My understanding was that since UDP doesn't have the
>concept of "streams," most NATs will allow all UDP packets through to a
>given port one it is first hole-punched.
>
>Nat traversal aside, I'm also concerned about performance, and since TCP
>doesn't make in-order delivery optional, I'm still tempted to stick with
>UDP...
>

For a bittorrent-like application, you're also not particularly concerned
with *latency*, just throughput.  Allowing out-of-order delivery primarily
reduces latency, it doesn't do a whole lot for throughput.

Jean-Paul



From tiredashell at gmail.com  Sun Sep 21 19:33:43 2008
From: tiredashell at gmail.com (Z. S. O.)
Date: Sun, 21 Sep 2008 21:33:43 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <20080922011227.29191.861647876.divmod.quotient.29517@ohm>
References: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
	<20080922011227.29191.861647876.divmod.quotient.29517@ohm>
Message-ID: <d6bdc39c0809211833x61516a80u77244b1e0efac734@mail.gmail.com>

>
> For a bittorrent-like application, you're also not particularly concerned
> with *latency*, just throughput.  Allowing out-of-order delivery primarily
> reduces latency, it doesn't do a whole lot for throughput.


That's a good point, I didn't consider that. Latency is only really
important for streaming media and gaming, so this probably is a bad idea
after all. Well anyway thanks for the input, I appreciate it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080921/de20ccc4/attachment.html>

From paulalexwilson at gmail.com  Mon Sep 22 02:37:10 2008
From: paulalexwilson at gmail.com (Paul Wilson)
Date: Mon, 22 Sep 2008 09:37:10 +0100
Subject: [Twisted-Python] Twisted Plugins that for classes that implement
	interfaces
Message-ID: <3c3d11cf0809220137w6391a96anb759ff83f20f602e@mail.gmail.com>

Hi all,

I'd like to be able to use the twisted plugin mechanism to extract
classes that implement given interfaces. I've successfully followed
the examples to get an iterator over _objects_ that provide my
interfaces, but can't find a way to get just the classes.

Does such a facility exist or am I going to need a rethink? Thanks in advance...

Paul



From phil at bubblehouse.org  Mon Sep 22 06:32:50 2008
From: phil at bubblehouse.org (Phil Christensen)
Date: Mon, 22 Sep 2008 08:32:50 -0400
Subject: [Twisted-Python] Twisted Plugins that for classes that implement
	interfaces
In-Reply-To: <3c3d11cf0809220137w6391a96anb759ff83f20f602e@mail.gmail.com>
References: <3c3d11cf0809220137w6391a96anb759ff83f20f602e@mail.gmail.com>
Message-ID: <9950F874-E253-49EC-808D-E572FC9CAE4E@bubblehouse.org>

On Sep 22, 2008, at 4:37 AM, Paul Wilson wrote:
> Hi all,
>
> I'd like to be able to use the twisted plugin mechanism to extract
> classes that implement given interfaces. I've successfully followed
> the examples to get an iterator over _objects_ that provide my
> interfaces, but can't find a way to get just the classes.
>
> Does such a facility exist or am I going to need a rethink? Thanks  
> in advance...

Hi Paul,

Try using classProvides() instead of implements() in your class  
definition. That should result in the plugin system returning the  
class itself, instead of the instance.

-phil



From paulalexwilson at gmail.com  Mon Sep 22 06:45:31 2008
From: paulalexwilson at gmail.com (Paul Wilson)
Date: Mon, 22 Sep 2008 13:45:31 +0100
Subject: [Twisted-Python] Twisted Plugins that for classes that implement
	interfaces
In-Reply-To: <9950F874-E253-49EC-808D-E572FC9CAE4E@bubblehouse.org>
References: <3c3d11cf0809220137w6391a96anb759ff83f20f602e@mail.gmail.com>
	<9950F874-E253-49EC-808D-E572FC9CAE4E@bubblehouse.org>
Message-ID: <3c3d11cf0809220545n595f4a97k95969e86d6ddd4e@mail.gmail.com>

2008/9/22 Phil Christensen <phil at bubblehouse.org>:
> On Sep 22, 2008, at 4:37 AM, Paul Wilson wrote:
>>
>> Hi all,
>>
>> I'd like to be able to use the twisted plugin mechanism to extract
>> classes that implement given interfaces. I've successfully followed
>> the examples to get an iterator over _objects_ that provide my
>> interfaces, but can't find a way to get just the classes.
>>
>> Does such a facility exist or am I going to need a rethink? Thanks in
>> advance...
>
> Hi Paul,
>
> Try using classProvides() instead of implements() in your class definition.
> That should result in the plugin system returning the class itself, instead
> of the instance.
>
> -phil
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>

Brilliant. Thank's fixed it!



From bernat at luffy.cx  Mon Sep 22 07:12:53 2008
From: bernat at luffy.cx (Vincent Bernat)
Date: Mon, 22 Sep 2008 15:12:53 +0200
Subject: [Twisted-Python] Having some kind of "finally" clause
Message-ID: <145518663ff04ce4300f2ccdf3b2ee4a@chopper.luffy.cx>


Hi!

I would like to do something like this with Twisted:

x.open()
try:
 x.someoperations()
 x.otheroperations()
finally:
 x.close()

I could do something like this :

d = open_and_get_x()
d.addCallback(someoperations)
d.addCallback(otheroperations)
d.addBoth(closeAndReRaiseIfError)
return d

Each callback would return x to let the next callback proceed it. However,
if there is an error, I have no "x" to close in "closeAndReRaiseIfError".
How can I do that?

Thanks.



From exarkun at divmod.com  Mon Sep 22 07:23:31 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon, 22 Sep 2008 09:23:31 -0400
Subject: [Twisted-Python] Having some kind of "finally" clause
In-Reply-To: <145518663ff04ce4300f2ccdf3b2ee4a@chopper.luffy.cx>
Message-ID: <20080922132331.29191.1456701601.divmod.quotient.29703@ohm>

On Mon, 22 Sep 2008 15:12:53 +0200, Vincent Bernat <bernat at luffy.cx> wrote:
>
>Hi!
>
>I would like to do something like this with Twisted:
>
>x.open()
>try:
> x.someoperations()
> x.otheroperations()
>finally:
> x.close()
>
>I could do something like this :
>
>d = open_and_get_x()
>d.addCallback(someoperations)
>d.addCallback(otheroperations)
>d.addBoth(closeAndReRaiseIfError)
>return d
>
>Each callback would return x to let the next callback proceed it. However,
>if there is an error, I have no "x" to close in "closeAndReRaiseIfError".
>How can I do that?

There are a lot of ways.  You could make x an attribute of a shared object,
or you could close over it in the first callback to create the "finally"
handler, or you could pass it along as an argument to the `addBoth call
(again, in the first callback).

Notice that there's a slight difference between the two code examples you
gave.  The first won't close x in response to errors from `x.open(), but
`closeAndReRaiseIfError will be called even for errors from `open_and_get_x.
If you only add the finally handler in the first callback attached to `d,
then this difference goes away.

Jean-Paul



>
>Thanks.
>
>_______________________________________________
>Twisted-Python mailing list
>Twisted-Python at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>



From foom at fuhm.net  Mon Sep 22 08:07:04 2008
From: foom at fuhm.net (James Y Knight)
Date: Mon, 22 Sep 2008 10:07:04 -0400
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
References: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>
	<20080922004422.29191.1404108468.divmod.quotient.29504@ohm>
	<d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
Message-ID: <1B92D686-C00A-47DD-A9BC-C3202F1C7DC4@fuhm.net>


On Sep 21, 2008, at 9:06 PM, Z. S. O. wrote:
> It's not easier to get UDP through NATs.  It's just as hard or harder.
>
> It must be a widely held error, then, because it's what I hear every  
> time the subject arises. My understanding was that since UDP doesn't  
> have the concept of "streams," most NATs will allow all UDP packets  
> through to a given port one it is first hole-punched.

Yes, that's usually true, especially for home NATs. Some NATs do  
actually track UDP conversations between endpoints just like TCP  
streams, though. Traversing a NAT with UDP is /usually/ easier, when  
you have multiple endpoints you wish to hear from. But don't forget  
about the other kinds of NATs too, which you'll also have to implement  
support for. That's what makes it hard: implementing things multiple  
times for all the different network topologies.

> Nat traversal aside, I'm also concerned about performance, and since  
> TCP doesn't make in-order delivery optional, I'm still tempted to  
> stick with UDP...

Not entirely true. In order delivery is preserved to your application,  
but out-of-order delivery between the host endpoints is supported.  
Read up on the TCP "selective ACK" feature [1], which basically all  
OSes made since 1998 or so support. So a missed packet or two doesn't  
actually require all later data to always be retransmitted.

James

[1] http://www.ietf.org/rfc/rfc2018.txt




From andreengels at gmail.com  Mon Sep 22 08:30:55 2008
From: andreengels at gmail.com (Andre Engels)
Date: Mon, 22 Sep 2008 16:30:55 +0200
Subject: [Twisted-Python] UDP & TCP
Message-ID: <6faf39c90809220730l19a4ec97p45952ddb5a5f1a01@mail.gmail.com>

How can I program a service in Twisted that listens for both UDP and
TCP traffic at the same port? I naively created two services for it,
but then got into an error message because I was listening the same
port twice.

-- 
Andr Engels, andreengels at gmail.com

From andreengels at gmail.com  Mon Sep 22 08:34:33 2008
From: andreengels at gmail.com (Andre Engels)
Date: Mon, 22 Sep 2008 16:34:33 +0200
Subject: [Twisted-Python] Re: UDP & TCP
In-Reply-To: <6faf39c90809220730l19a4ec97p45952ddb5a5f1a01@mail.gmail.com>
References: <6faf39c90809220730l19a4ec97p45952ddb5a5f1a01@mail.gmail.com>
Message-ID: <6faf39c90809220734j480acbcfn12207badcd335e6a@mail.gmail.com>

Disregard my message; it seems the problem was that the port I tried
to use was really in use, because using the same setup on another port
DID work.

On Mon, Sep 22, 2008 at 4:30 PM, Andre Engels <andreengels at gmail.com> wrote:
> How can I program a service in Twisted that listens for both UDP and
> TCP traffic at the same port? I naively created two services for it,
> but then got into an error message because I was listening the same
> port twice.
>
> --
> Andr Engels, andreengels at gmail.com
>



-- 
Andr Engels, andreengels at gmail.com

From bernat at luffy.cx  Mon Sep 22 10:48:37 2008
From: bernat at luffy.cx (Vincent Bernat)
Date: Mon, 22 Sep 2008 18:48:37 +0200
Subject: [Twisted-Python] Having some kind of "finally" clause
In-Reply-To: <20080922132331.29191.1456701601.divmod.quotient.29703@ohm>
	(Jean-Paul Calderone's message of "Mon, 22 Sep 2008 09:23:31 -0400")
References: <20080922132331.29191.1456701601.divmod.quotient.29703@ohm>
Message-ID: <m3bpygnn2y.fsf@neo.luffy.cx>

OoO En ce dbut d'aprs-midi ensoleill du lundi 22 septembre 2008, vers
15:23, Jean-Paul Calderone <exarkun at divmod.com> disait:

> There are a lot of ways.  You could make x an attribute of a shared object,
> or you could close over it in the first callback to create the "finally"
> handler, or you could pass it along as an argument to the `addBoth call
> (again, in the first callback).

Thanks for the tip. I am now using the last approach.
-- 
 /* Nobody will ever see this message :-) */
panic("Cannot initialize video hardware\n");
	2.0.38 /usr/src/linux/arch/m68k/atari/atafb.c



From glyph at divmod.com  Mon Sep 22 12:24:52 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Mon, 22 Sep 2008 18:24:52 -0000
Subject: [Twisted-Python] UDP vs TCP for bittorrent-style file transfer
In-Reply-To: <d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
References: <d6bdc39c0809211735h7b4d22d8h3710a87f312e0db0@mail.gmail.com>
	<20080922004422.29191.1404108468.divmod.quotient.29504@ohm>
	<d6bdc39c0809211806s748e825dx750635310d5b0584@mail.gmail.com>
Message-ID: <20080922182452.31635.1446250201.divmod.xquotient.44@weber.divmod.com>

On 01:06 am, tiredashell at gmail.com wrote:
>>It's not easier to get UDP through NATs.  It's just as hard or harder.
>
>It must be a widely held error, then, because it's what I hear every 
>time
>the subject arises. My understanding was that since UDP doesn't have 
>the
>concept of "streams," most NATs will allow all UDP packets through to a
>given port one it is first hole-punched.

If you are a piece of software behind a NAT, and you want to accept a 
connection from a peer, there are three things you can do:

  1. Require some explicit configuration from the user; ask them to punch 
a hole through their NAT and tell you what port to use.  This is by far 
the easiest for you, but considered unacceptable since its default 
configuration will usually be broken.
  2. Use a protocol like UPnP or Nat-PMP to get around the user's router. 
This will work on a minority of deployed endpoints, but when it does 
work it will work great, and your application can just make regular TCP 
connections.
  3. Punch a hole, abusing the router's NAT routing rules in order to get 
it to think it's making a connection when it is actually accepting one. 
There are about six different ways to do this, but you can do it with 
UDP *or* TCP.  Different routers support different schemes, and I don't 
just mean "some support TCP, some support UDP": UDP port mapping 
_usually_ works a certain way, but there are exceptions.  You should at 
least read the papers referenced here:  http://midcom- 
p2p.sourceforge.net/

In order to build a truly robust application you will need to do all of 
the above.  Even if you do #2 and #3 perfectly, there are a surprising 
percentage of home routers (say, 5-10%) which are just buggy and won't 
route your traffic properly to another NAT no matter what you do, so you 
always need to provide a "just tell the NAT what to do manually" option. 
(Or, forward your traffic through some known-to-work intermediary.)
>Nat traversal aside, I'm also concerned about performance, and since 
>TCP
>doesn't make in-order delivery optional, I'm still tempted to stick 
>with
>UDP...

TCP will, in general, "perform" better than UDP, because TCP can cheat 
whereas UDP can't.  Your ISP can (and probably does, according to rumors 
I've heard from people who have worked on such things) deploy "smart" 
routers which can prioritize traffic using the additional information 
present in TCP headers which UDP doesn't provide.  Plus, there are 
things that your operating system is doing (as James already mentioned) 
that are extensions to the core TCP spec.

If you don't understand _at least_ enough about TCP to have implemented 
it yourself once, then you probably don't understand enough to make the 
decision to use UDP for performance reasons.  I am saying this because 
it was at the point where I actually implemented TCP myself that I 
gained this insight :).

I started a project a while ago to try to abstract away all this NAT- 
traversal nonsense and present an API for making a connection to a peer- 
to-peer user over whatever methods are available.  It's definitely in 
need of some maintenance, but if you're already using Twisted I think 
you'll find it easier to get started with this than to build your own 
P2P framework from the ground up: 
http://divmod.org/trac/wiki/DivmodVertex

Good luck!



From gabriel.rossetti at arimaz.com  Tue Sep 23 03:24:54 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 23 Sep 2008 11:24:54 +0200
Subject: [Twisted-Python] Multi-service install
Message-ID: <48D8B5E6.1050502@arimaz.com>

Hello everyone,

I have written an application that has one server and multiple clients 
using twisted. I would need to be able to install/run it under windows 
(for now) as an executable or a service. I can't have to have to install 
python and all the deps, this needs to be a drag-n-drop-n-execute-it-n- 
it-works deal, sort of like apple "app" files. I personally run each 
service (client) and the server as a diff. process as using twistd with 
one tac file seems slower. One of the services has a wx GUI too. Does 
anyone have any pointers/ideas/links concerning this? I saw that py2exe 
and freeze exists, but from the mailing list archives I couldn't tell it 
it really works.

Thank you,
Gabriel



From kevin.horn at gmail.com  Tue Sep 23 13:03:24 2008
From: kevin.horn at gmail.com (Kevin Horn)
Date: Tue, 23 Sep 2008 14:03:24 -0500
Subject: [Twisted-Python] Multi-service install
In-Reply-To: <48D8B5E6.1050502@arimaz.com>
References: <48D8B5E6.1050502@arimaz.com>
Message-ID: <562bcc10809231203q65187f57o3cf5678bf2d7bacf@mail.gmail.com>

I would probably try to use py2exe, possibly with moonfallen's ntsvc code
here:
http://twistedmatrix.com/trac/browser/sandbox/moonfallen

That should at least get you started.

Kevin Horn

On Tue, Sep 23, 2008 at 4:24 AM, Gabriel Rossetti <
gabriel.rossetti at arimaz.com> wrote:

> Hello everyone,
>
> I have written an application that has one server and multiple clients
> using twisted. I would need to be able to install/run it under windows (for
> now) as an executable or a service. I can't have to have to install python
> and all the deps, this needs to be a drag-n-drop-n-execute-it-n- it-works
> deal, sort of like apple "app" files. I personally run each service (client)
> and the server as a diff. process as using twistd with one tac file seems
> slower. One of the services has a wx GUI too. Does anyone have any
> pointers/ideas/links concerning this? I saw that py2exe and freeze exists,
> but from the mailing list archives I couldn't tell it it really works.
>
> Thank you,
> Gabriel
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080923/40059317/attachment.html>

From glen.mabey at swri.org  Tue Sep 23 15:58:48 2008
From: glen.mabey at swri.org (Glen Mabey)
Date: Tue, 23 Sep 2008 16:58:48 -0500
Subject: [Twisted-Python] failure to connect to sshsimpleserver.py
Message-ID: <67BD154E-3A46-47CA-ACE8-3753732A9172@swri.org>

Hello,

I'm just starting to use twisted (having quickly read through the book  
"Twisted: Network Programming Essentials"), and I am unable to  
successfully use one of the example scripts:  doc/conch/examples/ 
sshsimpleserver.py .

I am using python 2.5.2 and today's svn of twisted and pycrypto on  
RedHat AS5 x84-64.  I experienced similar results with 8.1.0 .

I am able to start the server with no problem, but when I start a  
client that connects to it, I get:


2008-09-23 21:51:08+0000 [-] Log opened.
2008-09-23 21:51:08+0000 [-] __main__.ExampleFactory starting on 5022
2008-09-23 21:51:08+0000 [-] Starting factory <__main__.ExampleFactory  
instance at 0x17e60a28>
2008-09-23 21:51:10+0000 [__main__.ExampleFactory] disabling diffie- 
hellman-group-exchange because we cannot find moduli file
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] kex alg, key  
alg: diffie-hellman-group1-sha1 ssh-rsa
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] outgoing:  
aes256-ctr hmac-sha1 none
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] incoming:  
aes256-ctr hmac-sha1 none
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] Unhandled  
Error
	Traceback (most recent call last):
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/python/log.py", line 51, in  
callWithLogger
	    return callWithContext({"system": lp}, func, *args, **kw)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/python/log.py", line 36, in  
callWithContext
	    return context.call({ILogContext: newCtx}, func, *args, **kw)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/python/context.py", line 59, in  
callWithContext
	    return self.currentContext().callWithContext(ctx, func, *args,  
**kw)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/python/context.py", line 37, in  
callWithContext
	    return func(*args,**kw)
	--- <exception caught here> ---
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/internet/selectreactor.py", line 146,  
in _doReadOrWrite
	    why = getattr(selectable, method)()
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/internet/tcp.py", line 463, in doRead
	    return self.protocol.dataReceived(data)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/conch/ssh/transport.py", line 314, in  
dataReceived
	    self.dispatchMessage(messageNum, packet[1:])
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/conch/ssh/transport.py", line 329, in  
dispatchMessage
	    f(payload)
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/conch/ssh/transport.py", line 740, in  
ssh_KEX_DH_GEX_REQUEST_OLD
	    NS(self.factory.privateKeys[self.keyAlg].sign(exchangeHash)))
	  File "/usr/DiamondBack/stow/twisted-20080923_svn-py2.5/lib/ 
python2.5/site-packages/twisted/conch/ssh/keys.py", line 659, in sign
	    signature = self.keyObject.sign(digest, '')[0]
	  File "/usr/DiamondBack/stow/pycrypto-20080923_git-py2.5/lib/ 
python2.5/site-packages/Crypto/PublicKey/pubkey.py", line 76, in sign
	    return self._sign(M, K)
	exceptions.TypeError: _sign() takes exactly 2 arguments (3 given)
	
2008-09-23 21:51:10+0000 [SSHServerTransport,0,127.0.0.1] connection  
lost



I have tried starting the client both as 'ssh localhost -p 5022' as  
well as running the sshsimpleclient.py script with the same results.

I have also tried connecting from a different host into the server,  
with the same results.

Any help in resolving this issue and realizing a working example of an  
ssh server would be greatly appreciated.

Thank you,
Glen Mabey



From exarkun at divmod.com  Tue Sep 23 16:06:07 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 23 Sep 2008 18:06:07 -0400
Subject: [Twisted-Python] failure to connect to sshsimpleserver.py
In-Reply-To: <67BD154E-3A46-47CA-ACE8-3753732A9172@swri.org>
Message-ID: <20080923220607.29191.505826685.divmod.quotient.30030@ohm>

On Tue, 23 Sep 2008 16:58:48 -0500, Glen Mabey <glen.mabey at swri.org> wrote:
>Hello,
>
>I'm just starting to use twisted (having quickly read through the book 
>"Twisted: Network Programming Essentials"), and I am unable to  successfully 
>use one of the example scripts:  doc/conch/examples/ sshsimpleserver.py .
>
>I am using python 2.5.2 and today's svn of twisted and pycrypto on  RedHat 
>AS5 x84-64.  I experienced similar results with 8.1.0 .

This looks a lot like a bug in PyCrypto:

>
>I am able to start the server with no problem, but when I start a  client 
>that connects to it, I get:
>
> [snip]
>           File "/usr/DiamondBack/stow/pycrypto-20080923_git-py2.5/lib/ 
>python2.5/site-packages/Crypto/PublicKey/pubkey.py", line 76, in sign
>             return self._sign(M, K)
>         exceptions.TypeError: _sign() takes exactly 2 arguments (3 given)

This is a file in PyCrypto itself, calling a method in PyCrypto itself,
and passing the wrong arguments.

You might want to try using the last release of PyCrypto instead of the
latest development snapshot.  You might also want to file a bug with the
PyCrypto maintainer (it seems there's a new one now) to get this fixed.

Jean-Paul



From glen.mabey at swri.org  Tue Sep 23 16:13:43 2008
From: glen.mabey at swri.org (Glen Mabey)
Date: Tue, 23 Sep 2008 17:13:43 -0500
Subject: [Twisted-Python] failure to connect to sshsimpleserver.py
In-Reply-To: <20080923220607.29191.505826685.divmod.quotient.30030@ohm>
References: <20080923220607.29191.505826685.divmod.quotient.30030@ohm>
Message-ID: <4CA35971-713B-4D0A-8F52-5EEE42CA6981@swri.org>

Hi Jean-Paul,

On Sep 23, 2008, at 5:06 PM, Jean-Paul Calderone wrote:

> This looks a lot like a bug in PyCrypto:

Yeah, I should have noticed that myself.

> This is a file in PyCrypto itself, calling a method in PyCrypto  
> itself,
> and passing the wrong arguments.
>
> You might want to try using the last release of PyCrypto instead of  
> the
> latest development snapshot.  You might also want to file a bug with  
> the
> PyCrypto maintainer (it seems there's a new one now) to get this  
> fixed.

I did revert to 2.0.1 and the problem did go away.

I will file a bug report to the PyCrypto guy.

Thank you,
Glen Mabey




From gabriel.rossetti at arimaz.com  Wed Sep 24 00:24:17 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Wed, 24 Sep 2008 08:24:17 +0200
Subject: [Twisted-Python] Multi-service install
In-Reply-To: <562bcc10809231203q65187f57o3cf5678bf2d7bacf@mail.gmail.com>
References: <48D8B5E6.1050502@arimaz.com>
	<562bcc10809231203q65187f57o3cf5678bf2d7bacf@mail.gmail.com>
Message-ID: <48D9DD11.4060401@arimaz.com>

Ok, thank you, I'll have a look at that.

Gabriel Rossetti

Kevin Horn wrote:
> I would probably try to use py2exe, possibly with moonfallen's ntsvc 
> code here:
> http://twistedmatrix.com/trac/browser/sandbox/moonfallen
>
> That should at least get you started.
>
> Kevin Horn
>
> On Tue, Sep 23, 2008 at 4:24 AM, Gabriel Rossetti 
> <gabriel.rossetti at arimaz.com <mailto:gabriel.rossetti at arimaz.com>> wrote:
>
>     Hello everyone,
>
>     I have written an application that has one server and multiple
>     clients using twisted. I would need to be able to install/run it
>     under windows (for now) as an executable or a service. I can't
>     have to have to install python and all the deps, this needs to be
>     a drag-n-drop-n-execute-it-n- it-works deal, sort of like apple
>     "app" files. I personally run each service (client) and the server
>     as a diff. process as using twistd with one tac file seems slower.
>     One of the services has a wx GUI too. Does anyone have any
>     pointers/ideas/links concerning this? I saw that py2exe and freeze
>     exists, but from the mailing list archives I couldn't tell it it
>     really works.
>
>     Thank you,
>     Gabriel
>
>     _______________________________________________
>     Twisted-Python mailing list
>     Twisted-Python at twistedmatrix.com
>     <mailto:Twisted-Python at twistedmatrix.com>
>     http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>   



From vvangelovski at gmail.com  Wed Sep 24 06:47:02 2008
From: vvangelovski at gmail.com (Vasil Vangelovski)
Date: Wed, 24 Sep 2008 14:47:02 +0200
Subject: [Twisted-Python] A question about errorback failure objects
Message-ID: <406b9fda0809240547y4bbf7234jbd79c228bddc5ab4@mail.gmail.com>

When an errorback gets called with a failure parameter what is the
best way to get the stack trace (to see what lines at what files
caused the error)?



From exarkun at divmod.com  Wed Sep 24 08:01:23 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 24 Sep 2008 10:01:23 -0400
Subject: [Twisted-Python] A question about errorback failure objects
In-Reply-To: <406b9fda0809240547y4bbf7234jbd79c228bddc5ab4@mail.gmail.com>
Message-ID: <20080924140123.29191.1528701373.divmod.quotient.30166@ohm>

On Wed, 24 Sep 2008 14:47:02 +0200, Vasil Vangelovski <vvangelovski at gmail.com> wrote:
>When an errorback gets called with a failure parameter what is the
>best way to get the stack trace (to see what lines at what files
>caused the error)?
>

You can find the API documentation for failures here:

  http://twistedmatrix.com/documents/current/api/twisted.python.failure.Failure.html

You might be interested in the printTraceback method.  You can also
pass a failure to twisted.python.log.err and a traceback will be written.

Keep in mind, however, that not all failures have tracebacks.  If you try
printing a failure's traceback and don't see anything interesting, this
may be because the failure wasn't created with a traceback.  In this case,
running with failure debugging enabled (eg, with twistd --debug) may provide
more useful information, since it will set a breakpoint on failure creation,
letting you inspect the creation context.

Jean-Paul



From krokodil at gmail.com  Wed Sep 24 13:16:29 2008
From: krokodil at gmail.com (Vadim Zaliva)
Date: Wed, 24 Sep 2008 12:16:29 -0700
Subject: [Twisted-Python] concurrency via reactor
Message-ID: <3d7addec0809241216n1290b817x6049ce66c0df197f@mail.gmail.com>

Hi!

I am writing some code which requires synchronization between several
TCP clients. I have several connections and at some point I have to
wait for data becoming availiable from several of them. Kind of
"barrier" pattern. I am twising my head how to do it with twisted
using reactor. Could somebody point me into right direction? Thanks!

Vadim



From exarkun at divmod.com  Wed Sep 24 13:19:40 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed, 24 Sep 2008 15:19:40 -0400
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <3d7addec0809241216n1290b817x6049ce66c0df197f@mail.gmail.com>
Message-ID: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>

On Wed, 24 Sep 2008 12:16:29 -0700, Vadim Zaliva <krokodil at gmail.com> wrote:
>Hi!
>
>I am writing some code which requires synchronization between several
>TCP clients. I have several connections and at some point I have to
>wait for data becoming availiable from several of them. Kind of
>"barrier" pattern. I am twising my head how to do it with twisted
>using reactor. Could somebody point me into right direction? Thanks!

You might want twisted.internet.defer.gatherResults().  It accepts a
list of Deferreds and returns a Deferred that fires when they all fire.

Jean-Paul



From krokodil at gmail.com  Wed Sep 24 15:57:04 2008
From: krokodil at gmail.com (Vadim Zaliva)
Date: Wed, 24 Sep 2008 14:57:04 -0700
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
References: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
Message-ID: <B47F518B-4487-4F88-ABBA-9ADEC9AD72C0@gmail.com>


On Sep 24, 2008, at 12:19, Jean-Paul Calderone wrote:

>> Hi!
>>
>> I am writing some code which requires synchronization between several
>> TCP clients. I have several connections and at some point I have to
>> wait for data becoming availiable from several of them. Kind of
>> "barrier" pattern. I am twising my head how to do it with twisted
>> using reactor. Could somebody point me into right direction? Thanks!
>
> You might want twisted.internet.defer.gatherResults().  It accepts a
> list of Deferreds and returns a Deferred that fires when they all  
> fire.


Jean-Paul,

Thanks! Seems like what I need. The only thing missing is ability to  
specify
timeout parameters, how long to wait for deferred to fire.

Sincerely,
Vadim



From mike at mkp.ca  Wed Sep 24 16:00:19 2008
From: mike at mkp.ca (Mike Pelletier)
Date: Wed, 24 Sep 2008 18:00:19 -0400
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <B47F518B-4487-4F88-ABBA-9ADEC9AD72C0@gmail.com>
References: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
	<B47F518B-4487-4F88-ABBA-9ADEC9AD72C0@gmail.com>
Message-ID: <273093d80809241500h715b88e3rc7e297fd9e75b9b8@mail.gmail.com>

> Thanks! Seems like what I need. The only thing missing is ability to specify
> timeout parameters, how long to wait for deferred to fire.

since gatherResults won't block you can implement your own timeout
with callLater.



From krokodil at gmail.com  Wed Sep 24 17:22:43 2008
From: krokodil at gmail.com (Vadim Zaliva)
Date: Wed, 24 Sep 2008 16:22:43 -0700
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
References: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
Message-ID: <1867458E-38D8-4183-BC08-DB6963017F5A@gmail.com>


On Sep 24, 2008, at 12:19, Jean-Paul Calderone wrote:

> You might want twisted.internet.defer.gatherResults().  It accepts a
> list of Deferreds and returns a Deferred that fires when they all  
> fire.


Pardon my naive questions, but how I can easily call gatherResults() to
wait for all deferred to fire and to return list of results in form of  
list
of (success,result) tuples?

Vadim



From krokodil at gmail.com  Wed Sep 24 18:12:35 2008
From: krokodil at gmail.com (Vadim Zaliva)
Date: Wed, 24 Sep 2008 17:12:35 -0700
Subject: [Twisted-Python] concurrency via reactor
In-Reply-To: <1867458E-38D8-4183-BC08-DB6963017F5A@gmail.com>
References: <20080924191940.29191.1911069890.divmod.quotient.30218@ohm>
	<1867458E-38D8-4183-BC08-DB6963017F5A@gmail.com>
Message-ID: <BDAA757A-6A5B-48FB-B465-E03543F1BD7F@gmail.com>


On Sep 24, 2008, at 16:22, Vadim Zaliva wrote:

> Pardon my naive questions, but how I can easily call gatherResults()  
> to
> wait for all deferred to fire and to return list of results in form  
> of list
> of (success,result) tuples?

Never mind. I have managed to do it in asynchronous manner, via  
callbacks.

Vadim



From gabriel.rossetti at arimaz.com  Thu Sep 25 03:33:39 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Thu, 25 Sep 2008 11:33:39 +0200
Subject: [Twisted-Python] LoopingCall question : ping w/ timeout using
	shared variable -> problem
Message-ID: <48DB5AF3.1030300@arimaz.com>

Hello everyone!

I have written some code uses a LoopingCall to send a "ping" at regular 
intervals. If it hasn't received an answer before the next call, it 
notifies me that the destination isn't available, if it does then it 
does nothing. I am getting lots of "unavailables" on hosts that are, I 
tried augmenting the timeout (the ping interval) and it doesn't change 
anything. I think what is happening is I'm using a simple variable to 
keep the availability state and that since protocol and the 
LoopingCall's callback both access the variable, this causes problems. 
Is there a better way of doing things or am I bound to use some sort of 
locking mechanism? If I have to use locking, which one do you recommend?

Thank you,
Gabriel



From gabriel.rossetti at arimaz.com  Thu Sep 25 06:40:01 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Thu, 25 Sep 2008 14:40:01 +0200
Subject: [Twisted-Python] LoopingCall question : ping w/ timeout using
	shared variable -> problem
In-Reply-To: <48DB5AF3.1030300@arimaz.com>
References: <48DB5AF3.1030300@arimaz.com>
Message-ID: <48DB86A1.4090902@arimaz.com>

Gabriel Rossetti wrote:
> Hello everyone!
>
> I have written some code uses a LoopingCall to send a "ping" at 
> regular intervals. If it hasn't received an answer before the next 
> call, it notifies me that the destination isn't available, if it does 
> then it does nothing. I am getting lots of "unavailables" on hosts 
> that are, I tried augmenting the timeout (the ping interval) and it 
> doesn't change anything. I think what is happening is I'm using a 
> simple variable to keep the availability state and that since protocol 
> and the LoopingCall's callback both access the variable, this causes 
> problems. Is there a better way of doing things or am I bound to use 
> some sort of locking mechanism? If I have to use locking, which one do 
> you recommend?
>
> Thank you,
> Gabriel
>
I tried using a reactor.callLater call and if it fires then it notifies 
me (unavailable) and if I get the response I cancel it and start over, 
this seams like a better approach.

Gabriel



From wyhross at gmail.com  Thu Sep 25 19:18:55 2008
From: wyhross at gmail.com (ross ross)
Date: Fri, 26 Sep 2008 09:18:55 +0800
Subject: [Twisted-Python] leave this maillist!
Message-ID: <ae5f1a540809251818j26ad4083t7765debc48dfaa3@mail.gmail.com>

plaease delete my mail address from this maillist, thanks!

Ross!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080926/448328eb/attachment.html>

From gabriel.rossetti at arimaz.com  Fri Sep 26 08:13:34 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Fri, 26 Sep 2008 16:13:34 +0200
Subject: [Twisted-Python] py2exe with Twisted and plugins, plugins not found
Message-ID: <48DCEE0E.7030708@arimaz.com>

Hello everybody,

I am trying to use py2exe with twisted, but I'm running into a problem : 
one of my classes uses twisted's plugin mechanism and they aren't 
loaded. I tried the python version and it works correctly. I saw that to 
use sqlite with storm I have to explicitly import it somewhere like so :

 import storm.databases.sqlite

because py2exe wasn't finding it since it's imported using __import__(), 
do I have to do something like that with twisted?

Thank you,
Gabriel



From exarkun at divmod.com  Fri Sep 26 08:30:27 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri, 26 Sep 2008 10:30:27 -0400
Subject: [Twisted-Python] Twisted sprint next Sunday
In-Reply-To: <48D6ED1C.1080508@itamarst.org>
Message-ID: <20080926143027.29191.1999853794.divmod.quotient.30592@ohm>

On Sun, 21 Sep 2008 20:55:56 -0400, Itamar Shtull-Trauring <itamar at itamarst.org> wrote:
>Unless someone vetoes this, I am going to take glyph up on his offer and 
>preemptively declare a Twisted sprint for next Sunday, September 28, to take 
>place at the Divmod offices in Cambridge, MA. Unfortunately I don't actually 
>know what the address of the Divmod office is, or what the earliest hour we 
>can expect someone to be there, so I will leave these details up to someone 
>else.

Where: 5 Upland Rd, 2nd Floor, Porter Square, Cambridge, MA
When: 10 AM - whenever

The tentative focus is release automation, but any topics are welcome.

Jean-Paul



From dialtone at gmail.com  Sat Sep 27 01:42:45 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Sat, 27 Sep 2008 00:42:45 -0700
Subject: [Twisted-Python] Ampoule - 0.0.2
Message-ID: <8B49DB20-0642-4A7F-B7E6-B30A6EEF47A4@gmail.com>

I just released Ampoule 0.0.2 on pypi and launchpad

http://pypi.python.org/pypi/ampoule/0.0.2
https://launchpad.net/ampoule/ampoule/0.0.2

Ampoule is a process pool implementation written
on top of Twisted Matrix. Its name comes from the
use of AMP as the default communication protocol
between the pool and all its children.

It's different from other alternative solutions because it
provides an API very close to that of the Twisted ThreadPool.
As an helper function it also provides a deferToAMPProcess
function that creates the ProcessPool and submits jobs to it.

The code is pretty well tested, in fact it contains more test lines
than actual code lines, and it's pretty well documented.

Speedwise on my macbook pro I was able to run about 1700 Ping
calls per second without recycling processes and about 1500 with
a recycling value of about 10000 calls per process.
If anyone wants to contribute a C implementation of amp
serializer/deserializer I'm pretty sure that Ampoule would benefit a
lot from it but for my current tasks 1500 calls per second is more
than fast enough, it's actually pretty fast.

A usage example is the following:

from ampoule import child, util
from twisted.protocols import amp

class Pid(amp.Command):
     response = [("pid", amp.Integer())]

class MyChild(child.AMPChild):
     @Pid.responder
     def pid(self):
         import os
         return {"pid": os.getpid()}

@util.mainpoint
def main(args):
     import sys
     from twisted.internet import reactor, defer
     from twisted.python import log
     log.startLogging(sys.stdout)

     from ampoule import pool

     @defer.inlineCallbacks
     def _run():
         pp = pool.ProcessPool(MyChild)
         yield pp.start()
         result = yield pp.doWork(Pid)
         print "The Child process PID is:", result['pid']
         yield pp.stop()
         reactor.stop()

     reactor.callLater(1, _run)
     reactor.run()

What's new in this version:

Ampoule 0.0.2 (2008-09-26)
==========================

Features
--------
  - Support process recycling after predefined number of calls.

Changes
-------
  - ProcessPool argument max_idle is now maxIdle to comply with Twisted
    style guidelines.

  - removed ampoule.runner module because it was essentially useless,
    if you want to change subprocess startup behavior pass a string that
    contains the new code as an argument by overriding the default
    processFactory for example with a closure like this:

        from ampoule.main import startAMPProcess
        from ampoule.pool import ProcessPool
        pp = ProcessPool()
        def myProcessFactory(*args, **kwargs):
            kwargs['bootstrap'] = myBootstrapCode
            return startAMPProcess(*args, **kwargs)
        pp.processFactory = staticmethod(myProcessFactory)

Have fun with ampoule! :)

--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080927/989e1970/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
URL: </pipermail/twisted-python/attachments/20080927/989e1970/attachment.sig>

From john.mangual at gmail.com  Sat Sep 27 12:40:51 2008
From: john.mangual at gmail.com (John Mangual)
Date: Sat, 27 Sep 2008 14:40:51 -0400
Subject: [Twisted-Python] jabber_client.py
Message-ID: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>

I looking at all the code libraries for writing jabber clients and I found
twistedwords.  I found jabber_client.py from
http://twistedmatrix.com/projects/words/documentation/examples/jabber_client.pyand
i ran it on my command line but nothing happens.  It's running, but
nothing's happening.  Please help. - john
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080927/d1e72c75/attachment.html>

From exarkun at twistedmatrix.com  Sat Sep 27 22:05:15 2008
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 28 Sep 2008 04:05:15 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1222574715.14.1125212783@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080928/3de395e6/attachment.html>

From shweta3230 at gmail.com  Sun Sep 28 05:13:25 2008
From: shweta3230 at gmail.com (shweta mani)
Date: Sun, 28 Sep 2008 16:43:25 +0530
Subject: [Twisted-Python] DOUBTS PLEASE SOLVE
Message-ID: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>

Hi al i am new to twisted. I had been assigned a project on SSH.
the project is as follows.
i have to login to a remote Linux machine through Windows
i have to execute a shell script  and print the output back in Windows
machine
this needs to be done through SSH.
Any clues . please help. i need it urgently
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080928/33e65bac/attachment.html>

From exarkun at divmod.com  Sun Sep 28 07:03:18 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 28 Sep 2008 09:03:18 -0400
Subject: [Twisted-Python] DOUBTS PLEASE SOLVE
In-Reply-To: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
Message-ID: <20080928130318.29191.1562573282.divmod.quotient.31312@ohm>

On Sun, 28 Sep 2008 16:43:25 +0530, shweta mani <shweta3230 at gmail.com> wrote:
>Hi al i am new to twisted. I had been assigned a project on SSH.
>the project is as follows.
>i have to login to a remote Linux machine through Windows
>i have to execute a shell script  and print the output back in Windows
>machine
>this needs to be done through SSH.
>Any clues . please help. i need it urgently
>

Take a look at the API docs and the examples.  Perhaps get a copy of
_Twisted Network Programming Essentials_ or find the Conch chapter
online.  If you get stuck, come back with specific questions.

Jean-Paul



From dr.marc.byrd at gmail.com  Sun Sep 28 12:18:48 2008
From: dr.marc.byrd at gmail.com (Marc Byrd)
Date: Sun, 28 Sep 2008 11:18:48 -0700
Subject: [Twisted-Python] Syslog Listener UDP
Message-ID: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>

Hi,

I would like to build a syslog(udp port 514) listener in twisted.  The goal
is to make it compatible with syslog and syslog-ng, which may be configured
on a "client" to send log entries (as they occur) via udp (fire and forget)
to a remote server (my twisted server).

Is there already something out there that would do this or that would be a
good start?

Thanks,


Marc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080928/8ca908ef/attachment.html>

From ntoper at gmail.com  Sun Sep 28 12:22:57 2008
From: ntoper at gmail.com (Nicolas Toper)
Date: Sun, 28 Sep 2008 20:22:57 +0200
Subject: [Twisted-Python] Syslog Listener UDP
In-Reply-To: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>
References: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>
Message-ID: <fcbb46050809281122m5fed6b9by2d9d7a8ff7b045ce@mail.gmail.com>

Hi,

Is this going to be an open source project?

Best,
Nicolas

On Sun, Sep 28, 2008 at 8:18 PM, Marc Byrd <dr.marc.byrd at gmail.com> wrote:

> Hi,
>
> I would like to build a syslog(udp port 514) listener in twisted.  The goal
> is to make it compatible with syslog and syslog-ng, which may be configured
> on a "client" to send log entries (as they occur) via udp (fire and forget)
> to a remote server (my twisted server).
>
> Is there already something out there that would do this or that would be a
> good start?
>
> Thanks,
>
>
> Marc
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>


-- 
A+
Nico
http://www.deviant-abstraction.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080928/a7633e83/attachment.html>

From bernat at luffy.cx  Sun Sep 28 15:14:04 2008
From: bernat at luffy.cx (Vincent Bernat)
Date: Sun, 28 Sep 2008 23:14:04 +0200
Subject: [Twisted-Python] Syslog Listener UDP
In-Reply-To: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>
	(Marc Byrd's message of "Sun, 28 Sep 2008 11:18:48 -0700")
References: <a33934630809281118y34e23dfdq769c5ea2ab8e9acd@mail.gmail.com>
Message-ID: <m3abdsht2b.fsf@neo.luffy.cx>

OoO  Pendant le  journal tlvis  du dimanche  28 septembre  2008, vers
20:18, "Marc Byrd" <dr.marc.byrd at gmail.com> disait:

> I would like to build a syslog(udp port 514) listener in twisted.  The goal is
> to make it compatible with syslog and syslog-ng, which may be configured on a
> "client" to send log entries (as they occur) via udp (fire and forget) to a
> remote server (my twisted server). 

> Is there already something out there that would do this or that would be a good
> start?

Because  of the  simplicity of  the syslog  protocol, you  can  just use
UDPServer with  a protocol derived from DatagramProtocol.  You just need
to overload datagramReceived to do  something sensible with the log line
received.

In short:

class SyslogInput(protocol.DatagramProtocol):

      def datagramReceived(self, data):
          print "I have received %r" % data

service = internet.UDPServer(514, SyslogInput())
-- 
I WILL NOT BRING SHEEP TO CLASS
I WILL NOT BRING SHEEP TO CLASS
I WILL NOT BRING SHEEP TO CLASS
-+- Bart Simpson on chalkboard in episode 9F06



From paul at subsignal.org  Sat Sep 27 18:11:49 2008
From: paul at subsignal.org (paul)
Date: Sun, 28 Sep 2008 02:11:49 +0200
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
Message-ID: <gbp2uu$7pr$1@ger.gmane.org>

Jean-Paul Calderone schrieb:
> On Sun, 28 Sep 2008 16:43:25 +0530, shweta mani <shweta3230 at gmail.com> 
> wrote:
>> Hi al i am new to twisted. I had been assigned a project on SSH.
>> the project is as follows.
>> i have to login to a remote Linux machine through Windows
>> i have to execute a shell script  and print the output back in Windows
>> machine
>> this needs to be done through SSH.
>> Any clues . please help. i need it urgently
>>
> 
> Take a look at the API docs and the examples.  Perhaps get a copy of
> _Twisted Network Programming Essentials_ or find the Conch chapter
> online.  If you get stuck, come back with specific questions.

Hope this isn't too offensive but last time I checked conch didn't work 
on win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users 
would be happy with a basic "secure RPC" implementation, no console 
stuff. No idea how much work that is though ...

cheers
  Paul




From exarkun at divmod.com  Sun Sep 28 18:23:42 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun, 28 Sep 2008 20:23:42 -0400
Subject: [Twisted-Python] Re: doubts please solve
In-Reply-To: <gbp2uu$7pr$1@ger.gmane.org>
Message-ID: <20080929002342.29191.418228950.divmod.quotient.31554@ohm>

On Sun, 28 Sep 2008 02:11:49 +0200, paul <paul at subsignal.org> wrote:
>Jean-Paul Calderone schrieb:
>>On Sun, 28 Sep 2008 16:43:25 +0530, shweta mani <shweta3230 at gmail.com> 
>>wrote:
>>>Hi al i am new to twisted. I had been assigned a project on SSH.
>>>the project is as follows.
>>>i have to login to a remote Linux machine through Windows
>>>i have to execute a shell script  and print the output back in Windows
>>>machine
>>>this needs to be done through SSH.
>>>Any clues . please help. i need it urgently
>>
>>Take a look at the API docs and the examples.  Perhaps get a copy of
>>_Twisted Network Programming Essentials_ or find the Conch chapter
>>online.  If you get stuck, come back with specific questions.
>
>Hope this isn't too offensive but last time I checked conch didn't work on 
>win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users would be 
>happy with a basic "secure RPC" implementation, no console stuff. No idea 
>how much work that is though ...

Ticket 50 is about the conch command line client.  I'm not sure if the
rest of conch, the part you would use to automate an SSH login, works on
Windows or not.  It shouldn't be affected by the lack of an fcntl module
(or any of the other modules missing on Windows), but it may accidentally
import them, preventing the code from working out of the box, even though
it doesn't use them.  This is probably simpler to fix than actually writing
a command line client.  However, it may already work; I don't have a Windows
machine handy to try, but by looking at buildbot I can see that a significant
portion of the Conch test suite runs and passes on there.

Jean-Paul



From christopher.zorn at gmail.com  Mon Sep 29 06:40:41 2008
From: christopher.zorn at gmail.com (Christopher Zorn)
Date: Mon, 29 Sep 2008 08:40:41 -0400
Subject: [Twisted-Python] jabber_client.py
In-Reply-To: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>
References: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>
Message-ID: <149014b90809290540g114a4edn52378db9c195706a@mail.gmail.com>

On Sat, Sep 27, 2008 at 2:40 PM, John Mangual <john.mangual at gmail.com>wrote:

> I looking at all the code libraries for writing jabber clients and I found
> twistedwords.  I found jabber_client.py from
> http://twistedmatrix.com/projects/words/documentation/examples/jabber_client.pyand i ran it on my command line but nothing happens.  It's running, but
> nothing's happening.  Please help. - john
>

There could be a few things that could not be happening. Do you have the
correct username and password?
Do you have the correct server? Does the server use srv records?

If you have the ability you can check your xmpp server logs to see if it
connected.



>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080929/6ab9f211/attachment.html>

From kevin.horn at gmail.com  Mon Sep 29 14:11:12 2008
From: kevin.horn at gmail.com (Kevin Horn)
Date: Mon, 29 Sep 2008 15:11:12 -0500
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <gbp2uu$7pr$1@ger.gmane.org>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
	<gbp2uu$7pr$1@ger.gmane.org>
Message-ID: <562bcc10809291311m7e6bf4b9qb37f1367dc6cfd57@mail.gmail.com>

For a non-twisted solution, you can also try paramiko:
http://www.lag.net/paramiko/

It might be a bit easier to wrap your brain around if you are very new to
the twisted way of doing things.

It should also work nicely on Win32 (I haven't checked in a while but the
last time I used it it worked fine).

Kevin Horn

On Sat, Sep 27, 2008 at 7:11 PM, paul <paul at subsignal.org> wrote:

> Jean-Paul Calderone schrieb:
>
>> On Sun, 28 Sep 2008 16:43:25 +0530, shweta mani <shweta3230 at gmail.com>
>> wrote:
>>
>>> Hi al i am new to twisted. I had been assigned a project on SSH.
>>> the project is as follows.
>>> i have to login to a remote Linux machine through Windows
>>> i have to execute a shell script  and print the output back in Windows
>>> machine
>>> this needs to be done through SSH.
>>> Any clues . please help. i need it urgently
>>>
>>>
>> Take a look at the API docs and the examples.  Perhaps get a copy of
>> _Twisted Network Programming Essentials_ or find the Conch chapter
>> online.  If you get stuck, come back with specific questions.
>>
>
> Hope this isn't too offensive but last time I checked conch didn't work on
> win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users would
> be happy with a basic "secure RPC" implementation, no console stuff. No idea
> how much work that is though ...
>
> cheers
>
>  Paul
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080929/11c0a442/attachment.html>

From esteve at fluidinfo.com  Mon Sep 29 14:37:28 2008
From: esteve at fluidinfo.com (Esteve Fernandez)
Date: Mon, 29 Sep 2008 22:37:28 +0200
Subject: [Twisted-Python] txThrift released
Message-ID: <200809292237.28827.esteve@fluidinfo.com>

Hi all,

I'm pleased to announce that Fluidinfo [1] is releasing support for Twisted in 
Apache/Facebook Thrift [2]

Download from https://issues.apache.org/jira/browse/THRIFT-148

We hope to get it accepted into the Thrift core, but in the meantime you can 
apply the patch. There's also a simple example based on the Thrift calculator 
demo.

To add support for Twisted in a Thrift service, simply run "thrift --gen 
py:twisted specfile.thrift" from the command line. For more details, you can 
follow the calculator example, as it covers Thrift extensively.

Feedback and contributions will be greatly appreciated! :-)

Cheers.

PS: the JIRA web page lets you vote issues, so just show your support if you 
think this patch is useful :-)

[1] - Fluidinfo - http://www.fluidinfo.com
[2] - Thrift - http://incubator.apache.org/thrift/



From jack-tp at cs.york.ac.uk  Mon Sep 29 14:37:53 2008
From: jack-tp at cs.york.ac.uk (Jack Whitham)
Date: Mon, 29 Sep 2008 21:37:53 +0100
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <gbp2uu$7pr$1@ger.gmane.org>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
	<gbp2uu$7pr$1@ger.gmane.org>
Message-ID: <20080929203753.GA20132@cs.york.ac.uk>

On Sun, Sep 28, 2008 at 02:11:49AM +0200, paul wrote:
> Hope this isn't too offensive but last time I checked conch didn't work 
> on win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users 
> would be happy with a basic "secure RPC" implementation, no console 
> stuff. No idea how much work that is though ...

Conch does work on Win32, I have written an application that uses
it (not the command line client). You have to install pycrypto 
in addition to Twisted.


-- 
Jack Whitham
jack at cs.york.ac.uk




From iammegatron at gmail.com  Mon Sep 29 16:11:33 2008
From: iammegatron at gmail.com (Zhe Hu)
Date: Mon, 29 Sep 2008 17:11:33 -0500
Subject: [Twisted-Python] twisted reactor under win32 (test SerialPort)
Message-ID: <6bea62950809291511r76a43d4fi117231d9c6455f61@mail.gmail.com>

Hi,I try to use twisted for asynchronous serial port read().

Here is my simple twisted code:
==========================
from twisted.internet import reactor
from twisted.internet.serialport import SerialPort
from twisted.internet.protocol import Protocol

class Client(Protocol):
    def connectionMade(self):
        print 'connected'

    def dataReceived(self, data):
        print data

SerialPort(Client(), 'COM4', reactor)
reactor.callLater(20, reactor.stop())
reactor.run()

==========================

It runs on my Mac with this line changed to SerialPort(Client,
'dev/tty.usbserial-A4001mLL', reactor) which is my Arduino board device.

But on Windows XP, it gave the error message:
"AttributeError: 'module' object has no attribute 'addEvent' "

I tried to used different reactor, such as selectreactor, win32eventreactor,
but the error message became "AssertionError: reactor already installed"

Please help. Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080929/d1f0cd60/attachment.html>

From gabriel.rossetti at arimaz.com  Mon Sep 29 23:57:09 2008
From: gabriel.rossetti at arimaz.com (Gabriel Rossetti)
Date: Tue, 30 Sep 2008 07:57:09 +0200
Subject: [Twisted-Python] jabber_client.py
In-Reply-To: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>
References: <b7dd8a010809271140u7b9da6c8xe9a0b2833b483629@mail.gmail.com>
Message-ID: <48E1BFB5.1010508@arimaz.com>

John Mangual wrote:
> I looking at all the code libraries for writing jabber clients and I 
> found twistedwords.  I found jabber_client.py from 
> http://twistedmatrix.com/projects/words/documentation/examples/jabber_client.py 
> and i ran it on my command line but nothing happens.  It's running, 
> but nothing's happening.  Please help. - john
> ------------------------------------------------------------------------
>
>   
I had the exact same thing, try the XMPP client, it works great : 
http://twistedmatrix.com/projects/words/documentation/examples/xmpp_client.py

Gabriel



From terry at jon.es  Tue Sep 30 06:53:18 2008
From: terry at jon.es (Terry Jones)
Date: Tue, 30 Sep 2008 14:53:18 +0200
Subject: [Twisted-Python] Question on default t.p.log output
Message-ID: <18658.8510.659765.567315@jon.es>

Greetings Twisted superheroes!

I have a simple question about logging. Here's a snippet of code:

    from twisted.python import log
    from twisted.web import client
    from twisted.internet import reactor
    import sys

    log.startLogging(sys.stdout)
    def stop(x): reactor.callLater(0, reactor.stop)
    client.getPage('http://www.divmod.com').addBoth(stop)
    reactor.run()

This produces the output

    2008/09/30 14:16 +0200 [-] Log opened.
    2008/09/30 14:16 +0200 [-] Starting factory <HTTPClientFactory: http://www.divmod.com>
    2008/09/30 14:16 +0200 [HTTPPageGetter,client] Stopping factory <HTTPClientFactory: http://divmod.com/?__session_just_started__=1>
    2008/09/30 14:16 +0200 [-] Main loop terminated.

I had a look around and can see where (most) of this is coming from.

First off, the start/stop factory messages are surprising and feel ugly to
me. I mean that's my stdout you're scribbling that stuff all over. The
starting and stopping factory methods, despite appearing next to each other
in the same base Factory class, don't give the same [...] component in
their output. Sometimes I get [Uninitialized], sometimes [-], and sometimes
[HTTPPageGetter,client] as above - with both starting and stopping
messages.

And then, and misleading IMO, is that in a callback attached to the
deferred from getPage, the log output (to the uninitiated, a class I am
arguably a prime member of) still appears to have something to do with
HTTPPageGetter,client when in fact the page has been retrieved, and the
callback fired. It's like HTTPPageGetter,client refuses to lie down and die
quietly, and insists on sitting up in the casket to holler at its
ungrateful descendant callbacks: Hey, I'm the one that kicked this off and
don't you forget it!

Ahem. I see that output is controlled by a var called noisy in the base
Factory class. By why is it True by default if it really is just noise?
Judging from the code (and the use of log.msg not log.err) it's not an
error.

In my actual use case, I see my log filling up with output like this:

2008/09/29 23:55 +0200 [HTTPPageGetter,client] Stopping factory <HTTPClientFactory: https://ec2.amazonaws.com:443/?Action=RunInstances&AWSAccessKeyId=92383292629273839262&ImageId=ami-6bd03402&InstanceType=m1.small&KeyName=xxx-keypair&MaxCount=1&MinCount=1&SecurityGroup.1=coordinator&SignatureVersion=1&Timestamp=2008-09-29T21%3A55%3A23&UserData=QVdTX0FDQ0VTU19LRVlfSUQ6IDBKU1NNSzVOS000N0RHN1dTRDAyCkFXU19TRUNSRVRfQUNDRVNTX0tFWTogZ3J3UDFWaTdHbjg4Y3hMdy9UcDIrdWIxeENUdWVwUmUvV3JHdXRGYQpTM0J1Y2tldE5hbWU6IGZsdWlkaW5mby5jb20KaW5pdEtleU5hbWU6IG9wdC9mbHVpZGluZm8vYmluL2luaXQucHkKcHJvY2Vzc0FyZ3M6IFstLWxvZ2ZpbGUsIC9tbnQvdG1wLzEyMjI3MjUzMjIuNi5sb2csIC0tcGlkZmlsZSwgL21udC90bXAvMTIyMjcyNTMyMi42LnBpZCwKICAtLW5vX3NhdmUsIC0tbm9kYWVtb24sIGF0dHJpYmFzZS1odHRwLXByb2Nlc3MtcG9vbCwgLS1wb3J0LCAnODAwMSddCnJlc3VsdHNLZXlOYW1lOiBpbnN0YW5jZXMvMC9yZXN1bHRzLwpzY3JpcHRQYXRoOiAvdXNyL2Jpbi90d2lzdGQKc291cmNlTGlicmFyeUtleU5hbWU6IGluc3RhbmNlcy8wL3NyYy8yMDA4MDkyNwo%3D&Version=2008-05-05&Signature=mPRws2HDxQaF4lMcmL7Ikc8Txqo%3D>

I guess the answer might be that I should make my own version of getPage
that sets noisy to False after making its HTTPClientFactory, or maybe
subclass FileLogObserver and override emit. Or I guess I could be calling
functions with log.callWithContext.

But those approached seem to be wheeling in a lot of machinery just to set
to False a variable that (arguably?) should be False to begin with.

See - told you it was simple. I'm at my very best nibbling away on the very
edges of the Twist-o-verse.

Terry

From glyph at divmod.com  Tue Sep 30 07:45:39 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 30 Sep 2008 13:45:39 -0000
Subject: [Twisted-Python] Question on default t.p.log output
In-Reply-To: <18658.8510.659765.567315@jon.es>
References: <18658.8510.659765.567315@jon.es>
Message-ID: <20080930134539.31635.525127464.divmod.xquotient.460@weber.divmod.com>

On 12:53 pm, terry at jon.es wrote:
>Greetings Twisted superheroes!

Hi Terry!
>I have a simple question about logging. Here's a snippet of code:

>First off, the start/stop factory messages are surprising and feel ugly 
>to
>me. I mean that's my stdout you're scribbling that stuff all over. The
>starting and stopping factory methods, despite appearing next to each 
>other
>in the same base Factory class, don't give the same [...] component in
>their output. Sometimes I get [Uninitialized], sometimes [-], and 
>sometimes
>[HTTPPageGetter,client] as above - with both starting and stopping
>messages.

Thank you for at least noticing this ;-).

The logging code is quite ugly, but unfortunately, almost nobody cares. 
If you could dedicate any time at all to improving it, even a little, 
we'd all really appreciate it.
>And then, and misleading IMO, is that in a callback attached to the
>deferred from getPage, the log output (to the uninitiated, a class I am
>arguably a prime member of) still appears to have something to do with
>HTTPPageGetter,client when in fact the page has been retrieved, and the
>callback fired. It's like HTTPPageGetter,client refuses to lie down and 
>die
>quietly, and insists on sitting up in the casket to holler at its
>ungrateful descendant callbacks: Hey, I'm the one that kicked this off 
>and
>don't you forget it!

The way the log prefix is calculated is based on what actual event is 
firing from the reactor.  So, whatever object *generates* the callback 
is the one whose log prefix will be used.

It would definitely be nice if the log could follow the asynchronous 
thread of execution.  Patches accepted :).
>Ahem. I see that output is controlled by a var called noisy in the base
>Factory class. By why is it True by default if it really is just noise?
>Judging from the code (and the use of log.msg not log.err) it's not an
>error.

It sounds like you have several complaints here.

1.) You don't want logs to go to stdout.

This is easy.  You can direct the log wherever you want, and overriding 
stdout is optional; take a look at the arguments to startLogging. 
(Unless you're talking about customizing logging in twistd, which is a 
whole other mess that there is a universe of tickets for.)

2.) Factories are too noisy by default.

Knowing when factories start up and shut down can actually be incredibly 
useful.  It's a pain when they're filling up your logs with spam, but a 
better solution would be some kind of structured log format with a log 
viewer application, not destroying the information so that viewing logs 
with 'less' is easier.

3.) Factories' start and stop messages do not include useful 
information.

Quite so.  It would be nicer if they did.

4.) The log prefix isn't always useful or correct.

This may be true, but we'd need a ticket filed that includes a complete 
enumeration of exactly _how_ they aren't useful or correct, and each 
case would need to be fixed.

5.) The log prefix for Deferred callbacks doesn't follow the 
asynchronous origin of the callback.

Figuring out how to do this is really tricky, because in different cases 
you want different things.  However, twisted.python.context provides a 
hook for you to potentially capture some state when Deferreds, at least 
certain Deferreds, are spun up.  If you can come up with a really clear 
statement of requirements for a particular log prefix, you can probably 
get it.

6.) The HTTP client is too noisy and should emit fewer log messages.

Possibly - but then I recently discovered some very interesting 
information by watching a server which had a bunch of outstanding 
getPage connections spew out thousands of 'stopping factory' messages in 
their output - and seeing those URLs was an invaluable debugging aid.

7.) Twisted's log messages are generally ugly and difficult to 
understand.

Touche - but again, this needs to be fixed on a case-by-case basis; 
nothing to be done in general.  Except, of course, to come up with some 
kind of standard for what makes up a useful / helpful log message; and 
that's probably not going to be the unstructured mess of strings that 
currently goes into the log.  (Can you tell I'm pushing a structured log 
format that can be parsed?)

Please feel free to file some tickets for areas of this behavior that 
you have noticed.  I wish I had time to pour into the logging system, 
but neither I (nor any of our sponsors) _really_ needs it to be any 
better; it's just a constant annoyance.



From terry at jon.es  Tue Sep 30 08:16:31 2008
From: terry at jon.es (Terry Jones)
Date: Tue, 30 Sep 2008 16:16:31 +0200
Subject: [Twisted-Python] Question on default t.p.log output
In-Reply-To: Your message at 13:45:39 on Tuesday, 30 September 2008
References: <18658.8510.659765.567315@jon.es>
	<20080930134539.31635.525127464.divmod.xquotient.460@weber.divmod.com>
Message-ID: <18658.13503.272813.702776@jon.es>

>>>>> "glyph" == glyph  <glyph at divmod.com> writes:
glyph> Thank you for at least noticing this ;-).

The 1K char log lines were hard to miss :-)

glyph> The logging code is quite ugly, but unfortunately, almost nobody
glyph> cares.  If you could dedicate any time at all to improving it, even
glyph> a little, we'd all really appreciate it.

You'd all appreciate it but OTOH almost nobody cares??? Hmmm. Hard to
resist :-)

glyph> The way the log prefix is calculated is based on what actual event is 
glyph> firing from the reactor.  So, whatever object *generates* the callback 
glyph> is the one whose log prefix will be used.

But I also see lines like this:

2008/09/29 23:56 +0200 [-] Starting factory <HTTPClientFactory: http://ec2-75-101-219-127.compute-1.amazonaws.com:8001/dummy>
2008/09/29 23:56 +0200 [Uninitialized] Stopping factory <HTTPClientFactory: http://ec2-75-101-219-127.compute-1.amazonaws.com:8001/dummy>

And - and Uninitialized do not have any clear correspondence with reactor
events. (BTW, I do see where these are coming from.)

glyph> It would definitely be nice if the log could follow the asynchronous 
glyph> thread of execution.  Patches accepted :).

Yes, agreed that would be nice. From my memory of defer.py... (insert vague
comment about how this might not be so hard - for you :-)).

glyph> It sounds like you have several complaints here.

glyph> 1.) You don't want logs to go to stdout.

I do want that, that's why I used sys.stdout.

glyph> 2.) Factories are too noisy by default.

glyph> Knowing when factories start up and shut down can actually be incredibly 
glyph> useful.  It's a pain when they're filling up your logs with spam, but a 
glyph> better solution would be some kind of structured log format with a log 
glyph> viewer application, not destroying the information so that viewing logs 
glyph> with 'less' is easier.

Right, and so viewing them when running a script from the command line that
wants to do some logging to stdout is also fine.

glyph> 4.) The log prefix isn't always useful or correct.

glyph> This may be true, but we'd need a ticket filed that includes a
glyph> complete enumeration of exactly _how_ they aren't useful or correct,
glyph> and each case would need to be fixed.

OK, thinking about that.

glyph> 5.) The log prefix for Deferred callbacks doesn't follow the
glyph> asynchronous origin of the callback.

glyph> Figuring out how to do this is really tricky, because in different cases 
glyph> you want different things.  However, twisted.python.context provides a 
glyph> hook for you to potentially capture some state when Deferreds, at least 
glyph> certain Deferreds, are spun up.  If you can come up with a really clear 
glyph> statement of requirements for a particular log prefix, you can probably 
glyph> get it.

And this.

glyph> 6.) The HTTP client is too noisy and should emit fewer log messages.

glyph> Possibly - but then I recently discovered some very interesting
glyph> information by watching a server which had a bunch of outstanding
glyph> getPage connections spew out thousands of 'stopping factory'
glyph> messages in their output - and seeing those URLs was an invaluable
glyph> debugging aid.

OK, but by your own description that's output that's useful for debugging
(and above you call it spam). My only real question was why that output is
on by default instead of off (especially seeing as it's often adding 1K of
output to my log file for a single logged message).

glyph> 7.) Twisted's log messages are generally ugly and difficult to 
glyph> understand.

glyph> Touche

But I didn't say that... I'm very happy to not have to write logging
code. Sure, the [HTTPPageGetter,client] speaking from beyond the grave is a
bit unsettling, but that's minor.

glyph> Except, of course, to come up with some kind of standard for what
glyph> makes up a useful / helpful log message; and that's probably not
glyph> going to be the unstructured mess of strings that currently goes
glyph> into the log.  (Can you tell I'm pushing a structured log format
glyph> that can be parsed?)

Yes, agreed that would be good.

glyph> Please feel free to file some tickets for areas of this behavior that 
glyph> you have noticed.  I wish I had time to pour into the logging system, 
glyph> but neither I (nor any of our sponsors) _really_ needs it to be any 
glyph> better; it's just a constant annoyance.

Understood, thanks. I'm mainly just trying to understand what's going on
and why.

I will have a bit more of a poke around. As I was going to say, from what I
remember about the callback mechanism in defer.py it seems like one should
be able to have some kind of data structure that's being maintained
(pushed, popped) there that could be updating a log prefix in some way.

Thanks!

Terry



From exarkun at divmod.com  Tue Sep 30 08:30:15 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 30 Sep 2008 10:30:15 -0400
Subject: [Twisted-Python] September 28 2008 Twisted Sprint Report
In-Reply-To: 0
Message-ID: <20080930143015.29191.1292467146.divmod.quotient.32227@ohm>

Hello all,

Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
and myself accomplished this past Sunday at the Twisted sprint.

Itamar took turns pairing with Chris and I.  He and Chris worked on
creating command line tools to invoke the release automation libraries
which we've already written.  You can find the results in a branch linked
from ticket #3439.

Itamar and I (and later Chris and I) worked on providing improved support
in Trial for inspecting warnings which have been emitted over the course
of a test.  This is in support of the high-level deprecation API described
in ticket #3266.

Jean-Paul



From shweta3230 at gmail.com  Tue Sep 30 09:42:49 2008
From: shweta3230 at gmail.com (shweta mani)
Date: Tue, 30 Sep 2008 21:12:49 +0530
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <20080929203753.GA20132@cs.york.ac.uk>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
	<gbp2uu$7pr$1@ger.gmane.org> <20080929203753.GA20132@cs.york.ac.uk>
Message-ID: <d13e157d0809300842q70838c3ex55c09e56c57c6213@mail.gmail.com>

hi friends thanks for immediate reply.
i have referred the book twisted..........
currently i am facing the problem.
i have to show ls -l output in a listbox using Tkinter
but because of TCP it first stores information in a window or some packet
format.
so it doesnot show the output in a continuous manner.



On Tue, Sep 30, 2008 at 2:07 AM, Jack Whitham <jack-tp at cs.york.ac.uk> wrote:

> On Sun, Sep 28, 2008 at 02:11:49AM +0200, paul wrote:
> > Hope this isn't too offensive but last time I checked conch didn't work
> > on win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users
> > would be happy with a basic "secure RPC" implementation, no console
> > stuff. No idea how much work that is though ...
>
> Conch does work on Win32, I have written an application that uses
> it (not the command line client). You have to install pycrypto
> in addition to Twisted.
>
>
> --
> Jack Whitham
> jack at cs.york.ac.uk
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080930/0bda2305/attachment.html>

From shweta3230 at gmail.com  Tue Sep 30 09:54:03 2008
From: shweta3230 at gmail.com (shweta mani)
Date: Tue, 30 Sep 2008 21:24:03 +0530
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <d13e157d0809300842q70838c3ex55c09e56c57c6213@mail.gmail.com>
References: <d13e157d0809280413x1ceee9c8mf33fe90c6abdf875@mail.gmail.com>
	<20080928130318.29191.1562573282.divmod.quotient.31312@ohm>
	<gbp2uu$7pr$1@ger.gmane.org> <20080929203753.GA20132@cs.york.ac.uk>
	<d13e157d0809300842q70838c3ex55c09e56c57c6213@mail.gmail.com>
Message-ID: <d13e157d0809300854n6799f385l87d851c096befc7d@mail.gmail.com>

from twisted.conch import error

from twisted.conch.ssh import transport, connection, keys, userauth,
channel, common

from twisted.internet import defer, protocol, reactor
import re
import Tkinter
from Tkinter import *
from tkMessageBox import *
from os.path import exists
from Tkinter import *
import commands
#from DT import demo
import shutil
from os.path import exists
import ftplib
import sys
from ftplib import FTP
from tkMessageBox import *
from tkFileDialog import asksaveasfilename
import string
from os import popen
from re import split
import Tkinter
import os

win = Tkinter.Tk();
Label(win,text='CARD UPLOAD UTILITY').pack(side=TOP)








        #btn=Tkinter.Button(win,text='LIST ALL SUB FILES',command =(lambda :
slist()))
        #btn.pack(side=BOTTOM)



def submit():
    login=textlog.get()
    password=textpass.get()
    if login=="" or password=="":
        showinfo('ERROR','PLEASE FILL THE NECESSARY DETAILS ')
    elif login=='m' and password=='m':

        print 'HELLO USER'
        top.withdraw()#closes current window
        import sys, getpass

        server = '10.144.17.2'

        command = 'ls -l'

        username = 'cteam'

        password = 'cteam'



        factory = ClientCommandFactory( username, password, command)

        reactor.connectTCP(server, 22, factory)

        reactor.run( )



class ClientCommandTransport(transport.SSHClientTransport):


    def __init__(self, username, password, command):

        self.username = username

        self.password = password

        self.command = command
        print "username",username
        print "password",password
        print "command",command


    def verifyHostKey(self, pubKey, fingerprint):

        # in a real app, you should verify that the fingerprint matches

        # the one you expected to get from this server

        return defer.succeed(True)



    def connectionSecure(self):

        self.requestService(

            PasswordAuth(self.username, self.password,

                         ClientConnection(self.command)))



class PasswordAuth(userauth.SSHUserAuthClient):

    def __init__(self, user, password, connection):

        userauth.SSHUserAuthClient.__init__(self, user, connection)

        self.password = password



    def getPassword(self, prompt=None):

        return defer.succeed(self.password)



class ClientConnection(connection.SSHConnection):

    def __init__(self, cmd, *args, **kwargs):

        connection.SSHConnection.__init__(self)

        self.command = cmd



    def serviceStarted(self):

        self.openChannel(CommandChannel(self.command, conn=self))



class CommandChannel(channel.SSHChannel):

    name = 'session'



    def __init__(self, command, *args, **kwargs):

        channel.SSHChannel.__init__(self, *args, **kwargs)

        self.command = command



    def channelOpen(self, data):

        self.conn.sendRequest(

            self, 'exec', common.NS(self.command),
wantReply=True).addCallback(

            self._gotResponse)



    def _gotResponse(self, _):

        self.conn.sendEOF(self)

    def dataReceived(self, data):
        #self.dat=date
        print "nenu",data
        dat=data
        #print"nenu1",dat
        lis(dat)
def lis(m):


        Label(win,text='%s'%m).pack(side=TOP)

        dirfm = Frame(win)
        dirsa=Scrollbar(dirfm)
        dirsb= Scrollbar(dirfm)
        dirsb.pack(side = RIGHT, fill =Y)

        dirs = Listbox(dirfm,height = 50, width = 70, yscrollcommand =
dirsb.set)
        textsfile = Entry(dirfm)
        def closed(self):

            reactor.stop( )
            print "nenuclose"


        #print"nenu" ,data[56]
        #print"nenu" ,data[57]
        #print"nenu" ,data[58]
        #print"nenu" ,data[59]
        #print"nenu" ,data[63]
        '''p=1
        for i in range(40,100):
            if(data[i]=='-' or data[i]=='x'):
                p=i
        print"nenu" ,data[p-9]
        #ClientCommandFactory(username, password, command)



        #__init__(self, username, password, command)'''






class ClientCommandFactory(protocol.ClientFactory):

    def __init__(self, username, password, command):

            self.username = username

            self.password = password

            self.command = command



    def buildProtocol(self, addr):

            protocol = ClientCommandTransport(

                self.username, self.password, self.command)

            return protocol



if __name__ == "__main__":
    top = Tkinter.Tk()
#to draw Label in the main page

    label = Tkinter.Label(top, text=' CARD UPLOAD UTILITY ' )
    label.pack()

#to draw Label

    label = Tkinter.Label(top, text='ENTER LOGIN  ')
    label.pack(side=LEFT,fill=X)

#to draw Textbox
    tv = Tkinter.StringVar( )
    textlog=Entry(top,width=20,textvariable=tv)
    textlog.pack(side=LEFT)


#to draw Label

    label = Tkinter.Label(top, text=' ENTER PASSWORD  ')
    label.pack(side=LEFT)

#to draw Textbox
    tv1 = Tkinter.StringVar( )
    textpass=Entry(top,width=20,textvariable=tv1)
    textpass.pack(side=LEFT)

#to draw submit
    submit=Tkinter.Button(top, text=' SUBMIT ',command=submit)
    submit.pack(side=LEFT)
    top.bind_all('<Return>',(lambda event: submit()))



#to draw Quit
    quit = Tkinter.Button(top, text='  QUIT  ',command=top.quit)
    quit.pack(side=LEFT)




    Tkinter.mainloop()


#put m as username and m as password

On Tue, Sep 30, 2008 at 9:12 PM, shweta mani <shweta3230 at gmail.com> wrote:

>  hi friends thanks for immediate reply.
> i have referred the book twisted..........
> currently i am facing the problem.
> i have to show ls -l output in a listbox using Tkinter
> but because of TCP it first stores information in a window or some packet
> format.
> so it doesnot show the output in a continuous manner.
>
>
>
> On Tue, Sep 30, 2008 at 2:07 AM, Jack Whitham <jack-tp at cs.york.ac.uk>wrote:
>
>> On Sun, Sep 28, 2008 at 02:11:49AM +0200, paul wrote:
>> > Hope this isn't too offensive but last time I checked conch didn't work
>> > on win32 (http://twistedmatrix.com/trac/ticket/50). I guess most users
>> > would be happy with a basic "secure RPC" implementation, no console
>> > stuff. No idea how much work that is though ...
>>
>> Conch does work on Win32, I have written an application that uses
>> it (not the command line client). You have to install pycrypto
>> in addition to Twisted.
>>
>>
>> --
>> Jack Whitham
>> jack at cs.york.ac.uk
>>
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20080930/909ab3b1/attachment.html>

From exarkun at divmod.com  Tue Sep 30 10:04:28 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 30 Sep 2008 12:04:28 -0400
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: <d13e157d0809300854n6799f385l87d851c096befc7d@mail.gmail.com>
Message-ID: <20080930160428.29191.46084701.divmod.quotient.32247@ohm>

On Tue, 30 Sep 2008 21:24:03 +0530, shweta mani <shweta3230 at gmail.com> wrote:
> [snip]

This isn't the right way to use Tk with Twisted.

See http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html#auto14

Jean-Paul



From frans.martensson at gmail.com  Tue Sep 30 10:06:58 2008
From: frans.martensson at gmail.com (=?ISO-8859-1?Q?Frans_M=E5rtensson?=)
Date: Tue, 30 Sep 2008 18:06:58 +0200
Subject: [Twisted-Python] sending signal through SSHChannel
Message-ID: <8cc9d3030809300906u1db77d9ag2abb2e5257ab6a57@mail.gmail.com>

Hello!

I have written a python program that executes shell scripts on remote
computers using the twisted conch SSHChannel. Several shell scripts
are executed at once on several machines and the scripts range in
execution time from minutes to hours.

My question is regarding the behavior of Conch when it is shut down.
What i would like to do is to send a SIGINT or SIGKILL to the remote
script so that it can terminate in an orderly fashion. I am using the
channel.SSHChannel as a base class for my task. Is there a mechanism
in Conch for sending this signal?

best regards

frans



From terry at jon.es  Tue Sep 30 10:25:14 2008
From: terry at jon.es (Terry Jones)
Date: Tue, 30 Sep 2008 18:25:14 +0200
Subject: [Twisted-Python] Re: DOUBTS PLEASE SOLVE
In-Reply-To: Your message at 12:04:28 on Tuesday, 30 September 2008
References: <d13e157d0809300854n6799f385l87d851c096befc7d@mail.gmail.com>
	<20080930160428.29191.46084701.divmod.quotient.32247@ohm>
Message-ID: <18658.21226.698619.512438@jon.es>

On Tue, 
[snip]



From glyph at divmod.com  Tue Sep 30 11:46:02 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 30 Sep 2008 17:46:02 -0000
Subject: [Twisted-Python] September 28 2008 Twisted Sprint Report
In-Reply-To: <20080930143015.29191.1292467146.divmod.quotient.32227@ohm>
References: 0
	<20080930143015.29191.1292467146.divmod.quotient.32227@ohm>
Message-ID: <20080930174602.31635.985444747.divmod.xquotient.461@weber.divmod.com>

On 02:30 pm, exarkun at divmod.com wrote:
>Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
>and myself accomplished this past Sunday at the Twisted sprint.

Great work, guys.  Sorry I couldn't make it.  Let's have another one 
soon :).



From exarkun at divmod.com  Tue Sep 30 11:45:14 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Tue, 30 Sep 2008 13:45:14 -0400
Subject: [Twisted-Python] October Twisted Sprint
In-Reply-To: <20080930174602.31635.985444747.divmod.xquotient.461@weber.divmod.com>
Message-ID: <20080930174514.29191.1502014325.divmod.quotient.32289@ohm>

On Tue, 30 Sep 2008 17:46:02 -0000, glyph at divmod.com wrote:
>On 02:30 pm, exarkun at divmod.com wrote:
>>Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
>>and myself accomplished this past Sunday at the Twisted sprint.
>
>Great work, guys.  Sorry I couldn't make it.  Let's have another one soon 
>:).
>

Yes, let's.  Who would be interested in attending a sprint on the 25th or
the 26th of October?

Jean-Paul



From radix at twistedmatrix.com  Tue Sep 30 12:04:19 2008
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Tue, 30 Sep 2008 14:04:19 -0400
Subject: [Twisted-Python] October Twisted Sprint
In-Reply-To: <20080930174514.29191.1502014325.divmod.quotient.32289@ohm>
References: <20080930174602.31635.985444747.divmod.xquotient.461@weber.divmod.com>
	<20080930174514.29191.1502014325.divmod.quotient.32289@ohm>
Message-ID: <60ed19d40809301104g733dcaf8k85b343a3c85ccc02@mail.gmail.com>

On Tue, Sep 30, 2008 at 1:45 PM, Jean-Paul Calderone <exarkun at divmod.com> wrote:
> On Tue, 30 Sep 2008 17:46:02 -0000, glyph at divmod.com wrote:
>>
>> On 02:30 pm, exarkun at divmod.com wrote:
>>>
>>> Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
>>> and myself accomplished this past Sunday at the Twisted sprint.
>>
>> Great work, guys.  Sorry I couldn't make it.  Let's have another one soon
>> :).
>>
>
> Yes, let's.  Who would be interested in attending a sprint on the 25th or
> the 26th of October?

That's particularly good timing for me, because I'm going to be taking
the following week as holiday from work. I'll be there.



-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/



From glyph at divmod.com  Tue Sep 30 12:49:33 2008
From: glyph at divmod.com (glyph at divmod.com)
Date: Tue, 30 Sep 2008 18:49:33 -0000
Subject: [Twisted-Python] October Twisted Sprint
In-Reply-To: <60ed19d40809301104g733dcaf8k85b343a3c85ccc02@mail.gmail.com>
References: <20080930174602.31635.985444747.divmod.xquotient.461@weber.divmod.com>
	<20080930174514.29191.1502014325.divmod.quotient.32289@ohm>
	<60ed19d40809301104g733dcaf8k85b343a3c85ccc02@mail.gmail.com>
Message-ID: <20080930184933.31635.727913623.divmod.xquotient.521@weber.divmod.com>

On 06:04 pm, radix at twistedmatrix.com wrote:
>On Tue, Sep 30, 2008 at 1:45 PM, Jean-Paul Calderone 
><exarkun at divmod.com> wrote:
>>On Tue, 30 Sep 2008 17:46:02 -0000, glyph at divmod.com wrote:
>>>
>>>On 02:30 pm, exarkun at divmod.com wrote:
>>>>
>>>>Here's a summary of what Chris Armstrong, Itamar Shtull-Trauring,
>>>>and myself accomplished this past Sunday at the Twisted sprint.
>>>
>>>Great work, guys.  Sorry I couldn't make it.  Let's have another one 
>>>soon
>>>:).
>>
>>Yes, let's.  Who would be interested in attending a sprint on the 25th 
>>or
>>the 26th of October?
>
>That's particularly good timing for me, because I'm going to be taking
>the following week as holiday from work. I'll be there.

That looks like a good time for me as well.



