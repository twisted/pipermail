<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to detect when there is nothing waiting	in	the event queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20detect%20when%20there%20is%20nothing%20waiting%0A%09in%09the%20event%20queue&In-Reply-To=4AAE6B42.7010606%40lumierevfx.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020417.html">
   <LINK REL="Next"  HREF="020422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to detect when there is nothing waiting	in	the event queue</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20detect%20when%20there%20is%20nothing%20waiting%0A%09in%09the%20event%20queue&In-Reply-To=4AAE6B42.7010606%40lumierevfx.com"
       TITLE="[Twisted-Python] How to detect when there is nothing waiting	in	the event queue">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Sep 14 15:16:32 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020417.html">[Twisted-Python] How to detect when there is nothing waiting in the	event queue
</A></li>
        <LI>Next message: <A HREF="020422.html">[Twisted-Python] How to detect when there is nothing waiting in the event queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20424">[ date ]</a>
              <a href="thread.html#20424">[ thread ]</a>
              <a href="subject.html#20424">[ subject ]</a>
              <a href="author.html#20424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04:11 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">markv at lumierevfx.com</A> wrote:
&gt;<i>Hi, we've been using Twisted in an internal project for the past 4
</I>&gt;<i>months. It's a system that polls for events from a web source (looping
</I>&gt;<i>call) and also accepts connections via perspective broker. Each of 
</I>&gt;<i>these
</I>&gt;<i>events is turned into a series of Deferreds that run various tasks. 
</I>&gt;<i>Some
</I>&gt;<i>of these tasks are long-running and can take several hours to complete.
</I>&gt;<i>
</I>&gt;<i>Because of this, it's very difficult to restart the server when we roll
</I>&gt;<i>out a new release.
</I>&gt;<i>
</I>&gt;<i>I've added a signal handler to catch SIGHUP and call stop() on the
</I>&gt;<i>looping call and stopListening() on the perspective broker Root. How 
</I>&gt;<i>can
</I>&gt;<i>I detect when all remaining Deferreds have fired so I can stop the
</I>&gt;<i>reactor safely, without stranding any running processes?
</I>
There's no way to know when &quot;all remaining Deferreds have fired&quot;.  Since 
Deferreds are general purpose and any part of Twisted may internally use 
them for anything they're suited for, this isn't really what you want 
anyway.  You want to know when all of *your* tasks have completed.  So, 
you should look at all the APIs you have which return Deferreds, decide 
which APIs need to be allowed to complete (perhaps it will be all of 
them) before shutdown can happen, and then instrument those APIs to keep 
track of their own status.  This may be as simple as internally adding a 
callback to the Deferreds being returned (before returning them), 
letting you know when each task has completed.  This should let you 
decide when things are quiet enough to shut down.

Jean-Paul

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020417.html">[Twisted-Python] How to detect when there is nothing waiting in the	event queue
</A></li>
	<LI>Next message: <A HREF="020422.html">[Twisted-Python] How to detect when there is nothing waiting in the event queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20424">[ date ]</a>
              <a href="thread.html#20424">[ thread ]</a>
              <a href="subject.html#20424">[ subject ]</a>
              <a href="author.html#20424">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
