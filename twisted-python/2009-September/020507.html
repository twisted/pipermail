<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Unit tests, inline callbacks,	and exception handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Unit%20tests%2C%20inline%20callbacks%2C%0A%09and%20exception%20handling&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020506.html">
   <LINK REL="Next"  HREF="020508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Unit tests, inline callbacks,	and exception handling</H1>
    <B>Patrick Hartling</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Unit%20tests%2C%20inline%20callbacks%2C%0A%09and%20exception%20handling&In-Reply-To="
       TITLE="[Twisted-Python] Unit tests, inline callbacks,	and exception handling">patrick at priority5.com
       </A><BR>
    <I>Thu Sep 24 12:51:25 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020506.html">[Twisted-Python] Twisted OpenSSL Server Debug Information
</A></li>
        <LI>Next message: <A HREF="020508.html">[Twisted-Python] Unit tests, inline callbacks,	and exception handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20507">[ date ]</a>
              <a href="thread.html#20507">[ thread ]</a>
              <a href="subject.html#20507">[ subject ]</a>
              <a href="author.html#20507">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are using nose and the twisted.trial.unittest.TestCase class from  
Twisted 8.2.0 to write tests that use inline callbacks. In one of the  
tests, we are trying to validate that the code will behave correctly  
by raising an exception if two clients with the same user name connect  
to a server. The basic test code is similar to this:

@inlineCallbacks
def testDuplicateConnect(self):
    server_port = random.randint(10000, 40000)
    server = Server()
    server.listen(port = server_port)

    client1 = Client(username = &quot;Test&quot;)
    yield client1.connect(port = server_port)

    try:
       client2 = Client(username = &quot;Test&quot;)
       yield client2.connect(port = server_port)
       assert False
    except UsernameAlreadyExists, ex:
       pass

    yield server.close()
    yield client.close()

The test method executes and returns successfully. The exception is  
raised and caught correctly, but because a  
twisted.python.failure.Failure object was seen during deferred  
processing, twisted.trial.unittest.TestCase._cleanUp() concludes that  
an error occurred. That is perhaps not the most accurate way of  
describing what happens, but the end result is that a caught exception  
ends up being reported as an error.

My question is this: are there any tips for performing exception  
handling in test methods that are decorated with @inlineCallbacks? I  
have been tracing through a lot of code trying to find any extension  
point, hook, etc. where I could indicate that the exception was caught  
correctly, but I have not found anything yet. Adding the obvious  
@raises decoration does not work because the method catches the  
exception. The closest I have come is to call  
self._observer._ignoreErrors() from the test method with the exception  
type in question, but that does not strike me as being on the right  
track.

  -Patrick


--
Patrick L. Hartling
Senior Software Engineer, Priority 5
<A HREF="http://www.priority5.com/">http://www.priority5.com/</A>

The information transmitted in this communication is intended only for
the person or entity to which it is addressed and contains proprietary
material. Any review, retransmission, dissemination or other use of, or
taking of any action in reliance upon, this information by persons or
entities other than the intended recipient is prohibited. If you
received this in error, please destroy any copies, contact the sender
and delete the material from any computer.


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020506.html">[Twisted-Python] Twisted OpenSSL Server Debug Information
</A></li>
	<LI>Next message: <A HREF="020508.html">[Twisted-Python] Unit tests, inline callbacks,	and exception handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20507">[ date ]</a>
              <a href="thread.html#20507">[ thread ]</a>
              <a href="subject.html#20507">[ subject ]</a>
              <a href="author.html#20507">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
