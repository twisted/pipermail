<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] FTPClient - aborting transfers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20FTPClient%20-%20aborting%20transfers&In-Reply-To=e554908b0909011551h501339f7of45672954d08338%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020343.html">
   <LINK REL="Next"  HREF="020384.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] FTPClient - aborting transfers</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20FTPClient%20-%20aborting%20transfers&In-Reply-To=e554908b0909011551h501339f7of45672954d08338%40mail.gmail.com"
       TITLE="[Twisted-Python] FTPClient - aborting transfers">exarkun at twistedmatrix.com
       </A><BR>
    <I>Fri Sep  4 09:29:06 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020343.html">[Twisted-Python] FTPClient - aborting transfers
</A></li>
        <LI>Next message: <A HREF="020384.html">[Twisted-Python] FTPClient - aborting transfers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20358">[ date ]</a>
              <a href="thread.html#20358">[ thread ]</a>
              <a href="subject.html#20358">[ subject ]</a>
              <a href="author.html#20358">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1 Sep, 10:51 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">matt at bennett.name</A> wrote:
&gt;<i>Hello all,
</I>&gt;<i>
</I>&gt;<i>I've got an FTPClient implementation very similar to the one at [1],
</I>&gt;<i>and I've added the ability to retrieve a file from the server with the
</I>&gt;<i>following snippet:
</I>&gt;<i>
</I>&gt;<i>class FileReceiver(Protocol):
</I>&gt;<i>    &quot;&quot;&quot;
</I>&gt;<i>        Protocol subclass that writes received data to a local file.
</I>&gt;<i>    &quot;&quot;&quot;
</I>&gt;<i>    def __init__(self, filename):
</I>&gt;<i>        self.file = open(filename, 'wb')
</I>&gt;<i>
</I>&gt;<i>    def dataReceived(self, data):
</I>&gt;<i>        self.file.write(data)
</I>&gt;<i>
</I>&gt;<i>receiver = FileReceiver(local_path)
</I>&gt;<i>d = ftpClient.retrieveFile(remote_path,receiver)
</I>&gt;<i>
</I>&gt;<i>I want to be able to abort the transfers if they've not completed
</I>&gt;<i>after a specific period of time. When the timeout is triggered, I call
</I>&gt;<i>ftpClient.transport.loseConnection() which seems to stop the dL on
</I>&gt;<i>line 109 of [1] from firing, but the data transfer continues until
</I>&gt;<i>completion. This is true for both storing and retrieving files.
</I>&gt;<i>
</I>&gt;<i>In the storing case, I thought that
</I>&gt;<i>twisted.protocols.basic.FileSender's stopProducing method might help,
</I>&gt;<i>but all it seems to do is trigger the errback for anyone waiting for a
</I>&gt;<i>response - the actual data transfer continues.
</I>&gt;<i>
</I>&gt;<i>How do I abort the transfer and clear the wire when the timeout fires?
</I>
The DTP connection is set as the (undocumented) dtpInstance attribute on 
the FTP instance it's associated with.  You can call loseConnection on 
that object's transport and the download should stop.  It might be 
worthwhile for someone to clean this up a bit.  Does it ever make sense 
for the transfer to continue when the control channel is gone?  Even if 
so, it'd be nice to have a supported (or at least documented) way to do 
this cleanup.

Jean-Paul

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020343.html">[Twisted-Python] FTPClient - aborting transfers
</A></li>
	<LI>Next message: <A HREF="020384.html">[Twisted-Python] FTPClient - aborting transfers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20358">[ date ]</a>
              <a href="thread.html#20358">[ thread ]</a>
              <a href="subject.html#20358">[ subject ]</a>
              <a href="author.html#20358">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
