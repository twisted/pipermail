<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Having touble with spread.pb un-serializing	an	object
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Having%20touble%20with%20spread.pb%20un-serializing%09an%0A%09object&In-Reply-To=20090923214226.1533.1467370706.divmod.xquotient.220%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020502.html">
   <LINK REL="Next"  HREF="020523.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Having touble with spread.pb un-serializing	an	object</H1>
    <B>Benjamin Ash</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Having%20touble%20with%20spread.pb%20un-serializing%09an%0A%09object&In-Reply-To=20090923214226.1533.1467370706.divmod.xquotient.220%40localhost.localdomain"
       TITLE="[Twisted-Python] Having touble with spread.pb un-serializing	an	object">bash at intelerad.com
       </A><BR>
    <I>Thu Sep 24 23:42:23 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020502.html">[Twisted-Python] Having touble with spread.pb un-serializing	an	object
</A></li>
        <LI>Next message: <A HREF="020523.html">[Twisted-Python] Having touble with spread.pb un-serializing	an	object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20512">[ date ]</a>
              <a href="thread.html#20512">[ thread ]</a>
              <a href="subject.html#20512">[ subject ]</a>
              <a href="author.html#20512">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jean-Paul,

Here is a sample server and client code that demonstrates the problem
with PB's unserialization code and objects that use __slots__.  The
SlotsObject class implements __slots__ and the NoSlotsObject does not.
The problem arises when de-serializing the SlotsObject.  The stack trace
is a little different than the original one I posted but the net-effect
is the same; an AttributeError exception.

Thanks,

-ben

sample.py (server and copyable objects):
&quot;&quot;&quot;
import sys
import os

from twisted.spread import pb
from twisted.internet import reactor

class BaseObject(object, pb.Copyable, pb.RemoteCopy):

    def __init__(self, name):
        self.name = name
        self.version = &quot;1&quot;
        self.release = &quot;2&quot;

    def __str__(self):
        return &quot;%s-%s-%s&quot; % (self.name, self.version, self.release)

class SlotsObject(BaseObject):
    &quot;&quot;&quot;
    Some object that implements __slots__
    &quot;&quot;&quot;
    __slots__ = [&quot;name&quot;, &quot;version&quot;, &quot;release&quot;]

    def __init__(self):
        super(SlotsObject, self).__init__(&quot;slots&quot;)

class NoSlotsObject(BaseObject):

    def __init__(self):
        super(NoSlotsObject, self).__init__(&quot;no-slots&quot;)

class SampleServer(pb.Root, object):
    &quot;&quot;&quot;
    Serve up some objects that implement __slots__.
    &quot;&quot;&quot;
    def remote_getSlotsObject(self):
        return SlotsObject()

    def remote_getNoSlotsObject(self):
        return NoSlotsObject()
    
def main():
    reactor.listenTCP(12346, pb.PBServerFactory(SampleServer()))
    reactor.run()

if __name__ == &quot;__main__&quot;:
    from sample import SlotsObject, NoSlotsObject
    main()
&quot;&quot;&quot;

sample client code:
&quot;&quot;&quot;
import sys
import os

from twisted.internet import reactor
from twisted.spread import pb
from twisted.python import util

from sample import SlotsObject, NoSlotsObject

pb.setUnjellyableForClass(SlotsObject, SlotsObject)
pb.setUnjellyableForClass(NoSlotsObject, NoSlotsObject)

def call(factory, name):
    remote = factory.getRootObject()
    remote.addCallback(lambda obj: obj.callRemote(name))
    remote.addCallback(lambda obj: util.println(&quot;name is %r&quot; % obj.name))
    remote.addErrback(lambda err: err.printTraceback())
    return remote

factory = pb.PBClientFactory()
reactor.connectTCP(&quot;localhost&quot;, 12346, factory)
call(factory, &quot;getSlotsObject&quot;)
remote = call(factory, &quot;getNoSlotsObject&quot;)
remote.addCallback(lambda _: reactor.stop())
reactor.run()
&quot;&quot;&quot;

Output:
&quot;&quot;&quot;
Traceback (most recent call last):
  File &quot;/usr/lib64/python2.5/site-packages/twisted/internet/defer.py&quot;, line 304, in _startRunCallbacks
    self._runCallbacks()
  File &quot;/usr/lib64/python2.5/site-packages/twisted/internet/defer.py&quot;, line 317, in _runCallbacks
    self.result = callback(self.result, *args, **kw)
  File &quot;/usr/lib64/python2.5/site-packages/twisted/internet/defer.py&quot;, line 281, in _continue
    self.unpause()
  File &quot;/usr/lib64/python2.5/site-packages/twisted/internet/defer.py&quot;, line 277, in unpause
    self._runCallbacks()
--- &lt;exception caught here&gt; ---
  File &quot;/usr/lib64/python2.5/site-packages/twisted/internet/defer.py&quot;, line 317, in _runCallbacks
    self.result = callback(self.result, *args, **kw)
  File &quot;./sample-client.py&quot;, line 17, in &lt;lambda&gt;
    remote.addCallback(lambda obj: util.println(&quot;name is %r&quot; % obj.name))
exceptions.AttributeError: name
name is 'no-slots'
&quot;&quot;&quot;

On Wed, Sep 23, 2009 at 09:42:26PM -0000, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
&gt;<i> On 07:06 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bash at intelerad.com</A> wrote:
</I>&gt;<i> &gt;Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I am trying to send new style classes that implement __slots__ with 
</I>&gt;<i> &gt;spread.pb.
</I>&gt;<i> &gt;Things seem to go awry when attempting to un-serialize the objects on 
</I>&gt;<i> &gt;the
</I>&gt;<i> &gt;client side.  I am not sure if this is a known issue.  How can I work 
</I>&gt;<i> &gt;around
</I>&gt;<i> &gt;this issue?
</I>&gt;<i> 
</I>&gt;<i> Perhaps the presence of __slots__ breaks PB's unserialization code.  Can 
</I>&gt;<i> you share a SSCCE (&lt;<A HREF="http://sscce.org/">http://sscce.org/</A>&gt;)?  Then perhaps it may make sense 
</I>&gt;<i> to file an enhancement ticket to support this case.
</I>&gt;<i> 
</I>&gt;<i> Jean-Paul
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>



Intelerad Medical Systems 
Central Station 
895, de la Gauchetiere W., Suite 400 
Montreal, QC Canada H3B 4G1 
www.intelerad.com   

This email or any attachments may contain confidential or legally privileged information intended for the sole use of the addressees. Any use, redistribution, disclosure, or reproduction of this information, except as intended, is prohibited. If you received this email in error, please notify the sender and remove all copies of the message, including any attachments.   
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020502.html">[Twisted-Python] Having touble with spread.pb un-serializing	an	object
</A></li>
	<LI>Next message: <A HREF="020523.html">[Twisted-Python] Having touble with spread.pb un-serializing	an	object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20512">[ date ]</a>
              <a href="thread.html#20512">[ thread ]</a>
              <a href="subject.html#20512">[ subject ]</a>
              <a href="author.html#20512">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
