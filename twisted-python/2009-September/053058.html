<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] AlreadyCalledError trying more than a server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AlreadyCalledError%20trying%20more%20than%20a%20server&In-Reply-To=%3C20090930141016.GG1931%40steerpike.home.puzzling.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053057.html">
   <LINK REL="Next"  HREF="053039.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] AlreadyCalledError trying more than a server</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AlreadyCalledError%20trying%20more%20than%20a%20server&In-Reply-To=%3C20090930141016.GG1931%40steerpike.home.puzzling.org%3E"
       TITLE="[Twisted-Python] AlreadyCalledError trying more than a server">andrew at bemusement.org
       </A><BR>
    <I>Wed Sep 30 08:10:16 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053057.html">[Twisted-Python] AlreadyCalledError trying more than a server
</A></li>
        <LI>Next message (by thread): <A HREF="053039.html">[Twisted-Python] I found an interisting comment about Twisted vs.	Erlang
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53058">[ date ]</a>
              <a href="thread.html#53058">[ thread ]</a>
              <a href="subject.html#53058">[ subject ]</a>
              <a href="author.html#53058">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Antonio Beamud Montero wrote:
&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> escribió:
</I>&gt;<i> &gt; I don't think you've shared enough of your code for anyone to figure out 
</I>&gt;<i> &gt; what you're doing wrong (aside from calling one Deferred's callback 
</I>&gt;<i> &gt; method more than once).  Your &quot;runall&quot; function above looks okay, so 
</I>&gt;<i> &gt; perhaps the problem is in some other part of your code.  An SSCCE 
</I>&gt;<i> &gt; (&lt;<A HREF="http://sscce.org/">http://sscce.org/</A>&gt;) would be the best thing for you to share
</I>&gt;<i> &gt;   
</I>&gt;<i> Yes, you're right. I've created an example with the minimal code to 
</I>&gt;<i> reproduce the problem.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://pastebin.com/f4e445dc3">http://pastebin.com/f4e445dc3</A>
</I>
This fails the “self-contained” criterion, by the way, as it assumes access to a
host called “romeo”.

[It also fairly clear isn't *completely* minimal either, e.g. I'm pretty sure
the addCallback(runall) is not required to see your problem.  I also suspect
that you only need one connection to demonstrate this bug, but because it's not
self-contained it's hard to tell how far from minimal it actually is.]

Anyhow, my guess (it has to be a guess, as your example isn't self-contained, so
I cannot run it to examine the problem for myself), is that the problem is that:

 a) you create one Deferred per connection (self.deferred in MyClientFactory),
    combined with...
 b) your lineReceived invokes gotData which often calls that deferred without
    any robust defence against calling that deferred multiple times.

e.g.  consider a server that sends &quot;221 2.0.0 Bye&quot; followed by a blank line.
The specific data triggering your problem should be obvious from the output of
your “print repr(data)” line in gotData.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053057.html">[Twisted-Python] AlreadyCalledError trying more than a server
</A></li>
	<LI>Next message (by thread): <A HREF="053039.html">[Twisted-Python] I found an interisting comment about Twisted vs.	Erlang
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53058">[ date ]</a>
              <a href="thread.html#53058">[ thread ]</a>
              <a href="subject.html#53058">[ subject ]</a>
              <a href="author.html#53058">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
