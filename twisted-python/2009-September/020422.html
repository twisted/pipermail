<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to detect when there is nothing waiting in the event queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20detect%20when%20there%20is%20nothing%20waiting%20in%0A%20the%20event%20queue&In-Reply-To=4AAE6B42.7010606%40lumierevfx.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020424.html">
   <LINK REL="Next"  HREF="020418.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to detect when there is nothing waiting in the event queue</H1>
    <B>Tim Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20detect%20when%20there%20is%20nothing%20waiting%20in%0A%20the%20event%20queue&In-Reply-To=4AAE6B42.7010606%40lumierevfx.com"
       TITLE="[Twisted-Python] How to detect when there is nothing waiting in the event queue">screwtape at froup.com
       </A><BR>
    <I>Mon Sep 14 20:58:25 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020424.html">[Twisted-Python] How to detect when there is nothing waiting	in	the event queue
</A></li>
        <LI>Next message: <A HREF="020418.html">[Twisted-Python] help with rector
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20422">[ date ]</a>
              <a href="thread.html#20422">[ thread ]</a>
              <a href="subject.html#20422">[ subject ]</a>
              <a href="author.html#20422">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Sep 14, 2009 at 12:11:46PM -0400, Mark Visser wrote:
&gt;<i> I've added a signal handler to catch SIGHUP and call stop() on the 
</I>&gt;<i> looping call and stopListening() on the perspective broker Root. How can 
</I>&gt;<i> I detect when all remaining Deferreds have fired so I can stop the 
</I>&gt;<i> reactor safely, without stranding any running processes?
</I>
I was looking at something like this for our production system a while
back; so far as I can tell, the only thing you can do is to maintain
a list of all 'live' deferreds as your process runs. When you get
the 'stop' signal, stop accepting incoming requests, put all the
deferreds into a DeferredList and don't exit until the DeferredList
fires. Our system makes it rather difficult to gather all possible
deferreds, and our processes only run for less than a minute, so we
decided to just put up with occasional lost processes.

As well as catching SIGHUP, you might want to investigate the reactor's
'addSystemEventTrigger' method, where you can queue calls to be called
at shutdown, and return a deferred that will cause the shutdown to be
delayed until the deferred fires.

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020424.html">[Twisted-Python] How to detect when there is nothing waiting	in	the event queue
</A></li>
	<LI>Next message: <A HREF="020418.html">[Twisted-Python] help with rector
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20422">[ date ]</a>
              <a href="thread.html#20422">[ thread ]</a>
              <a href="subject.html#20422">[ subject ]</a>
              <a href="author.html#20422">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
