<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Trial: Blocking until all deferreds have fired	in	test
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Trial%3A%20Blocking%20until%20all%20deferreds%20have%20fired%0A%09in%09test&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020514.html">
   <LINK REL="Next"  HREF="020516.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Trial: Blocking until all deferreds have fired	in	test</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Trial%3A%20Blocking%20until%20all%20deferreds%20have%20fired%0A%09in%09test&In-Reply-To="
       TITLE="[Twisted-Python] Trial: Blocking until all deferreds have fired	in	test">terry at jon.es
       </A><BR>
    <I>Fri Sep 25 17:25:59 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020514.html">[Twisted-Python] Trial: Blocking until all deferreds have fired in	test
</A></li>
        <LI>Next message: <A HREF="020516.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20515">[ date ]</a>
              <a href="thread.html#20515">[ thread ]</a>
              <a href="subject.html#20515">[ subject ]</a>
              <a href="author.html#20515">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Mark.

I'd write your FooListener class like this (untested):

class FooListener(object):
    def fooBar():
        d = doSomeSetup()
        d.addCallback(lambda ign: doSomethingThatReturnsADeferred())
        d.addCallbacks(lambda ign: 'success!', lambda ign: 'failure!')
        return d

And leave your unit test as is. Then the unit test (with the yield on
fooBar() will do the right thing. And your other (non-test) code will
continue to get what it was getting before.

BTW, it's a slight red flag (to me) that you're returning the 'failure!'
string as the value of the deferred (i.e., if an error happens, that
errback function returns a string, which is going to get you back onto the
callback chain in the deferred - since you're not raising or returning a
failure).  I say it's a red flag because I tried stuff like that once and
later realized that things are much cleaner if you just let Twisted handle
errors in it's normal way. To do so you could just drop the addErrback
above and let any error flow back to the caller of fooBar in the normal way
(on the errback chain) rather than trying to catch problems and return a
result on the callback chain that indicates an error (i.e., a string like
'failure!').

Hope that helps.

Terry

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020514.html">[Twisted-Python] Trial: Blocking until all deferreds have fired in	test
</A></li>
	<LI>Next message: <A HREF="020516.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20515">[ date ]</a>
              <a href="thread.html#20515">[ thread ]</a>
              <a href="subject.html#20515">[ subject ]</a>
              <a href="author.html#20515">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
