<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] PB/Remote Object/Deferred question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20PB/Remote%20Object/Deferred%20question&In-Reply-To=%3C1252517753.23380.1334004013%40webmail.messagingengine.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052893.html">
   <LINK REL="Next"  HREF="020386.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] PB/Remote Object/Deferred question</H1>
    <B>Peter Westlake</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20PB/Remote%20Object/Deferred%20question&In-Reply-To=%3C1252517753.23380.1334004013%40webmail.messagingengine.com%3E"
       TITLE="[Twisted-Python] PB/Remote Object/Deferred question">peter.westlake at pobox.com
       </A><BR>
    <I>Wed Sep  9 11:35:53 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052893.html">[Twisted-Python] PB/Remote Object/Deferred question
</A></li>
        <LI>Next message (by thread): <A HREF="020386.html">[Twisted-Python] PB/Remote Object/Deferred question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52894">[ date ]</a>
              <a href="thread.html#52894">[ thread ]</a>
              <a href="subject.html#52894">[ subject ]</a>
              <a href="author.html#52894">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 09 Sep 2009 12:39 -0400, &quot;John Crawford&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">cyclops at speakeasy.net</A>&gt;
wrote:
&gt;<i> I'm trying to understand the Perspective Broker, reading over the 
</I>&gt;<i> on-site documentation, specifically the article:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/pb-usage.html">http://twistedmatrix.com/projects/core/documentation/howto/pb-usage.html</A>
</I>&gt;<i> 
</I>&gt;<i> and there is a section about the callRemote() function that I really 
</I>&gt;<i> don't understand :)
</I>&gt;<i> 
</I>&gt;<i> First, consider these three lines:
</I>&gt;<i> 
</I>&gt;<i> d = factory.getRootObject()
</I>&gt;<i> d.addCallback(lambda object: object.callRemote(&quot;echo&quot;, &quot;hello network&quot;))
</I>&gt;<i> d.addCallback(lambda echo: 'server echoed: '+echo)
</I>&gt;<i> 
</I>&gt;<i> Second, the documentation says, &quot;...object.callRemote() returns a 
</I>&gt;<i> Deferred. Assuming the remote method was run without causing an 
</I>&gt;<i> exception (including an attempt to invoke an unknown method), the 
</I>&gt;<i> callback attached to that Deferred will be invoked with any objects 
</I>&gt;<i> that were returned by the remote method call.&quot;
</I>&gt;<i> 
</I>&gt;<i> If I read this correctly, callRemote() returns a whole new Deferred 
</I>&gt;<i> object, which is *not* the same as the 'd' Deferred object we already 
</I>&gt;<i> have. So that *new* Deferred should be the one that the next callback 
</I>&gt;<i> (line 3) is added to, since the next callback is based on the success 
</I>&gt;<i> of the callRemote(). So wouldn't these be the correct lines:
</I>&gt;<i> 
</I>&gt;<i> d = factory.getRootObject()
</I>&gt;<i> d2 = d.addCallback(lambda object: object.callRemote(&quot;echo&quot;, &quot;hello
</I>&gt;<i> network&quot;))
</I>&gt;<i> d2.addCallback(lambda echo: 'server echoed: '+echo)
</I>
Can I get in before someone else does? If I do, will I get it right?
Be kind, O wise ones!

Here goes:

d.addCallback always returns d. Remember that the callRemote is only
called once d is fired, so its result and the result of the lambda
expression are (simplifying a little) only computed after this piece
of code is long since over and done with. It just adds callback
functions (your lambda expressions) to the callback chain of d.
 
The result of each callback function is fed into the callback chain, to
be passed as parameter to the next callback.

Because the return value from the first callback is a Deferred, it is
not passed directly to the next callback. Instead processing pauses
until this new Deferred fires, and then the value it returns is passed
to the echo callback. It's a feature, and a most nifty one :-)

In summary:

factory.getRootObject returns a Deferred, d.

Two callbacks are added to d.

...time passes...

Something in the factory module finishes doing getRootObject
and passes the result (&quot;thing&quot;, say) to d: &quot;d.callback(thing)&quot;.

The first callback function uses it: &quot;object.callRemote(rootThing)&quot;.

callRemote returns a new Deferred, d2.

The code of Deferred.callback spots the callback has returned
a Deferred. It puts d2 aside in a safe place, and d.callback()
returns.

...time passes...

The callRemote gets an answer, and d2 fires. It doesn't have
any callbacks (that you know about, at least) so it returns
the value.

The code of Deferred.callback that previously stashed d2
notices that it has fired, picks up the value and passes
it along the next callback in d's chain, the lambda echo.


Regards,

Peter.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052893.html">[Twisted-Python] PB/Remote Object/Deferred question
</A></li>
	<LI>Next message (by thread): <A HREF="020386.html">[Twisted-Python] PB/Remote Object/Deferred question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52894">[ date ]</a>
              <a href="thread.html#52894">[ thread ]</a>
              <a href="subject.html#52894">[ subject ]</a>
              <a href="author.html#52894">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
