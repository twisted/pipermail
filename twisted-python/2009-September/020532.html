<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] AlreadyCalledError trying more than a server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20AlreadyCalledError%20trying%20more%20than%20a%20server&In-Reply-To=4AC1C4F6.1060609%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020530.html">
   <LINK REL="Next"  HREF="020552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] AlreadyCalledError trying more than a server</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20AlreadyCalledError%20trying%20more%20than%20a%20server&In-Reply-To=4AC1C4F6.1060609%40gmail.com"
       TITLE="[Twisted-Python] AlreadyCalledError trying more than a server">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Sep 29 12:24:43 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020530.html">[Twisted-Python] AlreadyCalledError trying more than a server
</A></li>
        <LI>Next message: <A HREF="020552.html">[Twisted-Python] AlreadyCalledError trying more than a server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20532">[ date ]</a>
              <a href="thread.html#20532">[ thread ]</a>
              <a href="subject.html#20532">[ subject ]</a>
              <a href="author.html#20532">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08:27 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">antonio.beamud at gmail.com</A> wrote:
&gt;<i>Hi all:
</I>&gt;<i>I've implemented my client as comes in twisted documentation
</I>&gt;<i>(FingerProxy example).
</I>&gt;<i>I want to connect with several machines at the same time, send and
</I>&gt;<i>receive data from this servers and start again (monitoring in one 
</I>&gt;<i>word).
</I>&gt;<i>
</I>&gt;<i>I've created a ClientFactory and a loop like this:
</I>&gt;<i>
</I>&gt;<i>    conf['hosts'] = [list of hostnames]
</I>&gt;<i>    commands = [list of string commands, like 'status' or 'temp']
</I>&gt;<i>    def runall(data):
</I>&gt;<i>        nodes = []
</I>&gt;<i>
</I>&gt;<i>        for h in conf['hosts']:
</I>&gt;<i>                mcf = manager.ClientFactory(commands)
</I>&gt;<i>                reactor.connectTCP(h, SERVER_PORT, mcf)
</I>&gt;<i>                nodes.append(mcf.deferred)
</I>&gt;<i>
</I>&gt;<i>        dlist = defer.DeferredList(nodes)
</I>&gt;<i>        dlist.addCallback(runall)
</I>&gt;<i>        dlist.addErrback(lambda _: None)
</I>&gt;<i>
</I>&gt;<i>Only when the ClientFactory receives a 'bye' response, call's the
</I>&gt;<i>d.callback('ok').
</I>&gt;<i>With a only host, works perfect, but trying to run against two o more
</I>&gt;<i>hosts, the next exception is raised:
</I>&gt;<i>
</I>&gt;<i>File &quot;/usr/lib/python2.6/site-packages/twisted/internet/defer.py&quot;, line
</I>&gt;<i>293, in _startRunCallbacks
</I>&gt;<i>    raise AlreadyCalledError
</I>&gt;<i>twisted.internet.defer.AlreadyCalledError:
</I>&gt;<i>
</I>&gt;<i>In my debug console:
</I>&gt;<i>
</I>&gt;<i>This is the deferredList
</I>&gt;<i>[&lt;Deferred at 0x84c3d6c&gt;, &lt;Deferred at 0x852d1ac&gt;]
</I>&gt;<i>...
</I>&gt;<i>IPv4Address(TCP, 'ira', 10162) &lt;Deferred at 0x84c3d6c&gt;
</I>&gt;<i>IPv4Address(TCP, 'lujuria', 10162) &lt;Deferred at 0x84c3d6c  current
</I>&gt;<i>result: 'ok'&gt;
</I>&gt;<i>
</I>&gt;<i>Twisted is invoking the same deferred, and chaining them, the 'ok'
</I>&gt;<i>result is produced by the 'ira' callback invokation instead using 
</I>&gt;<i>everly
</I>&gt;<i>deferred separately.
</I>&gt;<i>
</I>&gt;<i>What I'm doing wrong...?
</I>
I don't think you've shared enough of your code for anyone to figure out 
what you're doing wrong (aside from calling one Deferred's callback 
method more than once).  Your &quot;runall&quot; function above looks okay, so 
perhaps the problem is in some other part of your code.  An SSCCE 
(&lt;<A HREF="http://sscce.org/">http://sscce.org/</A>&gt;) would be the best thing for you to share.

Jean-Paul

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020530.html">[Twisted-Python] AlreadyCalledError trying more than a server
</A></li>
	<LI>Next message: <A HREF="020552.html">[Twisted-Python] AlreadyCalledError trying more than a server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20532">[ date ]</a>
              <a href="thread.html#20532">[ thread ]</a>
              <a href="subject.html#20532">[ subject ]</a>
              <a href="author.html#20532">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
