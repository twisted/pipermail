<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] getPeer() inside conch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20getPeer%28%29%20inside%20conch&In-Reply-To=%3Cd9047f780909291948n5e433b54l6b4a5cf1b82ec831%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053055.html">
   <LINK REL="Next"  HREF="053036.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] getPeer() inside conch</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20getPeer%28%29%20inside%20conch&In-Reply-To=%3Cd9047f780909291948n5e433b54l6b4a5cf1b82ec831%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] getPeer() inside conch">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Sep 29 20:48:54 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053055.html">[Twisted-Python] getPeer() inside conch
</A></li>
        <LI>Next message (by thread): <A HREF="053036.html">[Twisted-Python] AlreadyCalledError trying more than a server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53056">[ date ]</a>
              <a href="thread.html#53056">[ thread ]</a>
              <a href="subject.html#53056">[ subject ]</a>
              <a href="author.html#53056">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Sep 29, 2009 at 7:16 PM, Benjamin Rutt &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rutt.4 at osu.edu</A>&gt; wrote:

&gt;<i> The code:
</I>&gt;<i>
</I>&gt;<i>     print 'hello, peer %s' % (self.terminal.transport.getPeer())
</I>&gt;<i>
</I>&gt;<i> Fails with:
</I>&gt;<i>
</I>&gt;<i>     AttributeError: SSHSessionProcessProtocol instance has no attribute
</I>&gt;<i> 'getPeer'
</I>&gt;<i>
</I>
Oops.  Looks like my reading of the code was wrong.

One possible patch to twisted 8.2.0's conch/ssh/session.py's
&gt;<i> SSHSessionProcessProtocol class to add a getPeer() method would be:
</I>&gt;<i>
</I>

&gt;<i> +        client = self.session.conn.transport.transport.client
</I>&gt;<i> +        return address.IPv4Address('TCP', client[0], client[1])
</I>&gt;<i> Could someone comment on this?  (I'm fairly certain ssh runs over TCP, but
</I>&gt;<i> less certain that the mouthful self.session.conn.transport.transport.client
</I>&gt;<i> isn't invading layers of abstraction in an unfriendly way).  Thanks.
</I>&gt;<i>
</I>
So, nominally, all those things are public (none of them starts with an
underscore) but I'd have to sift through the code to understand exactly how
kosher they are (whether those attributes are a part of the interfaces in
question).

However, (A) 'TCP' isn't quite the right answer here, because actually
there's some SSH in the way, and (B) I am pretty sure there is a getPeer
closer than that.  In particular,

SSHSessionProcessProtocol.session is a twisted.conch.session.SSHSession
SSHSession subclasses twisted.conch.ssh.channel.SSHChannel
SSHChannel implements getPeer already.

So you *should* be able to do self.session.getPeer() and get something
useful.  I hope.

That said, the getPeer implementation in question should really be returning
an IAddress, not a tuple, so you can subclass or delegate to IPv4Address and
still access 'host' on the return value.

Independent of the grossness, if you can contribute some test coverage for
this, we could make the implementation less gross later :).  This is
especially important since hopefully many of these conch APIs will change in
the near future.  (z3p, are you planning on coming to the sprint this
week...?)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20090929/5c0bdf29/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053055.html">[Twisted-Python] getPeer() inside conch
</A></li>
	<LI>Next message (by thread): <A HREF="053036.html">[Twisted-Python] AlreadyCalledError trying more than a server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53056">[ date ]</a>
              <a href="thread.html#53056">[ thread ]</a>
              <a href="subject.html#53056">[ subject ]</a>
              <a href="author.html#53056">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
