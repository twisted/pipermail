<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] hang when using twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20hang%20when%20using%20twisted&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020481.html">
   <LINK REL="Next"  HREF="020469.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] hang when using twisted</H1>
    <B>gx1986 at mail.ustc.edu.cn</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20hang%20when%20using%20twisted&In-Reply-To="
       TITLE="[Twisted-Python] hang when using twisted">gx1986 at mail.ustc.edu.cn
       </A><BR>
    <I>Fri Sep 18 11:48:36 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020481.html">[Twisted-Python] What is the difference in	between	reactor.running and reactor._stopped
</A></li>
        <LI>Next message: <A HREF="020469.html">[Twisted-Python] hang when using twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20468">[ date ]</a>
              <a href="thread.html#20468">[ thread ]</a>
              <a href="subject.html#20468">[ subject ]</a>
              <a href="author.html#20468">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

I met some problem when writing twisted.

The code is

1 #! /usr/bin/python 
2 # fileName remoteCopyFile 
3 from twisted.internet import protocol , reactor 
4 import os 
5 import updateCurrentIPList 
6 import time 
7
8 PORT = 7777 
9
10 class TSClientProtocol(protocol.Protocol): 
11     def sendData(self): 
12         path = '/usr/local/'+self.factory.filename 
13         if os.path.isfile(path): 
14             f = open(path,'rb') 
15             data = f.read() 
16             f.close() 
17             self.transport.write(&quot;filename=&quot;+self.factory.filename+'=') 
18             self.transport.write(data) 
19             self.transport.write('EOF') 
20         else: 
21             self.transport.loseConnection() 
22
23     def connectionMade(self): 
24             self.sendData()
25             
26 
27     def dataReceived(self,data): 
28             if data == 'EOF': 
29             print 'finished'	
30             self.transport.loseConnection()	
31
32
33 class TSClientFactory(protocol.ClientFactory): 
34     def __init__(self,filename): 
35            self.filename = filename 
36            protocol = TSClientProtocol 
37            clientConnectionLost = clientConnectionFailed = lambda self,connector,reason:reactor.stop() 
38 
39     def remoteCopyFile(HOST,filename = '4'): 
40            reactor.connectTCP(HOST,PORT,TSClientFactory(filename)) 
41            reactor.run(installSignalHandlers=0) 
42            updateCurrentIPList.updateCurrentIPList(HOST) 
43            reactor.connectTCP(HOST,PORT,TSClientFactory('currentIP')) 
44            reactor.run(installSignalHandlers=0) 
45            
46
47 if __name__ == '__main__': 
48     remoteCopyFile('127.0.0.1')


The program print two &quot;finished&quot;,then hang.
If i delete the line 40 and 41  or delete the line 43 and 44 ,the program become good.
whether can't we use two &quot;reactor.run()&quot; in one function? why?
Thank you! 

</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020481.html">[Twisted-Python] What is the difference in	between	reactor.running and reactor._stopped
</A></li>
	<LI>Next message: <A HREF="020469.html">[Twisted-Python] hang when using twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20468">[ date ]</a>
              <a href="thread.html#20468">[ thread ]</a>
              <a href="subject.html#20468">[ subject ]</a>
              <a href="author.html#20468">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
