<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] newbie: connecting to a PB service from a web resource
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20newbie%3A%20connecting%20to%20a%20PB%20service%20from%20a%20web%20resource&In-Reply-To=20021101145921.12f621cc.paul%40nfg.nl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002181.html">
   <LINK REL="Next"  HREF="002185.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] newbie: connecting to a PB service from a web resource</H1>
    <B>Donovan Preston</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20newbie%3A%20connecting%20to%20a%20PB%20service%20from%20a%20web%20resource&In-Reply-To=20021101145921.12f621cc.paul%40nfg.nl"
       TITLE="[Twisted-Python] newbie: connecting to a PB service from a web resource">dp at twistedmatrix.com
       </A><BR>
    <I>Fri Nov  1 10:38:27 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="002181.html">[Twisted-Python] newbie: connecting to a PB service from a web resource
</A></li>
        <LI>Next message: <A HREF="002185.html">[Twisted-Python] newbie: connecting to a PB service from a web resource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2182">[ date ]</a>
              <a href="thread.html#2182">[ thread ]</a>
              <a href="subject.html#2182">[ subject ]</a>
              <a href="author.html#2182">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It's fairly simple, there's just one important detail you're missing -- 
in order to get a node factory_* to wait for a deferred, you have to 
return it. (Ah, the joys of async programming.) Since you're also 
dealing with a series of deferreds, it's even more tricky. Here's what 
you do:

In the factory_getStatus method, get the first Deferred by calling 
connect. Add a callback to it and make sure you pass the node to the 
callback. Return the Deferred. (DOMTemplate will know that in order to 
render this node, it will have to wait for the results of the Deferred.)

In the readStatus callback method (whose signature should be modified 
to accept the node you passed to the callback above), get the second 
deferred, add the setResult callback to it, and pass the node along to 
that callback as well. *Return the Deferred*. (DOMTemplate sees that 
the results of the first Deferred are a second Deferred. It knows that 
in order to render this node, it will have to wait for the results of 
the second Deferred.)

Finally, in the setResult callback method (whose signature should be 
modified to accept the node), you have the result data you wish to 
insert into the node. You also have a reference to the node, since you 
passed it along though all the callbacks. Mutate the node (clear it, 
then node.appendChild(self.d.createTextNode(&quot;%s&quot;, result))) and *Return 
the node*. (DOMTemplate sees that the results of the second deferred 
are a node, and it will be inserted into the DOM (in this case, since 
the returned node is the same as the node that was passed in, nothing 
happens) and when the DOM is rendered to XML your data will be in it.)

Why is this fairly complicated procedure required? Well, in the 
original factory_getStatus, you call self.connect() which immediately 
returns a Deferred. You assume that self.result is ready -- this is not 
the case. Since the data will not be ready until the callback has 
fired, you have to defer doing the actual work until the callback, as 
well.

Donovan

On Friday, November 1, 2002, at 05:59 AM, Paul Stevens wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I'm trying to build a small webapp that will allow me to connect to a 
</I>&gt;<i> remote PB
</I>&gt;<i> service. Results from the remote calls are to be used in a simple DOM 
</I>&gt;<i> template.
</I>&gt;<i>
</I>&gt;<i> Is this feasable ?
</I>&gt;<i>
</I>&gt;<i> I've got all the building blocks functioning alright, using the 
</I>&gt;<i> pbquote.py and
</I>&gt;<i> pbquoteclient.py code as examples.
</I>&gt;<i>
</I>&gt;<i> However, when I try to integrate the code from the commandline client 
</I>&gt;<i> into the
</I>&gt;<i> dom resource, I'm lost.
</I>&gt;<i>
</I>&gt;<i> How can I make sure the client waits a while -- until all callbacks are
</I>&gt;<i> handled ?
</I>&gt;<i>
</I>&gt;<i> I can see the refcount growing on the server side each time I connect 
</I>&gt;<i> to the
</I>&gt;<i> clientside webserver. But how to disconnect.
</I>&gt;<i>
</I>&gt;<i> Clues or pointers anyone ? Thanks.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i>   ________________________________________________________________
</I>&gt;<i>   Paul Stevens                                  mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">paul at nfg.nl</A>
</I>&gt;<i>   NET FACILITIES GROUP                     PGP: finger <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">paul at nfg.nl</A>
</I>&gt;<i>   The <A HREF="Netherlands________________________________http://www.nfg.nl">Netherlands________________________________http://www.nfg.nl</A>
</I>&gt;<i> &lt;webstatusreporter.py&gt;
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002181.html">[Twisted-Python] newbie: connecting to a PB service from a web resource
</A></li>
	<LI>Next message: <A HREF="002185.html">[Twisted-Python] newbie: connecting to a PB service from a web resource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2182">[ date ]</a>
              <a href="thread.html#2182">[ thread ]</a>
              <a href="subject.html#2182">[ subject ]</a>
              <a href="author.html#2182">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
