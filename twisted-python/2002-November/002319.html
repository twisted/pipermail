<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] mail and web server authentication: yet to come or already there?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20mail%20and%20web%20server%20authentication%3A%20yet%20to%20come%0A%20or%20already%20there%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002312.html">
   <LINK REL="Next"  HREF="002320.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] mail and web server authentication: yet to come or already there?</H1>
    <B>Stefano Debenedetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20mail%20and%20web%20server%20authentication%3A%20yet%20to%20come%0A%20or%20already%20there%3F&In-Reply-To="
       TITLE="[Twisted-Python] mail and web server authentication: yet to come or already there?">ste at webaccess.mozquito.com
       </A><BR>
    <I>Thu Nov 21 19:48:25 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="002312.html">[Twisted-Python] mail and web server authentication: yet to come or already there?
</A></li>
        <LI>Next message: <A HREF="002320.html">[Twisted-Python] mail and web server authentication: yet to come or already there?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2319">[ date ]</a>
              <a href="thread.html#2319">[ thread ]</a>
              <a href="subject.html#2319">[ subject ]</a>
              <a href="author.html#2319">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Andrew, thanks a lot for the answer, I write some more comments inline:

Andrew Bennetts wrote:
&gt;<i> On Wed, Nov 20, 2002 at 09:42:08PM +0100, Stefano Debenedetti wrote:
</I>&gt;&gt;<i>(is HTTP 
</I>&gt;&gt;<i>basic auth implemented somewhere btw?)  
</I>&gt;<i> 
</I>&gt;<i> I *think* twisted.web.guard has this functionality... I've heard it's going
</I>&gt;<i> to be overhauled at some point, it's not as nice as it could be.
</I>
Unfortunately this seems to handle authentication at an application level while I need to use HTTP protocol authentication mechanisms, ok I'll have to give it a go myself.
 
&gt;<i> I'm even less of a twisted.mail expert than a twisted.web expert, but I
</I>&gt;<i> think that twisted.mail's auth stuff predates twisted.cred, and we haven't
</I>&gt;<i> had time to migrate it to twisted.cred yet.
</I>
Again, I'm going to try and do that, of course it would be easier if I had some more samples of twisted.cred I could start from :-)
 
&gt;<i> Hmm.  That looks like a dubious change to me.  Wouldn't that fail for
</I>&gt;<i> headers like:
</I>&gt;<i>     To: Mr. Example &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dude at example.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> I'm not familiar with smtp.py though...
</I>
:<i>-) seems you are victim of a similar misunderstanding of SMTP that I had until recently: MAIL FROM and RCPT TO can only specify a mail address (in angle brackets). Headers like:
</I> 
To: Mr. Example &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dude at example.com</A>&gt;

go after the DATA command so they are not affected by this modification. 
Indeed the current code is already handling RFC821 correctly, as that RFC doesn't allow to put spaces after the column and before the first angle bracket but I have at least one mailer that does that and I've seen other SMTP implementations that forgive that (for example see [1]), so I'll post my patch here again:

$ diff -u smtp.py_orig smtp.py
--- smtp.py_orig        2002-11-01 05:47:10.000000000 +0100
+++ smtp.py     2002-11-22 00:04:24.000000000 +0100
@@ -122,7 +122,7 @@
         self.transport.loseConnection()

     def do_MAIL(self, rest):
-        from_ = rest[len(&quot;MAIL:&lt;&quot;):-len(&quot;&gt;&quot;)]
+        from_ = rest[string.find(rest, &quot;&lt;&quot;)+1:-len(&quot;&gt;&quot;)]
         self.validateFrom(self.__helo, from_, self._fromValid,
                                               self._fromInvalid)

@@ -134,7 +134,7 @@
         self.sendCode(550, 'No mail for you!')

     def do_RCPT(self, rest):
-        to = rest[len(&quot;TO:&lt;&quot;):-len(&quot;&gt;&quot;)]
+        to = rest[string.find(rest, &quot;&lt;&quot;)+1:-len(&quot;&gt;&quot;)]
         user = User(to, self.__helo, self, self.__from)
         self.validateTo(user, self._toValid, self._toInvalid)
 
If you think it is not correct to be forgiving towards non-RFC-compliant mailers, fine but IMHO some modifications to the existing code should be done anyway, otherwise mailers that send that space won't receive any error message and think everything went OK but twisted.mail won't be able to send the mail because as things are now it will try to send it to: &quot;&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dude at example.com</A>&quot; therefore failing silently (from sender's perspective).
 
&gt;<i> 1. Twisted doesn't require any C modules to be compiled -- they're basically
</I>&gt;<i>    just optional speed-ups.  In fact the only C module in Twisted that works
</I>&gt;<i>    on Windows is cBanana; cReactor and portmap don't apply to Windows
</I>&gt;<i>    because it doesn't have the relevant APIs.
</I>&gt;<i> 
</I>&gt;<i> 2. I've heard it's possible to use the mingw port of gcc to compile python
</I>&gt;<i>    extensions... search comp.lang.python or google for details.
</I>
Yes but the setup.py installer tries to compile at least cBanana and fails if that fails. I tried to use mingw but I end up with a long list of compilation errors, I am probably still doing something wrong and by googling I get to three or four fairly different explanations of how to do that so I guess it's still not as straightforward as a dummy user like me would require, anyway if it's not important I'll leave that aside for now :-)

So even at the second attempt the only way to run the Twisted installer for me was to remove the parts of setup.py that mention external modules, that makes me feel like a bad boy but I found no other solution.
 
&gt;<i> Eek.  The UI shouldn't crash, but regardless usually I use &quot;runtests -t&quot;,
</I>&gt;<i> i.e. run in text mode.
</I>&gt;<i> 
</I>&gt;<i> Unfortunately Win32 support isn't 100% -- which tests are failing for you?
</I>
Thanks for the -t tip. I found out that the testcases hang only if I use the cygwin python and that they behave differently if I run them with the -t flag, I copy here (by hand) the outputs of the graphical UI, both under cygwin and with regular python:

under cygwin the graphical UI hangs while running test #155, with 181 tests remaining, after notifying the following:

Failure: testLongFileListings (twisted.test.test_ftp.FTPPassiveClientAndServerTest)
Failure: testRetr (twisted.test.test_ftp.FTPPassiveClientAndServerTest)
Failure: testCorrectOrder (twisted.test.test_internet.callFromThreadTestCase)
Error: testCorrectOrder (twisted.test.test_internet.callFromThreadTestCase)

outside of cygwin the UI doesn't crash and manages to complete the tests, here are the results:

Failure: testRetr (twisted.test.test_ftp.FTPPassiveClientAndServerTest)
Failure: test_internet (twisted.test.test_import.AtLeastImportTestCase)
Failure: testCallLater (twisted.test.test_internet.InterfaceTestCase)
Failure: testCorrectOrder (twisted.test.test_internet.callFromThreadTestCase)
Error: testCorrectOrder (twisted.test.test_internet.callFromThreadTestCase)
Error: testOutput (twisted.test.test_iutils.UtilsTestCase)
Error: testValue (twisted.test.test_iutils.UtilsTestCase)
Failure: testNoPermission (twisted.test.test_logfile.LogFileTestCase)
Error: testEcho (twisted.test.test_process.ProcessTestCase)
Error: testProcess (twisted.test.test_process.ProcessTestCase)
Error: testStdinReader (twisted.test.test_process.Win32ProcessTestCase)
Failure: testRebuild (twisted.test.test_rebuild.RebuildTestCase)
Failure: testCannotBind (twisted.test.test_tcp.CannotBindTestCase)
Error: testReconnect (twisted.test.test_tcp.ConnectorTestCase)
Error: testUserFail (twisted.test.test_tcp.ConnectorTestCase)
Error: testUserFail (twisted.test.test_tcp.ConnectorTestCase)
Error: testFailing (twisted.test.test_tcp.LoopbackTestCase)
Error: testMessages (twisted.test.test_unix.UnixSocketTestCase)

Please find attached also the results of the tests with the -t flag, also both under cygwin and with regular python, the tests outside of cygwin gave me different results on different executions so the files inside the zip I attach are four.

Maybe I should think twice about that potato-frying job, don't wanna go back to java.... :-)

thanks, ciao
ste

[1] <A HREF="http://jakarta.apache.org/james/">http://jakarta.apache.org/james/</A>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: runtests_output.zip
Type: application/x-zip-compressed
Size: 6508 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20021122/f6049e48/attachment.bin">http://twistedmatrix.com/pipermail/twisted-python/attachments/20021122/f6049e48/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002312.html">[Twisted-Python] mail and web server authentication: yet to come or already there?
</A></li>
	<LI>Next message: <A HREF="002320.html">[Twisted-Python] mail and web server authentication: yet to come or already there?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2319">[ date ]</a>
              <a href="thread.html#2319">[ thread ]</a>
              <a href="subject.html#2319">[ subject ]</a>
              <a href="author.html#2319">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
