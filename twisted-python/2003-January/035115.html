<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] RE: How do I upload files using FTPClient?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20RE%3A%20How%20do%20I%20upload%20files%20using%20FTPClient%3F&In-Reply-To=%3CSpringmail.0994.1042584182.0.87573800%40webmail.pas.earthlink.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="035107.html">
   <LINK REL="Next"  HREF="035116.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] RE: How do I upload files using FTPClient?</H1>
    <B> Daniel Burr</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20RE%3A%20How%20do%20I%20upload%20files%20using%20FTPClient%3F&In-Reply-To=%3CSpringmail.0994.1042584182.0.87573800%40webmail.pas.earthlink.net%3E"
       TITLE="[Twisted-Python] RE: How do I upload files using FTPClient?">ldanielburr at earthlink.net
       </A><BR>
    <I>Tue Jan 14 15:43:02 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="035107.html">[Twisted-Python] RE: How do I upload files using FTPClient?
</A></li>
        <LI>Next message (by thread): <A HREF="035116.html">[Twisted-Python] RE: How do I upload files using FTPClient?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35115">[ date ]</a>
              <a href="thread.html#35115">[ thread ]</a>
              <a href="subject.html#35115">[ subject ]</a>
              <a href="author.html#35115">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
WARNING!  Long-winded, and perhaps clueless post ahead!

As discussed earlier in this thread, here is a rough sketch of how I think
a high-level interface to twisted.protocols.ftp.FTPClient should look.

Currently, twisted.protocols.ftp contains mostly FTP-related classes; there
is only one module-level method, &quot;parsePWDResponse&quot;.  I am thinking that we
could just implement the high-level client interface as methods within the
current twisted.protocols.ftp module.

Ideally, I'd like to be able to use it like so:

---------------------------------------------------------------------------
import os

from twisted.protocols import ftp

def deploy(self, appRoot, filePaths):
        &quot;&quot;&quot;
        Deploy code to an ftp server

        appRoot - string containing the root directory of some app
        filePaths - list or tuple containing absolute filepaths
        &quot;&quot;&quot;

        try:
            ftp.connect(host='foo.bar.org',
                        port=21,
                        user='anonymous'
                        password='<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">anonymous at anonymous.net</A>')

        except ftp.ConnectionFailed:
            return False

        else:
            for filePath in filePaths:
                fileDirectory, fileName = os.path.split(filePath)
                uploadDirectory = '%s/%s' % (appRoot, fileDirectory)

                if ftp.pwd() != (uploadDirectory):
                    try:
                        ftp.cd(uploadDirectory)

                    except ftp.DirDoesNotExist:
                        makeDirectory(uploadDirectory)
                        ftp.cd(uploadDirectory)

                    ftp.binary()
                    ftp.put(fileName)

            ftp.quit()
            return True

def makeDirectory(self, path):
    &quot;&quot;&quot;
    Recursively create directories on the FTP server
    &quot;&quot;&quot;

    parent, base = os.path.split(path)

    try:
        ftp.cd(parent)
        ftp.mkdir(base)

    except ftp.DirDoesNotExist:
        makeDirectory(parent)
        ftp.cd(parent)
        ftp.mkdir(base)
---------------------------------------------------------------------------


This code is pretty naive, to be sure, and not at all Twisted.  However, it
does hopefully illustrate the way I would like to interact with an FTP
client.  The &quot;deploy&quot; function could be refactored to use Deferreds pretty
easily; the &quot;makeDirectory&quot; function would be similarly simple.


As for the interface to FTPClient, I've outlined my thoughts below.  Note
that my immediate itch only calls for &quot;cd&quot;, &quot;pwd&quot;, &quot;mkdir&quot;, and &quot;put&quot;, of
which only &quot;mkdir&quot; and &quot;put&quot; need to be implemented.  It'd be cool, down
the road, to implement &quot;mget&quot; and friends, so that my sample code above
could be reduced even further, by removing the need to loop through the
list of file paths and transfer files one at a time.

My overall, grand ambition is to tie all of this together into a handy
code deployment tool that can pull versioned code from multiple source
control solutions, and deploy it using a variety of protocols.


---------------------------------------------------------------------------
# a module level variable to which we will bind an instance of FTPClient
theClient = None

def append(localFile, remoteFile=localFile)
    &quot;&quot;&quot;
    Append the contents of a file on the client to a file on the server

    localFile  - string containing the name of the file on the client
    remoteFile - string containing the name of the file on the server;
                 defaults to the same name as the file on the client
    &quot;&quot;&quot;

def ascii():
    &quot;&quot;&quot;
    Set the transfer type to ascii (TYPE A)
    &quot;&quot;&quot;

def binary():
    &quot;&quot;&quot;
    Set the transfer type to binary (TYPE I)
    &quot;&quot;&quot;

def bye():
    &quot;&quot;&quot;
    Close the connection and exit the client
    &quot;&quot;&quot;

def cd(remoteDirectory):
    &quot;&quot;&quot;
    Change directory on the server (CWD)

    remoteDirectory - string containing the directory name
    &quot;&quot;&quot;

def close():
    &quot;&quot;&quot;
    Close the connection, but do not exit the client
    &quot;&quot;&quot;

def connect(host, port, userID='anonymous', password='<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">foo at bar.org</A>'):
    &quot;&quot;&quot;
    Connect to an FTP server

    This function will create an instance of FTPClient and bind it to
    &quot;theClient&quot;, a module-level variable which we will treat like a
    singleton, so all these functions have an instance to work with
    &quot;&quot;&quot;

def delete(remoteFile):
    &quot;&quot;&quot;
    Delete a file from the server

    remoteFile - string containing the name of the file on the server
    &quot;&quot;&quot;

def debug():
    &quot;&quot;&quot;
    Toggle debugging mode on/off

    If debugging mode is on, debug info will be logged to some default file
    &quot;&quot;&quot;

def disconnect():
    &quot;&quot;&quot;
    Close the connection, but do not exit the client
    &quot;&quot;&quot;

def get(remoteFile, localFile=remoteFile):
    &quot;&quot;&quot;
    Transfer a file from the server to the client
    
    remoteFile - string containing the name of the file on the server
    localFile  - string containing the name of the file on the client;
                 defaults to the same name as the file on the server
    &quot;&quot;&quot;

def literal(command):
    &quot;&quot;&quot;
    Send arbitrary FTP command

    command - string containing the line to be sent as a command
    &quot;&quot;&quot;

def mdelete(remoteFiles):
    &quot;&quot;&quot;
    Delete multiple files from the server

    remoteFiles - list or tuple of filepaths on the server
    &quot;&quot;&quot;

def mget(remoteFiles):
    &quot;&quot;&quot;
    Transfer multiple files from the server to the client

    remoteFiles - list or tuple of filepaths on the server
    &quot;&quot;&quot;

def mkdir(directory):
    &quot;&quot;&quot;
    Create a directory on the server

    directory - string containing an absolute or relative path
    &quot;&quot;&quot;

def mput(localFiles):
    &quot;&quot;&quot;
    Transfer multiple file from the client to the server

    localFiles - list or tuple of filepaths on the client
    &quot;&quot;&quot;

def put(localFile, remoteFile=localFile):
    &quot;&quot;&quot;
    Transfer a file from the client to the server

    localFile  - string containing the name of the file on the client
    remoteFile - string containing the name of the file on the server;
                 defaults to the same name as the file on the client
    &quot;&quot;&quot;

def quit():
    &quot;&quot;&quot;
    Close the connection and exit the client
    &quot;&quot;&quot;

def rmdir(directory):
    &quot;&quot;&quot;
    Delete a directory on the server

    directory - string containing an absolute or relative path
    &quot;&quot;&quot;
---------------------------------------------------------------------------


Well, that's my brain dump for now.  Be as harsh as you like in criticizing;
I have a thick hide, and I'm trying to learn, so don't pull any punches.
If anyone thinks it should be entirely different, that's fantastic, and I
want to hear about it.

L. Daniel Burr



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="035107.html">[Twisted-Python] RE: How do I upload files using FTPClient?
</A></li>
	<LI>Next message (by thread): <A HREF="035116.html">[Twisted-Python] RE: How do I upload files using FTPClient?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35115">[ date ]</a>
              <a href="thread.html#35115">[ thread ]</a>
              <a href="subject.html#35115">[ subject ]</a>
              <a href="author.html#35115">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
