<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deferred execution, timeouts, and unhandled exceptions 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred%20execution%2C%20timeouts%2C%20and%20unhandled%20exceptions%20&In-Reply-To=20030118.181410.17861993.glyph%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002650.html">
   <LINK REL="Next"  HREF="002653.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deferred execution, timeouts, and unhandled exceptions </H1>
    <B>Bob Ippolito</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred%20execution%2C%20timeouts%2C%20and%20unhandled%20exceptions%20&In-Reply-To=20030118.181410.17861993.glyph%40twistedmatrix.com"
       TITLE="[Twisted-Python] Deferred execution, timeouts, and unhandled exceptions ">bob at redivi.com
       </A><BR>
    <I>Sat Jan 18 20:57:26 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="002650.html">[Twisted-Python] Deferred execution, timeouts, and unhandled exceptions 
</A></li>
        <LI>Next message: <A HREF="002653.html">[Twisted-Python] 1.0.2alpha4 test failures on Alpha, PPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2651">[ date ]</a>
              <a href="thread.html#2651">[ thread ]</a>
              <a href="subject.html#2651">[ subject ]</a>
              <a href="author.html#2651">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Saturday, Jan 18, 2003, at 19:14 America/New_York, Glyph Lefkowitz 
wrote:

&gt;<i>
</I>&gt;<i> On Sat, 18 Jan 2003 14:43:00 -0500, Bob Ippolito &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bob at redivi.com</A>&gt; 
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> What bothers me most isn't that an exception is being raised, but 
</I>&gt;&gt;<i> that it is
</I>&gt;&gt;<i> impossible to reasonably catch that exception unless you subclass or
</I>&gt;&gt;<i> otherwise do some nasty modifications to the reactor, deferred, or 
</I>&gt;&gt;<i> whichever
</I>&gt;&gt;<i> class causes the exception.
</I>&gt;<i>
</I>&gt;<i> I believe that I expressed concerns when setTimeout was originally 
</I>&gt;<i> proposed,
</I>&gt;<i> noting that only the system firing the callback can reasonably 
</I>&gt;<i> terminate
</I>&gt;<i> whatever process is doing the callback.
</I>&gt;<i>
</I>&gt;<i> The meaning of &quot;cancel&quot; is domain-dependant, so if we want a general 
</I>&gt;<i> way of
</I>&gt;<i> doing this then we need a way to express cancellation in the code 
</I>&gt;<i> which expects
</I>&gt;<i> to be calling the callback.  I think that the system that calls the 
</I>&gt;<i> callback is
</I>&gt;<i> usually the one that creates the Deferred, so perhaps we could have an 
</I>&gt;<i> optional
</I>&gt;<i> argument to the constructor, cancelCallback.
</I>&gt;<i>
</I>&gt;<i> I can't help but feel this is a really ugly corner case, which would be
</I>&gt;<i> inconvenient to effectively force everyone who uses a Deferred to 
</I>&gt;<i> implement in
</I>&gt;<i> order for setTimeout to be callable. However, I don't have any better 
</I>&gt;<i> ideas.
</I>&gt;<i> My original plan here was to always put timeouts somewhere else 
</I>&gt;<i> besides a
</I>&gt;<i> Deferred, and have the system that calls the deferred call an errback 
</I>&gt;<i> at that
</I>&gt;<i> point (such as with the &quot;timeout&quot; argument to connectTCP).
</I>&gt;<i>
</I>&gt;<i> Another interesting case: what if two people call setTimeout on the 
</I>&gt;<i> same
</I>&gt;<i> Deferred?  If it's not purely the creator's responsibility to set the 
</I>&gt;<i> timeout
</I>&gt;<i> on a Deferred, then what do we do about conflicts between different 
</I>&gt;<i> points in
</I>&gt;<i> the processing chain?
</I>
You definitely raise some more interesting points here that didn't 
occur to me, especially the multiple-listener case.  I can think of two 
approaches that could facilitate this..
1) Have the actual operations inherit from Deferred, and have them deal 
with setTimeout and cancellation on their own.
2) Make cancellation some kind of delegate process.. On cancellation 
request, if there are other listeners on that deferred it asks them all 
if they're ok with cancellation.  If all of them say yes, it cancels.  
Otherwise the ones that said yes are sent an errback saying that it was 
cancelled and removed from list of callback/errbacks (so it seems to 
them as if it were cancelled) but the ones that said no will remain as 
they were and the operation will not be cancelled.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002650.html">[Twisted-Python] Deferred execution, timeouts, and unhandled exceptions 
</A></li>
	<LI>Next message: <A HREF="002653.html">[Twisted-Python] 1.0.2alpha4 test failures on Alpha, PPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2651">[ date ]</a>
              <a href="thread.html#2651">[ thread ]</a>
              <a href="subject.html#2651">[ subject ]</a>
              <a href="author.html#2651">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
