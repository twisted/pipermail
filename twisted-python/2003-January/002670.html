<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Error handling in Application.bindPorts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Error%20handling%20in%20Application.bindPorts&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002712.html">
   <LINK REL="Next"  HREF="002671.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Error handling in Application.bindPorts</H1>
    <B>Bernhard Herzog</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Error%20handling%20in%20Application.bindPorts&In-Reply-To="
       TITLE="[Twisted-Python] Error handling in Application.bindPorts">bh at intevation.de
       </A><BR>
    <I>Thu Jan 23 14:23:56 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="002712.html">[Twisted-Python] Arbitrary Port/Connector objects
</A></li>
        <LI>Next message: <A HREF="002671.html">[Twisted-Python] First contribution...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2670">[ date ]</a>
              <a href="thread.html#2670">[ thread ]</a>
              <a href="subject.html#2670">[ subject ]</a>
              <a href="author.html#2670">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm trying to get one of my twisted programs to terminate immediately if
it can't listen on a port on startup. It's main program is basically the
same as in e.g. doc/howto/listings/application/app1.py, i.e (quoting
from app1.py):

app = twisted.internet.app.Application(&quot;daytimer&quot;)
f = Factory()
f.protocol = Daytime
app.listenTCP(8813, f)

app.run()

My program uses a different protocol and factory, but the principle is
the same: it calls app.listenTCP before it calls app.run().

Now, if the mainloop isn't running yet, listenTCP doesn't start
listening immediately[1] but simply appends the arguments to a list.
Then, when app.run() is called and that list is not empty it will call
bindPorts before entering the mainloop.

bindPorts simply catches the CannotListenError, logs a message and
returns immediately even if not all ports have been bound yet.
Unfortunately, even if bindPorts returns early, app.run still enters the
mainloop. There doesn't seem to be a good way to avoid this.

IMO bindPorts should reraise the exception after writing logging the
error instead of simply returning. 

   Bernhard


[1] I think app.listenTCP doesn't try to listen immediately because this
method is also used when creating taps and that should be possible even
if the port is currently in use or the user doesn't have permission to
listen on that port.

-- 
Intevation GmbH                                 <A HREF="http://intevation.de/">http://intevation.de/</A>
Sketch                                 <A HREF="http://sketch.sourceforge.net/">http://sketch.sourceforge.net/</A>
MapIt!                                           <A HREF="http://www.mapit.de/">http://www.mapit.de/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002712.html">[Twisted-Python] Arbitrary Port/Connector objects
</A></li>
	<LI>Next message: <A HREF="002671.html">[Twisted-Python] First contribution...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2670">[ date ]</a>
              <a href="thread.html#2670">[ thread ]</a>
              <a href="subject.html#2670">[ subject ]</a>
              <a href="author.html#2670">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
