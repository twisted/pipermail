<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] cReactor fixes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20cReactor%20fixes&In-Reply-To=%3C20030106.115532.88728086.warner%40lothar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="035070.html">
   <LINK REL="Next"  HREF="035072.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] cReactor fixes</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20cReactor%20fixes&In-Reply-To=%3C20030106.115532.88728086.warner%40lothar.com%3E"
       TITLE="[Twisted-Python] cReactor fixes">warner at lothar.com
       </A><BR>
    <I>Mon Jan  6 12:55:32 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="035070.html">[Twisted-Python] cReactor fixes
</A></li>
        <LI>Next message (by thread): <A HREF="035072.html">[Twisted-Python] cReactor fixes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35080">[ date ]</a>
              <a href="thread.html#35080">[ thread ]</a>
              <a href="subject.html#35080">[ subject ]</a>
              <a href="author.html#35080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph Lefkowitz &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; writes:
&gt;<i> 
</I>&gt;<i> Ideally, I'd prefer that the reactor is *always* in a consistent state.
</I>&gt;<i> That would probably involve redefining or removing the &quot;crash&quot; facility,
</I>&gt;<i> since there would only be &quot;pause and return so that run() continues&quot; or
</I>&gt;<i> &quot;stop properly so run() restarts&quot;. Whatever compromise you come up with in
</I>&gt;<i> this vein is probably acceptable, though.
</I>
What do you mean by &quot;consistent&quot;? Let me verify my understanding: we could
say that the two states are running and stopped, and that you can always
transition from one to the other. I'm guessing the reason for .crash and the
prohibition on running .start a second time is the systemEventTriggers, and a
desire to keep them from running more than once in any given process.

If we move to only two states and allow arbitrary transitions between them,
we'd probably have to declare that the triggers run on each transition.
Normal apps won't care, since they only start and stop once. The unit tests
would start/stop 0 or more times per test case, running triggers each time,
but the only triggers in place would probably be the ones added by the tests
themselves.

The other use for .crash listed in the docs is to avoid running shutdown
triggers. I've had programs where the shutdown.tap -writing routine raised an
exception, which appeared to cause the shutdown to abort and the program to
go back to the main loop. I had to kill it with SIGTERM to make it stop. I
imagine .crash could be used in an exception handler that wrapped app.save()
to terminate a program that was having trouble with the &quot;after&quot;-&quot;shutdown&quot;
event triggers. If that is useful, .crash would be just like .stop except it
wouldn't run the triggers.

So:
1: At boot time, we enter the &quot;stopped&quot; state
2: While we are in the &quot;stopped&quot; state, you may only run .start
3: .start moves us from &quot;stopped&quot; to &quot;running&quot; and runs &quot;startup&quot; triggers
4: While we are in the &quot;running&quot; state, you may only run .stop or .crash
5: .stop moves from &quot;running&quot; to &quot;stopped&quot; and runs &quot;shutdown&quot; triggers
6: .crash moves from &quot;running&quot; to &quot;stopped&quot; without running triggers

7: .reset does an implicit .stop, if necessary, before cleaning all reactor
state

All triggers remain attached until individually removed or reactor.reset() is
called, so an app that does .run(); .stop(); .run(); .stop(); is going to
have the triggers run multiple times. All other reactor state is preserved by
.stop and .crash (timers, sockets).


I think I've just restated what you said before, but this way if I got it
wrong somebody has the opportunity to correct my understanding before I get
around to writing any code :)

thanks,
 -Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="035070.html">[Twisted-Python] cReactor fixes
</A></li>
	<LI>Next message (by thread): <A HREF="035072.html">[Twisted-Python] cReactor fixes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35080">[ date ]</a>
              <a href="thread.html#35080">[ thread ]</a>
              <a href="subject.html#35080">[ subject ]</a>
              <a href="author.html#35080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
