<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deferred execution, timeouts, and unhandled exceptions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred%20execution%2C%20timeouts%2C%20and%20unhandled%20exceptions&In-Reply-To=20030118122638.GA5708%40frobozz.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002644.html">
   <LINK REL="Next"  HREF="002635.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deferred execution, timeouts, and unhandled exceptions</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred%20execution%2C%20timeouts%2C%20and%20unhandled%20exceptions&In-Reply-To=20030118122638.GA5708%40frobozz.local"
       TITLE="[Twisted-Python] Deferred execution, timeouts, and unhandled exceptions">andrew-twisted at puzzling.org
       </A><BR>
    <I>Sat Jan 18 07:57:53 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="002644.html">[Twisted-Python] Deferred execution, timeouts, and unhandled exceptions
</A></li>
        <LI>Next message: <A HREF="002635.html">[Twisted-Python] DOMTemplate best practice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2645">[ date ]</a>
              <a href="thread.html#2645">[ thread ]</a>
              <a href="subject.html#2645">[ subject ]</a>
              <a href="author.html#2645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Jan 18, 2003 at 11:26:38PM +1100, Andrew Bennetts wrote:
&gt;<i> On Fri, Jan 17, 2003 at 07:04:01PM -0500, Bob Ippolito wrote:
</I>&gt;<i> &gt; I've noticed that there isn't really a good/standard way to do timeouts 
</I>&gt;<i> &gt; (without bad things happening) or cancel deferreds in Twisted [without 
</I>&gt;<i> &gt; subclassing everything you use, which isn't good in my book].
</I>&gt;<i> 
</I>&gt;<i> I've glanced at your code and log, but it's not immediately clear to me what
</I>&gt;<i> the problem is...
</I>
Nevermind me, I shouldn't try to read code and post when I'm tired.

Your problem (if I'm understanding correctly :), is that exceptions are
raised by calling Deferred.callback, if that Deferred has timed out, or
otherwise been &quot;cancelled&quot; (by having its errback called).

I'm tempted to argue that this is a feature: the code attempting to fire the
callback probably should know that the Deferred has already expired due to
an error.  The obvious problem with this is that alot of the time you don't
care if the Deferred has already fired or not, and wrapping d.callback(x) in
a try/except AlreadyCalledError is hardly convenient.

So I'd still like at least the option for an exception to be raised, even if
it's disabled by default.  I can't shake the feeling that some apps will
need to know that it succeeds... although I guess they could just register
their own .errback if they really care?

For that matter, perhaps another solution would be to mandate that a method
creating a Deferred is responsible for configuring it with an errback that
will cancel pending operations so that .callback won't be called.  Ugh,
that's a confusing sentence.  What I'm trying to say is that similarly to
how when FTP opens a port and waits for a connection, it must set an errback
to close that port if the connection never comes (e.g. due to an error on
the control connection), whatever &quot;owns&quot; the Deferred should also cancel
whatever would call .callback if an error occured -- this is probably
necessary in general, not just for timeouts and cancels.

Interesting problem :)

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002644.html">[Twisted-Python] Deferred execution, timeouts, and unhandled exceptions
</A></li>
	<LI>Next message: <A HREF="002635.html">[Twisted-Python] DOMTemplate best practice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2645">[ date ]</a>
              <a href="thread.html#2645">[ thread ]</a>
              <a href="subject.html#2645">[ subject ]</a>
              <a href="author.html#2645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
