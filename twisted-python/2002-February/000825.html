<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Windows issues...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Windows%20issues...&In-Reply-To=20020219002435.GA9849%40ritsuko.xware.cx">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000824.html">
   <LINK REL="Next"  HREF="000826.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Windows issues...</H1>
    <B>Benjamin Schollnick</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Windows%20issues...&In-Reply-To=20020219002435.GA9849%40ritsuko.xware.cx"
       TITLE="[Twisted-Python] Windows issues...">junkster at rochester.rr.com
       </A><BR>
    <I>Mon Feb 18 21:15:41 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="000824.html">[Twisted-Python] Windows issues...
</A></li>
        <LI>Next message: <A HREF="000826.html">[Twisted-Python] Windows issues...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#825">[ date ]</a>
              <a href="thread.html#825">[ thread ]</a>
              <a href="subject.html#825">[ subject ]</a>
              <a href="author.html#825">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>on 2/18/02 7:24 PM, Andrew Bennetts at <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrew-twisted at puzzling.org</A> wrote:

&gt;&gt;<i> 1) setup.py install    died....It stopped when it couldn't find &quot;CL.EXE&quot;,
</I>&gt;&gt;<i> while building
</I>&gt;&gt;<i> something in the twisted.spread.cbanana section...
</I>&gt;<i> 
</I>&gt;<i> CL.EXE is a command line program that comes with MS Visual C++...  setup.py
</I>&gt;<i> is basically trying to compile a C extension module.  I can send you a
</I>&gt;<i> binary for that file if you don't have MS VC++ installed, otherwise run
</I>&gt;<i> VCVARS32.BAT and try again.
</I>
No Visual C++....

If you don't mind sending it, I would appreciate it...

This really needs to be noted.... I admit, I didn't search around too
much, but I didn't see anything mentioning that it required a C/C++
compiler...

(How about a precompiled Windows binary?  Or having Distutils install the
precompiled binary)....

&gt;&gt;<i> 6) Under Windows, the default should be -n for twistd, and the PID file
</I>&gt;&gt;<i> shouldn't be created.   At least, as it is now.  twistd just &quot;stops&quot;, after
</I>&gt;&gt;<i> it starts up and drops us back to the command line, and examination shows
</I>&gt;&gt;<i> that the program isn't running.  So at least as a workaround, the -n mode
</I>&gt;&gt;<i> works....
</I>&gt;<i> 
</I>&gt;<i> Yeah, -n uses os.fork, which is not available under Windows.  You probably
</I>&gt;<i> need to use NT services instead...
</I>
That's what I figured....

(By NT Services, you mean the services listed from control panels --&gt;
services?)

But I dislike the NT services.... I've never seen a service get installed,
that will &quot;uninstall&quot; properly...  (Usually add/remove program doesn't
uninstall the service)

I prefer to run the console......reminds me a little bit more of a syslog
window... &gt;g&lt;


&gt;<i> Alternatively, consider using the cygwin version of Python -- it is closer
</I>&gt;<i> to the unix version, and so os.fork will work.  Also, it comes with gcc, so
</I>&gt;<i> cbanana would compile correctly.  Unfortunately, I don't think it can
</I>&gt;<i> interoperate with the Win32 extensions (at least, not that I know of).
</I>
I use the Win32 services, include ODBC... So that's not really a useable
workaround...

&gt;&gt;<i> I guest a better question is, has twistedmatrix been tested under Windows?
</I>&gt;&gt;<i> It really seems to be unix centric in it's programming...
</I>&gt;<i> 
</I>&gt;<i> It basically works.  The other problem to watch out for is that
</I>&gt;<i> Protocol.connectionFailed won't trigger unless you specify a timeout for
</I>&gt;<i> your tcp.Client, because select works slightly differently on Windows.
</I>
&gt;<i> Incidentally, I'm not using the twistd stuff *at all* (I don't yet
</I>&gt;<i> understand the need for it under Windows, but then I don't even know exactly
</I>&gt;<i> what it's meant to do...).  Instead, I'm using this little file:
</I>
Is the following code &quot;temporary&quot;....  It's considered a service while
running, but doesn't get installed in the services control panel?

It looks interesting, but I don't want to register the app as a &quot;true&quot;
service... As I mentioned before, I can't find a reliable way to remove
a service, without registry hacking...

            -- Benjamin

&gt;<i> --- ServerFramework/Service.py ---
</I>&gt;<i> import win32serviceutil, win32service
</I>&gt;<i> 
</I>&gt;<i> &quot;&quot;&quot;Example use of this module:
</I>&gt;<i> 
</I>&gt;<i> from ServerFramework.Service import Service, main
</I>&gt;<i> import ExampleServer
</I>&gt;<i> 
</I>&gt;<i> class ExampleServerService(Service):
</I>&gt;<i> _svc_name_ = &quot;ExampleServerService&quot;
</I>&gt;<i> _svc_display_name_ = &quot;My Example Server Service&quot;
</I>&gt;<i> main = ExampleServer.main
</I>&gt;<i> 
</I>&gt;<i> if __name__ == '__main__':
</I>&gt;<i> main(ExampleServerService)
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> try:
</I>&gt;<i> import twisted
</I>&gt;<i> except ImportError:
</I>&gt;<i> print &quot;Twisted Python must be installed to run this service&quot;
</I>&gt;<i> raise
</I>&gt;<i> 
</I>&gt;<i> class Service(win32serviceutil.ServiceFramework):
</I>&gt;<i> &quot;&quot;&quot;I am a template service for ServerFramework servers.
</I>&gt;<i> 
</I>&gt;<i> You should subclass me and override the following attributes:
</I>&gt;<i> _svc_name_          -- see win32serviceutil docs
</I>&gt;<i> _svc_display_name_  -- see win32serviceutil docs
</I>&gt;<i> main                -- function that starts your server
</I>&gt;<i> 
</I>&gt;<i> You can also override:
</I>&gt;<i> logFile             -- filename for where debug messages will be saved
</I>&gt;<i> (default: c:/&lt;_svc_name_&gt;.log)
</I>&gt;<i> &quot;&quot;&quot;
</I>&gt;<i> _svc_name_ = &quot;UnnamedServer&quot;
</I>&gt;<i> _svc_display_name_ = &quot;My UNNAMED Server&quot;
</I>&gt;<i> main = None
</I>&gt;<i> logFile = None
</I>&gt;<i> 
</I>&gt;<i> def __init__(self, *args):
</I>&gt;<i> win32serviceutil.ServiceFramework.__init__(self, *args)
</I>&gt;<i> if not self.logFile:
</I>&gt;<i> self.logFile = 'c:/%s.log' % (self._svc_name_,)
</I>&gt;<i> 
</I>&gt;<i> def SvcDoRun(self):
</I>&gt;<i> from twisted.python.log import startLogging
</I>&gt;<i> startLogging(open(self.logFile,'a'))
</I>&gt;<i> # Call main, note that it is not a method of this class, so we use
</I>&gt;<i> # self.main.im_func() instead of self.main().
</I>&gt;<i> self.main.im_func()
</I>&gt;<i> 
</I>&gt;<i> def SvcStop(self):
</I>&gt;<i> self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
</I>&gt;<i> from twisted.internet.main import shutDown
</I>&gt;<i> shutDown()
</I>&gt;<i> 
</I>&gt;<i> def main(svc):
</I>&gt;<i> win32serviceutil.HandleCommandLine(svc)
</I>&gt;<i> 
</I>&gt;<i> if __name__ == '__main__':
</I>&gt;<i> print &quot;This is a library module, and should not be executed.&quot;
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000824.html">[Twisted-Python] Windows issues...
</A></li>
	<LI>Next message: <A HREF="000826.html">[Twisted-Python] Windows issues...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#825">[ date ]</a>
              <a href="thread.html#825">[ thread ]</a>
              <a href="subject.html#825">[ subject ]</a>
              <a href="author.html#825">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
