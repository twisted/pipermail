<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Windows issues...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Windows%20issues...&In-Reply-To=B896F9B9.5CE4%25junkster%40rochester.rr.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000819.html">
   <LINK REL="Next"  HREF="000821.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Windows issues...</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Windows%20issues...&In-Reply-To=B896F9B9.5CE4%25junkster%40rochester.rr.com"
       TITLE="[Twisted-Python] Windows issues...">andrew-twisted at puzzling.org
       </A><BR>
    <I>Mon Feb 18 19:24:35 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="000819.html">[Twisted-Python] Windows issues...
</A></li>
        <LI>Next message: <A HREF="000821.html">[Twisted-Python] Windows issues...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#820">[ date ]</a>
              <a href="thread.html#820">[ thread ]</a>
              <a href="subject.html#820">[ subject ]</a>
              <a href="author.html#820">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 18, 2002 at 06:34:33PM -0500, Benjamin Schollnick wrote:
&gt;<i> Folks,
</I>&gt;<i> 
</I>&gt;<i>    I've got some questions, with windows usage of Twisted Matrix...
</I>
I use Twisted under Windows, so I may be able to offer some help..

&gt;<i> 1) setup.py install    died....It stopped when it couldn't find &quot;CL.EXE&quot;,
</I>&gt;<i> while building
</I>&gt;<i>    something in the twisted.spread.cbanana section...
</I>
CL.EXE is a command line program that comes with MS Visual C++...  setup.py
is basically trying to compile a C extension module.  I can send you a
binary for that file if you don't have MS VC++ installed, otherwise run
VCVARS32.BAT and try again. 

&gt;<i> 2) A lot of the files, don't have a .py extension.  (i.e. mktap, twistd,
</I>&gt;<i> etc)
</I>&gt;<i>    This is a major hindrance, because either I have to rename the file, or
</I>&gt;<i>    execute it explicitly &quot;python mktap ....etc....&quot;.  I have windows set to
</I>&gt;<i> run
</I>&gt;<i>    the .py files via python automatically.
</I>
This is easily fixed with short bash script, but I agree, this is annoyed.

I'd suggest the Twisted developers look at how, e.g. PyChecker or Teud does
it (various scripts get installed in %PYTHONPATH%/scripts/&lt;foo&gt;.bat).

&gt;<i> 3) web.distrib has some issues.  Mainly attempting to use the pwd unit under
</I>[snip]
&gt;<i> 4) Error checking is extremely light....
</I>[snip]
&gt;<i> 5) Even after fixing #3, mktap web --static static, isn't working.
</I>
I don't use the twisted.web stuff (yet ;), so I can't offer any help here :(

&gt;<i> 6) Under Windows, the default should be -n for twistd, and the PID file
</I>&gt;<i> shouldn't be created.   At least, as it is now.  twistd just &quot;stops&quot;, after
</I>&gt;<i> it starts up and drops us back to the command line, and examination shows
</I>&gt;<i> that the program isn't running.  So at least as a workaround, the -n mode
</I>&gt;<i> works....
</I>
Yeah, -n uses os.fork, which is not available under Windows.  You probably
need to use NT services instead...

Alternatively, consider using the cygwin version of Python -- it is closer
to the unix version, and so os.fork will work.  Also, it comes with gcc, so
cbanana would compile correctly.  Unfortunately, I don't think it can
interoperate with the Win32 extensions (at least, not that I know of).

&gt;<i> I guest a better question is, has twistedmatrix been tested under Windows?
</I>&gt;<i> It really seems to be unix centric in it's programming...
</I>
It basically works.  The other problem to watch out for is that
Protocol.connectionFailed won't trigger unless you specify a timeout for
your tcp.Client, because select works slightly differently on Windows.

Incidentally, I'm not using the twistd stuff *at all* (I don't yet
understand the need for it under Windows, but then I don't even know exactly
what it's meant to do...).  Instead, I'm using this little file:

--- ServerFramework/Service.py ---
import win32serviceutil, win32service

&quot;&quot;&quot;Example use of this module:

from ServerFramework.Service import Service, main
import ExampleServer

class ExampleServerService(Service):
    _svc_name_ = &quot;ExampleServerService&quot;
    _svc_display_name_ = &quot;My Example Server Service&quot;
    main = ExampleServer.main

if __name__ == '__main__':
    main(ExampleServerService)
&quot;&quot;&quot;


try:
    import twisted
except ImportError:
    print &quot;Twisted Python must be installed to run this service&quot;
    raise

class Service(win32serviceutil.ServiceFramework):
    &quot;&quot;&quot;I am a template service for ServerFramework servers.
    
    You should subclass me and override the following attributes:
        _svc_name_          -- see win32serviceutil docs
        _svc_display_name_  -- see win32serviceutil docs
        main                -- function that starts your server
    
    You can also override:
        logFile             -- filename for where debug messages will be saved
                               (default: c:/&lt;_svc_name_&gt;.log)
    &quot;&quot;&quot;
    _svc_name_ = &quot;UnnamedServer&quot;
    _svc_display_name_ = &quot;My UNNAMED Server&quot;
    main = None
    logFile = None

    def __init__(self, *args):
        win32serviceutil.ServiceFramework.__init__(self, *args)
        if not self.logFile:
            self.logFile = 'c:/%s.log' % (self._svc_name_,)

    def SvcDoRun(self):
        from twisted.python.log import startLogging
        startLogging(open(self.logFile,'a'))
        # Call main, note that it is not a method of this class, so we use
        # self.main.im_func() instead of self.main().
        self.main.im_func()

    def SvcStop(self):
        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
        from twisted.internet.main import shutDown
        shutDown()

def main(svc):
	win32serviceutil.HandleCommandLine(svc)
    
if __name__ == '__main__':
    print &quot;This is a library module, and should not be executed.&quot;
---

It basically wraps up the functionality of the win32serviceutil in a
convenient way for Twisted servers.  Once you've used it as shown in the
example, just run it from the commandline -- it's self explantory (it uses
Mark Hammond's win32serviceutil.HandleCommandLine function to let you
install the service).  I'm not sure if the self.main.im_func trick will work
on older Pythons; I use 2.2.

I hope this is of some use to you.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000819.html">[Twisted-Python] Windows issues...
</A></li>
	<LI>Next message: <A HREF="000821.html">[Twisted-Python] Windows issues...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#820">[ date ]</a>
              <a href="thread.html#820">[ thread ]</a>
              <a href="subject.html#820">[ subject ]</a>
              <a href="author.html#820">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
