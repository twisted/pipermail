<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A pseudo-deferred class that can be canceled
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20pseudo-deferred%20class%20that%20can%20be%20canceled&In-Reply-To=19266.41597.624446.721449%40jon.es">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021312.html">
   <LINK REL="Next"  HREF="021309.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A pseudo-deferred class that can be canceled</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20A%20pseudo-deferred%20class%20that%20can%20be%20canceled&In-Reply-To=19266.41597.624446.721449%40jon.es"
       TITLE="[Twisted-Python] A pseudo-deferred class that can be canceled">andrew at bemusement.org
       </A><BR>
    <I>Tue Jan  5 02:01:54 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021312.html">[Twisted-Python] A pseudo-deferred class that can be canceled
</A></li>
        <LI>Next message: <A HREF="021309.html">[Twisted-Python] A pseudo-deferred class that can be canceled
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21307">[ date ]</a>
              <a href="thread.html#21307">[ thread ]</a>
              <a href="subject.html#21307">[ subject ]</a>
              <a href="author.html#21307">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Terry Jones wrote:
&gt;<i> I just wrote the below for fun.  It's untested :-)
</I>&gt;<i> 
</I>&gt;<i> It's a class that you initialize with a callable (f), and which gives you
</I>&gt;<i> back a deferred (d) that will fire when f fires. Alternately, you can fire
</I>&gt;<i> d yourself by calling 'callback' or 'errback' on the class instance and
</I>&gt;<i> passing a value.  That value is returned via d.
</I>&gt;<i> 
</I>&gt;<i> The reason this is useful is that normally when you call a function that
</I>&gt;<i> returns a deferred, you can't easily &quot;cancel&quot; the deferred because it is
</I>&gt;<i> made and controlled by the function you called. The callback or errback on
</I>
I think the key thing is to remember there are two distinct parts:

  1) an operation (which eventually will have a result or failure)
  2) a result 
  
A Deferred takes care of managing 2.  It's a placeholder for that
result, and it can track callbacks that need to be called when it
arrives, etc.

We currently don't have any formal idioms for 1.  I think this is what
you're trying to address.  After all, it's not the result that times out
or that you might want to cancel, it's the operation that is expected to
generate it.

I don't think it's wise to conflate the two concepts, so I think
CancellableDeferred is a poor name.

In an ideal world perhaps every Deferred would have a .operation
attribute, so maybe &#8220;d.operation.cancel()&#8221; and even
&#8220;d.operation.getProgressReport()&#8221; would be possible, but I doubt that
every piece of code that creates a Deferred would want to pay the cost
of that bookkeepping.  But hopefully you see my point that it's a
connected but distinct concept to the very simple, single-purpose
callback managing object that a Deferred is.

[...]
&gt;<i> I post this partly because it seems cute, but more because it seems like
</I>&gt;<i> issue that's probably been solved by many people. Is there a general
</I>&gt;<i> utility in Twisted for doing this? A better way?
</I>
It feels like there should be, but so far people have basically been
managing the logic that fires Deferreds ad hoc.  I don't think this is
an ideal state of affairs, but it seems it's Good Enough most of the
time.

If I were to try improve the situation, I'd be trying to make an
Operation object or something like that, I think.  I think you'd want to
make it support cancellation (and timeouts) when the underlying code
supports it (network requests are often easy to cancel &#8212; just close the
socket), and I'm not sure what would be best when the underlying code is
not cancellable (deferToThread is in general impossible to cancel, etc).

So currently your class isn't something I'd use, because I don't think
it helps with any of this.

-Andrew.


</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021312.html">[Twisted-Python] A pseudo-deferred class that can be canceled
</A></li>
	<LI>Next message: <A HREF="021309.html">[Twisted-Python] A pseudo-deferred class that can be canceled
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21307">[ date ]</a>
              <a href="thread.html#21307">[ thread ]</a>
              <a href="subject.html#21307">[ subject ]</a>
              <a href="author.html#21307">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
