<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Accessing the request object from a different	thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Accessing%20the%20request%20object%20from%20a%20different%0A%09thread&In-Reply-To=%3Cf6700f0c1001151458ibcb4b47wffd5614ef663fd8e%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053839.html">
   <LINK REL="Next"  HREF="053841.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Accessing the request object from a different	thread</H1>
    <B>Red Daly</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Accessing%20the%20request%20object%20from%20a%20different%0A%09thread&In-Reply-To=%3Cf6700f0c1001151458ibcb4b47wffd5614ef663fd8e%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Accessing the request object from a different	thread">reddaly at gmail.com
       </A><BR>
    <I>Fri Jan 15 15:58:10 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053839.html">[Twisted-Python] Signalling twistd with SIGUSR1 to rotate also interrupts txAMQP connections
</A></li>
        <LI>Next message (by thread): <A HREF="053841.html">[Twisted-Python] Accessing the request object from a different thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53840">[ date ]</a>
              <a href="thread.html#53840">[ thread ]</a>
              <a href="subject.html#53840">[ subject ]</a>
              <a href="author.html#53840">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have an application that uses synchronous access to a MySQL database
through SQLAlchemy.  Unwilling to part with this synchronous access,
our application uses threads to perform database I/O outside of the
main Twisted thread.  It would be nice to still have some access to
the request object while processing a request in a new thread.  Is
there any thread-safe way to access the request object data?

Here is a typical Resource subclass:

    def parseRequest(self, request, session):
        try:
            # parse the relevant portion of the path
            namingPortionOfPath = self.idParserRE.match(request.path).group(1)

            cls = self.dbClass()
            return cls.getAllInstances(namingPortionOfPath)
        except:
            return None
        return None

    def render_GET(self, request):
        def sessionFn(session):
            instance = self.parseRequest(request, session)
            rendered = None
            if instance:
                stream = self.template.generate(object=instance,
                                                resource=self,
                                                session=session)

                rendered = stream.render('html', doctype='html',
encoding='latin1')
            else:
                rendered = &quot;finished&quot;

            return rendered

        def otherThreadFn():
            return pulse.web.mainStore().withSession(sessionFn)

        def deferedCallback(r):
            request.write(r)
            request.finish()

        twisted.internet.threads.deferToThread(otherThreadFn).addCallback(deferedCallback)

        return NOT_DONE_YET


All of the accesses to the request object are read operations.  If
those read operations occur on data that does not get messed with by
the main thread, then this should be thread-safe code.  However, it
seems that the official word is &quot;do not use request objects from other
threads.&quot;  Maybe I am mistaken.  In any case, is there a safe way to
get at request headers and parameter values outside of the reactor
loop.

Thanks,
Red


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053839.html">[Twisted-Python] Signalling twistd with SIGUSR1 to rotate also interrupts txAMQP connections
</A></li>
	<LI>Next message (by thread): <A HREF="053841.html">[Twisted-Python] Accessing the request object from a different thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53840">[ date ]</a>
              <a href="thread.html#53840">[ thread ]</a>
              <a href="subject.html#53840">[ subject ]</a>
              <a href="author.html#53840">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
