<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Log rotates not as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Log%20rotates%20not%20as%20expected&In-Reply-To=%3C4B5A16E0.4040206%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053894.html">
   <LINK REL="Next"  HREF="053912.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Log rotates not as expected</H1>
    <B>Lucas Taylor</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Log%20rotates%20not%20as%20expected&In-Reply-To=%3C4B5A16E0.4040206%40gmail.com%3E"
       TITLE="[Twisted-Python] Log rotates not as expected">ltaylor.volks at gmail.com
       </A><BR>
    <I>Fri Jan 22 14:21:36 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053894.html">[Twisted-Python] Log rotates not as expected
</A></li>
        <LI>Next message (by thread): <A HREF="053912.html">[Twisted-Python] Log rotates not as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53895">[ date ]</a>
              <a href="thread.html#53895">[ thread ]</a>
              <a href="subject.html#53895">[ subject ]</a>
              <a href="author.html#53895">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/22/10 3:15 AM, Pet wrote:
&gt;<i> On Fri, Jan 22, 2010 at 12:13 AM, Lucas Taylor &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ltaylor.volks at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> On 1/21/10 11:17 AM, Pet wrote:
</I>&gt;&gt;&gt;<i> On Thu, Jan 21, 2010 at 7:02 PM, Maarten ter Huurne
</I>&gt;&gt;&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">maarten at treewalker.org</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> On Thursday 21 January 2010, Lucas Taylor wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> This can occur if you have multiple instances of logfile.LogFile setup
</I>&gt;&gt;&gt;&gt;&gt;<i> to manage the same file. The default rotation is 1MB, so maybe you have
</I>&gt;&gt;&gt;&gt;&gt;<i> another logfile.LogFile somewhere?
</I>&gt;&gt;&gt;&gt;<i> Maybe twistd's log rotation?
</I>&gt;&gt;&gt;<i> Yes, may be. I start my daemon with
</I>&gt;&gt;&gt;<i> /usr/bin/twistd -y mydaemon.py --logfile=/var/log/my.log
</I>&gt;&gt;&gt;<i> --pidfile=/var/lock/mydaemon.pid
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> How do I start twistd, so it doesn't produce own log file?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks for help!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Pet
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> You can customize the application to use your logfile and observer:
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/core/howto/application.html#auto6">http://twistedmatrix.com/documents/current/core/howto/application.html#auto6</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> e.g
</I>&gt;&gt;<i> class MyLog(log.FileLogObserver):
</I>&gt;&gt;<i>    def emit(self, logEntryDict):
</I>&gt;&gt;<i>        log.FileLogObserver.timeFormat = '%Y-%m-%d %H:%M:%S'
</I>&gt;&gt;<i>        log.FileLogObserver.emit(self, logEntryDict)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> maxLogSize = 5000000
</I>&gt;&gt;<i> logFile = logfile.LogFile(&quot;my.log&quot;, &quot;/var/log&quot;, rotateLength=maxLogSize,
</I>&gt;&gt;<i> maxRotatedFiles=50)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> application = service.Application(&quot;myapp&quot;)
</I>&gt;&gt;<i> application.setComponent(log.ILogObserver, MyLog(logFile).emit)
</I>&gt;<i> 
</I>&gt;<i> Thanks for suggestion. I'll try it out as soon as I can. Currently I
</I>&gt;<i> do it in that way:
</I>&gt;<i> 
</I>&gt;<i> application = service.Application(&quot;MyService&quot;)
</I>&gt;<i> myLogService = myLogService(LOG_NAME, LOG_DIR)
</I>&gt;<i> myLogService.setServiceParent(application)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> what is the difference between creating service and setting
</I>&gt;<i> setServiceParent and setComponent?
</I>&gt;<i> 
</I>&gt;<i> Pet
</I>&gt;<i> 
</I><A HREF="http://twistedmatrix.com/documents/current/core/howto/application.html">http://twistedmatrix.com/documents/current/core/howto/application.html</A>

The important aspect is the setComponent api. This is the part that lets
you override the default logging behavior of twistd. It has nothing to
do with the services that you register with the application using
setServiceParent.

If your MyLogService only does what you originally posted, you probably
don't need all of that machinery. Using twistd will take care of
starting and stopping logging for you.

But, if you really want to use your service (say you want to force
rotation on a restart), then you can do so. You just need to set the
ILogObserver component on the application using your observer's emit
function.

e.g

application = service.Application(&quot;MyService&quot;)
myLogService = myLogService(LOG_NAME, LOG_DIR)
myLogService.setServiceParent(application)
application.setComponent(log.ILogObserver, myLogService.loclog.emit)

Note that this won't work with your original MyLogService implementation
without some reorganization (move logfile and loclog creation up to
__init__)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053894.html">[Twisted-Python] Log rotates not as expected
</A></li>
	<LI>Next message (by thread): <A HREF="053912.html">[Twisted-Python] Log rotates not as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53895">[ date ]</a>
              <a href="thread.html#53895">[ thread ]</a>
              <a href="subject.html#53895">[ subject ]</a>
              <a href="author.html#53895">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
