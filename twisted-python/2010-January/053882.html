<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] 9.0.0 question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%209.0.0%20question&In-Reply-To=%3C12aaa0811001210730p4ab8c299oc7e00c8b4b53e8ef%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053880.html">
   <LINK REL="Next"  HREF="053896.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] 9.0.0 question</H1>
    <B>Mikhail Terekhov</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%209.0.0%20question&In-Reply-To=%3C12aaa0811001210730p4ab8c299oc7e00c8b4b53e8ef%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] 9.0.0 question">termim at gmail.com
       </A><BR>
    <I>Thu Jan 21 08:30:35 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053880.html">[Twisted-Python] 9.0.0 question
</A></li>
        <LI>Next message (by thread): <A HREF="053896.html">[Twisted-Python] 9.0.0 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53882">[ date ]</a>
              <a href="thread.html#53882">[ thread ]</a>
              <a href="subject.html#53882">[ subject ]</a>
              <a href="author.html#53882">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Jan 21, 2010 at 3:58 AM,  &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
&gt;<i> On 03:43 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>On Jan 20, 2010, at 3:20 PM, Mikhail Terekhov wrote:
</I>&gt;&gt;&gt;<i>Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I've switched recently from 8.2 to 9.0 and noticed that some of my
</I>&gt;&gt;&gt;<i>client scripts
</I>&gt;&gt;&gt;<i>hang in reactor.stop() on exit sometimes. That never happened before.
</I>&gt;&gt;&gt;<i>For
</I>&gt;&gt;&gt;<i>example if I run the gethostbyname.py from the twisted-names examples
</I>&gt;&gt;&gt;<i>directory
</I>&gt;&gt;&gt;<i>it prints the correct result and hangs forever until I press Cntrl-C.
</I>&gt;&gt;&gt;<i>Then it prints the
</I>&gt;&gt;&gt;<i>following traceback:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I don't see the behavior you describe, but I do see this traceback on
</I>&gt;&gt;<i>trunk with every 3rd run or so of that example - maybe the example is
</I>&gt;&gt;<i>buggy?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>doc/names/examples$ python gethostbyname.py  twistedmatrix.com
</I>&gt;&gt;<i>twisted/names/dns.py:1670: DeprecationWarning: Please only pass IPs to
</I>&gt;&gt;<i>write(), not hostnames
</I>&gt;&gt;<i>  self.transport.write(message.toStr(), address)
</I>&gt;&gt;<i>Traceback (most recent call last):
</I>&gt;&gt;<i>  File &quot;twisted/internet/udp.py&quot;, line 121, in doRead
</I>&gt;&gt;<i>    self.protocol.datagramReceived(data, addr)
</I>&gt;&gt;<i>  File &quot;twisted/names/dns.py&quot;, line 1700, in datagramReceived
</I>&gt;&gt;<i>    d.callback(m)
</I>&gt;&gt;<i>  File &quot;twisted/internet/defer.py&quot;, line 239, in callback
</I>&gt;&gt;<i>    self._startRunCallbacks(result)
</I>&gt;&gt;<i>  File &quot;twisted/internet/defer.py&quot;, line 308, in _startRunCallbacks
</I>&gt;&gt;<i>    self._runCallbacks()
</I>&gt;&gt;<i>--- &lt;exception caught here&gt; ---
</I>&gt;&gt;<i>  File &quot;twisted/internet/defer.py&quot;, line 324, in _runCallbacks
</I>&gt;&gt;<i>    self.result = callback(self.result, *args, **kw)
</I>&gt;&gt;<i>  File &quot;twisted/names/common.py&quot;, line 239, in &lt;lambda&gt;
</I>&gt;&gt;<i>    ).addBoth(lambda passthrough: (r.protocol.transport.stopListening(),
</I>&gt;&gt;<i>passthrough)[1])
</I>&gt;&gt;<i>exceptions.AttributeError: 'NoneType' object has no attribute
</I>&gt;&gt;<i>'stopListening'
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/trac/ticket/4210">http://twistedmatrix.com/trac/ticket/4210</A>
</I>&gt;<i>
</I>
I think I found it, it is somewhat different IMHO. When you run

   python gethostbyname.py localhost

notice the '''localhost''' there, the getHostByName('localhost') returns
defer.succeed(..) so the callback gotResult and hence reactor.stop()
is called even before reactor is run and for some reason it hangs there
inside reactor.stop().

So there are actually two points here:

1. the gethostbyname.py example should probably be changed something
    like this

--- gethostbyname.py.orig       2010-01-21 10:01:30.000000000 -0500
+++ gethostbyname.py    2010-01-21 10:02:55.000000000 -0500
@@ -15,7 +15,9 @@
     failure.printTraceback()
     reactor.stop()

-d = client.getHostByName(sys.argv[1])
-d.addCallbacks(gotResult, gotFailure)
+def main():
+    d = client.getHostByName(sys.argv[1])
+    d.addCallbacks(gotResult, gotFailure)

+reactor.addSystemEventTrigger(&quot;after&quot;, &quot;startup&quot;, main)
 reactor.run()

2. Why reactor.stop() hangs if it is called before reactor.run()?

Are they worth a tickets?

Regards,
-- 
Mikhail Terekhov


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053880.html">[Twisted-Python] 9.0.0 question
</A></li>
	<LI>Next message (by thread): <A HREF="053896.html">[Twisted-Python] 9.0.0 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53882">[ date ]</a>
              <a href="thread.html#53882">[ thread ]</a>
              <a href="subject.html#53882">[ subject ]</a>
              <a href="author.html#53882">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
