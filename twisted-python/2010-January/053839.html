<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Signalling twistd with SIGUSR1 to rotate also interrupts txAMQP connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Signalling%20twistd%20with%20SIGUSR1%20to%20rotate%20also%0A%20interrupts%20txAMQP%20connections&In-Reply-To=%3C4B50AD88.40602%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053838.html">
   <LINK REL="Next"  HREF="053840.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Signalling twistd with SIGUSR1 to rotate also interrupts txAMQP connections</H1>
    <B>Lucas Taylor</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Signalling%20twistd%20with%20SIGUSR1%20to%20rotate%20also%0A%20interrupts%20txAMQP%20connections&In-Reply-To=%3C4B50AD88.40602%40gmail.com%3E"
       TITLE="[Twisted-Python] Signalling twistd with SIGUSR1 to rotate also interrupts txAMQP connections">ltaylor.volks at gmail.com
       </A><BR>
    <I>Fri Jan 15 11:01:44 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053838.html">[Twisted-Python] Signalling twistd with SIGUSR1 to rotate also	interrupts txAMQP connections
</A></li>
        <LI>Next message (by thread): <A HREF="053840.html">[Twisted-Python] Accessing the request object from a different	thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53839">[ date ]</a>
              <a href="thread.html#53839">[ thread ]</a>
              <a href="subject.html#53839">[ subject ]</a>
              <a href="author.html#53839">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/13/10 1:00 PM, Anthony wrote:
&gt;<i> We run some services that use txAMQP within twistd to connect to an AMQP
</I>&gt;<i> bus.
</I>&gt;<i> 
</I>&gt;<i> When we send twistd a SIGUSR1 to rotate its logs, it appears our
</I>&gt;<i> application loses connection to the AMQP bus and needs to reconnect.
</I>&gt;<i> This doesn't crash the app, but means the app may be offline momentarily
</I>&gt;<i> when it should be available to process data.
</I>&gt;<i> 
</I>&gt;<i> Is it possible that twistd is processing the SIGUSR1 and then passing it
</I>&gt;<i> onto our app and txAMQP?
</I>&gt;<i> 
</I>&gt;<i> We want to be able to force a log rotate without the entire app, or the
</I>&gt;<i> connections it has open, resetting.
</I>&gt;<i> 
</I>
AFAICT, twistd just registers a signal handler for SIGUSR1 that calls
t.p.logfile.Logfile.rotate. I don't see it propagating anywhere else in
a manner that would cause dropped connections.

Maybe os operations in rotate are blocking while they are doing the
remove/rename dance? Are you infrequently rotating (large files)?

If you setup your own handler for SIGUSR1, twistd will not register the
log rotation function, giving you an alternative to explore the issue.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053838.html">[Twisted-Python] Signalling twistd with SIGUSR1 to rotate also	interrupts txAMQP connections
</A></li>
	<LI>Next message (by thread): <A HREF="053840.html">[Twisted-Python] Accessing the request object from a different	thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53839">[ date ]</a>
              <a href="thread.html#53839">[ thread ]</a>
              <a href="subject.html#53839">[ subject ]</a>
              <a href="author.html#53839">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
