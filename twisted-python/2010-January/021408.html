<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Many connections and TIME_WAIT
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Many%20connections%20and%20TIME_WAIT&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021409.html">
   <LINK REL="Next"  HREF="021410.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Many connections and TIME_WAIT</H1>
    <B>Donal McMullan</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Many%20connections%20and%20TIME_WAIT&In-Reply-To="
       TITLE="[Twisted-Python] Many connections and TIME_WAIT">donal.mcmullan at gmail.com
       </A><BR>
    <I>Tue Jan 26 23:50:14 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021409.html">[Twisted-Python] Twisted newb I can't add a cred checker to	a	Factory class
</A></li>
        <LI>Next message: <A HREF="021410.html">[Twisted-Python] Many connections and TIME_WAIT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21408">[ date ]</a>
              <a href="thread.html#21408">[ thread ]</a>
              <a href="subject.html#21408">[ subject ]</a>
              <a href="author.html#21408">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been prototyping a client that connects to thousands of servers and
calls some method. It's not real important to me at this stage whether
that's via xmlrpc, perspective broker, or something else.

What seems to happen on the client machine is that each network connection
that gets opened and then closed goes into a TIME_WAIT state, and eventually
there are so many connections in that state that it's impossible to create
any more.

I'm keeping an eye on the output of
netstat -an | wc -l
Initially I've got 569 entries there. When I run my test client, that ramps
up really quickly and peaks at about 2824. At that point, the client reports
a callRemoteFailure:

callRemoteFailure [Failure instance: Traceback (failure with no frames):
&lt;class 'twisted.internet.error.ConnectionLost'&gt;: Connection to the other
side was lost in a non-clean fashion: Connection lost.

Increasing the file descriptor limits doesn't seem to have any effect on
this.

Is there an established Twisted sanctioned canonical way to free up this
resource? Or am I doing something wrong? I'm looking into tweaking
SO_REUSEADDR and SO_LINGER - that sound sane?

Just tapping the lazywebs to see if anyone's already seen this in the wild.

Thanks guys

Donal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20100127/68ab5c5b/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20100127/68ab5c5b/attachment.htm</A> 
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021409.html">[Twisted-Python] Twisted newb I can't add a cred checker to	a	Factory class
</A></li>
	<LI>Next message: <A HREF="021410.html">[Twisted-Python] Many connections and TIME_WAIT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21408">[ date ]</a>
              <a href="thread.html#21408">[ thread ]</a>
              <a href="subject.html#21408">[ subject ]</a>
              <a href="author.html#21408">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
