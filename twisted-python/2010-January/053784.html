<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Problem fetching page with getPage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Problem%20fetching%20page%20with%20getPage&In-Reply-To=%3C19263.22881.934832.166484%40jon.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053783.html">
   <LINK REL="Next"  HREF="053785.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Problem fetching page with getPage</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Problem%20fetching%20page%20with%20getPage&In-Reply-To=%3C19263.22881.934832.166484%40jon.es%3E"
       TITLE="[Twisted-Python] Problem fetching page with getPage">terry at jon.es
       </A><BR>
    <I>Sat Jan  2 07:34:09 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053783.html">[Twisted-Python] how manual run LoopingCall.f
</A></li>
        <LI>Next message (by thread): <A HREF="053785.html">[Twisted-Python] Problem fetching page with getPage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53784">[ date ]</a>
              <a href="thread.html#53784">[ thread ]</a>
              <a href="subject.html#53784">[ subject ]</a>
              <a href="author.html#53784">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've run into a problem fetching an HTTP page with t.w.client.getPage. It's
not simple to make standalone code showing what's going wrong, but the
following summarizes where I am and why I find this puzzling.

After some setup, I have some a url path, and some headers I want to
send. A summary:

    host = 'ec2.amazon.com'
    port = 443
    path = '/?some=params&amp;are=here&amp;etc=etc'
    method = 'GET'
    data = ''
    headers = { 'some' : 'headers', 'Content-Length' : '0' }
    url = '<A HREF="https://%s:%d%s">https://%s:%d%s</A>' % (host, port, path)

the actual details don't matter right now, I don't think.  When I call

  d = getPage(url, headers=headers)

d's errback fires with a twisted.web.error.Error with a 403 status. So
you'd think I had something wrong in my headers, or was trying to access a
forbidden resource, etc.

But.... when I drop this code in instead of the call to getPage:

    import httplib
    cx = httplib.HTTPSConnection(host, port)
    cx.request(method, path, data, headers)
    response = cx.getresponse()
    print 'response status:', response.status
    body = response.read()
    print 'body:', body

I get a 200 status, and the body is exactly as expected.

BTW, the path above does start with a slash. I've tried using
HTTPClientFactory and reactor.connectSSL directly.  I've tried with and
without the '' postdata and Content-Length header. I've tried with Twisted
8.2.0 and 9.0.0.  And of course I've checked many times that the URL and
its query params requested by httplib and getPage are identical (apart from
the time-sensitive signature).

The reason it's not easy to provide a simple example is that the URL and
headers have signed components, based in part on a timestamp, and based in
part on Amazon secret keys, etc. It's not easy to separate all that, and if
I did I'd be posting at least 100 lines of code that would only run if you
had your Amazon AWS details provided etc.

In any case, it looks like the problem is not in the setup of the request.
Can anyone offer a reason why httplib might be able to fetch the page
whereas getPage receives an error?  I'm stumped.

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053783.html">[Twisted-Python] how manual run LoopingCall.f
</A></li>
	<LI>Next message (by thread): <A HREF="053785.html">[Twisted-Python] Problem fetching page with getPage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53784">[ date ]</a>
              <a href="thread.html#53784">[ thread ]</a>
              <a href="subject.html#53784">[ subject ]</a>
              <a href="author.html#53784">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
