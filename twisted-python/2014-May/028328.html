<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] tor hidden service endpoint parser returns a	deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20tor%20hidden%20service%20endpoint%20parser%20returns%20a%0A%09deferred&In-Reply-To=%3CCAFN1edprzLY%2B7mr9Z9d-SNjvKfWwMRb8E0KWNz98SjdS98UB6A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028326.html">
   <LINK REL="Next"  HREF="028329.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] tor hidden service endpoint parser returns a	deferred</H1>
    <B>David Stainton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20tor%20hidden%20service%20endpoint%20parser%20returns%20a%0A%09deferred&In-Reply-To=%3CCAFN1edprzLY%2B7mr9Z9d-SNjvKfWwMRb8E0KWNz98SjdS98UB6A%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] tor hidden service endpoint parser returns a	deferred">dstainton415 at gmail.com
       </A><BR>
    <I>Tue May  6 05:38:13 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028326.html">[Twisted-Python] tor hidden service endpoint parser returns a	deferred
</A></li>
        <LI>Next message: <A HREF="028329.html">[Twisted-Python] tor hidden service endpoint parser returns a	deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28328">[ date ]</a>
              <a href="thread.html#28328">[ thread ]</a>
              <a href="subject.html#28328">[ subject ]</a>
              <a href="author.html#28328">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> The endpoint constructor should do _construction_.  The endpoint parser
</I>&gt;<i> should do _parsing_.  The task of parsing is of taking strings and producing
</I>&gt;<i> meaningful values.
</I>
Ah yeah I see what you mean. OK... I changed it:
<A HREF="https://github.com/david415/txtorcon/commit/1e96d550c40bef1be1b45c3c975c0da0bf6a2949">https://github.com/david415/txtorcon/commit/1e96d550c40bef1be1b45c3c975c0da0bf6a2949</A>

&gt;<i> You may want to have the endpoint parser actually live in a separate method
</I>&gt;<i> in txtorcon rather than putting it into the plugin itself, and leave the
</I>&gt;<i> plugin simply the task of plugging in, but the parsing method should not be
</I>&gt;<i> called __init__.
</I>
Done.

&gt;<i> (Also, don't use asserts.  This is probably indicative of a weakness in the
</I>&gt;<i> parsing API we've provided, but you should likely raise something like
</I>&gt;<i> UsageError.)
</I>
OK... I changed that part too.

&gt;<i> What exactly is 'usewithtor'?
</I>&gt;<i>
</I>&gt;<i> usewithtor pip install twisted
</I>
It's torsocks. It performs an LD_PRELOAD hack to force programs to use tor.
Here's some torsocks info:

<A HREF="https://trac.torproject.org/projects/tor/wiki/doc/torsocks">https://trac.torproject.org/projects/tor/wiki/doc/torsocks</A>
<A HREF="https://gitweb.torproject.org/torsocks.git">https://gitweb.torproject.org/torsocks.git</A>
<A HREF="https://lists.torproject.org/pipermail/tor-dev/2014-April/006649.html">https://lists.torproject.org/pipermail/tor-dev/2014-April/006649.html</A>

Torsocks is useful... but a terrible hack... and this reminds me:

I'm hoping that the effort to make Tahoe-LAFS more Tor-friendly will
result in well documented
solutions. I would hope that this would make it easier for other
developers to make their twisted apps more Tor-friendly as well.
I do not think we have all the solution details worked out yet...

We'd like to stop using torsocks with Tahoe-LAFS and instead use
twisted endpoints...
which is why I ported the Foolscap client side to use twisted endpoints.
(str4d already ported the Foolscap server side to use endpoints)

<A HREF="https://tahoe-lafs.org/trac/tahoe-lafs/ticket/517">https://tahoe-lafs.org/trac/tahoe-lafs/ticket/517</A>

This trac ticket discusses various ideas to make Tahoe more Tor friendly...
including this endpoint related idea that I've been thinking about
lately in trac comment 16
(<A HREF="https://tahoe-lafs.org/trac/tahoe-lafs/ticket/517#comment:16">https://tahoe-lafs.org/trac/tahoe-lafs/ticket/517#comment:16</A>) by leif
:<i>
</I>
&quot;&quot;&quot;My current thought is that Tahoe should have an &quot;always_use_tor&quot;
option which causes all furls to be rewritten as tor: endpoints before
being passed to foolscap. If this option is not enabled, tor
connections will be made if a tor endpoint is used, but not otherwise.
So, users of mixed tor/non-tor grids can leave it disabled if they
prefer faster connections to non-tor nodes.&quot;&quot;&quot;

This is necessary for a tahoe client wanting to use a public grid over
tor... because the grid's introducer node is going to
announce tcp endpoints not tor endpoints.

However I was thinking that the &quot;only_tor&quot; mode for tahoe (mentioned
here <A HREF="https://tahoe-lafs.org/trac/tahoe-lafs/ticket/517#comment:15">https://tahoe-lafs.org/trac/tahoe-lafs/ticket/517#comment:15</A> )
could be implemented in tahoe... it could filter endpoint descriptors
by calling clientFromString or serverFromString and then checking the
object type.... or is this a terrible way to do it? I'm not sure. The
thing is... tahoe wouldn't normally
know anything about endpoints because it uses Foolscap which could use
endpoints (it does in my branch
<A HREF="https://github.com/david415/foolscap/tree/endpoint_descriptors_server2">https://github.com/david415/foolscap/tree/endpoint_descriptors_server2</A>).

&gt;<i> Don't build eggs.  Why are you building eggs?  Eggs are unfortunately a huge
</I>&gt;<i> problem magnet.  I don't think 'pip install' builds eggs; I don't manually
</I>&gt;<i> run setup.py anywhere any more because I assume pip understands these
</I>&gt;<i> concerns better than I do.
</I>
Ah OK yeah it works just fine when installed with pip.

&gt;<i> Figure out a way to hook the _build_ step specifically so you can run
</I>&gt;<i> getPlugins() to generate the dropin cache before zipping up your zip file.
</I>&gt;<i> Twisted plugins actually do work within zip files, but nobody has bothered
</I>&gt;<i> working out the setuptools incantation to get them to generate at the
</I>&gt;<i> appropriate time for building an egg.  This is extra tricky because you only
</I>&gt;<i> want to generate this dropin.cache file if the dropin is going to live
</I>&gt;<i> inside an egg; otherwise, it would conflict with the communal dropin.cache
</I>&gt;<i> file generated at install time.  This option will be the most confusing and
</I>&gt;<i> frustrating for you, but I hope you choose it, because it would be GREAT to
</I>&gt;<i> have a Right Way&#8482; to address this problem in a Twisted plugin project's
</I>&gt;<i> setup.py :).
</I>
OK... I'll try to get it working that way... but for now a pip install
seems to work fine.

&gt;<i> zip_safe flag not set; analyzing archive contents...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It's probably best to set zip_safe one way or the other though, even if you
</I>&gt;<i> want to set it to 'true'.  Letting setuptools guess like this will,
</I>&gt;<i> unsurprisingly, get you unpredictable results.
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028326.html">[Twisted-Python] tor hidden service endpoint parser returns a	deferred
</A></li>
	<LI>Next message: <A HREF="028329.html">[Twisted-Python] tor hidden service endpoint parser returns a	deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28328">[ date ]</a>
              <a href="thread.html#28328">[ thread ]</a>
              <a href="subject.html#28328">[ subject ]</a>
              <a href="author.html#28328">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
