<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Why would someone need SSHTransportAddress?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Why%20would%20someone%20need%20SSHTransportAddress%3F&In-Reply-To=%3CCAFN1edoXSZobgyGn0Gv8MkyP_KRVdTEE9sG-yae%3D9BPY%3DZxnSg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028362.html">
   <LINK REL="Next"  HREF="028363.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Why would someone need SSHTransportAddress?</H1>
    <B>David Stainton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Why%20would%20someone%20need%20SSHTransportAddress%3F&In-Reply-To=%3CCAFN1edoXSZobgyGn0Gv8MkyP_KRVdTEE9sG-yae%3D9BPY%3DZxnSg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Why would someone need SSHTransportAddress?">dstainton415 at gmail.com
       </A><BR>
    <I>Mon May 19 12:48:07 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028362.html">[Twisted-Python] Why would someone need SSHTransportAddress?
</A></li>
        <LI>Next message: <A HREF="028363.html">[Twisted-Python] IOpenSSLClientConnectionCreator was ContextFactory, now it's IOpenSSLClientConnectionCreator not ContextFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28364">[ date ]</a>
              <a href="thread.html#28364">[ thread ]</a>
              <a href="subject.html#28364">[ subject ]</a>
              <a href="author.html#28364">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It seems like a fairly common idiom to setup some sort of TCP server
with a kernel selected port
via an endpoint descriptor like this:

def getListeningPort(listeningPort):
    address = listeningPort.getHost()
    endpointDesc = convertAddressToEndpointDesc(address)
    sendAnnouncement(endpointDesc)

endpoint = serverFromString(self.reactor, 'tcp:0')
d = endpoint.listen(MyProtocolFactory())
d.addCallback(getListeningPort)

...
later on a remote client receives the endpoint string and uses it to connect:

endpointDesc = getAnnouncement()
endpoint = clientFromString(endpointDesc)
endpoint.connect(MyFactory())

For the Tor Hidden Services endpoint (work in progress) I've
implemented IAddress and IListeningPort:
<A HREF="https://github.com/david415/txtorcon/blob/endpoint_parser_plugin-rewrite4/txtorcon/torconfig.py#L106-L160">https://github.com/david415/txtorcon/blob/endpoint_parser_plugin-rewrite4/txtorcon/torconfig.py#L106-L160</A>

Creating a Tor Hidden Service endpoint without specifying a &quot;hidden
services directory&quot; containing an rsa private key and a hostname file
causes the endpoint object to create a new Tor Hidden Service. This is
conceptually similar to the case where we create a TCP server endpoint
with the port number set to zero. In both cases the fired
IListeningPort implementation should tell us what we need to know in
order to construct a client endpoint descriptor string.

I was thinking that it would be great if the process of creating these
endpoint strings from an IAddress implementation should/could be
endpoint agnostic. It should work even if the endpoint descriptors
have no notion of hosts or ports... For protocols like TCP it is
non-obvious how to do this correctly because the host cannot be
correctly guessed in the face of NAT routers etc... as mentioned here:
<A HREF="https://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITransport.html#getPeer">https://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITransport.html#getPeer</A>

This is why the above TCP example is flawed; however the equivalent
example with the Tor endpoints will work perfectly and is not affected
by NAT routers:
<A HREF="https://github.com/david415/txsocksx/blob/tor_deferred_dispatcher/examples/tor-dispatch-onion.py#L39-L63">https://github.com/david415/txsocksx/blob/tor_deferred_dispatcher/examples/tor-dispatch-onion.py#L39-L63</A>

The TorOnionAddress has all the information it needs to create a Tor
client endpoint... except for the endpoint type identifier and a set
of rules from constructing endpoint strings... which perhaps the
TorOnionAddress should get from the TCPHiddenServiceEndpointParser?
Perhaps if the user were to pass in more information to the server
endpoint object then the TCP IListeningPort implementation would be
able to correctly produce a TCP client endpoint strings. Or maybe this
just doesn't make sense for protocols like TCP.



On Mon, May 19, 2014 at 3:59 PM,  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
&gt;<i> On 06:27 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This email is bases on comment from
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/trac/ticket/5999">https://twistedmatrix.com/trac/ticket/5999</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I fail to see the reason why SSHTransportAddress exist and why would
</I>&gt;&gt;<i> anyone need It.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Here are a couple ideas.
</I>&gt;<i>
</I>&gt;<i> You have a library that accepts a connection and does some things with it.
</I>&gt;<i> You want to log the operations that are taken using the connection and you
</I>&gt;<i> want to include information in those logs about which connection you did
</I>&gt;<i> things with.  You choose to use the addresses of the local and remote sides
</I>&gt;<i> of the connection to identify it.
</I>&gt;<i>
</I>&gt;<i> You have a library that accepts a connection and wants to be able to set up
</I>&gt;<i> another connection like it to the same remote address.  You get the remote
</I>&gt;<i> address using the transport's `getPeer` method.
</I>&gt;<i>
</I>&gt;<i> Though you may have established the SSH connection over a TCP/IPv4
</I>&gt;<i> connection, neither of these uses can be accomplished if the SSH connection,
</I>&gt;<i> when treated as a transport, merely uses an `IPv4Address` instance to
</I>&gt;<i> represent the address of the remote end of the connection. Using
</I>&gt;<i> `IPv4Address` gives you no way to differentiate between an SSH connection
</I>&gt;<i> running over a TCP/IPv4 connection and a plain TCP/IPv4 connection without
</I>&gt;<i> SSH.
</I>&gt;<i>
</I>&gt;<i> In practice, `SSHTransportAddress` is missing the information you would need
</I>&gt;<i> to implement either of these scenarios.  However, that seems more like an
</I>&gt;<i> argument for adding the missing information to that address type rather than
</I>&gt;<i> discarding the address type.
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028362.html">[Twisted-Python] Why would someone need SSHTransportAddress?
</A></li>
	<LI>Next message: <A HREF="028363.html">[Twisted-Python] IOpenSSLClientConnectionCreator was ContextFactory, now it's IOpenSSLClientConnectionCreator not ContextFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28364">[ date ]</a>
              <a href="thread.html#28364">[ thread ]</a>
              <a href="subject.html#28364">[ subject ]</a>
              <a href="author.html#28364">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
