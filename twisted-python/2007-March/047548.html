<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] using stdio with Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20using%20stdio%20with%20Twisted&In-Reply-To=%3C000E1D16-E278-4F75-906F-9D477D428101%40evernex.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047547.html">
   <LINK REL="Next"  HREF="047542.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] using stdio with Twisted</H1>
    <B>Neurophyre</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20using%20stdio%20with%20Twisted&In-Reply-To=%3C000E1D16-E278-4F75-906F-9D477D428101%40evernex.com%3E"
       TITLE="[Twisted-Python] using stdio with Twisted">listbox at evernex.com
       </A><BR>
    <I>Tue Mar 20 14:31:19 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047547.html">[Twisted-Python] using stdio with Twisted
</A></li>
        <LI>Next message (by thread): <A HREF="047542.html">[Twisted-Python] Inheriting t.a.service.Service and super
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47548">[ date ]</a>
              <a href="thread.html#47548">[ thread ]</a>
              <a href="subject.html#47548">[ subject ]</a>
              <a href="author.html#47548">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mar 20, 2007, at 12:43 PM, Jean-Paul Calderone wrote:

&gt;<i>
</I>&gt;<i> Well, it is also a protocol implementation for something like  
</I>&gt;<i> VT102.  A lot
</I>&gt;<i> of the tests bypass the byte-level stuff because that's not what's  
</I>&gt;<i> interesting
</I>&gt;<i> for what they're testing.  In your actual code, ServerProtocol is  
</I>&gt;<i> what is
</I>&gt;<i> responsible for calling keystrokeReceived with all of those  
</I>&gt;<i> interesting
</I>&gt;<i> values.
</I>
Sorry, but I don't understand how to make it do that.  I have my own  
user interface 'protocol' which at this point is getting  
keystrokeReceived events and echoing them to the screen, but it's  
only getting a keyID and the modifier field is always None.  Also, if  
I enter a control-key, the control character is echoed (for example  
ctrl-J produces a line feed) but the modifier is not set.

I've grepped your code and found only one place, in widgets.py, where  
it's used that isn't a test case -- and that's just doing a  
comparison on a received keystroke, I think.

Here's my relevant code, for reference:


class DOCUIProtocol(recvline.RecvLine):
     &quot;&quot;&quot;
     A 'protocol' which handles the user interface.
     &quot;&quot;&quot;

     def connectionMade(self):
         &quot;&quot;&quot;runWithProtocol() in main&quot;&quot;&quot;
         # process individual keystrokes, hopefully

         # <A HREF="http://svn.twistedmatrix.com/cvs/sandbox/exarkun/invective/">http://svn.twistedmatrix.com/cvs/sandbox/exarkun/invective/</A> 
trunk/invective/tui.py?rev=19759&amp;view=auto
         super(DOCUIProtocol, self).connectionMade()
         self.terminal.resetPrivateModes([privateModes.CURSOR_MODE])

         # set up quasi-singleton state variables
         self.__buff = ClientUITidbits.KeystrokeBuffer()
         self.__clientUIState = ClientUITidbits.UIState()
         self.__clientUIState.setState(Constants.UISTATE_DISCONNECTED)

         # make a quasi-singleton instance of ourself so others can  
use write() and writeLine()
         dummy = ClientUITidbits.StdIO()
         dummy.stdioInstance = self;

         d = self.write(u'done.\n')
         self.connectBBS()

     def keystrokeReceived(self, keyID, modifier):
         # see <A HREF="http://twistedmatrix.com/documents/current/api/">http://twistedmatrix.com/documents/current/api/</A> 
twisted.conch.insults.insults.TerminalProtocol.html
         # TODO fix for control keys
         self.writeLine(&quot;Got key: &quot; + keyID + &quot; &quot; + str(modifier))

         # ?
         if keyID == ServerProtocol.RIGHT_ARROW:
             self.writeLine(&quot;killed&quot;)
             reactor.stop()

         #self.__buff.append(keyID)
         #ClientParseInput.KeystrokeDispatcher.parse()

     # TODO delete if we continue using insults
     def dataReceived(self, data):
         self.__buff.append(data)
         ClientParseInput.KeystrokeDispatcher.parse()

     def write(self, data):
         &quot;&quot;&quot;write data to stdout, encoded in an output charset&quot;&quot;&quot;
         # TODO delete for conch
         # self.transport.write(data.encode(Constants.CHARSET_OUTPUT))
         self.terminal.write(data.encode(Constants.CHARSET_OUTPUT))

     def writeLine(self, data):
         &quot;&quot;&quot;write data plus a newline, encoded in an output charset&quot;&quot;&quot;
         # TODO find out why this isn't working right
         # TODO delete for conch
         # self.transport.write(data.encode(Constants.CHARSET_OUTPUT  
+ '\n'))
         self.terminal.write(data.encode(Constants.CHARSET_OUTPUT) +  
'\n')

     def connectBBS(self):
         &quot;&quot;&quot;initiate the TCP connection to the BBS server and start  
the reactor.&quot;&quot;&quot;
         # the factory writes diagnostic messages to the stdio  
instance for us
         reactor.connectTCP('vapor.evernex.net', 9023,  
ClientProtocol.BBSClientProtocolFactory())
         # reactor.run()


class CommandLineUserInterface(DOCUIProtocol):
     &quot;&quot;&quot;
     See <A HREF="http://svn.twistedmatrix.com/cvs/sandbox/exarkun/invective/">http://svn.twistedmatrix.com/cvs/sandbox/exarkun/invective/</A> 
trunk/invective/tui.py?rev=19759&amp;view=auto
     &quot;&quot;&quot;

     def connectionMade(self):
         signal(SIGWINCH, self.windowChanged)
         winSize = self.getWindowSize()
         self.width = winSize[0]
         self.height = winSize[1]
         super(CommandLineUserInterface, self).connectionMade()

     def connectionLost(self, reason):
         reactor.stop()

     # XXX Should be part of runWithProtocol
     def getWindowSize(self):
         winsz = ioctl(0, TIOCGWINSZ, '12345678')
         winSize = unpack('4H', winsz)
         newSize = winSize[1], winSize[0], winSize[3], winSize[2]
         return newSize

     def windowChanged(self, signum, frame):
         winSize = self.getWindowSize()
         self.terminalSize(winSize[0], winSize[1])


if __name__ == &quot;__main__&quot;:
     splashLine = Constants.VERSION_CLIENT_LINE + u' - ' +  
Constants.VERSION_COPYRIGHT
     print splashLine.encode(Constants.CHARSET_OUTPUT)
     print 'Connecting user interface: ',
     runWithProtocol(CommandLineUserInterface)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047547.html">[Twisted-Python] using stdio with Twisted
</A></li>
	<LI>Next message (by thread): <A HREF="047542.html">[Twisted-Python] Inheriting t.a.service.Service and super
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47548">[ date ]</a>
              <a href="thread.html#47548">[ thread ]</a>
              <a href="subject.html#47548">[ subject ]</a>
              <a href="author.html#47548">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
