<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] exceptions.TypeError: ('Could not adapt',	&lt;twisted.spread.pb._PortalAuthChallenger instance at 0x013E3760&gt;,	&lt;InterfaceClass twisted.cred.credentials.IUsernamePassword&gt;)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20exceptions.TypeError%3A%20%28%27Could%20not%20adapt%27%2C%0A%09%3Ctwisted.spread.pb._PortalAuthChallenger%20instance%20at%200x013E3760%3E%2C%0A%09%3CInterfaceClass%20twisted.cred.credentials.IUsernamePassword%3E%29&In-Reply-To=%3C20070329205745.18920.618705141.divmod.quotient.6478%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047598.html">
   <LINK REL="Next"  HREF="047620.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] exceptions.TypeError: ('Could not adapt',	&lt;twisted.spread.pb._PortalAuthChallenger instance at 0x013E3760&gt;,	&lt;InterfaceClass twisted.cred.credentials.IUsernamePassword&gt;)</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20exceptions.TypeError%3A%20%28%27Could%20not%20adapt%27%2C%0A%09%3Ctwisted.spread.pb._PortalAuthChallenger%20instance%20at%200x013E3760%3E%2C%0A%09%3CInterfaceClass%20twisted.cred.credentials.IUsernamePassword%3E%29&In-Reply-To=%3C20070329205745.18920.618705141.divmod.quotient.6478%40ohm%3E"
       TITLE="[Twisted-Python] exceptions.TypeError: ('Could not adapt',	&lt;twisted.spread.pb._PortalAuthChallenger instance at 0x013E3760&gt;,	&lt;InterfaceClass twisted.cred.credentials.IUsernamePassword&gt;)">exarkun at divmod.com
       </A><BR>
    <I>Thu Mar 29 14:57:45 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047598.html">[Twisted-Python] exceptions.TypeError: ('Could not adapt',	&lt;twisted.spread.pb._PortalAuthChallenger instance at 0x013E3760&gt;,	&lt;InterfaceClass twisted.cred.credentials.IUsernamePassword&gt;)
</A></li>
        <LI>Next message (by thread): <A HREF="047620.html">[Twisted-Python] exceptions.TypeError: ('Could not adapt',	&lt;twisted.spread.pb._PortalAuthChallenger instance at 0x013E3760&gt;,	&lt;InterfaceClass twisted.cred.credentials.IUsernamePassword&gt;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47605">[ date ]</a>
              <a href="thread.html#47605">[ thread ]</a>
              <a href="subject.html#47605">[ subject ]</a>
              <a href="author.html#47605">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 28 Mar 2007 12:01:12 -0500, Justin Johnson &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I'm running Python 2.5 and Twisted 2.5.0 on Windows 2003 Server.
</I>&gt;<i>
</I>&gt;<i>I have a web site (Twisted/Nevow) where users login with a username
</I>&gt;<i>and password.  I save the username and password once they login
</I>&gt;<i>because the same username and password are used to connect to various
</I>&gt;<i>Perspective Broker servers, and I don't want to make users
</I>&gt;<i>reauthenticate for every server that is connected to behind the
</I>&gt;<i>scenes.  Since the password cannot be hashed when passed to PB I store
</I>&gt;<i>it in plaintext.
</I>&gt;<i>
</I>&gt;<i>Up to this point I have been using a realm and file password db as
</I>&gt;<i>listed at the end of this email.  When I recently upgraded from
</I>&gt;<i>Twisted 2.4.0 to 2.5.0 and from Python 2.4 to 2.5 I get the following
</I>&gt;<i>error.
</I>&gt;<i>
</I>&gt;<i>2007/03/28 10:23 -0500 [Broker,0,IP_ADDRESS] Peer will receive
</I>&gt;<i>following PB traceback:
</I>&gt;<i>2007/03/28 10:23 -0500 [Broker,0,IP_ADDRESS] Unhandled Error
</I>&gt;<i>         Traceback (most recent call last):
</I>&gt;<i>           File &quot;D:\Python25\lib\site-packages\twisted\spread\pb.py&quot;, line
</I>&gt;<i>847, in _recvMessage
</I>&gt;<i>             netResult = object.remoteMessageReceived(self, message, netArgs, 
</I>&gt;<i>netKw)
</I>&gt;<i>           File &quot;D:\Python25\lib\site-packages\twisted\spread\flavors.py&quot;,
</I>&gt;<i>line 119, in remoteMessageReceived
</I>&gt;<i>             state = method(*args, **kw)
</I>&gt;<i>           File &quot;D:\Python25\lib\site-packages\twisted\spread\pb.py&quot;, line
</I>&gt;<i>1217, in remote_respond
</I>&gt;<i>             d = self.portalWrapper.portal.login(self, mind, IPerspective)
</I>&gt;<i>           File &quot;D:\Python25\lib\site-packages\twisted\cred\portal.py&quot;, line
</I>&gt;<i>109, in login
</I>&gt;<i>             return maybeDeferred(c.requestAvatarId, credentials
</I>&gt;<i>         --- &lt;exception caught here&gt; ---
</I>&gt;<i>           File &quot;D:\Python25\lib\site-packages\twisted\internet\defer.py&quot;,
</I>&gt;<i>line 107, in maybeDeferred
</I>&gt;<i>             result = f(*args, **kw)
</I>&gt;<i>           File &quot;d:\python25\lib\site-packages\ratcontrol\login.py&quot;, line 
</I>&gt;<i>195,
</I>&gt;<i>in requestAvatarId
</I>&gt;<i>             up = credentials.IUsernamePassword(c)
</I>&gt;<i>         exceptions.TypeError: ('Could not adapt',
</I>&gt;<i>&lt;twisted.spread.pb._PortalAuthChallenger instance at 0x013E3760&gt;,
</I>&gt;<i>
</I>&gt;<i>&lt;InterfaceClass twisted.cred.credentials.IUsernamePassword&gt;)
</I>&gt;<i>
</I>&gt;<i>2007/03/28 10:23 -0500 [Broker,client] Unhandled error in Deferred:
</I>&gt;<i>2007/03/28 10:23 -0500 [Broker,client] Unhandled Error
</I>&gt;<i>         Traceback from remote host -- Traceback unavailable
</I>&gt;<i>
</I>&gt;<i>I looked at the Subversion log for twisted.spread.pb.py and am not
</I>&gt;<i>sure what change is causing this failure.  The contents of
</I>&gt;<i>ratcontrol\login.py are below.
</I>&gt;<i>
</I>&gt;<i>Does anyone have any pointers on what I should be looking for here?
</I>&gt;<i>Is there any way I can accomplish my goal in a more maintainable way?
</I>
It's not clear to me how this worked in the first place. ;)  The
credentials object being adapted to IUsernamePassword should always
have been a _PortalAuthChallenger, and so it only should have ever
been adaptable to IUsernameHashedPassword and IUsernameMD5Password.

The way you want to write requestAvatarId, though, is to inspect the
credentials object to see what interfaces it provides and them handle
it accordingly.  You can do this by adapting and catching the TypeError,
adapting with a default and checking for that, or using the providedBy
method of the interface object.  The important point is that you have to
be able to handle every kind of credentials object which the you have
declared you can handle (with the credentialInterfaces attribute).  In
this specific case, I believe your checker declared it could handle both
IUsernamePassword and IUsernameHashedPassword, but its implementation can
only actually handle IUsernameePassword.

Hope this helps,

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047598.html">[Twisted-Python] exceptions.TypeError: ('Could not adapt',	&lt;twisted.spread.pb._PortalAuthChallenger instance at 0x013E3760&gt;,	&lt;InterfaceClass twisted.cred.credentials.IUsernamePassword&gt;)
</A></li>
	<LI>Next message (by thread): <A HREF="047620.html">[Twisted-Python] exceptions.TypeError: ('Could not adapt',	&lt;twisted.spread.pb._PortalAuthChallenger instance at 0x013E3760&gt;,	&lt;InterfaceClass twisted.cred.credentials.IUsernamePassword&gt;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47605">[ date ]</a>
              <a href="thread.html#47605">[ thread ]</a>
              <a href="subject.html#47605">[ subject ]</a>
              <a href="author.html#47605">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
