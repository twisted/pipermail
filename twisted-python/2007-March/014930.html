<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] TCP client that can connect to a server at	periodic intervals
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20TCP%20client%20that%20can%20connect%20to%20a%20server%20at%0A%09periodic%20intervals&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014929.html">
   <LINK REL="Next"  HREF="014932.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] TCP client that can connect to a server at	periodic intervals</H1>
    <B>Gaspard, Bradley S</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20TCP%20client%20that%20can%20connect%20to%20a%20server%20at%0A%09periodic%20intervals&In-Reply-To="
       TITLE="[Twisted-Python] TCP client that can connect to a server at	periodic intervals">BRADLEY.S.GASPARD at saic.com
       </A><BR>
    <I>Mon Mar  5 12:58:50 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="014929.html">[Twisted-Python] Weekly Bug Summary
</A></li>
        <LI>Next message: <A HREF="014932.html">[Twisted-Python] TCP client that can connect to a server at	periodic intervals
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14930">[ date ]</a>
              <a href="thread.html#14930">[ thread ]</a>
              <a href="subject.html#14930">[ subject ]</a>
              <a href="author.html#14930">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I am trying to write a TCP client that at regular intervals connects to a server makes a request and then closes the connection. Below is the code I've been playing with. I've seen an example of LoopingCall used for periodically sending UPD packets but am not sure how it would apply here because it would seem I need to periodically create new Protocol instances in the ClientFactory class. I've looked for examples and through the documentation but have come up empty. Any pointers would be greatly appreceiated.

class AnnouncementFetcher(protocol.Protocol):

    def connectionMade(self):
        print &quot;connectionMade called&quot;
        self.transport.write(MSG_INFO_IPC)

    def dataReceived(self, data):
        print &quot;Received: &quot;, repr(data)
        # self.factory.share.saveData(data)
        self.transport.loseConnection()
        

class AnnouncementFetcherFactory(protocol.ClientFactory):
    protocol = AnnouncementFetcher

    def __init__(self, share):
        self.share = share

    def buildProtocol(self, addr):
        print 'Connected.'
        p = AnnouncementFetcher()
        p.factory = self
        return p

    def clientConnectionLost(self, connector, reason):
        print 'Lost connection,  Reason:', reason
        reactor.callLater(5, self.buildProtocol, 'localhost')

    def clientConnectionFailed(self, connector, reason):
        print 'Connection failed. Reason:', reason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20070305/f6c63222/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20070305/f6c63222/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014929.html">[Twisted-Python] Weekly Bug Summary
</A></li>
	<LI>Next message: <A HREF="014932.html">[Twisted-Python] TCP client that can connect to a server at	periodic intervals
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14930">[ date ]</a>
              <a href="thread.html#14930">[ thread ]</a>
              <a href="subject.html#14930">[ subject ]</a>
              <a href="author.html#14930">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
