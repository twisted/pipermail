<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Migrate Asyncore to Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Migrate%20Asyncore%20to%20Twisted&In-Reply-To=a7964aae0703140832l702056abwdda0863f13399497%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015005.html">
   <LINK REL="Next"  HREF="015010.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Migrate Asyncore to Twisted</H1>
    <B>jian wu</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Migrate%20Asyncore%20to%20Twisted&In-Reply-To=a7964aae0703140832l702056abwdda0863f13399497%40mail.gmail.com"
       TITLE="[Twisted-Python] Migrate Asyncore to Twisted">hellojianwu at gmail.com
       </A><BR>
    <I>Thu Mar 15 02:38:20 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015005.html">[Twisted-Python] Migrate Asyncore to Twisted
</A></li>
        <LI>Next message: <A HREF="015010.html">[Twisted-Python] Migrate Asyncore to Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15009">[ date ]</a>
              <a href="thread.html#15009">[ thread ]</a>
              <a href="subject.html#15009">[ subject ]</a>
              <a href="author.html#15009">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sean,

&gt;<i> Even with asyncore I don't need two threads per connection. The
</I>&gt;<i> asyncore loop handles the send and receive just fine.
</I>
I think that I had better correcting my term as &quot;4 types of threads&quot; or
&quot;4 types of threading tasks&quot; since Twisted has a thread pool, so you
don't need start thread by your python code, you just submit your
task to Twisted Thread Pool, it'll schedule and run for you.

&gt;<i> I'm more interested in a mapping from asyncore dispatcher to
</I>&gt;<i> twisted protocol. This is on my to do list to figure out but for
</I>&gt;<i> my current project i don't have time.
</I>
Again, I might not be the right person to define the mapping.
Also, I think that you don't have to restrict yourself in an
one-to-one-map-porting mode since Twisted has more rich
features and functionalities than &quot;asyncore&quot;, such as thread
pool and that should be other alternative way to implement
async message routing like using Deferred along with Callback
Chain.

This is just my 2 cents.

Best regards,

Jian


On 3/14/07, Sean Roark &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">srock258 at gmail.com</A>&gt; wrote:
&gt;<i> &gt;Assuming that your python program is connected to your two
</I>&gt;<i> &gt;devices with two independent TCP connections, your python
</I>&gt;<i> &gt;program actually is doing message based routing among two
</I>&gt;<i> &gt;async bi-directional tcp channels.
</I>&gt;<i>
</I>&gt;<i> This is a very good way to describe it, thank you.
</I>&gt;<i>
</I>&gt;<i> &gt;Four extra threads is four more than there's any reason to have here.  Two
</I>&gt;<i> &gt;threads per socket is the kind of thing Twisted exists to let you avoid.
</I>&gt;<i>
</I>&gt;<i> Even with asyncore I don't need two threads per connection. The asyncore
</I>&gt;<i> loop handles the send and receive just fine. My Queue interface between my
</I>&gt;<i> application and the comms layer is what I need a protocol for. Abstractly,
</I>&gt;<i> it isn't complicated, I just don't have time to go down that road without
</I>&gt;<i> any guidance because if it takes more then a day or two I'm toast.
</I>&gt;<i>
</I>&gt;<i> I'm more interested in a mapping from asyncore dispatcher to twisted
</I>&gt;<i> protocol. This is on my to do list to figure out but for my current project
</I>&gt;<i> i don't have time. Something filling in these blanks would be perfect:
</I>&gt;<i>
</I>&gt;<i> Asyncore.dispatcher -----&gt;Twisted Protocol
</I>&gt;<i> handle_connect ------------&gt; ?
</I>&gt;<i> handle_read      ------------&gt; read, getline, readraw, etc...
</I>&gt;<i> handle_write     ------------&gt; sendline, send, etc...
</I>&gt;<i>  handle_expt     ------------&gt; ?
</I>&gt;<i> ?                    -------------&gt; buildFactory
</I>&gt;<i> asyncore.loop  ------------&gt; reactor.run
</I>&gt;<i>
</I>&gt;<i> Obviously need more then just that.
</I>&gt;<i>
</I>&gt;<i> I have found the online examples and documentation to be quite terse when
</I>&gt;<i> describing how things fit together. When I eventually get the chance to make
</I>&gt;<i> this migration I plan to write a tutorial. In my opinion the less legacy
</I>&gt;<i> code directly using asyncore in this world, the better, so may as well make
</I>&gt;<i> it easy to migrate.
</I>&gt;<i>
</I>&gt;<i> Sean
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 3/14/07, Jean-Paul Calderone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; wrote:
</I>&gt;<i> &gt; On Wed, 14 Mar 2007 00:26:23 -0700, jian wu &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">hellojianwu at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt;Hi Sean,
</I>&gt;<i> &gt; &gt;&gt;I am actually not sure if it is my protocol that is complicated
</I>&gt;<i> &gt; &gt;&gt;or if the way in which I want to pass the data that is complicated.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;I should claim that I'm not very well experienced with either Twisted
</I>&gt;<i> &gt; &gt;or asyncore, My guess is that is not protocol but the way to pass
</I>&gt;<i> &gt; &gt;data.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;Assuming that your python program is connected to your two
</I>&gt;<i> &gt; &gt;devices with two independent TCP connections, your python
</I>&gt;<i> &gt; &gt;program actually is doing message based routing among two
</I>&gt;<i> &gt; &gt;async bi-directional tcp channels.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;My guess is that you can keep two Queues since it will help
</I>&gt;<i> &gt; &gt;keeping the order of the async messages received and processed.
</I>&gt;<i> &gt; &gt;And, since twisted has a thread pool, it might be doable that
</I>&gt;<i> &gt; &gt;you could create four threads, two for each TCP Connections,
</I>&gt;<i> &gt; &gt;one thread for read and another for write per TCP connection,
</I>&gt;<i> &gt; &gt;the read thread will handle the received message, process it
</I>&gt;<i> &gt; &gt;and put it into the Queue, the write thread will take the message
</I>&gt;<i> &gt; &gt;from the Queue and write it out to the targeted TCP connection.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Four extra threads is four more than there's any reason to have here.  Two
</I>&gt;<i> &gt; threads per socket is the kind of thing Twisted exists to let you avoid.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Jean-Paul
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> Sean Roark
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015005.html">[Twisted-Python] Migrate Asyncore to Twisted
</A></li>
	<LI>Next message: <A HREF="015010.html">[Twisted-Python] Migrate Asyncore to Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15009">[ date ]</a>
              <a href="thread.html#15009">[ thread ]</a>
              <a href="subject.html#15009">[ subject ]</a>
              <a href="author.html#15009">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
