<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twistd memory usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twistd%20memory%20usage&In-Reply-To=%3C46024065.5090404%40sensisoft.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047563.html">
   <LINK REL="Next"  HREF="047549.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twistd memory usage</H1>
    <B>Jarek Zgoda</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twistd%20memory%20usage&In-Reply-To=%3C46024065.5090404%40sensisoft.com%3E"
       TITLE="[Twisted-Python] Twistd memory usage">jarek.zgoda at sensisoft.com
       </A><BR>
    <I>Thu Mar 22 02:37:57 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047563.html">[Twisted-Python] Twistd memory usage
</A></li>
        <LI>Next message (by thread): <A HREF="047549.html">[Twisted-Python] Twisted.Names assistance with auth and additional	sections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47569">[ date ]</a>
              <a href="thread.html#47569">[ thread ]</a>
              <a href="subject.html#47569">[ subject ]</a>
              <a href="author.html#47569">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Itamar Shtull-Trauring napisa≈Ç(a):

&gt;&gt;<i> I have an application, ran as twistd plugin. If I run it as daemon,
</I>&gt;&gt;<i> twistd consumes all available memory (of 4GB available), then after few
</I>&gt;&gt;<i> seconds of swapping twistd is killed by kernel's OOM killer. I cann't
</I>&gt;&gt;<i> reproduce this when I run this application in no-daemon mode (twistd
</I>&gt;&gt;<i> -n), the memory footprint is constant and does not exceed 150MB. Is this
</I>&gt;&gt;<i> normal behaviour?
</I>&gt;<i> 
</I>&gt;<i> That is not normal behavior. Maybe you could expand a bit on what the
</I>&gt;<i> program does, what the logs say, etc.?
</I>
The application is search/indexing server using PyLucene. It is done as
twisted web resource (rpy). Due to PyLucene limitation, the application
must use &quot;special&quot; thread class (PyLucene.PythonThread) to access index
content. This thread is started in reactor's after startup event
trigger. There is one really large datastructure in the application (the
Queue.Queue object holding dictionaries of documents to be indexed).

As the memory consumption grows in the time of adding documents to
queue, I suspect some problem with garbage collector and the fact that I
observe this behaviour only in daemonized application adds only more
confusion.

There's nothing special in logs, neither twistd or system. Of course,
OOM killer activation is reflected in /var/log/messages, but with no
apparent clues for possible causes. Twistd did not log anything (even
its death).

For now, twistd is run in nodaemon mode (-ny), but I know it's suboptimal...

-- 
Jarek Zgoda

&quot;We read Knuth so you don't have to.&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047563.html">[Twisted-Python] Twistd memory usage
</A></li>
	<LI>Next message (by thread): <A HREF="047549.html">[Twisted-Python] Twisted.Names assistance with auth and additional	sections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47569">[ date ]</a>
              <a href="thread.html#47569">[ thread ]</a>
              <a href="subject.html#47569">[ subject ]</a>
              <a href="author.html#47569">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
