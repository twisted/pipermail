<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Foolscap: CopyableSlicer has no streamable	attribute?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Foolscap%3A%20CopyableSlicer%20has%20no%20streamable%0A%09attribute%3F&In-Reply-To=%3C200703011712.27251.iacovou%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   <LINK REL="Next"  HREF="047423.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Foolscap: CopyableSlicer has no streamable	attribute?</H1>
    <B>kgi</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Foolscap%3A%20CopyableSlicer%20has%20no%20streamable%0A%09attribute%3F&In-Reply-To=%3C200703011712.27251.iacovou%40gmail.com%3E"
       TITLE="[Twisted-Python] Foolscap: CopyableSlicer has no streamable	attribute?">iacovou at gmail.com
       </A><BR>
    <I>Thu Mar  1 08:12:27 MST 2007</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="047423.html">[Twisted-Python] factory class has no __class__ attribute!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47422">[ date ]</a>
              <a href="thread.html#47422">[ thread ]</a>
              <a href="subject.html#47422">[ subject ]</a>
              <a href="author.html#47422">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi all.

I'm using Foolscap in a project with many disparate types and am gradually 
learning all the ins and outs of sending these all over the place.

I've got an exception occurring that is stumping me. I think it may be a bug 
in Foolscap, but I don't know enough about the inner workings to be sure.

The error is:

  'CopyableSlicer' object has no attribute 'streamable'

Which occurs here (I'm using SVN Foolscap, BTW):

&gt;<i> /usr/lib/python2.4/site-packages/foolscap/banana.py(312)pushSlicer()
</I>(Pdb) l
312  -&gt;         itr = slicer.slice(topSlicer.streamable, self)
313             next = iter(itr).next
(Pdb) whatis topSlicer
&lt;class 'foolscap.copyable.CopyableSlicer'&gt;
(Pdb) dir(topSlicer)
['__class__', '__delattr__', '__dict__', '__doc__', '__getattribute__', '__hash__',
'__implemented__', '__init__', '__module__', '__new__', '__providedBy__',
'__provides__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__',
'__str__', '__weakref__', 'childAborted', 'describe', 'obj', 'opentype',
'parent', 'registerReference', 'sendOpen', 'slice', 'sliceBody',
'slicerForObject', 'slices', 'trackReferences']

So the error happened when trying to access topSlicer.streamable, and indeed, 
dir() shows there is no such attribute on the object, which is of type 
CopyableSlicer. Now, CopyableSlicer is defined like this:

class CopyableSlicer(slicer.BaseSlicer):
    &quot;&quot;&quot;I handle ICopyable objects (things which are copied by value).&quot;&quot;&quot;
    def slice(self, streamable, banana):
        yield 'copyable'
        copytype = self.obj.getTypeToCopy()
        assert isinstance(copytype, str)
        yield copytype
        state = self.obj.getStateToCopy()
        for k,v in state.iteritems():
            yield k
            yield v
    def describe(self):
        return &quot;&lt;%s&gt;&quot; % self.obj.getTypeToCopy()
registerAdapter(CopyableSlicer, ICopyable, tokens.ISlicer)

So it overrides slicer.BaseSlicer.slice(). Now, in slicer.BaseSlicer, we see:

class BaseSlicer:
    __metaclass__ = SlicerClass
    implements(tokens.ISlicer)
    ....
    def slice(self, streamable, banana):
        # this is what makes us ISlicer
        self.streamable = streamable
        assert self.opentype
        for o in self.opentype:
            yield o
        for t in self.sliceBody(streamable, banana):
            yield t

Note the line following the comment, &quot;# this is what makes us ISlicer&quot; sets 
a 'streamable' attribute on the object in the base class, but the subclass 
doesn't preserve this behaviour.

Is this a bug, or is my exception being caused by something else?

Regards,

Ricky



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="047423.html">[Twisted-Python] factory class has no __class__ attribute!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47422">[ date ]</a>
              <a href="thread.html#47422">[ thread ]</a>
              <a href="subject.html#47422">[ subject ]</a>
              <a href="author.html#47422">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
