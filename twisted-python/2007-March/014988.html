<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Learning about IPushProducer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Learning%20about%20IPushProducer&In-Reply-To=20070312210956.18920.1418770739.divmod.quotient.1476%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014986.html">
   <LINK REL="Next"  HREF="014990.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Learning about IPushProducer</H1>
    <B>Rutt, Benjamin</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Learning%20about%20IPushProducer&In-Reply-To=20070312210956.18920.1418770739.divmod.quotient.1476%40ohm"
       TITLE="[Twisted-Python] Learning about IPushProducer">Benjamin.Rutt at gs.com
       </A><BR>
    <I>Mon Mar 12 17:46:54 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="014986.html">[Twisted-Python] Learning about IPushProducer
</A></li>
        <LI>Next message: <A HREF="014990.html">[Twisted-Python] Learning about IPushProducer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14988">[ date ]</a>
              <a href="thread.html#14988">[ thread ]</a>
              <a href="subject.html#14988">[ subject ]</a>
              <a href="author.html#14988">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>    Sorry, your question was big and challenging to approach.

Understood, thanks.  I should have pared it down.

    This loop:
    
    &gt;	        while not self.paused and self.howmany &gt;
    &gt;self.sent_already:
    &gt;	            chunksz = min(maxchunksz, self.howmany -
    &gt;self.sent_already)
    &gt;	            self.consumer.write('x' * chunksz)
    &gt;	            self.sent_already += chunksz
    
    is a bit atypical, I think.  The reason it is eventually stopping
    is that your code is being invoked re-entrantly by the consumer as
    soon as it decides its buffer is full.  I'm not sure the loop is
    /wrong/, but it is a bit surprising.  You don't need a mutex here,
    since it's single threaded, but you do need to be aware that your
    code can be re-entered within a single thread.
    
    Does that answer your questions?

Yes, thank you, it answers some of them but it raises more :).  I see,
it's self.consumer.write(...) that ends up calling the pause method.  So
that's how it's reentrant.  I knew twisted wasn't multithreaded in this
case.  Makes sense.

I have since made my resumeProducing() code loop for up to 100 (or 500,
or 1000 etc.) iterations and then return.  Thus I'm treating
resumeProducing as if it should &quot;produce a chunk larger than 1 byte but
smaller that the whole dataset&quot; then return.  How is this approach, does
it better match the intention of the producer/consumer system vs. the
&quot;loop forever until paused&quot; scheme I had earlier?

A final question -- is it safe for my code to ever call pauseProducing,
stopProducing, resumeProducing directly?  Or that will mess up the
balance of the twisted universe?  (I'm thinking that the calls to these
3 methods should only originate &quot;from within twisted&quot; in case the whole
producer/consumer system is tracking how many times it calls each one
etc.)  I don't plan on calling them directly, but want to critically
review in an informed way my colleague's code which does this.

Thank you so much for the response!

Benjamin Rutt


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014986.html">[Twisted-Python] Learning about IPushProducer
</A></li>
	<LI>Next message: <A HREF="014990.html">[Twisted-Python] Learning about IPushProducer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14988">[ date ]</a>
              <a href="thread.html#14988">[ thread ]</a>
              <a href="subject.html#14988">[ subject ]</a>
              <a href="author.html#14988">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
