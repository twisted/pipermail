<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Migrate Asyncore to Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Migrate%20Asyncore%20to%20Twisted&In-Reply-To=a7964aae0703130803m1c36e166qd9e88ddf33fc4e9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014997.html">
   <LINK REL="Next"  HREF="015003.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Migrate Asyncore to Twisted</H1>
    <B>jian wu</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Migrate%20Asyncore%20to%20Twisted&In-Reply-To=a7964aae0703130803m1c36e166qd9e88ddf33fc4e9%40mail.gmail.com"
       TITLE="[Twisted-Python] Migrate Asyncore to Twisted">hellojianwu at gmail.com
       </A><BR>
    <I>Wed Mar 14 03:26:23 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="014997.html">[Twisted-Python] Migrate Asyncore to Twisted
</A></li>
        <LI>Next message: <A HREF="015003.html">[Twisted-Python] Migrate Asyncore to Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15000">[ date ]</a>
              <a href="thread.html#15000">[ thread ]</a>
              <a href="subject.html#15000">[ subject ]</a>
              <a href="author.html#15000">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sean,

&gt;<i> I am actually not sure if it is my protocol that is complicated
</I>&gt;<i> or if the way in which I want to pass the data that is complicated.
</I>
I should claim that I'm not very well experienced with either Twisted
or asyncore, My guess is that is not protocol but the way to pass
data.

Assuming that your python program is connected to your two
devices with two independent TCP connections, your python
program actually is doing message based routing among two
async bi-directional tcp channels.

My guess is that you can keep two Queues since it will help
keeping the order of the async messages received and processed.
And, since twisted has a thread pool, it might be doable that
you could create four threads, two for each TCP Connections,
one thread for read and another for write per TCP connection,
the read thread will handle the received message, process it
and put it into the Queue, the write thread will take the message
from the Queue and write it out to the targeted TCP connection.

Hope this info might be helpful and Good Luck!

Jian


On 3/13/07, Sean Roark &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">srock258 at gmail.com</A>&gt; wrote:
&gt;<i> Thanks Jian. I am actually not sure if it is my protocol that is complicated
</I>&gt;<i> or if the way in which I want to pass the data that is complicated. This is
</I>&gt;<i> what I'm doing.
</I>&gt;<i>
</I>&gt;<i> I have two devices that both send and recieve binary strings. Each device
</I>&gt;<i> formats the binary messages in a completely different manner, but
</I>&gt;<i> abstractly, they basicly contain the same information just in different
</I>&gt;<i> formats. I need to recieve the data, parse it, translate it, then repack it
</I>&gt;<i> into this different raw format and send it to another destination. All this
</I>&gt;<i> works just fine using asyncore dispatchers but I have created my own way of
</I>&gt;<i> passing the messages between the different modules. Each module I have
</I>&gt;<i> (parse, translate, pack, recieve, send) is wrapped by two Queue's, one
</I>&gt;<i> taking input and the other taking output. I connect the modules by replacing
</I>&gt;<i> one instance's output Queue with another's input Queue. This way each module
</I>&gt;<i> is a thread that simply blocks on the input Queue. When the Parse instance
</I>&gt;<i> finishes parsing data it puts it on the output Queue which is actually the
</I>&gt;<i> Translate modules input Queue. Since everything needs to happen in a nice
</I>&gt;<i> linear manner this works great.
</I>&gt;<i>
</I>&gt;<i> But, this means I am not using callbacks or anything. Instead I would need
</I>&gt;<i> to wrap the Twisted protocol in my Queue protocol. This seems straight
</I>&gt;<i> forward enough, but I don't have much time to make this conversion (charge
</I>&gt;<i> number is running out!) which is why I would love to see an example of the
</I>&gt;<i> asyncore dispatcher to twisted protocol conversion. It would go along way to
</I>&gt;<i> helping me quickly map my existing code to twisted style code.
</I>&gt;<i>
</I>&gt;<i> My reason's for switching to Twisted are for the future. This may need a web
</I>&gt;<i> interface for configuration and monitoring in the near future. Also,
</I>&gt;<i> asyncore has a myriad of issues on Win32 but we want the program to work on
</I>&gt;<i> both *nix and windows, I'm hoping Twisted helps. Furthermore, the Twisted
</I>&gt;<i> libraries for making my system an application look very appealing as a means
</I>&gt;<i> to ease deployment.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Sean
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 3/13/07, jian wu &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">hellojianwu at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Hi Sean,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I had some experience to write a simple python test simulator for my
</I>&gt;<i> &gt; java network
</I>&gt;<i> &gt; application using Apache Mina for a text line based protocol
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; At first I used asyncore.async_chat, then I moved to
</I>&gt;<i> &gt; twisted.protocols.basic.LineReceiver
</I>&gt;<i> &gt; since I need async multi-thread behavior. For me, it is
</I>&gt;<i> &gt; straight-forward regarding handling the protocol when moving from
</I>&gt;<i> &gt; async_chat to LineReceiver.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And, asyncore.disptacher is just replaced with Twisted reactor and
</I>&gt;<i> &gt; Factory or TCPServer
</I>&gt;<i> &gt; if you want to write a Twisted Application.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If you have a very complicated protocol, it might be totally different
</I>&gt;<i> &gt; from my experience.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Best regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Jian
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 3/12/07, Sean Roark &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">srock258 at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; I would love to migrate my asyncore based applications to Twisted but
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; learning curve seems quite steep. Anybody have a good tutorial?
</I>&gt;<i> Migrating
</I>&gt;<i> &gt; &gt; asyncore.dispatcher objects to twisted protocols examples would be
</I>&gt;<i> awesome.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; --
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Sean Roark
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> Sean Roark
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014997.html">[Twisted-Python] Migrate Asyncore to Twisted
</A></li>
	<LI>Next message: <A HREF="015003.html">[Twisted-Python] Migrate Asyncore to Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15000">[ date ]</a>
              <a href="thread.html#15000">[ thread ]</a>
              <a href="subject.html#15000">[ subject ]</a>
              <a href="author.html#15000">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
