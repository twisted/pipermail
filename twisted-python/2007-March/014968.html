<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Need some pointers for writing asynchronous code	for Twisted app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Need%20some%20pointers%20for%20writing%20asynchronous%20code%0A%09for%20Twisted%20app&In-Reply-To=45F28932.8090508%40libero.it">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014965.html">
   <LINK REL="Next"  HREF="014969.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Need some pointers for writing asynchronous code	for Twisted app</H1>
    <B>Brian Costlow</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Need%20some%20pointers%20for%20writing%20asynchronous%20code%0A%09for%20Twisted%20app&In-Reply-To=45F28932.8090508%40libero.it"
       TITLE="[Twisted-Python] Need some pointers for writing asynchronous code	for Twisted app">brian.costlow at gmail.com
       </A><BR>
    <I>Sat Mar 10 13:55:30 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="014965.html">[Twisted-Python] Need some pointers for writing asynchronous	code	for Twisted app
</A></li>
        <LI>Next message: <A HREF="014969.html">[Twisted-Python] Need some pointers for writing asynchronous code	for Twisted app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14968">[ date ]</a>
              <a href="thread.html#14968">[ thread ]</a>
              <a href="subject.html#14968">[ subject ]</a>
              <a href="author.html#14968">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks everyone for your comments, you were all a lot of help.

Andrew, I was aware that the deferred didn't go anywhere, I oversimplified
things in the example, in the original design in my head, the code that
actually does the db calls was waiting on the deferred. Actually, the way
it's written, it never even runs, I left out the first call to
processChunk() necessary to start the iteration. But your comments helped a
lot.

My concern wasn't ElementTrees built in stuff, but 300+ line spaghetti
procedure that massages the element tree data into a dictionary. That needs
to be rewritten anyway.

I messed around this morning, and here's what I have done. I compiled
cElementTree onto the test box. The LineReceiver uses
cElementTree.XMLTreeBuilder.feed() and builds the tree on the fly.

At connectionClose it calls a method that runs the business logic routine in
a thread, using threads.deferToThread, and adding a callback; said callback
executes the db code. That still blocks for now.

So, my current plan is to refactor the tree--&gt;dict code, but call that in a
separate thread. Rewite the dict --&gt; db layer. The only question I have, is
since it's a long series of insert/update calls in which I don't need
results other than, 'it worked' , is, after reading the comments, it seems
like I might just best be served by writing a series of straight dbi calls;
and wrapping that all in one call to thread.callInThread.

The db is MySQL, and feeds a PHP-based reporting app, so I can't use
pgasync.

Thanks again all.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20070310/cd040366/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20070310/cd040366/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014965.html">[Twisted-Python] Need some pointers for writing asynchronous	code	for Twisted app
</A></li>
	<LI>Next message: <A HREF="014969.html">[Twisted-Python] Need some pointers for writing asynchronous code	for Twisted app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14968">[ date ]</a>
              <a href="thread.html#14968">[ thread ]</a>
              <a href="subject.html#14968">[ subject ]</a>
              <a href="author.html#14968">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
