<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Safe Pickling using banana and jelly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Safe%20Pickling%20using%20banana%20and%20jelly&In-Reply-To=%3C707F4930-8FBA-11D7-A91C-000393C92466%40dalkescientific.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="036744.html">
   <LINK REL="Next"  HREF="036746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Safe Pickling using banana and jelly</H1>
    <B>Andrew Dalke</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Safe%20Pickling%20using%20banana%20and%20jelly&In-Reply-To=%3C707F4930-8FBA-11D7-A91C-000393C92466%40dalkescientific.com%3E"
       TITLE="[Twisted-Python] Safe Pickling using banana and jelly">dalke at dalkescientific.com
       </A><BR>
    <I>Mon May 26 14:41:34 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="036744.html">[Twisted-Python] Safe Pickling using banana and jelly
</A></li>
        <LI>Next message (by thread): <A HREF="036746.html">[Twisted-Python] Safe Pickling using banana and jelly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36745">[ date ]</a>
              <a href="thread.html#36745">[ thread ]</a>
              <a href="subject.html#36745">[ subject ]</a>
              <a href="author.html#36745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Heiko Wundram wrote:
&gt;<i> Is unpickling _untrusted_ network data using banana and jelly a safe
</I>&gt;<i> thing? After a length check on the data has been done, discarding all
</I>&gt;<i> messages that are over 50k in size, of course... :)
</I>
Having only used Twisted for about a day, cumulative, I am not
the best person to answer that.  However, it does seem that it
has a security hole I pointed out in Python's pickle package,
which is one of the reasons pickle is not to be trusted.

In brief, jelly will unjelly anything, including objects which
do destructive acts in the deallocator.  And some exist in
the standard Python libs.  Here's an example.

 &gt;&gt;&gt; from twisted.spread import jelly
 &gt;&gt;&gt; import tempfile
 &gt;&gt;&gt; import StringIO
 &gt;&gt;&gt; x = tempfile._TemporaryFileWrapper(StringIO.StringIO(&quot;&quot;), &quot;/blah&quot;)
 &gt;&gt;&gt; del x
Exception exceptions.OSError: (2, 'No such file or directory', '/blah') 
in &lt;bound method _TemporaryFileWrapper.__del__ of 
&lt;tempfile._TemporaryFileWrapper instance at 0x626c60&gt;&gt; ignored
 &gt;&gt;&gt; x = tempfile._TemporaryFileWrapper(StringIO.StringIO(&quot;&quot;), &quot;/blah&quot;)
 &gt;&gt;&gt; jelly.jelly(x)
['tempfile._TemporaryFileWrapper', ['dictionary', ['close_called', 
['boolean', 'false']], ['name', '/blah'], ['file', 
['StringIO.StringIO', ['dictionary', ['softspace', 0], ['buflist', 
['list']], ['pos', 0], ['len', 0], ['closed', 0], ['buf', '']]]]]]
 &gt;&gt;&gt; q = _
 &gt;&gt;&gt; del x
Exception exceptions.OSError: (2, 'No such file or directory', '/blah') 
in &lt;bound method _TemporaryFileWrapper.__del__ of 
&lt;tempfile._TemporaryFileWrapper instance at 0x626c60&gt;&gt; ignored
 &gt;&gt;&gt; jelly.unjelly(q)
&lt;tempfile._TemporaryFileWrapper instance at 0x626c60&gt;
 &gt;&gt;&gt; 1
Exception exceptions.OSError: (2, 'No such file or directory', '/blah') 
in &lt;bound method _TemporaryFileWrapper.__del__ of 
&lt;tempfile._TemporaryFileWrapper instance at 0x626c60&gt;&gt; ignored
1
 &gt;&gt;&gt;

However, I don't know enough about how jellied data
structures are handled when they come over the wire to
know if they are indeed prone to this sort of attack.
Eg, one solution is to state that only certain objects can
be unpickled, which is the suggested solution for Python's
stock pickles.

					Andrew
					<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dalke at dalkescientific.com</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="036744.html">[Twisted-Python] Safe Pickling using banana and jelly
</A></li>
	<LI>Next message (by thread): <A HREF="036746.html">[Twisted-Python] Safe Pickling using banana and jelly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36745">[ date ]</a>
              <a href="thread.html#36745">[ thread ]</a>
              <a href="subject.html#36745">[ subject ]</a>
              <a href="author.html#36745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
