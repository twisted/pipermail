<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] problem remotely calling mehod that returns a Deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20problem%20remotely%20calling%20mehod%20that%20returns%20a%20Deferred&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004226.html">
   <LINK REL="Next"  HREF="004178.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] problem remotely calling mehod that returns a Deferred</H1>
    <B>Tim Nagels</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20problem%20remotely%20calling%20mehod%20that%20returns%20a%20Deferred&In-Reply-To="
       TITLE="[Twisted-Python] problem remotely calling mehod that returns a Deferred">tim_nagels at hotmail.com
       </A><BR>
    <I>Thu May 22 06:24:42 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004226.html">[Twisted-Python] Serving HTTP requests (was: Bug?)
</A></li>
        <LI>Next message: <A HREF="004178.html">[Twisted-Python] problem remotely calling mehod that returns a Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4177">[ date ]</a>
              <a href="thread.html#4177">[ thread ]</a>
              <a href="subject.html#4177">[ subject ]</a>
              <a href="author.html#4177">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm having trouble remotely calling the userWelcome method...

it returns a deferred with some databaseinformation...
when I wanted to test to see how it handles delays...I used 
time.sleep(30)...

then it seems to lose the connection and throws: 
twisted.spread.pb.PBConnectionLost

i've tested it with 15, 10, 5 secs... and when I go below 5 secs it seems to 
work again...(as does removing the sleep line)

Any ideas where the connection could be lost, can't seem to locate it...
tnx

code:

class FtpServFactory(pb.Root, pb.Perspective):

   ....

    def remote_takeInfo(self, info):
        print &quot; got info:&quot;, info
        print dir(info)
        print info.name
        print info.welcome
        #pond.countFrogs()
        return &quot;safe and sound&quot; # positive acknowledgement

    ....
    def testcallb(self, resultlist):
        print &quot;executing callback&quot;
        time.sleep(5)				####  if I let it sleep for less then 5 seconds, or 
I just remove the line
        return resultlist[0][0]			####  the value is returned correctly...

    def failtestc(self, resultlist):
        print &quot;failing callback&quot;
        return resultlist

    def perspective_userWelcome(self, user):
        root = self.service.factory.root
        print dir(self)
        self.dbpool = 
adbapi.ConnectionPool(&quot;MySQLdb&quot;,host=&quot;localhost&quot;,db=&quot;pythonftpserv&quot;,port=3306
                                            ,user=&quot;root&quot;,passwd=&quot;&quot;)

        self.db    = FtpDatabase(self.dbpool)
        deff = self.db.getDescription(&quot;TascAdmin&quot;)
        deff.addCallbacks(self.testcallb,self.failtestc)

        return deff

################################################

.....

def main():
    from FtpServer import FtpInfoClient  # so it's not __main__.CopyPond
    inf = FtpInfoClient.CopyInfo()
    inf.initData(&quot;Johnny&quot;, &quot;&quot;&quot;/temp/test.tst&quot;&quot;&quot;, 
&quot;&quot;&quot;2002-10-05&quot;&quot;&quot;,&quot;&quot;&quot;/temp&quot;&quot;&quot;,&quot;You will find me another ...shrubbery!&quot;)

    reactor.callLater(5,reactor.stop)
    sender = Sender(inf)
    deferred = pb.getObjectAt(&quot;10.10.0.47&quot;, 8800, 50)
    deferred.addCallback(sender.got_obj)

    pb.connect(&quot;10.10.0.47&quot;, # host name
           8880, # port number
           &quot;guest&quot;, # identity name
           &quot;guest&quot;, # password
           &quot;FtpServer.ftp&quot;, # service name
           &quot;guest&quot;, # perspective name (usually same as identity)
           None, # client reference, used to initiate server-&gt;client calls
           50 # timeout of 30 seconds before connection gives up
           ).addCallbacks(connected, # what to do when we get connected
                          failure) # and what to do when we can't


    reactor.run()

def connected(perspective):
    deff = 
perspective.callRemote('userWelcome',&quot;TascAdmin&quot;).addCallbacks(success, 
failure)
    deff.setTimeout(30)

def fail(des):
    print &quot;failed miserably&quot;

def gotdes(des):
    print &quot;description &quot;+desc

def success(welcome):
    print welcome
    #welcome.addCallbacks(gotdes,fail)
    #reactor.stop()

def failure(error):
    print error
    print dir(error)
    print &quot;Failed to obtain quote.\n&quot;
    #reactor.stop()

if __name__ == '__main__':
    main()


-----------
Aso

_________________________________________________________________




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004226.html">[Twisted-Python] Serving HTTP requests (was: Bug?)
</A></li>
	<LI>Next message: <A HREF="004178.html">[Twisted-Python] problem remotely calling mehod that returns a Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4177">[ date ]</a>
              <a href="thread.html#4177">[ thread ]</a>
              <a href="subject.html#4177">[ subject ]</a>
              <a href="author.html#4177">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
