<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Patch: Make twisted.web.distrib work with twisted.web.vhost
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Patch%3A%20Make%20twisted.web.distrib%20work%20with%20twisted.web.vhost&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004105.html">
   <LINK REL="Next"  HREF="004109.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Patch: Make twisted.web.distrib work with twisted.web.vhost</H1>
    <B>Tom 'Korpios' Tobin</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Patch%3A%20Make%20twisted.web.distrib%20work%20with%20twisted.web.vhost&In-Reply-To="
       TITLE="[Twisted-Python] Patch: Make twisted.web.distrib work with twisted.web.vhost">korpios at korpios.com
       </A><BR>
    <I>Fri May 16 10:00:46 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004105.html">[Twisted-Python] splitting log file
</A></li>
        <LI>Next message: <A HREF="004109.html">[Twisted-Python] Patch: Make twisted.web.distrib work with twisted.web.vhost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4103">[ date ]</a>
              <a href="thread.html#4103">[ thread ]</a>
              <a href="subject.html#4103">[ subject ]</a>
              <a href="author.html#4103">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is a patch to make twisted.web.distrib work with twisted.web.vhost.

As things stand, when twisted.web.vhost calls a virtual host's getChildWithDefault, it ends up calling getChild.  As ResourceSubscription has no getChild, the render call never happens to make the distributed connection.  By returning self, we can make this happen.

On the ResourcePublisher side of things, after being called in this way (e.g. through a virtual host) request's prepath and postpath are a bit off; we fix this in remote_request.


--- distrib.py  Fri May 16 09:41:18 2003
+++ distrib-patched.py  Fri May 16 09:50:01 2003
@@ -174,6 +174,11 @@
             self.publisher.callRemote('request', request).addCallbacks(i.finished, i.failed)
         return NOT_DONE_YET

+    def getChild(self, path, request):
+        &quot;&quot;&quot;I am a child; I should return myself so render can be called.
+        &quot;&quot;&quot;
+        return self
+
 class ResourcePublisher(pb.Root, styles.Versioned):
     def __init__(self, site):
         self.site = site
@@ -191,6 +196,8 @@
         return self

     def remote_request(self, request):
+        if len(request.prepath) &gt; 0:
+            request.postpath.insert(0, request.prepath.pop())
         res = self.site.getResourceFor(request)
         log.msg( request )
         return res.render(request)



Tom &quot;Korpios&quot; Tobin
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">korpios at korpios.com</A>




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004105.html">[Twisted-Python] splitting log file
</A></li>
	<LI>Next message: <A HREF="004109.html">[Twisted-Python] Patch: Make twisted.web.distrib work with twisted.web.vhost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4103">[ date ]</a>
              <a href="thread.html#4103">[ thread ]</a>
              <a href="subject.html#4103">[ subject ]</a>
              <a href="author.html#4103">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
