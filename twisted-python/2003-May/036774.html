<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Safe Pickling using banana and jelly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Safe%20Pickling%20using%20banana%20and%20jelly&In-Reply-To=%3C20030528044538.GC10429%40frobozz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="036772.html">
   <LINK REL="Next"  HREF="036785.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Safe Pickling using banana and jelly</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Safe%20Pickling%20using%20banana%20and%20jelly&In-Reply-To=%3C20030528044538.GC10429%40frobozz%3E"
       TITLE="[Twisted-Python] Safe Pickling using banana and jelly">andrew-twisted at puzzling.org
       </A><BR>
    <I>Tue May 27 22:45:38 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="036772.html">[Twisted-Python] Safe Pickling using banana and jelly
</A></li>
        <LI>Next message (by thread): <A HREF="036785.html">[Twisted-Python] Safe Pickling using banana and jelly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36774">[ date ]</a>
              <a href="thread.html#36774">[ thread ]</a>
              <a href="subject.html#36774">[ subject ]</a>
              <a href="author.html#36774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, May 28, 2003 at 06:21:52AM +0200, Heiko Wundram wrote:
&gt;<i> On Tue, 2003-05-27 at 10:01, Christopher Armstrong wrote:
</I>&gt;<i> &gt; It seems you've missed other posts in this thread (or my own? I don't
</I>&gt;<i> &gt; remember now), that point out that jelly can indeed restrict instantiation
</I>&gt;<i> &gt; of arbitrary classes. Implementing another half-broken serialization scheme
</I>&gt;<i> &gt; is definitely not a good solution to any problem :-)
</I>&gt;<i> 
</I>&gt;<i> The thing being: I don't like any serialization scheme that just says:
</I>&gt;<i> Okay, all data is fine with us, we'll coredump if we deconstruct
</I>&gt;<i> anything bad or obnoxious... (sort'a like that) I guess that's not the
</I>&gt;<i> point when doing serialization for data received over the net...
</I>
Twisted Spread is intended to be safe and secure, because data from the net
could be from anywhere, so it has to be robust in the face of dangerous
data.

&gt;<i> My intention behind creating my own serialization scheme were the
</I>&gt;<i> following:
</I>&gt;<i> 
</I>&gt;<i> 1. I can control how the data is actually stored in the pickle (classes
</I>&gt;<i> aren't pickled as is, but instead get the chance to __serialize
</I>&gt;<i> themselves; that's just mildly important, but... Hey. :)) And foremost:
</I>&gt;<i> I can control exactly which classes are okay for
</I>&gt;<i> serialization/unserialization.
</I>
That's what __getstate__ and __setstate__ are for with pickle; IIRC Jelly
supports that and also it's own 'getStateToCopyFor' or something along those
lines.

&gt;<i> 2. Both Jelly and Banana can't handle a special case where I have an
</I>&gt;<i> instance of class y (derived from class x), and want the serialization
</I>&gt;<i> stream to show that class x was sent. Examples of this: My current
</I>&gt;<i> program has a Host class, and a LocalHost class which is derived from
</I>&gt;<i> it. The LocalHost, when sent to other hosts, should just get serialized
</I>&gt;<i> as a Host. Normally you'd have to &quot;cast&quot; the LocalHost to a host object,
</I>&gt;<i> and then serialize that. My scheme can handle &quot;alias classes&quot;, which get
</I>&gt;<i> serialized using the other's name, making sure that the other class
</I>&gt;<i> doesn't even get a chance to serialize private attributes.
</I>
I'm sure PB can handle this.  Have you read &quot;PB Copyable: Passing Complex
Types&quot;, <A HREF="http://twistedmatrix.com/documents/howto/pb-copyable?">http://twistedmatrix.com/documents/howto/pb-copyable?</A> 

&gt;<i> 3. Support for different serialization protocols. I guess I've not made
</I>&gt;<i> the mistake that most other pickle-like module authors made, that they
</I>&gt;<i> didn't implement support for more than one protocol right from the
</I>&gt;<i> start... (hypocrisy... ;)) This e.g. means that object-ids (which
</I>&gt;<i> basically are names for the pickled class) can have different meanings,
</I>&gt;<i> when the protocol changes.
</I>
I'm not quite sure what you're saying here.

&gt;<i> 4. And most important for me (except 1): I can control exactly what data
</I>&gt;<i> gets put into the unserialized classes, as all __unserialize functions
</I>&gt;<i> are called in reverse order (when having classes which are bases to
</I>&gt;<i> other classes, etc.). The point being: when I load a Host from network,
</I>&gt;<i> I have to reduce several timeouts as &quot;local&quot; timeouts are much higher
</I>&gt;<i> than timeouts for instances received over the net. As I don't reduce
</I>[...]

Again, read <A HREF="http://twistedmatrix.com/documents/howto/pb-copyable.">http://twistedmatrix.com/documents/howto/pb-copyable.</A>  With PB
you can control exactly what data is sent over the wire.  You also get
Referenceables, Copyables and Cacheables, which is considerably richer than
a simple object protocol that just passes the occasional object-graph.

&gt;<i> 5. My pickles are signed data items, and while signing banana'd packets
</I>&gt;<i> is no problem, I have integrated signature/digesting algorithms with the
</I>&gt;<i> stream class, which allows for checking of SHA-digests and the like as
</I>&gt;<i> they are being written out. I don't really know any other pickler that
</I>&gt;<i> takes care of checksumming packets right in the pickler. You can of
</I>&gt;<i> course turn off this functionality... :)
</I>
TCP guarantees the data isn't corrupted on the way through.  Use SSL to 
guarantee that the traffic isn't being sniffed or tampered with in transit.
PB has an authentication step so that you can know who the clients are.
Between all this, I'm not sure what problem your signatures are solving that
isn't already solved?

&gt;<i> 6. Without being hypocrite, I guess I can say that the serialization
</I>&gt;<i> scheme is so simple, that there couldn't be much holes an attacker could
</I>&gt;<i> come through... Tests like the things Andrew did will certainly not
</I>&gt;<i> work, and the burden is put on the programmer to make sure that the
</I>&gt;<i> classes he registers as being serializable are really classes that are
</I>&gt;<i> okay to serialize (destroy, etc.). All base classes are safe to
</I>&gt;<i> serialize. And actually only int, string, unicode, complex, long and
</I>&gt;<i> float ever get written out to the stream, all other objects being
</I>&gt;<i> abstractions of a _DataStream (which is basically a list kind of
</I>&gt;<i> object).
</I>
Banana only understands a very small number of primitives too.  PB has been
implemented in languages other than Python, so I don't think it's overly
complex -- and I believe Brian Warner is working on a rewrite that might
make it simpler, faster and more flexible.

&gt;<i> &gt; btw, thanks to Andrew Dalke for an *excellent* beginning of a security
</I>&gt;<i> &gt; audit for jelly. :-)
</I>&gt;<i> 
</I>&gt;<i> Thanks here too... Made me finally give myself the turn to actually
</I>&gt;<i> write my own serializer... ;) I've wanted to do that for a long time,
</I>&gt;<i> but I've always feared that it would be an overly complex task.
</I>&gt;<i> Yesterday proved me wrong about that... :) I needed above functionality
</I>&gt;<i> 1+4 more than once, when it wasn't available, and that always produced
</I>&gt;<i> pretty crufty code...
</I>
As far as I can see (although I'm no PB expert), PB satisfies 1 and 4.  What
makes you think it doesn't?

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="036772.html">[Twisted-Python] Safe Pickling using banana and jelly
</A></li>
	<LI>Next message (by thread): <A HREF="036785.html">[Twisted-Python] Safe Pickling using banana and jelly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36774">[ date ]</a>
              <a href="thread.html#36774">[ thread ]</a>
              <a href="subject.html#36774">[ subject ]</a>
              <a href="author.html#36774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
