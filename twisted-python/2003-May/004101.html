<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.python.usage.Options Questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted.python.usage.Options%20Questions&In-Reply-To=1053077737.3183.1282.camel%40biproc">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004100.html">
   <LINK REL="Next"  HREF="004106.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.python.usage.Options Questions</H1>
    <B>Justin Johnson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted.python.usage.Options%20Questions&In-Reply-To=1053077737.3183.1282.camel%40biproc"
       TITLE="[Twisted-Python] twisted.python.usage.Options Questions">justinjohnson at fastmail.fm
       </A><BR>
    <I>Fri May 16 09:05:47 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004100.html">[Twisted-Python] splitting log file
</A></li>
        <LI>Next message: <A HREF="004106.html">[Twisted-Python] Transparent Remote Objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4101">[ date ]</a>
              <a href="thread.html#4101">[ thread ]</a>
              <a href="subject.html#4101">[ subject ]</a>
              <a href="author.html#4101">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings,

I'm using twisted.python.usage to handle command-line option parsing. 
The script I have uses subcommands, so I can type:

myscript.py subcommand -a 1 -b 2 ...

I sub-classed BaseOptions as follows...

[code]
# Setup command-line options for all subcommands
class BaseOptions(usage.Options):
	optFlags = [
		['help', 'h', &quot;Display usage information&quot;],
	]

class MkvobOptions(BaseOptions):
	optParameters = [
		['vobs', 'v', None, &quot;Comma-delimited list of VOBs to create&quot;],
		['original', 'o', None, &quot;Original site to create VOBs at first&quot;],
        ['sites', 's', None, &quot;Comma-delimited list of sites to replicate
        to&quot;],
		['group', 'g', r'UHCADAAA\ccusers', &quot;NT group to be primary group for VOBs&quot;]
	]
	def postOptions(self):
		for opt in [&quot;vobs&quot;,&quot;original&quot;]:
			if not self[opt]:
				raise usage.UsageError, &quot;--vobs and --original are required.&quot;

class RmvobOptions(BaseOptions):
	optParameters = [
		['vobs', 'v', None, &quot;Comma-delimited list of VOBs to remove&quot;],
		['original', 'o', None, &quot;Site to remove VOBs from&quot;],
	]
	def postOptions(self):
		for opt in [&quot;vobs&quot;,&quot;original&quot;]:
			if not self[opt]:
				raise usage.UsageError, &quot;--vobs and --original are required.&quot;

class Options(usage.Options):
	subCommands = [
		['mkvob', None, MkvobOptions, &quot;Create VOBs&quot;],
		['rmvob', None, RmvobOptions, &quot;Remove VOBs&quot;]
	]
[/code]

I have some questions though.

1)  Passing in the --help option displays usage info the way I'd want it,
grabbing __doc__ from the top of the file and also displaying info about
my subcommands.  

[output]
C:\share\python\uhg\uht\tsd\ClearCase&gt;vobtool.py --help
Usage: vobtool.py [options]
Options:
      --version
      --help     Display this help and exit.

VOB Administrative Tool  &lt;&lt;&lt; This is my __doc__

Commands:
    mkvob      Create VOBs
    rmvob      Remove VOBs


C:\share\python\uhg\uht\tsd\ClearCase&gt;
[/output]

But when I pass the --help option to a subcommand, I'd like to have some
sort of __doc__ equivalent for the subcommand, but I get the following
instead.

[output]
C:\share\python\uhg\uht\tsd\ClearCase&gt;vobtool.py mkvob --help
Usage: vobtool.py [options]
Options:
  -h, --help       Display this help and exit.
  -v, --vobs=      Comma-delimited list of VOBs to create
  -o, --original=  Original site to create VOBs at first
  -s, --sites=     Comma-delimited list of sites to replicate to
  -g, --group=     NT group to be primary group for VOBs [default:
                   UHCADAAA\ccusers]
      --version

VOB Administrative Tool  &lt;&lt;&lt; The __doc__ for the file
[/output]

Is there a way to do that?

2)  When I just run the command without passing any options (not even a
subcommand) I get the following error:

[output]
C:\share\python\uhg\uht\tsd\ClearCase&gt;vobtool.py
Traceback (most recent call last):
  File &quot;C:\share\python\uhg\uht\tsd\ClearCase\vobtool.py&quot;, line 121, in ?
    main()
  File &quot;C:\share\python\uhg\uht\tsd\ClearCase\vobtool.py&quot;, line 55, in
  main
    if config.subCommand == 'mkvob':
  File &quot;C:\Python22\Lib\site-packages\twisted\python\usage.py&quot;, line 151,
  in __g
etattr__
    raise AttributeError(&quot;%s instance has no attribute '%s'&quot; %
    (self.__class__,
attr))
AttributeError: __main__.Options instance has no attribute 'subCommand'

C:\share\python\uhg\uht\tsd\ClearCase&gt;
[/output]

My main function is as follows...

[snip]
# Main function
def main():
	config = Options()
	try:
		config.parseOptions()
	except usage.UsageError, errortext:
		print '%s: %s' % (sys.argv[0], errortext)
		print '%s: Try --help for usage details.' % (sys.argv[0])
		sys.exit(1)

	if config.subCommand == 'mkvob':
		doMkvob(config.subOptions)
	elif config.subCommand == 'rmvob':
		doRmvob(config.subOptions)
[snip]

Is there a particular test I should do on config before checking
config.subCommand?

3)  I see there is a --version option available if you use
twisted.python.usage.  But it always displays the Twisted version.  Is
there a way to override that so the --version option either isn't
available or at least returns the version information for my script and
not for Twisted?


Sorry for the long email.
Thanks so much.
-Justin


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004100.html">[Twisted-Python] splitting log file
</A></li>
	<LI>Next message: <A HREF="004106.html">[Twisted-Python] Transparent Remote Objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4101">[ date ]</a>
              <a href="thread.html#4101">[ thread ]</a>
              <a href="subject.html#4101">[ subject ]</a>
              <a href="author.html#4101">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
