<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to abuse generators, now that we're allowed to play with 2.2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20abuse%20generators%2C%20now%20that%20we%27re%20allowed%20to%20play%20with%202.2&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004303.html">
   <LINK REL="Next"  HREF="004211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to abuse generators, now that we're allowed to play with 2.2</H1>
    <B>Bob Ippolito</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20abuse%20generators%2C%20now%20that%20we%27re%20allowed%20to%20play%20with%202.2&In-Reply-To="
       TITLE="[Twisted-Python] How to abuse generators, now that we're allowed to play with 2.2">bob at redivi.com
       </A><BR>
    <I>Fri May 23 19:57:22 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004303.html">[Twisted-Python] Low-level networking in Twisted
</A></li>
        <LI>Next message: <A HREF="004211.html">[Twisted-Python] Lore bug with &quot;.html&quot;-stripping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4210">[ date ]</a>
              <a href="thread.html#4210">[ thread ]</a>
              <a href="subject.html#4210">[ subject ]</a>
              <a href="author.html#4210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's some code I've been playing with the past two days.. part of a 
DAAP (Digital Audio Access Protocol, aka iTunes 4.0) client/server 
framework that I'm working on that's nowhere near releasable at the 
moment..

However, the gzip/gunzip streaming code and the example of generator 
abuse may be of immediate use to someone in the meantime, so here you 
go.

HTTPStream expects you to pass in a protocol that will receive the page 
incrementally.  Try passing in headers={'Accept-Encoding':'gzip'} and 
talking to your favorite server, it may actually decide to send you the 
page gzipped.. with the way the protocol stack works, your underlying 
protocol won't even know the difference.  It can of course be extended 
to support any encoding(s) with the current dispatch mechanism, but 
gzip is the only one I need at the moment.

As far as IterableBytestreamProtocol goes, you should be careful if you 
use it.. basically it will work perfectly until connectionLost happens, 
and then it'll start throwing back None to your read requests (which 
will never happen otherwise).  If you set iterateOnLoss = False, then 
your iterator will just stop running when you lose connection, which 
may or may not be desirable.  Use at your own risk, but feel free to 
improve on it if you have any suggestions.

-bob


-------------- next part --------------
A non-text attachment was scrubbed...
Name: gzstream.py
Type: application/octet-stream
Size: 8149 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030523/a7d9d5a6/attachment.obj">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030523/a7d9d5a6/attachment.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: util.py
Type: application/octet-stream
Size: 2150 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030523/a7d9d5a6/attachment-0001.obj">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030523/a7d9d5a6/attachment-0001.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: httpstream.py
Type: application/octet-stream
Size: 1554 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030523/a7d9d5a6/attachment-0002.obj">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030523/a7d9d5a6/attachment-0002.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004303.html">[Twisted-Python] Low-level networking in Twisted
</A></li>
	<LI>Next message: <A HREF="004211.html">[Twisted-Python] Lore bug with &quot;.html&quot;-stripping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4210">[ date ]</a>
              <a href="thread.html#4210">[ thread ]</a>
              <a href="subject.html#4210">[ subject ]</a>
              <a href="author.html#4210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
