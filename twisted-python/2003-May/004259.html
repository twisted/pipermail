<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Small diff for LivePage controller
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Small%20diff%20for%20LivePage%20controller&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004258.html">
   <LINK REL="Next"  HREF="004262.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Small diff for LivePage controller</H1>
    <B>Bill Gribble</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Small%20diff%20for%20LivePage%20controller&In-Reply-To="
       TITLE="[Twisted-Python] Small diff for LivePage controller">grib at billgribble.com
       </A><BR>
    <I>Tue May 27 10:38:21 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004258.html">[Twisted-Python] Using usage.Options documentation error
</A></li>
        <LI>Next message: <A HREF="004262.html">[Twisted-Python] toc.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4259">[ date ]</a>
              <a href="thread.html#4259">[ thread ]</a>
              <a href="subject.html#4259">[ subject ]</a>
              <a href="author.html#4259">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi.  I noticed that when my LivePage instance sends updates to DOM
elements that are whitespace-sensitive, such as &lt;pre&gt; and 
&lt;textarea wordwrap=&quot;off&gt;, embedded newlines were getting stripped,
leaving the element bodies as single text lines with some interword
spacing removed. 

I tracked the problem down to this bit of code in woven/controller.py. 
The Javascript code generator is formatting the new element as a literal
Javascript string which will be processed on the client side to modify
the page.  But by stripping out the newlines in the code we remove some
important information in some HTML contexts.  

This patch leaves embedded newlines in the text, using JavaScript
literal string escapes to make sure they get passed through OK.  I also
added string escaping for other legal special characters that have 
JS literal escapes. 

With this patch, LivePage is working really well for me!  Thanks to all
the folks who have given help on IRC.  FWIW this patch is in the public
domain. 

Bill Gribble


Index: controller.py
===================================================================
RCS file: /cvs/Twisted/twisted/web/woven/controller.py,v
retrieving revision 1.60
diff -r1.60 controller.py
368,369d367
&lt;             nodeXML = nodeXML.replace('\n', '')
&lt;             nodeXML = nodeXML.replace('\r', '')
371a370,378
&gt;<i>             nodeXML = nodeXML.replace('&quot;', '\\&quot;')
</I>&gt;<i>             nodeXML = nodeXML.replace('\n', '\\n')
</I>&gt;<i>             nodeXML = nodeXML.replace('\r', '\\r')
</I>&gt;<i>             nodeXML = nodeXML.replace('\b', '\\b')
</I>&gt;<i>             nodeXML = nodeXML.replace('\t', '\\t')
</I>&gt;<i>             nodeXML = nodeXML.replace('\000', '\\0')
</I>&gt;<i>             nodeXML = nodeXML.replace('\v', '\\v')
</I>&gt;<i>             nodeXML = nodeXML.replace('\f', '\\f')
</I>&gt;<i> 
</I>


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030527/017a0716/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030527/017a0716/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004258.html">[Twisted-Python] Using usage.Options documentation error
</A></li>
	<LI>Next message: <A HREF="004262.html">[Twisted-Python] toc.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4259">[ date ]</a>
              <a href="thread.html#4259">[ thread ]</a>
              <a href="subject.html#4259">[ subject ]</a>
              <a href="author.html#4259">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
