<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.web.woven.guard.SessionWrapper problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted.web.woven.guard.SessionWrapper%20problems&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004068.html">
   <LINK REL="Next"  HREF="004049.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.web.woven.guard.SessionWrapper problems</H1>
    <B>Matthias Urlichs</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted.web.woven.guard.SessionWrapper%20problems&In-Reply-To="
       TITLE="[Twisted-Python] twisted.web.woven.guard.SessionWrapper problems">smurf at smurf.noris.de
       </A><BR>
    <I>Mon May 12 03:26:45 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004068.html">AW: AW: [Twisted-Python] newbie udp
</A></li>
        <LI>Next message: <A HREF="004049.html">[Twisted-Python] twisted.web.woven.guard.SessionWrapper problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4037">[ date ]</a>
              <a href="thread.html#4037">[ thread ]</a>
              <a href="subject.html#4037">[ subject ]</a>
              <a href="author.html#4037">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was experimenting with twisted.web.woven.guard yesterday and ran into a
problem.

Some browsers, including wget, don't like _at_all_ when you have a cycle
in your redirections, even though they should notice that they now have a
cookie while formerly they didn't.

Therefore I propose to rewrite the SessionWrapper to always change the
user's path, like this (the string &quot;sp&quot; is self.cookieKey):

/sessionized-url/foo
	Set cookie
	Redirect to /sessionized-url/sp__aef9c34aecc3d9148/foo
/sessionized-url/sp__aef9c34aecc3d9148/foo
	Redirect to either of the next two URLs depending on whether I see a
	cookie
/sessionized-url/sp/foo
	URL to use with cookies
/sessionized-url/sp_aef9c34aecc3d9148/foo
	URL to use without cookies

Finally, /sessionized-url/sp/foo, but no cookie, would do

	class SessionWrapper(...):
		def __init__(..., on_timeout=None):
			...
			self.prefix=prefix
			self.timed_out = timed_out
		def getChild(...):
			if (path == self.prefix and not self.sessions.has_key(cookie):
				return self.on_timeout(path,request)

so that access with no session can be distinguished from a plain link into
/sessionized-url/foo; the latter means the user might want to log in, but
the former should tell the user that their session has timed out before
offering the login page.

An additional advantage of this scheme would be that
.../unsessionized-url/ can be reaced with a constant number of backpaths.

Oh yes, and I'd like to make <A HREF="http://somewhere.example/sessionized-url">http://somewhere.example/sessionized-url</A> and
(i.e. no paths) work. At the moment that causes an ugly error because
SessionWrapper doesn't override render().

Thoughts? Or is somebody else going to rewrite this module next week
anyway and I therefore probably shouldn't bother?

-- 
Matthias Urlichs  | {M:U} IT Consulting @ m-u-it.de  |  <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">smurf at smurf.noris.de</A>
Disclaimer: The quote was selected randomly. Really. | <A HREF="http://smurf.noris.de">http://smurf.noris.de</A>
-- 
Van Roy's Law:
	An unbreakable toy is useful for breaking other toys.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004068.html">AW: AW: [Twisted-Python] newbie udp
</A></li>
	<LI>Next message: <A HREF="004049.html">[Twisted-Python] twisted.web.woven.guard.SessionWrapper problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4037">[ date ]</a>
              <a href="thread.html#4037">[ thread ]</a>
              <a href="subject.html#4037">[ subject ]</a>
              <a href="author.html#4037">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
