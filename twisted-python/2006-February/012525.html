<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deferred.callback() v. Deferred.called
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred.callback%28%29%20v.%20Deferred.called&In-Reply-To=20060208182330.54389.qmail%40web31515.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012524.html">
   <LINK REL="Next"  HREF="012526.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deferred.callback() v. Deferred.called</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Deferred.callback%28%29%20v.%20Deferred.called&In-Reply-To=20060208182330.54389.qmail%40web31515.mail.mud.yahoo.com"
       TITLE="[Twisted-Python] Deferred.callback() v. Deferred.called">exarkun at divmod.com
       </A><BR>
    <I>Wed Feb  8 13:53:35 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012524.html">[Twisted-Python] Deferred.callback() v. Deferred.called
</A></li>
        <LI>Next message: <A HREF="012526.html">[Twisted-Python] Conch: multiple commands
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12525">[ date ]</a>
              <a href="thread.html#12525">[ thread ]</a>
              <a href="subject.html#12525">[ subject ]</a>
              <a href="author.html#12525">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 8 Feb 2006 10:23:30 -0800 (PST), Lenny G Arbage &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">alengarbage at yahoo.com</A>&gt; wrote:
&gt;<i>I think I'm seeing a difference between when a
</I>&gt;<i>deferred's callback is invoked and when the .called
</I>&gt;<i>member variable is set, and was hoping someone might
</I>&gt;<i>be able to explain.
</I>&gt;<i>
</I>&gt;<i>(And let me apologize in advance if what I'm trying to
</I>&gt;<i>do is hairbrained or in some way abusive to the
</I>&gt;<i>methodology...)
</I>&gt;<i>
</I>&gt;<i>First, a little context.  I have some code that I use
</I>&gt;<i>to test with, and it follows the standard deferred
</I>&gt;<i>chaining pattern, i.e.,
</I>
Are you using trial?  If you use trial, testing Deferreds gets a lot easier.  If you're not using trial, you probably want to be using trial.

&gt;<i>
</I>&gt;<i> [snip - some things that look like unit tests but don't use trial]
</I>&gt;<i>
</I>&gt;<i>...and I wanted to try putting all the trial
</I>&gt;<i>invocations down in maintest, but still wait for the
</I>&gt;<i>result of a preceeding test before invoking the next,
</I>&gt;<i>so I made up a little function that does, basically,
</I>
Fortunately, waiting on things is what Deferreds do best.  Your maintest function (should you choose not to use trial, which there is basically no reason to do, so use trial) might look like this:

def maintest():
    tests = [test1, test2, test3]

    def runATest():
        if tests:
            d = tests.pop(0)()
            d.addCallback(lambda _: runATest())
            return d
    return runATest()

Now you can wait on the Deferred maintest returns.  Of course, you should really just use trial, since it handles all this for you, and with quite a few extra handy features as well.

&gt;<i>
</I>&gt;<i>def waitForDeferredResult(d):
</I>&gt;<i>    while not d.called:
</I>&gt;<i>        reactor.iteratoe(0.1)
</I>&gt;<i>    return d.result
</I>&gt;<i>
</I>
This function is broken.  d.called isn't really public.  d.result isn't really public.  reactor.iterate() isn't really public.  You cannot poll a Deferred like this and expect it to work.  Lots of people have tried.  It just can't be done.

&gt;<i>
</I>&gt;<i> [snip - description of why waitForDeferredResult doesn't work]
</I>&gt;<i>
</I>
When you want to run some code after a Deferred has fired, put the code in a function, add the function as a callback.  That's the only supported way to do this.  It's the entire purpose of Deferreds.  It works wonderfully. :)

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012524.html">[Twisted-Python] Deferred.callback() v. Deferred.called
</A></li>
	<LI>Next message: <A HREF="012526.html">[Twisted-Python] Conch: multiple commands
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12525">[ date ]</a>
              <a href="thread.html#12525">[ thread ]</a>
              <a href="subject.html#12525">[ subject ]</a>
              <a href="author.html#12525">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
