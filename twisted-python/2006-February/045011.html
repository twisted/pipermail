<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Making DeferredList look like Deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Making%20DeferredList%20look%20like%20Deferred&In-Reply-To=%3C20060206054325.82300.qmail%40web31504.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044998.html">
   <LINK REL="Next"  HREF="045013.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Making DeferredList look like Deferred</H1>
    <B>Lenny G Arbage</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Making%20DeferredList%20look%20like%20Deferred&In-Reply-To=%3C20060206054325.82300.qmail%40web31504.mail.mud.yahoo.com%3E"
       TITLE="[Twisted-Python] Re: Making DeferredList look like Deferred">alengarbage at yahoo.com
       </A><BR>
    <I>Sun Feb  5 22:43:25 MST 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044998.html">[Twisted-Python] Re: Making DeferredList look like Deferred
</A></li>
        <LI>Next message (by thread): <A HREF="045013.html">[Twisted-Python] Re: Making DeferredList look like Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45011">[ date ]</a>
              <a href="thread.html#45011">[ thread ]</a>
              <a href="subject.html#45011">[ subject ]</a>
              <a href="author.html#45011">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jean-Paul Calderone exarkun at divmod.com
Fri Feb 3 14:08:54 MST 2006 wrote:
&gt;<i>
</I>&gt;<i> ...However, if
</I>&gt;<i> you pass a true value for fireOnOneErrback when
</I>&gt;<i> constructing your DeferredList, any Deferred which
</I>&gt;<i> errbacks will cause the DeferredList to errback; in
</I>&gt;<i> this case it will never callback.
</I>

  I think I must be missing something, but I can't
spot it.  Here's the smallest example I've come up
with:

import random
from twisted.internet import reactor, defer
from twisted.python import failure

def error(err, msg):
    print &quot;failed: %s&quot; % msg
    reactor.stop()

def success(result, msg):
    print &quot;succeeded: %s&quot; % msg
    reactor.stop()

def defer2seconds(prob=0.5):
    d = defer.Deferred()
    if random.random() &lt; prob:
        print &quot;  deferred will succeed in 2s&quot;
        reactor.callLater(2, d.callback, True)
    else:
        print &quot;  deferred will fail in 2s&quot;
        reactor.callLater(2, d.errback, True)
    return d

def deferlist2seconds(prob=0.25, num=2):
    def itersuccess(result, i):
        print &quot;  %i succeeded&quot; % i
        return result

    def iterfail(err, i):
        print &quot;  %i failed&quot; % i

    dlist = []
    for i in range(num):
        d = defer2seconds(prob)
        d.addCallback(itersuccess, i)
        d.addErrback(iterfail, i)
        dlist.append(d)
    dl = defer.DeferredList(dlist,
            fireOnOneErrback=True)
    return dl

def testdlist():
    print &quot;in testdlist&quot;
    #d = defer2seconds(prob=0.5)
    d = deferlist2seconds(prob=0.5)
    d.addCallback(success, &quot;testdlist&quot;)
    d.addErrback(error, &quot;testdlist&quot;)

if __name__ == &quot;__main__&quot;:
    testdlist()
    reactor.run()


The action here is really simple, with each deferred
randomly choosing to succeed or fail.  The testdlist
function can call either the simple, single-deferred
test or the multi-deferredlist test.  The goal here is
that the caller doesn't care what the underlying
function call does, in terms of Deferred v.
DeferredList.  When calling the simple test, the
results are as expected:


in testdlist
  deferred will fail in 2 seconds
failed: testdlist

in testdlist
  deferred will succeed in 2 seconds
succeeded: testdlist


But when calling the DeferredList test, it never gets
into the DeferredList's errback.

in testdlist
  deferred will succeed in 2 seconds
  deferred will succeed in 2 seconds
  0 succeeded
  1 succeeded
succeeded: testdlist

in testdlist
  deferred will fail in 2 seconds
  deferred will succeed in 2 seconds
  0 failed
  1 succeeded
succeeded: testdlist


Why isn't the DeferredList's errback being called in
this case?  It seems that no matter what I do (remove
the individual Deferreds' errbacks, change
fireOnOneErrback, etc), the DeferredList's callback
only is called.  This doesn't sound like what you'd
expect.  What am I doing wrong?  What must I do to get
the DeferredList's errback to fire when any single
Deferred in the list has its errback called?

Tested using twisted 2.1.

Thanks,
Lenny

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
<A HREF="http://mail.yahoo.com">http://mail.yahoo.com</A> 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044998.html">[Twisted-Python] Re: Making DeferredList look like Deferred
</A></li>
	<LI>Next message (by thread): <A HREF="045013.html">[Twisted-Python] Re: Making DeferredList look like Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45011">[ date ]</a>
              <a href="thread.html#45011">[ thread ]</a>
              <a href="subject.html#45011">[ subject ]</a>
              <a href="author.html#45011">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
