<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r15860 - Move	checkPreconditions() from web2.dav.static.DAVFile to	web2.resource.RenderMixIn.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r15860%20-%20Move%0A%09checkPreconditions%28%29%20from%20web2.dav.static.DAVFile%20to%0A%09web2.resource.RenderMixIn.&In-Reply-To=E1F700I-0000rf-00%40wolfwood">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012533.html">
   <LINK REL="Next"  HREF="012532.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r15860 - Move	checkPreconditions() from web2.dav.static.DAVFile to	web2.resource.RenderMixIn.</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r15860%20-%20Move%0A%09checkPreconditions%28%29%20from%20web2.dav.static.DAVFile%20to%0A%09web2.resource.RenderMixIn.&In-Reply-To=E1F700I-0000rf-00%40wolfwood"
       TITLE="[Twisted-Python] Re: [Twisted-commits] r15860 - Move	checkPreconditions() from web2.dav.static.DAVFile to	web2.resource.RenderMixIn.">foom at fuhm.net
       </A><BR>
    <I>Thu Feb  9 13:34:29 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012533.html">[Twisted-Python] Deferred.callback() v. Deferred.called
</A></li>
        <LI>Next message: <A HREF="012532.html">[Twisted-Python] Re: [Twisted-commits] r15860 - Move	checkPreconditions() from web2.dav.static.DAVFile to	web2.resource.RenderMixIn.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12531">[ date ]</a>
              <a href="thread.html#12531">[ thread ]</a>
              <a href="subject.html#12531">[ subject ]</a>
              <a href="author.html#12531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 8, 2006, at 7:49 PM, Wilfredo Sanchez wrote:
&gt;<i> Move checkPreconditions() from web2.dav.static.DAVFile to  
</I>&gt;<i> web2.resource.RenderMixIn.
</I>&gt;<i> Add test suite (ported foom's tests for server.checkpreconditions()).
</I>&gt;<i> Fix some bugs found by the tests.  (Holy cow, checkpreconditions  
</I>&gt;<i> are a PITA.)
</I>
I don't like this part. You've made the precondition check code much  
longer, IMO harder to understand (figuring out how the return values  
of one method influenced the rest of the execution is not easy), and  
pinned it to being part of Resource, rather than being reusable. I'm  
not sure of the need, given that the previous implementation was  
callable from Resource as it was. Why not just use it...

Nextly, I'm somewhat concerned about the change to calling the  
precondition check before GET rendering instead of afterwards: I  
think your use cases are probably not typical. I believe most people  
will write resources which generate dynamic content, and if they're  
_really good_ about it, they'll simultaneously generate an etag and a  
last-modified time. This is also the only way that such information  
can come out of wsgi, cgi, proxies to other servers, etc.

The way things were set up before made Not Modified responses just  
&quot;magically&quot; show up correctly when you set those headers in your  
response. No more interface was required than that, which means that  
the response could come from anywhere. Now, instead, you force the  
author to implement resource.etag() and resource.lastModified() in  
order to get that behavior. It's really easy for file-like resources  
to do so, but not so much so for most other kinds.

And the thing is, it's OK to check afterwards for the kinds of  
requests a web browser makes: GET/HEAD/POST. GET/HEAD don't change  
things so it's acceptable to do their check at any time, and while  
POST does change things, as a practical matter nobody actually sends  
conditionals on post requests, because what would it be useful for?  
(and nothing would be set up to handle such a thing).

However, I'm currently ignoring conditionals on PostableResource's  
http_POST, which while okay as far as real-world interoperability  
goes, it is certainly not _right_. And to make things worse, the post- 
processing filter doesn't confine itself to checking only GET/HEAD  
requests, so the client will get back a precondition failed message,  
even though the method was executed. At the very least a POST with an  
If-Unmodified-Since/If-Match should return precondition failed. If  
there was code on Resource to handle that automatically, I could not  
have forgetten to do it.

So, um, I dunno what to conclude. :)

James


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012533.html">[Twisted-Python] Deferred.callback() v. Deferred.called
</A></li>
	<LI>Next message: <A HREF="012532.html">[Twisted-Python] Re: [Twisted-commits] r15860 - Move	checkPreconditions() from web2.dav.static.DAVFile to	web2.resource.RenderMixIn.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12531">[ date ]</a>
              <a href="thread.html#12531">[ thread ]</a>
              <a href="subject.html#12531">[ subject ]</a>
              <a href="author.html#12531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
