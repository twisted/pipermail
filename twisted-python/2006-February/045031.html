<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deferred.callback() v. Deferred.called
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deferred.callback%28%29%20v.%20Deferred.called&In-Reply-To=%3C20060208182330.54389.qmail%40web31515.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045077.html">
   <LINK REL="Next"  HREF="045032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deferred.callback() v. Deferred.called</H1>
    <B>Lenny G Arbage</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deferred.callback%28%29%20v.%20Deferred.called&In-Reply-To=%3C20060208182330.54389.qmail%40web31515.mail.mud.yahoo.com%3E"
       TITLE="[Twisted-Python] Deferred.callback() v. Deferred.called">alengarbage at yahoo.com
       </A><BR>
    <I>Wed Feb  8 11:23:30 MST 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045077.html">[Twisted-Python] Weekly Bug Summary
</A></li>
        <LI>Next message (by thread): <A HREF="045032.html">[Twisted-Python] Deferred.callback() v. Deferred.called
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45031">[ date ]</a>
              <a href="thread.html#45031">[ thread ]</a>
              <a href="subject.html#45031">[ subject ]</a>
              <a href="author.html#45031">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think I'm seeing a difference between when a
deferred's callback is invoked and when the .called
member variable is set, and was hoping someone might
be able to explain.

(And let me apologize in advance if what I'm trying to
do is hairbrained or in some way abusive to the
methodology...)

First, a little context.  I have some code that I use
to test with, and it follows the standard deferred
chaining pattern, i.e.,

def alldone(res):
    pass

def trial3(res, ...):
    ...
    d.addCallback(alldone)
    ...

def trial2(res, ...):
    ...
    d.addCallback(trial3)
    ...

def trial1(...):
    ...
    d = someFunc1(...)
    d.addCallback(trial2)
    ...

def maintest():
    trial1(...)


...and I wanted to try putting all the trial
invocations down in maintest, but still wait for the
result of a preceeding test before invoking the next,
so I made up a little function that does, basically,

def waitForDeferredResult(d):
    while not d.called:
        reactor.iteratoe(0.1)
    return d.result


...and then,

def maintest():
    d1 = trial1()
    res1 = waitForDeferredResult(d1)
    d2 = trial2(res1)
    res2 = waitForDeferredResult(d2)
    ...


Perhaps this is hairbrained, as the first strategy
works perfectly, but it sure would make it easier to
comment out one or two (or all but one or two) tests
when I just want to focus on hacking on that
functionality.

However, the while loop in waitForDeferredResult ends
(.called == True) before the callback is actually
called in the case where the the Deferred in the trial
is also chained.  For example, if someFunc1() is set
up something like this:

someFunc1():
    d = someFunc1-1()
    return d

someFunc1-1():
    d = threads.deferToThread(someThing)
    d.addCallback(someFunc1-2)
    return d

someFunc1-2():
    d = threads.deferToThread(someOtherThing)
    return d

...then it appears that .called becomes true after the
deferred in someFunc1-1() returns, but before
someFunc1-2() is invoked.  If, on the other hand, I
chain from one trialX() to the next (as in the top
example) the callback isn't invoked until after
someFunc1-2() returns.  Anyone know why?

Thanks,
Lenny

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
<A HREF="http://mail.yahoo.com">http://mail.yahoo.com</A> 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045077.html">[Twisted-Python] Weekly Bug Summary
</A></li>
	<LI>Next message (by thread): <A HREF="045032.html">[Twisted-Python] Deferred.callback() v. Deferred.called
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45031">[ date ]</a>
              <a href="thread.html#45031">[ thread ]</a>
              <a href="subject.html#45031">[ subject ]</a>
              <a href="author.html#45031">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
