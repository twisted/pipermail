<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] calling reactor.run() twice in PB app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20calling%20reactor.run%28%29%20twice%20in%20PB%20app&In-Reply-To=43F3CE84.70404%40trueblade.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012553.html">
   <LINK REL="Next"  HREF="012557.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] calling reactor.run() twice in PB app</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20calling%20reactor.run%28%29%20twice%20in%20PB%20app&In-Reply-To=43F3CE84.70404%40trueblade.com"
       TITLE="[Twisted-Python] calling reactor.run() twice in PB app">glyph at divmod.com
       </A><BR>
    <I>Wed Feb 15 21:48:23 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012553.html">[Twisted-Python] calling reactor.run() twice in PB app
</A></li>
        <LI>Next message: <A HREF="012557.html">[Twisted-Python] calling reactor.run() twice in PB app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12554">[ date ]</a>
              <a href="thread.html#12554">[ thread ]</a>
              <a href="subject.html#12554">[ subject ]</a>
              <a href="author.html#12554">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2006-02-15 at 19:59 -0500, Eric Smith wrote:
&gt;<i> Jean-Paul Calderone wrote:
</I>&gt;<i> &gt; On Thu, 16 Feb 2006 10:27:27 +1100, Andrew Bennetts 
</I>&gt;<i> &gt; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrew-twisted at puzzling.org</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; On Thu, Feb 16, 2006 at 08:17:42AM +1100, Jonathan Lange wrote:
</I>&gt;<i> &gt;&gt;&gt; On 2/16/06, Mike Pelletier &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mike at mkp.ca</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;&gt; &gt; What you want is not supported.  If it were, Trial would be a lot 
</I>&gt;<i> &gt;&gt;&gt; simpler.
</I>&gt;<i> &gt;&gt;&gt; &gt; There is some pressure to support it, but I think it's 
</I>&gt;<i> &gt;&gt;&gt; low-priority.  (If I
</I>&gt;<i> &gt;&gt;&gt; &gt; understand correctly.)  Perhaps you can just block the reactor by 
</I>&gt;<i> &gt;&gt;&gt; calling
</I>&gt;<i> &gt;&gt;&gt; &gt; into your app rather than vice-versa?
</I>
The easiest thing would be for your program to spawn a Twisted worker
process to get the data, send it along stdout in some simplified form,
and then read its output.

&gt;<i> &gt;&gt;&gt; You understand correctly. It is not supported, Trial would be simpler
</I>&gt;<i> &gt;&gt;&gt; and it is never going to be supported.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Never is a long time :)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Last time I pestered glyph about this, I got him to agree that it 
</I>&gt;<i> &gt;&gt; should work.
</I>
I think that in that particular conversation I followed up the
reactor-restarting comments with &quot;of course, for truly asynchronous
protocols like PB this is a waste of time, since it doesn't even
conceptually work&quot;.

&gt;<i> &gt; Now we just need to find someone to implement it for all the reactors :)
</I>&gt;<i> 
</I>&gt;<i> Well, I happen to be motivated just now.  I'm new to twisted, but I'm 
</I>&gt;<i> not new to Python and I'm reasonably familiar with the style twisted 
</I>&gt;<i> uses (I've written lots of IOCP code).
</I>
&gt;<i> If anyone could summarize the problem, and if you're serious about it 
</I>&gt;<i> getting fixed, I could look at it.
</I>
If you have the time, energy, and motivation to seriously contribute to
Twisted, AND experience with Win32 and IOCP, it would be a pity to waste
it supporting such an esoteric use-case - 99% of the users who ask for
this are just trying to shoot themselves in the foot, and if they manage
to do it successfully, it's more often bugs in Twisted.  As I said, you
can probably satisfy your own use-case with popen() relatively easily.

Unfortunately this is not a simple problem.  It involves auditing every
aspect of the reactor's internal state, including the threadpool, and
validating that its internal state is consistent before terminating
run().  It also means making sure that every buffer is flushed, all
outstanding bytes are read, etc.  Then you have to do that for each
reactor.  You'd also have to add an API that specifically did this kind
of &quot;soft&quot; shutdown; flushing buffers without closing connections,
stopping all threads, and so forth.

However, it would certainly be a great way to learn the ins and outs of
the reactor API.  I don't particularly want the functionality but I
suspect that adding it will flush out some latent bugs in at least one
reactor implementation, so I'm not opposed to seeing it done.

If you would like to work on something else though, we definitely need a
dedicated Windows maintainer ... ;)




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012553.html">[Twisted-Python] calling reactor.run() twice in PB app
</A></li>
	<LI>Next message: <A HREF="012557.html">[Twisted-Python] calling reactor.run() twice in PB app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12554">[ date ]</a>
              <a href="thread.html#12554">[ thread ]</a>
              <a href="subject.html#12554">[ subject ]</a>
              <a href="author.html#12554">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
