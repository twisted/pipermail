<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Is it possible to use	ReconnectingClientFactory with pb.ClientFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Is%20it%20possible%20to%20use%0A%09ReconnectingClientFactory%20with%20pb.ClientFactory&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011463.html">
   <LINK REL="Next"  HREF="011465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Is it possible to use	ReconnectingClientFactory with pb.ClientFactory</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Is%20it%20possible%20to%20use%0A%09ReconnectingClientFactory%20with%20pb.ClientFactory&In-Reply-To="
       TITLE="[Twisted-Python] Is it possible to use	ReconnectingClientFactory with pb.ClientFactory">warner at lothar.com
       </A><BR>
    <I>Fri Sep 16 21:25:27 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011463.html">[Twisted-Python] Is it possible to use ReconnectingClientFactory	with pb.ClientFactory
</A></li>
        <LI>Next message: <A HREF="011465.html">Re: Re: [Twisted-Python] Is it possible to use ReconnectingClientFactory with pb.ClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11464">[ date ]</a>
              <a href="thread.html#11464">[ thread ]</a>
              <a href="subject.html#11464">[ subject ]</a>
              <a href="author.html#11464">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Martin M&#246;llenbeck &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">martin at moellenbecks.de</A>&gt; writes:
&gt;<i>
</I>&gt;<i> Is it possible to use ReconnectingClientFactory with pb.ClientFactory?
</I>
Sure thing. I have a utility class that does this.. take a look at
ReconnectingPBClientFactory in the Buildbot (<A HREF="http://buildbot.sf.net">http://buildbot.sf.net</A>) source
tree, current CVS version is:

 <A HREF="http://cvs.sourceforge.net/viewcvs.py/buildbot/buildbot/buildbot/pbutil.py?rev=1.10&amp;view=auto">http://cvs.sourceforge.net/viewcvs.py/buildbot/buildbot/buildbot/pbutil.py?rev=1.10&amp;view=auto</A>

The only catch is to realize that pb.ClientFactory's getRootObject() and
login() methods return a single-use Deferred, and if you're reconnecting all
the time, you need something that can be fired multiple times. So
ReconnectingPBClientFactory offers a gotRootObject()/gotPerspective() method,
which are invoked each time the connection is established. You have to
override one of these in your subclass. If you're using cred, you override
gotPerspective() (and also call startLogin() or getPerspective() to start the
process, for newcred and oldcred respectively). If you aren't using cred at
all, you just override gotRootObject().

If you grep around the rest of the buildbot you can find an example of how
this factory gets used. I think buildbot.slave.bot.BotFactory is useful: it
includes a keepalive timer that pings the other end and abandons the
connection (thus triggering a reconnect) if the ping is lost. I added this to
deal with some buildslaves that were behind NAT boxes which timed out their
connection table after 10 minutes of inactivity: the symptom was that both
ends thought the connection was still established, no FINs had been seen, but
no packets could get from one side to the other. Sending a ping every 9
minutes tended to keep the connection table entry alive, while dropping the
connection if the ping got lost helped trigger a reconnect when that
keepalive failed.


cheers,
 -Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011463.html">[Twisted-Python] Is it possible to use ReconnectingClientFactory	with pb.ClientFactory
</A></li>
	<LI>Next message: <A HREF="011465.html">Re: Re: [Twisted-Python] Is it possible to use ReconnectingClientFactory with pb.ClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11464">[ date ]</a>
              <a href="thread.html#11464">[ thread ]</a>
              <a href="subject.html#11464">[ subject ]</a>
              <a href="author.html#11464">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
