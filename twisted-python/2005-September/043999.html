<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to send a UDP datagram
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20send%20a%20UDP%20datagram&In-Reply-To=%3C5.1.0.14.0.20050924175523.02adc0f0%40mail.adelphia.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043998.html">
   <LINK REL="Next"  HREF="044000.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to send a UDP datagram</H1>
    <B>Drake Smith</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20send%20a%20UDP%20datagram&In-Reply-To=%3C5.1.0.14.0.20050924175523.02adc0f0%40mail.adelphia.net%3E"
       TITLE="[Twisted-Python] How to send a UDP datagram">drakesmith at adelphia.net
       </A><BR>
    <I>Sat Sep 24 16:28:54 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043998.html">[Twisted-Python] How to send a UDP datagram
</A></li>
        <LI>Next message (by thread): <A HREF="044000.html">[Twisted-Python] How to send a UDP datagram
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43999">[ date ]</a>
              <a href="thread.html#43999">[ thread ]</a>
              <a href="subject.html#43999">[ subject ]</a>
              <a href="author.html#43999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i>On Sat, 24 Sep 2005 11:33:50 -0400, Drake Smith &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">drakesmith at adelphia.net</A>&gt; 
</I>&gt;<i>wrote:
</I>&gt;&gt;<i>Can somebody please show me the Twisted way to send a simple UDP 
</I>&gt;&gt;<i>datagram? From the examples, I see how to transport.write in response to 
</I>&gt;&gt;<i>receiving a datagram or in response to establishing a UDP &quot;connection&quot;. 
</I>&gt;&gt;<i>But in my application, I'd like to send datagrams blindly, say, to 
</I>&gt;&gt;<i>initiate a heartbeat message or to stream audio samples without 
</I>&gt;&gt;<i>acknowledgement via an unconnected UDP socket. I'd also like to do this 
</I>&gt;&gt;<i>from a function that is not wrapped inside a Twisted protocol class as 
</I>&gt;&gt;<i>such, unless that is contrary to the Twisted approach.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I am using Twisted version 2.0.1/Python 2.4 on a Linux box. Thank you.
</I>&gt;<i>
</I>&gt;<i>When a DatagramProtocol is hooked up to a transport, its startProtocol 
</I>&gt;<i>method is invoked.  Here's how I'd write a heartbeat thingy:
</I>&gt;<i>
</I>&gt;<i>  from twisted.internet import protocol, reactor, task
</I>&gt;<i>
</I>&gt;<i>  class Heartbeat(protocol.DatagramProtocol):
</I>&gt;<i>      def sendHeartbeat(self):
</I>&gt;<i>          self.transport.write('poingo')
</I>&gt;<i>
</I>&gt;<i>      def startProtocol(self):
</I>&gt;<i>          self._call = task.LoopingCall(self.sendHeartbeat)
</I>&gt;<i>          self._loop = self._call.start(15)
</I>&gt;<i>
</I>&gt;<i>      def stopProtocol(self):
</I>&gt;<i>          self._call.stop()
</I>&gt;<i>
</I>&gt;<i>  reactor.listenUDP(0, Heartbeat())
</I>&gt;<i>  reactor.run()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>There's nothing particularly unique to Twisted if you want to turn this 
</I>&gt;<i>inside out and have some other code controlling the loop, but here's an 
</I>&gt;<i>example of that just for completeness:
</I>&gt;<i>
</I>&gt;<i>  from twisted.internet import protocol, reactor, task
</I>&gt;<i>
</I>&gt;<i>  class Heartbeat(protocol.DatagramProtocol):
</I>&gt;<i>      def __init__(self, onStart):
</I>&gt;<i>          self.onStart = onStart
</I>&gt;<i>
</I>&gt;<i>      def startProtocol(self):
</I>&gt;<i>          self.onStart.callback(self)
</I>&gt;<i>
</I>&gt;<i>      def sendHeartbeat(self):
</I>&gt;<i>          self.transport.write('poingo')
</I>&gt;<i>
</I>&gt;<i>  class HeartbeatSenderGuy(object):
</I>&gt;<i>      def start(self):
</I>&gt;<i>          d = defer.Deferred()
</I>&gt;<i>          d.addCallback(self._listening)
</I>&gt;<i>          self._port = reactor.listenUDP(0, Heartbeat(d))
</I>&gt;<i>
</I>&gt;<i>      def _listening(self, proto):
</I>&gt;<i>          self._proto = proto
</I>&gt;<i>          self._call = task.LoopingCall(self._proto.sendHeartbeat)
</I>&gt;<i>          self._call.start(15)
</I>&gt;<i>
</I>&gt;<i>      def stop(self):
</I>&gt;<i>          self._call.stop()
</I>&gt;<i>          self._port.stopListening()
</I>&gt;<i>
</I>&gt;<i>  hb = HeartbeatSenderGuy()
</I>&gt;<i>  hb.start()
</I>&gt;<i>  reactor.run()
</I>&gt;<i>
</I>&gt;<i>Hope this helps,
</I>&gt;<i>
</I>&gt;<i>Jp
</I>

Jp,

Thank you for the extra effort to show us OO novices how to control the 
loop from outside the protocol class. I've read several inquiries to this 
effect but nobody has ever explained it.

I generalized your example to give me what I want: the ability to invoke 
UDP datagram messages from outside the protocol class:

from twisted.internet import protocol, reactor, defer

class UDPsender(protocol.DatagramProtocol):
     def __init__(self, onStart):
         self.onStart = onStart

     def startProtocol(self):
         self.onStart.callback(self)

     def sendMsg(self, data, (host, port)):
         self.transport.write(data, (host, port))

class DatagramSender(object):
     def start(self):
         d = defer.Deferred()
         d.addCallback(self._listening)
         self._port = reactor.listenUDP(0, UDPsender(d))

     def _listening(self, proto):
         global myProto
         myProto = proto

     def sendMsg(self, data, (host, port)):
         global myProto
         myProto.sendMsg(data, (host, port))

     def stop(self):
         self._call.stop()
         self._port.stopListening()

ds = DatagramSender()
ds.start()
ds.sendMsg(&quot;hello port 20006&quot;, (&quot;127.0.0.1&quot;, 20006))
ds.sendMsg(&quot;hello port 20007&quot;, (&quot;127.0.0.1&quot;, 20007))
reactor.run()

I tried a simpler implementation.....

from twisted.internet import protocol, reactor

class UDPsender(protocol.DatagramProtocol):

     def sendMsg(self, data, (host, port)):
         self.transport.write(data, (host, port))

ds = UDPsender()
ds.sendMsg(&quot;hello port 20006&quot;, (&quot;127.0.0.1&quot;, 20006))
ds.sendMsg(&quot;hello port 20007&quot;, (&quot;127.0.0.1&quot;, 20007))
reactor.run()

.....but I get the infamous &quot;AttributeError: 'NoneType' object has no 
attribute 'write'&quot; error. I'll stay with the former version. It's not 
exactly as compact as &quot;mySocket.sendto(data, addr)&quot; but I know it will 
cause me less headaches as my program evolves.

Jp: I see your name a lot within the Python community. Thanks for all your 
attentiveness to us new comers.



&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-Python mailing list
</I>&gt;<i><A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043998.html">[Twisted-Python] How to send a UDP datagram
</A></li>
	<LI>Next message (by thread): <A HREF="044000.html">[Twisted-Python] How to send a UDP datagram
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43999">[ date ]</a>
              <a href="thread.html#43999">[ thread ]</a>
              <a href="subject.html#43999">[ subject ]</a>
              <a href="author.html#43999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
