<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Broker leak in spread server on login failure =	denial of service?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Broker%20leak%20in%20spread%20server%20on%20login%20failure%20%3D%0A%09denial%20of%20service%3F&In-Reply-To=mailman.0.1126297570.25366.twisted-python%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011400.html">
   <LINK REL="Next"  HREF="011374.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Broker leak in spread server on login failure =	denial of service?</H1>
    <B>David K. Hess</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Broker%20leak%20in%20spread%20server%20on%20login%20failure%20%3D%0A%09denial%20of%20service%3F&In-Reply-To=mailman.0.1126297570.25366.twisted-python%40twistedmatrix.com"
       TITLE="[Twisted-Python] Broker leak in spread server on login failure =	denial of service?">dhess at verscend.com
       </A><BR>
    <I>Fri Sep  9 17:31:28 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011400.html">[Twisted-Python] Twisted Developers: Do not import Nevow	in	twisted code, and other reminders
</A></li>
        <LI>Next message: <A HREF="011374.html">[Twisted-Python] Broker leak in spread server on login failure =	denial of service?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11373">[ date ]</a>
              <a href="thread.html#11373">[ thread ]</a>
              <a href="subject.html#11373">[ subject ]</a>
              <a href="author.html#11373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I believe I've discovered a broker leak when a checker denies a login  
and that it can be used to launch a denial of service attack on a  
spread server.

When a checker throws a Failure exception, since requestAvatar in the  
realm doesn't get called, the realm (or anything else) doesn't end up  
with a reference it can use to disconnect the network connection that  
was denied login.

If a malicious (or just buggy as was my case) client tries to login  
over and over again and doesn't shutdown each connection from the  
client side, the server will continue to leak brokers until (under  
Windows) the select() call begins to fail because there are greater  
than 512 (with a stock Python build) file descriptors open and being  
monitored by the reactor. At this point, your server is dead as the  
reactor goes into an infinite loop retrying failing select() calls  
when this happens.

What I think might be best is if another method in the realm (say  
&quot;loginFailed(self, mind)&quot;) was called with the remote reference so  
the server could then call mind.broker.transport.loseConnection() on  
it. It would be nice too if this was after the Failure had been sent  
back across the connection and not before.

clientConnectionMade in PBServerFactory also looks promising but it  
doesn't seem possible to figure out which connection is  
authenticating from within the checker.

Can anybody offer some advice on how best to handle this?

Thanks!

Dave


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011400.html">[Twisted-Python] Twisted Developers: Do not import Nevow	in	twisted code, and other reminders
</A></li>
	<LI>Next message: <A HREF="011374.html">[Twisted-Python] Broker leak in spread server on login failure =	denial of service?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11373">[ date ]</a>
              <a href="thread.html#11373">[ thread ]</a>
              <a href="subject.html#11373">[ subject ]</a>
              <a href="author.html#11373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
