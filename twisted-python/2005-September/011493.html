<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] unsafe tracebacks in PB
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20unsafe%20tracebacks%20in%20PB&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011492.html">
   <LINK REL="Next"  HREF="011494.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] unsafe tracebacks in PB</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20unsafe%20tracebacks%20in%20PB&In-Reply-To="
       TITLE="[Twisted-Python] unsafe tracebacks in PB">warner at lothar.com
       </A><BR>
    <I>Sat Sep 24 20:32:59 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011492.html">[Twisted-Python] How to send a UDP datagram
</A></li>
        <LI>Next message: <A HREF="011494.html">[Twisted-Python] jelly tracebacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11493">[ date ]</a>
              <a href="thread.html#11493">[ thread ]</a>
              <a href="subject.html#11493">[ subject ]</a>
              <a href="author.html#11493">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Just wondering, why is it possible to turn on unsafe
</I>&gt;<i> tracebacks only at the server and not at the client?
</I>&gt;<i> PB being symmetrical, this discrimination makes it
</I>&gt;<i> arbitrarily difficuly to debug PB applications
</I>&gt;<i> sometimes.
</I>
Hey, sorry for the slow response.

It *is* possible to set the 'unsafeTracebacks' flag on both ends of the wire.
PBServerFactory() takes a constructor argument to set this flag, while
PBClientFactory() does not, but you can always set it after the fact:

 f = PBClientFactory()
 f.unsafeTracebacks = True

I'm more inclined to resolve the asymmetry by removing the argument from
PBServerFactory rather than adding it to PBClientFactory. As a debugging
thing, I feel it isn't entirely appropriate to have as a constructor
argument. However, I don't really feel that strongly about it either way.

For the record, I'll describe a little bit more about what exactly this flag
does, because there *is* a sense in which unsafe tracebacks can only be
enabled on the &quot;server&quot; side of a given method call. The important thing to
remember is that there are two different ways to divide the connection into
&quot;client&quot; and &quot;server&quot; ends.

Suppose you have program A, which has a pb.Referenceable named Alice that
implements remote_foo. Likewise, you have program B, which contains a
pb.Referenceable named Bob that implements remote_bar. Let us further suppose
that program B used PBServerFactory and reactor.listenTCP to make the object
Bob available to the world. Program A then used PBClientFactory and
reactor.connectTCP to obtain a RemoteReference to Bob (and somehow passed a
reference to Alice over to program B at the same time, so that both programs
have a RemoteReference to the other's Referenceable).

Now, the setting of this &quot;unsafe tracebacks&quot; flag on side A only affects
tracebacks being sent *from* side A: that is, for exceptions that occur on
side A, during a remote method invocation that was requested by side B. If
you consider any given method call to have a &quot;client side&quot; (which requests
the call by doing rref.callRemote(&quot;foo&quot;, args)), and a &quot;server side&quot; (which
implements the method remote_foo(self, args)), then the unsafe-tracebacks
flag is only relevant for the &quot;server side&quot;.

In our example, when B does alice.callRemote(&quot;foo&quot;), B is the &quot;client&quot; side
and A is the &quot;server&quot; side. If an exception occurs inside Alice's remote_foo
method, it is the setting of A's clientfactory.unsafeTracebacks flag that
determines whether's A's internal state will be exposed to B. On the other
hand, when A does bob.callRemote(&quot;bar&quot;), B is the &quot;server&quot; side, so it is B's
serverfactory.unsafeTracebacks flag that matters.

The important point is that the requesting side for any particular method
call does not get to ask for an &quot;unsafe traceback&quot;: only the owner of the
sensitive information (in this case, the stack frames leading up to the
exception, and the globals/locals that are in those stack frames) gets to
decide whether or not to share it with the outside world.

The second usage of the terms &quot;client&quot; and &quot;server&quot; here has to do with which
side initiated the TCP connection and which side accepted it. This is how the
PBClientFactory and PBServerFactory classes use these terms. Both of these
classes have an 'unsafeTracebacks' flag, and if you set it to something
non-zero, then any exception-raising methods invoked on that side will send
back a full traceback to the other side. The minor asymmetry here
(constructor argument versus set-the-flag-later) is just an oversight in the
API.


hope that's useful,
 -Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011492.html">[Twisted-Python] How to send a UDP datagram
</A></li>
	<LI>Next message: <A HREF="011494.html">[Twisted-Python] jelly tracebacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11493">[ date ]</a>
              <a href="thread.html#11493">[ thread ]</a>
              <a href="subject.html#11493">[ subject ]</a>
              <a href="author.html#11493">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
