<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.vfs issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.vfs%20issues&In-Reply-To=%3C433AF3B0.9040709%40thecablelounge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044029.html">
   <LINK REL="Next"  HREF="044034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.vfs issues</H1>
    <B>Andy Gayton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.vfs%20issues&In-Reply-To=%3C433AF3B0.9040709%40thecablelounge.com%3E"
       TITLE="[Twisted-Python] twisted.vfs issues">andy at thecablelounge.com
       </A><BR>
    <I>Wed Sep 28 13:49:04 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044029.html">[Twisted-Python] twisted.vfs issues
</A></li>
        <LI>Next message (by thread): <A HREF="044034.html">[Twisted-Python] twisted.vfs issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44030">[ date ]</a>
              <a href="thread.html#44030">[ thread ]</a>
              <a href="subject.html#44030">[ subject ]</a>
              <a href="author.html#44030">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>James Y Knight wrote:
&gt;<i> So, starting to look through twisted.vfs, I'm finding a few things  that 
</I>&gt;<i> need work.
</I>
Hey James,

Thanks for the feedback.  We need it.  Heaps of decisions for the vfs 
stuff have been put off to see what other use cases would need from the 
vfs.  Inparticular permissions and metadata.

&gt;<i> 1) I see no way of reading from or writing to a file in  
</I>&gt;<i> ivfs.IFileSystemLeaf.
</I>
The vfs stuff is still heavily influenced by the interface that conch 
expects as sftp has been the main motivation for the current contributors.

Reading and writing is done through writeChunk and readChunk - we've 
always felt this wasn't quite right though for a general backend. But 
after two sprints we still haven't come up with something that is 
better.  Adding the web2.Stream adaptor seems to have glazed over the 
issue for protocols that read/writeChunk doesn't work for.  Spiv even 
used streams for the vfs ftp adaptor!

I've added read/writeChunk to ivfs.IFileSystemLeaf's interface.

&gt;<i> 2) createFile is racy -- it requires opening a file by the given  name, 
</I>&gt;<i> with default permissions, then immediately closing it. 
</I>
:<i>), racy is good right?
</I>
&gt;<i> In  addition, it 
</I>&gt;<i> doesn't specify whether it's an error if the file  already exists.
</I>
It should, I've added this to the interface.

&gt;<i> 3) Looks like all operations are blocking? What about a remote vfs? I  
</I>&gt;<i> think every operation in the vfs interface ought to be non-blocking.
</I>
The other option is the vfs interface could be maybe deferred.  Most 
protocols are good at handling this (sftp, streams).  But given how easy 
it is to return deferred.succeed - it's probably simpler to say always 
non-blocking.

&gt;<i> 4) IFileSystemNode.remove doesn't say whether it's a recursive delete  
</I>&gt;<i> (on a directory)
</I>
Hrm yeah - should it?  Or should this be handled by higher level 
utilities (eg shutil).  The current os backend uses os.rmdir, so doesn't 
do a recursive delete.  I've updated the interface to say that it doesn't.

&gt;<i> , and .rename don't specify whether newName can be in  a 
</I>&gt;<i> different directory, whether it replaces an existing file, or  whether 
</I>&gt;<i> it works on a directory.
</I>
The method is against Node, so it works on directories.

This is os.rename's spec:

---
Rename the file or directory src to dst. If dst is a directory, OSError 
will be raised. On Unix, if dst exists and is a file, it will be removed 
silently if the user has permission. The operation may fail on some Unix 
flavors if src and dst are on different filesystems. If successful, the 
renaming will be an atomic operation (this is a POSIX requirement). On 
Windows, if dst already exists, OSError will be raised even if it is a 
file; there may be no way to implement an atomic rename when dst names 
an existing file. Availability: Macintosh, Unix, Windows.
---

Should vfs be aiming to provide consistent behaviour for all operations 
across all backends?  Or should some behaviour be left down to the 
particular backend to decide?

For the moment I've updated the interface to read:

Renames this node to newName.  newName can be in a different directory. 
  If the destination is an existing directory, an error will be raised.

&gt;<i> 5) Errors are coarse-grained. Everything is a VFSError, and the only  
</I>&gt;<i> detailed information is in human-readable text, not any nice computer- 
</I>&gt;<i> readable form.
</I>
yeah :( that needs to be fixed.

&gt;<i> 6) Need some support in the interface for extended attributes.
</I>
There's getMetadata. That let's you return arbitrary attributes.

Would that cover what you're thinking?

Protocol's should try to get by with as little metadata as they can.  If 
a backend doesn't supply a bit of metadata a protocol must have, then it 
won't be able to be used with the protocol.

Andy.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044029.html">[Twisted-Python] twisted.vfs issues
</A></li>
	<LI>Next message (by thread): <A HREF="044034.html">[Twisted-Python] twisted.vfs issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44030">[ date ]</a>
              <a href="thread.html#44030">[ thread ]</a>
              <a href="subject.html#44030">[ subject ]</a>
              <a href="author.html#44030">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
