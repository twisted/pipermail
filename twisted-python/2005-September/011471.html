<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: ReconnectingClientFactory creates multiple	Protocols? (clarification)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20ReconnectingClientFactory%20creates%20multiple%0A%09Protocols%3F%20%28clarification%29&In-Reply-To=E1EFy1o-0000xz-02%40pyramid.twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011470.html">
   <LINK REL="Next"  HREF="011472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: ReconnectingClientFactory creates multiple	Protocols? (clarification)</H1>
    <B>mikah at ceruleansoftware.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20ReconnectingClientFactory%20creates%20multiple%0A%09Protocols%3F%20%28clarification%29&In-Reply-To=E1EFy1o-0000xz-02%40pyramid.twistedmatrix.com"
       TITLE="[Twisted-Python] Re: ReconnectingClientFactory creates multiple	Protocols? (clarification)">mikah at ceruleansoftware.com
       </A><BR>
    <I>Tue Sep 20 03:36:18 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011470.html">[Twisted-Python] Hints for twisted newbie presentation
</A></li>
        <LI>Next message: <A HREF="011472.html">[Twisted-Python] Re: ReconnectingClientFactory creates multiple	Protocols? (clarification)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11471">[ date ]</a>
              <a href="thread.html#11471">[ thread ]</a>
              <a href="subject.html#11471">[ subject ]</a>
              <a href="author.html#11471">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Itamar Shtull-Trauring &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>&gt; wrote:
&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mikah at ceruleansoftware.com</A> wrote:
</I>&gt;<i> &gt;   As far as I can tell, it's related to the connection being
</I>&gt;<i> &gt; dropped, at which point the Factory reconnects and creates a
</I>&gt;<i> &gt; new protocol instance.
</I>&gt;<i> 
</I>&gt;<i> Protocols (at least, when used with TCP) are designed so that their
</I>&gt;<i> lifetime matches that of the TCP connection they are handling. As a
</I>&gt;<i> result, when the connection is lost and the factory reconnects, this is
</I>&gt;<i> a new TCP connection with a new protocol. This is why there's a factory,
</I>&gt;<i> to manage data and logic that is not tied to a specific TCP connection
</I>&gt;<i> (e.g. &quot;should I reconnect?&quot; or &quot;how far along was the download when I
</I>&gt;<i> got disconnected.&quot;)
</I>&gt;<i> 
</I>&gt;<i> In general you'd want to use the factory to store state that needs to
</I>&gt;<i> last past the lifetime of the protocol. You can, of course, have
</I>&gt;<i> buildProtocol always return the same instance, but that's pretty ugly
</I>&gt;<i> and can easily lead to obscure bugs if you don't clean up the state
</I>&gt;<i> correctly.
</I>
Itamar,

  Thanks for the reply. I think I have to clarify though, I
wasn't very clear describing the situation -- my problem isn't
that the RCFactory creates protocols on the fly, it's that
after disconnecting/reconnecting, the old protocol instance
seems to be still active! After the server has run a few days,
I start seeing a handful of protocol instances. I know they
aren't the same protocol because I can tell them apart from the
data they write to the log file.

  Only one of the protocols is actually connected to the remote
host, that much I can say. It's the 'newest' one (I hope). The
other instances are not connected but they attempt to send
requests anyway, and worse, continue to pull tasks out of the
task queue. So I end up with a bunch of tasks that never get
acted on because the protocols can't service them without a
connection.

  My question is: when an RCFactory makes a new protocol
instance, is the old one supposed to be deleted and cleaned
up?

  Everything hinges on this, pretty much. If the answer is yes,
then I'm doing something wrong because mine aren't getting
cleaned up. If the answer is no, then I must somehow take
responsibility for preventing the old instances from trying to
do work when they shouldn't, and somehow delete them.

  I have some related questions if someone would like to answer
them ... (1) is there a proper way for me to disconnect a
connected protocol and then stop its factory from reconnecting
and (2) start the factory connecting again at some time in the
future?

  I've found several ways to do this, but they seem kludgy and
not quite correct ...


  Thanks in advance!

Mikah

--



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011470.html">[Twisted-Python] Hints for twisted newbie presentation
</A></li>
	<LI>Next message: <A HREF="011472.html">[Twisted-Python] Re: ReconnectingClientFactory creates multiple	Protocols? (clarification)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11471">[ date ]</a>
              <a href="thread.html#11471">[ thread ]</a>
              <a href="subject.html#11471">[ subject ]</a>
              <a href="author.html#11471">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
