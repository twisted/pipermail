<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.vfs issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.vfs%20issues&In-Reply-To=%3C20050929011925.3914.1422986750.divmod.quotient.22223%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044038.html">
   <LINK REL="Next"  HREF="044047.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.vfs issues</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.vfs%20issues&In-Reply-To=%3C20050929011925.3914.1422986750.divmod.quotient.22223%40ohm%3E"
       TITLE="[Twisted-Python] twisted.vfs issues">exarkun at divmod.com
       </A><BR>
    <I>Wed Sep 28 19:19:25 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044038.html">[Twisted-Python] twisted.vfs issues
</A></li>
        <LI>Next message (by thread): <A HREF="044047.html">[Twisted-Python] twisted.vfs issues - web2 dependency
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44040">[ date ]</a>
              <a href="thread.html#44040">[ thread ]</a>
              <a href="subject.html#44040">[ subject ]</a>
              <a href="author.html#44040">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 28 Sep 2005 21:01:26 -0400, James Y Knight &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">foom at fuhm.net</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>On Sep 28, 2005, at 8:04 PM, Jp Calderone wrote:
</I>&gt;&gt;<i>rename() in VFS should work across filesystems,
</I>&gt;<i>
</I>&gt;<i>Hm, that is going to be an interesting one to implement. I'm thinking  in 
</I>&gt;<i>particular about what happens when you have a structure like:
</I>&gt;<i>/ -&gt; adhoc.AdhocDirectory:
</I>&gt;<i>   tmp -&gt; osfs.OSDirectory(&quot;/home/jknight/tmp&quot;, ...)
</I>&gt;<i>   home -&gt; inmem.FakeDirectory(...)
</I>&gt;<i>
</I>&gt;<i>and I ask to move a file from /tmp/foo to /home/bar.
</I>&gt;<i>
</I>
I can see ways to make this work.  They involve temporary files, as you mention below.  If we rule those out, it does become harder.

&gt;<i>IMO it is reasonable to say that the VFS 'rename' operation is  allowed to 
</I>&gt;<i>cleanly fail, and not do the rename, forcing a higher  level to do a 
</I>&gt;<i>copy/delete if it wants. This pushes the complication  out of each VFS 
</I>&gt;<i>implementation to one implementation that will work  across all, and 
</I>&gt;<i>furthermore can share its code with the copy  implementation. This maps 
</I>&gt;<i>nicely to rename(2), as well, as a bonus.
</I>&gt;&gt;<i>guarantee atomicity (if this is feasible - I think it is.  If not,  it 
</I>&gt;&gt;<i>should explicitly deny atomicity),
</I>&gt;<i>
</I>&gt;<i>It isn't feasible, when renaming across filesystems. There will  certainly 
</I>&gt;<i>have to be a time at which both 'from' and 'to' exist.  Additionally, it may 
</I>&gt;<i>be impossible to create a file 'to+&quot;.tmp&quot;' (or  similar) in the target 
</I>&gt;<i>directory to atomically rename to 'to' when  you've finished copying, 
</I>&gt;<i>because of permissions. Another reason to  restrict &quot;rename&quot; to be the 
</I>&gt;<i>simple rename, rather than the  copy&amp;delete-rename.
</I>
When are you allowed to create a file named &quot;foo&quot; in a directory, but not allowed to create a file named &quot;foo.tmp&quot;?

Anyway, I think it's worth a try at least.  If it turns out to not be possible, then certainly it should not be done :)  I am mainly concerned that there be consistent behavior across backends.  Writing code that deals with the quirks of os.rename() on Win32 is annoying, to say the least (and realisticly, just plain error prone).

Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044038.html">[Twisted-Python] twisted.vfs issues
</A></li>
	<LI>Next message (by thread): <A HREF="044047.html">[Twisted-Python] twisted.vfs issues - web2 dependency
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44040">[ date ]</a>
              <a href="thread.html#44040">[ thread ]</a>
              <a href="subject.html#44040">[ subject ]</a>
              <a href="author.html#44040">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
