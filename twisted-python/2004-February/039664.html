<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Advice on doing thousands of simultaneous UDP queries with Twisted...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advice%20on%20doing%20thousands%20of%20simultaneous%20UDP%0A%20queries%20with%20Twisted...&In-Reply-To=%3C403CBFDE.6040206%40tv.debian.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="039588.html">
   <LINK REL="Next"  HREF="039547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Advice on doing thousands of simultaneous UDP queries with Twisted...</H1>
    <B>Tommi Virtanen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advice%20on%20doing%20thousands%20of%20simultaneous%20UDP%0A%20queries%20with%20Twisted...&In-Reply-To=%3C403CBFDE.6040206%40tv.debian.net%3E"
       TITLE="[Twisted-Python] Advice on doing thousands of simultaneous UDP queries with Twisted...">tv at tv.debian.net
       </A><BR>
    <I>Wed Feb 25 08:31:42 MST 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="039588.html">[Twisted-Python] Advice on doing thousands of simultaneous UDP	queries with Twisted...
</A></li>
        <LI>Next message (by thread): <A HREF="039547.html">[Twisted-Python] For examples:  cred.py example adapted to use a db-based checker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39664">[ date ]</a>
              <a href="thread.html#39664">[ thread ]</a>
              <a href="subject.html#39664">[ subject ]</a>
              <a href="author.html#39664">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mike C. Fletcher wrote:
&gt;<i> Writing a simple asynchronous loop myself (poll on a simple socket, send 
</I>&gt;<i> message from queue when writable, read one into other queue when 
</I>&gt;<i> readable) allowed for doing a few thousand queries simultaneously), with 
</I>
A word of warning here. Nothing prevents your outgoing socket from
claiming writeability all the time, and the OS from dropping your
packets due to lack of buffer space. UDP just isn't reliable. Been
there, got the T-shirt.

You might be able to do some hacks with SIOCOUTQ, but even that
depends on the OS. IIRC on linux 2.4 it's not useful for UDP.

Your best course of action is to avoid bursts. Here's a nice and simple
algorithm: use a token bucket filter just like suggested elsewhere in
this thred, but add tokens both per time and per received responses.

Don't actually use the TBF as a filter, or even queue packets before it;
use it to see when you should be generating more requests and when not.
As long as there are tokens in bucket, generate reply and send it. When
bucket is empty, return and try again later. With reactor.callLater(),
add tokens to bucket and do the above processing. When receiving a
packet, add a token to bucket and do the above processing.

The more you get replies, the more work gets done; dropped packets slow
things down, as they should. Time-based token adding is there mostly
to be robust against packet loss; in normal case replies should
be the ones filling the bucket. The trick is to continue work as soon as
possible, based on replies (instead of waiting for all n request to
complete before continuing, or until a timer expires).


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="039588.html">[Twisted-Python] Advice on doing thousands of simultaneous UDP	queries with Twisted...
</A></li>
	<LI>Next message (by thread): <A HREF="039547.html">[Twisted-Python] For examples:  cred.py example adapted to use a db-based checker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39664">[ date ]</a>
              <a href="thread.html#39664">[ thread ]</a>
              <a href="subject.html#39664">[ subject ]</a>
              <a href="author.html#39664">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
