<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] [PATCH] twisted.names.hosts not working correct with getHostByName
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%5BPATCH%5D%20twisted.names.hosts%20not%20working%20correct%20with%20getHostByName&In-Reply-To=%3C86k72mv5nc.fsf%40stronzo.brainbot.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="039597.html">
   <LINK REL="Next"  HREF="039590.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] [PATCH] twisted.names.hosts not working correct with getHostByName</H1>
    <B>ralf at brainbot.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%5BPATCH%5D%20twisted.names.hosts%20not%20working%20correct%20with%20getHostByName&In-Reply-To=%3C86k72mv5nc.fsf%40stronzo.brainbot.com%3E"
       TITLE="[Twisted-Python] [PATCH] twisted.names.hosts not working correct with getHostByName">ralf at brainbot.com
       </A><BR>
    <I>Mon Feb 16 18:47:19 MST 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="039597.html">[Twisted-Python] [PATCH] nasty bug in	twisted.names.client.createResolver
</A></li>
        <LI>Next message (by thread): <A HREF="039590.html">[Twisted-Python] Client Prompt
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39589">[ date ]</a>
              <a href="thread.html#39589">[ thread ]</a>
              <a href="subject.html#39589">[ subject ]</a>
              <a href="author.html#39589">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Even with my prior patch I'm not able to use twisted.names.client.getHostByName.
Seems like twisted.names.hosts.Resolver calls itself with bad parameters
and even doesn't use the ip address it extracted from /etc/hosts. Also the return 
value could not be handled by the code in twisted.names.common.extractRecord.
The following patch seems to solve those problems.

- Ralf




===================================================================
RCS file: /cvs/Twisted/twisted/names/hosts.py,v
retrieving revision 1.14
diff -u -r1.14 hosts.py
--- twisted/names/hosts.py      19 Jul 2003 10:13:50 -0000      1.14
+++ twisted/names/hosts.py      17 Feb 2004 01:45:44 -0000
@@ -49,11 +49,11 @@
 
 
     def query(self, query, timeout = None):
-        return self._lookup(str(query.name), query.type, query.type, timeout)
+        return self._lookup(str(query.name), query.cls, query.type, timeout)
 
 
     def _lookup(self, name, cls, type, timeout):
-        if cls != dns.IN or type != dns.A:
+        if cls != dns.IN or (type != dns.A and type != dns.ALL_RECORDS): # getHostByName passes type==dns.ALL_RECORDS. what else do we need here?
             return defer.fail(failure.Failure(NotImplementedError(type, cls)))
         return self.lookupAddress(
             name, timeout
@@ -64,7 +64,7 @@
         res = searchFileFor(self.file, name)
         if res:
             return defer.succeed([
-                [dns.RRHeader(name, dns.A, dns.IN, self.ttl)], (), ()
+                [dns.RRHeader(name, dns.A, dns.IN, self.ttl, dns.Record_A(res, self.ttl))], [], []
             ])
         return defer.fail(failure.Failure(dns.DomainError(name)))
 
-- 
brainbot technologies ag
boppstrasse 64 . 55118 mainz . germany
fon +49 6131 211639-1 . fax +49 6131 211639-2
<A HREF="http://brainbot.com/">http://brainbot.com/</A>  mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ralf at brainbot.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="039597.html">[Twisted-Python] [PATCH] nasty bug in	twisted.names.client.createResolver
</A></li>
	<LI>Next message (by thread): <A HREF="039590.html">[Twisted-Python] Client Prompt
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39589">[ date ]</a>
              <a href="thread.html#39589">[ thread ]</a>
              <a href="subject.html#39589">[ subject ]</a>
              <a href="author.html#39589">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
