<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Can transport.write() to hostname instead of IP address?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Can%20transport.write%28%29%20to%20hostname%20instead%20of%0A%20IP%20address%3F&In-Reply-To=%3CCANzH6esz5ygL7iSZ-8HUL6M%2BeE-jFj4PKzWhaJFDbptjK_hTuw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064483.html">
   <LINK REL="Next"  HREF="064485.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Can transport.write() to hostname instead of IP address?</H1>
    <B>Sean DiZazzo</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Can%20transport.write%28%29%20to%20hostname%20instead%20of%0A%20IP%20address%3F&In-Reply-To=%3CCANzH6esz5ygL7iSZ-8HUL6M%2BeE-jFj4PKzWhaJFDbptjK_hTuw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Can transport.write() to hostname instead of IP address?">sean.dizazzo at gmail.com
       </A><BR>
    <I>Thu Aug 16 19:14:59 MDT 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064483.html">[Twisted-Python] Can transport.write() to hostname instead of IP address?
</A></li>
        <LI>Next message (by thread): <A HREF="064485.html">[Twisted-Python] Can transport.write() to hostname instead of IP address?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64484">[ date ]</a>
              <a href="thread.html#64484">[ thread ]</a>
              <a href="subject.html#64484">[ subject ]</a>
              <a href="author.html#64484">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for responding, Adi!

I don't want each packet to go it's own way from Twisted.  They all go to
the same place from each instance of the server/protocol.  They go to my
custom protocol listening on another local port.

It's just that I'm serving up several different ssl apps on the same nginx
server, and nginx uses the hostname to route the packets.  So in this case,
traffic coming in on http.example.com:443 might be routed to an https app
listening on a socket, and traffic coming in to myprotocol.example.com:443
should be routed to my own protocol listening on port 9999.  So if nginx
doesn't get the hostname, it doesn't know to route the packet to my custom
protocol instead of the web server.  Does that make sense?

It seems that the transport is resolving the hostname to an ip address and
then sending the traffic to the generic ip which is not enough info for
nginx to route the packet correctly.

On Thu, Aug 16, 2018 at 5:49 PM, Adi Roiban &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt; wrote:

&gt;<i> On Fri, 17 Aug 2018 at 01:25, Sean DiZazzo &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sean.dizazzo at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi all!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; After I start a reactor connecting to a specific hostname and port, I do
</I>&gt;<i> my thing and then call transport.write() to send the data to the peer.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; From what I can tell, though, the hostname is resolved, and the data is
</I>&gt;<i> written back to the ip address itself, instead of the hostname I started
</I>&gt;<i> the reactor with.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This is a problem in my case because we are using nginx's ssl_preread
</I>&gt;<i> server_name directive to route several different streams all coming in on
</I>&gt;<i> the same ip address.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So the write() method needs to explicitly use the hostname to route the
</I>&gt;<i> packet properly.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So... Is there any way to have transport.write() use the hostname given
</I>&gt;<i> instead of it's resolved IP address? Or am I missing something?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> I assume you are using TCP here.
</I>&gt;<i>
</I>&gt;<i> I guess that you are missing something.
</I>&gt;<i>
</I>&gt;<i> If you want each write to go over its own way / route and have the
</I>&gt;<i> hostname re-resolved you should open + write + close a connection for
</I>&gt;<i> each write.
</I>&gt;<i>
</I>&gt;<i> But I think that there is something else there and this is now what you
</I>&gt;<i> want :)
</I>&gt;<i> Do you use HTTP or have a custom protocol?
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Adi Roiban
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20180816/57152a01/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064483.html">[Twisted-Python] Can transport.write() to hostname instead of IP address?
</A></li>
	<LI>Next message (by thread): <A HREF="064485.html">[Twisted-Python] Can transport.write() to hostname instead of IP address?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64484">[ date ]</a>
              <a href="thread.html#64484">[ thread ]</a>
              <a href="subject.html#64484">[ subject ]</a>
              <a href="author.html#64484">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
