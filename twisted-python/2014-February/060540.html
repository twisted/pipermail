<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Raising TypeError in rich comparison methods
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Raising%20TypeError%20in%20rich%20comparison%20methods&In-Reply-To=%3CCABefbUrf4%2BLDRZtPSoLL4qHKpcsPGZWjMrYBBU7B%2BAZqJq-_oQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Raising TypeError in rich comparison methods</H1>
    <B>Richard Wall</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Raising%20TypeError%20in%20rich%20comparison%20methods&In-Reply-To=%3CCABefbUrf4%2BLDRZtPSoLL4qHKpcsPGZWjMrYBBU7B%2BAZqJq-_oQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Raising TypeError in rich comparison methods">m-lists at the-moon.net
       </A><BR>
    <I>Mon Feb 24 10:38:07 MST 2014</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60540">[ date ]</a>
              <a href="thread.html#60540">[ thread ]</a>
              <a href="subject.html#60540">[ subject ]</a>
              <a href="author.html#60540">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

I want to discuss if and when to raise TypeError from Python rich comparison
methods.

I'm working on a SerialNumber class which represents an RFC1982 serial number
value. See <A HREF="https://twistedmatrix.com/trac/ticket/6672">https://twistedmatrix.com/trac/ticket/6672</A>

SerialNumber has rich comparison methods to allow it to be compared with other
SerialNumber instances.

But what should be the behaviour when a SerialNumber is compared to an instance
of some foreign type?

In <A HREF="https://twistedmatrix.com/trac/ticket/6672?replyto=6#comment:4">https://twistedmatrix.com/trac/ticket/6672?replyto=6#comment:4</A> JP suggested
returning NotImplemented.

&gt;<i> The rich comparison methods should probably type check their argument and
</I>&gt;<i> return NotImplemented if it is not a SNA. This way the TypeError-generating
</I>&gt;<i> logic provided by the runtime will be invoked instead of an
</I>&gt;<i> implementation-dependent AttributeError.
</I>
I agree there should be type checking here, but after doing some research, I
think I prefer to raise an explicit TypeError. Here's why.

In Python2, returning NotImplemented from __lt__ always seems to return True and
False from __gt__. Python3 reacts more sensibly and raises TypeError. I worry
that this may cause Python2 users to think that an L{int} and a L{SerialNumber}
can be reliably compared. They can't.

I think the &quot;return True / False&quot; behaviour is due to a fallback comparison
mechanism in Python.
 * <A HREF="http://stackoverflow.com/questions/18516827/why-does-0-evaluate-to-true-in-python/18516984#18516984">http://stackoverflow.com/questions/18516827/why-does-0-evaluate-to-true-in-python/18516984#18516984</A>

   Python 2 is more stubborn and when NotImplemented is returned or no hooks
   have been implemented, the C code ends up in the default_3way_compare() C
   function,

So I've decided to explicitly raise TypeError instead. This makes it clear that
you can only compare L{SerialNumber} with L{SerialNumber}; in both Python2 and
Python3. It also means I only have to test for the &quot;raise TypeError&quot; behaviour.

Does that make sense?

Thanks in advance for your feedback.

-RichardW.


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60540">[ date ]</a>
              <a href="thread.html#60540">[ thread ]</a>
              <a href="subject.html#60540">[ subject ]</a>
              <a href="author.html#60540">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
