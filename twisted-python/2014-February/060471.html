<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Setting socket options before bind/listen
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Setting%20socket%20options%20before%20bind/listen&In-Reply-To=%3C634914A010D0B943A035D226786325D4446C295462%40EXVMBX020-12.exch020.serverdata.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060470.html">
   <LINK REL="Next"  HREF="060472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Setting socket options before bind/listen</H1>
    <B>Tobias Oberstein</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Setting%20socket%20options%20before%20bind/listen&In-Reply-To=%3C634914A010D0B943A035D226786325D4446C295462%40EXVMBX020-12.exch020.serverdata.net%3E"
       TITLE="[Twisted-Python] Setting socket options before bind/listen">tobias.oberstein at tavendo.de
       </A><BR>
    <I>Mon Feb  3 14:49:06 MST 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060470.html">[Twisted-Python] Setting socket options before bind/listen
</A></li>
        <LI>Next message (by thread): <A HREF="060472.html">[Twisted-Python] Setting socket options before bind/listen
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60471">[ date ]</a>
              <a href="thread.html#60471">[ thread ]</a>
              <a href="subject.html#60471">[ subject ]</a>
              <a href="author.html#60471">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt;for a multiprocess server, I'd like to set SO_REUSEPORT on a TCP
</I>&gt;<i> &gt;listening socket.
</I>&gt;<i> 
</I>&gt;<i> You might find that <A HREF="https://stackoverflow.com/questions/10077745">https://stackoverflow.com/questions/10077745</A>
</I>&gt;<i> /twistedweb-on-multicore-multiprocessor obviates the need for this option (and
</I>&gt;<i> thus your follow-up features as well).
</I>
Jean-Paul,

yes, I am aware of this (awesome) answer;) This works, but has 2 slightly
undesirable aspects:

1) it requires to have a master process that creates the socket and starts workers
which &quot;adopt&quot; the port. I'd like to be able to fire up workers independently .. with
no master at all.

2) the distribution of incoming connections to workers isn't completely uniformly
distributed across workers.

This problem is explained here (they report up to 3:1 ratios of connections per worker):
<A HREF="https://lwn.net/Articles/542629/">https://lwn.net/Articles/542629/</A>
<A HREF="https://lwn.net/Articles/542718/">https://lwn.net/Articles/542718/</A>

and I could verify this during some experiments (though not such extreme non-uniformity)

&gt;<i> 
</I>&gt;<i> Not that Twisted shouldn't offer some way to gain more control over this kind
</I>&gt;<i> of platform-specific option.  But, until it does...
</I>
I guess that means there is no &quot;recommended&quot; way currently;)

Would you mind giving a tip on how to make use of a CustomPort deriving
of Port? How to &quot;plug&quot; that into Twisted?

Thanks!
/Tobias

&gt;<i> 
</I>&gt;<i> Jean-Paul
</I>&gt;<i> &gt;The option needs to be set _before_ calling bind() and listen() on the
</I>&gt;<i> &gt;socket.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Is there a recommended way of doing this?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;One option might be subclassing `twisted.internet.tcp.Port` and
</I>&gt;<i> &gt;overriding `createInternetSocket` - is that recommended?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;And if so: how do I make the CustomPort be used with
</I>&gt;<i> &gt;reactor.listenTCP/listenSSL and endpoints?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Any hints appreciated, thanks!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;/Tobias
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;_______________________________________________
</I>&gt;<i> &gt;Twisted-Python mailing list
</I>&gt;<i> &gt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060470.html">[Twisted-Python] Setting socket options before bind/listen
</A></li>
	<LI>Next message (by thread): <A HREF="060472.html">[Twisted-Python] Setting socket options before bind/listen
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60471">[ date ]</a>
              <a href="thread.html#60471">[ thread ]</a>
              <a href="subject.html#60471">[ subject ]</a>
              <a href="author.html#60471">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
