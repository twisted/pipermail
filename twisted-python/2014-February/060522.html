<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deadlocks when launching processes - how to investigate?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deadlocks%20when%20launching%20processes%20-%20how%20to%0A%20investigate%3F&In-Reply-To=%3C20140219032604.6511.971289997.divmod.xquotient.6%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060521.html">
   <LINK REL="Next"  HREF="028045.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deadlocks when launching processes - how to investigate?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deadlocks%20when%20launching%20processes%20-%20how%20to%0A%20investigate%3F&In-Reply-To=%3C20140219032604.6511.971289997.divmod.xquotient.6%40top%3E"
       TITLE="[Twisted-Python] Deadlocks when launching processes - how to investigate?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Feb 18 20:26:04 MST 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060521.html">[Twisted-Python] Deadlocks when launching processes - how to	investigate?
</A></li>
        <LI>Next message (by thread): <A HREF="028045.html">[Twisted-Python] serializing inline callbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60522">[ date ]</a>
              <a href="thread.html#60522">[ thread ]</a>
              <a href="subject.html#60522">[ subject ]</a>
              <a href="author.html#60522">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02:50 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
&gt;<i>
</I>&gt;<i>On Feb 18, 2014, at 6:07 PM, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i>On 18 Feb, 07:29 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>On Feb 15, 2014, at 5:32 PM, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;&gt;&gt;<i>On 15 Feb, 07:58 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>The one thing that confused me was that the sample program appeared 
</I>&gt;&gt;&gt;&gt;&gt;<i>to be running the program only once a second, and waiting for it to 
</I>&gt;&gt;&gt;&gt;&gt;<i>complete before running it again.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>I think it's more like 81 processes once a second and *not* waiting 
</I>&gt;&gt;&gt;&gt;<i>for them to complete before starting over.  Notice the lack of 
</I>&gt;&gt;&gt;&gt;<i>yields in key places.  I suspect inlineCallbacks has gradually eaten 
</I>&gt;&gt;&gt;&gt;<i>out the part of your brain that recognizes that keyword. ;)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I sort of noted this on the ticket, but I think the idea of using 
</I>&gt;&gt;&gt;<i>KQueue to address this would be great.  Is there a similar thing we 
</I>&gt;&gt;&gt;<i>might be able to do on Linux to get rid of the dependence on a 
</I>&gt;&gt;&gt;<i>SIGCHLD handler?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Not that I know of.  As far as I know Linux is missing good child 
</I>&gt;&gt;<i>process event notification support.
</I>&gt;<i>
</I>&gt;<i>Wait... what about... signalfd?!
</I>&gt;<i>
</I>&gt;<i>Lots of mentions of SIGCHLD here:
</I>&gt;<i>
</I>&gt;<i>&lt;<A HREF="http://linux.die.net/man/2/signalfd">http://linux.die.net/man/2/signalfd</A>&gt;
</I>
It's sort of problematic for a library.  You have to block the signal 
for signalfd to work reliably.  Now no other code that depends on 
SIGCHLD can run properly in that process.

We could simply declare that to be the case and go ahead... But based on 
past experience I'm sure some people would be unhappy with that.

Perhaps it could be an option only turned on by applications that know 
it's okay for them and that want to avoid the mess of signals?

On the other hand we seem to be dealing with the mess of signals on 
Linux pretty okay at the moment.  Who would opt in to this and why?

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060521.html">[Twisted-Python] Deadlocks when launching processes - how to	investigate?
</A></li>
	<LI>Next message (by thread): <A HREF="028045.html">[Twisted-Python] serializing inline callbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60522">[ date ]</a>
              <a href="thread.html#60522">[ thread ]</a>
              <a href="subject.html#60522">[ subject ]</a>
              <a href="author.html#60522">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
