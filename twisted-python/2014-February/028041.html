<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deadlocks when launching processes - how to investigate?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deadlocks%20when%20launching%20processes%20-%20how%20to%0A%20investigate%3F&In-Reply-To=%3C52FF7BFD.9030907%40itamarst.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028040.html">
   <LINK REL="Next"  HREF="028042.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deadlocks when launching processes - how to investigate?</H1>
    <B>Itamar Turner-Trauring</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deadlocks%20when%20launching%20processes%20-%20how%20to%0A%20investigate%3F&In-Reply-To=%3C52FF7BFD.9030907%40itamarst.org%3E"
       TITLE="[Twisted-Python] Deadlocks when launching processes - how to investigate?">itamar at itamarst.org
       </A><BR>
    <I>Sat Feb 15 07:38:53 MST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028040.html">[Twisted-Python] Deadlocks when launching processes - how to	investigate?
</A></li>
        <LI>Next message: <A HREF="028042.html">[Twisted-Python] Deadlocks when launching processes - how to	investigate?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28041">[ date ]</a>
              <a href="thread.html#28041">[ thread ]</a>
              <a href="subject.html#28041">[ subject ]</a>
              <a href="author.html#28041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/14/2014 07:21 AM, Orestis Markou wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I just filed <A HREF="https://twistedmatrix.com/trac/ticket/6972">https://twistedmatrix.com/trac/ticket/6972</A>
</I>&gt;<i>
</I>&gt;<i> The issue I'm facing is a deadlocked Python on OS X when a lot of 
</I>&gt;<i> processes are spawned. In the repro script we do this very 
</I>&gt;<i> aggressively to trigger the deadlock quickly, but the actual program 
</I>&gt;<i> that does this &quot;ticks&quot; every minute.
</I>&gt;<i>
</I>&gt;<i> There is a possibility that this is either a Python bug or an OS X 
</I>&gt;<i> issue as the same program used to run fine in 10.5 and after some 
</I>&gt;<i> upgrades to 10.7 this issue appeared. We worked around it by using 2.6 
</I>&gt;<i> but now we need 2.7.
</I>&gt;<i>
</I>&gt;<i> I know this is going to be difficult for people to reproduce, so I 
</I>&gt;<i> wonder if someone can help me investigate the issue further. I found 
</I>&gt;<i> this <A HREF="https://dev.launchpad.net/Debugging/GDB">https://dev.launchpad.net/Debugging/GDB</A> but it doesn't work - I 
</I>&gt;<i> believe, without being able to confirm, that the issue is that GDB 
</I>&gt;<i> can't really work with clang-built executables? Or perhaps I don't 
</I>&gt;<i> have the debugging symbols.
</I>
When debugging Python deadlocks in general:

1. Try <A HREF="https://pypi.python.org/pypi/faulthandler/">https://pypi.python.org/pypi/faulthandler/</A> - send appropriate 
signal when process deadlocks.

2. If that doesn't work, I have had good luck debugging at least one 
Python mystery freeze with GDB. In particular because it has built-in 
Python support (sometimes), you to actually get a Python traceback. This 
assumes access to debugging symbols, though. lldb may have similar 
functionality, maybe Googling can help with that and finding debug symbols.


In this particular case, the traceback plus some googling 
(<A HREF="http://bugs.python.org/issue11768">http://bugs.python.org/issue11768</A> is what I found, presumably a 
different bug though) suggests the bug may be something like signal 
handler not being re-entrant for some reason and you're getting SIGCHLD 
just in the C code handling SIGCHLD. Try disabling SIGCHLD and just 
calling &quot;twisted.internet.process.reapAllProcesses()&quot; a few times a 
second and see if that's a good workaround - if so, add a note to the 
bug. If that is the case you may be able to reproduce the bug by setting 
a SIGCHLD handler and then sending SIGCHLD to the process a lot, no 
Twisted involved.

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028040.html">[Twisted-Python] Deadlocks when launching processes - how to	investigate?
</A></li>
	<LI>Next message: <A HREF="028042.html">[Twisted-Python] Deadlocks when launching processes - how to	investigate?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28041">[ date ]</a>
              <a href="thread.html#28041">[ thread ]</a>
              <a href="subject.html#28041">[ subject ]</a>
              <a href="author.html#28041">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
