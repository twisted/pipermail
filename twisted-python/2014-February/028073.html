<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Making twisted web client requests on running	reactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Making%20twisted%20web%20client%20requests%20on%20running%0A%09reactor&In-Reply-To=%3CCABcgvaj7_V5-tniKo7k3eN-YuVvt5enefhRbFMLdjzXQLOw%2B2Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="028069.html">
   <LINK REL="Next"  HREF="060536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Making twisted web client requests on running	reactor</H1>
    <B>Ameya Lokare</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Making%20twisted%20web%20client%20requests%20on%20running%0A%09reactor&In-Reply-To=%3CCABcgvaj7_V5-tniKo7k3eN-YuVvt5enefhRbFMLdjzXQLOw%2B2Q%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Making twisted web client requests on running	reactor">lokare.ameya at gmail.com
       </A><BR>
    <I>Sat Feb 22 19:17:42 MST 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="028069.html">[Twisted-Python] Implement HTTP request acception / rejection as	defined in RFC 2616 - 8.2.3
</A></li>
        <LI>Next message (by thread): <A HREF="060536.html">[Twisted-Python] Making twisted web client requests on running reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28073">[ date ]</a>
              <a href="thread.html#28073">[ thread ]</a>
              <a href="subject.html#28073">[ subject ]</a>
              <a href="author.html#28073">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everyone,

I'm writing a client library that makes (potentially long running) HTTP
requests. Since the library will be used within non-Twisted code, I was
thinking of running the reactor in a separate thread. The library code
looks roughly like this:

def start():
    Thread(target=reactor.run, args=(False,)).start()

def shutdown():
    reactor.callFromThread(lambda x: reactor.stop(), None)

def make_request(url):
        agent = Agent(reactor)
        d = agent.request(
            'GET',
            url,
            Headers({
                'User-Agent': ['Twisted SSE Client'],
                'Cache-Control': ['no-cache'],
            }),
            None)
        d.addCallback(self.cbRequest)

Then I make requests from the application like so:

start()
make_request(&quot;<A HREF="http://localhost:12000">http://localhost:12000</A>&quot;)
....
make_request(&quot;<A HREF="http://localhost:12000">http://localhost:12000</A>&quot;)
...
shutdown()

However, it looks like the 'd' deferred never gets fired. From a little
playing around, it looks like this is because the reactor is started before
the call(s) to agent.request are made. All examples in the twisted docs
create the request before running the reactor. I'm sure I'm missing
something very obvious here. Also, is there a better way to design such a
library?

-- 
-Ameya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20140222/c98efa6d/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20140222/c98efa6d/attachment.html</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="028069.html">[Twisted-Python] Implement HTTP request acception / rejection as	defined in RFC 2616 - 8.2.3
</A></li>
	<LI>Next message (by thread): <A HREF="060536.html">[Twisted-Python] Making twisted web client requests on running reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28073">[ date ]</a>
              <a href="thread.html#28073">[ thread ]</a>
              <a href="subject.html#28073">[ subject ]</a>
              <a href="author.html#28073">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
