<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Some things I've learned: safer callbacks, better t.p.context
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Some%20things%20I%27ve%20learned%3A%20safer%20callbacks%2C%0A%20better%20t.p.context&In-Reply-To=%3CCAKF%3D%2Bdiopr-YYWRPOEuJeZD2kM9UuzWA3HFNs%2BD9CqhKcKf3Jw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030858.html">
   <LINK REL="Next"  HREF="030860.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Some things I've learned: safer callbacks, better t.p.context</H1>
    <B>Kevin Conway</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Some%20things%20I%27ve%20learned%3A%20safer%20callbacks%2C%0A%20better%20t.p.context&In-Reply-To=%3CCAKF%3D%2Bdiopr-YYWRPOEuJeZD2kM9UuzWA3HFNs%2BD9CqhKcKf3Jw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Some things I've learned: safer callbacks, better t.p.context">kevinjacobconway at gmail.com
       </A><BR>
    <I>Wed Oct 19 18:12:47 MDT 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="030858.html">[Twisted-Python] Some things I've learned: safer callbacks,	better t.p.context
</A></li>
        <LI>Next message: <A HREF="030860.html">[Twisted-Python] Some things I've learned: safer callbacks,	better t.p.context
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30859">[ date ]</a>
              <a href="thread.html#30859">[ thread ]</a>
              <a href="subject.html#30859">[ subject ]</a>
              <a href="author.html#30859">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> What are you referring to as a &quot;coroutine&quot; here?  A generator?
</I>
Generator, yes, but used as a coroutine that both emits values and receives
them. The introduction of dedicated coroutines in Python 3.5 is something I
haven't updated my personal language for very well. Generator-coroutine is
the term used in there Python docs, IIRC.

&gt;<i> And exponential growth, you say?
</I>
Well... That may not be perfectly accurate and I shouldn't have used that
term. It grew large enough, fast enough that the same level of nesting was
measured in microseconds for the control and and over an hour for the
wrapper so I cancelled the test. Let me put together a reproducible
experiment and let others decide the growth rate.

&gt;<i> Where is this implemented?
</I>
Unfortunately, our production use of the lib is not something we've open
sourced. Similar to the above, I'll make available a reproducible
experiment so you can draw your own conclusion.

&gt;<i> Optimizing for CPython looks like adding weird implementation-specific
</I>hacks that might start working or be backwards in the next version

This went into the rationale behind making most of the components
pluggable. The choice of optimizing for cPython is internal to us and we
chose to document it for others. It's not required and not the default.

As far as the possibility of integrating this feature into Twisted, let me
chat with my cohorts over here. Well come back with some benchmark code and
a proposal of changes for further discussion. I'll probably start a new
thread to focus on the context bits.

On Wed, Oct 19, 2016, 16:56 Glyph Lefkowitz &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:


On Oct 19, 2016, at 2:47 PM, Itamar Turner-Trauring &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>&gt;
wrote:

On Wed, Oct 19, 2016, at 05:45 PM, Itamar Turner-Trauring wrote:

Well... I had a test that went through synchronous Deferred path. And yeah,
it was easier to write than async test. But it failed to catch a bug that
was only in async case. So the problem I see is that supporting both in
Deferred means you need twice the number of tests each time you use
Deferreds.


Er, that was unclear. I had a bug that wasn't caught by tests because it
passed with sync Deferred and failed with async Deferred callback, and I
didn't have tests for latter.


To be clear: I do see this as a *downside* to Deferred's architecture; it's
a tradeoff.  I see the loose coupling with the event loop as a worthwhile
upside.

However, it's totally possible to write the async Deferred callback case as
well, just by having the test fire the Deferred after returning to the test
body instead of firing it before :-).

-glyph
_______________________________________________
Twisted-Python mailing list
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20161020/e5708d31/attachment-0001.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20161020/e5708d31/attachment-0001.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030858.html">[Twisted-Python] Some things I've learned: safer callbacks,	better t.p.context
</A></li>
	<LI>Next message: <A HREF="030860.html">[Twisted-Python] Some things I've learned: safer callbacks,	better t.p.context
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30859">[ date ]</a>
              <a href="thread.html#30859">[ thread ]</a>
              <a href="subject.html#30859">[ subject ]</a>
              <a href="author.html#30859">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
