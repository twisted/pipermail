<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Is there a recommended way for a Service to request Application stop?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Is%20there%20a%20recommended%20way%20for%20a%20Service%20to%0A%20request%20Application%20stop%3F&In-Reply-To=%3CCADzPF4sKVwg8iJmFXRZOaLjruQSur%2BfzCj1yd2MtkzkvZb1zkA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063284.html">
   <LINK REL="Next"  HREF="063286.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Is there a recommended way for a Service to request Application stop?</H1>
    <B>Daniel Sutcliffe</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Is%20there%20a%20recommended%20way%20for%20a%20Service%20to%0A%20request%20Application%20stop%3F&In-Reply-To=%3CCADzPF4sKVwg8iJmFXRZOaLjruQSur%2BfzCj1yd2MtkzkvZb1zkA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Is there a recommended way for a Service to request Application stop?">dansut at gmail.com
       </A><BR>
    <I>Mon Oct 10 17:38:12 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063284.html">[Twisted-Python] Is there a recommended way for a Service to	request Application stop?
</A></li>
        <LI>Next message (by thread): <A HREF="063286.html">[Twisted-Python] Is there a recommended way for a Service to	request Application stop?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63285">[ date ]</a>
              <a href="thread.html#63285">[ thread ]</a>
              <a href="subject.html#63285">[ subject ]</a>
              <a href="author.html#63285">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your feedback Glyph, responses embedded below.

On Oct 10, 2016, at 9:41 AM, Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt; wrote:
&gt;<i> I have a hierarchy of Services some of which is MultiService and other
</I>&gt;<i> parts are my own implementations of IServiceCollection - in some
</I>&gt;<i> situations the child Service may want to 'suggest' that the
</I>&gt;<i> Application's job is done (error, or simply task completed) and I'm
</I>&gt;<i> looking for some sort of standardized way to pass this info upstream.
</I>&gt;<i> The idea being that I may using my implemented Services in a variety
</I>&gt;<i> of Applications.
</I>&gt;<i>
</I>&gt;<i> In this type of situation, is it the general intention a child Service
</I>&gt;<i> would use the Application directly, such that potential StopService()s
</I>&gt;<i> could bubble down? Or is there a normal pattern here to have messages
</I>&gt;<i> bubble up through the Services hierarchy? I'm not seeing anything like
</I>&gt;<i> this in the examples I've found or looking through the sources, but
</I>&gt;<i> I'm probably missing something.
</I>
On Mon, Oct 10, 2016 at 5:51 PM, Glyph Lefkowitz
&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
&gt;<i> Services are just things that can be started and stopped.  Application is
</I>&gt;<i> just a top-level object that associates a thing-to-start with a few bits of
</I>&gt;<i> global process-level state, like logging and pidfile settings.
</I>&gt;<i>
</I>&gt;<i> Therefore, the Service hierarchy abstraction is a poor fit for some code
</I>&gt;<i> that needs to do some work and then exit; it's designed for long-running
</I>&gt;<i> tools which can be started and stopped on demand.  For example, what happens
</I>&gt;<i> if two Service objects think that the Application's job is &quot;done&quot;?
</I>
This is perhap the type of thing I'm trying to code for; my goal is
that the Services themselves do not have the final say in when the
Application (or parent Service) is done. The event a Service feels is
a problem may cause its parent to stop it, or it could simply call a
method on it to remediate - depending on situation.

&gt;<i> If you want to exit a process, calling `stop` on the reactor is generally
</I>&gt;<i> the right way to go.
</I>
ie. specifically I would not want a Service to stop the reactor, as
what it feels is a problem might only be a minor inconvenience for the
Application as a whole; but in another Application, or Application
state, it might be 'game over'.

&gt;<i> But: talking about this in such vague, abstract terms is unlikely to be
</I>&gt;<i> helpful.  What, concretely, are you actually trying to do with the &quot;Services
</I>&gt;<i> in a variety of Applications&quot;?
</I>
I'll try to give one fairly concrete example of where I'd like to use
this kind of pattern.
The Services are long running polling ModBus clients whose configs are
read from a DB by the parent, the child Service has no knowledge of
where its config came from. Occasionally the child Services config may
become totally unworkable (for a variety of reasons) and so they want
to tell their parent the situation to give it a chance to reconfig,
call child.stopService(), or...The parent will have many such
Services, appropriate action may include a child reconfig, or if all
children showing issues telling its parent the situation to ask for
'advice'.

It seems to me in Twisted's Applications the job of calling
stopService() (or similar) should always be the responsibility of the
parent Service, but as a child how should I give my parent a clue I
need attention?

I can see implementing this with my own Interfaces so the child
Services know more about their parent's Interfaces/attributes, or
related objects, and can bubble information up through these, but I'd
prefer my child Services to know as little about their parents as
possible so they can be re-used in other simple Twisted apps.
Basically, I didn't want to go implementing stuff when there were
already tried and tested Twisted patterns for dealing with this kind
of thing.

Generically, can I somehow bubble up events through the Service
hierarchy, or should I communicate with external objects to the
hierarchy that can bubble down actions from higher up?

Any suggestions, or pointers to similar examples will be most
appreciated - I'm not stuck on this quandary, just wanting to write
code which fits best with the Twisted way of doing things.
Cheers
/dan
-- 
Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063284.html">[Twisted-Python] Is there a recommended way for a Service to	request Application stop?
</A></li>
	<LI>Next message (by thread): <A HREF="063286.html">[Twisted-Python] Is there a recommended way for a Service to	request Application stop?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63285">[ date ]</a>
              <a href="thread.html#63285">[ thread ]</a>
              <a href="subject.html#63285">[ subject ]</a>
              <a href="author.html#63285">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
