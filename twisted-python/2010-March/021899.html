<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] NetstringReceiver
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20NetstringReceiver&In-Reply-To=20100324123917.GA24344%40weiermayer.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021898.html">
   <LINK REL="Next"  HREF="021903.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] NetstringReceiver</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20NetstringReceiver&In-Reply-To=20100324123917.GA24344%40weiermayer.com"
       TITLE="[Twisted-Python] NetstringReceiver">andrew at bemusement.org
       </A><BR>
    <I>Wed Mar 24 18:22:03 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021898.html">[Twisted-Python] NetstringReceiver
</A></li>
        <LI>Next message: <A HREF="021903.html">[Twisted-Python] NetstringReceiver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21899">[ date ]</a>
              <a href="thread.html#21899">[ thread ]</a>
              <a href="subject.html#21899">[ subject ]</a>
              <a href="author.html#21899">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Albert Brandl wrote:
&gt;<i> Hi!
</I>&gt;<i> 
</I>&gt;<i> The NetstringReceiver class does not exactly do what I'd expect - see 
</I>&gt;<i> issue <A HREF="http://twistedmatrix.com/trac/ticket/4378.">http://twistedmatrix.com/trac/ticket/4378.</A> Since we plan to use 
</I>&gt;<i> netstrings, I am trying to fix it.
</I>&gt;<i> 
</I>&gt;<i> I am not quite sure how to handle certain problems, though, and that's 
</I>&gt;<i> where I'd appreciate help. If this is the wrong place to ask this kind of 
</I>&gt;<i> questions, please redirect me ;-).
</I>&gt;<i> 
</I>&gt;<i> 1.) In the current implementation, a NetstringParseError results in a 
</I>&gt;<i> call to self.transport.loseConnection(). Furthermore the variable 
</I>&gt;<i> brokenPeer is set to 1. But this variable is ignored. Would it be better 
</I>&gt;<i> to check it before receiving data? If yes: what is the correct way for a 
</I>&gt;<i> protocol to handle a broken transport? There is a ConnectionLost 
</I>&gt;<i> exception, but I'm not sure if / when a Protocol is allowed to raise it.
</I>
No; I think once loseConnection has been called dataReceived won't be
called again, so there's no point checking for brokenPeer in
dataReceived.

It might be worth checking in sendString, but I would expect that it
would already raise an appropriate exception because it will try to
write to a closed transport.

&gt;<i> 2.) The current implementation uses the method dataReceived to assemble 
</I>&gt;<i> the content of the netstring. When it is complete, the method 
</I>&gt;<i> stringReceived (which raises a NotImplementedError by default) is called. 
</I>&gt;<i> But netstrings can be long - would it be better to create a Deferred 
</I>&gt;<i> instance and call its callback instead? What would be the right place to 
</I>&gt;<i> create this Deferred?
</I>
No.

I'm rather confused about why you're even asking this question.  Exactly
what API are you proposing as an alternative to the existing API (which
is subclass NetstringReceiver and override stringReceived, and
stringReceived will be called for every netstring that is received, as
soon as it is received)?

&gt;<i> 3.) I started testing the NetstringReceiver by creating a class comment 
</I>&gt;<i> with doctests. When I later grepped the sources, I found some doctests, 
</I>&gt;<i> but there no mention of the doctest module in the test policy document. 
</I>&gt;<i> Would it be better to use the unittest framework for testing the code?
</I>
Yes please.

There are some existing tests for NetstringReceiver in
twisted/test/test_protocols.py.

-Andrew.


</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021898.html">[Twisted-Python] NetstringReceiver
</A></li>
	<LI>Next message: <A HREF="021903.html">[Twisted-Python] NetstringReceiver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21899">[ date ]</a>
              <a href="thread.html#21899">[ thread ]</a>
              <a href="subject.html#21899">[ subject ]</a>
              <a href="author.html#21899">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
