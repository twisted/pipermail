<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] NetstringReceiver
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20NetstringReceiver&In-Reply-To=%3C20100324123917.GA24344%40weiermayer.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] NetstringReceiver</H1>
    <B>Albert Brandl</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20NetstringReceiver&In-Reply-To=%3C20100324123917.GA24344%40weiermayer.com%3E"
       TITLE="[Twisted-Python] NetstringReceiver">albert.brandl at weiermayer.com
       </A><BR>
    <I>Wed Mar 24 06:39:17 MDT 2010</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54396">[ date ]</a>
              <a href="thread.html#54396">[ thread ]</a>
              <a href="subject.html#54396">[ subject ]</a>
              <a href="author.html#54396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

The NetstringReceiver class does not exactly do what I'd expect - see 
issue <A HREF="http://twistedmatrix.com/trac/ticket/4378.">http://twistedmatrix.com/trac/ticket/4378.</A> Since we plan to use 
netstrings, I am trying to fix it.

I am not quite sure how to handle certain problems, though, and that's 
where I'd appreciate help. If this is the wrong place to ask this kind of 
questions, please redirect me ;-).

1.) In the current implementation, a NetstringParseError results in a 
call to self.transport.loseConnection(). Furthermore the variable 
brokenPeer is set to 1. But this variable is ignored. Would it be better 
to check it before receiving data? If yes: what is the correct way for a 
protocol to handle a broken transport? There is a ConnectionLost 
exception, but I'm not sure if / when a Protocol is allowed to raise it.

2.) The current implementation uses the method dataReceived to assemble 
the content of the netstring. When it is complete, the method 
stringReceived (which raises a NotImplementedError by default) is called. 
But netstrings can be long - would it be better to create a Deferred 
instance and call its callback instead? What would be the right place to 
create this Deferred?

3.) I started testing the NetstringReceiver by creating a class comment 
with doctests. When I later grepped the sources, I found some doctests, 
but there no mention of the doctest module in the test policy document. 
Would it be better to use the unittest framework for testing the code?

Thanks and best regards,

--
Albert Brandl
Weiermayer Solutions GmbH
4813 Altmünster | Abteistraße 12 | Austria
Fon: +43(0)720 70 30 14 | Fax: +43 (0) 7612 88081


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54396">[ date ]</a>
              <a href="thread.html#54396">[ thread ]</a>
              <a href="subject.html#54396">[ subject ]</a>
              <a href="author.html#54396">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
