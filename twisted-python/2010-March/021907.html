<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] NetstringReceiver
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20NetstringReceiver&In-Reply-To=20100324222203.GF17997%40steerpike.home.puzzling.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021904.html">
   <LINK REL="Next"  HREF="021908.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] NetstringReceiver</H1>
    <B>Albert Brandl</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20NetstringReceiver&In-Reply-To=20100324222203.GF17997%40steerpike.home.puzzling.org"
       TITLE="[Twisted-Python] NetstringReceiver">albert.brandl at weiermayer.com
       </A><BR>
    <I>Fri Mar 26 06:25:48 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="021904.html">[Twisted-Python] NetstringReceiver
</A></li>
        <LI>Next message: <A HREF="021908.html">[Twisted-Python] NetstringReceiver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21907">[ date ]</a>
              <a href="thread.html#21907">[ thread ]</a>
              <a href="subject.html#21907">[ subject ]</a>
              <a href="author.html#21907">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Mar 25, 2010 at 09:22:03AM +1100, Andrew Bennetts wrote:
&gt;<i> 
</I>&gt;<i> No; I think once loseConnection has been called dataReceived won't be
</I>&gt;<i> called again, so there's no point checking for brokenPeer in
</I>&gt;<i> dataReceived.
</I>
There is a unittest that assumes that dataReceives still works after
sending in garbage:

   def test_illegal(self):
        &quot;&quot;&quot;
        Assert that illegal strings cause the transport to be closed.
        &quot;&quot;&quot;
        for s in self.illegalStrings:
            r = self.getProtocol()
            for c in s:
                r.dataReceived(c)
            self.assertTrue(r.transport.disconnecting)

self.illegalStrings is defined as

    illegalStrings = [
        '9999999999999999999999', 'abc', '4:abcde',
        '51:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaab,',]

In this implementation, the dataReceived method has to be functional
even after the NetstringReceiver has detected that the received
data are garbage. And there is no direct information that the
received string was no valid netstring - you have to check for
r.transport.disconnecting.

That's why I thought it might be a good idea to raise an appropriate 
exception if the receiver is no longer functional. I use a generator- 
based approach to parsing the netstring (for details see 
<A HREF="http://twistedmatrix.com/trac/attachment/ticket/4378/ticket_4378.patch">http://twistedmatrix.com/trac/attachment/ticket/4378/ticket_4378.patch</A>), 
and the generator raises a StopIteration exception.

But I'd prefer to raise an exception that explains what happened at a 
higher level - that's why I asked if there was some predefined exception 
that would match this kind of problem.

&gt;<i> There are some existing tests for NetstringReceiver in
</I>&gt;<i> twisted/test/test_protocols.py.
</I>
Thanks, this was very helpful.

Regards,
-- 
DI Albert Brandl

Weiermayer Solutions GmbH

4813 Altm&#252;nster | Abteistra&#223;e 12 | Austria
Fon: +43(0)720 70 30 14 | Fax: +43 (0) 7612 88081

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021904.html">[Twisted-Python] NetstringReceiver
</A></li>
	<LI>Next message: <A HREF="021908.html">[Twisted-Python] NetstringReceiver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21907">[ date ]</a>
              <a href="thread.html#21907">[ thread ]</a>
              <a href="subject.html#21907">[ subject ]</a>
              <a href="author.html#21907">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
