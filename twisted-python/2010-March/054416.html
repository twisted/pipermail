<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to use AmpList?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20use%20AmpList%3F&In-Reply-To=%3C1269870693.17631.1367260645%40webmail.messagingengine.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054414.html">
   <LINK REL="Next"  HREF="054424.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to use AmpList?</H1>
    <B>Peter Westlake</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20use%20AmpList%3F&In-Reply-To=%3C1269870693.17631.1367260645%40webmail.messagingengine.com%3E"
       TITLE="[Twisted-Python] How to use AmpList?">peter.westlake at pobox.com
       </A><BR>
    <I>Mon Mar 29 07:51:33 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054414.html">[Twisted-Python] How to use AmpList?
</A></li>
        <LI>Next message (by thread): <A HREF="054424.html">[Twisted-Python] How to use AmpList?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54416">[ date ]</a>
              <a href="thread.html#54416">[ thread ]</a>
              <a href="subject.html#54416">[ subject ]</a>
              <a href="author.html#54416">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Mon, 29 Mar 2010 14:54 +0300, &quot;Vlad Shevchenko&quot;
&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">vlad.shevchenko at gmail.com</A>&gt; wrote:
&gt;<i> No one use AmpList?
</I>&gt;<i> 
</I>&gt;<i> On Sat, Mar 27, 2010 at 11:45 PM, Vlad Shevchenko
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">vlad.shevchenko at gmail.com</A>
</I>&gt;<i> &gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt; can't find any reference of how to use AmpList. What should be passed to
</I>&gt;<i> &gt; callRemote? In command: arguments = Amp.List(...) or arguments = [('param',
</I>&gt;<i> &gt; AmpList(...))]? Responder params?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Please, advice some refs or examples.
</I>
Here's an example. I've missed out the other arguments for clarity. The
data being passed is a Unix-style environment string. It needs to be
reformatted to make it suitable for passing in an AmpList, but that's
just an implementation detail. It's because the AmpList requires the
dictionary keys to be declared in advance, but I want to be able to pass
environment variables whose names are only known at run-time. Your code
might not need to do any of that.

First, the command:

  class RunCmd(amp.Command):
      arguments = [...,
                   ('env',  amp.AmpList([('var', amp.String()), ('val',
                   amp.String())])),
                   ...]


Then the call:

          # env is something like {'PATH': '/bin:/usr/bin', 'HOME':
          '/home/peter'}
          # It needs to be converted into a form suitable for AmpList,
          like this:
          # [{'var': 'PATH', 'val': '/bin:/usr/bin'}, {'var': 'HOME',
          'val': '/home/peter'}]
          #
          amp_env  = [{'var': var, 'val': val} for (var, val) in
          env.items()]
          d = self.protocol.callRemote(commands.RunCmd, ...,
          env=amp_env, ...)


Then the responder:

    def runcmd(..., env, ..):
        &quot;&quot;&quot;Implementation of the AMP command RunCmd.
        ...
        &quot;&quot;&quot;

        # The &quot;env&quot; argument represents the environment of a process.
        # Convert it from the AmpList format back to a Python
        dictionary.
        #
        envd = {}
        for var in env:
            envd[var['var']] = var['val']
        ...
        return {...}
    
    commands.RunCmd.responder(runcmd)


Peter.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054414.html">[Twisted-Python] How to use AmpList?
</A></li>
	<LI>Next message (by thread): <A HREF="054424.html">[Twisted-Python] How to use AmpList?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54416">[ date ]</a>
              <a href="thread.html#54416">[ thread ]</a>
              <a href="subject.html#54416">[ subject ]</a>
              <a href="author.html#54416">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
