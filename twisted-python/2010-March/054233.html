<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted xmpp-router component interface problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20xmpp-router%20component%20interface%20problem&In-Reply-To=%3C4B8EB0E6.10400%40thiengineering.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054232.html">
   <LINK REL="Next"  HREF="054234.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted xmpp-router component interface problem</H1>
    <B>Werner Thie</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20xmpp-router%20component%20interface%20problem&In-Reply-To=%3C4B8EB0E6.10400%40thiengineering.ch%3E"
       TITLE="[Twisted-Python] twisted xmpp-router component interface problem">wthie at thiengineering.ch
       </A><BR>
    <I>Wed Mar  3 11:56:38 MST 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054232.html">[Twisted-Python] Does the default session expiry work?
</A></li>
        <LI>Next message (by thread): <A HREF="054234.html">[Twisted-Python] twisted xmpp-router component interface problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54233">[ date ]</a>
              <a href="thread.html#54233">[ thread ]</a>
              <a href="subject.html#54233">[ subject ]</a>
              <a href="author.html#54233">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

Starting twistd xmpp-router and trying to connect to it with a component 
from the wokkel examples

&quot;&quot;&quot;
An XMPP Ping server as an external server-side component.

This ping server assumes the domain C{'ping'}.
&quot;&quot;&quot;
import sys

from twisted.python import log
from twisted.application import app, service, internet
from twisted.internet import reactor

from wokkel import component
from wokkel.ping import PingHandler

# Configuration parameters
EXT_HOST = 'localhost'
EXT_PORT = 5347
SECRET = 'secret'
DOMAIN = 'ping'
LOG_TRAFFIC = True

# Set up the Twisted application
application = service.Application(&quot;Ping Component&quot;)

router = component.Router()
pingComponent = component.Component(EXT_HOST, EXT_PORT, DOMAIN, SECRET)
pingComponent.logTraffic = LOG_TRAFFIC
pingComponent.setServiceParent(application)

pingHandler = PingHandler()
pingHandler.setHandlerParent(pingComponent)

produces the following traceback:

2010-03-03 19:24:28+0100 [XmlStream,0,127.0.0.1] Unhandled Error
         Traceback (most recent call last):
           File 
&quot;\proj\Python-2.5.2\stackless-2.5.2-r63812\Modules\pyexpat.c&quot;, line 656, 
in EndElement
             (&quot;(N)&quot;, string_intern(self, name)))
           File &quot;C:\proj\twisted\twisted\words\xish\domish.py&quot;, line 
797, in _onEndElement
             self.ElementEvent(self.currElem)
           File &quot;C:\proj\twisted\twisted\words\xish\xmlstream.py&quot;, line 
107, in onElement
             self.dispatch(element)
           File &quot;C:\proj\twisted\twisted\words\xish\utility.py&quot;, line 
317, in dispatch
             callbacklist.callback(obj)
         --- &lt;exception caught here&gt; ---
           File &quot;C:\proj\twisted\twisted\words\xish\utility.py&quot;, line 
107, in callback
             methodwrapper(*args, **kwargs)
           File &quot;C:\proj\twisted\twisted\words\xish\utility.py&quot;, line 
27, in __call__
             self.method(*nargs, **nkwargs)
           File 
&quot;C:\proj\twisted\twisted\words\protocols\jabber\component.py&quot;, line 171, 
in onElement
             self.onHandshake(unicode(element))
           File 
&quot;C:\proj\twisted\twisted\words\protocols\jabber\component.py&quot;, line 187, 
in onHandshake
             unicode(self.secret))
           File 
&quot;C:\proj\twisted\twisted\words\protocols\jabber\xmlstream.py&quot;, line 52, 
in hashPassword
             raise TypeError(&quot;The session identifier must be a unicode 
object&quot;)
         exceptions.TypeError: The session identifier must be a unicode 
object

After some fiddling around it seems that the code at line 282 in 
twisted\words\protocols\jabber\xmlstream.py presets the sid of the 
stream to a str instead of a unicode(str). After changing line 282
from

self.xmlstream.sid = randbytes.secureRandom(8).encode('hex')

to

self.xmlstream.sid = unicode(randbytes.secureRandom(8).encode('hex'))

everything works as advertised.

Is there somebody around who could tell me what to do with this fix, I'm 
certainly a beginner diddling with XMPP.

Thanks a bunch, Werner




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054232.html">[Twisted-Python] Does the default session expiry work?
</A></li>
	<LI>Next message (by thread): <A HREF="054234.html">[Twisted-Python] twisted xmpp-router component interface problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54233">[ date ]</a>
              <a href="thread.html#54233">[ thread ]</a>
              <a href="subject.html#54233">[ subject ]</a>
              <a href="author.html#54233">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
