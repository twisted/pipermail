<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Need help pulling things together.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Need%20help%20pulling%20things%20together.&In-Reply-To=%3Ce64b001e0705221232v70ce16d8x8c03970c4937dc56%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047923.html">
   <LINK REL="Next"  HREF="047935.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Need help pulling things together.</H1>
    <B>Brendon Colby</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Need%20help%20pulling%20things%20together.&In-Reply-To=%3Ce64b001e0705221232v70ce16d8x8c03970c4937dc56%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Need help pulling things together.">brendoncolby at gmail.com
       </A><BR>
    <I>Tue May 22 13:32:02 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047923.html">[Twisted-Python] Dead link in wiki/ContributingToTwistedLabs
</A></li>
        <LI>Next message (by thread): <A HREF="047935.html">[Twisted-Python] Need help pulling things together.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47926">[ date ]</a>
              <a href="thread.html#47926">[ thread ]</a>
              <a href="subject.html#47926">[ subject ]</a>
              <a href="author.html#47926">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings,

I've struggled to learn Twisted for a couple of years, usually hitting
the same wall I've hit yet again and giving up. I acknowledge the huge
benefit to using Twisted for what I want to do, so I wanted to see if
some nice folks out there can help me pull some things together. I've
gone through the docs, previous posts, Twisted code and examples etc.
quite extensively. Things just have not gelled for me.

The project I'm working on is, at its core, a relatively basic chat
server. There are &quot;Areas&quot; and &quot;Users&quot;. What I do now with asynchat is
create a new User() object for each UserSocket() object (each user who
connects). The UserSocket() class parses the socket data and does a
getattr(), i.e. if the client sends a &quot;sendAreaMessage&quot; command I
getattr() User.do_sendAreaMessage(). The work is done in the User
class, then an event is sent back to the user. This is the pattern my
brain wants to use with Twisted, and I'm not sure whether or not I'm
off to a bad start. I took this from the chat server example:

class ChatProtocol(basic.LineReceiver):
    delimiter = '\n'

    def connectionMade(self):
        print &quot;Got new client!&quot;
        self.user = User(self)
        self.message(&quot;Welcome to chat.&quot;)

    def connectionLost(self, reason):
        print &quot;Lost a client!&quot;

    def lineReceived(self, line):
        data = line.split(&quot; &quot;)
        getattr(self.user,'do_'+data[0])(data[1:])

    def message(self, message):
        self.transport.write(message + self.delimiter)

class ChatFactory(Factory):
    protocol = ChatProtocol

class Area:
    pass # Area stuff

class User:
    def __init__(self,protocol):
        print &quot;New user&quot;
        self.protocol = protocol

    def do_foo(self,args):
        message = &quot;do_foo with args: &quot;+ ' '.join(args)
        self.protocol.transport.write(message + &quot;\n&quot;)

application = service.Application(&quot;sserverd&quot;)
internet.TCPServer(4001, ChatFactory()).setServiceParent(application)


With all the different examples I'm having a hard time finding the
&quot;right&quot; way to write my server using Twisted. I thought I was on to
something reading through the IRC server protocol, but without a full
server example I got lost. Do I set up a generic handleCommand() like
interface and define each command in the protocol class (i.e.
do_sendMessage) and have callbacks that my User class
redefines/implements? Or am I on the right path?

I really appreciate any input on this!

Brendon


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047923.html">[Twisted-Python] Dead link in wiki/ContributingToTwistedLabs
</A></li>
	<LI>Next message (by thread): <A HREF="047935.html">[Twisted-Python] Need help pulling things together.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47926">[ date ]</a>
              <a href="thread.html#47926">[ thread ]</a>
              <a href="subject.html#47926">[ subject ]</a>
              <a href="author.html#47926">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
