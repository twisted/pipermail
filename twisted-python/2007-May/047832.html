<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] client side cert?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20client%20side%20cert%3F&In-Reply-To=%3C18e3f33d0705012130q627492a9v3973f634580d7b04%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047836.html">
   <LINK REL="Next"  HREF="047833.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] client side cert?</H1>
    <B>Eli Criffield</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20client%20side%20cert%3F&In-Reply-To=%3C18e3f33d0705012130q627492a9v3973f634580d7b04%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] client side cert?">elicriffield at gmail.com
       </A><BR>
    <I>Tue May  1 22:30:27 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047836.html">[Twisted-Python] Polling a resource on another computer with	Twisted
</A></li>
        <LI>Next message (by thread): <A HREF="047833.html">[Twisted-Python] client side cert?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47832">[ date ]</a>
              <a href="thread.html#47832">[ thread ]</a>
              <a href="subject.html#47832">[ subject ]</a>
              <a href="author.html#47832">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to make a simple xmlrpc server that uses ssl and requires
the client to have a cert signed by me.

Sounds easy enough, It doesn't seem to work. It would appear that
twisted.internet.ssl.CertificateOptions() Has all the options i need
to make a ContextFactory object to feed to listenSSL, but i get this
error when i try to setup the listenSSL.

  File &quot;./xmlrpc-server.py&quot;, line 38, in &lt;module&gt;
    reactor.listenSSL(7080,server.Site(r),ctx)
  File &quot;/usr/lib/python2.5/site-packages/twisted/internet/posixbase.py&quot;,
line 492, in listenSSL
    p.startListening()
  File &quot;/usr/lib/python2.5/site-packages/twisted/internet/tcp.py&quot;,
line 730, in startListening
    skt = self.createInternetSocket()
  File &quot;/usr/lib/python2.5/site-packages/twisted/internet/ssl.py&quot;,
line 169, in createInternetSocket
    return SSL.Connection(self.ctxFactory.getContext(), sock)
  File &quot;/usr/lib/python2.5/site-packages/twisted/internet/_sslverify.py&quot;,
line 901, in getContext
    self._context = self._makeContext()
  File &quot;/usr/lib/python2.5/site-packages/twisted/internet/_sslverify.py&quot;,
line 910, in _makeContext
    ctx.use_certificate(self.certificate)
TypeError: Expected an X509 object


My code:
if __name__ == '__main__':
    from twisted.internet import reactor, ssl
    import OpenSSL
    r = Example()
    pem = OpenSSL.crypto.FILETYPE_PEM
    xfd = open('test.cert','r')
    x590cert = ssl.Certificate.loadPEM(xfd.read())
    pfd = open('test.key','r')
    pkeycert =  OpenSSL.crypto.load_privatekey(pem,pfd.read(),'password')
    ctx = ssl.CertificateOptions(privateKey=pkeycert,certificate=x590cert,method=OpenSSL.SSL.SSLv23_METHOD)
    reactor.listenSSL(7080,server.Site(r),ctx)
    reactor.run()

I try to make the x590 object to feed to CertificateOptions from
t.i.s.Certifcate.loadPEM() but it doesn't like it. I see nowhere in
t.i.ssl to make a PKey object that t.i.s.CertificationOptions() wants.

I've tried t.i.s.ContextFactory() but there is no options for
requiring a client side cert.
t.i.s.ClientContextFactory doesn't seem to have any options to tell it
what cert to use on the client side either, or how to verify the
server cert, I guess thats what t.i.s.CertificationOptions() is for
but it doesn't seem to work as documented.

Is there some great documentation out there about how to do this with
twisted.internet.ssl that I'm missing?

Eli Criffield


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047836.html">[Twisted-Python] Polling a resource on another computer with	Twisted
</A></li>
	<LI>Next message (by thread): <A HREF="047833.html">[Twisted-Python] client side cert?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47832">[ date ]</a>
              <a href="thread.html#47832">[ thread ]</a>
              <a href="subject.html#47832">[ subject ]</a>
              <a href="author.html#47832">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
