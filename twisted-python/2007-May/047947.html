<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Sequential use of asynchronous calls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Sequential%20use%20of%20asynchronous%20calls&In-Reply-To=%3C200705270448.58306.maarten%40treewalker.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047946.html">
   <LINK REL="Next"  HREF="047948.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Sequential use of asynchronous calls</H1>
    <B>Maarten ter Huurne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Sequential%20use%20of%20asynchronous%20calls&In-Reply-To=%3C200705270448.58306.maarten%40treewalker.org%3E"
       TITLE="[Twisted-Python] Sequential use of asynchronous calls">maarten at treewalker.org
       </A><BR>
    <I>Sat May 26 20:48:51 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047946.html">[Twisted-Python] Sequential use of asynchronous calls
</A></li>
        <LI>Next message (by thread): <A HREF="047948.html">[Twisted-Python] Sequential use of asynchronous calls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47947">[ date ]</a>
              <a href="thread.html#47947">[ thread ]</a>
              <a href="subject.html#47947">[ subject ]</a>
              <a href="author.html#47947">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Saturday 26 May 2007, Ben Artin wrote:

&gt;<i> &gt; In my implementation the decorator has a check whether the thing it is
</I>&gt;<i> &gt; decorating is really a generator. Without this check, you will get an
</I>&gt;<i> &gt; exception only when you start using the decorated function. I think
</I>&gt;<i> &gt; it is
</I>&gt;<i> &gt; usually better to detect errors at an early stage. However, the
</I>&gt;<i> &gt; check uses
</I>&gt;<i> &gt; compiler.consts.CO_GENERATOR, which is not documented in the Python
</I>&gt;<i> &gt; Library
</I>&gt;<i> &gt; Reference, so using it might be risky.
</I>&gt;<i>
</I>&gt;<i> If the argument to the decorator is not a generator (i.e., it's a
</I>&gt;<i> regular function), then you should just treat is as a generator that
</I>&gt;<i> immediately returned.
</I>
Since it is used as a decorator, the @sequential line will be written by the 
same person who wrote the function itself. If the author of the function 
knows it is not a generator, why would he apply @sequential (or 
@inlineCallbacks) to it?

&gt;<i> For example, 
</I>&gt;<i>
</I>&gt;<i> @sequential
</I>&gt;<i> def foo():
</I>&gt;<i> 	yield retval
</I>&gt;<i>
</I>&gt;<i> should just behave the same as
</I>&gt;<i>
</I>&gt;<i> @sequential
</I>&gt;<i> def foo():
</I>&gt;<i> 	return retval
</I>
That behaviour would be: return a Deferred on which:
- callback is called immediately if retval is not a Deferred
- errback is called immediately if the function raises an exception
- callback or errback is called when the retval Deferred fires
And the result passed to the callback would be None, not retval.

Applying maybeDeferred to the return value sounds more useful, since that will 
do the Deferred part, but will also preserve the result.

By the way, without &quot;@sequential&quot; the closest non-generator equivalent of

def foo():
	yield retval

would be

def foo():
	return (retval, )

In other words, it would return a sequence containing retval rather than 
retval itself.

&gt;<i> I can't think of any case where passing a non-generator into
</I>&gt;<i> @sequential is intended to mean anything other than this.
</I>
But should it be given any interpretation at all? Unless there is a real use 
case for it, I think it's better to consider it an error.

Bye,
		Maarten
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20070527/16a6b6d7/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047946.html">[Twisted-Python] Sequential use of asynchronous calls
</A></li>
	<LI>Next message (by thread): <A HREF="047948.html">[Twisted-Python] Sequential use of asynchronous calls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47947">[ date ]</a>
              <a href="thread.html#47947">[ thread ]</a>
              <a href="subject.html#47947">[ subject ]</a>
              <a href="author.html#47947">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
