<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Windows NT Service Problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Windows%20NT%20Service%20Problem&In-Reply-To=522DFE1BD2489441978055A65C9DF437B3675F%40KENSVR04.division.daviswire.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015375.html">
   <LINK REL="Next"  HREF="015377.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Windows NT Service Problem</H1>
    <B>Lucas Taylor</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Windows%20NT%20Service%20Problem&In-Reply-To=522DFE1BD2489441978055A65C9DF437B3675F%40KENSVR04.division.daviswire.com"
       TITLE="[Twisted-Python] Windows NT Service Problem">lucas at lucaserve.com
       </A><BR>
    <I>Fri May 18 01:53:56 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015375.html">[Twisted-Python] Windows NT Service Problem
</A></li>
        <LI>Next message: <A HREF="015377.html">[Twisted-Python] Windows NT Service Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15376">[ date ]</a>
              <a href="thread.html#15376">[ thread ]</a>
              <a href="subject.html#15376">[ subject ]</a>
              <a href="author.html#15376">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Berkstresser, Dan wrote:
&gt;<i> Hello, I am trying to get my twisted project to run as a Windows
</I>&gt;<i> Service.  I have followed the instructions here:
</I>&gt;<i> <A HREF="http://gradstein.info/DeployingTwistedWindows">http://gradstein.info/DeployingTwistedWindows</A>
</I>&gt;<i> as well as here:
</I>&gt;<i> <A HREF="http://svn.twistedmatrix.com/cvs/sandbox/moonfallen/?rev=18080#dirlist">http://svn.twistedmatrix.com/cvs/sandbox/moonfallen/?rev=18080#dirlist</A>
</I>

This isn't really relevant to the references you've mentioned, but there
is a simple way to create Windows services with a minor amount of code
and it's not too onerous. You don't have to use py2exe, although it is
certainly possible to do so once you've got the rest working. I'm not
sure if this is the &quot;best&quot; way, but it has been successful for me in a
couple of projects over the past 2 years.

Below is a very simple example using the QOTD server from the core docs.
It doesn't use tac files, Application objects, or twistd, so it's very
basic. A &quot;real&quot; project will differ, but the basic mechanics of starting
and stopping the service are illustrated in the SvcDoRun() and
CheckForQuit() methods of the WindowsService object. The idea is to have
the reactor check for a Stop event periodically and exit if it is raised.

You should be able to install and remove it thusly:
python qotdservice.py install
python qotdservice.py remove

You can then test it out with the sample Echo client from the core docs.

&quot;&quot;&quot;qotdservice.py
Sample Twisted Windows Service
&quot;&quot;&quot;

# Service Utilities
import win32serviceutil
import win32service
import win32event

# Twisted imports
from twisted.internet.protocol import Protocol, Factory
from twisted.internet import reactor

class QOTD(Protocol):

    def connectionMade(self):
        self.transport.write(&quot;An apple a day keeps the doctor away\r\n&quot;)
        self.transport.loseConnection()


class WindowsService(win32serviceutil.ServiceFramework):
    _svc_name_ = &quot;TwistedWin32Service&quot;
    _svc_display_name_ = &quot;Twisted Win32 Service&quot;

    def __init__(self, args):
        win32serviceutil.ServiceFramework.__init__(self, args)
        self.hWaitStop = win32event.CreateEvent(None, 0, 0, None)

    def SvcStop(self):
        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
        win32event.SetEvent(self.hWaitStop)

    def SvcDoRun(self):
        import servicemanager

        self.CheckForQuit()

        factory = Factory()
        factory.protocol = QOTD

        reactor.listenTCP(8007, factory)
        reactor.run(installSignalHandlers=0)


    def CheckForQuit(self):
        retval = win32event.WaitForSingleObject(self.hWaitStop, 10)
        if not retval == win32event.WAIT_TIMEOUT:
            # Received Quit from Win32
            reactor.stop()

        reactor.callLater(1.0, self.CheckForQuit)

if __name__=='__main__':
    win32serviceutil.HandleCommandLine(WindowsService)





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015375.html">[Twisted-Python] Windows NT Service Problem
</A></li>
	<LI>Next message: <A HREF="015377.html">[Twisted-Python] Windows NT Service Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15376">[ date ]</a>
              <a href="thread.html#15376">[ thread ]</a>
              <a href="subject.html#15376">[ subject ]</a>
              <a href="author.html#15376">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
