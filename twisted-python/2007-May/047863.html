<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A Solution Re: [Stackless] Advice on Debugging	Stackless/Twisted Problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20Solution%20Re%3A%20%5BStackless%5D%20Advice%20on%20Debugging%0A%09Stackless/Twisted%20Problem&In-Reply-To=%3C62138.73968.qm%40web34201.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047862.html">
   <LINK REL="Next"  HREF="047864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A Solution Re: [Stackless] Advice on Debugging	Stackless/Twisted Problem</H1>
    <B>Andrew Francis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20Solution%20Re%3A%20%5BStackless%5D%20Advice%20on%20Debugging%0A%09Stackless/Twisted%20Problem&In-Reply-To=%3C62138.73968.qm%40web34201.mail.mud.yahoo.com%3E"
       TITLE="[Twisted-Python] A Solution Re: [Stackless] Advice on Debugging	Stackless/Twisted Problem">andrewfr_ice at yahoo.com
       </A><BR>
    <I>Fri May 11 11:39:57 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047862.html">[Twisted-Python] Hacking in Bazaar
</A></li>
        <LI>Next message (by thread): <A HREF="047864.html">[Twisted-Python] A Solution Re: [Stackless] Advice on 	Debugging Stackless/Twisted Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47863">[ date ]</a>
              <a href="thread.html#47863">[ thread ]</a>
              <a href="subject.html#47863">[ subject ]</a>
              <a href="author.html#47863">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Colleagues:

Earlier I posted that I was having a problem involving
the loss of deferred calls in a programme that uses
Stackless and Twisted. I found the problem and wrote a
solution. I think it interesting.

It helped when I started using the Twisted logging
facility :-)

The immediate reason the deferred were &quot;lost&quot; was
because the main reactor loop stopped iterating.

What happened was:

1. In the example, Stackless treats Twisted as a
tasklet. 

see:
<A HREF="http://www.stackless.com/pipermail/stackless/2007-April/002448.html">http://www.stackless.com/pipermail/stackless/2007-April/002448.html</A>

2. When the Request Handler is created, it is running
as a *part* of the Twisted tasklet. 

3. Consequently when the Request Handler blocked on a
channel, this blocked the entire reactor! In turn, 
doIteration() (doSelect) cannot do its work. Twisted
grinds to a halt. 

4. When the last tasklet (TestTasklet) blocked, all
the tasklets became blocked. Consequently the
programme ended. 

The solution was two-fold.

1) To prevent the reactor from blocking, I run the
request handler in its own tasklet. This prevents the
reactor from blocking for indeterminate periods of
time.

2) I modified doSelect to call stackless.schedule().
If the reactor does not call stackless.schedule(),
other tasklets will not get an opportunity to run.

(When I have time, I will write a proper reactor. This
should be a little more than overriding the
doIteration() method of selectReactor). Or re-read the
Blocking demo : I don't quite understand how it works)

With this approach, I 

1) Eliminate a OS-Thread (both Stackless and Twisted
folks concur that this is wrong, wrong, wrong).

2) Can execute tasklets in parallel with tasklets that
are blocked waiting for network I/O like an incoming
HTTP request.

I think it is neat that the Twisted framework is
flexible enough to be contorted in this fashion.
Unfortunately this approach is *very* slow. I feel it 
is wastefully that a tasklet is created for every
incoming request. I have to work on this. 

~

I understand the subset of Stackless and Twisted users
is small. And the philosophies are different. And what
I am doing is a bit esoteric and application specific.
Hopefully others will be able to build upon this : I
don't see why programmers can't get the best of the
Stackless and Twisted worlds.

Cheers,
Andrew 








       
____________________________________________________________________________________Yahoo! oneSearch: Finally, mobile search 
that gives answers, not web links. 
<A HREF="http://mobile.yahoo.com/mobileweb/onesearch?refer=1ONXIC">http://mobile.yahoo.com/mobileweb/onesearch?refer=1ONXIC</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Solution.py
Type: text/x-python
Size: 9599 bytes
Desc: 2700386180-Solution.py
URL: &lt;/pipermail/twisted-python/attachments/20070511/7f2c3259/attachment-0002.py&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047862.html">[Twisted-Python] Hacking in Bazaar
</A></li>
	<LI>Next message (by thread): <A HREF="047864.html">[Twisted-Python] A Solution Re: [Stackless] Advice on 	Debugging Stackless/Twisted Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47863">[ date ]</a>
              <a href="thread.html#47863">[ thread ]</a>
              <a href="subject.html#47863">[ subject ]</a>
              <a href="author.html#47863">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
