<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: plus mode was Re: how winnt fileops	workandwhat to do about it
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20plus%20mode%20was%20Re%3A%20how%20winnt%20fileops%0A%09workandwhat%20to%20do%20about%20it&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012290.html">
   <LINK REL="Next"  HREF="012289.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: plus mode was Re: how winnt fileops	workandwhat to do about it</H1>
    <B>Paul G</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20plus%20mode%20was%20Re%3A%20how%20winnt%20fileops%0A%09workandwhat%20to%20do%20about%20it&In-Reply-To="
       TITLE="[Twisted-Python] Re: plus mode was Re: how winnt fileops	workandwhat to do about it">paul-lists at perforge.com
       </A><BR>
    <I>Sat Dec 31 18:50:24 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012290.html">[Twisted-Python] Re: plus mode was Re: how winnt	fileopsworkandwhat to do about it
</A></li>
        <LI>Next message: <A HREF="012289.html">[Twisted-Python] Re: plus mode was Re: how winnt	fileopsworkandwhat to do about it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12287">[ date ]</a>
              <a href="thread.html#12287">[ thread ]</a>
              <a href="subject.html#12287">[ subject ]</a>
              <a href="author.html#12287">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
----- Original Message ----- 
From: &quot;James Y Knight&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">foom at fuhm.net</A>&gt;
To: &quot;Twisted general discussion&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Sent: Saturday, December 31, 2005 6:12 PM
Subject: Re: [Twisted-Python] Re: plus mode was Re: how winnt fileops 
workandwhat to do about it


&gt;<i>
</I>&gt;<i> On Dec 31, 2005, at 4:57 PM, Paul G wrote:
</I>&gt;&gt;<i> oh, it makes perfect sense to have a workaround in twisted, i'm not 
</I>&gt;&gt;<i> suggesting otherwise. however, it should be just that - a temporary 
</I>&gt;&gt;<i> workaround until cpython has a fix for the issue, because (outside  of 
</I>&gt;&gt;<i> the offending libc implementation), that is the right place to  fix it.
</I>&gt;<i>
</I>&gt;<i> As I wrote in the bug report:
</I>&gt;&gt;<i> It's not a python bug except perhaps that python should raise an 
</I>&gt;&gt;<i> exception.
</I>&gt;&gt;<i> Doing a read and write without a seek in between is illegal in C.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;ANSI C requires that a file positioning function intervene between 
</I>&gt;&gt;<i> output and
</I>&gt;&gt;<i> input, unless an input operation encounters end-of-file.&quot;
</I>
you stop quoting right at the relevant part (ie, where the difference 
between eg glibc and msvcrt comes in):

&quot;(If this condition is not met, then a read is allowed to  return
       the result of writes other than the most recent.)&quot;

does msvcrt do this? no. moreover, msvcrt needs an *fsetpos()*/fseek() and 
an *fflush()* (as per cory), whereas glibc will take fseek() or *fgetpos()*. 
this means that calls resulting in synchronization in glibc and msvcrt are 
different, with glibc sticking to ansi c and msvcrt deviating.

there is an obvious deviation both from ansi c and from glibc usage.

moreover, none of this seems to be necessary with glibc in practice (and 
cpython seems to not be doing it or suggesting it in the docs), since this 
test doesn't fail on linux. different results given the same input is a bug, 
imo.

let us step back for a second: the problem rears its head in a file object 
&quot;being returned from the open() method of a FilePath
object&quot;. the user has no way to know that he should be syncing the stream, 
primarily because he's being given a 'File', not a 'File stream'. either 
these issues should be listed in the docs, or taken care of underneath, 
keeping a File a black box. from a design point of view, the stream is an 
implementation detail - exposing it is ugly.

a matter of how you view it though.

-p 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012290.html">[Twisted-Python] Re: plus mode was Re: how winnt	fileopsworkandwhat to do about it
</A></li>
	<LI>Next message: <A HREF="012289.html">[Twisted-Python] Re: plus mode was Re: how winnt	fileopsworkandwhat to do about it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12287">[ date ]</a>
              <a href="thread.html#12287">[ thread ]</a>
              <a href="subject.html#12287">[ subject ]</a>
              <a href="author.html#12287">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
