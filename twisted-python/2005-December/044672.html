<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Some beginner questions	about	&quot;twisted.names.client&quot; and &quot;.tac&quot; environment
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Some%20beginner%20questions%0A%09about%09%22twisted.names.client%22%20and%20%22.tac%22%20environment&In-Reply-To=%3C43A4A7CC.7060505%40argo.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044671.html">
   <LINK REL="Next"  HREF="044673.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Some beginner questions	about	&quot;twisted.names.client&quot; and &quot;.tac&quot; environment</H1>
    <B>Jesus Cea</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Some%20beginner%20questions%0A%09about%09%22twisted.names.client%22%20and%20%22.tac%22%20environment&In-Reply-To=%3C43A4A7CC.7060505%40argo.es%3E"
       TITLE="[Twisted-Python] Some beginner questions	about	&quot;twisted.names.client&quot; and &quot;.tac&quot; environment">jcea at argo.es
       </A><BR>
    <I>Sat Dec 17 17:05:32 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044671.html">[Twisted-Python] Some beginner questions about	&quot;twisted.names.client&quot; and &quot;.tac&quot; environment
</A></li>
        <LI>Next message (by thread): <A HREF="044673.html">[Twisted-Python] Some beginner questions	about	&quot;twisted.names.client&quot; and &quot;.tac&quot; environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44672">[ date ]</a>
              <a href="thread.html#44672">[ thread ]</a>
              <a href="subject.html#44672">[ subject ]</a>
              <a href="author.html#44672">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Jean-Paul Calderone wrote:
&gt;<i> You probably want to move most of your program out if &quot;dns.tac&quot; and into
</I>&gt;<i> an importable Python module.  Code defined inside .tac files lives in a
</I>&gt;<i> weird world where some surprising rules apply.
</I>
Any documentation about that?

&gt;<i> It's best to keep the
</I>&gt;<i> .tac file as short as possible.  Generally, you just want to create an
</I>&gt;<i> Application and give it some children, importing from modules the
</I>&gt;<i> definitions of all classes and functions needed to set this up.
</I>
I reduced the &quot;dns3.tac&quot; to:

=====

from twisted.application import service

application = service.Application(&quot;DNS test&quot;)

import sys
sys.path=[&quot;.&quot;]+sys.path
import dns3

=====

All logic is in &quot;dns3.tac&quot;. Basically the same code posted in my
previous message.

I have the very same problem with &quot;reactor.stop()&quot;: repeated exceptions,
only stoppable using &quot;kill -9&quot;.

I don't get the &quot;give it some children&quot; point. Could you post some
sample code?.

&gt;<i> Passing (60,) as the timeout might not be the best idea.  This will
</I>&gt;<i> cause the DNS client to send one request and then wait 60 seconds for a
</I>&gt;<i> response.  If either the request or the response is dropped (as often
</I>&gt;<i> happens with UDP traffic), you will never get a result, and you will
</I>&gt;<i> have to wait 60 seconds to discover this fact.
</I>
I'm resolving several thousand of domains, so one minute more or less is
not an issue. I don't want to retransmit since I'm using 127.0.0.1, so
losing request (in the same machine) should be rare (udp backlog
overflow, basically).

Some domains takes a long time to resolve. So if I use an small value I
load the server and get &quot;Unexpected message (XXXXX) received from
('127.0.0.1', 53)&quot;, caused because the DNS server gets a late answers
and my code already give up.

&gt;<i> If you don't want retransmission, a value of (15,) or so is probably
</I>&gt;<i> better.
</I>
Then I get a lot of &quot;unexpected DNS responses&quot;. Seems a fair number of
domains takes more than 15 seconds to fulfill the request :-p.

In any case this number is not really important. I'm more concerned
about the Twisted specific issues :p

&gt;<i> You can just use dns.MX here, instead of looking up &quot;MX&quot; in QUERY_TYPES.
</I>
Good point. Changes done.

&gt;<i> To customize the server used by the resolver, you may want to create
</I>&gt;<i> your own resolver instance, rather than relying on the defaults guessed
</I>&gt;<i> by the resolver automatically created in the client module.
</I>
Also a good point. Done and working fine.

How can I easily use the cache resolver?. My problem is updating the
cache when I get a response thru the network. In a long running daemon,
caching DNS when I'm serving several hundreds of email for day woul dbe
a big win.

Maybe with my own overloaded cache class, but seems an obvious addition
to standard twisted.names. :-? Maybe next release :-)

&gt;<i> Hmm.  The non-existence of the domain is hidden by the very last step in
</I>&gt;<i> performing the lookup.  The Resolver class has a method, filterAnswers,
</I>&gt;<i> which is used to turn a DNS response into the three-tuple of lists which
</I>&gt;<i> all the lookup* methods return.  You may want to subclass Resolver and
</I>&gt;<i> override filterAnswers to behave differently when the `message' argument
</I>&gt;<i> it is given has an `rCode' attribute equal to twisted.names.dns.ENAME,
</I>&gt;<i> which indicates the name requested does not exist.
</I>
That seems doable but an ugly hack :-). Perhaps a future &quot;twisted.named&quot;
release could include a flag to easily differenciate between missing RR
and nonexistent domain. Any hope?.

&gt;&gt;<i> 3. How can I stop this &quot;.tac&quot;?. If I do &quot;reactor.stop()&quot;, I get an
</I>&gt;&gt;<i> infinite error, repeated forever:
</I>&gt;<i> 
</I>&gt;<i> reactor.stop() is the correct way to end the program.  If you still have
</I>&gt;<i> this problem after you have split the program into multiple files,
</I>&gt;<i> please post again.
</I>
Program splitted. Same problem :-/

The dode is basically the same that in my previous email. Moved 99% of
code to &quot;dns3.py&quot;. The dns3.tac&quot; is trivial:

=====

from twisted.application import service

application = service.Application(&quot;DNS test&quot;)

import sys
sys.path=[&quot;.&quot;]+sys.path
import dns3

=====

Help appreciated. Thanks for you time and efford.

- --
Jesus Cea Avion                         _/_/      _/_/_/        _/_/_/
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jcea at argo.es</A> <A HREF="http://www.argo.es/~jcea/">http://www.argo.es/~jcea/</A> _/_/    _/_/  _/_/    _/_/  _/_/
                                      _/_/    _/_/          _/_/_/_/_/
PGP Key Available at KeyServ   _/_/  _/_/    _/_/          _/_/  _/_/
&quot;Things are not so easy&quot;      _/_/  _/_/    _/_/  _/_/    _/_/  _/_/
&quot;My name is Dump, Core Dump&quot;   _/_/_/        _/_/_/      _/_/  _/_/
&quot;El amor es poner tu felicidad en la felicidad de otro&quot; - Leibniz
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.2 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org">http://enigmail.mozdev.org</A>

iQCVAwUBQ6SnzJlgi5GaxT1NAQLFgwP/U01pixJpJ39iwA8jZHOgfBJCOoOzI+h2
uhWh3bWHcecXddhutTCCwJb9rw1VFLBwTCyzoSXx2Qn6c1qLgKkSIt/My9RDD0js
BPhJ2AV+8zQyc7ySAdYM3pTy4HNjw5JviDsymHs3KWw3AMDR/JhN46bXBgqARZtM
IIe1xBs/HZc=
=rXOt
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044671.html">[Twisted-Python] Some beginner questions about	&quot;twisted.names.client&quot; and &quot;.tac&quot; environment
</A></li>
	<LI>Next message (by thread): <A HREF="044673.html">[Twisted-Python] Some beginner questions	about	&quot;twisted.names.client&quot; and &quot;.tac&quot; environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44672">[ date ]</a>
              <a href="thread.html#44672">[ thread ]</a>
              <a href="subject.html#44672">[ subject ]</a>
              <a href="author.html#44672">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
