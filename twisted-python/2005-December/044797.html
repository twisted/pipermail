<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: plus mode was Re: how winnt	fileopsworkandwhat to do about it
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20plus%20mode%20was%20Re%3A%20how%20winnt%0A%09fileopsworkandwhat%20to%20do%20about%20it&In-Reply-To=%3C0c1d01c60e66%24705b6a10%246402a8c0%40dcore%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044795.html">
   <LINK REL="Next"  HREF="044785.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: plus mode was Re: how winnt	fileopsworkandwhat to do about it</H1>
    <B>Paul G</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20plus%20mode%20was%20Re%3A%20how%20winnt%0A%09fileopsworkandwhat%20to%20do%20about%20it&In-Reply-To=%3C0c1d01c60e66%24705b6a10%246402a8c0%40dcore%3E"
       TITLE="[Twisted-Python] Re: plus mode was Re: how winnt	fileopsworkandwhat to do about it">paul-lists at perforge.com
       </A><BR>
    <I>Sat Dec 31 17:00:55 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044795.html">[Twisted-Python] Re: plus mode was Re: how winnt fileops	workandwhat to do about it
</A></li>
        <LI>Next message (by thread): <A HREF="044785.html">[Twisted-Python] Re: plus mode was Re: how winnt fileops work and what to do about it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44797">[ date ]</a>
              <a href="thread.html#44797">[ thread ]</a>
              <a href="subject.html#44797">[ subject ]</a>
              <a href="author.html#44797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
----- Original Message ----- 
From: &quot;Paul G&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">paul-lists at perforge.com</A>&gt;
To: &quot;Twisted general discussion&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Sent: Saturday, December 31, 2005 6:50 PM
Subject: Re: [Twisted-Python] Re: plus mode was Re: how winnt 
fileopsworkandwhat to do about it


&gt;<i>
</I>&gt;<i> ----- Original Message ----- 
</I>&gt;<i> From: &quot;James Y Knight&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">foom at fuhm.net</A>&gt;
</I>&gt;<i> To: &quot;Twisted general discussion&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
</I>&gt;<i> Sent: Saturday, December 31, 2005 6:12 PM
</I>&gt;<i> Subject: Re: [Twisted-Python] Re: plus mode was Re: how winnt fileops 
</I>&gt;<i> workandwhat to do about it
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Dec 31, 2005, at 4:57 PM, Paul G wrote:
</I>&gt;&gt;&gt;<i> oh, it makes perfect sense to have a workaround in twisted, i'm not 
</I>&gt;&gt;&gt;<i> suggesting otherwise. however, it should be just that - a temporary 
</I>&gt;&gt;&gt;<i> workaround until cpython has a fix for the issue, because (outside  of 
</I>&gt;&gt;&gt;<i> the offending libc implementation), that is the right place to  fix it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As I wrote in the bug report:
</I>&gt;&gt;&gt;<i> It's not a python bug except perhaps that python should raise an 
</I>&gt;&gt;&gt;<i> exception.
</I>&gt;&gt;&gt;<i> Doing a read and write without a seek in between is illegal in C.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &quot;ANSI C requires that a file positioning function intervene between 
</I>&gt;&gt;&gt;<i> output and
</I>&gt;&gt;&gt;<i> input, unless an input operation encounters end-of-file.&quot;
</I>&gt;<i>
</I>&gt;<i> you stop quoting right at the relevant part (ie, where the difference 
</I>&gt;<i> between eg glibc and msvcrt comes in):
</I>&gt;<i>
</I>&gt;<i> &quot;(If this condition is not met, then a read is allowed to  return
</I>&gt;<i>       the result of writes other than the most recent.)&quot;
</I>&gt;<i>
</I>&gt;<i> does msvcrt do this? no. moreover, msvcrt needs an *fsetpos()*/fseek() and 
</I>&gt;<i> an *fflush()* (as per cory), whereas glibc will take fseek() or 
</I>&gt;<i> *fgetpos()*. this means that calls resulting in synchronization in glibc 
</I>&gt;<i> and msvcrt are different, with glibc sticking to ansi c and msvcrt 
</I>&gt;<i> deviating.
</I>&gt;<i>
</I>&gt;<i> there is an obvious deviation both from ansi c and from glibc usage.
</I>&gt;<i>
</I>&gt;<i> moreover, none of this seems to be necessary with glibc in practice (and 
</I>&gt;<i> cpython seems to not be doing it or suggesting it in the docs), since this 
</I>&gt;<i> test doesn't fail on linux. different results given the same input is a 
</I>&gt;<i> bug, imo.
</I>&gt;<i>
</I>&gt;<i> let us step back for a second: the problem rears its head in a file object 
</I>&gt;<i> &quot;being returned from the open() method of a FilePath
</I>&gt;<i> object&quot;. the user has no way to know that he should be syncing the stream, 
</I>&gt;<i> primarily because he's being given a 'File', not a 'File stream'. either 
</I>&gt;<i> these issues should be listed in the docs, or taken care of underneath, 
</I>&gt;<i> keeping a File a black box. from a design point of view, the stream is an 
</I>&gt;<i> implementation detail - exposing it is ugly.
</I>&gt;<i>
</I>&gt;<i> a matter of how you view it though.
</I>
talking to myself: no it isn't. here's the msdn article:

<A HREF="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vclib/html/_crt_fopen.2c_._wfopen.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vclib/html/_crt_fopen.2c_._wfopen.asp</A>

see the difference to the excerpt you quoted from fopen(2)? yep, no 'you 
dont have to sync if input op hits eof' exception. this is what's causing 
the breakage with msvcrt but not glibc, i bet. still think it's not a bug/is 
a bug in the test?

i'll go sleep now, so if i've missed the boat again, i won't be here to 
witness the smackdown &lt;g&gt;.

-p 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044795.html">[Twisted-Python] Re: plus mode was Re: how winnt fileops	workandwhat to do about it
</A></li>
	<LI>Next message (by thread): <A HREF="044785.html">[Twisted-Python] Re: plus mode was Re: how winnt fileops work and what to do about it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44797">[ date ]</a>
              <a href="thread.html#44797">[ thread ]</a>
              <a href="subject.html#44797">[ subject ]</a>
              <a href="author.html#44797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
