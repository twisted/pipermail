<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] WSGI Thread-management strategy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20WSGI%20Thread-management%20strategy&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012157.html">
   <LINK REL="Next"  HREF="012159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] WSGI Thread-management strategy</H1>
    <B>Jim Fulton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20WSGI%20Thread-management%20strategy&In-Reply-To="
       TITLE="[Twisted-Python] WSGI Thread-management strategy">jim at zope.com
       </A><BR>
    <I>Thu Dec 15 16:22:21 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012157.html">[Twisted-Python] how to run a twisted daemon without tcpserver
</A></li>
        <LI>Next message: <A HREF="012159.html">[Twisted-Python] WSGI Thread-management strategy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12158">[ date ]</a>
              <a href="thread.html#12158">[ thread ]</a>
              <a href="subject.html#12158">[ subject ]</a>
              <a href="author.html#12158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The strategy used by twisted WSGI, as I understand it, doesn't meet
our needs. Currently, a thread is created for each request.  The total
number of threads is throttled, I gather using a general Twisted
thread limit.  WSGI applications are called as soon as input headers
have been received completely. An application may be called before all
body input is received.  We need application calls to be delayed until
all request input has been received,

In an application like Zope, application threads are expensive.  There
are application resources, such as database connections and caches
needed by the application threads.  To limit resource consumption, we
have to limit the number of application threads.  Because the number
of threads is limited, application threads are scarce and thus
valuable resources that need to be used very efficiently.  In
particular, we don't want to tie up an application thread waiting for
request body input.

I propose that the default thread-management strategy should be to delay
calling an application until all request input has been received. If
this isn't the default, then there should at least be an option to get
this behavior.  (Of course, the buffering strategy needs to be clever
enough to switch to a file when the input gets over some size.)

Thoughts?

Jim

-- 
Jim Fulton           mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jim at zope.com</A>       Python Powered!
CTO                  (540) 361-1714            <A HREF="http://www.python.org">http://www.python.org</A>
Zope Corporation     <A HREF="http://www.zope.com">http://www.zope.com</A>       <A HREF="http://www.zope.org">http://www.zope.org</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012157.html">[Twisted-Python] how to run a twisted daemon without tcpserver
</A></li>
	<LI>Next message: <A HREF="012159.html">[Twisted-Python] WSGI Thread-management strategy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12158">[ date ]</a>
              <a href="thread.html#12158">[ thread ]</a>
              <a href="subject.html#12158">[ subject ]</a>
              <a href="author.html#12158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
