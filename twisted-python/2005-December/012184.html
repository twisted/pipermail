<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Allowing a type to be transmitted by jelly?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Allowing%20a%20type%20to%20be%20transmitted%20by%20jelly%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012183.html">
   <LINK REL="Next"  HREF="012186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Allowing a type to be transmitted by jelly?</H1>
    <B>Mike C. Fletcher</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Allowing%20a%20type%20to%20be%20transmitted%20by%20jelly%3F&In-Reply-To="
       TITLE="[Twisted-Python] Allowing a type to be transmitted by jelly?">mcfletch at rogers.com
       </A><BR>
    <I>Tue Dec 20 22:58:49 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012183.html">[Twisted-Python] I'm missing something on SSL-encrypted	PB	connections...
</A></li>
        <LI>Next message: <A HREF="012186.html">[Twisted-Python] Allowing a type to be transmitted by jelly?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12184">[ date ]</a>
              <a href="thread.html#12184">[ thread ]</a>
              <a href="subject.html#12184">[ subject ]</a>
              <a href="author.html#12184">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is one of those problems where I've got a solution, but it *seems* 
like it should be something that can be done that's a little less 
drastic.  Here's the problem:

    Want to expose a simple data-type (in this case a sub-class of
    tuple, the PySNMP OID object) to allow for transmission across pb
    queries and returns.

Now, I've tried quite a number of iterations on this, from:

    jelly.globalSecurity.allowInstancesOf(
        oid.OID,
    )

through using classes like this:

    class PBTypeAllowingServerFactory( pb.PBServerFactory ):
        &quot;&quot;&quot;Allow various types to be transported&quot;&quot;&quot;
        def buildProtocol(self, addr):
            &quot;&quot;&quot;Return a Broker attached to me (as the service provider).
            &quot;&quot;&quot;
            broker = pb.PBServerFactory.buildProtocol( self, addr )
            broker.security.allowInstancesOf(
                oid.OID,
            )
            return broker

    class PBTypeAllowingClientFactory( pb.PBClientFactory ):
        def clientConnectionMade(self, broker):
            &quot;&quot;&quot;Expand the types allowed to be communicated&quot;&quot;&quot;
            broker.security.allowInstancesOf(
                oid.OID,
            )
            return pb.PBClientFactory.clientConnectionMade( self, broker )

but whenever I try using jelly for the encoding it complains that:

    Traceback (most recent call last):
      File &quot;/home/mcfletch/pylive/Twisted/twisted/internet/defer.py&quot;,
    line 190, in addCallbacks
        self._runCallbacks()
      File &quot;/home/mcfletch/pylive/Twisted/twisted/internet/defer.py&quot;,
    line 358, in _runCallbacks
        self.result = callback(self.result, *args, **kw)
      File
    &quot;/home/mcfletch/pylive/cinemon/cinespread/metaperspective.py&quot;, line
    216, in callWhenFree
        return perspective.callRemote( *args, **named ).addErrback(
      File &quot;/home/mcfletch/pylive/Twisted/twisted/spread/pb.py&quot;, line
    382, in callRemote
        _name, args, kw)
    --- &lt;exception caught here&gt; ---
      File &quot;/home/mcfletch/pylive/Twisted/twisted/spread/pb.py&quot;, line
    857, in _sendMessage
        netArgs = self.serialize(args, perspective=perspective,
    method=message)
      File &quot;/home/mcfletch/pylive/Twisted/twisted/spread/pb.py&quot;, line
    811, in serialize
        return jelly(object, self.security, None, self)
      File &quot;/home/mcfletch/pylive/Twisted/twisted/spread/jelly.py&quot;, line
    896, in jelly
        return _Jellier(taster, persistentStore, invoker).jelly(object)
      File &quot;/home/mcfletch/pylive/Twisted/twisted/spread/jelly.py&quot;, line
    480, in jelly
        sxp.append(self.jelly(item))
      File &quot;/home/mcfletch/pylive/Twisted/twisted/spread/jelly.py&quot;, line
    476, in jelly
        sxp.append(self.jelly(item))
      File &quot;/home/mcfletch/pylive/Twisted/twisted/spread/jelly.py&quot;, line
    511, in jelly
        raise InsecureJelly(&quot;Type not allowed for object: %s %s&quot; %
    twisted.spread.jelly.InsecureJelly: Type not allowed for object:
    &lt;class 'cinemon.snmp.oidobject.OID'&gt; .1.3.6.1.2.1.1.4.0

to hack around it I've built my own generic (security restricted) 
pickle-like system, and freeze the parameters and return values before 
passing them across pb... which just seems *so* wrong.  My system is 
almost as large as jelly, and is just entirely redundant code other than 
its allowing me to add new classes to the set allowed.

Anyway, I'm sure I'm once again missing something blindingly obvious, 
but given that I missed the logical equivalent of turning on the power 
switch earlier I thought I'd ask if someone had a recipe for this type 
of operation.  BTW, this seems like something that should be covered in 
the tutorial for pb, as it would seem like a common need to add a 
low-level object-type or two to the set allowed.

Freezer-isn't-so-wonderful-I-want-to-use-it-pointlessly y'rs,
Mike

-- 
________________________________________________
  Mike C. Fletcher
  Designer, VR Plumber, Coder
  <A HREF="http://www.vrplumber.com">http://www.vrplumber.com</A>
  <A HREF="http://blog.vrplumber.com">http://blog.vrplumber.com</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012183.html">[Twisted-Python] I'm missing something on SSL-encrypted	PB	connections...
</A></li>
	<LI>Next message: <A HREF="012186.html">[Twisted-Python] Allowing a type to be transmitted by jelly?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12184">[ date ]</a>
              <a href="thread.html#12184">[ thread ]</a>
              <a href="subject.html#12184">[ subject ]</a>
              <a href="author.html#12184">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
