<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted Words: throttling server output
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Words%3A%20throttling%20server%20output&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012141.html">
   <LINK REL="Next"  HREF="012114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted Words: throttling server output</H1>
    <B>Seventh Holy Scripture</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20Words%3A%20throttling%20server%20output&In-Reply-To="
       TITLE="[Twisted-Python] Twisted Words: throttling server output">7hs at muchan.org
       </A><BR>
    <I>Sat Dec  3 13:38:14 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012141.html">[Twisted-Python] pb references
</A></li>
        <LI>Next message: <A HREF="012114.html">[Twisted-Python] Twisted Words: throttling server output
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12113">[ date ]</a>
              <a href="thread.html#12113">[ thread ]</a>
              <a href="subject.html#12113">[ subject ]</a>
              <a href="author.html#12113">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been writing an IRC bot using Twisted Words, and am having  
difficulty keeping it from flooding itself off the server. Currently  
my output subroutines look like this:

     def queueMsg(self, channel, msg):
         self.chanQueue.append(channel)
         self.msgQueue.append(msg)

     def emptyMsgQueue(self):
         for msg in self.msgQueue:
             channel = self.chanQueue.pop(0)
             self.msg(channel, msg)
             if channel[0] == &quot;#&quot;:
                 self.logger.log(&quot;&lt;%s&gt; %s&quot; % (self.nickname, msg))
             time.sleep(0.5)
         self.msgQueue = []

This ought to work as far as I know... but the bot waits until after  
all the sleep statements have executed to spew the output to the IRC  
server, which (if there's a lot of it) results in a forced disconnect  
due to &quot;Excess Flood&quot;. What am I doing wrong here? My guess is that  
twisted has its own message queue, and waits until after all host  
program subroutines have ended to process it... I'm not good at  
python, though, so it could be a stupid mistake on my part.

In any case, is there another way to introduce a delay between the  
messages sent to server that will work?


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012141.html">[Twisted-Python] pb references
</A></li>
	<LI>Next message: <A HREF="012114.html">[Twisted-Python] Twisted Words: throttling server output
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12113">[ date ]</a>
              <a href="thread.html#12113">[ thread ]</a>
              <a href="subject.html#12113">[ subject ]</a>
              <a href="author.html#12113">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
