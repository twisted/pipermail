<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20performance&In-Reply-To=%3CE1EjwA3-00085E-00%40pyramid.twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044755.html">
   <LINK REL="Next"  HREF="044639.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted performance</H1>
    <B>Alec Matusis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20performance&In-Reply-To=%3CE1EjwA3-00085E-00%40pyramid.twistedmatrix.com%3E"
       TITLE="[Twisted-Python] twisted performance">matusis at matusis.com
       </A><BR>
    <I>Wed Dec  7 03:04:26 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044755.html">[Twisted-Python] Weekly Bug Summary
</A></li>
        <LI>Next message (by thread): <A HREF="044639.html">[Twisted-Python] twisted performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44637">[ date ]</a>
              <a href="thread.html#44637">[ thread ]</a>
              <a href="subject.html#44637">[ subject ]</a>
              <a href="author.html#44637">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am running Twisted 1.3 server with a fairly large number of clients.
The hardware is two 64 bit 3.0 GHz Xeons with HT, 4GB RAM, and it's on
2.6.11 kernel.
I am using poll reactor.
Currently, when the number of clients approaches 5000, the &quot;top&quot; shows 99%
CPU load for twistd process, the event loop slows down and weird racing
conditions show up. 
 
My clients basically do nothing: they connect and just sit there, sending
application-level keep-alives (null character string) to the server every 90
sec, which are echoed back. The connections/ disconnections for clients are
rare- about 4-5 per sec. So I am mostly dealing with 5000 clients in the
ESTABLISHED state. Very rarely (5x per second on average) one of the clients
gets a message from the server, but I am sure that this is not what keeps
the load so high (I slowed down message rates, and the CPU load did not
change).  
 
What are your thoughts on this performance? Is this load mainly due to
poll() overhead, polling a large number of file descriptors? 
I would love to try an epoll reactor, but as I understand, it's not yet
available?
 
Additionally, the process leaks about 100MB memory per day. I made the
garbage collector print out the number of objects traced by it every 30 min,
and this number stays more or less constant. When the memory held by the
process becomes larger, the event loop further slows down, and the
performance with the same number of clients degrades, as the memory
footprint increases. 
 
Thanks for any advice.
 
Alec.
 


 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20051207/3b5880f5/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044755.html">[Twisted-Python] Weekly Bug Summary
</A></li>
	<LI>Next message (by thread): <A HREF="044639.html">[Twisted-Python] twisted performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44637">[ date ]</a>
              <a href="thread.html#44637">[ thread ]</a>
              <a href="subject.html#44637">[ subject ]</a>
              <a href="author.html#44637">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
