<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: r15451 - Fix test failures under windows	by changing the eventual-send operation to
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20r15451%20-%20Fix%20test%20failures%20under%20windows%0A%09by%20changing%20the%20eventual-send%20operation%20to&In-Reply-To=%3C20051231.140427.07612418.warner%40lothar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044777.html">
   <LINK REL="Next"  HREF="044772.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: r15451 - Fix test failures under windows	by changing the eventual-send operation to</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20r15451%20-%20Fix%20test%20failures%20under%20windows%0A%09by%20changing%20the%20eventual-send%20operation%20to&In-Reply-To=%3C20051231.140427.07612418.warner%40lothar.com%3E"
       TITLE="[Twisted-Python] Re: r15451 - Fix test failures under windows	by changing the eventual-send operation to">warner at lothar.com
       </A><BR>
    <I>Sat Dec 31 15:04:27 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044777.html">[Twisted-Python] Re: r15451 - Fix test failures under windows by	changing the eventual-send operation to
</A></li>
        <LI>Next message (by thread): <A HREF="044772.html">[Twisted-Python] Re: Twisted-Python Digest, Vol 21, Issue 39
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44783">[ date ]</a>
              <a href="thread.html#44783">[ thread ]</a>
              <a href="subject.html#44783">[ subject ]</a>
              <a href="author.html#44783">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> I think that your eventual-send queue should probably be its own
</I>&gt;<i> event-queuing API. If you have:
</I>&gt;<i>
</I>&gt;<i>  callLater(0, foo); callLater(0, bar)
</I>&gt;<i>
</I>&gt;<i> and you expect ordering between them, something like this is better:
</I>&gt;<i>
</I>&gt;<i>  callLater(0, lambda : foo(); bar())
</I>&gt;<i> or perhaps
</I>&gt;<i>  myRunQueue.put(foo); myRunQueue.put(bar); callLater(0, myRunQueue.activate)
</I>&gt;<i>
</I>&gt;<i> You get the idea.
</I>
The issue here is with multiple eventual-sends being called from other code.
Specifically, the context was an ITransport-providing Loopback class, used in
newpb unit tests, which needs to decouple transport.write() from the
resulting proto.dataReceived(). The write() calls are being made from all
over the place, with no good location to coordinate or batch them together.
Technically I could rig it so that transport.write() queues the data and then
oblige the writing Protocol to invoke transport.flush() (newpb has a place
for this to go, to support more datagram-oriented transports someday), but
then who's to say that whatever code invokes *that* won't want to run
multiple times in a brief period of time?

I heartily agree that callLater() is not the appropriate tool for this
purpose. A week ago I thought it might be, but at that point I didn't realize
that I need the ordering guarantee described above. The implementation of
callFromThread() happens to match both my needs and my expectations about
efficiency, but of course it isn't documented to provide either, plus this
eventual-send functionality should be completely unrelated to threads.

 -Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044777.html">[Twisted-Python] Re: r15451 - Fix test failures under windows by	changing the eventual-send operation to
</A></li>
	<LI>Next message (by thread): <A HREF="044772.html">[Twisted-Python] Re: Twisted-Python Digest, Vol 21, Issue 39
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44783">[ date ]</a>
              <a href="thread.html#44783">[ thread ]</a>
              <a href="subject.html#44783">[ subject ]</a>
              <a href="author.html#44783">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
