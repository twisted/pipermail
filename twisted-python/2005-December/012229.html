<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] help with refcounts and memleaks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20help%20with%20refcounts%20and%20memleaks&In-Reply-To=ADFEA6CA-5E1D-4511-9E7D-C501AB286BC9%40redivi.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012227.html">
   <LINK REL="Next"  HREF="012228.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] help with refcounts and memleaks</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20help%20with%20refcounts%20and%20memleaks&In-Reply-To=ADFEA6CA-5E1D-4511-9E7D-C501AB286BC9%40redivi.com"
       TITLE="[Twisted-Python] help with refcounts and memleaks">andrea at cpushare.com
       </A><BR>
    <I>Mon Dec 26 21:37:06 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012227.html">[Twisted-Python] help with refcounts and memleaks
</A></li>
        <LI>Next message: <A HREF="012228.html">[Twisted-Python] help with refcounts and memleaks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12229">[ date ]</a>
              <a href="thread.html#12229">[ thread ]</a>
              <a href="subject.html#12229">[ subject ]</a>
              <a href="author.html#12229">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Dec 26, 2005 at 08:22:24PM -0500, Bob Ippolito wrote:
&gt;<i> Take a look at:
</I>&gt;<i> <A HREF="http://docs.python.org/lib/module-gc.html">http://docs.python.org/lib/module-gc.html</A>
</I>&gt;<i> 
</I>&gt;<i> You can adjust the threshold for each GC generation to suit your  
</I>&gt;<i> application better.
</I>
gc.set_threshold(1, 1, 1) fixed it too, any other setting didn't
(sometime it increases to 100m). If (1,1,1) is as good as it can get,
I'll keep doing the gc.collect() during the factory restart since the
50m allocation only happens after the connectionMade callback and never
again in the context of any given protocol. So the gc.collect() seems
the optimal fix to me for now.

I wish the size of the task would be taken into account any way in the
threshold tunables. I'd like to say &quot;gc.set_mem_threshold({30*1024*1024
:<i> (10, 10, 10), 50*1024*1024 : (1, 1, 1),})&quot;, which mean it's a dynamic
</I>threshold. It should be possible to implement this in O(1), the
interpreter should easily track how much anonymous memory it has
allocated with malloc at any given time. The more anonymous memory, the
less generations it should wait. It could be a linear function too.
However for now I'm happy with the gc.collect().

Thanks a lot for all help.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012227.html">[Twisted-Python] help with refcounts and memleaks
</A></li>
	<LI>Next message: <A HREF="012228.html">[Twisted-Python] help with refcounts and memleaks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12229">[ date ]</a>
              <a href="thread.html#12229">[ thread ]</a>
              <a href="subject.html#12229">[ subject ]</a>
              <a href="author.html#12229">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
