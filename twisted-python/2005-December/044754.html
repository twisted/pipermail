<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Allowing a type to be transmitted by jelly?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Allowing%20a%20type%20to%20be%20transmitted%20by%20jelly%3F&In-Reply-To=%3C20051227.103828.79929151.warner%40lothar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044704.html">
   <LINK REL="Next"  HREF="044697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Allowing a type to be transmitted by jelly?</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Allowing%20a%20type%20to%20be%20transmitted%20by%20jelly%3F&In-Reply-To=%3C20051227.103828.79929151.warner%40lothar.com%3E"
       TITLE="[Twisted-Python] Allowing a type to be transmitted by jelly?">warner at lothar.com
       </A><BR>
    <I>Tue Dec 27 11:38:28 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044704.html">[Twisted-Python] Allowing a type to be transmitted by jelly?
</A></li>
        <LI>Next message (by thread): <A HREF="044697.html">[Twisted-Python] Re: [Twisted-commits] r15355 - Add	twisted.python.pymodules.datetime and use it if &quot;import datetime&quot;	fails.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44754">[ date ]</a>
              <a href="thread.html#44754">[ thread ]</a>
              <a href="subject.html#44754">[ subject ]</a>
              <a href="author.html#44754">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i>I am pretty sure newpb, which Brian Warner was threatening to merge any
</I>&gt;&gt;<i>day now, will support this much better than PB does.
</I>
Yup.

In oldpb, object graphs are serialized through recursive calls to Jelly,
which has a big switch statement (in twisted.spread.jelly._Jellier.jelly)
that uses a different one-object serializer for each type. To teach oldpb how
to handle a new type, you have to modify this function, and the corresponding
unjellier, and then arrange for your Broker to use the new _Jellier classes
instead of the normal ones. Subclassing pb.Copyable does away with this, but
as you've noticed it is both slightly inefficent (particularly if you're
using __slots__ anyway) and requires extensive surgery or pre-marshalling to
use with third-party code that doesn't happen to inherit from pb.Copyable.

In newpb, object graphs are serialized through iterative calls to a
collection of Slicers. Each time a new object needs to be serialized, the
enclosing Slicers help decide (based upon both the type of the object and any
adapters that have been registered for it) which new Slicer to use. To teach
newpb how to serialize a new type, you register an adapter for it (e.g.
registerAdapter(BooleanSlicer, bool, ISlicer)). To teach newpb how to
unserialize the resulting stream, you define an Unslicer class (there is some
metaclass magic which auto-registers the Unslicer for you.. I'm still going
back and forth on the best way to do this).

The advantage of the adapter/registration scheme is that you don't have to
modify the inheritance set of the classes you want to serialize, so
third-party code is easy to accomodate without surgery or pre-marshalling.
Pre-marshalling is a serious nuisance, because to do it correctly means
looking inside every possible container for further instances of the type
that needs to be converted into something jelly can handle, which is just as
much work as the final serialization itself.

Take a look at branches/newpb-again, in the doc/pb directory, for some
examples and descriptions of how to use newpb. The code itself is in the
twisted/pb directory (unless we come up with a different name for it). It's
still in development: it was in the trunk for a few hours last week, but
hopefully I'll get the remaining test failures resolved and it will go back
into the trunk some time this week.

cheers,
 -Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044704.html">[Twisted-Python] Allowing a type to be transmitted by jelly?
</A></li>
	<LI>Next message (by thread): <A HREF="044697.html">[Twisted-Python] Re: [Twisted-commits] r15355 - Add	twisted.python.pymodules.datetime and use it if &quot;import datetime&quot;	fails.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44754">[ date ]</a>
              <a href="thread.html#44754">[ thread ]</a>
              <a href="subject.html#44754">[ subject ]</a>
              <a href="author.html#44754">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
