<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Request for ideas
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Request%20for%20ideas&In-Reply-To=%3C6.1.2.0.0.20051203165555.0261cbb0%40mail.myedl.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044624.html">
   <LINK REL="Next"  HREF="044625.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Request for ideas</H1>
    <B>Samuel Reynolds</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Request%20for%20ideas&In-Reply-To=%3C6.1.2.0.0.20051203165555.0261cbb0%40mail.myedl.com%3E"
       TITLE="[Twisted-Python] Request for ideas">sam at SpinwardStars.com
       </A><BR>
    <I>Sat Dec  3 17:06:52 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044624.html">[Twisted-Python] Request for ideas
</A></li>
        <LI>Next message (by thread): <A HREF="044625.html">[Twisted-Python] Question on deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44629">[ date ]</a>
              <a href="thread.html#44629">[ thread ]</a>
              <a href="subject.html#44629">[ subject ]</a>
              <a href="author.html#44629">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At 2005-12-03 04:24 PM -0500, you wrote:
&gt;<i>The specific problem occurs when objects are reused. I've had situations 
</I>&gt;<i>where a client fails to reply for significantly longer than the timeout 
</I>&gt;<i>period. In that interval, the original CommTrans, AckMgr and RepMgr have 
</I>&gt;<i>been deleted and replaced by new instances. The client finally replies to 
</I>&gt;<i>the original request, and the reply is caught by those new objects!
</I>&gt;<i>(There is what I think is a very small, but non-zero probability that I'm 
</I>&gt;<i>misinterpreting what I'm seeing.)
</I>&gt;<i>
</I>&gt;<i> From what I can see in the source code, the internal ID is what's set by 
</I>&gt;<i> the builtin 'id' function. I'm printing these at key times and I can see 
</I>&gt;<i> where they're being duplicated. The only time I see this problem occur is 
</I>&gt;<i> when a new object has been created with the same id as a previous object.
</I>
Sounds like an object aliasing problem.
And I don't think that it's *objects* that are being
re-used, but *memory locations* for same-class objects.

Don't use the built-in id() function. I'm not sure if this
is correct, but it seems to me something like the memory
address of the object. When the memory gets re-used, the
same ID sometimes recurrs.

*****
If you need a unique identifier for your application logic,
create and assign it yourself. Don't use the id() function.
*****

One possibility is to give each AckMgr/RepMgr pair an auction ID.

Create a simple ID generator (object or function).
When you create a new AckMgr and RepMgr, get a new ID
from the generator and assign it to each one *before*
you use it.

The AckMgr then could simply ignore any response that
doesn't have the expected ID.

More generally, I would put the AckMgrs in a dictionary,
keyed by the action ID. I would have *one* function/method
(ProcessAck) that gets responses and dispatches them to the
appropriate AckMgr, or drops them if no matching AckMgr
is found. This would make testing, debugging, and tuning
easier, too, by providing a single location for
instrumentation.

- Sam

__________________________________________________________
Spinward Stars, LLC                        Samuel Reynolds
Software Consulting and Development           303-805-1446
<A HREF="http://SpinwardStars.com/">http://SpinwardStars.com/</A>           <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sam at SpinwardStars.com</A>  




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044624.html">[Twisted-Python] Request for ideas
</A></li>
	<LI>Next message (by thread): <A HREF="044625.html">[Twisted-Python] Question on deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44629">[ date ]</a>
              <a href="thread.html#44629">[ thread ]</a>
              <a href="subject.html#44629">[ subject ]</a>
              <a href="author.html#44629">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
