<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> how winnt fileops work and what to do about it (was	Re:[Twisted-Python] Twisted windows hackers - help the tests to pass!)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=how%20winnt%20fileops%20work%20and%20what%20to%20do%20about%20it%20%28was%0A%09Re%3A%5BTwisted-Python%5D%20Twisted%20windows%20hackers%20-%20help%20the%20tests%20to%20pass%21%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012272.html">
   <LINK REL="Next"  HREF="012260.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>how winnt fileops work and what to do about it (was	Re:[Twisted-Python] Twisted windows hackers - help the tests to pass!)</H1>
    <B>Paul G</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=how%20winnt%20fileops%20work%20and%20what%20to%20do%20about%20it%20%28was%0A%09Re%3A%5BTwisted-Python%5D%20Twisted%20windows%20hackers%20-%20help%20the%20tests%20to%20pass%21%29&In-Reply-To="
       TITLE="how winnt fileops work and what to do about it (was	Re:[Twisted-Python] Twisted windows hackers - help the tests to pass!)">paul-lists at perforge.com
       </A><BR>
    <I>Sat Dec 31 17:23:47 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012272.html">how winnt fileops work and what to do about it (was Re:	[Twisted-Python] Twisted windows hackers - help the tests to pass!)
</A></li>
        <LI>Next message: <A HREF="012260.html">[Twisted-Python] Re: [Twisted-commits] r15451 - Fix test failures	under windows by changing the eventual-send operation to
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12278">[ date ]</a>
              <a href="thread.html#12278">[ thread ]</a>
              <a href="subject.html#12278">[ subject ]</a>
              <a href="author.html#12278">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
----- Original Message ----- 
From: &quot;Jean-Paul Calderone&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt;
To: &quot;Twisted general discussion&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Sent: Saturday, December 31, 2005 4:52 PM
Subject: Re: how winnt fileops work and what to do about it (was 
Re:[Twisted-Python] Twisted windows hackers - help the tests to pass!)


&gt;<i> On Sat, 31 Dec 2005 05:48:43 -0500, Paul G &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">paul-lists at perforge.com</A>&gt; 
</I>&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>ok, i can actually chime in here because i've done filesystems work on 
</I>&gt;&gt;<i>windows (don't ask ;). now, it's been a while, but i should remember 
</I>&gt;&gt;<i>things reasonably accurately (i hope). see below for comments:
</I>&gt;<i>
</I>&gt;<i> Thanks, Paul, for these comments.  This cleared up a lot about how the 
</I>&gt;<i> filesystem works on Win32 for me.
</I>
just a quick revision from me, for the benefit of posterity only, since 
investigating the feasibility of fixing the underlying cause (files being 
held open) seems to be the best course of action.

&gt;&gt;<i>4. test whether you can either use ZwSetFileInformation() to rename 
</I>&gt;&gt;<i>directories by changing the FILE_NAME attr in the appropriate info 
</I>&gt;&gt;<i>structure or use it to move by renaming files which are open, again using 
</I>&gt;&gt;<i>the appropriate (but different) structure.
</I>
this will definitely not work for files based on the ddk docs i managed to 
dig out, and will almost certainly not work for directories (though this 
isn't documented either way). quite simply, expecting this to work is an 
expectation borne out of familiarity with things like ext2/linux-vfs, where 
all filesystem objects are inodes mapped into a namespace with dentries.  it 
appears that no matter how you slice it, the underlying implementation of 
ntfs is drastically different, so a rename is a move and a move is a 
copy+delete, which brings us back to our problem.

-p 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012272.html">how winnt fileops work and what to do about it (was Re:	[Twisted-Python] Twisted windows hackers - help the tests to pass!)
</A></li>
	<LI>Next message: <A HREF="012260.html">[Twisted-Python] Re: [Twisted-commits] r15451 - Fix test failures	under windows by changing the eventual-send operation to
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12278">[ date ]</a>
              <a href="thread.html#12278">[ thread ]</a>
              <a href="subject.html#12278">[ subject ]</a>
              <a href="author.html#12278">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
