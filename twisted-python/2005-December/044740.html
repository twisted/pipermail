<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] help with refcounts and memleaks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20help%20with%20refcounts%20and%20memleaks&In-Reply-To=%3C20051227032007.GY9576%40opteron.random%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044745.html">
   <LINK REL="Next"  HREF="044729.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] help with refcounts and memleaks</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20help%20with%20refcounts%20and%20memleaks&In-Reply-To=%3C20051227032007.GY9576%40opteron.random%3E"
       TITLE="[Twisted-Python] help with refcounts and memleaks">andrea at cpushare.com
       </A><BR>
    <I>Mon Dec 26 20:20:07 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044745.html">[Twisted-Python] help with refcounts and memleaks
</A></li>
        <LI>Next message (by thread): <A HREF="044729.html">[Twisted-Python] help with refcounts and memleaks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44740">[ date ]</a>
              <a href="thread.html#44740">[ thread ]</a>
              <a href="subject.html#44740">[ subject ]</a>
              <a href="author.html#44740">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Dec 27, 2005 at 03:28:30AM +0100, Jesus Cea wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i> 
</I>&gt;<i> Wow, Andrea Arcangeli, of Linux Kernel fame. What an honor :).
</I>&gt;<i> 
</I>&gt;<i> &gt; +		import gc
</I>&gt;<i> &gt; +		gc.collect()
</I>&gt;<i> 
</I>&gt;<i> Haha. I was just writing you about manual garbage collector invocations.
</I>
;) Thanks! I couldn't even think that it could have been the garbage
collector because the thing was &gt;1G large. I definitely expected any
sane garbage collector to kick in at least once every time the task was
doubling in size and certainly before the thing could grow to the
gigabytes. Perhaps this is what should really happen. Every time the
task doubles in size we could force a gc.collect(). The growth rate that
should trigger a collect() could be a threshold tunable too (default
None to be backwards compatible even though I think None is not a
safe/sane default).

&gt;<i> Manual collections can be costly, nevertheless. Since the manual
</I>&gt;<i> collector is only needed to free cyclic references, I guess that Twisted
</I>&gt;<i> people would rather prefer a patch to break cyclic references in Twisted
</I>&gt;<i> code. For example, using &quot;__del__&quot; methods or &quot;weakref&quot;.
</I>&gt;<i> 
</I>&gt;<i> You can easily see what objects and references keep the cycles alive
</I>&gt;<i> using &quot;gc.garbage&quot; and &quot;gc.get_referrers()&quot;. Usually a single
</I>&gt;<i> &quot;a.value=None&quot; can do miracles :-). Weakref can be very very helpful, also.
</I>
a.value=None + weakrefs is what did the miracles indeed, but I did it in my
code not in twisted code. twisted code has no cyclic references. All
cyclic references were in my code sitting on top of twisted. It's me
implementing the protocol.

The a.value=None made the code a mess, the weakref complicated things
too (especially because I had to hash one of those weak values, so I had
to use weakref.ref and I had to change lots of code to add &quot;()&quot;). So I'm
soooo glad to have backed out all those changes because they were
unnecessary ;). Plus a.value = None is similar to freeing memory in a
normal language without garbage collection, not very different from
free(a.value). So I certainly prefer to use the more advanced features
of the garbage collector, even if I have to invoke it by hand... ;)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044745.html">[Twisted-Python] help with refcounts and memleaks
</A></li>
	<LI>Next message (by thread): <A HREF="044729.html">[Twisted-Python] help with refcounts and memleaks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44740">[ date ]</a>
              <a href="thread.html#44740">[ thread ]</a>
              <a href="subject.html#44740">[ subject ]</a>
              <a href="author.html#44740">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
