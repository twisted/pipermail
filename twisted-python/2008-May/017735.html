<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] xmlstream problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20xmlstream%20problem&In-Reply-To=4832F351.2070603%40evotex.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017733.html">
   <LINK REL="Next"  HREF="017753.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] xmlstream problem</H1>
    <B>Ralph Meijer</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20xmlstream%20problem&In-Reply-To=4832F351.2070603%40evotex.ch"
       TITLE="[Twisted-Python] xmlstream problem">twisted at ralphm.ik.nu
       </A><BR>
    <I>Tue May 20 13:37:15 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017733.html">[Twisted-Python] xmlstream problem
</A></li>
        <LI>Next message: <A HREF="017753.html">[Twisted-Python] xmlstream problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17735">[ date ]</a>
              <a href="thread.html#17735">[ thread ]</a>
              <a href="subject.html#17735">[ subject ]</a>
              <a href="author.html#17735">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2008-05-20 at 17:50 +0200, Gabriel Rossetti wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I am using xmlstream.XmlStream to process...XML streams :-)
</I>&gt;<i> I'm having a bit of a problem, I have a client and a server, both 
</I>&gt;<i> protocols inherit from xmlstream.XmlStream. When the client sends 4 
</I>&gt;<i> messages, one after another, I get a parse error. I debugged my program, 
</I>&gt;<i> and the buffer the expat parser is given contains in effect, 4 messages 
</I>&gt;<i> consecutively like so :
</I>&gt;<i> 
</I>&gt;<i> str: 
</I>&gt;<i> &lt;message&gt;...&lt;/message&gt;&lt;message&gt;...&lt;/message&gt;&lt;message&gt;...&lt;/message&gt;&lt;message&gt;...&lt;/message&gt;
</I>&gt;<i> 
</I>&gt;<i> (I replaced the child elements with &quot;...&quot; for your reading enjoyment)
</I>&gt;<i> 
</I>&gt;<i> and I get this Exception when debugging (otherwise it stays hidden) :
</I>&gt;<i> 
</I>&gt;<i> ExpatError: junk after document element: line 1, column 196
</I>&gt;<i> 
</I>&gt;<i> now column 196 is the end of the 1st msg's root element, I think it 
</I>&gt;<i> doesn't like the next message being right after the first.
</I>
That's right. Streaming XML, as implemented by twisted.words.xish, works
by exchanging two complete (virtual) XML documents, one in each
direction. So, you need to have a root element around your messages,
such as 'stream'. The unit of communication is first-level elements of
that root element. So, you start out with sending the start tag of the
root element, and then sending the messages.

You would set up an observer for your messages like so:

  def onMessage(message):
      print &quot;Got message!&quot;

  factory = XmlStreamFactory()
  factory.addBootstrap(&quot;/message&quot;, onMessage)
  
&gt;<i> I did 
</I>&gt;<i> override xmlstream.XmlStream.onDocumentEnd()
</I>&gt;<i> because I didn't want it to close the connection in between messages, 
</I>&gt;<i> but in my method I told it to initialize the stream using :
</I>&gt;<i> 
</I>&gt;<i> self._initializeStream()
</I>&gt;<i> 
</I>&gt;<i> I did this since I noticed that closing the connection forces a new 
</I>&gt;<i> parser to be created when the previous statement is called. The reason I 
</I>&gt;<i> don't want the connection to be closed is that I'd like a persistent 
</I>&gt;<i> connection to be held.
</I>
There is no need to do this, what I showed above should meet your
requirements. Also, this method is semi-private (leading _) for a
reason.

-- 
Groetjes,

ralphm



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017733.html">[Twisted-Python] xmlstream problem
</A></li>
	<LI>Next message: <A HREF="017753.html">[Twisted-Python] xmlstream problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17735">[ date ]</a>
              <a href="thread.html#17735">[ thread ]</a>
              <a href="subject.html#17735">[ subject ]</a>
              <a href="author.html#17735">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
