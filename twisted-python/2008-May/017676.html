<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SQLAlchemy and Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20SQLAlchemy%20and%20Twisted&In-Reply-To=d272f0690805081503x12c18b68lc70c22ea4172e51c%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017691.html">
   <LINK REL="Next"  HREF="017699.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SQLAlchemy and Twisted</H1>
    <B>Valentino Volonghi</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20SQLAlchemy%20and%20Twisted&In-Reply-To=d272f0690805081503x12c18b68lc70c22ea4172e51c%40mail.gmail.com"
       TITLE="[Twisted-Python] SQLAlchemy and Twisted">dialtone at gmail.com
       </A><BR>
    <I>Thu May  8 21:39:22 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017691.html">[Twisted-Python] SQLAlchemy and Twisted
</A></li>
        <LI>Next message: <A HREF="017699.html">[Twisted-Python] SQLAlchemy and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17676">[ date ]</a>
              <a href="thread.html#17676">[ thread ]</a>
              <a href="subject.html#17676">[ subject ]</a>
              <a href="author.html#17676">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, May 8, 2008 at 3:03 PM, alex clemesha &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">clemesha at gmail.com</A>&gt; wrote:
&gt;<i> But, I hoping to solve some immediate problems with Twisted and
</I>&gt;<i> SQLAlchemy, so ...
</I>
I've long worked on trying to integrate sqlalchemy and twisted in a
useful way but that can only be done when using simple queries. There
are countless reasons behind this limitation, like the fact that
sqlalchemy objects can do a lot of stuff behind the scenes or because
code that you write in other places might use some assumptions because
it's sync rather than async, and there are also problems with possible
bugs and assumptions within sqlalchemy itself. Basically it's not safe
and I wouldn't recommend it for anyone to use the orm together within
a Twisted process.

What I ended up doing is creating subprocesses that have fairly
complex logic and usually spend more than a few seconds doing their
job. By doing this I simply use sqlalchemy synchronously and without
any problems (I was starting to go completely crazy while trying to
debug time-dependent errors when I decided to refactor my code to use
subprocesses instead, everything started working smoothly without any
relevant change in the logic or in the test code and now I can also
run the subprocess as a system script to check and verify stuff or
debug (with pdb)).

Considering that an ORM is only useful (?) for very complex logic I
consider my approach completely sane. Use the query generator for
everything and reserve the orm for long running tasks.

nadbapi and storm-twisted tries to solve the orm problem in a similar
way but nadbapi is no longer maintained, anyway both currently suffer
from an incredible number of deferreds that they generate making the
use of defgen an absolute requirement (and thus lowering overall
performance). If you look hard enough in glyph's old blog or in this
list (I can't remember where exactly) you can find a post about
letting the database deal with concurrency and not spread it in
application code (aka having tons of deferreds). It is true that not
using threads increases speed and memory usage but for this particular
case 99% of the time you are not going to need neither of them anyway.

closing: I recently refactored some code that used sqlalchemy orm into
using just the query generator and instead of taking 17 seconds it now
takes 7 seconds and memory usage has decreased considerably. It's not
really just because an orm is slower than simply executing queries,
but rather because querying the db was so easy; it was basically done
&quot;recklessly&quot; without thinking too much about the performance hit of
going back and forth to the database. This is basically why I'd rather
not use ORMs unless forced by legacy code or because generating a
query would introduce so much complexity to make it an application in
itself (very rare case IMHO).

-- 
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: <A HREF="http://www.twisted.it">http://www.twisted.it</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017691.html">[Twisted-Python] SQLAlchemy and Twisted
</A></li>
	<LI>Next message: <A HREF="017699.html">[Twisted-Python] SQLAlchemy and Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17676">[ date ]</a>
              <a href="thread.html#17676">[ thread ]</a>
              <a href="subject.html#17676">[ subject ]</a>
              <a href="author.html#17676">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
