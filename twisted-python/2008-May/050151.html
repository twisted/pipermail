<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python]The problem afer reactor stoped....
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5DThe%20problem%20afer%20reactor%20stoped....&In-Reply-To=%3C33fd431f0805052241j7d1fa341vba773d3fc0d53229%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050149.html">
   <LINK REL="Next"  HREF="050152.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python]The problem afer reactor stoped....</H1>
    <B>李祥曦</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5DThe%20problem%20afer%20reactor%20stoped....&In-Reply-To=%3C33fd431f0805052241j7d1fa341vba773d3fc0d53229%40mail.gmail.com%3E"
       TITLE="[Twisted-Python]The problem afer reactor stoped....">lxx1234 at gmail.com
       </A><BR>
    <I>Mon May  5 23:41:44 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050149.html">[Twisted-Python] EuroPython 2008
</A></li>
        <LI>Next message (by thread): <A HREF="050152.html">[Twisted-Python]The problem afer reactor stoped....
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50151">[ date ]</a>
              <a href="thread.html#50151">[ thread ]</a>
              <a href="subject.html#50151">[ subject ]</a>
              <a href="author.html#50151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,all
   I want to write a program that can send some e-mails automaticlly,i
use the code like this:

def sendmail(authenticationUsername, authenticationSecret,fromAddress,
toAddress,messageFile,smtpHost, smtpPort=25):
    resultDeferred = Deferred()
    senderFactory =
ESMTPSenderFactory(authenticationUsername,authenticationSecret,fromAddress,toAddress,messageFile,resultDeferred,requireTransportSecurity=False)
    reactor.connectTCP(smtpHost, smtpPort, senderFactory)
    return resultDeferred

def sendComplete(result):
    print &quot;Message sent.&quot;
    reactor.stop()

class EmailUtil:
    def __init__(self,popserver,smptserver,username,password):
        self.popserver=popserver
        self.smtpserver=smptserver
        self.username=username
        self.password=password

    def goSend(self,fromaddr, toaddr, subject, body, filenames):
        message = buildMessage(fromaddr, toaddr, subject, body, filenames)
        messageData = message.as_string(unixfrom=False)
        tempfile=open('temp.mai','wb')
        tempfile.write(messageData)
        tempfile.close()
        print 'Sending.....'
        result =
sendmail(self.username,self.password,fromaddr,toaddr,file('temp.mai'),self.smtpserver)
        result.addCallbacks(sendComplete,handleError)
        reactor.run()

if __name__=='__main__':
    f=EmailUtil('','smtp.xxx.com','xxxx','1234')
    filenames=['test2.docx']
    f.goSend('<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">xxxx at xxx.com</A>','<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">xxx at hotmail.com</A>','testSend','aaaaaaaaaa',filenames)
    f.goSend('<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">xxxx at xxx.com</A>','<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">xxx at hotmail.com</A>','testSend','aaaaaaaaaa',filenames)
    f.goSend('<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">xxxx at xxx.com</A>','<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">xxx at hotmail.com</A>','testSend','aaaaaaaaaa',filenames)

I try to send the same mail,but after the first mail was sended,the
program deadlock,and i use some tool konws after the first mail
sended,no packets was send to the outside world.I guess maybe the
problem related with the reactor run and stop,but i am sure,any one
can tell me what's problem is?Thanks


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050149.html">[Twisted-Python] EuroPython 2008
</A></li>
	<LI>Next message (by thread): <A HREF="050152.html">[Twisted-Python]The problem afer reactor stoped....
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50151">[ date ]</a>
              <a href="thread.html#50151">[ thread ]</a>
              <a href="subject.html#50151">[ subject ]</a>
              <a href="author.html#50151">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
