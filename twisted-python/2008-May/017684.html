<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Oddity(?) with zero-length Deferred lists
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Oddity%28%3F%29%20with%20zero-length%20Deferred%20lists&In-Reply-To=4824A6FF.8020309%40renesys.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017683.html">
   <LINK REL="Next"  HREF="017685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Oddity(?) with zero-length Deferred lists</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Oddity%28%3F%29%20with%20zero-length%20Deferred%20lists&In-Reply-To=4824A6FF.8020309%40renesys.com"
       TITLE="[Twisted-Python] Oddity(?) with zero-length Deferred lists">exarkun at divmod.com
       </A><BR>
    <I>Fri May  9 15:46:53 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017683.html">[Twisted-Python] Oddity(?) with zero-length Deferred lists
</A></li>
        <LI>Next message: <A HREF="017685.html">[Twisted-Python] Oddity(?) with zero-length Deferred lists
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17684">[ date ]</a>
              <a href="thread.html#17684">[ thread ]</a>
              <a href="subject.html#17684">[ subject ]</a>
              <a href="author.html#17684">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 09 May 2008 14:33:19 -0500, Gregg Lind &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">gregg at renesys.com</A>&gt; wrote:
&gt;<i>Good afternoon!
</I>&gt;<i>
</I>&gt;<i>I notice an oddity with zero-length DeferredLists.
</I>&gt;<i>
</I>&gt;<i>The example script (<A HREF="http://dpaste.com/49099/">http://dpaste.com/49099/</A>) should just return the 
</I>&gt;<i>contents of a bunch of URLs given at the command line, or some errors like 
</I>&gt;<i>so:
</I>&gt;<i>
</I>&gt;<i>$ python test.py a b c
</I>&gt;<i>[(False, &lt;twisted.python.failure.Failure twisted.web.error.Error&gt;), (False, 
</I>&gt;<i>&lt;twisted.python.failure.Failure twisted.web.error.Error&gt;), (False, 
</I>&gt;<i>&lt;twisted.python.failure.Failure twisted.web.error.Error&gt;)]
</I>&gt;<i>
</I>&gt;<i>*but*
</I>&gt;<i>
</I>&gt;<i>$ python test.py     # no arguments
</I>&gt;<i>[]
</I>&gt;<i># then hangs, never reaching &quot;quit&quot;
</I>&gt;<i>
</I>
You can do this in a simpler way without involving DeferredList:

    &gt;&gt;&gt; from twisted.internet.defer import succeed
    &gt;&gt;&gt; from twisted.internet import reactor
    &gt;&gt;&gt; d = succeed(None)
    &gt;&gt;&gt; d.addCallback(lambda ign: reactor.stop())
    &lt;Deferred at 0xB7D1F12CL  current result: &lt;twisted.python.failure.Failure twisted.internet.error.ReactorNotRunning&gt;&gt;
    &gt;&gt;&gt; reactor.run()
    &lt;hang&gt;

As you can see from this example, the Deferred already has a result (a
Failure) by the time reactor.run() is called.  Adding a callback to a
Deferred which already has a result (such as succeed(None) or
DeferredList([])) calls the callback immediately.  So your sample program
is trying to stop the reactor before it starts.  Then nothing tries to
stop the reactor after you actually do start it.  If you add an errback
to your Deferred, you'll see the problem reported.  One solution to this
is to use reactor.callWhenRunning(reactor.stop) instead of reactor.stop().

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017683.html">[Twisted-Python] Oddity(?) with zero-length Deferred lists
</A></li>
	<LI>Next message: <A HREF="017685.html">[Twisted-Python] Oddity(?) with zero-length Deferred lists
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17684">[ date ]</a>
              <a href="thread.html#17684">[ thread ]</a>
              <a href="subject.html#17684">[ subject ]</a>
              <a href="author.html#17684">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
