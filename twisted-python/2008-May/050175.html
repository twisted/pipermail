<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Change in reactor.stop() in Twisted 8.x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Change%20in%20reactor.stop%28%29%20in%20Twisted%208.x&In-Reply-To=%3C6ce0ac130805071141ud6177c4y236bfe499c1abd6%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050187.html">
   <LINK REL="Next"  HREF="050176.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Change in reactor.stop() in Twisted 8.x</H1>
    <B>Brian Granger</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Change%20in%20reactor.stop%28%29%20in%20Twisted%208.x&In-Reply-To=%3C6ce0ac130805071141ud6177c4y236bfe499c1abd6%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Change in reactor.stop() in Twisted 8.x">ellisonbg.net at gmail.com
       </A><BR>
    <I>Wed May  7 12:41:16 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050187.html">[Twisted-Python] Twisted Presentation Materials...
</A></li>
        <LI>Next message (by thread): <A HREF="050176.html">[Twisted-Python] Change in reactor.stop() in Twisted 8.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50175">[ date ]</a>
              <a href="thread.html#50175">[ thread ]</a>
              <a href="subject.html#50175">[ subject ]</a>
              <a href="author.html#50175">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We have been using Twisted for a long time and are migrating to 8.0.1.
 We are finding that code that ran fine with 2.5.0 is giving problems
with 8.0.1 and it appears to be related to what is happening in
reactor.stop().

The code that is failing looks like this:

##########

from twisted.internet import reactor

d = doSomeThingThatReturnsADeferred()
d.addCallback(handleOK)
d.addCallback(lambda _: reactor.stop())
reactor.run()

##########

The doSomeThingThatReturnsADeferred method is making XMLRPC calls
underneath the hood.

When we run this, it runs OK, but then blows up at the end with:

Traceback (most recent call last):
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/internet/defer.py&quot;,
line 185, in addCallbacks
    self._runCallbacks()
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/internet/defer.py&quot;,
line 323, in _runCallbacks
    self.result = callback(self.result, *args, **kw)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/internet/base.py&quot;,
line 387, in _continueFiring
    callable(*args, **kwargs)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/internet/base.py&quot;,
line 524, in disconnectAll
    failure.Failure(main.CONNECTION_LOST))
--- &lt;exception caught here&gt; ---
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/python/log.py&quot;,
line 51, in callWithLogger
    return callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/python/log.py&quot;,
line 36, in callWithContext
    return context.call({ILogContext: newCtx}, func, *args, **kw)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/python/context.py&quot;,
line 59, in callWithContext
    return self.currentContext().callWithContext(ctx, func, *args, **kw)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/python/context.py&quot;,
line 37, in callWithContext
    return func(*args,**kw)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/internet/tcp.py&quot;,
line 577, in connectionLost
    self.connector.connectionLost(reason)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/internet/base.py&quot;,
line 937, in connectionLost
    self.factory.clientConnectionLost(self, reason)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/web/xmlrpc.py&quot;,
line 325, in clientConnectionLost
    self.deferred.errback(reason)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/internet/defer.py&quot;,
line 264, in errback
    self._startRunCallbacks(fail)
  File &quot;/Library/Python/2.5/site-packages/Twisted-8.0.1-py2.5-macosx-10.5-i386.egg/twisted/internet/defer.py&quot;,
line 293, in _startRunCallbacks
    raise AlreadyCalledError
twisted.internet.defer.AlreadyCalledError:

I have checked and there is no failure object in my callback chain -
this is internal to Twisted.

Has the logic in reactor.stop changed recently?  Any ideas about what
would be causing this?

Thanks

Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050187.html">[Twisted-Python] Twisted Presentation Materials...
</A></li>
	<LI>Next message (by thread): <A HREF="050176.html">[Twisted-Python] Change in reactor.stop() in Twisted 8.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50175">[ date ]</a>
              <a href="thread.html#50175">[ thread ]</a>
              <a href="subject.html#50175">[ subject ]</a>
              <a href="author.html#50175">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
