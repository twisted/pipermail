<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Maximum recursion depth reached
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Maximum%20recursion%20depth%20reached&In-Reply-To=%3C20080509174026.6859.671616157.divmod.quotient.61114%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050188.html">
   <LINK REL="Next"  HREF="050190.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Maximum recursion depth reached</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Maximum%20recursion%20depth%20reached&In-Reply-To=%3C20080509174026.6859.671616157.divmod.quotient.61114%40ohm%3E"
       TITLE="[Twisted-Python] Maximum recursion depth reached">exarkun at divmod.com
       </A><BR>
    <I>Fri May  9 11:40:26 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050188.html">[Twisted-Python] Maximum recursion depth reached
</A></li>
        <LI>Next message (by thread): <A HREF="050190.html">[Twisted-Python] Maximum recursion depth reached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50189">[ date ]</a>
              <a href="thread.html#50189">[ thread ]</a>
              <a href="subject.html#50189">[ subject ]</a>
              <a href="author.html#50189">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 09 May 2008 10:18:57 -0700, Steve Freitas &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sflist at ihonk.com</A>&gt; wrote:
&gt;<i>On Fri, 2008-05-09 at 13:20 +0200, Maarten ter Huurne wrote:
</I>&gt;&gt;<i> By returning the DeferredList from next_batch(), you are chaining Deferreds:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/defer.html#auto11">http://twistedmatrix.com/projects/core/documentation/howto/defer.html#auto11</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you remove the &quot;return&quot; from next_batch(), the problem disappears. If you
</I>&gt;&gt;<i> want to be able to register a callback when all items are processed, it's
</I>&gt;&gt;<i> probably better to create a dedicated Deferred for that instead of chaining
</I>&gt;&gt;<i> the DeferredLists.
</I>&gt;<i>
</I>&gt;<i>Thanks for your reply, Marteen!
</I>&gt;<i>
</I>&gt;<i>I guess I'm a little mystified by what's going wrong here -- I chain
</I>&gt;<i>deferreds all the time -- I'm not sure what it is about returning a few
</I>&gt;<i>thousand deferreds wrapped up into a smaller number of DeferredLists
</I>&gt;<i>that's causing the problem, and I'd like to understand why.
</I>
Sitting at the core of Deferred is a loop over callback functions.  If
you have a chained Deferred, then one of those callbacks is doing to be
a function which recursively calls the function which has that loop.  If
you chain enough Deferreds, then eventually this recursion will fail.  It
turns out to be about 250 Deferreds (roughly 4 stack frames per level of
chaining, with the default limit of 1000 stack frames imposed by CPython)
which will trigger this limit.

It may be possible to replace this recursion with iteration, but I'm not
sure that solves all problems.  After all, if you suddenly have to blow
through thousands of levels of chaining in response to one event, then
you're paying a pretty hefty price which could be avoided by jumping over
all the irrelevant intermediate stuff.  Maybe *that* could be implemented
in Deferred as well somehow, but it's not totally obvious to me how. :)

Hope this helps,

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050188.html">[Twisted-Python] Maximum recursion depth reached
</A></li>
	<LI>Next message (by thread): <A HREF="050190.html">[Twisted-Python] Maximum recursion depth reached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50189">[ date ]</a>
              <a href="thread.html#50189">[ thread ]</a>
              <a href="subject.html#50189">[ subject ]</a>
              <a href="author.html#50189">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
