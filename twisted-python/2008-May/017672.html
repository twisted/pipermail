<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] socket error 22
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20socket%20error%2022&In-Reply-To=48206EA2.5080203%40thiengineering.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017664.html">
   <LINK REL="Next"  HREF="017700.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] socket error 22</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20socket%20error%2022&In-Reply-To=48206EA2.5080203%40thiengineering.ch"
       TITLE="[Twisted-Python] socket error 22">exarkun at divmod.com
       </A><BR>
    <I>Thu May  8 14:14:52 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017664.html">[Twisted-Python] socket error 22
</A></li>
        <LI>Next message: <A HREF="017700.html">[Twisted-Python] socket error 22
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17672">[ date ]</a>
              <a href="thread.html#17672">[ thread ]</a>
              <a href="subject.html#17672">[ subject ]</a>
              <a href="author.html#17672">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 06 May 2008 16:43:46 +0200, Werner Thie &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wthie at thiengineering.ch</A>&gt; wrote:
&gt;<i>Hi all
</I>&gt;<i>
</I>&gt;<i>Running on twisted 2.5 OpenBSD I see the following traceback in the logs 
</I>&gt;<i>every twenty minutes with up to 200 athena/LivePages connected:
</I>&gt;<i>
</I>&gt;<i>     Traceback (most recent call last):
</I>&gt;<i>     --- &lt;exception caught here&gt; ---
</I>&gt;<i>       File &quot;/usr/local/lib/python2.5/site- 
</I>&gt;<i>packages/twisted/internet/selectreactor.py&quot;, line 148, in _doReadOrWrite
</I>&gt;<i>         why = getattr(selectable, method)()
</I>&gt;<i>       File &quot;/usr/local/lib/python2.5/site-packages/twisted/internet/tcp.py&quot;, 
</I>&gt;<i>line 362, in doRead
</I>&gt;<i>         return self.protocol.dataReceived(data)
</I>&gt;<i>       File &quot;/usr/local/lib/python2.5/site- 
</I>&gt;<i>packages/twisted/protocols/basic.py&quot;, line 233, in dataReceived
</I>&gt;<i>         why = self.lineReceived(line)
</I>&gt;<i>       File &quot;/usr/local/lib/python2.5/site-packages/twisted/web/http.py&quot;, 
</I>&gt;<i>line 1069, in lineReceived
</I>&gt;<i>         self.allContentReceived()
</I>&gt;<i>       File &quot;/usr/local/lib/python2.5/site-packages/twisted/web/http.py&quot;, 
</I>&gt;<i>line 1110, in allContentReceived
</I>&gt;<i>         req.requestReceived(command, path, version)
</I>&gt;<i>       File &quot;/usr/local/lib/python2.5/site-packages/twisted/web/http.py&quot;, 
</I>&gt;<i>line 603, in requestReceived
</I>&gt;<i>         self.host = self.channel.transport.getHost()
</I>&gt;<i>       File &quot;/usr/local/lib/python2.5/site-packages/twisted/internet/tcp.py&quot;, 
</I>&gt;<i>line 672, in getHost
</I>&gt;<i>         return address.IPv4Address('TCP', *(self.socket.getsockname() + 
</I>&gt;<i>('INET',)))
</I>&gt;<i>       File &quot;&lt;string&gt;&quot;, line 1, in getsockname
</I>&gt;<i>
</I>&gt;<i>     socket.error: (22, 'Invalid argument')
</I>&gt;<i>
</I>&gt;<i>Changing reactors does not help, the error is very unspecific. Before I 
</I>&gt;<i>start changing the source sprinkling it with log statements is there anybody 
</I>&gt;<i>out there who has a cure or knows an explanation.
</I>&gt;<i>
</I>
I wonder if OpenBSD gives back EINVAL for getsockname(2) when the peer has
done a shutdown of the socket.  Can you tell me what this program does?

    from socket import socket
    port = socket()
    port.bind(('', 0))
    port.listen(1)
    client = socket()
    client.setblocking(False)
    client.connect_ex(port.getsockname())
    server, clientAddr = port.accept()
    print 'Before close', server.getsockname()
    client.close()
    print 'After close', server.getsockname()

If it finishes without error, try it with a time.sleep(5) before the final
line.

Also, to re-iterate what I believe someone else already said in this thread,
the best way to have Twisted work on OpenBSD is for there to be an OpenBSD
buildslave.  It's easy to set up new buildslaves, the only requirements are
that the machine can make outgoing TCP connections to the master and that it
can run the Twisted test suite whenever there's a trunk change or someone
needs to test something on the platform.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017664.html">[Twisted-Python] socket error 22
</A></li>
	<LI>Next message: <A HREF="017700.html">[Twisted-Python] socket error 22
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17672">[ date ]</a>
              <a href="thread.html#17672">[ thread ]</a>
              <a href="subject.html#17672">[ subject ]</a>
              <a href="author.html#17672">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
