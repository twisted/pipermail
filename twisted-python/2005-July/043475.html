<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Understanding%20the%20IOCP%20reactor%20and%20adding%0A%09spawnProcess&In-Reply-To=%3C94a776e705071112402f4643d0%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043474.html">
   <LINK REL="Next"  HREF="043476.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess</H1>
    <B>Justin Johnson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Understanding%20the%20IOCP%20reactor%20and%20adding%0A%09spawnProcess&In-Reply-To=%3C94a776e705071112402f4643d0%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess">justinjohnson at gmail.com
       </A><BR>
    <I>Mon Jul 11 13:40:44 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043474.html">[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
</A></li>
        <LI>Next message (by thread): <A HREF="043476.html">[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43475">[ date ]</a>
              <a href="thread.html#43475">[ thread ]</a>
              <a href="subject.html#43475">[ subject ]</a>
              <a href="author.html#43475">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/11/05, Jp Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; wrote: 
&gt;<i> 
</I>&gt;<i> On Mon, 11 Jul 2005 12:16:35 -0500, Justin Johnson &lt;
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;On 7/11/05, Jp Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt; [snip]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; 3. Notify the ProcessProtocol via protocol.makeConnection (not sure
</I>&gt;<i> &gt;&gt; &gt; why, looking at win32eventreactor)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; makeConnection is the method that's actually part of IProtocol (even
</I>&gt;<i> &gt;&gt; though ProcessProtocol doesn't implement IProtocol, it still adheres to 
</I>&gt;<i> its
</I>&gt;<i> &gt;&gt; API in this regard). Generally, all it does is set the .transport 
</I>&gt;<i> attribute
</I>&gt;<i> &gt;&gt; on the protocol instance and then call connectionMade. This might seem
</I>&gt;<i> &gt;&gt; pointless in the case of processes, but since it maintains consistency 
</I>&gt;<i> with
</I>&gt;<i> &gt;&gt; other kinds of transports, it is useful.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So the Process class is the transport? In win32eventreactor, 3 threads 
</I>&gt;<i> are
</I>&gt;<i> &gt;started that loop on reading stdout and stderr and writing data from the
</I>&gt;<i> &gt;outQueue to stdin. It seems to me that I would not use these threads, but
</I>&gt;<i> &gt;instead have each of these 3 file handles associated with the IOCP. Then 
</I>&gt;<i> the
</I>&gt;<i> &gt;methods defined in ops.py would be used to handle events on those 
</I>&gt;<i> handles,
</I>&gt;<i> &gt;resulting in transport methods being called. These transport methods 
</I>&gt;<i> would
</I>&gt;<i> &gt;be methods on the Process class, which would result in methods on a 
</I>&gt;<i> single
</I>&gt;<i> &gt;instance of the ProcessProtocol being called. This single instance of the
</I>&gt;<i> &gt;ProcessProtocol would be shared by all of the 3 file handles. Am I
</I>&gt;<i> &gt;understanding correctly? Are write and loseConnection the only methods 
</I>&gt;<i> the
</I>&gt;<i> &gt;Process would need to implement from ITransport?
</I>&gt;<i> 
</I>&gt;<i> That mostly sounds correct, except the last bit. What makes it a transport 
</I>&gt;<i> is that it implements /all/ of ITransport. Moreover, ProcessProtocols expect 
</I>&gt;<i> their transport to be an IProcessTransport, which adds several methods on 
</I>&gt;<i> top of ITransport. Everything in each of those interfaces needs to be 
</I>&gt;<i> implemented.
</I>
 Ahh... I missed those interfaces because I was starting with 
win32eventreactor.Process, which doesn't implement either ITransport or 
IProcessTransport (either with an implements() or by defining all of those 
methods).
 After some more thought about this I think I will have to define new xxxOps 
methods for stdout and stderr (and maybe stdin as well). These ops' ovDone 
methods will call the methods on the transport (Process) appropriate for 
ProcessProtocols.

For reference, &lt;
&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITransport.html">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.ITransport.html</A>&gt; 
</I>&gt;<i> and &lt;
</I>&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IProcessTransport.html">http://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IProcessTransport.html</A>
</I>&gt;<i> &gt;.
</I>&gt;<i> 
</I>&gt;<i> Jp
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20050711/c7f93eaf/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043474.html">[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
</A></li>
	<LI>Next message (by thread): <A HREF="043476.html">[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43475">[ date ]</a>
              <a href="thread.html#43475">[ thread ]</a>
              <a href="subject.html#43475">[ subject ]</a>
              <a href="author.html#43475">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
