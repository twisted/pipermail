<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Understanding%20the%20IOCP%20reactor%20and%20adding%0A%09spawnProcess&In-Reply-To=%3C94a776e705071110161e92d8a4%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043471.html">
   <LINK REL="Next"  HREF="043474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess</H1>
    <B>Justin Johnson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Understanding%20the%20IOCP%20reactor%20and%20adding%0A%09spawnProcess&In-Reply-To=%3C94a776e705071110161e92d8a4%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess">justinjohnson at gmail.com
       </A><BR>
    <I>Mon Jul 11 11:16:35 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043471.html">[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
</A></li>
        <LI>Next message (by thread): <A HREF="043474.html">[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43472">[ date ]</a>
              <a href="thread.html#43472">[ thread ]</a>
              <a href="subject.html#43472">[ subject ]</a>
              <a href="author.html#43472">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>See response below.

On 7/11/05, Jp Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; wrote: 
&gt;<i> 
</I>&gt;<i> On Mon, 11 Jul 2005 10:52:14 -0500, Justin Johnson &lt;
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;I am attempting to add spawnProcess to iocpreactor. In order to begin 
</I>&gt;<i> this
</I>&gt;<i> &gt;task I've had to do a lot of reading on Windows network programming,
</I>&gt;<i> &gt;specifically the various Windows I/O methods, to attempt to understand 
</I>&gt;<i> what
</I>&gt;<i> &gt;win32eventreactor and iocpreactor are doing, and also just increase my
</I>&gt;<i> &gt;understanding of how reactors work in general. To understand the various
</I>&gt;<i> &gt;Winsock 2 methods that both of these reactors rely upon, I read chapters 
</I>&gt;<i> 1-5
</I>&gt;<i> &gt;of Network Programming for Microsoft Windows[1].
</I>&gt;<i> &gt; Before actually attempting to add spawnProcess, I would like to present 
</I>&gt;<i> how
</I>&gt;<i> &gt;I think iocpreactor works and how I think I should add spawnProcess, and
</I>&gt;<i> &gt;hopefully be corrected or confirmed in my understanding. If I'm too vague
</I>&gt;<i> &gt;there's a good chance it's because I don't understand it very well. 
</I>&gt;<i> Please
</I>&gt;<i> &gt;feel free to point out things that you might think are obvious but aren't
</I>&gt;<i> &gt;sure I understand.
</I>&gt;<i> &gt; How iocpreactor works
</I>&gt;<i> &gt;---------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [snip]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; How to add spawnProcess
</I>&gt;<i> &gt;---------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. Create the processes via Windows APIs and associate their
</I>&gt;<i> &gt; stdout/err with with the IOCP via CreateIoCompletionPort calls.
</I>&gt;<i> &gt; 2. Close stdin.
</I>&gt;<i> 
</I>&gt;<i> Why close stdin? How will you write to the spawned process?
</I>
 I see, so I won't close stdin and people can do that in their 
ProcessProtocol in connectionMade or something if they want.

&gt;<i> 3. Notify the ProcessProtocol via protocol.makeConnection (not sure
</I>&gt;<i> &gt; why, looking at win32eventreactor)
</I>&gt;<i> 
</I>&gt;<i> makeConnection is the method that's actually part of IProtocol (even 
</I>&gt;<i> though ProcessProtocol doesn't implement IProtocol, it still adheres to its 
</I>&gt;<i> API in this regard). Generally, all it does is set the .transport attribute 
</I>&gt;<i> on the protocol instance and then call connectionMade. This might seem 
</I>&gt;<i> pointless in the case of processes, but since it maintains consistency with 
</I>&gt;<i> other kinds of transports, it is useful.
</I>
  So the Process class is the transport? In win32eventreactor, 3 threads are 
started that loop on reading stdout and stderr and writing data from the 
outQueue to stdin. It seems to me that I would not use these threads, but 
instead have each of these 3 file handles associated with the IOCP. Then the 
methods defined in ops.py would be used to handle events on those handles, 
resulting in transport methods being called. These transport methods would 
be methods on the Process class, which would result in methods on a single 
instance of the ProcessProtocol being called. This single instance of the 
ProcessProtocol would be shared by all of the 3 file handles. Am I 
understanding correctly? Are write and loseConnection the only methods the 
Process would need to implement from ITransport?

&gt;<i> 4. Receive data from stdout/err via the completion port by calling
</I>&gt;<i> &gt; GetQueuedCompletionStatus from within doIteration. Is this really 
</I>&gt;<i> possible?
</I>&gt;<i> &gt; ProcessProtocol's methods won't get called appropriately by letting the
</I>&gt;<i> &gt; existing callbacks in ops.py make calls to the transport (e.g.
</I>&gt;<i> &gt; connectionDone, readDone)?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks for your help.
</I>&gt;<i> &gt;Justin
</I>&gt;<i> &gt; [1] <A HREF="http://www.amazon.com/exec/obidos/ASIN/0735615799">http://www.amazon.com/exec/obidos/ASIN/0735615799</A>
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> Jp
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20050711/5b21c0a0/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043471.html">[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
</A></li>
	<LI>Next message (by thread): <A HREF="043474.html">[Twisted-Python] Understanding the IOCP reactor and adding	spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43472">[ date ]</a>
              <a href="thread.html#43472">[ thread ]</a>
              <a href="subject.html#43472">[ subject ]</a>
              <a href="author.html#43472">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
