<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Receiving large packets with TCP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Receiving%20large%20packets%20with%20TCP&In-Reply-To=%3C42D263E3.2040201%40gmx.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043463.html">
   <LINK REL="Next"  HREF="043465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Receiving large packets with TCP</H1>
    <B>David Guaraglia</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Receiving%20large%20packets%20with%20TCP&In-Reply-To=%3C42D263E3.2040201%40gmx.de%3E"
       TITLE="[Twisted-Python] Receiving large packets with TCP">dguaraglia at gmx.de
       </A><BR>
    <I>Mon Jul 11 06:19:47 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043463.html">[Twisted-Python] Receiving large packets with TCP
</A></li>
        <LI>Next message (by thread): <A HREF="043465.html">[Twisted-Python] Receiving large packets with TCP (solved)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43464">[ date ]</a>
              <a href="thread.html#43464">[ thread ]</a>
              <a href="subject.html#43464">[ subject ]</a>
              <a href="author.html#43464">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Stefan.

As Christopher said, you never know how much data you'll receive so you 
must buffer the data until you have what you expect. If you know your 
packets are going to be _exactly_ 16kb long, then you just read until 
you have 16kb+ of data in a buffer, and process that. Then you save the 
rest for the next packet. One of the best ways to do that is using an 
string, or a queue. I have some example code in case you are interested,

David

Stefan NÃ¤we wrote:

&gt;<i>Hi.
</I>&gt;<i>I'm using Twisted (2.0.1) for a TCP-based receiver.
</I>&gt;<i>That receiver receives different telegrams sent by another process.
</I>&gt;<i>Those telegrams are sent on different ports (i.e. one telegram type
</I>&gt;<i>is sent on one port). The sizes of the telegram vary from ~16 bytes
</I>&gt;<i>to ~8 kB.
</I>&gt;<i>
</I>&gt;<i>Everything works perfectly. I've really never been *that*
</I>&gt;<i>productive.
</I>&gt;<i>
</I>&gt;<i>BUT:
</I>&gt;<i>I'm having trouble receiving the whole contents of large telegrams.
</I>&gt;<i>For example one telegram is exactly 7452 bytes long but I only get
</I>&gt;<i>2920 bytes.
</I>&gt;<i>My twisted receiver uses the reactor to setup the different ports
</I>&gt;<i>to listen on and creates 'message handler' objects on connect.
</I>&gt;<i>Those message handler objects 'dissect' the received telegram and
</I>&gt;<i>print some of its contents to STDOUT.
</I>&gt;<i>
</I>&gt;<i>Some parts of my code:
</I>&gt;<i>
</I>&gt;<i>class MyReceiver(Protocol):
</I>&gt;<i>
</I>&gt;<i>    def dataReceived(self, data):
</I>&gt;<i>        if __debug__: log.msg(&quot;Received %d bytes&quot; % len(data))
</I>&gt;<i>        try:
</I>&gt;<i>            # here the message handler gets created
</I>&gt;<i>            m = self.factory.msg[self.port](data)
</I>&gt;<i>            log.msg(m)
</I>&gt;<i>        except KeyError:
</I>&gt;<i>            # can this really happen ??
</I>&gt;<i>            log.msg(&quot;Unhandled connection from port %d&quot; % self.port)
</I>&gt;<i>
</I>&gt;<i>    def connectionMade(self):
</I>&gt;<i>        addr = self.transport.getHost()
</I>&gt;<i>        self.proto = addr.type
</I>&gt;<i>        self.peer = addr.host
</I>&gt;<i>        self.port = addr.port
</I>&gt;<i>        log.msg(&quot;Connection from %s&quot; % self.transport.getPeer())
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>My 'main' function simply does 'reactor.listenTCP(port, MyFactory)'
</I>&gt;<i>
</I>&gt;<i>So what do I need to do to get the whole telegram 'in one shot' ?
</I>&gt;<i>Do I need to re-assemble the telegrams myself ?
</I>&gt;<i>
</I>&gt;<i>(I hope this Information is enough...Tell me, if not.)
</I>&gt;<i>
</I>&gt;<i>TIA
</I>&gt;<i>
</I>&gt;<i>Stefan
</I>&gt;<i>  
</I>&gt;<i>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043463.html">[Twisted-Python] Receiving large packets with TCP
</A></li>
	<LI>Next message (by thread): <A HREF="043465.html">[Twisted-Python] Receiving large packets with TCP (solved)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43464">[ date ]</a>
              <a href="thread.html#43464">[ thread ]</a>
              <a href="subject.html#43464">[ subject ]</a>
              <a href="author.html#43464">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
