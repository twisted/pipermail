<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Scheduling of modules
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scheduling%20of%20modules&In-Reply-To=%3C42C94D86.2060008%40metamoof.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043399.html">
   <LINK REL="Next"  HREF="043401.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Scheduling of modules</H1>
    <B>Moof</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scheduling%20of%20modules&In-Reply-To=%3C42C94D86.2060008%40metamoof.net%3E"
       TITLE="[Twisted-Python] Scheduling of modules">moof at metamoof.net
       </A><BR>
    <I>Mon Jul  4 08:53:58 MDT 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043399.html">[Twisted-Python] How to implement bandwidth control for a UDP proxy	server?
</A></li>
        <LI>Next message (by thread): <A HREF="043401.html">[Twisted-Python] O'Reilly book on Twisted coming in October
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43400">[ date ]</a>
              <a href="thread.html#43400">[ thread ]</a>
              <a href="subject.html#43400">[ subject ]</a>
              <a href="author.html#43400">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hiya,

I've more or less had twisted sold to me as the be-all and end-all in terms
of avoiding having to deal with threads, amongst other things, so I thought
I'd ask if twisted is the right thing to use for my problem.

I have a number of modules which use John J Lee's mechanize module to do
some web scraping to different web sites. Right now mechanize uses standard
urllib calls to do its thing, though it may be possible after much
refactoring to get it use something more asyncronous. So for the short term
rapid development thing, I'm more or less stuck with threads if I want to
get any vaguely concurrent running out of these modules.

Specifically, I'm going to need to poll a database every minute or so (or
write some form of SQL Server 2000 trigger which will call me when things
change) and if there are any changes in the database, potentially fire off
thirty of these web scraping modules at once. The modules are
self-contained, and don't communicate with anything other than the thing
that calls them by returning values, so I'm vaguely certain they're more or
less thread-safe, inasmuch as I ever can be.

My beef is that I can't have more than one scraping module modifying the
same site concurrently. This introduces race conditions on the site, rather
than in my code. Each module touches only one site, so I need to basically
have a module-level lock either in the module or in the thread scheduler to
ensure that I'm not running the same module more than once.

This makes me think of some sort of queue structure. I either need to have
one queue that just works through its requests ignoring any that are
currently running, or one queue per module with some sort of central
dispatcher that will place a request in the appropriate queue.

In real terms, these modules may take up to three minutes to complete the
web scraping they are required to do, though most take 20 seconds or so. I'd
rather not just have them called one after the other in a blocking manner,
as I'd sort of like to have a five or six minute response time whenever a
request is placed in the database to fire off a bunch of updates, rather
than the close to 20 minute response time I'm currently getting when I fire
a complete unittest suite off. These requests may come in several times a
day, most commonly hours apart, but I need to be able to react if I get two
or three different requests within a five minute period, which would mean
firing off the next request to the module as soon as it has completed the
current request.

Is this something Twisted can help me with? If so, what are my options
within Twisted, and what should I be reading up on how to use? I have a
vague idea that Twisted has a thread pool, but I'm not sure if it has an
event queue that would be suitable for this sort of control, or how I'd go
about modifying whatever's there to be useful for this sort of thing.

If not, any pointers to patterns that might help me code such a thing up?

I'm running on Windows. I need no GUI integration as such, though it will
need to run as an NT service. Any input other than though the database could
potentially be triggered off by a client programme going through something
like perspective broker, or the Windows NT service controller telling me to
start up or shut down.

Thanks for your help,

Moof
-- 
Giles Antonio Radford, alias Moof
&quot;Too old to be a chicken and too young to be a dirty old man&quot;
Serving up my ego over at &lt;<A HREF="http://metamoof.net/">http://metamoof.net/</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043399.html">[Twisted-Python] How to implement bandwidth control for a UDP proxy	server?
</A></li>
	<LI>Next message (by thread): <A HREF="043401.html">[Twisted-Python] O'Reilly book on Twisted coming in October
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43400">[ date ]</a>
              <a href="thread.html#43400">[ thread ]</a>
              <a href="subject.html#43400">[ subject ]</a>
              <a href="author.html#43400">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
