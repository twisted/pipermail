<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Adbapi, cp_reconnect and MySQL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Adbapi%2C%20cp_reconnect%20and%20MySQL&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010952.html">
   <LINK REL="Next"  HREF="010902.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Adbapi, cp_reconnect and MySQL</H1>
    <B>Yanick Dufresne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Adbapi%2C%20cp_reconnect%20and%20MySQL&In-Reply-To="
       TITLE="[Twisted-Python] Adbapi, cp_reconnect and MySQL">yanick at iotum.com
       </A><BR>
    <I>Tue Jul  5 12:06:50 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010952.html">[Twisted-Python] Questions regarding serviceCollection	and	Interfaces.
</A></li>
        <LI>Next message: <A HREF="010902.html">[Twisted-Python] ANN: Coil v0.1, a configuration library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10901">[ date ]</a>
              <a href="thread.html#10901">[ thread ]</a>
              <a href="subject.html#10901">[ subject ]</a>
              <a href="author.html#10901">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all, quick question:

In adbapi's Transaction.reopen:

    def reopen(self):
        if self._connection is None:
            self.reconnect()

        if self._cursor is not None:
            self.close()

        try:
            self._cursor = self._connection.cursor()
            return
        except:
            if not self._pool.reconnect:
                raise

My understand of the goal of cp_reconnect is to ensure that at the
beginning of a query, the connection be re-established if it timed out
since the last query (I understand that trying to reconnect in the
middle of an interaction could potentially have undesired and
unpredictable effects).

The code above seems to assume that self._connection.cursor() will raise
ConnectionLost if the connection has timed out.

My question is two-fold:
1) should it not specifically check for ConnectionLost rather than catch
everything?
2) I don't know about other backends, but MySQL will cheerfully give you
a cursor object whenever you ask for one, and only raises ConnectionLost
when you actually call execute on the cursor, making the code above
completely ineffective. Anyone has a clever solution to this, short of
inserting &quot;            self._cursor.execute(self._pool.good_sql)&quot; in the
try block? That works, but isn't exactly performance friendly...

Any help appreciated,

Yanick Dufresne
Iotum Corporation


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010952.html">[Twisted-Python] Questions regarding serviceCollection	and	Interfaces.
</A></li>
	<LI>Next message: <A HREF="010902.html">[Twisted-Python] ANN: Coil v0.1, a configuration library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10901">[ date ]</a>
              <a href="thread.html#10901">[ thread ]</a>
              <a href="subject.html#10901">[ subject ]</a>
              <a href="author.html#10901">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
