<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] jabber sasl and TLS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20jabber%20sasl%20and%20TLS&In-Reply-To=4adac7a3050701123513f2a10d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010871.html">
   <LINK REL="Next"  HREF="010882.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] jabber sasl and TLS</H1>
    <B>Nathaniel Haggard</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20jabber%20sasl%20and%20TLS&In-Reply-To=4adac7a3050701123513f2a10d%40mail.gmail.com"
       TITLE="[Twisted-Python] jabber sasl and TLS">natester at gmail.com
       </A><BR>
    <I>Fri Jul  1 19:40:42 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010871.html">[Twisted-Python] jabber sasl and TLS
</A></li>
        <LI>Next message: <A HREF="010882.html">[Twisted-Python] jabber sasl and TLS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10877">[ date ]</a>
              <a href="thread.html#10877">[ thread ]</a>
              <a href="subject.html#10877">[ subject ]</a>
              <a href="author.html#10877">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok I patched the latest twisted with those patches from the bug, and
this is the code that I use to try to login.

from twisted.words.protocols import jabber
from twisted.xish import xmlstream
from twisted.words.protocols.jabber import client, jid
from twisted.internet import reactor, defer

class Connection:
    def __init__(self, who, myjid):
        self.jid = jid.JID(myjid)
        self.who = who

    def connect(self, passwd, port=5223):
        self.factory = client.jabberClientFactory(self.jid, passwd)
        
        self.factory.addBootstrap(xmlstream.STREAM_AUTHD_EVENT,self.onAuthSuccess)
        self.factory.addBootstrap(client.XMPPAuthenticator.AUTH_FAILED_EVENT,self.onAuthFailed)
        
        self.connector = reactor.connectTCP(self.jid.host, port, self.factory)
    
    def onAuthSuccess(self, stream):
        print &quot;%s: Successful connection&quot; % (self.who)
        self.stream = stream

    def onAuthFailed(self, stream):
        print &quot;%s: Failed connection&quot; % (self.who)
        self.factory.stopTrying()
        self.connector.disconnect()

c1 = Connection('1', '<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">test at domain.com</A>/res1')
c1.connect('pass')

reactor.run()

jabberd 2.0s8 (on linux with openssl 0.9.7d) complains with this error:

C2S : Fri Jul  1 17:20:55 2005 [notice] [6] [10.1.2.111, port=49443]
error: SSL handshake error (error:140760FC:SSL
routines:SSL23_GET_CLIENT_HELLO:unknown protocol)
C2S : sx (sx.c:55) allocated new sx for 6
C2S : Fri Jul  1 17:21:47 2005 [notice] [7] [10.1.2.111, port=49444] connect

The server is setup to do TLS auth only on port 5223. 

Nate

On 7/1/05, Nathaniel Haggard &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">natester at gmail.com</A>&gt; wrote:
&gt;<i> Where is the code now and can I help you by using it?
</I>&gt;<i> 
</I>&gt;<i> Nate
</I>&gt;<i> 
</I>&gt;<i> On 7/1/05, Ralph Meijer &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted at ralphm.ik.nu</A>&gt; wrote:
</I>&gt;<i> &gt; On Fri, Jul 01, 2005 at 09:37:46AM -0600, Nathaniel Haggard wrote:
</I>&gt;<i> &gt; &gt; What is the status of the sasl TLS jabber authenticator?  There is
</I>&gt;<i> &gt; &gt; this code from about a month ago:
</I>&gt;<i> &gt; &gt; <A HREF="http://bfs.itlab.musc.edu/pubcvs/viewcvs.cgi/tofu/saslclient.py#rev1.6,">http://bfs.itlab.musc.edu/pubcvs/viewcvs.cgi/tofu/saslclient.py#rev1.6,</A>
</I>&gt;<i> &gt; &gt; but it does not include TLS.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Yes, tofu has submitted this code, and I, the maintainer of the Jabber
</I>&gt;<i> &gt; pieces in Twisted, am looking at integrating this. However, to do this
</I>&gt;<i> &gt; right, there are some fundamental changes necessary in Xish and the
</I>&gt;<i> &gt; Jabber module. I'm working on this, and will update the bug with
</I>&gt;<i> &gt; progress.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If you have any more questions, do ask in this list.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Groetjes,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ralphm
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010871.html">[Twisted-Python] jabber sasl and TLS
</A></li>
	<LI>Next message: <A HREF="010882.html">[Twisted-Python] jabber sasl and TLS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10877">[ date ]</a>
              <a href="thread.html#10877">[ thread ]</a>
              <a href="subject.html#10877">[ subject ]</a>
              <a href="author.html#10877">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
