<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] a reminder about Deferreds in tests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20a%20reminder%20about%20Deferreds%20in%20tests&In-Reply-To=%3CFDC4D775-0910-4ABA-831C-EAF9FD55B800%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] a reminder about Deferreds in tests</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20a%20reminder%20about%20Deferreds%20in%20tests&In-Reply-To=%3CFDC4D775-0910-4ABA-831C-EAF9FD55B800%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] a reminder about Deferreds in tests">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Mar 27 15:21:30 MDT 2014</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60650">[ date ]</a>
              <a href="thread.html#60650">[ thread ]</a>
              <a href="subject.html#60650">[ subject ]</a>
              <a href="author.html#60650">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm not sure if we've written this down anywhere official-looking, but if you're writing new tests in Twisted today, there is no reason that they should ever return a Deferred.

Returning Deferreds from tests in Trial is useful _only_ for writing integration tests that rely on external services which cannot be reasonably implemented or faked within Twisted itself.  In some applications, this is an unfortunate fact of life, which is why Trial provides the feature and will continue to provide it.  For example, writing unit tests for a database-backed application which depends intimately upon stored procedures would require altogether too much mocking and it's useful to be able to simply call out to the real database within tests.  However, this is assuming that you can run your database locally in isolation as part of your test suite, and there is absolutely no non-determinism present in the application's communications with its database.

However, there is nothing like this within Twisted itself.  In extreme cases where you actually need to test real platform interactions, you can instantiate a reactor for your test and iterate it as the ReactorBuilder tests do, but in any case where you're testing a client/server interaction, parsing bytes, etc, you can use twisted.test.proto_helpers or twisted.test.iosim.  In the branch I'm working on right now I'm moving some more general testing utilities from individual tests over to twisted.test.ssl_helpers as well, so it should be easy to test any TLS interactions you might have as well.  (Note, these are for testing within Twisted only right now, at some point we need to clean up all the generally-useful things in twisted.test, including proto_helpers, put them in a module outside of *.test...)

To sum up: there is absolutely no reason whatsoever to ever use loopbackAsync, please don't ever use it in a new test.

Thanks,

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20140327/928fb165/attachment-0002.html&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4124 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20140327/928fb165/attachment-0002.bin&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60650">[ date ]</a>
              <a href="thread.html#60650">[ thread ]</a>
              <a href="subject.html#60650">[ subject ]</a>
              <a href="author.html#60650">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
