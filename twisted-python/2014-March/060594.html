<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Freezing Ampoule or the Invasion of Infinite Zombie Processes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Freezing%20Ampoule%20or%20the%20Invasion%20of%20Infinite%0A%20Zombie%20Processes&In-Reply-To=%3CetPan.531fdcc6.6b8b4567.3669%40Buraks-MacBook-Pro.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060591.html">
   <LINK REL="Next"  HREF="060598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Freezing Ampoule or the Invasion of Infinite Zombie Processes</H1>
    <B>Burak Nehbit</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Freezing%20Ampoule%20or%20the%20Invasion%20of%20Infinite%0A%20Zombie%20Processes&In-Reply-To=%3CetPan.531fdcc6.6b8b4567.3669%40Buraks-MacBook-Pro.local%3E"
       TITLE="[Twisted-Python] Freezing Ampoule or the Invasion of Infinite Zombie Processes">burak at nehbit.net
       </A><BR>
    <I>Tue Mar 11 22:04:22 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060591.html">[Twisted-Python] Freezing Ampoule or the Invasion of Infinite	Zombie Processes
</A></li>
        <LI>Next message (by thread): <A HREF="060598.html">[Twisted-Python] Freezing Ampoule or the Invasion of Infinite Zombie Processes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60594">[ date ]</a>
              <a href="thread.html#60594">[ thread ]</a>
              <a href="subject.html#60594">[ subject ]</a>
              <a href="author.html#60594">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>spawnProcess is somewhat low-level.  It would be very nice indeed if Twisted had some sort of Service object you could easily use for spawning worker processes, along the lines of Ampoule, that would take care of all the platform-specific nonsense of setting up communication with subprocesses, spawning them, monitoring them, figuring out the right Python to spawn, the right environment variables to get sys.path correct, and other things, such as...


Ampoule is very close. Any chance of polishing and absorbing it into Twisted? Parallel computing is the weakest point of entire Python ecosystem, and Ampoule is so very close to the perfection, unless, like me, you end up getting stuck on a corner case. 



For this, I am almost entirely sure that the imports are failing, most probably because it’s trying to import the system python, not the one PyInstaller packages up. I have no idea how to fix it though. I’m feeling rather guilty about it, Aether v1.1 is a vastly improved version, but  I can’t package it, so the release is off for a while. For personal reasons (Moved to SF, started a new full–time job) I am unlikely to find enough time to debug such a complex issue in the near future, while the code is fading from my memory and rotting in drive. Such a shame.

 

Best,

Burak






From: Glyph Lefkowitz <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>
Reply: Twisted general discussion <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Date: March 10, 2014 at 11:39:36 AM
To: Twisted general discussion <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Subject:  Re: [Twisted-Python] Freezing Ampoule or the Invasion of Infinite	Zombie Processes  


On Mar 9, 2014, at 12:31 AM, Burak Nehbit &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">burak at nehbit.net</A>&gt; wrote:
I agree. Though it’s also very useful as an drop–in implementation of a Twisted spawnProcess for one single other process.

spawnProcess is somewhat low-level.  It would be very nice indeed if Twisted had some sort of Service object you could easily use for spawning worker processes, along the lines of Ampoule, that would take care of all the platform-specific nonsense of setting up communication with subprocesses, spawning them, monitoring them, figuring out the right Python to spawn, the right environment variables to get sys.path correct, and other things, such as...

It sounds like the basic process support included in Twisted, 
reactor.spawnProcess, could address your requirements. 
I have just found your answer here: 

<A HREF="https://stackoverflow.com/questions/6678763/simple-example-with-spawnprocess">https://stackoverflow.com/questions/6678763/simple-example-with-spawnprocess</A>

which seems useful. If nothing else works, I will try to reduce complexity by converting this to bare spawnProcess. 

Any ideas on what might be going wrong in my current stack? After all, processes being repeatedly created is just a symptom of something going wrong in the process very early, so ampoule tries to spawn another one. I am mainly looking to find a way to see the exception and where it happens. Twisted’s logging module seem to kick in too late. 

Twisted's logging typically gets initialized after all modules are imported.  A tool like Ampoule really ought to set up logging as early as possible in its child, and handle the case where it's not getting set up on the parent side.

The important thing to do is to make sure you have an errReceived callback that actually prints or logs the stderr it receives; there's likely a traceback in there which you may have missed if the process is just crashing.

-glyph
- smime.p7s, 6 KB
_______________________________________________  
Twisted-Python mailing list  
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>  
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20140311/10955440/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060591.html">[Twisted-Python] Freezing Ampoule or the Invasion of Infinite	Zombie Processes
</A></li>
	<LI>Next message (by thread): <A HREF="060598.html">[Twisted-Python] Freezing Ampoule or the Invasion of Infinite Zombie Processes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60594">[ date ]</a>
              <a href="thread.html#60594">[ thread ]</a>
              <a href="subject.html#60594">[ subject ]</a>
              <a href="author.html#60594">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
