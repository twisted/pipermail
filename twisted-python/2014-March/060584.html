<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] improving foolscap's use of Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20improving%20foolscap%27s%20use%20of%20Twisted&In-Reply-To=%3C20140308100231.GA4266%40googlemail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] improving foolscap's use of Twisted</H1>
    <B>David Stainton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20improving%20foolscap%27s%20use%20of%20Twisted&In-Reply-To=%3C20140308100231.GA4266%40googlemail.com%3E"
       TITLE="[Twisted-Python] improving foolscap's use of Twisted">dstainton415 at gmail.com
       </A><BR>
    <I>Sat Mar  8 03:02:31 MST 2014</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60584">[ date ]</a>
              <a href="thread.html#60584">[ thread ]</a>
              <a href="subject.html#60584">[ subject ]</a>
              <a href="author.html#60584">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Greetings,

My goal is to get Brian Warner's foolscap library ported to Twisted
endpoints instead of the older Twisted api interfaces it currently
uses (ClientFactory and IConnector).

This effort has been documented in foolscap trac ticket #203:
<A HREF="http://foolscap.lothar.com/trac/ticket/203">http://foolscap.lothar.com/trac/ticket/203</A>

and also part of Tahoe-LAFS trac ticket #517 - make tahoe Tor- and I2P-friendly:
<A HREF="https://tahoe-lafs.org/trac/tahoe-lafs/ticket/517">https://tahoe-lafs.org/trac/tahoe-lafs/ticket/517</A>

My question is this:

Since Foolscap's TubConnectorClientFactory does rely
on clientConnectionFailed... What is the equivalent to this for the new
interfaces?

I have tried to braindump all my foolscap twisted endpoint thoughts to
foolscap trac ticket #203 :
<A HREF="http://foolscap.lothar.com/trac/ticket/203#comment:30">http://foolscap.lothar.com/trac/ticket/203#comment:30</A>
<A HREF="http://foolscap.lothar.com/trac/ticket/203#comment:31">http://foolscap.lothar.com/trac/ticket/203#comment:31</A>

If we look at line 1223 of
<A HREF="https://github.com/warner/foolscap/blob/master/foolscap/negotiate.py">https://github.com/warner/foolscap/blob/master/foolscap/negotiate.py</A>
(at 0395476c7cb154f925d67abf6858a8200126352b)

we see that there's this TubConnectorClientFactory:
class TubConnectorClientFactory(protocol.ClientFactory, object):

and later at line 1384 it is used with connectTCP like this:
            f = TubConnectorClientFactory(self, host, lp)
            c = reactor.connectTCP(host, port, f)

In my endpoints2 branch
(<A HREF="https://github.com/david415/foolscap/tree/endpoints2">https://github.com/david415/foolscap/tree/endpoints2</A>)
I changed it to:
class TubConnectorFactory(protocol.Factory, object):

I suspected that TubConnector?'s clientConnectionFailed doesn't get
called and then I found a relevent quaote this twisted doc:
<A HREF="https://twistedmatrix.com/documents/current/core/howto/endpoints.html">https://twistedmatrix.com/documents/current/core/howto/endpoints.html</A>

here's the quote:
&quot;&quot;&quot;Note: If you've used ClientFactory before, keep in mind that the
connect method takes a Factory, not a ClientFactory. Even if you pass a ClientFactory to
endpoint.connect, its clientConnectionFailed and clientConnectionLost
methods will not be called.&quot;&quot;&quot;

Currently foolscap's extensive collection of unittests are exercising
bugs in my code when I try to port foolscap to twisted
endpoints.

foolscap$ trial foolscap.test.test_appserver.RunCommand.test_run
foolscap.test.test_appserver
  RunCommand
    test_run ...                                                        [ERROR]

===============================================================================
[ERROR]
Traceback (most recent call last):
Failure: foolscap.tokens.NegotiationError: no connection established within client timeout

foolscap.test.test_appserver.RunCommand.test_run
-------------------------------------------------------------------------------
Ran 1 tests in 60.576s

FAILED (errors=1)
foolscap$ 



Cheers!

David Stainton


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Digital signature
URL: &lt;/pipermail/twisted-python/attachments/20140308/55d9921f/attachment.sig&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60584">[ date ]</a>
              <a href="thread.html#60584">[ thread ]</a>
              <a href="subject.html#60584">[ subject ]</a>
              <a href="author.html#60584">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
