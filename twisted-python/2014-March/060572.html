<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Configuration options for twisted code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Configuration%20options%20for%20twisted%20code&In-Reply-To=%3C20140304132257.6218.1352865863.divmod.xquotient.221%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060571.html">
   <LINK REL="Next"  HREF="060573.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Configuration options for twisted code</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Configuration%20options%20for%20twisted%20code&In-Reply-To=%3C20140304132257.6218.1352865863.divmod.xquotient.221%40top%3E"
       TITLE="[Twisted-Python] Configuration options for twisted code">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Mar  4 06:22:57 MST 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060571.html">[Twisted-Python] Configuration options for twisted code
</A></li>
        <LI>Next message (by thread): <A HREF="060573.html">[Twisted-Python] Configuration options for twisted code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60572">[ date ]</a>
              <a href="thread.html#60572">[ thread ]</a>
              <a href="subject.html#60572">[ subject ]</a>
              <a href="author.html#60572">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12:41 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A> wrote:
&gt;&gt;<i>A configuration system would take a while to design
</I>&gt;<i>
</I>&gt;<i>This reads like: A configuration system will never be implemented.
</I>&gt;<i>
</I>&gt;<i>I agree that for the time being we can implement current tickets using
</I>&gt;<i>__init__ arguments,
</I>&gt;<i>but why not try to implement something simple?
</I>&gt;<i>
</I>&gt;<i>Example:
</I>&gt;<i>
</I>&gt;<i>TWISTED_WEB_DEFAULT_CONFIGURATIO = {
</I>&gt;<i>  'request.headers.count': 500,
</I>&gt;<i>  'request.headers.size': 16384,
</I>&gt;<i>  'request.session.name' :  'TWISTED_SESSION',
</I>&gt;<i>  }
</I>&gt;<i>
</I>&gt;<i># We can have a helper method to get default configuration
</I>&gt;<i>configInstance = TWISTED_WEB_DEFAULT_CONFIGURATION.copy()
</I>&gt;<i>configInstance[''request.headers.count'] = 100
</I>&gt;<i>t.w.s.Site(configuration=configInstance)
</I>&gt;<i>
</I>&gt;<i>Or a bit more structured:
</I>&gt;<i>
</I>&gt;<i>class RequestConfiguration(object):
</I>&gt;<i>   def __init__(self):
</I>&gt;<i>     self.max_headers_count = 500
</I>&gt;<i>     self.request_max_header_size = 16384
</I>&gt;<i>     self.session_cookie_name = 'TWISTED_SESSION'
</I>&gt;<i>     self.session_cookie_secure = True
</I>&gt;<i>     self.session_cookie_http_only = True
</I>&gt;<i>
</I>&gt;<i>class TwistedWebConfiguration(object):
</I>&gt;<i>  def __init__(self):
</I>&gt;<i>       self.request = RequestConfiguration()
</I>&gt;<i>
</I>&gt;<i>configInstance = TwistedWebConfiguration()
</I>&gt;<i>configInstance.request.max_headers_count = 100
</I>&gt;<i>
</I>&gt;<i>t.w.s.Site(configuration=configInstance)
</I>&gt;<i>
</I>&gt;<i>Or a mix:
</I>&gt;<i>
</I>&gt;<i>configInstance = TwistedWebConfiguration()
</I>&gt;<i>configInstance.set('request.headers.count', 100)
</I>&gt;<i>t.w.s.Site(configuration=configInstance)
</I>&gt;<i>
</I>&gt;<i>and support some sort of inheritance.
</I>&gt;<i>
</I>&gt;<i>configInstance.set('timeout', 100)
</I>&gt;<i>assert configInstance.get('request.timeout') == 100
</I>&gt;<i>configInstance.set('request.timeout', 200)
</I>&gt;<i>assert configInstance.get('request.timeout') == 200
</I>&gt;<i>
</I>&gt;<i>Or some design used in other project... or some other crazy idea.
</I>&gt;<i>
</I>&gt;<i>-----
</I>&gt;<i>
</I>&gt;<i>In Twisted web I found both configuration overridden in sub-classes
</I>&gt;<i>(t.w.s.Site) and defined via __init__ (t.w.s.File)
</I>&gt;<i>
</I>&gt;<i>twisted.web.static.File has 5 arguments, but the following
</I>&gt;<i>configuration are missing : indexNames, childNotFoundResource,
</I>&gt;<i>forbiddenResource, directoryListing resource
</I>&gt;<i>
</I>&gt;<i>As Jean-Paul commented, when there are too many arguments and they are
</I>&gt;<i>all related, they could be represented by a single argument.
</I>&gt;<i>For me, this single argument could be a configuration object.
</I>
The big downside of a &quot;configuration object&quot; is that &quot;configuration&quot; 
isn't any kind of abstraction.  &quot;Configuration&quot; approximately means 
&quot;stuff&quot;.  Where does your &quot;configuration&quot; end?  By just saying this is 
where &quot;configuration&quot; goes you've defined its scope as infinite.  Before 
you know it, there's 80,000 items in your &quot;configuration&quot; object and 
you're really much worse off than if you'd just added a couple more 
arguments to `__init__`.

I'd like to see this discussion going in the other direction so to give 
it a little push that way, here's a specific suggestion. :)  Most or all 
of this may be recycled from discussion that's already taken place - I'm 
not taking credit, just repeating it. :)

Give `Request.__init__` some new optional arguments to control the size 
of the header.  This could be several arguments like `maxHeaderLines` 
and `maxHeaderValueLength` and so on... Or perhaps it should just be one 
argument that can completely describe the header size limitation 
(stretching this idea further, perhaps the one argument is a callable 
that takes a `Headers` instance and determines if it has gotten to big).

Then, perhaps, also give `HTTPFactory.__init__` (and therefore 
`Site.__init__` a `requestFactory` argument so that the request class 
can be replaced more easily (although setting the `requestFactory` 
attribute after creating an instance isn't *too* bad).

These two things combined make the usage pretty flexible while still 
being pretty simple and without involving any more complicated 
&quot;configuration&quot; system:

    def requestFactory(*args, **kwargs):
        kwargs[&quot;headerSizeLimit&quot;] = HeaderSizeLimit(
            maxLines=23, maxTotalBytes=57, ...)
        return Site.requestFactory(*args, **kwargs)

    site = Site(..., requestFactory=requestFactory)

If anyone is really interested in building (or adopting) a more general 
&quot;configuration&quot; system for Twisted then I suggest you start by looking 
up some of Twisted's past attempts including the the &quot;Coil&quot; library 
Itamar started (he'll have to provide a link, I've lost track of where 
it lives now).

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060571.html">[Twisted-Python] Configuration options for twisted code
</A></li>
	<LI>Next message (by thread): <A HREF="060573.html">[Twisted-Python] Configuration options for twisted code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60572">[ date ]</a>
              <a href="thread.html#60572">[ thread ]</a>
              <a href="subject.html#60572">[ subject ]</a>
              <a href="author.html#60572">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
