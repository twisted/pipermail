<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twistd and application framework questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twistd%20and%20application%20framework%20questions&In-Reply-To=%3C18900.59387.760567.695239%40jon.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051937.html">
   <LINK REL="Next"  HREF="051934.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twistd and application framework questions</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twistd%20and%20application%20framework%20questions&In-Reply-To=%3C18900.59387.760567.695239%40jon.es%3E"
       TITLE="[Twisted-Python] Twistd and application framework questions">terry at jon.es
       </A><BR>
    <I>Thu Apr  2 10:29:47 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051937.html">[Twisted-Python] Twistd and application framework questions
</A></li>
        <LI>Next message (by thread): <A HREF="051934.html">[Twisted-Python] official packaging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51941">[ date ]</a>
              <a href="thread.html#51941">[ thread ]</a>
              <a href="subject.html#51941">[ subject ]</a>
              <a href="author.html#51941">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Nadav, Itamar

&gt;&gt;&gt;&gt;&gt;<i> &quot;Itamar&quot; == Itamar Shtull-Trauring &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>&gt; writes:
</I>Itamar&gt; On Wed, 2009-04-01 at 13:16 -0400, Nadav Aharony wrote:

&gt;&gt;<i> 1) The program uses multiple UDP/TCP clients and servers that are
</I>&gt;&gt;<i> currently launched with reactor.listenTCP / UDP connectTCP/UDP etc. I've
</I>&gt;&gt;<i> been using MultiService, according to the twisted documentation.  Some
</I>&gt;&gt;<i> of these services were are at a top level of my app so it was easy to
</I>&gt;&gt;<i> turn that part into a .tac file and switch the reacor calls to
</I>&gt;&gt;<i> internet.TCPServer etc.  However, some of them are deep inside my code,
</I>&gt;&gt;<i> and are instantiated on the fly.
</I>
We (at Fluidinfo) have a similar situation, though I wouldn't say the
services that start/stop later are deeply buried. They're just not started
right away when startService is called on the MultiService via the plugin
mechanism.

&gt;&gt;<i> What is the &quot;right&quot; way to attach them to my service parent? (the part
</I>&gt;&gt;<i> with &quot;.setServiceParent(&lt;myMultiservice&gt;&quot;) Should I now add a pointer to
</I>&gt;&gt;<i> my MultiService that will be propagated down the code hierarchy to each
</I>&gt;&gt;<i> of these calls and be accessible at the inner scopes?  Is there a neater
</I>&gt;&gt;<i> way to do it just with importing the right modules?  (in the same way
</I>&gt;&gt;<i> that in usual twisted scripts the loaded reactor is a global reactor)
</I>
At the suggestion/insistence :-) of Esteve Fernandez, we do this by using
the components machinery of Twisted. You write an adaptor that knows how to
take the core of your service and adapt it to some other form of service
interface. The adaptor can have access to the original Multiservice, it can
provide startService and stopService methods that call into the special
service that you're trying to launch, etc.  It's nice because the
mechanisms for creating a new service and getting it hooked up to the
outside world, can be encapsulated in the adaptor and don't pollute the
code that's trying to just provide the underlying service (your &quot;business
logic&quot; I guess you'd call that :-))

BTW, we also have some service startup ordering constraints that we fixed
by subclassing Multiservice. There's a slow-motion thread on this approach,
so the jury's still out, but the code described here works fine for me:

  <A HREF="http://twistedmatrix.com/pipermail/twisted-python/2009-February/019225.html">http://twistedmatrix.com/pipermail/twisted-python/2009-February/019225.html</A>
  <A HREF="http://twistedmatrix.com/pipermail/twisted-python/2009-February/019249.html">http://twistedmatrix.com/pipermail/twisted-python/2009-February/019249.html</A>

Itamar&gt; 1. You don't need to attach to parents service, you can also call
Itamar&gt; start/stopService directly.

Itamar&gt; 2. You can still call &quot;self.port = reactor.listenTCP(...)&quot; directly
Itamar&gt; in a custom startService, and self.port.stopListening() in a custom
Itamar&gt; stopService. You don't have to use twisted.application.internet, it
Itamar&gt; doesn't add much beyond a little convenience.

Itamar&gt; The point of services is to encapsulate startup and shutdown logic,
Itamar&gt; not to make your life harder :)

The main reason I like to add the new service to the original Multiservice
is that its stopService gets called at the right time and I don't have to
think about it. That's a nice convenience.

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051937.html">[Twisted-Python] Twistd and application framework questions
</A></li>
	<LI>Next message (by thread): <A HREF="051934.html">[Twisted-Python] official packaging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51941">[ date ]</a>
              <a href="thread.html#51941">[ thread ]</a>
              <a href="subject.html#51941">[ subject ]</a>
              <a href="author.html#51941">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
