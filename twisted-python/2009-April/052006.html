<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adapt from more than one interface
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20adapt%20from%20more%20than%20one%20interface&In-Reply-To=%3C200904121108.23622.esteve%40sindominio.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052003.html">
   <LINK REL="Next"  HREF="052008.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adapt from more than one interface</H1>
    <B>Esteve Fernandez</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20adapt%20from%20more%20than%20one%20interface&In-Reply-To=%3C200904121108.23622.esteve%40sindominio.net%3E"
       TITLE="[Twisted-Python] adapt from more than one interface">esteve at sindominio.net
       </A><BR>
    <I>Sun Apr 12 03:08:23 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052003.html">[Twisted-Python] adapt from more than one interface
</A></li>
        <LI>Next message (by thread): <A HREF="052008.html">[Twisted-Python] adapt from more than one interface
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52006">[ date ]</a>
              <a href="thread.html#52006">[ thread ]</a>
              <a href="subject.html#52006">[ subject ]</a>
              <a href="author.html#52006">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

On Sunday 12 April 2009 02:31:29 <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:
&gt;<i> This is a long and terrible road you're about to start down.  It's hard
</I>&gt;<i> for me to explain exactly why it's so painful, but trust me, it is.
</I>
No, I won't trust you :-) I hope you don't take what I'm going to say too 
seriously, but you couldn't sound more patronising.

Anyway, if it's so hard to explain, it's probably harder to understand, and 
thus, it's something that you cannot figure out by yourself. So, if you don't 
mind, why do you think it's so bad?

&gt;<i> What you're doing now, passing out-of-band arguments to the IFooFactory
</I>&gt;<i> adapter, whose concrete type you are *not supposed to know* at that
</I>&gt;<i> point in the control flow, is bad.  But trying to force adaptation to
</I>&gt;<i> become full-fledged multimethods is worse.  If you want multimethods, I
</I>&gt;<i> believe PEAK provides a package that implements them.
</I>
I know it's bad, because the resulting factory is incomplete, but that's why I 
wanted to adapt from two objects: the service itself and something that would 
make the factory complete (i.e. some configuration parameters required by 
protocols).

The main problem I see with the current adapter registry, is that adapters 
aren't configurable. In our case, we have a bunch of services, which are 
exposed to AMQP (adapted into a factory that builds instances of the AMQP 
protocol class), but since this is a client protocol that needs some extra 
arguments that can't be set beforehand in the adapter (username, password, 
vhost, encoding), they are passed after the service has been adapted into a 
factory.

So the problem is that the resulting factory is not complete, it doesn't have 
enough information to build protocols. The only workaround is to explicitly 
set those extra parameters after it has been instantiated.

&gt;<i> If you want to keep doing what you're doing, you should do this:
</I>&gt;<i>
</I>&gt;<i> factory = MyServiceFooFactory(myService)
</I>&gt;<i> factory.configureBar(&quot;some value&quot;)
</I>&gt;<i>
</I>&gt;<i> i.e. don't ask for an adaptation which might give you an object without
</I>&gt;<i> a &quot;bar&quot; attribute, just create the concrete type that does what you need
</I>&gt;<i> based on the type of myService and configure it with explicitly
</I>&gt;<i> documented methods.  Although if I misunderstand the spec of
</I>&gt;<i> &quot;IFooFactory&quot; and it *does* include a bar attribute, nevermind.
</I>
The IFooFactory interface declares that attribute, but it's not immediately 
available when the service is adapted into a factory.

I fail to see what's the difference between bar= and configureBar() in this 
particular case. Interface attributes can be documented, so I don't see what 
makes configureBar better than bar (which can be turned into a property). 
Anyway, I think both solutions are flaky, so that's why I thought adapting 
two interfaces would be more elegant.

&gt;<i> If you want something more magical and adapter-ish, them maybe you want
</I>&gt;<i> this:
</I>&gt;<i>
</I>&gt;<i> IFooFactory(ConfigurationObject(myService, bar=&quot;some value&quot;))
</I>&gt;<i>
</I>&gt;<i> i.e. by the time you are getting around to the IFooFactory adaptation,
</I>&gt;<i> you should have an object that fully provides enough information that
</I>&gt;<i> the concrete FooFactory adapter type can be fully initialized when it is
</I>&gt;<i> created.
</I>
I think that solution is even worse. That particular instance of 
ConfigurationObject is tied to myService: it can't be (de)serialized, reused 
with other adapters, ConfigurationObject and MyService are completely 
unrelated and I don't think the former should depend on the latter.

&gt;<i> &gt;In order to implement this, registerAdapter would have to be able to
</I>&gt;<i> &gt;take a
</I>&gt;<i> &gt;tuple of interfaces, like this:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;components.registerAdapter(
</I>&gt;<i> &gt;    AdaptToFactory,
</I>&gt;<i> &gt;    (IFooService, IConfigurationDescriptor),
</I>&gt;<i> &gt;    IFooFactory)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;would that feature make sense? If so, I'll file an issue right now :-)
</I>&gt;<i>
</I>&gt;<i> Unfortunately, much as I've been encouraging people to file tickets
</I>&gt;<i> lately, no :).  I don't think it makes sense.
</I>
I still think it does, but nobody wants to make the ticket count grow 
higher :-) Anyway, Zope already has this nifty thing called multi-adapters, 
which implement exactly what I described:

<A HREF="http://www.muthukadan.net/docs/zca.html#multi-adapter">http://www.muthukadan.net/docs/zca.html#multi-adapter</A>

but I always liked Twisted's adapter registry better and our application 
already uses it in quite a few places. I like being able to call IFoo(bar) 
and let the registry lookup an adapter automatically, instead of having to 
call getAdapter()/queryAdapter()

Cheers.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052003.html">[Twisted-Python] adapt from more than one interface
</A></li>
	<LI>Next message (by thread): <A HREF="052008.html">[Twisted-Python] adapt from more than one interface
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52006">[ date ]</a>
              <a href="thread.html#52006">[ thread ]</a>
              <a href="subject.html#52006">[ subject ]</a>
              <a href="author.html#52006">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
