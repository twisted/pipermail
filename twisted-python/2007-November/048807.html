<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Two main loops
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Two%20main%20loops&In-Reply-To=%3Cop.t1o4srsfz3pzfc%40nitrogenycs2%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048806.html">
   <LINK REL="Next"  HREF="048813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Two main loops</H1>
    <B>Nitro</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Two%20main%20loops&In-Reply-To=%3Cop.t1o4srsfz3pzfc%40nitrogenycs2%3E"
       TITLE="[Twisted-Python] Two main loops">nitro at dr-code.org
       </A><BR>
    <I>Mon Nov 12 13:35:05 MST 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048806.html">[Twisted-Python] Two main loops
</A></li>
        <LI>Next message (by thread): <A HREF="048813.html">[Twisted-Python] Two main loops
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48807">[ date ]</a>
              <a href="thread.html#48807">[ thread ]</a>
              <a href="subject.html#48807">[ subject ]</a>
              <a href="author.html#48807">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Am 12.11.2007, 21:15 Uhr, schrieb Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt;:

&gt;&gt;<i> The OS is responsible to break everything down into individual tcp  
</I>&gt;&gt;<i> packets and  puzzle them together at the other end. The whole packet  
</I>&gt;&gt;<i> thing is not  visible to pb.
</I>&gt;<i>
</I>&gt;<i> True, but the actual performance bottleneck here is in PB's conversion of
</I>&gt;<i> Python objects to strings, which is done by code entirely within Twisted.
</I>
Yes.

&gt;&gt;<i> So if you want pb to split your data, then do splitted  callRemotes.
</I>&gt;&gt;<i> It's not desirable because you don't want your program to be stalled at  
</I>&gt;&gt;<i> uncontrollable times when the OS decides to send 20 tcp packets at once.
</I>&gt;<i>
</I>&gt;<i> Your program won't ever stall because of this.
</I>
If you do it as Jesper suggested and serialize when packets are about to  
be send then it will stall when you try to send (=serialize) lots of  
packets at once.

&gt;&gt;<i> You want to spread the load as evenly as possible and you'll have to do  
</I>&gt;&gt;<i> this manually.
</I>&gt;<i>
</I>&gt;<i> PB's serializer could try very hard to avoid running for a long period of
</I>&gt;<i> time without giving control back to the reactor.  Of course, someone  
</I>&gt;<i> would
</I>&gt;<i> have to implement this.  Whether or not that is worthwhile to implement,
</I>&gt;<i> instead of doing what Glyph suggested (manually breaking up the work into
</I>&gt;<i> smaller pieces) is a separate question.
</I>
Of course you can do it. But does it make sense? If you ask pb to do lots  
of work then you can't be surprised it takes long. If I ask pb to  
serialize things I want it to do it *now*. If pb starts distributing work  
over time itself then I will end up with lags which are bad in my  
situation.
I'd like to hear about the actual situation where twisted is stalling  
because of serialization. As said before I am using pb and a pb-like thing  
which also uses banana for serialization (= even more overhead to generate  
messages and spread them over multiple udp packets). I am serializing lots  
of data and it works like a charm. After all if you have so much data to  
serialize then you are very likely to do something with the data on the  
sending and receiving end. And this processing is much more likely to be a  
performance bottleneck than twisted serialization.
I guess we can discuss a lot about how pb *could* work. We should keep in  
mind real world situations though which tend to shift priorities a lot.

-Matthias


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048806.html">[Twisted-Python] Two main loops
</A></li>
	<LI>Next message (by thread): <A HREF="048813.html">[Twisted-Python] Two main loops
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48807">[ date ]</a>
              <a href="thread.html#48807">[ thread ]</a>
              <a href="subject.html#48807">[ subject ]</a>
              <a href="author.html#48807">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
