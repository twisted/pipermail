<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Advise for heavy concurrency
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advise%20for%20heavy%20concurrency&In-Reply-To=%3C072b01c833aa%24b4d05c30%241e711490%24%40com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048884.html">
   <LINK REL="Next"  HREF="048892.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Advise for heavy concurrency</H1>
    <B>Alec Matusis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Advise%20for%20heavy%20concurrency&In-Reply-To=%3C072b01c833aa%24b4d05c30%241e711490%24%40com%3E"
       TITLE="[Twisted-Python] Advise for heavy concurrency">matusis at yahoo.com
       </A><BR>
    <I>Fri Nov 30 16:42:44 MST 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048884.html">[Twisted-Python] Advise for heavy concurrency
</A></li>
        <LI>Next message (by thread): <A HREF="048892.html">[Twisted-Python] Advise for heavy concurrency
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48894">[ date ]</a>
              <a href="thread.html#48894">[ thread ]</a>
              <a href="subject.html#48894">[ subject ]</a>
              <a href="author.html#48894">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> What causes the CPU overload in such a case
</I>
It looks like the for loop that loops over connections to send the message is the main source of the load. The biggest problem is not the CPU however. When the process takes more than 70% of the CPU (as displayed by top), python seems to start skipping garbage collection, and the memory size of the process just keeps growing. We have no control over this.

&gt;<i> I doubt I'll be running 4 heavy cpu-bound processes on a 4-core
</I>&gt;<i> system
</I>
Running 4 servers on a 4-core box seems fine, it leaves plenty of resources for system tasks and logging, as long as as long as they are not at 99% CPU each, but I doubt you will get them to run at 99% because of the said memory problem.

&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:twisted-python-
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bounces at twistedmatrix.com</A>] On Behalf Of Atilla
</I>&gt;<i> Sent: Thursday, November 29, 2007 10:47 AM
</I>&gt;<i> To: Twisted general discussion
</I>&gt;<i> Subject: Re: [Twisted-Python] Advise for heavy concurrency
</I>&gt;<i> 
</I>&gt;<i> I doubt I'll be running 4 heavy cpu-bound processes on a 4-core
</I>&gt;<i> system, I'd prefer to leave 1 core &quot;free&quot; for all the rest of
</I>&gt;<i> monitoring/logging tasks.
</I>&gt;<i> 
</I>&gt;<i> What causes the CPU overload in such a case? Currently I keep a custom
</I>&gt;<i> many-to-many like structure, which has O(1) access time and need to
</I>&gt;<i> forward the same message to N clients that are returned from that
</I>&gt;<i> structure, for each incoming packet, at worst. I could potentially
</I>&gt;<i> pre-pack the exact network message to avoid generating it for each of
</I>&gt;<i> them, which at this point is the largest overhead. Although I'm not
</I>&gt;<i> sure how much I can save like that.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048884.html">[Twisted-Python] Advise for heavy concurrency
</A></li>
	<LI>Next message (by thread): <A HREF="048892.html">[Twisted-Python] Advise for heavy concurrency
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48894">[ date ]</a>
              <a href="thread.html#48894">[ thread ]</a>
              <a href="subject.html#48894">[ subject ]</a>
              <a href="author.html#48894">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
