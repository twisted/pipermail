<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] connectionLost issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20connectionLost%20issue&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016351.html">
   <LINK REL="Next"  HREF="016353.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] connectionLost issue</H1>
    <B>Mark Papazyan</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20connectionLost%20issue&In-Reply-To="
       TITLE="[Twisted-Python] connectionLost issue">Mark.Papazyan at gmx.de
       </A><BR>
    <I>Thu Nov 22 03:27:19 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="016351.html">[Twisted-Python] Seeking freelance twisted programmer to work on	museum exhibit ...
</A></li>
        <LI>Next message: <A HREF="016353.html">[Twisted-Python] connectionLost issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16352">[ date ]</a>
              <a href="thread.html#16352">[ thread ]</a>
              <a href="subject.html#16352">[ subject ]</a>
              <a href="author.html#16352">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

i'm currently writing distributed system consisted of several components,
which have both input and output ports. To solve the initial startup
problem i simply use the retry approach: as soon as my components are
initialized the try to connect to their peers in a loop.
The problem is that the connectionLost function is not called for each
Factories independently, but stops callbacking as soon as my component
receives an incoming connection (although, the function belongs to the
class responsible for the outgoing connection). Thus, the component
assumes it has found all its peers, although only incoming connection is
initiated, not the outgoing. Is there a way to tell the framework to
handle the connection lost events for each Factory/Protocol objects
separately?

The code is trivial:


class InputSession(Factory):

   def start(self):
       reactor.listenTCP(self.port, self)

   def startedConnecting(self, connector):
       print 'Started to connect.'


   def buildProtocol(self, addr):
       print 'Connected.'
       self.connector = InputConnector(self)
       return self.connector


   def clientConnectionLost(self, connector, reason):
       print 'Lost connection. Reason:', reason


   def clientConnectionFailed(self, connector, reason):
       print 'Connection failed. Reason:', reason

################################################################################

class InputConnector(Protocol):

   def __init__(self, session):
       self.session = session

   def connectionMade(self):
       print &quot;Connection established&quot;

   def connectionLost(self, reason):
       print &quot;Connection lost&quot;

   def dataReceived(self, input_stream):
       print &quot;Receiving: &quot; + input_stream



################################################################################

class OutputConnector (Protocol):

   def __init__(self, session):
       self.session = session


   def sendStream(self, stream):
       self.transport.writeSomeData(stream)

   def clientConnectionLost(self, connector, reason):
       print 'Lost connection.'# Reason:', reason



################################################################################

class OutputSession(ClientFactory):

   def start(self):
       reactor.connectTCP(self.host, self.port, self)


   def buildProtocol(self, addr):
       print 'Connected.'
       self.curr_tries = 0
       self.connector = OutputConnector(self)

       return self.connector

   def clientConnectionLost(self, connector, reason):
       print 'Lost connection.'# Reason:', reason

       self.curr_tries = self.curr_tries + 1

       print &quot;Trying to reconnect: %d&quot; % self.curr_tries
       connector.connect()

   def clientConnectionFailed(self, connector, reason):
       print 'Connection failed.'# Reason:', reason

       self.curr_tries = self.curr_tries + 1

       connector.connect()


Best Regards,
Mark Papazyan
-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: <A HREF="http://www.gmx.net/de/go/freemail">http://www.gmx.net/de/go/freemail</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016351.html">[Twisted-Python] Seeking freelance twisted programmer to work on	museum exhibit ...
</A></li>
	<LI>Next message: <A HREF="016353.html">[Twisted-Python] connectionLost issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16352">[ date ]</a>
              <a href="thread.html#16352">[ thread ]</a>
              <a href="subject.html#16352">[ subject ]</a>
              <a href="author.html#16352">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
