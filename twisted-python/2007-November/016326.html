<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Timing problem with PB Broker's connectionReady
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Timing%20problem%20with%20PB%20Broker%27s%20connectionReady&In-Reply-To=af7fad5b0711140735p4eb369f7x10fba00f77c6082a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016323.html">
   <LINK REL="Next"  HREF="016337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Timing problem with PB Broker's connectionReady</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Timing%20problem%20with%20PB%20Broker%27s%20connectionReady&In-Reply-To=af7fad5b0711140735p4eb369f7x10fba00f77c6082a%40mail.gmail.com"
       TITLE="[Twisted-Python] Timing problem with PB Broker's connectionReady">exarkun at divmod.com
       </A><BR>
    <I>Wed Nov 14 16:22:14 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="016323.html">[Twisted-Python] Timing problem with PB Broker's connectionReady
</A></li>
        <LI>Next message: <A HREF="016337.html">[Twisted-Python] Timing problem with PB Broker's connectionReady
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16326">[ date ]</a>
              <a href="thread.html#16326">[ thread ]</a>
              <a href="subject.html#16326">[ subject ]</a>
              <a href="author.html#16326">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 14 Nov 2007 16:35:09 +0100, Alan Franzoni &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">alan.franzoni.xyz at gmail.com</A>&gt; wrote:
&gt;<i>Hello everybody,
</I>&gt;<i>I'm running Twisted 2.5 on 32-bit Ubuntu Linux (tested with both Feisty and
</I>&gt;<i>Gutsy) and python2.5. All packages are the distro's own ones.
</I>&gt;<i>
</I>&gt;<i>I'm experiencing a small problem with the broker's connectionReady method on
</I>&gt;<i>the server side of the PB connection. It's not huge and doesn't cause
</I>&gt;<i>problems in real-world applications, but it's making more difficult for me
</I>&gt;<i>to write a proper unit test.
</I>&gt;<i>
</I>&gt;<i> According to the docs, connectionReady is called as soon as Banana
</I>&gt;<i>negotiation is done. This is true on the client side; connectionReady gets
</I>&gt;<i>called before the client can get the root object from the server.
</I>&gt;<i>
</I>&gt;<i>But this is not true on the server side; as you can see from the printout of
</I>&gt;<i>the attached file, the client says it already has got the server's root
</I>&gt;<i>object but the connectionready hasn't been called on the server yet.
</I>&gt;<i>
</I>&gt;<i>In order to be sure connectionReady has been called on the server side, I
</I>&gt;<i>must trigger an additional callRemote.
</I>&gt;<i>
</I>
It's not triggered by the callRemote - the callRemote just keeps the example
program running long enough so that the server side actually has a chance
to get to connectionReady.

This is because there's no network activity required in between the client's
connectionReady call and the Deferred returned by getRootObject firing.
Since the client gets connectionReady first, without the callRemote (or
something else to prevent the process from exiting right away), the server
never receives the dialect negotiation response, so it never calls
connectionReady - as far as it is concerned, the connection never *is*
ready.

&gt;<i>I suppose there's some sort of caching or lazy behaviour implied here. Did I
</I>&gt;<i>do something wrong? How can I force connectionReady to be called on the
</I>&gt;<i>server side *before* the client can actually fetch the root object's
</I>&gt;<i>remotereference?
</I>
You can't, as PB is currently implemented.  I'm not sure you really need
this, though.  Can you describe the difficulty you've had writing unit
tests?

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016323.html">[Twisted-Python] Timing problem with PB Broker's connectionReady
</A></li>
	<LI>Next message: <A HREF="016337.html">[Twisted-Python] Timing problem with PB Broker's connectionReady
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16326">[ date ]</a>
              <a href="thread.html#16326">[ thread ]</a>
              <a href="subject.html#16326">[ subject ]</a>
              <a href="author.html#16326">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
