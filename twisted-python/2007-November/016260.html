<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] mktap/twistd in a Windows service
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20mktap/twistd%20in%20a%20Windows%20service&In-Reply-To=fgl0q5%2470i%241%40ger.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016259.html">
   <LINK REL="Next"  HREF="016264.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] mktap/twistd in a Windows service</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20mktap/twistd%20in%20a%20Windows%20service&In-Reply-To=fgl0q5%2470i%241%40ger.gmane.org"
       TITLE="[Twisted-Python] mktap/twistd in a Windows service">exarkun at divmod.com
       </A><BR>
    <I>Sun Nov  4 16:23:52 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="016259.html">[Twisted-Python] Re: mktap/twistd in a Windows service
</A></li>
        <LI>Next message: <A HREF="016264.html">[Twisted-Python] Re: mktap/twistd in a Windows service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16260">[ date ]</a>
              <a href="thread.html#16260">[ thread ]</a>
              <a href="subject.html#16260">[ subject ]</a>
              <a href="author.html#16260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 04 Nov 2007 17:52:35 +0000, Paul Moore &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">pf_moore at yahoo.co.uk</A>&gt; wrote:
&gt;<i>I know this is a FAQ, but it's not in the FAQ list and I've had no luck 
</I>&gt;<i>finding a good answer via web or list searches (Windows is a lousy search 
</I>&gt;<i>term, and service isn't much use in a Twisted context...)
</I>&gt;<i>
</I>&gt;<i>I want to run a tiny non-authoritative DNS server on my PC. I've never done 
</I>&gt;<i>this before, but twisted names looks ideal. The documentation 
</I>&gt;<i>(<A HREF="http://twistedmatrix.com/projects/names/documentation/howto/names.html">http://twistedmatrix.com/projects/names/documentation/howto/names.html</A>) 
</I>&gt;<i>says I just need to do
</I>&gt;<i>
</I>&gt;<i>     mktap dns --recursive --cache
</I>&gt;<i>     twistd -f dns.tap
</I>&gt;<i>
</I>
In recent versions of Twisted, you can simplify the above to this:

    twistd dns --recursive --cache

This skips the tap phase: it creates the same application mktap would have
created, but instead of putting it in the tap file, it just runs it.

&gt;<i>and indeed this works fine. I seem to recall some time ago seeing postings 
</I>&gt;<i>to the effect that tap format files were out of favour, but I don't follow 
</I>&gt;<i>the twisted list much, so I don't know if this is still true. Nevertheless, 
</I>&gt;<i>it works so who cares?
</I>
Quite so.

&gt;<i>
</I>&gt;<i>However, I want to run this as a Windows service. Ideally, twistd would have 
</I>&gt;<i>a --install-service flag or something, but it doesn't so I went looking, and 
</I>&gt;<i>found postings covering tap2ntsvc which creates services from tap files, but 
</I>&gt;<i>it seems to have been replaced by ntsvc, which only handles .tac files :-(
</I>
It would be very excellent if twistd had a --install-service flag.  There is
a relatively minimal level of interest in Windows-specific functionality
among the currently active Twisted developers, though.  This means that it
isn't very likely that any of us will undertake to add this feature.

That doesn't mean that we'll never implement it, nor that we wouldn't accept
a patch which implements it from someone else who is more interested in it
than we are.  If someone provides the functionality, with unit tests, then
we'll gladly incorporate and maintain it.  I'm not sure if you would be
interested in doing this work or not;  I'm directing this as much at you as
at all of the other users of Twisted on Windows who I know are out there and
mostly remain silently.

&gt;<i>
</I>&gt;<i>I get the impression that the idea is that .tac files are easy to create by 
</I>&gt;<i>hand, but as I know *nothing* about twisted names (and don't really want to 
</I>&gt;<i>- all I want is to run a DNS server!) it's not as easy as it might be...
</I>
They are, more or less, although they are harder to make than tap files. ;)

&gt;<i>
</I>&gt;<i>So, can someone tell me:
</I>&gt;<i>
</I>&gt;<i>1. What is the currently favoured form for Twisted application files?
</I>
It all depends on the use-case.  For all of the services distributed with
Twisted itself, tap files offer very little over the persistence-free form
of twistd I gave an example of above.  Since tap files contain pickled data,
they have all the problems of pickle (lack of introspectability, problems
with compatibility, security); if these aren't problems, then tap files
might be okay.  On the other hand, many uses of twistd don't actually need
any persistence, so using tap files doesn't actually provide any benefits.

&gt;<i>2. How do I make one for twisted names (the equivalent of the mktap line 
</I>&gt;<i>above) and better still how do I generalise this for any mktap command?
</I>
See twisted.names.tap.makeService - this is the function `mktap dns&#180; is
calling to create the object it will pickle into the tap file.  Your tac
file can call it directly with the desired configuration and add the
resulting service to an application object.  This will give you a tac
which does the same thing as your mktap-produced tap file.  You can
read more about writing tac files here:

  <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/application.html">http://twistedmatrix.com/projects/core/documentation/howto/application.html</A>

&gt;<i>3. How do I run it? (twistd, presumably)
</I>
As you said below, twistd -noy.

&gt;<i>4. How do I make that file run as a Windows service?
</I>&gt;<i>
</I>
I've never used ntsvc, so I can't say if that's right, but presumably
it is at least close.

There isn't any reason that if ntsvc works with tac files it couldn't
also work with tap files, though.  So another solution might be to explore
adding tap file support to ntsvc.  The interface for loading a tac file is
really the same as the interface for loading a tap file, in fact, so I am
slightly surprised ntsvc doesn't work with tap files.

&gt;<i>
</I>&gt;<i>I believe, from what I've found, that the answers are:
</I>&gt;<i>1. .tac
</I>&gt;<i>2. Don't know - not sure there's a generic answer.
</I>&gt;<i>3. twistd -noy
</I>&gt;<i>4. ntsvc
</I>&gt;<i>
</I>&gt;<i>In which case, the documentation really needs to be updated to explain .tac 
</I>&gt;<i>files throughout, instead of mktap. And I need someone to write me a dns.tac 
</I>&gt;<i>file :-(
</I>&gt;<i>
</I>&gt;<i>Ideally, this should be written up as a FAQ or HOWTO somewhere. I'll 
</I>&gt;<i>volunteer to write it up, as long as someone will maintain it - I'm not in a 
</I>&gt;<i>position to do so (I use twisted occasionally, but have no need or desire to 
</I>&gt;<i>follow development versions or discussions on the list). I don't want to 
</I>&gt;<i>bother doing a write-up, if it won't get included in the docs/FAQ and 
</I>&gt;<i>maintained, though...
</I>
Anything (accurate, coherent) you want to write up we'd be glad to add to
the Twisted repository and include on the website, in releases, etc.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016259.html">[Twisted-Python] Re: mktap/twistd in a Windows service
</A></li>
	<LI>Next message: <A HREF="016264.html">[Twisted-Python] Re: mktap/twistd in a Windows service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16260">[ date ]</a>
              <a href="thread.html#16260">[ thread ]</a>
              <a href="subject.html#16260">[ subject ]</a>
              <a href="author.html#16260">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
