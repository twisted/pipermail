<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Two main loops
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Two%20main%20loops&In-Reply-To=op.t1o0sfo0z3pzfc%40nitrogenycs2">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016297.html">
   <LINK REL="Next"  HREF="016299.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Two main loops</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Two%20main%20loops&In-Reply-To=op.t1o0sfo0z3pzfc%40nitrogenycs2"
       TITLE="[Twisted-Python] Two main loops">exarkun at divmod.com
       </A><BR>
    <I>Mon Nov 12 15:15:47 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="016297.html">[Twisted-Python] Two main loops
</A></li>
        <LI>Next message: <A HREF="016299.html">[Twisted-Python] Two main loops
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16298">[ date ]</a>
              <a href="thread.html#16298">[ thread ]</a>
              <a href="subject.html#16298">[ subject ]</a>
              <a href="author.html#16298">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 12 Nov 2007 20:08:29 +0100, Nitro &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nitro at dr-code.org</A>&gt; wrote:
&gt;<i>Am 12.11.2007, 19:47 Uhr, schrieb Jasper &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jasper at peak.org</A>&gt;:
</I>&gt;&gt;<i>To get to the point, I actually do feel that the fault lies with  Twisted, 
</I>&gt;&gt;<i>or more specifically PB.  Code using PB wants to be as unaware  of the 
</I>&gt;&gt;<i>details of network transmission as possible.  It certainly  doesn't want to 
</I>&gt;&gt;<i>slice things into a bazillion chunks for individual  transmission, and then 
</I>&gt;&gt;<i>puzzle them back together on the other end.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>IMHO it makes more sense for PB to understand it shouldn't block, and to 
</I>&gt;&gt;<i>chunk and schedule its serialization (and unserialization) in the same 
</I>&gt;&gt;<i>manner as the TCP packets sent underneath.  I'm guessing this would make 
</I>&gt;&gt;<i>for cleaner separation, and more general usefulness.
</I>&gt;<i>
</I>&gt;<i>I think this is a) not possible and b) not desirable.
</I>
I think it's possible.  It may even be desirable, although whether it is
worth the cost of implementing or not is a question worth considering.

&gt;<i>It's not possible 
</I>&gt;<i>because pb sends a single large chunk of data over tcp.
</I>
It doesn't have to be implemented this way.  However, this isn't
particularly relevant.  ITCPTransport.write takes approximately the same
amount of time to execute and return whether you pass it a string which is
one byte long or one million bytes long.

&gt;<i>The OS is 
</I>&gt;<i>responsible to break everything down into individual tcp packets and  puzzle 
</I>&gt;<i>them together at the other end. The whole packet thing is not  visible to 
</I>&gt;<i>pb.
</I>
True, but the actual performance bottleneck here is in PB's conversion of
Python objects to strings, which is done by code entirely within Twisted.

&gt;<i>So if you want pb to split your data, then do splitted  callRemotes.
</I>&gt;<i>It's not desirable because you don't want your program to be stalled at 
</I>&gt;<i>uncontrollable times when the OS decides to send 20 tcp packets at once. 
</I>
Your program won't ever stall because of this.

&gt;<i>You want to spread the load as evenly as possible and you'll have to do 
</I>&gt;<i>this manually.
</I>
PB's serializer could try very hard to avoid running for a long period of
time without giving control back to the reactor.  Of course, someone would
have to implement this.  Whether or not that is worthwhile to implement,
instead of doing what Glyph suggested (manually breaking up the work into
smaller pieces) is a separate question.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016297.html">[Twisted-Python] Two main loops
</A></li>
	<LI>Next message: <A HREF="016299.html">[Twisted-Python] Two main loops
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16298">[ date ]</a>
              <a href="thread.html#16298">[ thread ]</a>
              <a href="subject.html#16298">[ subject ]</a>
              <a href="author.html#16298">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
