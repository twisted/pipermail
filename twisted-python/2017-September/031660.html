<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] verilog simulation calling out to twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20verilog%20simulation%20calling%20out%20to%20twisted&In-Reply-To=%3CCAPY2A7Op1duKKzvwNBh2H3%3Djq-4pfXO1NYucqZeRUDyQXaVppw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031657.html">
   <LINK REL="Next"  HREF="031659.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] verilog simulation calling out to twisted</H1>
    <B>Bryan Murdock</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20verilog%20simulation%20calling%20out%20to%20twisted&In-Reply-To=%3CCAPY2A7Op1duKKzvwNBh2H3%3Djq-4pfXO1NYucqZeRUDyQXaVppw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] verilog simulation calling out to twisted">bmurdock at gmail.com
       </A><BR>
    <I>Thu Sep 21 12:31:00 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031657.html">[Twisted-Python] verilog simulation calling out to twisted
</A></li>
        <LI>Next message (by thread): <A HREF="031659.html">[Twisted-Python] Twisted 17.5 vs txkube
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31660">[ date ]</a>
              <a href="thread.html#31660">[ thread ]</a>
              <a href="subject.html#31660">[ subject ]</a>
              <a href="author.html#31660">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Sep 21, 2017 at 4:07 AM, ex vito &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ex.vitorino at gmail.com</A>&gt; wrote:
&gt;<i> On 2017-09-20, at 22:33, Bryan Murdock &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bmurdock at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Welcome to the club! :)
</I>
Thanks!

&gt;&gt;<i> Now I have a crazy idea.  I'd like that Python code that my Verilog
</I>&gt;&gt;<i> calls out to to use twisted.  OK, actually I've already done that, my
</I>&gt;&gt;<i> Verilog calls out to my that TCP server that I wrote.  I had to spawn
</I>&gt;&gt;<i> a thread and run the server in that thread so that the Verilog could
</I>&gt;&gt;<i> continue to do stuff in parallel with the server.  It's working great.
</I>&gt;<i>
</I>&gt;<i> Can you clarify what &quot;your Verilog&quot; is? Python code running a Verilog simulation, maybe? Something else?
</I>&lt;snip/&gt;
&gt;<i> I do not fully understand this: if &quot;Verilog calls out to TCP server&quot; means it establishes a TCP connection (does it?) what does &quot;Verilog calls out to a TCP client&quot; mean? Does it call a function/method with async Twisted code? How does it handle the fact that the result is async?
</I>
Sorry, I was worried that this would be too hard to explain and/or I
may be giving too many details and confusing the issue.  Let me try
again.  It's probably simplest to think of the whole simulation as a
TCP proxy.  It looks like this:

some TCP client process &lt;--&gt; Python TCP Server &lt;--&gt; Verilog &lt;--&gt;
Python TCP Client &lt;--&gt; some TCP server

The Verilog, Python TCP server, and Python TCP client are all running
in the same process (some TCP client and some TCP server can be a web
browser and web server or whatever).  The Verilog code starts up,
calls a python function to start the Python TCP Server as a thread,
calls another python function to start the Python TCP Client as a
thread, and then essentially just loops asking (polling) the Python
TCP Server if it has any data, if so, it calls a function to send that
data to the Python TCP Client.  It does the same in reverse to flow
data from client to server.

I originally wrote the Python TCP Client and Server as low-level
socket code, handling only one connection at a time and not
automatically reconnecting if a connection was lost.  All the
downsides of using multiple processes instead of threads that you
listed are exactly the reasons I used threads.  Verilog has no support
for spawning subprocesses or doing interprocess communication.  It
can't spawn threads either, to be fair though[1].  I have to do &quot;real
programming&quot; things like that by calling python functions.  Threads
just seemed easier at the time because I can just use a Queue to get
data to/from the server and client threads from/to the Verilog.  And
it all worked great.

Then, when I went to add support for multiple connections and
auto-reconnects I discovered twisted.  I rewrote the Python TCP server
and client with twisted but now data doesn't flow.  I assume that's
because the client and server are making thread-unsafe calls to the
reactor.  Is that true?

(By the way, I can run the client and server standalone as separate
processes, without verilog involved, and they work fine that way.  I
have also replaced the twisted Python TCP Client with my original
socket-based TCP client and everything works fine.  It's just when I
try to use twisted for both client and server that it fails).

&gt;<i> In general you are able to run concurrent (not parallel) code for TCP clients and servers within the same thread - after all, that's the key idea behind async programming with Twisted, with the reactor driving concurrent handling of multiple connections and events.
</I>
Right, I think the solution is going to have to be: have verilog spawn
one thread that runs the Python TCP Server and Client.  Or start them
both as subprocesses and figure out how to communicate with them, I
guess.

Bryan

1. Aside from it's &quot;green threads&quot; that it uses to model concurrent
digital logic

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031657.html">[Twisted-Python] verilog simulation calling out to twisted
</A></li>
	<LI>Next message (by thread): <A HREF="031659.html">[Twisted-Python] Twisted 17.5 vs txkube
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31660">[ date ]</a>
              <a href="thread.html#31660">[ thread ]</a>
              <a href="subject.html#31660">[ subject ]</a>
              <a href="author.html#31660">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
