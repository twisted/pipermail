<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] verilog simulation calling out to twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20verilog%20simulation%20calling%20out%20to%20twisted&In-Reply-To=%3C4C1BFA94-0D0B-4594-99A1-4C32D36CAD29%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031655.html">
   <LINK REL="Next"  HREF="064121.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] verilog simulation calling out to twisted</H1>
    <B>ex vito</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20verilog%20simulation%20calling%20out%20to%20twisted&In-Reply-To=%3C4C1BFA94-0D0B-4594-99A1-4C32D36CAD29%40gmail.com%3E"
       TITLE="[Twisted-Python] verilog simulation calling out to twisted">ex.vitorino at gmail.com
       </A><BR>
    <I>Thu Sep 21 04:07:19 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031655.html">[Twisted-Python] verilog simulation calling out to twisted
</A></li>
        <LI>Next message (by thread): <A HREF="064121.html">[Twisted-Python] verilog simulation calling out to twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64118">[ date ]</a>
              <a href="thread.html#64118">[ thread ]</a>
              <a href="subject.html#64118">[ subject ]</a>
              <a href="author.html#64118">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2017-09-20, at 22:33, Bryan Murdock &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bmurdock at gmail.com</A>&gt; wrote:

&gt;<i> I've been writing Verilog simulations for years, and tinkering with
</I>&gt;<i> Python for years.  In the last couple years I have been calling out to
</I>&gt;<i> Python from Verilog simulations, which has been awesome.  Just this
</I>&gt;<i> week I tried twisted out for the first time to write a simple custom
</I>&gt;<i> TCP server.  It was a great experience and even though I still know
</I>&gt;<i> next to nothing about twisted, I think I'm in love :-)
</I>
Welcome to the club! :)


&gt;<i> Now I have a crazy idea.  I'd like that Python code that my Verilog
</I>&gt;<i> calls out to to use twisted.  OK, actually I've already done that, my
</I>&gt;<i> Verilog calls out to my that TCP server that I wrote.  I had to spawn
</I>&gt;<i> a thread and run the server in that thread so that the Verilog could
</I>&gt;<i> continue to do stuff in parallel with the server.  It's working great.
</I>
Can you clarify what &quot;your Verilog&quot; is? Python code running a Verilog simulation, maybe? Something else?


&gt;<i> The real crazy thing I want is for the Verilog to call out to a
</I>&gt;<i> twisted TCP client as well.  Again, I need the client and server to
</I>&gt;<i> not block the Verilog.  My first attempt was to run client and server
</I>&gt;<i> in two separate threads.  I start the server thread, then I start the
</I>&gt;<i> client thread and only in the client thread do I call reactor.run().
</I>&gt;<i> It seems to not be working.  Before I try to figure out why, I thought
</I>&gt;<i> I might ask here if it even should work.
</I>
I do not fully understand this: if &quot;Verilog calls out to TCP server&quot; means it establishes a TCP connection (does it?) what does &quot;Verilog calls out to a TCP client&quot; mean? Does it call a function/method with async Twisted code? How does it handle the fact that the result is async?

In general you are able to run concurrent (not parallel) code for TCP clients and servers within the same thread - after all, that's the key idea behind async programming with Twisted, with the reactor driving concurrent handling of multiple connections and events.

Of course, again, in general, you'll want your code not to block and to do its things as fast as possible so that control can be returned to the reactor (so that it is ready to quickly handle other events).

A few notes about threads and Twisted:
- IIRC the reactor should (must?) be running on the main thread.
- Threads are a good fit to call out to &quot;I/O blocking code&quot; from Twisted.
  (talking to a database or doing heavy disk I/O, for example)

A few notes about threads and Python:
- Python (CPython that is) does not run two CPU-bound threads in parallel.
  (IOW, it can't simultaneously use two CPUs/CPU-cores in the system)
- That's due to the GIL: there's lot's of information about it on the internet.
- You will get lower I/O responsiveness even with a single CPU-bound + one I/O bound thread.


If &quot;Verilog&quot; needs to continue working and is, I assume, CPU-bound, you will probably be better off by having that run in a process and your Twisted code in a single-threaded separate process.

Benefits:
- Better separation of concerns.
- No mixing of sync/async code which at times can lead to complex design/code.
- No shared memory between &quot;Verilog&quot; and Twisted code.
- &quot;Verilog&quot; can use as much CPU as it needs.
- &quot;Twisted&quot; will be as responsive as possible.
- Easier to test.

Costs:
- Need to define how to start both processes.
- Need to define how those processes communicate.
- All communication between processes needs to be serialized (no shared memory).


These are a few general ideas you may want to consider. Like I said, I couldn't fully grasp where you're currently at and what exactly you're trying to achieve but hopefully these comments will serve as guidance.

Cheers,
--
exvito


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031655.html">[Twisted-Python] verilog simulation calling out to twisted
</A></li>
	<LI>Next message (by thread): <A HREF="064121.html">[Twisted-Python] verilog simulation calling out to twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64118">[ date ]</a>
              <a href="thread.html#64118">[ thread ]</a>
              <a href="subject.html#64118">[ subject ]</a>
              <a href="author.html#64118">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
