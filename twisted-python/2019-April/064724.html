<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop/start%20client%20connections%20with%0A%20loseConnection%20in%20ReconnectingClientFactory&In-Reply-To=%3C2a440c68-4512-bb31-0268-8109e9062db7%40withers.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory</H1>
    <B>Chris Withers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop/start%20client%20connections%20with%0A%20loseConnection%20in%20ReconnectingClientFactory&In-Reply-To=%3C2a440c68-4512-bb31-0268-8109e9062db7%40withers.org%3E"
       TITLE="[Twisted-Python] stop/start client connections with loseConnection in ReconnectingClientFactory">chris at withers.org
       </A><BR>
    <I>Mon Apr  1 15:15:33 MDT 2019</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64724">[ date ]</a>
              <a href="thread.html#64724">[ thread ]</a>
              <a href="subject.html#64724">[ subject ]</a>
              <a href="author.html#64724">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/03/2019 09:53, Tobias Oberstein wrote:
&gt;&gt;&gt;<i> The Autobahn guys still show ReconnectingClientFactory in their docs, 
</I>&gt;<i> 
</I>&gt;<i> Where did you find that? That would be a doc bug, but in the _docs_, 
</I>&gt;<i> there is no reference to ReconnectingClientFactory
</I>&gt;<i> 
</I>&gt;<i> (cpy372_3) <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">oberstet at intel-nuci7</A>:~$ find 
</I>&gt;<i> ~/scm/crossbario/autobahn-python/docs/ -type f -exec grep -Hi 
</I>&gt;<i> &quot;ReconnectingClientFactory&quot; {} \;
</I>&gt;<i> (cpy372_3) <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">oberstet at intel-nuci7</A>:~$
</I>&gt;<i> 
</I>&gt;<i> We do have some example code using ReconnectingClientFactory though:
</I>&gt;<i> 
</I>&gt;<i> (cpy372_3) <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">oberstet at intel-nuci7</A>:~$ find 
</I>&gt;<i> ~/scm/crossbario/autobahn-python/examples/ -type f -exec grep -Hi 
</I>&gt;<i> &quot;ReconnectingClientFactory&quot; {} \; | wc -l
</I>&gt;<i> 8
</I>
Yeah, this one: 
<A HREF="https://github.com/crossbario/autobahn-python/tree/master/examples/twisted/websocket/reconnecting">https://github.com/crossbario/autobahn-python/tree/master/examples/twisted/websocket/reconnecting</A>

Would be good to get that converted...

&gt;&gt;<i>  1. ReconnectingClientFactory is destined for deprecation, eventually.
</I>&gt;&gt;<i>       You should just adopt the &quot;new&quot; thing now so that if we get more
</I>&gt;&gt;<i>     energy to cycle the APIs and delete the old stuff, you'll have less
</I>&gt;&gt;<i>     hassle to deal with.  (&quot;New&quot; is in quotes here since it's been
</I>&gt;&gt;<i>     around for well over 3 years at this point; Autobahn should update
</I>&gt;&gt;<i>     too, not just you.)
</I>&gt;<i> 
</I>&gt;<i> Autobahn will automatically use
</I>&gt;<i> 
</I>&gt;<i> twisted.application.internet.ClientService
</I>&gt;<i> 
</I>&gt;<i> for auto-reconnect when on Twisted 16.1.0+
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://github.com/crossbario/autobahn-python/blob/master/autobahn/twisted/wamp.py#L349">https://github.com/crossbario/autobahn-python/blob/master/autobahn/twisted/wamp.py#L349</A> 
</I>
I'm not using WAMP, just raw websocket.

&gt;&gt;<i>  2. ClientService works with endpoints, which means you can use it with
</I>&gt;&gt;<i>     /any/ kind of transport, like SSH transports, subprocesses, etc.
</I>&gt;&gt;<i>       Most practically, it works with HostnameEndpoint which is a much
</I>&gt;&gt;<i>     better way to get TLS than connectSSL; 
</I>
What's the simplest way to connect a ClientService to a websocket url 
(ie: <A HREF="ws://host/endpoint">ws://host/endpoint</A> or <A HREF="wss://host/endpoint">wss://host/endpoint</A>)

&gt;&gt;<i>      1. if you want to shut down a ReconnectingClientFactory:
</I>&gt;&gt;<i>          1. you have to call stopTrying, then uh...
</I>&gt;&gt;<i>          2. find the last protocol it built with buildProtocol, then
</I>
This hasn't proved to hard.

&gt;&gt;<i>          3. grab its transport (hope it's saving that transport as
</I>&gt;&gt;<i>             '.transport', because it doesn't actually have to)
</I>&gt;&gt;<i>          4. call loseConnection
</I>
Why? Sending a WebSocket protocol-level close from the client seems to 
work just fine?

&gt;&gt;<i>  5. It's more testable because it just takes its clock and reactor as
</I>&gt;&gt;<i>     constructor parameters, rather than requiring post-hoc
</I>&gt;&gt;<i>     poorly-documented attribute patching to become testable.
</I>
I've abstracted all that away into <A HREF="https://github.com/cjw296/carly.">https://github.com/cjw296/carly.</A>
See 
<A HREF="https://github.com/cjw296/carly/blob/master/tests/test_autobahn_websocket_client.py">https://github.com/cjw296/carly/blob/master/tests/test_autobahn_websocket_client.py</A> 
for example.
I do still have writing docs for carly on my list of things to do.

It would be great if Twisted ever had a real testing reactor, but I 
think we all know that's never going to happen ;-)

Besides, it's actually useful to test with real networking...

Chris


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64724">[ date ]</a>
              <a href="thread.html#64724">[ thread ]</a>
              <a href="subject.html#64724">[ subject ]</a>
              <a href="author.html#64724">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
