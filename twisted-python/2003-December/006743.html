<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Session expiration callbacks have no arguments?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Session%20expiration%20callbacks%20have%20no%20arguments%3F&In-Reply-To=20031211170305.GA4844%40vercingetorix.caesar.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006751.html">
   <LINK REL="Next"  HREF="006744.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Session expiration callbacks have no arguments?</H1>
    <B>Kevin Unger</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Session%20expiration%20callbacks%20have%20no%20arguments%3F&In-Reply-To=20031211170305.GA4844%40vercingetorix.caesar.org"
       TITLE="[Twisted-Python] Session expiration callbacks have no arguments?">kunger at intersight.com
       </A><BR>
    <I>Thu Dec 11 21:18:40 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006751.html">[Twisted-Python] Why does this not work?
</A></li>
        <LI>Next message: <A HREF="006744.html">[Twisted-Python] Jabber knowledge sharing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6743">[ date ]</a>
              <a href="thread.html#6743">[ thread ]</a>
              <a href="subject.html#6743">[ subject ]</a>
              <a href="author.html#6743">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello twisteds,

Shouldn't the callbacks that are  registered via 
web.server.Session.notifyOnExpire() be called with the session object 
as a parameter?  How does the callback know what session is expiring?

-k




On Thursday, December 11, 2003, at 09:03 AM, Valentino Volonghi aka 
Dialtone wrote:

&gt;<i> I don't get why this version of my software does not work...  The
</I>&gt;<i> previous version did not use service.Service but directly
</I>&gt;<i> protocol.ServerFactory and it worked right.
</I>&gt;<i>
</I>&gt;<i> Basically this software is a server to which you can connect and
</I>&gt;<i> manage some database, actually now it only supports sqlite but it will
</I>&gt;<i> support more and more soon I hope.
</I>&gt;<i>
</I>&gt;<i> ######################################## CODE HERE ################
</I>&gt;<i> VERSION = 0.1
</I>&gt;<i>
</I>&gt;<i> from twisted.application import internet, service
</I>&gt;<i> from twisted.internet import protocol, reactor, defer
</I>&gt;<i> from twisted.protocols import basic
</I>&gt;<i>
</I>&gt;<i> import sqlite
</I>&gt;<i>
</I>&gt;<i> def catchError(err):
</I>&gt;<i>     return &quot;Internal Server&quot;
</I>&gt;<i>
</I>&gt;<i> class DBUniversalProtocol(basic.LineReceiver):
</I>&gt;<i>     def send_results(self, q_results):
</I>&gt;<i>         if q_results:
</I>&gt;<i>             print &quot;Sending data...&quot;,
</I>&gt;<i>             self.transport.write(str(q_results) +'\r\n')
</I>&gt;<i>             print &quot;OK&quot;
</I>&gt;<i>
</I>&gt;<i>     def connectionMade(self):
</I>&gt;<i>         self.factory.connect_to_DB()
</I>&gt;<i>
</I>&gt;<i>     def connectionLost(self, reason):
</I>&gt;<i>         print &quot;Connection closed by client... &quot;,
</I>&gt;<i>         self.factory.conn.commit()
</I>&gt;<i>         self.factory.cursor.close()
</I>&gt;<i>         self.factory.conn.close()
</I>&gt;<i>         print &quot;Reset done.&quot;
</I>&gt;<i>
</I>&gt;<i>     def lineReceived(self, line):
</I>&gt;<i>         d = self.factory.dispatch_function(line)
</I>&gt;<i>         d.addErrback(catchError)
</I>&gt;<i>         d.addCallback(self.send_results)
</I>&gt;<i>
</I>&gt;<i> class DBUniversalService(service.Service):
</I>&gt;<i>     def __init__(self):
</I>&gt;<i>         print &quot;DB Universal Server, v.&quot;, VERSION, &quot;(c) Valentino 
</I>&gt;<i> Volonghi&quot;
</I>&gt;<i>         print &quot;Licensed under the Lesser General Public License v2.1&quot;
</I>&gt;<i>         print &quot;Written by Valentino Volonghi and released without any 
</I>&gt;<i> warranties&quot;
</I>&gt;<i>
</I>&gt;<i>         self.dispatcher = {'set_query':self.set_query,
</I>&gt;<i>                            'get_many':self.get_many,
</I>&gt;<i>                            'get_all':self.get_all,
</I>&gt;<i>                            'get_one':self.get_one
</I>&gt;<i>                           }
</I>&gt;<i>         self.conn = None
</I>&gt;<i>         self.cursor = None
</I>&gt;<i>
</I>&gt;<i>     def getDBUniversalFactory(self):
</I>&gt;<i>         f = protocol.ServerFactory()
</I>&gt;<i>         f.protocol = DBUniversalProtocol
</I>&gt;<i>         f.dispatch_function = self.dispatch_function
</I>&gt;<i>         f.conn = self.conn
</I>&gt;<i>         f.cursor = self.cursor
</I>&gt;<i>         f.connect_to_DB = self.connect_to_DB
</I>&gt;<i>         return f
</I>&gt;<i>
</I>&gt;<i>     def dispatch_function(self, line):
</I>&gt;<i>         # Every line sent to this server is made of some parts:
</I>&gt;<i>         # &quot;FUN_TO_CALL:ARGS_IF_ANY\r\n&quot;
</I>&gt;<i>         # Be sure to always use this format standard otherwise
</I>&gt;<i>         # You won't have the expected behaviour
</I>&gt;<i>
</I>&gt;<i>         fun = line.split(&quot;:&quot;)[0]
</I>&gt;<i>         callable = self.dispatcher.get(fun.strip(), None)
</I>&gt;<i>         if not callable:
</I>&gt;<i>             return defer.succeed(self.error())
</I>&gt;<i>         else:
</I>&gt;<i>             return defer.succeed(callable(line))
</I>&gt;<i>
</I>&gt;<i>     def set_query(self, line):
</I>&gt;<i>         arg = line.split(&quot;:&quot;)[1]
</I>&gt;<i>         self.SQL = arg
</I>&gt;<i>         return self.run_query()
</I>&gt;<i>
</I>&gt;<i>     def get_many(self, line):
</I>&gt;<i>         arg = line.split(&quot;:&quot;)[1]
</I>&gt;<i>         try:
</I>&gt;<i>             NUM = int(arg)
</I>&gt;<i>         except:
</I>&gt;<i>             return defer.succeed(self.error())
</I>&gt;<i>         return defer.succeed(self.cursor.fetchmany(NUM))
</I>&gt;<i>
</I>&gt;<i>     def get_all(self, line):
</I>&gt;<i>         return defer.succeed(self.cursor.fetchall())
</I>&gt;<i>
</I>&gt;<i>     def get_one(self, line):
</I>&gt;<i>         return defer.succeed(self.cursor.fetchone())
</I>&gt;<i>
</I>&gt;<i>     def error(self):
</I>&gt;<i>         return &quot;Operation Failed!&quot;
</I>&gt;<i>
</I>&gt;<i>     def allOK(self):
</I>&gt;<i>         return &quot;OK&quot;
</I>&gt;<i>
</I>&gt;<i>     def run_query(self):
</I>&gt;<i>         print &quot;Checking the query (%s)... &quot; %(self.SQL.strip()),
</I>&gt;<i>         isCorrect = self.check_query(self.SQL)
</I>&gt;<i>         if isCorrect:
</I>&gt;<i>             print &quot; OK&quot;
</I>&gt;<i>             self.cursor.execute(self.SQL)
</I>&gt;<i>             return defer.succeed(self.allOK())
</I>&gt;<i>         else:
</I>&gt;<i>             print &quot; Failed&quot;
</I>&gt;<i>             return defer.succeed(self.error())
</I>&gt;<i>
</I>&gt;<i>     def check_query(self, to_check):
</I>&gt;<i>         res = to_check.split(&quot;\r\n&quot;)
</I>&gt;<i>         if len(res) &gt; 2: return 0
</I>&gt;<i>         if res[0][-1] != &quot;;&quot;: return 0
</I>&gt;<i>         return 1
</I>&gt;<i>
</I>&gt;<i>     def connect_to_DB(self):
</I>&gt;<i>         print &quot;Connecting to DB... &quot;,
</I>&gt;<i>         self.conn = sqlite.connect(&quot;test.db&quot;)
</I>&gt;<i>         self.cursor = self.conn.cursor()
</I>&gt;<i>         print &quot;OK&quot;
</I>&gt;<i>
</I>&gt;<i> #############################################
</I>&gt;<i> MYPORT = 6000
</I>&gt;<i> application = service.Application('dbi_face', uid=1000, gid=1000)
</I>&gt;<i> f = DBUniversalService()
</I>&gt;<i> serviceCollection = service.IServiceCollection(application)
</I>&gt;<i> internet.TCPServer(MYPORT, f.getDBUniversalFactory()
</I>&gt;<i>                    ).setServiceParent(serviceCollection)
</I>&gt;<i> #############################################
</I>&gt;<i> Are these last lines right or are they wrong?
</I>&gt;<i>
</I>&gt;<i> I've not really understood the meaning of the last lines,
</I>&gt;<i> while I understand the meaning of:
</I>&gt;<i>
</I>&gt;<i> reactor.listenTCP(MYPORT, DBUniversalServer())
</I>&gt;<i> reactor.run()
</I>&gt;<i>
</I>&gt;<i> I must say I based my &quot;upgrade&quot; to finger listings.
</I>&gt;<i>
</I>&gt;<i> Thanks for your help
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> Valentino Volonghi, Regia SpA, Milan
</I>&gt;<i> Linux User #310274, Gentoo Proud User
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006751.html">[Twisted-Python] Why does this not work?
</A></li>
	<LI>Next message: <A HREF="006744.html">[Twisted-Python] Jabber knowledge sharing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6743">[ date ]</a>
              <a href="thread.html#6743">[ thread ]</a>
              <a href="subject.html#6743">[ subject ]</a>
              <a href="author.html#6743">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
