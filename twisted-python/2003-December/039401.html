<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Where is best place to put my custom code?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Where%20is%20best%20place%20to%20put%20my%20custom%20code%3F&In-Reply-To=%3C20040101063810.GB26751%40intarweb.us%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="039399.html">
   <LINK REL="Next"  HREF="039391.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Where is best place to put my custom code?</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Where%20is%20best%20place%20to%20put%20my%20custom%20code%3F&In-Reply-To=%3C20040101063810.GB26751%40intarweb.us%3E"
       TITLE="[Twisted-Python] Where is best place to put my custom code?">exarkun at intarweb.us
       </A><BR>
    <I>Wed Dec 31 23:38:10 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="039399.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
        <LI>Next message (by thread): <A HREF="039391.html">[Twisted-Python] Re: IRC Client examples...  PLEASE HELP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39401">[ date ]</a>
              <a href="thread.html#39401">[ thread ]</a>
              <a href="subject.html#39401">[ subject ]</a>
              <a href="author.html#39401">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Dec 31, 2003 at 03:58:50PM -0800, JD wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm open for suggestions on where I can put my customized code.    I seem
</I>&gt;<i> to have a choice between putting it in the &quot;factory&quot; or in the &quot;protocol&quot;,
</I>&gt;<i> and I cannot seem to decide where the best place would be.
</I>&gt;<i> 
</I>&gt;<i> My application is simple.....   here is all it should do....
</I>&gt;<i> 
</I>&gt;<i> 1) establish a connection to an IRC server.
</I>&gt;<i> 2) send an IRC command,  like a &quot;who&quot; command,  and extract the info
</I>&gt;<i> 3) then exit the client
</I>&gt;<i> 
</I>&gt;<i> I could put my code in the IRCClient's &quot;connectionMade&quot; method.    Or I
</I>&gt;<i> could put it in the factory's &quot;startedConnecting&quot; method.  The code would
</I>&gt;<i> be simple, issue a &quot;who&quot; command, and take it's output and return it.  So,
</I>&gt;<i> in my connectionMade method I would issue the command...  then call
</I>&gt;<i> reactor.stop() which would exit from my reactor.run().
</I>&gt;<i> 
</I>
  startedConnecting isn't the right place.  connectionMade is a little
closer, but since you need to log in (tell the IRC server your nickname,
etc) before you can issue commands like WHO, it isn't totally appropriate
either.  signedOn is the best place, since it is called by IRCClient once
the server acknowledges the login information.

&gt;<i> I think the factory's &quot;startedConnecting&quot; might get called first,  then
</I>&gt;<i> somewhere down in this mess, the Client would call me back with the
</I>&gt;<i> &quot;connectionMade&quot;, and I could do it there. I just need to know the
</I>&gt;<i> appropriate place to put my code.  None of these examples in the
</I>&gt;<i> 'examples' directories make this clear.
</I>&gt;<i> 
</I>&gt;<i> My next task is to know how to extract the 'who' data back from my initial
</I>&gt;<i> &quot;who&quot;
</I>
  Indeed.  This is not very easy to do with IRCClient, since the response
the server sends doesn't have a whole lot to associate it with the WHO
command you originally issued.  You need to keep track of outstanding
commands and try to match them up with server replies.

  I recognized this deficiency some time ago and did some initial work
towards improving the API.  WHO is one of the commands I did manage to
improve, but I never moved any of the work out of my sandbox.  You can find
it in Twisted/sandbox/exarkun/irc2.py.  It is under the same license as the
rest of Twisted, even though it currently lacks any indication fo that.  If
it would be helpful to you, please feel free to use it.

  The improvements take one general form: commands which will produce server
responses are exposed as functions which return a Deferred.  When the server
replies, the parsed information will be passed to that Deferred's callback.

  Here is a simple example of how you might use it (untested):

    class WhoingIRCClient(irc2.AdvancedClient):
        def signedOn(self):
            # Find everyone IRC'ing from Twisted Matrix's server.
            self.who('*twistedmatrix.com'
                ).addCallbacks(self._cbWho, self._ebWho
                ).addBoth(self._shutdownEverything
                )

        def _cbWho(self, results):
            print 'channel user host server nick flags hops realname'
            for r in results:
                print ', '.join(r)

        def _ebWho(self, failure)
            print 'Error in who!'
            log.err(failure)


        def _shutdownEverything(self, ignored):
            reactor.stop()

  Jp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: &lt;/pipermail/twisted-python/attachments/20040101/279f3426/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="039399.html">[Twisted-Python] Re: Where is best place to put my custom code?
</A></li>
	<LI>Next message (by thread): <A HREF="039391.html">[Twisted-Python] Re: IRC Client examples...  PLEASE HELP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39401">[ date ]</a>
              <a href="thread.html#39401">[ thread ]</a>
              <a href="subject.html#39401">[ subject ]</a>
              <a href="author.html#39401">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
