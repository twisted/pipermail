<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] how to best limit a given protocol to one instance (socket connection)?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20how%20to%20best%20limit%20a%20given%20protocol%20to%20one%20instance%20%28socket%20connection%29%3F&In-Reply-To=00ec01c3b940%24f7126810%248f0a500a%40jsbwxp3">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006639.html">
   <LINK REL="Next"  HREF="006645.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] how to best limit a given protocol to one instance (socket connection)?</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20how%20to%20best%20limit%20a%20given%20protocol%20to%20one%20instance%20%28socket%20connection%29%3F&In-Reply-To=00ec01c3b940%24f7126810%248f0a500a%40jsbwxp3"
       TITLE="[Twisted-Python] how to best limit a given protocol to one instance (socket connection)?">exarkun at intarweb.us
       </A><BR>
    <I>Tue Dec  2 21:10:59 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006639.html">[Twisted-Python] how to best limit a given protocol to one instance (socket connection)?
</A></li>
        <LI>Next message: <A HREF="006645.html">[Twisted-Python] ANN: TwistedJava 0.6.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6641">[ date ]</a>
              <a href="thread.html#6641">[ thread ]</a>
              <a href="subject.html#6641">[ subject ]</a>
              <a href="author.html#6641">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Dec 02, 2003 at 05:58:35PM -0800, John Benson wrote:
&gt;<i> Hi, I'd like to ensure that only one client can get into my instance of
</I>&gt;<i> Protocol. I'm thinking of setting an &quot;instances&quot; attribute on the Factory
</I>&gt;<i> and losing the connection if it has already been incremented to 1, but I'm
</I>&gt;<i> wondering if there is something more forceful that says &quot;server rejected
</I>&gt;<i> connection&quot; that might be a twisted Factory or Protocol configuration
</I>&gt;<i> option.
</I>
  You could turn off the listening port after the first connection.

    class Factory(ServerFactory):
	port = None
        def buildProtocol(self, addr):
            if self.port is not None:
                self.port.stopListening()
                self.port = None
            else:
                # This is necessary in case multiple
                # connections are made before the call
                # to stopListening above is made.
                return None
            ...


    f = Factory()
    f.port = reactor.listenTCP(port, f)

  This will refuse *almost* all connections after the first.  It is still
possible that two or more might arrive at nearly the same time and both be
accept()'d, but after buildProtocol runs for the first time, no further
connections will be able to be made, as the listening socket will not longer
be listening.

  I'm not sure if there's a way to eliminate the possibility of multiple
connections being made close together.

  Jp

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031202/2551e868/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031202/2551e868/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006639.html">[Twisted-Python] how to best limit a given protocol to one instance (socket connection)?
</A></li>
	<LI>Next message: <A HREF="006645.html">[Twisted-Python] ANN: TwistedJava 0.6.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6641">[ date ]</a>
              <a href="thread.html#6641">[ thread ]</a>
              <a href="subject.html#6641">[ subject ]</a>
              <a href="author.html#6641">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
