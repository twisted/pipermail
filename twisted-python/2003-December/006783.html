<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Re: reactor.callLater ponderings (what i am trying to do) :)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Re%3A%20reactor.callLater%20ponderings%20%28what%20i%20am%20trying%20to%20do%29%20%3A%29&In-Reply-To=20031215061002.22990.60139.Mailman%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006785.html">
   <LINK REL="Next"  HREF="006786.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Re: reactor.callLater ponderings (what i am trying to do) :)</H1>
    <B>jjanecek at telusplanet.net</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Re%3A%20reactor.callLater%20ponderings%20%28what%20i%20am%20trying%20to%20do%29%20%3A%29&In-Reply-To=20031215061002.22990.60139.Mailman%40twistedmatrix.com"
       TITLE="[Twisted-Python] Re: Re: reactor.callLater ponderings (what i am trying to do) :)">jjanecek at telusplanet.net
       </A><BR>
    <I>Mon Dec 15 02:15:52 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006785.html">[Twisted-Python] Re: reactor.callLater ponderings (what i am trying to do) :) 
</A></li>
        <LI>Next message: <A HREF="006786.html">[Twisted-Python] Asking for suggestions in new-new ftp server implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6783">[ date ]</a>
              <a href="thread.html#6783">[ thread ]</a>
              <a href="subject.html#6783">[ subject ]</a>
              <a href="author.html#6783">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanx for your help :)

Here is an example of how i implement LoopClock

from twisted.internet import reactor
print reactor
from twisted.internet.task import LoopingCall
from twisted.python import threadable
from twisted.internet import threads
threadable.init(1)
reactor.suggestThreadPoolSize(10)
print reactor

import time
#conclusions would be possible to correct so reactor
#fires more accuratly not required since it is pretty close
#for what ever reason reactor can not go finer then 10ms
#on freebsd the min timer frequency is 20.0 ms
frequency=10.0 #time that callback will pulse in ms
clock_count=0
start_time=None
last_tick=0

def clock_pulse() :
    global start_time,clock_count,last_tick
    if start_time==None :
        start_time=time.time()
        
    next_time=frequency/1000.0
    cur_time=(time.time()-start_time)*1000

    reactor.callInThread(clock_pulse_thread)
    #clock_pulse_thread() 
    clock_count+=frequency
    

def clock_pulse_thread() :
    global start_time,clock_count,last_tick
    cur_time=time.time()    
    if last_tick&gt;0 :
        print &quot;diff &quot;,(cur_time-last_tick)*1000
        pass
    last_tick=cur_time        
    
    if clock_count&gt;=10000 :
        stop_time=time.time()
        real_time=(stop_time-start_time)*1000
        print &quot;Total Time= &quot;,clock_count,&quot; &quot;,real_time
        print &quot;Difference= &quot;,clock_count-real_time,&quot; percent
&quot;,((clock_count-real_time)/real_time)*100.0
        reactor.stop()
    time.sleep(0.005)
  
LC=LoopingCall(clock_pulse)
LC.start(frequency/1000.0)

reactor.run()

20 ms on freebsd still seems to be the minimum of resultion 
10 ms on windows and linux :)
anyway 20 ms is adequate.

I would like to help anthony on the shloom project but I have to 
talk to my boss first. Unfortunately I am not the one who makes the
decisions :(. If the small company I am working for goes tits up
then i will release my code as I relocate my office to a dumpster :)

Anyway it is kinda intresting that me and anthony had the idea for a 
VOIP fone using twisted at approx the same time.

I attempting to create an &quot;RTP stack&quot; which will accept and broadcast rtp
packets from a variety of sources and then like filter them down similar
to how a tcp stack works. If that makes sense.

The only problem i had was the timing issue. I tested my code on a 
windoze box, when i moved it up to freebsd box i started to drop packets 
(IE packets where arriving late). I orrigionally thought it was because of
the distance from me to the server (I am like 20 hops). But then I discovered
that the real problem was i was not sending out the packets at the correct time
as I had thought. The class LoopingCall does in a more elegant manner what i was 
attempting to do in my Clocking Program :)


Anyway Thanx for your help, and twisted kiks ass :)




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006785.html">[Twisted-Python] Re: reactor.callLater ponderings (what i am trying to do) :) 
</A></li>
	<LI>Next message: <A HREF="006786.html">[Twisted-Python] Asking for suggestions in new-new ftp server implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6783">[ date ]</a>
              <a href="thread.html#6783">[ thread ]</a>
              <a href="subject.html#6783">[ subject ]</a>
              <a href="author.html#6783">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
