<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Small Problem -twisted web
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Small%20Problem%20-twisted%20web&In-Reply-To=%3C001901c3c1e3%24d33ea1a0%24c801a8c0%40JUPITER%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="039313.html">
   <LINK REL="Next"  HREF="039279.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Small Problem -twisted web</H1>
    <B>Mike Owens</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Small%20Problem%20-twisted%20web&In-Reply-To=%3C001901c3c1e3%24d33ea1a0%24c801a8c0%40JUPITER%3E"
       TITLE="[Twisted-Python] Small Problem -twisted web">stormcoder at yahoo.com
       </A><BR>
    <I>Sat Dec 13 18:44:33 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="039313.html">[Twisted-Python] long-lived database transaction
</A></li>
        <LI>Next message (by thread): <A HREF="039279.html">[Twisted-Python] Small Problem -twisted web
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39278">[ date ]</a>
              <a href="thread.html#39278">[ thread ]</a>
              <a href="subject.html#39278">[ subject ]</a>
              <a href="author.html#39278">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have written a script that runs as a Win32 service. The service runs but
when I try to connect I get a connection refused error in the browser. I am
including the source at the end. Also the call to unlistenTCP doesn't seem
to return. Anyone have any ideas?

import win32serviceutil as wsu
import win32service as ws
import win32event as we



from twisted.internet import app
from twisted.web import static, server, vhost, script

DefaultSite = r&quot;sites\Default\documents&quot;
my = r&quot;sites\my\documents&quot;
other = r&quot;sites\other\documents&quot;

Indices = ['index.html', 'index.rpy']

class TwistedService(wsu.ServiceFramework, object):
    _svc_name_ = &quot;TwistedWeb&quot;
    _svc_display_name_ = &quot;A twisted web server&quot;
    root = None
    Application = None
    def __init__ (self, args):
        wsu.ServiceFramework.__init__(self, args)
        self.hWaitStop = we.CreateEvent(None, 0, 0, None)
        self.root = vhost.NameVirtualHost()
        self.root.default = static.File(DefaultSite)
        pf = static.File(my)
        pf.indices = Indices

        pf.processors = {'.rpy': script.ResourceScript}
        pf.ignoreExt(&quot;.rpy&quot;)
        self.root.addHost(&quot;my.com&quot;, pf)
        self.root.addHost(&quot;www.my.com&quot;, pf)
        self.root.addHost(&quot;my.org&quot;, pf)
        self.root.addHost(&quot;www.my.org&quot;, pf)
        self.root.addHost(&quot;my.net&quot;, pf)
        self.root.addHost(&quot;www.my.net&quot;, pf)

        ob = static.File(other)
        ob.indices = Indices
        ob.processors = {&quot;.rpy&quot;:script.ResourceScript}
        ob.ignoreExt(&quot;.rpy&quot;)
        self.root.addHost(&quot;other.com&quot;, ob)
        self.root.addHost(&quot;www.other.com&quot;, ob)
        self.Application = app.Application(&quot;web&quot;)
        return


    def SvcStop (self):
        self.ReportServiceStatus(ws.SERVICE_STOP_PENDING)
        self.Application.unlistenTCP(80)
        we.SetEvent(self.hWaitStop)
        return

    def SvcDoRun (self):
        we.WaitForSingleObject(self.hWaitStop, we.INFINITE)
        self.Application.listenTCP(80, server.Site(self.root))
        return

if __name__ == &quot;__main__&quot;:
    wsu.HandleCommandLine(TwistedService)


domains have been changed to protect the innocent.

&quot;You can have peace. Or you can have freedom. Don't ever count on having
both at once.&quot; - Lazarus Long


---
Outgoing mail is certified Virus Free.
Checked by AVG anti-virus system (<A HREF="http://www.grisoft.com">http://www.grisoft.com</A>).
Version: 6.0.548 / Virus Database: 341 - Release Date: 12/5/2003




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="039313.html">[Twisted-Python] long-lived database transaction
</A></li>
	<LI>Next message (by thread): <A HREF="039279.html">[Twisted-Python] Small Problem -twisted web
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39278">[ date ]</a>
              <a href="thread.html#39278">[ thread ]</a>
              <a href="subject.html#39278">[ subject ]</a>
              <a href="author.html#39278">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
