<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] way of dealing with returning a deferred from a method/function
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20way%20of%20dealing%20with%20returning%20a%20deferred%20from%20a%20method/function&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006656.html">
   <LINK REL="Next"  HREF="006661.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] way of dealing with returning a deferred from a method/function</H1>
    <B>Jonathan Simms</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20way%20of%20dealing%20with%20returning%20a%20deferred%20from%20a%20method/function&In-Reply-To="
       TITLE="[Twisted-Python] way of dealing with returning a deferred from a method/function">slyphon at twistedmatrix.com
       </A><BR>
    <I>Wed Dec  3 20:48:56 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006656.html">[Twisted-Python] t.web.proxy ignores response body if no Content-Length
</A></li>
        <LI>Next message: <A HREF="006661.html">[Twisted-Python] way of dealing with returning a deferred from a method/function
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6659">[ date ]</a>
              <a href="thread.html#6659">[ thread ]</a>
              <a href="subject.html#6659">[ subject ]</a>
              <a href="author.html#6659">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This may seem obvious to everyone, but I had an insight into the use of
deferreds today. It would always confuse me, I've got a method that's
going to take quite a while to run. When something calls it, i want to
immediately return a deferred. But how to accomplish this? returns (most
frequently) come at the *end* of a function!

I was thinking about it like this (hence my confusion):

def aLongWait(stuff):		# obviously incorrect
    d = defer.Deferred()   
    return d
    result = doSomeStuffHere(stuff)
    d.callback(result)


the little trick I figured out today is as follows:

def aLongWait(stuff):
    d = defer.Deferred()
    def _():
         result = doSomeStuffHere(stuff)
         d.callback(result)
    reactor.callLater(0, _)
    return d

it's almost like a deferred block (in the try/except sense). It creates
a deferred that is (pretty much) guaranteed only to be called by
aLongWait(), it returns that deferred, then in the next reactor
iteration, it runs the steps that will have to wait a long time to be
processed. at the end of doSomeStuffHere() it calls back the deferred
with the result.

Neat huh?

This is going to clean up about 50% of the deferreds i use! (before i
was defining an instance variable deferred and using and resetting it if
i needed another one, which was messy)

Anyway, just adding to the collective knowledge base.

Cheers,
- Jonathan Simms
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031203/a645a246/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031203/a645a246/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006656.html">[Twisted-Python] t.web.proxy ignores response body if no Content-Length
</A></li>
	<LI>Next message: <A HREF="006661.html">[Twisted-Python] way of dealing with returning a deferred from a method/function
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6659">[ date ]</a>
              <a href="thread.html#6659">[ thread ]</a>
              <a href="subject.html#6659">[ subject ]</a>
              <a href="author.html#6659">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
