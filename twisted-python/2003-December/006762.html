<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] long-lived database transaction
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20long-lived%20database%20transaction&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006853.html">
   <LINK REL="Next"  HREF="006763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] long-lived database transaction</H1>
    <B>Federico Di Gregorio</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20long-lived%20database%20transaction&In-Reply-To="
       TITLE="[Twisted-Python] long-lived database transaction">fog at initd.org
       </A><BR>
    <I>Sat Dec 13 14:15:01 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006853.html">[Twisted-Python] subclassing ftp
</A></li>
        <LI>Next message: <A HREF="006763.html">[Twisted-Python] long-lived database transaction
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6762">[ date ]</a>
              <a href="thread.html#6762">[ thread ]</a>
              <a href="subject.html#6762">[ subject ]</a>
              <a href="author.html#6762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi *,

attached to this mail there are two files that implement long-lived
database transactions for twisted (xdbapi.py, to be dropped in
twisted.enterprise) and the necessary unit tests (test_xdbapi.py). 

some months ago i needed database transactions that span more than a
single deferred chain (i.e., runInteraction) and i noting that twisted
was missing such a feature i implemented them in my application. now
that i have some free time, i though it would be nice to let other
people use my code directly from twisted. note that everything you can
do with xdbapi can be done with adbapi and long chains of deferred, but
for some kind of applications keeping around an open transaction and
committing at the end of a complex process is much more simplier.

here is a little example, note that all the methods are completely
asynchronous and return deferreds. also note that the example just show
the usage but not the &quot;reason&quot; for xdbapi. (the original need was that
sometimes you can't commit some information because the whole stuff
comes in pieces but accumulating it makes the code much more complicated
than just writing to the db and the commit the whole at the end.)

class MyAppUsingLongLivedTransactions:

    def __init__(self):
        self.dbpool = xdbapi.ConnectionPool('psycopg', database='test')

    def doSomething(self):
        # react to some user input, open the transaction and save it away,
        # also do a select and present the user some data
        d = self.dbpool.begin()
        d.addCallback(self.doSomething_cb)

    def doSomething_cb(self, trans):
        self.trans = trans
        d = self.trans.runQuery(&quot;SELECT ...&quot;)
        d.addCallback(self.doSomethingWithTheDataAndAskUserNextStep)

    def doSomthingElse(self, data):
        # the user gave us some data and we need to write to db and commit
        self.trans.runOperation(&quot;INSERT...&quot;, data)
        # no callback/errback? ouch!
        self.trans.commit()
        # ouch! again, but this is just an example

-- 
Federico Di Gregorio                         <A HREF="http://people.initd.org/fog">http://people.initd.org/fog</A>
Debian GNU/Linux Developer                                <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fog at debian.org</A>
INIT.D Developer                                           <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fog at initd.org</A>
  L'unica cosa che riesco a produrre con una certa precisione nella mia
   vita sono i dubbi.                                  -- Natale Titotto
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xdbapi.py
Type: text/x-python
Size: 10079 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031213/2440b483/attachment.py">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031213/2440b483/attachment.py</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test_xdbapi.py
Type: text/x-python
Size: 10423 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031213/2440b483/attachment-0001.py">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031213/2440b483/attachment-0001.py</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa parte del messaggio =?ISO-8859-1?Q?=E8?= firmata
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20031213/2440b483/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20031213/2440b483/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006853.html">[Twisted-Python] subclassing ftp
</A></li>
	<LI>Next message: <A HREF="006763.html">[Twisted-Python] long-lived database transaction
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6762">[ date ]</a>
              <a href="thread.html#6762">[ thread ]</a>
              <a href="subject.html#6762">[ subject ]</a>
              <a href="author.html#6762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
