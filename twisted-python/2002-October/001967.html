<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Addition to twisted.python.logfile
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Addition%20to%20twisted.python.logfile&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001965.html">
   <LINK REL="Next"  HREF="001968.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Addition to twisted.python.logfile</H1>
    <B>John Abel</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Addition%20to%20twisted.python.logfile&In-Reply-To="
       TITLE="[Twisted-Python] Addition to twisted.python.logfile">john.abel at pa.press.net
       </A><BR>
    <I>Thu Oct 17 10:03:28 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001965.html">[Twisted-Python] websetroot
</A></li>
        <LI>Next message: <A HREF="001968.html">[Twisted-Python] Addition to twisted.python.logfile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1967">[ date ]</a>
              <a href="thread.html#1967">[ thread ]</a>
              <a href="subject.html#1967">[ subject ]</a>
              <a href="author.html#1967">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Please go gently with me, this is my first submitted &quot;enhancement&quot;! 
 I've made a small change to twisted.python.logfile, adding the option 
to gzip the log files, once they've been renamed (default is not to 
compress).

I couldn't find any info on submitting a change, so I've attached the 
output from a diff logfile.py logfileII.py

Hope you find it useful.

Regards

John

&lt; import os, stat, glob, string
---
 &gt; import os, stat, glob, string, gzip, fileinput, re
37d36
&lt;
39c38
&lt;     def __init__(self, name, directory, rotateLength=1000000):
---
 &gt;     def __init__(self, name, directory, rotateLength=1000000, 
compressLog=0):
43a43,49
 &gt;         if not compressLog in [0,1]:
 &gt;             self.compressLog = 0
 &gt;         else:
 &gt;             self.compressLog = compressLog
 &gt;         self.globFilePattern = [&quot;%s.*&quot;, &quot;%s.*.gz&quot;]
 &gt;         self.renameFilePattern = [&quot;%s.%d&quot;,&quot;%s.%d.gz&quot;]
 &gt;         self.rePattern = [&quot;.*\.(\d)$&quot;,&quot;.*\.(\d)\.gz$&quot;]
90c96
&lt;         for name in glob.glob(&quot;%s.*&quot; % self.path):
---
 &gt;         for name in glob.glob(self.globFilePattern[self.compressLog] 
% self.path):
92,94c98,102
&lt;                 counter = int(string.split(name, '.')[-1])
&lt;                 if counter:
&lt;                     result.append(counter)
---
 &gt;                 reCounter = 
re.match(self.rePattern[self.compressLog],name)
 &gt;                 if reCounter:
 &gt;                     counter = int( reCounter.group(1) )
 &gt;                     if counter:
 &gt;                         result.append(counter)
111c119
&lt;             os.rename(&quot;%s.%d&quot; % (self.path, i), &quot;%s.%d&quot; % (self.path, 
i + 1))
---
 &gt;             os.rename(self.renameFilePattern[self.compressLog] % 
(self.path, i), self.renameFilePattern[self.compressLog] % (self.path, i 
+ 1113a122,126





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001965.html">[Twisted-Python] websetroot
</A></li>
	<LI>Next message: <A HREF="001968.html">[Twisted-Python] Addition to twisted.python.logfile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1967">[ date ]</a>
              <a href="thread.html#1967">[ thread ]</a>
              <a href="subject.html#1967">[ subject ]</a>
              <a href="author.html#1967">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
