<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] crasher
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20crasher&In-Reply-To=%3C20021029.172446.68561627.glyph%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034645.html">
   <LINK REL="Next"  HREF="034647.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] crasher</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20crasher&In-Reply-To=%3C20021029.172446.68561627.glyph%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] crasher">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Oct 29 16:24:46 MST 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034645.html">[Twisted-Python] Asynchronous unit tests
</A></li>
        <LI>Next message (by thread): <A HREF="034647.html">[Twisted-Python] crasher
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2138">[ date ]</a>
              <a href="thread.html#2138">[ thread ]</a>
              <a href="subject.html#2138">[ subject ]</a>
              <a href="author.html#2138">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Okay, I've discovered a _very very_ odd bug in Twisted.  In trying to get this
stupid web/issues conduit thing working on Mac IE, I was trying all kinds of
crazy nonsense.  In particular there was one bit where I tried to make
issueconduit close the connection after the server sent each message, so it
would be immediately displayed, and then have the browser re-open the
connection after a second to retrieve any new messages.  (Mac IE doesn't allow
you to modify pages with Javascript that haven't been fully loaded for some
reason.) I did this using js timeouts and setting the src attribute on a hidden
iframe.

What happened next was not what I expected at all.  First, the server started
sending me the welcome message in a loop.  (This is probably just a bug in the
conduit code, nothing serious.)  However, when I entered something in the text
field and hit &quot;enter&quot;, twistd _locked up hard_.  I couldn't even send it a
SIGTERM.  So I killed it and tried again a few times.  It would reliably lock
up after trying to send a message.  Best of all, this does not normally happen:
it is quite possible to interact with the server using the default js (with
some trivial changes); the only problem is that the updates won't show up until
the connection is finished.

The only thing I could think of that would be useful for debugging info is
strace, since it was wedged so hard and I didn't know where.  Here's what I
got:

    ...
    munmap(0x4001b000, 4096)                = 0
    close(9)                                = 0
    gettimeofday({1035895791, 342136}, NULL) = 0
    send(6, &quot;HTTP/1.1 200 OK\r\nTransfer-encodi&quot;..., 136, 0) = 136
    send(6, &quot;c3\r\n&amp;lt;IssueBot&amp;gt; A SUPPORT R&quot;..., 201, 0) = 201
    send(6, &quot;0\r\n\r\n&quot;, 5, 0)              = 5
    gettimeofday({1035895791, 345729}, NULL) = 0
    gettimeofday({1035895791, 346897}, NULL) = 0
    write(1, &quot;29/10/2002 06:49 [HTTPChannel,0,&quot;..., 20529/10/2002 06:49 [HTTPChannel,0,64.123.27.109] 64.123.27.109 - - [29/Oct/2002:12:49:50 +0000] &quot;&lt;GET /issues.rpy/conduit?output=135 HTTP/1.1&gt;&quot; 200 195 &quot;-&quot; &quot;Mozilla/4.0 (compatible; MSIE 5.14; Mac_PowerPC)&quot;
    ) = 205
    brk(0x846d000)                          = 0x846d000
    old_mmap(NULL, 245760, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x4035b000
    brk(0x8433000)                          = 0x8433000
    mremap(0x4035b000, 245760, 245760, MREMAP_MAYMOVE) = 0x4035b000
    mremap(0x4035b000, 245760, 245760, MREMAP_MAYMOVE) = 0x4035b000
    mremap(0x4035b000, 245760, 245760, MREMAP_MAYMOVE) = 0x4035b000
    mremap(0x4035b000, 245760, 245760, MREMAP_MAYMOVE) = 0x4035b000
    ...

It then repeats &quot;mremap&quot; basically forever, and the various numbers there
increase very gradually.

So for some reason, Twisted is trying to allocate some huuuge chunk of memory.
Is there a way to get gdb to tell me where in python this is happening?

I am going out of my mind trying to figure out a way to debug this, so extra
eyes are helpful, but I don't think this bug can be found through normal
bughunting; you'd have to be pretty familiar with whatever code is causing the
problem.  I figure it might be either woven, twisted.protocols.http or
twisted.internet.

Help? :-)

-- 
 |    &lt;`'&gt;    |  Glyph Lefkowitz: Traveling Sorcerer   |
 |   &lt; _/ &gt;   |  Lead Developer,  the Twisted project  |
 |  &lt; ___/ &gt;  |      <A HREF="http://www.twistedmatrix.com">http://www.twistedmatrix.com</A>      |
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20021029/e042314a/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20021029/e042314a/attachment.pgp</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034645.html">[Twisted-Python] Asynchronous unit tests
</A></li>
	<LI>Next message (by thread): <A HREF="034647.html">[Twisted-Python] crasher
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2138">[ date ]</a>
              <a href="thread.html#2138">[ thread ]</a>
              <a href="subject.html#2138">[ subject ]</a>
              <a href="author.html#2138">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
