<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: nntp protocol supports moderated newsgroups?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20nntp%20protocol%20supports%20moderated%20newsgroups%3F&In-Reply-To=%3C15793.34455.512573.39157%40gargle.gargle.HOWL%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034486.html">
   <LINK REL="Next"  HREF="034509.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: nntp protocol supports moderated newsgroups?</H1>
    <B>Barry A. Warsaw</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20nntp%20protocol%20supports%20moderated%20newsgroups%3F&In-Reply-To=%3C15793.34455.512573.39157%40gargle.gargle.HOWL%3E"
       TITLE="[Twisted-Python] Re: nntp protocol supports moderated newsgroups?">barry at python.org
       </A><BR>
    <I>Sat Oct 19 10:21:43 MDT 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034486.html">[Twisted-Python] Re: nntp protocol supports moderated newsgroups?
</A></li>
        <LI>Next message (by thread): <A HREF="034509.html">[Twisted-Python] Re: nntp protocol supports moderated newsgroups?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2004">[ date ]</a>
              <a href="thread.html#2004">[ thread ]</a>
              <a href="subject.html#2004">[ subject ]</a>
              <a href="author.html#2004">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;&gt;&gt;&gt;&gt;<i> &quot;JC&quot; == Jp Calderone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; writes:
</I>
    JC&gt;  Hmm, twisted/news/database.py should have all the stuff it
    JC&gt; needs already - maybe makeGroupSQL() will need to be modified
    JC&gt; a bit so that twisted/tap/news.py can tell it which groups
    JC&gt; should be moderated and which shouldn't.  twisted/tap/news.py
    JC&gt; will probably have most of the action; it'll need code to let
    JC&gt; the user specify moderated/unmoderated to mktap somehow, maybe
    JC&gt; with another --groups parameter, or with some indicator in the
    JC&gt; groups file.

    JC&gt; Maybe it's time twisted.news got a *real* configuration
    JC&gt; interface :) I'll ponder that a little (maybe something fun
    JC&gt; with woven), and if you(/anyone else) have any ideas on this,
    JC&gt; I'd love to hear them.

I don't really, since I'm fairly green in my Twisted use.  I will note
that the news stuff seems a little more difficult to use than when I
last looked at it (Twisted 0.19 I think).  I'm using Twisted from cvs
now, so it's possible this stuff is just in flux.

Specifically:

- What is the --servers switch for?  I couldn't actually find where
  that was used in tap/news.py but it seemed required, so I fed it
  nonsense. 

- I understand why &quot;mktap news&quot; requires an extra argument now, but it
  would be nice if either the pickle or sql command were defaulted.  I
  don't think I needed to specify &quot;mktap news pickle&quot; last time.  Hmm,
  maybe if --file is given you can default to pickle?

- I noticed some bugs in the code, a few of which I fixed, but some I
  didn't.  I ran the server w/ twistd -n and watched the output.  I
  got mysterious log messages such as:

[...]
19/10/2002 11:54 [*news*] Starting factory &lt;twisted.news.news.UsenetClientFactory instance at 0x82a52d4&gt;
19/10/2002 11:54 [*news*] Connection failed: [Failure instance: Traceback! exceptions.IOError, address not found
19/10/2002 11:54 [*news*] ]
19/10/2002 11:54 [*news*] Connection failed: [Failure instance: Traceback! exceptions.IOError, address not found
19/10/2002 11:54 [*news*] ]
19/10/2002 11:54 [*news*] Stopping factory &lt;twisted.news.news.UsenetClientFactory instance at 0x82a52d4&gt;
19/10/2002 11:55 [*news*] Starting factory &lt;twisted.news.news.UsenetClientFactory instance at 0x82a52d4&gt;
[...]

  While these repeated as long as the server was running, they didn't
  seem to affect its operation.

- In news/news.py, buildProtocol() is trying to pass self.remoteHosts
  to the self.protocol() call, but self.protocol() -- which is really
  the nntp.NNTPServer class, doesn't take two arguments.

In any event, I hacked in moderated group support by adding a
-m/--moderators flag, which takes a file containing a list of
newsgroup/moderator address pairs.  When a message is POSTed to a
group, the list of target newsgroups is checked against the
moderators.  If there is any match, and the article has no Approved
header, the article is not posted, but instead emailed to the
moderators address.  The value of the Approved header is completely
ignored -- it just has to be there.  I believe this is pretty close to
how Usenet s/w handles moderators.

A couple of kludges that should be cleaned up:

- What to do if the list of target newsgroups has more than one
  moderated newsgroup in it?  Off hand, I'm not sure what Usenet does
  in this case.

- We really need a few more config options, including the smtp host
  and port to use to send out the moderator's email, and the envelope
  sender address to use in that email.  Both are hard coded in my
  hack.

- Any un-Twisted coding offenses. :)

So, in the grand tradition of scratching my own itch, but just enough
so I can sleep, here's the patch.

Oh, BTW, for someone who was completely green to the code base,
Twisted is very nicely written.  It wasn't difficult at all to drill
down to where I needed to make the changes.  JP's hints helped a lot
too.  Yay!

Enjoy,
-Barry

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: twisted.txt
Url: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20021019/97b86b2c/attachment.txt">http://twistedmatrix.com/pipermail/twisted-python/attachments/20021019/97b86b2c/attachment.txt</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034486.html">[Twisted-Python] Re: nntp protocol supports moderated newsgroups?
</A></li>
	<LI>Next message (by thread): <A HREF="034509.html">[Twisted-Python] Re: nntp protocol supports moderated newsgroups?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2004">[ date ]</a>
              <a href="thread.html#2004">[ thread ]</a>
              <a href="subject.html#2004">[ subject ]</a>
              <a href="author.html#2004">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
