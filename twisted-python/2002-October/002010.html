<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: nntp protocol supports moderated newsgroups?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20nntp%20protocol%20supports%20moderated%20newsgroups%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002001.html">
   <LINK REL="Next"  HREF="001979.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: nntp protocol supports moderated newsgroups?</H1>
    <B>Barry A. Warsaw</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20nntp%20protocol%20supports%20moderated%20newsgroups%3F&In-Reply-To="
       TITLE="[Twisted-Python] Re: nntp protocol supports moderated newsgroups?">barry at python.org
       </A><BR>
    <I>Sat Oct 19 18:12:01 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="002001.html">[Twisted-Python] Re: nntp protocol supports moderated newsgroups?
</A></li>
        <LI>Next message: <A HREF="001979.html">[Twisted-Python] 1.0.0rc2 is out - please test installation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2010">[ date ]</a>
              <a href="thread.html#2010">[ thread ]</a>
              <a href="subject.html#2010">[ subject ]</a>
              <a href="author.html#2010">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;&gt;&gt;&gt;<i> &quot;JC&quot; == Jp Calderone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; writes:
</I>
    JC&gt;   I wish I could say that is the case -- I've just been
    JC&gt; motivated to work on other projects lately.

I can sympathize!
    
    JC&gt; I agree that it has gotten more complex, and I don't like it.
    JC&gt; I've recently been pointed at twisted.persisted.dirdbm, and my
    JC&gt; current thinking is that PickleStorage and
    JC&gt; NewsStorageAugmentation should go away in favor of a
    JC&gt; DirDBMStorage.  PickleStorage was never meant as anything more
    JC&gt; than a toy, and the SQL stuff doesn't seem to have yielded any
    JC&gt; performance benefits, probably due to the complexity of some
    JC&gt; of the common queries it is performing.

PickleStorage was fine for my purpose, which wasn't to create a fully
functional peering news server, but to have something
protocol-complete enough to test Mailman's gatewaying functionality.

    JC&gt; The file given to --servers should contain a list of news
    JC&gt; servers to which to connect and share messages with.  This
    JC&gt; hasn't yet been tested thoroughly -- I have surprising
    JC&gt; difficulty finding a news server that implemented enough of
    JC&gt; the protocol to let this work.  I guess the &quot;user facing&quot;
    JC&gt; servers are kept intentionally non-functional for some reason.

Ah, cool.  I guess --servers should simply be optional then (as should
--moderators, but I wasn't sure how to do that).  I think there are
use cases beyond testing Mailman &lt;wink&gt; for having a news server that
isn't a peer of other servers.  E.g. an internal mailing list mirror.

    JC&gt; Yea, this is new too, since pickle was the only legal command
    JC&gt; in the past.  If I go with the dirdbm stuff, I'll probably
    JC&gt; make it the default and let pickle or sql be specified if
    JC&gt; someone wants something different (Or pickle and sql might
    JC&gt; quietly disappear - the prospect of maintaining 3 different
    JC&gt; backends - 2 of which are likely useless to nearly everybody -
    JC&gt; is a little unpleasant).

Pickles were fine for me, but I can understand others may not be happy
with them.  Sql wasn't an option because I don't have an sql server
set up, and that would have been too high a barrier for me.

&gt;<i>  While these repeated as long as the server was running, they didn't
</I>&gt;<i>  seem to affect its operation.
</I>
    JC&gt; I'm guessing these are due to whatever you put in your server
    JC&gt; list file.

Makes sense!

&gt;<i>In any event, I hacked in moderated group support by adding a
</I>&gt;<i>-m/--moderators flag, which takes a file containing a list of
</I>&gt;<i>newsgroup/moderator address pairs.  When a message is POSTed to a
</I>&gt;<i>group, the list of target newsgroups is checked against the
</I>&gt;<i>moderators.  If there is any match, and the article has no Approved
</I>&gt;<i>header, the article is not posted, but instead emailed to the
</I>&gt;<i>moderators address.  The value of the Approved header is completely
</I>&gt;<i>ignored -- it just has to be there.  I believe this is pretty close to
</I>&gt;<i>how Usenet s/w handles moderators.
</I>
    JC&gt; Hmm.  How does a moderator then approve the message?  The
    JC&gt; interface I had envisioned was something closer to mailman's
    JC&gt; scheme, though this is certainly easier on the server side :)

I believe that the news server never really enters into the picture
for moderation.  All it cares about is that posts to moderated groups
have an Approved header -- it doesn't even care what the value of that
header is!  If the Approved header exists, it accepts the post.  If
not, it forwards it to the email address of the moderators.  That's
it.

Mailman's moderation support (only in cvs at the moment) works with
this protocol so that unmoderated messages are held for approval via
the normal admindb interface.  If the list owner -- who doubles as the
newsgroup moderator -- approves the message, Mailman re-posts it
including an Approved header, to its local news server.  The news
server will accept the posting now and everything proceeds as normal.

So the news server's behavior is only half the picture (but a critical
half!).

&gt;<i>- What to do if the list of target newsgroups has more than one
</I>&gt;<i>  moderated newsgroup in it?  Off hand, I'm not sure what Usenet does
</I>&gt;<i>  in this case.
</I>&gt;<i>
</I>    JC&gt; I believe the correct behavior would be to post the message to
    JC&gt; all un-moderated groups and hold the message for approval from
    JC&gt; the moderators of each moderated group, posting it to each
    JC&gt; held group when the appropriate moderator approves it.

Except the news server can't do this, because of the above.  I /think/
what actually happens in practice (some Usenet expert will have to
verify this) is that the news server doesn't post the message to any
newsgroup, but forwards it off to the moderators of the first
moderated newsgroup in the list.  Once they approve it and repost,
that's all the approval necessary.
    
&gt;<i>- Any un-Twisted coding offenses. :)
</I>
    JC&gt; The only one I see is the use of smtplib.  Its sendmail method
    JC&gt; will very likely block, possibly for a long time, hanging the
    JC&gt; entire server.

Ah, I'm so used to Mailman's behavior, I hadn't tought about this.
Mailman always connects to a trusted, local MTA to do the final
delivery.  Usually this is some server on localhost:25.  Mailman never
connects to the actual recipient's remote mta.  I'd be happy enough if
Twisted made the same assumption, but OTOH since Twisted /does/ come
with an SMTPd, it can probably do better.
    
    JC&gt; Aside from just being nasty, this opens up the
    JC&gt; possibility for DoS on servers, simply by repeatedly mailing a
    JC&gt; moderated group.  I'm going out of town for a week this coming
    JC&gt; tuesday, and I doubt I'll have time to figure out how
    JC&gt; twisted.protocols.smtp.SMTPClient works before then, so I'm
    JC&gt; going to hold off on committing this.  If you want to figure
    JC&gt; that out and send another patch, that'd be great, otherwise
    JC&gt; I'll just take care of it when I get back.

I probably wont' get to it.  Twisted + my hacks was enough to debug
Mailman's new moderation support, and I'll have to leave it at that
for now.  I've got my hands full trying to get Mailman 2.1b4 out the
door this weekend!

  Glad to hear it :)  Thanks for the patch.

No problem, thanks again for your help.
-Barry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002001.html">[Twisted-Python] Re: nntp protocol supports moderated newsgroups?
</A></li>
	<LI>Next message: <A HREF="001979.html">[Twisted-Python] 1.0.0rc2 is out - please test installation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2010">[ date ]</a>
              <a href="thread.html#2010">[ thread ]</a>
              <a href="subject.html#2010">[ subject ]</a>
              <a href="author.html#2010">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
