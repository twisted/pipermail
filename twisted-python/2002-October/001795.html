<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Improvements to twisted.protocols.smtp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Improvements%20to%20twisted.protocols.smtp&In-Reply-To=200209301501.g8UF1a9u001275%40fido.strakt.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001794.html">
   <LINK REL="Next"  HREF="001797.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Improvements to twisted.protocols.smtp</H1>
    <B>Moshe Zadka</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Improvements%20to%20twisted.protocols.smtp&In-Reply-To=200209301501.g8UF1a9u001275%40fido.strakt.com"
       TITLE="[Twisted-Python] Improvements to twisted.protocols.smtp">m at moshez.org
       </A><BR>
    <I>Tue Oct  1 05:02:27 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="001794.html">[Twisted-Python] Re: [Twisted-commits] How do I serve PHP-files with twisted.web? Answered.
</A></li>
        <LI>Next message: <A HREF="001797.html">[Twisted-Python] RE: Problem with build on winxp/VC6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1795">[ date ]</a>
              <a href="thread.html#1795">[ thread ]</a>
              <a href="subject.html#1795">[ subject ]</a>
              <a href="author.html#1795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I promised I'll detail my problems with the patch.
I'll try to check something in this weekend, maybe these problems.
 
&gt;<i> Index: twisted/protocols/basic.py
</I>
I'd hesitate to touch protocols.basic without a unit test for this
feature.

&gt;<i> Index: twisted/protocols/smtp.py
</I>
I have a general problem here: the REs are very complicated and undocumented.
Please use re.X and comment the RE

&gt;<i> -class User:
</I>&gt;<i> +class User(Address):
</I>
I'd prefer containment rather than inclusion here.

&gt;<i> -    def __init__(self):
</I>&gt;<i> +    def __init__(self, domain=None, timeout=600):
</I>&gt;<i>          self.mode = COMMAND
</I>&gt;<i>          self.__from = None
</I>&gt;<i>          self.__helo = None
</I>&gt;<i> -        self.__to = ()
</I>&gt;<i> +        self.__to = []
</I>&gt;<i> +        self.timeout = timeout
</I>&gt;<i> +        if not domain:
</I>&gt;<i> +            import socket
</I>&gt;<i> +            domain = socket.getfqdn()
</I>&gt;<i> +        self.host = domain
</I>
this is wrong. the domain name should be in the protocol factory, not
in the protocol

&gt;<i> +        self.timeoutID = reactor.callLater(self.timeout, self.timedout)
</I>
please allow a timeout of &quot;None&quot; to mean &quot;no timeouts&quot;

&gt;<i> +            del self.__messages
</I>&gt;<i> +        self.sendCode(500, 'Line too long')
</I>
this seems like it wouldn't work. the client would send the rest of the long
line, which look like a beginning of a command

&gt;<i>      def do_MAIL(self, rest):
</I>&gt;<i> -        from_ = rest[len(&quot;MAIL:&lt;&quot;):-len(&quot;&gt;&quot;)]
</I>&gt;<i> -        self.validateFrom(self.__helo, from_, self._fromValid,
</I>&gt;<i> -                                              self._fromInvalid)
</I>&gt;<i> +        if not self.__helo:
</I>&gt;<i> +            self.sendCode(503,&quot;Who are you? Say HELO first&quot;);
</I>
be liberal, at least in the framework. if a user wants to allow
nonusing of helo, he should be free to do this. you can enforce helo
in validateFrom

&gt;<i> -        self.__init__()
</I>&gt;<i> +        self.__from = None
</I>&gt;<i> +        self.__to = []
</I>&gt;<i>          self.sendCode(250, 'I remember nothing.')
</I>what about __messages?




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001794.html">[Twisted-Python] Re: [Twisted-commits] How do I serve PHP-files with twisted.web? Answered.
</A></li>
	<LI>Next message: <A HREF="001797.html">[Twisted-Python] RE: Problem with build on winxp/VC6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1795">[ date ]</a>
              <a href="thread.html#1795">[ thread ]</a>
              <a href="subject.html#1795">[ subject ]</a>
              <a href="author.html#1795">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
