<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] usage.Options
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20usage.Options&In-Reply-To=%3C20021005.001805.57985419.warner%40lothar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034333.html">
   <LINK REL="Next"  HREF="034345.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] usage.Options</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20usage.Options&In-Reply-To=%3C20021005.001805.57985419.warner%40lothar.com%3E"
       TITLE="[Twisted-Python] usage.Options">warner at lothar.com
       </A><BR>
    <I>Sat Oct  5 01:18:05 MDT 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034333.html">[Twisted-Python] usage.Options
</A></li>
        <LI>Next message (by thread): <A HREF="034345.html">[Twisted-Python] usage.Options
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34344">[ date ]</a>
              <a href="thread.html#34344">[ thread ]</a>
              <a href="subject.html#34344">[ subject ]</a>
              <a href="author.html#34344">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> I'm looking at warner's manhole doc at
</I>&gt;<i>     <A HREF="http://www.lothar.com/tech/twisted/manhole.xhtml">http://www.lothar.com/tech/twisted/manhole.xhtml</A>
</I>&gt;<i> (which is excellent, btw)
</I>
&lt;blushes&gt;. thanks. Check out the other docs-in-progress at
<A HREF="http://www.lothar.com/tech/twisted/">http://www.lothar.com/tech/twisted/</A> too, let me know what you think.

&gt;<i> I'm tempted to wonder if this would be better (if it were implemented in
</I>&gt;<i> usage.Options, of course...):
</I>&gt;<i>     # add manhole with username and password
</I>&gt;<i>     from twisted.tap.manhole import Options, updateApplication
</I>&gt;<i>     updateApplication(app, Options(user='boss', password='sekrit'))
</I>
I'm also not sure if this is a sufficiently common need to make shorter..
most of the time the Options come from sys.argv, after all. What I would find
handy, however, would be something to specifically make it easier to add a
manhole service into an application. Something that a beginner could use
without understanding anything further about PB. Something, say, like this:

Index: twisted/manhole/service.py
===================================================================
RCS file: /cvs/Twisted/twisted/manhole/service.py,v
retrieving revision 1.31
diff -u -r1.31 service.py
--- twisted/manhole/service.py	1 Sep 2002 09:07:11 -0000	1.31
+++ twisted/manhole/service.py	5 Oct 2002 07:05:33 -0000
@@ -344,3 +344,17 @@
                                             getattr(self.application,
                                                     'name', &quot;???&quot;))
         return s
+
+
+def addManhole(app, username, password, portno=None):
+    &quot;&quot;&quot;Convenience method to add manhole service to an existing app. Returns
+    the manhole Service so you can get at its .namespace attribute.&quot;&quot;&quot;
+    from twisted.cred import authorizer
+    auth = authorizer.DefaultAuthorizer(app)
+    svc = Service(&quot;twisted.manhole&quot;, serviceParent=app, authorizer=auth)
+    p = svc.createPerspective(username)
+    p.makeIdentity(password)
+    if portno == None:
+        portno = pb.portno
+    app.listenTCP(portno, pb.BrokerFactory(pb.AuthRoot(auth)))
+    return svc


That would allow the user to add a manhole service with a nice, clean
two-line addition (as opposed to my mean, ugly 4-line addition):

 from twisted.manhole.service import addManhole
 addManhole(app, &quot;boss&quot;, &quot;sekrit&quot;)

And then you can pre-fill the namespace with useful variables (like
theApplication, or your Services) like this:

 from twisted.manhole.service import addManhole
 n = addManhole(app, &quot;boss&quot;, &quot;sekrit&quot;).namespace
 n['app'] = app
 n['svc'] = my_svc
 n['help'] = &quot; app: theApplication\n svc: my_svc\n&quot;


One shortcoming of my patch is that the auth will probably steal pb.portno
from any existing PB services. If there are already PB services listening on
that port, the code should probably raise an exception and tell the user to
make it listen on a different one (rather than silently insert it's user/pass
into the user's Authorizer). I don't know how to check for that.. any ideas?

thanks,
 -Brian



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034333.html">[Twisted-Python] usage.Options
</A></li>
	<LI>Next message (by thread): <A HREF="034345.html">[Twisted-Python] usage.Options
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34344">[ date ]</a>
              <a href="thread.html#34344">[ thread ]</a>
              <a href="subject.html#34344">[ subject ]</a>
              <a href="author.html#34344">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
