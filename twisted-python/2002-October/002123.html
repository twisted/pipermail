<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] No shame...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20No%20shame...&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002117.html">
   <LINK REL="Next"  HREF="002126.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] No shame...</H1>
    <B>Ken Kennedy</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20No%20shame...&In-Reply-To="
       TITLE="[Twisted-Python] No shame...">kkennedy at kenzoid.com
       </A><BR>
    <I>Sat Oct 26 01:03:55 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="002117.html">[Twisted-Python] reactor installation
</A></li>
        <LI>Next message: <A HREF="002126.html">[Twisted-Python] Acronym Expansion in Documentation (WARNING: Newbie)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2123">[ date ]</a>
              <a href="thread.html#2123">[ thread ]</a>
              <a href="subject.html#2123">[ subject ]</a>
              <a href="author.html#2123">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>OK...I'm obviously not QUITE grokking something with Deferreds, and
I've spent FAR too long on something that's probably WAY too simple.

I've been trying to use a Deferred from an adbapi connection in a web
page display, and I'm just doing something wrong. I get the data, but
the page is already rendered. I know the query's working, b/c the
callback function writes to the log. At this point, I've given up and
used a blocking call just for example purposes.

Here's what's (shamefully) working now:

----BEGIN SCRIPT----

# Bloglist RTL file
#
# Provides a listing of recent blog posts 

# obviously, these aren't all being used now.
# I've been through 'em all during the day, though...
from twisted.web.resource import Resource
from twisted.enterprise import adbapi
from TwistedBlog.config import DSN
from TwistedBlog import blogger
from twisted.python import log
from twisted.web.server import NOT_DONE_YET
# the heck with it...
import pyPgSQL.PgSQL

class BlogResource(Resource):

      template render(self, request):
               print &quot;DSN = %s&quot; % (DSN,)
               conn = pyPgSQL.PgSQL.connect(DSN)
               cursor = conn.cursor()
               sql = &quot;&quot;&quot;SELECT title, news_item_id FROM news_items
               ORDER BY release_date desc, news_item_id DESC
               LIMIT %s&quot;&quot;&quot;
               cursor.execute(sql, 8)
               recentList = cursor.fetchall()
               &quot;&quot;&quot;
               &lt;html&gt;
               &lt;head&gt;&lt;title&gt;Recent Entries&lt;/title&gt;&lt;/head&gt;
               &lt;body&gt;
                &lt;h1&gt;Kenzoid's blog&lt;/h1&gt;
                &quot;&quot;&quot;
                for (title, id) in recentList:
                    '&lt;a href=&quot;blog/%s&quot;&gt;%s&lt;/a&gt;&lt;br&gt;' % (id,title)
                &quot;&quot;&quot;
                &lt;/p&gt;
                &lt;/body&gt;
                &lt;/html&gt;
                &quot;&quot;&quot; % vars()

resource = BlogResource()

----END SCRIPT----

Now, TwistedBlog.blogger.DatabaseBlogger OTOH uses an
adbapi.Augmentation.runQuery with the same SQL as above, returning a
Deferred. Once the callback runs, the resultlist is available there,
and I can write it (for example) to the log. So I know it's
working. Just not in sync with the rest of things.

So I realize the problems...but I'm
just-not-seeing-the-Deferred-way. Can someone give me a dumb-stupid
example, getting basically the same info as above into a webpage,
using adbapi rather than a blocking call? I find tantalizing mentions
of the use of Deferreds in various places, but I don't see any
easy examples. I like easy. *grin* For starters, anyway. 

As to format, I don't care. Use woven, Quixote PTL, Web Widgets,
direct writes, whatever floats your boat. I hope that once I see it and
play with it a tad, the lightbulb will turn on in my beany little
head. 

Thanks in advance...I'll take the ribbing, as long as I get some code
too! *grin*

-- 

Ken Kennedy	| <A HREF="http://www.kenzoid.com">http://www.kenzoid.com</A>	| <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kenzoid at io.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002117.html">[Twisted-Python] reactor installation
</A></li>
	<LI>Next message: <A HREF="002126.html">[Twisted-Python] Acronym Expansion in Documentation (WARNING: Newbie)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2123">[ date ]</a>
              <a href="thread.html#2123">[ thread ]</a>
              <a href="subject.html#2123">[ subject ]</a>
              <a href="author.html#2123">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
