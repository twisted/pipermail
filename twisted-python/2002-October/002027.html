<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] enterprise.row and two-way relationships
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20enterprise.row%20and%20two-way%20relationships&In-Reply-To=1035143074.872.5.camel%40qutang">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002020.html">
   <LINK REL="Next"  HREF="002028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] enterprise.row and two-way relationships</H1>
    <B>Sean Riley</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20enterprise.row%20and%20two-way%20relationships&In-Reply-To=1035143074.872.5.camel%40qutang"
       TITLE="[Twisted-Python] enterprise.row and two-way relationships">sean at twistedmatrix.com
       </A><BR>
    <I>Sun Oct 20 17:32:23 EDT 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="002020.html">[Twisted-Python] enterprise.row and two-way relationships
</A></li>
        <LI>Next message: <A HREF="002028.html">[Twisted-Python] enterprise.row and two-way relationships
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2027">[ date ]</a>
              <a href="thread.html#2027">[ thread ]</a>
              <a href="subject.html#2027">[ subject ]</a>
              <a href="author.html#2027">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>well, i can think of two ways - but neither are particularly good.

You could create RowObject classes for each of the three tables - account,
contact, and rel  - and define foreign keys with the &quot;rowForeignKey&quot;
attributes between the tables.

Then use loadObjectsFrom to load objects from the rel table, and have those
&quot;relRow&quot; objects auto-load their children - which would be the rows from the
contacts table... This is not terribly efficient as it doesn't take
advantage of sql joins or set operations at all, but it should work.

For the second way, create a view on the rel and contacts tables:

create view account_contacts as
select rel.account_id, contact.contact_id, contact.name
from contact, rel
where rel.contact_id = contact.contact_id;

and create a rowObjectClass for the view. This would allow the rows to be
loaded, but updates and inserts could be a problem. Some databases cant do
updates or inserts to views... Others require rules or triggers to do it.


Dealing with many-to-many relationships like this is really outside of the
immediate scope of the current row code. Its a pretty common problem though,
so it is a logical place for the next extensions.  I'm not yet sure how to
make a good interface for this. I am reluctant to introduce more rowClass
attributes without some better validation or generation scheme - it is
already tedious and error-prone enough to type in all the columns, types and
relationships.

An SQL parser may be one way. If there was some way to generate
rowObjectClasses for queries dynamically, with functionality similar to the
way cursors work, that would be a generally useful solution....

Any thoughts on extending the Row API are welcome :)


-----Original Message-----
From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-admin at twistedmatrix.com</A>
[mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-admin at twistedmatrix.com</A>]On Behalf Of Justin Ryan
Sent: Sunday, October 20, 2002 2:45 PM
To: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Subject: Re: [Twisted-Python] enterprise.row and two-way relationships


On Sun, 2002-10-20 at 13:50, Ken Kennedy wrote:
&gt;<i> On Sat, Oct 19, 2002 at 06:21:32PM -0500, Justin Ryan wrote:
</I>&gt;<i> &gt; Hello..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; To solve this problem, I've got a 'rel' table which keeps relationships
</I>&gt;<i> &gt; between account ids and contact ids, so if I want all of the contacts
</I>&gt;<i> &gt; for account x I simply pull all of the rows out of the 'rel' table whose
</I>&gt;<i> &gt; accountId is x, and then individually step through them and extract the
</I>&gt;<i> &gt; contacts with the corresponding accountIds..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I don't think there is a problem with the way I'm doing this, or a
</I>&gt;<i> &gt; better way to do this (though I'd be tickled if someone could point me a
</I>&gt;<i> &gt; better way), but in any case there does not seem to be an (obvious) way
</I>&gt;<i> &gt; to handle this with RowObjects..
</I>&gt;<i>
</I>&gt;<i> It's a little unclear, but the &quot;pull all of the rows out..and then
</I>&gt;<i> individually step through them&quot; seems to suggest you're making two
</I>&gt;<i> queries to the db. If that's the case,then yeah, there's a better
</I>&gt;<i> way. If you know the accountID (from some previous query), just join
</I>&gt;<i> rel to contacts:
</I>&gt;<i>
</I>&gt;<i> &quot;select contact_info from contacts inner join rel on (rel.contactid =
</I>&gt;<i> contacts.contactid) where rel.accountid = whatever&quot;
</I>&gt;<i>
</I>&gt;<i> If you only know account name info, use:
</I>&gt;<i>
</I>&gt;<i> &quot;select contact_info from
</I>&gt;<i>        accounts inner join rel on (rel.accountid = accounts.accountid)
</I>&gt;<i>        inner join
</I>&gt;<i>        contacts on (contacts.contactid=rel.contactid)
</I>&gt;<i>        where account.accountname = 'whatever'
</I>&gt;<i> &quot;
</I>&gt;<i>
</I>&gt;<i> Either way, you should be getting back what you need in one
</I>&gt;<i> query. Does that make sense?
</I>&gt;<i>
</I>
Certainly.., and it's not that far off from what I was doing.. except it
does seem a bit off in that no info is actually being pulled from the
account table - and if it were, it would be pulled multiple times (if i
want to pull the account name and account id, and then a list of
contacts).

the big important question here is ('scuse my german)... *drumroll*

how the fuck do I do this with twisted.enterprise.row? ;)

Unfortunately, the documentation for row seems pretty sketchy and shows
a direct parent-child relationship (room-&gt;furniture)..

it seems very unimportant what the underlying SQL does if row is
supposed to abstract it anyway..

any idears?

Thanks again!

-Justin



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002020.html">[Twisted-Python] enterprise.row and two-way relationships
</A></li>
	<LI>Next message: <A HREF="002028.html">[Twisted-Python] enterprise.row and two-way relationships
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2027">[ date ]</a>
              <a href="thread.html#2027">[ thread ]</a>
              <a href="subject.html#2027">[ subject ]</a>
              <a href="author.html#2027">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
