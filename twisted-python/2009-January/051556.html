<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Tracebacks%20being%20dropped%20from%20exceptions%20when%0A%09using%20inlineCallbacks&In-Reply-To=%3C20090117081840.12555.411923736.divmod.xquotient.3620%40weber.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051555.html">
   <LINK REL="Next"  HREF="051558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Tracebacks%20being%20dropped%20from%20exceptions%20when%0A%09using%20inlineCallbacks&In-Reply-To=%3C20090117081840.12555.411923736.divmod.xquotient.3620%40weber.divmod.com%3E"
       TITLE="[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks">glyph at divmod.com
       </A><BR>
    <I>Sat Jan 17 01:18:40 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051555.html">[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks
</A></li>
        <LI>Next message (by thread): <A HREF="051558.html">[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51556">[ date ]</a>
              <a href="thread.html#51556">[ thread ]</a>
              <a href="subject.html#51556">[ subject ]</a>
              <a href="author.html#51556">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07:54 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:
&gt;<i>2. When filing that ticket, I'd really like a full working example of 
</I>&gt;<i>inlineCallbacks not showing a traceback to play with
</I>
Just to drive that point home, Terry, I found an interesting error in 
your initial example.  Your example does this:

        info = sys.exc_info()
        f = failure.Failure(*info)

but sys.exc_info() is a tuple of (type, value, traceback), whereas 
Failure takes a tuple of (value, type, traceback).  This is why the 
default behavior of Failure() with no arguments is to capture the 
current exception.

Creating an invalid Failure, as you do here, has some _very_ weird 
ramifications for the low-level error-formatting code in the guts of the 
logging system; the reason the traceback doesn't get logged is due to an 
exception where your ZeroDivisionError instance doesn't have a 
__module__ attribute (since it's in the &quot;type&quot; slot).

If I modify your example to pass the arguments in the correct order, 
like so:

    import sys
    from twisted.internet import defer
    from twisted.python import failure

    d = defer.Deferred()
    try:
        1 / 0
    except Exception:
        exc_type, exc_value, exc_tb = sys.exc_info()
        f = failure.Failure(exc_value, exc_type, exc_tb)
        print &quot;f.tb is %r&quot; % f.tb
        d.errback(f)
        print &quot;f.tb is %r&quot; % f.tb

then I get a nice traceback, like this:

    f.tb is &lt;traceback object at 0xb7c628c4&gt;
    f.tb is None
    Unhandled error in Deferred:
    Traceback (most recent call last):
      File &quot;example.py&quot;, line 10, in &lt;module&gt;
        f = failure.Failure(exc_value, exc_type, exc_tb)
    --- &lt;exception caught here&gt; ---
      File &quot;example.py&quot;, line 7, in &lt;module&gt;
        1 / 0
    exceptions.ZeroDivisionError: integer division or modulo by zero

which is exactly what Failure is designed to do, i.e. produce useful 
tracebacks once the actual &quot;traceback&quot; instance is gone.

So, we still have some diagnosis to do on why you don't seem to be 
getting useful tracebacks from inlineCallbacks :).  Now, not only can I 
not reproduce the bug, your reasoning doesn't make sense any more 
either.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051555.html">[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks
</A></li>
	<LI>Next message (by thread): <A HREF="051558.html">[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51556">[ date ]</a>
              <a href="thread.html#51556">[ thread ]</a>
              <a href="subject.html#51556">[ subject ]</a>
              <a href="author.html#51556">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
