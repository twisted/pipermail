<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Tracebacks%20being%20dropped%20from%20exceptions%20when%0A%09using%20inlineCallbacks&In-Reply-To=%3C18801.11140.7108.766495%40jon.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051551.html">
   <LINK REL="Next"  HREF="051554.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Tracebacks%20being%20dropped%20from%20exceptions%20when%0A%09using%20inlineCallbacks&In-Reply-To=%3C18801.11140.7108.766495%40jon.es%3E"
       TITLE="[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks">terry at jon.es
       </A><BR>
    <I>Fri Jan 16 17:51:16 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051551.html">[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks
</A></li>
        <LI>Next message (by thread): <A HREF="051554.html">[Twisted-Python] Tracebacks being dropped from exceptions when 	using inlineCallbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51552">[ date ]</a>
              <a href="thread.html#51552">[ thread ]</a>
              <a href="subject.html#51552">[ subject ]</a>
              <a href="author.html#51552">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Phil

&gt;&gt;&gt;&gt;&gt;<i> &quot;Phil&quot; == Phil Christensen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">phil at bubblehouse.org</A>&gt; writes:
</I>Phil&gt; On Jan 12, 2009, at 8:36 PM, Terry Jones wrote:
&gt;&gt;<i> # added 2003-06-23. See comment above in __init__
</I>&gt;&gt;<i> c['tb'] = None
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> But the comment in __init__ seems to have been deleted.
</I>
Phil&gt; The comment was this:

Phil&gt; # added 2003-06-23 by Chris Armstrong. Yes, I actually have a
Phil&gt; # use case where I need this traceback object, and I've made
Phil&gt; # sure that it'll be cleaned up.
Phil&gt; self.tb = tb

I'd seen that comment, and even the same date on it, but assumed there was
more detail in __init__.  I don't know what Chris' use case was, but we
definitely have another one now.

I don't really understand the comment in any case. If someone creates a
Failure instance by explicitly passing in all of exc_value, exc_type, and
exc_tb - with the probable intention that this failure instance is passed
along an errback chain - then I think it's reasonable for them to expect
the Failure will keep the tb and not toss it.

I may well be misunderstanding things, but I don't see how there can be any
question that the self.tb = tb line is desirable.

Phil&gt; Originally all __getstate__ did was stringify the object's state,
Phil&gt; which is probably why cleanFailure calls it directly. It looks to me
Phil&gt; like most of the code from __getstate__ should really be moved into a
Phil&gt; separate method, which would be called from cleanFailure as well as
Phil&gt; __getstate__.

That sounds fine to me.

If I understand you and the code correctly, the only reason for calling
cleanFailure is to reduce the number of references to other objects, thus
clearing the way for garbage collection that would not otherwise happen. Is
that right?

Phil&gt; I'd appreciate any feedback.

And thanks a lot for yours. It would be very useful to get this fixed. I'm
happy to submit a patch, though your suggested change looks like a couple
of minutes' work (just swapping the names of the cleanFailure and
__getstate__ methods gets you almost all the way there).

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051551.html">[Twisted-Python] Tracebacks being dropped from exceptions when	using inlineCallbacks
</A></li>
	<LI>Next message (by thread): <A HREF="051554.html">[Twisted-Python] Tracebacks being dropped from exceptions when 	using inlineCallbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51552">[ date ]</a>
              <a href="thread.html#51552">[ thread ]</a>
              <a href="subject.html#51552">[ subject ]</a>
              <a href="author.html#51552">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
