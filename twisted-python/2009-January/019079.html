<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Beginner's question about names and callbacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Beginner%27s%20question%20about%20names%20and%20callbacks&In-Reply-To=ed9894e50901252206p2e5a7fedlc6dc93f95ae648dc%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019078.html">
   <LINK REL="Next"  HREF="019105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Beginner's question about names and callbacks</H1>
    <B>Tim Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Beginner%27s%20question%20about%20names%20and%20callbacks&In-Reply-To=ed9894e50901252206p2e5a7fedlc6dc93f95ae648dc%40mail.gmail.com"
       TITLE="[Twisted-Python] Beginner's question about names and callbacks">screwtape at froup.com
       </A><BR>
    <I>Mon Jan 26 01:46:20 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019078.html">[Twisted-Python] Beginner's question about names and callbacks
</A></li>
        <LI>Next message: <A HREF="019105.html">[Twisted-Python] Beginner's question about names and callbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19079">[ date ]</a>
              <a href="thread.html#19079">[ thread ]</a>
              <a href="subject.html#19079">[ subject ]</a>
              <a href="author.html#19079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jan 26, 2009 at 01:06:37AM -0500, Adan Broderick wrote:
&gt;<i> I'm trying to write a program that will call my own function whenever a
</I>&gt;<i> query to a nameserver times out. I have figured out how to run the DNS
</I>&gt;<i> server. And I also know how to use filterAnswers(). But how do I catch the
</I>&gt;<i> &quot;Failure: twisted.names.error.DNSQueryTimeoutError:&quot; messages by adding code
</I>&gt;<i> to the resolver I've constructed?
</I>
I'm not familiar with twisted.names, but looking at the source to
client.Resolver, it seems that something winds up calling _lookup() with
a timeout, which passes it off to the queryUDP() and sets up the basic
result handling. If queryUDP() returns a result, it goes to filterAnswers,
which checks for truncation and re-sends with queryTCP().

Since the actual deferreds that deal with the timeouts are returned from
queryUDP() and queryTCP(), it looks like you should be overriding those
methods and capturing the results instead. Something like this:

class MyResolver(client.Resolver):

    def _handle_query_timeout(self, fail):
	fail.trap(DNSQueryTimeoutError)
	print &quot;Got an error:&quot;, fail.getErrorMessage()

    def queryUDP(self, *args, **kwargs):
	d = client.Resolver.queryUDP(self, *args, **kwargs)
	d.addErrback(self._handle_query_timeout)
	return d

    def queryTCP(self, *args, **kwargs):
	d = client.Resolver.queryTCP(self, *args, **kwargs)
	d.addErrback(self._handle_query_timeout)
	return d


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019078.html">[Twisted-Python] Beginner's question about names and callbacks
</A></li>
	<LI>Next message: <A HREF="019105.html">[Twisted-Python] Beginner's question about names and callbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19079">[ date ]</a>
              <a href="thread.html#19079">[ thread ]</a>
              <a href="subject.html#19079">[ subject ]</a>
              <a href="author.html#19079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
