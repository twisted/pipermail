<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] IPushProducer problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20IPushProducer%20problem&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019007.html">
   <LINK REL="Next"  HREF="019009.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] IPushProducer problem</H1>
    <B>Gabriel Rossetti</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20IPushProducer%20problem&In-Reply-To="
       TITLE="[Twisted-Python] IPushProducer problem">gabriel.rossetti at arimaz.com
       </A><BR>
    <I>Tue Jan 13 10:34:29 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019007.html">[Twisted-Python] connectTCP() passing a ClientFactory: how to get	the local port of the created client socket?
</A></li>
        <LI>Next message: <A HREF="019009.html">[Twisted-Python] IPushProducer problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19008">[ date ]</a>
              <a href="thread.html#19008">[ thread ]</a>
              <a href="subject.html#19008">[ subject ]</a>
              <a href="author.html#19008">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

I implemented a push-produce a while back and I though it works, but it 
didn't. When the msgs where spaced out, it worked, but if several msgs 
were sent one after the other, then things go bad (the msgs get mixed up)...

I found this thread : 
<A HREF="http://www.twistedmatrix.com/pipermail/twisted-python/2007-March/014983.html">http://www.twistedmatrix.com/pipermail/twisted-python/2007-March/014983.html</A>

and I think I ave the same problem, my code looks a bit like his :

    def pauseProducing(self):
        &quot;&quot;&quot;
        Pause the producer
        &quot;&quot;&quot;
        self.__paused = True

    def resumeProducing(self):
        &quot;&quot;&quot;
        Resume the producer
        &quot;&quot;&quot;
        self.__paused = False

        while(not self.__paused and self.__startLimit &lt; self.__total):
            data = self.__buf[self.__startLimit:self.__endLimit]
            self.transport.write(data)
            self.__startLimit = self.__endLimit
            self.__endLimit += self.__burstSize
            if(not self.__stream):
                break

        if(not self.__paused or self.__startLimit &gt;= self.__total):
            self.stopProducing()

    def stopProducing(self):
        &quot;&quot;&quot;
        Stop the producer
        &quot;&quot;&quot;
        self.__paused = False
        self.__startLimit = 0
        self.__buf = None
        self.__total = None
        self.__endLimit = self.__burstSize

and when I send a msg I use this :

def sendMessage(self, msg):
        if domish.IElement.providedBy(msg):
            msg = msg.toXml()
       
        if isinstance(msg, unicode):
            msg = msg.encode('utf-8')
               
        self.__buf = msg
        self.__total = len(msg)
        if(self.__stream):
            self.resumeProducing()

I think what happens is that the code is re-entered, just like Jean-Paul 
suggested in the other thread. The thing is I didn't understand the 
solution, could somebody please explain it to me or suggest something else?

Thank you,
Gabriel


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019007.html">[Twisted-Python] connectTCP() passing a ClientFactory: how to get	the local port of the created client socket?
</A></li>
	<LI>Next message: <A HREF="019009.html">[Twisted-Python] IPushProducer problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19008">[ date ]</a>
              <a href="thread.html#19008">[ thread ]</a>
              <a href="subject.html#19008">[ subject ]</a>
              <a href="author.html#19008">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
