<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: How to write (network) integration tests with	Twisted?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20How%20to%20write%20%28network%29%20integration%20tests%20with%0A%09Twisted%3F&In-Reply-To=84987d20901260002q2ddba745x4601aa5ccb20ebd9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019086.html">
   <LINK REL="Next"  HREF="019095.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: How to write (network) integration tests with	Twisted?</H1>
    <B>Martin Geisler</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20How%20to%20write%20%28network%29%20integration%20tests%20with%0A%09Twisted%3F&In-Reply-To=84987d20901260002q2ddba745x4601aa5ccb20ebd9%40mail.gmail.com"
       TITLE="[Twisted-Python] Re: How to write (network) integration tests with	Twisted?">mg at daimi.au.dk
       </A><BR>
    <I>Mon Jan 26 12:00:07 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019086.html">[Twisted-Python] How to write (network) integration tests with	Twisted?
</A></li>
        <LI>Next message: <A HREF="019095.html">[Twisted-Python] Re: How to write (network) integration tests 	with Twisted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19091">[ date ]</a>
              <a href="thread.html#19091">[ thread ]</a>
              <a href="subject.html#19091">[ subject ]</a>
              <a href="author.html#19091">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alessio Pace &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">alessio.pace at gmail.com</A>&gt; writes:

&gt;<i> I would like to put in my suite of tests some integration tests which
</I>&gt;<i> deal with running some exchange of messages among 2 endpoints (bound
</I>&gt;<i> locally on the same machine on 2 different ports).
</I>&gt;<i>
</I>&gt;<i> I noticed (and read afterwards..) that I can't run()/stop() the
</I>&gt;<i> reactor multiple times, so I was wondering what's the suggested way to
</I>&gt;<i> deal with this kind of situation.
</I>&gt;<i>
</I>&gt;<i> Sorry if perhaps it is documented somewhere on the Twisted doc but
</I>&gt;<i> apart from the mention to &quot;Trial&quot; (which I'm not sure responds to my
</I>&gt;<i> needs) I haven't found much.
</I>
Trial is what you want, it knows how to deal with the Deferreds you are
likely to return from your tests.

The point is that you can do stuff like this where getPage is a function
which returns a Deferred:

  def test_something(self):
    p = getPage(&quot;<A HREF="http://example.com/&quot;">http://example.com/&quot;</A>)
    p.addCallback(self.assertEquals, &quot;&lt;html&gt;...&lt;/html&gt;&quot;)
    return p

When you return p from the test, the reactor will wait until p has fired
before starting the next test. When p fires, the callbacks are executed
like normal, and here the callsback compares the HTML retrieved with the
expected content. If p does not fire within a given timeout (120 seconds
by default, I think) the reactor will declare the test a failure.

Take a look at the tutorial here:

  <A HREF="http://twistedmatrix.com/trac/browser/branches/trial-tutorial-2443/doc/core/howto/trial.xhtml">http://twistedmatrix.com/trac/browser/branches/trial-tutorial-2443/doc/core/howto/trial.xhtml</A>

Use the link for &quot;Original Format&quot; at the bottom to view as HTML, though
I'm getting an XML parse error from my browser when I do this.

I'm using the twisted.protocols.loopback module for connecting several
parties with a pseudo-transport. This allows the testing code to behave
like in your normal application, but the communication is done with
function calls instead of actual network traffic.


-- 
Martin Geisler

VIFF (Virtual Ideal Functionality Framework) brings easy and efficient
SMPC (Secure Multiparty Computation) to Python. See: <A HREF="http://viff.dk/.">http://viff.dk/.</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 196 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20090126/14f50402/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20090126/14f50402/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019086.html">[Twisted-Python] How to write (network) integration tests with	Twisted?
</A></li>
	<LI>Next message: <A HREF="019095.html">[Twisted-Python] Re: How to write (network) integration tests 	with Twisted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19091">[ date ]</a>
              <a href="thread.html#19091">[ thread ]</a>
              <a href="subject.html#19091">[ subject ]</a>
              <a href="author.html#19091">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
