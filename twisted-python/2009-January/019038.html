<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Write into a persistent connection before stopping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Write%20into%20a%20persistent%20connection%20before%20stopping&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019040.html">
   <LINK REL="Next"  HREF="019045.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Write into a persistent connection before stopping</H1>
    <B>Boeuf, Jean-Francois</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Write%20into%20a%20persistent%20connection%20before%20stopping&In-Reply-To="
       TITLE="[Twisted-Python] Write into a persistent connection before stopping">jean-francois.boeuf at eads.com
       </A><BR>
    <I>Fri Jan 16 07:33:31 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019040.html">[Twisted-Python] reactor.stop() and thread and wxPython problem
</A></li>
        <LI>Next message: <A HREF="019045.html">[Twisted-Python] getProcessOutput on windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19038">[ date ]</a>
              <a href="thread.html#19038">[ thread ]</a>
              <a href="subject.html#19038">[ subject ]</a>
              <a href="author.html#19038">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> 
Hello,

I have an application using twisted in which the web browser opens a
persistent connection when a user logs in (COMET model). I want to write
data into active persistent connections at server stop to notify client to
logout properly.

To do that, I add a system event trigger to the reactor calling the method
that closes session before shutdown when I start the webService. This method
is called when twisted receives a SIGTERM and I can see in twistd.log traces
of writing to the persistent connexion before services stops and connexions
are closed. But the web browser never receives this content and listening
the traffic between server and client with wireshark, I can't see anything
else than the [FIN, ACK] packets that are sent when server ends all
connections (delayed for maximum clarity in the logs).

The same method is called to logout client properly when session expires and
does work fully.

You can see below the twistd.log file when the servers stops.

Thank you for your help.

Regards

Jean-Fran&#231;ois


twistd.log
----------
2009-01-16 13:26:16+0100 [-] Received SIGTERM, shutting down.
2009-01-16 13:26:16+0100 [-] 10.37.68.212 - - [16/Jan/2009:12:26:16 +0000]
&quot;GET /sim/listen?sourceScreen=216 HTTP/1.1&quot; 200 166
&quot;<A HREF="http://peyo:8080/sim?id=216&quot;">http://peyo:8080/sim?id=216&quot;</A> &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fr;
rv:1.8.1.16) Gecko/20080702 Firefox/2.0.0.16&quot;
2009-01-16 13:26:16+0100 [-] 10.37.68.212 - - [16/Jan/2009:12:26:16 +0000]
&quot;GET /sim/listen?sourceScreen=217 HTTP/1.1&quot; 200 166
&quot;<A HREF="http://peyo:8080/sim?id=217&quot;">http://peyo:8080/sim?id=217&quot;</A> &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fr;
rv:1.8.1.16) Gecko/20080702 Firefox/2.0.0.16&quot;
2009-01-16 13:26:16+0100 [-] 10.37.68.212 - - [16/Jan/2009:12:26:16 +0000]
&quot;GET /sim/listen?sourceScreen=218 HTTP/1.1&quot; 200 166
&quot;<A HREF="http://peyo:8080/sim?id=218&amp;screen0=216&amp;screen1=217&amp;nbScreen=2&quot;">http://peyo:8080/sim?id=218&amp;screen0=216&amp;screen1=217&amp;nbScreen=2&quot;</A>
&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.8.1.16) Gecko/20080702
Firefox/2.0.0.16&quot;
2009-01-16 13:26:25+0100 [-] (Port 8080 Closed)
2009-01-16 13:26:25+0100 [-] Stopping factory
&lt;cockpitServer.userSessionManagement.cockpitSite.CockpitSite object at
0xb6db9e6c&gt;
2009-01-16 13:26:25+0100 [-] (Port 8082 Closed)
2009-01-16 13:26:25+0100 [-] Stopping factory
&lt;cockpitServer.soapService.SoapSite object at 0xb7092d0c&gt;
2009-01-16 13:26:25+0100 [-] Main loop terminated.
2009-01-16 13:26:25+0100 [-] Server Shut Down


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019040.html">[Twisted-Python] reactor.stop() and thread and wxPython problem
</A></li>
	<LI>Next message: <A HREF="019045.html">[Twisted-Python] getProcessOutput on windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19038">[ date ]</a>
              <a href="thread.html#19038">[ thread ]</a>
              <a href="subject.html#19038">[ subject ]</a>
              <a href="author.html#19038">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
