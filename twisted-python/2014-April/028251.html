<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Synchronous @inlineCallback interpreter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Synchronous%20%40inlineCallback%20interpreter&In-Reply-To=%3CCACKEAnXvjggutstq5NXqFjL1-WqKdbC3a0DHa3p54eEOh%3DjPxA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028250.html">
   <LINK REL="Next"  HREF="028252.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Synchronous @inlineCallback interpreter</H1>
    <B>Clayton Daley</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Synchronous%20%40inlineCallback%20interpreter&In-Reply-To=%3CCACKEAnXvjggutstq5NXqFjL1-WqKdbC3a0DHa3p54eEOh%3DjPxA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Synchronous @inlineCallback interpreter">clayton.daley at gmail.com
       </A><BR>
    <I>Thu Apr 24 20:28:04 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028250.html">[Twisted-Python] Synchronous @inlineCallback interpreter
</A></li>
        <LI>Next message: <A HREF="028252.html">[Twisted-Python] Twisted 14.0.0pre3 Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28251">[ date ]</a>
              <a href="thread.html#28251">[ thread ]</a>
              <a href="subject.html#28251">[ subject ]</a>
              <a href="author.html#28251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>[apologize in advance if this creates threading issues as I picked digests
when I signed up not realizing it would make it difficult to reply to
threads]

Sorry I wasn't more clear.  My thought is to write a version that uses the
same @inlineCallback name and supports the same syntax (to eliminate the
need to rewrite code).  However, I don't mean the synchronous version to
actually use deferreds at all.  All I want the synchronous version to do is
&quot;ignore&quot; the yields (likely by sending the output right back in after the
block clears)... and treat the returnValue() as a return.

That way code written in the @inlineCallback syntax can be used by a
synchronous or asynchronous consumer.

Clayton Daley


On Thu, Apr 24, 2014 at 8:14 PM, pierre at jaury.eu wrote:

&gt;<i>
</I>Le 2014-04-25 01:45, Clayton Daley a &#233;crit :
&gt;<i>* I imagine rewriting this to the following:
</I>*&gt; &gt;*     @classmethod
*&gt;*     @inlineCallbacks
*&gt;*     def from_id(cls, id):
*&gt;*         doc = yield db.get_document(id) # blocking/async db call
*&gt; &gt;*         self = cls._new_document(doc) # always synchronous
*&gt;*          yield self.__init__() # blocking/async call
*&gt;*         returnValue(self)
*&gt; &gt;* places. I've read that the @inlineCallback code is complicated so I
*&gt;* figured I'd run the idea by the experts before diving down that rabbit
*&gt;* hole.
*
I am no expert, but the code for inlineCallbacks looks pretty
straightforward, except some special cases handled down the way.

&gt;<i>* Does anyone see any obvious pitfall? I'm happy to do the legwork
</I>*&gt;* to try and build it, but I'd also welcome any pointers from your (no
*&gt;* doubt extensive) experience writing the twisted version.
*
I would mostly argue about a semantic problem. inlineCallbacks help
asynchronous code *look* like synchronous code thanks to the sequential
writing. It is however essentially asynchronous and does return a
Deferred.

I do not see any immediate technical pitfall here. I would however be
very careful and double think my design if I were to use Deferred
objects as part of a blocking process.

kaiyou.


On Thu, Apr 24, 2014 at 7:45 PM, Clayton Daley &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">clayton.daley at gmail.com</A>&gt;wrote:

&gt;<i> I have a modular application that communicates over RPC connections (with
</I>&gt;<i> both sync and async server/clients available).  I want to migrate some of
</I>&gt;<i> the modules over to Twisted. Currently, all modules inherit important
</I>&gt;<i> utility functions from a parent class.  On paper, I now need two versions
</I>&gt;<i> of this parent class (synchronous &amp; asynchronous) to be inherited by
</I>&gt;<i> modules of the respective types.
</I>&gt;<i>
</I>&gt;<i> I'm looking for ways to maximize the common code between the two versions
</I>&gt;<i> of the parent object. One that comes to mind (motivating the subject of
</I>&gt;<i> this post) would be to write a synchronous interpreter for @inlineCallback
</I>&gt;<i> calls.  For example, here's a synchronous factory function from the parent
</I>&gt;<i> class (already partly reconfigured to be friendly to my idea):
</I>&gt;<i>
</I>&gt;<i>     @classmethod
</I>&gt;<i>     def from_id(cls, id):
</I>&gt;<i>         doc = db.get_document(id) # blocking db call
</I>&gt;<i>         self = cls._new_document(doc) # synchronous initialization stuff
</I>&gt;<i>         self.__init__() # module init code is custom and may block
</I>&gt;<i>         return self
</I>&gt;<i>
</I>&gt;<i> I imagine rewriting this to the following:
</I>&gt;<i>
</I>&gt;<i>     @classmethod
</I>&gt;<i>     @inlineCallbacks
</I>&gt;<i>     def from_id(cls, id):
</I>&gt;<i>         doc = yield db.get_document(id) # blocking/async db call
</I>&gt;<i>         self = cls._new_document(doc) # always synchronous
</I>&gt;<i>         yield self.__init__() # blocking/async call
</I>&gt;<i>         returnValue(self)
</I>&gt;<i>
</I>&gt;<i> Assuming the db connector and init function are appropriate to the
</I>&gt;<i> environment, my gut reaction is that this could (when combined with a
</I>&gt;<i> synchronous implementation of the decorator) run correctly in both places.
</I>&gt;<i> I've read that the @inlineCallback code is complicated so I figured I'd run
</I>&gt;<i> the idea by the experts before diving down that rabbit hole. Does anyone
</I>&gt;<i> see any obvious pitfall? I'm happy to do the legwork to try and build it,
</I>&gt;<i> but I'd also welcome any pointers from your (no doubt extensive) experience
</I>&gt;<i> writing the twisted version.
</I>&gt;<i>
</I>&gt;<i> Thanks in advance!
</I>&gt;<i>
</I>&gt;<i> Clayton Daley
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20140424/669f4e3e/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20140424/669f4e3e/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028250.html">[Twisted-Python] Synchronous @inlineCallback interpreter
</A></li>
	<LI>Next message: <A HREF="028252.html">[Twisted-Python] Twisted 14.0.0pre3 Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28251">[ date ]</a>
              <a href="thread.html#28251">[ thread ]</a>
              <a href="subject.html#28251">[ subject ]</a>
              <a href="author.html#28251">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
