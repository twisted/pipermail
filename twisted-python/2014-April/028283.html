<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] pb objects unexpectedly change identity
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20pb%20objects%20unexpectedly%20change%20identity&In-Reply-To=%3CCAKN9TDJ02ayP-XsxTfyeU5ONn8tFFyHHT1RRyDdD%3D-FN8G2fqQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028277.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] pb objects unexpectedly change identity</H1>
    <B>Daniel Sank</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20pb%20objects%20unexpectedly%20change%20identity&In-Reply-To=%3CCAKN9TDJ02ayP-XsxTfyeU5ONn8tFFyHHT1RRyDdD%3D-FN8G2fqQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] pb objects unexpectedly change identity">sank.daniel at gmail.com
       </A><BR>
    <I>Wed Apr 30 21:09:32 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028277.html">[Twisted-Python] pb objects unexpectedly change identity
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28283">[ date ]</a>
              <a href="thread.html#28283">[ thread ]</a>
              <a href="subject.html#28283">[ subject ]</a>
              <a href="author.html#28283">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Twisted users,

To my amazement I have reproduced this strange behaviour in an even simpler
program. Attached are a pb client/server which illustrate unexpected
behaviour of the id of a pb.RemoteCache. To run the example, run server.py
and then client.py (with resources.py in the same working directory).

You will see output like this (line numbers added by me)

====
1. RemoteCache 29403544 initialized
2. Client received RemoteCache: id=29403544
3. RemoteCache: while responding to observe_add I think my id is 29403760
4. Client: The RemoteCache's ide is 29403544
...
====

1. When the RemoteCache is initialized it thinks its id is 29403544.
2. The client agrees that it has received a RemoteCache with id 29403544.
3. When the RemoteCache is inside observe_add it thinks its id is 29403760.
4. The client still thinks the RemoteCache's id is 29403544.

If you let the program run it will continue to loop between the RemoteCache
reporting its id while in observe_add, and the client reporting the id of
the RemoteCache. The two reported ids are always the same unequal numbers.

The question appears to be &quot;Why does the id reported by a RemoteCache's
while inside an observe_* method differ the id reported by objects owning
references to that RemoteCache?&quot;

Thank you for your time,
Daniel




On Wed, Apr 30, 2014 at 11:00 AM, Daniel Sank &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sank.daniel at gmail.com</A>&gt; wrote:

&gt;<i> Dear twisted users,
</I>&gt;<i>
</I>&gt;<i> I think I have found some surprising behavior in perspective broker. I
</I>&gt;<i> define a subclass of pb.RemoteCache which has a method managed by a
</I>&gt;<i> descriptor. The descriptor keeps track of the instances it manages in a set.
</I>&gt;<i>
</I>&gt;<i> When the RemoteCache is first received by the client, it accesses the
</I>&gt;<i> descriptor-ified method inside setCopyableState. At that time the
</I>&gt;<i> RemoteCache's id is a certain value X. Then later when the RemoteCache is
</I>&gt;<i> notified of a change by the server side Cacheable, it again accesses the
</I>&gt;<i> descriptor-ified method, but at this time it's id is Y, and Y!=X.
</I>&gt;<i>
</I>&gt;<i> I attach to this post a simple working example which displays the behavior
</I>&gt;<i> described above. To run, first run server.py and then run client.py. You
</I>&gt;<i> will see a little bit of output, the most important part being
</I>&gt;<i>
</I>&gt;<i> ===
</I>&gt;<i> Client received RemoteCache: id=45952496
</I>&gt;<i>
</I>&gt;<i> Asking server to update
</I>&gt;<i> TD 45921680 (test.RemoteCache.add) accessed by &lt;test.RemoteCache instance
</I>&gt;<i> at 2BD2DC8&gt;: id=45952456
</I>&gt;<i> RemoteCache id=45952496
</I>&gt;<i> ===
</I>&gt;<i>
</I>&gt;<i> To understand the details of the output please see descriptor.py. The id
</I>&gt;<i> of the RemoteCache is first reported as 45952496 when the client receives
</I>&gt;<i> it. Then, when the descriptor is accessed, the id of the accessing instance
</I>&gt;<i> is reported as 45952456, which is different. Then, when in the last line we
</I>&gt;<i> print out the id of the RemoteCache we're back to 45952496.
</I>&gt;<i>
</I>&gt;<i> Is there some reason that a RemoteCache's id can change during its life
</I>&gt;<i> time?
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Daniel Sank
</I>&gt;<i> Department of Physics
</I>&gt;<i> Broida Hall
</I>&gt;<i> University of California
</I>&gt;<i> Santa Barbara, CA 93117
</I>&gt;<i> (805)893-3899
</I>&gt;<i>
</I>


-- 
Daniel Sank
Department of Physics
Broida Hall
University of California
Santa Barbara, CA 93117
(805)893-3899
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20140430/e55ac54b/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20140430/e55ac54b/attachment.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: client.py
Type: text/x-python
Size: 190 bytes
Desc: not available
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20140430/e55ac54b/attachment.py">http://twistedmatrix.com/pipermail/twisted-python/attachments/20140430/e55ac54b/attachment.py</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: resources.py
Type: text/x-python
Size: 2994 bytes
Desc: not available
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20140430/e55ac54b/attachment-0001.py">http://twistedmatrix.com/pipermail/twisted-python/attachments/20140430/e55ac54b/attachment-0001.py</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: server.py
Type: text/x-python
Size: 428 bytes
Desc: not available
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20140430/e55ac54b/attachment-0002.py">http://twistedmatrix.com/pipermail/twisted-python/attachments/20140430/e55ac54b/attachment-0002.py</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028277.html">[Twisted-Python] pb objects unexpectedly change identity
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28283">[ date ]</a>
              <a href="thread.html#28283">[ thread ]</a>
              <a href="subject.html#28283">[ subject ]</a>
              <a href="author.html#28283">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
