<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A Python metaclass for Twisted allowing __init__	to return a Deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20Python%20metaclass%20for%20Twisted%20allowing%20__init__%0A%09to%20return%20a%20Deferred&In-Reply-To=%3C20081104111127.6400.342806414.divmod.xquotient.903%40weber.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051132.html">
   <LINK REL="Next"  HREF="051139.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A Python metaclass for Twisted allowing __init__	to return a Deferred</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20Python%20metaclass%20for%20Twisted%20allowing%20__init__%0A%09to%20return%20a%20Deferred&In-Reply-To=%3C20081104111127.6400.342806414.divmod.xquotient.903%40weber.divmod.com%3E"
       TITLE="[Twisted-Python] A Python metaclass for Twisted allowing __init__	to return a Deferred">glyph at divmod.com
       </A><BR>
    <I>Tue Nov  4 04:11:27 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051132.html">[Twisted-Python] A Python metaclass for Twisted allowing __init__	to return a Deferred
</A></li>
        <LI>Next message (by thread): <A HREF="051139.html">[Twisted-Python] A Python metaclass for Twisted allowing __init__	to return a Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51137">[ date ]</a>
              <a href="thread.html#51137">[ thread ]</a>
              <a href="subject.html#51137">[ subject ]</a>
              <a href="author.html#51137">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02:33 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">terry at jon.es</A> wrote:
&gt;<i>That would be fine if makeService could in turn return a Deferred that
</I>&gt;<i>would result in an object implementing IServiceMaker, but as far as I 
</I>&gt;<i>can
</I>&gt;<i>tell, makeService does not allow this. And in the context of a Twisted
</I>&gt;<i>plugin file like the above I'm even less clear on how to go about it.
</I>&gt;<i>
</I>&gt;<i>Am I missing something here?
</I>
As a matter of fact, yes :).

A Service instance is effectively a piece of static configuration.  In 
your example, you need to do reactor work; communicate with a remote 
database in a thread.  Services very definitely should _not_ be 
generating network traffic, scheduling timed calls, or otherwise talking 
to the reactor until &quot;startService&quot; has been called.  The idea with a 
Service is that you should be able to write a serialization mechanism 
that loads it out of a text file, a string in memory, or in your case a 
set of command line arguments, without touching any other objects, so 
that it can be re-configured and re-serialized by configuration tools.

You may want to create some _other_ configuration object, loaded from 
the remote database, in the middle of startService.  You may even want 
to have a multi-phase internal startup procedure to generate that 
object.  But you need to keep track of what state those things are in so 
that the infrastructure can come around and say stopService to you in 
the middle of that procedure and still get a clean, ordered shutdown. 
If the infrastructure were to get back a Deferred, there's nothing to 
call stopService on.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051132.html">[Twisted-Python] A Python metaclass for Twisted allowing __init__	to return a Deferred
</A></li>
	<LI>Next message (by thread): <A HREF="051139.html">[Twisted-Python] A Python metaclass for Twisted allowing __init__	to return a Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51137">[ date ]</a>
              <a href="thread.html#51137">[ thread ]</a>
              <a href="subject.html#51137">[ subject ]</a>
              <a href="author.html#51137">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
