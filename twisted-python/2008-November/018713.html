<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Exception handling in t.e.adbapi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Exception%20handling%20in%20t.e.adbapi&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018715.html">
   <LINK REL="Next"  HREF="018714.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Exception handling in t.e.adbapi</H1>
    <B>Don Dwiggins</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Exception%20handling%20in%20t.e.adbapi&In-Reply-To="
       TITLE="[Twisted-Python] Exception handling in t.e.adbapi">ddwiggins at advpubtech.com
       </A><BR>
    <I>Wed Nov 19 19:38:54 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018715.html">[Twisted-Python] trial testing messages
</A></li>
        <LI>Next message: <A HREF="018714.html">[Twisted-Python] Exception handling in t.e.adbapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18713">[ date ]</a>
              <a href="thread.html#18713">[ thread ]</a>
              <a href="subject.html#18713">[ subject ]</a>
              <a href="author.html#18713">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been using adbapi (with pyodbc talking to MS SQL Server) 
successfully in a Windows service.  I've discovered that occasionally, 
the network between the service and the database machine goes down and 
comes back up (either that or the database server itself cycles down and 
back up).  When this happens, any pyodbc connections hanging around are 
corrupted, so that the next query gets an exception (class 
pyodbc.Error).  Currently, the best thing I can do is to restart the 
service.

I'm trying to rewrite the service to be able to catch, analyze, and 
respond to exceptions from pyodbc.  In particular, in the case above, 
it's possible to reconnect and retry the query.  If the network 
connection is still down, I'd like to log it, send a message to alert 
someone, or whatever.

I've rewritten a ConnectionPool.runQuery call to use runInteraction to 
call a function (in a thread) that works with the cursor created in 
runInteraction to execute the query.  The function wraps the 
cursor.execute(...) in a try-except.  I can successfully catch the 
exception, and I try to recover by doing cursor.reconnect(), then 
cursor.reopen(), and finally cursor.execute(...) again.  I'm finding 
that this fails with a &quot;wrong connection for thread&quot; exception.  I 
haven't been able to figure out why that should happen; more 
importantly, I'm not sure that I'm going about this in the right way. 
Any insights or pointers to code that does this kind of thing would be 
appreciated.

Thanks,
-- 
Don Dwiggins
Advanced Publishing Technology



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018715.html">[Twisted-Python] trial testing messages
</A></li>
	<LI>Next message: <A HREF="018714.html">[Twisted-Python] Exception handling in t.e.adbapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18713">[ date ]</a>
              <a href="thread.html#18713">[ thread ]</a>
              <a href="subject.html#18713">[ subject ]</a>
              <a href="author.html#18713">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
