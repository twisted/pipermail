<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] DeferredDict, defaultdict, map/reduce, silliness
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20DeferredDict%2C%20defaultdict%2C%20map/reduce%2C%20silliness&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018626.html">
   <LINK REL="Next"  HREF="018632.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] DeferredDict, defaultdict, map/reduce, silliness</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20DeferredDict%2C%20defaultdict%2C%20map/reduce%2C%20silliness&In-Reply-To="
       TITLE="[Twisted-Python] DeferredDict, defaultdict, map/reduce, silliness">terry at jon.es
       </A><BR>
    <I>Tue Nov  4 04:01:57 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018626.html">[Twisted-Python] DeferredDict, defaultdict, map/reduce, silliness
</A></li>
        <LI>Next message: <A HREF="018632.html">[Twisted-Python] DeferredDict, defaultdict, map/reduce, silliness
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18627">[ date ]</a>
              <a href="thread.html#18627">[ thread ]</a>
              <a href="subject.html#18627">[ subject ]</a>
              <a href="author.html#18627">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Valentino

&gt;&gt;&gt;&gt;&gt;<i> &quot;Valentino&quot; == Valentino Volonghi &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dialtone at gmail.com</A>&gt; writes:
</I>Valentino&gt; This is actually a very very nice pattern.

I thought it was too cute not to post, though I didn't really know what to
do with it. Something along the lines of map/reduce occurred to me quite
late. I bet there are other nice things you could do, mainly along the
lines of processing/bucketing a bunch of unpredictable input.

One thing I'd (probably) change would be to not use Deferred as the
argument to default dict, but to use a class that looked like it but with
the Deferred already called. That way you don't have the potentially very
long chain of callbacks building up. It's also partly a question of when
you want to do the work - each time you call addCallback, or at the end
when you've accumulated all the input and sent it off to its respective
callback chain.

So you could do something like this:

    def getDefault(init):
        def x():
            return defer.succeed(init)
        return x

and then the MapReduce class would look like

    class MapReduce(object):
        def __init__(self, init, cb):
            self.cb = cb
            self.d = defaultdict(getDefault(init))

Or, more flexibly, pass the defaultdict into the MapReduce class, giving
you the option of not having the callback chain already called, etc.

Anyway, I'm glad you like it, and hope you can do something nice with it.

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018626.html">[Twisted-Python] DeferredDict, defaultdict, map/reduce, silliness
</A></li>
	<LI>Next message: <A HREF="018632.html">[Twisted-Python] DeferredDict, defaultdict, map/reduce, silliness
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18627">[ date ]</a>
              <a href="thread.html#18627">[ thread ]</a>
              <a href="subject.html#18627">[ subject ]</a>
              <a href="author.html#18627">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
