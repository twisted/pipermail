<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] A Python metaclass for Twisted allowing	__init__ to return a Deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20Python%20metaclass%20for%20Twisted%20allowing%0A%09__init__%20to%20return%20a%20Deferred&In-Reply-To=%3C18702.17138.245542.16472%40jon.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051109.html">
   <LINK REL="Next"  HREF="051111.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] A Python metaclass for Twisted allowing	__init__ to return a Deferred</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20A%20Python%20metaclass%20for%20Twisted%20allowing%0A%09__init__%20to%20return%20a%20Deferred&In-Reply-To=%3C18702.17138.245542.16472%40jon.es%3E"
       TITLE="[Twisted-Python] A Python metaclass for Twisted allowing	__init__ to return a Deferred">terry at jon.es
       </A><BR>
    <I>Sun Nov  2 17:16:50 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051109.html">[Twisted-Python] A Python metaclass for Twisted allowing	__init__ to return a Deferred
</A></li>
        <LI>Next message (by thread): <A HREF="051111.html">[Twisted-Python] A Python metaclass for Twisted allowing	__init__ to return a Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51110">[ date ]</a>
              <a href="thread.html#51110">[ thread ]</a>
              <a href="subject.html#51110">[ subject ]</a>
              <a href="author.html#51110">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi JP

&gt;<i> I usually solve this kind of problem like this:
</I>&gt;<i> 
</I>&gt;<i>     d = aFuncReturningADeferred()
</I>&gt;<i>     d.addCallback(MyClass)
</I>&gt;<i>     d.addCallback(cb)
</I>
See? I knew there'd be a 3-line solution somewhere :-)

That's very cute, I'd never have thought of that...  Python is so nice.

My (weak?) response is that your solution isn't quite so general. What if I
want __init__ to generate the deferred based on its args, or on the result
of other functions called based on its args? Yes, I can do all that work
before using your lovely d.addCallback(MyClass), but then the logic of what
the class does is starting to leak out into the code that should be calling
the class. And you can't encapsulate THAT code into another class, because
its __init__ would in turn have to return a deferred.

BTW, I sometimes have the feeling that Deferreds are like how M$
characterizes the GPL. Viral. Once you call anything creating a Deferred,
you're hooked - whatcha gonna do with that Deferred boy? Take one sip of
the Deferred Kool Aid and the next thing you know you're on a drip.

&gt;<i> I'll not try to claim anything about the level of elegance, though. :)
</I>
History will smile on you JP.

&gt;<i> For less surprisiness, I'd suggest that you at least restrict the result
</I>&gt;<i> of the Deferred returned from __init__ to firing with None or self and
</I>&gt;<i> make the argument to the first callback on the Deferred returned by
</I>&gt;<i> MyClass() just be the new instance.
</I>
Hmmm. OK. I think you're right. The caller has no business knowing what the
Deferred returned in any case. And if the class itself wants the result it
can add a callback and stick it on self.  That's good, I had been hoping to
return just the instance, but then it occurred to me to send back the
result too.

BTW, I started out trying to think of a way to just say

  x = MyClass(...)

and have that result in the instance. But the only ways I could think of
doing that were disgusting and broken (e.g., make a *function* called
MyClass and use inlineCallbacks and some other class the metaclass would
build). So the __instantiate__ call seemed like a big win, even though I
don't like it much either.

Thanks!

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051109.html">[Twisted-Python] A Python metaclass for Twisted allowing	__init__ to return a Deferred
</A></li>
	<LI>Next message (by thread): <A HREF="051111.html">[Twisted-Python] A Python metaclass for Twisted allowing	__init__ to return a Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51110">[ date ]</a>
              <a href="thread.html#51110">[ thread ]</a>
              <a href="subject.html#51110">[ subject ]</a>
              <a href="author.html#51110">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
