<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] FirstError handling from defer.gatherResults()?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20FirstError%20handling%20from%20defer.gatherResults%28%29%3F&In-Reply-To=%3C20081105053624.29191.578608441.divmod.quotient.49920%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="051146.html">
   <LINK REL="Next"  HREF="051149.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] FirstError handling from defer.gatherResults()?</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20FirstError%20handling%20from%20defer.gatherResults%28%29%3F&In-Reply-To=%3C20081105053624.29191.578608441.divmod.quotient.49920%40ohm%3E"
       TITLE="[Twisted-Python] FirstError handling from defer.gatherResults()?">exarkun at divmod.com
       </A><BR>
    <I>Tue Nov  4 22:36:24 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="051146.html">[Twisted-Python] FirstError handling from defer.gatherResults()?
</A></li>
        <LI>Next message (by thread): <A HREF="051149.html">[Twisted-Python] FirstError handling from defer.gatherResults()?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51147">[ date ]</a>
              <a href="thread.html#51147">[ thread ]</a>
              <a href="subject.html#51147">[ subject ]</a>
              <a href="author.html#51147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 05 Nov 2008 14:00:56 +1100, Justin Warren &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">daedalus at eigenmagic.com</A>&gt; wrote:
&gt;<i>On Wed, 2008-11-05 at 02:51 +0100, Terry Jones wrote:
</I>&gt;&gt;<i> Hi Justin
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;&gt;&gt;&gt;&gt; &quot;Justin&quot; == Justin Warren &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">daedalus at eigenmagic.com</A>&gt; writes:
</I>&gt;&gt;<i> Justin&gt; If an error occurs, gatherResults() behaves like
</I>&gt;&gt;<i> Justin&gt; DeferredList(fireOnOneErrback=True), but the errback will receive a
</I>&gt;&gt;<i> Justin&gt; FirstError object, not a Failure.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Justin&gt; Normally, I'd do something like this in an Errback:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Justin&gt; def cb_handle_failure(failure):
</I>&gt;&gt;<i> Justin&gt;   e = failure.trap(MyNonFatalException)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Justin&gt; But what is the right way to do this when I receive a FirstError?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The FirstError holds the original failure in an attribute called
</I>&gt;&gt;<i> subFailure. So you should be able to do
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     e = failure.value.subFailure.trap(MyNonFatalException)
</I>&gt;<i>
</I>&gt;<i>Yes, ok. That's what I thought I should be doing, however trial appears
</I>&gt;<i>to still think that the error I've trapped has occurred, and ERRORs the
</I>&gt;<i>test. Am I not clearing state somewhere? I thought that simply handling
</I>&gt;<i>the failure (and not returning a Failure from the errback) would stop
</I>&gt;<i>this?
</I>
The Deferred in the list you passed to gatherResults still failed
because gatherResults doesn't pass consumeErrors=True to the DeferredList
it created.  So even though you trapped the failure from the Deferred
gatherResults returned, the original Deferred still has an unhandled
failure and your test gets an error.

To fix this, use DeferredList instead of gatherResults (or your own
version of gatherResults that does pass consumeErrors=True) or add
your own errbacks to all the Deferreds in the list after you've
passed the list to gatherResults.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="051146.html">[Twisted-Python] FirstError handling from defer.gatherResults()?
</A></li>
	<LI>Next message (by thread): <A HREF="051149.html">[Twisted-Python] FirstError handling from defer.gatherResults()?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51147">[ date ]</a>
              <a href="thread.html#51147">[ thread ]</a>
              <a href="subject.html#51147">[ subject ]</a>
              <a href="author.html#51147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
