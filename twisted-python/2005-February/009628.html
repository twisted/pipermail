<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20how%20to%20stop%20dataReceived%20while%20waiting%20a%0A%09deferred%20to%20fire%3F&In-Reply-To=20050221204757.12282.856735952.divmod.quotient.9108%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009627.html">
   <LINK REL="Next"  HREF="009629.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20how%20to%20stop%20dataReceived%20while%20waiting%20a%0A%09deferred%20to%20fire%3F&In-Reply-To=20050221204757.12282.856735952.divmod.quotient.9108%40ohm"
       TITLE="[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?">andrea at cpushare.com
       </A><BR>
    <I>Mon Feb 21 16:36:44 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009627.html">[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
</A></li>
        <LI>Next message: <A HREF="009629.html">[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9628">[ date ]</a>
              <a href="thread.html#9628">[ thread ]</a>
              <a href="subject.html#9628">[ subject ]</a>
              <a href="author.html#9628">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 21, 2005 at 08:47:57PM +0000, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:
&gt;<i> On Mon, 21 Feb 2005 18:46:18 +0100, Andrea Arcangeli &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrea at cpushare.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Ok here we go, I even found a severe bug in the linereceiver code and I
</I>&gt;<i> &gt; fixed it as well. The bug in linereceiver happens like this:
</I>&gt;<i> 
</I>&gt;<i> Any chance that you could include some unit tests for the behavior
</I>&gt;<i> you're expecting?  I think it might need to be fixed a different way.
</I>&gt;<i> For example:
</I>
Using the echoserver/client as base should be good enough to test this.
&gt;<i>From the client send a flood of lines, and from the server call
</I>pauseProducing() after the first line has been received. Then verify the
server doesn't receive the other lines and that they sit in the tcp recv
queue.

&gt;<i> &gt; -        while len(self.recvd) &gt; 1:
</I>&gt;<i> &gt; +        while len(self.recvd) &gt; 1 and not self.paused:
</I>&gt;<i> 
</I>&gt;<i> This seems like it could lead to some unpleasantly large (i.e.
</I>&gt;<i> quadratic-time concatenation) buffers strings being left around if you
</I>&gt;<i> pause one of these receivers and then forget to unpause it, or even
</I>
Won't the data be freed along with the protocol when the connection is
closed? The protocol should go away when the connection is closed.

&gt;<i> just if your peer happens to be sending data very rapidly.
</I>
The high bound of in flight receive data for each int32 protocol is set
to 99999 (protocol.MAX_LENGTH), and the reactor will read with a limited
buffer too. So I don't see any problem as long as
transport.pauseProducing() does what's expected to do (i.e. to stop
polling the socket and to stop receiving data from the wire).

Anyway if there's still a problem, let's ignore my problem, and let's
only focus on the LineReceiver implementation that is already in current
twisted. As long as LineReceiver works my patch is going to be fine.

There was a reentrancy bug in LineReceiver but I already fixed it.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009627.html">[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
</A></li>
	<LI>Next message: <A HREF="009629.html">[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9628">[ date ]</a>
              <a href="thread.html#9628">[ thread ]</a>
              <a href="subject.html#9628">[ subject ]</a>
              <a href="author.html#9628">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
