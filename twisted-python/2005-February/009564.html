<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: twisted.enterprise.adbapi and connection pool	problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20twisted.enterprise.adbapi%20and%20connection%20pool%0A%09problem&In-Reply-To=1f060c4c050214130539cfb629%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009566.html">
   <LINK REL="Next"  HREF="009569.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: twisted.enterprise.adbapi and connection pool	problem</H1>
    <B>Nicola Larosa</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20twisted.enterprise.adbapi%20and%20connection%20pool%0A%09problem&In-Reply-To=1f060c4c050214130539cfb629%40mail.gmail.com"
       TITLE="[Twisted-Python] Re: twisted.enterprise.adbapi and connection pool	problem">nico at tekNico.net
       </A><BR>
    <I>Mon Feb 14 16:44:46 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009566.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
        <LI>Next message: <A HREF="009569.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9564">[ date ]</a>
              <a href="thread.html#9564">[ thread ]</a>
              <a href="subject.html#9564">[ subject ]</a>
              <a href="author.html#9564">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i> I've noticed a bug(?) or at least misbehaviour in adapi connection pool.
</I>&gt;&gt;<i> I've got a daemon program which keeps a few connections to PostgreSQL
</I>&gt;&gt;<i> database and when a client connects and sends some commands it queries the
</I>&gt;&gt;<i> database and sends back results. Everything works fine, until I restart
</I>&gt;&gt;<i> PostgreSQL. All commands fail and the only trace I've got is the response
</I>&gt;&gt;<i> from the database:
</I>
&gt;<i> Attempting reconnects just isn't part of adbapi as far as I can tell. 
</I>&gt;<i> I use psycopg with postgresql and here is how I handle this, maybe
</I>&gt;<i> someone else has a better way of doing it.  This tests the database
</I>&gt;<i> connection every 10 seconds, and attempts to reconnect 3 times if it
</I>&gt;<i> gets an error, otherwise it exits.  It's not very complete but that's
</I>&gt;<i> because I just threw it together today...
</I>
Funny, I had the same problem and threw together a similar solution with
the same approach, down to the &quot;SELECT 1&quot; query. :-)

Main difference is, when I detect a problem I do not exit, but just do

self.dbpool.close()
self.dbpool.start()

If you look at the source of adbapi, you see that you can do that even
if the program cannot yet reconnect to PostgreSQL. The connections are
not really established until something tries to use them.

-- 
Nicola Larosa - <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nico at tekNico.net</A>

The reward for your efforts will be an equivocal one: you will feel as
suffocated programming in C++ as an experienced C++ programmer would
feel programming in Basic. -- Paul Graham, ANSI Common Lisp, 1995



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009566.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
	<LI>Next message: <A HREF="009569.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9564">[ date ]</a>
              <a href="thread.html#9564">[ thread ]</a>
              <a href="subject.html#9564">[ subject ]</a>
              <a href="author.html#9564">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
