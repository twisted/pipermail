<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted.enterprise.adbapi%20and%20connection%20pool%0A%09problem&In-Reply-To=39CD5E1A-7F67-11D9-9DB9-000A95A50FB2%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009572.html">
   <LINK REL="Next"  HREF="009565.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem</H1>
    <B>Federico Di Gregorio</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted.enterprise.adbapi%20and%20connection%20pool%0A%09problem&In-Reply-To=39CD5E1A-7F67-11D9-9DB9-000A95A50FB2%40fuhm.net"
       TITLE="[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem">fog at initd.org
       </A><BR>
    <I>Tue Feb 15 10:54:54 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009572.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
        <LI>Next message: <A HREF="009565.html">[Twisted-Python] Parsing POST data inside render_POST
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9574">[ date ]</a>
              <a href="thread.html#9574">[ thread ]</a>
              <a href="subject.html#9574">[ subject ]</a>
              <a href="author.html#9574">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Il giorno mar, 15-02-2005 alle 10:35 -0500, James Y Knight ha scritto:
&gt;<i> On Feb 15, 2005, at 4:22 AM, Federico Di Gregorio wrote:
</I>&gt;<i> &gt; If the database support transactions and an exception is raised the
</I>&gt;<i> &gt; DatabasePool does a .rollback() (if I remember correctly). In this case
</I>&gt;<i> &gt; you're sure the query has not been executed (it was rolled back
</I>&gt;<i> &gt; explicitly.)
</I>&gt;<i> 
</I>&gt;<i> If the database server returned an exception and you can actually 
</I>&gt;<i> execute a rollback, the connection didn't die. :) That is not the 
</I>&gt;<i> situation we're talking about. It's when you send a command over the 
</I>&gt;<i> network, and the remote host maybe gets it, or maybe not, and then you 
</I>&gt;<i> unplug your net connection before you get a response. You don't know if 
</I>&gt;<i> the server got the command or not. However, your point stands: If 
</I>&gt;<i> you're in a transaction and failed anything but the commit, then you 
</I>&gt;<i> know the transaction was unexecuted. If you fail the commit command, 
</I>&gt;<i> it's harder. With certain errors you know came from the database server 
</I>&gt;<i> rather than the network, you can probably also know it's unexecuted, 
</I>&gt;<i> but in some cases it's unclear.
</I>
Agreed. If you fail (probably because of network problems) during the
commit the situation can be so bad that shutting down the application
until you can check the database is a very good idea. :/

&gt;<i> In contrast to my previous message, I do believe cp_reconnect will 
</I>&gt;<i> notice a failed connection before attempting a query on it, since it 
</I>&gt;<i> checks the result of db.cursor() when starting the transaction, and if
</I>
It depends on the database adapter. For example, in psycopg, you can
call conn.cursor() on an &quot;unplugged&quot; connection without getting any
errors. It is the curs.execute() that will fail. Sending data to the
backend at every .cursor() just to check the connection status is an
overhead that some people don't want.

&gt;<i> that fails, reconnects. This is likely sufficient for most website-like 
</I>&gt;<i> application, where a failed query just results in the user pressing 
</I>&gt;<i> reload anyways.
</I>&gt;<i> 
</I>&gt;<i> For a more serious application, it should handle any errors sensibly, 
</I>&gt;<i> including those that happen at commit time, so it needs to be able to 
</I>&gt;<i> handle errors itself, in any case.
</I>
I agree but I don't see any sensible way to manage an error at .commit()
time.

federico

-- 
Federico Di Gregorio                         <A HREF="http://people.initd.org/fog">http://people.initd.org/fog</A>
Debian GNU/Linux Developer                                <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fog at debian.org</A>
INIT.D Developer                                           <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fog at initd.org</A>
  I terminali seriali sono in via di estinzione (infatti quello che
   c'era si &#232; estinto)                                 -- Simone Caldana
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa parte del messaggio =?ISO-8859-1?Q?=E8?= firmata
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20050215/2747ed68/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20050215/2747ed68/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009572.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
	<LI>Next message: <A HREF="009565.html">[Twisted-Python] Parsing POST data inside render_POST
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9574">[ date ]</a>
              <a href="thread.html#9574">[ thread ]</a>
              <a href="subject.html#9574">[ subject ]</a>
              <a href="author.html#9574">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
