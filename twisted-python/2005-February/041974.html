<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] echo server using deferToThread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20echo%20server%20using%20deferToThread&In-Reply-To=%3C20050207041619.21318.1061589095.divmod.quotient.6632%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041975.html">
   <LINK REL="Next"  HREF="041976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] echo server using deferToThread</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20echo%20server%20using%20deferToThread&In-Reply-To=%3C20050207041619.21318.1061589095.divmod.quotient.6632%40ohm%3E"
       TITLE="[Twisted-Python] echo server using deferToThread">exarkun at divmod.com
       </A><BR>
    <I>Sun Feb  6 21:16:19 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041975.html">[Twisted-Python] echo server using deferToThread
</A></li>
        <LI>Next message (by thread): <A HREF="041976.html">[Twisted-Python] echo server using deferToThread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41974">[ date ]</a>
              <a href="thread.html#41974">[ thread ]</a>
              <a href="subject.html#41974">[ subject ]</a>
              <a href="author.html#41974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 6 Feb 2005 20:06:21 -0800, snacktime &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">snacktime at gmail.com</A>&gt; wrote:
&gt;<i>On Mon, 7 Feb 2005 14:29:33 +1100, Andrew Bennetts
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrew-twisted at puzzling.org</A>&gt; wrote:
</I>&gt;<i> &gt; On Sun, Feb 06, 2005 at 07:15:34PM -0800, snacktime wrote:
</I>&gt;<i> &gt; &gt; I can't figure out why LineReceived never gets called in the client.  Any ideas?
</I>&gt;<i> &gt; [...]
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; class EchoClient(LineReceiver):
</I>&gt;<i> &gt; [...]
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; class Echo(Protocol):
</I>&gt;<i> &gt; &gt;     def dataReceived(self, data):
</I>&gt;<i> &gt; &gt;       reactor.callLater(0, self.RunThread, data)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     def PrintData(self,data):
</I>&gt;<i> &gt; &gt;       self.transport.write('GoodBye')
</I>&gt;<i> &gt; &gt;       print &quot;Sent GoodBye&quot;
</I>&gt;<i> &gt; &gt;       self.transport.loseConnection()
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; You're not writing a whole line, so a line is never received :)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Use self.sendLine('GoodBye') instead.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -Andrew
</I>&gt;<i> 
</I>&gt;<i> replacing self.transport.write with self.sendLine just makes the code
</I>&gt;<i> block when it hits self.sendLine.
</I>
  This seems unlikely, since sendLine never blocks.  sendLine is nothing 
more than a call to transport.write() with the appropriate additional 
bytes tacked on automatically (&quot;\r\n&quot; by default).

  Echo subclasses Protocol, though.  sendLine is a method of LineReceiver.  
When you call sendLine on your Protocol instance, an AttributeError is 
raised.  The exception is translated into a Failure (so as to be handleable 
asynchronously).  But no handler is ever set up for it, so it goes 
unreported, unless you get lucky and the Failure gets garbage collected 
in a timely fashion.

  So, if you get stuck with a Deferred that appears to just hang forever, 
make sure you are setting up proper error handling.  In some cases, for 
debugging, this may just mean adding twisted.python.log.err as the errback 
(`from twisted.python import log; d.addErrback(log.err)').

  Jp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041975.html">[Twisted-Python] echo server using deferToThread
</A></li>
	<LI>Next message (by thread): <A HREF="041976.html">[Twisted-Python] echo server using deferToThread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41974">[ date ]</a>
              <a href="thread.html#41974">[ thread ]</a>
              <a href="subject.html#41974">[ subject ]</a>
              <a href="author.html#41974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
