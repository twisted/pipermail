<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted threading server has to be stopped with	KILL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20threading%20server%20has%20to%20be%20stopped%20with%0A%09KILL&In-Reply-To=%3C1f060c4c05020822404e84b552%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042004.html">
   <LINK REL="Next"  HREF="042006.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted threading server has to be stopped with	KILL</H1>
    <B>snacktime</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20threading%20server%20has%20to%20be%20stopped%20with%0A%09KILL&In-Reply-To=%3C1f060c4c05020822404e84b552%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] twisted threading server has to be stopped with	KILL">snacktime at gmail.com
       </A><BR>
    <I>Tue Feb  8 23:40:11 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042004.html">[Twisted-Python] twisted threading server has to be stopped with	KILL
</A></li>
        <LI>Next message (by thread): <A HREF="042006.html">[Twisted-Python] twisted threading server has to be stopped with	KILL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42005">[ date ]</a>
              <a href="thread.html#42005">[ thread ]</a>
              <a href="subject.html#42005">[ subject ]</a>
              <a href="author.html#42005">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>  Complete examples are preferable.  If the problem cannot be reproduced
</I>&gt;<i> (that is to say, the source copied into a file, the file run with Python,
</I>&gt;<i> and the undesirable behavior observed as a result), it is much more time
</I>&gt;<i> consuming to attempt to provide a useful response.
</I>&gt;<i> 
</I>Ok here is a test server/client.  

Server:
--------------------------
from twisted.application import service,internet
from twisted.internet.protocol import Protocol, Factory
from twisted.internet import defer, reactor
from twisted.python import threadable
from twisted.internet import threads
from twisted.python import log
threadable.init(1)
import sys
from OpenSSL import SSL

class ServerContextFactory:

    def getContext(self):
        &quot;&quot;&quot;Create an SSL context.

        This is a sample implementation that loads a certificate from a file
        called 'server.pem'.&quot;&quot;&quot;
        ctx = SSL.Context(SSL.SSLv23_METHOD)
        ctx.use_certificate_file('server.pem')
        ctx.use_privatekey_file('server.pem')
        return ctx

class ProcessTransaction:

  def Do(self,data):
      return 'Done'


### Protocol Implementation

class OT(Protocol):
    def dataReceived(self, data):
      &quot;&quot;&quot;As soon as any data is received, process it in a thread.&quot;&quot;&quot;
      reactor.callLater(0, self.Start,data)

    def PrintData(self,data):
      self.transport.write(&quot;%s\r\n&quot; % data)
      self.transport.loseConnection()

    def Start(self,data):
      c = ProcessTransaction()
      d = threads.deferToThread(c.Do,data)
      d.addCallback(self.PrintData)
      d.addErrback(log.err)


application = service.Application(&quot;otransact&quot;)
OTService = service.IServiceCollection(application)
OTfactory = Factory()
OTfactory.protocol = OT
OTServer = internet.SSLServer(8000, OTfactory,ServerContextFactory())
OTServer.setServiceParent(OTService)

Client:
-----------------------
from OpenSSL import SSL
import sys
import time

from twisted.internet.protocol import ClientFactory
from twisted.protocols.basic import LineReceiver
from twisted.internet import ssl, reactor

class EchoClient(LineReceiver):
    end=&quot;GoodBye&quot;
    def connectionMade(self):
        self.sendLine(&quot;Testing&quot;)

    def connectionLost(self, reason):
        print 'connection lost (protocol)'
        reactor.stop()

    def lineReceived(self, line):
        print &quot;receive:&quot;, line
        self.transport.loseConnection()

class EchoClientFactory(ClientFactory):
    protocol = EchoClient

    def clientConnectionFailed(self, connector, reason):
        print 'connection failed:', reason.getErrorMessage()
        reactor.stop()

    def clientConnectionLost(self, connector, reason):
        print 'connection lost:', reason.getErrorMessage()
        reactor.stop()


def main():
    factory = EchoClientFactory()
    reactor.connectSSL('localhost', 8000, factory, ssl.ClientContextFactory())
    reactor.run()


if __name__ == '__main__':
    main()


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042004.html">[Twisted-Python] twisted threading server has to be stopped with	KILL
</A></li>
	<LI>Next message (by thread): <A HREF="042006.html">[Twisted-Python] twisted threading server has to be stopped with	KILL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42005">[ date ]</a>
              <a href="thread.html#42005">[ thread ]</a>
              <a href="subject.html#42005">[ subject ]</a>
              <a href="author.html#42005">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
