<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] HTTP client should be more tolerant?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20HTTP%20client%20should%20be%20more%20tolerant%3F&In-Reply-To=%3C7t7jlp3bbg.fsf%40fingon.iki.fi%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041941.html">
   <LINK REL="Next"  HREF="041933.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] HTTP client should be more tolerant?</H1>
    <B>Markus Stenberg</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20HTTP%20client%20should%20be%20more%20tolerant%3F&In-Reply-To=%3C7t7jlp3bbg.fsf%40fingon.iki.fi%3E"
       TITLE="[Twisted-Python] HTTP client should be more tolerant?">fingon at iki.fi
       </A><BR>
    <I>Thu Feb  3 08:36:19 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041941.html">[Twisted-Python] Re: How do I get at the Application object (usin	g	twistd)
</A></li>
        <LI>Next message (by thread): <A HREF="041933.html">[Twisted-Python] HTTP client should be more tolerant?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41932">[ date ]</a>
              <a href="thread.html#41932">[ thread ]</a>
              <a href="subject.html#41932">[ subject ]</a>
              <a href="author.html#41932">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As initial disclaimer, PLEASE change your FAQ about bug reporting - nobody
really wants to correctly report bug by first joining on some random
mailing list (OR allow moderated non-member postings, but we all know how
much spam THAT will drag in).

Anyway..

According to the HTTP RFCs, CRLF is the valid line termination
sequence. However, the appendix (section 19.3 in old HTTP/1.1, too lazy to
dig up more recent one) states as follows:

   The line terminator for message-header fields is the sequence CRLF.
   However, we recommend that applications, when parsing such headers,
   recognize a single LF as a line terminator and ignore the leading CR.

Some UNIXish servers, while breaking RFC, seem to work on browsers. I'd say
following this advice would be good, and therefore tuned my twisted http
client to be 'tolerant' (all major and minor browsers that I am aware of
are).

Changes required? web/http.py:

@@ -314,6 +314,7 @@
     length = None
     firstLine = 1
     __buffer = ''
+    delimiter = '\n'
 
     def sendCommand(self, command, path):
         self.transport.write('%s %s HTTP/1.0\r\n' % (command, path))
@@ -325,6 +326,7 @@
         self.transport.write('\r\n')
 
     def lineReceived(self, line):
+        if line and line[-1] == '\r': line = line[:-1]
         if self.firstLine:
             self.firstLine = 0
             l = line.split(None, 2)

I'm also considering implementing HTTP/1.1 client. Has anyone done anything
about it? Thoughts? 'Give up, bad idea'?

I also rewrote the proxy for my local use a bit, mostly to make it more
component-oriented AND correct (currently HTTP/1.1 clients do not get
persistent service, which is inefficient). Unfortunately changes are mixed
among some other code, but has there been any work on proxy recently? 
I might have interest in submitting patch or two to make it more correct in
some things.

-Markus

-- 
A: &quot;You can do wonderful things in software if you get rid of the
    assumption that Windows == Shit.&quot;
B: &quot;But likewise you could do wonderful things in hardware if you
    got rid of the assumption that Gravity == 9.81 metres per second
    squared.&quot;
C: &quot;But that's an invalid comparison.  You can get rid of the gravity
    problem quite easily by a change of location -- but do you
    think Windows would get any better if you shot it to the moon?&quot;
-- rec.humor.funny post by <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ermel at gmx.de</A> (Erik Meltzer)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041941.html">[Twisted-Python] Re: How do I get at the Application object (usin	g	twistd)
</A></li>
	<LI>Next message (by thread): <A HREF="041933.html">[Twisted-Python] HTTP client should be more tolerant?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41932">[ date ]</a>
              <a href="thread.html#41932">[ thread ]</a>
              <a href="subject.html#41932">[ subject ]</a>
              <a href="author.html#41932">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
