<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.enterprise.adbapi%20and%20connection%20pool%0A%09problem&In-Reply-To=%3C1108459364.3270.4.camel%40lana.initd.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042077.html">
   <LINK REL="Next"  HREF="042080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem</H1>
    <B>Federico Di Gregorio</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.enterprise.adbapi%20and%20connection%20pool%0A%09problem&In-Reply-To=%3C1108459364.3270.4.camel%40lana.initd.org%3E"
       TITLE="[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem">fog at initd.org
       </A><BR>
    <I>Tue Feb 15 02:22:44 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042077.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
        <LI>Next message (by thread): <A HREF="042080.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42079">[ date ]</a>
              <a href="thread.html#42079">[ thread ]</a>
              <a href="subject.html#42079">[ subject ]</a>
              <a href="author.html#42079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Il giorno lun, 14-02-2005 alle 21:03 -0500, James Y Knight ha scritto:
&gt;<i> On Feb 14, 2005, at 4:05 PM, snacktime wrote:
</I>&gt;<i> &gt; Attempting reconnects just isn't part of adbapi as far as I can tell.
</I>&gt;<i> 
</I>&gt;<i> It is part of adbapi in Twisted 2.0 (see cp_reconnect arg to the 
</I>&gt;<i> DatabasePool constructor). However, it will only reconnect after 
</I>&gt;<i> failing a query. It will never retry a query (that could be unsafe to 
</I>&gt;<i> do), but will re-establish the database connection after that query 
</I>&gt;<i> fails. Thus, subsequent queries will succeed.
</I>&gt;<i> 
</I>&gt;<i> If you know some way to tell for sure that it there is no possibility 
</I>&gt;<i> that the query has been executed, you could submit a patch for adbapi 
</I>&gt;<i> that it will retry the query in those circumstances.
</I>
If the database support transactions and an exception is raised the
DatabasePool does a .rollback() (if I remember correctly). In this case
you're sure the query has not been executed (it was rolled back
explicitly.)

The problem is with backends that do not support transactions, but if
you're crazy enough to use one of them having a query repeated is a
lesser evil. ;)

IMHO, it is safe to rollback, reconnect and send the query again. Maybe
a cp_repeat_query=True|False parameter?

-- 
Federico Di Gregorio                         <A HREF="http://people.initd.org/fog">http://people.initd.org/fog</A>
Debian GNU/Linux Developer                                <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fog at debian.org</A>
INIT.D Developer                                           <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fog at initd.org</A>
           Nobody will ever need more than 640k RAM! -- Bill Gates, 1981
           Windows 95 needs at least 8 MB RAM.       -- Bill Gates, 1996
           Nobody will ever need Windows 95.       -- logical conclusion
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Questa parte del messaggio Ã¨ firmata
URL: &lt;/pipermail/twisted-python/attachments/20050215/e932ccb3/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042077.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
	<LI>Next message (by thread): <A HREF="042080.html">[Twisted-Python] twisted.enterprise.adbapi and connection pool	problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42079">[ date ]</a>
              <a href="thread.html#42079">[ thread ]</a>
              <a href="subject.html#42079">[ subject ]</a>
              <a href="author.html#42079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
