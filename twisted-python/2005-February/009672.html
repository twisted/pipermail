<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20linux%20kernel%202.6.11-rc%20broke%20twisted%20process%0A%09pipes&In-Reply-To=893f671b35fdcdcd1a00429d521394d2%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009671.html">
   <LINK REL="Next"  HREF="009667.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20linux%20kernel%202.6.11-rc%20broke%20twisted%20process%0A%09pipes&In-Reply-To=893f671b35fdcdcd1a00429d521394d2%40fuhm.net"
       TITLE="[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes">andrea at cpushare.com
       </A><BR>
    <I>Mon Feb 28 23:15:36 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009671.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
        <LI>Next message: <A HREF="009667.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9672">[ date ]</a>
              <a href="thread.html#9672">[ thread ]</a>
              <a href="subject.html#9672">[ subject ]</a>
              <a href="author.html#9672">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 28, 2005 at 10:40:00PM -0500, James Y Knight wrote:
&gt;<i> Right. Twisted treats all of POLLERR/HUP/NVAL the same, anyways.
</I>
Ok.

&gt;<i> Nope -- Notice that rpipe and wpipe are backwards for the read and 
</I>&gt;<i> write fds. &quot;rpipe&quot; on the write fd won't ever have any data in it. 
</I>&gt;<i> (Except of course that pipes in BSD are bidirectional!). In BSD, 
</I>
I didn't know it was bidirectional, I thought the peer pointer pointed
to the other side of the pipe like in linux, and not the other direction
of the same side.

&gt;<i> Yes, it will get called, because linux returns (returned?) 
</I>&gt;<i> POLLERR|POLLIN when the other side is closed. pollreactor doesn't 
</I>
It return_ed_ POLLERR|POLLIN, correct.

Now it returns only POLLERR for a wronly fd and only POLLHUP for a
rdonly fd which seems even more correct since it will prevent the
suprious doRead call with pollreactor.

&gt;<i> assume the connection was lost immediately when POLLERR/etc is set, if 
</I>&gt;<i> POLLIN is also set, because POLLIN|POLLHUP means there is more data 
</I>&gt;<i> available to be read from the kernel buffer that was sent before the 
</I>&gt;<i> connection closed. And, since normal transport implementations of 
</I>
Yep, except that's a wronly fd so calling doRead can only detect a
disconnect that is already detected thanks to the pollerr.

&gt;<i> doRead actually do try to read, if it was lying about POLLIN, that's 
</I>&gt;<i> okay: the read syscall will fail, and CONNECTION_LOST will be returned 
</I>&gt;<i> from doRead.
</I>
Ok. So I'll take the exception path. The exception should be ValueError:
filedescriptor out of range in select(). Anyway with the new patched
kernel I'm running and with latest 2.6.11 this shouldn't happen anymore
because POLLIN isn't set ;).

Thanks a lot for all the help, this clarified many things.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009671.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
	<LI>Next message: <A HREF="009667.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9672">[ date ]</a>
              <a href="thread.html#9672">[ thread ]</a>
              <a href="subject.html#9672">[ subject ]</a>
              <a href="author.html#9672">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
