<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20how%20to%20stop%20dataReceived%20while%20waiting%20a%0A%09deferred%20to%20fire%3F&In-Reply-To=%3C20050221051353.GN1374%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042140.html">
   <LINK REL="Next"  HREF="042133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20how%20to%20stop%20dataReceived%20while%20waiting%20a%0A%09deferred%20to%20fire%3F&In-Reply-To=%3C20050221051353.GN1374%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?">andrew-twisted at puzzling.org
       </A><BR>
    <I>Sun Feb 20 22:13:53 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042140.html">[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
</A></li>
        <LI>Next message (by thread): <A HREF="042133.html">[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42129">[ date ]</a>
              <a href="thread.html#42129">[ thread ]</a>
              <a href="subject.html#42129">[ subject ]</a>
              <a href="author.html#42129">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 21, 2005 at 05:50:16AM +0100, Andrea Arcangeli wrote:
[...]
&gt;<i> 
</I>&gt;<i> The example in the docs is like this:
</I>&gt;<i> 
</I>&gt;<i> -------------------------
</I>&gt;<i> class FingerProtocol(basic.LineReceiver):
</I>&gt;<i>     def lineReceived(self, user):
</I>&gt;<i>         self.factory.getUser(user
</I>&gt;<i>         ).addErrback(lambda _: &quot;Internal error in server&quot;
</I>&gt;<i>         ).addCallback(lambda m:
</I>&gt;<i>             (self.transport.write(m+&quot;\r\n&quot;),
</I>&gt;<i>              self.transport.loseConnection()))
</I>&gt;<i> [..]
</I>&gt;<i> we would have to fetch result from a remote Oracle? Or from the web?
</I>&gt;<i> -------------------------
</I>&gt;<i> 
</I>&gt;<i> But as far as I can tell the above also is broken and it won't wait for
</I>&gt;<i> the deferred to fire, so two of those queries could be invoked if the
</I>&gt;<i> client side is malicious and it sends two lines in one packet and that
</I>&gt;<i> could screwup the server. It'll work only as long as the clients aren't
</I>&gt;<i> malicious.
</I>
I don't think it matters if the two lines arrive in the same packet or not;
if the lines arrive before the getUser deferred fires, it will fire multiple
queries, regardless of the exact packets involved.  In this case maybe a
flag should be in the protocol after the first lineReceived event... any
future rawDataReceived events (after call self.setRawMode()) could then be
ignored.  Or if you're more paranoid, it could drop the connection and try
cancel the in-progress getUser operation.

&gt;<i> I really can't see how the reactor could ever wait for the deferred
</I>&gt;<i> returned by GetUser and how could lineReceived being throttled in the
</I>&gt;<i> above example. So I think the above example needs fixing too.
</I>&gt;<i> 
</I>&gt;<i> I need one of those below two solutions:
</I>&gt;<i> 
</I>&gt;<i> 1) something like protocol.transport.removeReader() to call before
</I>[...]

I think the transport's pauseProducing call will do what you want, here.
And resumeProducing when you're ready again.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042140.html">[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
</A></li>
	<LI>Next message (by thread): <A HREF="042133.html">[Twisted-Python] how to stop dataReceived while waiting a	deferred to fire?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42129">[ date ]</a>
              <a href="thread.html#42129">[ thread ]</a>
              <a href="subject.html#42129">[ subject ]</a>
              <a href="author.html#42129">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
