<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] async code structure question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20async%20code%20structure%20question&In-Reply-To=%3C1f060c4c050210112631b8e0c6%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042031.html">
   <LINK REL="Next"  HREF="042030.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] async code structure question</H1>
    <B>snacktime</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20async%20code%20structure%20question&In-Reply-To=%3C1f060c4c050210112631b8e0c6%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] async code structure question">snacktime at gmail.com
       </A><BR>
    <I>Thu Feb 10 12:26:11 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042031.html">[Twisted-Python] async code structure question
</A></li>
        <LI>Next message (by thread): <A HREF="042030.html">[Twisted-Python] async code structure question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42028">[ date ]</a>
              <a href="thread.html#42028">[ thread ]</a>
              <a href="subject.html#42028">[ subject ]</a>
              <a href="author.html#42028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> 
</I>&gt;<i> Do() should return a Deferred that has result when processing is done,
</I>&gt;<i> and then you can Do().addCallback(lambda: self.transport.write(&quot;hello&quot;))
</I>&gt;<i> or something.
</I>&gt;<i> 
</I>&gt;<i> e.g.
</I>&gt;<i> 
</I>&gt;<i> def Do():
</I>&gt;<i>    d = deferToThread(foo)
</I>&gt;<i>    d.addCallback(processResult)
</I>&gt;<i>    return d
</I>&gt;<i> 
</I>&gt;<i> or
</I>&gt;<i> 
</I>&gt;<i> def Do():
</I>&gt;<i>    # processing in this case is waiting for one second
</I>&gt;<i>    d = Deferred()
</I>&gt;<i>    reactor.callLater(d.callback, 1)
</I>&gt;<i>    return d
</I>
Thanks Itamar.  I think I understand these examples to a point, but
what I don't understand is how to implement it when you are calling
methods several levels deep into other classes.  For example the
method authorize() in class Authorization below is where the final
data is that I need to print back to the client via Printdata in the
protocol handler.  In authorize there are several chained deferreds
also, and the last one needs to somehow trigger the very first
callback that was added in dataReceived().

Specifically what I am having the most difficulty with is this.  In
Do() is where the Deferred is created that needs to have it's
callbacks fired.  How can I fire off that callback from authorize()
and have authorize() pass it the final data?

class OT(Protocol):
    def dataReceived(self, data):
    def Do():
      d = defer.Deferred()
      c = ProcessTransaction()
      reactor.callLater(0, c.Do,data)
      d.addCallback(self.PrintData)
      d.addErrback(log.err)

    def PrintData(self,data):
        self.transport.write(&quot;%s\r\n&quot; % data)
        self.transport.loseConnection()


class ProcessTransaction:

  def Do(self,data):
    ''' Do some sanity checks on data and see what network to process
the transaction through'''
    if network == 'vital':
      d = Vital()
       response = d.Submit()
    elif...
    else...

class Vital:
  ''' Run method based on the transaction type '''

   if transaction_type == 'AUTHORIZE':
      r = Authorization(req)
      response = r.Submit()
    elif...
    else...

class Authorization:

  def authorize(self):
    ''' Here we have several chained deferreds to handle some database
operations,
    submit the transaction via a post, and finally format a final
response which needs to be printed to the client.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042031.html">[Twisted-Python] async code structure question
</A></li>
	<LI>Next message (by thread): <A HREF="042030.html">[Twisted-Python] async code structure question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42028">[ date ]</a>
              <a href="thread.html#42028">[ thread ]</a>
              <a href="subject.html#42028">[ subject ]</a>
              <a href="author.html#42028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
