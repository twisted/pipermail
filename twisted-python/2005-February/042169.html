<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] linux kernel 2.6.11-rc broke twisted process pipes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20linux%20kernel%202.6.11-rc%20broke%20twisted%20process%20pipes&In-Reply-To=%3C20050228201448.GN8880%40opteron.random%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042168.html">
   <LINK REL="Next"  HREF="042173.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] linux kernel 2.6.11-rc broke twisted process pipes</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20linux%20kernel%202.6.11-rc%20broke%20twisted%20process%20pipes&In-Reply-To=%3C20050228201448.GN8880%40opteron.random%3E"
       TITLE="[Twisted-Python] linux kernel 2.6.11-rc broke twisted process pipes">andrea at suse.de
       </A><BR>
    <I>Mon Feb 28 13:14:48 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042168.html">[Twisted-Python] Re: linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
        <LI>Next message (by thread): <A HREF="042173.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42169">[ date ]</a>
              <a href="thread.html#42169">[ thread ]</a>
              <a href="subject.html#42169">[ subject ]</a>
              <a href="author.html#42169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

Please read the attached emails.

I would like to understand exactly what broke twisted, so that we're
sure the new 2.6.11 kernel will work reliably with twisted.

This code especially will never trigger with 2.6.11 because we'll never
set POLLIN|POLLOUT at the same time for writeable fd.

    def doRead(self):
        &quot;&quot;&quot;The only way this pipe can become readable is at EOF, because the
        child has closed it.
        &quot;&quot;&quot;
        fd = self.fd
        r, w, x = select.select([fd], [fd], [], 0)
        if r and w:
            return CONNECTION_LOST

Could you answer why anybody should call doRead on a writeable fd?

Where is it written that at EOF a _write_ pipe channel becomes readable?

Is it ok that &quot;r and w&quot; will never trigger at the same time anymore,
right? Was just that a superflous assumptions?

Note that with 2.6.8 and all previous linux kernels, &quot;r and w&quot; could be
== True in normal conditions too if the pipe write buffer was empty (old
kernel was setting pollin always for no good reason).

What I suspect is that the above is a superflous check that was working
by luck with older kernels (becasue we could set in and out at the same
time even without a disconnect event), and that all you care about is to
get the wakeup from the write or disconnect events. And in turn the new
linux 2.6.11-rc should not work by luck anymore.

Comments appreciated.

Thanks.
-------------- next part --------------
An embedded message was scrubbed...
From: Andrea Arcangeli &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrea at suse.de</A>&gt;
Subject: two pipe bugfixes
Date: Mon, 28 Feb 2005 05:25:44 +0100
Size: 5047
URL: &lt;/pipermail/twisted-python/attachments/20050228/fcc62a25/attachment.mht&gt;
-------------- next part --------------
An embedded message was scrubbed...
From: Linus Torvalds &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">torvalds at osdl.org</A>&gt;
Subject: Re: two pipe bugfixes
Date: Mon, 28 Feb 2005 08:25:07 -0800 (PST)
Size: 4241
URL: &lt;/pipermail/twisted-python/attachments/20050228/fcc62a25/attachment-0001.mht&gt;
-------------- next part --------------
An embedded message was scrubbed...
From: Andrea Arcangeli &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrea at suse.de</A>&gt;
Subject: Re: two pipe bugfixes
Date: Mon, 28 Feb 2005 20:04:37 +0100
Size: 2997
URL: &lt;/pipermail/twisted-python/attachments/20050228/fcc62a25/attachment-0002.mht&gt;
-------------- next part --------------
An embedded message was scrubbed...
From: Linus Torvalds &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">torvalds at osdl.org</A>&gt;
Subject: Re: two pipe bugfixes
Date: Mon, 28 Feb 2005 11:22:18 -0800 (PST)
Size: 4526
URL: &lt;/pipermail/twisted-python/attachments/20050228/fcc62a25/attachment-0003.mht&gt;
-------------- next part --------------
An embedded message was scrubbed...
From: Andrea Arcangeli &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrea at suse.de</A>&gt;
Subject: Re: two pipe bugfixes
Date: Mon, 28 Feb 2005 20:55:56 +0100
Size: 3825
URL: &lt;/pipermail/twisted-python/attachments/20050228/fcc62a25/attachment-0004.mht&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042168.html">[Twisted-Python] Re: linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
	<LI>Next message (by thread): <A HREF="042173.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42169">[ date ]</a>
              <a href="thread.html#42169">[ thread ]</a>
              <a href="subject.html#42169">[ subject ]</a>
              <a href="author.html#42169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
