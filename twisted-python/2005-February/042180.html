<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20linux%20kernel%202.6.11-rc%20broke%20twisted%20process%0A%09pipes&In-Reply-To=%3C20050301041536.GE8880%40opteron.random%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="042179.html">
   <LINK REL="Next"  HREF="042175.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20linux%20kernel%202.6.11-rc%20broke%20twisted%20process%0A%09pipes&In-Reply-To=%3C20050301041536.GE8880%40opteron.random%3E"
       TITLE="[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes">andrea at cpushare.com
       </A><BR>
    <I>Mon Feb 28 21:15:36 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="042179.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
        <LI>Next message (by thread): <A HREF="042175.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42180">[ date ]</a>
              <a href="thread.html#42180">[ thread ]</a>
              <a href="subject.html#42180">[ subject ]</a>
              <a href="author.html#42180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 28, 2005 at 10:40:00PM -0500, James Y Knight wrote:
&gt;<i> Right. Twisted treats all of POLLERR/HUP/NVAL the same, anyways.
</I>
Ok.

&gt;<i> Nope -- Notice that rpipe and wpipe are backwards for the read and 
</I>&gt;<i> write fds. &quot;rpipe&quot; on the write fd won't ever have any data in it. 
</I>&gt;<i> (Except of course that pipes in BSD are bidirectional!). In BSD, 
</I>
I didn't know it was bidirectional, I thought the peer pointer pointed
to the other side of the pipe like in linux, and not the other direction
of the same side.

&gt;<i> Yes, it will get called, because linux returns (returned?) 
</I>&gt;<i> POLLERR|POLLIN when the other side is closed. pollreactor doesn't 
</I>
It return_ed_ POLLERR|POLLIN, correct.

Now it returns only POLLERR for a wronly fd and only POLLHUP for a
rdonly fd which seems even more correct since it will prevent the
suprious doRead call with pollreactor.

&gt;<i> assume the connection was lost immediately when POLLERR/etc is set, if 
</I>&gt;<i> POLLIN is also set, because POLLIN|POLLHUP means there is more data 
</I>&gt;<i> available to be read from the kernel buffer that was sent before the 
</I>&gt;<i> connection closed. And, since normal transport implementations of 
</I>
Yep, except that's a wronly fd so calling doRead can only detect a
disconnect that is already detected thanks to the pollerr.

&gt;<i> doRead actually do try to read, if it was lying about POLLIN, that's 
</I>&gt;<i> okay: the read syscall will fail, and CONNECTION_LOST will be returned 
</I>&gt;<i> from doRead.
</I>
Ok. So I'll take the exception path. The exception should be ValueError:
filedescriptor out of range in select(). Anyway with the new patched
kernel I'm running and with latest 2.6.11 this shouldn't happen anymore
because POLLIN isn't set ;).

Thanks a lot for all the help, this clarified many things.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="042179.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
	<LI>Next message (by thread): <A HREF="042175.html">[Twisted-Python] linux kernel 2.6.11-rc broke twisted process	pipes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42180">[ date ]</a>
              <a href="thread.html#42180">[ thread ]</a>
              <a href="subject.html#42180">[ subject ]</a>
              <a href="author.html#42180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
