<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted threading server has to be stopped with	KILL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20threading%20server%20has%20to%20be%20stopped%20with%0A%09KILL&In-Reply-To=%3C1f060c4c05020812151c933bfe%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041997.html">
   <LINK REL="Next"  HREF="042004.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted threading server has to be stopped with	KILL</H1>
    <B>snacktime</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted%20threading%20server%20has%20to%20be%20stopped%20with%0A%09KILL&In-Reply-To=%3C1f060c4c05020812151c933bfe%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] twisted threading server has to be stopped with	KILL">snacktime at gmail.com
       </A><BR>
    <I>Tue Feb  8 13:15:35 MST 2005</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041997.html">[Twisted-Python] twisted threading server has to be stopped	with KILL
</A></li>
        <LI>Next message (by thread): <A HREF="042004.html">[Twisted-Python] twisted threading server has to be stopped with	KILL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41998">[ date ]</a>
              <a href="thread.html#41998">[ thread ]</a>
              <a href="subject.html#41998">[ subject ]</a>
              <a href="author.html#41998">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 08 Feb 2005 15:06:18 -0500, Itamar Shtull-Trauring &gt; &gt; The
only place I call threads is through deferToThread, and the server
&gt;<i> &gt; still hangs even after all the threads called with deferToThread have
</I>&gt;<i> &gt; run and their callbacks processed.  What other threads could there be
</I>&gt;<i> &gt; that are blocking?
</I>&gt;<i> 
</I>&gt;<i> In that case Twisted should exit correctly.
</I>
Here is the code.  ProcessTransaction is the class (not shown here)
that contains the blocking method Do().  After playing with it some
more I found something interesting.  Say I send a number of requests
with the client, then hit control-C on the server.  The server won't
shutdown, but on the very next connection from the client the server
drops the connection  immediately before the ssl handshake is
completed and shuts down.  It seems like some sort of event loop where
the INT signal isn't getting processed until the next event happens,
which in this case would be the connection.

class OT(Protocol):
    def dataReceived(self, data):
      &quot;&quot;&quot;As soon as any data is received, process it in a thread.&quot;&quot;&quot;
      reactor.callLater(0, self.Start,data)

    def PrintData(self,data):
      self.transport.write(&quot;%s\r\n&quot; % data)
      self.transport.loseConnection()

    def Start(self,data):
      c = ProcessTransaction()
      # Blocking function called here in thread
      d = threads.deferToThread(c.Do,data)
      d.addCallback(self.PrintData)
      d.addErrback(log.err)


application = service.Application(&quot;otransact&quot;)
OTService = service.IServiceCollection(application)
OTfactory = Factory()
OTfactory.protocol = OT
OTServer = internet.SSLServer(8000, OTfactory,ServerContextFactory())
OTServer.setServiceParent(OTService)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041997.html">[Twisted-Python] twisted threading server has to be stopped	with KILL
</A></li>
	<LI>Next message (by thread): <A HREF="042004.html">[Twisted-Python] twisted threading server has to be stopped with	KILL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41998">[ date ]</a>
              <a href="thread.html#41998">[ thread ]</a>
              <a href="subject.html#41998">[ subject ]</a>
              <a href="author.html#41998">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
