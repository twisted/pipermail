<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted scalability with hundreds of outbound	(client) connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20scalability%20with%20hundreds%20of%20outbound%0A%09%28client%29%20connections&In-Reply-To=%3C41571A05.7050508%40imperial.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041218.html">
   <LINK REL="Next"  HREF="041220.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted scalability with hundreds of outbound	(client) connections</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20scalability%20with%20hundreds%20of%20outbound%0A%09%28client%29%20connections&In-Reply-To=%3C41571A05.7050508%40imperial.ac.uk%3E"
       TITLE="[Twisted-Python] Twisted scalability with hundreds of outbound	(client) connections">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Sun Sep 26 13:35:33 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041218.html">[Twisted-Python] Twisted scalability with hundreds of outbound	(client) connections
</A></li>
        <LI>Next message (by thread): <A HREF="041220.html">[Twisted-Python] Twisted scalability with hundreds of outbound	(client) connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41219">[ date ]</a>
              <a href="thread.html#41219">[ thread ]</a>
              <a href="subject.html#41219">[ subject ]</a>
              <a href="author.html#41219">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Itamar Shtull-Trauring wrote:

&gt;<i> Rather than doing queuing in the transport, do it in your
</I>&gt;<i> DatagramProtocol code - instead of doing transport.write add stuff to a
</I>&gt;<i> queue that schedules writes fairly for different machines.
</I>&gt;<i> 
</I>&gt;<i> 
</I>
If I do this, I'll need:

def xmit(self):
     while True:
         txqueue = self.txcurrent
         self.txcurrent = txqueue.next
         if txqueue:
             self.write(txqueue.pop(0))
             break
     reactor.callLater(0, self.xmit)
def write(self, data, address):
     self.getqueue(address).append(data)

def rcv(self):
     while True:
         rxqueue = self.rxcurrent
         self.rxcurrent = rxqueue.next
         if rxqueue:
             pdu = rxqueue.pop(0)
             pdu.callback()
             break

def datagramReceived(self, data, addr):
     pdu, queue = self.parse(data, addr)
     queue.append(pdu)
     reactor.callLater(0, self.rcv)

I'm concerned about all those reactor.callLater - since one of the main 
problems is the UDP socket queue overflowing, every time I xmit I have 
to get *out* of the protocol code ASAP and back into the select() loop, 
however one of the problems with the reactors (problems for me at any 
rate) is that they do pending calls and thread stuff before IO, which 
IMHO is not quite the right way round.

I'm also slightly concerned about the number of function calls involved 
in jumping in and out of the reactor that many times a second (several 
thousand, if I can get it to go as fast as my previous code) given how 
expensive they are under Python. It would certainly be quicker to 
implement this inside the reactor.mainLoop.

Anyway, I'll give it a go, but I thought I saw stuff recently about 
scalability of callLater; and certainly I've had problems with a lot of 
callLaters (I used to use them for the timeouts before going for a 
simpler expiry scan) - maybe callLater will go faster in Python 2.4 with 
the C bisect.insort?

Thanks for the tips


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041218.html">[Twisted-Python] Twisted scalability with hundreds of outbound	(client) connections
</A></li>
	<LI>Next message (by thread): <A HREF="041220.html">[Twisted-Python] Twisted scalability with hundreds of outbound	(client) connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41219">[ date ]</a>
              <a href="thread.html#41219">[ thread ]</a>
              <a href="subject.html#41219">[ subject ]</a>
              <a href="author.html#41219">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
