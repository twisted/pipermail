<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Communicating between listeners
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Communicating%20between%20listeners&In-Reply-To=%3C20040929172830.29723.26053217.divmod.quotient.7911%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041239.html">
   <LINK REL="Next"  HREF="041241.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Communicating between listeners</H1>
    <B>exarkun at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Communicating%20between%20listeners&In-Reply-To=%3C20040929172830.29723.26053217.divmod.quotient.7911%40ohm%3E"
       TITLE="[Twisted-Python] Communicating between listeners">exarkun at divmod.com
       </A><BR>
    <I>Wed Sep 29 11:28:30 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041239.html">[Twisted-Python] Communicating between listeners
</A></li>
        <LI>Next message (by thread): <A HREF="041241.html">[Twisted-Python] RE: Twisted-Python Digest, Vol 6, Issue 37
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41240">[ date ]</a>
              <a href="thread.html#41240">[ thread ]</a>
              <a href="subject.html#41240">[ subject ]</a>
              <a href="author.html#41240">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 29 Sep 2004 16:22:32 +0100, tom dyson &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tom.dyson at torchbox.com</A>&gt; wrote:
&gt;<i>I'm new to Twisted, and network programming in general. Can anyone 
</I>&gt;<i> provide an example that might help me code the following functionality:
</I>&gt;<i> 
</I>&gt;<i> * Server listens on two ports, one TCP, one UDP
</I>&gt;<i> * Incoming UDP datagrams contain an identifying string
</I>&gt;<i> * A message is broadcast to all connected TCP clients whose username 
</I>&gt;<i> matches the UDP ID.
</I>&gt;<i> 
</I>&gt;<i> In particular, I can't work out how to access details of the current 
</I>&gt;<i> TCP clients - and trigger a new message to some of them - from the UDP 
</I>&gt;<i> listener.
</I>&gt;<i> 
</I>&gt;<i> Many thanks
</I>
  Something like this, perhaps:

    from twisted.internet import protocol, reactor
    from twisted.application import service

    class SomeFactory(protocol.ServerFactory):
        def __init__(self, service):
            self.service = service

        def buildProtocol(self, addr):
            p = protocol.ServerFactory.buildProtocol(self, addr)
            self.service.addClient(p)
            return p

    class SomeDatagramProtocol(protocol.DatagramProtocol):
        def __init__(self, service):
            self.service = service

        def datagramReceived(self, dgram, addr):
            id, msg = extractStuff(dgram)
            self.service.broadcastMessage(id, msg)

    class FoobleService(service.Service):
        def startService(self):
            udpP = SomeDatagramProtocol(self)
            self.udpPort = reactor.listenUDP(..., udpP)
            tcpF = SomeFactory(self)
            self.tcpPort = reactor.listenTCP(..., tcpF)
            self.clients = []

        def stopService(self):
            self.udpPort.stopListening()
            self.tcpPort.stopListening()
            del self.udpPort, self.tcpPort

        # The interesting bit
        def addClient(self, proto):
            self.clients.append(proto)

        def broadcastMessage(self, id, msg):
            for c in self.clients:
                if c.id == id:
                    c.sendMessage(msg)

  In other words, construct a system for tracking clients, based on the callbacks Twisted does provide, and then access those clients as desired.  Cleaning up after clients which drop their connection is left as an exercise for the reader.

  Jp



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041239.html">[Twisted-Python] Communicating between listeners
</A></li>
	<LI>Next message (by thread): <A HREF="041241.html">[Twisted-Python] RE: Twisted-Python Digest, Vol 6, Issue 37
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41240">[ date ]</a>
              <a href="thread.html#41240">[ thread ]</a>
              <a href="subject.html#41240">[ subject ]</a>
              <a href="author.html#41240">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
