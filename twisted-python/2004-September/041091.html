<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Performance issue in reactor.callLater
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Performance%20issue%20in%20reactor.callLater&In-Reply-To=%3C413EBB8D.20204%40gkec.informatik.tu-darmstadt.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041075.html">
   <LINK REL="Next"  HREF="041092.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Performance issue in reactor.callLater</H1>
    <B>Stefan Behnel</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Performance%20issue%20in%20reactor.callLater&In-Reply-To=%3C413EBB8D.20204%40gkec.informatik.tu-darmstadt.de%3E"
       TITLE="[Twisted-Python] Performance issue in reactor.callLater">behnel_ml at gkec.informatik.tu-darmstadt.de
       </A><BR>
    <I>Wed Sep  8 01:58:05 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041075.html">[Twisted-Python] Performance issue in reactor.callLater
</A></li>
        <LI>Next message (by thread): <A HREF="041092.html">[Twisted-Python] Re: Performance issue in reactor.callLater
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41091">[ date ]</a>
              <a href="thread.html#41091">[ thread ]</a>
              <a href="subject.html#41091">[ subject ]</a>
              <a href="author.html#41091">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Bob Ippolito schrieb:
 &gt;&gt;&gt;&gt;    heapq.py is under the PSF license.  PSF is roughly similar to MIT.
 &gt;&gt;&gt;&gt; Is this going to be okay for inclusion in Twisted?
 &gt;&gt;&gt;
 &gt;&gt;&gt; It's part of Python, so I don't see why that would be necessary.
 &gt;&gt;
 &gt;&gt; This is patched / somehow different version.

Right, it needs to keep track of the array position where a DelayedCall is stored in order to remove them as quickly as possible.


 &gt;&gt;&gt; However, I have profiled various heapq-based schemes for callLater in
 &gt;&gt;&gt; the past, and they always end up losing pretty big in the average case,
 &gt;&gt;&gt; and winning only in perverse cases such as hundreds of callLater(0)s per
 &gt;&gt;&gt; tick.  I saw a little discussion of the performance impact, but I am
 &gt;&gt;&gt; still not entirely convinced that it's a good idea.
 &gt;
 &gt; What is the &quot;average&quot; case anyway?  For what application?  Where are the
 &gt; performance tests coming from?

Yes, I think that's a problem. Now, as far as I see it, the implementation makes the case where there are a lot of interleaved callLater/cancel/reset calls /much/ faster. And in a case where there is only a few calls it shouldn't matter anyway.

Just to repeat myself: what really get's slower is runUntilCurrent, but the gain in callLater should compensate that. So, for the case where each callLater leads to a delayed call, the performance gain should be marginal (my patch already avoids shifting the list in linear time) and in all cases where there are more calls to callLater, reset and cancel (added up) than launched delayed calls, I expect the heap implementation to be faster by orders of magnitude.


 &gt; There is at least one scenario where it makes perfect sense to do a lot
 &gt; of callLater(0.0, ...), when you're doing computation but trying not to
 &gt; block.
 &gt;
 &gt; Though, of course, you would do something like callLater(0.00001, ...)
 &gt; in the current Twisted, because callLater(0.0, ...) pretty much blocks.

What you may gain in that case is that it is no longer necessary to shift the complete list when adding a new call, so there already is a shift from linear time to log(N).

And again: if there is only a few calls to callLater then this is not the place to look for performance bottlenecks anyway. But that is up to the application programmer.

Stefan


BTW: I went to <A HREF="http://www.twistedmatrix.com/bugs,">http://www.twistedmatrix.com/bugs,</A> but I can't find the obvious link saying &quot;file a bug report HERE&quot;. So I registered, but I don't seem to get a reply - and I can't login either. Looks like the web server is running with the /old/ version of Twisted... :o)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041075.html">[Twisted-Python] Performance issue in reactor.callLater
</A></li>
	<LI>Next message (by thread): <A HREF="041092.html">[Twisted-Python] Re: Performance issue in reactor.callLater
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41091">[ date ]</a>
              <a href="thread.html#41091">[ thread ]</a>
              <a href="subject.html#41091">[ subject ]</a>
              <a href="author.html#41091">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
