<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Why don't Connectors use deferreds?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Why%20don%27t%20Connectors%20use%20deferreds%3F&In-Reply-To=%3C413FE63F.2000104%40rogers.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="041110.html">
   <LINK REL="Next"  HREF="041103.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Why don't Connectors use deferreds?</H1>
    <B>Mike C. Fletcher</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Why%20don%27t%20Connectors%20use%20deferreds%3F&In-Reply-To=%3C413FE63F.2000104%40rogers.com%3E"
       TITLE="[Twisted-Python] Why don't Connectors use deferreds?">mcfletch at rogers.com
       </A><BR>
    <I>Wed Sep  8 23:12:31 MDT 2004</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="041110.html">[Twisted-Python] Recursive filescanning in Twisted??
</A></li>
        <LI>Next message (by thread): <A HREF="041103.html">[Twisted-Python] Why don't Connectors use deferreds?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41099">[ date ]</a>
              <a href="thread.html#41099">[ thread ]</a>
              <a href="subject.html#41099">[ subject ]</a>
              <a href="author.html#41099">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been wasting yet more time today looking for the &quot;right&quot; way to do 
a very simple thing:

    * Given a protocol
    * Given a destination (e.g. a TCP port)
    * Connect to the TCP port using the given protocol and return the
      protocol object to be used by client code

Now, I know the &quot;normal&quot; way to do this is to create a one-off factory 
such as is seen in twisted.web.client and then use the factory to do the 
after-connection operations.  What I'm wondering is why the code doesn't 
use deferred's to make the operations simpler.  That is, a connector 
succeeds if it completes connecting, and fails otherwise.  The return 
value would be a protocol (and thereby an attached transport).

So something like:

    df = reactor.connectTCP( address, port, factory )
    df.addCallbacks(
    doSomethingWithPortObject,doSomethingIfFailsOrCancelled )

Sure, that doesn't give you the ability to cancel the connection, but 
I'd guess it's a fairly common pattern for client-side code.

With less modification of current code, simply adding a deferred to the 
connector that is fired on either failure-to-connect or connection would 
seem reasonable, so:

    connector = reactor.connectTCP( address, port, factory )
    connector.defer.addCallbacks(
    doSomethingWithPortObject,doSomethingIfFailsOrCancelled )

After all, we're dealing with a classic case of a deferred operation 
(completion of the connection), so why not make it use the standard 
deferred mechanisms.

I've hacked in a solution for my current code where the factory calls 
defer.errback in clientConnectionFailed and the protocol calls 
defer.callback in connectionMade, but that seems extremely inelegant 
(and to be honest, I'm not sure it really guarantees that the deferred 
will eventually be called, there may be cases where neither of those 
methods are called).

Maybe I'm just missing something about the &quot;proper&quot; way to do this in 
Twisted, if so, feel free to point out the one-true-way,
Mike

________________________________________________
  Mike C. Fletcher
  Designer, VR Plumber, Coder
  <A HREF="http://www.vrplumber.com">http://www.vrplumber.com</A>
  <A HREF="http://blog.vrplumber.com">http://blog.vrplumber.com</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="041110.html">[Twisted-Python] Recursive filescanning in Twisted??
</A></li>
	<LI>Next message (by thread): <A HREF="041103.html">[Twisted-Python] Why don't Connectors use deferreds?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41099">[ date ]</a>
              <a href="thread.html#41099">[ thread ]</a>
              <a href="subject.html#41099">[ subject ]</a>
              <a href="author.html#41099">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
