<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20deferToThread%20-%20supported%20alternative%20to%20the%0A%09%28deprecated%29%20setTimeout%20method&In-Reply-To=%3C20060524023637.GF2204%40steerpike.home.puzzling.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045731.html">
   <LINK REL="Next"  HREF="045733.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20deferToThread%20-%20supported%20alternative%20to%20the%0A%09%28deprecated%29%20setTimeout%20method&In-Reply-To=%3C20060524023637.GF2204%40steerpike.home.puzzling.org%3E"
       TITLE="[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method">andrew-twisted at puzzling.org
       </A><BR>
    <I>Tue May 23 20:36:37 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045731.html">[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
</A></li>
        <LI>Next message (by thread): <A HREF="045733.html">[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45732">[ date ]</a>
              <a href="thread.html#45732">[ thread ]</a>
              <a href="subject.html#45732">[ subject ]</a>
              <a href="author.html#45732">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, May 23, 2006 at 09:49:23PM +0100, Paul Moore wrote:
[...]
&gt;<i> 
</I>&gt;<i> The problem is that in rare cases, the blocking call can block
</I>&gt;<i> indefinitely. In this case, I need to make the call time out. However,
</I>&gt;<i> the underlying API offers no way to time out the call, so I have to do
</I>&gt;<i> this externally.
</I>
There is a problem here Twisted cannot help you with -- you will leak threads
that you cannot interrupt, because they are blocked indefinitely.  setTimeout or
other solutions will allow you to paper over this fact, but you need to be aware
of it, because it will eventually stop your process from running.  There's no
way something like defer.setTimeout can magically cancel the underlying
operation for you (even though it unblocks the deferred waiting on that
operation), and part of the reason setTimeout is a deprecated is to force people
to be aware of that.

Also, deferToThread by default isn't going to give you with 50-100 parallel
threads.  The default threadpool size is 4.  You'll need to use
reactor.suggestThreadPoolSize to change that -- but realise that the default DNS
resolver in current Twisted releases use that threadpool too, and perhaps so
will other libraries, and you could starve those callers by swamping the
threadpool with your blocking calls.  So it may be better to use your own
threadpool, as twisted.enterprise.adbapi does, for example.  See
twisted.python.threadpool.

I don't suppose there's a non-blocking way to do what you want?

Oh -- and remember that while you can't kill threads, you *can* kill processes.
Consider using subprocesses to do your blocking work.

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045731.html">[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
</A></li>
	<LI>Next message (by thread): <A HREF="045733.html">[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45732">[ date ]</a>
              <a href="thread.html#45732">[ thread ]</a>
              <a href="subject.html#45732">[ subject ]</a>
              <a href="author.html#45732">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
