<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20deferToThread%20-%20supported%20alternative%20to%20the%0A%09%28deprecated%29%20setTimeout%20method&In-Reply-To=%3Cop.s900z3why3d107%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045730.html">
   <LINK REL="Next"  HREF="045732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method</H1>
    <B>Eric Mangold</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20deferToThread%20-%20supported%20alternative%20to%20the%0A%09%28deprecated%29%20setTimeout%20method&In-Reply-To=%3Cop.s900z3why3d107%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method">teratorn at twistedmatrix.com
       </A><BR>
    <I>Tue May 23 17:03:29 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045730.html">[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
</A></li>
        <LI>Next message (by thread): <A HREF="045732.html">[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45731">[ date ]</a>
              <a href="thread.html#45731">[ thread ]</a>
              <a href="subject.html#45731">[ subject ]</a>
              <a href="author.html#45731">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 24 May 2006 06:49:23 +1000, Paul Moore &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">pf_moore at yahoo.co.uk</A>&gt;  
wrote:

&gt;<i> I have a program where I think that what I want to use is
</I>&gt;<i> deferToThread and setTimeout. However, the setTimeout method is marked
</I>&gt;<i> as deprecated - but I can't find a good supported alternative. Can
</I>&gt;<i> anyone help?
</I>
You can just use reactor.callLater(...) to run whatever timeout code you
have after the given number of seconds. callLater returns a DelayedCall
instance which you can .cancel() if you get a result before the timeout.

&gt;<i> The situation I have is:
</I>&gt;<i>
</I>&gt;<i> I need to do a large-ish number (50-100) of blocking calls in
</I>&gt;<i> parallel, and collect the results or any errors. In itself, this seems
</I>&gt;<i> like a suitable use for deferToThread (defer each call, and collect
</I>&gt;<i> the results in the deferred callback/errback).
</I>&gt;<i>
</I>&gt;<i> The problem is that in rare cases, the blocking call can block
</I>&gt;<i> indefinitely. In this case, I need to make the call time out. However,
</I>&gt;<i> the underlying API offers no way to time out the call, so I have to do
</I>&gt;<i> this externally.
</I>
Well this is a bit of a problem. You can't just kill a thread - so it will
eventually return a result, and Twisted will .callback() its deferred. If
you've already stepped in, due to a timeout, and .callback()'ed the same
deferred you'll get an AlreadyCalledError in your log.

So don't do that.. don't fire that deferred. When you time out just keep  
some
state so that you can ignore the result if and when it comes.

&gt;<i> A quick prototype seems to work OK, using setTimeout to force a
</I>&gt;<i> timeout on the deferred, but it generates deprecation warnings for the
</I>&gt;<i> setTimeout call.
</I>&gt;<i>
</I>&gt;<i> What should I be using to achieve this effect?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Paul.
</I>
Hope that helps.

-- 
Eric Mangold - Twisted/Win32 Maintainer
<A HREF="http://twistedmatrix.com/trac/wiki/Windows">http://twistedmatrix.com/trac/wiki/Windows</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045730.html">[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
</A></li>
	<LI>Next message (by thread): <A HREF="045732.html">[Twisted-Python] deferToThread - supported alternative to the	(deprecated) setTimeout method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45731">[ date ]</a>
              <a href="thread.html#45731">[ thread ]</a>
              <a href="subject.html#45731">[ subject ]</a>
              <a href="author.html#45731">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
