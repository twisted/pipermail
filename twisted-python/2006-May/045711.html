<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Send many large files with PB
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Send%20many%20large%20files%20with%20PB&In-Reply-To=%3C20060521.233032.123886711.warner%40lothar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045632.html">
   <LINK REL="Next"  HREF="045629.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Send many large files with PB</H1>
    <B>Brian Warner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20Send%20many%20large%20files%20with%20PB&In-Reply-To=%3C20060521.233032.123886711.warner%40lothar.com%3E"
       TITLE="[Twisted-Python] Re: Send many large files with PB">warner at lothar.com
       </A><BR>
    <I>Mon May 22 00:30:32 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045632.html">[Twisted-Python] Re: Send many large files with PB
</A></li>
        <LI>Next message (by thread): <A HREF="045629.html">[Twisted-Python] sAsync: SQLAlchemy Made Asynchronous
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45711">[ date ]</a>
              <a href="thread.html#45711">[ thread ]</a>
              <a href="subject.html#45711">[ subject ]</a>
              <a href="author.html#45711">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Justin Mazzola Paluska:
</I>&gt;&gt;<i> How bad is the slow down?  Or, to ask the question another way, how
</I>&gt;&gt;<i> much CPU will the process actually take?  
</I>&gt;<i>
</I>&gt;<i> 100% CPU for all the time it takes. Serialization is CPU- and
</I>&gt;<i> memory-intensive.
</I>
Well, the memory footprint is equal to the size of the chunk that you're
paging.. that's the reason for using FilePager, to reduce the chunk size. (I
think the instantaneous footprint is 2x the chunksize, but once the chunk has
been serialized, it drops back to close to 1x).

Serializing strings is equivalent to copying them. The banana format for
strings is just a couple of length bytes followed by the string contents, so
there's not a whole lot of complex CPU stuff going on, just strcpy.

The other advantage of FilePager is that the serialization CPU time is spread
out according to how fast the network is. I suspect that in most
environments, the process will be IO limited, and CPU usage during the
process would be far less than 100%. That said, it *is* less efficient than
an HTTP server that can just dump the file straight to the network (or better
yet use something like sendfile() to avoid the kernel/userspace transition
altogether).

&gt;&gt;<i> Or is the best thing to do just use the PB to send a URL to the DEST
</I>&gt;&gt;<i> server?
</I>&gt;<i>
</I>&gt;<i> That's what I was hinting at, yes. Of course you should separately take
</I>&gt;<i> care of any required authentication, authorization and encryption on the
</I>&gt;<i> HTTP connection.
</I>
Yup, and if you do too much then you're verging back to the performance of
PB. Creating a random, unguessable URL which only allows a single download of
the target file will basically provide the authentication/authorization
features (modulo a man-in-the-middle attack), but not any confidentiality.
For some applications that might be enough, though.

 -Brian


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045632.html">[Twisted-Python] Re: Send many large files with PB
</A></li>
	<LI>Next message (by thread): <A HREF="045629.html">[Twisted-Python] sAsync: SQLAlchemy Made Asynchronous
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45711">[ date ]</a>
              <a href="thread.html#45711">[ thread ]</a>
              <a href="subject.html#45711">[ subject ]</a>
              <a href="author.html#45711">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
