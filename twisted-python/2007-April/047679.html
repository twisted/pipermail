<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Synchronization techniques
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Synchronization%20techniques&In-Reply-To=%3C04D67B29-A3EB-407B-A057-BC8E8770F64C%40keystonewood.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047678.html">
   <LINK REL="Next"  HREF="047657.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Synchronization techniques</H1>
    <B>Daniel Miller</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Synchronization%20techniques&In-Reply-To=%3C04D67B29-A3EB-407B-A057-BC8E8770F64C%40keystonewood.com%3E"
       TITLE="[Twisted-Python] Synchronization techniques">daniel at keystonewood.com
       </A><BR>
    <I>Thu Apr  5 12:09:53 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047678.html">[Twisted-Python] Synchronization techniques
</A></li>
        <LI>Next message (by thread): <A HREF="047657.html">[Twisted-Python] Synchronization techniques
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47679">[ date ]</a>
              <a href="thread.html#47679">[ thread ]</a>
              <a href="subject.html#47679">[ subject ]</a>
              <a href="author.html#47679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt;The external &quot;blocking&quot; resource is just a shell script that  
</I>&gt;<i> takes  some
</I>&gt;<i> &gt;time t run. It does not acquire any shared resources that would   
</I>&gt;<i> result in
</I>&gt;<i> &gt;dead lock and it will always return (maybe with an error,  but it  
</I>&gt;<i> will
</I>&gt;<i> &gt;return) unless something terrible happens (e.g. plug is  pulled on  
</I>&gt;<i> server,
</I>&gt;<i> &gt;fire, etc.).
</I>&gt;<i>
</I>&gt;<i> I thought I understood what was going on, but now I'm confused  
</I>&gt;<i> again.  Why do you need mutual exclusion at all if it doesn't  
</I>&gt;<i> acquire any shared resources?  Couldn't you just run it concurrently?
</I>
I guess I said that wrong. When I said &quot;it does not acquire any  
shared resources&quot; I was referring to the external system being  
manipulated by the shell script. That effectively means that the  
shell script is the shared resource and it can only be called in a  
synchronous manner. The script is essentially posting a transaction,  
which must be done in an atomic fashion with regard to my code. I  
know this is very ugly, and I'd love to fix it. Unfortunately it's  
not my system so I can't.

We can keep going around and around about this but there's no need.  
My immediate problem was solved when I learned that I could return a  
deferred from a PB remote_xxx() method.

What I would like to continue to discuss is whether all code that  
calls something that does deferred logic must be immediately aware of  
that fact.

&gt;<i> &gt;It would be more maintainable because it would look just like normal
</I>&gt;<i> &gt;sequential python code:
</I>&gt;<i>
</I>&gt;<i> Yes, it would *look* like sequential python code.  But it wouldn't  
</I>&gt;<i> be :).  There's a heck of a lot that can happen in acquire(); your  
</I>&gt;<i> whole application could run for ten minutes on that one line of  
</I>&gt;<i> code.  Worst of all, it would only happen in extreme situations, so  
</I>&gt;<i> testing or debugging issues that are caused by it becomes even more  
</I>&gt;<i> difficult.
</I>
This could happen with any deferred logic. As long as the code has  
the proper concurrency logic this is not a problem--even if it takes  
10 minutes. In today's operating systems something like that could  
even happen in plain old synchronous single-threaded code if the OS  
decided to give some other process priority for that long (unlikely  
but possible).

&gt;<i>
</I>&gt;<i> &gt;My complaint is that the code must have knowledge of the twisted   
</I>&gt;<i> environment
</I>&gt;<i> &gt;(why else would it yield the result of process.check_call ()?). I  
</I>&gt;<i> do not
</I>&gt;<i> &gt;really see the conceptual difference between these two  code  
</I>&gt;<i> blocks except
</I>&gt;<i> &gt;one yields to and one calls into the reactor event  loop. Is there  
</I>&gt;<i> some
</I>&gt;<i> &gt;other inherent problem with the first example? Of  course you need  
</I>&gt;<i> to make
</I>&gt;<i> &gt;sure that the code inside the try/finally  block does not try to  
</I>&gt;<i> acquire the
</I>&gt;<i> &gt;lock again, but that's a basic  concurrency problem which can even  
</I>&gt;<i> happen in
</I>&gt;<i> &gt;the next example.
</I>&gt;<i>
</I>&gt;<i> This is really the key thing.  If you're running your code in the  
</I>&gt;<i> Twisted environment, and you want it to be correct, it really must  
</I>&gt;<i> know about the Twisted environment.  The simple presence of the  
</I>&gt;<i> 'yield' keyword at every level where a Deferred is being returned  
</I>&gt;<i> forces you to acknowledge, &quot;yes, I know that a context switch may  
</I>&gt;<i> occur here&quot;.  Without it, any function could suddenly and radically  
</I>&gt;<i> change the assumptions that all of its callers were allowed to make.
</I>
So it's really a matter of being explicit...and it's true that  
&quot;explicit is better than implicit&quot; but then again, &quot;practicality  
beats purity&quot; :-) It would be super nice to be able to provide the  
exact interface of a normal python module/class/function and have  
twisted logic going on inside. When used properly it would be very  
powerful. Of course doing something like this is definitely not  
entirely innocent, and there should be warnings provided with  
implementations that may block (as there should be with any other  
piece of concurrency-related code that may block). But it's not nice  
to force everyone to use an awkward interface just to try to help  
them avoid mistakes.

~ Daniel




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047678.html">[Twisted-Python] Synchronization techniques
</A></li>
	<LI>Next message (by thread): <A HREF="047657.html">[Twisted-Python] Synchronization techniques
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47679">[ date ]</a>
              <a href="thread.html#47679">[ thread ]</a>
              <a href="subject.html#47679">[ subject ]</a>
              <a href="author.html#47679">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
