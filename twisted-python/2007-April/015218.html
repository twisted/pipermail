<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] epoll reactor problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20epoll%20reactor%20problems&In-Reply-To=026a01c77c22%2463141020%24293c3060%24%40com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015217.html">
   <LINK REL="Next"  HREF="015226.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] epoll reactor problems</H1>
    <B>Thomas Herv&#233;</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20epoll%20reactor%20problems&In-Reply-To=026a01c77c22%2463141020%24293c3060%24%40com"
       TITLE="[Twisted-Python] epoll reactor problems">therve at free.fr
       </A><BR>
    <I>Wed Apr 11 07:47:11 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015217.html">[Twisted-Python] epoll reactor problems
</A></li>
        <LI>Next message: <A HREF="015226.html">[Twisted-Python] epoll reactor problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15218">[ date ]</a>
              <a href="thread.html#15218">[ thread ]</a>
              <a href="subject.html#15218">[ subject ]</a>
              <a href="author.html#15218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Quoting Alec Matusis &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">matusis at matusis.com</A>&gt;:

&gt;&gt;<i> That's old (debian stable ? :)). I don't say that'll solve your
</I>&gt;&gt;<i> problem, but you
</I>&gt;&gt;<i> could try with 2.4.4 (warning, not 2.4.3).
</I>&gt;<i>
</I>&gt;<i> It's SuSE stable ;-) Our stuff on that machine is pretty convoluted now, so
</I>&gt;<i> we will probably have a chance to test with 2.4.4 only in a week, when we
</I>&gt;<i> add a brand new server with 2.4.4.
</I>
OK. That is just another thing to try, I don't see obvious reasons why 
it could
work better on 2.4.4, but...

&gt;<i> I noticed a difference between this from the 99.9% CPU server:
</I>&gt;<i>
</I>&gt;<i> epoll_wait(4, {{EPOLLERR|EPOLLHUP, {u32=423, u64=12304606485815493031}},
</I>&gt;<i> {EPOLLIN|EPOLLPRI|EPOLLOUT|EPOLLRDNORM|EPOLLRDBAND|EPOLLWRNORM|EPOLLWRBAND|E
</I>&gt;<i> POLLMSG|EPOLLERR|EPOLLHUP|0x7820, {u32=5529648, u64=5529648}},
</I>&gt;<i> {EPOLLIN|EPOLLPRI|EPOLLRDNORM|EPOLLRDBAND|EPOLLMSG|0x1000, {u32=0,
</I>&gt;<i> u64=22827751178240}}, {0, {u32=0, u64=0}},
</I>&gt;<i> {EPOLLOUT|EPOLLERR|EPOLLONESHOT|EPOLLET|0x3fffa820, {u32=32767,
</I>&gt;<i> u64=18097643565645823}}}, 1432, 68) = 5
</I>&gt;<i>
</I>&gt;<i> and this from a normal server running at 5% CPU:
</I>&gt;<i>
</I>&gt;<i> epoll_wait(4, {{EPOLLIN, {u32=1769, u64=12304606485815494377}}, {0,
</I>&gt;<i> {u32=4294944684, u64=140737488332716}}}, 1728, 17) = 2
</I>&gt;<i>
</I>&gt;<i> What does this mean?
</I>
The flags set on your sockets are generally EPOLLIN or EPOLLOUT: data 
to read or
available for write. I don't know much about the other flags. EPOLLERR 
is set if
the fd has been closed for example. EPOLLET is *highly* suspect, because it
should only be there if set in the user code. The documentation of other flags
is really terse...


&gt;&gt;<i> What's the global state of the process? Memory, number of opened fd ?
</I>&gt;<i>
</I>&gt;<i> We immediately reverted to poll, so I do not have it in front of me. The RSS
</I>&gt;<i> size was 45MB, and the number of open fd I do not know: it should have been
</I>&gt;<i> about 1500, but I did not check.
</I>
Hum... it may come from running out of file descriptors, so you'd better check
your settings for this.

&gt;<i> I can do another test run with epoll in about 20hrs, since I do not want to
</I>&gt;<i> upset users too much.
</I>
Of course :).

&gt;<i> If you have some specific data I should get from the
</I>&gt;<i> test run, please let me know now.
</I>
Every information would be useful. The most useful information would be 
to know
when it begins to act strangely, and if there is something that happend 
at this
moment. Otherwise, number of fds, memory, netstat output, strace output...

-- 
Thomas




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015217.html">[Twisted-Python] epoll reactor problems
</A></li>
	<LI>Next message: <A HREF="015226.html">[Twisted-Python] epoll reactor problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15218">[ date ]</a>
              <a href="thread.html#15218">[ thread ]</a>
              <a href="subject.html#15218">[ subject ]</a>
              <a href="author.html#15218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
