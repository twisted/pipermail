<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> readline-like behavior inside Twisted (was Re: [Twisted-Python] Re:	Synchronization techniques)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20readline-like%20behavior%20inside%20Twisted%20%28was%20Re%3A%20%5BTwisted-Python%5D%20Re%3A%0A%09Synchronization%20techniques%29&In-Reply-To=%3C20070408145125.18920.1518675638.divmod.quotient.9346%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047689.html">
   <LINK REL="Next"  HREF="047698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>readline-like behavior inside Twisted (was Re: [Twisted-Python] Re:	Synchronization techniques)</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20readline-like%20behavior%20inside%20Twisted%20%28was%20Re%3A%20%5BTwisted-Python%5D%20Re%3A%0A%09Synchronization%20techniques%29&In-Reply-To=%3C20070408145125.18920.1518675638.divmod.quotient.9346%40ohm%3E"
       TITLE="readline-like behavior inside Twisted (was Re: [Twisted-Python] Re:	Synchronization techniques)">exarkun at divmod.com
       </A><BR>
    <I>Sun Apr  8 08:51:25 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047689.html">[Twisted-Python] Re: Synchronization techniques
</A></li>
        <LI>Next message (by thread): <A HREF="047698.html">[Twisted-Python] Re: readline-like behavior inside Twisted (was Re:	Re:	Synchronization techniques)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47695">[ date ]</a>
              <a href="thread.html#47695">[ thread ]</a>
              <a href="subject.html#47695">[ subject ]</a>
              <a href="author.html#47695">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 06 Apr 2007 21:28:49 -0000, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:
&gt;<i>On 06:18 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">list-ener at strank.info</A> wrote:
</I>&gt;&gt;<i>on 04.04.2007 23:40 <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> said the following:
</I>&gt;&gt;<i>&lt;snip&gt;
</I>&gt;<i>
</I>&gt;&gt;&gt;<i>Run &quot;python -m twisted/conch/stdio&quot; for an example of an interactive
</I>&gt;<i>&lt;snip&gt;
</I>&gt;&gt;&gt;<i>Here's a screenshot of an interactive session using the command above:
</I>&gt;<i>
</I>&gt;&gt;<i>Am I right that this is a screenshot of the manhole client?
</I>&gt;<i>
</I>&gt;<i>Sort of.  It's the manhole server (I don't know what you mean by &quot;client&quot;) 
</I>&gt;<i>running on standard IO, run via 'python -m twisted/conch/stdio'.
</I>&gt;&gt;<i>For embedding this in twisted, the twisted reactor needs to be the one 
</I>&gt;&gt;<i>calling IPython/pyreadline when necessary.
</I>&gt;&gt;<i>On the IPython level, I think this should be &quot;easy&quot; by subclassing the 
</I>&gt;&gt;<i>Shell and splitting/rearranging the relevant code, so that it can be called 
</I>&gt;&gt;<i>back at the point where raw_input would normally return.
</I>&gt;&gt;<i>(I did not look at the new IPython saw branch...)
</I>&gt;<i>
</I>&gt;&gt;<i>On the twisted side, I think that something like twisted.internet.stdio 
</I>&gt;&gt;<i>would be calling back?
</I>&gt;<i>
</I>&gt;<i>Rather than IPython calling into raw_input, the loop that calls raw_input 
</I>&gt;<i>would have to be changed to a function that takes a string. This would 
</I>&gt;<i>almost certainly be the trickiest part, since it seems there are about two 
</I>&gt;<i>dozen places (at a quick glance) in ipython that call raw_input.
</I>&gt;&gt;<i>Or rather something like twisted.conch.insults?
</I>&gt;<i>
</I>&gt;<i>insults will be getting its events from twisted.internet.stdio, so both will 
</I>&gt;<i>be involved.
</I>&gt;&gt;<i>I suspect that it would be hard to recode pyreadline in a way that it could 
</I>&gt;&gt;<i>be called back by twisted?
</I>&gt;&gt;<i>So to get readline support, something like readline would need to be 
</I>&gt;&gt;<i>implemented using t.i.stdio / insults.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Does this seem possible, so far? :-)
</I>&gt;<i>
</I>&gt;<i>To me, sure - although I hardly have the time to do it :).  There have been 
</I>&gt;<i>a few forays into line-editing code for insults, although I'm not clear of 
</I>&gt;<i>the current state of the art, JP Calderone should be returning from vacation 
</I>&gt;<i>soon and will probably have some light to shed on the issue.  I don't know 
</I>&gt;<i>much about pyreadline.  There may be code there that's reusable, maybe not, 
</I>&gt;<i>but in any event it is a goal of the insults library to provide high-quality 
</I>&gt;<i>event-driven line-editing.
</I>&gt;<i>
</I>
I haven't looked at pyreadline before, although I did take a look at UNC a
long time ago.  Taking a quick look at the code, it looks like converting
pyreadline to be Twisted friendly may be doable.  The most obvious change
that would be required is for each point in the code which calls getkeypress
or getchar to be changed to instead respond to an event.  The ideal way to
do this would be with a nice state machine which accounts for all the legal
inputs and states the input system can be in.  A slightly less nice way which
would probably be much easier to implement would be to add getkeypress and
getchar implementations which return Deferreds and then use inlineCallbacks
to avoid having to make significant changes to any of the callers.  This is
worse since it leaves the code a bit of a mess, but it might be useful as an
experiment.

As for insults, I expect it has a less complete implementation of all of the
typical readline features you or your users are interested in, but it is
gradually improving.  What would actually be really excellent is if both
insults and pyreadline used the same underlying readline model code which
was devoid of input/output code, then each could focus on the part it should
really care about (dealing with events or talking to a windows console or
what have you) and improvements to the actually interesting behavior in the
readline model could be shared between the two.

To some extend insults already has this (I've tried to factor as much of the
interesting behavior out away from the Twisted parts), and I see this is also
how at least some of pyreadline is structured (eg lineeditor/history.py), so
it might actually be feasible to merge the two backends into one shared
thing.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047689.html">[Twisted-Python] Re: Synchronization techniques
</A></li>
	<LI>Next message (by thread): <A HREF="047698.html">[Twisted-Python] Re: readline-like behavior inside Twisted (was Re:	Re:	Synchronization techniques)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47695">[ date ]</a>
              <a href="thread.html#47695">[ thread ]</a>
              <a href="subject.html#47695">[ subject ]</a>
              <a href="author.html#47695">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
