<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Load testing twistd + twisted.soap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Load%20testing%20twistd%20%2B%20twisted.soap&In-Reply-To=%3C24B83043-F677-42EE-9377-F2C5CCA06DA5%40zgroupplc.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047804.html">
   <LINK REL="Next"  HREF="047808.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Load testing twistd + twisted.soap</H1>
    <B>Matthew Glubb</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Load%20testing%20twistd%20%2B%20twisted.soap&In-Reply-To=%3C24B83043-F677-42EE-9377-F2C5CCA06DA5%40zgroupplc.com%3E"
       TITLE="[Twisted-Python] Load testing twistd + twisted.soap">matt at zgroupplc.com
       </A><BR>
    <I>Fri Apr 27 04:51:05 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047804.html">[Twisted-Python] newb: Twisted-Goodies asynch cluster and	TaskQueue
</A></li>
        <LI>Next message (by thread): <A HREF="047808.html">[Twisted-Python] sAsync example.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47806">[ date ]</a>
              <a href="thread.html#47806">[ thread ]</a>
              <a href="subject.html#47806">[ subject ]</a>
              <a href="author.html#47806">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi All,

I am attempting to write a simple load test for my soap web services.  
I am running the application under twistd and using trial for unit  
tests. I understand that for a real load test, I would use a tool  
like ab or http_load in a more scientific environment but I want to  
get a quick feel for how well a twisted application stands up against  
low levels of load on my dev box and I feel that there is merit in  
setting a baseline level of performance in a unit test.

I am running into problems with the following:

class SOAPTestCase(BaseTestCase):

     url = '<A HREF="http://localhost:8080/">http://localhost:8080/</A>'

     def setUp(self):
         self.proxy = Proxy(self.url)

     def testMutipleAPCs(self):
         &quot;&quot;&quot;Assert that multiple APCs succeed&quot;&quot;&quot;
         deferred = defer.Deferred()
         for i in range(100):
             d = self.testAPCTimeout()
             d.chainDeferred(deferred)
         return deferred

     def testAPCTimeout(self):
         deferred = self.proxy.callRemote('processApc', 0,  
self._getRandomString())
         deferred.addBoth(self.APCTimeout)
         return deferred

     def APCTimeout(self, result):
         requestIdForApc, requestDataForApc, errorFlag, result = result

         self.assertEqual(result, res)
         self.assertTrue(isinstance(requestIdForApc, str))
         self.assertEqual(id, requestIdForApc)
         self.assertTrue(isinstance(requestDataForApc, str))
         self.assertEqual(data, requestDataForApc)

         self.assertTrue(isinstance(errorFlag, str))
         self.assertEqual(cp.cp_base.getErrorFlag(cp.cp_base.APC,  
err), errorFlag)

For a start, I get a lot of 'reactor left in unclean state' warnings.  
This number of twisted.internet.tcp.Client instances that this  
reports on is never usually all of them:

twisted.trial.util.DirtyReactorError: THIS WILL BECOME AN ERROR SOON!  
reactor left in unclean state, the following Selectables were left  
over:  &lt;&lt;class 'twisted.internet.tcp.Client'&gt; to ('localhost', 8080)  
at 1782390&gt; &lt;&lt;class 'twisted.internet.tcp.Client'&gt; to ('localhost',  
8080) at 1782150&gt; ...

In addition I get pending time calls still pending:

twisted.trial.util.PendingTimedCallsError: pendingTimedCalls still  
pending (consider setting twisted.internet.base.DelayedCall.debug =  
True): &lt;DelayedCall 24636392 [24.8269200325s] called=0 cancelled=0  
Client.failIfNotConnected(TimeoutError('',))&gt; ...

Does any twisted genius have any idea what I am doing wrong?

Regards,


Matt


m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: &lt;<A HREF="http://www.zgroupplc.com/">http://www.zgroupplc.com/</A>&gt;

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">service at zgroupplc.com</A>&gt;



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGMdWcyI6MkdKPngkRAqTgAJ9I9dxz3B3EYPMfY8fY09kVqmVMdACfSqa2
wPgXzPQMX+FgKcC41oWEQA8=
=V8JT
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047804.html">[Twisted-Python] newb: Twisted-Goodies asynch cluster and	TaskQueue
</A></li>
	<LI>Next message (by thread): <A HREF="047808.html">[Twisted-Python] sAsync example.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47806">[ date ]</a>
              <a href="thread.html#47806">[ thread ]</a>
              <a href="subject.html#47806">[ subject ]</a>
              <a href="author.html#47806">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
