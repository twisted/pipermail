<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Synchronization techniques
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Synchronization%20techniques&In-Reply-To=20070404214000.7769.1687353046.divmod.xquotient.2170%40joule.divmod.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015158.html">
   <LINK REL="Next"  HREF="015181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Synchronization techniques</H1>
    <B>Stefan Rank</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Synchronization%20techniques&In-Reply-To=20070404214000.7769.1687353046.divmod.xquotient.2170%40joule.divmod.com"
       TITLE="[Twisted-Python] Re: Synchronization techniques">list-ener at strank.info
       </A><BR>
    <I>Fri Apr  6 14:18:00 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015158.html">[Twisted-Python] Synchronization techniques
</A></li>
        <LI>Next message: <A HREF="015181.html">[Twisted-Python] Re: Synchronization techniques
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15180">[ date ]</a>
              <a href="thread.html#15180">[ thread ]</a>
              <a href="subject.html#15180">[ subject ]</a>
              <a href="author.html#15180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>on 04.04.2007 23:40 <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> said the following:
&lt;snip&gt;
&gt;<i> 
</I>&gt;<i> Run &quot;python -m twisted/conch/stdio&quot; for an example of an interactive 
</I>&gt;<i> session that is held in a non-blocking way.  Not blocking in the code 
</I>&gt;<i> *doesn't* mean not blocking for the user - it just means having the 
</I>&gt;<i> option not to block.
</I>&gt;<i> 
</I>&gt;<i>  &gt;2.  Users expect certain things in an interactive python session that
</I>&gt;<i>  &gt;don't mesh well with Twisted and the asynchronous universe:
</I>&gt;<i> 
</I>&gt;<i> This is _exactly_ the documentation issue I was talking about :).
</I>&gt;<i> 
</I>&gt;<i>  &gt;&gt;&gt;&gt;psi = computeWavefunctionForHydrogen()
</I>&gt;<i>  &gt;&gt;&gt;&gt;psi.getEnergy(1)
</I>&gt;<i>  &gt;-13.6
</I>&gt;<i>  &gt;# here the user looks at the energy (a human if statement) and decides
</I>&gt;<i>  &gt;if they actually want to
</I>&gt;<i>  &gt;# make the following plot.  If the answer were not -13.6, they would
</I>&gt;<i>  &gt;not make the plot.
</I>&gt;<i>  &gt;&gt;&gt;&gt;plot(psi.getState(1))
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;Even if you could get the reactor running in an interactive python
</I>&gt;<i>  &gt;session it would be crazy to have to write something like (in an
</I>&gt;<i>  &gt;interactive session):
</I>&gt;<i>  &gt;&gt;&gt;&gt;d = computeWavefunctionForHydrogen()
</I>&gt;<i>  &gt;&gt;&gt;&gt;def printAndPlot(psi, n):
</I>&gt;<i>  &gt;&gt;&gt;&gt;     print psi.getEnergy(n)
</I>&gt;<i>  &gt;&gt;&gt;&gt;     if abs(psi.getEnergy(n) - (psi.getEnergy(n)) &lt; 1.0e-4:
</I>&gt;<i>  &gt;&gt;&gt;&gt;         plot(psi.getState(n))
</I>&gt;<i>  &gt;&gt;&gt;&gt;d.addCallback(printAndPlot, 1)
</I>&gt;<i> 
</I>&gt;<i> Here's a screenshot of an interactive session using the command above:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/users/glyph/images/content/screenshots/psi-energy.png">http://twistedmatrix.com/users/glyph/images/content/screenshots/psi-energy.png</A>
</I>&gt;<i> 
</I>&gt;<i> Unfortunately it doesn't animate, but there is a 1-second pause between 
</I>&gt;<i> &quot;&lt;Deferred #0&gt;&quot; and &quot;Deferred #0 called back:&quot;.  It's a bit crude since 
</I>&gt;<i> it is &quot;deferred-oriented&quot; right now, rather than result oriented, but a 
</I>&gt;<i> few clever implementation tricks could easily eliminate the distinction 
</I>&gt;<i> (like the &quot;_.result&quot; line).
</I>
Am I right that this is a screenshot of the manhole client?

I just recently tried to embed the IPython shell into a twisted application.
AFAIK this is currently only possible using a separate thread
(there is an ASPN cookbook entry).

I would like to list here what I think is necessary to make this 
possible without using threads. Hopefully, you can correct me where I am 
wrong.

The main IPython class has a main loop (InteractiveShell.interact) that 
uses raw_input. Further, it first sets up pyreadline for handling 
command-line niceties inside raw_input.

For embedding this in twisted, the twisted reactor needs to be the one 
calling IPython/pyreadline when necessary.
On the IPython level, I think this should be &quot;easy&quot; by subclassing the 
Shell and splitting/rearranging the relevant code, so that it can be 
called back at the point where raw_input would normally return.
(I did not look at the new IPython saw branch...)

On the twisted side, I think that something like twisted.internet.stdio 
  would be calling back?
Or rather something like twisted.conch.insults?

I suspect that it would be hard to recode pyreadline in a way that it 
could be called back by twisted?
So to get readline support, something like readline would need to be 
implemented using t.i.stdio / insults.

Does this seem possible, so far? :-)

cheers,
stefan



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015158.html">[Twisted-Python] Synchronization techniques
</A></li>
	<LI>Next message: <A HREF="015181.html">[Twisted-Python] Re: Synchronization techniques
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15180">[ date ]</a>
              <a href="thread.html#15180">[ thread ]</a>
              <a href="subject.html#15180">[ subject ]</a>
              <a href="author.html#15180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
