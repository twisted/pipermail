<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] The Trial of the DirtyReactorError
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20The%20Trial%20of%20the%20DirtyReactorError&In-Reply-To=20070412185606.7769.1982208738.divmod.xquotient.2797%40joule.divmod.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015243.html">
   <LINK REL="Next"  HREF="015250.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] The Trial of the DirtyReactorError</H1>
    <B>Matthew Glubb</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20The%20Trial%20of%20the%20DirtyReactorError&In-Reply-To=20070412185606.7769.1982208738.divmod.xquotient.2797%40joule.divmod.com"
       TITLE="[Twisted-Python] The Trial of the DirtyReactorError">matt at zgroupplc.com
       </A><BR>
    <I>Fri Apr 13 03:19:45 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015243.html">[Twisted-Python] The Trial of the DirtyReactorError
</A></li>
        <LI>Next message: <A HREF="015250.html">[Twisted-Python] The Trial of the DirtyReactorError
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15248">[ date ]</a>
              <a href="thread.html#15248">[ thread ]</a>
              <a href="subject.html#15248">[ subject ]</a>
              <a href="author.html#15248">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Thanks for your advice, glyph. I'll probably end up calling listenTCP  
from within the factory and shutting it down on call or errback.

Regards,

Matt

On 12 Apr 2007, at 19:56, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:

&gt;<i> On 04:53 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">matt at zgroupplc.com</A> wrote:
</I>&gt;&gt;<i> I understand why this is occurring, its a simple matter of calling  
</I>&gt;&gt;<i> tcp.Port.stopListening() to suppress the error. However, I am more  
</I>&gt;&gt;<i> concerned with learning about where the most appropriate place to  
</I>&gt;&gt;<i> run this routine would be. I am not happy about running it in the  
</I>&gt;&gt;<i> unit test as it doesn't solve the problem, it just suppresses it.
</I>&gt;<i>
</I>&gt;<i> Putting the stopListening call into the middle of the actual test  
</I>&gt;<i> method would definitely be wrong.
</I>&gt;<i>
</I>&gt;<i> However, putting the listenTCP in the setUp and the stopListening  
</I>&gt;<i> in the tearDown would be entirely appropriate.  If the code under  
</I>&gt;<i> test dynamically calls stopListening and might fail before then,  
</I>&gt;<i> then a tearDown by itself might be appropriate.
</I>&gt;&gt;<i> I can't  seem to find an easy way to stop a port from listening  
</I>&gt;&gt;<i> from within a  ServerFactory. Should I be writing a class that  
</I>&gt;&gt;<i> wraps the ServerFactory to run tcp.Port.stopListening() at the  
</I>&gt;&gt;<i> appropriate time?
</I>&gt;<i>
</I>&gt;<i> This is, in part, a weakness of the IProtocolFactory interface.   
</I>&gt;<i> Calls to doStart and doStop should really receive an IListeningPort  
</I>&gt;<i> argument.
</I>&gt;<i>
</I>&gt;<i> However, this is a minor wart.  listenTCP returns the Port, and  
</I>&gt;<i> hooking this up to your server factory in application code should  
</I>&gt;<i> be easy enough.
</I>&gt;&gt;<i> Please bear in mind that I am creating multiple 'one-shot' servers  
</I>&gt;&gt;<i> that are always shut down as soon as they have done their  
</I>&gt;&gt;<i> business. I am guessing that the stopService methods would be more  
</I>&gt;&gt;<i> appropriate  for a conventional server that serves multiple  
</I>&gt;&gt;<i> clients / requests.
</I>&gt;<i>
</I>&gt;<i> If they are &quot;always shut down&quot;, what event currently shuts them  
</I>&gt;<i> down? Have your test trigger that event.  If they're one-shot, then  
</I>&gt;<i> perhaps the method that calls listenTCP should be on the factory  
</I>&gt;<i> itself, making it even easier to keep track of the Port instance it  
</I>&gt;<i> is associated with.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


m a t t h e w   g l u b b

________________________________________________________________________
Z Group PLC

Tel: +44 (0) 8700 111 173
Fax: +44 (0) 8707 051 393
Txt: +44 (0) 7800 140 877
Web: &lt;<A HREF="http://www.zgroupplc.com/">http://www.zgroupplc.com/</A>&gt;

This  email  and  any  files  transmitted  with it are  confidential and
intended solely for the use of the individual or entity to whom they are
addressed.  The opinions  expressed in this mail are those of the author
and do not necessarily  represent the views of the company.  If you have
received this email in error please notify &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">service at zgroupplc.com</A>&gt;



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (Darwin)

iD8DBQFGHy8UyI6MkdKPngkRAlH6AJ9bKzXeD2resG9USuAnWwCvoEaVEgCePCDy
rGROSFHTjmkQgBDHdDQ09o0=
=k9Gq
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015243.html">[Twisted-Python] The Trial of the DirtyReactorError
</A></li>
	<LI>Next message: <A HREF="015250.html">[Twisted-Python] The Trial of the DirtyReactorError
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15248">[ date ]</a>
              <a href="thread.html#15248">[ thread ]</a>
              <a href="subject.html#15248">[ subject ]</a>
              <a href="author.html#15248">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
