<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] epoll reactor problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20epoll%20reactor%20problems&In-Reply-To=20070411192731.7769.729194544.divmod.xquotient.2702%40joule.divmod.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015229.html">
   <LINK REL="Next"  HREF="015251.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] epoll reactor problems</H1>
    <B>Alec Matusis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20epoll%20reactor%20problems&In-Reply-To=20070411192731.7769.729194544.divmod.xquotient.2702%40joule.divmod.com"
       TITLE="[Twisted-Python] epoll reactor problems">matusis at matusis.com
       </A><BR>
    <I>Thu Apr 12 21:50:40 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015229.html">[Twisted-Python] epoll reactor problems
</A></li>
        <LI>Next message: <A HREF="015251.html">[Twisted-Python] epoll reactor problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15246">[ date ]</a>
              <a href="thread.html#15246">[ thread ]</a>
              <a href="subject.html#15246">[ subject ]</a>
              <a href="author.html#15246">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>  Would it be possible to replicate this issue with your application in some kind of load-testing environment so that we can analyze it &quot;in the lab&quot;?  
</I>
 

So far, we could not replicate this in the lab- with thousands of fake multithreaded clients the behavior is normal.

Thus far, we have run this for 2 days with twisted 2.5 with poll and epoll, and we are now seeing big memory leaks that did not occur on 2.2, especially on epoll, in addition to 99.9% CPU.

Back on 2.2 one of our servers was slowly leaking memory, going from 45MB to about 500MB in about 10 days. On epoll in 2.5 it went from 45MB to 1.9g in a couple of hours, almost taking the machine down. The other server did not have memory leak on 2.2, staying at 70MB for weeks at a time. In one day it went from 70MB to 80MB on epoll in 2.5. Both show 99% CPU, so I suspect the memory leaks may be caused by skipping garbage collection because the process is too busy. Interestingly, the actual performance on epoll is not bad, the servers remain responsive even where the poll-based reactor in 2.2 was having difficulties.

 

We must revert to 2.2 tonight.

 

I emailed you and Jean-Paul. If you like, we can arrange ssh to our live servers, then you could look at it on Twisted 2.2 first, then we will switch again to 2.5 and then you can examine it when it&#8217;s unstable.

 

 

 

From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>
Sent: Wednesday, April 11, 2007 12:28 PM
To: Twisted general discussion
Subject: RE: [Twisted-Python] epoll reactor problems

 

On 06:38 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">matusis at matusis.com</A> wrote:

&gt;<i>I wonder if we should revert to Twisted 2.2 ASAP
</I>
I can't speak to your deployment requirements, but it sounds like this inquiry could lead to some extremely valuable information to fix this issue in the next release of Twisted.  Would it be possible to replicate this issue with your application in some kind of load-testing environment so that we can analyze it &quot;in the lab&quot;?  Although I'd really like to see this through to a satisfying conclusion, I don't want your application to have to pay the cost of fixing Twisted.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20070412/7e9871d4/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20070412/7e9871d4/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015229.html">[Twisted-Python] epoll reactor problems
</A></li>
	<LI>Next message: <A HREF="015251.html">[Twisted-Python] epoll reactor problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15246">[ date ]</a>
              <a href="thread.html#15246">[ thread ]</a>
              <a href="subject.html#15246">[ subject ]</a>
              <a href="author.html#15246">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
