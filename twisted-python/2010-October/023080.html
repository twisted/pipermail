<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Catching all the exceptions in a Twisted	program
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Catching%20all%20the%20exceptions%20in%20a%20Twisted%0A%09program&In-Reply-To=AANLkTikOavTPwCFvPzLsA3finjA_JjxVxwBUOSwsNq%2Bt%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023078.html">
   <LINK REL="Next"  HREF="023084.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Catching all the exceptions in a Twisted	program</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Catching%20all%20the%20exceptions%20in%20a%20Twisted%0A%09program&In-Reply-To=AANLkTikOavTPwCFvPzLsA3finjA_JjxVxwBUOSwsNq%2Bt%40mail.gmail.com"
       TITLE="[Twisted-Python] Catching all the exceptions in a Twisted	program">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Oct 25 08:29:58 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="023078.html">[Twisted-Python] Catching all the exceptions in a Twisted program
</A></li>
        <LI>Next message: <A HREF="023084.html">[Twisted-Python] PySide (Qt4) &lt;-&gt; Twisted reactor integration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23080">[ date ]</a>
              <a href="thread.html#23080">[ thread ]</a>
              <a href="subject.html#23080">[ subject ]</a>
              <a href="author.html#23080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10:57 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">facundobatista at gmail.com</A> wrote:
&gt;<i>Hello!
</I>&gt;<i>
</I>&gt;<i>I've just subscribed to the list, but I'm using Twisted from a while 
</I>&gt;<i>ago.
</I>&gt;<i>
</I>&gt;<i>I need to do something, and wasn't able to find out how to do it. 
</I>&gt;<i>Well, I
</I>&gt;<i>*did* find out, but it's a horrible hack, and actually depends on 
</I>&gt;<i>something
</I>&gt;<i>that may be a bug, so it's worth asking here about this :)
</I>&gt;<i>
</I>&gt;<i>In a project I'm doing [0], I want to catch all problems (unhandled
</I>&gt;<i>exceptions), log them and show them in stderr after a bit massaging. 
</I>&gt;<i>My
</I>&gt;<i>first approach was to hook me in sys.excepthook, and it worked on some
</I>&gt;<i>cases.  But I saw some cases where it didn't [1].
</I>
Right.  Instead of letting any exception from application code abort the 
process entirely, most places in Twisted catch and log unexpected 
exceptions.
&gt;<i>Specifically, when the exception was inside a deferred, it didn't call
</I>&gt;<i>excepthook.
</I>
Another case where this will happen is if a protocol's dataReceived 
method raises an exception.  Or if a function passed to 
reactor.callLater raises an exception.
&gt;<i>Why not? I started to check the code, and found the following
</I>&gt;<i>snippet, at the end of Deferred._run_callbacks, in defer.py:
</I>&gt;<i>
</I>&gt;<i>   if isinstance(self.result, failure.Failure):
</I>&gt;<i>       self.result.cleanFailure()
</I>&gt;<i>       if self._debugInfo is None:
</I>&gt;<i>           self._debugInfo = DebugInfo()
</I>&gt;<i>       self._debugInfo.failResult = self.result
</I>&gt;&gt;<i> From this, I have two questions:
</I>&gt;<i>
</I>&gt;<i>1. The rest of the code only instantiates and uses DebugInfo
</I>&gt;<i>   &quot;if self.debug&quot;.  Why this part of the code doesn't care about the
</I>&gt;<i>   self.debug flag and always uses it?  Is it intended and DebugInfo()
</I>&gt;<i>   not being used for debug is a misname left there for historical
</I>&gt;<i>   reasons?  Should I open a bug about this?
</I>
It's correct as is.  DebugInfo is used for a few things.  Tracking 
unhandled errors is one of them, and it is always enabled, whether 
&quot;Deferred debugging&quot; is on or not.
&gt;<i>2. I did the following (ugly) hack to achieve my results:
</I>&gt;<i>
</I>&gt;<i>    import twisted.internet.defer
</I>&gt;<i>
</I>&gt;<i>    # ugliest thing I saw in a *long* time
</I>&gt;<i>    class MyDebugInfo(object):
</I>&gt;<i>
</I>&gt;<i>        def _error_happened(self, failure):
</I>&gt;<i>            msg = failure.getTraceback()
</I>&gt;<i>            _expose_exception(msg)
</I>&gt;<i>
</I>&gt;<i>        failResult = property(fset=_error_happened)
</I>&gt;<i>
</I>&gt;<i>    twisted.internet.defer.DebugInfo = MyDebugInfo
</I>&gt;<i>
</I>&gt;<i>   Is there a better way to do this?  Actually, this is working 
</I>&gt;<i>correctly,
</I>&gt;<i>   but I don't know if it's the right way to do it, and don't want to
</I>&gt;<i>   depend of DebugInfo() being called always in this case.
</I>
You should add a log observer that watches for errors.

<A HREF="http://twistedmatrix.com/documents/9.0.0/core/howto/logging.html">http://twistedmatrix.com/documents/9.0.0/core/howto/logging.html</A>

Jean-Paul
&gt;<i>Thank you very much!
</I>&gt;<i>
</I>&gt;<i>[0] <A HREF="http://launchpad.net/magicicada">http://launchpad.net/magicicada</A>
</I>&gt;<i>[1] <A HREF="http://bugs.launchpad.net/magicicada/+bug/665681">http://bugs.launchpad.net/magicicada/+bug/665681</A>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>.&#160; &#160; Facundo
</I>&gt;<i>
</I>&gt;<i>Blog: <A HREF="http://www.taniquetil.com.ar/plog/">http://www.taniquetil.com.ar/plog/</A>
</I>&gt;<i>PyAr: <A HREF="http://www.python.org/ar/">http://www.python.org/ar/</A>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-Python mailing list
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023078.html">[Twisted-Python] Catching all the exceptions in a Twisted program
</A></li>
	<LI>Next message: <A HREF="023084.html">[Twisted-Python] PySide (Qt4) &lt;-&gt; Twisted reactor integration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23080">[ date ]</a>
              <a href="thread.html#23080">[ thread ]</a>
              <a href="subject.html#23080">[ subject ]</a>
              <a href="author.html#23080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
