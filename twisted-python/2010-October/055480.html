<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] patch for TLS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20patch%20for%20TLS&In-Reply-To=%3C4CAE1742.1000300%40creativetrax.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055479.html">
   <LINK REL="Next"  HREF="055481.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] patch for TLS</H1>
    <B>jason-sage at creativetrax.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20patch%20for%20TLS&In-Reply-To=%3C4CAE1742.1000300%40creativetrax.com%3E"
       TITLE="[Twisted-Python] patch for TLS">jason-sage at creativetrax.com
       </A><BR>
    <I>Thu Oct  7 12:53:54 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055479.html">[Twisted-Python] ConFoo 2011 Call for Speakers
</A></li>
        <LI>Next message (by thread): <A HREF="055481.html">[Twisted-Python] patch for TLS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55480">[ date ]</a>
              <a href="thread.html#55480">[ thread ]</a>
              <a href="subject.html#55480">[ subject ]</a>
              <a href="author.html#55480">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(cc to both twisted and sage-devel lists)

Hi all,

In the Sage project (<A HREF="http://sagemath.org">http://sagemath.org</A>), we apply a patch to the 
Twisted version we distribute.  I'd like to clean out our custom patches 
and push them upstream, if possible.  So I have a couple of questions 
(I'm not terribly familiar with Twisted):

1. Is the patch below generally useful?

2. Is there a better way to do this than to patch the file?

3. What do we need to do to incorporate it upstream in Twisted?


PATCH (against the Twisted git mirror, as of today):

diff --git a/twisted/application/internet.py 
b/twisted/application/internet.py
index 8437568..0397f08 100644
--- a/twisted/application/internet.py
+++ b/twisted/application/internet.py
@@ -193,7 +193,7 @@ on arguments to the reactor method.
  }

  import new
-for tran in 'TCP UNIX SSL UDP UNIXDatagram Multicast'.split():
+for tran in 'TCP UNIX SSL TLS UDP UNIXDatagram Multicast'.split():
      for side in 'Server Client'.split():
          if tran == &quot;Multicast&quot; and side == &quot;Client&quot;:
              continue
diff --git a/twisted/application/strports.py 
b/twisted/application/strports.py
index 3654413..2b6ca08 100644
--- a/twisted/application/strports.py
+++ b/twisted/application/strports.py
@@ -79,9 +79,25 @@ def _parseSSL(factory, port, privateKey=&quot;server.pem&quot;, 
certKey=None,
      return ((int(port), factory, cf),
              {'interface': interface, 'backlog': int(backlog)})

+def _parseTLS(factory, port, privateKey='server.pem', certKey=None,
+              sslmethod=None, interface='', backlog=50):
+    from gnutls.interfaces.twisted import X509Credentials
+    from gnutls.crypto import X509Certificate, X509PrivateKey
+
+    if certKey is None:
+        certKey = privateKey
+
+    cert = X509Certificate(open(certKey).read())
+    key = X509PrivateKey(open(privateKey).read())
+    cf = X509Credentials(cert, key)
+
+    return ((int(port), factory, cf),
+            {'interface': interface, 'backlog': int(backlog)})
+
  _funcs = {&quot;tcp&quot;: _parseTCP,
            &quot;unix&quot;: _parseUNIX,
-          &quot;ssl&quot;: _parseSSL}
+          &quot;ssl&quot;: _parseSSL,
+          &quot;tls&quot;: _parseTLS}

  _OP, _STRING = range(2)
  def _tokenize(description):



Thanks for the excellent software!

Jason

[1] <A HREF="http://sagemath.org">http://sagemath.org</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055479.html">[Twisted-Python] ConFoo 2011 Call for Speakers
</A></li>
	<LI>Next message (by thread): <A HREF="055481.html">[Twisted-Python] patch for TLS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55480">[ date ]</a>
              <a href="thread.html#55480">[ thread ]</a>
              <a href="subject.html#55480">[ subject ]</a>
              <a href="author.html#55480">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
