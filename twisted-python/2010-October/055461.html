<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Limiting a task.Cooperator to N work units / sec
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Limiting%20a%20task.Cooperator%20to%20N%20work%20units%20/%20sec&In-Reply-To=%3C4CA5ACB7.9020403%40imperial.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   <LINK REL="Next"  HREF="055462.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Limiting a task.Cooperator to N work units / sec</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Limiting%20a%20task.Cooperator%20to%20N%20work%20units%20/%20sec&In-Reply-To=%3C4CA5ACB7.9020403%40imperial.ac.uk%3E"
       TITLE="[Twisted-Python] Limiting a task.Cooperator to N work units / sec">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Fri Oct  1 03:41:11 MDT 2010</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="055462.html">[Twisted-Python] Limiting a task.Cooperator to N work units /	sec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55461">[ date ]</a>
              <a href="thread.html#55461">[ thread ]</a>
              <a href="subject.html#55461">[ subject ]</a>
              <a href="author.html#55461">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Is there an easy way to make a task.Cooperator instance only execute N 
ticks / sec, summed across all iterators it's driving? So if you add two 
iterators, they each run at N/2 per sec, 3 at N/3, etc.

It seems like this ought to do it:

N = &lt;rate&gt;

def myScheduler(x):
   # reschedule N times per second
   reactor.callLater(1.0/N, x)

class myTermination:
   def __call__(self):
     # stop immediately after one iterator.next()
     return True

myCoop = task.Cooperator(
   terminationPredicateFactory=myTermination,
   scheduler=myScheduler,
)

...but this doesn't seem to work when I try it:

def mytask(name, limit):
     for i in range(limit):
         print name, time.time(), i
         yield i

def running():
     finish_a = myCoop.coiterate(mytask('a', 40))
     def start_b():
         finish_b = myCoop.coiterate(mytask('b', 10))
     reactor.callLater(6.5, start_b)

def main():
     reactor.callWhenRunning(running)
     reactor.run()

if __name__=='__main__':
     main()

...shows that, once the &quot;b&quot; iterator is added, each iterator is running 
1/sec, rather than the whole cooperator:

a 1285925864.05 0
a 1285925865.05 1
a 1285925866.05 2
a 1285925867.05 3
a 1285925868.05 4
a 1285925869.05 5 &lt;&lt; running fine 1/sec up until here
b 1285925870.05 0
a 1285925870.55 6 &lt;&lt; now running 2/sec
b 1285925871.05 1
a 1285925871.55 7
b 1285925872.05 2
a 1285925872.55 8
b 1285925873.05 3

I've had a look at the source code, and it looks like the logic should 
cause what I want to happen, but obviously it's not. Version is Twisted 
8.2.0 on python 2.6 (Fedora 12)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="055462.html">[Twisted-Python] Limiting a task.Cooperator to N work units /	sec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55461">[ date ]</a>
              <a href="thread.html#55461">[ thread ]</a>
              <a href="subject.html#55461">[ subject ]</a>
              <a href="author.html#55461">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
