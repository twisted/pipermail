<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] Updated defer.html so that the first 4 examples are runnable, split the 3rd
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20Updated%20defer.html%20so%20that%20the%20first%204%20examples%20are%20runnable%2C%20split%20the%203rd&In-Reply-To=E18rn3o-0008OQ-00%40pyramid.twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003204.html">
   <LINK REL="Next"  HREF="003207.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] Updated defer.html so that the first 4 examples are runnable, split the 3rd</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20Updated%20defer.html%20so%20that%20the%20first%204%20examples%20are%20runnable%2C%20split%20the%203rd&In-Reply-To=E18rn3o-0008OQ-00%40pyramid.twistedmatrix.com"
       TITLE="[Twisted-Python] Re: [Twisted-commits] Updated defer.html so that the first 4 examples are runnable, split the 3rd">andrew-twistedcommits at puzzling.org
       </A><BR>
    <I>Sat Mar  8 20:49:32 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003204.html">[Twisted-Python] updated defer.html in cvs
</A></li>
        <LI>Next message: <A HREF="003207.html">[Twisted-Python] Re: [Twisted-commits] Updated defer.html so	that the first 4 examples are runnable, split the 3rd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3206">[ date ]</a>
              <a href="thread.html#3206">[ thread ]</a>
              <a href="subject.html#3206">[ subject ]</a>
              <a href="author.html#3206">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Mar 08, 2003 at 04:44:56PM -0600, cce CVS wrote:
&gt;<i> Modified files:
</I>&gt;<i> Twisted/doc/howto/defer.html 1.29 1.30
</I>
[..snip..]
&gt;<i> @@ -19,14 +19,22 @@
</I>&gt;<i>  methods where the common idiom is to block until a result is
</I>&gt;<i>  gotten.&lt;/p&gt;
</I>&gt;<i>  &lt;pre class=&quot;python&quot;&gt;
</I>&gt;<i> +
</I>&gt;<i>  class Getter:
</I>&gt;<i>  
</I>&gt;<i>      def getData(self, x):
</I>&gt;<i> -        self.blockUntilResult(x)
</I>&gt;<i> -        return result
</I>&gt;<i> +        return self.someBlockingCall(x)
</I>&gt;<i> +
</I>&gt;<i> +    def someBlockingCall(self,x)
</I>&gt;<i> +        print &quot;blocking&quot;
</I>&gt;<i> +        import time
</I>&gt;<i> +        time.sleep(4)
</I>&gt;<i> +        return x * 3
</I>&gt;<i>  
</I>&gt;<i>  g = Getter()
</I>&gt;<i>  print g.getData(3)
</I>&gt;<i> +print &quot;blocking&quot;
</I>&gt;<i> +
</I>&gt;<i>  &lt;/pre&gt;
</I>
Why does this code snippet now do 'print &quot;blocking&quot;' twice?

&gt;<i>  &lt;h3&gt;Don't Call Us, We'll Call You&lt;/h3&gt;
</I>&gt;<i> @@ -39,29 +47,43 @@
</I>&gt;<i>  understand the necessity for Deferreds.&lt;/p&gt;
</I>&gt;<i>  
</I>&gt;<i>  &lt;pre class=&quot;python&quot;&gt;
</I>&gt;<i> +
</I>&gt;<i>  class Getter:
</I>&gt;<i>  
</I>&gt;<i>      def getData(self, x, callback):
</I>&gt;<i> -        self.callback = callback
</I>&gt;<i> -        # this call does not block, it ensure self.gotResult is called
</I>&gt;<i> -        # when we have the result
</I>&gt;<i> -        self.onResult(x, self.gotResult)
</I>&gt;<i> -    
</I>&gt;<i> -    def gotResult(self, result):
</I>&gt;<i> -        self.callback(result)
</I>&gt;<i> +        self.callback = callback; self.x = x
</I>
Why not two seperate lines here?

&gt;<i> +        self.nonBlockingOperation()
</I>&gt;<i> +        #
</I>&gt;<i> +        # Timer class happens to wrap the previous code in 
</I>&gt;<i> +        # a thread; but this could be any asyncronous operation 
</I>&gt;<i> +        # such as selecting from a socket, etc.
</I>&gt;<i> +        #
</I>&gt;<i> +        from threading import Timer
</I>&gt;<i> +        t = Timer(4, self.gotResult)
</I>&gt;<i> +        t.start()
</I>&gt;<i> +
</I>&gt;<i> +    def nonBlockingOperation(self): 
</I>&gt;<i> +        print &quot;non-blocking&quot;
</I>&gt;<i> +
</I>&gt;<i> +    def gotResult(self):
</I>&gt;<i> +        self.callback(3*self.x)
</I>&gt;<i>  
</I>&gt;<i>  def gotData(d):
</I>&gt;<i>      print d
</I>&gt;<i>  
</I>&gt;<i>  g = Getter()
</I>&gt;<i>  g.getData(3, gotData)
</I>&gt;<i> +
</I>&gt;<i>  &lt;/pre&gt;
</I>
You've sacrificed clarity for runnability.  I'm not sure that's the right
thing to do; the point of this example is now obscured behind details like
how threading.Timer works, and spelling out a dummy &quot;nonBlockingOperation&quot;
method where before it was quite clear without it.  Not all example code
in the Howtos must be immediately executable standalone... I think perhaps
this example code would be better in the doc/examples directory, where it is
more appropriate for examples to be verbose like this.

Also, the way the example used to be reflected an idiomatic use in Twisted:
where there is some event handler, e.g. onResult, fired at an arbitrary time
by some external source.  Think of e.g. Protocol objects with dataReceived.
The example as it was emphasised that Deferreds can apply equally well when
you don't have control over when some event completes -- regardless of
whether it came from a thread, or the network, or anywhere.

&gt;<i>  
</I>&gt;<i> -&lt;p&gt;There are several things missing in this simple example.  There is no way to
</I>&gt;<i> -know if the data never comes back; no mechanism for handling errors.  There is
</I>&gt;<i> -no way to distinguish between different calls to gotData from different
</I>&gt;<i> -sessions.  &lt;code&gt;Deferred&lt;/code&gt; solves these problems, by creating a single,
</I>&gt;<i> -unified way to defer execution of code that depends on blocking calls.&lt;/p&gt;
</I>&gt;<i> +&lt;p&gt;There are several things missing in this simple example.  There is no way
</I>&gt;<i> +to know if the data never comes back; no mechanism for handling errors.  The
</I>&gt;<i> +example does not handle a multiple callback functions, nor does it give a
</I>&gt;<i> +method to merge arguments before and after execution.  Further, there is no
</I>&gt;<i> +way to distinguish between different calls to gotData from different
</I>&gt;<i> +producer objects. &lt;code&gt;Deferred&lt;/code&gt; solves these problems, by creating 
</I>&gt;<i> +a single, unified way to handle callbacks and errors from deferred
</I>&gt;<i> +execution.&lt;/p&gt;
</I>
What does &quot;merge arguments before and after execution&quot; mean to a Twisted
newbie?  Why would they want to do it?

&gt;<i>  
</I>&gt;<i>  &lt;h2&gt;Deferreds&lt;/h2&gt;
</I>&gt;<i>  
</I>&gt;<i> @@ -69,9 +91,45 @@
</I>&gt;<i>  a function will at some point have a result.  We can attach callback functions
</I>&gt;<i>  to a Deferred, and once it gets a result these callbacks will be called. In
</I>&gt;<i>  addition Deferreds allow the developer to register a callback for an error,
</I>&gt;<i> -with the default behavior of logging the error. This is an asynchronous
</I>&gt;<i> -equivalent of the common idiom of blocking until a result is returned or an
</I>&gt;<i> -exception it raised.&lt;/p&gt;
</I>&gt;<i> +with the default behavior of logging the error.  The deferred mechanism 
</I>&gt;<i> +standardizes the application programmer's interface with all sorts of 
</I>&gt;<i> +blocking or delayed operations.&lt;/p&gt;
</I>
That probably should be &quot;*D*eferred&quot;, not &quot;deferred&quot;.  I think I'd also like
to add back the comment about &quot;This is an asynchronous equivalent of ...&quot; --
perhaps it's overly jargonistic, but it is the way I think about Deferreds;
they are the primary tool Twisted provides to abstract away blocking
operations into a fundamentally asynchronous framework.

&gt;<i> @@ -82,39 +140,48 @@
</I>&gt;<i>  to return the result to the HTTP client.&lt;/p&gt;
</I>&gt;<i>  
</I>&gt;<i>  &lt;pre class=&quot;python&quot;&gt;
</I>[..snip..]
&gt;<i>  &lt;/pre&gt;
</I>
Again, with the next two examples I think you've obscured the point in your
efforts to make everything explicit.  I'd rather have a 10 line example
that illustrates a concept, than a 20 line example that obscures the same
concept behind irrelevant method definitions, etc.  On the other hand, I
think long examples, say 50 lines or more, should be runnable, because
anything long enough to require that many lines to explain probably should
be ready for a newbie to play with.  

Informally, I'd say this is the different between &lt;pre class=&quot;python&quot;&gt; and
&lt;a href=... class=&quot;py-listing&quot;&gt; -- when you're listing a file, it *should*
be a complete, runnable example.  In fact, complete, runnable examples
probably should be a listing for the reader's convenience, i.e. put the code
in doc/listings somewhere, rather that in the .html file.

Please don't be discouraged from working on the docs!  They *do* need
work... I just happen to think that defer.html is probably the doc least in
need of improvement :)

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003204.html">[Twisted-Python] updated defer.html in cvs
</A></li>
	<LI>Next message: <A HREF="003207.html">[Twisted-Python] Re: [Twisted-commits] Updated defer.html so	that the first 4 examples are runnable, split the 3rd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3206">[ date ]</a>
              <a href="thread.html#3206">[ thread ]</a>
              <a href="subject.html#3206">[ subject ]</a>
              <a href="author.html#3206">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
