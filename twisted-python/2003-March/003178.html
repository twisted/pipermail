<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Thoughts on Deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Thoughts%20on%20Deferred&In-Reply-To=20030306060223.GA66896%40doublegemini.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003174.html">
   <LINK REL="Next"  HREF="003181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Thoughts on Deferred</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Thoughts%20on%20Deferred&In-Reply-To=20030306060223.GA66896%40doublegemini.com"
       TITLE="[Twisted-Python] Thoughts on Deferred">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Mar  6 06:34:29 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003174.html">[Twisted-Python] Thoughts on Producer / Consumer
</A></li>
        <LI>Next message: <A HREF="003181.html">[Twisted-Python] Thoughts on Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3178">[ date ]</a>
              <a href="thread.html#3178">[ thread ]</a>
              <a href="subject.html#3178">[ subject ]</a>
              <a href="author.html#3178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Thursday, March 6, 2003, at 12:02 AM, Clark C. Evans wrote:

&gt;<i>   1.  The entire deferred processing chain is quite nice,
</I>&gt;<i>       although the bulk of the time my callbacks don't take
</I>&gt;<i>       any arguments.  I suspect that most people who do have
</I>&gt;<i>       callback args can just make an object and pass a bound
</I>&gt;<i>       method as their callback instead of the 'args' mechanism.
</I>
Interesting idea, but I'm not sure about it yet.  Need to think it over.

&gt;<i>   2.  The error handling could use help.
</I>
You don't seem to understand it completely.  See itamar's post.

&gt;<i>   3.  Deferred also &quot;artifically limits&quot; so that the entire callback
</I>&gt;<i>       tree can only be done once.   This involves a hack 
</I>&gt;<i> &quot;MultiDeferred&quot;
</I>&gt;<i>       to solve the problem; but with a slightly different _runCallbacks
</I>&gt;<i>       plus a __init__ flag, this need not be the case.
</I>
If you actually try this and figure out how to get it work with the 
cases that Deferreds are used, I would be interested in seeing it, 
since this is a common criticism.  However, Deferreds are not event 
broadcasters, they are deferred results, and requests that are made 
once should only be answered once.  The following behavior, for example:

	d = Deferred()
	d.addCallback(foo)
	d.callback(bar)
	d.addCallback(baz)

only calls 'foo' and 'baz' once, which makes perfect sense: each 
callback is called as soon as possible with the result at that point in 
the chain.

In a &quot;multi-&quot;deferred case, though, what happens?  We add another 
'd.callback(boz)' to the end.  Then what?  does 'foo' get called once 
and 'baz' get called once?  'foo' called twice and 'baz' called once?  
'foo' and 'baz' both called twice with foo and with bar?

This makes callback execution highly dependent upon the order in which 
callbacks are registered.  Some other, similar callback abstraction 
mechanism might be useful here, but the semantics of deferreds would 
become pretty badly polluted to add something which _does_ depend on 
timing of the '.callback' method, where Deferreds have spent so much 
energy trying to get away from caring about that order.  Having to care 
about this on a regular basis smacks of the same sort of mandatory 
awareness of order-of-execution that thread programming brings.

&gt;<i>   4.  Lastly, I'd like to see other &quot;state&quot; variables for the deferred.
</I>&gt;<i>       Essentially, what I see is a process flow, aka state transition
</I>&gt;<i>       mechnanism emerging.   For an SQL query, one of the states
</I>&gt;<i>       is 'good', 'bad', and 'finished'.  Perhaps I'm a bit off here,
</I>&gt;<i>       but being able to handle more than two states could be useful.
</I>
This is why the Failure object has an exception type.  See the trap 
method.  For things that aren't errors you should be able to 
encapsulate that state information in the result.

More than two states smells like overengineering to me.  Does anyone 
else need this?

&gt;<i> Just some thoughts.  If you like, I could refactor the Deferred
</I>&gt;<i> object as above (it'd be less code &amp; probably cleaner), as well
</I>&gt;<i> as updating the documentation and providing examples which run
</I>&gt;<i> without modification.
</I>
Regardless of my criticisms I'd like to see you mail a patch to the 
list, so that I can comment on it more specifically.  Especially the 
first point: some more examples of how that would work would be helpful.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (Darwin)

iD8DBQE+ZzJJvVGR4uSOE2wRAvg8AKCEUUK4FvoOoTQzm3a2dUAVfLZCfACePMRW
ENuwW/CTSXdtI3H/GeHt/cY=
=O01d
-----END PGP SIGNATURE-----



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003174.html">[Twisted-Python] Thoughts on Producer / Consumer
</A></li>
	<LI>Next message: <A HREF="003181.html">[Twisted-Python] Thoughts on Deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3178">[ date ]</a>
              <a href="thread.html#3178">[ thread ]</a>
              <a href="subject.html#3178">[ subject ]</a>
              <a href="author.html#3178">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
