<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Thoughts on Deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Thoughts%20on%20Deferred&In-Reply-To=%3C20030306150325.GB68231%40doublegemini.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="035686.html">
   <LINK REL="Next"  HREF="035681.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Thoughts on Deferred</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Thoughts%20on%20Deferred&In-Reply-To=%3C20030306150325.GB68231%40doublegemini.com%3E"
       TITLE="[Twisted-Python] Thoughts on Deferred">cce at clarkevans.com
       </A><BR>
    <I>Thu Mar  6 08:03:25 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="035686.html">[Twisted-Python] Thoughts on Deferred
</A></li>
        <LI>Next message (by thread): <A HREF="035681.html">[Twisted-Python] Twisted.Web as scgi client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35689">[ date ]</a>
              <a href="thread.html#35689">[ thread ]</a>
              <a href="subject.html#35689">[ subject ]</a>
              <a href="author.html#35689">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Mar 06, 2003 at 05:34:29AM -0600, Glyph Lefkowitz wrote:
|<i> On Thursday, March 6, 2003, at 12:02 AM, Clark C. Evans wrote:
</I>|<i> &gt;  1.  The entire deferred processing chain is quite nice,
</I>|<i> &gt;      although the bulk of the time my callbacks don't take
</I>|<i> &gt;      any arguments.  I suspect that most people who do have
</I>|<i> &gt;      callback args can just make an object and pass a bound
</I>|<i> &gt;      method as their callback instead of the 'args' mechanism.
</I>|<i> 
</I>|<i> Interesting idea, but I'm not sure about it yet.  Need to think it over.
</I>
Ok.  I'll post a patch for approval.

|<i> &gt;  2.  The error handling could use help.
</I>|<i> 
</I>|<i> You don't seem to understand it completely.  See itamar's post.
</I>
I think I was proposing an functionally equivalent option to
the current implementation.  After some thought, there really
isn't an advantage either way, although your implementation
could be ever-so-slightly-faster.   Let's drop this one.

|<i> &gt;  3.  Deferred also &quot;artifically limits&quot; so that the entire callback
</I>|<i> &gt;      tree can only be done once.   This involves a hack 
</I>|<i> &gt;&quot;MultiDeferred&quot;
</I>|<i> &gt;      to solve the problem; but with a slightly different _runCallbacks
</I>|<i> &gt;      plus a __init__ flag, this need not be the case.
</I>|<i> 
</I>|<i> If you actually try this and figure out how to get it work with the 
</I>|<i> cases that Deferreds are used, I would be interested in seeing it, 
</I>|<i> since this is a common criticism.  However, Deferreds are not event 
</I>|<i> broadcasters, they are deferred results, and requests that are made 
</I>|<i> once should only be answered once.
</I>
Yes, this just doesn't fit since I want to provide for &quot;partial&quot; 
results along the way; aka a database query or a fragment of 
a file, etc.   

|<i>  The following behavior, for example:
</I>|<i> 
</I>|<i> 	d = Deferred()
</I>|<i> 	d.addCallback(foo)
</I>|<i> 	d.callback(bar)
</I>|<i> 	d.addCallback(baz)
</I>
Is this common?  

I think in a multi-result case, you can't add additional 
callbacks once 'callback' has been invoked; this restriction
is needed since you don't want to cache every value 
just-in-case another callback would be added later.

|<i> only calls 'foo' and 'baz' once, which makes perfect sense: each 
</I>|<i> callback is called as soon as possible with the result at that point in 
</I>|<i> the chain.
</I>
Right; and any modifications would maintain the current behavior.  The
implementation path would add an additional flag to Deferred to indicate
if it was a multi-result thingy.   I'm still trying to figure out how
to send a 'finished' message down the chain.  I think this is somewhat
related to consumer/producer as well... a bit more thought is needed.

|<i> In a &quot;multi-&quot;deferred case, though, what happens?  We add another 
</I>|<i> 'd.callback(boz)' to the end.  Then what?  does 'foo' get called once 
</I>|<i> and 'baz' get called once?  'foo' called twice and 'baz' called once?  
</I>|<i> 'foo' and 'baz' both called twice with foo and with bar?
</I>
You'd have one more call of 'foo' and 'bar', 'foo' passed 'boz', 
assuming that the callback(bar) happened after addCallback(baz).
I can't see how you'd make it work otherwise, beacuse you don't
really want to cache the value.

|<i> This makes callback execution highly dependent upon the order in which 
</I>|<i> callbacks are registered.
</I>
It is already hightly dependent on this... addCallback(foo) followed
by addCallback(bar) is very different than addCallback(bar) followed
by addCallback(foo).  ;)

|<i> Having to care about this on a regular basis smacks of the same 
</I>|<i> sort of mandatory awareness of order-of-execution that thread
</I>|<i> programming brings.
</I>
Agreed.  So you probably could'nt support the full semantics, i.e.,
the call chain would be much less dynamic.

|<i> &gt;  4.  Lastly, I'd like to see other &quot;state&quot; variables for the deferred.
</I>|<i> &gt;      Essentially, what I see is a process flow, aka state transition
</I>|<i> &gt;      mechnanism emerging.   For an SQL query, one of the states
</I>|<i> &gt;      is 'good', 'bad', and 'finished'.  Perhaps I'm a bit off here,
</I>|<i> &gt;      but being able to handle more than two states could be useful.
</I>|<i> 
</I>|<i> This is why the Failure object has an exception type.  See the trap 
</I>|<i> method.  For things that aren't errors you should be able to 
</I>|<i> encapsulate that state information in the result.
</I>
Ok.  I was just trying to differentate between a 'chunk' notify
and a finish message.  Probably this is another difference 
between the two Deferred and MultiDeferred.  Perhaps they should
stay distinct then.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="035686.html">[Twisted-Python] Thoughts on Deferred
</A></li>
	<LI>Next message (by thread): <A HREF="035681.html">[Twisted-Python] Twisted.Web as scgi client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35689">[ date ]</a>
              <a href="thread.html#35689">[ thread ]</a>
              <a href="subject.html#35689">[ subject ]</a>
              <a href="author.html#35689">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
