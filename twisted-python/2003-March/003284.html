<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] defer.AlreadyCalled error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20defer.AlreadyCalled%20error&In-Reply-To=15242461005.20030314090637%40uch.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003277.html">
   <LINK REL="Next"  HREF="003278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] defer.AlreadyCalled error</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20defer.AlreadyCalled%20error&In-Reply-To=15242461005.20030314090637%40uch.net"
       TITLE="[Twisted-Python] defer.AlreadyCalled error">andrew-twisted at puzzling.org
       </A><BR>
    <I>Fri Mar 14 20:29:54 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003277.html">[Twisted-Python] defer.AlreadyCalled error
</A></li>
        <LI>Next message: <A HREF="003278.html">[Twisted-Python] EuroPython 2003
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3284">[ date ]</a>
              <a href="thread.html#3284">[ thread ]</a>
              <a href="subject.html#3284">[ subject ]</a>
              <a href="author.html#3284">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Mar 14, 2003 at 09:06:37AM +0200, Dmitry Litovchenko wrote:
&gt;<i> Hello, all
</I>&gt;<i> 
</I>&gt;<i> Using my handcrafted socks5 client I've got the situation where my
</I>&gt;<i> ClientFactory.clientConnectionLost and clientConnectionFailed get
</I>&gt;<i> execution after errback is already called, so I get
</I>&gt;<i> defer.AlreadyCalled error.
</I>&gt;<i> 
</I>&gt;<i> The fastest thing that solves it was try/except with raising error
</I>&gt;<i> again if its not AlreadyCalled.
</I>&gt;<i> 
</I>&gt;<i> Is this solution correct or I should inherit some another method of
</I>&gt;<i> ClientFactory or ClientProtocol to intercept this situation before its
</I>&gt;<i> AlreadyCalled.
</I>
Your solution is fine.

I can think of another approach though, that is almost certainly too complex
and overkill for your problem, just in case you are interested:

Perhaps you could use a DeferredList instead, with fireOnOneCallback=1 (so
that results get passed immediately) and fireOnOneErrback=1 (so that errors
happen immediately).  

So what you'd do is create a DeferredList with two Deferreds:
  1. the Deferred you are using already
  2. a new Deferred that clientConnectionLost/Failed will call

Then add your callbacks and errbacks to the DeferredList instead of the
original Deferred.  DeferredList with fireOnOneErrback=1 will call its
errbacks as soon as any of its Deferreds errback, but won't raise
AlreadyCalled error no matter how many of its Deferreds errback.

The reason for also setting fireOnOneCallback=1 is to ensure that the
DeferredList doesn't wait for the second Deferred to callback, which should
never happen.

Basically, a DeferredList([...], fireOnOneCallback=1, fireOnOneErrback=1)
has the odd behaviour of effectively taking the first result (good or bad)
to arrive, and ignoring the rest.

In short, I think you're better off with the try/except :)

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003277.html">[Twisted-Python] defer.AlreadyCalled error
</A></li>
	<LI>Next message: <A HREF="003278.html">[Twisted-Python] EuroPython 2003
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3284">[ date ]</a>
              <a href="thread.html#3284">[ thread ]</a>
              <a href="subject.html#3284">[ subject ]</a>
              <a href="author.html#3284">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
