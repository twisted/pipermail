<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Redirecting after form completion using woven
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Redirecting%20after%20form%20completion%20using%20woven&In-Reply-To=20030314152352.GA90615%40mithrandr.moria.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003281.html">
   <LINK REL="Next"  HREF="003286.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Redirecting after form completion using woven</H1>
    <B>Donovan Preston</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Redirecting%20after%20form%20completion%20using%20woven&In-Reply-To=20030314152352.GA90615%40mithrandr.moria.org"
       TITLE="[Twisted-Python] Redirecting after form completion using woven">dp at twistedmatrix.com
       </A><BR>
    <I>Fri Mar  7 13:35:18 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003281.html">[Twisted-Python] Redirecting after form completion using woven
</A></li>
        <LI>Next message: <A HREF="003286.html">[Twisted-Python] Need a mother?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3283">[ date ]</a>
              <a href="thread.html#3283">[ thread ]</a>
              <a href="subject.html#3283">[ subject ]</a>
              <a href="author.html#3283">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Friday, March 14, 2003, at 07:23 AM, Neil Blakey-Milner wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Two things:
</I>&gt;<i>
</I>&gt;<i> Firstly, using Twisted 1.0.3, when form submissions has occurred, it
</I>&gt;<i> seems that the getData to build the form is done before the setData to
</I>&gt;<i> make the changes.  This means that the _old_ information is in the
</I>&gt;<i> forms, which is somewhat confusing.  For an example, use stikiwiki and
</I>&gt;<i> edit a page.  It's entirely possible I'm using things incorrectly,
</I>&gt;<i> though.
</I>
Here is what is happening: Since the views and controllers are 
triggered by traversing the DOM tree, if the view is above the 
controller, the view will render with the old data before the 
controller gets a chance to update the model with the new data. There 
are a couple of solutions, and the redirect is the best solution for 
you.

1) Redirect the user after a successful controller commit, either to 
the same page, or a different page. This causes the page to get 
rerendered, and the new data will be available.

2) Notify the model that it's data has changed. The model will pass the 
notification on to the views which rely on the data, and the views will 
rerender themselves. There is an example of this technique in 
NewReality, and also in the unittests for woven.

&gt;<i>
</I>&gt;<i> Secondly, how would I organise for a redirect to another page after my
</I>&gt;<i> form has been parsed and data handled with setData?  Again, stikiwiki
</I>&gt;<i> probably wants to redirect people to the page they've just edited or
</I>&gt;<i> created instead of giving them an opportunity to edit it again.
</I>
Here's some code I use to do redirects; you can modify it for your 
needs. The only issue then is calling this code when the controller 
commits; if you're using input.Anything, you don't really have control 
over what happens when the controller gets some data and calls setData. 
I'll reread your code and come up with a suggestion.

def redirectToParent(request, now=1):
     &quot;&quot;&quot;Redirect the current request to the immediate parent URL of the
     current request URL. Useful for redirecting from a tab URL to the
     main tab.
     &quot;&quot;&quot;
     parent = request.pathRef().parentRef()
     method, host, port = request.getHost()
     url = &quot;http%<A HREF="s://%s%s/%s/&quot;">s://%s%s/%s/&quot;</A> % (method is 'SSL' and 's' or '',
         getattr(request.site, 'serverName', host),
         getattr(request.site, 'serverPort', port) is 80 and '' or ':' + 
str(port),
             '/'.join(parent.path))
     if now:
         request.redirect(url)
     return url


&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Neil
</I>&gt;<i> -- 
</I>&gt;<i> Neil Blakey-Milner
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nbm at mithrandr.moria.org</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/enriched
Size: 3709 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030307/960552ce/attachment.bin">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030307/960552ce/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003281.html">[Twisted-Python] Redirecting after form completion using woven
</A></li>
	<LI>Next message: <A HREF="003286.html">[Twisted-Python] Need a mother?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3283">[ date ]</a>
              <a href="thread.html#3283">[ thread ]</a>
              <a href="subject.html#3283">[ subject ]</a>
              <a href="author.html#3283">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
