<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] runQuery isolation patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20runQuery%20isolation%20patch&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003173.html">
   <LINK REL="Next"  HREF="003180.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] runQuery isolation patch</H1>
    <B>Federico Di Gregorio</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20runQuery%20isolation%20patch&In-Reply-To="
       TITLE="[Twisted-Python] runQuery isolation patch">fog at initd.org
       </A><BR>
    <I>Thu Mar  6 06:50:06 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003173.html">[Twisted-Python] Twisted.Web as scgi client
</A></li>
        <LI>Next message: <A HREF="003180.html">[Twisted-Python] PATCH: runQuery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3179">[ date ]</a>
              <a href="thread.html#3179">[ thread ]</a>
              <a href="subject.html#3179">[ subject ]</a>
              <a href="author.html#3179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>runQuery has a problem when used with databases with transactions and
high isolation levels (like postgresql+psycopg): it never closes the
transaction leaving threads using that connection from the pool
completely isolated from changes to the database. the solution is to
call rollback() on the connection just after the query has been
executed.

simple patch follows:

--- adbapi.py-old       2003-03-06 12:48:02.000000000 +0100
+++ adbapi.py   2003-03-06 12:49:01.000000000 +0100
@@ -97,6 +97,7 @@
         apply(curs.execute, args, kw)
         result = curs.fetchall()
         curs.close()
+       conn.rollback()
         return result
  
     def _runOperation(self, args, kw):

-- 
Federico Di Gregorio
Debian GNU/Linux Developer                                <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fog at debian.org</A>
INIT.D Developer                                           <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">fog at initd.org</A>
  Gli esseri umani, a volte, sono destinati, per il solo fatto di
   esistere, a fare del male a qualcuno.              -- Haruki Murakami
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030306/35099af2/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030306/35099af2/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003173.html">[Twisted-Python] Twisted.Web as scgi client
</A></li>
	<LI>Next message: <A HREF="003180.html">[Twisted-Python] PATCH: runQuery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3179">[ date ]</a>
              <a href="thread.html#3179">[ thread ]</a>
              <a href="subject.html#3179">[ subject ]</a>
              <a href="author.html#3179">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
