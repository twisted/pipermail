<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] supporting start/stop/restart behavior
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20supporting%20start/stop/restart%20behavior&In-Reply-To=%3C20030320071832.GA30645%40doublegemini.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="035827.html">
   <LINK REL="Next"  HREF="035833.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] supporting start/stop/restart behavior</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20supporting%20start/stop/restart%20behavior&In-Reply-To=%3C20030320071832.GA30645%40doublegemini.com%3E"
       TITLE="[Twisted-Python] supporting start/stop/restart behavior">cce at clarkevans.com
       </A><BR>
    <I>Thu Mar 20 00:18:32 MST 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="035827.html">[Twisted-Python] supporting start/stop/restart behavior
</A></li>
        <LI>Next message (by thread): <A HREF="035833.html">[Twisted-Python] supporting start/stop/restart behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35828">[ date ]</a>
              <a href="thread.html#35828">[ thread ]</a>
              <a href="subject.html#35828">[ subject ]</a>
              <a href="author.html#35828">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph,

Thanks for responding, I know you're quite busy before PyCon.

On Wed, Mar 19, 2003 at 11:35:39PM -0600, Glyph Lefkowitz wrote:
|<i> &gt;... what [Twisted] misses, IMHO, is a simple interface to stop and 
</I>|<i> &gt;restart.
</I>|<i> 
</I>|<i> You're right, but this is the wrong way to go about fixing it.
</I>
Ok. 

|<i> &gt;  1. Refactoring runApp to remove a hunk of code which
</I>|<i> &gt;     runs os.kill on a pid found in the given pidfile.
</I>|<i> &gt;     This is moved to another function, killApp, which
</I>|<i> &gt;     takes two arguments, config and signal.   From the
</I>|<i> &gt;     runApp the code then calls killApp(config, signal=0)
</I>|<i> 
</I>|<i> Currently, that code is there _only_ to determine, in a rather 
</I>|<i> platform-specific way, whether the server should attempt to keep 
</I>|<i> starting or not.  It's not a generalized stop-the-application.
</I>
If twistd adds (in a &quot;rather platform-specific&quot; way) support for 
stop and restart, then I'm sure platform-specific linkages can be
added later on; for example doing NT based service API calls
instead of fork / pidfiles / signals.

|<i> &gt;     c.  if stop or restart are chosen, then this kills the
</I>|<i> &gt;         current process using the given pidfile (which defaults
</I>|<i> &gt;         to twistd.pid in the current directory) through
</I>|<i> &gt;         killApp(signal=SIGTERM)
</I>|<i> 
</I>|<i> Why put this into Twisted where we have to swaddle it in a layer of 
</I>|<i> cross-platform compatibility rather than just letting the user use 
</I>|<i> whatever tools are available on their system for interacting with 
</I>|<i> Twisted?
</I>
Why not?  With twistd, Twisted is taking on responsibility for
'starting' an application, shouldn't it finish the job with
stop and restart?

|<i> So you are trying to solve a documentation problem by adding 
</I>|<i> functionality to a different place, necessitating more documentation? 
</I>
Got me.  ;)

|<i> We write these frameworks in Python, but I agree with this point: 
</I>|<i> none of this daemon/logging/startup/shutdown behavior needs to 
</I>|<i> be in an application.
</I>
Cool.  Does it belong in a framework?   If not, where?

|<i> My view on functionality like this is that it is a platform-specific 
</I>|<i> thing.  Even assuming that signals worked like you expect them to 
</I>|<i> across all platforms that we are trying to support, there are other 
</I>|<i> issues.  What about the cultural expectation of command lines?  On 
</I>|<i> win32, the way Python programs are run isn't very natural.  On the 
</I>|<i> command line, the location of the .exe is significant, there's no such 
</I>|<i> thing as a shebang line, and users aren't accustomed to running 
</I>|<i> interpreters on scripts.  They expect to have an icon to click on, 
</I>|<i> usually a Service.  There are also differing cultural expectations of 
</I>|<i> how you run stuff like this on MacOS.  Does the start/stop thing have a 
</I>|<i> GUI?  A monitoring icon in the dock?
</I>|<i> 
</I>|<i> Now, we don't *currently* have functionality like that, but we hope to 
</I>|<i> one day.  I am beginning to despair of ever actually achieving that 
</I>|<i> goal, though, since nobody who understands it has time, and so many 
</I>|<i> other programmers have habits that are opposed to this approach...
</I>
All of this is great.  But I've got many applications that I am
writing, and would like to write; and I'd like a nice way to 
start, stop, and restart my twisted daemons.  Currently, &quot;twistd&quot; 
seems to be the preferred command line approach.

|<i> Supporting mechanisms in the framework that make configuration and 
</I>|<i> introspection impossible without editing the start-up code for your 
</I>|<i> particular application would make this eventual goal even more 
</I>|<i> difficult than it already is.
</I>|<i> 
</I>|<i> Components written for twisted should be written in such a way that 
</I>|<i> they can be loaded into existing applications without running a script. 
</I>
Uncle! Uncle!  Ok.  Ok.  '__main__' == __name__ is bad.

|<i> If you want to improve twistd, please feel free to suggest ways that 
</I>|<i> stopping/restarting could be made easier or even more consistent across 
</I>|<i> platforms.  For example, &quot;killApp&quot; might make sense if, on 
</I>|<i> signals-challenged platforms, twistd automatically opened a 
</I>|<i> localhost-only socket which allowed communication with the server.
</I>
Ok.  Could we add to twistd 'start', 'stop' and 'restart' sub-commands,
with 'start' being the default.  For now, we implement stop with kill
signals.  When we get time we refactor the whole start/stop/restart code
so that it uses a 'Process' object that is platform specific.   The
process object has 'start', 'stop', and 'restart' methods, and it has
two or more implementations, including, but not limited to a
UnixProcess, which uses kill/signals/pidfile, and a NT Process, which
uses NT services, etc.

As for GUIs.  What would be useful is one more sub-command, 'query'.
Which returns a status of the given process, 'starting', 'stopping',
'running', 'restarting', 'stopped'.  With those in place, I'm sure
someone could write a nice cross-platform wxWindows viewer which calls
twistd to check the status of various processes, etc.  We'd probably
at that point also have to start thinking about registry entries,
i.e. configuration settings (Coca?).

Best,

Clark


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="035827.html">[Twisted-Python] supporting start/stop/restart behavior
</A></li>
	<LI>Next message (by thread): <A HREF="035833.html">[Twisted-Python] supporting start/stop/restart behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35828">[ date ]</a>
              <a href="thread.html#35828">[ thread ]</a>
              <a href="subject.html#35828">[ subject ]</a>
              <a href="author.html#35828">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
