<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] finding out what's blocking the reactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20finding%20out%20what%27s%20blocking%20the%20reactor&In-Reply-To=%3Cd848cd86-9acb-4162-2e63-bddd5a946016%40thieprojects.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064766.html">
   <LINK REL="Next"  HREF="064769.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] finding out what's blocking the reactor</H1>
    <B>Werner Thie</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20finding%20out%20what%27s%20blocking%20the%20reactor&In-Reply-To=%3Cd848cd86-9acb-4162-2e63-bddd5a946016%40thieprojects.ch%3E"
       TITLE="[Twisted-Python] finding out what's blocking the reactor">werner at thieprojects.ch
       </A><BR>
    <I>Tue May 14 15:14:51 MDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064766.html">[Twisted-Python] finding out what's blocking the reactor
</A></li>
        <LI>Next message (by thread): <A HREF="064769.html">[Twisted-Python] finding out what's blocking the reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64767">[ date ]</a>
              <a href="thread.html#64767">[ thread ]</a>
              <a href="subject.html#64767">[ subject ]</a>
              <a href="author.html#64767">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all

with periods of seemingly no activity the gc comes to mind.

Is the working set size stable or ever increasing, swap operations might
block activity of the process

I had problems in the beginning with twisted, because I was holding on
to a lot of objects and thus creatingÂ  circular non collectible object
references leading to ever increasing work sets over time, with the gc
hitting me hard once in a while.

First check I do always is keep an eye on the size of the process at
constant network load, size shrinking when network load is dwindling and
increasing when network load is growing. If it is possible to manipulate
network load precisely then returning to the same load should give you
the same process size after some time repeatedly.

As a reference I have twisted processes running with up times measured
in years on FreeBSD.

Werner

On 5/14/19 05:39, Scott, Barry wrote:
&gt;<i> On Monday, 13 May 2019 15:26:01 BST Chris Withers wrote:
</I>&gt;&gt;<i> Hi All,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On some busy instances of the app I'm working with/on, we see websocket
</I>&gt;&gt;<i> connections being dropped due to not ping/ponging in time, I'm fairly
</I>&gt;&gt;<i> sure this is as a result of some user-written callbacks blocking the
</I>&gt;&gt;<i> reactor for long periods of time (seconds...).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What's the best way to debug a twisted application to find out what's
</I>&gt;&gt;<i> blocking the reactor?
</I>&gt;<i> Is the process CPU bound or IO bound?
</I>&gt;<i>
</I>&gt;<i> If CPU bound then cprofile or the tool Glyph mentioned would help.
</I>&gt;<i>
</I>&gt;<i> This advice is from a Linux perspective.
</I>&gt;<i>
</I>&gt;<i> If its IO bound the you may be waiting on a blocking operation.
</I>&gt;<i> You could use strace on the process to see what its doing.
</I>&gt;<i>
</I>&gt;<i> As its hung for seconds you could connect gdb to the process and see a python 
</I>&gt;<i> backtrace using the py-bt command. You are likely to catch the offending code.
</I>&gt;<i>
</I>&gt;<i> The normal bt command will show you what the last python command it calling.
</I>&gt;<i>
</I>&gt;<i> You could adding logging to your code to show the time of callback entry and 
</I>&gt;<i> exit.
</I>&gt;<i>
</I>&gt;<i> If all else fails patch the twisted code to time callbacks and report the slow 
</I>&gt;<i> ones.
</I>&gt;<i>
</I>&gt;<i> Barry
</I>&gt;<i>
</I>&gt;&gt;<i> cheers,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Chris
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064766.html">[Twisted-Python] finding out what's blocking the reactor
</A></li>
	<LI>Next message (by thread): <A HREF="064769.html">[Twisted-Python] finding out what's blocking the reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64767">[ date ]</a>
              <a href="thread.html#64767">[ thread ]</a>
              <a href="subject.html#64767">[ subject ]</a>
              <a href="author.html#64767">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
