<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] finding out what's blocking the reactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20finding%20out%20what%27s%20blocking%20the%20reactor&In-Reply-To=%3C119843095.qYWDFDJFEp%40barry-scott-desktop%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064770.html">
   <LINK REL="Next"  HREF="064768.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] finding out what's blocking the reactor</H1>
    <B>Scott, Barry</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20finding%20out%20what%27s%20blocking%20the%20reactor&In-Reply-To=%3C119843095.qYWDFDJFEp%40barry-scott-desktop%3E"
       TITLE="[Twisted-Python] finding out what's blocking the reactor">barry.scott at forcepoint.com
       </A><BR>
    <I>Wed May 15 05:08:52 MDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064770.html">[Twisted-Python] finding out what's blocking the reactor
</A></li>
        <LI>Next message (by thread): <A HREF="064768.html">[Twisted-Python] finding out what's blocking the reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64772">[ date ]</a>
              <a href="thread.html#64772">[ thread ]</a>
              <a href="subject.html#64772">[ subject ]</a>
              <a href="author.html#64772">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wednesday, 15 May 2019 06:27:30 BST Chris Withers wrote:
&gt;<i> On 14/05/2019 16:39, Scott, Barry wrote:
</I>&gt;<i> &gt; On Monday, 13 May 2019 15:26:01 BST Chris Withers wrote:
</I>&gt;<i> &gt;&gt; Hi All,
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; On some busy instances of the app I'm working with/on, we see websocket
</I>&gt;<i> &gt;&gt; connections being dropped due to not ping/ponging in time, I'm fairly
</I>&gt;<i> &gt;&gt; sure this is as a result of some user-written callbacks blocking the
</I>&gt;<i> &gt;&gt; reactor for long periods of time (seconds...).
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; What's the best way to debug a twisted application to find out what's
</I>&gt;<i> &gt;&gt; blocking the reactor?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Is the process CPU bound or IO bound?
</I>&gt;<i> 
</I>&gt;<i> Yes ;-)
</I>&gt;<i> 
</I>&gt;<i> &gt; If CPU bound then cprofile or the tool Glyph mentioned would help.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This advice is from a Linux perspective.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If its IO bound the you may be waiting on a blocking operation.
</I>&gt;<i> &gt; You could use strace on the process to see what its doing.
</I>&gt;<i> 
</I>&gt;<i> Good call on strace, will do so next time one of these happens.
</I>&gt;<i> 
</I>&gt;<i> &gt; As its hung for seconds you could connect gdb to the process and see a
</I>&gt;<i> &gt; python backtrace using the py-bt command. You are likely to catch the
</I>&gt;<i> &gt; offending code.
</I>&gt;<i> I'm failing miserably to get gdb to find debug symbols for python. I've
</I>&gt;<i> installed the system python's debug symbols rpm, I've installed gdb .py
</I>&gt;<i> that ships in the python source tree (so at least I *have* a py-bt
</I>&gt;<i> command now!) - what am I likely to be missing?
</I>
At least on Fedora/Centos when you run up gdb you get a message that tells
you the the command to run to install missing symbols. This is what I see on
Fedora 30 for example:

$ gdb python3
GNU gdb (GDB) Fedora 8.2.91.20190424-24.fc30
... skip ...
For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
Reading symbols from python3...
(No debugging symbols found in python3)
Missing separate debuginfos, use: dnf debuginfo-install 
python3-3.7.3-1.fc30.x86_64
(gdb) 

Then I quit gdb and run the sudo dnf as suggested.

Then next time you run gdb it will suggest even mode debug info to install.
You can often skip that, you have all you need to see python code.

&gt;<i> &gt; You could adding logging to your code to show the time of callback entry
</I>&gt;<i> &gt; and exit.
</I>&gt;<i> 
</I>&gt;<i> Right, but if the callback yields, that will be falsely shown as
</I>&gt;<i> blocking, no?
</I>
I'm not used to using yield with twisted. But it will not block.

&gt;<i> 
</I>&gt;<i> cheers,
</I>&gt;<i> 
</I>&gt;<i> Chris
</I>




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064770.html">[Twisted-Python] finding out what's blocking the reactor
</A></li>
	<LI>Next message (by thread): <A HREF="064768.html">[Twisted-Python] finding out what's blocking the reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64772">[ date ]</a>
              <a href="thread.html#64772">[ thread ]</a>
              <a href="subject.html#64772">[ subject ]</a>
              <a href="author.html#64772">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
