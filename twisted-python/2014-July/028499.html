<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Request.getClient
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Request.getClient&In-Reply-To=%3CE2F94EEA-DA64-4FE3-8A54-5382102304CF%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028498.html">
   <LINK REL="Next"  HREF="028500.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Request.getClient</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Request.getClient&In-Reply-To=%3CE2F94EEA-DA64-4FE3-8A54-5382102304CF%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Request.getClient">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Jul  2 15:02:45 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028498.html">[Twisted-Python] Request.getClient
</A></li>
        <LI>Next message: <A HREF="028500.html">[Twisted-Python] Request.getClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28499">[ date ]</a>
              <a href="thread.html#28499">[ thread ]</a>
              <a href="subject.html#28499">[ subject ]</a>
              <a href="author.html#28499">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jul 2, 2014, at 9:26 AM, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:

&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> twisted.web.http.Request.getClient has a terrible implementation.  It does blocking network I/O (DNS).  Fortunately it is only used in one place in Twisted - the CGI implementation.  Unfortunately this makes the CGI implementation somewhat unsuited for real-world use.
</I>&gt;<i> 
</I>&gt;<i> `Request.getClient` has always been allowed to return `None` under certain circumstances.  I propose making it always return `None` and deprecating it.
</I>&gt;<i> 
</I>&gt;<i> This is implemented in the branch linked to &lt;<A HREF="https://tm.tl/2252">https://tm.tl/2252</A>&gt;.
</I>&gt;<i> 
</I>&gt;<i> Chris Armstrong suggested that this change might not be strictly keeping with our backwards compatibility policy.
</I>
I agree that this is a troubling area but in general I tend to believe that changes like this are in keeping with our compatibility policy.  Changing the signature or the allowed return type of a value (&quot;type&quot; speaking in terms of public features of its interface) should not be allowed.  If we already returned None sometimes, then a correct program would already have to deal with None sometimes, so making this change wouldn't break it, per se.

Bringing up such a change on the list is always a good policy, since it gives people a chance to audit their code and look for places where they might have been depending too intimately on accidental features, so by no means take my belief that this is in-policy to mean that we shouldn't broadly discuss changes like this in the future :-).  Real, actual, broken code is what the policy strives to prevent, so real world code that broke should usually take precedence.

&gt;<i> I suggest that either it is - because `None` was always a possible return value - or that removing the possibility of blocking I/O from applications that are mistakenly using this API makes it worth the not- strictly-compatible change.
</I>&gt;<i> 
</I>&gt;<i> A minor adjustment might be to make it always return the IP address instead, as this was another behavior it previously had.
</I>
I think that this adjustment is the best option.  IP addresses are mostly interchangeable with hostnames, so during the transition period while it's being deprecated, even an application relying on this API heavily would at least have an opportunity to keep functionality equivalent during an upgrade.  Making it always return None means that a correct application (one which dealt with the None return value), while not becoming crash-with-an-exception buggy, might lose functionality (logging a source IP of &quot;None&quot; all the time, for example, and losing track of an audit log of who is making what changes).

Unbidden, I have some ideas about how we might preserve even _more_ of the functionality involving DNS lookups, but more effort than just giving back the IP is probably wasted, so I won't mention them.  Let's deprecate the API and move on.

Thanks for bringing this up,

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20140702/472badae/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20140702/472badae/attachment.html</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028498.html">[Twisted-Python] Request.getClient
</A></li>
	<LI>Next message: <A HREF="028500.html">[Twisted-Python] Request.getClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28499">[ date ]</a>
              <a href="thread.html#28499">[ thread ]</a>
              <a href="subject.html#28499">[ subject ]</a>
              <a href="author.html#28499">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
