<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Could Service.startService return a Deferred?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Could%20Service.startService%20return%20a%20Deferred%3F&In-Reply-To=%3CCAL%2BxXwOosjXAKn3qYNiVH9TxJphBF1Yjf_f%2B64ei7%3Da4vf-Buw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="027781.html">
   <LINK REL="Next"  HREF="060245.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Could Service.startService return a Deferred?</H1>
    <B>Matt Haggard</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Could%20Service.startService%20return%20a%20Deferred%3F&In-Reply-To=%3CCAL%2BxXwOosjXAKn3qYNiVH9TxJphBF1Yjf_f%2B64ei7%3Da4vf-Buw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Could Service.startService return a Deferred?">haggardii at gmail.com
       </A><BR>
    <I>Wed Nov 27 08:33:26 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027781.html">[Twisted-Python] Could Service.startService return a Deferred?
</A></li>
        <LI>Next message (by thread): <A HREF="060245.html">[Twisted-Python] Could Service.startService return a Deferred?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60243">[ date ]</a>
              <a href="thread.html#60243">[ thread ]</a>
              <a href="subject.html#60243">[ subject ]</a>
              <a href="author.html#60243">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Peter,

I assume you're using a MultiService to hold all of these services.
You could delay adding the dependent services to the MultiService
until the setup service has finished doing what it does.

For instance, something like this (untested):

class SetupService(Service):

    def __init__(self):
        self.done = defer.Deferred()

    def startService(self):
        # do things
        self.done.callback(None)


def makeService(...):
    ms = MultiService()

    setup = SetupService()
    setup.done.addCallback(addTheOtherServicesTo, ms)


Or maybe there's a better built-in way to do this that I don't know about.

Matt


On Wed, Nov 27, 2013 at 7:58 AM, Peter Westlake
&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">peter.westlake at pobox.com</A>&gt; wrote:
&gt;<i> I have a Twisted application with several Services. One of them has a
</I>&gt;<i> startService method that does some setup asynchronously. This can go
</I>&gt;<i> wrong if the next service to start makes a call to the first one, and it
</I>&gt;<i> isn't ready yet. One way round it would be to make all methods on the
</I>&gt;<i> slow service returned a Deferred (e.g.
</I>&gt;<i> &quot;self.slow_init.addCallback(self.actual_method)&quot;, but it seems a shame
</I>&gt;<i> to have to do that every time when the situation only occurs when the
</I>&gt;<i> daemon starts up. So would it be possible for t.a.s.Service.startService
</I>&gt;<i> to be allowed to return a Deferred? Then the next service would only be
</I>&gt;<i> started up when the Deferred fired.
</I>&gt;<i>
</I>&gt;<i> Peter.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027781.html">[Twisted-Python] Could Service.startService return a Deferred?
</A></li>
	<LI>Next message (by thread): <A HREF="060245.html">[Twisted-Python] Could Service.startService return a Deferred?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60243">[ date ]</a>
              <a href="thread.html#60243">[ thread ]</a>
              <a href="subject.html#60243">[ subject ]</a>
              <a href="author.html#60243">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
