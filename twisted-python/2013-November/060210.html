<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Do%20Viewables%20absolutely%20have%20to%20be%20return%27ed%0A%09by%20Avatars%3F&In-Reply-To=%3CB3B41670-6D95-4C2D-8098-06FE476656C8%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="027745.html">
   <LINK REL="Next"  HREF="060211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Do%20Viewables%20absolutely%20have%20to%20be%20return%27ed%0A%09by%20Avatars%3F&In-Reply-To=%3CB3B41670-6D95-4C2D-8098-06FE476656C8%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Nov 22 12:02:57 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027745.html">[Twisted-Python] Do Viewables absolutely have to be return'ed by	Avatars?
</A></li>
        <LI>Next message (by thread): <A HREF="060211.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60210">[ date ]</a>
              <a href="thread.html#60210">[ thread ]</a>
              <a href="subject.html#60210">[ subject ]</a>
              <a href="author.html#60210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Nov 20, 2013, at 3:54 PM, Daniel Sank &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sank.daniel at gmail.com</A>&gt; wrote:

&gt;<i> From some experimentation I find that the only way to make a Viewable
</I>&gt;<i> get a meaningful perspective argument when executing view_* methods is
</I>&gt;<i> to make sure that the references to that Viewable are given to clients
</I>&gt;<i> as return values from perspective_* methods called on a pb.Avatar.
</I>&gt;<i> 
</I>&gt;<i> In particular, if the Avatar gives a client a reference to a Viewable
</I>&gt;<i> by passing it as an argument to a remote_* method on the client,
</I>&gt;<i> subsequent invocations of view_* methods by the client result in
</I>&gt;<i> perspective argument in view_* methods being None.
</I>&gt;<i> 
</I>&gt;<i> I have attached a complete working example of a client and server that
</I>&gt;<i> succinctly illustrates this issue.
</I>&gt;<i> 
</I>&gt;<i> Question: Is there a way to distribute un-asked for references to
</I>&gt;<i> Viewables that properly get the perspective argument in their view_*
</I>&gt;<i> methods?
</I>
So, this strikes me as incredibly subtle, and likely a bug, but the fix is not immediately obvious to me.

Viewable objects are associated with their perspective when they are serialized.  They are associated with the perspective which is serializing them.

The &quot;mind&quot; object, passed by the client during the login process, can be just about anything - but one property that all &quot;mind&quot; objects share is that they are serialized *before authentication even occurs*, so there is no Avatar object and therefore no perspective around.  Therefore the ViewPoint which gets stored in the remote reference cache will have a perspective of None, and all subsequent calls made to that reference will have no perspective.

One way to fix this is to manually construct a ViewPoint rather than a Viewable and pass that to the client.  But I do think that we should find a way to make your use-case work, to, or at the very least document the reasons why it doesn't in a comprehensible way...

It's been a *very* long time since I took such a hard look at PB.  Good catch!

-glyph

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027745.html">[Twisted-Python] Do Viewables absolutely have to be return'ed by	Avatars?
</A></li>
	<LI>Next message (by thread): <A HREF="060211.html">[Twisted-Python] Do Viewables absolutely have to be return'ed	by Avatars?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60210">[ date ]</a>
              <a href="thread.html#60210">[ thread ]</a>
              <a href="subject.html#60210">[ subject ]</a>
              <a href="author.html#60210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
