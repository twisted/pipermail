<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] (newbie!) smtp to message object
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%28newbie%21%29%20smtp%20to%20message%20object&In-Reply-To=%3C527A52FF.8070209%40nweb.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027683.html">
   <LINK REL="Next"  HREF="027678.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] (newbie!) smtp to message object</H1>
    <B>Fabio Sangiovanni</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%28newbie%21%29%20smtp%20to%20message%20object&In-Reply-To=%3C527A52FF.8070209%40nweb.it%3E"
       TITLE="[Twisted-Python] (newbie!) smtp to message object">sangiovanni at nweb.it
       </A><BR>
    <I>Wed Nov  6 07:32:31 MST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027683.html">[Twisted-Python] (newbie!) smtp to message object
</A></li>
        <LI>Next message: <A HREF="027678.html">[Twisted-Python] Error unmerging r40589
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27684">[ date ]</a>
              <a href="thread.html#27684">[ thread ]</a>
              <a href="subject.html#27684">[ subject ]</a>
              <a href="author.html#27684">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Il 06/11/13 15:20, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> ha scritto:
&gt;<i> On 11:35 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sangiovanni at nweb.it</A> wrote:
</I>&gt;&gt;<i> Il 06/11/13 12:09, Stacey Sern ha scritto:
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I also tried to figure out how to deliver one copy of a message 
</I>&gt;&gt;&gt;<i> instead of one for every recipient for a Twisted server tutorial 
</I>&gt;&gt;&gt;<i> (ticket #3324) which hasn't yet been finalized.  Here's the way I 
</I>&gt;&gt;&gt;<i> went about it but I'd appreciate comments on the approach as well.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> For the IMessageDelivery.validateTo method, it generates the real 
</I>&gt;&gt;&gt;<i> IMessage object when it receives the first recipient. After that, it 
</I>&gt;&gt;&gt;<i> returns a NullMessage object for each subsequent recipient.  The 
</I>&gt;&gt;&gt;<i> NullMessage object is called for each line received as part of the 
</I>&gt;&gt;&gt;<i> message but does nothing with it.  Then you don't need to change 
</I>&gt;&gt;&gt;<i> _cbToValidate.  Here's you're code with the modifications 
</I>&gt;&gt;&gt;<i> <A HREF="http://pastebin.com/6nFXiTgK.">http://pastebin.com/6nFXiTgK.</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Stacey
</I>&gt;&gt;<i> Hi Stacey,
</I>&gt;&gt;<i> thanks for your reply.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I think your approach is cleaner than mine! Thanks!
</I>&gt;&gt;<i> My only concern is this loop in smtp.SMTP.do_DATA:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> for (user, msgFunc) in recipients:
</I>&gt;&gt;<i> [...]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> that implies a scan of the whole list of messages (made of the 'real' 
</I>&gt;&gt;<i> message and of the other NullMessages).
</I>&gt;&gt;<i> I don't know how it can really impact on performances, though. I 
</I>&gt;&gt;<i> aimed at not creating 'fake' messages at all, but it's not clear to 
</I>&gt;&gt;<i> me if it's even possible without overriding _cbToValidate.
</I>&gt;<i>
</I>&gt;<i> The performance impact of this is going to be minimal.
</I>&gt;<i>
</I>&gt;<i> On a runtime like PyPy, the impact *may* even be zero.
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>Thanks Jean-Paul,
I'll go the way suggested by Stacey, then.
Any other suggestions about my approach?

Thanks again!
&gt;&gt;<i> Let's keep in touch!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Fabio
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Nov 6, 2013, at 5:08 AM, Fabio Sangiovanni &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sangiovanni at nweb.it</A> 
</I>&gt;&gt;&gt;<i> &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sangiovanni at nweb.it</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> Hello list,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I'm new to twisted and to python in general, so still deep in the 
</I>&gt;&gt;&gt;&gt;<i> learning process.
</I>&gt;&gt;&gt;&gt;<i> Please forgive any faulty assumptions you'll find in this post :)
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I'm trying to accomplish to the following task: realize a tool that 
</I>&gt;&gt;&gt;&gt;<i> acts as a proxy between the SMTP domain and the 'objects' domain. 
</I>&gt;&gt;&gt;&gt;<i> That is: a daemon that listens for SMTP connections (relayed 
</I>&gt;&gt;&gt;&gt;<i> sessions from Postfix) and bundles everything that belongs to a 
</I>&gt;&gt;&gt;&gt;<i> single session (envelope sender, envelope recipients, headers, 
</I>&gt;&gt;&gt;&gt;<i> body) into an object (it will probably become a JSON one day, not 
</I>&gt;&gt;&gt;&gt;<i> decided yet). The aim is to allow further processing (es. 
</I>&gt;&gt;&gt;&gt;<i> publishing to a queue) of a self- contained item.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> My (draft) implementation can be reached at 
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://pastebin.com/mbRztuid">http://pastebin.com/mbRztuid</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> My main concerns are:
</I>&gt;&gt;&gt;&gt;<i> 1) am I using the right classes? My implementation leverages 
</I>&gt;&gt;&gt;&gt;<i> twisted.mail.smtp, is this correct?
</I>&gt;&gt;&gt;&gt;<i> 2) I've overridden smtp.SMTP._cbToValidate; I really don't like 
</I>&gt;&gt;&gt;&gt;<i> this very much (I'd like to leave the protocol untouched) but it's 
</I>&gt;&gt;&gt;&gt;<i> the only way I've come up with (after several days of experiments 
</I>&gt;&gt;&gt;&gt;<i> :) ) to have one single payload down the line (in 
</I>&gt;&gt;&gt;&gt;<i> smtp.SMTP.do_DATA), and not one copy of the message for every 
</I>&gt;&gt;&gt;&gt;<i> single recipient. May this have bad consequences?
</I>&gt;&gt;&gt;&gt;<i> 3) what do you think about the overall approach? could it have been 
</I>&gt;&gt;&gt;&gt;<i> done differently/better?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Thanks a lot for your help!
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Fabio
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A> &lt;mailto:Twisted- 
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Python at twistedmatrix.com</A>&gt;
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027683.html">[Twisted-Python] (newbie!) smtp to message object
</A></li>
	<LI>Next message: <A HREF="027678.html">[Twisted-Python] Error unmerging r40589
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27684">[ date ]</a>
              <a href="thread.html#27684">[ thread ]</a>
              <a href="subject.html#27684">[ subject ]</a>
              <a href="author.html#27684">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
