<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] carbon-relay eating CPU - EAGAIN (Resource temporarily unavailable)?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20carbon-relay%20eating%20CPU%20-%20EAGAIN%20%28Resource%0A%20temporarily%20unavailable%29%3F&In-Reply-To=%3CCAPkRfUTJ76nxXeFMSXUYt-woBKWAqXDrtxHqKz8XfinKFt7ibA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060240.html">
   <LINK REL="Next"  HREF="027781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] carbon-relay eating CPU - EAGAIN (Resource temporarily unavailable)?</H1>
    <B>Christopher Armstrong</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20carbon-relay%20eating%20CPU%20-%20EAGAIN%20%28Resource%0A%20temporarily%20unavailable%29%3F&In-Reply-To=%3CCAPkRfUTJ76nxXeFMSXUYt-woBKWAqXDrtxHqKz8XfinKFt7ibA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] carbon-relay eating CPU - EAGAIN (Resource temporarily unavailable)?">radix at twistedmatrix.com
       </A><BR>
    <I>Tue Nov 26 08:07:42 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060240.html">[Twisted-Python] carbon-relay eating CPU - EAGAIN (Resource temporarily unavailable)?
</A></li>
        <LI>Next message (by thread): <A HREF="027781.html">[Twisted-Python] Could Service.startService return a Deferred?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60241">[ date ]</a>
              <a href="thread.html#60241">[ thread ]</a>
              <a href="subject.html#60241">[ subject ]</a>
              <a href="author.html#60241">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Quan Tong Anh.

On Mon, Nov 25, 2013 at 10:05 PM, Quan Tong Anh &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">anhquankitty at gmail.com</A>&gt;wrote:

&gt;<i>  - Python 2.7.3
</I>&gt;<i>  - [twisted, version 13.1.0]
</I>&gt;<i>  - xen-domU
</I>&gt;<i>
</I>&gt;<i> `atop` shows that `carbon-relay` is eating 80, 90% USRCPU. From the
</I>&gt;<i> `strace`:
</I>&gt;<i>
</I>&gt;<i>     accept(7, {sa_family=AF_INET, sin_port=htons(60649),
</I>&gt;<i> sin_addr=inet_addr(&quot;192.237.222.81&quot;)}, [16]) = 257
</I>&gt;<i>     accept(7, {sa_family=AF_INET, sin_port=htons(51564),
</I>&gt;<i> sin_addr=inet_addr(&quot;166.78.1.48&quot;)}, [16]) = 257
</I>&gt;<i>     accept(7, 0x7ffff4679550, [16])         = -1 EAGAIN (Resource
</I>&gt;<i> temporarily unavailable)
</I>&gt;<i>     accept(7, {sa_family=AF_INET, sin_port=htons(33654),
</I>&gt;<i> sin_addr=inet_addr(&quot;198.61.194.248&quot;)}, [16]) = 257
</I>&gt;<i>     accept(7, {sa_family=AF_INET, sin_port=htons(50037),
</I>&gt;<i> sin_addr=inet_addr(&quot;166.78.181.204&quot;)}, [16]) = 257
</I>&gt;<i>     accept(7, 0x7ffff4679550, [16])         = -1 EAGAIN (Resource
</I>&gt;<i> temporarily unavailable)
</I>&gt;<i>
</I>&gt;<i> The strange thing is: even restart the service, it seems stuck at fd 7
</I>&gt;<i> everytime running `strace`. Does it mean this fd is not being cleanup
</I>&gt;<i> properly?
</I>&gt;<i>
</I>
You have given a lot of data, but haven't actually described a problem.
Nothing is &quot;stuck&quot; at FD 7, it's simply a listening socket file descriptor,
and the way listening sockets work is you call accept() repeatedly on them
to get incoming connections.

accept() returning EAGAIN is normal behavior and should basically be
ignored. Twisted handles this case appropriately. From the man page:

       EAGAIN or EWOULDBLOCK
              The socket is marked nonblocking and no connections are
present to be accepted.  POSIX.1-2001 allows either error to be returned
for this case, and does not require these constants to have the same value,
so a portable application should check for both possibilities.

Is there actually something wrong with your service? Can you explain the
behavior you're seeing and how it differs from the behavior you want to
see? If the problem is only &quot;carbon uses a lot of CPU&quot;, maybe the problem
is either just that carbon is inefficient or you need to scale up to more
instances?



-- 
Christopher Armstrong
<A HREF="http://radix.twistedmatrix.com/">http://radix.twistedmatrix.com/</A>
<A HREF="http://planet-if.com/">http://planet-if.com/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20131126/3c5066a4/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060240.html">[Twisted-Python] carbon-relay eating CPU - EAGAIN (Resource temporarily unavailable)?
</A></li>
	<LI>Next message (by thread): <A HREF="027781.html">[Twisted-Python] Could Service.startService return a Deferred?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60241">[ date ]</a>
              <a href="thread.html#60241">[ thread ]</a>
              <a href="subject.html#60241">[ subject ]</a>
              <a href="author.html#60241">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
