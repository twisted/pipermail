<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] (newbie!) smtp to message object
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%28newbie%21%29%20smtp%20to%20message%20object&In-Reply-To=%3C0D7D5E1F-BD46-4FAC-B244-5838F336F33B%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027677.html">
   <LINK REL="Next"  HREF="027681.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] (newbie!) smtp to message object</H1>
    <B>Stacey Sern</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%28newbie%21%29%20smtp%20to%20message%20object&In-Reply-To=%3C0D7D5E1F-BD46-4FAC-B244-5838F336F33B%40gmail.com%3E"
       TITLE="[Twisted-Python] (newbie!) smtp to message object">staceysern at gmail.com
       </A><BR>
    <I>Wed Nov  6 04:09:00 MST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027677.html">[Twisted-Python] (newbie!) smtp to message object
</A></li>
        <LI>Next message: <A HREF="027681.html">[Twisted-Python] (newbie!) smtp to message object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27679">[ date ]</a>
              <a href="thread.html#27679">[ thread ]</a>
              <a href="subject.html#27679">[ subject ]</a>
              <a href="author.html#27679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I also tried to figure out how to deliver one copy of a message instead of one for every recipient for a Twisted server tutorial (ticket #3324) which hasn't yet been finalized.  Here's the way I went about it but I'd appreciate comments on the approach as well.

For the IMessageDelivery.validateTo method, it generates the real IMessage object when it receives the first recipient.  After that, it returns a NullMessage object for each subsequent recipient.  The NullMessage object is called for each line received as part of the message but does nothing with it.  Then you don't need to change _cbToValidate.  Here's you're code with the modifications <A HREF="http://pastebin.com/6nFXiTgK.">http://pastebin.com/6nFXiTgK.</A>

Stacey



On Nov 6, 2013, at 5:08 AM, Fabio Sangiovanni &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sangiovanni at nweb.it</A>&gt; wrote:

&gt;<i> Hello list,
</I>&gt;<i> 
</I>&gt;<i> I'm new to twisted and to python in general, so still deep in the learning process.
</I>&gt;<i> Please forgive any faulty assumptions you'll find in this post :)
</I>&gt;<i> 
</I>&gt;<i> I'm trying to accomplish to the following task: realize a tool that acts as a proxy between the SMTP domain and the 'objects' domain. That is: a daemon that listens for SMTP connections (relayed sessions from Postfix) and bundles everything that belongs to a single session (envelope sender, envelope recipients, headers, body) into an object (it will probably become a JSON one day, not decided yet). The aim is to allow further processing (es. publishing to a queue) of a self-contained item.
</I>&gt;<i> 
</I>&gt;<i> My (draft) implementation can be reached at <A HREF="http://pastebin.com/mbRztuid">http://pastebin.com/mbRztuid</A>
</I>&gt;<i> 
</I>&gt;<i> My main concerns are:
</I>&gt;<i> 1) am I using the right classes? My implementation leverages twisted.mail.smtp, is this correct?
</I>&gt;<i> 2) I've overridden smtp.SMTP._cbToValidate; I really don't like this very much (I'd like to leave the protocol     untouched) but it's the only way I've come up with (after several days of experiments :) ) to have one single payload down the line (in smtp.SMTP.do_DATA), and not one copy of the message for every single recipient. May this have bad consequences?
</I>&gt;<i> 3) what do you think about the overall approach? could it have been done differently/better?
</I>&gt;<i> 
</I>&gt;<i> Thanks a lot for your help!
</I>&gt;<i> 
</I>&gt;<i> Fabio
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20131106/0acb093a/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20131106/0acb093a/attachment.html</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027677.html">[Twisted-Python] (newbie!) smtp to message object
</A></li>
	<LI>Next message: <A HREF="027681.html">[Twisted-Python] (newbie!) smtp to message object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27679">[ date ]</a>
              <a href="thread.html#27679">[ thread ]</a>
              <a href="subject.html#27679">[ subject ]</a>
              <a href="author.html#27679">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
