<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Determine TLS version from within request handler ? (twisted web)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Determine%20TLS%20version%20from%20within%20request%0A%20handler%20%3F%20%28twisted%20web%29&In-Reply-To=%3C20131106143827.8349.1534318774.divmod.xquotient.371%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027682.html">
   <LINK REL="Next"  HREF="027704.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Determine TLS version from within request handler ? (twisted web)</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Determine%20TLS%20version%20from%20within%20request%0A%20handler%20%3F%20%28twisted%20web%29&In-Reply-To=%3C20131106143827.8349.1534318774.divmod.xquotient.371%40top%3E"
       TITLE="[Twisted-Python] Determine TLS version from within request handler ? (twisted web)">exarkun at twistedmatrix.com
       </A><BR>
    <I>Wed Nov  6 07:38:27 MST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027682.html">[Twisted-Python] Determine TLS version from within request handler	? (twisted web)
</A></li>
        <LI>Next message: <A HREF="027704.html">[Twisted-Python] Determine TLS version from within request handler ? (twisted web)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27685">[ date ]</a>
              <a href="thread.html#27685">[ thread ]</a>
              <a href="subject.html#27685">[ subject ]</a>
              <a href="author.html#27685">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11:43 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rmeijer at xs4all.nl</A> wrote:
&gt;<i>I'm using twisted web for an https connection. At first I start with
</I>&gt;<i>creating and configuring a ssl.DefaultOpenSSLContextFactory derived 
</I>&gt;<i>class
</I>&gt;<i>that disables SSLv2 and SSLv3. So (basically we're left with TLS1.0 and
</I>&gt;<i>up) and forces the use of a single strong (non RC4 but BEAST 
</I>&gt;<i>vulnerable)
</I>&gt;<i>cipher.
</I>&gt;<i>
</I>&gt;<i>Than I have a http.HTTPFactory derived class with a 'buildProtocol'that
</I>&gt;<i>return a http.HTTPChannel derived object, that in turn returns a
</I>&gt;<i>http.Request derived object.
</I>&gt;<i>
</I>&gt;<i>Than reactor.listenSSL is invoked with both the SSL factory and the 
</I>&gt;<i>HTTP
</I>&gt;<i>factory. Now my problem. I don't really understand how these two are
</I>&gt;<i>connected once the request handler gets invoked.
</I>&gt;<i>
</I>&gt;<i>What I would like to do is that I would want to allow TLS1.0 users to 
</I>&gt;<i>use
</I>&gt;<i>the server, but only after explicitly agreeing that they understand the
</I>&gt;<i>risks involved with using an old BEAST vulnerable browser.
</I>&gt;<i>
</I>&gt;<i>Is there any way to retrieve info on what TLS version has been 
</I>&gt;<i>negotiated
</I>&gt;<i>from within the HTTP request handler? I've been walking the 'self' 
</I>&gt;<i>object
</I>&gt;<i>a bit, and self.transport.getHandle() seems to have some tls stuff like
</I>&gt;<i>'get_cipher_list' and 'get_peer_certificate', but the simple TLS 
</I>&gt;<i>version
</I>&gt;<i>number does not seem to be available.
</I>
The object you get back from `self.transport.getHandle()` happens to be 
an object from pyOpenSSL - an instance of OpenSSL.SSL.Connection.  While 
reading the following, though, bear in mind that `getHandle` doesn't 
make much of a promise about what it will return.  Other transports may 
return something else and future versions of Twisted may change the 
result as well.

The API that OpenSSL appears to offer for determining what protocol 
version is in use appears to be SSL_get_version().  This returns a 
string like &quot;SSLv2&quot; or &quot;TLSv1&quot; (the documentation doesn't say anything 
about TLSv1.1 or TLSv1.2 but *presumably* if you have a version of 
OpenSSL that implements either of these protocols and one of them is 
negotiated on a connection then SSL_get_version() will identify them in 
its result).

pyOpenSSL, however, does not expose this method.  So in order to get the 
information you need you may need to contribute a binding for this 
method to pyOpenSSL.

Jean-Paul
&gt;<i>Is the twisted web API simply insuficient to retreive this information
</I>&gt;<i>from within the request handler, or am I missing something here?
</I>&gt;<i>
</I>&gt;<i>T.I.A,
</I>&gt;<i>
</I>&gt;<i>Rob
</I>
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027682.html">[Twisted-Python] Determine TLS version from within request handler	? (twisted web)
</A></li>
	<LI>Next message: <A HREF="027704.html">[Twisted-Python] Determine TLS version from within request handler ? (twisted web)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27685">[ date ]</a>
              <a href="thread.html#27685">[ thread ]</a>
              <a href="subject.html#27685">[ subject ]</a>
              <a href="author.html#27685">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
