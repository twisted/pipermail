<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] AMP Argument.toBox's proto argument is a	locator, not the proto?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMP%20Argument.toBox%27s%20proto%20argument%20is%20a%0A%09locator%2C%20not%20the%20proto%3F&In-Reply-To=%3C59B7D7CB-1BB5-4048-8FCE-85F55B83FC51%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="027495.html">
   <LINK REL="Next"  HREF="027500.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] AMP Argument.toBox's proto argument is a	locator, not the proto?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMP%20Argument.toBox%27s%20proto%20argument%20is%20a%0A%09locator%2C%20not%20the%20proto%3F&In-Reply-To=%3C59B7D7CB-1BB5-4048-8FCE-85F55B83FC51%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] AMP Argument.toBox's proto argument is a	locator, not the proto?">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Oct  3 03:54:13 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027495.html">[Twisted-Python] AMP Argument.toBox's proto argument is a locator, not the proto?
</A></li>
        <LI>Next message (by thread): <A HREF="027500.html">[Twisted-Python] Conch - Why does one piece of code &quot;fail&quot; while	another works
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59974">[ date ]</a>
              <a href="thread.html#59974">[ thread ]</a>
              <a href="subject.html#59974">[ subject ]</a>
              <a href="author.html#59974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> On Oct 1, 2013, at 1:13 AM, Laurens Van Houtven &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.io</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On Tue, Oct 1, 2013 at 12:59 AM, Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i> Most of the code I can think of that wants to use that really wants the transport rather than the &quot;protocol&quot;,
</I>&gt;<i> 
</I>&gt;<i> Yes, but having the protocol would also immediately give you access to the transport, and, from what I understand in most cases of AMP, also everything else :)
</I>
The problem here is that you can do AMP decoding without a protocol anywhere in sight.  A CommandLocator by itself, passed appropriate boxes to the callables returned by locateResponder, is capable of speaking AMP just fine, as long as you don't care about speaking it to an actual byte stream :-).  (And ostensibly this is one way to speak AMP over transports other than BinaryBoxProtocol.)

In the case of AMP routes (something it would be very nice to integrate into the main protocol), you have multiple command locators per transport, and each one might have its own properties that would be interesting to Argument types,

This is why putting requirements on the thing-doing-the-parsing in the Argument definition makes sense; the Command could interrogate its prospective Responder class, asking each of its Argument objects if it will be able to satisfy their requirements in turn, at the time that CommandLocator.__metaclass__.__new__ gets invoked, rather than once your protocol is already trying to respond to commands.

&gt;&gt;<i> but nothing within AMP itself actually uses those arguments; in fact, searching the usual suspects (epsilon, vertex) I can't even find any Arguments that use the 'proto' argument for anything useful.
</I>&gt;<i> 
</I>&gt;<i> I suppose it's too late to get &quot;proto&quot; to actually mean &quot;proto&quot; and not &quot;boxSender&quot;?
</I>
I believe it currently means &quot;responderLocator&quot;.  _wrapWithSerialization is where the magic happens if you want to confirm.

&gt;<i> It would definitely be a backwards-incompatible change, and I do actually have some code that somehow relied on it being the boxSender (actually, I think I saved that code in txampext, mostly, except I renamed that thing &quot;proto&quot;).
</I>
It's probably too late for this method, but you can always add a new one :-)

&gt;&gt;<i> If I recall, I believe the idea behind it was to allow an AMP responder within Vertex to return the peer's IP address back to the peer, from within an authenticated AMP route that (because it was a route) wasn't necessarily connected directly to the transport (and therefore couldn't just do self.transport.getPeer()).  Ironically I don't think it'll actually work for that now :-).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> When we pull the authentication logic in from &lt;<A HREF="http://bazaar.launchpad.net/~divmod-dev/divmod.org/trunk/view/head:/Epsilon/epsilon/ampauth.py">http://bazaar.launchpad.net/~divmod-dev/divmod.org/trunk/view/head:/Epsilon/epsilon/ampauth.py</A>&gt;, you might write a responder that's interested in authentication information that lives in some other relation to the protocol.
</I>&gt;<i> 
</I>&gt;<i> I wrote very similar deep-in-AMP auth logic once, and did look at that code (but ended up not using it because I use TLS, so I don't need hand-rolled challenge response or OTP systems).
</I>
The hand-rolled CR/OTP crap is really not supposed to be the interesting part. Really, that should just be SASL.  The interesting part is the integration with cred.

(Augh, and we didn't know the difference between a one-time password and a one-time pad, and the wrong word is right there in the wire format... Augh augh augh)

&gt;<i> When you say &quot;other relation to the protocol&quot;, does that mean &quot;it can be the protocol because the protocol will have some kind of reference to it&quot;?
</I>
Notice that in that authentication code, CredReceiver *sets self.boxReceiver* to the result of portal.login.  It hands off processing of the parsed AMP boxes to another IBoxReceiver.  So the thing parsing the commands - the post-authentication protocol - is what the Arguments will currently have direct access to (as that will be the CommandLocator as well) but that object will have no transport; only a boxSender.

&gt;&gt;<i> So in order to fix fromBox/toBox, we need to do a fix that firms up that contract and perhaps exposes more than a Protocol object.  The *recommended* API should be more or less like what ExposingArgument is doing - specify an Argument that asks for a particular attribute of the transport or the protocol or the authentication context or whatever, the implementation details may involve other lower-level public APIs.
</I>&gt;<i> 
</I>&gt;<i> That still sounds like it can be done by making &quot;proto&quot; actually the proto ;-) So, basically, the question is if &quot;proto&quot; being the locator is a bug that I can fix, or an interface that I can't.
</I>
You could add a new interface where it's &quot;fixed&quot;, but given the case I just described above, what does &quot;fixed&quot; mean?

&gt;&gt;&gt;<i> My contributions to AMP have been more of the defect-findy kind, but I could certainly turn them more into the code-contributy kind. I imagine I'm not the first person to want tests for command classes (<A HREF="https://github.com/lvh/txampext/blob/master/txampext/commandtests.py">https://github.com/lvh/txampext/blob/master/txampext/commandtests.py</A>) or a nested AMP box (<A HREF="https://github.com/lvh/txampext/blob/master/txampext/nested.py">https://github.com/lvh/txampext/blob/master/txampext/nested.py</A>).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> That would be cool.  And, you know, that auth thing I said :-).
</I>&gt;<i> 
</I>&gt;<i> If I can change &quot;proto&quot; to mean &quot;actually the protocol not something else&quot; then that seems plenty easy to add, and it would definitely be cool if people don't have to mess with this nonsense themselves for something as ostensibly simple as having access to the protocol :-)
</I>
Keep in mind that in the authentication case I mentioned, your post-auth object may well subclass AMP and therefore &quot;actually&quot; be a protocol; but it still won't have a transport.  What do you propose happen in that case?

-g
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20131003/cd3a5009/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027495.html">[Twisted-Python] AMP Argument.toBox's proto argument is a locator, not the proto?
</A></li>
	<LI>Next message (by thread): <A HREF="027500.html">[Twisted-Python] Conch - Why does one piece of code &quot;fail&quot; while	another works
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#59974">[ date ]</a>
              <a href="thread.html#59974">[ thread ]</a>
              <a href="subject.html#59974">[ subject ]</a>
              <a href="author.html#59974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
