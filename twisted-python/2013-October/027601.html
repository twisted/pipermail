<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted as a full solution for web hosting	[WSGI + other]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20as%20a%20full%20solution%20for%20web%20hosting%0A%09%5BWSGI%20%2B%20other%5D&In-Reply-To=%3C3FB7C1B3-4A13-42D1-A212-7B883747AE96%40orestis.gr%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027600.html">
   <LINK REL="Next"  HREF="027607.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted as a full solution for web hosting	[WSGI + other]</H1>
    <B>Orestis Markou</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20as%20a%20full%20solution%20for%20web%20hosting%0A%09%5BWSGI%20%2B%20other%5D&In-Reply-To=%3C3FB7C1B3-4A13-42D1-A212-7B883747AE96%40orestis.gr%3E"
       TITLE="[Twisted-Python] Twisted as a full solution for web hosting	[WSGI + other]">orestis at orestis.gr
       </A><BR>
    <I>Tue Oct 22 06:58:45 MDT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027600.html">[Twisted-Python] Twisted as a full solution for web hosting [WSGI + other]
</A></li>
        <LI>Next message: <A HREF="027607.html">[Twisted-Python] Twisted as a full solution for web hosting	[WSGI + other]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27601">[ date ]</a>
              <a href="thread.html#27601">[ thread ]</a>
              <a href="subject.html#27601">[ subject ]</a>
              <a href="author.html#27601">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 22 &#927;&#954;&#964; 2013, at 3:38 &#956;.&#956;., <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:

&gt;<i> On 07:41 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">orestis at orestis.gr</A> wrote:
</I>&gt;&gt;<i> On 21 &#927;&#954;&#964; 2013, at 10:32 &#956;.&#956;., Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Oct 20, 2013, at 2:21 AM, Orestis Markou &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">orestis at orestis.gr</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> Hello,
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Short form of the question:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Are people using Twisted to host WSGI applications AND serve static files AND replace celery/redis/other?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I'm not personally using it as a WSGI host, but otherwise, yes, a full-stack application container speaking multiple protocols.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Any pointers on how to best use this in combination with WSGI/Django? In the past I had a combination of twisted-web (for /static and /media) and wsgi host (for everything else), all running under the same Service. Essentially:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> os.environ['DJANGO_SETTINGS_MODULE'] = 'myproject.settings'
</I>&gt;&gt;<i> application = django.core.handlers.wsgi.WSGIHandler()
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> wsgi_resource = WSGIResource(reactor, reactor.getThreadPool(), application)
</I>&gt;&gt;<i> resource = Root(wsgi_resource)
</I>&gt;&gt;<i> # this could probably be automatically inferred from settings.py
</I>&gt;&gt;<i> resource.putChild('static', File(...))
</I>&gt;&gt;<i> resource.putChild('uploaded', File(...))
</I>&gt;&gt;<i> # other stuff
</I>&gt;&gt;<i> site = server.Site(resource)
</I>&gt;&gt;<i> reactor.listenTCP(8000, site)
</I>&gt;&gt;<i> reactor.run()
</I>&gt;<i> 
</I>&gt;<i> This looks about like I'd expect (if my guess that `Root` is an `IResource` that knows how to split dispatch between the WSGI resource and its other children).  If you have any suggestions for improving the experience please share them. :)
</I>
For anyone following along:

class Root(resource.Resource):

    def __init__(self, wsgi_resource):
        resource.Resource.__init__(self)
        self.wsgi_resource = wsgi_resource

    def getChild(self, path, request):
        path0 = request.prepath.pop(0)
        request.postpath.insert(0, path0)
        return self.wsgi_resource

I don't remember now if I wrote this code or if I copied it from somewhere.

&gt;&gt;<i> [snip]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Here's a thought experiment - I'd like to keep URL routing 100% in Django for anything that hits the DB. I have some code that needs to spawn an external process to generate an image on-demand (with a layer of caching on top). In the past I defined a Twisted.Web handler for that. Could I now expose an internal API that (through Crochet?) do the spawnProcess dance and come back with image data that Django could then handle internally (store in a file, whatever). How would the threaded WSGI container deal with the blocking request (not really blocking, but that request would stall until the Deferred would be fired).
</I>&gt;<i> 
</I>&gt;<i> It will produce roughly the same results as you'd get if you used any other WSGI container: one of the threads in the thread pool will be kept unavailable as it waits for the result.  This will have the usual consequence: if your threadpool has a max of N threads and you receive N requests that need to do this, the N+1th request that needs to be handled by the WSGI part of your server won't be handled until one of the previous requests completes (completion frees up one thread which is then used to handle the N+1th request).
</I>&gt;<i> 
</I>&gt;<i> The only difference might be that since you also have non-WSGI content (all of your static content) even when your thread pool is completely in use requests for static content will still be satisfied right away. However, if you previously had a WSGI+lighttpd/whatever then you probably already had this property as well.
</I>&gt;<i> 
</I>&gt;<i> Put another way, Twisted's WSGI container is still just a WSGI container.  Fortunately Twisted has other pieces aside from a WSGI container. :)
</I>
I wonder if this could be turned on its head - instead of having the Django WSGI app blocking while waiting for a long running thing, field the request beforehand, do whatever long-running thing is required and only then hand over the to the WSGI app to proceed with the HTTP response. This obviously requires a level request processing in Twisted - I'm not sure if it's worth the effort. It could be done by a Twisted-savvy WSGI middleware, perhaps. I'll try to see what I can come up with.

Orestis



&gt;<i> Jean-Paul
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20131022/fe78349b/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20131022/fe78349b/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027600.html">[Twisted-Python] Twisted as a full solution for web hosting [WSGI + other]
</A></li>
	<LI>Next message: <A HREF="027607.html">[Twisted-Python] Twisted as a full solution for web hosting	[WSGI + other]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27601">[ date ]</a>
              <a href="thread.html#27601">[ thread ]</a>
              <a href="subject.html#27601">[ subject ]</a>
              <a href="author.html#27601">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
