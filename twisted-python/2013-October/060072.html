<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] epoll keep sharing state between process even	after fork.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20epoll%20keep%20sharing%20state%20between%20process%20even%0A%09after%20fork.&In-Reply-To=%3CCALpq1pboUNB9_Nxm2kOtGqLbz0cYnOxuBzq2iQUDxaH2HD_W-A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] epoll keep sharing state between process even	after fork.</H1>
    <B>Flint</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20epoll%20keep%20sharing%20state%20between%20process%20even%0A%09after%20fork.&In-Reply-To=%3CCALpq1pboUNB9_Nxm2kOtGqLbz0cYnOxuBzq2iQUDxaH2HD_W-A%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] epoll keep sharing state between process even	after fork.">grindizer at gmail.com
       </A><BR>
    <I>Wed Oct 23 09:46:24 MDT 2013</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60072">[ date ]</a>
              <a href="thread.html#60072">[ thread ]</a>
              <a href="subject.html#60072">[ subject ]</a>
              <a href="author.html#60072">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everybody

I a came across a surprising problem when using the epoll based reactor.
(ticket here <A HREF="https://twistedmatrix.com/trac/ticket/6796">https://twistedmatrix.com/trac/ticket/6796</A>)

As you can see on the ticket, the epoll object seems to share some state
even after fork.
Which means even after having forked the process, making some changes to
the inherited epoll object in one process may impact the one existing in
another process !

This problem is only related to epoll based reactor, poll and select behave
correctly.
I'm aware that some may say that this in not a twisted related problem (but
an epoll issue), but I'm addressing my question here to try to figure out
what would be the best workaround for this problem in a twisted based
project ?

And for information this is what I have already tryed:
- I though about using poll or select reactor, but this is not possible,
cause as i'm writing a library I do not decide which reactor will be
installed by the person who want to use it.
(Besides as epoll is now the default reactor installed, I certainly want my
library to work with it !)

- Using spawnProcess as mentioned in the ticket comment, is not an option
too, in my case, I need to share some state between the main process and
subprocess. (I have on object in main process space that I want to inherit
in all subprocess)

- I (desperately) tryed to re-initialize the reactor._poller object after
each fork to set it with a new object, but it was just a very bad idea ! :)

Thank you, in advance, for any possible clue !
(for information, my project is here <A HREF="https://github.com/Grindizer/scaletix">https://github.com/Grindizer/scaletix</A>)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20131023/62e8ad1a/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60072">[ date ]</a>
              <a href="thread.html#60072">[ thread ]</a>
              <a href="subject.html#60072">[ subject ]</a>
              <a href="author.html#60072">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
