<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] epoll keep sharing state between process even after fork.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20epoll%20keep%20sharing%20state%20between%20process%20even%0A%20after%20fork.&In-Reply-To=%3CCALpq1paDsRBhbZny%3DMVW5%2Bfj5GZk9ePiQZhKez3eGCV4_jV0cg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060103.html">
   <LINK REL="Next"  HREF="060075.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] epoll keep sharing state between process even after fork.</H1>
    <B>Flint</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20epoll%20keep%20sharing%20state%20between%20process%20even%0A%20after%20fork.&In-Reply-To=%3CCALpq1paDsRBhbZny%3DMVW5%2Bfj5GZk9ePiQZhKez3eGCV4_jV0cg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] epoll keep sharing state between process even after fork.">grindizer at gmail.com
       </A><BR>
    <I>Thu Oct 24 08:10:45 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060103.html">[Twisted-Python] epoll keep sharing state between process even after fork.
</A></li>
        <LI>Next message (by thread): <A HREF="060075.html">[Twisted-Python] epoll keep sharing state between process	even	after fork.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60105">[ date ]</a>
              <a href="thread.html#60105">[ thread ]</a>
              <a href="subject.html#60105">[ subject ]</a>
              <a href="author.html#60105">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i> To expand on that just a bit, the form of sharing that you get when you
</I>&gt;<i> fork() but you don't exec() is very difficult to use correctly (I think
</I>&gt;<i> it's an open question whether it's *possible* to use correctly in a Python
</I>&gt;<i> program).
</I>&gt;<i>
</I>&gt;<i> The argument here is similar to the argument against shared-everything
</I>&gt;<i> multithreading.  While memory (and some other per-process state) is no
</I>&gt;<i> longer shared after fork(), *some* per-process state is still shared. And
</I>&gt;<i> all of the state that isn't shared is still a potential source of bugs
</I>&gt;<i> since it's almost certainly the case that none of it cooperated with the
</I>&gt;<i> fork() call - a call which happened at some arbitrary time and captured a
</I>&gt;<i> snapshot of all the state in memory at an arbitrary point.
</I>&gt;<i>
</I>&gt;<i> Consider a simple implementation of a lock file, used to prevent multiple
</I>&gt;<i> instances of a program from starting.  There are several ways fork() could
</I>&gt;<i> break such code.  Perhaps it is partway through acquiring a lock on the
</I>&gt;<i> lock file when the fork() occurs.  Perhaps the result is that the file ends
</I>&gt;<i> up locked but no process thinks it is holding the lock.  Now no instances
</I>&gt;<i> of the program are running.  Or perhaps the lock is held when fork()
</I>&gt;<i> happens and the problem only surfaces at unlock time.  Perhaps one of the
</I>&gt;<i> processes exits and releases the lock.  Now the program is still running
</I>&gt;<i> but the lock isn't held.
</I>&gt;<i>
</I>&gt;<i> And that's just one of the simplest possible examples of how things can go
</I>&gt;<i> wrong.
</I>&gt;<i>
</I>&gt;<i> The nearly uncountable different ways for failures to creep in and the
</I>&gt;<i> resulting impracticality (if not impossibility) of being able to test that
</I>&gt;<i> Twisted (or any Python library) actually works when fork() is used means
</I>&gt;<i> that it's not likely Twisted will ever be declared compatible with any
</I>&gt;<i> fork()-without-exec() usage.
</I>&gt;<i>
</I>&gt;<i> You can find some examples of Twisted-using applications that run multiple
</I>&gt;<i> processes, though.  Apple CalendarServer does it by passing file
</I>&gt;<i> descriptors to worker processes and sends them the location of a
</I>&gt;<i> configuration file describing how they should behave.  Divmod Mantissa does
</I>&gt;<i> it by inserting self-describing work into a SQLite3 database.  When the
</I>&gt;<i> worker process finds one of these, it knows what code to load and run by
</I>&gt;<i> looking at the fields in the row.  These are variations on a theme - RPC,
</I>&gt;<i> not shared (or duplicated) memory.
</I>&gt;<i>
</I>&gt;<i> Hope this helps,
</I>&gt;<i> Jean-Paul
</I>

Thankx a lot.

I'll probably rethink everything in my project hehe, but i'm glad I asked !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20131024/5b16fe65/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060103.html">[Twisted-Python] epoll keep sharing state between process even after fork.
</A></li>
	<LI>Next message (by thread): <A HREF="060075.html">[Twisted-Python] epoll keep sharing state between process	even	after fork.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60105">[ date ]</a>
              <a href="thread.html#60105">[ thread ]</a>
              <a href="subject.html#60105">[ subject ]</a>
              <a href="author.html#60105">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
