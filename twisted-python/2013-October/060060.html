<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted as a full solution for web hosting [WSGI + other]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20as%20a%20full%20solution%20for%20web%20hosting%0A%20%5BWSGI%20%2B%20other%5D&In-Reply-To=%3C20131022123850.8627.826066756.divmod.xquotient.29%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060059.html">
   <LINK REL="Next"  HREF="060061.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted as a full solution for web hosting [WSGI + other]</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20as%20a%20full%20solution%20for%20web%20hosting%0A%20%5BWSGI%20%2B%20other%5D&In-Reply-To=%3C20131022123850.8627.826066756.divmod.xquotient.29%40top%3E"
       TITLE="[Twisted-Python] Twisted as a full solution for web hosting [WSGI + other]">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Oct 22 06:38:50 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060059.html">[Twisted-Python] Twisted as a full solution for web hosting	[WSGI + other]
</A></li>
        <LI>Next message (by thread): <A HREF="060061.html">[Twisted-Python] Twisted as a full solution for web hosting [WSGI + other]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60060">[ date ]</a>
              <a href="thread.html#60060">[ thread ]</a>
              <a href="subject.html#60060">[ subject ]</a>
              <a href="author.html#60060">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07:41 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">orestis at orestis.gr</A> wrote:
&gt;<i>On 21 Οκτ 2013, at 10:32 μ.μ., Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>On Oct 20, 2013, at 2:21 AM, Orestis Markou &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">orestis at orestis.gr</A>&gt; 
</I>&gt;&gt;<i>wrote:
</I>&gt;&gt;&gt;<i>Hello,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Short form of the question:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Are people using Twisted to host WSGI applications AND serve static 
</I>&gt;&gt;&gt;<i>files AND replace celery/redis/other?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I'm not personally using it as a WSGI host, but otherwise, yes, a 
</I>&gt;&gt;<i>full-stack application container speaking multiple protocols.
</I>&gt;<i>
</I>&gt;<i>Any pointers on how to best use this in combination with WSGI/Django? 
</I>&gt;<i>In the past I had a combination of twisted-web (for /static and /media) 
</I>&gt;<i>and wsgi host (for everything else), all running under the same 
</I>&gt;<i>Service. Essentially:
</I>&gt;<i>
</I>&gt;<i>os.environ['DJANGO_SETTINGS_MODULE'] = 'myproject.settings'
</I>&gt;<i>application = django.core.handlers.wsgi.WSGIHandler()
</I>&gt;<i>
</I>&gt;<i>wsgi_resource = WSGIResource(reactor, reactor.getThreadPool(), 
</I>&gt;<i>application)
</I>&gt;<i>resource = Root(wsgi_resource)
</I>&gt;<i># this could probably be automatically inferred from settings.py
</I>&gt;<i>resource.putChild('static', File(...))
</I>&gt;<i>resource.putChild('uploaded', File(...))
</I>&gt;<i># other stuff
</I>&gt;<i>site = server.Site(resource)
</I>&gt;<i>reactor.listenTCP(8000, site)
</I>&gt;<i>reactor.run()
</I>
This looks about like I'd expect (if my guess that `Root` is an 
`IResource` that knows how to split dispatch between the WSGI resource 
and its other children).  If you have any suggestions for improving the 
experience please share them. :)
&gt;<i>[snip]
</I>&gt;<i>
</I>&gt;<i>Here's a thought experiment - I'd like to keep URL routing 100% in 
</I>&gt;<i>Django for anything that hits the DB. I have some code that needs to 
</I>&gt;<i>spawn an external process to generate an image on-demand (with a layer 
</I>&gt;<i>of caching on top). In the past I defined a Twisted.Web handler for 
</I>&gt;<i>that. Could I now expose an internal API that (through Crochet?) do the 
</I>&gt;<i>spawnProcess dance and come back with image data that Django could then 
</I>&gt;<i>handle internally (store in a file, whatever). How would the threaded 
</I>&gt;<i>WSGI container deal with the blocking request (not really blocking, but 
</I>&gt;<i>that request would stall until the Deferred would be fired).
</I>
It will produce roughly the same results as you'd get if you used any 
other WSGI container: one of the threads in the thread pool will be kept 
unavailable as it waits for the result.  This will have the usual 
consequence: if your threadpool has a max of N threads and you receive N 
requests that need to do this, the N+1th request that needs to be 
handled by the WSGI part of your server won't be handled until one of 
the previous requests completes (completion frees up one thread which is 
then used to handle the N+1th request).

The only difference might be that since you also have non-WSGI content 
(all of your static content) even when your thread pool is completely in 
use requests for static content will still be satisfied right away. 
However, if you previously had a WSGI+lighttpd/whatever then you 
probably already had this property as well.

Put another way, Twisted's WSGI container is still just a WSGI 
container.  Fortunately Twisted has other pieces aside from a WSGI 
container. :)

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060059.html">[Twisted-Python] Twisted as a full solution for web hosting	[WSGI + other]
</A></li>
	<LI>Next message (by thread): <A HREF="060061.html">[Twisted-Python] Twisted as a full solution for web hosting [WSGI + other]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60060">[ date ]</a>
              <a href="thread.html#60060">[ thread ]</a>
              <a href="subject.html#60060">[ subject ]</a>
              <a href="author.html#60060">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
