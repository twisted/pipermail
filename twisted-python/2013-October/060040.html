<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] serial communication - getting started
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20serial%20communication%20-%20getting%20started&In-Reply-To=%3CCAH7aJjL6HpfS9AvAxUugaSHU6BqYOphc1w6i51Yct-TOL0E2LQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] serial communication - getting started</H1>
    <B>Robert Voigtl√§nder</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20serial%20communication%20-%20getting%20started&In-Reply-To=%3CCAH7aJjL6HpfS9AvAxUugaSHU6BqYOphc1w6i51Yct-TOL0E2LQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] serial communication - getting started">r.voigtlaender at gmail.com
       </A><BR>
    <I>Mon Oct 21 05:35:44 MDT 2013</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60040">[ date ]</a>
              <a href="thread.html#60040">[ thread ]</a>
              <a href="subject.html#60040">[ subject ]</a>
              <a href="author.html#60040">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am new to Python. Trying to figure out how to use the serial port I
started with pyserial.
Works - but the CPU usage on my Raspberry Pi is at about 30% just for
reading the port. Before I started to optimize the code it was even 90+%.

So I tried twisted - and boom down to 3-4%. Even though twisted also uses
pyserial (as far as I read) - obviously better than I do.

So far so good.
With copy&amp;paste from the internet and some editing I got the PI to read
from my Arduino. (code below)
But the code seems to be blocking. I tried putting things in a thread - but
I must have done something wrong. It is still blocking.

I also don't know how to write.
Does s.write(&quot;test&quot;) work?

Would be great if someone could help me out here.

Thanks a lot.
Robert



import logging
from twisted.protocols.basic import LineReceiver
from twisted.protocols.basic import LineReceiver

from twisted.internet import reactor
from twisted.internet.serialport import SerialPort
from twisted.python import usage
import thread

class THOptions(usage.Options):
    optParameters = [
        ['baudrate', 'b', 115200, 'Serial baudrate'],
        ['port', 'p', '/dev/ttyACM0', 'Serial port to use'],]


class Echo(LineReceiver):
    def processData(self, data):
        print(data)

    def lineReceived(self, line):
        try:
            data = line.rstrip()
            #logging.debug(data)
            self.processData(data)
            #print(line.rstrip())
            #pass
        except ValueError:
            logging.error('Unable to parse data %s' % line)
            return

def SerialInit():
    o = THOptions()
    try:
        o.parseOptions()
    except usage.UsageError, errortext:
        logging.error('%s %s' % (sys.argv[0], errortext))
        logging.info('Try %s --help for usage details' % sys.argv[0])
        raise SystemExit, 1

    baudrate = o.opts['baudrate'] #int('115200')
    port = o.opts['port']
    logging.debug('About to open port %s' % port)
    s = SerialPort(Echo(), port, reactor, baudrate=baudrate)
    reactor.run()


thread.start_new_thread(SerialInit())

if __name__ == '__main__':
    print(&quot;-----&quot;)
    s.write('123456789')
    #s.write(&quot;\n&quot;)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20131021/e8ca46ec/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60040">[ date ]</a>
              <a href="thread.html#60040">[ thread ]</a>
              <a href="subject.html#60040">[ subject ]</a>
              <a href="author.html#60040">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
