<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] epoll keep sharing state between process even after fork.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20epoll%20keep%20sharing%20state%20between%20process%20even%0A%20after%20fork.&In-Reply-To=%3C5267FBA7.2050606%40imperial.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="027611.html">
   <LINK REL="Next"  HREF="060076.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] epoll keep sharing state between process even after fork.</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20epoll%20keep%20sharing%20state%20between%20process%20even%0A%20after%20fork.&In-Reply-To=%3C5267FBA7.2050606%40imperial.ac.uk%3E"
       TITLE="[Twisted-Python] epoll keep sharing state between process even after fork.">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Wed Oct 23 10:39:03 MDT 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027611.html">[Twisted-Python] epoll keep sharing state between process even	after fork.
</A></li>
        <LI>Next message (by thread): <A HREF="060076.html">[Twisted-Python] epoll keep sharing state between process even after fork.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60074">[ date ]</a>
              <a href="thread.html#60074">[ thread ]</a>
              <a href="subject.html#60074">[ subject ]</a>
              <a href="author.html#60074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/10/13 16:46, Flint wrote:
&gt;<i> Hi everybody
</I>&gt;<i>
</I>&gt;<i> I a came across a surprising problem when using the epoll based reactor.
</I>&gt;<i> (ticket here <A HREF="https://twistedmatrix.com/trac/ticket/6796">https://twistedmatrix.com/trac/ticket/6796</A>)
</I>&gt;<i>
</I>&gt;<i> As you can see on the ticket, the epoll object seems to share some state
</I>&gt;<i> even after fork.
</I>&gt;<i> Which means even after having forked the process, making some changes to
</I>&gt;<i> the inherited epoll object in one process may impact the one existing in
</I>&gt;<i> another process !
</I>&gt;<i>
</I>&gt;<i> This problem is only related to epoll based reactor, poll and select
</I>&gt;<i> behave correctly.
</I>&gt;<i> I'm aware that some may say that this in not a twisted related problem
</I>&gt;<i> (but an epoll issue), but I'm addressing my question here to try to
</I>&gt;<i> figure out what would be the best workaround for this problem in a
</I>&gt;<i> twisted based project ?
</I>
The problem is that you're sharing the epoll object (and thus the 
underlying epoll FD, and associated state) with the multiprocessing 
child processes.

Either:

  1. Don't use multiprocessing
  2. Arrange for the epoll object (or FD) to be closed after fork, but 
before exec, so that the child process can't fiddle with it
  3. Create the epoll object after starting the multiprocessing children

IMHO Twisted and multiprocessing are not good together.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027611.html">[Twisted-Python] epoll keep sharing state between process even	after fork.
</A></li>
	<LI>Next message (by thread): <A HREF="060076.html">[Twisted-Python] epoll keep sharing state between process even after fork.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60074">[ date ]</a>
              <a href="thread.html#60074">[ thread ]</a>
              <a href="subject.html#60074">[ subject ]</a>
              <a href="author.html#60074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
