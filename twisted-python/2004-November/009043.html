<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: Trouble with pb.CopyableFailure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Trouble%20with%20pb.CopyableFailure&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009034.html">
   <LINK REL="Next"  HREF="009044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: Trouble with pb.CopyableFailure</H1>
    <B>David Bolen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20Trouble%20with%20pb.CopyableFailure&In-Reply-To="
       TITLE="[Twisted-Python] Re: Trouble with pb.CopyableFailure">db3l at fitlinxx.com
       </A><BR>
    <I>Thu Nov 11 14:38:30 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009034.html">[Twisted-Python] Trouble with pb.CopyableFailure
</A></li>
        <LI>Next message: <A HREF="009044.html">[Twisted-Python] Re: Trouble with pb.CopyableFailure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9043">[ date ]</a>
              <a href="thread.html#9043">[ thread ]</a>
              <a href="subject.html#9043">[ subject ]</a>
              <a href="author.html#9043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Justin Johnson &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justinjohnson at gmail.com</A>&gt; writes:

&gt;<i> Does anyone know what I'm doing wrong here?  I've searched through the
</I>&gt;<i> docs but don't see specific examples of how to use CopyableFailure, so
</I>&gt;<i> I made the assumption that I could raise a CopyableFailure instead of
</I>&gt;<i> specifically writing code to send the failure back to the client.  Any
</I>&gt;<i> help is appreciated.
</I>
I don't think CopyableFailure is supported in that manner.  The
support for returning information on remote exceptions is in pb.py in
the _recvMessage function of the Broker class.  In general:

* If the exception is a subclass of pb.Error then it is wrapped in a
  CopyableFailure (using the exception information) and without any
  local logging of the exception.
* For any other exception a CopyableFailure is created using the current
  exception information (sys.exc_info()) and that is sent back along
  with local logging of the exception.

The use of CopyableFailure is pretty much an internal implementation detail
in order to get the Failure instance across to the remote client, and
doesn't appear to be designed to be subclassed.

So it depends on what you're trying to do.  If you just want to get
the failure indication back to your client, you should just be able to
raise any old exception (subclass pb.Error if you don't want a local
log about the exception), and it will get passed over automatically,
and show up as a Failure object suitable for use with errbacks,
failure.trap() and so on.

If however you specifically want to get across your custom exception
with additional information, you'll have some issues with or without
CopyableFailure, since the eventual CopyableFailure that such remote
transmissions get wrapped in transmits the actual exception instance
turned into a string name and without any local exception instance
data.  It still works fine with twisted code for errbacks and
failure.trap() since that code knows how to match up a failure by
class name, but it bit us when we specifically wanted the remote side
to have access to a functioning custom exception object with
additional attributes.  While we haven't done it yet, the only way we
anticipate to handle this is with some local modifications to how the
exceptions are transmitted through the CopyableFailure process (either
simply pickling the exception in our case since we understand our
security environment, or reusing existing jelly registration for the
underlying exception class).

-- David



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009034.html">[Twisted-Python] Trouble with pb.CopyableFailure
</A></li>
	<LI>Next message: <A HREF="009044.html">[Twisted-Python] Re: Trouble with pb.CopyableFailure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9043">[ date ]</a>
              <a href="thread.html#9043">[ thread ]</a>
              <a href="subject.html#9043">[ subject ]</a>
              <a href="author.html#9043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
