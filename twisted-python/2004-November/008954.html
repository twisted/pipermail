<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] callLater(0) is A BIG LIE
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20callLater%280%29%20is%20A%20BIG%20LIE&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="008955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] callLater(0) is A BIG LIE</H1>
    <B>Jonathan Simms</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20callLater%280%29%20is%20A%20BIG%20LIE&In-Reply-To="
       TITLE="[Twisted-Python] callLater(0) is A BIG LIE">slyphon at twistedmatrix.com
       </A><BR>
    <I>Mon Nov  1 05:41:53 EST 2004</I>
    <P><UL>
        
        <LI>Next message: <A HREF="008955.html">[Twisted-Python] callLater(0) is A BIG LIE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8954">[ date ]</a>
              <a href="thread.html#8954">[ thread ]</a>
              <a href="subject.html#8954">[ subject ]</a>
              <a href="author.html#8954">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'd like to offer some reflections on the reactor and facilitate some
conversation on a subject that's been causing me much frustration:

    the twisted idiom, &quot;callLater(0)&quot;

While it seems that this is a DelayedCall, it really is a lie. It has
nothing to do with time at all, it is a very *convenient* lie that we
all have accepted, but is a lie nonetheless.

We all know this means &quot;call function f in the next reactor iteration&quot;, 
but the semantics of callLater have to do with time, not reactor
iterations. In fact, in the API documentation, there is no reference to
reactor iterations, at all.

I think the implicit nature of this idiom is bad.

For example in tcp.py:377

    reactor.callLater(0, self.failIfNotConnected, error)

what this really means is: &quot;run this method at the beginning of the next 
reactor iteration, if my socket isn't connected, that method will fail&quot;

Now, if the reactor were a &quot;pure&quot; event loop (in the way libevent is,
with no scheduling), callLater(0) would mean, &quot;Call function f *ASAP*
after this function exits&quot;. There would be no guarantees as to what
would get run next.

The workaround (in terms of my implementation) is to emulate this
scheduling behavior the select reactor provides, but this kills some of
the performance gains one gets from using libevent.  When I asked the
libevent guys about this, they said it seemed like a brokenness of our
library.

I guess the question is, is there a better way for twisted to handle
this type of thing? Would it be more to our advantage to make scheduling
a different abstraction with explicit well-defined methods?

-Jonathan




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="008955.html">[Twisted-Python] callLater(0) is A BIG LIE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8954">[ date ]</a>
              <a href="thread.html#8954">[ thread ]</a>
              <a href="subject.html#8954">[ subject ]</a>
              <a href="author.html#8954">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
