From trac at twistedmatrix.com  Sun Mar  1 00:05:16 2020
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 01 Mar 2020 07:05:16 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1583046316.87.246775091121898898@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20200301/98a2d580/attachment.htm>

From trac at twistedmatrix.com  Sun Mar  8 00:05:17 2020
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 08 Mar 2020 07:05:17 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1583651117.13.6790591251350620866@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20200308/d7da60c5/attachment.htm>

From hawkowl at atleastfornow.net  Mon Mar  9 03:39:02 2020
From: hawkowl at atleastfornow.net (Amber Brown (hawkowl))
Date: Mon, 9 Mar 2020 20:39:02 +1100
Subject: [Twisted-Python] Twisted 20.3.0rc1 Release Candidate Announcement
Message-ID: <d3f221cf-ae48-fee8-9389-0ba8b02c24ee@atleastfornow.net>

It's time for another Twisted release!

Twisted 20.3.0rc1 brings the following:

- curve25519-sha256 key exchange algorithm support in Conch.
- "openssh-key-v1" key format support in Conch.
- Security fixes to twisted.web, including preventing request smuggling 
attacks and rejecting malformed headers. CVE-2020-10108 and 
CVE-2020-10109 were assigned for these issues, see the NEWS file for 
full details.
- `twist dns --secondary` now works on Python 3.
- The deprecation of twisted.news.
- ...and various other fixes, with 28 tickets closed in total.

You can get the tarball and the NEWS file at 
https://twistedmatrix.com/Releases/rc/20.3.0rc1/ , or you can try it out 
from PyPI:

      python -m pip install Twisted==20.3.0rc1

Please test it, and let me know how your applications fare, good or bad! 
If nothing comes up, 20.3 will release very soon.

Twisted regards,

Amber Brown (hawkowl)


From glyph at twistedmatrix.com  Sat Mar 14 01:03:12 2020
From: glyph at twistedmatrix.com (Glyph)
Date: Sat, 14 Mar 2020 00:03:12 -0700
Subject: [Twisted-Python] Twisted 20.3.0rc1 Release Candidate
 Announcement
In-Reply-To: <d3f221cf-ae48-fee8-9389-0ba8b02c24ee@atleastfornow.net>
References: <d3f221cf-ae48-fee8-9389-0ba8b02c24ee@atleastfornow.net>
Message-ID: <E842A96B-A70F-480D-86CF-6DF4C15C978C@twistedmatrix.com>

Thanks for doing another release, Amber!  Glad to see more important HTTP security issues get squashed; looking forward to seeing this on store shelves soon!

-g

> On Mar 9, 2020, at 2:39 AM, Amber Brown (hawkowl) <hawkowl at atleastfornow.net> wrote:
> 
> It's time for another Twisted release!
> 
> Twisted 20.3.0rc1 brings the following:
> 
> - curve25519-sha256 key exchange algorithm support in Conch.
> - "openssh-key-v1" key format support in Conch.
> - Security fixes to twisted.web, including preventing request smuggling attacks and rejecting malformed headers. CVE-2020-10108 and CVE-2020-10109 were assigned for these issues, see the NEWS file for full details.
> - `twist dns --secondary` now works on Python 3.
> - The deprecation of twisted.news.
> - ...and various other fixes, with 28 tickets closed in total.
> 
> You can get the tarball and the NEWS file at https://twistedmatrix.com/Releases/rc/20.3.0rc1/ , or you can try it out from PyPI:
> 
>     python -m pip install Twisted==20.3.0rc1
> 
> Please test it, and let me know how your applications fare, good or bad! If nothing comes up, 20.3 will release very soon.
> 
> Twisted regards,
> 
> Amber Brown (hawkowl)
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


From trac at twistedmatrix.com  Sun Mar 15 00:05:16 2020
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 15 Mar 2020 06:05:16 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1584252316.5.3845469410909378931@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20200315/0ec83e03/attachment.htm>

From richard at matrix.org  Wed Mar 18 05:42:57 2020
From: richard at matrix.org (Richard van der Hoff)
Date: Wed, 18 Mar 2020 11:42:57 +0000
Subject: [Twisted-Python] Twisted 20.3.0rc1 Release Candidate
 Announcement
In-Reply-To: <E842A96B-A70F-480D-86CF-6DF4C15C978C@twistedmatrix.com>
References: <d3f221cf-ae48-fee8-9389-0ba8b02c24ee@atleastfornow.net>
 <E842A96B-A70F-480D-86CF-6DF4C15C978C@twistedmatrix.com>
Message-ID: <2e39b0e5-e6e4-8ac6-2f5e-692cf7dd0558@matrix.org>

Hi Amber and team!

Firstly, I can confirm that I've been using 20.3.0rc1 on a production 
server, and all seems fine.

So... I'm keen to see a final release, particularly in light of the 
request smuggling attacks. Any idea what sort of timeframe looks likely?

R

On 14/03/2020 07:03, Glyph wrote:
> Thanks for doing another release, Amber!  Glad to see more important HTTP security issues get squashed; looking forward to seeing this on store shelves soon!
> 
> -g
> 
>> On Mar 9, 2020, at 2:39 AM, Amber Brown (hawkowl) <hawkowl at atleastfornow.net> wrote:
>>
>> It's time for another Twisted release!
>>
>> Twisted 20.3.0rc1 brings the following:
>>
>> - curve25519-sha256 key exchange algorithm support in Conch.
>> - "openssh-key-v1" key format support in Conch.
>> - Security fixes to twisted.web, including preventing request smuggling attacks and rejecting malformed headers. CVE-2020-10108 and CVE-2020-10109 were assigned for these issues, see the NEWS file for full details.
>> - `twist dns --secondary` now works on Python 3.
>> - The deprecation of twisted.news.
>> - ...and various other fixes, with 28 tickets closed in total.
>>
>> You can get the tarball and the NEWS file at https://twistedmatrix.com/Releases/rc/20.3.0rc1/ , or you can try it out from PyPI:
>>
>>      python -m pip install Twisted==20.3.0rc1
>>
>> Please test it, and let me know how your applications fare, good or bad! If nothing comes up, 20.3 will release very soon.
>>
>> Twisted regards,
>>
>> Amber Brown (hawkowl)
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 


From glyph at twistedmatrix.com  Fri Mar 20 00:48:14 2020
From: glyph at twistedmatrix.com (Glyph)
Date: Thu, 19 Mar 2020 23:48:14 -0700
Subject: [Twisted-Python] Twisted 20.3.0rc1 Release Candidate
 Announcement
In-Reply-To: <2e39b0e5-e6e4-8ac6-2f5e-692cf7dd0558@matrix.org>
References: <d3f221cf-ae48-fee8-9389-0ba8b02c24ee@atleastfornow.net>
 <E842A96B-A70F-480D-86CF-6DF4C15C978C@twistedmatrix.com>
 <2e39b0e5-e6e4-8ac6-2f5e-692cf7dd0558@matrix.org>
Message-ID: <D61B9324-1840-4E6E-B382-5DFCEEB6F4D1@twistedmatrix.com>

Hi Richard!

Thanks for your testing!

One thing I always like to remind people is that if you want a particular ticket to get addressed quickly (in this case, the release) one thing you can do is to go to https://twisted.reviews/ <https://twisted.reviews/> and review a couple of project-member-submitted contributions; this drains the review queue and makes it more likely that project members with review privileges will review the thing you want reviewed, whenever they have spare cycles.

-glyph

> On Mar 18, 2020, at 4:42 AM, Richard van der Hoff <richard at matrix.org> wrote:
> 
> Hi Amber and team!
> 
> Firstly, I can confirm that I've been using 20.3.0rc1 on a production server, and all seems fine.
> 
> So... I'm keen to see a final release, particularly in light of the request smuggling attacks. Any idea what sort of timeframe looks likely?
> 
> R
> 
> On 14/03/2020 07:03, Glyph wrote:
>> Thanks for doing another release, Amber!  Glad to see more important HTTP security issues get squashed; looking forward to seeing this on store shelves soon!
>> -g
>>> On Mar 9, 2020, at 2:39 AM, Amber Brown (hawkowl) <hawkowl at atleastfornow.net> wrote:
>>> 
>>> It's time for another Twisted release!
>>> 
>>> Twisted 20.3.0rc1 brings the following:
>>> 
>>> - curve25519-sha256 key exchange algorithm support in Conch.
>>> - "openssh-key-v1" key format support in Conch.
>>> - Security fixes to twisted.web, including preventing request smuggling attacks and rejecting malformed headers. CVE-2020-10108 and CVE-2020-10109 were assigned for these issues, see the NEWS file for full details.
>>> - `twist dns --secondary` now works on Python 3.
>>> - The deprecation of twisted.news.
>>> - ...and various other fixes, with 28 tickets closed in total.
>>> 
>>> You can get the tarball and the NEWS file at https://twistedmatrix.com/Releases/rc/20.3.0rc1/ , or you can try it out from PyPI:
>>> 
>>>     python -m pip install Twisted==20.3.0rc1
>>> 
>>> Please test it, and let me know how your applications fare, good or bad! If nothing comes up, 20.3 will release very soon.
>>> 
>>> Twisted regards,
>>> 
>>> Amber Brown (hawkowl)
>>> 
>>> _______________________________________________
>>> Twisted-Python mailing list
>>> Twisted-Python at twistedmatrix.com
>>> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20200319/a9797b4d/attachment.htm>

From hawkowl at atleastfornow.net  Fri Mar 20 07:20:53 2020
From: hawkowl at atleastfornow.net (Amber Brown (hawkowl))
Date: Sat, 21 Mar 2020 00:20:53 +1100
Subject: [Twisted-Python] Twisted 20.3.0 Release Announcement
Message-ID: <6b77419a-c730-ca68-f34c-0220200ecce6@atleastfornow.net>

On behalf of Twisted Matrix Laboratories, I am honoured to announce the 
release of Twisted 20.3! The highlights of this release are:

- curve25519-sha256 key exchange algorithm support in Conch.
- "openssh-key-v1" key format support in Conch.
- Security fixes to twisted.web, including preventing request smuggling 
attacks and rejecting malformed headers. CVE-2020-10108 and 
CVE-2020-10109 were assigned for these issues, see the NEWS file for 
full details.
- `twist dns --secondary` now works on Python 3.
- The deprecation of twisted.news.
- ...and various other fixes, with 28 tickets closed in total.

You can find the downloads at <https://pypi.python.org/pypi/Twisted> (or 
alternatively <http://twistedmatrix.com/trac/wiki/Downloads>). The NEWS 
file is also available at 
<https://github.com/twisted/twisted/blob/twisted-20.3.0/NEWS.rst>.

Many thanks to everyone who had a part in this release - the supporters 
of the Twisted Software Foundation, the developers who contributed code 
as well as documentation, and all the people building great things with 
Twisted!

- hawkowl


From richard at matrix.org  Fri Mar 20 07:26:12 2020
From: richard at matrix.org (Richard van der Hoff)
Date: Fri, 20 Mar 2020 13:26:12 +0000
Subject: [Twisted-Python] Twisted 20.3.0rc1 Release Candidate
 Announcement
In-Reply-To: <D61B9324-1840-4E6E-B382-5DFCEEB6F4D1@twistedmatrix.com>
References: <d3f221cf-ae48-fee8-9389-0ba8b02c24ee@atleastfornow.net>
 <E842A96B-A70F-480D-86CF-6DF4C15C978C@twistedmatrix.com>
 <2e39b0e5-e6e4-8ac6-2f5e-692cf7dd0558@matrix.org>
 <D61B9324-1840-4E6E-B382-5DFCEEB6F4D1@twistedmatrix.com>
Message-ID: <44d3770a-1392-7565-b8ac-78eb89c3c2b5@matrix.org>

Noted. And thanks to Amber for cutting the release!

On 20/03/2020 06:48, Glyph wrote:
> Hi Richard!
>
> Thanks for your testing!
>
> One thing I always like to remind people is that if you want a 
> particular ticket to get addressed quickly (in this case, the release) 
> one thing you can do is to go to https://twisted.reviews/ and review a 
> couple of project-member-submitted contributions; this drains the 
> review queue and makes it more likely that project members with review 
> privileges will review the thing you want reviewed, whenever they have 
> spare cycles.
>
> -glyph
>
>> On Mar 18, 2020, at 4:42 AM, Richard van der Hoff <richard at matrix.org 
>> <mailto:richard at matrix.org>> wrote:
>>
>> Hi Amber and team!
>>
>> Firstly, I can confirm that I've been using 20.3.0rc1 on a production 
>> server, and all seems fine.
>>
>> So... I'm keen to see a final release, particularly in light of the 
>> request smuggling attacks. Any idea what sort of timeframe looks likely?
>>
>> R
>>
>> On 14/03/2020 07:03, Glyph wrote:
>>> Thanks for doing another release, Amber!  Glad to see more important 
>>> HTTP security issues get squashed; looking forward to seeing this on 
>>> store shelves soon!
>>> -g
>>>> On Mar 9, 2020, at 2:39 AM, Amber Brown (hawkowl) 
>>>> <hawkowl at atleastfornow.net <mailto:hawkowl at atleastfornow.net>> wrote:
>>>>
>>>> It's time for another Twisted release!
>>>>
>>>> Twisted 20.3.0rc1 brings the following:
>>>>
>>>> - curve25519-sha256 key exchange algorithm support in Conch.
>>>> - "openssh-key-v1" key format support in Conch.
>>>> - Security fixes to twisted.web, including preventing request 
>>>> smuggling attacks and rejecting malformed headers. CVE-2020-10108 
>>>> and CVE-2020-10109 were assigned for these issues, see the NEWS 
>>>> file for full details.
>>>> - `twist dns --secondary` now works on Python 3.
>>>> - The deprecation of twisted.news.
>>>> - ...and various other fixes, with 28 tickets closed in total.
>>>>
>>>> You can get the tarball and the NEWS file at 
>>>> https://twistedmatrix.com/Releases/rc/20.3.0rc1/ , or you can try 
>>>> it out from PyPI:
>>>>
>>>>     python -m pip install Twisted==20.3.0rc1
>>>>
>>>> Please test it, and let me know how your applications fare, good or 
>>>> bad! If nothing comes up, 20.3 will release very soon.
>>>>
>>>> Twisted regards,
>>>>
>>>> Amber Brown (hawkowl)
>>>>
>>>> _______________________________________________
>>>> Twisted-Python mailing list
>>>> Twisted-Python at twistedmatrix.com 
>>>> <mailto:Twisted-Python at twistedmatrix.com>
>>>> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>> _______________________________________________
>>> Twisted-Python mailing list
>>> Twisted-Python at twistedmatrix.com 
>>> <mailto:Twisted-Python at twistedmatrix.com>
>>> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>>
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com 
>> <mailto:Twisted-Python at twistedmatrix.com>
>> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>
>
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20200320/de2b8d45/attachment-0001.htm>

From glyph at twistedmatrix.com  Fri Mar 20 16:24:51 2020
From: glyph at twistedmatrix.com (Glyph)
Date: Fri, 20 Mar 2020 15:24:51 -0700
Subject: [Twisted-Python] Twisted 20.3.0 Release Announcement
In-Reply-To: <6b77419a-c730-ca68-f34c-0220200ecce6@atleastfornow.net>
References: <6b77419a-c730-ca68-f34c-0220200ecce6@atleastfornow.net>
Message-ID: <70BD2661-11E6-4E87-8838-2F5E554A3D3F@twistedmatrix.com>

Thank you Amber!

I'd encourage all Twisted users to upgrade, since those CVEs might be somewhat serious for web applications.

-g

> On Mar 20, 2020, at 6:20 AM, Amber Brown (hawkowl) <hawkowl at atleastfornow.net> wrote:
> 
> On behalf of Twisted Matrix Laboratories, I am honoured to announce the release of Twisted 20.3! The highlights of this release are:
> 
> - curve25519-sha256 key exchange algorithm support in Conch.
> - "openssh-key-v1" key format support in Conch.
> - Security fixes to twisted.web, including preventing request smuggling attacks and rejecting malformed headers. CVE-2020-10108 and CVE-2020-10109 were assigned for these issues, see the NEWS file for full details.
> - `twist dns --secondary` now works on Python 3.
> - The deprecation of twisted.news.
> - ...and various other fixes, with 28 tickets closed in total.
> 
> You can find the downloads at <https://pypi.python.org/pypi/Twisted> (or alternatively <http://twistedmatrix.com/trac/wiki/Downloads>). The NEWS file is also available at <https://github.com/twisted/twisted/blob/twisted-20.3.0/NEWS.rst>.
> 
> Many thanks to everyone who had a part in this release - the supporters of the Twisted Software Foundation, the developers who contributed code as well as documentation, and all the people building great things with Twisted!
> 
> - hawkowl
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


From trac at twistedmatrix.com  Sun Mar 22 00:05:16 2020
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 22 Mar 2020 06:05:16 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1584857116.61.2685960893992119146@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20200322/5aa82f77/attachment.htm>

From hawkowl at atleastfornow.net  Mon Mar 23 13:12:54 2020
From: hawkowl at atleastfornow.net (Amber Brown (hawkowl))
Date: Tue, 24 Mar 2020 06:12:54 +1100
Subject: [Twisted-Python] Twisted 20.3.0 Release Announcement
In-Reply-To: <6b77419a-c730-ca68-f34c-0220200ecce6@atleastfornow.net>
References: <6b77419a-c730-ca68-f34c-0220200ecce6@atleastfornow.net>
Message-ID: <883fc4cd-3ce8-ca27-a68b-c8f95202f467@atleastfornow.net>


On 21/3/20 12:20 am, Amber Brown (hawkowl) wrote:
> On behalf of Twisted Matrix Laboratories, I am honoured to announce the 
> release of Twisted 20.3!

As an addendum, as discussed earlier in the year on Twisted's mailing 
list, this release is the final one to support Python 2.7. The next 
version of Twisted will be Python 3.5+ only.

- Amber


From richard at matrix.org  Mon Mar 23 13:45:18 2020
From: richard at matrix.org (Richard van der Hoff)
Date: Mon, 23 Mar 2020 19:45:18 +0000
Subject: [Twisted-Python] IReactorTime.seconds: epoch time or no?
Message-ID: <74d9b7a0-e3f1-2d60-ae49-fea64adf405b@matrix.org>

HTTPFactory seems to think that `reactor.seconds` is reliably an epoch 
time (see 
https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L3110, 
etc).

On the other hand. AsyncioSelectorReactor.seconds() returns a monotonic 
time:

python3 -c 'from twisted.internet import asyncioreactor; 
print(asyncioreactor.AsyncioSelectorReactor().seconds())'
41116.763594412

One of these is wrong... I think it's HTTPFactory making bad 
assumptions, but can anyone confirm the intention here?

R



From hawkowl at atleastfornow.net  Mon Mar 23 14:24:21 2020
From: hawkowl at atleastfornow.net (Amber Brown (hawkowl))
Date: Tue, 24 Mar 2020 07:24:21 +1100
Subject: [Twisted-Python] IReactorTime.seconds: epoch time or no?
In-Reply-To: <74d9b7a0-e3f1-2d60-ae49-fea64adf405b@matrix.org>
References: <74d9b7a0-e3f1-2d60-ae49-fea64adf405b@matrix.org>
Message-ID: <64050e5b-505e-12fb-4ad5-704323b5b64c@atleastfornow.net>



On 24/3/20 6:45 am, Richard van der Hoff wrote:
> HTTPFactory seems to think that `reactor.seconds` is reliably an epoch 
> time (see 
> https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L3110, 
> etc).
> 
> On the other hand. AsyncioSelectorReactor.seconds() returns a monotonic 
> time:
> 
> python3 -c 'from twisted.internet import asyncioreactor; 
> print(asyncioreactor.AsyncioSelectorReactor().seconds())'
> 41116.763594412
> 
> One of these is wrong... I think it's HTTPFactory making bad 
> assumptions, but can anyone confirm the intention here?


It's a bug in asyncioreactor. IReactorTime defines it as "current time 
in seconds", which _probably_ should be defined nicer 
(https://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorTime.html#seconds) 
but is generally epoch time.

asyncioreactor does have a few problems with time:

https://twistedmatrix.com/trac/ticket/9611
https://twistedmatrix.com/trac/ticket/9780

I can't find a bug for this issue, though, although I'm almost sure I've 
seen it before... so, if you could file one (and maybe a patch to fix 
it!) then that would be appreciated.

- Amber


From twm at freecog.net  Tue Mar 24 17:05:02 2020
From: twm at freecog.net (Tom Most)
Date: Tue, 24 Mar 2020 16:05:02 -0700
Subject: [Twisted-Python] IReactorTime.seconds: epoch time or no?
In-Reply-To: <64050e5b-505e-12fb-4ad5-704323b5b64c@atleastfornow.net>
References: <74d9b7a0-e3f1-2d60-ae49-fea64adf405b@matrix.org>
 <64050e5b-505e-12fb-4ad5-704323b5b64c@atleastfornow.net>
Message-ID: <0bbb2d6a-363a-488d-bda2-847463486b8f@www.fastmail.com>

I'll offer a dissenting opinion:

I've worked on systems where the reactor is patched to use monotonic time. (This is essential on embedded systems that lack a real-time clock.) I'm not aware of this causing any issues, and it fixed real problems.

HTTPFactory is quite unusual in assuming that it is epoch time. Most parts of Twisted that require wall time call `time.time()` or equivalent directly. IMO HTTPFactory is in error here, and this is simply a bug. We should change HTTPFactory to use `time.time()` directly.

Since the time base of IReactorTime.seconds() hasn't ever been clearly defined, I think that we should really go the other way: use `time.monotonic()` by default where possible. (Or, more realistically, make it an option and maybe the default.)

---Tom

On Mon, Mar 23, 2020, at 1:24 PM, Amber Brown (hawkowl) wrote:
> 
> 
> On 24/3/20 6:45 am, Richard van der Hoff wrote:
> > HTTPFactory seems to think that `reactor.seconds` is reliably an epoch 
> > time (see 
> > https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L3110, 
> > etc).
> > 
> > On the other hand. AsyncioSelectorReactor.seconds() returns a monotonic 
> > time:
> > 
> > python3 -c 'from twisted.internet import asyncioreactor; 
> > print(asyncioreactor.AsyncioSelectorReactor().seconds())'
> > 41116.763594412
> > 
> > One of these is wrong... I think it's HTTPFactory making bad 
> > assumptions, but can anyone confirm the intention here?
> 
> 
> It's a bug in asyncioreactor. IReactorTime defines it as "current time 
> in seconds", which _probably_ should be defined nicer 
> (https://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorTime.html#seconds) 
> but is generally epoch time.
> 
> asyncioreactor does have a few problems with time:
> 
> https://twistedmatrix.com/trac/ticket/9611
> https://twistedmatrix.com/trac/ticket/9780
> 
> I can't find a bug for this issue, though, although I'm almost sure I've 
> seen it before... so, if you could file one (and maybe a patch to fix 
> it!) then that would be appreciated.
> 
> - Amber
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>


From glyph at twistedmatrix.com  Wed Mar 25 01:02:46 2020
From: glyph at twistedmatrix.com (Glyph)
Date: Wed, 25 Mar 2020 00:02:46 -0700
Subject: [Twisted-Python] IReactorTime.seconds: epoch time or no?
In-Reply-To: <0bbb2d6a-363a-488d-bda2-847463486b8f@www.fastmail.com>
References: <74d9b7a0-e3f1-2d60-ae49-fea64adf405b@matrix.org>
 <64050e5b-505e-12fb-4ad5-704323b5b64c@atleastfornow.net>
 <0bbb2d6a-363a-488d-bda2-847463486b8f@www.fastmail.com>
Message-ID: <B6C055F3-3177-42AF-9B7F-EF1D85A1DA45@twistedmatrix.com>

> On Mar 24, 2020, at 4:05 PM, Tom Most <twm at freecog.net> wrote:
> 
> I'll offer a dissenting opinion:
> 
> I've worked on systems where the reactor is patched to use monotonic time. (This is essential on embedded systems that lack a real-time clock.) I'm not aware of this causing any issues, and it fixed real problems.

I am curious to know the problems that were fixed here, but, this is a violation of the IReactorTime contract, implicit as it may be.

The reactor should have a monotonic-time interface, and maybe we should even use it to implement callLater.  But .seconds() is wall-clock time.

> HTTPFactory is quite unusual in assuming that it is epoch time. Most parts of Twisted that require wall time call `time.time()` or equivalent directly. IMO HTTPFactory is in error here, and this is simply a bug. We should change HTTPFactory to use `time.time()` directly.

Nope.  This breaks a whole class of testing strategies, which are explicitly documented in https://twistedmatrix.com/documents/20.3.0/core/howto/trial.html#testing-scheduling <https://twistedmatrix.com/documents/20.3.0/core/howto/trial.html#testing-scheduling> .

However, I can definitely see the need for monotonic time.  `IReactorTimeEx` should probably include methods for getting monotonic time, getting civil times, scheduling callables at future civil times explicitly rather than using relative timestamps, etc.  Possibly some of these should be different interfaces.

> Since the time base of IReactorTime.seconds() hasn't ever been clearly defined, I think that we should really go the other way: use `time.monotonic()` by default where possible. (Or, more realistically, make it an option and maybe the default.)

Definitely not.  Huge huge swathes of Twisted code would break, not least of which would be Twisted's own HTTP access logs which rely on .seconds() to be wall clock.

> ---Tom
> 
> On Mon, Mar 23, 2020, at 1:24 PM, Amber Brown (hawkowl) wrote:
>> 
>> 
>> On 24/3/20 6:45 am, Richard van der Hoff wrote:
>>> HTTPFactory seems to think that `reactor.seconds` is reliably an epoch 
>>> time (see 
>>> https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L3110, 
>>> etc).
>>> 
>>> On the other hand. AsyncioSelectorReactor.seconds() returns a monotonic 
>>> time:
>>> 
>>> python3 -c 'from twisted.internet import asyncioreactor; 
>>> print(asyncioreactor.AsyncioSelectorReactor().seconds())'
>>> 41116.763594412
>>> 
>>> One of these is wrong... I think it's HTTPFactory making bad 
>>> assumptions, but can anyone confirm the intention here?
>> 
>> 
>> It's a bug in asyncioreactor. IReactorTime defines it as "current time 
>> in seconds", which _probably_ should be defined nicer 
>> (https://twistedmatrix.com/documents/current/api/twisted.internet.interfaces.IReactorTime.html#seconds) 
>> but is generally epoch time.
>> 
>> asyncioreactor does have a few problems with time:
>> 
>> https://twistedmatrix.com/trac/ticket/9611
>> https://twistedmatrix.com/trac/ticket/9780
>> 
>> I can't find a bug for this issue, though, although I'm almost sure I've 
>> seen it before... so, if you could file one (and maybe a patch to fix 
>> it!) then that would be appreciated.
>> 
>> - Amber
>> 
>> _______________________________________________
>> Twisted-Python mailing list
>> Twisted-Python at twistedmatrix.com
>> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
>> 
> 
> _______________________________________________
> Twisted-Python mailing list
> Twisted-Python at twistedmatrix.com
> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20200325/e48cdff5/attachment.htm>

From barry.scott at forcepoint.com  Thu Mar 26 03:23:07 2020
From: barry.scott at forcepoint.com (Barry Scott)
Date: Thu, 26 Mar 2020 09:23:07 +0000
Subject: [Twisted-Python] IReactorTime.seconds: epoch time or no?
In-Reply-To: <B6C055F3-3177-42AF-9B7F-EF1D85A1DA45@twistedmatrix.com>
References: <74d9b7a0-e3f1-2d60-ae49-fea64adf405b@matrix.org>
 <0bbb2d6a-363a-488d-bda2-847463486b8f@www.fastmail.com>
 <B6C055F3-3177-42AF-9B7F-EF1D85A1DA45@twistedmatrix.com>
Message-ID: <3915205.rqfhMI5Yx9@fpbarry>

On Wednesday, 25 March 2020 07:02:46 GMT Glyph wrote:
> > On Mar 24, 2020, at 4:05 PM, Tom Most <twm at freecog.net> wrote:
> > 
> > I'll offer a dissenting opinion:
> > 
> > I've worked on systems where the reactor is patched to use monotonic time.
> > (This is essential on embedded systems that lack a real-time clock.) I'm
> > not aware of this causing any issues, and it fixed real problems.
> I am curious to know the problems that were fixed here, but, this is a
> violation of the IReactorTime contract, implicit as it may be.
> 
> The reactor should have a monotonic-time interface, and maybe we should even
> use it to implement callLater.  But .seconds() is wall-clock time.
> > HTTPFactory is quite unusual in assuming that it is epoch time. Most parts
> > of Twisted that require wall time call `time.time()` or equivalent
> > directly. IMO HTTPFactory is in error here, and this is simply a bug. We
> > should change HTTPFactory to use `time.time()` directly.
> Nope.  This breaks a whole class of testing strategies, which are explicitly
> documented in
> https://twistedmatrix.com/documents/20.3.0/core/howto/trial.html#testing-sc
> heduling
> <https://twistedmatrix.com/documents/20.3.0/core/howto/trial.html#testing-s
> cheduling> .
> 
> However, I can definitely see the need for monotonic time.  `IReactorTimeEx`
> should probably include methods for getting monotonic time, getting civil
> times, scheduling callables at future civil times explicitly rather than
> using relative timestamps, etc.  Possibly some of these should be different
> interfaces.
> > Since the time base of IReactorTime.seconds() hasn't ever been clearly
> > defined, I think that we should really go the other way: use
> > `time.monotonic()` by default where possible. (Or, more realistically,
> > make it an option and maybe the default.)
> Definitely not.  Huge huge swathes of Twisted code would break, not least of
> which would be Twisted's own HTTP access logs which rely on .seconds() to
> be wall clock.

Why does Twisted need to duplicate the built in python time features?
What was wrong with using time.time() for the access logs?

Surely reactors must be use monotonic time to avoid breaking protocol
timing across wall-clock time being adjusted by ntp etc.

Barry

> > ---Tom
> > 
> > On Mon, Mar 23, 2020, at 1:24 PM, Amber Brown (hawkowl) wrote:
> >> On 24/3/20 6:45 am, Richard van der Hoff wrote:
> >>> HTTPFactory seems to think that `reactor.seconds` is reliably an epoch
> >>> time (see
> >>> https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L3
> >>> 110, etc).
> >>> 
> >>> On the other hand. AsyncioSelectorReactor.seconds() returns a monotonic
> >>> time:
> >>> 
> >>> python3 -c 'from twisted.internet import asyncioreactor;
> >>> print(asyncioreactor.AsyncioSelectorReactor().seconds())'
> >>> 41116.763594412
> >>> 
> >>> One of these is wrong... I think it's HTTPFactory making bad
> >>> assumptions, but can anyone confirm the intention here?
> >> 
> >> It's a bug in asyncioreactor. IReactorTime defines it as "current time
> >> in seconds", which _probably_ should be defined nicer
> >> (https://twistedmatrix.com/documents/current/api/twisted.internet.interfa
> >> ces.IReactorTime.html#seconds) but is generally epoch time.
> >> 
> >> asyncioreactor does have a few problems with time:
> >> 
> >> https://twistedmatrix.com/trac/ticket/9611
> >> https://twistedmatrix.com/trac/ticket/9780
> >> 
> >> I can't find a bug for this issue, though, although I'm almost sure I've
> >> seen it before... so, if you could file one (and maybe a patch to fix
> >> it!) then that would be appreciated.
> >> 
> >> - Amber
> >> 
> >> _______________________________________________
> >> Twisted-Python mailing list
> >> Twisted-Python at twistedmatrix.com
> >> https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python
> > 
> > _______________________________________________
> > Twisted-Python mailing list
> > Twisted-Python at twistedmatrix.com
> > https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python





From richard at matrix.org  Fri Mar 27 08:24:23 2020
From: richard at matrix.org (Richard van der Hoff)
Date: Fri, 27 Mar 2020 14:24:23 +0000
Subject: [Twisted-Python] IReactorTime.seconds: epoch time or no?
In-Reply-To: <3915205.rqfhMI5Yx9@fpbarry>
References: <74d9b7a0-e3f1-2d60-ae49-fea64adf405b@matrix.org>
 <0bbb2d6a-363a-488d-bda2-847463486b8f@www.fastmail.com>
 <B6C055F3-3177-42AF-9B7F-EF1D85A1DA45@twistedmatrix.com>
 <3915205.rqfhMI5Yx9@fpbarry>
Message-ID: <1916ee73-b604-31e6-f49b-ec411c6a6d11@matrix.org>

On 26/03/2020 09:23, Barry Scott wrote:
> Why does Twisted need to duplicate the built in python time features? > What was wrong with using time.time() for the access logs?

I feel like glyph's already answered this: use of `time` makes for poor 
testability. You might argue you don't care for access logs, since we 
aren't going to check the exact output, but (a) we probably *should* 
check the output matches the given timestamp, and (b) if a pattern's 
worth following, it's worth following everywhere.

> Surely reactors must be use monotonic time to avoid breaking protocol
> timing across wall-clock time being adjusted by ntp etc.

Again, I think glyph's answered this. There *should* be a method for 
getting a monotonic-time, and things that do scheduling should use it; 
but that method shouldn't be `seconds()`.

Thanks to Amber and glyph for answering my original question: I've 
opened https://twistedmatrix.com/trac/ticket/9787 to track the issue.


From trac at twistedmatrix.com  Sun Mar 29 00:05:16 2020
From: trac at twistedmatrix.com (trac at twistedmatrix.com)
Date: Sun, 29 Mar 2020 06:05:16 -0000
Subject: [Twisted-Python] Weekly Bug Summary
Message-ID: 1585461916.32.949234556903373341@twistedmatrix.com

An HTML attachment was scrubbed...
URL: </pipermail/twisted-python/attachments/20200329/55bc3af3/attachment.htm>

From meejah at meejah.ca  Tue Mar 31 21:48:24 2020
From: meejah at meejah.ca (meejah)
Date: Wed, 01 Apr 2020 07:48:24 +0400
Subject: [Twisted-Python] txtorcon 20.0.0
Message-ID: <86sghnc1dj.fsf@atlantis.meejah.ca>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

I'm pleased to announce txtorcon 20.0.0. This fixes a few bugs and
officially deprecates Python 2 support.

 * Use real GeoIP database or nothing (https://github.com/meejah/txtorcon/issues/250)
 * Change abstract base classes import in preperation for Python 3.8 (thanks @glowatsk)
 * Python 3.4 is no longer supported
 * Python 2 is deprecated; all new code should be Python 3. Support
   for Python 2 will be removed in a future release.

You can download the release from PyPI or GitHub (or of
course "pip install txtorcon"):

  https://pypi.python.org/pypi/txtorcon/20.0.0
  https://github.com/meejah/txtorcon/releases/tag/v20.0.0

Releases are also available from the hidden service:

  http://timaq4ygg2iegci7.onion/txtorcon-20.0.0.tar.gz
  http://timaq4ygg2iegci7.onion/txtorcon-20.0.0.tar.gz.asc

Or via a "version 3" service:

  http://fjblvrw2jrxnhtg67qpbzi45r7ofojaoo3orzykesly2j3c2m3htapid.onion/txtorcon-20.0.0.tar.gz
  http://fjblvrw2jrxnhtg67qpbzi45r7ofojaoo3orzykesly2j3c2m3htapid.onion/txtorcon-20.0.0.tar.gz.asc

You can verify the sha256sum of both by running the following 4 lines
in a shell wherever you have the files downloaded:

cat <<EOF | sha256sum --check
122cd081786396f57718adda1c1a5eb01b8e9a4832fcd140918b45c10359377a  txtorcon-20.0.0.tar.gz
5c1145566a8733105da851b794e7b15cb56cea48693635b55c4bddfb79fe629d  txtorcon-20.0.0-py2.py3-none-any.whl
EOF

thanks,
meejah
-----BEGIN PGP SIGNATURE-----

iQFFBAEBCgAvFiEEnVor1WiOy4id680/wmAoAxKAaacFAl6EDnURHG1lZWphaEBt
ZWVqYWguY2EACgkQwmAoAxKAaadv4AgAkIny/Pt55kEppkxlqu4/B4ddfU7oQNLD
8lwoYyUZbYtS8XwiBaqY6SR/UU9MhhswdoPU50WBq3h4Im+3jrmm7MbVD4uR6Uvt
BnZIMzCJlQNcGpfbaGmtyrtbBNazQLTDOAxxQ7WM/MD8rip1zlP8MeL7yBgE3VEC
JInw9DWN+fbQhbsTQgdiLLLhBXOFqZuXgz7auPnGzu+5LsIeJd6ZnWzuQ6TlzL3R
rLgrMAasxTMzKoJB51jmDpCOeaj4b68XK+MY130/xSdENb2ZyGbuSF4LpZUjs4RU
Sqiwtevu/bT/th0XBqcg79RHnwGLK/g1pJRB27RaOVbuh6f+lENc4Q==
=4q9v
-----END PGP SIGNATURE-----


