<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] help with Deferreds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20help%20with%20Deferreds&In-Reply-To=%3C19574.16197.79319.11292%40jon.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055247.html">
   <LINK REL="Next"  HREF="055244.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] help with Deferreds</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20help%20with%20Deferreds&In-Reply-To=%3C19574.16197.79319.11292%40jon.es%3E"
       TITLE="[Twisted-Python] help with Deferreds">terry at jon.es
       </A><BR>
    <I>Thu Aug 26 04:17:41 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055247.html">[Twisted-Python] help with Deferreds
</A></li>
        <LI>Next message (by thread): <A HREF="055244.html">[Twisted-Python] help with Deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55242">[ date ]</a>
              <a href="thread.html#55242">[ thread ]</a>
              <a href="subject.html#55242">[ subject ]</a>
              <a href="author.html#55242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sergey

&gt;<i> How to rewrite this regular function with Deferred-style?
</I>
Something like the below (untested) will do the job.  You'd have to make
sure that cache.open returned a deferred that fails with NotFound in case
things don't work out.

It would be simpler to translate your code using inlineCallbacks, but it
might be to your advantage to first see how to do it without that.  If you
do take that approach you might want to do some timing tests.

Terry

---

def getCachedResult(cache, key):

    def release(result, item):
        item.release()
        return result

    def renew(data):
        return renew(data)

    def notFound(fail):
        fail.trap(NotFound)

    def checkObsolete(item):
        if item.obsolete():
            return None
        else:
            d = item.read()
            d.addBoth(release, item)
            d.addCallback(renew)
            return d

    d = cache.open(key)
    d.addCallbacks(checkObsolete, notFound)
    return d


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055247.html">[Twisted-Python] help with Deferreds
</A></li>
	<LI>Next message (by thread): <A HREF="055244.html">[Twisted-Python] help with Deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55242">[ date ]</a>
              <a href="thread.html#55242">[ thread ]</a>
              <a href="subject.html#55242">[ subject ]</a>
              <a href="author.html#55242">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
