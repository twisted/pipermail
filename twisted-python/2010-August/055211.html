<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twistd --uid and --logfile
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twistd%20--uid%20and%20--logfile&In-Reply-To=%3C20100819065523.GA8187%40ruber.office.udmvt.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055212.html">
   <LINK REL="Next"  HREF="055214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twistd --uid and --logfile</H1>
    <B>twisted-web at udmvt.ru</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twistd%20--uid%20and%20--logfile&In-Reply-To=%3C20100819065523.GA8187%40ruber.office.udmvt.ru%3E"
       TITLE="[Twisted-Python] twistd --uid and --logfile">twisted-web at udmvt.ru
       </A><BR>
    <I>Thu Aug 19 00:55:23 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055212.html">[Twisted-Python] twistd --uid and --logfile
</A></li>
        <LI>Next message (by thread): <A HREF="055214.html">[Twisted-Python] twistd --uid and --logfile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55211">[ date ]</a>
              <a href="thread.html#55211">[ thread ]</a>
              <a href="subject.html#55211">[ subject ]</a>
              <a href="author.html#55211">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Aug 18, 2010 at 04:35:29PM +0100, Phil Mayers wrote:
&gt;<i> On 18/08/10 10:25, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-web at udmvt.ru</A> wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; I think --uid option is too dangerous.
</I>&gt;<i> &gt; sudo or su or setuidgid (from <A HREF="http://cr.yp.to/daemontools.html">http://cr.yp.to/daemontools.html</A>) is more
</I>&gt;<i> &gt; appropriate for changing uids.
</I>&gt;<i> 
</I>&gt;<i> In all cases? I think not.
</I>There is no option to tell the code when to setuid(), right?
So, is the place, where it happens now, appropriate for all of your cases?
I don't think so. And it will never be appropriate for all cases,
there is no one correct place where to do setuid, that heavily depends
on every particular case.

--uid is not that simple and magical solution to the &quot;all cases&quot;, believe me.
twistd binary is not designed for &quot;all cases&quot; either.
If you have your special case, design outside of twistd binary, it is only
a helper to provide twisted power to command line.

&gt;<i> 
</I>&gt;<i> &gt; It will always be hard to design application, that opens some files or
</I>&gt;<i> &gt; sockets and only then changes it's uids/gids.
</I>&gt;<i> 
</I>&gt;<i> What about a daemon that needs to listen on ports &lt;1024?
</I>Use code, that opens a listening socket, binds it and then executes setuidgid
program that runs your particular program.
Clear and simple approach, separation, that is clearly visible outside of code.
Twisted is not ready for such simplification, it can't use pre-opened sockets,
at least without a hack.

&gt;<i> 
</I>&gt;<i> Sure it's hard and needs care. twistd may be doing it wrong at the 
</I>&gt;<i> moment. But it should be quite possible to fix that. &quot;sudo&quot; and &quot;su&quot; 
</I>&gt;<i> don't do anything magical. Nor does &quot;apache&quot;, or any one of the hundreds 
</I>&gt;<i> of daemons that open sockets then setuid.
</I>Ports &lt; 1024 is not a newbie task. Professional programmers very rarely
able to design secure setuid code in one attempt. Even experienced
people have to redesign their setuid code several times and nobody blames them.

sudo and su do very obscure and magic things, they are not only used to
change uid by request of root, but they also have setuid bit set on their binary,
so they have to do a lot of voodoo to protect themselves from non-root users.

setuidgid is not setuid binary, so it only does one task at a time and it
separates this task from your application's task. So the user, the administrator
and the programmer can be sure, that there is nothing in application, that
can break security.

--uid option semantics is not trivial, not every user understands it's risks.
I'm afraid, not every twisted developer understand it's risks.
This is very bad option.
It is unclear, when setuid happens, or what is being done before setuid() happens.
Help only says &quot;The uid to run as.&quot;, so it looks simple and without caveats,
but it is not simple as long as you have security concerns.

To twisted developers:
Don't encourage people to design insecure code, please.
Don't make others blame twisted for insecurity.
Just don't make twisted involved into any security issues.
Replace that option with a reminder on how to change uids properly.
It is very dangerous to have such option, especially if it is not test covered.

-- 
Alexey


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055212.html">[Twisted-Python] twistd --uid and --logfile
</A></li>
	<LI>Next message (by thread): <A HREF="055214.html">[Twisted-Python] twistd --uid and --logfile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55211">[ date ]</a>
              <a href="thread.html#55211">[ thread ]</a>
              <a href="subject.html#55211">[ subject ]</a>
              <a href="author.html#55211">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
