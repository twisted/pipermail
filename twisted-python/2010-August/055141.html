<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Configuring Twisted logging via plugins
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Configuring%20Twisted%20logging%20via%20plugins&In-Reply-To=%3C65297D84-50FD-4168-A826-B8D04251C6AA%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055133.html">
   <LINK REL="Next"  HREF="055142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Configuring Twisted logging via plugins</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Configuring%20Twisted%20logging%20via%20plugins&In-Reply-To=%3C65297D84-50FD-4168-A826-B8D04251C6AA%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Configuring Twisted logging via plugins">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Aug  5 11:25:24 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055133.html">[Twisted-Python] Configuring Twisted logging via plugins
</A></li>
        <LI>Next message (by thread): <A HREF="055142.html">[Twisted-Python] Configuring Twisted logging via plugins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55141">[ date ]</a>
              <a href="thread.html#55141">[ thread ]</a>
              <a href="subject.html#55141">[ subject ]</a>
              <a href="author.html#55141">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 5, 2010, at 12:44 AM, Valeriy Zamarayev wrote:

&gt;<i> Hello, all.
</I>&gt;<i> 
</I>&gt;<i> There have been a few questions on this list about how to configure
</I>&gt;<i> Twisted logging via plugins, as opposed to .tac files. And we now know
</I>&gt;<i> about the #638 and #3534 tickets. Hopefully, they will be resolved
</I>&gt;<i> soon.
</I>&gt;<i> 
</I>&gt;<i> But before this happens, it seems to me there's no other way to handle
</I>&gt;<i> this than to use a &quot;monkey patching&quot; techinque on Twisted (excluding
</I>&gt;<i> patching the Twisted source code itself).
</I>&gt;<i> 
</I>&gt;<i> We need to access the 'application' object when the server starts. We
</I>&gt;<i> can do this when the 'twistd' code calls setServiceParent on the
</I>&gt;<i> service returned by the plugin. So if we wrap setServiceParent, we can
</I>&gt;<i> access the application object and do what we want.
</I>&gt;<i> 
</I>&gt;<i> See the code:  <A HREF="http://gist.github.com/505926">http://gist.github.com/505926</A>
</I>&gt;<i> 
</I>&gt;<i> This works for me. I don't know if a better and less dangerous way to
</I>&gt;<i> achieve the same exists. Maybe there is one?
</I>

This actually looks pretty ingenious to me!  It uses public APIs... mostly.  I'd have to think pretty hard about whether this particular interface is actually supported, of course, since you're depending on extra stuff from your service parent which hypothetically may not actually be there.

If you're looking for aesthetic advice, it would be a bit nicer to use something like proxyForInterface and wrap the underlying service, rather than setting an attribute on it and clobbering its setServiceParent method.

Also... you could write a twistd plugin that could be used directly, instead of code that needs to be adapted / re-written for each different twistd plugin.  Your code can scan the IServiceMaker plugin registry just as well as twistd itself can.

So you could have

  twistd my-custom-logger --my-log-option-1 --my-log-option-2 web --path ~/public_html

and have the my-custom-logger plugin delegate to all twistd subcommands.

That's a pattern which should remain useful even after #638 is fixed.

Code to do this properly is left as an exercise for the reader, of course :).


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20100805/f0e76757/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055133.html">[Twisted-Python] Configuring Twisted logging via plugins
</A></li>
	<LI>Next message (by thread): <A HREF="055142.html">[Twisted-Python] Configuring Twisted logging via plugins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55141">[ date ]</a>
              <a href="thread.html#55141">[ thread ]</a>
              <a href="subject.html#55141">[ subject ]</a>
              <a href="author.html#55141">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
