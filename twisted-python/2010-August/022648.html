<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Configuring Twisted logging via plugins
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Configuring%20Twisted%20logging%20via%20plugins&In-Reply-To=65297D84-50FD-4168-A826-B8D04251C6AA%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022647.html">
   <LINK REL="Next"  HREF="022650.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Configuring Twisted logging via plugins</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Configuring%20Twisted%20logging%20via%20plugins&In-Reply-To=65297D84-50FD-4168-A826-B8D04251C6AA%40twistedmatrix.com"
       TITLE="[Twisted-Python] Configuring Twisted logging via plugins">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Aug  5 13:36:44 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022647.html">[Twisted-Python] Configuring Twisted logging via plugins
</A></li>
        <LI>Next message: <A HREF="022650.html">[Twisted-Python] Configuring Twisted logging via plugins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22648">[ date ]</a>
              <a href="thread.html#22648">[ thread ]</a>
              <a href="subject.html#22648">[ subject ]</a>
              <a href="author.html#22648">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05:25 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> wrote:
&gt;<i>On Aug 5, 2010, at 12:44 AM, Valeriy Zamarayev wrote:
</I>&gt;&gt;<i>Hello, all.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>There have been a few questions on this list about how to configure
</I>&gt;&gt;<i>Twisted logging via plugins, as opposed to .tac files. And we now know
</I>&gt;&gt;<i>about the #638 and #3534 tickets. Hopefully, they will be resolved
</I>&gt;&gt;<i>soon.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>But before this happens, it seems to me there's no other way to handle
</I>&gt;&gt;<i>this than to use a &quot;monkey patching&quot; techinque on Twisted (excluding
</I>&gt;&gt;<i>patching the Twisted source code itself).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>We need to access the 'application' object when the server starts. We
</I>&gt;&gt;<i>can do this when the 'twistd' code calls setServiceParent on the
</I>&gt;&gt;<i>service returned by the plugin. So if we wrap setServiceParent, we can
</I>&gt;&gt;<i>access the application object and do what we want.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>See the code:  <A HREF="http://gist.github.com/505926">http://gist.github.com/505926</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>This works for me. I don't know if a better and less dangerous way to
</I>&gt;&gt;<i>achieve the same exists. Maybe there is one?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>This actually looks pretty ingenious to me!  It uses public APIs... 
</I>&gt;<i>mostly.  I'd have to think pretty hard about whether this particular 
</I>&gt;<i>interface is actually supported, of course, since you're depending on 
</I>&gt;<i>extra stuff from your service parent which hypothetically may not 
</I>&gt;<i>actually be there.
</I>&gt;<i>
</I>&gt;<i>If you're looking for aesthetic advice, it would be a bit nicer to use 
</I>&gt;<i>something like proxyForInterface and wrap the underlying service, 
</I>&gt;<i>rather than setting an attribute on it and clobbering its 
</I>&gt;<i>setServiceParent method.
</I>&gt;<i>
</I>&gt;<i>Also... you could write a twistd plugin that could be used directly, 
</I>&gt;<i>instead of code that needs to be adapted / re-written for each 
</I>&gt;<i>different twistd plugin.  Your code can scan the IServiceMaker plugin 
</I>&gt;<i>registry just as well as twistd itself can.
</I>&gt;<i>
</I>&gt;<i>So you could have
</I>&gt;<i>
</I>&gt;<i>  twistd my-custom-logger --my-log-option-1 --my-log-option-2 web --path 
</I>&gt;<i>~/public_html
</I>&gt;<i>
</I>&gt;<i>and have the my-custom-logger plugin delegate to all twistd 
</I>&gt;<i>subcommands.
</I>&gt;<i>
</I>&gt;<i>That's a pattern which should remain useful even after #638 is fixed.
</I>&gt;<i>
</I>&gt;<i>Code to do this properly is left as an exercise for the reader, of 
</I>&gt;<i>course :).
</I>
This is probably possible, but not using the twisted.python.usage 
options parser, which doesn't support multiple subcommands.  This 
solution has been discussed on IRC before and probably the lack of 
multiple subcommand support in the options parser is the only reason it 
hasn't been implemented.

I think there was some consensus on an alternate way to spell this 
combination, but I don't remember what it was right now.  It's probably 
in someone's IRC logs.

Jean-Paul

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022647.html">[Twisted-Python] Configuring Twisted logging via plugins
</A></li>
	<LI>Next message: <A HREF="022650.html">[Twisted-Python] Configuring Twisted logging via plugins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22648">[ date ]</a>
              <a href="thread.html#22648">[ thread ]</a>
              <a href="subject.html#22648">[ subject ]</a>
              <a href="author.html#22648">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
