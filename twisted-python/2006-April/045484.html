<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted's ability to handle many open	connections.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%27s%20ability%20to%20handle%20many%20open%0A%09connections.&In-Reply-To=%3C444FFFD4.1060909%40pollenation.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045495.html">
   <LINK REL="Next"  HREF="045487.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted's ability to handle many open	connections.</H1>
    <B>Matt Goodall</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%27s%20ability%20to%20handle%20many%20open%0A%09connections.&In-Reply-To=%3C444FFFD4.1060909%40pollenation.net%3E"
       TITLE="[Twisted-Python] Twisted's ability to handle many open	connections.">matt at pollenation.net
       </A><BR>
    <I>Wed Apr 26 17:18:44 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045495.html">[Twisted-Python] Twisted's ability to handle many open	connections.
</A></li>
        <LI>Next message (by thread): <A HREF="045487.html">[Twisted-Python] Twisted's ability to handle many open	connections.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45484">[ date ]</a>
              <a href="thread.html#45484">[ thread ]</a>
              <a href="subject.html#45484">[ subject ]</a>
              <a href="author.html#45484">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Terry Jones wrote:
&gt;<i> I'm completely new to Twisted. As I understand it, a Twisted server runs as
</I>&gt;<i> a single process - no forking, no threads.
</I>
Correct. Twisted is event driven. It doesn't need to fork and spawn 
threads to handle a lot of network connections at once.

However, Twisted is perfectly capable of managing any processes and 
threads an application *needs* to create. In fact, Twisted's core 
includes APIs specifically created to handle background processes and 
threads.


&gt;<i> To me that implies that select
</I>&gt;<i> (or poll or pselect, etc) is being heavily used to feed data to Deferreds.
</I>
select/poll/whatever is at the core of Twisted's event loop, known as 
the 'reactor' but Deferreds are completely unrelated to data delivery.

A Deferred is a callback mechanism, nothing more. A function typically 
returns a Deferred to say, &quot;hey, you asked me to do something and I will 
give my response ... just not right now&quot;.


&gt;<i> 
</I>&gt;<i> If that's the case, how does Twisted (portably) allow for a large number of
</I>&gt;<i> file descriptors?
</I>
As you recognised, Twisted uses a select loop so I'm not quite sure what 
your question means. However ...

Twisted chooses the best available reactor implementation for the 
platform. &quot;Best&quot;, here, probably meaning most available (default?) 
rather than fastest.

I'm no expert here but on Linux the reactor really does use a select() 
loop, on win32 it uses the win32 equivalent of a select loop 
(WSAEventSelect and MsgWaitForMultipleObjects, or something), and I 
believe it uses poll on the BSDs.

If the &quot;best&quot; reactor is not actually the best (if you see what I mean!) 
then you can manually install a non-default reactor. There are plenty to 
choose from.

For instance, on Linux if you want to handle a huge number of 
simultaneous connections then installing a poll-based reactor is 
probably a good idea. If your application uses GTK+ then you would 
install a GTK+ reactor.


&gt;<i> I'm considering using Twisted for a project. Twisted would front requests
</I>&gt;<i> from the web, but also from (e.g.) remote command line applications via an
</I>&gt;<i> API.
</I>
This is what Twisted excels at - multi-protocol network applications. 
I've done it many times now and it just works.

Twisted already includes support (of varying quality) for most common 
protocols but it's very easy to add new protocols if necessary.


&gt;<i> These latter connections could potentially be numerous, and long
</I>&gt;<i> lived.  Should I be thinking about how Twisted deals with this, or does it
</I>&gt;<i> already scale to allow more simultaneous connections / file descriptors
</I>&gt;<i> than a naive server program would be able to maintain?
</I>
Twisted is event driven and most people believe that event driven scales 
better, especially for network-related work. I therefore believe Twisted 
will *help* you write code that will scale to a high number of 
simultaneous connections. Twisted does perform any magic though.

You will need to understand event driven programming to scale up, 
otherwise you're likely to block the application from doing more than 
one thing at a time (in the cooperatively multitasking sense) making 
your application utterly unscalable.

Also, note that Twisted does not magic away other common problems 
associated with scalability. The obvious one that springs to mind 
(because it bit me recently :-/) is the maximum number of file 
descriptors a non-root Linux process can open per process.

&gt;<i> 
</I>&gt;<i> Given what looks like widespread use of Deferreds in Twisted, I suppose
</I>&gt;<i> that there is not a 1-1 relationship between connections and file
</I>&gt;<i> descriptors? If so this makes the issue more pressing.
</I>
There is absolutely a 1-1 relationship between connections and file 
descriptors but Deferred have nothing to do with it.

It's quite possible to write a Twisted application without ever using a 
Deferred. If your application can respond immediately (well, very 
quickly) to requests that arrive from the network then you don't need 
Deferreds.

You need a Deferred when you cannot respond immediately. In that case 
you would create a Deferred and store it somewhere, spawn something 
*non-blocking* to handle the request and return the Deferred to the 
caller. Then, when the non-blocking thing completes, you callback via 
the Deferred you stored to let the caller know the result.

&gt;<i> 
</I>&gt;<i> Thanks for any help,
</I>&gt;<i> Terry
</I>
Hope it did help!

Cheers, Matt

-- 
      __
     /  \__     Matt Goodall, Pollenation Internet Ltd
     \__/  \    w: <A HREF="http://www.pollenation.net">http://www.pollenation.net</A>
   __/  \__/    e: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">matt at pollenation.net</A>
  /  \__/  \    t: +44 (0)113 2252500
  \__/  \__/
  /  \	       Any views expressed are my own and do not necessarily
  \__/          reflect the views of my employer.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045495.html">[Twisted-Python] Twisted's ability to handle many open	connections.
</A></li>
	<LI>Next message (by thread): <A HREF="045487.html">[Twisted-Python] Twisted's ability to handle many open	connections.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45484">[ date ]</a>
              <a href="thread.html#45484">[ thread ]</a>
              <a href="subject.html#45484">[ subject ]</a>
              <a href="author.html#45484">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
