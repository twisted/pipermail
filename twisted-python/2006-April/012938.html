<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferred TCP writes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferred%20TCP%20writes&In-Reply-To=fa8579a40604181044v4b964015scccf1d93580819fc%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012936.html">
   <LINK REL="Next"  HREF="012940.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferred TCP writes</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferred%20TCP%20writes&In-Reply-To=fa8579a40604181044v4b964015scccf1d93580819fc%40mail.gmail.com"
       TITLE="[Twisted-Python] deferred TCP writes">glyph at divmod.com
       </A><BR>
    <I>Tue Apr 18 16:11:19 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012936.html">[Twisted-Python] deferred TCP writes
</A></li>
        <LI>Next message: <A HREF="012940.html">[Twisted-Python] error &quot;limits.h missing&quot; while compiling zope interface in Sumo on mac os x 10.4.6 Py 2.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12938">[ date ]</a>
              <a href="thread.html#12938">[ thread ]</a>
              <a href="subject.html#12938">[ subject ]</a>
              <a href="author.html#12938">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 18 Apr 2006 10:44:22 -0700, Brian Granger &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bgranger at scu.edu</A>&gt; wrote:
&gt;<i>I echo the question: why doesn't write return a deferred?  Surely
</I>&gt;<i>there are times you want to trigger events on the completion of a
</I>&gt;<i>write.
</I>
Some folks have already answered with the primary reason, which is to say, efficiency.  While Twisted definitely trades performance for flexibility in a number of places where reasonable, 'write()' is one of those things that just absolutely has to be as fast as possible, because many things which are highly  performance-critical call it.  Creating Deferreds could be 100x faster and it would still be too slow for this case.

There is anothe reason, though: returning a deferred from &quot;write()&quot; implies to the user that when the deferred fires, the bytes have been &quot;written&quot;, e.g. the other end has received them.  In cases where .write() blocks, most naive programmers -- and yes, I say this having once been a &quot;naive programmer&quot; myself -- assume that the other end has not only received the bytes, it has processed them.  This is wrong, and can (and often does) have unfortunate consequences.

It sounds like you want control over excessive in-memory buffering, which is a pretty reasonable thing to want, and the IConsumer/IProducer interfaces you have already been directed to should provide that to you quite satisfactorily.

The reality is that when a 'write' completes and returns to userland, your bytes are somewhere between your kernel, your router, your cable modem, your ISP's cable modem, your ISP's internal routers, the backbone (...) your destination's kernel, and your destination's application.  You have no idea where they are, really, and neither does Twisted.  It just hides one more distinction from you: Twisted's buffer to your OS's buffer.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012936.html">[Twisted-Python] deferred TCP writes
</A></li>
	<LI>Next message: <A HREF="012940.html">[Twisted-Python] error &quot;limits.h missing&quot; while compiling zope interface in Sumo on mac os x 10.4.6 Py 2.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12938">[ date ]</a>
              <a href="thread.html#12938">[ thread ]</a>
              <a href="subject.html#12938">[ subject ]</a>
              <a href="author.html#12938">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
