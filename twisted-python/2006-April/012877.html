<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Transforming Exceptions for use with PB
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Transforming%20Exceptions%20for%20use%20with%20PB&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012876.html">
   <LINK REL="Next"  HREF="012880.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Transforming Exceptions for use with PB</H1>
    <B>Brian Granger</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Transforming%20Exceptions%20for%20use%20with%20PB&In-Reply-To="
       TITLE="[Twisted-Python] Transforming Exceptions for use with PB">bgranger at scu.edu
       </A><BR>
    <I>Wed Apr 12 03:30:13 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="012876.html">[Twisted-Python] Re: Minimal example of Words/OSCAR?
</A></li>
        <LI>Next message: <A HREF="012880.html">[Twisted-Python] bad behaviour of ldaptor 0.0.39 with twisted 2.2.0: &quot;strange&quot; characters in ldap logs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12877">[ date ]</a>
              <a href="thread.html#12877">[ thread ]</a>
              <a href="subject.html#12877">[ subject ]</a>
              <a href="author.html#12877">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have a question about how Exceptions are handled by PB.

I am using Twisted to expose a python object (wrapped into a Twisted
Service) over a couple of network protocols (PB and XML-RPC).  I am
using interfaces/components/adapters to adapt my service into entities
that each protocol can use:

class IPerspectiveFunction(Interface):

    def remote_function(self, x):

class PerspectiveFunctionFromService(pb.Root):

    implements(IPerspectiveFunction)

    def __init__(self, service):
        self.service = service

    def remote_function(self, x):
        return self.service.function(x)     # The service returns a Deferred

self.service.function returns a Deferred, whose errbacks are fired
when an Exception is raised in self.service.function.

Here is my dilemma:

- The code in self.service.function that raises exceptions is in
another library that doesn't know about Twisted.  Thus the exceptions
are not sublcasses of pb.Error.

- Even if I did have control over these exceptions, I wouldn't want to
subclass pb.Error as I need to propagate the errors out to other (not
PB) protocols.

- I would like to detect certain types of exceptions (maybe using
trap()) and convert them to instances of pb.Error (or a subclass) so I
can send them over the line using PB.

The following almost works:

    def remote_function(self, x):
        d = self.service.function(x)     # The service returns a Deferred
        def transformFailure(f):
            return failure.Failure(pb.Error(f.printTraceback()))
        d.addErrback(transformFailure)
        return d

The other side gets the Error just fine, but the PB server still
prints the traceback and says &quot;Peer will receive following PB
traceback:&quot;  Why does PB handle it this way, when the Failure instance
that PB gets contains a pb.Error exception?

Any thoughts on how to transform general Failure instances to ones
that can be handled in a clean way by PB?  I guess there is amore
general question of how to transform Failure instances into things
that can be handled by various network protocols (such as XML-RPC or
even HTTP)

Thanks in advance.

Brian


Brian Granger
Santa Clara University
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ellisonbg at gmail.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012876.html">[Twisted-Python] Re: Minimal example of Words/OSCAR?
</A></li>
	<LI>Next message: <A HREF="012880.html">[Twisted-Python] bad behaviour of ldaptor 0.0.39 with twisted 2.2.0: &quot;strange&quot; characters in ldap logs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12877">[ date ]</a>
              <a href="thread.html#12877">[ thread ]</a>
              <a href="subject.html#12877">[ subject ]</a>
              <a href="author.html#12877">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
