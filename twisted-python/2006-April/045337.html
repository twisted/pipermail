<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Cleanly shutting down Service
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Cleanly%20shutting%20down%20Service&In-Reply-To=%3Cop.s7e4d4mky3d107%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045335.html">
   <LINK REL="Next"  HREF="045338.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Cleanly shutting down Service</H1>
    <B>Eric Mangold</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Cleanly%20shutting%20down%20Service&In-Reply-To=%3Cop.s7e4d4mky3d107%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] Cleanly shutting down Service">teratorn at twistedmatrix.com
       </A><BR>
    <I>Mon Apr  3 00:02:18 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045335.html">[Twisted-Python] Cleanly shutting down Service
</A></li>
        <LI>Next message (by thread): <A HREF="045338.html">[Twisted-Python] Cleanly shutting down Service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45337">[ date ]</a>
              <a href="thread.html#45337">[ thread ]</a>
              <a href="subject.html#45337">[ subject ]</a>
              <a href="author.html#45337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 03 Apr 2006 13:01:07 +1000, Reed L. O'Brien &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">reed at intersiege.com</A>&gt;  
wrote:

&gt;<i> Jean-Paul Calderone wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Sun, 02 Apr 2006 21:30:06 -0400, &quot;Reed L. O'Brien&quot;
</I>&gt;&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">reed at intersiege.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> apocalypznow wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> How do I cleanly shut down a Service?  I want the shut down to make
</I>&gt;&gt;&gt;&gt;<i> the stopService() method get called.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> import signal, sys
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> signal.signal(signal.SIGINT, handler)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> def handler(signum, frame):
</I>&gt;&gt;&gt;<i>    print &quot;Shutting down the Foo service&quot; # or use a logging facility
</I>&gt;&gt;&gt;<i>    stopService()
</I>&gt;&gt;&gt;<i>    sys.exit(2)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Will catch ^C and call handler for more read the signal docs:
</I>&gt;&gt;&gt;<i> <A HREF="http://www.python.org/doc/current/lib/module-signal.html">http://www.python.org/doc/current/lib/module-signal.html</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alas, this won't do anything resembling correct in a Twisted  
</I>&gt;&gt;<i> application.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I tried to come up with an answer to this question earlier today, but
</I>&gt;&gt;<i> failed: perhaps the OP can ask a more specific or detailed one which
</I>&gt;&gt;<i> will be easier to answer correctly.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Jean-Paul
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> reactor.addSystemEventTrigger('before', 'shutdown', func())
</I>&gt;<i>
</I>&gt;<i> def func():
</I>&gt;<i> 	doStuff...
</I>&gt;<i>
</I>&gt;<i> closer?
</I>&gt;<i>
</I>&gt;<i> ~reed
</I>
Not really, No. I think you should have waited for the OP to ask a better  
question as JP suggested. The quality of questions on this mailing list  
has been very poor lately. Anyway, onwards...

To shut down a Service cleanly, you call stopService() on it.

If you want your service to have its stopService method called when  
Twisted shuts down, then
that service should be registered correctly. If you aren't using twistd  
then see
twisted.application.app.startApplication

&gt;&gt;&gt;<i> An example test.tac file:
</I>
 from twisted.application import service

class MyService(service.Service):
     def stopService(self):
         print &quot;Stopping my service!&quot;
         service.Service.stopService(self)

application = service.Application(&quot;My Twisted App&quot;)
myService = MyService()
myService.setName(&quot;My Service&quot;)
myService.setServiceParent(application)

 from twisted.internet import reactor
reactor.callLater(2, reactor.stop)

&lt;&lt;&lt; End test.tac

If you run the .tac file with &quot;twistd -noy test.tac&quot;, after 2 seconds,
you will see &quot;Stopping my service!&quot; printed.

-Eric


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045335.html">[Twisted-Python] Cleanly shutting down Service
</A></li>
	<LI>Next message (by thread): <A HREF="045338.html">[Twisted-Python] Cleanly shutting down Service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45337">[ date ]</a>
              <a href="thread.html#45337">[ thread ]</a>
              <a href="subject.html#45337">[ subject ]</a>
              <a href="author.html#45337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
