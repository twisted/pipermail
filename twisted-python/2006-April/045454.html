<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Do Twisted support LMTP servers?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Do%20Twisted%20support%20LMTP%20servers%3F&In-Reply-To=%3C000e01c66476%24728e8860%2438aa20d4%40hp%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045440.html">
   <LINK REL="Next"  HREF="045359.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Do Twisted support LMTP servers?</H1>
    <B>Simon Hedberg</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Do%20Twisted%20support%20LMTP%20servers%3F&In-Reply-To=%3C000e01c66476%24728e8860%2438aa20d4%40hp%3E"
       TITLE="[Twisted-Python] Do Twisted support LMTP servers?">simon at hedberg.net
       </A><BR>
    <I>Thu Apr 20 06:32:11 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045440.html">[Twisted-Python] Do Twisted support LMTP servers?
</A></li>
        <LI>Next message (by thread): <A HREF="045359.html">[Twisted-Python] Twisted Sprint in Australia
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45454">[ date ]</a>
              <a href="thread.html#45454">[ thread ]</a>
              <a href="subject.html#45454">[ subject ]</a>
              <a href="author.html#45454">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jesus Cea wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i> 
</I>&gt;<i> Simon Hedberg wrote:
</I>&gt;&gt;<i> I have been looking at ways to have postfix talking to my twisted app
</I>&gt;&gt;<i> and today tried LMTP successfully for the first time. What I've done
</I>&gt;&gt;<i> so far is just subclass the ESMTP protocol and add do_LHLO which
</I>&gt;&gt;<i> seems to do the trick for some basic usage at least. Looking at
</I>&gt;&gt;<i> <A HREF="http://www.ietf.org/rfc/rfc2033.txt">http://www.ietf.org/rfc/rfc2033.txt</A> it seems like it shouldn't be to
</I>&gt;&gt;<i> hard to make a proper LMTP implementation. Perhaps someone more
</I>&gt;&gt;<i> familiar with twisted.mail could have a look.
</I>&gt;<i> 
</I>&gt;<i> Your mini LMTP implementation fails if a message is sent to several
</I>&gt;<i> recipients, since LMTP must answer with a status code per
</I>&gt;<i> destination. That is the main difference with SMTP.  
</I>&gt;<i> 
</I>&gt;<i> But good starting point :)
</I>&gt;<i> 
</I>&gt;<i> Hope &quot;somebody&quot; takes the token and complete a RFC compliant
</I>&gt;<i> implementation... :-p 
</I>&gt;<i> 
</I>&gt;<i> - --
</I>
Ok, I had a closer look and here's a more complete version, that sends a
status code for each recipient. 
Try it out
/Simon


class LMTP(smtp.ESMTP):
    def do_LHLO(self, rest):
        peer = self.transport.getPeer()
        try:
            host = peer.host
        except AttributeError:
            host = str(peer)
        self._helo = (rest, host)
        self._from = None
        self._to = []
        self.sendCode(250, '%s Hello %s, nice to meet you\n%s' %
(self.host, host,self.listExtensions()))

    def do_HELO(self,rest):
        return self.do_UNKNOWN(self,rest)
    
    def do_EHLO(self,rest):
        return self.do_UNKNOWN(self,rest)
    
    def _messageHandled(self, resultList):
        for (success, result) in resultList:
            if success:
                self.sendCode(250, 'OK')
            else:
                log.err(result)
                code = 550
                msg = 'Could not deliver e-mail'
                smtperr = result.check(smtp.SMTPClientError)
                if smtperr:
                    code = result.value.code
                    msg  = result.value.resp
                self.sendCode(code, msg)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045440.html">[Twisted-Python] Do Twisted support LMTP servers?
</A></li>
	<LI>Next message (by thread): <A HREF="045359.html">[Twisted-Python] Twisted Sprint in Australia
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45454">[ date ]</a>
              <a href="thread.html#45454">[ thread ]</a>
              <a href="subject.html#45454">[ subject ]</a>
              <a href="author.html#45454">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
