<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] UDP answer from different IP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20UDP%20answer%20from%20different%20IP&In-Reply-To=%3CE1FRPBJ-0001Bm-00%40pyramid.twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045350.html">
   <LINK REL="Next"  HREF="045353.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] UDP answer from different IP</H1>
    <B>Wolfgang Eichler</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20UDP%20answer%20from%20different%20IP&In-Reply-To=%3CE1FRPBJ-0001Bm-00%40pyramid.twistedmatrix.com%3E"
       TITLE="[Twisted-Python] UDP answer from different IP">Wolfgang.W.Eichler at gmx.de
       </A><BR>
    <I>Thu Apr  6 01:45:21 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045350.html">[Twisted-Python] UDP answer from different IP
</A></li>
        <LI>Next message (by thread): <A HREF="045353.html">[Twisted-Python] UDP answer from different IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45352">[ date ]</a>
              <a href="thread.html#45352">[ thread ]</a>
              <a href="subject.html#45352">[ subject ]</a>
              <a href="author.html#45352">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I would like to clarify the situation and describe my current work-around:

My twisted application is on client machine A. It sends  SNMP requests to server machine B.

         self.proxy = agentproxy.AgentProxy(
            ipAddress, port,            					# here   '130.119.127.196', 6665
            community = community,
            snmpVersion = 'v1',
            protocol = self.port.protocol,
        )
        df = self.proxy.getTable(oids, timeout= 0.5, retryCount=5)

Machine B has two interfaces to the network with IP '130.119.127.196' and '130.119.127.127' . Here runs some arbitrary SNMP Agent.

Twisted on A opens a port (25000 or so) and sends getNext requests.
These requests contain an ID, that is later used to identifiy incoming messages and  relate them to the request.

To do this snmpprotocol.py has a function getRequestKey, that retrieves this ID from protocol elements.

When sending the getNext-message getRequestKey() returns:

(('130.119.127.196', 6665), 782)

This is the key which later should work to identify this request when the answers from B arrive.

But since B uses the other interface to answer, the message that arrives carries:

(('130.119.127.127', 6665), 782) and this key is not known.

I wonder why we need the IP address and port at this point, since the ID (782) is unique to machine A and port 25000 and is sufficient to identify the request to which this incoming message belongs.

I patched in snmpprotocol.py:

	def getRequestKey( self, request, target ):
		&quot;&quot;&quot;Get the request key from a request/response&quot;&quot;&quot;
		for key in [
			'get_request', 'get_response',
			'get_next_request', 'get_bulk_request',
			'response', 'set_request',
		]:
			try:
				ID = request['pdu'][key]['request_id']
			except KeyError, err:
				pass
			except TypeError, err:
				log.error(
					&quot;&quot;&quot;Unexpected TypeError retrieving request key %r: %s&quot;&quot;&quot;,
					key, log.getException(err),
				)
			else:
#				return target, ID.get()
				return ID.get()
		raise KeyError( &quot;&quot;&quot;Unable to get a request key id from %s for target %s&quot;&quot;&quot;%( request, target))

This worked.
Could this be checked by some expert ? Any problem with this approach ?

Thanks
Wolfgang






</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045350.html">[Twisted-Python] UDP answer from different IP
</A></li>
	<LI>Next message (by thread): <A HREF="045353.html">[Twisted-Python] UDP answer from different IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45352">[ date ]</a>
              <a href="thread.html#45352">[ thread ]</a>
              <a href="subject.html#45352">[ subject ]</a>
              <a href="author.html#45352">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
