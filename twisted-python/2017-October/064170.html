<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] COMMERCIAL:Re: Clarification or pausing a	consumer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20COMMERCIAL%3ARe%3A%20Clarification%20or%20pausing%20a%0A%09consumer&In-Reply-To=%3CCAEeXt4O%3DXPbXz6dWEZgajbdxxEnqw8Y_3JYPH8DMvqGb0fVoKw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064169.html">
   <LINK REL="Next"  HREF="064171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] COMMERCIAL:Re: Clarification or pausing a	consumer</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20COMMERCIAL%3ARe%3A%20Clarification%20or%20pausing%20a%0A%09consumer&In-Reply-To=%3CCAEeXt4O%3DXPbXz6dWEZgajbdxxEnqw8Y_3JYPH8DMvqGb0fVoKw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] COMMERCIAL:Re: Clarification or pausing a	consumer">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Oct 23 10:31:19 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064169.html">[Twisted-Python] COMMERCIAL:Re: Clarification or pausing a	consumer
</A></li>
        <LI>Next message (by thread): <A HREF="064171.html">[Twisted-Python] COMMERCIAL:Re: Clarification or pausing	a	consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64170">[ date ]</a>
              <a href="thread.html#64170">[ thread ]</a>
              <a href="subject.html#64170">[ subject ]</a>
              <a href="author.html#64170">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Oct 23, 2017 at 8:10 AM, Barry Scott &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">barry.scott at forcepoint.com</A>&gt;
wrote:

&gt;<i> On Saturday, 14 October 2017 07:44:12 BST Glyph wrote:
</I>&gt;<i> &gt; &gt; On Oct 13, 2017, at 5:47 PM, Jean-Paul Calderone
</I>&gt;<i> &gt; &gt; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On Fri, Oct 13, 2017 at 8:29 AM, Barry Scott &lt;
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">barry.scott at forcepoint.com</A>
</I>&gt;<i> &gt; &gt; &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">barry.scott at forcepoint.com</A>&gt;&gt; wrote: I have a app that needs to
</I>&gt;<i> &gt; &gt; send data as an http response. But the data is produced slowly. More
</I>&gt;<i> &gt; &gt; slowly then the time taken to transmit it.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The consumer keeps calling resumeProducing, but there is no data to
</I>&gt;<i> send
</I>&gt;<i> &gt; &gt; often.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; This sounds like a bug in the consumer.  There are two cases.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; If the producer is &quot;streaming&quot; or &quot;push&quot; (two words, one meaning) then
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; consumer should call resumeProducing once and let data come.  If it
</I>&gt;<i> wants
</I>&gt;<i> &gt; &gt; to slow down the data, it can call pauseProducing.  There's nothing
</I>&gt;<i> else
</I>&gt;<i> &gt; &gt; it should be doing.
</I>&gt;<i> &gt; This is the good kind of producer.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; If the producer is &quot;not streaming&quot; or &quot;pull&quot; (again, one meaning) then
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; consumer should call resumeProducing and wait for a write call.  Then
</I>&gt;<i> it
</I>&gt;<i> &gt; &gt; should call resumeProducing again (if it wants more data).  It should
</I>&gt;<i> not
</I>&gt;<i> &gt; &gt; call resumeProducing again while waiting for a write call.
</I>&gt;<i> &gt; This is the bad kind.  It is basically pointless.  It was a design error
</I>&gt;<i> to
</I>&gt;<i> &gt; include it and it should be removed from Twisted eventually.
</I>&gt;<i>
</I>&gt;<i> Oh. This is surprising to here what is the rational behind this &quot;good&quot; vs.
</I>&gt;<i> &quot;bad&quot;?
</I>&gt;<i>
</I>
What makes it &quot;bad&quot; is that it creates extra work for every consumer
implementation.  The extra work is implementing largely the same thing
every time so it's also redundant work.  The logic for knowing when to call
resumeProducing again is always exactly the same regardless of the
consumer.  It doesn't belong inside every consumer.


&gt;<i>
</I>&gt;<i> My use case is that I'm a proxy and I can only produce what has been
</I>&gt;<i> received
</I>&gt;<i> from the other side.
</I>&gt;<i>
</I>&gt;<i>
</I>This sounds like it should be a push producer to me.


&gt;<i> A hard CPU loop calling resumeProducing is not appropiate for this use
</I>&gt;<i> case.
</I>&gt;<i>
</I>&gt;<i>
</I>This is appropriate behavior for neither kind of producer.  As I wrote in
my first reply, a consumer with a pull (&quot;not streaming&quot;, &quot;bad&quot;) producer
should call resumeProducing once and then wait until write is called on
it.  After write is called on it, it may call resumeProducing again if it
wants.

Jean-Paul


&gt;<i> I had to work around what looked like a bug that the streaming parameter is
</I>&gt;<i> ignored and call unregisterProducer/registedProduced to get back usable
</I>&gt;<i> behaviour.
</I>&gt;<i>
</I>&gt;<i> Barry
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; What is the correct way to pause the consumer so that it does not keep
</I>&gt;<i> &gt; &gt; calling resumeProducing? unregisterProducer?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Probably just fix the consumer implementation to not be broken.  Or
</I>&gt;<i> switch
</I>&gt;<i> &gt; &gt; to tubes which has a simpler model and (in principle) fewer places to
</I>&gt;<i> &gt; &gt; make mistakes.
</I>&gt;<i> &gt; My guess is not that the consumer is broken, but rather, you registered
</I>&gt;<i> your
</I>&gt;<i> &gt; producer as the bad kind of producer (&quot;pull&quot;) and it's just doing as it
</I>&gt;<i> was
</I>&gt;<i> &gt; told, which is to keep calling resumeProducing over and over again every
</I>&gt;<i> &gt; time it wants data.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Let us know how it works out!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Then when the next block of data is available what is the correct way
</I>&gt;<i> to
</I>&gt;<i> &gt; &gt; resume the consumer? registerProducer?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Related to that why does HTTPChannel.registerProducer convert a
</I>&gt;<i> &gt; &gt; IPullProducer into a IPushProducer using _PullToPush?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Probably as an attempt to simplify the implementation - to make it so
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; consumer can pretend there's just one kind of producer instead of two
</I>&gt;<i> &gt; &gt; (which would be nice for everyone).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Jean-Paul
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20171023/5b31fecd/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064169.html">[Twisted-Python] COMMERCIAL:Re: Clarification or pausing a	consumer
</A></li>
	<LI>Next message (by thread): <A HREF="064171.html">[Twisted-Python] COMMERCIAL:Re: Clarification or pausing	a	consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64170">[ date ]</a>
              <a href="thread.html#64170">[ thread ]</a>
              <a href="subject.html#64170">[ subject ]</a>
              <a href="author.html#64170">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
