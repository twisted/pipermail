<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Where to start: log reader/analysis
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Where%20to%20start%3A%20log%20reader/analysis&In-Reply-To=%3C8b93c05a0708060157j2ffa75c1u170aecaea5a36f6c%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048326.html">
   <LINK REL="Next"  HREF="048330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Where to start: log reader/analysis</H1>
    <B>Yoann Aubineau</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Where%20to%20start%3A%20log%20reader/analysis&In-Reply-To=%3C8b93c05a0708060157j2ffa75c1u170aecaea5a36f6c%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Where to start: log reader/analysis">yoann.aubineau at wengo.com
       </A><BR>
    <I>Mon Aug  6 02:57:19 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048326.html">[Twisted-Python] Where to start: log reader/analysis
</A></li>
        <LI>Next message (by thread): <A HREF="048330.html">[Twisted-Python] Where to start: log reader/analysis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48327">[ date ]</a>
              <a href="thread.html#48327">[ thread ]</a>
              <a href="subject.html#48327">[ subject ]</a>
              <a href="author.html#48327">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Andrew,

I wrote a class that follows a file (eg. log file) and provides an iterator
to walk through it. Don't know if it may be of any use for you (or others).

class FileFollower(object):
    &quot;&quot;&quot;Iterate through a file while it is updated.

    &gt;&gt;&gt; file = FileFollower(&quot;/tmp/testfile&quot;)
    &gt;&gt;&gt; file.interval = 5
    &gt;&gt;&gt; for line in file:
    ...     print line
    &quot;&quot;&quot;

    interval = 1

    def __init__(self, filename, interval=None):
        self.filename = filename
        self.interval = interval or self.interval
        self.stat = None
        self.offset = 0
        self.lines = []
        self.running = True

    #
    # File following

    def follow(self):
        while self.running:
            if self.hasChanged():
                data = self.readChange()
                if data:
                    self.dataReceived(data)
                    break
            time.sleep(self.interval)

    def hasChanged(self):
        stat = os.stat(self.filename)
        if stat != self.stat:
            self.stat = stat
            return True
        return False

    def readChange(self):
        file = open(self.filename)
        file.seek(self.offset)
        data = file.read()
        self.offset = file.tell()
        file.close()
        return data

    #
    # Data buffering

    def dataReceived(self, data):
        lines = data.split(os.linesep)
        lines = lines[:-1]
        for line in lines:
            self.lineReceived(line)

    def lineReceived(self, line):
        self.lines.append(line)

    #
    # Iterator implementation

    def __iter__(self):
        return self

    def next(self):
        if not self.lines:
            self.follow()
        line = self.lines.pop(0)
        return line


2007/8/5, Andrew E &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">andrew at ellerton.net</A>&gt;:
&gt;<i>
</I>&gt;<i> Dear Twisted Experts (... meant in a nice way :) )
</I>&gt;<i>
</I>&gt;<i> I'm not sure where to start.
</I>&gt;<i>
</I>&gt;<i> I need to write a small server that:
</I>&gt;<i>
</I>&gt;<i> - reads lines in a log file as they are appended
</I>&gt;<i> - reads input from a socket as it becomes available
</I>&gt;<i> - does an analysis of both (like, what time was input received in the
</I>&gt;<i> log, and the output received via the socket)
</I>&gt;<i> - outputs a summary report
</I>&gt;<i>
</I>&gt;<i> Socket I/O is easy - but I'm not sure how to include file reading ...
</I>&gt;<i> its bound to be easy.
</I>&gt;<i>
</I>&gt;<i> Any tips?
</I>&gt;<i>
</I>&gt;<i> Thanks :)
</I>&gt;<i>
</I>&gt;<i> Andrew
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20070806/05616755/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048326.html">[Twisted-Python] Where to start: log reader/analysis
</A></li>
	<LI>Next message (by thread): <A HREF="048330.html">[Twisted-Python] Where to start: log reader/analysis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48327">[ date ]</a>
              <a href="thread.html#48327">[ thread ]</a>
              <a href="subject.html#48327">[ subject ]</a>
              <a href="author.html#48327">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
