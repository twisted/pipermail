<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] TDDing an ssh client - mocking the server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20TDDing%20an%20ssh%20client%20-%20mocking%20the%20server&In-Reply-To=%3C20070806120334.4947.1638958206.divmod.quotient.19459%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048328.html">
   <LINK REL="Next"  HREF="048339.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] TDDing an ssh client - mocking the server</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20TDDing%20an%20ssh%20client%20-%20mocking%20the%20server&In-Reply-To=%3C20070806120334.4947.1638958206.divmod.quotient.19459%40ohm%3E"
       TITLE="[Twisted-Python] TDDing an ssh client - mocking the server">exarkun at divmod.com
       </A><BR>
    <I>Mon Aug  6 06:03:34 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048328.html">[Twisted-Python] TDDing an ssh client - mocking the server
</A></li>
        <LI>Next message (by thread): <A HREF="048339.html">[Twisted-Python] TDDing an ssh client - mocking the server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48331">[ date ]</a>
              <a href="thread.html#48331">[ thread ]</a>
              <a href="subject.html#48331">[ subject ]</a>
              <a href="author.html#48331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 6 Aug 2007 12:11:29 +0100, Dave Kirby &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">d.kirby at tideway.com</A>&gt; wrote:
&gt;<i>Firstly a belated thanks to everyone who replied to my previous question
</I>&gt;<i>- I had to put my project on hold for a while, but now I am back with
</I>&gt;<i>more questions.
</I>&gt;<i>
</I>&gt;<i>My objective is to use twisted to do automated logging in to multiple
</I>&gt;<i>ssh servers to carry out various tasks.  Currently this is done by
</I>&gt;<i>spawning a separate ssh executable for each session and controlling it
</I>&gt;<i>through pexpect, and I would like to replace this with a twisted/conch
</I>&gt;<i>system.
</I>&gt;<i>
</I>&gt;<i>So far I can create conch &quot;exec&quot; sessions to run a single command/script
</I>&gt;<i>and return the result, but I would like to be able to create shell
</I>&gt;<i>sessions and do more interactive work.  Does anyone have any examples of
</I>&gt;<i>doing this?
</I>&gt;<i>
</I>&gt;<i>The biggest issue I have at the moment is how to do Test Driven
</I>&gt;<i>Development with conch.  I would like to be able to mock out the server
</I>&gt;<i>that the ssh client talks to, so that I can keep the unit tests
</I>&gt;<i>self-contained and keep tight control of both sides of the interaction,
</I>&gt;<i>e.g. for testing failure scenarios.  I can think of three ways of doing
</I>&gt;<i>this:
</I>&gt;<i>
</I>&gt;<i>1) write a separate ssh server with conch that provides the desired
</I>&gt;<i>behaviour, and have that spawned as a separate process by the unit
</I>&gt;<i>tests.
</I>&gt;<i>
</I>&gt;<i>2) as above, but run the ssh server in the same process as the tests, so
</I>&gt;<i>they are both firing from the same reactor event loop.  IMHO this is
</I>&gt;<i>better than (1) since it is more self-contained.
</I>&gt;<i>
</I>&gt;<i>3) stub out the low-level classes of the client so that they are not
</I>&gt;<i>really talking to a server at all, but simulating the correct behaviour.
</I>&gt;<i>
</I>&gt;<i>The problem with both 1 and 2 is that they require writing test code
</I>&gt;<i>that is as complex as the code I am testing.  The problem with 3 is that
</I>&gt;<i>it assumes that I know what the correct low-level behaviour is so that I
</I>&gt;<i>can mock it out.  At the moment I do not grok twisted in sufficient
</I>&gt;<i>detail to do that.
</I>
I suspect a lot of the code that you write will be for handling the output
from and generating input to send to processes run via ssh.  You should be
able to use #3 to test this kind of code, since the API for interacting
with conch from a protocol implementation is quite confined and well-defined.

I don't have much to suggest for avoiding #2 (but you probably don't want #1
in any case), but if you at least isolate the majority of your application
logic from most of conch, then you can test it without having any kind of
SSH server or mock around.  The code that's left over that does have to
interact with conch can be tested by itself, perhaps by setting up real
SSH connections, which may not be ideal, but you should at least be able to
do it, get it over with, and not worry about it anymore afterwards.  Most
of the rest of the code you write will be testable in isolation.

Hope this helps,

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048328.html">[Twisted-Python] TDDing an ssh client - mocking the server
</A></li>
	<LI>Next message (by thread): <A HREF="048339.html">[Twisted-Python] TDDing an ssh client - mocking the server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48331">[ date ]</a>
              <a href="thread.html#48331">[ thread ]</a>
              <a href="subject.html#48331">[ subject ]</a>
              <a href="author.html#48331">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
