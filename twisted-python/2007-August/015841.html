<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] locking threads when deferToThread is used
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20locking%20threads%20when%20deferToThread%20is%20used&In-Reply-To=20070808103136.4947.2032819735.divmod.quotient.20151%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015840.html">
   <LINK REL="Next"  HREF="015842.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] locking threads when deferToThread is used</H1>
    <B>Ladislav Andel</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20locking%20threads%20when%20deferToThread%20is%20used&In-Reply-To=20070808103136.4947.2032819735.divmod.quotient.20151%40ohm"
       TITLE="[Twisted-Python] locking threads when deferToThread is used">ladaan at iptel.org
       </A><BR>
    <I>Wed Aug  8 07:11:09 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015840.html">[Twisted-Python] locking threads when deferToThread is used
</A></li>
        <LI>Next message: <A HREF="015842.html">[Twisted-Python] locking threads when deferToThread is used
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15841">[ date ]</a>
              <a href="thread.html#15841">[ thread ]</a>
              <a href="subject.html#15841">[ subject ]</a>
              <a href="author.html#15841">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jean-Paul Calderone wrote:
&gt;<i> On Wed, 08 Aug 2007 09:56:16 +0200, Ladislav Andel &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ladaan at iptel.org</A>&gt; 
</I>&gt;<i> wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> I'm writing an application which will be periodically testing servers.
</I>&gt;&gt;<i> I will have a global list of these servers(domain names) and need to do
</I>&gt;&gt;<i> few tasks.
</I>&gt;&gt;<i> 1) DNS checks - I will use asynchronous twisted-names for it
</I>&gt;&gt;<i> - in case there is a difference comparing to the list it should 
</I>&gt;&gt;<i> update the list(then also in DB)
</I>&gt;&gt;<i> 2) ICMP pings - should be also possible to do it asynchronously
</I>&gt;&gt;<i> 3) Blocking function which will be pinging with SIP requests
</I>&gt;&gt;<i> - here I will use function deferToThread to make it non-blocking.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Questions:
</I>&gt;&gt;<i> 1) How do I lock each thread when writing to a global list in twisted?
</I>&gt;<i>
</I>&gt;<i> Don't.  Don't share state between different threads.  If you need to 
</I>&gt;<i> mutate
</I>&gt;<i> state as a result of code which has run in a thread, do it in the reactor
</I>&gt;<i> thread based on the result of the Deferred returned by deferToThread.
</I>&gt;<i>
</I>I'm aiming to use results of the Deffered returned by deferToThread.
Can you give me an example of combining two Deferred results?
This will be done through callbacks but what if the blocking application 
gives me result in 5 sec
and e.g. DNS check in 1 sec.

&gt;<i> Also, why do you need threads to send SIP messages?
</I>I use third party application where I'm just handling parameters to the 
application.
I know it's possible to do it somehow easily via twisted but I don't 
have time to explore it now.
I'm also quite new to python and also to twisted so that's why I don't 
want to get involved in something more
complex for now.

&gt;<i>
</I>&gt;&gt;<i> 2) How will I put together all three results mentioned above in the 
</I>&gt;&gt;<i> global list
</I>&gt;&gt;<i> - is it by using function callLater ?
</I>&gt;<i>
</I>&gt;<i> Don't use globals.  You can just put your state variables on an 
</I>&gt;<i> instance of
</I>&gt;<i> a class.  There's nothing unique to Twisted about this.  I'm not sure how
</I>&gt;<i> callLater would be involved.  callLater is for scheduling functions to 
</I>&gt;<i> run
</I>&gt;<i> based on timing events.
</I>&gt;<i>
</I>Can you give me a little example?

Lada


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015840.html">[Twisted-Python] locking threads when deferToThread is used
</A></li>
	<LI>Next message: <A HREF="015842.html">[Twisted-Python] locking threads when deferToThread is used
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15841">[ date ]</a>
              <a href="thread.html#15841">[ thread ]</a>
              <a href="subject.html#15841">[ subject ]</a>
              <a href="author.html#15841">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
