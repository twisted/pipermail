<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SSLContext not valid for TLS Server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SSLContext%20not%20valid%20for%20TLS%20Server&In-Reply-To=%3Cbc54bba4-afea-dd33-850d-d26bef911034%40gmx.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SSLContext not valid for TLS Server</H1>
    <B>ceeborraa</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SSLContext%20not%20valid%20for%20TLS%20Server&In-Reply-To=%3Cbc54bba4-afea-dd33-850d-d26bef911034%40gmx.de%3E"
       TITLE="[Twisted-Python] SSLContext not valid for TLS Server">ceeborraa at gmx.de
       </A><BR>
    <I>Wed Aug 16 14:15:32 MDT 2017</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64044">[ date ]</a>
              <a href="thread.html#64044">[ thread ]</a>
              <a href="subject.html#64044">[ subject ]</a>
              <a href="author.html#64044">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm running Twisted 17.5.0 on Python 3.5.3 and want to create a TLS
server with Twisted. I strictly sticked to the example of
echoserv_ssl.py on
<A HREF="http://twistedmatrix.com/documents/current/core/howto/ssl.html,">http://twistedmatrix.com/documents/current/core/howto/ssl.html,</A> but TLS
server is not running properly.

Despite the server starts correctly, it doesn't offer any cipher suites
to the client, no matter what kind of client is trying to connect. Any
time a client connects, the connection is immediately aborted by server
with the error message of:

&lt;class 'OpenSSL.SSL.Error'&gt;: [('SSL
routines','tls_post_process_client_hello',no shared cipher')]

I tried to connect to server with the TLS echo client example of
echoclient_ssl.py, with openssl s_client command and with nmap by using
the --ssl-enum-ciphers script. Each time it failed with the above error
message.

If I do not use the options offered by ssl.CertificateOptions() as
suggested in the example, but instead create a
ssl.DefaultOpenSSLContextFactory() where I provide the privateKey and
Certificate as filename-strings, the server works correctly and offers
the intended cipher suites.

But I need to create the SSLContext from a OpenSSL PKey-Object (private
Key) and a OpenSSL Certificate-Object. Therefore I adjusted the server
code of the TLS server example to:

certificate = ssl.Certificate(cert_obj)
privkey = ssl.KeyPair(pkey)    # pkey is the OpenSSL PKey object
prkey_and_cert =
ssl.PrivateCertificate.fromCertificateAndKeyPair(certificate,privkey)

factory = protocol.Factory.forProtocol(Echo)
reactor.listenSSL(7498,factory,prkey_and_cert.options())

Again, the server starts, but it does not provide cipher suites so that
no client can connect. Same as above!

Appreciate any help!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20170816/681adcab/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64044">[ date ]</a>
              <a href="thread.html#64044">[ thread ]</a>
              <a href="subject.html#64044">[ subject ]</a>
              <a href="author.html#64044">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
