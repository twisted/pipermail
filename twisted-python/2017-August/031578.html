<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Is there a nice way to write transport-agnostic protocols and servers/clients?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Is%20there%20a%20nice%20way%20to%20write%0A%20transport-agnostic%20protocols%20and%20servers/clients%3F&In-Reply-To=%3CCA%2BHdgOVrsHiyFdT_OoAZbo15O_43if_pKvuEvcZ_kHgwCwvEMg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031577.html">
   <LINK REL="Next"  HREF="031579.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Is there a nice way to write transport-agnostic protocols and servers/clients?</H1>
    <B>Jarosław Fedewicz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Is%20there%20a%20nice%20way%20to%20write%0A%20transport-agnostic%20protocols%20and%20servers/clients%3F&In-Reply-To=%3CCA%2BHdgOVrsHiyFdT_OoAZbo15O_43if_pKvuEvcZ_kHgwCwvEMg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Is there a nice way to write transport-agnostic protocols and servers/clients?">jaroslaw.fedewicz at gmail.com
       </A><BR>
    <I>Wed Aug 16 05:53:07 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031577.html">[Twisted-Python] Is there a nice way to write transport-agnostic protocols and servers/clients?
</A></li>
        <LI>Next message (by thread): <A HREF="031579.html">[Twisted-Python] Is there a nice way to write transport-agnostic protocols and servers/clients?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31578">[ date ]</a>
              <a href="thread.html#31578">[ thread ]</a>
              <a href="subject.html#31578">[ subject ]</a>
              <a href="author.html#31578">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This makes a perfect sense. (I ended up implementing it in this sorta way,
but the other way around: it was a primarily-datagram protocol that could
use TCP as a transport, provided there is appropriate framing.)

However, while there is really a need for a shim to make use of
polytransport protocols (DNS, syslog, SIP, NFS are a few), it looks like
every Twisted user should bring their own. This bothers me, but just a
little bit.

Also, your reply does not address the little discrepancies that exist in
Twisted between two kinds of datagram protocols (namely, Unix datagram
sockets and UDP): seems like UDP APIs progressed while Unix datagram socket
support was &quot;left behind&quot;. I don't know if this is deliberate or not.

One thing that is also notably missing from the puzzle is that there is no
support for datagram endpoints. With stream sockets, I can now use strings
and clientFromString()/serverFromString() and be blissfully ignorant if
it's TCP or a Unix socket. I cannot do the same with datagram sockets, I
need to be actively aware if what I'm dealing with is a UDP socket or a
Unix datagram socket.

I'd gladly implement something to fill the gap, but I fear my contribution
would be rejected because, say, it doesn't conform to the general direction
Twisted is heading, whatever that may be. Or because datagram protocols are
somehow inferior as a class. Or because Unix datagram sockets in particular
should die and burn in hell.



On Wed, Aug 16, 2017 at 10:07 AM, Cory Benfield &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">cory at lukasa.co.uk</A>&gt; wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; On 15 Aug 2017, at 01:22, Jarosław Fedewicz &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jaroslaw.fedewicz at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The number of protocols that use TCP or UDP interchangeably is quite
</I>&gt;<i> high. Some applications where Twisted would be an appropriate choice, could
</I>&gt;<i> even work with non-TCP/UDP transports, like QUIC, DCCP, STCP, etc.
</I>&gt;<i>
</I>&gt;<i> Is it? TCP and UDP behave *very* differently: what protocols can safely
</I>&gt;<i> use them interchangeably?
</I>&gt;<i>
</I>&gt;<i> As to QUIC/DCCP/STCP and friends, ultimately the natural thing to do is to
</I>&gt;<i> use composition of protocols, the same way TLSMemoryBIOProtocol does in
</I>&gt;<i> Twisted. Essentially, you write a class (or collection of classes) that
</I>&gt;<i> present themselves as both a protocol and a transport, and then you create
</I>&gt;<i> a pipeline. For HTTP/2, for example, we have the following series of
</I>&gt;<i> objects: reactor &lt;-&gt; TCP transport &lt;-&gt; TLSMemoryBIOProtocol &lt;-&gt;
</I>&gt;<i> H2Connection &lt;-&gt; H2Stream &lt;-&gt; Request body handler protocol (provided by
</I>&gt;<i> the user).
</I>&gt;<i>
</I>&gt;<i> In each case, the intermediary objects provide both a transport and
</I>&gt;<i> protocol interface. For example, from the TCP transport’s perspective,
</I>&gt;<i> TLSMemoryBIOProtocol is a protocol. But from H2Connection’s perspective,
</I>&gt;<i> it’s a transport. Similarly, H2Connection and H2Stream together provide
</I>&gt;<i> both a protocol and transport interface: H2Connection is a protocol,
</I>&gt;<i> H2Stream is a transport, and they communicate together.
</I>&gt;<i>
</I>&gt;<i> For QUIC, ultimately it’s a protocol that runs over UDP. So you’d want to
</I>&gt;<i> compose again: QUIC should be a protocol from the perspective of the UDP
</I>&gt;<i> transport, and a transport from the perspective of its inner protocol
</I>&gt;<i> (which would probably want to be something like HTTP, though there are some
</I>&gt;<i> thorns here).
</I>&gt;<i>
</I>&gt;<i> The only thing you can’t paste over is the difference between a streaming
</I>&gt;<i> and non-streaming transport, which is as it should be: you cannot treat
</I>&gt;<i> these two as identical. If *your specific protocol* can, then that’s ok:
</I>&gt;<i> define an extra object that does the mapping. For example, imagine we’re
</I>&gt;<i> using CorytextTransferProtocol, which can run over UDP and TCP equally
</I>&gt;<i> well. Let’s not worry about how it does this (probably it has to reinvent
</I>&gt;<i> TCP over UDP, but let’s not care). The way you’d do it is to define your
</I>&gt;<i> core protocol logic in terms of, say, the stream transport interface
</I>&gt;<i> (`class CorytextTransferProtocol` will call transport.write). Then, you
</I>&gt;<i> write a shim class: `class UDPtoTCPforCTTPMapping`, say. This class does
</I>&gt;<i> nothing if its transport is a stream transport, but does some appropriate
</I>&gt;<i> transformation for datagram transports. Then, when you instantiate your
</I>&gt;<i> protocol you set the mapping class as the protocol for the underlying
</I>&gt;<i> transport, and then make the CorytextTransferProtocol class the protocol
</I>&gt;<i> for the mapping. Essentially you get: underlying transport &lt;-&gt;
</I>&gt;<i> UDPtoTCPforCTTPMapping &lt;-&gt; CorytextTransferProtocol.
</I>&gt;<i>
</I>&gt;<i> The great advantage of this is that your two classes can be decoupled, so
</I>&gt;<i> if the strategy of mapping streaming to datagram transport is general it
</I>&gt;<i> can be re-used by other protocols that want a streaming interface.
</I>&gt;<i>
</I>&gt;<i> Does this make sense?
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


-- 
Yaroslav Fedevych
IT Philosopher
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20170816/5ed73914/attachment.html&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031577.html">[Twisted-Python] Is there a nice way to write transport-agnostic protocols and servers/clients?
</A></li>
	<LI>Next message (by thread): <A HREF="031579.html">[Twisted-Python] Is there a nice way to write transport-agnostic protocols and servers/clients?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31578">[ date ]</a>
              <a href="thread.html#31578">[ thread ]</a>
              <a href="subject.html#31578">[ subject ]</a>
              <a href="author.html#31578">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
