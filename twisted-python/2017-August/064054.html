<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SSLContext not valid for TLS Server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SSLContext%20not%20valid%20for%20TLS%20Server&In-Reply-To=%3C6819A214-D65B-41BE-B371-4BA23773DC58%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031583.html">
   <LINK REL="Next"  HREF="064058.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SSLContext not valid for TLS Server</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SSLContext%20not%20valid%20for%20TLS%20Server&In-Reply-To=%3C6819A214-D65B-41BE-B371-4BA23773DC58%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] SSLContext not valid for TLS Server">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Aug 17 23:23:40 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031583.html">[Twisted-Python] SSLContext not valid for TLS Server
</A></li>
        <LI>Next message (by thread): <A HREF="064058.html">[Twisted-Python] SSLContext not valid for TLS Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64054">[ date ]</a>
              <a href="thread.html#64054">[ thread ]</a>
              <a href="subject.html#64054">[ subject ]</a>
              <a href="author.html#64054">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Aug 16, 2017, at 1:15 PM, ceeborraa &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ceeborraa at gmx.de</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm running Twisted 17.5.0 on Python 3.5.3 and want to create a TLS server with Twisted. I strictly sticked to the example of echoserv_ssl.py on <A HREF="http://twistedmatrix.com/documents/current/core/howto/ssl.html,">http://twistedmatrix.com/documents/current/core/howto/ssl.html,</A> but TLS server is not running properly. 
</I>&gt;<i> 
</I>&gt;<i> Despite the server starts correctly, it doesn't offer any cipher suites to the client, no matter what kind of client is trying to connect. Any time a client connects, the connection is immediately aborted by server with the error message of: 
</I>&gt;<i> 
</I>&gt;<i> &lt;class 'OpenSSL.SSL.Error'&gt;: [('SSL routines','tls_post_process_client_hello',no shared cipher')]
</I>&gt;<i> 
</I>&gt;<i> I tried to connect to server with the TLS echo client example of echoclient_ssl.py, with openssl s_client command and with nmap by using the --ssl-enum-ciphers script. Each time it failed with the above error message.
</I>&gt;<i> 
</I>&gt;<i> If I do not use the options offered by ssl.CertificateOptions() as suggested in the example, but instead create a ssl.DefaultOpenSSLContextFactory() where I provide the privateKey and Certificate as filename-strings, the server works correctly and offers the intended cipher suites.
</I>&gt;<i> 
</I>&gt;<i> But I need to create the SSLContext from a OpenSSL PKey-Object (private Key) and a OpenSSL Certificate-Object. Therefore I adjusted the server code of the TLS server example to: 
</I>&gt;<i> 
</I>&gt;<i> certificate = ssl.Certificate(cert_obj)
</I>&gt;<i> privkey = ssl.KeyPair(pkey)    # pkey is the OpenSSL PKey object
</I>&gt;<i> prkey_and_cert = ssl.PrivateCertificate.fromCertificateAndKeyPair(certificate,privkey)
</I>&gt;<i> 
</I>&gt;<i> factory = protocol.Factory.forProtocol(Echo)
</I>&gt;<i> reactor.listenSSL(7498,factory,prkey_and_cert.options())
</I>&gt;<i> 
</I>&gt;<i> Again, the server starts, but it does not provide cipher suites so that no client can connect. Same as above!
</I>&gt;<i> 
</I>&gt;<i> Appreciate any help!
</I>
This sounds like it might be a configuration problem with your build of OpenSSL.  Can you post the most detailed explanation of what versions of everything you're using that you can?  Particularly: your operating system, any installed version of OpenSSL, cryptography?  (If you know how to check which OpenSSL cryptography is linked to, that would be great too.)  What attributes does the private key have?

Thanks for using Twisted,

-g


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031583.html">[Twisted-Python] SSLContext not valid for TLS Server
</A></li>
	<LI>Next message (by thread): <A HREF="064058.html">[Twisted-Python] SSLContext not valid for TLS Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64054">[ date ]</a>
              <a href="thread.html#64054">[ thread ]</a>
              <a href="subject.html#64054">[ subject ]</a>
              <a href="author.html#64054">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
