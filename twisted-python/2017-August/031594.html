<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] trial.unitest-specific segfault with lxml
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20trial.unitest-specific%20segfault%20with%20lxml&In-Reply-To=%3CCAMcKhMTL91%3DUTYw8aWDcRF9rn_dcFqFT_n%2BTduvWWPxOfkvpPQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031592.html">
   <LINK REL="Next"  HREF="031595.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] trial.unitest-specific segfault with lxml</H1>
    <B>Tristan Seligmann</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20trial.unitest-specific%20segfault%20with%20lxml&In-Reply-To=%3CCAMcKhMTL91%3DUTYw8aWDcRF9rn_dcFqFT_n%2BTduvWWPxOfkvpPQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] trial.unitest-specific segfault with lxml">mithrandi at mithrandi.net
       </A><BR>
    <I>Fri Aug 18 00:05:58 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031592.html">[Twisted-Python] trial.unitest-specific segfault with lxml
</A></li>
        <LI>Next message (by thread): <A HREF="031595.html">[Twisted-Python] trial.unitest-specific segfault with lxml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31594">[ date ]</a>
              <a href="thread.html#31594">[ thread ]</a>
              <a href="subject.html#31594">[ subject ]</a>
              <a href="author.html#31594">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 18 Aug 2017 at 00:47 Phil Mayers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">p.mayers at imperial.ac.uk</A>&gt; wrote:

&gt;<i> SSCCE - well, hopefully correct - here:
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://gist.github.com/philmayers/387597c7407ab98f159426cea5f44a69">https://gist.github.com/philmayers/387597c7407ab98f159426cea5f44a69</A>
</I>&gt;<i>
</I>
Note that I don't think you're allowed to catch GeneratorExit like this;
normally doing so will crash your program with a RuntimeError after the
generator fails to exit (possibly masked here by the generator living until
the end of the program). However, I was able to reproduce the crash even
after removing the try/except, so I don't think this issue is related.

Given that the crash only occurs at exit, I suspect this has something to
do with finalizers running at a bad time during interpreter shutdown, but I
don't have time at the moment to look into this deeply (I just spotted the
GeneratorExit issue and wanted to check if that was the problem).

I suspect this is an lxml or Cython bug, ultimately, but changing the test
base class changes some ordering of events arbitrarily resulting in this
heisencrash. Alternatively, it might have something to do with logging.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20170818/7ce6a6fe/attachment.html&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031592.html">[Twisted-Python] trial.unitest-specific segfault with lxml
</A></li>
	<LI>Next message (by thread): <A HREF="031595.html">[Twisted-Python] trial.unitest-specific segfault with lxml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31594">[ date ]</a>
              <a href="thread.html#31594">[ thread ]</a>
              <a href="subject.html#31594">[ subject ]</a>
              <a href="author.html#31594">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
