<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Weird PyPY twisted.internet.defer.TimeoutError ERROR*12 during full test run
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Weird%20PyPY%20twisted.internet.defer.TimeoutError%0A%20ERROR%2A12%20during%20full%20test%20run&In-Reply-To=%3CCADzPF4v7nyvJVk4p2So7%3DaqEvjoH_3Bb%3D1nJmv%3De_5YrGj%3Dwyg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="031563.html">
   <LINK REL="Next"  HREF="031564.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Weird PyPY twisted.internet.defer.TimeoutError ERROR*12 during full test run</H1>
    <B>Daniel Sutcliffe</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Weird%20PyPY%20twisted.internet.defer.TimeoutError%0A%20ERROR%2A12%20during%20full%20test%20run&In-Reply-To=%3CCADzPF4v7nyvJVk4p2So7%3DaqEvjoH_3Bb%3D1nJmv%3De_5YrGj%3Dwyg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Weird PyPY twisted.internet.defer.TimeoutError ERROR*12 during full test run">dansut at gmail.com
       </A><BR>
    <I>Mon Aug  7 15:45:44 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="031563.html">[Twisted-Python] Weird PyPY twisted.internet.defer.TimeoutError ERROR*12 during full test run
</A></li>
        <LI>Next message (by thread): <A HREF="031564.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31565">[ date ]</a>
              <a href="thread.html#31565">[ thread ]</a>
              <a href="subject.html#31565">[ subject ]</a>
              <a href="author.html#31565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Many thanks Tristan for sharing your experiences here, I'm sure
they'll get me a little closer to finding the root cause of these test
result peculiarities.

On Sat, 5 Aug 2017 at 00:44 Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt; wrote:
&gt;&gt;<i> For the buildbot:
</I>&gt;&gt;<i>   <A HREF="https://buildbot.twistedmatrix.com/builders/ubuntu16.04-pypy5/">https://buildbot.twistedmatrix.com/builders/ubuntu16.04-pypy5/</A>
</I>&gt;&gt;<i> they seem to pretty much consistently happen during:
</I>&gt;&gt;<i>   twisted.protocols.test.test_tls.TLSMemoryBIOTests.test_hugeWrite_TLSv1_1
</I>&gt;&gt;<i> but running in my own environment(s) I also always see the 12
</I>&gt;&gt;<i> TimoutError but they can occur in a variety of different tests, I've
</I>&gt;&gt;<i> seen them in these as well as the above:
</I>&gt;&gt;<i>   twisted.news.test.test_news.NewsTests.testArticleRequest
</I>&gt;&gt;<i>   twisted.names.test.test_server.DNSServerFactoryTests.test_verboseDefault
</I>&gt;&gt;<i>   twisted.positioning.test.test_nmea.BrokenSentenceCallbackTests.test_dontSwallowCallbackException
</I>&gt;&gt;<i> and a bunch of others.
</I>
On Fri, Aug 4, 2017 at 11:22 PM, Tristan Seligmann
&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mithrandi at mithrandi.net</A>&gt; wrote:
&gt;<i> This kind of timeout usually means that the test is waiting for some event,
</I>&gt;<i> and due to an event ordering that wasn't expected, the event never happens;
</I>&gt;<i> for example, it might have already happened before you start waiting for it,
</I>&gt;<i> or it might not happen at all due to an error.
</I>&gt;<i>
</I>&gt;<i> Sometimes this means that the test is really stuck, but often it means that
</I>&gt;<i> an error has occurred but was not handled by the test, so you get an error
</I>&gt;<i> (maybe logged, maybe not) but also the test never ends.
</I>
Having now looked deeper into the other tests I have had the ERROR
occur in I can confidently say there seems to little in common with
the tests I have seen get stuck in the TimeoutError. The last two in
list specifically seem like very unlikely culprits...

&gt;<i>From this my gut is that this is nothing to do with the tests
</I>themselves and more to do with something in the long running trial
that is having issues when run under PyPy

&gt;&gt;<i> Always exactly 12 and always during same test for a single test run.
</I>&gt;&gt;<i> I've not been able to reproduce running anything but the full
</I>&gt;&gt;<i> testsuite - but they have always occurred for me during full run.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Just wondered if anybody with more experience had a clue/idea as to
</I>&gt;&gt;<i> why this could happen (why 12), and how I could go about tracking down
</I>&gt;&gt;<i> the root cause.
</I>&gt;<i>
</I>&gt;<i> Look for missing error handling in the test to see if an error is occurring
</I>&gt;<i> that the test does not notice; if you're lucky, these errors may have been
</I>&gt;<i> logged (check test.log). If not, you may need to improve the error handling
</I>&gt;<i> and / or play around in a debugger.
</I>
Nothing in test.log when this happens, and I've yet to work out a way
of getting a debugger to cooperate by dropping me out of execution
when these TimeoutError occur so I can get an idea of what is being
waited for, where.

&gt;<i> If the test really is stuck, a common cause of PyPy vs CPython issues is
</I>&gt;<i> garbage collection or weakref callbacks happening in an unpredictable
</I>&gt;<i> ordering of events. I haven't looked at the tests in question but I would
</I>&gt;<i> check for things like __del__ methods (eg. files not being closed
</I>&gt;<i> explicitly) or weakref use in the vicinity.
</I>
I've certainly noticed differences with weakref and GC under PyPy, I think:
  twisted.test.test_threadpool.ThreadPoolTests.test_threadCreationArgumentsCallInThreadWithCallback
specifically shows as a FAIL under PyPy because the test relies on a
weakref being collected, when this can't be relied on under PyPy.

Cheers
/dan
-- 
Daniel Sutcliffe &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dansut at gmail.com</A>&gt;

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="031563.html">[Twisted-Python] Weird PyPY twisted.internet.defer.TimeoutError ERROR*12 during full test run
</A></li>
	<LI>Next message (by thread): <A HREF="031564.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31565">[ date ]</a>
              <a href="thread.html#31565">[ thread ]</a>
              <a href="subject.html#31565">[ subject ]</a>
              <a href="author.html#31565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
