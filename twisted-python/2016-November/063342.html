<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted 16.6.0rc1 Release Candidate	Announcement
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%2016.6.0rc1%20Release%20Candidate%0A%09Announcement&In-Reply-To=%3CA1BAC53B-0CA3-4EF9-A6E6-D5362F2C3CA9%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063341.html">
   <LINK REL="Next"  HREF="063344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted 16.6.0rc1 Release Candidate	Announcement</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%2016.6.0rc1%20Release%20Candidate%0A%09Announcement&In-Reply-To=%3CA1BAC53B-0CA3-4EF9-A6E6-D5362F2C3CA9%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Twisted 16.6.0rc1 Release Candidate	Announcement">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Nov 17 12:00:13 MST 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063341.html">[Twisted-Python] Twisted 16.6.0rc1 Release Candidate	Announcement
</A></li>
        <LI>Next message (by thread): <A HREF="063344.html">[Twisted-Python] Twisted 16.6.0rc1 Release Candidate	Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63342">[ date ]</a>
              <a href="thread.html#63342">[ thread ]</a>
              <a href="subject.html#63342">[ subject ]</a>
              <a href="author.html#63342">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Nov 17, 2016, at 6:43 AM, Mark Williams &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">markrwilliams at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Wed, Nov 16, 2016 at 11:22:49PM -0800, Glyph Lefkowitz wrote:
</I>&gt;&gt;<i> However; is it really a regression to have py3 support for Words that just doesn't support other encodings yet?  It strikes me that this is just a bug, and that we should just fall back from UTF-8 to latin-1 in this scenario.  But adding that fallback is a small additional fix (perhaps one that should be slated for 16.6.0 if you want to make it).
</I>&gt;<i> 
</I>&gt;<i> Falling back to latin-1 will address the most obvious issue exposed by
</I>&gt;<i> the client in the re-opened ticket.  It will not fix the general issue.
</I>
This doesn't appear to be an answer to the &quot;is it a regression&quot; question though ;-).  I'm still curious what you think there.

The _general_ issue is unfixable, except to use chardet upon encoding errors.  As far as I'm aware, IRC simply doesn't have the ability to specify an encoding.

More importantly, IRC doesn't specify an encoding and it is also responsible for transmitting textual data intended to be input and consumed by humans.  If you can't decode it, faithfully replicating the on-the-wire encoding is of limited utility.  You can't write any code to process the data.

&gt;<i> Note that my sample was heavily biased towards European servers.
</I>&gt;<i> Other IRC servers in other regions might prefer a different 8-bit
</I>&gt;<i> encoding, like windows-1251 or Big5.  And often a single server will
</I>&gt;<i> see a long tail (or at least a tail) of different 8-bit encodings.
</I>&gt;<i> Listing all channels on a server, as the example script does, cannot
</I>&gt;<i> be done with an implementation that decodes input as text prior to
</I>&gt;<i> parsing it.  It's even possible to use chardet to detect encodings.
</I>
If chardet is installed, can it be specified as an encoding itself?  Like, b&quot;garbage garbage&quot;.decode(&quot;chardet&quot;)?  This would make it possible to use without binding to the library; you just specify an encoding.  (The library is LGPL2.1 which makes it a problematic dependency for Twisted, even optionally.)

&gt;<i> IRC's encoding situation mirrors file systems' one on POSIX.  A given
</I>&gt;<i> path's components can be in multiple encodings.  I believe at least
</I>&gt;<i> part of the reason FilePath's paths are bytes, even when
</I>&gt;<i> surrogateescape exists, is that Unicode paths on POSIX systems would
</I>&gt;<i> make FilePath unusable for perfectly valid use cases.  We can pretend
</I>&gt;<i> that IRC has a defined encoding, but doing so will make unusable for
</I>&gt;<i> perfectly valid use cases.
</I>
Here we go :-).

POSIX has an internally inconsistent model of how encodings work; they cannot possibly function correctly.

First off, let me put to rest the lie that paths are &quot;really&quot; bytes.  Paths are text.  They must be text because they have to transit through text-processing systems, such as windowing systems and and terminal programs.  Users must be able to visually identify and select them, as text.

This is significant because certain operations on paths-as-bytes will inevitably fail.  You can't type an invalidly-encoded pathname in your shell.  If two paths differ by an incorrectly-encoded character you won't be able to visually distinguish between them without inspecting their contents.  This is why OS X forces all paths to be UTF-8, and why paths are &quot;really&quot; unicode (UCS-2, precisely) on Windows.

There's POSIX metadata which allows you to select an encoding; locale.  But, locale is per-process state, and, due to the fact that you can have multiple filesystems mounted simultaneously, it's impossible for this metadata to fully describe the state of any arbitrary path.  The standard metadata is insufficient.  This is why UI toolkits like GTK+ have adopted the policy of &quot;ignore the locale, paths are UTF-8, deal with it ðŸ•¶&quot;.  As far back as GTK2, non-utf-8 path selection has been deprecated: &lt;<A HREF="https://developer.gnome.org/gtk2/stable/GtkFileSelection.html#gtk-file-selection-set-filename">https://developer.gnome.org/gtk2/stable/GtkFileSelection.html#gtk-file-selection-set-filename</A> &lt;<A HREF="https://developer.gnome.org/gtk2/stable/GtkFileSelection.html#gtk-file-selection-set-filename">https://developer.gnome.org/gtk2/stable/GtkFileSelection.html#gtk-file-selection-set-filename</A>&gt;&gt;.

While a mis-encoded path is a failure, there are ways to treat paths as a data structure to allow for only partial failure.  They're a data structure because they must be in an encoding with no NULLs, which encode SOLIDUS as the octet 0x2F, and so you can fail on each individual path component; if you're lucky you don't need to present all the components in the path to manipulate it.

We don't do this in Twisted right now (as I was somewhat disappointed to discover while writing this), but we should, and more importantly we could; FilePath(b&quot;\xff&quot;).child(&quot;valid&quot;).asTextMode().basename() could return u&quot;valid&quot; rather than returning an encoding error.

To bring all this back to IRC though:

Mis-encoded IRC messages are not data structures; they're just strings.  There's no opportunity for partial recovery beyond chardet and mojibake.  In most cases, partial recovery requires configuration.  Per-channel encodings, for example, or per-user, which have to be agreed upon out of band, in ways that IRC does not expose as metadata.

Given this situation, the only reasonable way forward as a community is to tell users that using anything other than UTF-8 is a misconfiguration and we need to be getting all those out-of-band agreements to switch to it.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20161117/aaceeb4f/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063341.html">[Twisted-Python] Twisted 16.6.0rc1 Release Candidate	Announcement
</A></li>
	<LI>Next message (by thread): <A HREF="063344.html">[Twisted-Python] Twisted 16.6.0rc1 Release Candidate	Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63342">[ date ]</a>
              <a href="thread.html#63342">[ thread ]</a>
              <a href="subject.html#63342">[ subject ]</a>
              <a href="author.html#63342">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
