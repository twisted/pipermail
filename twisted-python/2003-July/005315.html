<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Remote PB calls in ApplicationService.stopService
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Remote%20PB%20calls%20in%20ApplicationService.stopService&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005310.html">
   <LINK REL="Next"  HREF="005317.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Remote PB calls in ApplicationService.stopService</H1>
    <B>Alex Levy</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Remote%20PB%20calls%20in%20ApplicationService.stopService&In-Reply-To="
       TITLE="[Twisted-Python] Remote PB calls in ApplicationService.stopService">mesozoic at polynode.com
       </A><BR>
    <I>Thu Jul 31 17:02:10 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="005310.html">[Twisted-Python] Providing perspective-dependent client-side information to a pb.RemoteCache object
</A></li>
        <LI>Next message: <A HREF="005317.html">[Twisted-Python] Flag storing broke in IMAP4Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5315">[ date ]</a>
              <a href="thread.html#5315">[ thread ]</a>
              <a href="subject.html#5315">[ subject ]</a>
              <a href="author.html#5315">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I had two programs running; one was a twistd -y instance, the other was a
simple script that received objects over Perspective Broker and printed them
out.

The -y'able application consists of one Service:

 class MyService(app.ApplicationService):
   def somePBRemoteCall(self, event):
     d = pb.getObjectAt(self.host, self.port, self.timeout)
     d.addCallback(self.foundCatcher, event)
   def foundCatcher(self, obj, event):
     d = obj.callRemote('catch', event)
   def stopService(self):
     somePBRemoteCall(i_am_dying_event)
     app.ApplicationService.stopService(self)

This isn't the code verbatim, but this is basically what it's doing. I want
the receiving side to be informed when the sending side is about to stop.

On the sending side, this results in 'Connection failed'. On the receiving
side, the following traceback appears. Could somebody more familiar with the
internals of Perspective Broker explain what's going wrong, or how I might
change my approach?

---snip---
Traceback (most recent call last):
  File &quot;sandbox/test-catcher.py&quot;, line 15, in ?
    reactor.run()
  File &quot;/usr/lib/python2.2/site-packages/twisted/internet/default.py&quot;, line 122, in run
    self.mainLoop()
  File &quot;/usr/lib/python2.2/site-packages/twisted/internet/default.py&quot;, line 133, in mainLoop
    self.doIteration(t)
  File &quot;/usr/lib/python2.2/site-packages/twisted/internet/default.py&quot;, line 472, in doSelect
    _logrun(selectable, _drdw, selectable, method, dict)
    --- &lt;exception caught here&gt; ---
  File &quot;/usr/lib/python2.2/site-packages/twisted/python/log.py&quot;, line 65, in callWithLogger
    callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
  File &quot;/usr/lib/python2.2/site-packages/twisted/python/log.py&quot;, line 52, in callWithContext
    return context.call({ILogContext: newCtx}, func, *args, **kw)
  File &quot;/usr/lib/python2.2/site-packages/twisted/python/context.py&quot;, line 32, in callWithContext
    return func(*args,**kw)
  File &quot;/usr/lib/python2.2/site-packages/twisted/internet/default.py&quot;, line 495, in _doReadOrWrite
    selectable.connectionLost(f)
  File &quot;/usr/lib/python2.2/site-packages/twisted/internet/tcp.py&quot;, line 253, in connectionLost
    protocol.connectionLost(reason)
  File &quot;/usr/lib/python2.2/site-packages/twisted/spread/pb.py&quot;, line 563, in connectionLost
    for lobj in self.remotelyCachedObjects.values():
exceptions.AttributeError: Broker instance has no attribute 'remotelyCachedObjects'
---snip---

-- 
Alex Levy
WWW: <A HREF="http://mesozoic.geecs.org">http://mesozoic.geecs.org</A>
 
&quot;Never let your sense of morals prevent you from doing what is right.&quot;
 -- Salvor Hardin, Isaac Asimov's _Foundation_


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005310.html">[Twisted-Python] Providing perspective-dependent client-side information to a pb.RemoteCache object
</A></li>
	<LI>Next message: <A HREF="005317.html">[Twisted-Python] Flag storing broke in IMAP4Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5315">[ date ]</a>
              <a href="thread.html#5315">[ thread ]</a>
              <a href="subject.html#5315">[ subject ]</a>
              <a href="author.html#5315">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
