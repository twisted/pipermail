<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Wrapping blocking code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Wrapping%20blocking%20code&In-Reply-To=D7A856E6-BEAD-11D7-B892-000A95686CD8%40redivi.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005185.html">
   <LINK REL="Next"  HREF="005187.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Wrapping blocking code</H1>
    <B>Justin Johnson</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Wrapping%20blocking%20code&In-Reply-To=D7A856E6-BEAD-11D7-B892-000A95686CD8%40redivi.com"
       TITLE="[Twisted-Python] Wrapping blocking code">justinjohnson at fastmail.fm
       </A><BR>
    <I>Fri Jul 25 11:42:29 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="005185.html">[Twisted-Python] Wrapping blocking code
</A></li>
        <LI>Next message: <A HREF="005187.html">[Twisted-Python] Wrapping blocking code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5186">[ date ]</a>
              <a href="thread.html#5186">[ thread ]</a>
              <a href="subject.html#5186">[ subject ]</a>
              <a href="author.html#5186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the reply.  Questions below.

On Fri, 25 Jul 2003 10:39:48 -0400, &quot;Bob Ippolito&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">bob at redivi.com</A>&gt; said:
&gt;<i> That's kind of amusing.  I'm not particularly familiar with the log or  
</I>&gt;<i> win32eventreactor modules... but as far as I can tell, those messages  
</I>&gt;<i> mean &quot;dude, don't use log.logOwner anymore&quot;.  It's not your fault, it's  
</I>&gt;<i> the twisted team's fault for not keeping win32eventreactor up to date  
</I>&gt;<i> with the latest conventions.  They're just DeprecationWarnings, so  
</I>&gt;<i> they're harmless to everything other than your eyes and our pride :)
</I>&gt;<i> 
</I>&gt;<i> Also, instead of using that reactor.iterate() hack.. it's better to be  
</I>&gt;<i> in the habit of writing something event driven.. for example, you could  
</I>&gt;<i> override the __init__ for protocol.ProcessProtocol (well, it's not  
</I>&gt;<i> really overriding anything, since it doesn't have one) from your  
</I>&gt;<i> subclass, stick a Deferred in the instance, and do a callback in  
</I>&gt;<i> processEnded... like this:
</I>&gt;<i> 
</I>&gt;<i> class MyProcessProtocol(protocol.ProcessProtocol):
</I>&gt;<i> 	def __init__(self):
</I>&gt;<i> 		self.deferred = defer.Deferred()
</I>&gt;<i> 
</I>&gt;<i> 	...cut and paste your code...
</I>&gt;<i> 
</I>&gt;<i> 	def processEnded(self, reason):
</I>&gt;<i> 		...cut and paste some more code...
</I>&gt;<i> 		self.deferred.callback(reason)
</I>
reason is an Exception from twisted.internet.error.  It is an instance of
ProcessDone if it completes successfully.  How can this be called?  When
I was using the other process.py module, it allowed me to get stdout,
stderr, and the status.  That is really all I want to do.  So it seems
like stdout and stderr are easy to get with the xxxReceived methods, and
then the status would have to be determined from the type of exception
processEnded gets as the &quot;reason&quot; argument, right?

I used to have code like...

cmd = &quot;cmd arg1 arg2&quot;
p = process.ProcessOpen(cmd)
status = p.wait()
stdout = p.stdout.read()
stderr = p.stderr.read()
if status != 0:
    raise errors.CmdError(cmd, status, stdout, stderr) # an Exception I
    defined

...and this was in a module that didn't know about twisted, and I'd
prefer to keep it that way if possible.  What is the best way to wrap a
class with methods that contain code like this up with twisted?  Attached
is the latest version of the ProcessProtocol code which is working
(except for not knowing exactly how to get the real status).  I'm just
not sure what to do with it.

&gt;<i> 
</I>&gt;<i> ...cut and paste again, but throw out your for loop...
</I>&gt;<i> p.addBoth(lambda ignore: reactor.callLater(0.0, reactor.stop))
</I>&gt;<i> reactor.run()
</I>
p is not a Deferred, so I can't call addBoth.  It seems to work okay
without this though.  What was this supposed to be added to?

-Justin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: my.py
Type: application/unknown
Size: 1199 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030725/4d6848c9/attachment.bin">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030725/4d6848c9/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005185.html">[Twisted-Python] Wrapping blocking code
</A></li>
	<LI>Next message: <A HREF="005187.html">[Twisted-Python] Wrapping blocking code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5186">[ date ]</a>
              <a href="thread.html#5186">[ thread ]</a>
              <a href="subject.html#5186">[ subject ]</a>
              <a href="author.html#5186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
