<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] t.w.w.form maybe bug?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20t.w.w.form%20maybe%20bug%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005159.html">
   <LINK REL="Next"  HREF="005164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] t.w.w.form maybe bug?</H1>
    <B>Alessandro Praduroux</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20t.w.w.form%20maybe%20bug%3F&In-Reply-To="
       TITLE="[Twisted-Python] t.w.w.form maybe bug?">pradu at pradu.it
       </A><BR>
    <I>Tue Jul 22 12:48:07 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="005159.html">[Twisted-Python] Fw: [assemblee] [ANN] WebTK v0.alpha3
</A></li>
        <LI>Next message: <A HREF="005164.html">[Twisted-Python] Pretty printing in Woven
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5160">[ date ]</a>
              <a href="thread.html#5160">[ thread ]</a>
              <a href="subject.html#5160">[ subject ]</a>
              <a href="author.html#5160">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, 
I am trying to create a page with a list of elements that can be possibly 
edited by the user, along with a form to edit the elements or insert new 
ones.

So, I setup the things as follows:

class Test(page.Page)
    template = &quot;&quot;&quot;
&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
        &lt;table border=&quot;1&quot; cellpadding=&quot;2&quot; width=&quot;80%&quot; model=&quot;configs&quot; 
view=&quot;List&quot;&gt;
            &lt;tr 
pattern=&quot;listHeader&quot;&gt;&lt;th&gt;&amp;nbsp;&lt;/th&gt;&lt;th&gt;Nome&lt;/th&gt;&lt;th&gt;Limiti&lt;/th&gt;&lt;th&gt;Bilanciamento&lt;/th&gt;&lt;/tr&gt;
            &lt;tr pattern=&quot;listItem&quot; view=&quot;conf&quot;&gt;&lt;/tr&gt;
        &lt;/table&gt;
        &lt;div&gt;&lt;form method=&quot;POST&quot; action=&quot;/balancing/edit&quot; 
model=&quot;editform&quot;&gt;&lt;/form&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot; 
    def wmfactory_configs(self, request):
        cf = libra.RouteConfig()
        return cf.configurations()

    def wmfactory_editform(self, request):
        return self._form

    def wchild_edit(self, request):
        fp = form.FormProcessor(self._form, callback=lambda x: 
util.Redirect(&quot;/balancing&quot;))
        fp.mangle_timein = fp.mangle_multi
        return fp

    def wvupdate_conf(self, request, node, data):
        r = microdom.lmx(node)
        d = r.td()
        d.a(href=&quot;/balancing/?action=edit&amp;cfg=%s&quot;%data[0]).text(&quot;Modifica&quot;)
        d.br()
        d.a(href=&quot;/balancing/?action=delete&amp;cfg=%s&quot;%data[0]).text(&quot;Elimina&quot;)
        r.td().text(data[0])
        ((h0,m0,s0),(h1,m1,s1)) = data[1][&quot;limit&quot;]
        r.td().text(&quot;dalle %02d:%02d:%02d alle 
%02d:%02d:%02d&quot;%(h0,m0,s0,h1,m1,s1))

        bl = [&quot;%s: %d%%&quot;%(k,v) for (k,v) in data[1][&quot;weights&quot;]]
        d = r.td()
        for l in bl:
            d.text(l)
            d.br()

    def setUp(self, request, d):
        self._action = request.args.get(&quot;action&quot;,[&quot;&quot;])[0]

        if self._action == &quot;delete&quot;:
            cf = libra.RouteConfig()
            cf.delCfg(request.args.get(&quot;cfg&quot;,[&quot;&quot;])[0])
            cf.save()

        if self._action == &quot;edit&quot;:
            cf = libra.RouteConfig()
            c = cf.getCfg(request.args.get(&quot;cfg&quot;,[&quot;&quot;])[0])
            args = [
                fm.Hidden(&quot;action&quot;,&quot;edit&quot;),
                lw.Static(&quot;Nome&quot;,request.args.get(&quot;cfg&quot;,[&quot;&quot;])[0]),
                lw.Static(&quot;Dalle&quot;,&quot;%02d:%02d%02d&quot;%c['limit'][0]),
                lw.Static(&quot;Alle&quot;,&quot;%02d:%02d%02d&quot;%c['limit'][1]),
                ]

            for (k,v) in c[&quot;weights&quot;]:
                args.append(fm.String(k, str(v)))

            cfs = fm.MethodSignature(*args)
            self._form = cfs.method(self.processEdit)
        else:
            cfs = fm.MethodSignature(
                fm.Hidden(&quot;action&quot;,&quot;new&quot;),
                fm.String(&quot;Nome&quot;),
                lw.Timein(&quot;Dalle&quot;,(00,00,00)),
                lw.Timein(&quot;Alle&quot;,(23,59,59))
                )
            self._form = cfs.method(self.processEdit)

    def processEdit(self,**kw):
        if kw[&quot;action&quot;] == &quot;new&quot;:
            print &quot;new&quot;, kw
        else:
            print &quot;edit&quot;, kw

one thing to notice: the page is not part of an .rpy, but it's added as child 
of the root page using putChild

The first time the page is rendered, i get the form I espect (the second one 
defined in setUp).

If I follow a link that should end up with the first form displayed, nothing 
happens (better, I am presented with the same form again and again).

digging into t.w.w.form.FormFillerWidget, I notice the following (around line 
280):
	argList = self.model.fmethod.getArgs()

That means the widget is rendered using the model it was built with, not the 
model that is passed in setUp(self, request, node, data)

Now the questions:
	
1. I am doing things really wrong here?
2. the fact that the render-time model is completely ignored is by design or a 
bug?
3. would changing the line above to read &quot;argList = data.getArgs()&quot; really 
solve the issue (here it seems to work) or it will introduce some subtle bugs 
I'm not aware of?

Thanks in advance for the help

-- 
Linux webmaster &amp; sysadmin
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">pradu at pradu.it</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005159.html">[Twisted-Python] Fw: [assemblee] [ANN] WebTK v0.alpha3
</A></li>
	<LI>Next message: <A HREF="005164.html">[Twisted-Python] Pretty printing in Woven
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5160">[ date ]</a>
              <a href="thread.html#5160">[ thread ]</a>
              <a href="subject.html#5160">[ subject ]</a>
              <a href="author.html#5160">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
