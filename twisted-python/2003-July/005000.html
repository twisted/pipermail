<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] One big smile ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20One%20big%20smile%20...&In-Reply-To=1058035798.1298.18.camel%40mingus">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004998.html">
   <LINK REL="Next"  HREF="005001.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] One big smile ...</H1>
    <B>Moshe Zadka</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20One%20big%20smile%20...&In-Reply-To=1058035798.1298.18.camel%40mingus"
       TITLE="[Twisted-Python] One big smile ...">m at moshez.org
       </A><BR>
    <I>Sat Jul 12 19:05:05 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004998.html">[Twisted-Python] One big smile ...
</A></li>
        <LI>Next message: <A HREF="005001.html">[Twisted-Python] One big smile ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5000">[ date ]</a>
              <a href="thread.html#5000">[ thread ]</a>
              <a href="subject.html#5000">[ subject ]</a>
              <a href="author.html#5000">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12 Jul 2003, Abe Fettig &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">abe at fettig.net</A>&gt; wrote:

&gt;<i> class SimpleService(app.ApplicationService):
</I>&gt;<i>     def startService(self):
</I>&gt;<i>         self.serviceRunning = 1
</I>
Call the father's method first, instead:
app.ApplicationService.startService(self)
...
Ditto for stopService(self).
They are responsible for setting .serviceRunning

&gt;<i>         reactor.callLater(0, self.printHello)
</I>
Why not self.nextCall = reactor.callLater(0, ...)?

&gt;<i>     def stopService(self):
</I>&gt;<i>         self.serviceRunning = 0
</I>&gt;<i>         if hasattr(self, 'nextCall'): 
</I>&gt;<i>             self.nextCall.cancel()
</I>&gt;<i>             del(self.nextCall)
</I>&gt;<i>         print &quot;%s: Stopped.&quot; % self.serviceName
</I>
You also want to avoid persisting nextCall

def __getstate__(self):
    d = self.__dict__
    if 'nextCall' in d:
        del d['nextCall']
    return d

&gt;<i> class ServiceWebManager(resource.Resource):
</I>&gt;<i>     isLeaf = 1
</I>&gt;<i> 
</I>&gt;<i>     def __init__(self, app):
</I>&gt;<i>         self.app = app
</I>&gt;<i> 
</I>&gt;<i>     def render(self, request):
</I>&gt;<i>         serviceName = request.args.get('service', [''])[0]
</I>&gt;<i>         action = request.args.get('action', [''])[0]
</I>&gt;<i>         if serviceName:
</I>&gt;<i>             service = self.app.getServiceNamed(serviceName)
</I>&gt;<i>             if action == 'Start':
</I>&gt;<i>                 service.startService()
</I>&gt;<i>             else:
</I>&gt;<i>                 service.stopService()
</I>&gt;<i>             request.redirect('/')
</I>
Note that your service has a bug if .startService() is called
twice without an intervening stopService(), and you present
here for users an ability to tickle that bug. You can probably
work around in many ways...

...but I prefer to having non-parents .enable() or .disable()
the service. Of course, it can start enabled by default, but
this way you have a clear distinction which methods are supposed
to be called by whom.
 
&gt;<i> myApp = app.Application(&quot;Test App&quot;)
</I>&gt;<i> SimpleService(&quot;Service 1&quot;, myApp)
</I>&gt;<i> SimpleService(&quot;Service 2&quot;, myApp)
</I>&gt;<i> website = server.Site(ServiceWebManager(myApp))
</I>&gt;<i> myApp.listenTCP(8008, website)
</I>
If you call it &quot;application&quot; insteadof &quot;myApp&quot;, the next line
is not needed: instead of &quot;Python&quot;ing it, &quot;twistd -y&quot; it
[or maybe twistd -ny if you don't want forking]

-- 
Moshe Zadka -- <A HREF="http://moshez.org/">http://moshez.org/</A>
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- <A HREF="http://www.python.org/">http://www.python.org/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004998.html">[Twisted-Python] One big smile ...
</A></li>
	<LI>Next message: <A HREF="005001.html">[Twisted-Python] One big smile ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5000">[ date ]</a>
              <a href="thread.html#5000">[ thread ]</a>
              <a href="subject.html#5000">[ subject ]</a>
              <a href="author.html#5000">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
