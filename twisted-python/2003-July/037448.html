<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: IMAP fixes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20IMAP%20fixes&In-Reply-To=%3C20030710055339.31218.qmail%40green.zadka.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="037447.html">
   <LINK REL="Next"  HREF="037452.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: IMAP fixes</H1>
    <B>Moshe Zadka</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Re%3A%20IMAP%20fixes&In-Reply-To=%3C20030710055339.31218.qmail%40green.zadka.com%3E"
       TITLE="[Twisted-Python] Re: IMAP fixes">m at moshez.org
       </A><BR>
    <I>Wed Jul  9 23:53:39 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037447.html">[Twisted-Python] Re: IMAP fixes
</A></li>
        <LI>Next message (by thread): <A HREF="037452.html">[Twisted-Python] Re: IMAP fixes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37448">[ date ]</a>
              <a href="thread.html#37448">[ thread ]</a>
              <a href="subject.html#37448">[ subject ]</a>
              <a href="author.html#37448">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 10 Jul 2003, &quot;Tony Meyer&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ta-meyer at ihug.co.nz</A>&gt; wrote:

&gt;<i> Well, it started life as a python RE, so there was no translation.  I did
</I>&gt;<i> did very carefully analyse (and test) it, and you're welcome to as well.
</I>&gt;<i> It's easy enough to do without it, or split it into several smaller re's, but
</I>&gt;<i> this seems the best way to do it.
</I>
Why?
It's much better to split into several REs. When you need to comment your
REs, they're obviously useless -- it is impossible to keep comments in sync
with code, so when bugs crop up in your RE, it will be difficult to fix.
Not to mention you can't step with PDB through REs, or insert prints, to
see what exactly is going wrong.

Here's a proof of concept (untested) factorization into several REs
each of which is easy enough to describe:

sectionRe = re.compile('([\d\.])*\.') # digits and dots, ends with dot
partRe = re.compile('([A-Z\.]+)') # upper case letters and dots
fielditemsRe = re.compile(' \([()])*\)') # open-paren, parens, close paren
partialRe = re.compile('&lt;(\d+\.[1-9]\d*)&gt;') # digits, dot, non-zero, digits
body = re.compile('BODY') # BODY
peek = re.compile('\.?PEEK') # optional dot, PEEK
bra = re.compile('\[') # literal [
cket = re.compile('\]') # literal ]

# The comments are not necessary -- my point is that looking at those
# REs is easy to understand what they capture

def trymatch(r, s):
    m = r.match(s)
    if m:
        return m.group(1), s[m.end():]
    else:
        return None, s

def forcematch(r, s)
    m = r.match(s)
    if not m:
        raise IllegalIdentiferError()
    return s[m.end():]

# Note how the parsing is now done with code -- only the low-level
# tokenizing is done with REs. The code is relatively easy to read.
def parse(s):
    s = forcematch(body, s)
    peek, s = trymatch(peek, s)
    s = forcematch(bra, s)
    section, s = trymatch(sectionRe, s)
    part, s = trymatch(partRe, s, 1)
    fielditems, s = trymatch(fielditemsRe, s)
    s = forcematch(cket, s, 1)
    partial, s = trymatch(partialRe, s, 1)
    # End when you write it like that, it is easy to fine
    # false positives. For example, should we check s is empty?
    return peek, section, part, fielditems, partial

-- 
Moshe Zadka -- <A HREF="http://moshez.org/">http://moshez.org/</A>
Buffy: I don't like you hanging out with someone that... short.
Riley: Yeah, a lot of young people nowadays are experimenting with shortness.
Agile Programming Language -- <A HREF="http://www.python.org/">http://www.python.org/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037447.html">[Twisted-Python] Re: IMAP fixes
</A></li>
	<LI>Next message (by thread): <A HREF="037452.html">[Twisted-Python] Re: IMAP fixes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37448">[ date ]</a>
              <a href="thread.html#37448">[ thread ]</a>
              <a href="subject.html#37448">[ subject ]</a>
              <a href="author.html#37448">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
