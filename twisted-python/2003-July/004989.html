<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] One big smile ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20One%20big%20smile%20...&In-Reply-To=005701c34810%2468f725d0%240401a8c0%40razor">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004988.html">
   <LINK REL="Next"  HREF="004996.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] One big smile ...</H1>
    <B>Christopher Armstrong</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20One%20big%20smile%20...&In-Reply-To=005701c34810%2468f725d0%240401a8c0%40razor"
       TITLE="[Twisted-Python] One big smile ...">radix at twistedmatrix.com
       </A><BR>
    <I>Fri Jul 11 21:12:13 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004988.html">[Twisted-Python] One big smile ...
</A></li>
        <LI>Next message: <A HREF="004996.html">[Twisted-Python] One big smile ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4989">[ date ]</a>
              <a href="thread.html#4989">[ thread ]</a>
              <a href="subject.html#4989">[ subject ]</a>
              <a href="author.html#4989">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Jul 12, 2003 at 02:56:20AM +0200, Thomas Weholt wrote:
&gt;<i> I got a list of RSS/RDF-urls and I iterate thru them in sequence, feeding
</I>&gt;<i> each one to Mark Pilgrims Ultra Liberal Parser. The call to that
</I>&gt;<i> parse-method is actually what's being using in deferToThread. The I add a
</I>&gt;<i> callback-method which processes the result of the RSS/RDF-parsing. It's a
</I>&gt;<i> plain dictionary. This dictionary is processed into a simpler list. That's
</I>&gt;<i> it.
</I>&gt;<i> 
</I>&gt;<i> Alot of the things I'll be doing is like this; fetch a file from the net (
</I>&gt;<i> here the parser fetches it itself ), process the data returned from that
</I>&gt;<i> call and update some object or stuff the result into a database. The last
</I>&gt;<i> option most of the times probably, and the database will most likely be
</I>&gt;<i> SQLite which is not very thread-frinedly either. Other times it can be a
</I>&gt;<i> XML-RPC/SOAP-call which might take time to complete and the result of the
</I>&gt;<i> call might have to be processed. The last thing I can think of is scanning
</I>&gt;<i> folders and generating checksums. Probably the worst job of them all. Not
</I>&gt;<i> done often, but very time/resource-consuming when it occurs.
</I>&gt;<i> 
</I>&gt;<i> Most often I'll have to update something in the main thread, some state or
</I>&gt;<i> value, so if there's any way to use mutex/locks/whatever or ways to avoid
</I>&gt;<i> the whole thing I'm all ears ( one of the worlds most moronic statements
</I>&gt;<i> BTW ).
</I>
The way to avoid the problems is to _avoid threads whenever you
can_. For database access, Twisted already has an asynchronous
interface in twisted.enterprise. It uses threads, but in an isolated
way. Fetching files from the net and parsing data is possible to do
asynchronously already (see twisted.web.client). Twisted has an asynch
client interface to XMLRPC, and a SOAP one should be easy enough to
implement (see how the XMLRPC client interface was done). The
file-walking stuff could probably be done well just by breaking up the
process into steps, allowing the reactor to do the work it needs to do
in between steps (i.e., reactor.callLater(0, doSomeWork), and at the
end of doSomeWork, reschedule doSomeWork, until all work is done).

Does your RSS parser actually try to download data itself? If it does,
I would recommend trying to figure out how to get at the lower level
parsing bits; download the data with twisted.web.client, and then pass
the data to the parsing bits. All asynchronous, no threads (with their
data corruption and deadlocks) to worry about.


The big idea I'm trying to get through is that you should not be
defaulting to threads. Most of your use cases are possible to do
without them; the only time that threads are really required is when
you are trying to use a blocking interface that you don't want to or
can't plausibly rework.

Good luck,
-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+     <A HREF="http://twistedmatrix.com/users/radix.twistd/">http://twistedmatrix.com/users/radix.twistd/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004988.html">[Twisted-Python] One big smile ...
</A></li>
	<LI>Next message: <A HREF="004996.html">[Twisted-Python] One big smile ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4989">[ date ]</a>
              <a href="thread.html#4989">[ thread ]</a>
              <a href="subject.html#4989">[ subject ]</a>
              <a href="author.html#4989">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
