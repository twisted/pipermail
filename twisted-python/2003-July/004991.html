<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Lazily adding Identities in new cred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lazily%20adding%20Identities%20in%20new%20cred&In-Reply-To=3F0F89E8.3040001%40ripton.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004990.html">
   <LINK REL="Next"  HREF="004992.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Lazily adding Identities in new cred</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lazily%20adding%20Identities%20in%20new%20cred&In-Reply-To=3F0F89E8.3040001%40ripton.net"
       TITLE="[Twisted-Python] Lazily adding Identities in new cred">exarkun at twistedmatrix.com
       </A><BR>
    <I>Sat Jul 12 00:37:26 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004990.html">[Twisted-Python] Lazily adding Identities in new cred
</A></li>
        <LI>Next message: <A HREF="004992.html">[Twisted-Python] Storage for a NNTP-server?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4991">[ date ]</a>
              <a href="thread.html#4991">[ thread ]</a>
              <a href="subject.html#4991">[ subject ]</a>
              <a href="author.html#4991">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Jul 12, 2003 at 12:09:12AM -0400, David Ripton wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm working on a turn-based game, with a server and N untrusted clients, 
</I>&gt;<i> using PB.
</I>&gt;<i> 
</I>&gt;<i> So far I just have a few hardcoded test users and passwords.  Now I'd 
</I>&gt;<i> like to add lazy user registration.  If a username is already known, 
</I>&gt;<i> then you need the password to log in.  If it's not known, you can claim 
</I>&gt;<i> that username by attempting to login, and your password should be 
</I>&gt;<i> immediately set to whatever you just used.
</I>&gt;<i> 
</I>&gt;<i> (I'm not saying this is the generally ideal way to add new users and 
</I>&gt;<i> assign their passwords, but it should definitely be doable in any 
</I>&gt;<i> reasonably flexible authentication framework.)
</I>&gt;<i> 
</I>&gt;<i> It appears that cred was not really designed to support this, because 
</I>&gt;<i> the password that the user entered is not passed to 
</I>&gt;<i> Authorizer.getIdentityRequest, which seems like the obvious place to 
</I>&gt;<i> lazily add an Identity.
</I>&gt;<i> 
</I>&gt;<i> Getting it there by patching Twisted would be easy enough: pass it from 
</I>&gt;<i> pb.authIdentity through AuthServ.remote_username into the call to 
</I>&gt;<i> getIdentityRequest.  The callers would always need to pass the password, 
</I>&gt;<i> but only a small percentage of Authorizers would actually use it, so 
</I>&gt;<i> this doesn't seem perfectly clean.  But I don't see a better alternative.
</I>&gt;<i> 
</I>&gt;<i> Suggestions?
</I>
  The best solution would seem to be to get PB working with the new cred
code -- which doesn't use Authorizers, Identities, or any of that confusion.

  Here's a simple credentials checker that adds all unrecognized usernames
that are requested (untested):

    from twisted import cred
    import twisted.cred.credentials
    import twisted.cred.checkers
    import twisted.cred.error

    from twisted.python.components import implements

    class LazyCredentialsChecker:
        __implements__ = (cred.checkers.ICredentialsChecker,)

        credentialInterfaces = (cred.credentials.IUsernamePassword,)

        def userExists(self, username):
            # Return true if username exists, false otherwise

        def getPassword(self, username):
            # Implement appropriately

        def addUser(self, username, password):
            # Here, too

        def requestAvatarId(self, creds):
            if implements(creds, cred.credentials.IUsernamePassword):
                if self.userExists(creds.username):
                    if self.getPassword(creds.username) == creds.password:
                        return creds.username
                    raise cred.error.UnauthorizedLogin()
                self.addUser(creds.username, creds.password)
                return creds.username
            raise NotImplementedError()

  An even nicer way to do this would be to create an interface for creating
a new user, (eg, IChargen), have requestAvatarId check for this interface,
and create the required entries in its database, rather than relying on the
non-existence of a username to create a new one (what if the user mistypes
their user?)

  Hope this helps,

  Jp

-- 
&quot;The problem is, of course, that not only is economics bankrupt but it has
 always been nothing more than politics in disguise ... economics is a form
 of brain damage.&quot;  -- Hazel Henderson
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20030712/5057f979/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20030712/5057f979/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004990.html">[Twisted-Python] Lazily adding Identities in new cred
</A></li>
	<LI>Next message: <A HREF="004992.html">[Twisted-Python] Storage for a NNTP-server?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4991">[ date ]</a>
              <a href="thread.html#4991">[ thread ]</a>
              <a href="subject.html#4991">[ subject ]</a>
              <a href="author.html#4991">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
