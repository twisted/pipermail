<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Problems with deferred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Problems%20with%20deferred&In-Reply-To=%3C005201c344d7%2468346ef0%240401a8c0%40razor%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="037422.html">
   <LINK REL="Next"  HREF="037423.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Problems with deferred</H1>
    <B>Thomas Weholt</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Problems%20with%20deferred&In-Reply-To=%3C005201c344d7%2468346ef0%240401a8c0%40razor%3E"
       TITLE="[Twisted-Python] Problems with deferred">2002 at weholt.org
       </A><BR>
    <I>Mon Jul  7 16:30:43 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037422.html">[Twisted-Python] Patch for twisted.web.soap
</A></li>
        <LI>Next message (by thread): <A HREF="037423.html">[Twisted-Python] Problems with deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37421">[ date ]</a>
              <a href="thread.html#37421">[ thread ]</a>
              <a href="subject.html#37421">[ subject ]</a>
              <a href="author.html#37421">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I got a tip earlier from this list on how to implement a scheduled task, or
in my case several task. I want my ApplicationService-object to hold a list
of tasks, looking somewhat like the ones subclassing the task-class in the
code below, where a method called Action is called on a given interval. I
want users to be able to just subclass my task-class and override the
action-method and then the application will create a list of instances of
these tasks, call their start method and from there on their action method
will be called over and over on the intervall specified in their
refreshInterval-attribute given at creation.

Does that makes sense? In my code only Task1.action is called, and
Task2.action is called just before the thing exits. Why?

Any hints?

from twisted.internet.app import Application, ApplicationService
from twisted.internet import defer
from twisted.internet import reactor
from twisted.python import log

class task:

    def __init__(self, service, refreshInterval=5):
        self.service = service
        self.refreshInterval = refreshInterval

    def start(self):
        reactor.callLater(self.refreshInterval, self.execute)

    def action(self):
        &quot;Override this!&quot;
        print &quot;action called&quot;

    def execute(self):
        d = defer.Deferred()
        reactor.callLater(0, self.action)

        # Log any errors in downloading or processing
        d.addErrback(log.err)

        # Reschedule this function
        d.addBoth(reactor.callLater, self.refreshInterval, self.execute)

class task1(task):
    def action(self):
        print &quot;Task 1 called&quot;

class task2(task):
    def action(self):
        print &quot;Task 2 called&quot;

class testservice(ApplicationService):

    def __init__(self, application):
        self.application = application
        self.tasks = [task1(self), task2(self)]

    def startService(self):
        print &quot;Starting services&quot;
        for task in self.tasks:
            task.start()


    def stopService(self):
        print &quot;Stopping services&quot;

app = Application('test app')
srv = testservice(app)
app.run()


Best regards,
Thomas W



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037422.html">[Twisted-Python] Patch for twisted.web.soap
</A></li>
	<LI>Next message (by thread): <A HREF="037423.html">[Twisted-Python] Problems with deferred
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37421">[ date ]</a>
              <a href="thread.html#37421">[ thread ]</a>
              <a href="subject.html#37421">[ subject ]</a>
              <a href="author.html#37421">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
