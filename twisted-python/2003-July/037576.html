<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] HTTP Authentication Example for review
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20HTTP%20Authentication%20Example%20for%20review&In-Reply-To=%3C1058382026.30109.19.camel%40mars.mccurleyweb.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="037578.html">
   <LINK REL="Next"  HREF="037577.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] HTTP Authentication Example for review</H1>
    <B>David McCurley</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20HTTP%20Authentication%20Example%20for%20review&In-Reply-To=%3C1058382026.30109.19.camel%40mars.mccurleyweb.net%3E"
       TITLE="[Twisted-Python] HTTP Authentication Example for review">David.McCurley at technologist.com
       </A><BR>
    <I>Wed Jul 16 13:00:26 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037578.html">[Twisted-Python] dealing with woven templates.
</A></li>
        <LI>Next message (by thread): <A HREF="037577.html">[Twisted-Python] HTTP Authentication Example for review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37576">[ date ]</a>
              <a href="thread.html#37576">[ thread ]</a>
              <a href="subject.html#37576">[ subject ]</a>
              <a href="author.html#37576">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Below is some example code I've been using to restrict access to certain
parts of my site to only the users I want.  I've started simple with
hard coded user/pwd stuff and tried to make a clean example for others
to look at to verify this looks to be a correct approach with twisted. 
Please take a look and give me some feedback.  Know a better way? See
any holes? Maybe I should be looking and doing something to the protocol
stuff instead of the resource approach?

This resource is intented to be plugged into part of the resource tree
and guard everything below it.  It could be at the root or somewhere
below.

Note that in production, user accounts will be associated with groups,
and allowed paths can be attached to users and/or groups.  I'm going to
implement this after I have covered the basics.

The one thing so far that I don't like (ref MyGuard) is that it looks
like I have to do checks in the following methods (at least):

render()
getChild()
getChildWithDefault()
getChildForRequest()



Example code:
=============================

class MyAuth(baseRes):
    isLeaf = True
    def __init__(self):
        baseRes.__init__(self)
    def render(self, request):
        request.setHeader('WWW-authenticate', 'Basic realm=&quot;%s&quot;' %
(&quot;default&quot;,))
        errpage = error.ErrorPage(http.UNAUTHORIZED,&quot;Unauthorized&quot;,&quot;401
Authentication required&quot;)
        return errpage.render(request)
    def getChild(self, name, request):
            return self
        
class MyGuard(baseRes):
    def __init__(self, userName=&quot;test&quot;, password=&quot;test&quot;):
        baseRes.__init__(self)
        self.uName = userName
        self.pWord = password
        
    def render(self, request):
        auth = self.checkUser(request)
        if auth:
            return auth.render(request)
        return
&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MyGuard&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;MyGuard&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;
            
    def getChild(self, name, request):
        auth = self.checkUser(request)
        if auth:
            return auth
        if name == '':
            return self
        return baseRes.getChild(self, name, request)
        
    def getChildWithDefault(self, path, request):
        auth = self.checkUser(request)
        if auth:
            return auth
        return baseRes.getChildWithDefault(self, path, request)
        
    def getChildForRequest(self, request):
        auth = self.checkUser(request)
        if auth:
            return auth
        return baseRes.getChildForRequest(self, request)
        
    def checkUser(self, request):
        if not request.getUser() or not request.getPassword():
            return MyAuth()
        else:
            user = request.getUser()
            pwd = request.getPassword()
        if user != self.uName or pwd != self.pWord:
            return MyAuth()
        else:
            return None
=============================

Thx!



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037578.html">[Twisted-Python] dealing with woven templates.
</A></li>
	<LI>Next message (by thread): <A HREF="037577.html">[Twisted-Python] HTTP Authentication Example for review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37576">[ date ]</a>
              <a href="thread.html#37576">[ thread ]</a>
              <a href="subject.html#37576">[ subject ]</a>
              <a href="author.html#37576">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
