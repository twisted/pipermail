<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Woven: access to submodels
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Woven%3A%20access%20to%20submodels&In-Reply-To=%3C6577C938-BA1C-11D7-8547-000A95864FC4%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="037516.html">
   <LINK REL="Next"  HREF="037615.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Woven: access to submodels</H1>
    <B>Donovan Preston</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Woven%3A%20access%20to%20submodels&In-Reply-To=%3C6577C938-BA1C-11D7-8547-000A95864FC4%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Woven: access to submodels">dp at twistedmatrix.com
       </A><BR>
    <I>Sat Jul 19 13:08:35 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037516.html">[Twisted-Python] Woven: access to submodels
</A></li>
        <LI>Next message (by thread): <A HREF="037615.html">[Twisted-Python] Woven: access to submodels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37614">[ date ]</a>
              <a href="thread.html#37614">[ thread ]</a>
              <a href="subject.html#37614">[ subject ]</a>
              <a href="author.html#37614">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I apologize for not responding immediately.

On Saturday, July 12, 2003, at 7:21PM, Mary wrote:

&gt;<i> I'm trying to replicate the functionality of <A HREF="http://eyes.puzzling.org/">http://eyes.puzzling.org/</A>
</I>&gt;<i> (currently powered by a bunch of Python CGI scripts running on an 
</I>&gt;<i> Apache
</I>&gt;<i> webserver) in Woven.
</I>&gt;<i>
</I>&gt;<i> eyes.puzzling.org is a kind of a minimalist blog, with pages that list
</I>&gt;<i> recent entries, the authors of the entries, and so on.
</I>
Cool! Have you seen Blog, in the twistedmatrix.com cvs? It is out of 
date and
needs work, but feel free to steal the code/take over the 
project/whatever.

&lt;snip&gt;

&gt;<i> For each author, I would like to generate a /author/AUTHORNAME/ page
</I>&gt;<i> which lists their individual entries. I am trying to create these pages
</I>&gt;<i> from AuthorsPage's getDynamicChild method. The idea is to pass the
</I>&gt;<i> already constructed submodel -- a dictionary representing the 
</I>&gt;<i> individual
</I>&gt;<i> author -- to the IndividualPage object I will construct to represent 
</I>&gt;<i> the
</I>&gt;<i> individual author's page, rather than have IndividualPage make its own
</I>&gt;<i> database query for that information.
</I>
That's good -- that sounds like a good design. There are no rules when 
it
comes to Woven architecture, but reusing your Model objects, and model
production logic, across multiple pages sounds like a good idea to me.

&gt;<i> At present, as you can see below, I'm using getSubmodel to retrieve
</I>&gt;<i> the (dictionary) submodel associated with a particular author. However,
</I>&gt;<i> this returns a twisted.web.woven.model.DeferredWrapper instance, rather
</I>&gt;<i> than the dictionary itself. Should I make IndividualPage add callbacks
</I>&gt;<i> to the DeferredWrapper, or am I missing something crucial about
</I>&gt;<i> retrieving submodels or is this model more fundamentally incorrect?
</I>
As Moshe said in his reply, currently the URL traversal process is 
synchronous,
so if you need to wait on a Deferred to construct the next URL segment 
Resource
you're going to be doing a lot more work than you should have to. Woven 
attempts
to hide Deferreds from the programmer by pausing rendering and resuming 
it
when the Deferred fires. So, fortunately, things may be simpler than 
they seem.
You can just pass the DeferredWrapper as the Main Model to the next Page
instance you construct, and as long as you are going to be rendering 
that Page
next, Woven will just wait on it as it would any other Deferred.

from twisted.web.woven import page
from twisted.web.woven import model

from twisted.internet import defer
from twisted.internet import reactor


class DeferredProducer(model.MethodModel):
     def wmfactory_someDeferred(self, reqeuest):
         d = defer.Deferred()
         reactor.callLater(0.5, self.produce, d)
         return d

     def produce(self, d):
         d.callback( &quot;Hello, here is some text&quot; )

     def wmfactory_someNotDeferred(self, request):
         return &quot;Hi there&quot;


class MainPage(page.Page):
     template = &quot;&quot;&quot;&lt;html&gt;
     &lt;h3 model=&quot;someNotDeferred&quot; view=&quot;Text&quot;&gt;qawsf&lt;/h3&gt;
     &lt;span model=&quot;someDeferred&quot; view=&quot;Text&quot;&gt;qwensd&lt;/span&gt;
&lt;/html&gt;&quot;&quot;&quot;

     def getDynamicChild(self, name, request):
         return ChildPage(
                     self.model.getSubmodel(request, 'someDeferred'))


class ChildPage(page.Page):
     template = &quot;&quot;&quot;&lt;html&gt;
     Hello! Our main model is a deferred, so the next node will have to 
wait
     &lt;span model=&quot;.&quot; view=&quot;Text&quot;&gt;ncxnz&lt;/span&gt;
&lt;/html&gt;&quot;&quot;&quot;


resource = MainPage(DeferredProducer())



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037516.html">[Twisted-Python] Woven: access to submodels
</A></li>
	<LI>Next message (by thread): <A HREF="037615.html">[Twisted-Python] Woven: access to submodels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37614">[ date ]</a>
              <a href="thread.html#37614">[ thread ]</a>
              <a href="subject.html#37614">[ subject ]</a>
              <a href="author.html#37614">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
