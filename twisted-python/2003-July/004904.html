<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Why do I get a _Dereference instance?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Why%20do%20I%20get%20a%20_Dereference%20instance%3F&In-Reply-To=JAEDJDIBADCJHPFLNEDFOEFNCAAA.pb_twisted%40olga.mine.nu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004903.html">
   <LINK REL="Next"  HREF="004925.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Why do I get a _Dereference instance?</H1>
    <B>Patrik Blommaskog</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Why%20do%20I%20get%20a%20_Dereference%20instance%3F&In-Reply-To=JAEDJDIBADCJHPFLNEDFOEFNCAAA.pb_twisted%40olga.mine.nu"
       TITLE="[Twisted-Python] Why do I get a _Dereference instance?">pb_twisted at olga.mine.nu
       </A><BR>
    <I>Sun Jul  6 18:45:16 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004903.html">[Twisted-Python] Why do I get a _Dereference instance?
</A></li>
        <LI>Next message: <A HREF="004925.html">[LONG] Re: [Twisted-Python] Why do I get a _Dereference instance?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4904">[ date ]</a>
              <a href="thread.html#4904">[ thread ]</a>
              <a href="subject.html#4904">[ subject ]</a>
              <a href="author.html#4904">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Also, we have the peculiar case:
</I>&gt;<i>
</I>&gt;<i> 	def setCopyableState(self, state):
</I>&gt;<i> 	    self.__dict__.update(state)
</I>&gt;<i> 	    self.foo = state
</I>&gt;<i>
</I>&gt;<i> Which gives:
</I>&gt;<i>
</I>&gt;<i> 	{'pond': &lt;twisted.persisted.crefutil._Dereference instance
</I>&gt;<i> at 0x009B5ED8&gt;,
</I>&gt;<i> 'foo': {'pond': &lt;cache_classes.SlaveDuckPond instance at 0x009AD808&gt;},
</I>&gt;<i> 'broker': &lt;twisted.spread.pb.Broker instance at 0x009AD1B0&gt;, 'luid': 2}
</I>&gt;<i>
</I>&gt;<i> So the item in 'foo' is dereferenced as expected, while
</I>&gt;<i> __dict__[&quot;pond&quot;] is
</I>&gt;<i> not. Go figure!
</I>
Never mind this last one, I didn't think far enough there. While it works,
this is what I should have tried, and it doesn't work:

	def setCopyableState(self, state):
	    self.__dict__.update(state)
	    self.foo = state[&quot;pond&quot;]


My guess, and I really should know better than to make guesses after
midnight, is that the dereferencing mechanism only works with the 'state'
dictionary itself. That is, in the post processing, it substitutes the real
object references for the _Dereference values in the 'state' dictionary for
the keys it knows. As long as I keep the original state dictionary as master
data, at least until the deserializing is done, everything will work as
expected.

Thinking a little more (still on the wrong side of midnight), I can't really
see a Pythonic way of how the dereferencing mechanism could be solved the
way I initially wanted, i.e. self.__dict__.update(state). I can only come up
with a solution where the _Dereference would have to work as a proxy, and I
guess that there could be some severe side effects.

Unless someone (on the right side of midnight) can suggest something or
point out the error in my thinking, I think I will have to redesign my data
strategy somewhat.


- Patrik




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004903.html">[Twisted-Python] Why do I get a _Dereference instance?
</A></li>
	<LI>Next message: <A HREF="004925.html">[LONG] Re: [Twisted-Python] Why do I get a _Dereference instance?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4904">[ date ]</a>
              <a href="thread.html#4904">[ thread ]</a>
              <a href="subject.html#4904">[ subject ]</a>
              <a href="author.html#4904">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
