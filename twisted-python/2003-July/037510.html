<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Woven: access to submodels
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Woven%3A%20access%20to%20submodels&In-Reply-To=%3C20030713022136.GB1862%40titus.home.puzzling.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="037503.html">
   <LINK REL="Next"  HREF="037512.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Woven: access to submodels</H1>
    <B>Mary</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Woven%3A%20access%20to%20submodels&In-Reply-To=%3C20030713022136.GB1862%40titus.home.puzzling.org%3E"
       TITLE="[Twisted-Python] Woven: access to submodels">mary-twisted at puzzling.org
       </A><BR>
    <I>Sat Jul 12 20:21:36 MDT 2003</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037503.html">[Twisted-Python] new bugtracker
</A></li>
        <LI>Next message (by thread): <A HREF="037512.html">[Twisted-Python] Woven: access to submodels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37510">[ date ]</a>
              <a href="thread.html#37510">[ thread ]</a>
              <a href="subject.html#37510">[ subject ]</a>
              <a href="author.html#37510">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to replicate the functionality of <A HREF="http://eyes.puzzling.org/">http://eyes.puzzling.org/</A>
(currently powered by a bunch of Python CGI scripts running on an Apache
webserver) in Woven.

eyes.puzzling.org is a kind of a minimalist blog, with pages that list
recent entries, the authors of the entries, and so on.

At the moment, I'm trying to replicate the authors functionality (2
different sets of pages: one which lists all the authors and links to
their individual page; and one for each author, which lists their
individual articles.

The /authors/ page (listing all the authors and linking to their
individual page) is generated by objects of the AuthorsPage subclass.

For each author, I would like to generate a /author/AUTHORNAME/ page
which lists their individual entries. I am trying to create these pages
from AuthorsPage's getDynamicChild method. The idea is to pass the
already constructed submodel -- a dictionary representing the individual
author -- to the IndividualPage object I will construct to represent the
individual author's page, rather than have IndividualPage make its own
database query for that information.

At present, as you can see below, I'm using getSubmodel to retrieve
the (dictionary) submodel associated with a particular author. However,
this returns a twisted.web.woven.model.DeferredWrapper instance, rather
than the dictionary itself. Should I make IndividualPage add callbacks
to the DeferredWrapper, or am I missing something crucial about
retrieving submodels or is this model more fundamentally incorrect?

For example, should I be passing submodels around like that at all?

If so, is there a higher level call I should make to access the
submodel?

The two classes following are the AuthorsPage and IndividualPage classes
described above.

Thanks,

-Mary

class IndividualPage(page.Page):
 
    # getTemplate munges two template files together
    template = getTemplate(&quot;/home/mary/cvs/Projects/Eye/author-page.html&quot;)

    def initialize(self, *args, **kwargs):
        self.amodel = kwargs['amodel']

    def wmfactory_author(self, request):
        return self.amodel['author']
        
class AuthorsPage(page.Page):

    template = getTemplate(&quot;/home/mary/cvs/Projects/Eye/authors-page.html&quot;)

    def initialize(self, *args, **kwargs):
        self.dbpool = kwargs['pool']
        self.authors = None

    def wmfactory_authors(self, request):
        query = self.dbpool.runQuery(&quot;SELECT DISTINCT posts.name, link, password FROM authors, posts WHERE authors.name = posts.name ORDER BY name;&quot;)
        query.addCallback(self.makeAuthors)
        return query
    
    def makeAuthors(self, rows):
        '''
        Construct self.authors, return them as a list
        @return a list of author dictionaries
        '''
        authors = {}
        for row in rows:
            (name, link, password) = row
            authors[name] = {
                'name' : name,
                'link' : link,
                'password' : password
            }
        return authors

    def wvfactory_alink(self, request, node, model):
        return AuthorLink(model)

    def getDynamicChild(self, name, request):
        return IndividualPage(amodel=self.getSubmodel('authors')[name]))


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037503.html">[Twisted-Python] new bugtracker
</A></li>
	<LI>Next message (by thread): <A HREF="037512.html">[Twisted-Python] Woven: access to submodels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37510">[ date ]</a>
              <a href="thread.html#37510">[ thread ]</a>
              <a href="subject.html#37510">[ subject ]</a>
              <a href="author.html#37510">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
