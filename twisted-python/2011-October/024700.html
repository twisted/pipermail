<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] running 1,000,000 tasks, 40 at-a-time
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20running%201%2C000%2C000%20tasks%2C%2040%20at-a-time&In-Reply-To=CA%2BPf4UDBoVWzFKcivN5_zGo%2BCm%2BSzoJKJcp0YKhS5_dhtjnucQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024707.html">
   <LINK REL="Next"  HREF="024701.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] running 1,000,000 tasks, 40 at-a-time</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20running%201%2C000%2C000%20tasks%2C%2040%20at-a-time&In-Reply-To=CA%2BPf4UDBoVWzFKcivN5_zGo%2BCm%2BSzoJKJcp0YKhS5_dhtjnucQ%40mail.gmail.com"
       TITLE="[Twisted-Python] running 1,000,000 tasks, 40 at-a-time">exarkun at twistedmatrix.com
       </A><BR>
    <I>Wed Oct 26 10:24:12 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024707.html">[Twisted-Python] running 1,000,000 tasks, 40 at-a-time
</A></li>
        <LI>Next message: <A HREF="024701.html">[Twisted-Python] running 1,000,000 tasks, 40 at-a-time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24700">[ date ]</a>
              <a href="thread.html#24700">[ thread ]</a>
              <a href="subject.html#24700">[ subject ]</a>
              <a href="author.html#24700">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02:02 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jrennie at gmail.com</A> wrote:
&gt;<i>The background:
</I>&gt;<i>
</I>&gt;<i>I've been using DeferredSemaphore and DeferredList to manage the 
</I>&gt;<i>running of
</I>&gt;<i>tasks with a resource constraint (only so many tasks can run at the 
</I>&gt;<i>same
</I>&gt;<i>time).  This worked great until I tried to use it to manage millions of
</I>&gt;<i>tasks.  Simply setting them up to run (DeferredSemaphore.run() calls) 
</I>&gt;<i>took
</I>&gt;<i>appx. 2 hours and used ~5 gigs of ram.  This was less efficient than I
</I>&gt;<i>expected.  Note that these numbers don't include time/memory for 
</I>&gt;<i>actually
</I>&gt;<i>running the tasks, only time/memory to set up the running of the tasks.
</I>&gt;<i>I've since written a custom task runner that has uses comparatively 
</I>&gt;<i>little
</I>&gt;<i>setup time/memory by adding a &quot;manager&quot; callback to each task which 
</I>&gt;<i>starts
</I>&gt;<i>additional tasks as appropriate.
</I>&gt;<i>
</I>&gt;<i>My questions:
</I>&gt;<i>
</I>&gt;<i>   - Is the behavior I'm seeing expected?  i.e. are DS/DL only 
</I>&gt;<i>recommended
</I>&gt;<i>   for task management if the # of tasks not too large?  Is there a 
</I>&gt;<i>better way
</I>&gt;<i>   to use DS/DL that I might not be thinking of?
</I>
Yes, it's expected.  Queueing up millions of tasks is a lot of work. 
Setting up millions more callbacks to learn about completion is a lot 
more work.  I would not recommend DeferredSemaphore for things beyond 
&quot;user scale&quot; - eg, things that correspond to a single user action, like 
clicking a button in a GUI.
&gt;<i>   - Is there a Twisted pattern for managing tasks efficiently that I 
</I>&gt;<i>might
</I>&gt;<i>   be missing?
</I>
I think the generator/cooperator approach works pretty well, and has 
constant (instead of linear) time completion notification and 
distributes setup costs across the lifetime of the queue, probably 
allowing for better resource utilization.

See <A HREF="http://as.ynchrono.us/2006/05/limiting-parallelism_22.html">http://as.ynchrono.us/2006/05/limiting-parallelism_22.html</A> for a 
simple write-up.

Jean-Paul

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024707.html">[Twisted-Python] running 1,000,000 tasks, 40 at-a-time
</A></li>
	<LI>Next message: <A HREF="024701.html">[Twisted-Python] running 1,000,000 tasks, 40 at-a-time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24700">[ date ]</a>
              <a href="thread.html#24700">[ thread ]</a>
              <a href="subject.html#24700">[ subject ]</a>
              <a href="author.html#24700">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
