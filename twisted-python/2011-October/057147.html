<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted for Python 3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20for%20Python%203&In-Reply-To=%3C4A1F76A3-E9CA-4314-9757-0E405CDC5DC6%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057146.html">
   <LINK REL="Next"  HREF="057148.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted for Python 3</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20for%20Python%203&In-Reply-To=%3C4A1F76A3-E9CA-4314-9757-0E405CDC5DC6%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Twisted for Python 3">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Oct 19 11:46:57 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057146.html">[Twisted-Python] Twisted for Python 3
</A></li>
        <LI>Next message (by thread): <A HREF="057148.html">[Twisted-Python] Twisted for Python 3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57147">[ date ]</a>
              <a href="thread.html#57147">[ thread ]</a>
              <a href="subject.html#57147">[ subject ]</a>
              <a href="author.html#57147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 19, 2011, at 1:22 PM, Antoine Pitrou wrote:

&gt;<i> On Wed, 19 Oct 2011 13:10:22 -0400
</I>&gt;<i> &quot;Itamar Turner-Trauring&quot; &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> For example, I could post the
</I>&gt;&gt;&gt;<i> following patch for t.p.failure, but would you accept it?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> @@ -464,6 +468,14 @@ class Failure:
</I>&gt;&gt;&gt;<i>         # added 2003-06-23. See comment above in __init__
</I>&gt;&gt;&gt;<i>         c['tb'] = None
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> +        try:
</I>&gt;&gt;&gt;<i> +            # Clear other references held by exception objects
</I>&gt;&gt;&gt;<i> +            c['value'].__cause__ = None
</I>&gt;&gt;&gt;<i> +            c['value'].__context__ = None
</I>&gt;&gt;&gt;<i> +            c['value'].__traceback__ = None
</I>&gt;&gt;&gt;<i> +        except AttributeError:
</I>&gt;&gt;&gt;<i> +            pass
</I>&gt;&gt;&gt;<i> +
</I>&gt;&gt;&gt;<i>         if self.stack is not None:
</I>&gt;&gt;&gt;<i>             # XXX: This is a band-aid.  I can't figure out where these
</I>&gt;&gt;&gt;<i>             # (failure.stack is None) instances are coming from.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> That sort of patch would probably be fine, though I'd much rather that be
</I>&gt;&gt;<i> inside an if statement that checked the Python version rather than inside
</I>&gt;&gt;<i> a try/except. Faster, and much clearer what's going on.
</I>&gt;<i> 
</I>&gt;<i> The try/except is necessary because Failures sometimes wrap something
</I>&gt;<i> else than an exception, and where setting an arbitrary attribute is not
</I>&gt;<i> allowed.
</I>
This patch would definitely need to be accepted if you expect Twisted to eventually support Python 3.  Why do you believe it wouldn't be accepted?

Of course it would need to have some test coverage - but a first step there is to have a buildbot actually running the tests on py3k.

Also: if Failures wrap something other than an Exception, that's a bug.  in Failure.__doc__, it says: &quot;@ivar value: The exception instance responsible for this failure.&quot;  If there are cases where non-Exceptions are passed here, then perhaps that behavior should be deprecated before it raises an exception, but something needs to be adjusted so that the documentation is consistent with the implementation.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20111019/7920e393/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057146.html">[Twisted-Python] Twisted for Python 3
</A></li>
	<LI>Next message (by thread): <A HREF="057148.html">[Twisted-Python] Twisted for Python 3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57147">[ date ]</a>
              <a href="thread.html#57147">[ thread ]</a>
              <a href="subject.html#57147">[ subject ]</a>
              <a href="author.html#57147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
