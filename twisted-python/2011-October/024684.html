<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted enterprise deployment models
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20enterprise%20deployment%20models&In-Reply-To=95EE3AF6-93E3-4B18-90FD-291A847EFA2A%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024683.html">
   <LINK REL="Next"  HREF="024686.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted enterprise deployment models</H1>
    <B>Brad Milne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20enterprise%20deployment%20models&In-Reply-To=95EE3AF6-93E3-4B18-90FD-291A847EFA2A%40twistedmatrix.com"
       TITLE="[Twisted-Python] Twisted enterprise deployment models">brad.milne at devx.runthered.com
       </A><BR>
    <I>Thu Oct 20 20:10:21 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024683.html">[Twisted-Python] Twisted enterprise deployment models
</A></li>
        <LI>Next message: <A HREF="024686.html">[Twisted-Python] First pre-release of Twisted 11.1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24684">[ date ]</a>
              <a href="thread.html#24684">[ thread ]</a>
              <a href="subject.html#24684">[ subject ]</a>
              <a href="author.html#24684">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks all for the thoughts.

Clinching drivers for us to choose AMQP (RabbitMQ) include built-in
persistence, manual ACK (ie only when finished, not just when pulled), plus
the obviously strong configuration-driven routing capabilities.

With this distributed architecture using rabbit, we're not likely to pursue
a hot-swap design with Twisted - there wouldn't be the same payback compared
with the ease with which new entire adapter service code can be deployed
with rabbit maintaining messages between components. It is something I've
come back to a few times though - have thought roughly about the idea of an
enhanced Service class that can be easily swapped in and out.

The plan was that if we continued with *n *Twisted services attached by
rabbit queues that we'd eventually build some manner of central Manager that
could be responsible for tracking these things. In fact we may extend it to
become a deployment manager as well at some point, that could control the
graceful swapping out of Twisted services.

Introducing these kinds of limits into the Twisted ecosystem would not be
&gt;<i> impossible, but it is very challenging, because you'd have to come up with a
</I>&gt;<i> model that applied equally well to all of the supported protocols and all
</I>&gt;<i> the ways you might want to store state within those protocols.
</I>
On this note, I hadn't aimed for the gold-plated approach of persisting
every state - we have stateful objects that we pass around and was thinking
more of closing all inbound services, waiting for completion, then closing
outbound services and persisting these objects' state. That would be less
reusable across Twisted as a whole, I understand, but certainly makes for a
more easily consumable first bite.

Fair enough re 'best-practice' :) I knew if I went as far as to ask that,
I'd get a reasonable gauge back at least

Thanks again
Brad

PS - Christopher, I look forward to seeing that lib


On 21 October 2011 07:13, Glyph &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i> On Oct 20, 2011, at 6:50 AM, Brad Milne wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; We have a core message-handling platform which encompasses an
</I>&gt;<i> ever-increasing array of modules and services run inside one Twisted
</I>&gt;<i> process. This is good as it means the reactor is in control of most of the
</I>&gt;<i> stuff relevant to it. However, as the number of deployed services within it
</I>&gt;<i> grows, it becomes increasingly burdensome to have all the modules in a
</I>&gt;<i> single deployed codebase running in a single launched process.
</I>&gt;<i> &gt; Java has JEE; erlang has hot code loading; x has y; what does Twisted
</I>&gt;<i> have? pb?
</I>&gt;<i>
</I>&gt;<i> Erlang can do this because it has a strict separation of state and behavior
</I>&gt;<i> (in the vernacular, &quot;it is not object-oriented&quot;) and J2EE can do this
</I>&gt;<i> because it requires you to externalize all your state - usually to a
</I>&gt;<i> relational database.  Part of the appeal of Twisted is that you can freely
</I>&gt;<i> use simple, in-memory mutable data structures to store your mutable state.
</I>&gt;<i>
</I>&gt;<i> Introducing these kinds of limits into the Twisted ecosystem would not be
</I>&gt;<i> impossible, but it is very challenging, because you'd have to come up with a
</I>&gt;<i> model that applied equally well to all of the supported protocols and all
</I>&gt;<i> the ways you might want to store state within those protocols.
</I>&gt;<i>
</I>&gt;<i> &gt; To date we have begun introducing RabbitMQ (AMQP), with separate Twisted
</I>&gt;<i> processes running as adapters at either end of queues. On the surface this
</I>&gt;<i> fits nicely as it provides distributed architecture, resilience through
</I>&gt;<i> isolation, and decoupled upgrade paths. On the flipside though, it means
</I>&gt;<i> more technology and more processes running outside of a singleton Twisted
</I>&gt;<i> reactor (read: OS process management, which Twisted's designed to be better
</I>&gt;<i> than).
</I>&gt;<i>
</I>&gt;<i> I'm not sure what you mean by &quot;OS process management&quot; versus &quot;Twisted
</I>&gt;<i> process management&quot;.  It's true that you get some benefits from using
</I>&gt;<i> spawnProcess to manage your subprocesses, since you can write code to
</I>&gt;<i> automatically start and stop them in response to certain stimuli, but this
</I>&gt;<i> relies completely on however it is your OS starts and stops processes.  Why
</I>&gt;<i> not just have a Twisted monitor process that starts and monitors the health
</I>&gt;<i> of all of your queue producer/consumer processes?  Then you should get the
</I>&gt;<i> best of both worlds.
</I>&gt;<i>
</I>&gt;<i> &gt; So my questions:
</I>&gt;<i> &gt; 1) I'm right, right? Twisted doesn't have mechanisms or a library for hot
</I>&gt;<i> swapping code modules or similar solutions for low impact upgrades and high
</I>&gt;<i> availability? (I originally read about Twisted *plugins* hoping for this,
</I>&gt;<i> but was disappointed to find how basic they actually were)
</I>&gt;<i>
</I>&gt;<i> Reza already replied with a pretty good list of possible options for this,
</I>&gt;<i> but: no, there's no single, one-size-fits-all solution for this.
</I>&gt;<i>
</I>&gt;<i> And there could be!  As I said above, it's tricky, but if you could think
</I>&gt;<i> of a good design for such a system, I'd absolutely LOVE for it to be in
</I>&gt;<i> Twisted.  Please feel free to contribute something :).
</I>&gt;<i>
</I>&gt;<i> &gt; 2) Is RabbitMQ with txAMQP-empowered Twisted instances on the ends of the
</I>&gt;<i> queues a sensible, compatible, best-practice approach as agreed by the
</I>&gt;<i> community?
</I>&gt;<i>
</I>&gt;<i> No.
</I>&gt;<i>
</I>&gt;<i> I don't mean that it doesn't work, I just don't like the term
</I>&gt;<i> &quot;best-practice&quot;.
</I>&gt;<i>
</I>&gt;<i> Maybe your implementation is a good idea, maybe not.  But if I said it's a
</I>&gt;<i> &quot;best practice&quot;, that would relieve you of the need to think critically
</I>&gt;<i> about whether or not this approach was satisfying your requirements.  There
</I>&gt;<i> are some cases where this is a good idea, some not.  There are some people
</I>&gt;<i> in the community who have had good experiences with this approach; I
</I>&gt;<i> personally don't use it.
</I>&gt;<i>
</I>&gt;<i> You'll have to be the judge of whether it's working for you or not.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20111021/594e9a06/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20111021/594e9a06/attachment.htm</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024683.html">[Twisted-Python] Twisted enterprise deployment models
</A></li>
	<LI>Next message: <A HREF="024686.html">[Twisted-Python] First pre-release of Twisted 11.1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24684">[ date ]</a>
              <a href="thread.html#24684">[ thread ]</a>
              <a href="subject.html#24684">[ subject ]</a>
              <a href="author.html#24684">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
