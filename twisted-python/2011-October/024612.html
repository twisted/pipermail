<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] dataReveived() buffer best practice?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20dataReveived%28%29%20buffer%20best%20practice%3F&In-Reply-To=4E8EE6E2.8040204%40imperial.ac.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024610.html">
   <LINK REL="Next"  HREF="024613.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] dataReveived() buffer best practice?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20dataReveived%28%29%20buffer%20best%20practice%3F&In-Reply-To=4E8EE6E2.8040204%40imperial.ac.uk"
       TITLE="[Twisted-Python] dataReveived() buffer best practice?">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Oct  7 09:11:35 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024610.html">[Twisted-Python] dataReveived() buffer best practice?
</A></li>
        <LI>Next message: <A HREF="024613.html">[Twisted-Python] dataReveived() buffer best practice?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24612">[ date ]</a>
              <a href="thread.html#24612">[ thread ]</a>
              <a href="subject.html#24612">[ subject ]</a>
              <a href="author.html#24612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 7, 2011, at 7:47 AM, Phil Mayers wrote:

&gt;<i> On 10/06/2011 10:06 PM, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> I also ran a tcpdump to confirm &#65533; The opposite server is obviously
</I>&gt;&gt;&gt;<i> pushing
</I>&gt;&gt;&gt;<i> content to the socket in arbitrary frequencies, ending up in my
</I>&gt;&gt;&gt;<i> dataReceived() method to get called arbitrarily as well.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> This is not so obvious. Any hop along the route may fragment the data.
</I>&gt;<i> 
</I>&gt;<i> It is quite unusual (though not unheard of) for something to re-segment 
</I>&gt;<i> the TCP stream. IP level fragmentation might occur, but it's relatively 
</I>&gt;<i> uncommon in todays IP networks, and is anyway irrelevant to TCP - the 
</I>&gt;<i> TCP stack will only see a reassembled IP packet.
</I>
I am skeptical; my recollection (the last time I worked at this layer of the network) is that this happens all the time over the public internet between diverse endpoints.

However, it's also mostly irrelevant: the thing at issue here is the distinction between the call to send() and the call to recv() - or in Twisted terms, the call to transport.write() and the argument to dataReceived, which will be smashed up into quasi-arbitrary lengths at the very least by your kernel and your router; you can send as much as you want at once via .write() but dataReceived will tend to get called with chunks around 1-2x your path MTU.

But the sizes are also not important.  The point is that TCP is about streams, not packets, and you have to deal with arbitrary chunking if you want your code to work right.  What layer of the network this happens at is not important to your code :).

-glyph
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024610.html">[Twisted-Python] dataReveived() buffer best practice?
</A></li>
	<LI>Next message: <A HREF="024613.html">[Twisted-Python] dataReveived() buffer best practice?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24612">[ date ]</a>
              <a href="thread.html#24612">[ thread ]</a>
              <a href="subject.html#24612">[ subject ]</a>
              <a href="author.html#24612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
