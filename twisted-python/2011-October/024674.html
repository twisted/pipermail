<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted for Python 3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20for%20Python%203&In-Reply-To=c86c896386db0d08b6129e5ddd6988ef.squirrel%40webmail.zoteca.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024673.html">
   <LINK REL="Next"  HREF="024675.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted for Python 3</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20for%20Python%203&In-Reply-To=c86c896386db0d08b6129e5ddd6988ef.squirrel%40webmail.zoteca.com"
       TITLE="[Twisted-Python] Twisted for Python 3">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Oct 19 17:37:00 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024673.html">[Twisted-Python] Twisted for Python 3
</A></li>
        <LI>Next message: <A HREF="024675.html">[Twisted-Python] Twisted for Python 3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24674">[ date ]</a>
              <a href="thread.html#24674">[ thread ]</a>
              <a href="subject.html#24674">[ subject ]</a>
              <a href="author.html#24674">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 19, 2011, at 4:28 PM, Itamar Turner-Trauring wrote:

&gt;&gt;<i> To me, 3.x support in trunk is not really workable unless you drop
</I>&gt;&gt;<i> pre-2.6 compatibility. Bytes literals are pretty much required.
</I>&gt;&gt;<i> A possible workaround is to call a factory function that makes
</I>&gt;&gt;<i> an str into a bytes in 3.x (e.g. write B(&quot;xyz&quot;) everywhere instead of
</I>&gt;&gt;<i> b&quot;xyz&quot;), but that's quite ugly IMO, not to mention suboptimal.
</I>&gt;<i> 
</I>&gt;<i> We're getting closer; we're going to drop Python 2.4 as soon as the next
</I>&gt;<i> release is out. Still not up to 2.6, though.
</I>
For one thing:

What's the big problem with B(&quot;&quot;)?  It does not strike me as particularly problematic.  We call plenty of functions at import time, I'm sure that it's not going to impact performance much.  Plus, it's very easy to fix with a trivial regex when we do drop 2.5 support eventually: the expression evaluates to the same thing.  If anything, concern about the function call overhead will simply encourage us to make more constant bytestrings module-level constants instead of inline expressions, which is a plus if you ask me :).

&gt;&gt;<i> Incompatibilities are a given when you switch between two different
</I>&gt;&gt;<i> data models. The incompatibilities don't have to be wire-level, but
</I>&gt;&gt;<i> they *will* occur at the higher level anyway.
</I>&gt;<i> 
</I>&gt;<i> The thing that worries is me is unnecessary or harmful incompatibilities
</I>&gt;<i> that are a result of misunderstanding (e.g. the banana thing, which was an
</I>&gt;<i> unnecessary wire protocol change). Submitting patches would have the
</I>&gt;<i> benefit of letting someone else help you make these decisions; it's
</I>&gt;<i> unreasonable to expect you to become an expert on every single API in
</I>&gt;<i> Twisted.
</I>
Nothing to say to this besides a big &quot;+1&quot;.  This is the whole point of the review process: to make sure that appropriate knowledge is shared before committing to a change.

&gt;&gt;<i> Without wanting to sound unconstructive, the &quot;right way&quot; (the
</I>&gt;&gt;<i> &quot;byte-sized&quot; approach) does not sound workable. Some 3.x-related patches
</I>&gt;&gt;<i> (not mine) have been lingering for years, although they are trivial. And
</I>&gt;&gt;<i> these patches (mine and the others) are really the tip of iceberg.
</I>&gt;<i> 
</I>&gt;<i> There aren't any python 3 patches in the review queue at the moment; do
</I>&gt;<i> you have any specific tickets in mind? If they're ready to go they should
</I>&gt;<i> have the &quot;review&quot; keyword set (if they haven't addressed review comments
</I>&gt;<i> then that is why they aren't merged).
</I>
I should note also that our review queue has gotten to 0 tickets several times since those tickets have last been in review, so things are getting through.

The problem here is that nobody is putting in the consistent work necessary to get these patches through review and merged to trunk.  Almost all the py3k patches have been dropped off and then abandoned.  The solution is not to give up and abandon all the patches together, but rather to find some people to get involved and continue participating in that work.

(That's not to say that I don't appreciate the effort involved in dropping those patches off in the first place.  I do.  It also doesn't mean that people shouldn't drop off patches if they're not going to finish them; they definitely should.  The original author doesn't necessarily have to be the one to do the responding to feedback.)

It may seem easier right now to put them into a big pile and forget about that process, but what happens once trunk has moved on?  We don't make a lot of incompatible changes, but that doesn't mean we don't change the implementation of things quite a bit.  Lots of work has gone on in core areas of Twisted recently - including a near-total rewrite of TLS support - and many more such changes are coming.  The relative stability of Twisted as an API to depend on says nothing about the stability of the code in terms of diffs continuing to apply; and the larger the diff, the more likely it's going to run into conflicts.

It's worth the extra effort to get the code into the mainline because when the work is done, it's actually done: we continue to maintain that code moving forward, and assuming that there is an appropriate buildslave (possibly one with the 'rachet'-style reporting that exarkun just set up for pydoctor?), we make sure that future changes won't undo the progress that has been made and introduce more py3k warnings or test failures.

If the code isn't in the mainline, then instead of supporting your efforts, all future maintenance undermines them.  You'll have to put in lots of extra work to keep your fork applying, and you'll have to do a bunch of work because any changes will not take the py3 compatibility tests into account, so every new module will be a new thing you have to clean up.  Plus you don't get the benefit of having each change tested extensively to make sure it doesn't break anything unexpected, on some weird platform or configuration.

This work on the build infrastructure and release management and QA appears to be invisible from the perspective of an individual change, but in reality it's the plurality, if not the majority, of the work that goes into the project.

&gt;&gt;<i> *Assuming* we find a clean solution to the bytes literal problem,
</I>
We've already got one, except perhaps for an unreasonably strict definition of &quot;clean&quot; :-).

&gt;&gt;<i> I could try to slice all of that into &quot;byte-sized&quot; patches into which I
</I>&gt;&gt;<i> inject version-checking boilerplate, but that would mean a large waste
</I>&gt;&gt;<i> of time and energy:
</I>&gt;&gt;<i> - for me, as I post dozens of small patches and have to follow up on
</I>&gt;&gt;<i>  them, and wait for them to be checked in
</I>
You can choose the appropriate size of patches; you don't have to work on a per-file basis; it would make more sense to choose a topic area than to just submit individual one-liners as patches because that's what happens to be in a single file.

&gt;&gt;<i> - for you, as you have to review these patches without perhaps even
</I>&gt;&gt;<i>  being Python 3 users yourselves, and without Python 3 compatibility
</I>&gt;&gt;<i>  being on your priority list
</I>&gt;<i> 
</I>&gt;<i> Most of us aren't Windows users either, but we still try to support
</I>&gt;<i> Windows :)
</I>
Also, the issue is not the priority of python 3 support, but the priority of reviewing incoming patches, which is always at the absolute top of our priority list.  As you can see from the scoring system on &lt;<A HREF="http://twistedmatrix.com/highscores/">http://twistedmatrix.com/highscores/</A>&gt;, we value it more highly than anything else.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20111019/1f0fb42c/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20111019/1f0fb42c/attachment-0001.htm</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024673.html">[Twisted-Python] Twisted for Python 3
</A></li>
	<LI>Next message: <A HREF="024675.html">[Twisted-Python] Twisted for Python 3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24674">[ date ]</a>
              <a href="thread.html#24674">[ thread ]</a>
              <a href="subject.html#24674">[ subject ]</a>
              <a href="author.html#24674">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
