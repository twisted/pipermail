<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Ideas on limiting/throttling spawnProcess
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Ideas%20on%20limiting/throttling%20spawnProcess&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025194.html">
   <LINK REL="Next"  HREF="024713.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Ideas on limiting/throttling spawnProcess</H1>
    <B>Daryl Herzmann</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Ideas%20on%20limiting/throttling%20spawnProcess&In-Reply-To="
       TITLE="[Twisted-Python] Ideas on limiting/throttling spawnProcess">akrherz at gmail.com
       </A><BR>
    <I>Fri Oct 28 18:21:41 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="025194.html">No subject
</A></li>
        <LI>Next message: <A HREF="024713.html">[Twisted-Python] Ideas on limiting/throttling spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24712">[ date ]</a>
              <a href="thread.html#24712">[ thread ]</a>
              <a href="subject.html#24712">[ subject ]</a>
              <a href="author.html#24712">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have an application that ingests data and does a reactor.spawnProcess()
for each chunk of data (a product) to pass it as STDIN to a compiled binary
and then I harvest the STDOUT. It has been working well, but I have an issue
when my data rates get too high and the machine gets overloaded with spawned
processes (I think) and starts running out of file descriptors (yes I can
raise it :) causing all sorts of pain.  I'm wondering about a mechanism to
throttle the number of spawned processes going at one time?  It'd be nice to
only have 10 of these spawned processes going at any one time.  Thanks for
your ideas :)

daryl

code snipet:

class SHEFIT(protocol.ProcessProtocol):
    def __init__(self, tp):
        self.tp = tp
        self.data = &quot;&quot;

    def connectionMade(self):
        self.transport.write( self.tp.raw )
        self.transport.closeStdin()

    def outReceived(self, data):
        self.data = self.data + data

    def errReceived(self, data):
        print &quot;errReceived! with %d bytes!&quot; % len(data)
        print data

    def outConnectionLost(self):
        really_process(self.tp, self.data)

def got_product():
    shef = SHEFIT( tp )
    reactor.spawnProcess(shef, &quot;shefit&quot;, [&quot;shefit&quot;], {})

def really_process(tp,data):
    print 'Do some work'

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025194.html">No subject
</A></li>
	<LI>Next message: <A HREF="024713.html">[Twisted-Python] Ideas on limiting/throttling spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24712">[ date ]</a>
              <a href="thread.html#24712">[ thread ]</a>
              <a href="subject.html#24712">[ subject ]</a>
              <a href="author.html#24712">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
