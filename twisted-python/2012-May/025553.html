<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Getting rid of &quot;DirtyReactorWarning&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Getting%20rid%20of%20%22DirtyReactorWarning%22&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025552.html">
   <LINK REL="Next"  HREF="025564.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Getting rid of &quot;DirtyReactorWarning&quot;</H1>
    <B>Itamar Turner-Trauring</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Getting%20rid%20of%20%22DirtyReactorWarning%22&In-Reply-To="
       TITLE="[Twisted-Python] Getting rid of &quot;DirtyReactorWarning&quot;">itamar at itamarst.org
       </A><BR>
    <I>Tue May 15 06:26:24 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025552.html">[Twisted-Python] Cannot install Twisted version 8 through PIP
</A></li>
        <LI>Next message: <A HREF="025564.html">[Twisted-Python] Getting rid of &quot;DirtyReactorWarning&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25553">[ date ]</a>
              <a href="thread.html#25553">[ thread ]</a>
              <a href="subject.html#25553">[ subject ]</a>
              <a href="author.html#25553">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a ticket open for allowing tests that look like this, where each 
run has a new reactor instance:


def test_somethingShouldHappen(self, reactor):
      result = []
      reactor.listenTCP(...)
      self.runReactor(reactor)
      self.assertEqual(result, [&quot;hooray&quot;])


Further thought suggests however that this doesn't add much, 
necessarily, over the current &quot;return a Deferred&quot; idiom for most users. 
Experience with ReactorBuilder framework that has similar testing 
mechanism suggests it's far too easy to fail to stop the reactor. 
Moreover, things like coiterate() don't work since they rely on 
pre-imported global reactor, and given the &quot;from twisted.internet import 
reactor&quot; idiom this testing style won't work well for many people's code.

But! ReactorBuilder tests are superior in one way: no 
DirtyReactorWarning. You don't have to wait until all connections are 
closed, which is difficult, or make sure to cancel every timeout. This 
makes test writing simpler.

Perhaps we should get rid of DirtyReactorWarning for regular 
Deferred-returning tests as well, then. We have all the infrastructure 
we need, after all, for canceling scheduled events and disconnecting all 
descriptors. We might want to log when we do so, to help debug things, 
but we already have cleanup code mostly implemented in trial anyway, and 
it seems like DirtyReactorWarning doesn't usually make future tests fail 
anyway since we do run cleanup.

Threaded code might still be a problem, but that's the case for current 
tests now, and even switching to a new style of tests as above would 
only somewhat mitigate the issue.

Thoughts?

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025552.html">[Twisted-Python] Cannot install Twisted version 8 through PIP
</A></li>
	<LI>Next message: <A HREF="025564.html">[Twisted-Python] Getting rid of &quot;DirtyReactorWarning&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25553">[ date ]</a>
              <a href="thread.html#25553">[ thread ]</a>
              <a href="subject.html#25553">[ subject ]</a>
              <a href="author.html#25553">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
