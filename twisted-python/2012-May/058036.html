<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Synchronous calls using Twisted?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Synchronous%20calls%20using%20Twisted%3F&In-Reply-To=%3C4FB67984.3070508%40gresille.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058032.html">
   <LINK REL="Next"  HREF="058037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Synchronous calls using Twisted?</H1>
    <B>Louis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Synchronous%20calls%20using%20Twisted%3F&In-Reply-To=%3C4FB67984.3070508%40gresille.org%3E"
       TITLE="[Twisted-Python] Synchronous calls using Twisted?">spalax at gresille.org
       </A><BR>
    <I>Fri May 18 10:32:04 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058032.html">[Twisted-Python] Synchronous calls using Twisted?
</A></li>
        <LI>Next message (by thread): <A HREF="058037.html">[Twisted-Python] Synchronous calls using Twisted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58036">[ date ]</a>
              <a href="thread.html#58036">[ thread ]</a>
              <a href="subject.html#58036">[ subject ]</a>
              <a href="author.html#58036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>	Hello,
On 17/05/2012 02:00, Jasper St. Pierre wrote:
&gt;<i> I don't understand why you can't make Django do asynchronous calls.
</I>&gt;<i> Maybe a bit more context would help.
</I>	Once again, maybe I *cannot* make Django do asynchronous calls simply
because I am not used to Twisted and asynchronous calls.

 +----------+   +-------------+   +------------+   +-----------+
 | Database |---| Core Server |---| Web Server |---| Web client|
 +----------+   +-------------+   +------------+   +-----------+

	A bit more context.
	What I call &quot;core server&quot; is more or less a proxy to a database. It
exposes some high-level functions to access and manipulate the database,
doing some additional checks to ensure that user is allowed to do what
he is trying to do, and ensuring that he does not mess up the integrity
of the database. I am trying to make this server be a Twisted server.
	The &quot;web server&quot; is built using Django. It has access to the database
only using the high-level functions exposed by the core server.
	Until I got stuck with this synchronous/asynchronous questions, I
thought Twisted would be a nice tool to use to make the core server and
web server communicate.


	The way I plan mixing Django and Twisted here is having Django be run
the usual way (from a Django point of view), and do calls to the core
server using Twisted. This excludes mixing Django and Twisted that way
[1] where, as far as I understand it, Twisted is &quot;simply&quot; the web server
calling Django.
	Django being run the usual way, I can define Django functions which,
when a client is requesting a web page, are called, process data, and
return the requested web page. If I want to do a Twisted call in this
function (to get some information from the database (remember: the
Twisted server is a proxy to the database)), I must wait for the Twisted
call to return before returning the requested page.

	I hope this is more clear... (more clear? clearer? Sorry... Not native
English speaker...)

	But maybe there is another way of doing this. Maybe there is a way to
asynchronously call the Twisted function, getting a deferred, and adding
the &quot;returnDjangoWebPage()&quot; function (which makes use of the MVC
functionality of Django) as a callback to this deferred.

	Is there a proper way to mix Django and Twisted the way I want it to be
mixed ?

	Regards,
	Louis

[1]
<A HREF="http://www.clemesha.org/blog/Django-on-Twisted-using-latest-twisted-web-wsgi/">http://www.clemesha.org/blog/Django-on-Twisted-using-latest-twisted-web-wsgi/</A>

&gt;<i> On Wed, May 16, 2012 at 6:58 PM, Louis &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">spalax at gresille.org</A>&gt; wrote:
</I>&gt;&gt;<i>  Hello,
</I>&gt;&gt;<i>  I am writing an application, which architecture is (I hope my
</I>&gt;&gt;<i> beautiful drawing is not messed up):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  +-------------+   +------------+   +-----------+
</I>&gt;&gt;<i>  | Core Server |---| Web Server |---| Web client|
</I>&gt;&gt;<i>  +-------------+   +------------+   +-----------+
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  That is, I have a core server (itself interacting with a database, but
</I>&gt;&gt;<i> I think this is not important). I have a second piece of software, which
</I>&gt;&gt;<i> is both a client regarding the core server, and a web server. At last,
</I>&gt;&gt;<i> the web client is the web browser of your choice.
</I>&gt;&gt;<i>  The web server is a Django application, which means that (as far as I
</I>&gt;&gt;<i> know) I cannot (easily) make it use asynchronous calls.
</I>&gt;&gt;<i>  At last, for the communication between the core server and the web
</I>&gt;&gt;<i> server (which is, from this point of vue, a client), I was looking for
</I>&gt;&gt;<i> something that let me use remote objects as if they were local. That is
</I>&gt;&gt;<i> when I discovered Twisted.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Twisted seems to be the kind of tool I want to use because it seems to
</I>&gt;&gt;<i> be powerful, can use SSL, authentication, transmits exceptions, is meant
</I>&gt;&gt;<i> to be used with Trial (I want to write tests), etc. The problem is that
</I>&gt;&gt;<i> one of the strength of Twisted is its ability to deal with asynchronous
</I>&gt;&gt;<i> tasks, which I am not interested in.  Using blockingCallFromThread()
</I>&gt;&gt;<i> [1], I managed to make a small package which looks (from my
</I>&gt;&gt;<i> Twisted-ignorant point of vue) promising for my application, where the
</I>&gt;&gt;<i> server is simply defined by (in a Twisted .tac  file):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    # Server() is the object to be exported to the client
</I>&gt;&gt;<i>    application = server.get_application(Server(),
</I>&gt;&gt;<i>                  &quot;tcp:8800:interface=localhost&quot;)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And the client can perform something like:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    remote = client.RemoteObject(&quot;localhost&quot;, 8800)
</I>&gt;&gt;<i>    # display() is a method executed on the server
</I>&gt;&gt;<i>    remote.display(&quot;Hello, world!&quot;)
</I>&gt;&gt;<i>    remote.disconnect()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  But then I noticed that I might have problem to test it using Trial
</I>&gt;&gt;<i> (because an deadlock happens when blockingCallFromThread() and the
</I>&gt;&gt;<i> reactor are waiting for each other in the same thread). I also had a
</I>&gt;&gt;<i> look at inlineCallbacks [2], but although code looks synchronous inside
</I>&gt;&gt;<i> the decorated function, the function itself still returns a deferred.  I
</I>&gt;&gt;<i> noticed quite a few other minor things. And I started to realize that
</I>&gt;&gt;<i> Twisted is not meant to be used that way (and I read a bunch of threads
</I>&gt;&gt;<i> of the Twisted mailing list with subjects containing &quot;synchronous&quot;,
</I>&gt;&gt;<i> including this long one [3]).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  My question is: What is your reaction?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> a) &quot;Nice hack! Go on!&quot;
</I>&gt;&gt;<i> b) &quot;Go on if you like, but you won't be able to use advanced Trial stuff
</I>&gt;&gt;<i> (like timeouts), let alone Trial.&quot;
</I>&gt;&gt;<i> c) &quot;Go on if you wish, but you are missing the beauty of Twisted.&quot;
</I>&gt;&gt;<i> d) &quot;Stop it now. You have clearly misunderstood Twisted. You are wasting
</I>&gt;&gt;<i> your time and ours.&quot;
</I>&gt;&gt;<i> e) Any other...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Do you think Twisted is the right tool for my use case, or am I doing
</I>&gt;&gt;<i> an ugly hack to do what I want, which means I should rather use another
</I>&gt;&gt;<i> tool?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Sorry for the length of this post, and thanks in advance for your help.
</I>&gt;&gt;<i>  Louis
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [1]
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.threads.html#blockingCallFromThread">http://twistedmatrix.com/documents/current/api/twisted.internet.threads.html#blockingCallFromThread</A>
</I>&gt;&gt;<i> [2]
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.internet.defer.html#inlineCallbacks">http://twistedmatrix.com/documents/current/api/twisted.internet.defer.html#inlineCallbacks</A>
</I>&gt;&gt;<i> [3]
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/pipermail/twisted-python/2005-October/thread.html#11831">http://twistedmatrix.com/pipermail/twisted-python/2005-October/thread.html#11831</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058032.html">[Twisted-Python] Synchronous calls using Twisted?
</A></li>
	<LI>Next message (by thread): <A HREF="058037.html">[Twisted-Python] Synchronous calls using Twisted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58036">[ date ]</a>
              <a href="thread.html#58036">[ thread ]</a>
              <a href="subject.html#58036">[ subject ]</a>
              <a href="author.html#58036">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
