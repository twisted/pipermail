<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Synchronous calls using Twisted?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Synchronous%20calls%20using%20Twisted%3F&In-Reply-To=%3C20120518201707.30694.531206930.divmod.xquotient.22%40localhost6.localdomain6%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058036.html">
   <LINK REL="Next"  HREF="058033.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Synchronous calls using Twisted?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Synchronous%20calls%20using%20Twisted%3F&In-Reply-To=%3C20120518201707.30694.531206930.divmod.xquotient.22%40localhost6.localdomain6%3E"
       TITLE="[Twisted-Python] Synchronous calls using Twisted?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Fri May 18 14:17:07 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058036.html">[Twisted-Python] Synchronous calls using Twisted?
</A></li>
        <LI>Next message (by thread): <A HREF="058033.html">[Twisted-Python] Synchronous calls using Twisted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58037">[ date ]</a>
              <a href="thread.html#58037">[ thread ]</a>
              <a href="subject.html#58037">[ subject ]</a>
              <a href="author.html#58037">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04:32 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">spalax at gresille.org</A> wrote:
&gt;<i>         Hello,
</I>&gt;<i>On 17/05/2012 02:00, Jasper St. Pierre wrote:
</I>&gt;&gt;<i>I don't understand why you can't make Django do asynchronous calls.
</I>&gt;&gt;<i>Maybe a bit more context would help.
</I>&gt;<i>         Once again, maybe I *cannot* make Django do asynchronous calls 
</I>&gt;<i>simply
</I>&gt;<i>because I am not used to Twisted and asynchronous calls.
</I>&gt;<i>
</I>&gt;<i>[snip]
</I>&gt;<i>
</I>&gt;<i>         The way I plan mixing Django and Twisted here is having Django 
</I>&gt;<i>be run
</I>&gt;<i>the usual way (from a Django point of view), and do calls to the core
</I>
If &quot;the usual way&quot; is as a WSGI application, then blockingCallFromThread 
is probably the best fit.

Django is intended to be used in a multi-threaded (or multi-process) 
environment, not an asynchronous one.  It can't take advantage of 
Twisted's single-threaded asynchronous APIs (eg Deferreds).

Based on your original email, I think you had a pretty good grasp of 
what needed to be done, but it sounds like you got hung up on unit 
testing.

The unit tests work the same way as the actual application works.  That 
is, in actual deployment, you have one thread running the reactor and N 
threads, each running the Django application.  You use 
blockingCallFromThread in any of those N threads to talk to the one 
reactor thread.

The most obvious way for your unit tests to work is for them to do the 
same thing.  Run the reactor in one thread, run your (Django-based, 
blockingCallFromThread-using) unit tests in a different thread.

The deadlock you mentioned will go away, because now the code is 
executing as expected, with the reactor in a different thread than the 
blockingCallFromThread usage.

Whether this is elegant or or beautiful should be addressed separately 
from whether it is technically possible or not.  It is technically 
possible, and there aren't any new technical drawbacks of this approach 
as compared to any system built using Django (or any system built using 
Twisted, for that matter).

Another way to look at it is to consider that Django (and most, if not 
all) synchronously written systems are intended to be used with threads 
to address concurrency.  Using Twisted with Django differs very little 
from using anything else with Django.  To achieve concurrency, you use 
threads.  The only minor difference Twisted brings with it is that all 
of your Twisted usage can happen in just *one* extra thread, whereas 
using a blocking library would probably be one extra thread per 
concurrent request.

Hope that helps clear things up.
Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058036.html">[Twisted-Python] Synchronous calls using Twisted?
</A></li>
	<LI>Next message (by thread): <A HREF="058033.html">[Twisted-Python] Synchronous calls using Twisted?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58037">[ date ]</a>
              <a href="thread.html#58037">[ thread ]</a>
              <a href="subject.html#58037">[ subject ]</a>
              <a href="author.html#58037">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
