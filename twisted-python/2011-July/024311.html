<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Async-pep (again)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Async-pep%20%28again%29&In-Reply-To=CAE_Hg6ZkuxsrAFn6s6p5ew7GeVUptOr%3DwW_9QAdZ03p0xmYm2Q%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024310.html">
   <LINK REL="Next"  HREF="024312.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Async-pep (again)</H1>
    <B>Tim Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Async-pep%20%28again%29&In-Reply-To=CAE_Hg6ZkuxsrAFn6s6p5ew7GeVUptOr%3DwW_9QAdZ03p0xmYm2Q%40mail.gmail.com"
       TITLE="[Twisted-Python] Async-pep (again)">screwtape at froup.com
       </A><BR>
    <I>Thu Jul 14 05:05:38 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024310.html">[Twisted-Python] Async-pep (again)
</A></li>
        <LI>Next message: <A HREF="024312.html">[Twisted-Python] Async-pep (again)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24311">[ date ]</a>
              <a href="thread.html#24311">[ thread ]</a>
              <a href="subject.html#24311">[ subject ]</a>
              <a href="author.html#24311">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Jul 14, 2011 at 10:05:00AM +0200, Laurens Van Houtven wrote:
&gt;<i> On Thu, Jul 14, 2011 at 8:48 AM, Tim Allen &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">screwtape at froup.com</A>&gt; wrote:
</I>&gt;<i> &gt; The idea of Protocols implementing Transports is vaguely gestured at as
</I>&gt;<i> &gt; a Useful Thing, but not much detail is given. I think it would be useful
</I>&gt;<i> &gt; for the final PEP to address that topic more rigorously - partially
</I>&gt;<i> &gt; because it's good to have a firm basis on which to model SOCKS and SSH
</I>&gt;<i> &gt; libraries, but mostly because figuring out how SSL should interact with
</I>&gt;<i> &gt; TCP is going to give people headaches. Twisted, so far as I can see,
</I>&gt;<i> &gt; just sort of punts and says &quot;Yeah, SSL is just another transport like
</I>&gt;<i> &gt; TCP&quot;, but then you have to make the SSL transport support all the same
</I>&gt;<i> &gt; options that the TCP transport supports (socket options? IPv6?), but
</I>&gt;<i> &gt; then what if you want to run SSL over a serial port or a SOCKS
</I>&gt;<i> &gt; connection... AAAAAAAAAAAAA!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In practice, it might be simpler because &quot;SSL&quot; means &quot;whatever subset of
</I>&gt;<i> &gt; TCP functionality we can coax OpenSSL into providing&quot; rather than
</I>&gt;<i> &gt; a fully stackable protocol-providing-a-transport.
</I>&gt;<i> 
</I>&gt;<i> Cool. Can I shove those 2 paragraphs into a ticket or will the copyright
</I>&gt;<i> monster haunt me?
</I>
Go right ahead! I guess most of these things should be tickets, but
I don't have a GitHub account and I'm not particularly looking to
register on more websites at the moment.

&gt;<i> &gt; The thing with Consumers and Producers seems... very abstract. If I'm
</I>&gt;<i> &gt; sitting down to retrieve email via POP3 (to pick a random protocol),
</I>&gt;<i> &gt; 'transports' and 'protocols' are tools that nestle very comfortably in
</I>&gt;<i> &gt; my mental model of the task in front of me; &quot;consumers&quot; and &quot;producers&quot;
</I>&gt;<i> &gt; are not. Are they concepts that should be handled by transport
</I>&gt;<i> &gt; implementors? Protocol implementors? Protocol users? Should they be
</I>&gt;<i> &gt; mapped onto XON/XOFF or RTS/CTS by serial transports?
</I>&gt;<i> 
</I>&gt;<i> Yes, Consumers and Producers are about flow control, and most Transports
</I>&gt;<i> probably are producers.
</I>
Having looked at the issues list after sending that message, I see this
is basically issue 13, &quot;Why are producers/consumers important, how are
they different from protocols/transports?&quot;

If your PEP includes producers and consumers (and I note that the
current example code doesn't, it just has a &quot;FlowControl&quot; class), you'll
want to have an example Protocol that uses producers and consumers in
some useful, illustrative fashion.

&gt;<i> &gt; At least in Twisted, transports and protocols do not exist in a vacuum;
</I>&gt;<i> &gt; they have to be hooked up via the reactor. Will this PEP define
</I>&gt;<i> &gt; a (skeletal) API to be implemented by potential reactors, or is that
</I>&gt;<i> &gt; going to left entirely unspecified, like WSGI?
</I>&gt;<i> 
</I>&gt;<i> Entirely unspecified, because different implementations have to do pretty
</I>&gt;<i> different things.
</I>
I guess the selection of available Transports is up to the hosting
event-loop, too - it might be worth noting that in the section on
&quot;Transports&quot;. Unless, of course, the Transport in question is
implemented by another Protocol, in which case I guess it's anybody's
guess how you might hook your Protocol up.

I almost think that, for pedagogy's sake, there should be an additional
Encapsulator or Framer abstract class, that inherits from Protocol, but
adds a .connectProtocol() method that takes another Protocol instance,
and hooks itself up as that Protocol's transport. Sure, anyone who
understands what's going on should be able to figure out what's going
on, but I think an extra class would make it blindingly obvious, and
I like APIs that save me from having to think too hard.

While there's still people listening to my half-formed opinions:

- Issue 7 seems to have settled on removing support for half_closing
  transports. I seem to recall somebody mentioning support for
  half-close as being one of those weird-corner cases that nobody thinks
  they need until they're trying to figure out why their SSH sessions
  always die with &quot;broken pipe&quot; errors. While it probably would
  complicate the documentation to include it, I'd hope that many
  frameworks that implement this PEP would want to include support for
  half-closing transports, and it'd be nice if there was a standard API
  for it instead of everybody adding their own methods with their own
  semantics. Perhaps there could be an HalfClosableTransport(Transport)
  ABC, that's optional in the same way that, say, DB-API's
  &quot;connection.rollback()&quot; method is defined but optional.

- For issue 6 (&quot;Scatter/gather IO API doesn't make sense yet&quot;), I can't
  see much of a use for readv/scatter, because I imagine the benefits
  come from having a bunch of pre-allocated buffers lying around, and
  even if the Python VM had such buffers, they probably wouldn't be
  visible or useful to running Python code. On the other hand, I can
  easily imagine Python code having a bunch of independently-generated
  buffers that need to be written in a particular order (framing data
  and framed data, for example), and being able to avoid ''.join() could
  be a big win. Again, perhaps this could be an optional extension
  provided by hosting frameworks that want to implement it - although it
  should be pretty easy to emulate on top of the regular .write()
  method.

- You might also want to create an optional Transport method to wrap the
  sendfile(2) and/or splice(2) functions. Without OS support, it'd just
  be a convenient way to tell the host framework to do the grunt-work of
  shunting bytes around; with OS support it should be a good deal more
  efficient than doing the same operations manually.
  
Tim.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024310.html">[Twisted-Python] Async-pep (again)
</A></li>
	<LI>Next message: <A HREF="024312.html">[Twisted-Python] Async-pep (again)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24311">[ date ]</a>
              <a href="thread.html#24311">[ thread ]</a>
              <a href="subject.html#24311">[ subject ]</a>
              <a href="author.html#24311">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
