<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Conch Testing server and client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Conch%20Testing%20server%20and%20client&In-Reply-To=%3CBANLkTinNcUA%3DzBHfDzM00M2Te3pqkrv4CA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="056669.html">
   <LINK REL="Next"  HREF="056676.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Conch Testing server and client</H1>
    <B>Anshul Singhle</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Conch%20Testing%20server%20and%20client&In-Reply-To=%3CBANLkTinNcUA%3DzBHfDzM00M2Te3pqkrv4CA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Conch Testing server and client">anshul.singhle at gmail.com
       </A><BR>
    <I>Fri Jul  1 07:41:33 MDT 2011</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="056669.html">[Twisted-Python] Conch Testing server and client
</A></li>
        <LI>Next message (by thread): <A HREF="056676.html">[Twisted-Python] Conch Testing server and client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56673">[ date ]</a>
              <a href="thread.html#56673">[ thread ]</a>
              <a href="subject.html#56673">[ subject ]</a>
              <a href="author.html#56673">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, here goes :
The test code :

from twisted.trial import unittest
from twisted.internet import defer, protocol, reactor
class TestAccountStatus(unittest.TestCase):
     def setUp(self):
         ssh_server = Server()
         self.server = reactor.listenTCP(ssh_server.port,
                      ssh_server.application(),
                      interface=ssh_server.interface)
         return self.server
     def tearDown(self):
         server, self.server = self.server,None
         return server.stopListening()
     def test_1(self):
         def got_data(data):
             self.assertEquals(data,&quot;a&quot;)
         d = protocol.ClientCreator(reactor,
SimpleTransport).connectTCP('localhost', self.server.getHost().port)
         d.addCallback(got_data)
         return d

The client code :
from twisted.conch.ssh import transport, userauth, connection, common, keys,
channel
from twisted.internet import defer, protocol, reactor
class SimpleTransport(transport.SSHClientTransport):
    def verifyHostKey(self, hostKey, fingerprint):
        print 'host key fingerprint: %s' % fingerprint
        return defer.succeed(1)

    def connectionSecure(self):
        self.requestService(
            SimpleUserAuth('webchick',
                SimpleConnection()))

class SimpleUserAuth(userauth.SSHUserAuthClient):
    def getPassword(self):
        print &quot;Get Password called&quot;
        return defer.succeed(&quot;Thai1mil3ahb&quot;)

When I run the test I expect :
  tests
  TestAccountStatus
    test_1 ... Get Password called

followed by some errors , but atleast this much should be printed if the
client code is being called properly.
Instead I get:

[FAIL]: tests.TestAccountStatus.test_1

Traceback (most recent call last):
  File &quot;tests.py&quot;, line 92, in got_data
    self.assertEquals(data,&quot;a&quot;)
twisted.trial.unittest.FailTest: not equal:
a = &lt;tests.SimpleTransport instance at 0x1024aa128&gt;
b = 'a'

Instead of running the client the deferred is just returning an instance of
the Client Transport used by me  (SimpleTransport). Any ideas why this is
happening? Is this becuse I'm not using a ClientFactory or am I using the
deferred all wrong?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20110701/a5584c9b/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="056669.html">[Twisted-Python] Conch Testing server and client
</A></li>
	<LI>Next message (by thread): <A HREF="056676.html">[Twisted-Python] Conch Testing server and client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#56673">[ date ]</a>
              <a href="thread.html#56673">[ thread ]</a>
              <a href="subject.html#56673">[ subject ]</a>
              <a href="author.html#56673">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
