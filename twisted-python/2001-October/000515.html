<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Fresh CVS hooker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Fresh%20CVS%20hooker&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000514.html">
   <LINK REL="Next"  HREF="000516.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Fresh CVS hooker</H1>
    <B>Kevin Turner</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Fresh%20CVS%20hooker&In-Reply-To="
       TITLE="[Twisted-Python] Fresh CVS hooker">acapnotic at twistedmatrix.com
       </A><BR>
    <I>Wed Oct 17 14:51:11 EDT 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="000514.html">[Twisted-Python] Re: [Twisted-commits] CVS: Twisted/twisted/web server.py,1.20,1.21
</A></li>
        <LI>Next message: <A HREF="000516.html">[Twisted-Python] Fresh CVS hooker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#515">[ date ]</a>
              <a href="thread.html#515">[ thread ]</a>
              <a href="subject.html#515">[ subject ]</a>
              <a href="author.html#515">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So I was reading the CVS docs where it says 
&gt;<i> Doing so in the naive way will cause a problem with locks,
</I>&gt;<i> so the `cvs update' must be run in the background.  Here is
</I>&gt;<i> an example for unix (this should all be on one line):
</I>&gt;<i> 
</I>&gt;<i> ^cyclic-pages              (date; cat; (sleep 2; cd /u/www/local-docs; cvs -q update -d) &amp;) &gt;&gt; $CVSROOT/CVSROOT/updatelog 2&gt;&amp;1
</I>
and the kluge repulsion seized ahold of some delerium and possesed me to
write an, uh, non-naive CVS loginfo thingie.

The result is in 
<A HREF="http://twistedmatrix.com/users/acapnotic/mycvs/cvstoys/">http://twistedmatrix.com/users/acapnotic/mycvs/cvstoys/</A> , or
~acapnotic/co-me/cvstoys for those of you on the inside.

the primary advantage of this is that it doesn't anywhere say &quot;sleep 2&quot;
(it hides that behind a Delayed instead =), but whereas CVSROOT/loginfo
will only run the first matching command it finds, my cvs fresher can
unleash an entire horde of actions.  And it can provide a PB service, if
you're into that sort of thing.

It hasn't undergone trial-by-fire yet, but it seems to be working so
far.  There is one bit left undone, though: the commit notification
e-mails don't get sent, and I can't figure why.  (Please cast your
eyeballs upon cvstoys/actions.py:MailCommand and see if you can
strighten me out.)

Potential uses:

*) can keep a checked-out directory up-to-date at all times.  i.e. have a
/twisted/cvsTwisted/ directory that would always contain the
bleeding-edge version.  Or have changes show up in /var/www as soon
as they're checked in.

*) could let a bleeding-edge Twisted server know when the source has
changed, in case it wants to trigger a twisted.python.rebuild.  

*) Could keep a tarball snapshot up to date (although you'd probably
want to be a little cautious about how often you decide to bz2 it, as
that takes some considerable resources).

*) could keep a mirror (i.e. coopweb) or off-site back-up up to date by
pushing over rsync.

*) could do the email-commit-notification thing (if we get that bug
ironed out), although admittedly I don't have any real complaints with
the syncmail script we're using now.

*) could run Teud to keep the docs fresh.

*) could notify perspectives signed into it when a check-in occours.
Using epb.el, one could potentially have your emacs run its
version-control-update thing to update your buffers whenever someone
else checks in a new revisions.  This sounds cracktackulous, but I'm not
sure it's really a good idea.

*) could run unit tests and send mail to you (and/or everyone else) if
you screwed something up.

and, um, stuff.  There you have it.  If you want to play with it, put a
'freshCfg' configuration file (like the one in actions.__doc__) in
CVSROOT, check in the freshCfg file and add it to CVSROOT/checkoutlist,
have CVSROOT/loginfo run loginfo.py %{sSv}, start the server by running
fresher.py, and there you go.  (Hmm.  will have to automate some of
that.)  I'll package it shortly after the mail notification starts
working.  oops, better go add the un-copyright notices now.

&quot;and-that's-how-I-replaced-one-line-of-shell-code-with-a-thousand-in-Python&quot;-ly yours,
  - Kevin

-- 
Kevin Turner &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">acapnotic at twistedmatrix.com</A>&gt; | OpenPGP encryption welcome here
The moon is waxing crescent, 0.6% illuminated, 0.8 days old.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000514.html">[Twisted-Python] Re: [Twisted-commits] CVS: Twisted/twisted/web server.py,1.20,1.21
</A></li>
	<LI>Next message: <A HREF="000516.html">[Twisted-Python] Fresh CVS hooker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#515">[ date ]</a>
              <a href="thread.html#515">[ thread ]</a>
              <a href="subject.html#515">[ subject ]</a>
              <a href="author.html#515">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
