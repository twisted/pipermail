<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted, medusa, ZServer, and VFS's
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%2C%20medusa%2C%20ZServer%2C%20and%20VFS%27s&In-Reply-To=%3C20011010233847.A4458%40minkirri.apana.org.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="032992.html">
   <LINK REL="Next"  HREF="032993.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted, medusa, ZServer, and VFS's</H1>
    <B>Donovan Baarda</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%2C%20medusa%2C%20ZServer%2C%20and%20VFS%27s&In-Reply-To=%3C20011010233847.A4458%40minkirri.apana.org.au%3E"
       TITLE="[Twisted-Python] Twisted, medusa, ZServer, and VFS's">abo at minkirri.apana.org.au
       </A><BR>
    <I>Wed Oct 10 07:38:48 MDT 2001</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="032992.html">[Twisted-Python] Twisted, medusa, ZServer, and VFS's
</A></li>
        <LI>Next message (by thread): <A HREF="032993.html">[Twisted-Python] A modest proposal: Replace medusa with Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32994">[ date ]</a>
              <a href="thread.html#32994">[ thread ]</a>
              <a href="subject.html#32994">[ subject ]</a>
              <a href="author.html#32994">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Oct 10, 2001 at 03:56:38AM -0500, Glyph Lefkowitz wrote:
&gt;<i> I'm only responding to the twisted-python list, since the cross-post 
</I>&gt;<i> seemed excessive.  Feel free to rebroadcast this if ensuing discussion 
</I>&gt;<i> on other lists is interesting.
</I>
sticking to this convention... :-)

&gt;<i> On Wednesday, October 10, 2001, at 12:48  AM, Donovan Baarda wrote:
</I>[...]
&gt;<i> They seem to have a fairly different approach to how protocols are 
</I>&gt;<i> written and integrated, and in what their scope for future development 
</I>&gt;<i> is.
</I>
This I guess is part of what is putting me off Twisted. I'm familiar with
Medusa, and Twisted is just different enough that I've got a learning curve
ahead of me. Unless I get convinced Twisted is worth the extra effort...

&gt;<i> &gt; Twisted seems to be a from-the-ground up re-invention of Medusa.
</I>&gt;<i> 
</I>&gt;<i> As Moshe said, only insofar as it's a from-the-ground-up re-invention of 
</I>&gt;<i> about 6 or 7 other things.
</I>
Python async socket framework... it's filling the same void :-)

&gt;<i> &gt; It's newer, but surprisingly it's bigger, dispite it's apparently less 
</I>&gt;<i> &gt; mature feature set.
</I>&gt;<i> 
</I>&gt;<i> What do you mean when you say &quot;less mature&quot;?  Twisted's features have 
</I>&gt;<i> been around for less time (hence, &quot;newer&quot;) but compare, for example, 
</I>&gt;<i> twisted.spread.pb with rpc_server.  Or twisted.words with chat_server  
</I>&gt;<i> Would you characterize the medusa approach in any of these comparisons 
</I>&gt;<i> as &quot;more mature&quot;?
</I>&gt;<i> 
</I>&gt;<i> What is the Medusa equivalent of twisted.reality, twisted.mail, 
</I>&gt;<i> twisted.web.widgets, or twisted.enterprise?  These services are at 
</I>&gt;<i> varying levels of maturity, but surely the fact that they exist at all 
</I>&gt;<i> has to count for something :-).
</I>
That probably accounts for Twisted having more code. However, in my case I'm
just after http and ftp server capabilities. I have a feeling Medusa's ftp
code at least is more complete.

&gt;<i> &gt; It is similar in structure to Medusa,
</I>&gt;<i> 
</I>&gt;<i> At some extremely superficial level, I guess this is true.  However, 
</I>&gt;<i> Twisted does a lot more than just clone medusa.  Even at a basic level, 
</I>&gt;<i> you could say that it complicates the medusa structure a great deal with 
</I>&gt;<i> a unified notion of authentication, automatic persistence, and 
</I>&gt;<i> incidentally, several full-featured applications. :-)
</I>
I'm also a bit of a less-is-more person... I don't really need all of that.
However, if the framework is neat, and I get that without extra hassles and
bloat, I guess I'd use it.

&gt;<i> &gt; but simplifys it by dispensing with producers.
</I>&gt;<i> 
</I>&gt;<i> Twisted has producers, but only when you need them.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/users/glyph/TwistedDocs/Twisted-0.11.0/twisted/internet/">http://twistedmatrix.com/users/glyph/TwistedDocs/Twisted-0.11.0/twisted/internet/</A>
</I>&gt;<i> abstract_FileDescriptor.py.html#registerProducer
</I>
Hmmm... looking into this.

&gt;<i> &gt; It can use a variety of event-loops, including Tk and GTK, or it's own. 
</I>&gt;<i> &gt; It doesen't have a VFS (yet) so its ftp and http servers serve from the 
</I>&gt;<i> &gt; underlying os filesystem.
</I>&gt;<i> 
</I>&gt;<i> Well, it depends what you mean by VFS.  Twisted has a perception of the 
</I>&gt;<i> filesystem as more like a special-case of &quot;container&quot; than containers as 
</I>&gt;<i> a special-case of the filesystem.  There are containers which can 
</I>&gt;<i> respond to specifics of the HTTP protocol that are not derived from 
</I>&gt;<i> files; would you call that part of a &quot;VFS&quot;?  The semantics of 
</I>&gt;<i> &quot;__builtins__.open&quot; are not sufficiently rich to support that.
</I>
I was just looking at the ftp part, and it seems that it can only serve
files. If it can to more than this, I guess I'm more interested.

&gt;<i> &gt; In my search for Python VFS's I found PyVFS (<A HREF="http://www.pycage.de/">http://www.pycage.de/</A>). 
</I>&gt;<i> &gt; This is modelled on the Gnome/MC VFS, so it supports 
</I>&gt;<i> &gt; '/dir/somefile.tar.gz#tgz:/somepath' style paths to look inside tar, 
</I>&gt;<i> &gt; tgz, ftp, whatever. The various different VFS backends are loaded 
</I>&gt;<i> &gt; dynamicly as pluggins. These pluggins execute as a seperate process 
</I>&gt;<i> &gt; that are communicated with over a channel. The API is too simplistic 
</I>&gt;<i> &gt; for me, with files being &quot;projected&quot; out of the VFS to a local file to 
</I>&gt;<i> &gt; be manipulated/used. I don't like the pluggin-process-channel 
</I>&gt;<i> &gt; architecture either.
</I>&gt;<i> 
</I>&gt;<i> Why not?  It sounds clever to me.  I don't have a good picture of your 
</I>&gt;<i> requirements (other than &quot;HTTP and FTP&quot; at this point, so I can't fathom 
</I>&gt;<i> why you like or don't like this particular solution.  (Why is it 
</I>&gt;<i> relevant?)
</I>
It is overkill for what it is. Spawning whole extra processes and using
inter-process communication over a channel when just classes and/or
threads would do the job.

The biggest limitation was the API... I basicly want to serve up a virtual
mirror, which means I need to be able to identify and mirror things like
symlinks.

However, because it is quite simple, I was thinking of making a VFS backend
for my VFS that talks to PyVFS... more as a proof of concept, but also to
get tar.gz, cpio, mailbox, etc for free.

&gt;<i> &gt; In the reading of the Twisted mailing list, I saw a comment to the 
</I>&gt;<i> &gt; affect that
</I>&gt;<i> &gt; the Medusa VFS was an example of how _not_ to do it, which lead to 
</I>&gt;<i> &gt; using webDAV
</I>&gt;<i> &gt; as the API for a VFS. My gut feeling is DAV is a cool protocol for a VFS
</I>&gt;<i> &gt; backend, but I dunno about using it as the primary API. Sure, it 
</I>&gt;<i> &gt; supports meta-
</I>&gt;<i> &gt; data etc, but the reality is the API that is most widely used and 
</I>&gt;<i> &gt; understood is
</I>&gt;<i> &gt; the POSIX filesytem API, as exposed in Python by the os and os.path 
</I>&gt;<i> &gt; modules.
</I>&gt;<i> 
</I>&gt;<i> Yes, but that's a blocking API; ergo, it does not work in an 
</I>&gt;<i> asynchronous framework like Twisted.  Not all &quot;files&quot; are associated 
</I>
The Medusa VFS is a stripped down POSIX, and it actualy causes blocking
problems for my application. That's why I added ready() support to asynchat,
so that file producers can tell the select loop they would block and be
excluded from that time round the loop. This is basicly a hack... a probably
neater way is to make the file producers asychat's themselves but that would
require major restructuring of Medusa's ftp and http servers.

&gt;<i> with a file descriptor, so they may potentially support different 
</I>&gt;<i> operations.  Directory listing on FTP, HTTP, and WebDAV sites is not 
</I>&gt;<i> necessarily consistent with the files that are actually available.  
</I>&gt;<i> There is metadata associated with some requests, and not with others... 
</I>&gt;<i> in short, there are lots of subtle issues involved with supporting each 
</I>&gt;<i> of these types of hierarchies well, and a blanket virtual &quot;filesystem&quot; 
</I>&gt;<i> implementation does not satisfy all (or even a reasonably large subset) 
</I>&gt;<i> of them.  For different protocols, there may be API differences, unless 
</I>&gt;<i> some of the protocols are stripped to the &quot;lowest common denominator&quot;, 
</I>&gt;<i> e.g. POSIX.
</I>
That's why I'm going for POSIX :-)

&gt;<i> &gt; My solution for a VFS has been, upto now, based on Medusa's, but 
</I>&gt;<i> &gt; extending it
</I>&gt;<i> &gt; to be more like os and os.path. So far it's a filesystem class with 
</I>&gt;<i> &gt; most of the
</I>&gt;<i> &gt; os and os.path methods. One of the derived classes is a 
</I>&gt;<i> &gt; mountable_filesystem
</I>&gt;<i> &gt; that allows you to mount other VFS filesystems off it. At this point I'm
</I>&gt;<i> &gt; tempted to make a vfs module that emulates os and os.path so that you 
</I>&gt;<i> &gt; can mount
</I>&gt;<i> &gt; whatever vfs's you want first, and then just replace all your os.* 
</I>&gt;<i> &gt; calls with
</I>&gt;<i> &gt; vfs.* calls. Note that the one catch would be open() would need to be 
</I>&gt;<i> &gt; replaced
</I>&gt;<i> &gt; with vfs.open().
</I>&gt;<i> 
</I>&gt;<i> Not necessarily.  You could always hack up the __builtins__ module at 
</I>&gt;<i> runtime to point to your newer, better open().  Either way it seems like 
</I>&gt;<i> there are probably issues with security &amp; the presence of *real* file 
</I>&gt;<i> descriptors that you have to think about...
</I>
Thats why I'd keep it seperate inside a vfs module... remember at least one
vfs backend would be using the builtin open and os modules to access the
real fs. Though now you mention it... it could be away of transperantly
running any application on top of a VFS without changing it at all. Hmmm...
bound to be clashes... I wonder...

&gt;<i> &gt; I'm sort of fishing for general suggestions, comments, and interest. 
</I>&gt;<i> &gt; I'm at the
</I>&gt;<i> &gt; point where I've just convinced myself my vfs is worth finishing, and 
</I>&gt;<i> &gt; my ready
</I>&gt;<i> &gt; () patch to asynchat is worth updating, but I'm not sure what to use as 
</I>&gt;<i> &gt; the
</I>&gt;<i> &gt; http and ftp server front-end, though I'm still leaning towards medusa. 
</I>&gt;<i> &gt; It
</I>&gt;<i> &gt; looks like Twister is not ready, and ZServer would be too hard to 
</I>&gt;<i> &gt; seperate from
</I>&gt;<i> &gt; Zope.
</I>&gt;<i> 
</I>&gt;<i> Ready for what, is the question? :-)
</I>&gt;<i> 
</I>&gt;<i> Short form: HTTP yes, FTP no (but it could be with a little work), 
</I>&gt;<i> everything else yes.
</I>
FTP is the main one...though I'd really love rsync... roll on librsync :-)

&gt;<i> Long form:
</I>&gt;<i> 
</I>&gt;<i> We do not currently have (or have any high-priority plans to produce) a 
</I>&gt;<i> &quot;VFS&quot;, but I would contend that such a system is not necessary when you 
</I>&gt;<i> look at the way that Twisted does web resources.  FTP doesn't currently 
</I>&gt;<i> use that model, but I don't think it would be a difficult modification; 
</I>&gt;<i> it uses the same Producer model that HTTP does.  I estimate that it 
</I>&gt;<i> would be easier to modify Twisted in this way than to undertake a 
</I>&gt;<i> project to do your own VFS, but since I'm not exactly sure what's going 
</I>&gt;<i> to make you happy, I don't have a high degree of confidence in that 
</I>&gt;<i> estimation.
</I>
The application is basicly a mirror daemon that serves up a virtual mirror
of an ftp, rsync or http site. To the ftp and http clients, it appears to be
a full mirror. Files are fetched on demand and stored in a partial mirror on
the server.

My plan was to use a VFS to 'mount' the remote ftp, rsync, or http site. The
partial mirror on the server would also be accessed through the same VFS
interface. Then I was going to overlay a &quot;mirrorfs&quot; VFS over them both, that
would mirror the remote VFS to the local one on demand. The http/ftp server
part would then just serve files from the mirrorfs VFS.

The beauty of this is the different VFS backends would allow you to do wierd
things like on-demand mirror a remote ftp server into a local tar.gz file,
not that you'd want to :-)

-- 
----------------------------------------------------------------------
ABO: finger <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">abo at minkirri.apana.org.au</A> for more info, including pgp key
----------------------------------------------------------------------



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="032992.html">[Twisted-Python] Twisted, medusa, ZServer, and VFS's
</A></li>
	<LI>Next message (by thread): <A HREF="032993.html">[Twisted-Python] A modest proposal: Replace medusa with Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32994">[ date ]</a>
              <a href="thread.html#32994">[ thread ]</a>
              <a href="subject.html#32994">[ subject ]</a>
              <a href="author.html#32994">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
