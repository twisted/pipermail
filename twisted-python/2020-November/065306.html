<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] More Conch Questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20More%20Conch%20Questions&In-Reply-To=%3CCAAXGW-wdwFLNKkCvFUbvGL-G57OB_-j9HK5_%2Br2Ua8YkP4AZwg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065304.html">
   <LINK REL="Next"  HREF="065311.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] More Conch Questions</H1>
    <B>Robert DiFalco</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20More%20Conch%20Questions&In-Reply-To=%3CCAAXGW-wdwFLNKkCvFUbvGL-G57OB_-j9HK5_%2Br2Ua8YkP4AZwg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] More Conch Questions">robert.difalco at gmail.com
       </A><BR>
    <I>Sun Nov 29 10:41:26 MST 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065304.html">[Twisted-Python] revert / rework of &quot;AMPv2&quot; change?
</A></li>
        <LI>Next message (by thread): <A HREF="065311.html">[Twisted-Python] More Conch Questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65306">[ date ]</a>
              <a href="thread.html#65306">[ thread ]</a>
              <a href="subject.html#65306">[ subject ]</a>
              <a href="author.html#65306">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm continuing to wrestle with conch, this time around authentication and
notifying deferred of auth failure.

It seems like the SSH factory has a deferred to be notified of auth
failures here:
<A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L61-L66">https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L61-L66</A>

Unfortunately, this deferred is cleared because prior to auth, it
receives this on successful connect:
<A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L83-L88">https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L83-L88</A>

As you can see this clears the deferred so it is no longer available to get
an errback. This also prevents the SSHClientTransport from getting a
sendDisconnect.

To try it change the user to something invalid here:
<A HREF="https://gist.github.com/radifalco/5a5cca4bf8d49d5c61113e36f9be7553#file-sftp-py-L328">https://gist.github.com/radifalco/5a5cca4bf8d49d5c61113e36f9be7553#file-sftp-py-L328</A>

This will never get a callback to errback.

I guess I would have expected this to get the error but it actually
succeeds with None. As a result there is no deferred to get the auth
failure and my app waits forever for a notification.

There is one ting I *think* I know how to do, add a timeout with a callback
later on the sftpClient deferred. But that seems lame. What I'd like to do
is to get this ConchError as it has the actual reason for the connection
failure.  Thoughts?

<A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L61-L66">https://github.com/twisted/twisted/blob/trunk/src/twisted/conch/client/direct.py#L61-L66</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20201129/549aa4ee/attachment-0001.htm&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065304.html">[Twisted-Python] revert / rework of &quot;AMPv2&quot; change?
</A></li>
	<LI>Next message (by thread): <A HREF="065311.html">[Twisted-Python] More Conch Questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65306">[ date ]</a>
              <a href="thread.html#65306">[ thread ]</a>
              <a href="subject.html#65306">[ subject ]</a>
              <a href="author.html#65306">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
