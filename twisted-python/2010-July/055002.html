<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Newbie: using cred  strcred.AuthOptionMixin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Newbie%3A%20using%20cred%20%20strcred.AuthOptionMixin&In-Reply-To=%3C000a01cb1cfe%24be1cf1f0%243a56d5d0%24%40schneider%40de-bleek.demon.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054996.html">
   <LINK REL="Next"  HREF="055003.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Newbie: using cred  strcred.AuthOptionMixin</H1>
    <B>Schneider</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Newbie%3A%20using%20cred%20%20strcred.AuthOptionMixin&In-Reply-To=%3C000a01cb1cfe%24be1cf1f0%243a56d5d0%24%40schneider%40de-bleek.demon.nl%3E"
       TITLE="[Twisted-Python] Newbie: using cred  strcred.AuthOptionMixin">f.schneider at de-bleek.demon.nl
       </A><BR>
    <I>Tue Jul  6 05:31:13 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054996.html">[Twisted-Python] relative priority of deprecation tickets
</A></li>
        <LI>Next message (by thread): <A HREF="055003.html">[Twisted-Python] Newbie: using cred  strcred.AuthOptionMixin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55002">[ date ]</a>
              <a href="thread.html#55002">[ thread ]</a>
              <a href="subject.html#55002">[ subject ]</a>
              <a href="author.html#55002">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I need a perspective broker with authentification and followed the Twisted
documentation on
<A HREF="http://twistedmatrix.com/documents/current/core/howto/tap.html#auto4">http://twistedmatrix.com/documents/current/core/howto/tap.html#auto4</A> to get
the twistd plugin to work. Now I want to make it work with the /etc/shadow,
but don't know how to get it to work.  

The plugin looks like:
-----------------------------------------------------------------------
from zope.interface import implements
from twisted.python import usage
from twisted.plugin import IPlugin
from twisted.application.service import IServiceMaker from
twisted.application import internet from twisted.cred import credentials,
portal, strcred from twisted.spread import pb

from qxmt.QXMTServer import QXMTUser

class Options(usage.Options, strcred.AuthOptionMixin):
    # This part is optional; it tells AuthOptionMixin what
    # kinds of credential interfaces the user can give us.
    supportedInterfaces = (credentials.IUsernamePassword,)

    optParameters = [[&quot;port&quot;, &quot;p&quot;, 8789, &quot;Server port number&quot;]]


class QXMTRealm:
    implements(portal.IRealm)
    def requestAvatar(self, avatarId, mind, *interfaces):
        if pb.IPerspective not in interfaces:
            raise NotImplementedError
        return pb.IPerspective, QXMTUser(avatarId), lambda: None

class QXMTServiceMaker(object):
    implements(IServiceMaker, IPlugin)
    tapname = &quot;qxmt&quot;
    description = &quot;The QXtend remote error processing tool.&quot;
    options = Options

    def makeService(self, options):
        &quot;&quot;&quot;
        Construct a TCPServer from a factory defined in qxmt.
        &quot;&quot;&quot;
        p = portal.Portal(QXMTRealm(), options[&quot;credCheckers&quot;])
        #c = checkers.InMemoryUsernamePasswordDatabaseDontUse(user1=&quot;pass1&quot;,
        #p.registerChecker(c)
        return internet.TCPServer(int(options['port']),
                                  pb.PBServerFactory(p))

serviceMaker = QXMTServiceMaker()
-----------------------------------------------------------------------

Running twistd qxmt --help-auth gives

Usage: --auth AuthType[:ArgString]
For detailed help: --help-auth-type AuthType

  AuthType      ArgString format
  ========      ================
  memory        A colon-separated list (name:password:...)
  file          Location of a FilePasswordDB-formatted file.
  unix          No argstring required.

And twistd qxmt --help-auth-type unix gives

Usage: --auth unix[:ArgString]
ArgString format: No argstring required.

  This checker will attempt to use every resource available to
  authenticate against the list of users on the local UNIX system.
  (This does not support Windows servers for very obvious reasons.)

  Right now, this includes support for:

    * Python's pwd module (which checks /etc/passwd)
    * Python's spwd module (which checks /etc/shadow)

  Future versions may include support for PAM authentication. 

So, I guess the server now should be able to use the system's shadow
passwords for authentification.

As a client I used with the InMemoryUsernamePasswordDatabaseDontUse checker
the following code.

-----------------------------------------------------------------------
#!/usr/bin/env python

# Copyright (c) 2009 Twisted Matrix Laboratories.
# See LICENSE for details.

from twisted.spread import pb
from twisted.internet import reactor
from twisted.cred import credentials

def main():
    factory = pb.PBClientFactory()
    reactor.connectTCP(&quot;localhost&quot;, 8789, factory)
    def1 = factory.login(credentials.UsernamePassword(&quot;user1&quot;, &quot;pass1&quot;))
    def1.addCallback(connected)
    reactor.run()

def connected(perspective):
    print &quot;got perspective1 ref:&quot;, perspective
    print &quot;asking it to foo(13)&quot;
    perspective.callRemote(&quot;foo&quot;, 13)

main()
-----------------------------------------------------------------------

How to rewrite the client to make it work with --auth=unix ?

Thanks,

Frans






</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054996.html">[Twisted-Python] relative priority of deprecation tickets
</A></li>
	<LI>Next message (by thread): <A HREF="055003.html">[Twisted-Python] Newbie: using cred  strcred.AuthOptionMixin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55002">[ date ]</a>
              <a href="thread.html#55002">[ thread ]</a>
              <a href="subject.html#55002">[ subject ]</a>
              <a href="author.html#55002">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
