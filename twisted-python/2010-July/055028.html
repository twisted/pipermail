<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Uploading multiple files using ftpclient in	Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Uploading%20multiple%20files%20using%20ftpclient%20in%0A%09Twisted&In-Reply-To=%3CAANLkTilOG41W6-7kRmDLNo_xTFeAqsbGm4jzaYlgLTAU%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055027.html">
   <LINK REL="Next"  HREF="055036.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Uploading multiple files using ftpclient in	Twisted</H1>
    <B>Jaepyoung Kim</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Uploading%20multiple%20files%20using%20ftpclient%20in%0A%09Twisted&In-Reply-To=%3CAANLkTilOG41W6-7kRmDLNo_xTFeAqsbGm4jzaYlgLTAU%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Uploading multiple files using ftpclient in	Twisted">jaepyoung.kim at gmail.com
       </A><BR>
    <I>Sat Jul 10 18:26:19 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055027.html">[Twisted-Python] Uploading multiple files using ftpclient in	Twisted
</A></li>
        <LI>Next message (by thread): <A HREF="055036.html">[Twisted-Python] msn file transfer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55028">[ date ]</a>
              <a href="thread.html#55028">[ thread ]</a>
              <a href="subject.html#55028">[ subject ]</a>
              <a href="author.html#55028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

Great thanks for your perfect answer.

I think Disk IO will not be a bottleneck.
There are four servers which share disks.
I executed the scrpit in seperate servers and this reduced the upload
speed a lot.
After I saw this performance improvement, I started changing script.

I will try your suggestion..

Thanks,
Jaepyoung


On Sat, Jul 10, 2010 at 3:56 PM, David Bolen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">db3l.net at gmail.com</A>&gt; wrote:
&gt;<i> Jaepyoung Kim &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jaepyoung.kim at gmail.com</A>&gt; writes:
</I>&gt;<i>
</I>&gt;&gt;<i> The current script is uploading using ftplib and it takes time about 1 hour.
</I>&gt;&gt;<i> I want to change this script to use twisted asynchronous function.
</I>&gt;&gt;<i> I thought if I use asynchronous function in twisted like following,
</I>&gt;&gt;<i> then file uploading will be executed in parallel.
</I>&gt;&gt;<i> But this was executed sequentially. Uploading second file starts afer
</I>&gt;&gt;<i> completing first file upload.
</I>&gt;&gt;<i> Could you check what was wrong in my source code? Or Am I wrong in
</I>&gt;&gt;<i> understanding asynchronous function?
</I>&gt;<i>
</I>&gt;<i> I'm pretty sure you'll need separate connections to an FTP server to
</I>&gt;<i> achieve parallel transfers, regardless of how you write the client.
</I>&gt;<i> At least as long as you stick with regular get/put commands.  So while
</I>&gt;<i> using a twisted approach can enable you to manage those parallel
</I>&gt;<i> streams pretty easily, you'll need distinct connections for each
</I>&gt;<i> transfer and manage which file transfer is using which connection in
</I>&gt;<i> your code.
</I>&gt;<i>
</I>&gt;<i> Essentially a store or fetch FTP operation initiates a transfer over
</I>&gt;<i> the dedicated data channel, so that channel is in use until the
</I>&gt;<i> transfer completes or is aborted.  The data on the data channel is not
</I>&gt;<i> encapsulated nor multiplexed in any way so you can only have a single
</I>&gt;<i> transfer using the data channel at once.  Passive transfers do create
</I>&gt;<i> new data channels, but the FTP protocol specifically says a server
</I>&gt;<i> needs to stop accepting connections and shut down any open connections
</I>&gt;<i> on old passive ports once a new passive request is received, so you're
</I>&gt;<i> still limited to one at a time.
</I>&gt;<i>
</I>&gt;<i> Thus, your callbacks for each store operation, will only file when the
</I>&gt;<i> store has completed, and you'll only be able to initiate the next
</I>&gt;<i> store request at that point since its only then that the channel to
</I>&gt;<i> the server is free to transfer another file.
</I>&gt;<i>
</I>&gt;<i> I believe some servers have implemented custom extensions to implement
</I>&gt;<i> parallel operations at a finer grained level than a file, but I don't
</I>&gt;<i> think they're commonly implemented in ftp libraries (nor in servers
</I>&gt;<i> commonly in use).
</I>&gt;<i>
</I>&gt;<i> What I'd suggest, in terms of your code, is to instantiate a pool of
</I>&gt;<i> FTPClients to the same server, initiate transfers on them in parallel
</I>&gt;<i> and then as one completes, use it to pick up the next file.  You'll
</I>&gt;<i> need to handle the distribution of files amongst the pool of clients
</I>&gt;<i> yourself.
</I>&gt;<i>
</I>&gt;<i> Is there any particular reason you expect this to yield an improvement
</I>&gt;<i> in overall time?  Unless you're transferring very large numbers of
</I>&gt;<i> files that are very small compared to the bandwidth*latency of your
</I>&gt;<i> network connection to the server (which doesn't sound like the case
</I>&gt;<i> here), the overhead of the protocol itself will be quite small, and
</I>&gt;<i> your bottleneck is either going to be the network throughput, or the
</I>&gt;<i> slower of the disk I/O on either end.
</I>&gt;<i>
</I>&gt;<i> Neither of those bottlenecks will likely be improved by doing multiple
</I>&gt;<i> transfers in parallel, and in fact your total time can worsen if the
</I>&gt;<i> prior bottleneck was the disk I/O since you'll have competing
</I>&gt;<i> operations for the disks as opposed to simple sequential access.  Or
</I>&gt;<i> you may find that you get very marginal benefit with the expense of
</I>&gt;<i> much more complicated to maintain code.
</I>&gt;<i>
</I>&gt;<i> You might grab an existing ftp client that supports parallel transfers
</I>&gt;<i> and use it to run some tests before trying to re-implement things
</I>&gt;<i> yourself.  There should be several options, but for example, I believe
</I>&gt;<i> FileZilla supports it under Windows, or lftp under Linux.
</I>&gt;<i>
</I>&gt;<i> -- David
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


-- 
Jaepyoung Kim
(Cellular phone) 1-310-848-7774


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055027.html">[Twisted-Python] Uploading multiple files using ftpclient in	Twisted
</A></li>
	<LI>Next message (by thread): <A HREF="055036.html">[Twisted-Python] msn file transfer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55028">[ date ]</a>
              <a href="thread.html#55028">[ thread ]</a>
              <a href="subject.html#55028">[ subject ]</a>
              <a href="author.html#55028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
