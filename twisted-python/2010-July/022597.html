<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] loading intermediate CA certs from a chain file
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20loading%20intermediate%20CA%20certs%20from%20a%20chain%20file&In-Reply-To=AANLkTimPYmj3sB41GX4-YgKI5Bm4hWsY1GztY3NM2eei%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022596.html">
   <LINK REL="Next"  HREF="022598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] loading intermediate CA certs from a chain file</H1>
    <B>Sury Soni</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20loading%20intermediate%20CA%20certs%20from%20a%20chain%20file&In-Reply-To=AANLkTimPYmj3sB41GX4-YgKI5Bm4hWsY1GztY3NM2eei%40mail.gmail.com"
       TITLE="[Twisted-Python] loading intermediate CA certs from a chain file">ssoni at nextdigital.com
       </A><BR>
    <I>Tue Jul 20 22:26:37 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="022596.html">[Twisted-Python] loading intermediate CA certs from a chain file
</A></li>
        <LI>Next message: <A HREF="022598.html">[Twisted-Python] Client/Server upload problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22597">[ date ]</a>
              <a href="thread.html#22597">[ thread ]</a>
              <a href="subject.html#22597">[ subject ]</a>
              <a href="author.html#22597">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was able to solve this problem by writing following class. Thank you JP for pointing me to use_certificate_chain_file function.

class ChainedOpenSSLContextFactory(DefaultOpenSSLContextFactory):
    def __init__(self, privateKeyFileName, certificateChainFileName,
                 sslmethod=SSL.SSLv23_METHOD):
        &quot;&quot;&quot;
        @param privateKeyFileName: Name of a file containing a private key
        @param certificateChainFileName: Name of a file containing a certificate chain
        @param sslmethod: The SSL method to use
        &quot;&quot;&quot;
        self.privateKeyFileName = privateKeyFileName
        self.certificateChainFileName = certificateChainFileName
        self.sslmethod = sslmethod
        self.cacheContext()
    
    def cacheContext(self):
        ctx = SSL.Context(self.sslmethod)
        ctx.use_certificate_chain_file(self.certificateChainFileName)
        ctx.use_privatekey_file(self.privateKeyFileName)
        self._context = ctx

And I used it in place of DefaultOpenSSLContextFactory like this:

ssl_service = internet.SSLServer(443, site_ssl, 
            ChainedOpenSSLContextFactory(
                privateKeyFileName=&quot;cert/server.key&quot;,
                certificateChainFileName=&quot;cert/chain.pem&quot;, 
                sslmethod = SSL.SSLv3_METHOD))

Where chain.pem was cat'ing version of my certificate + CA certificate + ROOT certificate. Thank you Konards for suggesting me this cat'ing thing.

If anyone still have problem in this area, they will have to track correct chain of certificates. I myself got stuck in choosing correct CA certificate, since Thawte have many different CA certificate for different purpose. Eventually, I was fine with choosing the right one.

Cheers.

-Sury

---------------------
what i recommend is to add all chain in one file using openssl kit (maybe just cat'ing works). However, most certs issued nowadays contain the chain already in. You can check with openssl x509 -in cert.pem -text and see the attached signers cerificate in base64, copy that to a new.pem and repeat. You can walk this way up the chain to root cert. If you can, the chaining is not your problem.
Try playing with openssl toolkit alone and see what it says about cert and key.

2010/7/20, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt;:
&gt;<i> On 07:13 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ssoni at nextdigital.com</A> wrote:
</I>&gt;&gt;<i>Hi There,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Does Twisted support or is there any way of loading intermediate CA 
</I>&gt;&gt;<i>certs from a chain file?
</I>&gt;<i>
</I>&gt;<i> Twisted uses pyOpenSSL for it's SSL support.  So you can do pretty 
</I>&gt;<i> much anything pyOpenSSL allows.  <A HREF="http://packages.python.org/pyOpenSSL">http://packages.python.org/pyOpenSSL</A>
</I>&gt;<i> /openssl-context.html documents the Context interface; in particular 
</I>&gt;<i> the use_certificate_chain_file might be interesting.  However, I 
</I>&gt;<i> recently had a conversation with someone who was using this method and 
</I>&gt;<i> still couldn't get their chain certificate to work reliably.  I think 
</I>&gt;<i> he's still trying to track down the issue.
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>

--
Konrads Smelkovs
Applied IT sorcery.

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022596.html">[Twisted-Python] loading intermediate CA certs from a chain file
</A></li>
	<LI>Next message: <A HREF="022598.html">[Twisted-Python] Client/Server upload problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22597">[ date ]</a>
              <a href="thread.html#22597">[ thread ]</a>
              <a href="subject.html#22597">[ subject ]</a>
              <a href="author.html#22597">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
