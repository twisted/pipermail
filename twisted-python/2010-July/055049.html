<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] What is the minimum effort solution to	make	inetd-managed twisted-based application?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20What%20is%20the%20minimum%20effort%20solution%20to%0A%09make%09inetd-managed%20twisted-based%20application%3F&In-Reply-To=%3C20100713143708.2105.59269190.divmod.xquotient.26%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="055048.html">
   <LINK REL="Next"  HREF="055050.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] What is the minimum effort solution to	make	inetd-managed twisted-based application?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20What%20is%20the%20minimum%20effort%20solution%20to%0A%09make%09inetd-managed%20twisted-based%20application%3F&In-Reply-To=%3C20100713143708.2105.59269190.divmod.xquotient.26%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] What is the minimum effort solution to	make	inetd-managed twisted-based application?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Jul 13 08:37:08 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="055048.html">[Twisted-Python] What is the minimum effort solution to make	inetd-managed	twisted-based application?
</A></li>
        <LI>Next message (by thread): <A HREF="055050.html">[Twisted-Python] What is the minimum effort solution to	make	inetd-managed twisted-based application?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55049">[ date ]</a>
              <a href="thread.html#55049">[ thread ]</a>
              <a href="subject.html#55049">[ subject ]</a>
              <a href="author.html#55049">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12:57 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-web at udmvt.ru</A> wrote:
&gt;<i>What is the minimal effort method for building protocol instance (maybe 
</I>&gt;<i>out of
</I>&gt;<i>already implemented protocol factory) using a transport, that uses
</I>&gt;<i>parent-inherited sockets (or any other already connected sockets) ?
</I>&gt;<i>I haven't yet found any single-line solution for that.
</I>
This isn't supported, but we'd like to support it.  There's a ticket in 
the issue tracker, &lt;<A HREF="http://twistedmatrix.com/trac/ticket/4387">http://twistedmatrix.com/trac/ticket/4387</A>&gt;, related 
to this (but with a somewhat wider scope).
&gt;<i>For example, how to start an inetd-managed SMTP server (with STARTTLS 
</I>&gt;<i>support),
</I>&gt;<i>suppose, we have protocol (and factory) already implemented, but
</I>&gt;<i>how to construct the correct transport out of fd with the minimal 
</I>&gt;<i>effort?
</I>&gt;<i>
</I>&gt;<i>Or how to implement ucspi-tcp's tcpclient client on top of twisted 
</I>&gt;<i>framework?
</I>&gt;<i>
</I>&gt;<i>Right now I am looking at t.i.unix.Connector and t.i.unix.Port to 
</I>&gt;<i>understand
</I>&gt;<i>how do transports get constructed by them, but well, that is too 
</I>&gt;<i>complex for a single evening.
</I>&gt;<i>Should I really get into the details of implementing my own transport 
</I>&gt;<i>(or their constructors)
</I>&gt;<i>to do what I need? I'm sure there should be something, that I missed in 
</I>&gt;<i>the documentation
</I>&gt;<i>(or in the code?).
</I>
Despite not appearing to be private, things like t.i.unix.Connector and 
t.i.unix.Port aren't really intended for use by applications.

This is the right part of Twisted to be looking at if you want to 
contribute a patch which adds this feature, though.  And I encourage you 
to do that. :)

The implementation should be fairly straight-forward.  Most things like 
Port and Client and Server have a &quot;createInternetSocket&quot; method.  All 
that's really necessary to use an externally created file descriptor is 
get &quot;createInternetSocket&quot; to return that descriptor instead of creating 
a new one (or skip the call to the method entirely and just use the 
descriptor you have already).

The biggest question I have is what the API should look like.  Somehow 
the file descriptor needs to get from your application code (which knows 
that inetd put an open TCP connection on fd 0) to the 
Port/Client/Server.

The obvious options, adding another argument to 
listen/connectTCP/UNIX/etc, would work, but is somewhat ugly (you have 
the issue that existing mandatory arguments would just be ignored).

Another idea would be adding new methods entirely.  I don't know if 
that's much better, though.

So, if we can come up with a nice API, I think this will be a pretty 
quick feature to implement.
&gt;<i>And by the way, I haven't found any socketpair(2) usage in the twisted 
</I>&gt;<i>framework (except for tests),
</I>&gt;<i>how can that be? Transport based on socketpair sockets will have the 
</I>&gt;<i>same
</I>&gt;<i>implementation, as I need. Is it true, that nobody in twisted community 
</I>&gt;<i>uses
</I>&gt;<i>anonymous preconnected sockets in real life?
</I>
Apparently. :)
&gt;<i>
</I>&gt;<i>PS: I need socket-based transport, that is, full-duplex, half- 
</I>&gt;<i>closeable, with support
</I>&gt;<i>of getting the remote endpoint address and with ability to start TLS on 
</I>&gt;<i>top of it
</I>&gt;<i>and without implementing every that feature myself :)
</I>
Hopefully if we can figure out how to create a Twisted transport object 
from an existing file descriptor, you should have no trouble with the 
rest of these.
&gt;<i>Thanks for a great framework!
</I>
You're welcome, and thanks! :)

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="055048.html">[Twisted-Python] What is the minimum effort solution to make	inetd-managed	twisted-based application?
</A></li>
	<LI>Next message (by thread): <A HREF="055050.html">[Twisted-Python] What is the minimum effort solution to	make	inetd-managed twisted-based application?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55049">[ date ]</a>
              <a href="thread.html#55049">[ thread ]</a>
              <a href="subject.html#55049">[ subject ]</a>
              <a href="author.html#55049">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
