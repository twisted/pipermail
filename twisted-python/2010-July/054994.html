<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Implementing OAuth in twisted.cred
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Implementing%20OAuth%20in%20twisted.cred&In-Reply-To=%3C50B8BDD6-01E6-44D5-BFDA-4DB4442D0732%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="054979.html">
   <LINK REL="Next"  HREF="054977.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Implementing OAuth in twisted.cred</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Implementing%20OAuth%20in%20twisted.cred&In-Reply-To=%3C50B8BDD6-01E6-44D5-BFDA-4DB4442D0732%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Implementing OAuth in twisted.cred">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Jul  5 11:48:01 MDT 2010</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="054979.html">[Twisted-Python] Implementing OAuth in twisted.cred
</A></li>
        <LI>Next message (by thread): <A HREF="054977.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54994">[ date ]</a>
              <a href="thread.html#54994">[ thread ]</a>
              <a href="subject.html#54994">[ subject ]</a>
              <a href="author.html#54994">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jul 3, 2010, at 3:19 PM, Laurens Van Houtven wrote:

&gt;<i> A number of people have tried to implement it in Twisted. AFAICT most
</I>&gt;<i> of them just use oauth.py. That uses urllib. Basically I guess it just
</I>&gt;<i> crosses its fingers and hopes that the OAuth API endpoints will always
</I>&gt;<i> be reachable and responsive. (I have been told this is completely
</I>&gt;<i> unrealistic.)
</I>
It always is.

&gt;<i> Thankfully, the OAuth spec is asynchronous in nature. I'm trying to
</I>&gt;<i> implement OAuth using twisted (specifically twisted.cred and
</I>&gt;<i> twisted.web) to promote code re-use.
</I>
Great!

&gt;<i> In order to do the authentication OAuth relies on redirection (in most
</I>&gt;<i> use cases, this is HTTP redirection), which would be protocol
</I>&gt;<i> specific. I'm not sure how twisted.cred fits into this since it
</I>&gt;<i> appears to expect everything beyond the portal to be
</I>&gt;<i> protocol-agnostic.
</I>
Not at all.

Checkers are as protocol-specific as necessary.  That's why they have a credentialInterfaces attribute, to indicate what type of credentials they may be used with.

Now, many *application* protocols do share obvious checker behavior such as &quot;does this password match&quot;, and it would be a shame to re-implement that logic, but that's not to say that *authentication* protocols shouldn't have their own, more specific interfaces.  Especially if you could see some way to abstractly re-implement, let's say, SMTP authentication to rely on OAuth.

As someone else already noted in a reply, the main thing is that this stuff returns a Deferred, so HTTP redirection could be neatly handled there.

&gt;<i> I'm not sure what the credentials would be.
</I>
I'm not going to read 40 pages of RFC just to answer this one email :) but the credentials object should be something that contains enough information for the checker to do its work.

What the checker needs to be able to do is to map the credentials into a locally useful &quot;avatar ID&quot;.  This is probably just an URI which identifies the authenticated principal (which presumably the IRealm could use to map into a local database row).

Of course it would be *good* if you could boil down OAuth credentials to something simple that could be re-used by other protocols, or better yet some existing interface.  Then you could use an existing checker, or perhaps even provide a strcred plugin.  But, that seems unlikely, given that its domain model for authentication is a bit broader than the usual username/password check.

&gt;<i> If I understand correctly the avatar would be the thing that has the
</I>&gt;<i> token credentials (for those who haven't read the OAuth spec, &quot;token
</I>&gt;<i> credentials&quot; are an OAuth thing, and not necessarily the credentials
</I>&gt;<i> in the twisted.cred sense); it represents a single authenticated
</I>&gt;<i> transaction (which might consist of many authenticated requests). This
</I>&gt;<i> takes care of steps 6 7 and 8 in
</I>&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/core/img/cred-login.png.">http://twistedmatrix.com/documents/current/core/img/cred-login.png.</A>
</I>
The avatar is made entirely of application logic.  It shouldn't have any authentication stuff stuck to it at all.  (Although maybe that's not what &quot;token credentials&quot; means...)  Please note that it must be an implementation of an _existing_ protocol interface, as that's the whole point of cred's abstraction: to allow existing application logic to be re-used independent of authentication or authorization mechanism.  If this is an authentication mechanism for an HTTP protocol, the avatar is an IResource provider.  HTTP already has a defined avatar interface within Twisted, and that's it; so if you want to use any existing code that talks to cred, you have to use it.

If the avatar needs to be passed more information in order to operate correctly, then you can pass that information as part of the avatar ID somehow, and have the realm implementation break it down into the necessary parts to pass on.  This is, admittedly, a crufty corner of cred, but that's the best option available right now.  Hopefully OAuth doesn't require this :).

&gt;<i> The strange bits start in the CredentialsChecker, since credentials
</I>&gt;<i> are checked by someone else entirely.
</I>
A credentials checker doesn't need to actually check the credentials itself; it's just the logic that knows who to delegate to and what information to give them.

&gt;<i> I really don't understand the Mind, but it sounds like something that
</I>&gt;<i> might be required in the context of a three-actor auth system like
</I>&gt;<i> OAuth.
</I>
The Mind is for connection-oriented protocols to provide a callback mechanism to the originating side of the connection.  For example, if I'm logging in to an IRC server, the 'mind' would be a wrapper around the client connection that would allow the avatar to be associated with a TCP socket it could send IRC messages to.  I don't think it applies in this case.

&gt;<i> I would be really grateful if someone who actually understood
</I>&gt;<i> twisted.cred (and hopefully also OAuth) could shed some light on this.
</I>
I hope this has been more useful than confusing.  Let me know if you have more questions.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20100705/081cdf28/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="054979.html">[Twisted-Python] Implementing OAuth in twisted.cred
</A></li>
	<LI>Next message (by thread): <A HREF="054977.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54994">[ date ]</a>
              <a href="thread.html#54994">[ thread ]</a>
              <a href="subject.html#54994">[ subject ]</a>
              <a href="author.html#54994">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
