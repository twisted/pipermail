<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Use twisted.python.logfile.LogFile wirte log，Memory can not be released, does anybody familiar with or encounter such a situation?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%3D%3Futf-8%3Fq%3FUse_twisted%3D2Epython%3D2Elogfile%3D2ELogF%3F%3D%0A%09%3D%3Futf-8%3Fq%3File_wirte_log%3DEF%3DBC%3D8CMemory_can_not_be_released%3D2C_does%3F%3D%0A%09%3D%3Futf-8%3Fq%3F_anybody_familiar_with_or_encounter_such_a_situation%3D3F%3F%3D&In-Reply-To=%3Cc9bd7f5f0809150431s2d31b1ayd00c1cf3ba36bab0%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050892.html">
   <LINK REL="Next"  HREF="050888.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Use twisted.python.logfile.LogFile wirte log，Memory can not be released, does anybody familiar with or encounter such a situation?</H1>
    <B>echo</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20%3D%3Futf-8%3Fq%3FUse_twisted%3D2Epython%3D2Elogfile%3D2ELogF%3F%3D%0A%09%3D%3Futf-8%3Fq%3File_wirte_log%3DEF%3DBC%3D8CMemory_can_not_be_released%3D2C_does%3F%3D%0A%09%3D%3Futf-8%3Fq%3F_anybody_familiar_with_or_encounter_such_a_situation%3D3F%3F%3D&In-Reply-To=%3Cc9bd7f5f0809150431s2d31b1ayd00c1cf3ba36bab0%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Use twisted.python.logfile.LogFile wirte log，Memory can not be released, does anybody familiar with or encounter such a situation?">dotecho at gmail.com
       </A><BR>
    <I>Mon Sep 15 05:31:59 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050892.html">[Twisted-Python] twisted.web.client POST data
</A></li>
        <LI>Next message (by thread): <A HREF="050888.html">Re: [Twisted-Python] Use twisted.python.logfile.LogFile wirte log，Memory can not be released, does anybody familiar with or encounter such a situation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50885">[ date ]</a>
              <a href="thread.html#50885">[ thread ]</a>
              <a href="subject.html#50885">[ subject ]</a>
              <a href="author.html#50885">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Use twisted.python.logfile.LogFile wirte log，Memory can not be released,
does anybody familiar with or encounter such a situation?

Environment: FREEBSD 6.3 RELEASE
twisted svn trunk today


Description of the problem
Use &quot;TOP&quot; command observe the used memory, memory first use the BUF, if
buf&gt;111M, then don't use buf
and use WIRED, Wired to around 132 M， and then use Inact
If during the service  manually delete the generated file. Memory will be
released.
twisted.python.logfile.LogFile default  log file will be closed at 1 M size,
and re-open a file, how the file is closed， but the memory still not
released？

sorry for my poor english.. thank you


**test code：

#!/usr/local/bin/python
import datetime
import os
from twisted.python import logfile

class LogFile2(logfile.LogFile):
    '''
    '''
    def rotate(self):
        &quot;&quot;&quot;
        Rotate the file and create a new one.

        If it's not possible to open new logfile, this will fail silently,
        and continue logging to old logfile.
        &quot;&quot;&quot;
        if not (os.access(self.directory, os.W_OK) and os.access(self.path,
os.W_OK)):
            return
        logs = self.listLogs()
        logs.reverse()
        for i in logs:
            if self.maxRotatedFiles is not None and i &gt;=
self.maxRotatedFiles:
                os.remove(&quot;%s.%d&quot; % (self.path, i))
            else:
                os.rename(&quot;%s.%d&quot; % (self.path, i), &quot;%s.%d&quot; % (self.path, i
+ 1))

        self._file.close()
        print self._file, 'closed'
        os.rename(self.path, &quot;%s.1&quot; % self.path)
        self._openFile()


i=10000000
log = LogFile2('test_logfile.log', '/home/echo/tmp/test/')

while i:
    msg = '%s: test_test_test_test\r\n' % str(i)
    log.write(msg)
    i=i-1


log.close()

**result。

&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'r+' at 0x827ccc8&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827ccc8&gt;
closeed
&lt;closed file '/home/echo/tmp/test/test_logfile.log', mode 'w+' at 0x827c458&gt;
closeed
.......
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20080915/0b6cfde1/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050892.html">[Twisted-Python] twisted.web.client POST data
</A></li>
	<LI>Next message (by thread): <A HREF="050888.html">Re: [Twisted-Python] Use twisted.python.logfile.LogFile wirte log，Memory can not be released, does anybody familiar with or encounter such a situation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50885">[ date ]</a>
              <a href="thread.html#50885">[ thread ]</a>
              <a href="subject.html#50885">[ subject ]</a>
              <a href="author.html#50885">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
