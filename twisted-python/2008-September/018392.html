<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Looping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Looping&In-Reply-To=24dc0be10809192128l57802301q599aeeb016f2d916%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018390.html">
   <LINK REL="Next"  HREF="018391.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Looping</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Looping&In-Reply-To=24dc0be10809192128l57802301q599aeeb016f2d916%40mail.gmail.com"
       TITLE="[Twisted-Python] Looping">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Sat Sep 20 06:37:46 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018390.html">[Twisted-Python] Looping
</A></li>
        <LI>Next message: <A HREF="018391.html">[Twisted-Python] distributing a commercial project based on	twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18392">[ date ]</a>
              <a href="thread.html#18392">[ thread ]</a>
              <a href="subject.html#18392">[ subject ]</a>
              <a href="author.html#18392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David Wilson wrote:
&gt;<i> Hi All,
</I>&gt;<i> I'm trying to pick up Twisted and I'm having trouble with looping.
</I>&gt;<i>  
</I>&gt;<i> I expected that a Deferred returned from a looping call would be 
</I>&gt;<i> available after each call.  But it's only available after the loop is 
</I>
It's not, and if you think about it, it can't - a loopingcall is setup 
once and run indefinitely, who would you be &quot;returning&quot; the deferreds 
to, and how?

Just call your handler from within your loopingcall i.e.

def check_file(fp, cb):
   # blah blah
   for line in lines:
     cb(line)



&gt;<i> stopped.  Am I looking for a different class?
</I>&gt;<i>  
</I>&gt;<i> Thanks,
</I>&gt;<i> Dave
</I>&gt;<i>  
</I>&gt;<i> p.s.  Ultimately I'd like to watch a file and post any new lines up to 
</I>&gt;<i> an HTTP server.  If there is a direct way to get there, please let me 
</I>&gt;<i> know.  Thanks!
</I>
The code you show isn't a very robust way of following a file. My advice 
would be to run &quot;tail -F -q name&quot; in a sub-process and accumulate the 
output.

You need to be aware when watching an external file that when you read, 
the whole line might not have been written, so you need to do something 
like this:

buffer = ''
def check(file, handler):
   buffer += file.read()
   if not '\n' in buffer:
     return

   lines = buffer.split('\n')
   # the final &quot;line&quot; in the buffer doesn't have a terminating
   # \n, make it be the buffer and drop it from out list
   buffer = lines.pop()
   for line in lines:
     handler(line)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018390.html">[Twisted-Python] Looping
</A></li>
	<LI>Next message: <A HREF="018391.html">[Twisted-Python] distributing a commercial project based on	twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18392">[ date ]</a>
              <a href="thread.html#18392">[ thread ]</a>
              <a href="subject.html#18392">[ subject ]</a>
              <a href="author.html#18392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
