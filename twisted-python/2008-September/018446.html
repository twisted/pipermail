<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Question on default t.p.log output
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20on%20default%20t.p.log%20output&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018444.html">
   <LINK REL="Next"  HREF="018447.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Question on default t.p.log output</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20on%20default%20t.p.log%20output&In-Reply-To="
       TITLE="[Twisted-Python] Question on default t.p.log output">terry at jon.es
       </A><BR>
    <I>Tue Sep 30 08:53:18 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018444.html">[Twisted-Python] twisted reactor under win32 (test SerialPort)
</A></li>
        <LI>Next message: <A HREF="018447.html">[Twisted-Python] Question on default t.p.log output
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18446">[ date ]</a>
              <a href="thread.html#18446">[ thread ]</a>
              <a href="subject.html#18446">[ subject ]</a>
              <a href="author.html#18446">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings Twisted superheroes!

I have a simple question about logging. Here's a snippet of code:

    from twisted.python import log
    from twisted.web import client
    from twisted.internet import reactor
    import sys

    log.startLogging(sys.stdout)
    def stop(x): reactor.callLater(0, reactor.stop)
    client.getPage('<A HREF="http://www.divmod.com'">http://www.divmod.com'</A>).addBoth(stop)
    reactor.run()

This produces the output

    2008/09/30 14:16 +0200 [-] Log opened.
    2008/09/30 14:16 +0200 [-] Starting factory &lt;HTTPClientFactory: <A HREF="http://www.divmod.com">http://www.divmod.com</A>&gt;
    2008/09/30 14:16 +0200 [HTTPPageGetter,client] Stopping factory &lt;HTTPClientFactory: <A HREF="http://divmod.com/?__session_just_started__=1">http://divmod.com/?__session_just_started__=1</A>&gt;
    2008/09/30 14:16 +0200 [-] Main loop terminated.

I had a look around and can see where (most) of this is coming from.

First off, the start/stop factory messages are surprising and feel ugly to
me. I mean that's my stdout you're scribbling that stuff all over. The
starting and stopping factory methods, despite appearing next to each other
in the same base Factory class, don't give the same [...] component in
their output. Sometimes I get [Uninitialized], sometimes [-], and sometimes
[HTTPPageGetter,client] as above - with both starting and stopping
messages.

And then, and misleading IMO, is that in a callback attached to the
deferred from getPage, the log output (to the uninitiated, a class I am
arguably a prime member of) still appears to have something to do with
HTTPPageGetter,client when in fact the page has been retrieved, and the
callback fired. It's like HTTPPageGetter,client refuses to lie down and die
quietly, and insists on sitting up in the casket to holler at its
ungrateful descendant callbacks: Hey, I'm the one that kicked this off and
don't you forget it!

Ahem. I see that output is controlled by a var called noisy in the base
Factory class. By why is it True by default if it really is just noise?
Judging from the code (and the use of log.msg not log.err) it's not an
error.

In my actual use case, I see my log filling up with output like this:

2008/09/29 23:55 +0200 [HTTPPageGetter,client] Stopping factory &lt;HTTPClientFactory: <A HREF="https://ec2.amazonaws.com:443/?Action=RunInstances&amp;AWSAccessKeyId=92383292629273839262&amp;ImageId=ami-6bd03402&amp;InstanceType=m1.small&amp;KeyName=xxx-keypair&amp;MaxCount=1&amp;MinCount=1&amp;SecurityGroup.1=coordinator&amp;SignatureVersion=1&amp;Timestamp=2008-09-29T21%3A55%3A23&amp;UserData=QVdTX0FDQ0VTU19LRVlfSUQ6IDBKU1NNSzVOS000N0RHN1dTRDAyCkFXU19TRUNSRVRfQUNDRVNTX0tFWTogZ3J3UDFWaTdHbjg4Y3hMdy9UcDIrdWIxeENUdWVwUmUvV3JHdXRGYQpTM0J1Y2tldE5hbWU6IGZsdWlkaW5mby5jb20KaW5pdEtleU5hbWU6IG9wdC9mbHVpZGluZm8vYmluL2luaXQucHkKcHJvY2Vzc0FyZ3M6IFstLWxvZ2ZpbGUsIC9tbnQvdG1wLzEyMjI3MjUzMjIuNi5sb2csIC0tcGlkZmlsZSwgL21udC90bXAvMTIyMjcyNTMyMi42LnBpZCwKICAtLW5vX3NhdmUsIC0tbm9kYWVtb24sIGF0dHJpYmFzZS1odHRwLXByb2Nlc3MtcG9vbCwgLS1wb3J0LCAnODAwMSddCnJlc3VsdHNLZXlOYW1lOiBpbnN0YW5jZXMvMC9yZXN1bHRzLwpzY3JpcHRQYXRoOiAvdXNyL2Jpbi90d2lzdGQKc291cmNlTGlicmFyeUtleU5hbWU6IGluc3RhbmNlcy8wL3NyYy8yMDA4MDkyNwo%3D&amp;Version=2008-05-05&amp;Signature=mPRws2HDxQaF4lMcmL7Ikc8Txqo%3D">https://ec2.amazonaws.com:443/?Action=RunInstances&amp;AWSAccessKeyId=92383292629273839262&amp;ImageId=ami-6bd03402&amp;InstanceType=m1.small&amp;KeyName=xxx-keypair&amp;MaxCount=1&amp;MinCount=1&amp;SecurityGroup.1=coordinator&amp;SignatureVersion=1&amp;Timestamp=2008-09-29T21%3A55%3A23&amp;UserData=QVdTX0FDQ0VTU19LRVlfSUQ6IDBKU1NNSzVOS000N0RHN1dTRDAyCkFXU19TRUNSRVRfQUNDRVNTX0tFWTogZ3J3UDFWaTdHbjg4Y3hMdy9UcDIrdWIxeENUdWVwUmUvV3JHdXRGYQpTM0J1Y2tldE5hbWU6IGZsdWlkaW5mby5jb20KaW5pdEtleU5hbWU6IG9wdC9mbHVpZGluZm8vYmluL2luaXQucHkKcHJvY2Vzc0FyZ3M6IFstLWxvZ2ZpbGUsIC9tbnQvdG1wLzEyMjI3MjUzMjIuNi5sb2csIC0tcGlkZmlsZSwgL21udC90bXAvMTIyMjcyNTMyMi42LnBpZCwKICAtLW5vX3NhdmUsIC0tbm9kYWVtb24sIGF0dHJpYmFzZS1odHRwLXByb2Nlc3MtcG9vbCwgLS1wb3J0LCAnODAwMSddCnJlc3VsdHNLZXlOYW1lOiBpbnN0YW5jZXMvMC9yZXN1bHRzLwpzY3JpcHRQYXRoOiAvdXNyL2Jpbi90d2lzdGQKc291cmNlTGlicmFyeUtleU5hbWU6IGluc3RhbmNlcy8wL3NyYy8yMDA4MDkyNwo%3D&amp;Version=2008-05-05&amp;Signature=mPRws2HDxQaF4lMcmL7Ikc8Txqo%3D</A>&gt;

I guess the answer might be that I should make my own version of getPage
that sets noisy to False after making its HTTPClientFactory, or maybe
subclass FileLogObserver and override emit. Or I guess I could be calling
functions with log.callWithContext.

But those approached seem to be wheeling in a lot of machinery just to set
to False a variable that (arguably?) should be False to begin with.

See - told you it was simple. I'm at my very best nibbling away on the very
edges of the Twist-o-verse.

Terry
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018444.html">[Twisted-Python] twisted reactor under win32 (test SerialPort)
</A></li>
	<LI>Next message: <A HREF="018447.html">[Twisted-Python] Question on default t.p.log output
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18446">[ date ]</a>
              <a href="thread.html#18446">[ thread ]</a>
              <a href="subject.html#18446">[ subject ]</a>
              <a href="author.html#18446">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
