<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Question on default t.p.log output
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20on%20default%20t.p.log%20output&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018447.html">
   <LINK REL="Next"  HREF="018449.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Question on default t.p.log output</H1>
    <B>Terry Jones</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Question%20on%20default%20t.p.log%20output&In-Reply-To="
       TITLE="[Twisted-Python] Question on default t.p.log output">terry at jon.es
       </A><BR>
    <I>Tue Sep 30 10:16:31 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018447.html">[Twisted-Python] Question on default t.p.log output
</A></li>
        <LI>Next message: <A HREF="018449.html">[Twisted-Python] September 28 2008 Twisted Sprint Report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18448">[ date ]</a>
              <a href="thread.html#18448">[ thread ]</a>
              <a href="subject.html#18448">[ subject ]</a>
              <a href="author.html#18448">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;&gt;&gt;&gt;<i> &quot;glyph&quot; == glyph  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A>&gt; writes:
</I>glyph&gt; Thank you for at least noticing this ;-).

The 1K char log lines were hard to miss :-)

glyph&gt; The logging code is quite ugly, but unfortunately, almost nobody
glyph&gt; cares.  If you could dedicate any time at all to improving it, even
glyph&gt; a little, we'd all really appreciate it.

You'd all appreciate it but OTOH almost nobody cares??? Hmmm. Hard to
resist :-)

glyph&gt; The way the log prefix is calculated is based on what actual event is 
glyph&gt; firing from the reactor.  So, whatever object *generates* the callback 
glyph&gt; is the one whose log prefix will be used.

But I also see lines like this:

2008/09/29 23:56 +0200 [-] Starting factory &lt;HTTPClientFactory: <A HREF="http://ec2-75-101-219-127.compute-1.amazonaws.com:8001/dummy">http://ec2-75-101-219-127.compute-1.amazonaws.com:8001/dummy</A>&gt;
2008/09/29 23:56 +0200 [Uninitialized] Stopping factory &lt;HTTPClientFactory: <A HREF="http://ec2-75-101-219-127.compute-1.amazonaws.com:8001/dummy">http://ec2-75-101-219-127.compute-1.amazonaws.com:8001/dummy</A>&gt;

And - and Uninitialized do not have any clear correspondence with reactor
events. (BTW, I do see where these are coming from.)

glyph&gt; It would definitely be nice if the log could follow the asynchronous 
glyph&gt; thread of execution.  Patches accepted :).

Yes, agreed that would be nice. From my memory of defer.py... (insert vague
comment about how this might not be so hard - for you :-)).

glyph&gt; It sounds like you have several complaints here.

glyph&gt; 1.) You don't want logs to go to stdout.

I do want that, that's why I used sys.stdout.

glyph&gt; 2.) Factories are too noisy by default.

glyph&gt; Knowing when factories start up and shut down can actually be incredibly 
glyph&gt; useful.  It's a pain when they're filling up your logs with spam, but a 
glyph&gt; better solution would be some kind of structured log format with a log 
glyph&gt; viewer application, not destroying the information so that viewing logs 
glyph&gt; with 'less' is easier.

Right, and so viewing them when running a script from the command line that
wants to do some logging to stdout is also fine.

glyph&gt; 4.) The log prefix isn't always useful or correct.

glyph&gt; This may be true, but we'd need a ticket filed that includes a
glyph&gt; complete enumeration of exactly _how_ they aren't useful or correct,
glyph&gt; and each case would need to be fixed.

OK, thinking about that.

glyph&gt; 5.) The log prefix for Deferred callbacks doesn't follow the
glyph&gt; asynchronous origin of the callback.

glyph&gt; Figuring out how to do this is really tricky, because in different cases 
glyph&gt; you want different things.  However, twisted.python.context provides a 
glyph&gt; hook for you to potentially capture some state when Deferreds, at least 
glyph&gt; certain Deferreds, are spun up.  If you can come up with a really clear 
glyph&gt; statement of requirements for a particular log prefix, you can probably 
glyph&gt; get it.

And this.

glyph&gt; 6.) The HTTP client is too noisy and should emit fewer log messages.

glyph&gt; Possibly - but then I recently discovered some very interesting
glyph&gt; information by watching a server which had a bunch of outstanding
glyph&gt; getPage connections spew out thousands of 'stopping factory'
glyph&gt; messages in their output - and seeing those URLs was an invaluable
glyph&gt; debugging aid.

OK, but by your own description that's output that's useful for debugging
(and above you call it spam). My only real question was why that output is
on by default instead of off (especially seeing as it's often adding 1K of
output to my log file for a single logged message).

glyph&gt; 7.) Twisted's log messages are generally ugly and difficult to 
glyph&gt; understand.

glyph&gt; Touche

But I didn't say that... I'm very happy to not have to write logging
code. Sure, the [HTTPPageGetter,client] speaking from beyond the grave is a
bit unsettling, but that's minor.

glyph&gt; Except, of course, to come up with some kind of standard for what
glyph&gt; makes up a useful / helpful log message; and that's probably not
glyph&gt; going to be the unstructured mess of strings that currently goes
glyph&gt; into the log.  (Can you tell I'm pushing a structured log format
glyph&gt; that can be parsed?)

Yes, agreed that would be good.

glyph&gt; Please feel free to file some tickets for areas of this behavior that 
glyph&gt; you have noticed.  I wish I had time to pour into the logging system, 
glyph&gt; but neither I (nor any of our sponsors) _really_ needs it to be any 
glyph&gt; better; it's just a constant annoyance.

Understood, thanks. I'm mainly just trying to understand what's going on
and why.

I will have a bit more of a poke around. As I was going to say, from what I
remember about the callback mechanism in defer.py it seems like one should
be able to have some kind of data structure that's being maintained
(pushed, popped) there that could be updating a log prefix in some way.

Thanks!

Terry


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018447.html">[Twisted-Python] Question on default t.p.log output
</A></li>
	<LI>Next message: <A HREF="018449.html">[Twisted-Python] September 28 2008 Twisted Sprint Report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18448">[ date ]</a>
              <a href="thread.html#18448">[ thread ]</a>
              <a href="subject.html#18448">[ subject ]</a>
              <a href="author.html#18448">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
