<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Calling deferToThread from a thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Calling%20deferToThread%20from%20a%20thread&In-Reply-To=95bb10690809180242r7688b554u3dd05c33f69a642d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018386.html">
   <LINK REL="Next"  HREF="018389.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Calling deferToThread from a thread</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Calling%20deferToThread%20from%20a%20thread&In-Reply-To=95bb10690809180242r7688b554u3dd05c33f69a642d%40mail.gmail.com"
       TITLE="[Twisted-Python] Calling deferToThread from a thread">exarkun at divmod.com
       </A><BR>
    <I>Thu Sep 18 08:22:12 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018386.html">[Twisted-Python] Calling deferToThread from a thread
</A></li>
        <LI>Next message: <A HREF="018389.html">[Twisted-Python] Calling deferToThread from a thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18387">[ date ]</a>
              <a href="thread.html#18387">[ thread ]</a>
              <a href="subject.html#18387">[ subject ]</a>
              <a href="author.html#18387">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 18 Sep 2008 10:42:35 +0100, Reza Lotun &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rlotun at gmail.com</A>&gt; wrote:
&gt;<i>Hi All,
</I>&gt;<i>
</I>&gt;<i>I have a data store api that mandates the return of deferreds for each
</I>&gt;<i>call. I have a number of implementations for the api - an in-memory
</I>&gt;<i>one for testing, and a number of other network + disk based apis.
</I>&gt;<i>
</I>
deferToThread isn't special.  Like pretty much any Twisted API, it is
only safe to call in the reactor thread.  It doesn't matter if the
reactor thread is the main thread or another one - whichever, that's
the only thread Twisted APIs are safe in.

&gt;<i> [snip]
</I>&gt;<i>
</I>&gt;<i>I see two options:
</I>&gt;<i>1. In my unit test I write a function f which makes the api call and
</I>&gt;<i>gets the deferred, and sets it to a local variable within the test
</I>&gt;<i>instance. Then I schedule f to run in the reactor thread via
</I>&gt;<i>reactor.callFromThread
</I>&gt;<i>2. I look into trial which has support for this kind of stuff??
</I>
Your best bet is to look at py.test's support for xunit style tests.
Whenever you need to deal with Deferreds, you should be using trial's
TestCase.  Anything else you do will be fragile and prone to break (as
trial is, but at least we will fix it when it breaks so that you don't
have to).

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018386.html">[Twisted-Python] Calling deferToThread from a thread
</A></li>
	<LI>Next message: <A HREF="018389.html">[Twisted-Python] Calling deferToThread from a thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18387">[ date ]</a>
              <a href="thread.html#18387">[ thread ]</a>
              <a href="subject.html#18387">[ subject ]</a>
              <a href="author.html#18387">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
