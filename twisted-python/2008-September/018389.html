<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Calling deferToThread from a thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Calling%20deferToThread%20from%20a%20thread&In-Reply-To=95bb10690809180242r7688b554u3dd05c33f69a642d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018387.html">
   <LINK REL="Next"  HREF="018388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Calling deferToThread from a thread</H1>
    <B>David Ripton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Calling%20deferToThread%20from%20a%20thread&In-Reply-To=95bb10690809180242r7688b554u3dd05c33f69a642d%40mail.gmail.com"
       TITLE="[Twisted-Python] Calling deferToThread from a thread">dripton at ripton.net
       </A><BR>
    <I>Thu Sep 18 11:16:23 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018387.html">[Twisted-Python] Calling deferToThread from a thread
</A></li>
        <LI>Next message: <A HREF="018388.html">[Twisted-Python] distributing a commercial project based on twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18389">[ date ]</a>
              <a href="thread.html#18389">[ thread ]</a>
              <a href="subject.html#18389">[ subject ]</a>
              <a href="author.html#18389">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2008.09.18 10:42:35 +0100, Reza Lotun wrote:
&gt;<i> My issue is this - I'm using py.test for unit testing (I'm aware of
</I>&gt;<i> trial, but for compatibility reasons with the rest of the project I
</I>&gt;<i> haven't looked into using it). To test deferred-based code I have set
</I>&gt;<i> up a separate thread which the reactor runs in (the setup and teardown
</I>&gt;<i> code is shown below for anyone who is interested).
</I>
&gt;<i> I see two options:
</I>&gt;<i> 1. In my unit test I write a function f which makes the api call and
</I>&gt;<i> gets the deferred, and sets it to a local variable within the test
</I>&gt;<i> instance. Then I schedule f to run in the reactor thread via
</I>&gt;<i> reactor.callFromThread
</I>&gt;<i> 2. I look into trial which has support for this kind of stuff??
</I>
trial has very good support for deferreds.  If your test method returns
a deferred then trial magically does the right thing.  You don't need to
manage the reactor yourself.  See Twisted's docs and unit tests for
examples.

trial's API is based on unittest's, which is based on JUnit's.  Works
fine, but it has the Java nature.

I recommend trying nose.  It has support for deferreds, using a
decorator.  And its API is based on the py.test API.  Unfortunately they
chose to spell setup and teardown differently, so you can't use your
py.test test modules unchanged, but the changes are usually trivial.

-- 
David Ripton    <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dripton at ripton.net</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018387.html">[Twisted-Python] Calling deferToThread from a thread
</A></li>
	<LI>Next message: <A HREF="018388.html">[Twisted-Python] distributing a commercial project based on twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18389">[ date ]</a>
              <a href="thread.html#18389">[ thread ]</a>
              <a href="subject.html#18389">[ subject ]</a>
              <a href="author.html#18389">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
