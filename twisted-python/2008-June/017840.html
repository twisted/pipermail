<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Idiom for database access	within	iterator/generator?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Idiom%20for%20database%20access%0A%09within%09iterator/generator%3F&In-Reply-To=1212497906.13279.3.camel%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017837.html">
   <LINK REL="Next"  HREF="017841.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Idiom for database access	within	iterator/generator?</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Idiom%20for%20database%20access%0A%09within%09iterator/generator%3F&In-Reply-To=1212497906.13279.3.camel%40localhost.localdomain"
       TITLE="[Twisted-Python] Idiom for database access	within	iterator/generator?">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Tue Jun  3 13:10:13 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017837.html">[Twisted-Python] Idiom for database access within	iterator/generator?
</A></li>
        <LI>Next message: <A HREF="017841.html">[Twisted-Python] Idiom for database access	within	iterator/generator?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17840">[ date ]</a>
              <a href="thread.html#17840">[ thread ]</a>
              <a href="subject.html#17840">[ subject ]</a>
              <a href="author.html#17840">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Itamar Shtull-Trauring wrote:
&gt;<i> On Tue, 2008-06-03 at 17:03 +1000, Justin Warren wrote:
</I>&gt;&gt;<i> Greetings twisted gurus!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm hoping someone with a better algorithmic brain than I could offer
</I>&gt;&gt;<i> some advice on a good way to do something in a twisty/pythonic way.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The pseudocode for what I want to do is:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> for item in generator_that_fetches_rows_from_database:
</I>&gt;&gt;<i> 	...
</I>&gt;&gt;<i> 	do_stuff()
</I>&gt;&gt;<i> 	...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> where generator_that_fetches_rows_from_database is an object that uses
</I>&gt;&gt;<i> enterprise.adbapi (or anything else) to fetch rows from a database and
</I>&gt;&gt;<i> return them to the for..in.. loop.
</I>&gt;<i> 
</I>&gt;<i> runInteraction is your friend:
</I>
Sure, but that's exactly what the OP didn't want; doing a bulk fetch 
from the SQL (which yes will be non-blocking for the most part)

I think he wanted:

def query(txn):
   txn.execute(&quot;...&quot;)
   while True:
     rs = txn.fetchone()
     if blah:
         continue
     if foo:
         transform data
     yield data



@defer.inlineCallbacks
def sqlQuery():
   deferred_iter = runInteraction(query)
   for def in deferred_iter:
     row = yield def
     # do a thing with the row e.g. push it to an Athena page

i.e. the function that runs inside the thread pool to be able to yield 
values, and the function that runs in the reactor to be able to iterate 
through them in a deferred-compatible fashion.

AFAIK there is no such thing, which is a shame because for *really* huge 
queries it has the potential to significantly reduce memory usage.

On a not-very related issue, it would be highly useful IMHO for



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017837.html">[Twisted-Python] Idiom for database access within	iterator/generator?
</A></li>
	<LI>Next message: <A HREF="017841.html">[Twisted-Python] Idiom for database access	within	iterator/generator?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17840">[ date ]</a>
              <a href="thread.html#17840">[ thread ]</a>
              <a href="subject.html#17840">[ subject ]</a>
              <a href="author.html#17840">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
