<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Executing a number of commands over SSH
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Executing%20a%20number%20of%20commands%20over%20SSH&In-Reply-To=B724F517-FF2C-4015-BC03-1C4DD2AE4B83%40webmynd.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017895.html">
   <LINK REL="Next"  HREF="017915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Executing a number of commands over SSH</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Executing%20a%20number%20of%20commands%20over%20SSH&In-Reply-To=B724F517-FF2C-4015-BC03-1C4DD2AE4B83%40webmynd.com"
       TITLE="[Twisted-Python] Executing a number of commands over SSH">exarkun at divmod.com
       </A><BR>
    <I>Sat Jun 14 21:43:51 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017895.html">[Twisted-Python] Executing a number of commands over SSH
</A></li>
        <LI>Next message: <A HREF="017915.html">[Twisted-Python] Executing a number of commands over SSH
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17896">[ date ]</a>
              <a href="thread.html#17896">[ thread ]</a>
              <a href="subject.html#17896">[ subject ]</a>
              <a href="author.html#17896">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 14 Jun 2008 16:08:58 -0700, James Brady &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">james at webmynd.com</A>&gt; wrote:
&gt;<i>Hi all,
</I>&gt;<i>I'd like to run a few commands on a remote machine over SSH. Looking  at the 
</I>&gt;<i>conch packages, I'm not sure what the best approach is for this.
</I>&gt;<i>
</I>&gt;<i>The only way I can see to pass the set of commands down into the 
</I>&gt;<i>SSHConnection and SSHChannel objects is through my transport factory,  i.e. 
</I>&gt;<i>I can't add or remove commands to be run on an already  instantiated 
</I>&gt;<i>SSHConnection.
</I>
It sounds like you've figured out a lot of the difficult parts already. :)

Consider how you execute a command once `SSHConnection.serviceStarted&#180; is
called (if you looked at `sshsimpleclient.py&#180;, then this is where the True,
False, and Cat channels get opened).  All you need to do to execute another
command is what you would do to execute those initial commands in that
method.  As long as you have a reference to the SSHConnection instance, you
can start arbitrary commands at any time you like.

So the problem is really just figuring out how to have a reference to the
SSHConnection instance in the code that knows it wants to start a new
command.

&gt;<i>
</I>&gt;<i>Also, I'm a newcomer to the Twisted way of doing things, so it's not  clear 
</I>&gt;<i>to me how I would go about returning the status and output of  these 
</I>&gt;<i>commands back up to my code. I'm guessing I should create a  Deferred 
</I>&gt;<i>somewhere, but some guidance on how these should bubble up  through the 
</I>&gt;<i>twisted layers would be much appreciated.
</I>
Indeed, a Deferred should help.  You can have one which is fired with the
SSHConnection once it is available.  Then, callbacks on this Deferred will
be able to start any commands they want.  One way to do this would be to
pass a Deferred all the way down into the SSHConnection and fire it with
`self&#180; in `serviceStarted&#180;.  This basically turns control flow inside-out,
allowing arbitrary code which is not part of the SSHConnection class to use
the connection.

This has been a bit vague, but Conch certainly has a lot of pieces and it's
hard to talk more specifically without having some code at hand.  If you're
still stuck, I suggest posting a short example of what you have (preferably
self-contained and runnable) and then someone can make more specific code
suggestions based on it.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017895.html">[Twisted-Python] Executing a number of commands over SSH
</A></li>
	<LI>Next message: <A HREF="017915.html">[Twisted-Python] Executing a number of commands over SSH
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17896">[ date ]</a>
              <a href="thread.html#17896">[ thread ]</a>
              <a href="subject.html#17896">[ subject ]</a>
              <a href="author.html#17896">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
