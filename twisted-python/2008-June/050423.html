<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Executing a number of commands over SSH
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Executing%20a%20number%20of%20commands%20over%20SSH&In-Reply-To=%3CF6431E8C-D6A9-4BE3-9157-EB1E22F9D549%40webmynd.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050404.html">
   <LINK REL="Next"  HREF="050409.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Executing a number of commands over SSH</H1>
    <B>James Brady</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Executing%20a%20number%20of%20commands%20over%20SSH&In-Reply-To=%3CF6431E8C-D6A9-4BE3-9157-EB1E22F9D549%40webmynd.com%3E"
       TITLE="[Twisted-Python] Executing a number of commands over SSH">james at webmynd.com
       </A><BR>
    <I>Tue Jun 17 15:44:53 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050404.html">[Twisted-Python] Executing a number of commands over SSH
</A></li>
        <LI>Next message (by thread): <A HREF="050409.html">[Twisted-python] Writing industrial grade twisted servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50423">[ date ]</a>
              <a href="thread.html#50423">[ thread ]</a>
              <a href="subject.html#50423">[ subject ]</a>
              <a href="author.html#50423">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> Indeed, a Deferred should help.  You can have one which is fired  
</I>&gt;<i> with the
</I>&gt;<i> SSHConnection once it is available.  Then, callbacks on this  
</I>&gt;<i> Deferred will
</I>&gt;<i> be able to start any commands they want.  One way to do this would  
</I>&gt;<i> be to
</I>&gt;<i> pass a Deferred all the way down into the SSHConnection and fire it  
</I>&gt;<i> with
</I>&gt;<i> `self´ in `serviceStarted´.  This basically turns control flow  
</I>&gt;<i> inside-out,
</I>&gt;<i> allowing arbitrary code which is not part of the SSHConnection class  
</I>&gt;<i> to use
</I>&gt;<i> the connection.
</I>
Hi Jean-Paul,
Thanks for that advice - as you suggested I'm now passing a Deferred  
down into the SSHConnection to receive a reference to the connection  
object, which works really well.

I now have a follow-on question. This is my situation: I'd like to set  
up an SSHConnection and associate it with a Machine object at program  
startup, then execute arbitrary commands over this SSHConnection at  
run-time.

The problem I'm facing is that after instantiating the Twisted  
objects, calling reactor.run() doesn't return, so I can't create a  
standalone SSHConnection and attach it as a utility to a Machine object.

For example:
class Machine(object):
     def __init__(self, address):
         self.conn = MachineConnection(self, address, 'user')

class MachineConnection(object):
     def __init__(self, address, user):
         self.address = address
         self.port = 22
         self.user = user
         d=defer.Deferred()
         d.addCallback(self.__conn_ready)
         d.addErrback(self.__conn_err)

         factory = protocol.ClientFactory(self.user, d) # I'm actually  
using a subclass
         reactor.connectTCP(self.address, self.port, factory)
         reactor.run()


Here, I've left out definitions of my conch subclasses, and methods on  
Machine and MachineConnection, but I don't think they're relevant.

The issue is that reactor.run() in the last line of  
MachineConnection.__init__ starts Twisted up, creates the connection  
and so on, but doesn't return control to the original flow of code.  
I've tried starting separate threads for the connections, but Twisted  
seems to rely on running in the main thread.

Are the any suggestions on how to set up backgrounded Twisted  
connections that can be interacted with as daemonic threads?

Thank you,
James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20080617/8d39b704/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050404.html">[Twisted-Python] Executing a number of commands over SSH
</A></li>
	<LI>Next message (by thread): <A HREF="050409.html">[Twisted-python] Writing industrial grade twisted servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50423">[ date ]</a>
              <a href="thread.html#50423">[ thread ]</a>
              <a href="subject.html#50423">[ subject ]</a>
              <a href="author.html#50423">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
