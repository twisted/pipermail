<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Idiom for database access	within	iterator/generator?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Idiom%20for%20database%20access%0A%09within%09iterator/generator%3F&In-Reply-To=%3C20080603175155.4714.675195439.divmod.quotient.5160%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050348.html">
   <LINK REL="Next"  HREF="050350.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Idiom for database access	within	iterator/generator?</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Idiom%20for%20database%20access%0A%09within%09iterator/generator%3F&In-Reply-To=%3C20080603175155.4714.675195439.divmod.quotient.5160%40ohm%3E"
       TITLE="[Twisted-Python] Idiom for database access	within	iterator/generator?">exarkun at divmod.com
       </A><BR>
    <I>Tue Jun  3 11:51:55 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050348.html">[Twisted-Python] Idiom for database access	within	iterator/generator?
</A></li>
        <LI>Next message (by thread): <A HREF="050350.html">[Twisted-Python] Idiom for database access	within	iterator/generator?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50349">[ date ]</a>
              <a href="thread.html#50349">[ thread ]</a>
              <a href="subject.html#50349">[ subject ]</a>
              <a href="author.html#50349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 03 Jun 2008 18:10:13 +0100, Phil Mayers &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">p.mayers at imperial.ac.uk</A>&gt; wrote:
&gt;<i>Itamar Shtull-Trauring wrote:
</I>&gt;&gt;<i>On Tue, 2008-06-03 at 17:03 +1000, Justin Warren wrote:
</I>&gt;&gt;&gt;<i>Greetings twisted gurus!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I'm hoping someone with a better algorithmic brain than I could offer
</I>&gt;&gt;&gt;<i>some advice on a good way to do something in a twisty/pythonic way.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>The pseudocode for what I want to do is:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>for item in generator_that_fetches_rows_from_database:
</I>&gt;&gt;&gt;<i>         ...
</I>&gt;&gt;&gt;<i>         do_stuff()
</I>&gt;&gt;&gt;<i>         ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>where generator_that_fetches_rows_from_database is an object that uses
</I>&gt;&gt;&gt;<i>enterprise.adbapi (or anything else) to fetch rows from a database and
</I>&gt;&gt;&gt;<i>return them to the for..in.. loop.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>runInteraction is your friend:
</I>&gt;<i>
</I>&gt;<i>Sure, but that's exactly what the OP didn't want; doing a bulk fetch from 
</I>&gt;<i>the SQL (which yes will be non-blocking for the most part)
</I>&gt;<i>
</I>&gt;<i>I think he wanted:
</I>&gt;<i>
</I>&gt;<i>def query(txn):
</I>&gt;<i>   txn.execute(&quot;...&quot;)
</I>&gt;<i>   while True:
</I>&gt;<i>     rs = txn.fetchone()
</I>&gt;<i>     if blah:
</I>&gt;<i>         continue
</I>&gt;<i>     if foo:
</I>&gt;<i>         transform data
</I>&gt;<i>     yield data
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>@defer.inlineCallbacks
</I>&gt;<i>def sqlQuery():
</I>&gt;<i>   deferred_iter = runInteraction(query)
</I>&gt;<i>   for def in deferred_iter:
</I>&gt;<i>     row = yield def
</I>&gt;<i>     # do a thing with the row e.g. push it to an Athena page
</I>&gt;<i>
</I>&gt;<i>i.e. the function that runs inside the thread pool to be able to yield 
</I>&gt;<i>values, and the function that runs in the reactor to be able to iterate 
</I>&gt;<i>through them in a deferred-compatible fashion.
</I>
It should be straightforward to implement this with DeferredQueue.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050348.html">[Twisted-Python] Idiom for database access	within	iterator/generator?
</A></li>
	<LI>Next message (by thread): <A HREF="050350.html">[Twisted-Python] Idiom for database access	within	iterator/generator?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50349">[ date ]</a>
              <a href="thread.html#50349">[ thread ]</a>
              <a href="subject.html#50349">[ subject ]</a>
              <a href="author.html#50349">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
