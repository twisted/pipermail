<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Returning a DeferredList?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Returning%20a%20DeferredList%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017997.html">
   <LINK REL="Next"  HREF="018000.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Returning a DeferredList?</H1>
    <B>Nathan</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Returning%20a%20DeferredList%3F&In-Reply-To="
       TITLE="[Twisted-Python] Returning a DeferredList?">nathan.stocks at gmail.com
       </A><BR>
    <I>Mon Jun 30 17:52:58 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017997.html">[Twisted-Python] [SIP]
</A></li>
        <LI>Next message: <A HREF="018000.html">[Twisted-Python] Returning a DeferredList?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17999">[ date ]</a>
              <a href="thread.html#17999">[ thread ]</a>
              <a href="subject.html#17999">[ subject ]</a>
              <a href="author.html#17999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I regularly use the return values of deferreds to simulate synchronous
behaviour like this:

def handle_db_result(result):
   if ({some logic stuff}):
      return True
   else:
      return False

def check_db():
   d = {some db query that returns a deferred}
   d.addCallback(handle_db_result)
   return d

def main_func():
   if check_db():   # This eventually returns True or False
      # Do some stuff
   else:
      # Do some different stuff


So now I'm trying to do the same thing with DeferredList's, but
apparently the semantics aren't the same.  Here's some actual runnable
sample code trying to use the DeferredList:

from twisted.internet import reactor, defer

def callback_function(results):
   return &quot;(--&gt; This is the value that I want to get into retval! &lt;--)&quot;

def make_a_list():
   deferred1 = defer.Deferred()
   deferred2 = defer.Deferred()
   dl = defer.DeferredList([deferred1, deferred2])
   dl.addCallback(callback_function)
   deferred1.callback('one')
   deferred2.callback('two')
   return dl             # The crucial line!

def test():
   retval = make_a_list()
   print &quot;retval is:&quot;, retval

reactor.callWhenRunning(test)
reactor.callLater(2.0, reactor.stop)
reactor.run()



The actual output of the above script is:

retval is: &lt;DeferredList at 0x7a30a8  current result: '(--&gt; This is
the value that I want to get into retval! &lt;--)'&gt;

Through some trial and error I found that if I change that &quot;crucial
line&quot; above to &quot;return dl.result&quot;, then it appears to work how I like.
 Is that what I should be doing, or did I just get lucky in that
particular instance??

Also, I notice that if one of the deferred's errbacked, then the
DeferredList seems to errback as well.  It shouldn't do that according
to <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/defer.html#auto7">http://twistedmatrix.com/projects/core/documentation/howto/defer.html#auto7</A>
... so I filed a bug (#3323).

~ Nathan


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017997.html">[Twisted-Python] [SIP]
</A></li>
	<LI>Next message: <A HREF="018000.html">[Twisted-Python] Returning a DeferredList?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17999">[ date ]</a>
              <a href="thread.html#17999">[ thread ]</a>
              <a href="subject.html#17999">[ subject ]</a>
              <a href="author.html#17999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
