<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted, twistd and logging
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%2C%20twistd%20and%20logging&In-Reply-To=20080620121346.59659d06%40ws35.commsecure.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017940.html">
   <LINK REL="Next"  HREF="017942.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted, twistd and logging</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%2C%20twistd%20and%20logging&In-Reply-To=20080620121346.59659d06%40ws35.commsecure.com.au"
       TITLE="[Twisted-Python] Twisted, twistd and logging">glyph at divmod.com
       </A><BR>
    <I>Thu Jun 19 23:31:47 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="017940.html">[Twisted-Python] Twisted, twistd and logging
</A></li>
        <LI>Next message: <A HREF="017942.html">[Twisted-Python] Twisted, twistd and logging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17941">[ date ]</a>
              <a href="thread.html#17941">[ thread ]</a>
              <a href="subject.html#17941">[ subject ]</a>
              <a href="author.html#17941">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02:13 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tim at commsecure.com.au</A> wrote:
&gt;<i>Having skim-read ticket 638 that JP pointed to in another reply,
</I>&gt;<i>now I'm not so sure. It's kind of difficult to for me to understand the
</I>&gt;<i>current state of play, especially since that ticket predates the merge
</I>&gt;<i>of seemingly-related ticket 3052, but it *seems* to be a battle between
</I>&gt;<i>the camps of &quot;twistd's logging is limited, it should be infinitely
</I>&gt;<i>extensible&quot; and &quot;twistd's logging is limited, applications
</I>&gt;<i>should be allowed to override it&quot;. Personally, I think I lean
</I>&gt;<i>more toward &quot;it should be infinitely extensible&quot; side - but right now I
</I>&gt;<i>don't really care about the general case of extensibility, I just want
</I>&gt;<i>more flexible syslog support.
</I>
Well, let me first say that your understanding of the issues here is 
remarkably deep and nuanced, despite your modesty :).  I hope that 
you'll stick around to help us take the whole logging system in Twisted 
to the next level...

I don't believe there are actually different &quot;camps&quot; here, and there 
isn't a lot of disagreement.  At least, I believe all of the core 
developers have essentially the same perspective, with differences in 
emphasis, not content.

There are two systems here.  Twisted's logging (i.e. 
twisted.python.log), and twistd's logging 
(twisted.internet._twistd_unix, twisted.internet._twistw, 
twisted.python.syslog, among other things).  Twisted's logging, while it 
could certainly be improved, is in reasonable shape.  It's extremely 
simple, and there is a clear and (mostly) well-specified &quot;do anything 
you want&quot; integration point: addObserver.  While there are some tweaks 
I'd like to see here, I don't think it's what we're talking about.

By contrast, twistd's logging, as the module names I mentioned above may 
indicate, is a squirrely mess of private and undocumented code, ad-hoc 
relationships, and so on.

The ticket which I believe most clearly explains how to fix this issue 
is #2751.  The question of &quot;how do we tell where twistd thinks the logs 
go&quot; is really just a tiny microcosm of &quot;how do we tell what twistd 
thinks is going on around here&quot;.  There is no clear, uniform surface 
presented to affect twistd's configuration from anywhere, not even 
internally; let alone in user code.

The problem with the way you phrased the disagreement is the extreme 
vagueness of the word &quot;application&quot;.  It really just means &quot;some code&quot;. 
The reason you have picked up on opposition to the &quot;applications should 
be allowed to override it&quot; idea is that there is a tendency, when 
creating applications, to customize every aspect of the framework just 
because you can; to create a monolithic, non-cooperative chunk of code 
that just has a mainpoint and sets everything up for you.  An 
application, as in some code that uses Twisted to provide a network 
service, should be written in such a way that it is relatively agnostic 
about logging.  Some users might want to set it up to use syslog, some 
might want to get it in the logging module; some might want something 
really weird like Growl notifications or dbus messages.  Ergo, 
applications should not generally touch logging, no matter what our 
logging APIs look like.  This is what I'm talking about with the &quot;it 
invites abuse&quot; comment near the bottom of #638.

However, some &quot;applications&quot; *are* logging.  For example, if you wanted 
to do write some crazy log monitor that integrates with twistd process, 
you need two things: the &quot;application&quot; needs to allow the framework to 
handle logging, not muck with it itself (i.e. the thing I just said) and 
the framework needs to provide an interface for *your* application (i.e. 
the log monitor) to get in there and call some nice, well-documented 
APIs to reconfigure the way twistd has set up its logging.

The first application that needs to do this is twistd itself.  The 
internal APIs of twistd need to be organized such that it is easy to 
maintain and extend - for example, so that you could do the extension 
that you are proposing with syslog.  Once these APIs are tested, 
documented, and clearly factored, adding a plugin system to allow users 
to replace components of the logging system should be relatively 
straightforward.

Work is underway to do all of this; many of the tickets that we're 
talking about here have already have work underway.
&gt;<i>At any rate, ticket 638 and other related tickets seem to be high-level
</I>&gt;<i>conceptual arguments, and I don't feel I have the domain-knowledge
</I>&gt;<i>required to comment intelligibly on them.
</I>
I hope that this summary has improved your understanding somewhat. 
Don't let the depth of the issues here scare you; the best way to 
resolve major architectural headaches like this is one step at a time, 
responding to one specific use-case at a time.  So, I would recommend 
that you file a ticket if you haven't already, and simply add syslog 
facility support to twistd by adding a --syslog-facility command-line 
option (no, usage.Options won't let you have --foo and --foo=bar options 
at the same time, sorry...) and a _syslogFacility attribute to the 
UnixAppLogger object added by the fix to #3052.  You would of course 
need to add this to twisted.python.syslog as well, but I think the way 
to do that should be pretty straightforward.

If you feel the need to get fancy and add more features to t.p.syslog, 
make the factoring of the log configuration object finer-grained, or add 
a plugin system for twistd for log sinks so you can write your own 
syslog support, feel free!  However, ambitious and possibly 
controversial refactorings like that are a lot easier to talk about (and 
get done) when we can look at how they will improve the implementation 
of some existing feature, not for a speculative benefit.  So in any 
event you probably want to do the simple syslog facility addition first.

Also, congratulations on volunteering to maintain Twisted's log 
subsystem!  If you would like to decline, please see David Reid about 
fighting a bear on your way out.  ;-).


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017940.html">[Twisted-Python] Twisted, twistd and logging
</A></li>
	<LI>Next message: <A HREF="017942.html">[Twisted-Python] Twisted, twistd and logging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17941">[ date ]</a>
              <a href="thread.html#17941">[ thread ]</a>
              <a href="subject.html#17941">[ subject ]</a>
              <a href="author.html#17941">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
