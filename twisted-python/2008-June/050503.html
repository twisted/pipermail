<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Implementing startup sanity-checks for twistd	services.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Implementing%20startup%20sanity-checks%20for%20twistd%0A%09services.&In-Reply-To=%3C20080630180850.62fe78f2%40ws35.commsecure.com.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="050506.html">
   <LINK REL="Next"  HREF="017997.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Implementing startup sanity-checks for twistd	services.</H1>
    <B>Tim Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Implementing%20startup%20sanity-checks%20for%20twistd%0A%09services.&In-Reply-To=%3C20080630180850.62fe78f2%40ws35.commsecure.com.au%3E"
       TITLE="[Twisted-Python] Implementing startup sanity-checks for twistd	services.">tim at commsecure.com.au
       </A><BR>
    <I>Mon Jun 30 02:08:50 MDT 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="050506.html">[Twisted-Python] Twisted Hosting and Twisted in the Cloud
</A></li>
        <LI>Next message (by thread): <A HREF="017997.html">[Twisted-Python] [SIP]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50503">[ date ]</a>
              <a href="thread.html#50503">[ thread ]</a>
              <a href="subject.html#50503">[ subject ]</a>
              <a href="author.html#50503">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The system I'm working on at the moment is talking to MySQL, and in
order to get reasonable behaviour, I need to make sure the &quot;SQL_MODE&quot;
variable is set on both the database connection, and on the stored
procedures I'll be calling. If this is not set up correctly, I expect
to be plagued with silent data corruption issues. I can force the
SQL_MODE per-connection when I connect to the database, but I need to
double-check the procedures whenever I start up.

Ideally, my system would follow a startup procedure something like this:

 - Read configuration
 - Connect to the configured database.
 - Check the SQL_MODE associated with any stored procedures.
 - If everything checks out OK, continue the startup process.
 - Otherwise, log a noisy error and shut down.

Of course, I'd prefer to do things the Twisted Way if at all possible.

I've had some ideas about how to implement this, but none of them seem
terribly useful:

If I launch my queries at startup, and only add my service to the
master Application object if they return successfully, then by the time
I try to start my service twistd will have (I assume) already dropped
privileges and chroot'd and so forth.

If I attach my service to the master Application object at startup
*then* launch my queries, then I might wind up accepting queries before
my sanity checks have completed, defeating the point.

Also, if my service has started and my sanity-checks fail, how can I
cleanly shut down twistd from inside? If my service is just one of
possibly many running inside the master Application object, it seems a
bit rude for me to call reactor.stop(); on the other hand, if I just
stop my service then twistd keeps happily running - confusing
operations staff who often use 'ps' to check whether systems are up.

Is there a better way to do this?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20080630/5562910c/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="050506.html">[Twisted-Python] Twisted Hosting and Twisted in the Cloud
</A></li>
	<LI>Next message (by thread): <A HREF="017997.html">[Twisted-Python] [SIP]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50503">[ date ]</a>
              <a href="thread.html#50503">[ thread ]</a>
              <a href="subject.html#50503">[ subject ]</a>
              <a href="author.html#50503">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
