<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Scalability of timers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scalability%20of%20timers&In-Reply-To=%3C20140810143129.GA32138%40k2%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="061076.html">
   <LINK REL="Next"  HREF="061068.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Scalability of timers</H1>
    <B>dw+twisted-python at hmmz.org</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scalability%20of%20timers&In-Reply-To=%3C20140810143129.GA32138%40k2%3E"
       TITLE="[Twisted-Python] Scalability of timers">dw+twisted-python at hmmz.org
       </A><BR>
    <I>Sun Aug 10 08:31:29 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="061076.html">[Twisted-Python] Scalability of timers
</A></li>
        <LI>Next message (by thread): <A HREF="061068.html">[Twisted-Python] Scalability of timers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61066">[ date ]</a>
              <a href="thread.html#61066">[ thread ]</a>
              <a href="subject.html#61066">[ subject ]</a>
              <a href="author.html#61066">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Tobias,

Individual OS have their own mechanisms for avoiding the kind of waste
you're describing. For example, Linux quite aggressively rounds up the
expiry of certain classes of timer at progressively less granular
intervals the further in the future they're scheduled (&quot;timer
coalescing&quot;).

When Twisted wakes, there is no guarantee that that only one timer has
expired by then. In fact under load you would expect the select loop to
always be running (and thus timing out) late, and so each iteration may
process several timers simultaneously.

Twisted will set the select() timeout to the timer due to expire the
earliest. Finding this timer is a constant time operation. There is only
ever one active select() (or select-equivalent) call active at a time.

The Twisted timer implementation internally uses a heap, so scheduling
and expiry are quite efficint O(logN). With 4 billion timers active,
scheduling a new timer in the worst case would require 32 array elements
to be swapped.


On Sun, Aug 10, 2014 at 05:16:51AM -0700, Tobias Oberstein wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I have a question regarding scalability of timers in Twisted.
</I>&gt;<i> 
</I>&gt;<i> Say I have a massive number of periodic timers (lets say each with period 1s, but all slightly time shifted to each other).
</I>&gt;<i> 
</I>&gt;<i> As far as I understand, timers are implemented ultimately by setting the timeout parameter when calling into OS select/poll/epoll/kqueue.
</I>&gt;<i> 
</I>&gt;<i> If this  is true, then the number of timers scales linearly with the number of syscalls. This can get limiting (the total number of syscalls a Linux box can sustain is a couple of 100k's per second). As more and more timers are setup, the timeout essentially will approach 0. On the upside, timers will fire precisely.
</I>&gt;<i> 
</I>&gt;<i> However, say I am fine with a precision of 1ms.
</I>&gt;<i> 
</I>&gt;<i> Is there a way that limits the syscall rate to 1000/s (given no FD activity happens) _independently_ of the number of timers setup?
</I>&gt;<i> 
</I>&gt;<i> Timers that fall into a certain ms slice would all fire roughly at the same time (still ordered).
</I>&gt;<i> 
</I>&gt;<i> Is that possible?
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Tobias
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="061076.html">[Twisted-Python] Scalability of timers
</A></li>
	<LI>Next message (by thread): <A HREF="061068.html">[Twisted-Python] Scalability of timers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61066">[ date ]</a>
              <a href="thread.html#61066">[ thread ]</a>
              <a href="subject.html#61066">[ subject ]</a>
              <a href="author.html#61066">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
