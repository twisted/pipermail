<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Scalability of timers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scalability%20of%20timers&In-Reply-To=%3C20140810221113.GA11902%40k2%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028607.html">
   <LINK REL="Next"  HREF="028612.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Scalability of timers</H1>
    <B>dw+twisted-python at hmmz.org</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Scalability%20of%20timers&In-Reply-To=%3C20140810221113.GA11902%40k2%3E"
       TITLE="[Twisted-Python] Scalability of timers">dw+twisted-python at hmmz.org
       </A><BR>
    <I>Sun Aug 10 16:11:13 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028607.html">[Twisted-Python] Scalability of timers
</A></li>
        <LI>Next message: <A HREF="028612.html">[Twisted-Python] Scalability of timers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28608">[ date ]</a>
              <a href="thread.html#28608">[ thread ]</a>
              <a href="subject.html#28608">[ subject ]</a>
              <a href="author.html#28608">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Aug 10, 2014 at 02:51:02PM -0700, Tobias Oberstein wrote:

&gt;<i> But the coalescing you describe would also apply to those implicit
</I>&gt;<i> timers (created from select(timeout = ..) within the Linux kernel)?
</I>
It applies to all kernel timers not created by realtime processes.


&gt;<i> This is all fine. But how do I _explicitly_ limit the rate at which
</I>&gt;<i> select() is called to say 1000Hz (at the expense of timer precision)?
</I>
&gt;<i> I don't want to let the box hit it's syscall rate limit. Because the
</I>&gt;<i> box will spend a fair amount of resources for context switching all
</I>&gt;<i> the time with to real gain.
</I>
&gt;<i>From a reading of <A HREF="http://lwn.net/Articles/296578/,">http://lwn.net/Articles/296578/,</A> at time of writing
</I>the default select() implementation coalesces sub-second timeouts to
50us boundaries, and this can be adjusted via prctl(PR_SET_TIMERSLACK)
(<A HREF="http://linux.die.net/man/2/prctl">http://linux.die.net/man/2/prctl</A>) on a per-process basis.

That article is from 2008, and though the relevant kernel code seems to
match the article content, a huge amount of power-efficiency related
changes went into the kernel since that time. My assumption is nowadays
the kernel rounds more aggressively than the default of 50us documented
by that article.

Short answer is yes, you can set the max hz of select(), but in all
likelihood you won't have to. As always, benchmarking and profiling real
code might reveal this to be a non-issue.


David

&gt;<i> 
</I>&gt;<i> Thanks for your hints and patience,
</I>&gt;<i> Tobias
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Sun, Aug 10, 2014 at 05:16:51AM -0700, Tobias Oberstein wrote:
</I>&gt;<i> &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I have a question regarding scalability of timers in Twisted.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Say I have a massive number of periodic timers (lets say each with period 1s,
</I>&gt;<i> &gt; but all slightly time shifted to each other).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; As far as I understand, timers are implemented ultimately by setting the
</I>&gt;<i> &gt; timeout parameter when calling into OS select/poll/epoll/kqueue.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; If this  is true, then the number of timers scales linearly with the number of
</I>&gt;<i> &gt; syscalls. This can get limiting (the total number of syscalls a Linux box can
</I>&gt;<i> &gt; sustain is a couple of 100k's per second). As more and more timers are setup,
</I>&gt;<i> &gt; the timeout essentially will approach 0. On the upside, timers will fire
</I>&gt;<i> &gt; precisely.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; However, say I am fine with a precision of 1ms.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Is there a way that limits the syscall rate to 1000/s (given no FD activity
</I>&gt;<i> &gt; happens) _independently_ of the number of timers setup?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Timers that fall into a certain ms slice would all fire roughly at the same time
</I>&gt;<i> &gt; (still ordered).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Is that possible?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Thanks,
</I>&gt;<i> &gt; &gt; Tobias
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028607.html">[Twisted-Python] Scalability of timers
</A></li>
	<LI>Next message: <A HREF="028612.html">[Twisted-Python] Scalability of timers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28608">[ date ]</a>
              <a href="thread.html#28608">[ thread ]</a>
              <a href="subject.html#28608">[ subject ]</a>
              <a href="author.html#28608">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
