<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] reactor.stop() doesn't stop the select reactor?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20reactor.stop%28%29%20doesn%27t%20stop%20the%20select%20reactor%3F&In-Reply-To=%3CF8D3784FE4E93C4AA66BE8C551EBB5D1B5534E%40ntxbeus12.exchange.xchg%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048588.html">
   <LINK REL="Next"  HREF="048590.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] reactor.stop() doesn't stop the select reactor?</H1>
    <B>Benjamin Henry</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20reactor.stop%28%29%20doesn%27t%20stop%20the%20select%20reactor%3F&In-Reply-To=%3CF8D3784FE4E93C4AA66BE8C551EBB5D1B5534E%40ntxbeus12.exchange.xchg%3E"
       TITLE="[Twisted-Python] reactor.stop() doesn't stop the select reactor?">bhenry at pacecocorp.com
       </A><BR>
    <I>Tue Sep 25 13:52:35 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048588.html">[Twisted-Python] reactor.stop() doesn't stop the select reactor?
</A></li>
        <LI>Next message (by thread): <A HREF="048590.html">[Twisted-Python] reactor.stop() doesn't stop the select reactor?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48589">[ date ]</a>
              <a href="thread.html#48589">[ thread ]</a>
              <a href="subject.html#48589">[ subject ]</a>
              <a href="author.html#48589">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This response won't be as elegant as some, but you can't start the
reactor twice in the same process.  You can stop the reactor when the
service is ended (client or server), but with twistd, it starts and
stops itself.  

So, is it necessary that you start and stop the reactor to run the tests
in your code?  Why not make each test a callback?

Ben Henry
-----Original Message-----
From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>
[mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of Sam
Roberts
Sent: Tuesday, September 25, 2007 12:45 PM
To: twisted
Subject: [Twisted-Python] reactor.stop() doesn't stop the select
reactor?


I have unittests where each test:

  def test_this
     .. setup
     reactor.run() # ... when test is done reactor.stop() will be called

  def test_that
     .. same as above


does some setup, runs the reactor until test is complete, then stops the
reactor, asserting all went as intended.

However, second call to reactor.stop() doesn't stop the reactor. strace
shows reactor going back into select(), blocking forever, but killable
with sigquit.

Is this really intentional?

Example code and testrun follow.

~/w/engine % python t_reactor_stop.py
2.5.1 (r251:54863, May  2 2007, 16:27:44)
[GCC 4.1.2 (Ubuntu 4.1.2-0ubuntu4)]
[twisted, version 2.5.0]
&lt;twisted.internet.selectreactor.SelectReactor object at 0x2b684344a310&gt;
stopping reactor running? 1
reactor stopped
stopping reactor running? 1
zsh: quit (core dumped)  python t_reactor_stop.py



~/w/engine % cat t_reactor_stop.py
import sys

print sys.version

from twisted.internet import reactor

import twisted

print twisted._version.version
print reactor

def stop_reactor():
    print &quot;stopping reactor running? &quot; + repr(reactor.running)
    try:
        reactor.stop()
    except:
        print &quot;stop died!&quot;

reactor.callWhenRunning(stop_reactor)
reactor.run()
print &quot;reactor stopped&quot;
reactor.callWhenRunning(stop_reactor)
reactor.run()
# Unreachable, why?
print &quot;reactor stopped&quot;
reactor.callWhenRunning(stop_reactor)
reactor.run()
print &quot;reactor stopped&quot;



_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048588.html">[Twisted-Python] reactor.stop() doesn't stop the select reactor?
</A></li>
	<LI>Next message (by thread): <A HREF="048590.html">[Twisted-Python] reactor.stop() doesn't stop the select reactor?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48589">[ date ]</a>
              <a href="thread.html#48589">[ thread ]</a>
              <a href="subject.html#48589">[ subject ]</a>
              <a href="author.html#48589">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
