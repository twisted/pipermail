<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Properly handling Connection Refused
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Properly%20handling%20Connection%20Refused&In-Reply-To=%3C509588.36597.qm%40web715.biz.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048490.html">
   <LINK REL="Next"  HREF="048492.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Properly handling Connection Refused</H1>
    <B>Beau Hargis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Properly%20handling%20Connection%20Refused&In-Reply-To=%3C509588.36597.qm%40web715.biz.mail.mud.yahoo.com%3E"
       TITLE="[Twisted-Python] Properly handling Connection Refused">beau at subobscur.us
       </A><BR>
    <I>Wed Sep  5 13:37:16 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048490.html">[Twisted-Python] Properly handling Connection Refused
</A></li>
        <LI>Next message (by thread): <A HREF="048492.html">[Twisted-Python] Properly handling Connection Refused
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48491">[ date ]</a>
              <a href="thread.html#48491">[ thread ]</a>
              <a href="subject.html#48491">[ subject ]</a>
              <a href="author.html#48491">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well, it subclasses 'protocol.ClientFactory'. I did not try 'ReconnectingClientFactory' yet as I wanted a little bit more control of the reconnecting process at some point. In any case, these functions are defined in the class as such:

    def clientConnectionFailed(self, connector, reason):
        print 'Connection failed. Reason: ', reason
        reactor.callLater(random.randint(10,91), connector.connect)

    def clientConnectionLost(self, connector, reason):
        print 'Connection Lost. Reason: ', reason
        reactor.callLater(random.randint(10,91), connector.connect)

Works ok for every other problem except Connection Refused. When I first started testing reconnect, the seconds argument to callLater was constant like 3 or 4 seconds and it did the same thing.  Even immediate reconnection caused the same problem with Connection Refused: 111.

----- Original Message ----
From: Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt;
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Sent: Wednesday, September 5, 2007 12:29:15 PM
Subject: Re: [Twisted-Python] Properly handling Connection Refused

On Wed, 5 Sep 2007 12:24:35 -0700 (PDT), Beau Hargis &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">beau at subobscur.us</A>&gt; wrote:
&gt;<i>I have this application built in twisted that is pretty robust save for one thing. The server reconnects when it falters or fails for any reason EXCEPT a refused connection, which happens when connecting to services on the Windows servers we have where particular services have not yet been started, which is normal. Every other failure is handled gracefully, including the database disappearing suddenly. I print out the reason in the log and I get this error:
</I>&gt;<i>
</I>&gt;<i>[Uninitialized]  Reason:  [Failure instance: Traceback (failure with no frames): &lt;class 'twisted.internet.error.ConnectionRefusedError'&gt;: Connection was refused by other side: 111: Connection refused.
</I>&gt;<i>[Uninitialized] ]
</I>&gt;<i>[Uninitialized] Stopping factory &lt;SomeFactory instance at 0x88b77ac&gt;
</I>&gt;<i>
</I>&gt;<i>And the whole thing stops processing and does not restart the connection.
</I>
How did you implement reconnection?

Jean-Paul

_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048490.html">[Twisted-Python] Properly handling Connection Refused
</A></li>
	<LI>Next message (by thread): <A HREF="048492.html">[Twisted-Python] Properly handling Connection Refused
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48491">[ date ]</a>
              <a href="thread.html#48491">[ thread ]</a>
              <a href="subject.html#48491">[ subject ]</a>
              <a href="author.html#48491">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
