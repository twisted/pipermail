<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Wrapping a Perspective Broker remote object with	a blocking API
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Wrapping%20a%20Perspective%20Broker%20remote%20object%20with%0A%09a%20blocking%20API&In-Reply-To=%3Cbf82ea70709041943t5527d414rdd08c7c879cf1b02%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048484.html">
   <LINK REL="Next"  HREF="048475.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Wrapping a Perspective Broker remote object with	a blocking API</H1>
    <B>Rasjid Wilcox</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Wrapping%20a%20Perspective%20Broker%20remote%20object%20with%0A%09a%20blocking%20API&In-Reply-To=%3Cbf82ea70709041943t5527d414rdd08c7c879cf1b02%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Wrapping a Perspective Broker remote object with	a blocking API">rasjidw at gmail.com
       </A><BR>
    <I>Tue Sep  4 20:43:01 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048484.html">[Twisted-Python] Wrapping a Perspective Broker remote object	with a blocking API
</A></li>
        <LI>Next message (by thread): <A HREF="048475.html">Tell us how you're using Twisted (was Re: [Twisted-Python]	Win32 IOCPReactor?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48485">[ date ]</a>
              <a href="thread.html#48485">[ thread ]</a>
              <a href="subject.html#48485">[ subject ]</a>
              <a href="author.html#48485">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/4/07, Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt; wrote:
&gt;<i> The example code doesn't do anything with Events, and I'm not sure I
</I>&gt;<i> understand what you're describing above, so I don't know if that part
</I>&gt;<i> of your code is correct or not.
</I>
&gt;<i>From simple-client.py
</I>
def wait_factory():
    &quot;Returns a callback to apply to a deffered, and event to wait on&quot;
    evt = threading.Event()
    def set_event(result):
        evt.set()
        return result
    return set_event, evt

&gt;<i> &gt;I have not really looked into the thread safety issues yet, but have
</I>&gt;<i> &gt;been looking into reactor.callFromThread and whether it is required
</I>&gt;<i> &gt;here.
</I>&gt;<i>
</I>&gt;<i> Yes, it is.  As your code is now, it calls APIs which are not threadsafe
</I>&gt;<i> from a non-reactor thread.  This isn't allowed and will definitely result
</I>&gt;<i> in incorrect behavior sometimes.
</I>
I figured that was the case.  I was planning to fix this after getting
some feedback.  Which has been worthwhile, since I now know about
twisted.internet.blockingCallFromThread which would appear to do what
I want.

&gt;<i> &gt;If the entire approach is inherently broken for some reason, I'd like
</I>&gt;<i> &gt;to know so I can look at alternatives.
</I>&gt;<i>
</I>&gt;<i> I'm not sure why you're trying to do this at all, instead of just using
</I>&gt;<i> Twisted in a single-threaded manner.
</I>
Because the ultimate 'user' of the remote object will be a Visual Basic program.

My vision is as follows:
The Visual Basic program will talk to a python com server.
The python com server will run a PB client that will talk to a PB server.
The PB server will start a windows com component.
Everything gets relayed in a fairly transparent manner, and as far as
the VB program is concerned, it is just talking to a local com
component.

Standard DCOM does not really do what I want, since it assumes a
fairly fixed Client-Server model, whereas I want a peer-to-peer setup
where each node could be a client and a server.  PB would allow me to
do exactly that.

It might be possible to create a new twisted reactor that integrates
into the python com server event loop.  That would presumably be the
correct way to deal with this. But that would seem like far more work
that I have time to devote to this problem at this time.

So my question really is:
What are the problems / brawbacks with running the twisted reactor in
a non-main thread, provided all calls to the reactor are done through
twisted.internet.blockingCallFromThread?

Cheers,

Rasjid.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048484.html">[Twisted-Python] Wrapping a Perspective Broker remote object	with a blocking API
</A></li>
	<LI>Next message (by thread): <A HREF="048475.html">Tell us how you're using Twisted (was Re: [Twisted-Python]	Win32 IOCPReactor?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48485">[ date ]</a>
              <a href="thread.html#48485">[ thread ]</a>
              <a href="subject.html#48485">[ subject ]</a>
              <a href="author.html#48485">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
