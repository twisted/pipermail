<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Transmit queue - how would I go at it?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Transmit%20queue%20-%20how%20would%20I%20go%20at%20it%3F&In-Reply-To=%3C46ECA4C5.7080801%40mit.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048533.html">
   <LINK REL="Next"  HREF="048542.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Transmit queue - how would I go at it?</H1>
    <B>Nadav Aharony</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Transmit%20queue%20-%20how%20would%20I%20go%20at%20it%3F&In-Reply-To=%3C46ECA4C5.7080801%40mit.edu%3E"
       TITLE="[Twisted-Python] Transmit queue - how would I go at it?">nadav at MIT.EDU
       </A><BR>
    <I>Sat Sep 15 21:36:37 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048533.html">[Twisted-Python] Transmit queue - how would I go at it?
</A></li>
        <LI>Next message (by thread): <A HREF="048542.html">[Twisted-Python] Transmit queue - how would I go at it?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48540">[ date ]</a>
              <a href="thread.html#48540">[ thread ]</a>
              <a href="subject.html#48540">[ subject ]</a>
              <a href="author.html#48540">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Pablo!
this looks pretty clear and neat, I'll try it out.

Just one newbie question - is the &quot;_&quot;  in &quot;acquire_cb(_)&quot;  just a 
placeholder for my own parameters, or does it have an actual meaning?
I've never seen this done in python before, and couldn't find other 
examples for it online...

Cheers,
Nadav


Pablo Mart√≠ wrote:
&gt;<i> On Fri, 2007-09-14 at 00:58 -0400, Nadav Aharony wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> Hi, 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am working on an application where clients request files, and since
</I>&gt;&gt;<i> each file is very large, the server ACKs the requests and then queues
</I>&gt;&gt;<i> them to be served later, one at a time. 
</I>&gt;&gt;<i> I am relatively new to Twisted and was wondering what would be the
</I>&gt;&gt;<i> best way to approach this.
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Hi Nadav,
</I>&gt;<i>
</I>&gt;<i> I had a similar requirement with my application. You must offer an
</I>&gt;<i> asynchronous interface while dealing with each request synchronously. I
</I>&gt;<i> think that you should push your requests to a
</I>&gt;<i> twisted.internet.defer.DeferredQueue and process one at a time with the
</I>&gt;<i> aid of twisted.internet.defer.DeferredLock.
</I>&gt;<i>   
</I>&gt;<i>
</I>&gt;<i> If we consider that each of your petitions has an associated deferred
</I>&gt;<i> that will be called back when its finished:
</I>&gt;<i> (I haven't run this)
</I>&gt;<i>
</I>&gt;<i> from twisted.internet import defer
</I>&gt;<i>
</I>&gt;<i> class OneAtATime(object):
</I>&gt;<i>     def __init__(self):
</I>&gt;<i>         super(OneAtATime, self).__init__()
</I>&gt;<i>         self.queue = defer.DeferredQueue()
</I>&gt;<i>         self.lock = defer.DeferredLock()
</I>&gt;<i>         self.check_queue()
</I>&gt;<i>
</I>&gt;<i>     def check_queue(self):
</I>&gt;<i>         self.queue.get().addCallback(self._process_one)
</I>&gt;<i>     
</I>&gt;<i>     def _process_one(self, petition):
</I>&gt;<i>
</I>&gt;<i>         def acquire_cb(_):
</I>&gt;<i>             # do whatever with your petition
</I>&gt;<i>             # make sure that when you're done you call
</I>&gt;<i>             # self.lock.release() and self.check_queue()
</I>&gt;<i>             # on a state machine, this would be while transitioning
</I>&gt;<i>             # to the &quot;idle&quot; state
</I>&gt;<i>             pass
</I>&gt;<i>
</I>&gt;<i>         self.lock.acquire().addCallback(acquire_cb)
</I>&gt;<i>
</I>&gt;<i>     def queue_petition(self, petition):
</I>&gt;<i>         self.queue.put(petition)
</I>&gt;<i>         return petition.deferred
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Pablo
</I>&gt;<i>   
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>   
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20070915/4e81d145/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048533.html">[Twisted-Python] Transmit queue - how would I go at it?
</A></li>
	<LI>Next message (by thread): <A HREF="048542.html">[Twisted-Python] Transmit queue - how would I go at it?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48540">[ date ]</a>
              <a href="thread.html#48540">[ thread ]</a>
              <a href="subject.html#48540">[ subject ]</a>
              <a href="author.html#48540">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
