<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Properly handling Connection Refused
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Properly%20handling%20Connection%20Refused&In-Reply-To=%3C235579.52404.qm%40web712.biz.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048492.html">
   <LINK REL="Next"  HREF="048494.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Properly handling Connection Refused</H1>
    <B>Beau Hargis</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Properly%20handling%20Connection%20Refused&In-Reply-To=%3C235579.52404.qm%40web712.biz.mail.mud.yahoo.com%3E"
       TITLE="[Twisted-Python] Properly handling Connection Refused">beau at subobscur.us
       </A><BR>
    <I>Wed Sep  5 14:24:44 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048492.html">[Twisted-Python] Properly handling Connection Refused
</A></li>
        <LI>Next message (by thread): <A HREF="048494.html">[Twisted-Python] Properly handling Connection Refused
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48493">[ date ]</a>
              <a href="thread.html#48493">[ thread ]</a>
              <a href="subject.html#48493">[ subject ]</a>
              <a href="author.html#48493">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That small script worked as it should. The traceback is exactly the same as in my application. I just wonder where the '[Uninitialized]' is coming from. How is it ending up like that? Is it getting garbage collected for some reason? I can't catch the state of the port fast enough to see if it's anything else in the stack. I am using the poll reactor. I will change it back to the default select reactor and see if I see a problem with it again and see what other tracing I can do.

----- Original Message ----
From: Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at divmod.com</A>&gt;
To: Twisted general discussion &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
Sent: Wednesday, September 5, 2007 12:54:31 PM
Subject: Re: [Twisted-Python] Properly handling Connection Refused

On Wed, 5 Sep 2007 12:37:16 -0700 (PDT), Beau Hargis &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">beau at subobscur.us</A>&gt; wrote:
&gt;<i>Well, it subclasses 'protocol.ClientFactory'. I did not try 'ReconnectingClientFactory' yet as I wanted a little bit more control of the reconnecting process at some point. In any case, these functions are defined in the class as such:
</I>&gt;<i>
</I>&gt;<i>    def clientConnectionFailed(self, connector, reason):
</I>&gt;<i>        print 'Connection failed. Reason: ', reason
</I>&gt;<i>        reactor.callLater(random.randint(10,91), connector.connect)
</I>&gt;<i>
</I>&gt;<i>    def clientConnectionLost(self, connector, reason):
</I>&gt;<i>        print 'Connection Lost. Reason: ', reason
</I>&gt;<i>        reactor.callLater(random.randint(10,91), connector.connect)
</I>&gt;<i>
</I>&gt;<i>Works ok for every other problem except Connection Refused. When I first started testing reconnect, the seconds argument to callLater was constant like 3 or 4 seconds and it did the same thing.  Even immediate reconnection caused the same problem with Connection Refused: 111.
</I>
This looks as though it should work.  If I run a similar test program, like
this:

  from twisted.internet.protocol import ClientFactory, Protocol
  from twisted.internet import reactor

  class Reconnecter(ClientFactory):
      def clientConnectionFailed(self, connector, reason):
          print reason
          reactor.callLater(5, connector.connect)

  reactor.connectTCP('localhost', 12345, Reconnecter())
  reactor.run()

where nothing is bound to localhost:12345, then I see a connection refused
message every five seconds for as long as I allow it to run.

Can you see if this simple program exhibits the same behavior as your
application?

It would also be worth determining if your application is receiving the
clientConnectionFailed notification but then failing to attempt another
connection (ie, some problem with the callLater), if it is attempting the
next connection but that is never happening (ie, some problem with the
connector.connect), or if clientConnectionFailed isn't even being called
for the connection which is failing (some problem inside the reactor with
failed connection detection/notification).

If you can, it would also be useful to know what the operating system thinks
the state of the socket used for the connection attempt is.  On Linux, you
can get this with a tool like netstat.

Jean-Paul

_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048492.html">[Twisted-Python] Properly handling Connection Refused
</A></li>
	<LI>Next message (by thread): <A HREF="048494.html">[Twisted-Python] Properly handling Connection Refused
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48493">[ date ]</a>
              <a href="thread.html#48493">[ thread ]</a>
              <a href="subject.html#48493">[ subject ]</a>
              <a href="author.html#48493">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
