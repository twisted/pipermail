<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] reactor.stop() doesn't stop the select reactor?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20reactor.stop%28%29%20doesn%27t%20stop%20the%20select%20reactor%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016078.html">
   <LINK REL="Next"  HREF="016080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] reactor.stop() doesn't stop the select reactor?</H1>
    <B>Sam Roberts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20reactor.stop%28%29%20doesn%27t%20stop%20the%20select%20reactor%3F&In-Reply-To="
       TITLE="[Twisted-Python] reactor.stop() doesn't stop the select reactor?">sroberts at uniserve.com
       </A><BR>
    <I>Tue Sep 25 15:45:07 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="016078.html">[Twisted-Python] waiting for data before shutdown
</A></li>
        <LI>Next message: <A HREF="016080.html">[Twisted-Python] reactor.stop() doesn't stop the select reactor?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16079">[ date ]</a>
              <a href="thread.html#16079">[ thread ]</a>
              <a href="subject.html#16079">[ subject ]</a>
              <a href="author.html#16079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I have unittests where each test:

  def test_this
     .. setup
     reactor.run() # ... when test is done reactor.stop() will be called

  def test_that
     .. same as above


does some setup, runs the reactor until test is complete, then stops the
reactor, asserting all went as intended.

However, second call to reactor.stop() doesn't stop the reactor. strace
shows reactor going back into select(), blocking forever, but killable
with sigquit.

Is this really intentional?

Example code and testrun follow.

~/w/engine % python t_reactor_stop.py
2.5.1 (r251:54863, May  2 2007, 16:27:44)
[GCC 4.1.2 (Ubuntu 4.1.2-0ubuntu4)]
[twisted, version 2.5.0]
&lt;twisted.internet.selectreactor.SelectReactor object at 0x2b684344a310&gt;
stopping reactor running? 1
reactor stopped
stopping reactor running? 1
zsh: quit (core dumped)  python t_reactor_stop.py



~/w/engine % cat t_reactor_stop.py
import sys

print sys.version

from twisted.internet import reactor

import twisted

print twisted._version.version
print reactor

def stop_reactor():
    print &quot;stopping reactor running? &quot; + repr(reactor.running)
    try:
        reactor.stop()
    except:
        print &quot;stop died!&quot;

reactor.callWhenRunning(stop_reactor)
reactor.run()
print &quot;reactor stopped&quot;
reactor.callWhenRunning(stop_reactor)
reactor.run()
# Unreachable, why?
print &quot;reactor stopped&quot;
reactor.callWhenRunning(stop_reactor)
reactor.run()
print &quot;reactor stopped&quot;




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016078.html">[Twisted-Python] waiting for data before shutdown
</A></li>
	<LI>Next message: <A HREF="016080.html">[Twisted-Python] reactor.stop() doesn't stop the select reactor?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16079">[ date ]</a>
              <a href="thread.html#16079">[ thread ]</a>
              <a href="subject.html#16079">[ subject ]</a>
              <a href="author.html#16079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
