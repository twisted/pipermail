<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] reconnecting from the client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20reconnecting%20from%20the%20client&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008179.html">
   <LINK REL="Next"  HREF="008180.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] reconnecting from the client</H1>
    <B>Bosnjak Zoran    ITWEP</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20reconnecting%20from%20the%20client&In-Reply-To="
       TITLE="[Twisted-Python] reconnecting from the client">Bosnjak at iskratel.si
       </A><BR>
    <I>Mon Jul 26 11:13:37 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008179.html">[Twisted-Python] Writing a plug-in for an online game that uses	UDP
</A></li>
        <LI>Next message: <A HREF="008180.html">[Twisted-Python] reconnecting from the client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8174">[ date ]</a>
              <a href="thread.html#8174">[ thread ]</a>
              <a href="subject.html#8174">[ subject ]</a>
              <a href="author.html#8174">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
in my simple client I need a mechanism for reconnecting to the server:

1. If the server is not responding at the momment, the client should keep trying to connect
2. If the connection once become active and the server is restarted, the client should reconnect
3. If the connection is active and no data can be transmited / received for X seconds (link down, router down),
   the client should try to reconnect as in the case (1.) (as if the client has never been connected)
   It should react in less then 10 seconds.

Unfortunately I can not detect the situation (3.). If I unplug the ethernet while connected, none of my methods is called (ever).
I couldn't find anything like this in the documentation or in the examples.

Here is my testfile:
--------------
from twisted.internet.protocol import Protocol, ReconnectingClientFactory
from twisted.internet import reactor

class Echo(Protocol):
    def dataReceived(self, data):
        print data

    def connectionLost(self, reason):
        print 'connection lost', reason

    def connectionMade(self):
        reactor.callLater(1.0, self.ping)
        print 'connection made'

    def ping(self, *args):
        self.transport.write('test')
        reactor.callLater(1.0, self.ping)

class EchoClientFactory(ReconnectingClientFactory):
    maxDelay = 3
    def startedConnecting(self, connector):
        print 'started to connect'

    def buildProtocol(self, addr):
        print 'connected'
        self.resetDelay()
        return Echo()

    def clientConnectionLost(self, connector, reason):
        print 'lost connection', reason
        ReconnectingClientFactory.clientConnectionLost(self, connector, reason)

    def clientConnectionFailed(self, connector, reason):
        print 'connection failed', reason
        ReconnectingClientFactory.clientConnectionFailed(self, connector, reason)

reactor.connectTCP('10.10.2.77', 23, EchoClientFactory())
reactor.run()

--------------

regards,
Zoran Bosnjak



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008179.html">[Twisted-Python] Writing a plug-in for an online game that uses	UDP
</A></li>
	<LI>Next message: <A HREF="008180.html">[Twisted-Python] reconnecting from the client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8174">[ date ]</a>
              <a href="thread.html#8174">[ thread ]</a>
              <a href="subject.html#8174">[ subject ]</a>
              <a href="author.html#8174">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
