<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Re: [Twisted-commits] r11107 - Delete	fundamentally broken test.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r11107%20-%20Delete%0A%09fundamentally%20broken%20test.&In-Reply-To=20040723140723.GE30670%40frobozz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008165.html">
   <LINK REL="Next"  HREF="008163.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Re: [Twisted-commits] r11107 - Delete	fundamentally broken test.</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Re%3A%20%5BTwisted-commits%5D%20r11107%20-%20Delete%0A%09fundamentally%20broken%20test.&In-Reply-To=20040723140723.GE30670%40frobozz"
       TITLE="[Twisted-Python] Re: [Twisted-commits] r11107 - Delete	fundamentally broken test.">foom at fuhm.net
       </A><BR>
    <I>Fri Jul 23 11:02:02 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008165.html">[Twisted-Python] Re: [Twisted-commits] r11107 - Delete	fundamentally broken test.
</A></li>
        <LI>Next message: <A HREF="008163.html">[Twisted-Python] Re: [Twisted-commits] r11107 - Delete	fundamentally broken test.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8162">[ date ]</a>
              <a href="thread.html#8162">[ thread ]</a>
              <a href="subject.html#8162">[ subject ]</a>
              <a href="author.html#8162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sigh I probably ought to have read the process_pausing.py script, too. 
:<i>) I was wrongly assuming it was just doing something nice and simple. 
</I>Anyhow, I can see how it could easily cause spurious failures, as it's 
depending on the process scheduling doing *just* what it wants, which 
is obviously unreliable.

That it hangs is still a bad thing, since even if the timing is wrong, 
it oughtn't be hanging.
...
But I have traced down the problem:
&quot;if len(self.data) != 5: raise ValueError&quot;
Apparently, the exception raised from inside processEnded just gets 
eaten somewhere instead of raised back through to the test framework. 
Thus, if the test takes more than 9.999 seconds to complete, it will 
raise an exception and not set self.elapsed. Then, the test will sit in 
the reactor.iterate loop forever waiting for self.elapsed to be set.

Okay, I'm satisfied the error was completely in the test. However, it 
does now seem that pauseProducing isn't tested at all.

James

On Jul 23, 2004, at 10:07 AM, Andrew Bennetts wrote:

&gt;<i> On Fri, Jul 23, 2004 at 09:38:56AM -0400, James Y Knight wrote:
</I>&gt;&gt;<i> Wait, wait, that causes *hangs*? That seems like a bad thing. It
</I>&gt;&gt;<i> doesn't look like an obviously wrong thing to do to me. Do you know
</I>&gt;&gt;<i> *why* it's hanging?
</I>&gt;<i>
</I>&gt;<i> I'm not sure why it's hanging, and I'd be happy for someone to figure 
</I>&gt;<i> out
</I>&gt;<i> why.  Ideally they'd fix the problem too, if there is one.
</I>&gt;<i>
</I>&gt;<i> My suspicion is that the bug is in that test, not in Twisted, though.  
</I>&gt;<i> The
</I>&gt;<i> process_pausing.py script itself is far too ugly to have any 
</I>&gt;<i> confidence in.
</I>&gt;<i> It tries to detect that writes to stdout block by looking at times, 
</I>&gt;<i> which is
</I>&gt;<i> extremely fragile.  Worse, detecting that writing to stdout blocks 
</I>&gt;<i> doesn't
</I>&gt;<i> necessarily prove anything anyway: the intention (presumably, the test 
</I>&gt;<i> has
</I>&gt;<i> no comments) is apparently to test that pauseProducing on a transport 
</I>&gt;<i> will
</I>&gt;<i> cause pipes from a child process to be unread and hence let the buffers
</I>&gt;<i> fill.  But the child process could just as easily be finding that the 
</I>&gt;<i> writes
</I>&gt;<i> are blocking because it's simply writing more frequently than the 
</I>&gt;<i> parent is
</I>&gt;<i> reading, e.g. due to scheduling anomalies...
</I>&gt;<i>
</I>&gt;<i> I'm also not aware of any real world reports of problems with the 
</I>&gt;<i> process
</I>&gt;<i> code hanging, despite the test being pretty prone to intermittent 
</I>&gt;<i> failure,
</I>&gt;<i> which is also highly suggestive that the test is broken, not the code.
</I>&gt;<i>
</I>&gt;<i> I also have difficulty imagining a scenario which would rely upon this
</I>&gt;<i> behaviour.  The OS is free to buffer writes to pipes as much as it 
</I>&gt;<i> wants,
</I>&gt;<i> even if the other end is unread, so this isn't something that can be
</I>&gt;<i> portably relied on to give any useful information.  If the parent 
</I>&gt;<i> really
</I>&gt;<i> wants to signal to the child that it should behave differently, then 
</I>&gt;<i> ought
</I>&gt;<i> to tell that to the child directly, either via a message down a pipe, 
</I>&gt;<i> or a
</I>&gt;<i> signal, or some other channel.  Relying upon indirect side-effects 
</I>&gt;<i> doesn't
</I>&gt;<i> strike me as a good practice.
</I>&gt;<i>
</I>&gt;<i> In short: the test's intention is undocumented, and appears to be 
</I>&gt;<i> testing
</I>&gt;<i> something fundamentally unuseful, and is contributing zero additional
</I>&gt;<i> confidence in the code base by being in the test suite, but is 
</I>&gt;<i> contributing
</I>&gt;<i> a considerable amount of noise on the buildbot due to failures that 
</I>&gt;<i> are more
</I>&gt;<i> than likely spurious.  We're better off without it.
</I>&gt;<i>
</I>&gt;<i> -Andrew.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008165.html">[Twisted-Python] Re: [Twisted-commits] r11107 - Delete	fundamentally broken test.
</A></li>
	<LI>Next message: <A HREF="008163.html">[Twisted-Python] Re: [Twisted-commits] r11107 - Delete	fundamentally broken test.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8162">[ date ]</a>
              <a href="thread.html#8162">[ thread ]</a>
              <a href="subject.html#8162">[ subject ]</a>
              <a href="author.html#8162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
