<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Soon to be not-a-newbie?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Soon%20to%20be%20not-a-newbie%3F&In-Reply-To=200801261251.34563.maarten%40treewalker.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016665.html">
   <LINK REL="Next"  HREF="016656.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Soon to be not-a-newbie?</H1>
    <B>Justin Warren</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Soon%20to%20be%20not-a-newbie%3F&In-Reply-To=200801261251.34563.maarten%40treewalker.org"
       TITLE="[Twisted-Python] Soon to be not-a-newbie?">daedalus at eigenmagic.com
       </A><BR>
    <I>Sun Jan 27 21:47:48 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016665.html">[Twisted-Python] Soon to be not-a-newbie?
</A></li>
        <LI>Next message: <A HREF="016656.html">[Twisted-Python] Soon to be not-a-newbie?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16681">[ date ]</a>
              <a href="thread.html#16681">[ thread ]</a>
              <a href="subject.html#16681">[ subject ]</a>
              <a href="author.html#16681">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 2008-01-26 at 12:51 +0100, Maarten ter Huurne wrote:
&gt;<i> On Saturday 26 January 2008, Tristan Seligmann wrote:
</I>
&gt;<i> &gt; Most deferred operations have no need to 
</I>&gt;<i> &gt; be serialized, and shouldn't be; the linear nature of
</I>&gt;<i> &gt; inlineCallbacks-style makes it very easy to accidentally serialize
</I>&gt;<i> &gt; operations that could otherwise run in parallel instead. Even if you
</I>&gt;<i> &gt; write the generator correctly, it's not as obvious what the actual flow
</I>&gt;<i> &gt; is since it has been crunched into a linear-looking function.
</I>
I dunno about this. Serialisation is really common, in my experience.
People are also more used to thinking about things in terms of
sequential actions (do this, then do this, then do this other thing),
which is probably one reason why parallel programming is hard, and why
inlineCallbacks are so appealing.

&gt;<i> There are quite a few cases in which the dependencies between the operations 
</I>&gt;<i> force sequential processing. In those cases, inline callbacks are useful.
</I>&gt;<i> 
</I>&gt;<i> For example, to serve a web page, I want to authenticate the user, then run 
</I>&gt;<i> a database query and finally present the result. Running the query before 
</I>&gt;<i> authenticating the user is not something I'd recommend. In some cases it 
</I>&gt;<i> might be possible to start presenting results before all queries are 
</I>&gt;<i> finished, but in many cases that is not worth the complexity.
</I>
Hear hear.

I have a bunch of code that has benefited from refactoring to use
inlineCallbacks for exactly these reasons. Sometimes there is a
sequential flow of data from function to function:

for device in device_list:
  get_some_data_from_device()
    |--parse_data_and_fetch_more_based_on_parse_result()
       |--parse_this_stuff_and_insert_into_database_maybe()
          |--reschedule_poll_for_data()

Manually setting up the deferredChain made my code hard (for me) to
read. Maybe I'm just a bad coder.

&gt;<i> Writing all your routines as inline callbacks without thinking about the 
</I>&gt;<i> dependencies is a bad idea though.
</I>
Not thinking about what you're doing is generally bad, yes, but what if
you were to write everything with inlineCallbacks, then optimise to make
needlessly sequential parts parallel?

I've used inlineCallbacks to quickly convert someone else's blocking
Python code to async twisted code, with very little change to the code's
structural flow. The last time I did this, without inlineCallbacks, was
painful, buggy and slow. Anything that helps me unblock code with
twisted is good.

&gt;<i> &gt; Finally, 
</I>&gt;<i> &gt; it is extremely hard to unit test a generator using inlineCallbacks, as
</I>&gt;<i> &gt; there is no easy way of resuming the generator at certain points with
</I>&gt;<i> &gt; certain state to test each part of the generator.
</I>&gt;<i> 
</I>&gt;<i> If the code using inline callbacks looks like this, there is no problem in 
</I>&gt;<i> testing the parts separately:
</I>&gt;<i> 
</I>&gt;<i> 	result1 = yield function1(arg)
</I>&gt;<i> 	result2 = yield function2(result1)
</I>&gt;<i> 
</I>&gt;<i> &gt; I'm not necessarily convinced that inlineCallbacks is always bad, but it
</I>&gt;<i> &gt; certainly leads to subtle traps in most cases, while providing little
</I>&gt;<i> &gt; real benefit (despite the perceived benefit).
</I>&gt;<i> 
</I>&gt;<i> I've converted some routines I wrote before Twisted 2.5 to inline callbacks 
</I>&gt;<i> and it became a lot easier for me to read. Like any tool, it can be used or 
</I>&gt;<i> abused, but I definately think it has its uses.
</I>
Yep. The biggest benefit for me has been to make my twisted code feel
more readable overall, which is one of the best bits about Python. In
the past I've felt a bit guilty when writing complex deferred chains
with twisted.. almost like I'd just done something in perl. ;)

Heh. I'm such a fanboy.

-- 
Justin Warren &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">daedalus at eigenmagic.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016665.html">[Twisted-Python] Soon to be not-a-newbie?
</A></li>
	<LI>Next message: <A HREF="016656.html">[Twisted-Python] Soon to be not-a-newbie?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16681">[ date ]</a>
              <a href="thread.html#16681">[ thread ]</a>
              <a href="subject.html#16681">[ subject ]</a>
              <a href="author.html#16681">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
