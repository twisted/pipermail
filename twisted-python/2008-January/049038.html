<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Performance and select.select
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Performance%20and%20select.select&In-Reply-To=%3C20080104031940.31425.2014724949.divmod.quotient.459%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049068.html">
   <LINK REL="Next"  HREF="049069.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Performance and select.select</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Performance%20and%20select.select&In-Reply-To=%3C20080104031940.31425.2014724949.divmod.quotient.459%40ohm%3E"
       TITLE="[Twisted-Python] Performance and select.select">exarkun at divmod.com
       </A><BR>
    <I>Thu Jan  3 20:19:40 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049068.html">[Twisted-Python] Performance and select.select
</A></li>
        <LI>Next message (by thread): <A HREF="049069.html">[Twisted-Python] Performance and select.select
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49038">[ date ]</a>
              <a href="thread.html#49038">[ thread ]</a>
              <a href="subject.html#49038">[ subject ]</a>
              <a href="author.html#49038">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 04 Jan 2008 03:42:10 +0100, Nitro &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nitro at dr-code.org</A>&gt; wrote:
&gt;<i>Hello,
</I>&gt;<i>
</I>&gt;<i>I profiled my application with cProfiler. Below is an excerpt from the 
</I>&gt;<i>resulting report:
</I>&gt;<i>
</I>&gt;<i>Fri Jan 04 01:07:39 2008    profiling_data_cProfile
</I>&gt;<i>
</I>&gt;<i>          15123197 function calls (14579262 primitive calls) in 228.517 CPU 
</I>&gt;<i>seconds
</I>&gt;<i>
</I>&gt;<i>    Ordered by: internal time
</I>&gt;<i>    List reduced from 2933 to 50 due to restriction &lt;50&gt;
</I>&gt;<i>
</I>&gt;<i>    ncalls  tottime  percall  cumtime  percall filename:lineno(function)
</I>&gt;<i>    138305  135.419    0.001  135.817    0.001 {select.select}
</I>&gt;<i>     26168   13.159    0.001   14.044    0.001 
</I>&gt;<i>Sources\Server\Plugins\RKSimulation.py:218(UpdatePhysics)
</I>&gt;<i>
</I>&gt;<i>As you can see select.select takes up ~136 of ~229 seconds. This is the 
</I>&gt;<i>most expensive function. The row below shows the next expensive function 
</I>&gt;<i>which is one of my own. Now I am wondering whether
</I>&gt;<i>
</I>&gt;<i>a) the select calls are really taking up that much time (more than 50%!)
</I>&gt;<i>b) if they are taking up that much time I'd like to find out how to reduce 
</I>&gt;<i>their execution time (either by minimizing the number it gets called or  the 
</I>&gt;<i>time it takes to execute etc)
</I>&gt;<i>
</I>&gt;<i>My application doesn't invoke select.select itself so it is most likely 
</I>&gt;<i>called within twisted. I am on Windows and using the default reactor  (&quot;from 
</I>&gt;<i>twisted.internet import reactor&quot;).
</I>
Twisted does use select by default on Windows.  One thing you might try is
one of the other reactors available on Windows; there are two,
win32eventreactor and iocpreactor.  You can read about how to do this here:

<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html">http://twistedmatrix.com/projects/core/documentation/howto/choosing-reactor.html</A>

Depending on what your application does, iocpreactor may not be complete
enough to actually run your code.  It lacks some features provided by the
default reactor.

Whether either of these reactors will actually improve the performance of
your application, I don't know.  You pointed out that a lot of time is
spent in select, but this doesn't mean that spending less time inside the
event notification function will make your overall application faster.

Also, you are right to be suspicious of these profile results.  Python has
a very spotty history when it comes to profilers.  They are often inaccurate
or completely wrong.  cProfile is supposed to be better than the previous
attempts, but I haven't personally used it extensively enough (nor at all on
Windows) to say whether this is true.

Some things to consider are:

  * How many simultaneous connections does your application have?  select
    usually scales linearly with this number.  I'm not sure exactly what it
    does on Windows, though.

  * How often do connections have events?  Is data passing through them
    constantly or are they mostly idle?  More events means more trips into
    select, which incurs setup costs more.  Fewer events means select should
    be spending more of its time idling, waiting for events.

  * How often do timed events go off?  These also cause more trips into
    select, since each one causes select to return when it is time to run.
    Do you use reactor.callLater() with a 0 timeout a lot?

Hope this helps,

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049068.html">[Twisted-Python] Performance and select.select
</A></li>
	<LI>Next message (by thread): <A HREF="049069.html">[Twisted-Python] Performance and select.select
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49038">[ date ]</a>
              <a href="thread.html#49038">[ thread ]</a>
              <a href="subject.html#49038">[ subject ]</a>
              <a href="author.html#49038">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
