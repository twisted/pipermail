<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferredGenerator or inlineCallbacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferredGenerator%20or%20inlineCallbacks&In-Reply-To=m3prw3ha0e.fsf%40neo.luffy.cx">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016574.html">
   <LINK REL="Next"  HREF="016573.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferredGenerator or inlineCallbacks</H1>
    <B>Justin Warren</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferredGenerator%20or%20inlineCallbacks&In-Reply-To=m3prw3ha0e.fsf%40neo.luffy.cx"
       TITLE="[Twisted-Python] deferredGenerator or inlineCallbacks">daedalus at eigenmagic.com
       </A><BR>
    <I>Tue Jan 15 04:18:59 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016574.html">[Twisted-Python] deferredGenerator or inlineCallbacks
</A></li>
        <LI>Next message: <A HREF="016573.html">[Twisted-Python] Re: Twisted-Python Digest, Vol 46, Issue 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16575">[ date ]</a>
              <a href="thread.html#16575">[ thread ]</a>
              <a href="subject.html#16575">[ subject ]</a>
              <a href="author.html#16575">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2008-01-15 at 07:34 +0100, Vincent Bernat wrote:
&gt;<i> OoO En ce  milieu de nuit &#233;toil&#233;e du mardi 15  janvier 2008, vers 03:53,
</I>&gt;<i> 
</I>&gt;<i> Can we use exceptions?
</I>
Yes, it appears so.

You do something like this:

@defer.inlineCallbacks
def my_inline_function():
    try:

        # call a function that returns a Deferred, but that might
        # raise an Exception somewhere, which will trigger the
        # .errback() of the deferred that gets returned
        value = yield function_to_get_value_that_raises_exception()

    except Exception, e:    # poor form, but useful for an example
        print &quot;Caught an exception:&quot;, e

The Exception that gets caught will be whatever Exception was wrapped up
in the Failure that gets passed to the .errback(). Some neat magic is
happening under the covers to unwrap the Exception from the Failure, so
you can use normal logic like this.

Beware in your own code: make sure that you don't just raise an
Exception where you should be calling an .errback(), or you'll see
'Unhandled error in Deferred' messages.

Executable demo code follows.

As an aside, thanks to the Twisted Matrix folks for this sweet
enhancement to twisted. Glyph gets the main blame, because he's listed
as the maintainer in twisted.internet.defer. Kudos!

#
# inlineDeferred try/except demo
#
def later_processing(d):
    # This must be an .errback(), not just a bare 'raise'
    # or I'm actually raising the error outside of the
    # Deferred chain.
    if True:  # simulate a test for an error condition
        # simulate triggering an errback on error
        d.errback( ValueError(&quot;My error!&quot;) )
    else:
        # Simulating normal behaviour
        d.callback(&quot;success!&quot;)

def deferred_fetch_value():
    &quot;&quot;&quot;
    Simulate waiting for a deferred thing to fetch a value
    &quot;&quot;&quot;
    d = defer.Deferred()
    reactor.callLater(1, later_processing, d)
    return d

@defer.inlineCallbacks
def get_value():
    &quot;&quot;&quot;
    Sample function to get a value, which will asyncronously block
waiting
    for a deferred.
    &quot;&quot;&quot;
    try:
        value = yield deferred_fetch_value()
        defer.returnValue( value )
    except ValueError, e:
        print &quot;caught exception:&quot;, e
        #defer.returnValue( None )
        pass

@defer.inlineCallbacks
def get_value2():
    &quot;&quot;&quot;
    Sample function to get a value, which will asyncronously block
waiting
    for a deferred.
    &quot;&quot;&quot;
    value = yield deferred_fetch_value()
    defer.returnValue( value )

def my_error(failure):
    print &quot;an error occurred: %s&quot;, failure
    reactor.stop()

def mystop(ignored):
    reactor.stop()

@defer.inlineCallbacks
def call_get_value():
    print &quot;fetching value...&quot;
    value = yield get_value()
    print &quot;got value:&quot;, value

def go():
    d = call_get_value()
    d.addCallback(mystop)
    d.addErrback(my_error)

reactor.callLater(0, go)
reactor.run()

-- 
Justin Warren &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">daedalus at eigenmagic.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016574.html">[Twisted-Python] deferredGenerator or inlineCallbacks
</A></li>
	<LI>Next message: <A HREF="016573.html">[Twisted-Python] Re: Twisted-Python Digest, Vol 46, Issue 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16575">[ date ]</a>
              <a href="thread.html#16575">[ thread ]</a>
              <a href="subject.html#16575">[ subject ]</a>
              <a href="author.html#16575">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
