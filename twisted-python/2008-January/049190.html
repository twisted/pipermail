<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Stoping a deferedList
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Stoping%20a%20deferedList&In-Reply-To=%3C479DE6B7.8060103%40nu.no%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049192.html">
   <LINK REL="Next"  HREF="049191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Stoping a deferedList</H1>
    <B>tarjei</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Stoping%20a%20deferedList&In-Reply-To=%3C479DE6B7.8060103%40nu.no%3E"
       TITLE="[Twisted-Python] Stoping a deferedList">tarjei at nu.no
       </A><BR>
    <I>Mon Jan 28 07:29:11 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049192.html">[Twisted-Python] Making inlineCallback return a generator
</A></li>
        <LI>Next message (by thread): <A HREF="049191.html">[Twisted-Python] Stoping a deferedList
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49190">[ date ]</a>
              <a href="thread.html#49190">[ thread ]</a>
              <a href="subject.html#49190">[ subject ]</a>
              <a href="author.html#49190">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,

I'm using the FtpClient to upload a set of files. I start the uploads
with the following code:


   def fileError(self, result):
        log.msg(&quot;Error has happened&quot; + result.getErrorMessage())
        log.msg(result.trap(Exception))
        return result

    def endError(self, result):
        log.msg(&quot;End Error has happened&quot;)
        self.client.quit()
        self.client.transport.loseConnection()
        result.trap(Exception)

    def connectionMade(self,ftpClient):
        &quot;Checks if there are more files to upload and uploads them.&quot;
        deffereds = []
        &quot;We'll need the client to do a disconnect later&quot;
        self.client = ftpClient
        &quot; Create defereds for each of the different files to be uploaded&quot;
        for upfile in self.ftpFiles:
            store, finish = ftpClient.storeFile(self._getPath(
upfile.get_name() ) )
            finish.addCallback(self.end).addErrback(self.fileError)
            store.addCallback(self.send_file, upfile
).addErrback(self.fileError)
            deffereds.append(store)
            deffereds.append(finish)
            self.numfiles += 1
        return
defer.gatherResults(deffereds).addCallback(self.success).addErrback(self.endError)


Now, if an error happens during the upload of one file, then I want to
stop the other files as well and close the connection. When I try to run
tests using the above code, trial reports that it still has open
connections.

The code works fine if user has access to save the files, it is the
error handling I want to get done right.

What should I do to ensure that all connections get closed when an error
happens?

kind regards,
Tarjei
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org">http://enigmail.mozdev.org</A>

iD8DBQFHnea3YVRKCnSvzfIRAh3RAJ9lrMzQBJOMtIo1qcuntbkZlX5HMACfZNS8
St7eOg43MC4mTR2Qh9XWAX4=
=aJCZ
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049192.html">[Twisted-Python] Making inlineCallback return a generator
</A></li>
	<LI>Next message (by thread): <A HREF="049191.html">[Twisted-Python] Stoping a deferedList
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49190">[ date ]</a>
              <a href="thread.html#49190">[ thread ]</a>
              <a href="subject.html#49190">[ subject ]</a>
              <a href="author.html#49190">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
