<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferredGenerator or inlineCallbacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferredGenerator%20or%20inlineCallbacks&In-Reply-To=1200360857.6971.29.camel%40localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016569.html">
   <LINK REL="Next"  HREF="016571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferredGenerator or inlineCallbacks</H1>
    <B>Justin Warren</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferredGenerator%20or%20inlineCallbacks&In-Reply-To=1200360857.6971.29.camel%40localhost"
       TITLE="[Twisted-Python] deferredGenerator or inlineCallbacks">daedalus at eigenmagic.com
       </A><BR>
    <I>Mon Jan 14 21:53:07 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="016569.html">[Twisted-Python] deferredGenerator or inlineCallbacks
</A></li>
        <LI>Next message: <A HREF="016571.html">[Twisted-Python] deferredGenerator or inlineCallbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16570">[ date ]</a>
              <a href="thread.html#16570">[ thread ]</a>
              <a href="subject.html#16570">[ subject ]</a>
              <a href="author.html#16570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2008-01-15 at 12:34 +1100, Justin Warren wrote:
&gt;<i> Hi folks,
</I>&gt;<i> 
</I>&gt;<i> I think I have a fundamental misunderstanding of how deferredGenerator
</I>&gt;<i> (or inlineCallbacks for Python2.5) work.
</I>&gt;<i> 
</I>&gt;<i> What I *want* to do, is something like this:
</I>&gt;<i> 
</I>&gt;<i> aValue = MyObject.get_a_value()
</I>
Aha!

Replying to my own post, I know, but I think I found the insight that
was preventing me from grokking this mechanism.

Adding @defer.deferredGenerator or @defer.inlineCallbacks 'turns on' the
inline callback mechanism *within that function*. You can then use the
inline yield syntax to perform sequential operations that are actually
asynchronous things that 'wait' for the operation to complete before
continuing to the next bit of code.

So, to do what I wanted to do, I needed to think about things
differently. Here's a concrete example:

I wanted to use the ZAPITool.zapi_request() function from my ModiPY code
to query a NetApp filer via its ZAPI (XML over HTTP) protocol. This
function returns a Deferred() that will .callback() or errback() when a
result is available.

So, I want to fetch the version of the filer OS. Normally, I'd use
something like this:

zpt = ZAPITool()
d = zpt.zapi_request('&lt;system-get-version/&gt;')

def got_result(result):
    print &quot;Got a result:&quot;, result
    # Do something with the result

d.addCallback( got_result )

Which is messy, verbose, and annoying.

I can do this using inlineCallbacks thusly:

@defer.inlineCallbacks    # turn on inline callback functionality
def do_some_inline_callback_stuff():
    zpt = ZAPITool()
    result = yield zpt.zapi_request('&lt;system-get-version/&gt;')
    print &quot;Got a result:&quot;, result
    # Do something with the result
    ...

    # Do another fetch
    result = yield zpt.zapi_request('&lt;options-list-info/&gt;')
    print &quot;Filer options are:&quot;, result

    # and so on


w00t!

Note that you cannot

    return result

from within do_some_inline_callback_stuff(), because this is actually a
generator now, since it contains a yield.

This is quite neat stuff.. though it feels a bit sneaky and magical.

-- 
Justin Warren &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">daedalus at eigenmagic.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016569.html">[Twisted-Python] deferredGenerator or inlineCallbacks
</A></li>
	<LI>Next message: <A HREF="016571.html">[Twisted-Python] deferredGenerator or inlineCallbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16570">[ date ]</a>
              <a href="thread.html#16570">[ thread ]</a>
              <a href="subject.html#16570">[ subject ]</a>
              <a href="author.html#16570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
