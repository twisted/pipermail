<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Fw: [Twisted-Python] Different behavior under Windows and Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%3D%3Fkoi8-r%3FQ%3FFw%3D3A_%5BTwisted-Python%5D_Different_behavior_under_Windows_and_Linux%3F%3D&In-Reply-To=%3CE1JA2Yd-0005Np-00.wlad-karyagin-mail-ru%40f130.mail.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049031.html">
   <LINK REL="Next"  HREF="049030.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Fw: [Twisted-Python] Different behavior under Windows and Linux</H1>
    <B>W K</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%3D%3Fkoi8-r%3FQ%3FFw%3D3A_%5BTwisted-Python%5D_Different_behavior_under_Windows_and_Linux%3F%3D&In-Reply-To=%3CE1JA2Yd-0005Np-00.wlad-karyagin-mail-ru%40f130.mail.ru%3E"
       TITLE="Fw: [Twisted-Python] Different behavior under Windows and Linux">wlad.karyagin at mail.ru
       </A><BR>
    <I>Wed Jan  2 05:18:51 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049031.html">[Twisted-Python] Different behavior under Windos and Linux
</A></li>
        <LI>Next message (by thread): <A HREF="049030.html">Fw: [Twisted-Python] Different behavior under Windows and Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49028">[ date ]</a>
              <a href="thread.html#49028">[ thread ]</a>
              <a href="subject.html#49028">[ subject ]</a>
              <a href="author.html#49028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

-----Original Message-----
From: W K &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wlad.karyagin at mail.ru</A>&gt;
To: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>
Date: Wed, 02 Jan 2008 14:38:37 +0300
Subject: [Twisted-Python] Different behavior under Windos and Linux

&gt;<i> Hello all, 
</I>&gt;<i> 
</I>&gt;<i> i'll be short. The application was developed, which sends streams to different nodes using TCP (basic.LineReceiver and ClientFactory were used) It works perfectly under WindowsXP. However, under (K)Ubuntu the data is not sent immediately, but after approximately 20 secs delay! Does anyone encounter similar inconsistencies? How can one tune the parameters responsible for buffering?
</I>&gt;<i> 
</I>&gt;<i> Thanks 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>
Here is the sample code

from twisted.internet.protocol import Protocol, Factory, ClientFactory
from twisted.protocols import basic
from twisted.internet import reactor, protocol
import logging
from threading import Event
import sys
import time
import thread

class LineConnector (basic.LineReceiver):
    
    def __init__(self, session):
        self.session = session

    def connectionMade(self):
        self.session.cnd.set()

    def sendMessage(self, line):
        logging.debug(&quot;Sending line &quot; + line)
        self.sendLine(line)

    
    def lineReceived(self, line):
     	logging.debug(&quot;Received line &quot; + line)
		
  
class ServerConnector (basic.LineReceiver):
    
    def __init__(self, session):
        self.session = session

    def connectionMade(self):
        pass

    def sendMessage(self, line):
        logging.debug(&quot;Sending line &quot; + line)
        self.sendLine(line)

    
    def lineReceived(self, line):
     	logging.debug(&quot;Received line &quot; + line)
################################################################################

class SimpleClient(ClientFactory):
    
    def __init__(self, host, port):
        
        self.port = port
        self.host = host
        
        self.connector = None
        self.cnd = Event()
		
        thread.start_new_thread(self.send, ())
        reactor.connectTCP(self.host, self.port, self)

            
  
		
		
    def send(self):
       while 1:
          self.cnd.wait()
          self.connector.sendMessage(&quot;TEST LINE&quot;)
          time.sleep(1)


    def buildProtocol(self, addr):
        logging.debug('ManagerOutput: Connected')
        
        self.connector = LineConnector(self)
        
        return self.connector

    def startedConnecting(self, connector):
        print 'Output: Started to connect.'
    
    def clientConnectionLost(self, connector, reason):
        print 'Output: Lost connection.'# Reason:', reason
     
        

    def clientConnectionFailed(self, connector, reason):
        logging.debug(self.name + ' output: Connection failed.')# Reason:', reason
        
################################################################################

class SimpleServer(protocol.ServerFactory):

    def __init__(self, port):
        self.port = port
        self.connector = None
        reactor.listenTCP(self.port, self)

    def buildProtocol(self, addr):
        logging.debug('Manager Connected')
        self.connector = ServerConnector(self)
        return self.connector
	
    def startedConnecting(self, connector):
        logging.debug('Started to connect')


    def clientConnectionLost(self, connector, reason):
        logging.debug('Lost connection. Reason:', reason)


    def clientConnectionFailed(self, connector, reason):
        logging.debug('Connection failed. Reason:', reason)


if __name__ == &quot;__main__&quot;:
    
    logging.getLogger().setLevel(logging.DEBUG)
    logging.basicConfig(format='%(asctime)s %(levelname)8s %(message)s')#, filename='/tmp/logfile.txt', filemode='w')

    numargs = len(sys.argv) - 1

    if numargs == 1:
        print &quot;Server started&quot;
        manager = SimpleServer(31000)
    else:
        print &quot;Client Started&quot;
        mp = SimpleClient(&quot;127.0.0.1&quot;, 31000)
        
    
    reactor.run()



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049031.html">[Twisted-Python] Different behavior under Windos and Linux
</A></li>
	<LI>Next message (by thread): <A HREF="049030.html">Fw: [Twisted-Python] Different behavior under Windows and Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49028">[ date ]</a>
              <a href="thread.html#49028">[ thread ]</a>
              <a href="subject.html#49028">[ subject ]</a>
              <a href="author.html#49028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
