<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Help with Simple Trial unit test
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Help%20with%20Simple%20Trial%20unit%20test&In-Reply-To=%3C232795.92050.qm%40web31106.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="049210.html">
   <LINK REL="Next"  HREF="049204.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Help with Simple Trial unit test</H1>
    <B>Shawn Smiley</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Help%20with%20Simple%20Trial%20unit%20test&In-Reply-To=%3C232795.92050.qm%40web31106.mail.mud.yahoo.com%3E"
       TITLE="[Twisted-Python] Help with Simple Trial unit test">ssmiley483 at yahoo.com
       </A><BR>
    <I>Wed Jan 30 14:45:08 MST 2008</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049210.html">[Twisted-Python] Re: Events in Python
</A></li>
        <LI>Next message (by thread): <A HREF="049204.html">[Twisted-Python] Help with Simple Trial unit test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49203">[ date ]</a>
              <a href="thread.html#49203">[ thread ]</a>
              <a href="subject.html#49203">[ subject ]</a>
              <a href="author.html#49203">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all, 

I recently started learning Python &amp; Twisted in prep for a big project at work.  So far things are going well, except that I can't quite figure out what I'm doing wrong in this simple unit test I'm writing.

One of the features of the project I'll be working on is the implementation of a simple HTTP GET Based communication layer between legacy systems.  As such, I wanted to write a simple unit test that uses the twisted client.getPage() method to test the communication process (i.e. simulates a legacy system requesting data from the server).

I have a test that sort of works.  However, I find that I have to add a reactor.run() command in the unit test for the test to actually be executed.  The unfortunate side affect of this is that you then have to ctrl+C to stop the reactor after the test runs.  If I don't put in the reactor.run() command, I get a &quot;REACTOR UNCLEAN&quot; error message and the test doesn't appear to run (at least the callbacks from getPage() never happen).

What am I doing wrong here?

Also, can you point me at any good references for working with Twisted and Trial?  I have the O'Reily book on Twisted which is a lot of help with the framework itself.  But it doesn't cover trial at all.

All development is occurring on an Ubuntu 7.10 machine using Python 2.5 and Twisted 2.5.

I'm executing the test from the console using: 
&quot;trial ~/workspace/TestProject/src/tests/HttpGetTests.py&quot;

Here is the source code for my test:

from twisted.trial import unittest
from twisted.internet import stdio, reactor, protocol, defer
from twisted.protocols import basic
from twisted.web import client

class HttpGetTests(unittest.TestCase):
    
    def testReportHit(self):
        def _handleError(reason):
            print &quot;\n====&gt;HttpGetTests.testReportHit()._handleError(): reason=%s\n&quot; % reason
            self.fail(&quot;Test failed.  reason=%s&quot; % reason)
        
        def _handleSuccess(data):
            print &quot;\n====&gt;HttpGetTests.testReportHit()._handleSuccess():\n&quot;
            self.assert_(data.count&gt;0, &quot;No data returned&quot;)

        d = client.getPage(&quot;<A HREF="http://www.google.com">http://www.google.com</A>&quot;)
        d.addCallback(_handleSuccess)
        d.addErrback(_handleError)
        reactor.run()





      ____________________________________________________________________________________
Looking for last minute shopping deals?  
Find them fast with Yahoo! Search.  <A HREF="http://tools.search.yahoo.com/newsearch/category.php?category=shopping">http://tools.search.yahoo.com/newsearch/category.php?category=shopping</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049210.html">[Twisted-Python] Re: Events in Python
</A></li>
	<LI>Next message (by thread): <A HREF="049204.html">[Twisted-Python] Help with Simple Trial unit test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49203">[ date ]</a>
              <a href="thread.html#49203">[ thread ]</a>
              <a href="subject.html#49203">[ subject ]</a>
              <a href="author.html#49203">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
