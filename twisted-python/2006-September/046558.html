<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Other wx/twisted methods (was Re: [Twisted-Python]	removing	unsupported	reactors in twisted 2.6: qt, corefoundation, threadedselect, wx)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20Other%20wx/twisted%20methods%20%28was%20Re%3A%20%5BTwisted-Python%5D%0A%09removing%09unsupported%0A%09reactors%20in%20twisted%202.6%3A%20qt%2C%20corefoundation%2C%20threadedselect%2C%20wx%29&In-Reply-To=%3C451647A2.3000709%40pangalactic.us%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="046552.html">
   <LINK REL="Next"  HREF="046567.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Other wx/twisted methods (was Re: [Twisted-Python]	removing	unsupported	reactors in twisted 2.6: qt, corefoundation, threadedselect, wx)</H1>
    <B>Stephen Waterbury</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20Other%20wx/twisted%20methods%20%28was%20Re%3A%20%5BTwisted-Python%5D%0A%09removing%09unsupported%0A%09reactors%20in%20twisted%202.6%3A%20qt%2C%20corefoundation%2C%20threadedselect%2C%20wx%29&In-Reply-To=%3C451647A2.3000709%40pangalactic.us%3E"
       TITLE="Other wx/twisted methods (was Re: [Twisted-Python]	removing	unsupported	reactors in twisted 2.6: qt, corefoundation, threadedselect, wx)">waterbug at pangalactic.us
       </A><BR>
    <I>Sun Sep 24 02:53:54 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="046552.html">Other wx/twisted methods (was Re: [Twisted-Python] removing	unsupported	reactors in twisted 2.6: qt, corefoundation, threadedselect, wx)
</A></li>
        <LI>Next message (by thread): <A HREF="046567.html">Other wx/twisted methods (was Re: [Twisted-Python]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46558">[ date ]</a>
              <a href="thread.html#46558">[ thread ]</a>
              <a href="subject.html#46558">[ subject ]</a>
              <a href="author.html#46558">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:
&gt;<i> On Sat, 23 Sep 2006 23:33:11 -0400, Stephen Waterbury 
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">waterbug at pangalactic.us</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> If I can get that to work (which I haven't had time to play with yet),
</I>&gt;&gt;<i> it would seem to offer several advantages:  (1) running wx and twisted
</I>&gt;&gt;<i> event loops in completely separate processes, (2) making relatively
</I>&gt;&gt;<i> minimal use of threads in the wx process (well-supported by the wx
</I>&gt;&gt;<i> libraries) to drive Pyro, and using the usual twisted paradigm in
</I>&gt;&gt;<i> the twisted process.  I would appreciate any advice, but I don't see
</I>&gt;&gt;<i> any show-stoppers.  I would do the Pyro communications on 127.0.0.1,
</I>&gt;&gt;<i> since Pyro has essentially zero security, keeping it completely within
</I>&gt;&gt;<i> the local machine.  Twisted would handle all external protocols.
</I>&gt;<i> 
</I>&gt;<i> Thanks for the suggestion, Stephen.  I don't think I like this approach 
</I>&gt;<i> though.
</I>&gt;<i> 
</I>&gt;<i> The major reason is that it introduces a process boundary between 
</I>&gt;<i> Twisted code and WX code.
</I>
I see that as a *good* thing.  ;)

&gt;<i> In every other toolkit Twisted supports,
</I>
... of which there's really only *one* (GTK) that's at all
interesting to anyone doing cross-platform apps ... and
even that one, IMO, isn't very cross-platform, although
that could certainly be argued either way ...

&gt;<i> you 
</I>&gt;<i> can handle GUI events and network events in the same process, in the 
</I>&gt;<i> same thread.   That makes it possible to have individual state machines 
</I>&gt;<i> which can emit output in the form of either GUI updates and writes to 
</I>&gt;<i> streams, and you can similarly receive GUI events or data from the 
</I>&gt;<i> network as input.
</I>
Okay.  I'm willing to do without that.

&gt;<i> Keep in mind that each of the toolkits that WX backends to already *has* 
</I>&gt;<i> either a supported reactor or a proof of concept for Twisted 
</I>&gt;<i> integration: GTK+, the Win32 event loop, and Cococa.  It's not that we 
</I>&gt;<i> can't get network I/O notifications from the platform.  The real problem 
</I>&gt;<i> here is that WX obscures the underlying APIs for integrating sockets.  
</I>&gt;<i> (I say &quot;obscures&quot; rather than &quot;does not wrap&quot; because the last time I 
</I>&gt;<i> tried to use gtk reactor with a gtk build of wx, the process segfaulted 
</I>&gt;<i> after emitting a pile of dynamic linker errors.  I have no idea what 
</I>&gt;<i> would happen on Windows or the Mac.)  Whatever we're going to do at this 
</I>&gt;<i> point without getting some new code from the WX developers is going to 
</I>&gt;<i> be a workaround.
</I>
I think *that* is the real problem ... not technical, just interest
from the right people.  I've waited enough years (about 5) that
I've given up on that.

&gt;<i> That said, the mechanism that you propose may be the best way to 
</I>&gt;<i> practically integrate Twisted and WX today.  If it is, I think that it 
</I>&gt;<i> would work better as a separate project, because it is a workaround with 
</I>&gt;<i> a lot of pointy edges and not a real solution.
</I>
What's reality?  :)  OTOH ...
I completely agree that it should not be part of Twisted
at all ... but if I succeed with it, I'll certainly document what I
do.

&gt;<i> One major reason I'd like a WX reactor to continue to exist in some form 
</I>&gt;<i> is OSAF's usage of Twisted and WX.  They have a similarly baroque model 
</I>&gt;<i> for handing data back and forth between Twisted code and GUI code, ...
</I>
... and everything else (sorry, couldn't resist ;) ...

&gt;<i> ... and 
</I>&gt;<i> I'd love to have something to propose to them that was (A) supported by 
</I>&gt;<i> Twisted (B) well tested, and (C) didn't involve lots of potential race 
</I>&gt;<i> conditions, as all shared-state-threading code was likely to do.  I 
</I>&gt;<i> haven't looked at it in a while, but if I remember correctly their 
</I>&gt;<i> separation between Twisted code and GUI code was fairly clean and 
</I>&gt;<i> well-thought-out,
</I>
... hmmm ... I've been on all the OSAF Chandler/Scooby/Cosmo lists
since April (and that's a lot of freakin' mail ;), and not *once* in
that interval has &quot;twisted&quot; occurred in the subject line of a
message, and no substantive discussion of it in the bodies either.

I know about their zanshin twisted-based framework for WebDAV/CalDAV,
and that it's used in their Sharing architecture, which is used by
the Chandler wx GUI, but I just updated my chandler svn checkout, and
I counted 17 occurrences of the zanshin &quot;blockUntil&quot; function in the
Sharing.py module ... if it's so clean, how come they need those?
(In zanshin's docs, &quot;blockUntil&quot; is billed as &quot;for test purposes&quot; ... ;)

&gt;<i> but the separation would have been unnecessary if wx 
</I>&gt;<i> had native Twisted integration.
</I>
Well, yeah, but I don't think OSAF has the resources to put into it
either, and Robin *works* for OSAF.

&gt;<i> There are other problems with a Pyro-driven Twisted subprocess, which 
</I>&gt;<i> are relevant as the goal here is a well-supported and well-tested path 
</I>&gt;<i> for integration.
</I>&gt;<i> 
</I>&gt;<i> Multiprocess communication and process spawning, especially on Windows, 
</I>&gt;<i> is fraught with peril.  We've been working on reliable event-driven 
</I>&gt;<i> process spawning in Twisted for years and years, and only recently have 
</I>&gt;<i> we gotten to the point where the published API works reliably 
</I>&gt;<i> cross-platform.  Given that Twisted would be left out of this loop, I 
</I>&gt;<i> imagine the process control would be rather ad-hoc, so getting the 
</I>&gt;<i> Twisted and WX processes synchronized would be problematic, and 
</I>&gt;<i> extremely hard to unit test.  Although it would be slightly easier if 
</I>&gt;<i> the Twisted proces is 'on top', you still have to inject test code into 
</I>&gt;<i> both the parent and child processes, and have a way to verify the state 
</I>&gt;<i> of both.
</I>&gt;<i> 
</I>&gt;<i> The last release of pyro is almost a year old.  That suggests it is not 
</I>&gt;<i> actively maintained.
</I>
Or else it just works.  ;)

&gt;<i> Pyro doesn't have a buildbot, or (as far as I can tell from the release) 
</I>&gt;<i> any automated tests of its own.  That would make it a wash in terms of 
</I>&gt;<i> tested, robust integration support.
</I>
As if there's going to be some other &quot;tested, robust integration
support&quot; ... nothing on the horizon that I can see (and as I say,
I've been watching for a long time).

&gt;<i> You'd have to re-implement the Pyro protocol on top of Twisted to 
</I>&gt;<i> communicate with it without spawning lots of threads.  That's a bunch of 
</I>&gt;<i> new code which is going to need a home, again, possibly a whole new 
</I>&gt;<i> project.  Even after that's done, Pyro is going to be spawning threads 
</I>&gt;<i> and blocking inside the WX process because the Twisted implementation 
</I>&gt;<i> isn't running there.
</I>
Process spawning!  Rusty code!  Spawning threads, *and* blocking!
My, you do paint a rosy picture.  All your handwaving and FUD makes
me want to try it, because it's probably quicker and easier than
discussing it.  But thanks for the warnings, anyway!  ;)

Cheers,
Steve



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="046552.html">Other wx/twisted methods (was Re: [Twisted-Python] removing	unsupported	reactors in twisted 2.6: qt, corefoundation, threadedselect, wx)
</A></li>
	<LI>Next message (by thread): <A HREF="046567.html">Other wx/twisted methods (was Re: [Twisted-Python]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46558">[ date ]</a>
              <a href="thread.html#46558">[ thread ]</a>
              <a href="subject.html#46558">[ subject ]</a>
              <a href="author.html#46558">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
