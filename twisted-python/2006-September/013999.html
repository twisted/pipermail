<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Newbie Problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Newbie%20Problem&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013998.html">
   <LINK REL="Next"  HREF="014000.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Newbie Problem</H1>
    <B>Damon Kohler</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Newbie%20Problem&In-Reply-To="
       TITLE="[Twisted-Python] Newbie Problem">damonkohler at yahoo.com
       </A><BR>
    <I>Wed Sep 13 00:11:30 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="013998.html">[Twisted-Python] mechanize in twisted ?
</A></li>
        <LI>Next message: <A HREF="014000.html">[Twisted-Python] Newbie Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13999">[ date ]</a>
              <a href="thread.html#13999">[ thread ]</a>
              <a href="subject.html#13999">[ subject ]</a>
              <a href="author.html#13999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is probably something simple. I'm having some trouble with this little bit
of code below. I start it up once as a server, then a second time as the client
connecting to localhost. However, it never actually seems to connect. Both
sides just wait indefinitely. I'm a bit stuck as to how to debug this, so if
someone has a solution for me and could tell me how I would have figured it
out, that would be great!

Thanks,
Damon

import sys
import optparse

import zope.interface

from twisted.spread import pb
from twisted.internet import reactor
from twisted.internet import interfaces
from twisted.python import util


class ConsoleInput(object):
    zope.interface.implements(interfaces.IReadDescriptor)
    
    def fileno(self):
        return 0

    def connectionLost(self, reason):
        print &quot;Lost connection because %s&quot; % reason

    def doRead(self):
        d = self.root.callRemote(&quot;echo&quot;, sys.stdin.readline().strip())
       
    def setRoot(self, root):
        print &quot;got root&quot;
        self.myEchoer = Echoer()
        self.root = root
        self.root.callRemote('GiveReference', self.myEchoer)

    def logPrefix(self):
        return 'ConsoleInput'


class Echoer(pb.Root):
    def remote_echo(self, st):
        print 'echoing:', st
        return st

    def remote_GiveReference(self, ref):
        self.client_ref = ref

def main():
    parser = optparse.OptionParser()
    parser.add_option('--host', dest='host', help='Host to connect to.')
    options, args = parser.parse_args()

    ci = ConsoleInput()
    reactor.addReader(ci)

    if options.host:
        host = options.host
        factory = pb.PBClientFactory()
        print &quot;Connecting to %s...&quot; % host
        reactor.connectTCP(host, 8789, pb.PBClientFactory())
        d = factory.getRootObject()
        d.addCallback(ci.setRoot)
        d.addErrback(lambda reason: &quot;error %s&quot; % reason.value)
        d.addCallback(util.println)
    else:
        print &quot;Listening...&quot;
        root = Echoer()
        factory = pb.PBServerFactory(root)
        reactor.listenTCP(8789, factory)

    reactor.run()

if __name__ == '__main__':
    main()


__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
<A HREF="http://mail.yahoo.com">http://mail.yahoo.com</A> 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013998.html">[Twisted-Python] mechanize in twisted ?
</A></li>
	<LI>Next message: <A HREF="014000.html">[Twisted-Python] Newbie Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13999">[ date ]</a>
              <a href="thread.html#13999">[ thread ]</a>
              <a href="subject.html#13999">[ subject ]</a>
              <a href="author.html#13999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
