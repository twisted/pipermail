<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Lots and lots and lots and lots... of deferreds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lots%20and%20lots%20and%20lots%20and%20lots...%20of%20deferreds&In-Reply-To=EEF62EFB-31D9-493C-BF0E-BEB2654CA246%40integrateddevcorp.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020618.html">
   <LINK REL="Next"  HREF="020613.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Lots and lots and lots and lots... of deferreds</H1>
    <B>Matt Perry</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Lots%20and%20lots%20and%20lots%20and%20lots...%20of%20deferreds&In-Reply-To=EEF62EFB-31D9-493C-BF0E-BEB2654CA246%40integrateddevcorp.com"
       TITLE="[Twisted-Python] Lots and lots and lots and lots... of deferreds">matt at unshift.net
       </A><BR>
    <I>Tue Oct  6 23:00:03 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020618.html">[Twisted-Python] Lots and lots and lots and lots... of deferreds
</A></li>
        <LI>Next message: <A HREF="020613.html">[Twisted-Python] Lots and lots and lots and lots... of deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20612">[ date ]</a>
              <a href="thread.html#20612">[ thread ]</a>
              <a href="subject.html#20612">[ subject ]</a>
              <a href="author.html#20612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Your limit will usually be the number of file descriptors in the system,
which can be usually changed via ulimit or your system's equivalent.  On
Linux I believe it defaults to 1024, so you should be able to handle 1024
simultaneous connections.

One thing of note is that you say you have concurrency issues handled -- but
with asynchronous I/O, there are no concurrency issues, since there's no
concurrency (at least, not at application level).  This is confusing at
first but it's important to understand.

All that said, you probably want to maintain a queue of URLs and some sort
of graph representation of your data for purposes of finding loops (e.g. A
links to B, B links to C, C links to A).  You can then set an upper limit on
the number of concurrent connections (say 1000) and track the number of
deferreds in the system just based on when you start connections and when
they finish (via callbacks).   Your initial seed can start one URL, and then
its callback can hit all linked nodes, and so on and so on.

You might be hitting a cycle in the page traversal graph, and that is
causing you all sorts of problems in terms of recursion depth or running out
of file descriptors.  Without seeing your code or your target site, though,
it's impossible to say.

Have you considered using another library for web spidering?  I believe
Scrapy (<A HREF="http://scrapy.org">http://scrapy.org</A>) is a good spidering tool, and it might be easier
to use a decent library than roll your own.


  - Matt



On Tue, Oct 6, 2009 at 10:40 PM, Steve Steiner (listsin) &lt;
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">listsin at integrateddevcorp.com</A>&gt; wrote:

&gt;<i> So, I have a situation...
</I>&gt;<i>
</I>&gt;<i>        I have an application whose basic function is, in simplified form:
</I>&gt;<i>
</I>&gt;<i>        def main():
</I>&gt;<i>                get_web_page(main_page_from_params)
</I>&gt;<i>
</I>&gt;<i>        def get_web_page(page_name):
</I>&gt;<i>                set up a page getter deferred,
</I>&gt;<i>                        one of the callbacks gets the links out of the page
</I>&gt;<i> and sends them
</I>&gt;<i> to get_them()
</I>&gt;<i>
</I>&gt;<i>        def get_them(links):
</I>&gt;<i>                for l in links:
</I>&gt;<i>                        if l is not being gotten or hasn't been got:
</I>&gt;<i>                                deferred = get_web_page(l)
</I>&gt;<i>
</I>&gt;<i>        In other words, I feed in the top level page, then recursively feed
</I>&gt;<i> in any pages linked to by the current page, and they feed in all their
</I>&gt;<i> links, until all pages are gotten.
</I>&gt;<i>
</I>&gt;<i>        I understand the concurrency issues with multiple deferred's trying
</I>&gt;<i> to add pages to the &quot;get list&quot; -- it's properly handled in the code
</I>&gt;<i> (far as I can tell, so far).
</I>&gt;<i>
</I>&gt;<i>        So, here's the question...
</I>&gt;<i>
</I>&gt;<i>        I have a &quot;pages&quot;  list containing all of the pages.
</I>&gt;<i>
</I>&gt;<i>        They are set to either gotten or in-flight.
</I>&gt;<i>
</I>&gt;<i>        In-flight means I have a deferred that's going to go get it (in
</I>&gt;<i> get_web_page()).
</I>&gt;<i>
</I>&gt;<i>        IOW, right now, if I don't already have the page, and I have a link
</I>&gt;<i> to it, I just start a deferred to go get it.
</I>&gt;<i>
</I>&gt;<i>        Should I limit the number of &quot;in-flight&quot; pages?
</I>&gt;<i>
</I>&gt;<i>        Currently, I'm scanning sites that have upwards of 5000 pages and it
</I>&gt;<i> seems that, when I get too many deferred's in flight, the app
</I>&gt;<i> *appears* to crash.
</I>&gt;<i>
</I>&gt;<i>        I'm not sure whether it's actually going out to lunch or just
</I>&gt;<i> appears
</I>&gt;<i> that way and, before I go instrumenting the app to death, can anyone
</I>&gt;<i> tell me whether there is some sort of practical limit to how many &quot;in-
</I>&gt;<i> flight&quot; deferreds might start to cause issues, just due to the sheer
</I>&gt;<i> number?
</I>&gt;<i>
</I>&gt;<i>        Thanks for any insight on this that anyone might offer.
</I>&gt;<i>
</I>&gt;<i>        I expect the usual flurry of  &quot;you must post your exact code or we
</I>&gt;<i> can't help you at all, moron&quot; posts, but...
</I>&gt;<i>
</I>&gt;<i>        In spite of my not having posted specific code, could someone with
</I>&gt;<i> some actual experience in this please give me a clue, within an order
</I>&gt;<i> of magnitude, how many deferreds might start to cause real trouble?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> S
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20091006/2398f84b/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20091006/2398f84b/attachment-0001.htm</A> 
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020618.html">[Twisted-Python] Lots and lots and lots and lots... of deferreds
</A></li>
	<LI>Next message: <A HREF="020613.html">[Twisted-Python] Lots and lots and lots and lots... of deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20612">[ date ]</a>
              <a href="thread.html#20612">[ thread ]</a>
              <a href="subject.html#20612">[ subject ]</a>
              <a href="author.html#20612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
