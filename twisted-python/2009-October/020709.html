<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Newbie question: can't get getProcessOutput to run from inside a listenTCP service call-back
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Newbie%20question%3A%20can%27t%20get%20getProcessOutput%20to%0A%20run%20from%20inside%20a%20listenTCP%20service%20call-back&In-Reply-To=1EF4C760-66C8-49C4-89C2-1BD790C92374%40boxdesign.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020708.html">
   <LINK REL="Next"  HREF="020710.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Newbie question: can't get getProcessOutput to run from inside a listenTCP service call-back</H1>
    <B>Read Roberts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Newbie%20question%3A%20can%27t%20get%20getProcessOutput%20to%0A%20run%20from%20inside%20a%20listenTCP%20service%20call-back&In-Reply-To=1EF4C760-66C8-49C4-89C2-1BD790C92374%40boxdesign.co.uk"
       TITLE="[Twisted-Python] Newbie question: can't get getProcessOutput to run from inside a listenTCP service call-back">rroberts at adobe.com
       </A><BR>
    <I>Sat Oct 17 13:03:23 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020708.html">[Twisted-Python] Newbie question: can't get getProcessOutput to	run from inside a listenTCP service call-back
</A></li>
        <LI>Next message: <A HREF="020710.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20709">[ date ]</a>
              <a href="thread.html#20709">[ thread ]</a>
              <a href="subject.html#20709">[ subject ]</a>
              <a href="author.html#20709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Nick;

Thanks for the answer. However, If I take the while loop out,  &quot;helloWorldTest()&quot; returns immediately, and the Flex app gets the initial value of self.result. The defer.callback function doLog never gets called.  If I call  the &quot;terminate()&quot; from the Flex app, which in turn calls reactor.sop()  the doLog  function finally then gets called.   I am looking for what I need to do to allow getProcessOutput to run such that the defer.callback function doLog actually gets called.

I have figured out that if instead of calling getProcessOutput() directly within the helloWorldTest() method, that I can queue it for running  after helloWorldTest() as returned, as in:
    reactor.callLater(1, self. helloWorldTest2)
 and that the defer.callback function doLog does then get called.

This means that the defer.callback function doLog will get  called after the helloWorldTest()  has returned. I see can call helloWorldTest() , and then keep querying the python service from the Flex app until the  defer.callback function doLog  has run.

I still don't understand why calling getProcessOutput() directly within the helloWorldTest() method doesn't work. Any explanation would be welcome.

    Thanks,  Read Roberts

On 10/17/09 1:53 AM, &quot;Nick Joyce&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">nick at boxdesign.co.uk</A>&gt; wrote:

On 17 Oct 2009, at 05:15, Read Roberts wrote:

&gt;<i> I have a Python server using twisted which responds to pyAMF calls
</I>&gt;<i> from
</I>&gt;<i> Flex/Air applications (following Bruce Eckels 5/1/2008 article
</I>&gt;<i> &quot;Concurrency
</I>&gt;<i> with Python, Twisted, and Flex&quot;). The service is basically as
</I>&gt;<i> follows below.
</I>&gt;<i> When the client calls a service API, the API needs to make a OS
</I>&gt;<i> shell call.
</I>&gt;<i> I see that if I call reactor.stop() after the  getProcessOutput call
</I>&gt;<i> (such
</I>&gt;<i> as within the doLog and doError functions), the call happens and I
</I>&gt;<i> see the
</I>&gt;<i> output. How can can I retrieve the output without calling
</I>&gt;<i> reactor.stop()? In
</I>&gt;<i> the example below, the AIR app calls the callback helloWorldTest(),
</I>&gt;<i> and the
</I>&gt;<i> deferred.addCallback function is never called.
</I>&gt;<i>
</I>&gt;<i> import os
</I>&gt;<i> from twisted.spread import pb
</I>&gt;<i> from  twisted.internet.utils import getProcessOutput
</I>&gt;<i> from twisted.internet import reactor
</I>&gt;<i>
</I>&gt;<i> class FlexInterface(pb.Root):
</I>&gt;<i>    def __init__(self):
</I>&gt;<i>        self.result e
</I>&gt;<i>
</I>&gt;<i>    def doLog(self, result):
</I>&gt;<i>        self.result = &quot;%s&quot; % (result)
</I>&gt;<i>        return result
</I>&gt;<i>
</I>&gt;<i>    def doError(self, failure):
</I>&gt;<i>        self.result = &quot;%s&quot; % ( failure)
</I>&gt;<i>        return failure
</I>&gt;<i>
</I>&gt;<i>    def helloWorldTest(self):
</I>&gt;<i>        deferred = getProcessOutput(&quot;echo&quot;, [&quot;Hello World&quot;],
</I>&gt;<i> os.environ)
</I>&gt;<i>        deferred.addErrback(self.doError)
</I>&gt;<i>        deferred.addCallback(self.doLog)
</I>&gt;<i>        while (self.result == None)
</I>&gt;<i>            print &quot;doLog still hasn't been called&quot;
</I>&gt;<i>        return self.result
</I>

The while loop will block the event loop, preventing the deferred from
ever being called. PyAMF will accept a deferred as a return value for
the service function and will not return a response until the
deferred's callback is fired.

So, you could re-write the method like:

     def helloWorldTest(self):
         deferred = getProcessOutput(&quot;echo&quot;, [&quot;Hello World&quot;],
os.environ)

         deferred.addErrback(self.doError)
         deferred.addCallback(self.doLog)

         return deferred

If the deferred's callback is called then the return value of doLog
will be used as the response value. If the errback is called, the
return value of doError will be used as the response, in this case a
Failure instance. PyAMF converts Failure instances to remoting/
messaging error objects automagically, so the faultHandler on the
flash/air side will be called.

hth,

Nick


_______________________________________________
Twisted-Python mailing list
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20091017/d90d5d38/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20091017/d90d5d38/attachment.htm</A> 
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020708.html">[Twisted-Python] Newbie question: can't get getProcessOutput to	run from inside a listenTCP service call-back
</A></li>
	<LI>Next message: <A HREF="020710.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20709">[ date ]</a>
              <a href="thread.html#20709">[ thread ]</a>
              <a href="subject.html#20709">[ subject ]</a>
              <a href="author.html#20709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
