<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Newbie question: can't get getProcessOutput to run from inside a listenTCP service call-back
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Newbie%20question%3A%20can%27t%20get%20getProcessOutput%20to%20run%0A%20from%20inside%20a%20listenTCP%20service%20call-back&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020706.html">
   <LINK REL="Next"  HREF="020708.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Newbie question: can't get getProcessOutput to run from inside a listenTCP service call-back</H1>
    <B>Read Roberts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Newbie%20question%3A%20can%27t%20get%20getProcessOutput%20to%20run%0A%20from%20inside%20a%20listenTCP%20service%20call-back&In-Reply-To="
       TITLE="[Twisted-Python] Newbie question: can't get getProcessOutput to run from inside a listenTCP service call-back">rroberts at adobe.com
       </A><BR>
    <I>Sat Oct 17 00:15:03 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020706.html">[Twisted-Python] maybeDeferred capability
</A></li>
        <LI>Next message: <A HREF="020708.html">[Twisted-Python] Newbie question: can't get getProcessOutput to	run from inside a listenTCP service call-back
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20707">[ date ]</a>
              <a href="thread.html#20707">[ thread ]</a>
              <a href="subject.html#20707">[ subject ]</a>
              <a href="author.html#20707">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a Python server using twisted which responds to pyAMF calls from
Flex/Air applications (following Bruce Eckels 5/1/2008 article &quot;Concurrency
with Python, Twisted, and Flex&quot;). The service is basically as follows below.
When the client calls a service API, the API needs to make a OS shell call.
I see that if I call reactor.stop() after the  getProcessOutput call (such
as within the doLog and doError functions), the call happens and I see the
output. How can can I retrieve the output without calling reactor.stop()? In
the example below, the AIR app calls the callback helloWorldTest(), and the
deferred.addCallback function is never called.

import os
from twisted.spread import pb
from  twisted.internet.utils import getProcessOutput
from twisted.internet import reactor

class FlexInterface(pb.Root):
    def __init__(self):
        self.result e

    def doLog(self, result):
        self.result = &quot;%s&quot; % (result)
        return result
        
    def doError(self, failure):
        self.result = &quot;%s&quot; % ( failure)
        return failure

    def helloWorldTest(self):
        deferred = getProcessOutput(&quot;echo&quot;, [&quot;Hello World&quot;], os.environ)
        deferred.addErrback(self.doError)
        deferred.addCallback(self.doLog)
        while (self.result == None)
            print &quot;doLog still hasn't been called&quot;
        return self.result

    def terminate(self, discardPostAag):
        reactor.callLater(1, reactor.stop)
        return &quot;Terminating CubeGlyphServices&quot;

def run():
    # Place the namespace mapping into a TwistedGateway:
    fi = FlexInterface()
    gateway = TwistedGateway({ &quot;flexAppServer&quot;: fi })

    # Publish the PyAMF gateway at the root URL:
    root = resource.Resource()
    root.putChild(&quot;&quot;, gateway)

    # Tell the twisted reactor to listen:
    reactor.listenTCP(8050, server.Site(root))
    print &quot;Local python server listening on localhost port 8050&quot;
    reactor.run()


if __name__=='__main__':
    run()

I do know that If I used Python 2.6 and later, a twisted bug is fixed such
that I could use subprocess.Popen, and that the next release of AIR will
allow direct execv calls. However, for performance issues  I still want to
call one Python process running a server, and I have to work within a Python
2.5 environment.

Thanks for any advice,
 Read Roberts




</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020706.html">[Twisted-Python] maybeDeferred capability
</A></li>
	<LI>Next message: <A HREF="020708.html">[Twisted-Python] Newbie question: can't get getProcessOutput to	run from inside a listenTCP service call-back
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20707">[ date ]</a>
              <a href="thread.html#20707">[ thread ]</a>
              <a href="subject.html#20707">[ subject ]</a>
              <a href="author.html#20707">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
