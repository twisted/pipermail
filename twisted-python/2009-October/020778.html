<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Phasing out old-style classes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Phasing%20out%20old-style%20classes&In-Reply-To=40b76abc0910270138p711d33ddjf55c76e23673d74b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020774.html">
   <LINK REL="Next"  HREF="020779.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Phasing out old-style classes</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Phasing%20out%20old-style%20classes&In-Reply-To=40b76abc0910270138p711d33ddjf55c76e23673d74b%40mail.gmail.com"
       TITLE="[Twisted-Python] Phasing out old-style classes">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Oct 27 08:17:02 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020774.html">[Twisted-Python] Phasing out old-style classes
</A></li>
        <LI>Next message: <A HREF="020779.html">[Twisted-Python] Phasing out old-style classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20778">[ date ]</a>
              <a href="thread.html#20778">[ thread ]</a>
              <a href="subject.html#20778">[ subject ]</a>
              <a href="author.html#20778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08:38 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">k.kelly.gordon at gmail.com</A> wrote:
&gt;<i>On Sun, Oct 25, 2009 at 1:50 AM,  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i>On 02:39 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">k.kelly.gordon at gmail.com</A> wrote:
</I>&gt;&gt;&gt;<i>On Thu Oct 8 20:08:12 EDT 2009, Glyph Lefkowitz
</I>&gt;&gt;&gt;<i>&lt;glyph at twistedmatrix.com&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i>If old-style classes can be evolved into new-style classes while
</I>&gt;&gt;&gt;&gt;<i>somehow following this policy, that would be great.
</I>&gt;<i>
</I>&gt;&gt;&gt;<i>I have some POC code for this.  It provides a simple toggle at the
</I>&gt;&gt;&gt;<i>start of the application to select between old style (the default)
</I>&gt;&gt;&gt;<i>and new style classes.  After that, a DeprecationWarning is issued
</I>&gt;&gt;&gt;<i>every time an old style class is defined.
</I>&gt;<i>
</I>&gt;&gt;<i>Process-wide switches are tricky.  Some code may decide it wants
</I>&gt;&gt;<i>new-style, while other code wants to stick with classic.  They have
</I>&gt;&gt;<i>a fight, one of them loses.  I think that adding this is just an
</I>&gt;&gt;<i>invitation for people to create more problems.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I guess that would be a problem if an application used two libraries
</I>&gt;<i>that use Twisted and each initialised Twisted differently.  However, I
</I>&gt;<i>was thinking this would be something that should only be called by
</I>&gt;<i>the application (ie the thing with #! at the top)
</I>&gt;<i>
</I>&gt;<i>Roughly speaking - in the Twisted library:
</I>&gt;<i>
</I>&gt;<i>    from twisted.object import ClassStyle
</I>&gt;<i>
</I>&gt;<i>    class MustBeOldStyle(ClassStyle.old): pass
</I>&gt;<i>
</I>&gt;<i>    class DoesntMatter(ClassStyle.default): pass
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>In the application's top level file:
</I>&gt;<i>
</I>&gt;<i>    #!/usr/bin/env python
</I>&gt;<i>
</I>&gt;<i>    from twisted.object import ClassStyle
</I>&gt;<i>
</I>&gt;<i>    ClassStyle.use_old_style()
</I>&gt;<i>    # or
</I>&gt;<i>    ClassStyle.use_new_style()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Which would have the effect flipping ClassStyle.default between old
</I>&gt;<i>and new style.  Once set it can't be changed which is why it needs to
</I>&gt;<i>be done before any Twisted classes are defined.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I think that we should consider requests to make specific classes
</I>&gt;&gt;<i>new-style (and grant them when doing so won't cause compatibility
</I>&gt;&gt;<i>problems), make all new classes new-style, but otherwise leave
</I>&gt;&gt;<i>this alone until 3.x is widely adopted.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Jean-Paul
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>How could that be done in a way that was consistent with the
</I>&gt;<i>deprecation policy?  ie how could a warning be issued: &quot;this class
</I>&gt;<i>will be new style in a couple of releases&quot;, such that the developer
</I>&gt;<i>could &quot;fix&quot; their code to remove the warning?
</I>&gt;<i>
</I>&gt;<i>Changing from old-style to new-style changes a number of class
</I>&gt;<i>behaviours (notably: mro, __coerce__, assignment to Class.__dict__
</I>&gt;<i>and Class.__bases__), so its not really something that can be done
</I>&gt;<i>silently to any class that might be inherited from.
</I>
Actually, I was thinking that we would only do it to classes that can 
not be inherited from.  For example, no one's really supposed to be 
subclassing Deferred, so we might consider making Deferred new-style 
(perhaps for performance reasons, for example).
&gt;<i>Presumably there will be a period when Twisted works on both 2.x and
</I>&gt;<i>3.x.
</I>
I think it is still early to presume this. :)
&gt;<i>At that point there will be two sets of users,  the 3.x's that
</I>&gt;<i>use only new-style classes and the 2.x's for which Twisted classes
</I>&gt;<i>may be either old or new.  It would probably be better to have
</I>&gt;<i>switched to new-style before then and only have to support the use
</I>&gt;<i>of new style classes.
</I>
But, presuming this :) I don't think we need to have switched to new- 
style classes for support this scenario.  We only have to have written 
all our code such that it continues to work even when there are no 
longer any classic classes.  I think that the majority of code in 
Twisted already works even if you flip the new-style switch.  We just 
need to identify and fix the few places that don't.
&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-Python mailing list
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020774.html">[Twisted-Python] Phasing out old-style classes
</A></li>
	<LI>Next message: <A HREF="020779.html">[Twisted-Python] Phasing out old-style classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20778">[ date ]</a>
              <a href="thread.html#20778">[ thread ]</a>
              <a href="subject.html#20778">[ subject ]</a>
              <a href="author.html#20778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
