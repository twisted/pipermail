<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Phasing out old-style classes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Phasing%20out%20old-style%20classes&In-Reply-To=%3C6EE454CA-F803-4C6B-BE67-23B2078087B9%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053256.html">
   <LINK REL="Next"  HREF="053262.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Phasing out old-style classes</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Phasing%20out%20old-style%20classes&In-Reply-To=%3C6EE454CA-F803-4C6B-BE67-23B2078087B9%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Phasing out old-style classes">glyph at twistedmatrix.com
       </A><BR>
    <I>Sat Oct 24 23:38:12 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053256.html">[Twisted-Python] Phasing out old-style classes
</A></li>
        <LI>Next message (by thread): <A HREF="053262.html">[Twisted-Python] Phasing out old-style classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53261">[ date ]</a>
              <a href="thread.html#53261">[ thread ]</a>
              <a href="subject.html#53261">[ subject ]</a>
              <a href="author.html#53261">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Oct 24, 2009, at 10:50 AM, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:

&gt;<i> I think that we should consider requests to make specific classes new-
</I>&gt;<i> style (and grant them when doing so won't cause compatibility  
</I>&gt;<i> problems),
</I>&gt;<i> make all new classes new-style, but otherwise leave this alone until  
</I>&gt;<i> 3.x
</I>&gt;<i> is widely adopted.
</I>
While your argument makes sense to me, there's a fundamental problem  
with the way Python introduced new-style classes that creates an  
ongoing maintenance tension.  I think we should start addressing the  
problem incrementally now (especially since it sounded like Kelly was  
volunteering for some work!) rather than put it off for one big chunk  
when we do a 3k migration.

Let's say you're writing a new Twisted application today.  You want to  
be prepared for the day when everything is new-style, but you also  
want to use existing Twisted functionality.  You're using some long- 
standing library class, that looks like this:

# in Twisted
class Library: pass

What do you do?  Well, the obvious upgrade path here is to make a  
class which (A) inherits from &quot;Library&quot; to get Twisted functionality  
and (B) inherits from &quot;object&quot; to get new-style-ness.  So you go ahead  
and write:

# in your application
class Application(object, Library): pass

... and that's great.  It works, your class is new-style, and it gets  
all the library functionality that you want.  Except now, you've made  
the old-style-ness of 'Library' a very important part of its  
interface.  If, one day, we flip any kind of new-style switch, instead  
of neatly defining a new-style twisted-using class, your code will do  
this instead:

Traceback (most recent call last):
   File &quot;your-application.py&quot;, line 1, in &lt;module&gt;
     class Application(object, Library): pass
TypeError: Error when calling the metaclass bases
     Cannot create a consistent method resolution
order (MRO) for bases object, Library

I would really like a more abstract declaration that applications can  
use in the meanwhile, to get new-style semantics but still allow  
inheritable classes to evolve.

I suspect that we could do this with some kind of metaclass, but that  
seems ugly.  More reasonable, I imagine, would be something like:

class Application(newStyle(Library)): pass

and we could implement 'newStyle' to do something sane in the face of  
either an old-style or a new-style &quot;Library&quot; class.

Of course, there are still issues with behavior differences on  
decorators and so on, and so the same compatibility issues might still  
come up, but in my experience those issues are significantly less  
serious and easier to fix than &quot;my entire program blows up and will  
not start unless I make all my classes old-style&quot;.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20091025/9b272f18/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053256.html">[Twisted-Python] Phasing out old-style classes
</A></li>
	<LI>Next message (by thread): <A HREF="053262.html">[Twisted-Python] Phasing out old-style classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53261">[ date ]</a>
              <a href="thread.html#53261">[ thread ]</a>
              <a href="subject.html#53261">[ subject ]</a>
              <a href="author.html#53261">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
