<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Phasing out old-style classes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Phasing%20out%20old-style%20classes&In-Reply-To=20091024145011.11571.1125183848.divmod.xquotient.1491%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020771.html">
   <LINK REL="Next"  HREF="020778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Phasing out old-style classes</H1>
    <B>Kelly</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Phasing%20out%20old-style%20classes&In-Reply-To=20091024145011.11571.1125183848.divmod.xquotient.1491%40localhost.localdomain"
       TITLE="[Twisted-Python] Phasing out old-style classes">k.kelly.gordon at gmail.com
       </A><BR>
    <I>Tue Oct 27 04:38:02 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020771.html">[Twisted-Python] Phasing out old-style classes
</A></li>
        <LI>Next message: <A HREF="020778.html">[Twisted-Python] Phasing out old-style classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20774">[ date ]</a>
              <a href="thread.html#20774">[ thread ]</a>
              <a href="subject.html#20774">[ subject ]</a>
              <a href="author.html#20774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Oct 25, 2009 at 1:50 AM,  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
&gt;<i> On 02:39 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">k.kelly.gordon at gmail.com</A> wrote:
</I>&gt;&gt;<i> On Thu Oct 8 20:08:12 EDT 2009, Glyph Lefkowitz
</I>&gt;&gt;<i> &lt;glyph at twistedmatrix.com&gt; wrote:
</I>&gt;&gt;&gt;<i> If old-style classes can be evolved into new-style classes while
</I>&gt;&gt;&gt;<i> somehow following this policy, that would be great.
</I>

&gt;&gt;<i> I have some POC code for this.  It provides a simple toggle at the
</I>&gt;&gt;<i> start of the application to select between old style (the default)
</I>&gt;&gt;<i> and new style classes.  After that, a DeprecationWarning is issued
</I>&gt;&gt;<i> every time an old style class is defined.
</I>

&gt;<i> Process-wide switches are tricky.  Some code may decide it wants
</I>&gt;<i> new-style, while other code wants to stick with classic.  They have
</I>&gt;<i> a fight, one of them loses.  I think that adding this is just an
</I>&gt;<i> invitation for people to create more problems.
</I>

I guess that would be a problem if an application used two libraries
that use Twisted and each initialised Twisted differently.  However, I
was thinking this would be something that should only be called by
the application (ie the thing with #! at the top)

Roughly speaking - in the Twisted library:

    from twisted.object import ClassStyle

    class MustBeOldStyle(ClassStyle.old): pass

    class DoesntMatter(ClassStyle.default): pass


In the application's top level file:

    #!/usr/bin/env python

    from twisted.object import ClassStyle

    ClassStyle.use_old_style()
    # or
    ClassStyle.use_new_style()


Which would have the effect flipping ClassStyle.default between old
and new style.  Once set it can't be changed which is why it needs to
be done before any Twisted classes are defined.

&gt;<i>
</I>&gt;<i> I think that we should consider requests to make specific classes
</I>&gt;<i> new-style (and grant them when doing so won't cause compatibility
</I>&gt;<i> problems), make all new classes new-style, but otherwise leave
</I>&gt;<i> this alone until 3.x is widely adopted.
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>

How could that be done in a way that was consistent with the
deprecation policy?  ie how could a warning be issued: &quot;this class
will be new style in a couple of releases&quot;, such that the developer
could &quot;fix&quot; their code to remove the warning?

Changing from old-style to new-style changes a number of class
behaviours (notably: mro, __coerce__, assignment to Class.__dict__
and Class.__bases__), so its not really something that can be done
silently to any class that might be inherited from.

Presumably there will be a period when Twisted works on both 2.x and
3.x.  At that point there will be two sets of users,  the 3.x's that
use only new-style classes and the 2.x's for which Twisted classes
may be either old or new.  It would probably be better to have
switched to new-style before then and only have to support the use
of new style classes.

</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020771.html">[Twisted-Python] Phasing out old-style classes
</A></li>
	<LI>Next message: <A HREF="020778.html">[Twisted-Python] Phasing out old-style classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20774">[ date ]</a>
              <a href="thread.html#20774">[ thread ]</a>
              <a href="subject.html#20774">[ subject ]</a>
              <a href="author.html#20774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
