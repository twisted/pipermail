<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] spawnProcess - reapProcess not retrying on failures
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20spawnProcess%20-%20reapProcess%20not%20retrying%20on%20failures&In-Reply-To=%3CCAFycZ9eCgqTpra%2Bkuk502wXOfGYDau991yEardnTCPO%3D9AYJVg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="061176.html">
   <LINK REL="Next"  HREF="061150.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] spawnProcess - reapProcess not retrying on failures</H1>
    <B>Adi Roiban</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20spawnProcess%20-%20reapProcess%20not%20retrying%20on%20failures&In-Reply-To=%3CCAFycZ9eCgqTpra%2Bkuk502wXOfGYDau991yEardnTCPO%3D9AYJVg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] spawnProcess - reapProcess not retrying on failures">adi at roiban.ro
       </A><BR>
    <I>Tue Sep  2 03:08:49 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="061176.html">[Twisted-Python] what is a non-class class?
</A></li>
        <LI>Next message (by thread): <A HREF="061150.html">[Twisted-Python] spawnProcess - reapProcess not retrying on	failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28688">[ date ]</a>
              <a href="thread.html#28688">[ thread ]</a>
              <a href="subject.html#28688">[ subject ]</a>
              <a href="author.html#28688">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

While using spawnProcess on Linux I found out that when an invalid
executable is called there is a corner case in which a zombie process
is left until main process exists and can not be closed.

I wrote a test for this but I was not able to reproduce this error in
isolation, event if I run the test for 10000 times. reapProcess will
always succeed from the first call.

For the production code I can always reproduce the problem.

Inspecting the execution thread I found out that all pipes are closed
but spawned process is not closed yet. Due to this
Process.maybeCallProcessEnded() will call self.reapProcess().

In my case,  os.waitpid(pid, os.WNOHANG) return 0, and
self.reapProcess() will just ignore this case.

Process handlers is still registered in reapProcessHandlers but
reapAllProcesses is no longer called.

If a add a reactor.callLater(self.reapProcess) the next call to
os.waitpid will succeed and the forked process is closed.

------------

What am I doing wrong? Why reapAllProcesses is no longer called, even
if reapProcessHandlers is not empty?

My process protocol code is here
<A HREF="https://gist.github.com/adiroiban/bac493f00ce5e94738ce">https://gist.github.com/adiroiban/bac493f00ce5e94738ce</A> but from what I
see, this should happen for any protocol.

Many thanks,

-- 
Adi Roiban

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="061176.html">[Twisted-Python] what is a non-class class?
</A></li>
	<LI>Next message (by thread): <A HREF="061150.html">[Twisted-Python] spawnProcess - reapProcess not retrying on	failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28688">[ date ]</a>
              <a href="thread.html#28688">[ thread ]</a>
              <a href="subject.html#28688">[ subject ]</a>
              <a href="author.html#28688">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
