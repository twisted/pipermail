<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Graceful shutdown of twistd application
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Graceful%20shutdown%20of%20twistd%20application&In-Reply-To=%3C20140904125549.20413.481091133.divmod.xquotient.1886%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028720.html">
   <LINK REL="Next"  HREF="028725.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Graceful shutdown of twistd application</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Graceful%20shutdown%20of%20twistd%20application&In-Reply-To=%3C20140904125549.20413.481091133.divmod.xquotient.1886%40top%3E"
       TITLE="[Twisted-Python] Graceful shutdown of twistd application">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Sep  4 06:55:49 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028720.html">[Twisted-Python] Graceful shutdown of twistd application
</A></li>
        <LI>Next message: <A HREF="028725.html">[Twisted-Python] Graceful shutdown of twistd application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28722">[ date ]</a>
              <a href="thread.html#28722">[ thread ]</a>
              <a href="subject.html#28722">[ subject ]</a>
              <a href="author.html#28722">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12:36 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sangiovanni at nweb.it</A> wrote:
&gt;<i>On Thu, Sep 4, 2014 at 2:02 PM, &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>You said before shutdown triggers are too late but you didn't say why. 
</I>&gt;&gt;<i>I
</I>&gt;&gt;<i>think that's based on a misunderstanding - but if not, then explain 
</I>&gt;&gt;<i>why it
</I>&gt;&gt;<i>doesn't work for your scenario.
</I>&gt;<i>
</I>&gt;<i>Hi, thanks for your reply.
</I>&gt;<i>
</I>&gt;<i>I've tried the following:
</I>&gt;<i>
</I>&gt;<i>def sleep(secs):
</I>&gt;<i>    log.msg('from within trigger')
</I>&gt;<i>    d = defer.Deferred()
</I>&gt;<i>    reactor.callLater(secs, d.callback, None)
</I>&gt;<i>    return d
</I>&gt;<i>
</I>&gt;<i>reactor.addSystemEventTrigger('before', 'shutdown', sleep, 10)
</I>
All 'before' trigger are run concurrently.  If you're using 
`Application` then your `sleep` trigger runs concurrently with the 
application's `stopService` trigger (because `Application` has its 
stopService added as another 'before' shutdown' trigger alongside 
yours).

If you want to delay your application shutdown, you need to cooperate a 
little more closely with it.  Either attach your application shutdown 
code as a callback to the sleep Deferred or move the sleep into the 
stopService implementation of one of the services on your application 
and trigger the remaining stopService calls (eg the stopService call on 
the MultiService you mentioned) when the sleep Deferred fires there.

Jean-Paul

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028720.html">[Twisted-Python] Graceful shutdown of twistd application
</A></li>
	<LI>Next message: <A HREF="028725.html">[Twisted-Python] Graceful shutdown of twistd application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28722">[ date ]</a>
              <a href="thread.html#28722">[ thread ]</a>
              <a href="subject.html#28722">[ subject ]</a>
              <a href="author.html#28722">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
