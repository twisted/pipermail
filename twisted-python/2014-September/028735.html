<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Python3: should paths be bytes or str?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Python3%3A%20should%20paths%20be%20bytes%20or%20str%3F&In-Reply-To=%3C20140908021410.20413.2139896976.divmod.xquotient.2126%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028734.html">
   <LINK REL="Next"  HREF="028737.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Python3: should paths be bytes or str?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Python3%3A%20should%20paths%20be%20bytes%20or%20str%3F&In-Reply-To=%3C20140908021410.20413.2139896976.divmod.xquotient.2126%40top%3E"
       TITLE="[Twisted-Python] Python3: should paths be bytes or str?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Sun Sep  7 20:14:10 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028734.html">[Twisted-Python] Python3: should paths be bytes or str?
</A></li>
        <LI>Next message: <A HREF="028737.html">[Twisted-Python] Python3: should paths be bytes or str?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28735">[ date ]</a>
              <a href="thread.html#28735">[ thread ]</a>
              <a href="subject.html#28735">[ subject ]</a>
              <a href="author.html#28735">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01:26 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wolfgang.kde at rohdewald.de</A> wrote:
&gt;<i>The porting guide says
</I>&gt;<i>
</I>&gt;<i>No byte paths in sys.path.
</I>
What porting guide is that?
&gt;<i>
</I>&gt;<i>doc for FilePath says
</I>&gt;<i>    On both Python 2 and Python 3, paths can only be bytes.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I stumbled upon this while trying to find out how much work it might be
</I>&gt;<i>to make bin/trial run with python3
</I>&gt;<i>
</I>&gt;<i>admin/run-python3-tests already passes for all twisted.spread related
</I>&gt;<i>tests but I still need to clean up a lot.
</I>&gt;<i>
</I>&gt;<i>after adding an assert to FilePath.__init__, python3 bin/trial ... 
</I>&gt;<i>gives
</I>&gt;<i>
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;, line 601, in 
</I>&gt;<i>run
</I>&gt;<i>    config.parseOptions()
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/usage.py&quot;, line 277, in 
</I>&gt;<i>parseOptions
</I>&gt;<i>    self.postOptions()
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;, line 472, in 
</I>&gt;<i>postOptions
</I>&gt;<i>    _BasicOptions.postOptions(self)
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;, line 382, in 
</I>&gt;<i>postOptions
</I>&gt;<i>    self['reporter'] = self._loadReporterByName(self['reporter'])
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;, line 369, in 
</I>&gt;<i>_loadReporterByName
</I>&gt;<i>    for p in plugin.getPlugins(itrial.IReporter):
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/plugin.py&quot;, line 209, in 
</I>&gt;<i>getPlugins
</I>&gt;<i>    allDropins = getCache(package)
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/plugin.py&quot;, line 134, in 
</I>&gt;<i>getCache
</I>&gt;<i>    mod = getModule(module.__name__)
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;, line 781, in 
</I>&gt;<i>getModule
</I>&gt;<i>    return theSystemPath[moduleName]
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;, line 702, in 
</I>&gt;<i>__getitem__
</I>&gt;<i>    self._findEntryPathString(moduleObject)),
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;, line 627, in 
</I>&gt;<i>_findEntryPathString
</I>&gt;<i>    if _isPackagePath(FilePath(topPackageObj.__file__)):
</I>&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/filepath.py&quot;, line 664, 
</I>&gt;<i>in __init__
</I>&gt;<i>    assert isinstance(path, bytes), 'path must be bytes: %r' % (path,)
</I>&gt;<i>AssertionError: path must be bytes: 
</I>&gt;<i>'/home/wr/ssdsrc/Twisted/twisted/__init__.py'
</I>
If paths are being represented using unicode somewhere and you want to 
use them with FilePath then you have to encode them (or you have to add 
unicode path support to FilePath and let FilePath encode them).

Unfortunately it's not entirely obvious how to make FilePath support 
unicode paths since not all platforms Twisted supports represent 
filesystem paths using unicode.

The choice python-dev made to bridge this gap was the creation of the 
&quot;surrogateescape&quot; error handler for the UTC-8 codec.  This lets you 
pretend that any time you need to convert between bytes and unicode the 
correct codec is UTF-8 (with this special error handler).

It's not clear this was a good choice (since the result is unicode 
strings that may contain garbage which will confuse other software) but 
it's also not clear it's possible for Twisted to try to make any other 
choice (at some point Twisted has to interoperate with the path-related 
APIs in Python itself - `sys.path`, for example).

Not sure if that helps you at all.  Maybe it outlines the problem a 
little more clearly, at least.

Jean-Paul

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028734.html">[Twisted-Python] Python3: should paths be bytes or str?
</A></li>
	<LI>Next message: <A HREF="028737.html">[Twisted-Python] Python3: should paths be bytes or str?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28735">[ date ]</a>
              <a href="thread.html#28735">[ thread ]</a>
              <a href="subject.html#28735">[ subject ]</a>
              <a href="author.html#28735">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
