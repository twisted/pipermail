<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] INCOMPATIBLE CHANGE: twisted.python.threadpool
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20INCOMPATIBLE%20CHANGE%3A%20twisted.python.threadpool&In-Reply-To=%3CetPan.54258bf1.6b8b4567.609%40densetsu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="061269.html">
   <LINK REL="Next"  HREF="061275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] INCOMPATIBLE CHANGE: twisted.python.threadpool</H1>
    <B>Christopher Armstrong</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20INCOMPATIBLE%20CHANGE%3A%20twisted.python.threadpool&In-Reply-To=%3CetPan.54258bf1.6b8b4567.609%40densetsu%3E"
       TITLE="[Twisted-Python] INCOMPATIBLE CHANGE: twisted.python.threadpool">radix at twistedmatrix.com
       </A><BR>
    <I>Fri Sep 26 09:53:20 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="061269.html">[Twisted-Python] INCOMPATIBLE CHANGE: twisted.python.threadpool
</A></li>
        <LI>Next message (by thread): <A HREF="061275.html">[Twisted-Python] INCOMPATIBLE CHANGE: twisted.python.threadpool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61268">[ date ]</a>
              <a href="thread.html#61268">[ thread ]</a>
              <a href="subject.html#61268">[ subject ]</a>
              <a href="author.html#61268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On September 25, 2014 at 8:39:54 PM, weykent (<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">weykent at weasyl.com</A>) wrote:
On Sep 25, 2014, at 3:31 PM, Glyph Lefkowitz &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:  

&gt;<i> So, does anyone out there have any code which makes use of the aforementioned bad attributes of ThreadPool, whose applications would break if I removed them?  
</I>
Yes. Specifically, I am maintaining this AMP responder method:  

@FetchThreadPoolStats.responder  
def fetchThreadPoolStats(self):  
pool = self.factory.threadPool  
return dict(  
threadsWaiting=len(pool.waiters),  
threadsWorking=len(pool.working),  
workerQueueSize=pool.q.qsize(),  
)  

These statistics are chunked into graphite and displayed as a nice little graph. They’ve been quite useful on some occasions: sometimes all of the threads in a thread pool for a WSGI application got blocked, and the symptoms were that all of the requests coming in were timing out at the proxy in front of twisted. We were able to quickly tell that the problem was the WSGI thread pool because the threadsWorking count was at its limit and the workerQueueSize was skyrocketing.  



We did very similar stuff (logging thread pool size to graphite) at id, so they're probably still using those bits too.


&gt;<i> If so, how can I make you feel as bad about yourselves for using it as I feel bad about myself for writing it? ;-) 
</I>
I don’t really see this as an abuse of the public interface. If possible, I’d like to see this diagnostic information preserved in the new interface, as I consider it invaluable information as long as we’re using twisted as a WSGI runner. 

I will say that it is certainly possible for me to emulate these attributes, but that would require touching implementation details of WSGIResource. I’m not sure which is worse. 

~weykent 


-- 
Christopher Armstrong
<A HREF="http://twitter.com/radix">http://twitter.com/radix</A>
<A HREF="http://wordeology.com/">http://wordeology.com/</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20140926/c3cf8c41/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="061269.html">[Twisted-Python] INCOMPATIBLE CHANGE: twisted.python.threadpool
</A></li>
	<LI>Next message (by thread): <A HREF="061275.html">[Twisted-Python] INCOMPATIBLE CHANGE: twisted.python.threadpool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61268">[ date ]</a>
              <a href="thread.html#61268">[ thread ]</a>
              <a href="subject.html#61268">[ subject ]</a>
              <a href="author.html#61268">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
