<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Python3: should paths be bytes or str?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Python3%3A%20should%20paths%20be%20bytes%20or%20str%3F&In-Reply-To=%3CCAPkN8x%2B%2Bomr85TNcQp0awMQcPySeRjJS3RHqbmshDnb-DnoztQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028737.html">
   <LINK REL="Next"  HREF="028745.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Python3: should paths be bytes or str?</H1>
    <B>anatoly techtonik</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Python3%3A%20should%20paths%20be%20bytes%20or%20str%3F&In-Reply-To=%3CCAPkN8x%2B%2Bomr85TNcQp0awMQcPySeRjJS3RHqbmshDnb-DnoztQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Python3: should paths be bytes or str?">techtonik at gmail.com
       </A><BR>
    <I>Mon Sep  8 04:26:58 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="028737.html">[Twisted-Python] Python3: should paths be bytes or str?
</A></li>
        <LI>Next message: <A HREF="028745.html">[Twisted-Python] Python3: should paths be bytes or str?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28738">[ date ]</a>
              <a href="thread.html#28738">[ thread ]</a>
              <a href="subject.html#28738">[ subject ]</a>
              <a href="author.html#28738">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Sep 8, 2014 at 5:14 AM,  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
&gt;<i> On 01:26 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wolfgang.kde at rohdewald.de</A> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The porting guide says
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> No byte paths in sys.path.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What porting guide is that?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> doc for FilePath says
</I>&gt;&gt;<i>    On both Python 2 and Python 3, paths can only be bytes.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I stumbled upon this while trying to find out how much work it might be
</I>&gt;&gt;<i> to make bin/trial run with python3
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> admin/run-python3-tests already passes for all twisted.spread related
</I>&gt;&gt;<i> tests but I still need to clean up a lot.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> after adding an assert to FilePath.__init__, python3 bin/trial ... gives
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;, line 601, in run
</I>&gt;&gt;<i>    config.parseOptions()
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/usage.py&quot;, line 277, in
</I>&gt;&gt;<i> parseOptions
</I>&gt;&gt;<i>    self.postOptions()
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;, line 472, in
</I>&gt;&gt;<i> postOptions
</I>&gt;&gt;<i>    _BasicOptions.postOptions(self)
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;, line 382, in
</I>&gt;&gt;<i> postOptions
</I>&gt;&gt;<i>    self['reporter'] = self._loadReporterByName(self['reporter'])
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/scripts/trial.py&quot;, line 369, in
</I>&gt;&gt;<i> _loadReporterByName
</I>&gt;&gt;<i>    for p in plugin.getPlugins(itrial.IReporter):
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/plugin.py&quot;, line 209, in getPlugins
</I>&gt;&gt;<i>    allDropins = getCache(package)
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/plugin.py&quot;, line 134, in getCache
</I>&gt;&gt;<i>    mod = getModule(module.__name__)
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;, line 781, in
</I>&gt;&gt;<i> getModule
</I>&gt;&gt;<i>    return theSystemPath[moduleName]
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;, line 702, in
</I>&gt;&gt;<i> __getitem__
</I>&gt;&gt;<i>    self._findEntryPathString(moduleObject)),
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/modules.py&quot;, line 627, in
</I>&gt;&gt;<i> _findEntryPathString
</I>&gt;&gt;<i>    if _isPackagePath(FilePath(topPackageObj.__file__)):
</I>&gt;&gt;<i>  File &quot;/home/wr/ssdsrc/Twisted/twisted/python/filepath.py&quot;, line 664, in
</I>&gt;&gt;<i> __init__
</I>&gt;&gt;<i>    assert isinstance(path, bytes), 'path must be bytes: %r' % (path,)
</I>&gt;&gt;<i> AssertionError: path must be bytes:
</I>&gt;&gt;<i> '/home/wr/ssdsrc/Twisted/twisted/__init__.py'
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If paths are being represented using unicode somewhere and you want to use
</I>&gt;<i> them with FilePath then you have to encode them (or you have to add unicode
</I>&gt;<i> path support to FilePath and let FilePath encode them).
</I>&gt;<i>
</I>&gt;<i> Unfortunately it's not entirely obvious how to make FilePath support unicode
</I>&gt;<i> paths since not all platforms Twisted supports represent filesystem paths
</I>&gt;<i> using unicode.
</I>
It really depends on filesystem, not on a platform. Platform just makes sure
that you won't shoot it in the foot. So to behave good you need to translate
you path knowledge to platform knowledge when you have to make change.

In data transformation theory that may mean:
[ ] get data about path in native format
  [ ] detect the source encoding of filesystem
[ ] figure out if you can work with native format
  [ ] python 2 way - just work with bytes
  [ ] python 3 way - look if native filesystem format is convertible to unicode
    [ ] if conversion is symmetrical - operate in unicode
    [ ] if not convertible, alternatives (options, switches)
      [ ] fail and explain why to user in user actionable manner (don't use ?)
      [ ] use some symmetrical mapping to unicode and mark path objects as
          `mapped` so that there is a trace of hacks on filepaths
      [ ] provide API on objects without ability to use names directly
      [ ] transform the name to a &quot;safe&quot; valid value loosing the original name
          and explain the user why and what happened to the old name

&gt;<i> The choice python-dev made to bridge this gap was the creation of the
</I>&gt;<i> &quot;surrogateescape&quot; error handler for the UTC-8 codec.  This lets you pretend
</I>&gt;<i> that any time you need to convert between bytes and unicode the correct
</I>&gt;<i> codec is UTF-8 (with this special error handler).
</I>&gt;<i>
</I>&gt;<i> It's not clear this was a good choice (since the result is unicode strings
</I>&gt;<i> that may contain garbage which will confuse other software) but it's also
</I>&gt;<i> not clear it's possible for Twisted to try to make any other choice (at some
</I>&gt;<i> point Twisted has to interoperate with the path-related APIs in Python
</I>&gt;<i> itself - `sys.path`, for example).
</I>&gt;<i>
</I>&gt;<i> Not sure if that helps you at all.  Maybe it outlines the problem a little
</I>&gt;<i> more clearly, at least.
</I>
I think that it should be a choice of application maintainers. If they want to
create files with dots at the end, Windows allows this, but doesn't support
it through standard WinAPI calls, because of FAT. But you can use special
path transformation prefix \\?\ to do this on NTFS or on a remote machine.
In networking OS plays less role, but the new choice for every platform
filesystem is not clear for users. They don't realize where the problem
comes from. In the end it all depends on FS first, then on
OS API (which can be skipped thanks to direct disk access), then on
FS library, then on application. Application should be able to opt-in for
handling all possible cases, or just &quot;safe&quot; subset or something middle,
so a task of a framework is to just describe the problem well and ensure
that people can make their choice.
-- 
anatoly t.

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028737.html">[Twisted-Python] Python3: should paths be bytes or str?
</A></li>
	<LI>Next message: <A HREF="028745.html">[Twisted-Python] Python3: should paths be bytes or str?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28738">[ date ]</a>
              <a href="thread.html#28738">[ thread ]</a>
              <a href="subject.html#28738">[ subject ]</a>
              <a href="author.html#28738">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
