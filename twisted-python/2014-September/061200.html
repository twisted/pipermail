<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] PEP3131: non-ascii identifiers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20PEP3131%3A%20non-ascii%20identifiers&In-Reply-To=%3C20140908105444.20413.527660985.divmod.xquotient.2139%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="028736.html">
   <LINK REL="Next"  HREF="061201.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] PEP3131: non-ascii identifiers</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20PEP3131%3A%20non-ascii%20identifiers&In-Reply-To=%3C20140908105444.20413.527660985.divmod.xquotient.2139%40top%3E"
       TITLE="[Twisted-Python] PEP3131: non-ascii identifiers">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Sep  8 04:54:44 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="028736.html">[Twisted-Python] PEP3131: non-ascii identifiers
</A></li>
        <LI>Next message (by thread): <A HREF="061201.html">[Twisted-Python] PEP3131: non-ascii identifiers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61200">[ date ]</a>
              <a href="thread.html#61200">[ thread ]</a>
              <a href="subject.html#61200">[ subject ]</a>
              <a href="author.html#61200">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09:19 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wolfgang.kde at rohdewald.de</A> wrote:
&gt;<i>This does not seem to be supported by Python yet.
</I>&gt;<i>
</I>&gt;<i>Should that be enabled at all?
</I>&gt;<i>If one process with PY3 sends such identifiers to
</I>&gt;<i>a separate process with PY2, that will fail. I am not
</I>&gt;<i>sure if that would be a problem, whoever uses this must
</I>&gt;<i>make sure PY3 is used everywhere.
</I>
This is why we will *not* change the PB wire protocol as part of the 
porting work.  The wire protocol will remain the same whether you are 
using Python 2 or Python 3 to run your program or.

This is the point of a protocol, after all.  It is to let two programs 
communicate with each other.
&gt;<i>If this should be forbidden, I will add a test to
</I>&gt;<i>test_pb for this. And of course somebody should document that
</I>&gt;<i>somewhere. There more PEP3131 is used, the more users will
</I>&gt;<i>fall into this trap.
</I>
I'm not exactly sure what you mean here.  Using unicode where only bytes 
are allowed is probably already forbidden throughout PB.
&gt;<i>
</I>&gt;<i>If this should be enabled (which I think is not difficult,
</I>&gt;<i>at least for pb):
</I>&gt;<i>
</I>&gt;<i>At least the patch below will be needed (only for PY3),
</I>&gt;<i>maybe it is already sufficient. Given that nativeString
</I>&gt;<i>and networkString are always used (done that for pb).
</I>&gt;<i>
</I>&gt;<i>networkString may then return bytes with the high bit set
</I>
Definitely not.
&gt;<i>But since networkString is called in many places I want to ask and
</I>&gt;<i>make sure that it may really be changed this way.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i><A HREF="https://twistedmatrix.com/documents/14.0.0/core/specifications/banana.html">https://twistedmatrix.com/documents/14.0.0/core/specifications/banana.html</A>
</I>&gt;<i>does not speak against it, so I wonder why networkString has that 
</I>&gt;<i>limitation
</I>&gt;<i>to 7bit.
</I>
That is the sole purpose of `networkString`.  It is a work-around for 
the inconvenient fact that Python changed the meaning of the string 
literal syntax from bytes to unicode.
&gt;<i>
</I>&gt;<i>concrete banana-encoded example, from modified test_pb: (the method 
</I>&gt;<i>name is getSimple√§)
</I>&gt;<i>test_pb still passes with patched nativeString/networkString (but I
</I>&gt;<i>only have one test for this so far, test_refcount).
</I>&gt;<i>
</I>&gt;<i>b'\x07\x80\x07\x82message\x01\x81\x03\x82foo\x0b\x82getSimple\xc3\xa4\x01\x81\x01\x80\x05\x82tuple\x01\x80\n\x82dictionary'
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>diff --git twisted/python/compat.py twisted/python/compat.py
</I>&gt;<i>index 6f76c39..6919cf6 100644
</I>&gt;<i>--- twisted/python/compat.py
</I>&gt;<i>+++ twisted/python/compat.py
</I>&gt;<i>@@ -348,10 +348,9 @@ def nativeString(s):
</I>&gt;<i>         raise TypeError(&quot;%r is neither bytes nor unicode&quot; % s)
</I>&gt;<i>     if _PY3:
</I>&gt;<i>         if isinstance(s, bytes):
</I>&gt;<i>-            return s.decode(&quot;ascii&quot;)
</I>&gt;<i>+            return s.decode(&quot;utf-8&quot;)
</I>&gt;<i>         else:
</I>&gt;<i>-            # Ensure we're limited to ASCII subset:
</I>&gt;<i>-            s.encode(&quot;ascii&quot;)
</I>&gt;<i>+            return s
</I>&gt;<i>     else:
</I>&gt;<i>         if isinstance(s, unicode):
</I>&gt;<i>             return s.encode(&quot;ascii&quot;)
</I>&gt;<i>@@ -428,7 +427,7 @@ if _PY3:
</I>&gt;<i>     def networkString(s):
</I>&gt;<i>         if not isinstance(s, unicode):
</I>&gt;<i>             raise TypeError(&quot;Can only convert text to bytes on Python 
</I>&gt;<i>3, I got %r&quot; % (s,))
</I>&gt;<i>-        return s.encode('ascii')
</I>&gt;<i>+        return s.encode('utf-8')
</I>&gt;<i>
</I>&gt;<i>     def networkChar(integer):
</I>&gt;<i>         &quot;&quot;&quot;
</I>
This change definitely won't be acceptable.  It completely removes the 
feature `networkString` exists to provide: verifying that strings that 
might be either unicode or bytes can still be implicitly combined into 
bytes.

Can you point out the specific places where you think PB needs to start 
using UTF-8 instead of ASCII?  Those are the places that need to be 
fixed, not the underlying porting helpers they happen to use.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="028736.html">[Twisted-Python] PEP3131: non-ascii identifiers
</A></li>
	<LI>Next message (by thread): <A HREF="061201.html">[Twisted-Python] PEP3131: non-ascii identifiers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61200">[ date ]</a>
              <a href="thread.html#61200">[ thread ]</a>
              <a href="subject.html#61200">[ subject ]</a>
              <a href="author.html#61200">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
