<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] spawnProcess - reapProcess not retrying on failures
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20spawnProcess%20-%20reapProcess%20not%20retrying%20on%0A%20failures&In-Reply-To=%3C20140905121355.20413.575214074.divmod.xquotient.2052%40top%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="061185.html">
   <LINK REL="Next"  HREF="061188.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] spawnProcess - reapProcess not retrying on failures</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20spawnProcess%20-%20reapProcess%20not%20retrying%20on%0A%20failures&In-Reply-To=%3C20140905121355.20413.575214074.divmod.xquotient.2052%40top%3E"
       TITLE="[Twisted-Python] spawnProcess - reapProcess not retrying on failures">exarkun at twistedmatrix.com
       </A><BR>
    <I>Fri Sep  5 06:13:55 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="061185.html">[Twisted-Python] spawnProcess - reapProcess not retrying on	failures
</A></li>
        <LI>Next message (by thread): <A HREF="061188.html">[Twisted-Python] spawnProcess - reapProcess not retrying on	failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61187">[ date ]</a>
              <a href="thread.html#61187">[ thread ]</a>
              <a href="subject.html#61187">[ subject ]</a>
              <a href="author.html#61187">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06:30 am, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A> wrote:
&gt;<i>On 4 September 2014 12:59,  &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i>[snip]
</I>&gt;&gt;<i>What would be really nice is if someone collected *all* of the 
</I>&gt;&gt;<i>complaints
</I>&gt;&gt;<i>about `spawnProcess` into one place and integrated solutions to them 
</I>&gt;&gt;<i>into a
</I>&gt;&gt;<i>design for a replacement. :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Jean-Paul
</I>&gt;<i>
</I>&gt;<i>Since I can not create wiki pages here are my notes:
</I>&gt;<i>
</I>&gt;<i>To do:
</I>&gt;<i>
</I>&gt;<i>* Always return a deferred. #2415
</I>&gt;<i>
</I>&gt;<i>* Provide the option to timeout the execution... and on timeout errback 
</I>&gt;<i>with
</I>&gt;<i>  a dedicated failure #2415
</I>&gt;<i>
</I>&gt;<i>* Add childs to the same process group #2415
</I>&gt;<i>
</I>&gt;<i>* allways errback when failing to spawn (rather than raising OSError) 
</I>&gt;<i>and
</I>&gt;<i>  errback with a different failure when failing to spawn the executable 
</I>&gt;<i>#4184
</I>&gt;<i>
</I>&gt;<i>* on Unix provide a method to install SIGCHLD handler, independent of 
</I>&gt;<i>the
</I>&gt;<i>  general reactor.run() signal handlers. ... maybe related to #5710
</I>&gt;<i>
</I>&gt;<i>* Allow passing Unicode environment (at least on Windows) maybe needed
</I>&gt;<i>for Python3 #5968
</I>&gt;<i>
</I>&gt;<i>* Allow passing Unicode command and arguments on Windows (current not
</I>&gt;<i>supported by pywin32 CreateProcess) #6470... maybe needed for Python3
</I>&gt;<i>#5968
</I>&gt;<i>
</I>&gt;<i>* Improve fork/exec for speed and memory usage #5710 .... maybe by 
</I>&gt;<i>creating
</I>&gt;<i>  a auxiliary process which handles forks and child management.
</I>&gt;<i>
</I>&gt;<i>* Execute as a different account in Windows
</I>&gt;<i>
</I>&gt;<i>* Spawn only after reactor starts ? I am ok with forking before.
</I>&gt;<i>
</I>&gt;<i>* Support client endpoint?
</I>&gt;<i>
</I>&gt;<i>-------
</I>&gt;<i>
</I>&gt;<i>For a new design:
</I>&gt;<i>
</I>&gt;<i>* I like the ProcessProtocol API
</I>
I don't. :)  ProcessProtocol means you can't re-use any of your existing 
IProtocol implementations.  Oops.

It seems like a better API would let you say &quot;Here is a protocol, hook 
its output up to fd 0 in the process, hook fd 1 in the process up to its 
input.  Here is another protocol, hook fd 2 in the process up to its 
input&quot; (this would probably be a common configuration - &quot;speak some 
regular protocol over stdin/stdout, have a little special logic 
(probably logging) for stderr).

On the other hand, it's possible to build this on top of ProcessProtocol 
and no one ever has...
&gt;<i>* spawnProcess will always return a deferred... for backward 
</I>&gt;<i>compatibility
</I>&gt;<i>  we need to decide a name for this new method which returns a deferred.
</I>&gt;<i>  Maybe createProcess or connectProcess
</I>&gt;<i>
</I>&gt;<i>* create spawnUnixProcess which has childFDs uid/gid
</I>&gt;<i>
</I>&gt;<i>* create spawnWindowsProcess which has Windows specific options
</I>&gt;<i>
</I>&gt;<i>* createProcess / connectProcess will call spawnUnixProcess or
</I>&gt;<i>spawnWindowsProcess
</I>&gt;<i>  depending on current OS
</I>&gt;<i>
</I>&gt;<i>* ProcessProtocol.processEnded is similar to connectionLost..
</I>&gt;<i>  so maybe it can be rename it and add other methods so that 
</I>&gt;<i>IProcessProtocol
</I>&gt;<i>  can inherit from IProtocol. I guess that this will help with 
</I>&gt;<i>connectors.
</I>
Let's not introduce new cases where inheritance is encouraged.
&gt;<i>------
</I>&gt;<i>
</I>&gt;<i>I think that child management problem, does not affect the public API 
</I>&gt;<i>so I am
</I>&gt;<i>not discussing it here.
</I>&gt;<i>
</I>&gt;<i>Timeouts are handled at protocol level and I see that we have 2 timeout 
</I>&gt;<i>types:
</I>&gt;<i>total execution time and  timeout after last child data was received.
</I>&gt;<i>
</I>&gt;<i>-----
</I>&gt;<i>
</I>&gt;<i>Does it make sense to put it on wiki or what should be the Twisted
</I>&gt;<i>Enhancement Proposal process?
</I>
I think it's easier to maintain a document on the wiki than in threads 
on the mailing list.
&gt;<i>Can I get 'create page' rights on Trac?
</I>
Hm.  I thought everyone had wiki edit rights (except for a small number 
of privileged pages) by default - so I'm not sure what's going on here 
or how to give you permissions.  Perhaps something changed in the trac 
upgrade or as part of the recent ticket permission reconfiguration.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="061185.html">[Twisted-Python] spawnProcess - reapProcess not retrying on	failures
</A></li>
	<LI>Next message (by thread): <A HREF="061188.html">[Twisted-Python] spawnProcess - reapProcess not retrying on	failures
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61187">[ date ]</a>
              <a href="thread.html#61187">[ thread ]</a>
              <a href="subject.html#61187">[ subject ]</a>
              <a href="author.html#61187">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
