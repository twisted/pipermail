<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] On testing things wrapping other things
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20On%20testing%20things%20wrapping%20other%20things&In-Reply-To=%3C3257A578-D2A5-4523-87F2-FC4DBAAC696D%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="028777.html">
   <LINK REL="Next"  HREF="061242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] On testing things wrapping other things</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20On%20testing%20things%20wrapping%20other%20things&In-Reply-To=%3C3257A578-D2A5-4523-87F2-FC4DBAAC696D%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] On testing things wrapping other things">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Sep 21 11:36:37 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="028777.html">[Twisted-Python] On testing things wrapping other things
</A></li>
        <LI>Next message (by thread): <A HREF="061242.html">[Twisted-Python] On testing things wrapping other things
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61241">[ date ]</a>
              <a href="thread.html#61241">[ thread ]</a>
              <a href="subject.html#61241">[ subject ]</a>
              <a href="author.html#61241">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Sep 20, 2014, at 11:31 AM, weykent &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">weykent at weasyl.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Recently I worked on refactoring a project so that it was, in my opinion, more testable. For reference, the diff is available at &lt;<A HREF="https://github.com/Weasyl/txyam/compare/Weasyl:9230b7d09c1413a09d776700f26a01865aa99604...cdf7aef9e3425f27016f8e97c59bd2143fbf805c">https://github.com/Weasyl/txyam/compare/Weasyl:9230b7d09c1413a09d776700f26a01865aa99604...cdf7aef9e3425f27016f8e97c59bd2143fbf805c</A>&gt;, and the important parts in the changed version are at &lt;<A HREF="https://github.com/Weasyl/txyam/blob/cdf7aef9e3425f27016f8e97c59bd2143fbf805c/txyam/client.py#L24-L49">https://github.com/Weasyl/txyam/blob/cdf7aef9e3425f27016f8e97c59bd2143fbf805c/txyam/client.py#L24-L49</A>&gt;. 
</I>&gt;<i> 
</I>&gt;<i> My question: is this a good factoring for testing a wrapper? It seems to make sense to split apart crafting and issuing requests to clients, as it lets you test the contents of a request to see what will happen instead of having to issue the request and test that its effects happened.
</I>
If anything I'd say that the problem with this code is that it's not a public, documented interface. The clients of this library might want to test it as well :).

&gt;<i> On a previous iteration of this project, I wrote tests that did exactly that: issued requests and checked the bytes that were sent to a StringTransport. Those tests ended up being harder to read and write, and seemed to rely on the exact implementation of the thing I was wrapping.
</I>
If you're going to check the bytes in a StringTransport, that means you need an implementation of the other end of the protocol as well.  If you're just asserting about the exact bytes, then that's really brittle and will break in response to lots of incidental changes.

You can use this as a part of a higher-level testing strategy, like so:

&lt;<A HREF="https://github.com/rackerlabs/mimic/blob/master/mimic/test/helpers.py">https://github.com/rackerlabs/mimic/blob/master/mimic/test/helpers.py</A>&gt;

but in this case the unit test code doesn't see the response to its requests until it's been parsed into a sensible data structure, and assertions are about that.

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20140921/5feb7876/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="028777.html">[Twisted-Python] On testing things wrapping other things
</A></li>
	<LI>Next message (by thread): <A HREF="061242.html">[Twisted-Python] On testing things wrapping other things
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61241">[ date ]</a>
              <a href="thread.html#61241">[ thread ]</a>
              <a href="subject.html#61241">[ subject ]</a>
              <a href="author.html#61241">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
