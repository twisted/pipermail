<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferred object inside function
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferred%20object%20inside%20function&In-Reply-To=371DA0C2-3F88-46AA-83A1-13453418528A%40gravina.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013608.html">
   <LINK REL="Next"  HREF="013611.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferred object inside function</H1>
    <B>Chaz.</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20deferred%20object%20inside%20function&In-Reply-To=371DA0C2-3F88-46AA-83A1-13453418528A%40gravina.com"
       TITLE="[Twisted-Python] deferred object inside function">eprparadocs at gmail.com
       </A><BR>
    <I>Fri Jul  7 07:07:57 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="013608.html">[Twisted-Python] deferred object inside function
</A></li>
        <LI>Next message: <A HREF="013611.html">[Twisted-Python] deferred object inside function
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13609">[ date ]</a>
              <a href="thread.html#13609">[ thread ]</a>
              <a href="subject.html#13609">[ subject ]</a>
              <a href="author.html#13609">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Boy no one seemed to offer the answer. What will happen in your code, if
I am not mistaken, is that somefunct1() will be called with the results
of the resolver. In essense r.resolve() when it returns the deferred
promises to invoke one of the callbacks (either the normal one or error
one). To that call back it will supply an appropriate argument.

You should do a 'return d' from your function. Anyone that issues a
Callback against that deferred will be invoked only if your function
somefunct() uses the defer.

Hope that helps. If not, send me a private email and I can help you get it.

Chaz

Robert Gravina wrote:
&gt;&gt;<i> Yusnel Rojas Garc&#237;a wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> how can I make a function which have a deferred object return a value
</I>&gt;&gt;&gt;<i> that
</I>&gt;&gt;&gt;<i> depends of the deferred object's result.
</I>&gt;&gt;&gt;<i> example:
</I>&gt;&gt;&gt;<i> how can get the result from the resolver?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> from twisted.names import client, dns
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> def somefunction(somepars):
</I>&gt;&gt;&gt;<i>       r  = client.Resolver('/etc/resolv.conf')
</I>&gt;&gt;&gt;<i>       d = r.resolve(dns.Query('www.example.com', dns.MX, dns.IN))
</I>&gt;&gt;&gt;<i>       d.Callbacks(somefunct1, somefunctErr2)
</I>&gt;&gt;&gt;<i>       return ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Have you read the docs on deferreds? There's a bunch of good ones now,
</I>&gt;&gt;<i> and you can get to them here:
</I>&gt;&gt;<i>   <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/index.html">http://twistedmatrix.com/projects/core/documentation/howto/index.html</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Yes, I think
</I>&gt;<i> <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/defer.html">http://twistedmatrix.com/projects/core/documentation/howto/defer.html</A> is
</I>&gt;<i> a good place to start also.
</I>&gt;<i> 
</I>&gt;<i> While I'm no Twisted expert, I think the main point of confusion you are
</I>&gt;<i> having is here:
</I>&gt;<i> 
</I>&gt;<i> d.Callbacks(somefunct1, somefunctErr2)
</I>&gt;<i> return ?
</I>&gt;<i> 
</I>&gt;<i> The great thing about Deferreds (and Twisted) is that it is asynchronous
</I>&gt;<i> - that means that calls like your DNS query are non-blocking - in other
</I>&gt;<i> words, your program doesn't sit around and wait while the DNS query is
</I>&gt;<i> happening. I think you are expecting your program to wait until the DNS
</I>&gt;<i> query is finished before getting to the &quot;return&quot; line... but it will
</I>&gt;<i> keep on going, and later (at some time, maybe a few seconds later)
</I>&gt;<i> either your &quot;somefunct1&quot; will be called if everything worked out, or
</I>&gt;<i> your &quot;somefunctErr2&quot; will be called if there is an error. But, it will
</I>&gt;<i> get to the return line probably before either of those two methods get
</I>&gt;<i> called.
</I>&gt;<i> 
</I>&gt;<i> I really do suggest working through the Twisted Howtos (they are
</I>&gt;<i> *excellent*) and running the example code to see it in action. It helps
</I>&gt;<i> a lot.
</I>&gt;<i> 
</I>&gt;<i> Robert
</I>&gt;<i> 
</I>&gt;&gt;<i> In particular, you want the section on &quot;Low-Level Networking and Event
</I>&gt;&gt;<i> Loop&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In your example above, you probably want this, instead:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   d.addCallbacks(yourCallback, yourErrback)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As for your question, see if this sums it up:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * You want some data
</I>&gt;&gt;<i> * The data depends upon the result
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If that's correct, then you can only get your data in the callback.
</I>&gt;&gt;<i> Think about writing a class to handle this, and instead of having a
</I>&gt;&gt;<i> function return what you want, you could set a class attribute with the
</I>&gt;&gt;<i> data you're looking for once the callback is fired. Or any other of
</I>&gt;&gt;<i> hundreds of possible solutions ;-)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> d
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013608.html">[Twisted-Python] deferred object inside function
</A></li>
	<LI>Next message: <A HREF="013611.html">[Twisted-Python] deferred object inside function
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13609">[ date ]</a>
              <a href="thread.html#13609">[ thread ]</a>
              <a href="subject.html#13609">[ subject ]</a>
              <a href="author.html#13609">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
