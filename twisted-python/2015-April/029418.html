<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Looking for some advice debugging issue with transport.write calls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Looking%20for%20some%20advice%20debugging%20issue%20with%0A%20transport.write%20calls&In-Reply-To=%3CCACLJ_dEFdva0sZZvWjs5cHdE3_z1fCDuOUSs%2BB0%3DYaYoSCW6KQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029415.html">
   <LINK REL="Next"  HREF="029416.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Looking for some advice debugging issue with transport.write calls</H1>
    <B>Brian Costlow</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Looking%20for%20some%20advice%20debugging%20issue%20with%0A%20transport.write%20calls&In-Reply-To=%3CCACLJ_dEFdva0sZZvWjs5cHdE3_z1fCDuOUSs%2BB0%3DYaYoSCW6KQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Looking for some advice debugging issue with transport.write calls">brian.costlow at gmail.com
       </A><BR>
    <I>Mon Apr 27 23:26:15 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029415.html">[Twisted-Python] Looking for some advice debugging issue with transport.write calls
</A></li>
        <LI>Next message: <A HREF="029416.html">[Twisted-Python] revisiting onboarding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29418">[ date ]</a>
              <a href="thread.html#29418">[ thread ]</a>
              <a href="subject.html#29418">[ subject ]</a>
              <a href="author.html#29418">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Apr 27, 2015 at 8:26 PM, Itamar Turner-Trauring &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A>
&gt;<i> wrote:
</I>
&gt;<i> self.in_send_message seems like a potential source of bugs (can't see it
</I>&gt;<i> being set to False on all branches here) and is also likely unnecessary.
</I>&gt;<i>
</I>
self.in_send_message is redundant with self.waiting_id, which was added
later, and will be refactored out next iteration.

But, after a message removed from the queue and sent, we can't send another
until either we get an ack message back, or the timeout fires. Those bits
of code omitted here, are what resets self.in_send_message back to False.
(Or eventually, self.waiting_id to None).

Suggestions on a better way to do this are most welcome. I thought about
only having check_for_send push itself back on the reactor loop if the
queue is empty, and having the ack and/or timeout code fire check_for_send
in other cases, instead of setting the variable. Not sure that's terribly
simpler, though.
&gt;<i>
</I>&gt;<i> General advice:
</I>&gt;<i>
</I>&gt;<i> 1. Simplify, simplify, simplify.
</I>&gt;<i>
</I>&gt;<i> 2. Unit tests (see
</I>&gt;<i> <A HREF="https://twistedmatrix.com/documents/current/core/howto/trial.html">https://twistedmatrix.com/documents/current/core/howto/trial.html</A>).
</I>&gt;<i>
</I>
There actually is a test around this, although ugly, as it has to simulate
the protocol and the factory's queue. It passes. This also works when we
run integration tests with some 3rd party open source apps, but breaks in
production at one location.

#1 well taken though, I should break check_for_send up and make it easier
to write simple tests.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20150428/8085e6f4/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20150428/8085e6f4/attachment.html</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029415.html">[Twisted-Python] Looking for some advice debugging issue with transport.write calls
</A></li>
	<LI>Next message: <A HREF="029416.html">[Twisted-Python] revisiting onboarding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29418">[ date ]</a>
              <a href="thread.html#29418">[ thread ]</a>
              <a href="subject.html#29418">[ subject ]</a>
              <a href="author.html#29418">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
