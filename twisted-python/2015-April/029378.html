<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Methods%20to%20upload%20and%20download%20file%20to%20a%20sftp%0A%20server%20using%20twisted%20conch&In-Reply-To=%3C151872264.3657221.1429081873514.JavaMail.yahoo%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029377.html">
   <LINK REL="Next"  HREF="029379.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch</H1>
    <B>halidou SANFO</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Methods%20to%20upload%20and%20download%20file%20to%20a%20sftp%0A%20server%20using%20twisted%20conch&In-Reply-To=%3C151872264.3657221.1429081873514.JavaMail.yahoo%40mail.yahoo.com%3E"
       TITLE="[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch">sanfo.halidou at yahoo.fr
       </A><BR>
    <I>Wed Apr 15 01:11:13 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029377.html">[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
</A></li>
        <LI>Next message: <A HREF="029379.html">[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29378">[ date ]</a>
              <a href="thread.html#29378">[ thread ]</a>
              <a href="subject.html#29378">[ subject ]</a>
              <a href="author.html#29378">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you for your reply.In fact I found this code in many forums like S.O and I tried to understand it, by doing exactly &#160;all steps you recommend in you response. The difficulty I have found is with the method of the returned object of openFile method of the FileTransferClient class. This returned object that adhere to ISFTP interface; has two methods to write and read: &quot;writeChunk&quot; and &quot;readChunk&quot;. My problem is to use these last functions or methods to perform a file transfert (uploading and downloading) &#160;from my local machine running twisted to a SFTP server and vise-versa.Can you give me an code example to perform this task? with the methods of the openFile object.
Sanfo

&#160;


&#160; &#160; &#160; &#160; 


     Le Mercredi 15 avril 2015 6h22, Kevin Horn &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">kevin.horn at gmail.com</A>&gt; a &#233;crit :
   

 On Tue, Apr 14, 2015 at 6:47 AM, halidou SANFO &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sanfo.halidou at yahoo.fr</A>&gt; wrote:

Hi everybody,I am student and need help of any one.I am working on internship and I have to implement a SFTP client usign twisted conch module.I have program thoe code to establish th ssh tunnel using password authentication. I arrive to create directory with &quot;MakeDirectory&quot; method of FileTransfertClient class.But my objective is to upload and download files and the FileTransfertClient &#160;class has no method [or as I konw ] to do that.
Can you help me with way to do the uploading and the downloding with twisted conch?
Here is my program.&lt;code&gt;'''Created on 8 avr. 2015
@author: hsanfo'''
from sys import stdout
from twisted.python.log import startLogging, err
from twisted.internet import reactorfrom twisted.internet.defer import Deferred
from twisted.conch.ssh.common import NSimport twisted.conch.scripts.cftp.ClientOptionsfrom twisted.conch.scripts.cftp import ClientOptionsfrom twisted.conch.ssh.filetransfer import FileTransferClientfrom twisted.conch.client.connect import connectfrom twisted.conch.client.default import SSHUserAuthClient, verifyHostKeyfrom twisted.conch.ssh.connection import SSHConnectionfrom twisted.conch.ssh.channel import SSHChannel
from twisted.conch.ssh import keys, userauthfrom twisted.internet import defer
class SFTPSession(SSHChannel):&#160; &#160; name = 'session'
&#160; &#160; def channelOpen(self, whatever):&#160; &#160; &#160; &#160; d = self.conn.sendRequest(&#160; &#160; &#160; &#160; &#160; &#160; self, 'subsystem', NS('sftp'), wantReply=True)&#160; &#160; &#160; &#160; d.addCallbacks(self._cbSFTP)

&#160; &#160; def _cbSFTP(self, result):&#160; &#160; &#160; &#160; client = FileTransferClient()&#160; &#160; &#160; &#160; client.makeConnection(self)&#160; &#160; &#160; &#160; self.dataReceived = client.dataReceived&#160; &#160; &#160; &#160; self.conn._sftp.callback(client)


class SFTPConnection(SSHConnection):&#160; &#160;&#160;&#160; &#160; def serviceStarted(self):&#160; &#160; &#160; &#160; self.openChannel(SFTPSession())

class ClientUserAuth(userauth.SSHUserAuthClient):&#160; &#160; def getPassword(self, prompt = None):&#160; &#160; &#160; &#160; #normal password authentication&#160; &#160; &#160; &#160; print &quot;PASSWORD AUTH&quot;&#160; &#160; &#160; &#160; return defer.succeed('test') # &lt;-- YOUR PASSWORD
&#160; &#160; def getGenericAnswers(self, name, instruction, prompts):&#160; &#160; &#160; &#160; #interactive password authentication&#160; &#160; &#160; &#160; print &quot;INTERACTIVE AUTH&quot;&#160; &#160; &#160; &#160; response = ['']*len(prompts)&#160; &#160; &#160; &#160; for i, p in enumerate(prompts):&#160; &#160; &#160; &#160; &#160; &#160; try:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; if('password' in p[0].lower()):&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; response[i] = 'test' # &lt;-- YOUR PASSWORD&#160; &#160; &#160; &#160; &#160; &#160; except:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; pass&#160; &#160; &#160; &#160; #The response is always a sequence, and the length of it is always&#160; &#160; &#160; &#160; #identical to the length of prompts&#160; &#160; &#160; &#160; return defer.succeed(response) &#160;&#160;&#160; &#160;&#160;
def sftp(user, host, port):&#160; &#160; options = ClientOptions()&#160; &#160;&#160;&#160; &#160; options['host'] = host&#160; &#160; options['port'] = port&#160; &#160; conn = SFTPConnection()&#160; &#160; conn._sftp = Deferred()&#160; &#160; auth = SSHUserAuthClient(user, options, conn)&#160; &#160; #auth = ClientUserAuth(user, options, conn)&#160; &#160; #connect(host, port, options, verifyHostKey, auth)&#160; &#160; connect(host, port, options, None, auth)&#160; &#160;&#160;&#160; &#160; return conn._sftp

def transfer(client):&#160; &#160; d = client.makeDirectory('foobarbaz', {})&#160; &#160; def cbDir(ignored):&#160; &#160; &#160; &#160; print 'Made directory'&#160; &#160; d.addCallback(cbDir)&#160; &#160; return d

def main():&#160; &#160; startLogging(stdout)
&#160; &#160; user = 'test'&#160; &#160; host = '192.168.29.129'&#160; &#160; port = 22&#160; &#160; d = sftp(user, host, port)&#160; &#160; d.addCallback(transfer)&#160; &#160; d.addErrback(err, &quot;Problem with SFTP transfer&quot;)&#160; &#160; d.addCallback(lambda ignored: reactor.stop())&#160; &#160; reactor.run()

if __name__ == '__main__':&#160; &#160; main()&lt;code&gt;&#160;Best regards
SANFO




This is a multi-step process.&#160;
1) Open the StackOverflow page that you copied the above code from.2) Actually read the whole answer.3) Read the documentation for the FileTransferClient class.&#160; It's in the Twisted API documentation.&#160; It does have an openFile method.4) Use the openFile method.5) read and/or write using the returned object, which (as explained in the SO answer) will adhere to the ISFTPFile interface.&#160; That also has documentation, which you should probably read.6) Once you have done all those things, if you still have questions about _specific_ problems, feel free to ask them.


--Kevin Horn
_______________________________________________
Twisted-Python mailing list
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20150415/431c91f7/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20150415/431c91f7/attachment.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029377.html">[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
</A></li>
	<LI>Next message: <A HREF="029379.html">[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29378">[ date ]</a>
              <a href="thread.html#29378">[ thread ]</a>
              <a href="subject.html#29378">[ subject ]</a>
              <a href="author.html#29378">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
