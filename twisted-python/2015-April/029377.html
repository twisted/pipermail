<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Methods%20to%20upload%20and%20download%20file%20to%20a%20sftp%0A%20server%20using%20twisted%20conch&In-Reply-To=%3CCA%2BU%3DzK1%2BSqNgQ1JTOMBO34rueGTk38Wja31un-Kqr8YN2oTwKA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029370.html">
   <LINK REL="Next"  HREF="029378.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch</H1>
    <B>Kevin Horn</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Methods%20to%20upload%20and%20download%20file%20to%20a%20sftp%0A%20server%20using%20twisted%20conch&In-Reply-To=%3CCA%2BU%3DzK1%2BSqNgQ1JTOMBO34rueGTk38Wja31un-Kqr8YN2oTwKA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch">kevin.horn at gmail.com
       </A><BR>
    <I>Tue Apr 14 22:19:01 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029370.html">[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
</A></li>
        <LI>Next message: <A HREF="029378.html">[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29377">[ date ]</a>
              <a href="thread.html#29377">[ thread ]</a>
              <a href="subject.html#29377">[ subject ]</a>
              <a href="author.html#29377">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Apr 14, 2015 at 6:47 AM, halidou SANFO &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sanfo.halidou at yahoo.fr</A>&gt;
wrote:

&gt;<i> Hi everybody,
</I>&gt;<i> I am student and need help of any one.
</I>&gt;<i> I am working on internship and I have to implement a SFTP client usign
</I>&gt;<i> twisted conch module.
</I>&gt;<i> I have program thoe code to establish th ssh tunnel using password
</I>&gt;<i> authentication. I arrive to create directory with &quot;MakeDirectory&quot; method of
</I>&gt;<i> FileTransfertClient class.
</I>&gt;<i> But my objective is to upload and download files and the
</I>&gt;<i> FileTransfertClient  class has no method [or as I konw ] to do that.
</I>&gt;<i>
</I>&gt;<i> Can you help me with way to do the uploading and the downloding with
</I>&gt;<i> twisted conch?
</I>&gt;<i>
</I>&gt;<i> Here is my program.
</I>&gt;<i> &lt;code&gt;
</I>&gt;<i> '''
</I>&gt;<i> Created on 8 avr. 2015
</I>&gt;<i>
</I>&gt;<i> @author: hsanfo
</I>&gt;<i> '''
</I>&gt;<i>
</I>&gt;<i> from sys import stdout
</I>&gt;<i>
</I>&gt;<i> from twisted.python.log import startLogging, err
</I>&gt;<i>
</I>&gt;<i> from twisted.internet import reactor
</I>&gt;<i> from twisted.internet.defer import Deferred
</I>&gt;<i>
</I>&gt;<i> from twisted.conch.ssh.common import NS
</I>&gt;<i> import twisted.conch.scripts.cftp.ClientOptions
</I>&gt;<i> from twisted.conch.scripts.cftp import ClientOptions
</I>&gt;<i> from twisted.conch.ssh.filetransfer import FileTransferClient
</I>&gt;<i> from twisted.conch.client.connect import connect
</I>&gt;<i> from twisted.conch.client.default import SSHUserAuthClient, verifyHostKey
</I>&gt;<i> from twisted.conch.ssh.connection import SSHConnection
</I>&gt;<i> from twisted.conch.ssh.channel import SSHChannel
</I>&gt;<i>
</I>&gt;<i> from twisted.conch.ssh import keys, userauth
</I>&gt;<i> from twisted.internet import defer
</I>&gt;<i>
</I>&gt;<i> class SFTPSession(SSHChannel):
</I>&gt;<i>     name = 'session'
</I>&gt;<i>
</I>&gt;<i>     def channelOpen(self, whatever):
</I>&gt;<i>         d = self.conn.sendRequest(
</I>&gt;<i>             self, 'subsystem', NS('sftp'), wantReply=True)
</I>&gt;<i>         d.addCallbacks(self._cbSFTP)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     def _cbSFTP(self, result):
</I>&gt;<i>         client = FileTransferClient()
</I>&gt;<i>         client.makeConnection(self)
</I>&gt;<i>         self.dataReceived = client.dataReceived
</I>&gt;<i>         self.conn._sftp.callback(client)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class SFTPConnection(SSHConnection):
</I>&gt;<i>
</I>&gt;<i>     def serviceStarted(self):
</I>&gt;<i>         self.openChannel(SFTPSession())
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class ClientUserAuth(userauth.SSHUserAuthClient):
</I>&gt;<i>     def getPassword(self, prompt = None):
</I>&gt;<i>         #normal password authentication
</I>&gt;<i>         print &quot;PASSWORD AUTH&quot;
</I>&gt;<i>         return defer.succeed('test') # &lt;-- YOUR PASSWORD
</I>&gt;<i>
</I>&gt;<i>     def getGenericAnswers(self, name, instruction, prompts):
</I>&gt;<i>         #interactive password authentication
</I>&gt;<i>         print &quot;INTERACTIVE AUTH&quot;
</I>&gt;<i>         response = ['']*len(prompts)
</I>&gt;<i>         for i, p in enumerate(prompts):
</I>&gt;<i>             try:
</I>&gt;<i>                 if('password' in p[0].lower()):
</I>&gt;<i>                     response[i] = 'test' # &lt;-- YOUR PASSWORD
</I>&gt;<i>             except:
</I>&gt;<i>                 pass
</I>&gt;<i>         #The response is always a sequence, and the length of it is always
</I>&gt;<i>         #identical to the length of prompts
</I>&gt;<i>         return defer.succeed(response)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> def sftp(user, host, port):
</I>&gt;<i>     options = ClientOptions()
</I>&gt;<i>
</I>&gt;<i>     options['host'] = host
</I>&gt;<i>     options['port'] = port
</I>&gt;<i>     conn = SFTPConnection()
</I>&gt;<i>     conn._sftp = Deferred()
</I>&gt;<i>     auth = SSHUserAuthClient(user, options, conn)
</I>&gt;<i>     #auth = ClientUserAuth(user, options, conn)
</I>&gt;<i>     #connect(host, port, options, verifyHostKey, auth)
</I>&gt;<i>     connect(host, port, options, None, auth)
</I>&gt;<i>
</I>&gt;<i>     return conn._sftp
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> def transfer(client):
</I>&gt;<i>     d = client.makeDirectory('foobarbaz', {})
</I>&gt;<i>     def cbDir(ignored):
</I>&gt;<i>         print 'Made directory'
</I>&gt;<i>     d.addCallback(cbDir)
</I>&gt;<i>     return d
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> def main():
</I>&gt;<i>     startLogging(stdout)
</I>&gt;<i>
</I>&gt;<i>     user = 'test'
</I>&gt;<i>     host = '192.168.29.129'
</I>&gt;<i>     port = 22
</I>&gt;<i>     d = sftp(user, host, port)
</I>&gt;<i>     d.addCallback(transfer)
</I>&gt;<i>     d.addErrback(err, &quot;Problem with SFTP transfer&quot;)
</I>&gt;<i>     d.addCallback(lambda ignored: reactor.stop())
</I>&gt;<i>     reactor.run()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> if __name__ == '__main__':
</I>&gt;<i>     main()
</I>&gt;<i> &lt;code&gt;
</I>&gt;<i>
</I>&gt;<i> Best regards
</I>&gt;<i>
</I>&gt;<i> SANFO
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>This is a multi-step process.

1) Open the StackOverflow page that you copied the above code from.
2) Actually read the whole answer.
3) Read the documentation for the FileTransferClient class.  It's in the
Twisted API documentation.  It does have an openFile method.
4) Use the openFile method.
5) read and/or write using the returned object, which (as explained in the
SO answer) will adhere to the ISFTPFile interface.  That also has
documentation, which you should probably read.
6) Once you have done all those things, if you still have questions about
_specific_ problems, feel free to ask them.


--
Kevin Horn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20150414/7ccaa96d/attachment-0001.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20150414/7ccaa96d/attachment-0001.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029370.html">[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
</A></li>
	<LI>Next message: <A HREF="029378.html">[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29377">[ date ]</a>
              <a href="thread.html#29377">[ thread ]</a>
              <a href="subject.html#29377">[ subject ]</a>
              <a href="author.html#29377">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
