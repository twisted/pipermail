<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Methods to upload and download file to a sftp server using twisted conch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Methods%20to%20upload%20and%20download%20file%20to%20a%20sftp%0A%20server%20using%20twisted%20conch&In-Reply-To=%3C1695656692.2840237.1429012030407.JavaMail.yahoo%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch</H1>
    <B>halidou SANFO</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Methods%20to%20upload%20and%20download%20file%20to%20a%20sftp%0A%20server%20using%20twisted%20conch&In-Reply-To=%3C1695656692.2840237.1429012030407.JavaMail.yahoo%40mail.yahoo.com%3E"
       TITLE="[Twisted-Python] Methods to upload and download file to a sftp server using twisted conch">sanfo.halidou at yahoo.fr
       </A><BR>
    <I>Tue Apr 14 05:47:10 MDT 2015</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61831">[ date ]</a>
              <a href="thread.html#61831">[ thread ]</a>
              <a href="subject.html#61831">[ subject ]</a>
              <a href="author.html#61831">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everybody,I am student and need help of any one.I am working on internship and I have to implement a SFTP client usign twisted conch module.I have program thoe code to establish th ssh tunnel using password authentication. I arrive to create directory with &quot;MakeDirectory&quot; method of FileTransfertClient class.But my objective is to upload and download files and the FileTransfertClient  class has no method [or as I konw ] to do that.
Can you help me with way to do the uploading and the downloding with twisted conch?
Here is my program.&lt;code&gt;'''Created on 8 avr. 2015
@author: hsanfo'''
from sys import stdout
from twisted.python.log import startLogging, err
from twisted.internet import reactorfrom twisted.internet.defer import Deferred
from twisted.conch.ssh.common import NSimport twisted.conch.scripts.cftp.ClientOptionsfrom twisted.conch.scripts.cftp import ClientOptionsfrom twisted.conch.ssh.filetransfer import FileTransferClientfrom twisted.conch.client.connect import connectfrom twisted.conch.client.default import SSHUserAuthClient, verifyHostKeyfrom twisted.conch.ssh.connection import SSHConnectionfrom twisted.conch.ssh.channel import SSHChannel
from twisted.conch.ssh import keys, userauthfrom twisted.internet import defer
class SFTPSession(SSHChannel):    name = 'session'
    def channelOpen(self, whatever):        d = self.conn.sendRequest(            self, 'subsystem', NS('sftp'), wantReply=True)        d.addCallbacks(self._cbSFTP)

    def _cbSFTP(self, result):        client = FileTransferClient()        client.makeConnection(self)        self.dataReceived = client.dataReceived        self.conn._sftp.callback(client)


class SFTPConnection(SSHConnection):        def serviceStarted(self):        self.openChannel(SFTPSession())

class ClientUserAuth(userauth.SSHUserAuthClient):    def getPassword(self, prompt = None):        #normal password authentication        print &quot;PASSWORD AUTH&quot;        return defer.succeed('test') # &lt;-- YOUR PASSWORD
    def getGenericAnswers(self, name, instruction, prompts):        #interactive password authentication        print &quot;INTERACTIVE AUTH&quot;        response = ['']*len(prompts)        for i, p in enumerate(prompts):            try:                if('password' in p[0].lower()):                    response[i] = 'test' # &lt;-- YOUR PASSWORD            except:                pass        #The response is always a sequence, and the length of it is always        #identical to the length of prompts        return defer.succeed(response)       
def sftp(user, host, port):    options = ClientOptions()        options['host'] = host    options['port'] = port    conn = SFTPConnection()    conn._sftp = Deferred()    auth = SSHUserAuthClient(user, options, conn)    #auth = ClientUserAuth(user, options, conn)    #connect(host, port, options, verifyHostKey, auth)    connect(host, port, options, None, auth)        return conn._sftp

def transfer(client):    d = client.makeDirectory('foobarbaz', {})    def cbDir(ignored):        print 'Made directory'    d.addCallback(cbDir)    return d

def main():    startLogging(stdout)
    user = 'test'    host = '192.168.29.129'    port = 22    d = sftp(user, host, port)    d.addCallback(transfer)    d.addErrback(err, &quot;Problem with SFTP transfer&quot;)    d.addCallback(lambda ignored: reactor.stop())    reactor.run()

if __name__ == '__main__':    main()&lt;code&gt; Best regards
SANFO

       
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20150414/69aac660/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61831">[ date ]</a>
              <a href="thread.html#61831">[ thread ]</a>
              <a href="subject.html#61831">[ subject ]</a>
              <a href="author.html#61831">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
