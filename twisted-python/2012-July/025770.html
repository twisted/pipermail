<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SIP protocol Via header doesn't compatible with	SIP RFC3261.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20SIP%20protocol%20Via%20header%20doesn%27t%20compatible%20with%0A%09SIP%20RFC3261.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025768.html">
   <LINK REL="Next"  HREF="025771.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SIP protocol Via header doesn't compatible with	SIP RFC3261.</H1>
    <B>RuiQiang Huang</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20SIP%20protocol%20Via%20header%20doesn%27t%20compatible%20with%0A%09SIP%20RFC3261.&In-Reply-To="
       TITLE="[Twisted-Python] SIP protocol Via header doesn't compatible with	SIP RFC3261.">hrqiang at gmail.com
       </A><BR>
    <I>Fri Jul  6 15:49:44 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025768.html">[Twisted-Python] Twisted sprint and tutorial in San Francisco
</A></li>
        <LI>Next message: <A HREF="025771.html">[Twisted-Python] SIP protocol Via header doesn't compatible	with SIP RFC3261.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25770">[ date ]</a>
              <a href="thread.html#25770">[ thread ]</a>
              <a href="subject.html#25770">[ subject ]</a>
              <a href="author.html#25770">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Via header is different between RFC2543 and RFC3261.
Based on RFC3261, Via header BNF is

    Via               =  ( &quot;Via&quot; / &quot;v&quot; ) HCOLON via-parm *(COMMA via-parm)
via-parm          =  sent-protocol LWS sent-by *( SEMI via-params )
via-params        =  via-ttl / via-maddr
                     / via-received / via-branch
                     / via-extension
via-ttl           =  &quot;ttl&quot; EQUAL ttl
via-maddr         =  &quot;maddr&quot; EQUAL host
via-received      =  &quot;received&quot; EQUAL (IPv4address / IPv6address)
via-branch        =  &quot;branch&quot; EQUAL token
via-extension     =  generic-param

That means parseViaHeader should return a tuple, instead of single via object.
Top via will be parse first via header and first element in the tuple.
This fix is required because if message coming from Via, and it inject
Via header like this
Via: SIP/2.0/UDP
192.84.13.26:5060;branch=z9hG4bK5af66076b7a656376f671478bb7a4b3f,SIP/2.0/UDP
192.168.1.145;branch=z9hG4bKfbbb8cf0FF120663;received=192.84.17.215;rport=13582
current SIP stack cannot send the response to 192.84.13.26:5060.
Instead, it sends to 192.84.13.26:13582 that never get to the other side.
So I fixed this to have my SIP program working with proxy.
I have a patch for this. Please let me know how to submit to SVN.

Thanks.

</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025768.html">[Twisted-Python] Twisted sprint and tutorial in San Francisco
</A></li>
	<LI>Next message: <A HREF="025771.html">[Twisted-Python] SIP protocol Via header doesn't compatible	with SIP RFC3261.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25770">[ date ]</a>
              <a href="thread.html#25770">[ thread ]</a>
              <a href="subject.html#25770">[ subject ]</a>
              <a href="author.html#25770">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
