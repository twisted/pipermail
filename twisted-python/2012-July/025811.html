<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted in a multicore environment
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20in%20a%20multicore%20environment&In-Reply-To=CADFy_4GWmtnoxwLxE-pf%3DnNFnOFFdrj0Q_ZR-bV-DNwxqaxHHg%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025817.html">
   <LINK REL="Next"  HREF="025793.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted in a multicore environment</H1>
    <B>Ray Cote</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20in%20a%20multicore%20environment&In-Reply-To=CADFy_4GWmtnoxwLxE-pf%3DnNFnOFFdrj0Q_ZR-bV-DNwxqaxHHg%40mail.gmail.com"
       TITLE="[Twisted-Python] Twisted in a multicore environment">rgacote at appropriatesolutions.com
       </A><BR>
    <I>Thu Jul 12 16:44:32 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025817.html">[Twisted-Python] Twisted in a multicore environment
</A></li>
        <LI>Next message: <A HREF="025793.html">[Twisted-Python] deferred graph?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25811">[ date ]</a>
              <a href="thread.html#25811">[ thread ]</a>
              <a href="subject.html#25811">[ subject ]</a>
              <a href="author.html#25811">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Augusto:

You don't mention the protocol you're implementing in Twisted, but if is is HTTP...

The way we address this problem with an HTTP protocol is to put 
multiple copies of Twisted behind nginx. 

On two and four core machines, we set the number of nginx worker processes equal 
to the number of CPU cores (as recommend by nginx docs). 
We then install one Twisted server instance per core.
We then have nginx round-robin proxy into the Twisted instances.

On a larger system (such as eight cores) we'd set up four nginx worker processes
and four Twisted services; or perhaps two nginx worker processes and six Twisted
services. Particularly when we're running HTTPS and the 
nginx Web Application Firewall which can consume a fair bit of CPU. 

Final balancing between nginx and Twisted core is obviously dependent on where the
heaviest computation appears. 

We find this balancing act works well and, since we know the number of 
cores on a box when we're deploying, we're rarely interested in the ability to 
add/remove Twisted instances on the fly. 

--Ray


----- Original Message -----
&gt;<i> From: &quot;Augusto Mecking Caringi&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">augustocaringi at gmail.com</A>&gt;
</I>&gt;<i> To: &quot;Twisted general discussion&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python at twistedmatrix.com</A>&gt;
</I>&gt;<i> Sent: Tuesday, July 10, 2012 11:14:27 AM
</I>&gt;<i> Subject: [Twisted-Python] Twisted in a multicore environment
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i>     I'm researching the best way to implement/use a Twisted-based
</I>&gt;<i> server in a multicore environment...
</I>&gt;<i> 
</I>&gt;<i>     There is the Ampoule project, that I realize is considered the
</I>&gt;<i> best way to do that. Right?
</I>&gt;<i> 
</I>&gt;<i>     I'm also reading about the internals of Nginx HTTP server. This
</I>&gt;<i> server utilizes the same reactor pattern of Twisted (epoll based)...
</I>&gt;<i> 
</I>&gt;<i>     &quot;What resulted is a modular, event-driven, asynchronous,
</I>&gt;<i> single-threaded, non-blocking architecture which became the
</I>&gt;<i> foundation
</I>&gt;<i> of nginx code.&quot; <A HREF="http://www.aosabook.org/en/nginx.html">http://www.aosabook.org/en/nginx.html</A>
</I>&gt;<i> 
</I>&gt;<i>     But to maximize the use of processors in a multicore environment,
</I>&gt;<i> Nginx do this:
</I>&gt;<i> 
</I>&gt;<i>     &quot;nginx doesn't spawn a process or thread for every connection.
</I>&gt;<i> Instead, worker processes accept new requests from a shared &quot;listen&quot;
</I>&gt;<i> socket and execute a highly efficient run-loop inside each worker to
</I>&gt;<i> process thousands of connections per worker&quot;
</I>&gt;<i> 
</I>&gt;<i>     My question: There is something similar in Twisted? Or do you
</I>&gt;<i> think that is easy to implement something like that?
</I>&gt;<i> 
</I>&gt;<i>     Thanks!
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Augusto Mecking Caringi
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> 
</I>
-- 
Ray Cote, President
Appropriate Solutions, Inc.
We Build Software
603.924.6079

</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025817.html">[Twisted-Python] Twisted in a multicore environment
</A></li>
	<LI>Next message: <A HREF="025793.html">[Twisted-Python] deferred graph?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25811">[ date ]</a>
              <a href="thread.html#25811">[ thread ]</a>
              <a href="subject.html#25811">[ subject ]</a>
              <a href="author.html#25811">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
