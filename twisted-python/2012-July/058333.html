<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] i want to update 1000 devices running as	servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20i%20want%20to%20update%201000%20devices%20running%20as%0A%09servers&In-Reply-To=%3CCAOHwv57-wvF5mVowxYOMDiwpjy98vRk0jwtVCa_%2BaSY10WsYAw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058331.html">
   <LINK REL="Next"  HREF="058336.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] i want to update 1000 devices running as	servers</H1>
    <B>Luka Rahne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20i%20want%20to%20update%201000%20devices%20running%20as%0A%09servers&In-Reply-To=%3CCAOHwv57-wvF5mVowxYOMDiwpjy98vRk0jwtVCa_%2BaSY10WsYAw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] i want to update 1000 devices running as	servers">luka.rahne at gmail.com
       </A><BR>
    <I>Fri Jul 20 02:26:32 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058331.html">[Twisted-Python] i want to update 1000 devices running as	servers
</A></li>
        <LI>Next message (by thread): <A HREF="058336.html">[Twisted-Python] i want to update 1000 devices running as	servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58333">[ date ]</a>
              <a href="thread.html#58333">[ thread ]</a>
              <a href="subject.html#58333">[ subject ]</a>
              <a href="author.html#58333">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Due to historical reasons there is UDP only protocol whith response
ack for each packet.
In reality there are also some delays because received device can not
handle data after it sends ack (some ancient and buggy eth chip).

Also there are not just lines from sx file, but are enveloped in other
packet that is transfered.

In general protocol goes like:


for each line in sx:
    encode line whit extra data in packet (packet is like len + encrypted_)
    Send packet over UDP (tcp not supported)
    wait for ACK (&quot;OK&quot; packet in my example)
    wait for 0.05 s (not in included example)


I done some code that should support this and i have tried to stop
protocol but calling self.doStop()  function
(twisted.internet.protocol.AbstractDatagramProtocol)    raises assert
assert self.numPorts &gt; 0

I was hoping that this function will remove protocol instance from reactor.






2012/7/20 Laurens Van Houtven &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.cc</A>&gt;
&gt;<i>
</I>&gt;<i> What version of twisted are you using and which reactor is it using? (You can tell from the logs)
</I>&gt;<i>
</I>&gt;<i> Note that your process for getting data from the datasource is blocking. What sort of data source is it, and why are you stripping stuff off of it? You might want to consider something more cooperative, such as for example a file producer:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/documents/current/api/twisted.protocols.basic.FileSender.html">http://twistedmatrix.com/documents/current/api/twisted.protocols.basic.FileSender.html</A>
</I>&gt;<i>
</I>&gt;<i> I'm assuming you are aware of all of the issues involving UDP (specifically, that in the real world your file is probably not going to make it to the other side)
</I>&gt;<i>
</I>&gt;<i> The basic pattern will probably be something like:
</I>&gt;<i> 1) create 100 deferreds that will fire when you're done transferring
</I>&gt;<i> 2) gatherResults/DeferredList to wait on all of them
</I>&gt;<i> 3) do (1) again in a callback to that deferred list until you run out of clients
</I>&gt;<i>
</I>&gt;<i> Twisted might have some standard tool somewhere to implement this, but I don't know about it.
</I>&gt;<i>
</I>&gt;<i> cheers
</I>&gt;<i> lvh
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 20 Jul 2012, at 09:01, Luka Rahne wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I have like 1000 devices that need update that takes like 1 minute each. I want them to update as quick as possible, sending lines from sx file, using UDP and for each line i got reponse &quot;OK&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Here is code that works for up to 500 servers, but not so well when i go more (it just does not finish)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; my current  simplified client and server_emulator code is here:
</I>&gt;<i> &gt; <A HREF="https://gist.github.com/3144857">https://gist.github.com/3144857</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; currently i have only one server for simulation, but in real world it will be 1000 different IP-s.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I was trying to stop and run reactor but did not work (reactor is not rerunnable exception or somthing like that).
</I>&gt;<i> &gt;  I want to run lets say 100 updates at time and once some update is finished i want to remove this protocol out of job and schedule new one.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Can somebody give some pointers?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I am running this on windows if that is an issue.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058331.html">[Twisted-Python] i want to update 1000 devices running as	servers
</A></li>
	<LI>Next message (by thread): <A HREF="058336.html">[Twisted-Python] i want to update 1000 devices running as	servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58333">[ date ]</a>
              <a href="thread.html#58333">[ thread ]</a>
              <a href="subject.html#58333">[ subject ]</a>
              <a href="author.html#58333">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
