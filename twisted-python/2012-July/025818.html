<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to best log server/client interactions	from a test?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20best%20log%20server/client%20interactions%0A%09from%20a%20test%3F&In-Reply-To=570E7322-0A48-4D78-929C-F9D9437FE57F%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025813.html">
   <LINK REL="Next"  HREF="025819.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to best log server/client interactions	from a test?</H1>
    <B>Dan Milstein</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20How%20to%20best%20log%20server/client%20interactions%0A%09from%20a%20test%3F&In-Reply-To=570E7322-0A48-4D78-929C-F9D9437FE57F%40twistedmatrix.com"
       TITLE="[Twisted-Python] How to best log server/client interactions	from a test?">dan at wingu.com
       </A><BR>
    <I>Mon Jul 16 09:40:51 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025813.html">[Twisted-Python] How to best log server/client interactions	from a test?
</A></li>
        <LI>Next message: <A HREF="025819.html">[Twisted-Python] How to best log server/client interactions from a test?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25818">[ date ]</a>
              <a href="thread.html#25818">[ thread ]</a>
              <a href="subject.html#25818">[ subject ]</a>
              <a href="author.html#25818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To be clear: my current interest is really just doing this during unit tests/ongoing development (e.g. not diagnosing prod issues, where Wireshark would make plenty of sense).  So something integrated into Twisted feels natural.

That said, is the unit test pattern I'm seeing in the mail/test/test_imap.py module atypical?  Most of the doc'd examples for trial don't seem to be using loopbackTCP, so much as directly writing to lineReceived or something similar.  It's only because these tests are doing end-to-end things, by way of constructing both an IMAP server and client, and hooking them up, that I'm in this situation.

-D

On Jul 13, 2012, at 6:21 PM, Glyph wrote:

&gt;<i> 
</I>&gt;<i> On Jul 12, 2012, at 1:31 PM, Dan Milstein &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dan at wingu.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> 'lo all,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've been doing some work with the twisted.mail.imap4 module, and its associated unit tests (in order to learn the code more, I'm tackling a few of the outstanding tickets).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> When running those tests, I'd often like to log all the server/client interaction.  I managed to do so by way of hacking the code in twisted.protocols.loopback, but that feels pretty wrong.  What's a good way to get all the interaction logged?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> To be more specific, the tests in question (e.g. test_imap.NewFetchTestCase), do a lot of:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>    d = loopback.loopbackTCP(self.server, self.client, noisy=False)
</I>&gt;&gt;<i>    d.addCallback(lambda x : self.assertEqual(self.result, self.expected))
</I>&gt;&gt;<i>    return d
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What's a Good Way to get all the traffic going over that loopback logged?  Setting noisy to True merely gets it to log some protocol startup/teardown-type messages.  
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Or: given that I've figured out how to hack loopback.lookupbackTCP, if there's general utility, I can certainly add a keyword arg to trigger logging of all messages, e.g. logAll=False (I'm trying to find something which feels meaningfully different from 'noisy', because it would seem Very Wrong Indeed to make noisy suddenly produce vastly more log output).  Is that something people might be interested in?
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> If you're interested in logging at the TCP connection level, have you considered moving this out of your Twisted process entirely and using some tool like Wireshark?  You could build something yourself by interposing transport objects that dump their data, but you'd have to build your own toolchain (command line tools, GUIs, etc) for actually examining the output, whereas existing protocol analysis tools would just do that for you.
</I>&gt;<i> 
</I>&gt;<i> -glyph
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20120716/8edd22d9/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20120716/8edd22d9/attachment.htm</A> 
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025813.html">[Twisted-Python] How to best log server/client interactions	from a test?
</A></li>
	<LI>Next message: <A HREF="025819.html">[Twisted-Python] How to best log server/client interactions from a test?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25818">[ date ]</a>
              <a href="thread.html#25818">[ thread ]</a>
              <a href="subject.html#25818">[ subject ]</a>
              <a href="author.html#25818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
