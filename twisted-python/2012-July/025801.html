<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Logging observers and threads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Logging%20observers%20and%20threads&In-Reply-To=CACL%3D7avgn1VmxeLfXJMhk4PzZ88HAW2qCxAqsgtaQXLfCa4gfQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025800.html">
   <LINK REL="Next"  HREF="025802.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Logging observers and threads</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Logging%20observers%20and%20threads&In-Reply-To=CACL%3D7avgn1VmxeLfXJMhk4PzZ88HAW2qCxAqsgtaQXLfCa4gfQ%40mail.gmail.com"
       TITLE="[Twisted-Python] Logging observers and threads">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Jul 12 10:32:06 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025800.html">[Twisted-Python] Logging observers and threads
</A></li>
        <LI>Next message: <A HREF="025802.html">[Twisted-Python] Logging observers and threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25801">[ date ]</a>
              <a href="thread.html#25801">[ thread ]</a>
              <a href="subject.html#25801">[ subject ]</a>
              <a href="author.html#25801">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01:56 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">justin.venus at gmail.com</A> wrote:
&gt;<i>For logging could we look at implementing posix aio on platforms that
</I>&gt;<i>support it?  I would be willing to help code that.
</I>
As far as I know, all of the implementations of POSIX AIO are relatively 
low quality.  They include a number of tricky, low-level constraints 
(eg, char* to write must be page aligned) as well as some sad functional 
limitations such as blocking instead of being asynchronous if too many 
AIOs are started concurrently (with this limit applying to AIOs *system 
wide* in some cases).

If there are any good implementations, or prospects of thes 
implementations getting good sometime in the near future, it might be 
worth exploring, but I don't think it's something we can rely on now.

See also this stackoverflow question: <A HREF="http://bit.ly/NqWd5b">http://bit.ly/NqWd5b</A>

Corrections welcome, I haven't checked on the state of this in a few 
months.

Jean-Paul
&gt;<i>Justin
</I>&gt;<i>On Jul 12, 2012 8:51 AM, &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i>On 11:32 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">itamar at itamarst.org</A> wrote:
</I>&gt;&gt;<i> &gt;On 07/12/2012 05:17 AM, Tristan Seligmann wrote:
</I>&gt;&gt;<i> &gt;&gt;3) log observers should expect to be inovked in non-reactor threads,
</I>&gt;&gt;<i> &gt;&gt;making this a Mantissa bug.
</I>&gt;&gt;<i> &gt;In theory this is the case - the logging howto says &quot;The observer 
</I>&gt;&gt;<i>needs
</I>&gt;&gt;<i> &gt;to be thread safe if you anticipate using threads in your program.&quot; 
</I>&gt;&gt;<i>The
</I>&gt;&gt;<i> &gt;API docs don't mention threads, though..
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;In practice however, probably every custom observer gets this wrong, 
</I>&gt;&gt;<i>so
</I>&gt;&gt;<i> &gt;we really need some infrastructure to make this easier or to fix it.
</I>&gt;&gt;<i> &gt;Possibly we should have some way to indicate an observer is thread-
</I>&gt;&gt;<i> &gt;safe,
</I>&gt;&gt;<i> &gt;assume by default they are not, and if they are not wrap them in a
</I>&gt;&gt;<i> &gt;reactor.callFromThread wrapper.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>The logging system is already a bottleneck in some applications. 
</I>&gt;&gt;<i>Doing
</I>&gt;&gt;<i>even more work to try to make it properly thread-safe will probably 
</I>&gt;&gt;<i>slow
</I>&gt;&gt;<i>it down even more.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I think it was a mistake to try to make it possible to use
</I>&gt;&gt;<i>twisted.python.log free-threaded.  I think we should think about 
</I>&gt;&gt;<i>getting
</I>&gt;&gt;<i>rid of this claimed feature.  Perhaps it could be replaced with a more
</I>&gt;&gt;<i>explicit, probably more restricted, logging feature for non-reactor
</I>&gt;&gt;<i>threads.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Unless someone can magically fix the threading issues without hurting
</I>&gt;&gt;<i>performance.  Then, great, go for it.
</I>&gt;&gt;<i> &gt;I would also like some infrastructure to make the file log observer 
</I>&gt;&gt;<i>run
</I>&gt;&gt;<i> &gt;in its own thread, but that's almost the opposite use case :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Sure, but that's probably based on top of an asynchronous file I/O API
</I>&gt;&gt;<i>that's not explicitly thread-based (but probably is thread-based in
</I>&gt;&gt;<i>practice, because what other kind of asynchronous file I/O even 
</I>&gt;&gt;<i>exists).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Also, to explicitly answer Tristan's question:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     It's a bug in the Mantissa log observer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Jean-Paul
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>_______________________________________________
</I>&gt;&gt;<i>Twisted-Python mailing list
</I>&gt;&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025800.html">[Twisted-Python] Logging observers and threads
</A></li>
	<LI>Next message: <A HREF="025802.html">[Twisted-Python] Logging observers and threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25801">[ date ]</a>
              <a href="thread.html#25801">[ thread ]</a>
              <a href="subject.html#25801">[ subject ]</a>
              <a href="author.html#25801">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
