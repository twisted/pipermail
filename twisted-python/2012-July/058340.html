<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] deferred graph?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20deferred%20graph%3F&In-Reply-To=%3Cop.whuxaogx4oppi6%40obsidianwin7.hq.teratorn.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058326.html">
   <LINK REL="Next"  HREF="058208.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] deferred graph?</H1>
    <B>Eric Mangold</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20deferred%20graph%3F&In-Reply-To=%3Cop.whuxaogx4oppi6%40obsidianwin7.hq.teratorn.org%3E"
       TITLE="[Twisted-Python] deferred graph?">teratorn at gmail.com
       </A><BR>
    <I>Sun Jul 22 10:55:26 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058326.html">[Twisted-Python] deferred graph?
</A></li>
        <LI>Next message (by thread): <A HREF="058208.html">[Twisted-Python] ANN: Twisted DBus 1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58340">[ date ]</a>
              <a href="thread.html#58340">[ thread ]</a>
              <a href="subject.html#58340">[ subject ]</a>
              <a href="author.html#58340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 02 Jul 2012 19:31:14 -0500, Dan Stromberg &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">drsalists at gmail.com</A>&gt;  
wrote:

&gt;<i>
</I>&gt;<i> On Thu, Jun 28, 2012 at 9:40 PM, Dan Stromberg &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">drsalists at gmail.com</A>&gt;  
</I>&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm a Twisted neophyte, but I've been using Python a long time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My question:
</I>&gt;&gt;<i> Is there a way of producing a deferred graph in a Python program at a  
</I>&gt;&gt;<i> given point in time?  Perhaps something based on graphviz and  
</I>&gt;&gt;<i> &gt;&gt;objgraph.py?  We're able to detect when we're having the problem, we  
</I>&gt;&gt;<i> just don't (yet) know its cause.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Background:
</I>&gt;&gt;<i> I'm looking at some code with a bit over 200  
</I>&gt;&gt;<i> addCallback/addErrback/addCallbacks in it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It's got a problem where sometimes the deferreds seem to just stop  
</I>&gt;&gt;<i> executing.  I see in the doc it says that this can happen if you've  
</I>&gt;&gt;<i> &gt;&gt;neglected to add an errback to the end of one or more of your  
</I>&gt;&gt;<i> deferred chains.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One of the people who's been here longer than me, indicated that he's  
</I>&gt;&gt;<i> gone through the code looking for such issues, and didn't find &gt;&gt;any.   
</I>&gt;&gt;<i> This suggests to me that either there's some other cause, or that it  
</I>&gt;&gt;<i> really is a deferred without a final errback, but it's hidden in a  
</I>&gt;&gt;<i> &gt;&gt;dark corner of the code somewhere.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks!
</I>&gt;&gt;<i>
</I>&gt;<i> I put together something to do a single-point-in-time graph (as  
</I>&gt;<i> distorted/delayed by the time it takes to go through all the objects in  
</I>&gt;<i> the python &gt;interpreter) of deferreds.  Please find it below as a shar  
</I>&gt;<i> archive (wow, someone still does those?   Yeah, sometimes)
</I>
Cool stuff - but could you use an ordinary archive format? Asking the  
whole mailing list to run gobs of shell code is.... I dunno. not something  
I'm going to bother with even if I would like to.

-E


&gt;<i>  Anyway, given a tree of deferreds, this will produce a whatever.dot  
</I>&gt;<i> file, which can be fed to graphviz' &quot;dot -Tpdf whatever.dot &gt;  
</I>&gt;<i> whatever.pdf&quot;, &gt;and the pdf has a rather nice-looking graph of the  
</I>&gt;<i> deferreds.
</I>&gt;<i>
</I>&gt;<i> #!/bin/sh
</I>&gt;<i> # This is a shell archive (produced by GNU sharutils 4.11.1).
</I>&gt;<i> # To extract the files from this archive, save it to some FILE, remove
</I>&gt;<i> # everything before the `#!/bin/sh' line above, then type `sh FILE'.
</I>&gt;<i> #
</I>&gt;<i> lock_dir=_sh32156
</I>&gt;<i> # Made on 2012-07-02 21:48 UTC by &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">stromberg at aw50</A>&gt;.
</I>&gt;<i> # Source directory was `/home/stromberg/src/twisted-experiments'.
</I>&gt;<i> #
</I>&gt;<i> # Existing files will *not* be overwritten, unless `-c' is specified.
</I>&gt;<i> #
</I>&gt;<i> # This shar contains:
</I>&gt;<i> # length mode       name
</I>&gt;<i> # ------ ---------- ------------------------------------------
</I>&gt;<i> #   2181 -rwxr-xr-x deferreddump.py
</I>&gt;<i> #   3174 -rwxr-xr-x wedgedump
</I>&gt;<i> #
</I>&gt;<i> MD5SUM=${MD5SUM-md5sum}
</I>&gt;<i> f=`${MD5SUM} --version | egrep '^md5sum .*(core|text)utils'`
</I>&gt;<i> test -n &quot;${f}&quot; &amp;&amp; md5check=true || md5check=false
</I>&gt;<i> ${md5check} || \
</I>&gt;<i>  echo 'Note: not verifying md5sums.  Consider installing GNU coreutils.'
</I>&gt;<i> if test &quot;X$1&quot; = &quot;X-c&quot;
</I>&gt;<i> then keep_file=''
</I>&gt;<i> else keep_file=true
</I>&gt;<i> fi
</I>&gt;<i> echo=echo
</I>&gt;<i> save_IFS=&quot;${IFS}&quot;
</I>&gt;<i> IFS=&quot;${IFS}:&quot;
</I>&gt;<i> gettext_dir=
</I>&gt;<i> locale_dir=
</I>&gt;<i> set_echo=false
</I>&gt;<i>
</I>&gt;<i> for dir in $PATH
</I>&gt;<i> do
</I>&gt;<i>  if test -f $dir/gettext \
</I>&gt;<i>     &amp;&amp; ($dir/gettext --version &gt;/dev/null 2&gt;&amp;1)
</I>&gt;<i>  then
</I>&gt;<i>    case `$dir/gettext --version 2&gt;&amp;1 | sed 1q` in
</I>&gt;<i>      *GNU*) gettext_dir=$dir
</I>&gt;<i>      set_echo=true
</I>&gt;<i>      break ;;
</I>&gt;<i>    esac
</I>&gt;<i>  fi
</I>&gt;<i> done
</I>&gt;<i>
</I>&gt;<i> if ${set_echo}
</I>&gt;<i> then
</I>&gt;<i>  set_echo=false
</I>&gt;<i>  for dir in $PATH
</I>&gt;<i>  do
</I>&gt;<i>    if test -f $dir/shar \
</I>&gt;<i>       &amp;&amp; ($dir/shar --print-text-domain-dir &gt;/dev/null 2&gt;&amp;1)
</I>&gt;<i>    then
</I>&gt;<i>      locale_dir=`$dir/shar --print-text-domain-dir`
</I>&gt;<i>      set_echo=true
</I>&gt;<i>      break
</I>&gt;<i>    fi
</I>&gt;<i>  done
</I>&gt;<i>
</I>&gt;<i>  if ${set_echo}
</I>&gt;<i>  then
</I>&gt;<i>    TEXTDOMAINDIR=$locale_dir
</I>&gt;<i>    export TEXTDOMAINDIR
</I>&gt;<i>    TEXTDOMAIN=sharutils
</I>&gt;<i>    export TEXTDOMAIN
</I>&gt;<i>    echo=&quot;$gettext_dir/gettext -s&quot;
</I>&gt;<i>  fi
</I>&gt;<i> fi
</I>&gt;<i> IFS=&quot;$save_IFS&quot;
</I>&gt;<i> if (echo &quot;testing\c&quot;; echo 1,2,3) | grep c &gt;/dev/null
</I>&gt;<i> then if (echo -n test; echo 1,2,3) | grep n &gt;/dev/null
</I>&gt;<i>     then shar_n= shar_c='
</I>&gt;<i> '
</I>&gt;<i>     else shar_n=-n shar_c= ; fi
</I>&gt;<i> else shar_n= shar_c='\c' ; fi
</I>&gt;<i> f=shar-touch.$$
</I>&gt;<i> st1=200112312359.59
</I>&gt;<i> st2=123123592001.59
</I>&gt;<i> st2tr=123123592001.5 # old SysV 14-char limit
</I>&gt;<i> st3=1231235901
</I>&gt;<i>
</I>&gt;<i> if touch -am -t ${st1} ${f} &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
</I>&gt;<i>   test ! -f ${st1} &amp;&amp; test -f ${f}; then
</I>&gt;<i>  shar_touch='touch -am -t $1$2$3$4$5$6.$7 &quot;$8&quot;'
</I>&gt;<i>
</I>&gt;<i> elif touch -am ${st2} ${f} &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
</I>&gt;<i>   test ! -f ${st2} &amp;&amp; test ! -f ${st2tr} &amp;&amp; test -f ${f}; then
</I>&gt;<i>  shar_touch='touch -am $3$4$5$6$1$2.$7 &quot;$8&quot;'
</I>&gt;<i>
</I>&gt;<i> elif touch -am ${st3} ${f} &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
</I>&gt;<i>   test ! -f ${st3} &amp;&amp; test -f ${f}; then
</I>&gt;<i>  shar_touch='touch -am $3$4$5$6$2 &quot;$8&quot;'
</I>&gt;<i>
</I>&gt;<i> else
</I>&gt;<i>  shar_touch=:
</I>&gt;<i>  echo
</I>&gt;<i>  ${echo} 'WARNING: not restoring timestamps.  Consider getting and
</I>&gt;<i> installing GNU `touch'\'', distributed in GNU coreutils...'
</I>&gt;<i>  echo
</I>&gt;<i> fi
</I>&gt;<i> rm -f ${st1} ${st2} ${st2tr} ${st3} ${f}
</I>&gt;<i> #
</I>&gt;<i> if test ! -d ${lock_dir} ; then :
</I>&gt;<i> else ${echo} &quot;lock directory ${lock_dir} exists&quot;
</I>&gt;<i>     exit 1
</I>&gt;<i> fi
</I>&gt;<i> if mkdir ${lock_dir}
</I>&gt;<i> then ${echo} &quot;x - created lock directory ${lock_dir}.&quot;
</I>&gt;<i> else ${echo} &quot;x - failed to create lock directory ${lock_dir}.&quot;
</I>&gt;<i>     exit 1
</I>&gt;<i> fi
</I>&gt;<i> # ============= deferreddump.py ==============
</I>&gt;<i> if test -n &quot;${keep_file}&quot; &amp;&amp; test -f 'deferreddump.py'
</I>&gt;<i> then
</I>&gt;<i> ${echo} &quot;x - SKIPPING deferreddump.py (file already exists)&quot;
</I>&gt;<i> else
</I>&gt;<i> ${echo} &quot;x - extracting deferreddump.py (text)&quot;
</I>&gt;<i>  sed 's/^X//' &lt;&lt; 'SHAR_EOF' &gt; 'deferreddump.py' &amp;&amp;
</I>&gt;<i> #!/usr/bin/python
</I>&gt;<i> X
</I>&gt;<i> # See also: <A HREF="http://twistedmatrix.com/trac/ticket/3858">http://twistedmatrix.com/trac/ticket/3858</A>
</I>&gt;<i> # and:      <A HREF="http://twistedmatrix.com/trac/ticket/1402">http://twistedmatrix.com/trac/ticket/1402</A>
</I>&gt;<i> # and:
</I>&gt;<i> #   twisted.internet.defer also exposes a setDebugging(bool) function to
</I>&gt;<i> #   store call stacks from creation and invocation in deferred objects,
</I>&gt;<i> #   it's what I was using to try and figure out what was going on, but
</I>&gt;<i> #   it's not nearly as at-a-glance as a graph is.
</I>&gt;<i> X
</I>&gt;<i> import gc
</I>&gt;<i> import sys
</I>&gt;<i> X
</I>&gt;<i> import twisted.internet.defer
</I>&gt;<i> X
</I>&gt;<i> def escape(callback_type, obj):
</I>&gt;<i> X    dummy = callback_type
</I>&gt;<i> X    return '%s' % (str(obj).replace(' ', '_').replace(':',  
</I>&gt;<i> '').replace('&lt;', '').replace('&gt;', ''), )
</I>&gt;<i> X
</I>&gt;<i> def dump(outfile = sys.stdout):
</I>&gt;<i> X    outfile.write('digraph deferred_digraph {\n')
</I>&gt;<i> X    for obj in gc.get_objects():
</I>&gt;<i> X        if isinstance(obj, twisted.internet.defer.Deferred):
</I>&gt;<i> X            len_callbacks = len(obj.callbacks)
</I>&gt;<i> X            if obj.callbacks:
</I>&gt;<i> X                outfile.write('\t%s -&gt; %s\n' % (escape('', obj),  
</I>&gt;<i> escape('', obj.callbacks[0][0][0])))
</I>&gt;<i> X                outfile.write('\t%s -&gt; %s\n' % (escape('', obj),  
</I>&gt;<i> escape('', obj.callbacks[0][1][0])))
</I>&gt;<i> X            for callbackpairno in range(len_callbacks - 1):
</I>&gt;<i> X                current_callback = obj.callbacks[callbackpairno][0]
</I>&gt;<i> X                current_errback = obj.callbacks[callbackpairno][1]
</I>&gt;<i> X                current_callback_desc = current_callback[0]
</I>&gt;<i> X                current_errback_desc = current_errback[0]
</I>&gt;<i> X
</I>&gt;<i> X                next_callback = obj.callbacks[callbackpairno + 1][0]
</I>&gt;<i> X                next_errback = obj.callbacks[callbackpairno + 1][1]
</I>&gt;<i> X                next_callback_desc = next_callback[0]
</I>&gt;<i> X                next_errback_desc = next_errback[0]
</I>&gt;<i> X
</I>&gt;<i> X                outfile.write('\t%s -&gt; %s;\n' % (escape('callback',  
</I>&gt;<i> current_callback_desc), escape('callback', next_callback_desc)))
</I>&gt;<i> X                outfile.write('\t%s -&gt; %s;\n' % (escape('errback',  
</I>&gt;<i> current_errback_desc), escape('errback', next_errback_desc)))
</I>&gt;<i> X
</I>&gt;<i> X                outfile.write('\t%s -&gt; %s;\n' % (escape('callback',  
</I>&gt;<i> current_callback_desc), escape('errback', next_errback_desc)))
</I>&gt;<i> X                outfile.write('\t%s -&gt; %s;\n' % (escape('errback',  
</I>&gt;<i> current_errback_desc), escape('callback', next_callback_desc)))
</I>&gt;<i> X
</I>&gt;<i> X    outfile.write('}\n')
</I>&gt;<i> X
</I>&gt;<i> X
</I>&gt;<i> SHAR_EOF
</I>&gt;<i>  (set 20 12 06 29 18 02 00 'deferreddump.py'
</I>&gt;<i>   eval &quot;${shar_touch}&quot;) &amp;&amp; \
</I>&gt;<i>  chmod 0755 'deferreddump.py'
</I>&gt;<i> if test $? -ne 0
</I>&gt;<i> then ${echo} &quot;restore of deferreddump.py failed&quot;
</I>&gt;<i> fi
</I>&gt;<i>  if ${md5check}
</I>&gt;<i>  then (
</I>&gt;<i>       ${MD5SUM} -c &gt;/dev/null 2&gt;&amp;1 || ${echo} 'deferreddump.py': 'MD5  
</I>&gt;<i> check failed'
</I>&gt;<i>       ) &lt;&lt; \SHAR_EOF
</I>&gt;<i> 45b2aed37cc2e57bc58f46a42eb2a2d4  deferreddump.py
</I>&gt;<i> SHAR_EOF
</I>&gt;<i>  else
</I>&gt;<i> test `LC_ALL=C wc -c &lt; 'deferreddump.py'` -ne 2181 &amp;&amp; \
</I>&gt;<i>  ${echo} &quot;restoration warning:  size of 'deferreddump.py' is not 2181&quot;
</I>&gt;<i>  fi
</I>&gt;<i> fi
</I>&gt;<i> # ============= wedgedump ==============
</I>&gt;<i> if test -n &quot;${keep_file}&quot; &amp;&amp; test -f 'wedgedump'
</I>&gt;<i> then
</I>&gt;<i> ${echo} &quot;x - SKIPPING wedgedump (file already exists)&quot;
</I>&gt;<i> else
</I>&gt;<i> ${echo} &quot;x - extracting wedgedump (text)&quot;
</I>&gt;<i>  sed 's/^X//' &lt;&lt; 'SHAR_EOF' &gt; 'wedgedump' &amp;&amp;
</I>&gt;<i> #!/usr/bin/python
</I>&gt;<i> X
</I>&gt;<i> # Unhandled Errors
</I>&gt;<i> X
</I>&gt;<i> # From <A HREF="http://twistedmatrix.com/documents/current/core/howto/defer.html">http://twistedmatrix.com/documents/current/core/howto/defer.html</A> :
</I>&gt;<i> X
</I>&gt;<i> #   If a Deferred is garbage-collected with an unhandled error (i.e. it
</I>&gt;<i> #   would call the next errback if there was one), then Twisted will  
</I>&gt;<i> write
</I>&gt;<i> #   the error's traceback to the log file. This means that you can
</I>&gt;<i> #   typically get away with not adding errbacks and still get errors
</I>&gt;<i> #   logged. Be careful though; if you keep a reference to the Deferred
</I>&gt;<i> #   around, preventing it from being garbage-collected, then you may  
</I>&gt;<i> never
</I>&gt;<i> #   see the error (and your callbacks will mysteriously seem to have  
</I>&gt;<i> never
</I>&gt;<i> #   been called). If unsure, you should explicitly add an errback after
</I>&gt;<i> #   your callbacks, even if all you do is:
</I>&gt;<i> X
</I>&gt;<i> #       # Make sure errors get logged
</I>&gt;<i> #       from twisted.python import log
</I>&gt;<i> #       d.addErrback(log.err)
</I>&gt;<i> X
</I>&gt;<i> import sys
</I>&gt;<i> #mport time
</I>&gt;<i> X
</I>&gt;<i> import twisted.internet.defer
</I>&gt;<i> import twisted.python
</I>&gt;<i> X
</I>&gt;<i> import deferreddump
</I>&gt;<i> X
</I>&gt;<i> def get_deferred():
</I>&gt;<i> X    return twisted.internet.defer.succeed(1)
</I>&gt;<i> X
</I>&gt;<i> def cb1(value):
</I>&gt;<i> X    print value
</I>&gt;<i> X    return value * 2
</I>&gt;<i> X
</I>&gt;<i> def cb2(value):
</I>&gt;<i> X    #raise ValueError
</I>&gt;<i> X    print value
</I>&gt;<i> X    return value * 2
</I>&gt;<i> X
</I>&gt;<i> def cb3(value):
</I>&gt;<i> X    print value
</I>&gt;<i> X    return value * 2
</I>&gt;<i> X
</I>&gt;<i> def cb4(value):
</I>&gt;<i> X    print value
</I>&gt;<i> X    return value * 2
</I>&gt;<i> X
</I>&gt;<i> def cb5(value):
</I>&gt;<i> X    print value
</I>&gt;<i> X    return value * 2
</I>&gt;<i> X
</I>&gt;<i> def cb6(value):
</I>&gt;<i> X    print value
</I>&gt;<i> X    return value * 2
</I>&gt;<i> X
</I>&gt;<i> def cb7(value):
</I>&gt;<i> X    print value
</I>&gt;<i> X    return value * 2
</I>&gt;<i> X
</I>&gt;<i> def cb8(value):
</I>&gt;<i> X    print value
</I>&gt;<i> X    return value * 2
</I>&gt;<i> X
</I>&gt;<i> def eb1(value):
</I>&gt;<i> X    twisted.python.log.err()
</I>&gt;<i> X
</I>&gt;<i> def eb2(value):
</I>&gt;<i> X    twisted.python.log.err()
</I>&gt;<i> X
</I>&gt;<i> def eb3(value):
</I>&gt;<i> X    twisted.python.log.err()
</I>&gt;<i> X
</I>&gt;<i> def eb4(value):
</I>&gt;<i> X    twisted.python.log.err()
</I>&gt;<i> X
</I>&gt;<i> def eb5(value):
</I>&gt;<i> X    twisted.python.log.err()
</I>&gt;<i> X
</I>&gt;<i> def eb6(value):
</I>&gt;<i> X    twisted.python.log.err()
</I>&gt;<i> X
</I>&gt;<i> def eb7(value):
</I>&gt;<i> X    twisted.python.log.err()
</I>&gt;<i> X
</I>&gt;<i> def eb8(value):
</I>&gt;<i> X    twisted.python.log.err()
</I>&gt;<i> X
</I>&gt;<i> def arbitrary_function(add_final_log):
</I>&gt;<i> X    deferred = get_deferred()
</I>&gt;<i> X
</I>&gt;<i> X    # apparently we can use the same callback multiple times in the  
</I>&gt;<i> same deferred
</I>&gt;<i> X    first_deferred = deferred.addCallback(cb1)
</I>&gt;<i> X    first_deferred.pause()
</I>&gt;<i> X    deferred.addCallbacks(cb1, eb1)
</I>&gt;<i> X    deferred.addCallbacks(cb2, eb2)
</I>&gt;<i> X    deferred.addCallbacks(cb3, eb3)
</I>&gt;<i> X    deferred.addCallbacks(cb4, eb4)
</I>&gt;<i> X    deferred.addCallbacks(cb5, eb5)
</I>&gt;<i> X    deferred.addCallbacks(cb6, eb6)
</I>&gt;<i> X    deferred.addCallbacks(cb7, eb7)
</I>&gt;<i> X
</I>&gt;<i> X    with open('t.dot', 'w') as file_:
</I>&gt;<i> X        deferreddump.dump(file_)
</I>&gt;<i> X
</I>&gt;<i> X    first_deferred.unpause()
</I>&gt;<i> X    if add_final_log:
</I>&gt;<i> X        deferred.addCallbacks(cb4, twisted.python.log.err)
</I>&gt;<i> X    else:
</I>&gt;<i> X        deferred.addCallback(cb4)
</I>&gt;<i> X
</I>&gt;<i> X    return deferred
</I>&gt;<i> X
</I>&gt;<i> def usage(retval):
</I>&gt;<i> X    sys.stderr.write('Usage: %s --add-final-log\n' % sys.argv[0])
</I>&gt;<i> X    sys.exit(retval)
</I>&gt;<i> X
</I>&gt;<i> def main():
</I>&gt;<i> X    add_final_log = False
</I>&gt;<i> X    while sys.argv[1:]:
</I>&gt;<i> X        if sys.argv[1] == '--add-final-log':
</I>&gt;<i> X            add_final_log = True
</I>&gt;<i> X        elif sys.argv[1] in [ '-h', '--help' ]:
</I>&gt;<i> X            usage(0)
</I>&gt;<i> X        else:
</I>&gt;<i> X            sys.stderr.write('%s: Unrecognized option: %s\n' %  
</I>&gt;<i> (sys.argv[0], sys.argv[1]))
</I>&gt;<i> X            usage(1)
</I>&gt;<i> X        del sys.argv[1]
</I>&gt;<i> X
</I>&gt;<i> X    deferred = arbitrary_function(add_final_log)
</I>&gt;<i> X    with open('/dev/null', 'w') as file_:
</I>&gt;<i> X        file_.write(str(deferred))
</I>&gt;<i> X
</I>&gt;<i> X    sys.exit(0)
</I>&gt;<i> X
</I>&gt;<i> main()
</I>&gt;<i> X
</I>&gt;<i> SHAR_EOF
</I>&gt;<i>  (set 20 12 07 02 21 46 02 'wedgedump'
</I>&gt;<i>   eval &quot;${shar_touch}&quot;) &amp;&amp; \
</I>&gt;<i>  chmod 0755 'wedgedump'
</I>&gt;<i> if test $? -ne 0
</I>&gt;<i> then ${echo} &quot;restore of wedgedump failed&quot;
</I>&gt;<i> fi
</I>&gt;<i>  if ${md5check}
</I>&gt;<i>  then (
</I>&gt;<i>       ${MD5SUM} -c &gt;/dev/null 2&gt;&amp;1 || ${echo} 'wedgedump': 'MD5 check  
</I>&gt;<i> failed'
</I>&gt;<i>       ) &lt;&lt; \SHAR_EOF
</I>&gt;<i> d526664fcf63762f768303af91a74a5f  wedgedump
</I>&gt;<i> SHAR_EOF
</I>&gt;<i>  else
</I>&gt;<i> test `LC_ALL=C wc -c &lt; 'wedgedump'` -ne 3174 &amp;&amp; \
</I>&gt;<i>  ${echo} &quot;restoration warning:  size of 'wedgedump' is not 3174&quot;
</I>&gt;<i>  fi
</I>&gt;<i> fi
</I>&gt;<i> if rm -fr ${lock_dir}
</I>&gt;<i> then ${echo} &quot;x - removed lock directory ${lock_dir}.&quot;
</I>&gt;<i> else ${echo} &quot;x - failed to remove lock directory ${lock_dir}.&quot;
</I>&gt;<i>     exit 1
</I>&gt;<i> fi
</I>&gt;<i> exit 0
</I>&gt;<i>
</I>


-- 
Using Opera's revolutionary email client: <A HREF="http://www.opera.com/mail/">http://www.opera.com/mail/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20120722/7032f6ac/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058326.html">[Twisted-Python] deferred graph?
</A></li>
	<LI>Next message (by thread): <A HREF="058208.html">[Twisted-Python] ANN: Twisted DBus 1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58340">[ date ]</a>
              <a href="thread.html#58340">[ thread ]</a>
              <a href="subject.html#58340">[ subject ]</a>
              <a href="author.html#58340">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
