<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] bug or my code? (getPage + Twisted Webserver = Exception)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20bug%20or%20my%20code%3F%20%28getPage%20%2B%20Twisted%20Webserver%20%3D%0A%20Exception%29&In-Reply-To=%3C20120704110945.4071.1281807867.divmod.xquotient.10%40localhost6.localdomain6%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058221.html">
   <LINK REL="Next"  HREF="058227.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] bug or my code? (getPage + Twisted Webserver = Exception)</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20bug%20or%20my%20code%3F%20%28getPage%20%2B%20Twisted%20Webserver%20%3D%0A%20Exception%29&In-Reply-To=%3C20120704110945.4071.1281807867.divmod.xquotient.10%40localhost6.localdomain6%3E"
       TITLE="[Twisted-Python] bug or my code? (getPage + Twisted Webserver = Exception)">exarkun at twistedmatrix.com
       </A><BR>
    <I>Wed Jul  4 05:09:45 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058221.html">[Twisted-Python] bug or my code? (getPage + Twisted Webserver =	Exception)
</A></li>
        <LI>Next message (by thread): <A HREF="058227.html">[Twisted-Python] bug or my code? (getPage + Twisted Webserver =	Exception)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58225">[ date ]</a>
              <a href="thread.html#58225">[ thread ]</a>
              <a href="subject.html#58225">[ subject ]</a>
              <a href="author.html#58225">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3 Jul, 09:54 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mobilebackup77 at gmail.com</A> wrote:
&gt;<i>Hi All,
</I>&gt;<i>
</I>&gt;<i>I have a flask application that I am running on a https twisted
</I>&gt;<i>webserver and forwarding the port to a url. Everything works well. I
</I>&gt;<i>can goto the url using firefox, accept the certificate and get in.
</I>&gt;<i>
</I>&gt;<i>I have a small nose test to test if the url is up. Here is the test:
</I>&gt;<i>
</I>&gt;<i>    @deferred(timeout = 31)
</I>&gt;<i>    @defer.inlineCallbacks
</I>&gt;<i>    def test_if_forwarding_url_is_ready(self):
</I>&gt;<i>        &quot;&quot;&quot;
</I>&gt;<i>            furl: Check if url is accessible
</I>&gt;<i>        &quot;&quot;&quot;
</I>&gt;<i>        # First wait for 10 seconds
</I>&gt;<i>        yield task.deferLater(reactor, 10, lambda:None)
</I>&gt;<i>        delay = 2
</I>&gt;<i>        secureurl = Config.General.url
</I>&gt;<i>        # Every two seconds do a query and find out if you can get
</I>&gt;<i>        # data from the mapped url. If you can, then exit
</I>&gt;<i>        for i in range(15):
</I>&gt;<i>            got_data = False
</I>&gt;<i>            print &quot;Trial :&quot;, i
</I>&gt;<i>            try:
</I>&gt;<i>                output = yield getPage(secureurl)
</I>&gt;<i>                got_data = True
</I>&gt;<i>            except Exception as E:
</I>&gt;<i>                print &quot;Exception occurred:&quot;, E
</I>&gt;<i>                got_data = False
</I>&gt;<i>            if got_data == True:
</I>&gt;<i>                assert &quot;secure magic&quot; in output
</I>&gt;<i>                return
</I>&gt;<i>            yield task.deferLater(reactor, delay, lambda:None)
</I>&gt;<i>        # All 15 trials to get data from the url failed
</I>&gt;<i>        assert False
</I>&gt;<i>
</I>&gt;<i>When the test is run, it fails &quot;most of the time&quot; and outputs:
</I>&gt;<i>
</I>&gt;<i>Exception occurred: [('SSL routines', 'SSL23_READ', 'ssl handshake 
</I>&gt;<i>failure')]
</I>&gt;<i>
</I>&gt;<i>But if I run the test and right away goto the secureurl manually using
</I>&gt;<i>firefox or chrome, as soon as I am on the webpage, the test passes!
</I>&gt;<i>Sometimes I've seen the test will pass after 8 trials, if that is when
</I>&gt;<i>I can type the url in firefox and press enter!
</I>&gt;<i>
</I>&gt;<i>Any ideas what is causing this and how to fix it? Maybe I am doing
</I>&gt;<i>something stupid and perhaps someone can help me rewrite this code.
</I>
nose used to support Twisted with some gross, arguably incorrect code. 
I don't know if this is still the case, but it's perhaps something to 
investigate.

Apart from that, getPage uses Twisted's regular (&quot;standard&quot;?  &quot;only&quot;?) 
SSL support to do HTTPS.  There *shouldn't* be anything particular to 
getPage that would cause the handshake to fail, so either Twisted's SSL 
support is broken in general in whatever configuration you're using, or 
the problem isn't in Twisted.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058221.html">[Twisted-Python] bug or my code? (getPage + Twisted Webserver =	Exception)
</A></li>
	<LI>Next message (by thread): <A HREF="058227.html">[Twisted-Python] bug or my code? (getPage + Twisted Webserver =	Exception)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58225">[ date ]</a>
              <a href="thread.html#58225">[ thread ]</a>
              <a href="subject.html#58225">[ subject ]</a>
              <a href="author.html#58225">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
