<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ITransport.write%20after%0A%20IProtocol.connectionLost%20--%20no%20failure/exception%3F&In-Reply-To=%3CC43121A4-1FAC-47CC-BFD2-A2957D736A1A%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063414.html">
   <LINK REL="Next"  HREF="063416.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ITransport.write%20after%0A%20IProtocol.connectionLost%20--%20no%20failure/exception%3F&In-Reply-To=%3CC43121A4-1FAC-47CC-BFD2-A2957D736A1A%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Dec 16 13:27:59 MST 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063414.html">[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?
</A></li>
        <LI>Next message (by thread): <A HREF="063416.html">[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63415">[ date ]</a>
              <a href="thread.html#63415">[ thread ]</a>
              <a href="subject.html#63415">[ subject ]</a>
              <a href="author.html#63415">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Dec 16, 2016, at 5:22 AM, Cory Benfield &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">cory at lukasa.co.uk</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> On 15 Dec 2016, at 12:07, exvito here &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ex.vitorino at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Dear all,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The subject says most of it. While diagnosing a behavior on a somewhat
</I>&gt;&gt;<i> large codebase, I found out something somewhat surprising -- see
</I>&gt;&gt;<i> subject -- which is replicated with the minimal code example below.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> It is a LineReceiver client that:
</I>&gt;&gt;<i> 1. Connects to 127.0.0.1:10000.
</I>&gt;&gt;<i> 2. Sends a line of text.
</I>&gt;&gt;<i> 3. Disconnects one second later.
</I>&gt;&gt;<i> 4. Tries to send another line of text, one second after disconnection.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I expected step 4 to fail somehow, given that Twisted promptly
</I>&gt;&gt;<i> detected that the connection closed and IProtocol.connectionLost was
</I>&gt;&gt;<i> called, as documented. Nevertheless, it does not fail.
</I>&gt;<i> 
</I>&gt;<i> I can’t speak for the design of Twisted, but this is definitely an intended implementation behaviour: because twisted’s write method is non-blocking, it is generally nicer to avoid write exploding in your face when disconnected.
</I>
I can! The main design feature of this approach is that if you have a loop like this:

for x in messages:
    self.transport.write(self.encode(x))

you should not have to write it to be:

for x in messages:
    if self._flagISetInConnectionLost:
        break
    self.transport.write(self.encode(x))

just to avoid seeing tracebacks in your logs.

If you care about the disconnection event, implement connectionLost to do the thing that needs to be done (in this case, stop your LoopingCall).  That's what that callback is there for!

-glyph

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063414.html">[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?
</A></li>
	<LI>Next message (by thread): <A HREF="063416.html">[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63415">[ date ]</a>
              <a href="thread.html#63415">[ thread ]</a>
              <a href="subject.html#63415">[ subject ]</a>
              <a href="author.html#63415">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
