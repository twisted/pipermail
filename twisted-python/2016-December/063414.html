<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ITransport.write%20after%0A%20IProtocol.connectionLost%20--%20no%20failure/exception%3F&In-Reply-To=%3C2FA38717-2D39-4177-97C6-5BA16EE1A9DB%40lukasa.co.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="030952.html">
   <LINK REL="Next"  HREF="063415.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?</H1>
    <B>Cory Benfield</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ITransport.write%20after%0A%20IProtocol.connectionLost%20--%20no%20failure/exception%3F&In-Reply-To=%3C2FA38717-2D39-4177-97C6-5BA16EE1A9DB%40lukasa.co.uk%3E"
       TITLE="[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?">cory at lukasa.co.uk
       </A><BR>
    <I>Fri Dec 16 06:22:09 MST 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="030952.html">[Twisted-Python] ITransport.write after IProtocol.connectionLost --	no failure/exception?
</A></li>
        <LI>Next message (by thread): <A HREF="063415.html">[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63414">[ date ]</a>
              <a href="thread.html#63414">[ thread ]</a>
              <a href="subject.html#63414">[ subject ]</a>
              <a href="author.html#63414">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On 15 Dec 2016, at 12:07, exvito here &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ex.vitorino at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Dear all,
</I>&gt;<i> 
</I>&gt;<i> The subject says most of it. While diagnosing a behavior on a somewhat
</I>&gt;<i> large codebase, I found out something somewhat surprising -- see
</I>&gt;<i> subject -- which is replicated with the minimal code example below.
</I>&gt;<i> 
</I>&gt;<i> It is a LineReceiver client that:
</I>&gt;<i> 1. Connects to 127.0.0.1:10000.
</I>&gt;<i> 2. Sends a line of text.
</I>&gt;<i> 3. Disconnects one second later.
</I>&gt;<i> 4. Tries to send another line of text, one second after disconnection.
</I>&gt;<i> 
</I>&gt;<i> I expected step 4 to fail somehow, given that Twisted promptly
</I>&gt;<i> detected that the connection closed and IProtocol.connectionLost was
</I>&gt;<i> called, as documented. Nevertheless, it does not fail.
</I>
I can’t speak for the design of Twisted, but this is definitely an intended implementation behaviour: because twisted’s write method is non-blocking, it is generally nicer to avoid write exploding in your face when disconnected.

&gt;<i> b) Does a protocol implementation, like the one in the example, really
</I>&gt;<i> need to track connectionMade / connectionLost calls before going for
</I>&gt;<i> self.transport.write?
</I>
A well-written protocol should stop finding reasons to write once connectionLost is called, yes. Similarly, it should probably avoid writing before connectionMade.

&gt;<i> c) Can a protocol implementation, instead, depend on
</I>&gt;<i> self.transport.connected for which I found no documentation? (I
</I>&gt;<i> probably missed it, where is it?)
</I>
I have no good answer to this one, but basically I suspect the answer is “yes, for the default TCP transports”, but “no, not in the general case, because it’s not part of a documented interface”.

Cory



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="030952.html">[Twisted-Python] ITransport.write after IProtocol.connectionLost --	no failure/exception?
</A></li>
	<LI>Next message (by thread): <A HREF="063415.html">[Twisted-Python] ITransport.write after IProtocol.connectionLost -- no failure/exception?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63414">[ date ]</a>
              <a href="thread.html#63414">[ thread ]</a>
              <a href="subject.html#63414">[ subject ]</a>
              <a href="author.html#63414">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
