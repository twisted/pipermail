<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] conch problem with ecdsa-sha2-nistp256 host	key?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20conch%20problem%20with%20ecdsa-sha2-nistp256%20host%0A%09key%3F&In-Reply-To=%3C20161202030124.GA19532%40hammal%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063374.html">
   <LINK REL="Next"  HREF="063376.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] conch problem with ecdsa-sha2-nistp256 host	key?</H1>
    <B>Mark Williams</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20conch%20problem%20with%20ecdsa-sha2-nistp256%20host%0A%09key%3F&In-Reply-To=%3C20161202030124.GA19532%40hammal%3E"
       TITLE="[Twisted-Python] conch problem with ecdsa-sha2-nistp256 host	key?">markrwilliams at gmail.com
       </A><BR>
    <I>Thu Dec  1 20:01:25 MST 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063374.html">[Twisted-Python] conch problem with ecdsa-sha2-nistp256 host	key?
</A></li>
        <LI>Next message (by thread): <A HREF="063376.html">[Twisted-Python] conch problem with ecdsa-sha2-nistp256 host	key?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63375">[ date ]</a>
              <a href="thread.html#63375">[ thread ]</a>
              <a href="subject.html#63375">[ subject ]</a>
              <a href="author.html#63375">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Dec 01, 2016 at 05:11:37PM -0800, Craig Rodrigues wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I filed this bug:
</I>&gt;<i> <A HREF="https://twistedmatrix.com/trac/ticket/8931">https://twistedmatrix.com/trac/ticket/8931</A>
</I>&gt;<i>
</I>&gt;<i> At least for me, conch fails to parse a host key created by OpenSSH
</I>&gt;<i> in ~/.ssh/known_hosts
</I>&gt;<i> which is of type ecdsa-sha2-nistp256.
</I>&gt;<i>
</I>&gt;<i> Anyone have an idea as to how to fix this?
</I>&gt;<i>
</I>
As usual you've found a fantastically interesting issue.

This is conch, the client, right?  I'm guessing so because
~/.ssh/known_hosts contains the servers the ssh client trusts.
(Specifically, among other things it contains a hostname and that
host's sshd server's public key fingerprint).

If it is conch, the-client, then deleting the offending entry from
~/.ssh/known_hosts and getting a new one makes sense.  That's because
sshd usually generates a couple of different keys in case clients
don't support the latest and greatest technology.

I think deleting the entry in ~/.ssh/known_hosts allows conch to ask
the server for a different key that it *can* understand.  You should
be able to find out which server key conch negotiated by doing thing
following after deleting the offending ~/.ssh/known_hosts entry:

(&lt;hostname is the problematic OS X server&gt;)
$ ssh-keygen -H -F &lt;hostname&gt; | awk '{ print $NF }'
dGhpcyBpcyB2ZXJ5IHZlcnkgdmVyeSB2ZXJ5IHZlcnkgbG9uZyBob3N0IGtleQ==

Then on the OS X server, grep for that in /etc/ssh/*.pub

I bet the key negotiated by conch is not an ECDSA key but rather an
RSA key.  If this is all the case, then I think you've found a key
that LibreSSL supports but your client's libssl (which conch calls
into via cryptography) does not.  What version of libssl do you have?

If any of this is helpful or relevant I'll ask more questions in the
ticket.

Thanks!

-Mark


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063374.html">[Twisted-Python] conch problem with ecdsa-sha2-nistp256 host	key?
</A></li>
	<LI>Next message (by thread): <A HREF="063376.html">[Twisted-Python] conch problem with ecdsa-sha2-nistp256 host	key?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63375">[ date ]</a>
              <a href="thread.html#63375">[ thread ]</a>
              <a href="subject.html#63375">[ subject ]</a>
              <a href="author.html#63375">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
