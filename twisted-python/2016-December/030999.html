<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] hmac-sha2-512 - Corrupted MAC on input with	OpenSSH
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20hmac-sha2-512%20-%20Corrupted%20MAC%20on%20input%20with%0A%09OpenSSH&In-Reply-To=%3CCAG%3DrPVccsxgVBpb_QarfK4%3Di%2Bti_9dpfGWMmJtm7ghP-qTytyA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030976.html">
   <LINK REL="Next"  HREF="031002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] hmac-sha2-512 - Corrupted MAC on input with	OpenSSH</H1>
    <B>Craig Rodrigues</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20hmac-sha2-512%20-%20Corrupted%20MAC%20on%20input%20with%0A%09OpenSSH&In-Reply-To=%3CCAG%3DrPVccsxgVBpb_QarfK4%3Di%2Bti_9dpfGWMmJtm7ghP-qTytyA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] hmac-sha2-512 - Corrupted MAC on input with	OpenSSH">rodrigc at crodrigues.org
       </A><BR>
    <I>Wed Dec 28 10:40:07 MST 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="030976.html">[Twisted-Python] hmac-sha2-512 - Corrupted MAC on input with	OpenSSH
</A></li>
        <LI>Next message: <A HREF="031002.html">[Twisted-Python] hmac-sha2-512 - Corrupted MAC on input with OpenSSH
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30999">[ date ]</a>
              <a href="thread.html#30999">[ thread ]</a>
              <a href="subject.html#30999">[ subject ]</a>
              <a href="author.html#30999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jianchen,

Can you provide more details about the server you are writing?

I cannot reproduce your problem with the latest Twisted code in trunk.

Here is what I did:


git clone <A HREF="https://github.com/twisted/twisted">https://github.com/twisted/twisted</A> twisted-test
cd twisted-test
python setup.py develop
cd docs/conch/examples
mkdir ssh-examples
ckeygen -t rsa -f ssh-keys/ssh_host_rsa_key
twistd -ny demo_recvline.tac


I logged in with:


ssh <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">username at 127.0.0.1</A> -m hmac-sha2-512 -vvv -p 6022

(using *username* for the login, and  *password* for the password)

&gt;<i>From the log, I saw:
</I>
debug1: Authenticating to 127.0.0.1:6022 as 'username'
debug3: put_host_port: [127.0.0.1]:6022
debug3: hostkeys_foreach: reading file &quot;/Users/crodrigues/.ssh/known_hosts&quot;
debug3: record_hostkey: found key type RSA in file
/Users/crodrigues/.ssh/known_hosts:5
debug3: load_hostkeys: loaded 1 keys from [127.0.0.1]:6022
debug3: order_hostkeyalgs: prefer hostkeyalgs: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ssh-rsa-cert-v01 at openssh.com</A>
,rsa-sha2-512,rsa-sha2-256,ssh-rsa
debug3: send packet: type 20
debug1: SSH2_MSG_KEXINIT sent
debug3: receive packet: type 20
debug1: SSH2_MSG_KEXINIT received
debug2: local client KEXINIT proposal
debug2: KEX algorithms: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">curve25519-sha256 at libssh.org</A>
,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,ext-info-c
debug2: host key algorithms: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ssh-rsa-cert-v01 at openssh.com</A>,rsa-sha2-512
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">,rsa-sha2-256,ssh-rsa,ecdsa-sha2-nistp256-cert-v01 at openssh.com</A>,
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ecdsa-sha2-nistp384-cert-v01 at openssh.com</A>,
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">ecdsa-sha2-nistp521-cert-v01 at openssh.com</A><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">,ssh-ed25519-cert-v01 at openssh.com</A>
,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-ed25519
debug2: ciphers ctos: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chacha20-poly1305 at openssh.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm at openssh.com</A>,
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">aes256-gcm at openssh.com</A>,aes128-cbc,aes192-cbc,aes256-cbc,3des-cbc
debug2: ciphers stoc: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chacha20-poly1305 at openssh.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm at openssh.com</A>,
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">aes256-gcm at openssh.com</A>,aes128-cbc,aes192-cbc,aes256-cbc,3des-cbc
debug2: MACs ctos: hmac-sha2-512
debug2: MACs stoc: hmac-sha2-512
debug2: compression ctos: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">none,zlib at openssh.com</A>,zlib
debug2: compression stoc: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">none,zlib at openssh.com</A>,zlib
debug2: languages ctos:
debug2: languages stoc:
debug2: first_kex_follows 0
debug2: reserved 0
debug2: peer server KEXINIT proposal
debug2: KEX algorithms:
ecdh-sha2-nistp256,ecdh-sha2-nistk163,ecdh-sha2-nistp224,ecdh-sha2-nistk233,ecdh-sha2-nistb233,ecdh-sha2-nistp384,ecdh-sha2-nistk283,ecdh-sha2-nistk409,ecdh-sha2-nistb409,ecdh-sha2-nistp521,ecdh-sha2-nistt571,diffie-hellman-group1-sha1,diffie-hellman-group14-sha1
debug2: host key algorithms: ssh-rsa
debug2: ciphers ctos:
aes256-ctr,aes256-cbc,aes192-ctr,aes192-cbc,aes128-ctr,aes128-cbc,cast128-ctr,cast128-cbc,blowfish-cbc,
3des-cbc
debug2: ciphers stoc:
aes256-ctr,aes256-cbc,aes192-ctr,aes192-cbc,aes128-ctr,aes128-cbc,cast128-ctr,cast128-cbc,blowfish-cbc,
3des-cbc

debug2: MACs ctos: hmac-sha2-512,hmac-sha2-384,hmac-sha2-256
,hmac-sha1,hmac-md5

debug2: compression ctos: none,zlib
debug2: compression stoc: none,zlib
debug2: languages ctos:
debug2: languages stoc:debug2: first_kex_follows 0
debug2: reserved 0
debug1: kex: algorithm: ecdh-sha2-nistp256
debug1: kex: host key algorithm: ssh-rsa
debug1: kex: server-&gt;client cipher: aes128-ctr MAC: hmac-sha2-512
compression: none
debug1: kex: client-&gt;server cipher: aes128-ctr MAC: hmac-sha2-512
compression: none
debug3: send packet: type 30
debug1: sending SSH2_MSG_KEX_ECDH_INIT
debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
debug3: receive packet: type 31
debug1: Server host key: ssh-rsa
SHA256:VP7JUyzN/BuRNuCOieijGHuF9fAylDBCYYJAtJ+gDO8
debug3: put_host_port: [127.0.0.1]:6022
debug3: put_host_port: [127.0.0.1]:6022
debug3: hostkeys_foreach: reading file &quot;/Users/crodrigues/.ssh/known_hosts&quot;
debug3: record_hostkey: found key type RSA in file
/Users/crodrigues/.ssh/known_hosts:5
debug3: load_hostkeys: loaded 1 keys from [127.0.0.1]:6022
debug1: Host '[127.0.0.1]:6022' is known and matches the RSA host key.
debug1: Found key in /Users/crodrigues/.ssh/known_hosts:5
debug3: send packet: type 21
debug2: set_newkeys: mode 1



I did not see the problem that you saw.

--
Craig


On Tue, Dec 20, 2016 at 10:15 PM, &#38472;&#20581; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chenjianhappy2008 at 126.com</A>&gt; wrote:

&gt;<i>  hi:
</I>&gt;<i>
</I>&gt;<i>     I write a SSH server with Twisted(15.5.0)  Conch.  But it  don't
</I>&gt;<i> support hmac-sha2-512 MAC algorithms
</I>&gt;<i> .  However I see this problem has been fixed in <A HREF="https://twistedmatrix.com/">https://twistedmatrix.com/</A>
</I>&gt;<i> trac/ticket/8108 .  I asked the question in <A HREF="http://stackoverflow.com/">http://stackoverflow.com/</A>
</I>&gt;<i> questions/41254398/twisted-hmac-sha2-512-corrupted-mac-
</I>&gt;<i> on-input-with-openssh .
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i>  ---jianchen
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20161228/d1a79b16/attachment-0001.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20161228/d1a79b16/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030976.html">[Twisted-Python] hmac-sha2-512 - Corrupted MAC on input with	OpenSSH
</A></li>
	<LI>Next message: <A HREF="031002.html">[Twisted-Python] hmac-sha2-512 - Corrupted MAC on input with OpenSSH
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30999">[ date ]</a>
              <a href="thread.html#30999">[ thread ]</a>
              <a href="subject.html#30999">[ subject ]</a>
              <a href="author.html#30999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
