<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Known bug with twistd log rotation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Known%20bug%20with%20twistd%20log%20rotation&In-Reply-To=%3C53987026.1000106%40riehl.io%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Known bug with twistd log rotation</H1>
    <B>Maximilien Riehl</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Known%20bug%20with%20twistd%20log%20rotation&In-Reply-To=%3C53987026.1000106%40riehl.io%3E"
       TITLE="[Twisted-Python] Known bug with twistd log rotation">max at riehl.io
       </A><BR>
    <I>Wed Jun 11 09:05:10 MDT 2014</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60874">[ date ]</a>
              <a href="thread.html#60874">[ thread ]</a>
              <a href="subject.html#60874">[ subject ]</a>
              <a href="author.html#60874">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

I'm finding it difficult to get log rotation working cleanly with twistd 
(if dropping privileges through twistd, which we require).
I went through all the docs and also found [1] very helpful, but the 
problem boils down to the fact that


&gt;<i>     Implications for Logfile Rotation
</I>&gt;<i>
</I>&gt;<i> Using the configuration described here, the LOGFILE will be created as 
</I>&gt;<i> user &quot;root&quot; and group &quot;root&quot;, but rotated as user UID and group GID.  
</I>&gt;<i> If you want rotation to work as advertised it is necessary to put the 
</I>&gt;<i> LOGFILE in a directory in which UID/GID has permissions to rename files.
</I>&gt;<i>
</I>
and

&gt;<i>     def rotate(self):
</I>&gt;<i>         &quot;&quot;&quot;
</I>&gt;<i>         Rotate the file and create a new one.
</I>&gt;<i>
</I>&gt;<i>         If it's not possible to open new logfile, this will fail silently,
</I>&gt;<i>         and continue logging to old logfile.
</I>&gt;<i>         &quot;&quot;&quot;
</I>&gt;<i>         if not (os.access(self.directory, os.W_OK) and 
</I>&gt;<i> os.access(self.path, os.W_OK)):
</I>&gt;<i>             return
</I>(twisted 14.0.0)

will never work together. Even if the user twistd runs as is technically 
able to rename the log file (due to having write permissions on the 
directory), it will never try to since it can't write to the file.
There is a workaround on a comment in [1] but that's a really 
unnecessary and hacky solution, IMHO.

Is this a known bug?
I remember running into this issue a year ago or so and IIRC I just gave up.


Thanks for any pointers,
max

[1]
<A HREF="http://www.tsheffler.com/blog/?p=526">http://www.tsheffler.com/blog/?p=526</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20140611/486447a9/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60874">[ date ]</a>
              <a href="thread.html#60874">[ thread ]</a>
              <a href="subject.html#60874">[ subject ]</a>
              <a href="author.html#60874">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
