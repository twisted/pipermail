<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] send-msearch on all network interfaces of a machine
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20send-msearch%20on%20all%20network%20interfaces%20of%20a%20machine&In-Reply-To=%3CCAHNg1So%2BNr30HPhtn5yCF5CQHn5b4x7Z%2BffMG-8ZQ%2BoqKqJnJw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="060880.html">
   <LINK REL="Next"  HREF="060888.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] send-msearch on all network interfaces of a machine</H1>
    <B>Pratik Prajapati</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20send-msearch%20on%20all%20network%20interfaces%20of%20a%20machine&In-Reply-To=%3CCAHNg1So%2BNr30HPhtn5yCF5CQHn5b4x7Z%2BffMG-8ZQ%2BoqKqJnJw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] send-msearch on all network interfaces of a machine">pratik.prajapati12 at gmail.com
       </A><BR>
    <I>Sat Jun 14 06:48:36 MDT 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="060880.html">[Twisted-Python] Trouble with Record_TXT
</A></li>
        <LI>Next message (by thread): <A HREF="060888.html">[Twisted-Python] send-msearch on all network interfaces of a machine
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28426">[ date ]</a>
              <a href="thread.html#28426">[ thread ]</a>
              <a href="subject.html#28426">[ subject ]</a>
              <a href="author.html#28426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am implementing a code through which i have to get devices connected to
all network interfaces on my machine and list them .

For this, i am first getting the ip of all network interfaces and then
sending m-search command on them.

After 2.5 seconds port is stopped to listen.

But it is giving me some assertion error. (I am connected to 2 interfaces
-ethernet and wifi)

`Code:`

    class Base(DatagramProtocol):
        &quot;&quot;&quot; Class to send M-SEARCH message to devices in network and
receive datagram
            packets from them
        &quot;&quot;&quot;
        SSDP_ADDR = &quot;239.255.255.250&quot;
        SSDP_PORT = 1900
        MS = &quot;M-SEARCH * HTTP/1.1\r\nHOST: {}:{}\r\nMAN:
'ssdp:discover'\r\nMX: 2\r\nST: ssdp:all\r\n\r\n&quot;.format(SSDP_ADDR,
SSDP_PORT)

    def sendMsearch(self):
        &quot;&quot;&quot; Sending M-SEARCH message
        &quot;&quot;&quot;
        ports = []
        for address in self.addresses:
            ports.append(reactor.listenUDP(0, self, interface=address))

        for port in ports:
            for num in range(4):
                port.write(Base.MS, (Base.SSDP_ADDR,Base.SSDP_PORT))
            reactor.callLater(2.5, self.stopMsearch, port) # MX + a wait
margin


    def stopMsearch(self, port):
        &quot;&quot;&quot; Stop listening on port
        &quot;&quot;&quot;
        port.stopListening()


`Error:`
    Traceback (most recent call last):
  File &quot;work\find_devices.py&quot;, line 56, in sendMsearch
 ports.append(reactor.listenUDP(0, self, interface=address))
  File &quot;C:\Python27\lib\site-packages\twisted\internet\posixbase.py&quot;, line
374, in listenUDP
 p.startListening()
  File &quot;C:\Python27\lib\site-packages\twisted\internet\udp.py&quot;, line 172,
in startListening
 self._connectToProtocol()
  File &quot;C:\Python27\lib\site-packages\twisted\internet\udp.py&quot;, line 210,
in _connectToProtocol
 self.protocol.makeConnection(self)
  File &quot;C:\Python27\lib\site-packages\twisted\internet\protocol.py&quot;, line
709, in makeConnection
 assert self.transport == None
AssertionError



This code worked:

def sendMsearch(self):
        &quot;&quot;&quot; Sending M-SEARCH message
        &quot;&quot;&quot;
        address = socket.gethostbyname(socket.gethostbyname())
        port = reactor.listenUDP(0, self, interface=address)
        for num in range(4):
                port.write(Base.MS, (Base.SSDP_ADDR,Base.SSDP_PORT))
        reactor.callLater(2.5, self.stopMsearch, port) # MX + a wait margin




Please tell what's wrong in code mentioned in the start of this mail and
how to correct this.

I have also posted this code on stackoverflow , but didn't get any response
<A HREF="http://stackoverflow.com/questions/24178580/send-m-search-packets-on-all-network-interfaces-using-twisted-module-in-python">http://stackoverflow.com/questions/24178580/send-m-search-packets-on-all-network-interfaces-using-twisted-module-in-python</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20140614/9f337317/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20140614/9f337317/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="060880.html">[Twisted-Python] Trouble with Record_TXT
</A></li>
	<LI>Next message (by thread): <A HREF="060888.html">[Twisted-Python] send-msearch on all network interfaces of a machine
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28426">[ date ]</a>
              <a href="thread.html#28426">[ thread ]</a>
              <a href="subject.html#28426">[ subject ]</a>
              <a href="author.html#28426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
