<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted 16.3.0 Prerelease 2 Announcement
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%2016.3.0%20Prerelease%202%20Announcement&In-Reply-To=%3CCAO38UCmRu6PE0ZL9X637vd9sFrajhvhQ3WNSAt7oB%3DRTuBWLdA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030550.html">
   <LINK REL="Next"  HREF="030554.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted 16.3.0 Prerelease 2 Announcement</H1>
    <B>Pawe&#322; Miech</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%2016.3.0%20Prerelease%202%20Announcement&In-Reply-To=%3CCAO38UCmRu6PE0ZL9X637vd9sFrajhvhQ3WNSAt7oB%3DRTuBWLdA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Twisted 16.3.0 Prerelease 2 Announcement">pawelmhm at gmail.com
       </A><BR>
    <I>Mon Jul 11 15:04:10 MDT 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="030550.html">[Twisted-Python] Twisted 16.3.0 Prerelease 2 Announcement
</A></li>
        <LI>Next message: <A HREF="030554.html">[Twisted-Python] Twisted 16.3.0 Prerelease 2 Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30551">[ date ]</a>
              <a href="thread.html#30551">[ thread ]</a>
              <a href="subject.html#30551">[ subject ]</a>
              <a href="author.html#30551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for input everyone!

@Cory

&gt;<i> right now it seems like the only thing we could do is detect when HTTP/2
</I>is literally impossible to support (e.g. when there is no TLS 1.2 support)

This seems to suggest that Ubuntu 16.04 (the system I'm testing) does not
support ciphers required by HTTP2. But nginx article about HTTP2 lists
ubuntu as only linux like system that is able to support HTTP2 over ALPN
which is required by Chrome:
<A HREF="https://www.nginx.com/blog/supporting-http2-google-chrome-users/">https://www.nginx.com/blog/supporting-http2-google-chrome-users/</A>

I decided to verify tnginx statements and I tried to set up nginx with
HTTP2 on ubuntu 16.04. It turns out this is possible and it works ok. I
just followed this article here:
<A HREF="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-with-http-2-support-on-ubuntu-16-04">https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-with-http-2-support-on-ubuntu-16-04</A>
This means that in principle Ubuntu 16.04 should be able to support HTTP2
and it has required TLS ciphers.

So the problem here is not about lack of OS support.

Looking into this nginx article they recommend two things that are part of
manual setup which (maybe?) are required?

1) They say ciphers should be set to ssl_ciphers
EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;

This long string does not mean much to me, but reading email from Amber
again I see it differs slightly from what she says Twisted uses. But one
thing I'm wondering about is how do you guys know which ciphers are set in
Twisted? Looking into source code of DefaultOpenSSLContextFactory I see
context is created here:
<A HREF="https://github.com/twisted/twisted/blob/3455a902fb15e732ee43b59f4d82a66b105351ba/twisted/internet/ssl.py#L107">https://github.com/twisted/twisted/blob/3455a902fb15e732ee43b59f4d82a66b105351ba/twisted/internet/ssl.py#L107</A>
I dont see any point where there is a call that sets ciphers. Maybe this is
done somewhere else? I tried grepping source for string mentioned by Amber
but cant find it.

2) they ask user to generate DHE key and provide this to nginx
configuration.

When I compare my nginx with Twisted using openssl I see that ciphers in
response differ.

For example this is what my nginx cipher is:

&gt;<i> openssl s_client -connect localhost:443
</I>...
...
...
New, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES128-GCM-SHA256

And here is cipher for Twisted

&gt;<i> openssl s_client -connect localhost:8080
</I>
New, TLSv1/SSLv3, Cipher is AES256-GCM-SHA384

When I check HTTP2 cipher black list I see AES256-GCM-SHA384 is there on
this list see here <A HREF="https://http2.github.io/http2-spec/#BadCipherSuites">https://http2.github.io/http2-spec/#BadCipherSuites</A>





2016-07-11 21:22 GMT+02:00 Glyph Lefkowitz &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;:

&gt;<i>
</I>&gt;<i> On Jul 11, 2016, at 3:35 AM, Cory Benfield &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">cory at lukasa.co.uk</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 11 Jul 2016, at 01:45, Glyph Lefkowitz &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Jul 9, 2016, at 10:30 AM, Pawe&#322; Miech &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">pawelmhm at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> My question is: should user deal with this kind of stuff themselves? If
</I>&gt;<i> some ciphers are blacklisted in HTTP2 shouldn't this be handled somewhere
</I>&gt;<i> in Twisted?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> As others have already said, this *should* work out of the box, and I'm
</I>&gt;<i> not sure why it isn't for you, especially that you've gone to the extra
</I>&gt;<i> trouble of building a Docker image and retrieving recent enough versions of
</I>&gt;<i> every relevant layer of the stack.
</I>&gt;<i>
</I>&gt;<i> However, to answer this question generally: this should *absolutely* be
</I>&gt;<i> handled by Twisted.  In fact, even if we're doing the right thing already
</I>&gt;<i> except in your one configuration, we should go a step beyond and provide
</I>&gt;<i> tooling and logging to clearly explain to system operators why they won't
</I>&gt;<i> get HTTP/2 if their dependencies are out of date.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This turns out to be trickier than you&#8217;d expect.
</I>&gt;<i>
</I>&gt;<i> PyOpenSSL does not expose any of the APIs for us to programmatically
</I>&gt;<i> detect what ciphers are available to the OpenSSL we have installed.
</I>&gt;<i> Cryptography exposes only one: SSL_get_ciphers. This is not really the one
</I>&gt;<i> we want, because it lists all *possible* ciphers, rather than the ones that
</I>&gt;<i> are actually enabled for a given connection. This makes it very difficult
</I>&gt;<i> for us to conclude that we&#8217;d want to use HTTP/2 but we cannot because of a
</I>&gt;<i> lack of cipher support.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So pyOpenSSL/Cryptography doesn't have SSL_get_current_cipher anywhere?
</I>&gt;<i>
</I>&gt;<i> Now, Twisted *could* add code to introspect the HTTP/2 TLS configuration
</I>&gt;<i> and optionally terminate the connection in the same manner that Chrome
</I>&gt;<i> does. Currently I&#8217;ve not done that because it&#8217;s not been hugely needed, but
</I>&gt;<i> we could do that. The reality is, though, that Twisted can&#8217;t
</I>&gt;<i> unconditionally not use those ciphers because it needs to support HTTP/1.1
</I>&gt;<i> as well as HTTP/2, and HTTP/1.1 does not have those same restrictions.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The main interest I think we have is to placate Chrome, to ensure it can
</I>&gt;<i> speak HTTP/2 if it's possible, and to explain why it's not possible, if
</I>&gt;<i> it's not.
</I>&gt;<i>
</I>&gt;<i> What would be looking for here? Out of the box, Twisted should do the very
</I>&gt;<i> best it can, but right now it seems like the only thing we could do is
</I>&gt;<i> detect when HTTP/2 is literally impossible to support (e.g. when there is
</I>&gt;<i> no TLS 1.2 support). With that said, those versions *completely* overlap
</I>&gt;<i> with the versions where OpenSSL doesn&#8217;t support ALPN.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In the same way that we complain about service_identity perhaps we should
</I>&gt;<i> complain about OpenSSL?
</I>&gt;<i>
</I>&gt;<i> Regardless, Twisted&#8217;s default cipher ordering is appropriate for HTTP/2
</I>&gt;<i> (it prefers ECDHE AES GCM, which is what is required). So I&#8217;m not sure what
</I>&gt;<i> more we could do.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yeah, I'm curious why the OP was having this problem.
</I>&gt;<i>
</I>&gt;<i> -glyph
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20160711/ff1a3fa4/attachment-0001.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20160711/ff1a3fa4/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030550.html">[Twisted-Python] Twisted 16.3.0 Prerelease 2 Announcement
</A></li>
	<LI>Next message: <A HREF="030554.html">[Twisted-Python] Twisted 16.3.0 Prerelease 2 Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30551">[ date ]</a>
              <a href="thread.html#30551">[ thread ]</a>
              <a href="subject.html#30551">[ subject ]</a>
              <a href="author.html#30551">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
