<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Parameters of	twisted.internet.interfaces.ITLSTransport [Was: Re: Request	for help with Twisted bindings in M2Crypto]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Parameters%20of%0A%09twisted.internet.interfaces.ITLSTransport%20%5BWas%3A%20Re%3A%20Request%0A%09for%20help%20with%20Twisted%20bindings%20in%20M2Crypto%5D&In-Reply-To=%3C517A02D1-67EE-4E92-8EA8-A5DFA859C5D4%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063096.html">
   <LINK REL="Next"  HREF="063102.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Parameters of	twisted.internet.interfaces.ITLSTransport [Was: Re: Request	for help with Twisted bindings in M2Crypto]</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Parameters%20of%0A%09twisted.internet.interfaces.ITLSTransport%20%5BWas%3A%20Re%3A%20Request%0A%09for%20help%20with%20Twisted%20bindings%20in%20M2Crypto%5D&In-Reply-To=%3C517A02D1-67EE-4E92-8EA8-A5DFA859C5D4%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Parameters of	twisted.internet.interfaces.ITLSTransport [Was: Re: Request	for help with Twisted bindings in M2Crypto]">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Jul 26 00:28:23 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063096.html">[Twisted-Python] Parameters of twisted.internet.interfaces.ITLSTransport [Was: Re: Request for help with Twisted bindings in M2Crypto]
</A></li>
        <LI>Next message (by thread): <A HREF="063102.html">[Twisted-Python] Request for help with Twisted bindings in	M2Crypto
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63100">[ date ]</a>
              <a href="thread.html#63100">[ thread ]</a>
              <a href="subject.html#63100">[ subject ]</a>
              <a href="author.html#63100">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Jul 25, 2016, at 16:02, Matěj Cepl &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mcepl at cepl.eu</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On 2016-07-25, 09:33 GMT, Craig Rodrigues wrote:
</I>&gt;&gt;<i> Earlier this year, I contributed lots of patches to you in M2Crypto to port
</I>&gt;&gt;<i> it to py3k.
</I>&gt;&gt;<i> Now I have shifted efforts to Twisted, where in the past month I have
</I>&gt;&gt;<i> contributed hundreds of patches to help improve py3k support in Twisted.
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> can I for a piece of advice on the documentation.
</I>&gt;<i> M2Crypto.SSL.TwistedProtocolWrapper.TLSProtocolWrapper.startTLS
</I>&gt;<i> implements ITLSTransport.startTLS interace method, which first parameter
</I>&gt;<i> is called ``ctx`` and in `the current implementation in M2Crypto`_ it is of
</I>&gt;<i> type control of SSL Context (that's M2Crypto.SSL.Context.Context) or
</I>&gt;<i> whether it is factory generating such Contexts (which is what
</I>&gt;<i> <A HREF="https://twistedmatrix.com/documents/current/api/twisted.internet._newtls.ConnectionMixin.html">https://twistedmatrix.com/documents/current/api/twisted.internet._newtls.ConnectionMixin.html</A>
</I>&gt;<i> says, at least I understand it in this way). Is my current
</I>&gt;<i> implementation wrong?
</I>
Technically speaking, your implementation is wrong because it claims to implement &lt;<A HREF="https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.interfaces.ITLSTransport.html">https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.interfaces.ITLSTransport.html</A>&gt;, which documents the method startTLS &lt;<A HREF="https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.interfaces.ITLSTransport.html#startTLS">https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.interfaces.ITLSTransport.html#startTLS</A>&gt; to accept a `contextFactory´ which is a provider of either &lt;<A HREF="https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.interfaces.IOpenSSLClientConnectionCreator.html">https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.interfaces.IOpenSSLClientConnectionCreator.html</A>&gt; or &lt;<A HREF="https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.interfaces.IOpenSSLServerConnectionCreator.html">https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.interfaces.IOpenSSLServerConnectionCreator.html</A>&gt;.  Both of these interfaces return pyOpenSSL-specific objects.  If you want to do TLS with M2Crypto, you must therefore give up on supporting any of Twisted's interfaces directly, because (for example) optionsForClientTLS &lt;<A HREF="https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.ssl.html#optionsForClientTLS">https://twistedmatrix.com/documents/16.3.0/api/twisted.internet.ssl.html#optionsForClientTLS</A>&gt; is not going to work with your implementation, since you don't call clientConnectionForTLS on it.

If you want to provide TLS purely with M2Crypto, then you should have interfaces which describe exactly how it should work with M2Crypto.  You can make it take a concrete context if you want, or a factory, whichever makes sense for how you're going to set it up.  Personally my recommendation would be to go in the direction that Twisted itself has been moving and pass a thing that can create Connection objects (or, in OpenSSL-speak, an &quot;SSL*&quot;, or in M2Crypto, an _SSLProxy(ssl_new())).  No existing Twisted code which is going to call startTLS() can be made to work with these interfaces without extensive monkey-patching, and even then, anything which expects to be able to cut in at the OpenSSL layer will break.

Basically, Twisted doesn't have a mechanism for abstracting away the TLS backend yet.  I'd really like it if it did!  If you want M2Crypto to be able to do what it's currently trying to do, you could contribute code to Twisted to make things like optionsForClientTLS more abstract, and to isolate the TLS implementation more closely to the TLS wrapper factory.  This would make it easier to adopt Cryptography's TLS API eventually, which is what we'll need to do as pyOpenSSL eventually becomes less relevant.

This is still several years away, of course.  But it would be nice to have some help getting there in advance.

-glyph

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063096.html">[Twisted-Python] Parameters of twisted.internet.interfaces.ITLSTransport [Was: Re: Request for help with Twisted bindings in M2Crypto]
</A></li>
	<LI>Next message (by thread): <A HREF="063102.html">[Twisted-Python] Request for help with Twisted bindings in	M2Crypto
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63100">[ date ]</a>
              <a href="thread.html#63100">[ thread ]</a>
              <a href="subject.html#63100">[ subject ]</a>
              <a href="author.html#63100">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
