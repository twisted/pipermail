<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Request for help with Twisted bindings in	M2Crypto
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Request%20for%20help%20with%20Twisted%20bindings%20in%0A%09M2Crypto&In-Reply-To=%3C20160726154710.GC7233%40mitmanek.redhat.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030644.html">
   <LINK REL="Next"  HREF="030635.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Request for help with Twisted bindings in	M2Crypto</H1>
    <B>Mat&#283;j Cepl</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Request%20for%20help%20with%20Twisted%20bindings%20in%0A%09M2Crypto&In-Reply-To=%3C20160726154710.GC7233%40mitmanek.redhat.com%3E"
       TITLE="[Twisted-Python] Request for help with Twisted bindings in	M2Crypto">mcepl at cepl.eu
       </A><BR>
    <I>Tue Jul 26 09:47:10 MDT 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="030644.html">[Twisted-Python] Request for help with Twisted bindings in	M2Crypto
</A></li>
        <LI>Next message: <A HREF="030635.html">[Twisted-Python] Parameters of twisted.internet.interfaces.ITLSTransport [Was: Re: Request for help with Twisted bindings in M2Crypto]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30647">[ date ]</a>
              <a href="thread.html#30647">[ thread ]</a>
              <a href="subject.html#30647">[ subject ]</a>
              <a href="author.html#30647">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2016-07-25, 09:55 GMT, Craig Rodrigues wrote:
First of all, thank you very much for all help you gave to 
M2Crypto. However, ...

&gt;<i> I call shenanigans on you.
</I>
Nothing of which I have been accused of has anything to do with 
what I meant. When I said &#8222;opaque&#8220;, I didn&#8217;t mean to offend 
Twisted. Just to say, that while I was marking whole library 
with PEP-484 type hints, I usually dealt with bytes, str, ints, 
and very few rather simple objects. With Twisted I get object

    @implementer(ITLSTransport)
    class TLSProtocolWrapper(ProtocolWrapper):
        def __init__(self, factory, wrappedProtocol, 
                     startPassThrough, client,
                     contextFactory, postConnectionCheck):
            # type: policies.WrappingFactory, object, int, int, object, Checker

(and with those two objects, I don't even dare to guess what 
types these are, and all that covered in some weird decorator 
from Zope (?)).

That's nothing wrong with Twisted, just that it is really 
difficult for idiot like me to understand what's going on.

&gt;<i> If you are unfamiliar with Twisted's code and data types, and 
</I>&gt;<i> don't have the energy to dig in, then be honest about that, 
</I>&gt;<i> but don't accuse Twisted of being &quot;opaque&quot;, because it isn't.
</I>
I don't think what's dishonest on saying that Twisted API is 
quite complicated and I am stupid enough not understanding 
what's going on.

&gt;<i> Regarding your code example which is failing,
</I>&gt;<i> your code is failing because you are intermixing bytes and strings which is
</I>&gt;<i> a big no-no for Python 3.
</I>
Of course I know that (it is not the first place where I have to 
deal with bytes &#215; str dichotomy in py3k), but in order to 
understand what's going, I have to first understand where these 
values come from and where they run to, i.e., to decipher 
Twisted. Thus I was asking for help.

&gt;<i> If I look at this line for example:
</I>&gt;<i> <A HREF="https://gitlab.com/m2crypto/m2crypto/blob/master/M2Crypto/SSL/TwistedProtocolWrapper.py#L357">https://gitlab.com/m2crypto/m2crypto/blob/master/M2Crypto/SSL/TwistedProtocolWrapper.py#L357</A>
</I>&gt;<i>
</I>&gt;<i> I see the code is doing stuff like:
</I>&gt;<i>    data = ''
</I>&gt;<i>    encryptedData = ''
</I>&gt;<i>
</I>&gt;<i> Those are of type str, and need to be of type bytes:
</I>&gt;<i>
</I>&gt;<i>    data = b''
</I>&gt;<i>    encryptedData = b''
</I>&gt;<i>
</I>&gt;<i> You need to clean stuff like that up in your code so that you are only
</I>&gt;<i> using bytes.
</I>
I believe I have fixed all I can do without actually 
understanding Twisted in 
<A HREF="https://gitlab.com/mcepl/m2crypto/commit/6cd5f87b31e50016ebb7e44f3f2ae46610bc24e0.">https://gitlab.com/mcepl/m2crypto/commit/6cd5f87b31e50016ebb7e44f3f2ae46610bc24e0.</A>  
So now, if Twisted is so transparent and perfectly 
understandable, could you please suggest, what I do wrong, that 
the test ends in the endless loop 
(<A HREF="https://travis-ci.org/mcepl/M2Crypto/builds/147175901">https://travis-ci.org/mcepl/M2Crypto/builds/147175901</A>)?

Thank you,

Mat&#283;j Cepl

-- 
<A HREF="https://matej.ceplovi.cz/blog/,">https://matej.ceplovi.cz/blog/,</A> Jabber: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mcepl at ceplovi.cz</A>
GPG Finger: 3C76 A027 CA45 AD70 98B5  BC1D 7920 5802 880B C9D8
 
Never ascribe to malice that which is adequately explained by
stupidity.
    -- Napoleon Bonaparte (or many other people to whom this
       quote is ascribed)

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: not available
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20160726/0a218800/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-python/attachments/20160726/0a218800/attachment.pgp</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030644.html">[Twisted-Python] Request for help with Twisted bindings in	M2Crypto
</A></li>
	<LI>Next message: <A HREF="030635.html">[Twisted-Python] Parameters of twisted.internet.interfaces.ITLSTransport [Was: Re: Request for help with Twisted bindings in M2Crypto]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30647">[ date ]</a>
              <a href="thread.html#30647">[ thread ]</a>
              <a href="subject.html#30647">[ subject ]</a>
              <a href="author.html#30647">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
