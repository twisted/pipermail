<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Coverage exceptions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Coverage%20exceptions&In-Reply-To=%3C78DF920E-B059-4369-BDA5-AA65319BF692%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="030501.html">
   <LINK REL="Next"  HREF="062971.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Coverage exceptions</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Coverage%20exceptions&In-Reply-To=%3C78DF920E-B059-4369-BDA5-AA65319BF692%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Coverage exceptions">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Jul  1 00:29:07 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="030501.html">[Twisted-Python] Coverage exceptions
</A></li>
        <LI>Next message (by thread): <A HREF="062971.html">[Twisted-Python] Coverage exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62963">[ date ]</a>
              <a href="thread.html#62963">[ thread ]</a>
              <a href="subject.html#62963">[ subject ]</a>
              <a href="author.html#62963">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Jun 30, 2016, at 18:37, Craig Rodrigues &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rodrigc at crodrigues.org</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> The conversation about coverage exceptions came up due to this:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://github.com/twisted/twisted/pull/261">https://github.com/twisted/twisted/pull/261</A> &lt;<A HREF="https://github.com/twisted/twisted/pull/261">https://github.com/twisted/twisted/pull/261</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> I have that up to 97.87% of patch coverage.  I cannot merge it because the codecov integration with GitHub
</I>&gt;<i> is currently configured to not accept patches which don't have 100% patch coverage.
</I>&gt;<i> 
</I>&gt;<i> Can someone please take a look at that, and make a decision as to how to move that PR forward?
</I>&gt;<i> Thanks.
</I>
The problematic lines in question on this PR are here:

<A HREF="https://codecov.io/gh/twisted/twisted/compare/f43b16c097309d9747a0c1e708bd4ed05a6977e8...8a22bd8c626c8e496b9564879d85eb711e2bc408#747769737465642F746573742F746573745F64656665722E7079-2360">https://codecov.io/gh/twisted/twisted/compare/f43b16c097309d9747a0c1e708bd4ed05a6977e8...8a22bd8c626c8e496b9564879d85eb711e2bc408#747769737465642F746573742F746573745F64656665722E7079-2360</A>

In this case, the fix to ensure they're covered is pretty easy.  The problem here is essentially a defect in the test: it's returning a Deferred from the test method to spin the reactor, even though the test has already done the work of isolating the system under test from the real reactor (self.lock is pointed at self._clock and a glance at the implementation shows it doesn't access the global reactor).

If you just fix the test to call self.successResultOf(d) after advancing the Clock to assert that it didn't fail, you can stop returning the Deferred, and remove the problematic un-covered callback.

More generally - although the ability to return a Deferred from a test is a very useful bit of integration testing functionality, tests within Twisted itself returning Deferreds are usually just insufficiently isolated.  We have a different way of doing integration tests with the reactors themselves (ReactorBuilder tests) which doesn't rely on returning Deferreds, and we don't have any tightly-coupled external systems like a database which it would make sense to rely upon in tests, so pretty much everything should be synchronous in our own test suite.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20160630/94286bbb/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="030501.html">[Twisted-Python] Coverage exceptions
</A></li>
	<LI>Next message (by thread): <A HREF="062971.html">[Twisted-Python] Coverage exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62963">[ date ]</a>
              <a href="thread.html#62963">[ thread ]</a>
              <a href="subject.html#62963">[ subject ]</a>
              <a href="author.html#62963">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
