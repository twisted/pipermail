<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Waiting time for tests running on Travis CI	and Buildbot
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Waiting%20time%20for%20tests%20running%20on%20Travis%20CI%0A%09and%20Buildbot&In-Reply-To=%3CF7E1E702-694C-46AC-A705-9FFE713884BD%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="030718.html">
   <LINK REL="Next"  HREF="063186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Waiting time for tests running on Travis CI	and Buildbot</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Waiting%20time%20for%20tests%20running%20on%20Travis%20CI%0A%09and%20Buildbot&In-Reply-To=%3CF7E1E702-694C-46AC-A705-9FFE713884BD%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Waiting time for tests running on Travis CI	and Buildbot">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Aug 14 17:10:13 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="030718.html">[Twisted-Python] Waiting time for tests running on Travis CI and	Buildbot
</A></li>
        <LI>Next message (by thread): <A HREF="063186.html">[Twisted-Python] Waiting time for tests running on Travis CI	and Buildbot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63181">[ date ]</a>
              <a href="thread.html#63181">[ thread ]</a>
              <a href="subject.html#63181">[ subject ]</a>
              <a href="author.html#63181">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Aug 14, 2016, at 3:38 AM, Adi Roiban &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> We now have 5 concurrent jobs on Travis-CI for the whole Twisted organization.
</I>&gt;<i> 
</I>&gt;<i> If we want to reduce the waste of running push tests for a PR we
</I>&gt;<i> should check that the other repos from the Twisted organization are
</I>&gt;<i> doing the same.
</I>&gt;<i> 
</I>&gt;<i> We now have in twisted/twisted 9 jobs per each build ... and for each
</I>&gt;<i> push to a PR ... we run the tests for the push and for the PR merge...
</I>&gt;<i> so those are 18 jobs for a commit.
</I>&gt;<i> 
</I>&gt;<i> twisted/mantisa has 7 jobs per build, twisted/epsilon 3 jobs per
</I>&gt;<i> build, twisted/nevow 14 jobs, twisted/axiom 6 jobs, twisted/txmongo 16
</I>&gt;<i> jobs
</I>&gt;<i> 
</I>&gt;<i> .... so we are a bit over the limit of 5 jobs
</I>
Well, we're not &quot;over the limit&quot;.  It's just 5 concurrent.  Most of the projects that I work on have more than 5 entries in their build matrix.

&gt;<i> I have asked Travis-CI how we can improve the waiting time for
</I>&gt;<i> twisted/twisted jobs and for $6000 per year they can give us 15
</I>&gt;<i> concurrent jobs for the Twisted organization.
</I>&gt;<i> 
</I>&gt;<i> This will not give us access to a faster waiting line for the OSX jobs.
</I>&gt;<i> 
</I>&gt;<i> Also, I don't think that we can have twisted/twisted take priority
</I>&gt;<i> inside the organization.
</I>&gt;<i> 
</I>&gt;<i> If you think that we can raise $6000 per year for sponsoring our
</I>&gt;<i> Travis-CI and that is worth increasing the queue size I can follow up
</I>&gt;<i> with Travis-CI.
</I>
I think that this is definitely worth doing.

&gt;<i> I have also asked Circle CI for a free ride on their OSX builders, but
</I>&gt;<i> it was put on hold as Glyph told me that Circe CI is slower than
</I>&gt;<i> Travis.
</I>&gt;<i> 
</I>&gt;<i> I have never used Circle CI. If you have a good experience with OSX on
</I>&gt;<i> Circle CI I can continue the phone interview with Circle Ci so that we
</I>&gt;<i> get the free access and see how it goes.
</I>
The reason I'm opposed to Circle is simply that their idiom for creating a build matrix is less parallelism-friendly than Travis.  Travis is also more popular, so more contributors will be interested in participating.

&gt;<i> There are multiple ways in which we can improve the time a test takes
</I>&gt;<i> to run on Travis-CI, but it will never be faster than buildbot with a
</I>&gt;<i> slave which is always active and ready to start a job in 1 second and
</I>&gt;<i> which already has 99% of the virtualev dependencies already installed.
</I>
There's a lot that we can do to make Travis almost that fast, with pre-built Docker images and cached dependencies.  We haven't done much in the way of aggressive optimization yet.  As recently discussed we're still doing twice as many builds as we need to just because we've misconfigured branch / push builds :).

&gt;<i> AFAIK the main concern with buildot, is that the slaves are always
</I>&gt;<i> running so a malicious person could create a PR with some malware and
</I>&gt;<i> then all our slaves will execute that malware.
</I>
Not only that, but the security between the buildmaster and the builders themselves is weak.  Now that we have the buildmaster on a dedicated machine, this is less of a concern, but it still has access to a few secrets (an SSL private key, github oauth tokens) which we would rather not leak if we can avoid it.

&gt;<i> One way to mitigate this, is to use latent buildslaves and stop and
</I>&gt;<i> reset a slave after each build, but this will also slow the build and
</I>&gt;<i> lose the virtualenv ... which of docker based slave should not be a
</I>&gt;<i> problem... but if we want Windows latent slaves it might increase the
</I>&gt;<i> build time.
</I>
It seems like fully latent slaves would be slower than Travis by a lot, since Travis is effectively doing the same thing, but they have a massive economy of scale with pre-warmed pre-booted VMs that they can keep in a gigantic pool and share between many different projects.

&gt;<i> What do you say if we protect our buildslaves with a firewall which
</I>&gt;<i> only allows outgoing connections to buildmaster and github ... and
</I>&gt;<i> have the slaves running only on RAX + Azure to simplify the firewall
</I>&gt;<i> configuration?
</I>&gt;<i> 
</I>&gt;<i> Will a malicious person still be interested of exploiting the slaves?
</I>&gt;<i> 
</I>&gt;<i> I would be happy to help with buildbot configuration as I think that
</I>&gt;<i> for TDD, buildbot_try with slaves which are always connected and
</I>&gt;<i> virtualenv already created is the only acceptable CI system.
</I>

Personally, I just want to stop dealing with so much administrative overhead.  I am willing to wait for slightly longer build times in order to do that.  Using Travis for everything means we don't need to worry about these issues, or have these discussions; we can just focus on developing Twisted, and have sponsors throw money at the problem.  There's also the issue that deploying new things to the buildmaster will forever remain a separate permission level, but proposing changes to the travis configuration just means sending a PR.

There are things we could do to reduce both overhead and the risk impact further though.  For example, we could deploy buildbot as a docker container instead of as a VM, making it much faster to blow away the VM if we have a security problem, and limiting its reach even more.

On the plus side, it would be nice to be dogfooding Twisted as part of our CI system, and buildbot uses it heavily.  So while I think overall the tradeoffs are in favor of travis, I wouldn't say that I'm 100% in favor.  And _most_ of the things we used to need a buildbot config change for now are just tox environment changes; if we can move to 99% of the job configuration being in tox.ini as opposed to the buildmaster, that would eliminate another objection.

I'd also be interested in hearing from as many contributors as possible about this though.  The point of all of this is to make contributing easier and more enjoyable, so the majority opinion is kind of important here :).

-glyph



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="030718.html">[Twisted-Python] Waiting time for tests running on Travis CI and	Buildbot
</A></li>
	<LI>Next message (by thread): <A HREF="063186.html">[Twisted-Python] Waiting time for tests running on Travis CI	and Buildbot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63181">[ date ]</a>
              <a href="thread.html#63181">[ thread ]</a>
              <a href="subject.html#63181">[ subject ]</a>
              <a href="author.html#63181">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
