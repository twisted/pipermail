<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] RFC: IPv6 multicast join/ticket 6597
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20RFC%3A%20IPv6%20multicast%20join/ticket%206597&In-Reply-To=%3CCAARXrPnuZKq%3DoCD%3DZDQY2WuXgf7HvY%2BD8oe8-nbksO7QitBOFQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030675.html">
   <LINK REL="Next"  HREF="030678.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] RFC: IPv6 multicast join/ticket 6597</H1>
    <B>Jason Litzinger</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20RFC%3A%20IPv6%20multicast%20join/ticket%206597&In-Reply-To=%3CCAARXrPnuZKq%3DoCD%3DZDQY2WuXgf7HvY%2BD8oe8-nbksO7QitBOFQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] RFC: IPv6 multicast join/ticket 6597">jlitzingerdev at gmail.com
       </A><BR>
    <I>Thu Aug  4 22:29:23 MDT 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="030675.html">[Twisted-Python] RFC: IPv6 multicast join/ticket 6597
</A></li>
        <LI>Next message: <A HREF="030678.html">[Twisted-Python] RFC: IPv6 multicast join/ticket 6597
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30676">[ date ]</a>
              <a href="thread.html#30676">[ thread ]</a>
              <a href="subject.html#30676">[ subject ]</a>
              <a href="author.html#30676">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> By default, the &quot;multicast&quot; flag is not enabled for the loopback interface
</I>&gt;<i> on Linux. Does running &quot;ip link set dev lo multicast on&quot; help here?
</I>&gt;<i> (Although requiring this would then be rather problematic for testing, as
</I>&gt;<i> doing this in containerized environments and restricted environments like
</I>&gt;<i> Travis is presumably impossible)
</I>It didn't seem to.  Despite the subject, I'll focus on the existing,
IPv4 tests, rather than the new tests I'm writing (to eliminate any
issues in my code, though the change didn't help there either).

When I run with at least one interface up, my results for `./bin/trial
twisted` at SHA baba4c661a6606a56d8dab053cfe7b336a3c593e are:
PASSED (skips=2140, successes=9472)

When I take disconnect my wireless, and manually take down my lxr
interface, `ip link` shows:
1: lo: &lt;LOOPBACK,MULTICAST,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state
UNKNOWN mode DEFAULT group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: enp1s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc
pfifo_fast state DOWN mode DEFAULT group default qlen 1000
    link/ether &lt;removed&gt; brd ff:ff:ff:ff:ff:ff
3: wlp2s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state
DOWN mode DORMANT group default qlen 1000
    link/ether &lt;removed&gt; brd ff:ff:ff:ff:ff:ff
4: lxcbr0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noqueue state DOWN
mode DEFAULT group default qlen 1000
    link/ether &lt;removed&gt; brd ff:ff:ff:ff:ff:ff

And the results of `./bin/trial` are:
FAILED (skips=2212, failures=3, errors=8, successes=9393)

Specific to multicast, one of the errors is:
Traceback (most recent call last):
Failure: twisted.internet.error.MulticastJoinError:
('\xe1\x00\x00\xfa', '\x00\x00\x00\x00', 19, 'No such device')

twisted.test.test_udp.MulticastTests.test_multicast

However, I can eliminate the error for test_multicast with the
following patch, and this works even when multicast is not explicitly
enabled on the loopback.

diff --git a/twisted/test/test_udp.py b/twisted/test/test_udp.py
index 6cf4583..79fd9d0 100644
--- a/twisted/test/test_udp.py
+++ b/twisted/test/test_udp.py
@@ -623,10 +623,10 @@ class MulticastTests(unittest.TestCase):
         received from it.
         &quot;&quot;&quot;
         c = Server()
-        p = reactor.listenMulticast(0, c)
+        p = reactor.listenMulticast(0, c, interface=&quot;127.0.0.1&quot;)
         addr = self.server.transport.getHost()

-        joined = self.server.transport.joinGroup(&quot;225.0.0.250&quot;)
+        joined = self.server.transport.joinGroup(&quot;225.0.0.250&quot;,
interface=&quot;127.0.0.1&quot;)

         def cbJoined(ignored):
             d = self.server.packetReceived = Deferred()


Unfortunately, a similar change on my IPv6 code didn't yield the
results I was hoping for, but, I assume that's my problem.

Is there interest in a separate patch for these tests?  I assume a new ticket?

Thanks,
-Jason Litzinger

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030675.html">[Twisted-Python] RFC: IPv6 multicast join/ticket 6597
</A></li>
	<LI>Next message: <A HREF="030678.html">[Twisted-Python] RFC: IPv6 multicast join/ticket 6597
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30676">[ date ]</a>
              <a href="thread.html#30676">[ thread ]</a>
              <a href="subject.html#30676">[ subject ]</a>
              <a href="author.html#30676">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
