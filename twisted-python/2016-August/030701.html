<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] SSL4ClientEndpoint not updating the transport's connected flag on connection lost
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SSL4ClientEndpoint%20not%20updating%20the%20transport%27s%0A%20connected%20flag%20on%20connection%20lost&In-Reply-To=%3CCAFycZ9c4H6ZGOhR_w9v9MGHmYe4b-oBXo6LyQcEd%3DyXVkc-f_A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063161.html">
   <LINK REL="Next"  HREF="063206.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] SSL4ClientEndpoint not updating the transport's connected flag on connection lost</H1>
    <B>Adi Roiban</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20SSL4ClientEndpoint%20not%20updating%20the%20transport%27s%0A%20connected%20flag%20on%20connection%20lost&In-Reply-To=%3CCAFycZ9c4H6ZGOhR_w9v9MGHmYe4b-oBXo6LyQcEd%3DyXVkc-f_A%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] SSL4ClientEndpoint not updating the transport's connected flag on connection lost">adi at roiban.ro
       </A><BR>
    <I>Thu Aug 11 07:59:12 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063161.html">[Twisted-Python] More tests running on Python 3
</A></li>
        <LI>Next message (by thread): <A HREF="063206.html">[Twisted-Python] SSL4ClientEndpoint not updating the	transport's connected flag on connection lost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30701">[ date ]</a>
              <a href="thread.html#30701">[ thread ]</a>
              <a href="subject.html#30701">[ subject ]</a>
              <a href="author.html#30701">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have observed that when a SSL4ClientEndpoint was used, the
protocol's transport `connected` attribute is not updated by the
wrapper when the connection is lost.

I have this code which will need your own server cert+key file:

<A HREF="https://gist.github.com/adiroiban/8e0be840f81750f88a587e634ddfb194">https://gist.github.com/adiroiban/8e0be840f81750f88a587e634ddfb194</A>

I tried it on twisted/trunk and when SSL is used the output is

server:client connected
client:connected
client:send-message
server:data received
client:connection-lost
client:transport-status:1:wrapped-transport-&gt;0
server:client disconnected
client:transport-status:1:wrapped-transport-&gt;0

while without SSL the output is:

server:client connected
client:connected
client:send-message
server:data received
server:client disconnected
client:connection-lost
client:transport-status:0:wrapped-transport-&gt;0
client:transport-status:0:wrapped-transport-&gt;0

------------

My current finding is that the reactor will call connection lost on
t.i.abstract.FileDescriptor.connectionLost and not on
t.protocols.policies.ProtocolWrapper

so it seems that when SSL is used the wrapped protocol is registered
instead of the wrapping protocol.

------

I am doing something wrong here?

Is this the expected behavior or this is a bug?

Thanks!

-- 
Adi Roiban

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063161.html">[Twisted-Python] More tests running on Python 3
</A></li>
	<LI>Next message (by thread): <A HREF="063206.html">[Twisted-Python] SSL4ClientEndpoint not updating the	transport's connected flag on connection lost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30701">[ date ]</a>
              <a href="thread.html#30701">[ thread ]</a>
              <a href="subject.html#30701">[ subject ]</a>
              <a href="author.html#30701">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
