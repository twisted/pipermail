<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] clientfactory cleanup slow-down (after many http	requests)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20clientfactory%20cleanup%20slow-down%20%28after%20many%20http%0A%09requests%29&In-Reply-To=%3C20160806104823.GA14053%40garage2%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="063139.html">
   <LINK REL="Next"  HREF="063140.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] clientfactory cleanup slow-down (after many http	requests)</H1>
    <B>Randomcoder</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20clientfactory%20cleanup%20slow-down%20%28after%20many%20http%0A%09requests%29&In-Reply-To=%3C20160806104823.GA14053%40garage2%3E"
       TITLE="[Twisted-Python] clientfactory cleanup slow-down (after many http	requests)">randomcoder1 at gmail.com
       </A><BR>
    <I>Sat Aug  6 04:48:23 MDT 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="063139.html">[Twisted-Python] RFC: IPv6 multicast join/ticket 6597
</A></li>
        <LI>Next message (by thread): <A HREF="063140.html">[Twisted-Python] clientfactory cleanup slow-down (after many	http requests)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30677">[ date ]</a>
              <a href="thread.html#30677">[ thread ]</a>
              <a href="subject.html#30677">[ subject ]</a>
              <a href="author.html#30677">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I've been working on a small Twisted program.
The program makes HTTP requests to a large number of feeds.
Twisted is used to speed up the entire process.
After the feeds are fetched, they're parsed. Finally they should be
written to a database (to simplify the code, that part is left out).

Feeds are fetched in parallel using gatherResults, and a batch is
built. Then all batches are again gathered into a set of batches,
a DeferredList is built out of those. A semaphore controls both the
batch-level list of deferreds, and a semaphore controls the entire batch
list deferred.

Currently, the program works ok on 100-150 feeds, and BATCH_SIZE between
5 and 20.

However, I notice the program starts to hang for a long time, when the
number of feeds goes over 150-200.

To be more precise, at the end of running the program, messages
like these are printed, but the program seems to not be very active:

    Stopping factory &lt;twisted.web.client._HTTP11ClientFactory instance at 0x7f0b7d5f3908&gt;

It seems like this is the cleanup phase.

I've read what I could find on the topic. I wasn't able to make progress
on it, so I'm posting to the mailing list to ask if someone has encountered this
before. Maybe it's a common pitfall or issue that other people have also
bumped into.

Thanks
-------------- next part --------------
<A HREF="http://mauveweb.co.uk/rss.xml">http://mauveweb.co.uk/rss.xml</A> &quot;python&quot;
<A HREF="http://blog.hownowstephen.com/rss">http://blog.hownowstephen.com/rss</A> &quot;python&quot;
<A HREF="http://blog.codepainters.com/feed/">http://blog.codepainters.com/feed/</A> &quot;python&quot;
<A HREF="http://chase-seibert.github.io/blog/atom.xml">http://chase-seibert.github.io/blog/atom.xml</A> &quot;python&quot;
<A HREF="http://www.lshift.net/blog/feed/">http://www.lshift.net/blog/feed/</A> &quot;python&quot;
<A HREF="http://django-planet.com/feeds/main/rss/">http://django-planet.com/feeds/main/rss/</A> &quot;python&quot;
<A HREF="http://eflorenzano.com/atom.xml">http://eflorenzano.com/atom.xml</A> &quot;python&quot;

-------------- next part --------------
A non-text attachment was scrubbed...
Name: collect.py
Type: text/x-python
Size: 6818 bytes
Desc: not available
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20160806/fbf5912d/attachment.py">http://twistedmatrix.com/pipermail/twisted-python/attachments/20160806/fbf5912d/attachment.py</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="063139.html">[Twisted-Python] RFC: IPv6 multicast join/ticket 6597
</A></li>
	<LI>Next message (by thread): <A HREF="063140.html">[Twisted-Python] clientfactory cleanup slow-down (after many	http requests)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30677">[ date ]</a>
              <a href="thread.html#30677">[ thread ]</a>
              <a href="subject.html#30677">[ subject ]</a>
              <a href="author.html#30677">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
