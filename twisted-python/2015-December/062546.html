<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] The role of	twisted.internet._sslverify.IOpenSSLTrustRoot
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20The%20role%20of%0A%09twisted.internet._sslverify.IOpenSSLTrustRoot&In-Reply-To=%3C8E552B9F-363C-4A5D-BCB8-EECDEC2A739C%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062544.html">
   <LINK REL="Next"  HREF="062545.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] The role of	twisted.internet._sslverify.IOpenSSLTrustRoot</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20The%20role%20of%0A%09twisted.internet._sslverify.IOpenSSLTrustRoot&In-Reply-To=%3C8E552B9F-363C-4A5D-BCB8-EECDEC2A739C%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] The role of	twisted.internet._sslverify.IOpenSSLTrustRoot">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Dec 25 19:27:58 MST 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062544.html">[Twisted-Python] The role of	twisted.internet._sslverify.IOpenSSLTrustRoot
</A></li>
        <LI>Next message (by thread): <A HREF="062545.html">[Twisted-Python] The role of	twisted.internet._sslverify.IOpenSSLTrustRoot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62546">[ date ]</a>
              <a href="thread.html#62546">[ thread ]</a>
              <a href="subject.html#62546">[ subject ]</a>
              <a href="author.html#62546">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Dec 25, 2015, at 2:19 PM, Adi Roiban &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> On 25 December 2015 at 11:20, Glyph Lefkowitz &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On Dec 20, 2015, at 9:05 AM, Adi Roiban &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A>&gt;&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What is the purpose of IOpenSSLTrustRoot ?
</I>&gt;<i> 
</I>&gt;<i> The idea is that we have public functions, mainly `optionsForClientTLS´, which need to take a thing that represents a &quot;trust root&quot;.  We want this to be something that can abstractly be described at a high level, but then in reality we need to do with gross implementation details of OpenSSL.  So this interface describes what you pass.
</I>&gt;<i> 
</I>&gt;<i> Reading the docstring of IOpenSSLTrustRoot it does not give any hints about optionsForClientTLS
</I>&gt;<i> 
</I>&gt;<i> So instead of
</I>&gt;<i> 
</I>&gt;<i>     Trust settings for an OpenSSL context.
</I>&gt;<i> 
</I>&gt;<i> Maybe it should be something like:
</I>&gt;<i> 
</I>&gt;<i>    Marker only interface for private implementations of OpenSSL trust root things.
</I>
This is incorrect, though.  The term &quot;marker interface&quot; means &quot;interface with no attributes or methods, used to denote a complex property that Interface is insufficiently expressive to describe&quot;.

Oh and hey we didn't even invent the term: <A HREF="https://en.wikipedia.org/wiki/Marker_interface_pattern">https://en.wikipedia.org/wiki/Marker_interface_pattern</A> :)

&gt;&gt;<i> It it documented as a private interface, it has only private methods, but then it is exposed in  twisted.internet.ssl.optionsForClientTLS
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Why?
</I>&gt;<i> 
</I>&gt;<i> Yes, this is intentional.  It is a private interface, so you can't check if something provides it, you aren't allowed to know what attributes it has, and you can't implement it.  However, you can call a function that is documented to return a value that provides it (such as `twisted.internet.ssl.platformTrust´) and pass that value to a function documented to accept it (such as `twisted.internet.ssl.optionsForClientTLS`).
</I>&gt;<i> 
</I>&gt;<i> It's private because we weren't sure if we'd want to change it.  At the time it was implemented, the only two cases were OpenSSLDefaultPaths and Certificate.  In the case of Certificate, you know what certificate you're adding, but in the case of OpenSSLDefaultPaths, you just call a method on the context object to mutate it, and you can't extract information about which certificates are trusted past that.  The method we came up with, _addCACertsToContext, was a gross compromise which allowed for implementing this but could not be made abstract, because it reflects a bizarre flaw in the OpenSSL API, and it by necessity exposes pyOpenSSL objects, which we are trying to do less of.  For one thing, we'd eventually like to support TLS via OpenSSL using an API provided by Cryptography; for another, we'd like to one day provide TLS from an API that might not be backed by OpenSSL at all.  So reducing the surface area of our public API that touches pyOpenSSL is important.
</I>&gt;<i> 
</I>&gt;<i> Hopefully this thoroughly explains the decision?
</I>&gt;<i> 
</I>&gt;<i> I understand now, but I find it hard to extract this information just from the code... maybe I am a bad code reader, or maybe the  IOpenSSLTrustRoot docstring should inform that it is a gross compromise so that other people will understand that this is not really intentional ... and invited to find something better :)
</I>
I think the documentation as it is does maintainers a slight disservice, as the assumption is that you've come to IOpenSSLTrustRoot after having read the docstring for optionsForClientTLS, or platformTrust, or OpenSSLCertificateOptions.  So it could definitely be re-written to take into account the fact that a maintainer might discover this interface first.  Honestly it seems to me that a &quot;@see:&quot; with links to the thing that take it as a parameter would get us 70% of the way there, just so that maintainers could use it as a jumping-off point.  Some of the explanation from these emails would also be useful, of course, to give some context.  It says &quot;things outside of twisted shouldn't implement it&quot; but it doesn't really explain why.

&gt;<i> I am happy to see more backend neutral API but unless we have at least another use case for non OpenSSL backed TLS I don't know if it worth designing an API for that unknown API.
</I>
We have definitely made some missteps with this API design (I should probably write a giant &quot;mea culpa&quot; blog post at some point pointing out what many of those errors were).  However, the point of things like IOpenSSLTrustRoot is not to prematurely introduce extra interfaces and functionality where they are not needed - we need such an interface even for a pure OpenSSL-only backend.  The point is to keep those things out of the public interface so that callers are not overly coupled to them.

One thing that's important to remember is that &quot;private&quot; is a social convention in Python, so if needs must, a Twisted application can always just go ahead and implement this interface. 

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20151225/89c5af78/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062544.html">[Twisted-Python] The role of	twisted.internet._sslverify.IOpenSSLTrustRoot
</A></li>
	<LI>Next message (by thread): <A HREF="062545.html">[Twisted-Python] The role of	twisted.internet._sslverify.IOpenSSLTrustRoot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62546">[ date ]</a>
              <a href="thread.html#62546">[ thread ]</a>
              <a href="subject.html#62546">[ subject ]</a>
              <a href="author.html#62546">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
