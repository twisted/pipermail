<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Waiting for transports to close
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Waiting%20for%20transports%20to%20close&In-Reply-To=%3C56755519.6070608%40googlemail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062532.html">
   <LINK REL="Next"  HREF="062542.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Waiting for transports to close</H1>
    <B>Chris Norman</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Waiting%20for%20transports%20to%20close&In-Reply-To=%3C56755519.6070608%40googlemail.com%3E"
       TITLE="[Twisted-Python] Waiting for transports to close">chris.norman2 at googlemail.com
       </A><BR>
    <I>Sat Dec 19 06:01:13 MST 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062532.html">[Twisted-Python] Waiting for transports to close
</A></li>
        <LI>Next message (by thread): <A HREF="062542.html">[Twisted-Python] Waiting for transports to close
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62537">[ date ]</a>
              <a href="thread.html#62537">[ thread ]</a>
              <a href="subject.html#62537">[ subject ]</a>
              <a href="author.html#62537">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

On 17/12/2015 13:03, Glyph Lefkowitz wrote:
&gt;<i>
</I>&gt;&gt;<i> On Dec 17, 2015, at 4:56 AM, Chris Norman 
</I>&gt;&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A>&gt;&gt; 
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> It's a MUD server, so players type in commands and receive textual 
</I>&gt;&gt;<i> responses.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One of the admin commands is the ability to shutdown the server (or 
</I>&gt;&gt;<i> CTRL-C might be pressed on the console). I'd like this action to 
</I>&gt;&gt;<i> notify all connected transports that the server is going down for 
</I>&gt;&gt;<i> shutdown, so they're not rudely disconnected, then once the 
</I>&gt;&gt;<i> notifications have all gone through, then the server is free to shutdown.
</I>&gt;<i>
</I>&gt;<i> Gotcha.  So you don't need to necessarily wait for all the messages to 
</I>&gt;<i> be delivered if there are slow clients waiting around; you just want 
</I>&gt;<i> to send everyone a farewell message and if they haven't responded 
</I>&gt;<i> within a reasonable timeout, go ahead and shut down anyway.
</I>&gt;<i>
</I>&gt;<i> If your MUD server is already a Service 
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html</A>&gt; 
</I>&gt;<i> being launched by twistd, you just need to add a stopService 
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService</A>&gt; 
</I>&gt;<i> method that returns a Deferred.  When CTRL-C is hit (or anything else 
</I>&gt;<i> causes reactor.stop to be called), it will call this stopService 
</I>&gt;<i> method, and won't exit until a Deferred fires.
</I>&gt;<i>
</I>&gt;<i> In your case, a simple deferLater 
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater</A>&gt; 
</I>&gt;<i> will probably do the trick.  You can also speed things up when there 
</I>&gt;<i> are no connected clients left by cancelling that Deferred to make it 
</I>&gt;<i> finish firing immediately.
</I>&gt;<i>
</I>&gt;<i> Will that work for you?
</I>&gt;<i>
</I>&gt;&gt;<i> I hope all this makes sense.
</I>
It's not a service no... Should it be? I wasn't planning to use twistd, 
mainly because I don't know how to, and running
python main.py
is working fine, accepting command line arguments - the works.

It could be converted though, if there is an advantage with services?

Also, I've read quite a lot about Deferreds. I thought initially they 
were for multithreading your application, but I realise that's wrong, so 
I don't understand what the point in them is?

This isn't to say there isn't one mind you, I think I'm just majorly 
missing the point.

&gt;<i>
</I>&gt;<i> P.S.: For future reference, on this list the preferred style of reply 
</I>&gt;<i> is interleaved <A HREF="https://en.wikipedia.org">https://en.wikipedia.org</A> 
</I>&gt;<i> &lt;<A HREF="https://en.wikipedia.org/wiki/Posting_style#Interleaved_style">https://en.wikipedia.org/wiki/Posting_style#Interleaved_style</A>&gt;
</I>
Sorry, I'll do that in the future.

&gt;<i> /wiki/Posting_style#Interleaved_style 
</I>&gt;<i> &lt;<A HREF="https://en.wikipedia.org/wiki/Posting_style#Interleaved_style">https://en.wikipedia.org/wiki/Posting_style#Interleaved_style</A>&gt; or 
</I>&gt;<i> bottom-posting: <A HREF="https://en.wikipedia.org/wiki/Posting_style#Bottom-posting">https://en.wikipedia.org/wiki/Posting_style#Bottom-posting</A>
</I>&gt;<i>
</I>&gt;<i> -glyph
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20151219/6484d914/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062532.html">[Twisted-Python] Waiting for transports to close
</A></li>
	<LI>Next message (by thread): <A HREF="062542.html">[Twisted-Python] Waiting for transports to close
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62537">[ date ]</a>
              <a href="thread.html#62537">[ thread ]</a>
              <a href="subject.html#62537">[ subject ]</a>
              <a href="author.html#62537">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
