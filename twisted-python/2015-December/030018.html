<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] ssl APIs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ssl%20APIs&In-Reply-To=%3CCCCE686F-F4D6-4E32-BA29-F2DA856F3949%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030017.html">
   <LINK REL="Next"  HREF="030075.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] ssl APIs</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20ssl%20APIs&In-Reply-To=%3CCCCE686F-F4D6-4E32-BA29-F2DA856F3949%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] ssl APIs">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Dec  4 02:34:22 MST 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="030017.html">[Twisted-Python] ssl APIs
</A></li>
        <LI>Next message: <A HREF="030075.html">[Twisted-Python] ssl APIs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30018">[ date ]</a>
              <a href="thread.html#30018">[ thread ]</a>
              <a href="subject.html#30018">[ subject ]</a>
              <a href="author.html#30018">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Dec 3, 2015, at 9:14 PM, meejah &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">meejah at meejah.ca</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I've been fooling around with the Twisted SSL APIs.
</I>&gt;<i> 
</I>&gt;<i> I'd like to add a &quot;loadPEM&quot; and documentation to ssl.KeyPair; shall I
</I>&gt;<i> open a ticket and start this, or is there a reason it doesn't have a
</I>&gt;<i> loadPEM() like some of the other classes (or any docstrings)? It is
</I>&gt;<i> exported as a public class in &quot;ssl&quot;.
</I>
Please go ahead and do it.

&gt;<i> Also I'm wondering why CertificateOptions takes actual OpenSSL objects
</I>&gt;<i> for args, instead of the Twisted equivalents; this leads to code
</I>&gt;<i> accessing &quot;.original&quot; all the time if you use Twisted APIs to load
</I>&gt;<i> Certificate (and friends) which seems .. odd. Perhaps either a
</I>&gt;<i> Certificate *or* the correct underlying OpenSSL object could be
</I>&gt;<i> accepted?
</I>
Wow!  I am so glad someone else finally noticed this! :-)

Basically: yes, this is odd.  It is a result of a miscommunication (or rather, lack of communication) between the designers and the maintainers of that system.

A long time ago, I designed a &quot;just enough&quot; API for TLS (for Vertex, even, not really for Twisted), which is what got adopted into Twisted and eventually became _sslverify.py.  However, this was very much incomplete; it wasn't really designed for the 99% use-case (running an HTTPS server).

OpenSSLCertificateOptions was just a private implementation detail; it was the object returned by PrivateCertificate.options().  (Hence its somewhat odd name: 'options', which has now become the convention; see optionsForClientTLS).  However, the signature of .options() was tough to extend, since it just takes &quot;*authorities&quot;.  Given Vertex's use-case that sort of made sense but it really doesn't belong in the general-purpose library of twisted.internet.ssl.

Anyway, I digress: the point is that these classes were lying around, basically undocumented, when Hynek Schlawack showed up and began his otherwise excellent feature additions to Twisted's TLS stack, among .  When asked &quot;what is the 'good' ContextFactory class&quot;, the answer he got was unanimously 'OpenSSLCertificateOptions'.  So he did what seemed reasonable: start adding features to that class, and then make it public.  I took my eye off the ball for a release or two and by the time I checked back, &quot;CertificateOptions&quot; was the recommended public interface, warts and all :).

I want to be clear that despite the fact that there are problems with the factoring here, if you're writing TLS server code with Twisted today you should absolutely be using CertificateOptions; its interface is crummy but its implementation is very solid; again, Hynek did some really excellent work.  As the interface changes, the implementation should stay largely the same.

If you want to fix this, rather than continue to mangle this architectural monstrosity, I think we should develop something symmetrical to the new, mostly pretty good optionsForClientTLS - <A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.ssl.html#optionsForClientTLS">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.ssl.html#optionsForClientTLS</A> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.ssl.html#optionsForClientTLS">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.ssl.html#optionsForClientTLS</A>&gt; - which operates entirely in terms of high-level wrapper objects defined in twisted.internet.ssl.  Make an 'optionsForServerTLS', which can have a simpler interface, because it will just accept relevant configuration parameters for server TLS, and under the covers still use CertificateOptions.  Initially we can provide the 'extraCertificateOptions' escape-hatch as we have with 'optionsForClientTLS', but once we've got a nice way to deal with esoterica like selecting TLS protocol versions and selecting cipher suites in those APIs, we can deprecate and remove the escape-hatch and be left with a clean function. 

So, are you up for contributing an 'optionsForServerTLS'?

&gt;<i> There also doesn't seem to be a way around importing
</I>&gt;<i> OpenSSLCertificateAuthorities from _sslverify (i.e. &quot;private&quot; class) if
</I>&gt;<i> you want to give optionsForClientTLS() more than a single certificate as
</I>&gt;<i> trustRoot. The only way I can see is to construct one of those from a
</I>&gt;<i> list of OpenSSL certificate instances and pass that as trustRoot=
</I>

Yes, that is in fact an oversight.  No need to write a ticket up yourself; you can just fix this one:

<A HREF="https://twistedmatrix.com/trac/ticket/7671">https://twistedmatrix.com/trac/ticket/7671</A> &lt;<A HREF="https://twistedmatrix.com/trac/ticket/7671">https://twistedmatrix.com/trac/ticket/7671</A>&gt;

Thanks a ton for your interest, it would be great to get more people interested in TLS to maintain this stuff!

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20151204/885634be/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20151204/885634be/attachment.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030017.html">[Twisted-Python] ssl APIs
</A></li>
	<LI>Next message: <A HREF="030075.html">[Twisted-Python] ssl APIs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30018">[ date ]</a>
              <a href="thread.html#30018">[ thread ]</a>
              <a href="subject.html#30018">[ subject ]</a>
              <a href="author.html#30018">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
