<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Waiting for transports to close
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Waiting%20for%20transports%20to%20close&In-Reply-To=%3C0494770D-A0C0-4171-A10F-446BC2966FCB%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="062531.html">
   <LINK REL="Next"  HREF="062537.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Waiting for transports to close</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Waiting%20for%20transports%20to%20close&In-Reply-To=%3C0494770D-A0C0-4171-A10F-446BC2966FCB%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Waiting for transports to close">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Dec 17 06:03:44 MST 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="062531.html">[Twisted-Python] Waiting for transports to close
</A></li>
        <LI>Next message (by thread): <A HREF="062537.html">[Twisted-Python] Waiting for transports to close
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62532">[ date ]</a>
              <a href="thread.html#62532">[ thread ]</a>
              <a href="subject.html#62532">[ subject ]</a>
              <a href="author.html#62532">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Dec 17, 2015, at 4:56 AM, Chris Norman &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> It's a MUD server, so players type in commands and receive textual responses.
</I>&gt;<i> 
</I>&gt;<i> One of the admin commands is the ability to shutdown the server (or CTRL-C might be pressed on the console). I'd like this action to notify all connected transports that the server is going down for shutdown, so they're not rudely disconnected, then once the notifications have all gone through, then the server is free to shutdown.
</I>
Gotcha.  So you don't need to necessarily wait for all the messages to be delivered if there are slow clients waiting around; you just want to send everyone a farewell message and if they haven't responded within a reasonable timeout, go ahead and shut down anyway.

If your MUD server is already a Service &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html</A>&gt;&gt; being launched by twistd, you just need to add a stopService &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService</A> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService</A>&gt;&gt; method that returns a Deferred.  When CTRL-C is hit (or anything else causes reactor.stop to be called), it will call this stopService method, and won't exit until a Deferred fires.

In your case, a simple deferLater &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater</A> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater</A>&gt;&gt; will probably do the trick.  You can also speed things up when there are no connected clients left by cancelling that Deferred to make it finish firing immediately.

Will that work for you?

&gt;<i> I hope all this makes sense.
</I>
P.S.: For future reference, on this list the preferred style of reply is interleaved <A HREF="https://en.wikipedia.org/wiki/Posting_style#Interleaved_style">https://en.wikipedia.org/wiki/Posting_style#Interleaved_style</A> &lt;<A HREF="https://en.wikipedia.org/wiki/Posting_style#Interleaved_style">https://en.wikipedia.org/wiki/Posting_style#Interleaved_style</A>&gt; or bottom-posting: <A HREF="https://en.wikipedia.org/wiki/Posting_style#Bottom-posting">https://en.wikipedia.org/wiki/Posting_style#Bottom-posting</A> &lt;<A HREF="https://en.wikipedia.org/wiki/Posting_style#Bottom-posting">https://en.wikipedia.org/wiki/Posting_style#Bottom-posting</A>&gt;

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20151217/2709b613/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="062531.html">[Twisted-Python] Waiting for transports to close
</A></li>
	<LI>Next message (by thread): <A HREF="062537.html">[Twisted-Python] Waiting for transports to close
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62532">[ date ]</a>
              <a href="thread.html#62532">[ thread ]</a>
              <a href="subject.html#62532">[ subject ]</a>
              <a href="author.html#62532">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
