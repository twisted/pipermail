<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Waiting for transports to close
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Waiting%20for%20transports%20to%20close&In-Reply-To=%3CD15A8C49-2104-432C-9C79-E0973B62FE59%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030076.html">
   <LINK REL="Next"  HREF="030062.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Waiting for transports to close</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Waiting%20for%20transports%20to%20close&In-Reply-To=%3CD15A8C49-2104-432C-9C79-E0973B62FE59%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Waiting for transports to close">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Dec 25 02:00:24 MST 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="030076.html">[Twisted-Python] Waiting for transports to close
</A></li>
        <LI>Next message: <A HREF="030062.html">[Twisted-Python] asynchronous response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30081">[ date ]</a>
              <a href="thread.html#30081">[ thread ]</a>
              <a href="subject.html#30081">[ subject ]</a>
              <a href="author.html#30081">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Dec 19, 2015, at 5:01 AM, Chris Norman &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> On 17/12/2015 13:03, Glyph Lefkowitz wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Dec 17, 2015, at 4:56 AM, Chris Norman &lt; &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A>&gt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A> &lt;mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">chris.norman2 at googlemail.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i> It's a MUD server, so players type in commands and receive textual responses.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> One of the admin commands is the ability to shutdown the server (or CTRL-C might be pressed on the console). I'd like this action to notify all connected transports that the server is going down for shutdown, so they're not rudely disconnected, then once the notifications have all gone through, then the server is free to shutdown.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Gotcha.  So you don't need to necessarily wait for all the messages to be delivered if there are slow clients waiting around; you just want to send everyone a farewell message and if they haven't responded within a reasonable timeout, go ahead and shut down anyway.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If your MUD server is already a Service &lt; &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html</A>&gt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html</A>&gt;&gt; being launched by twistd, you just need to add a stopService &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService</A> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService">https://twistedmatrix.com/documents/15.5.0/api/twisted.application.service.IService.html#stopService</A>&gt;&gt; method that returns a Deferred.  When CTRL-C is hit (or anything else causes reactor.stop to be called), it will call this stopService method, and won't exit until a Deferred fires.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> In your case, a simple deferLater &lt; &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater</A>&gt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater</A> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.task.html#deferLater</A>&gt;&gt; will probably do the trick.  You can also speed things up when there are no connected clients left by cancelling that Deferred to make it finish firing immediately.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Will that work for you?
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I hope all this makes sense.
</I>&gt;<i> 
</I>&gt;<i> It's not a service no... Should it be? I wasn't planning to use twistd, mainly because I don't know how to, and running
</I>&gt;<i> python main.py
</I>&gt;<i> is working fine, accepting command line arguments - the works.
</I>&gt;<i> 
</I>&gt;<i> It could be converted though, if there is an advantage with services?
</I>
Services are just the standard way to organize starting up and shutting down with Twisted.  And running under `twistd&#180; takes care of some of the details of starting up and hosting your service, including initializing logging, managing the timing of setting the UID and GID, selecting the reactor and so on.  But if you're happy with your own service setup, it's not necessary.  The alternative is to use `addSystemEventTrigger&#180;: <A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.base.ReactorBase.html#addSystemEventTrigger">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.base.ReactorBase.html#addSystemEventTrigger</A> &lt;<A HREF="https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.base.ReactorBase.html#addSystemEventTrigger">https://twistedmatrix.com/documents/15.5.0/api/twisted.internet.base.ReactorBase.html#addSystemEventTrigger</A>&gt;
&gt;<i> Also, I've read quite a lot about Deferreds. I thought initially they were for multithreading your application, but I realise that's wrong, so I don't understand what the point in them is?
</I>
You can't block (i.e. wait to return from your function until you have a result) in an async system, so Deferreds are a placeholder for a result that doesn't exist yet.  krondo.com's Twisted introduction covers this in some detail, if the official Twisted docs didn't help you: <A HREF="http://krondo.com/?page_id=1327">http://krondo.com/?page_id=1327</A>

&gt;<i> This isn't to say there isn't one mind you, I think I'm just majorly missing the point.
</I>
If there weren't a point to having Deferreds then Twisted would be a very strange system indeed ;).

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20151225/8d2b5be0/attachment.html">http://twistedmatrix.com/pipermail/twisted-python/attachments/20151225/8d2b5be0/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030076.html">[Twisted-Python] Waiting for transports to close
</A></li>
	<LI>Next message: <A HREF="030062.html">[Twisted-Python] asynchronous response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30081">[ date ]</a>
              <a href="thread.html#30081">[ thread ]</a>
              <a href="subject.html#30081">[ subject ]</a>
              <a href="author.html#30081">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
