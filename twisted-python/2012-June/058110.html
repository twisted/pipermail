<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Quan Nguyen: Twisted Python questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Quan%20Nguyen%3A%20Twisted%20Python%20questions&In-Reply-To=%3C01B4075F-A1A4-49DF-BCAD-D4C0A6FA2C73%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058103.html">
   <LINK REL="Next"  HREF="058104.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Quan Nguyen: Twisted Python questions</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Quan%20Nguyen%3A%20Twisted%20Python%20questions&In-Reply-To=%3C01B4075F-A1A4-49DF-BCAD-D4C0A6FA2C73%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Quan Nguyen: Twisted Python questions">glyph at twistedmatrix.com
       </A><BR>
    <I>Wed Jun 13 13:10:18 MDT 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058103.html">[Twisted-Python] Quan Nguyen: Twisted Python questions
</A></li>
        <LI>Next message (by thread): <A HREF="058104.html">[Twisted-Python] Detect SSL transport and get remote peer	certificate in tcp.Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58110">[ date ]</a>
              <a href="thread.html#58110">[ thread ]</a>
              <a href="subject.html#58110">[ subject ]</a>
              <a href="author.html#58110">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jun 12, 2012, at 1:53 PM, Quan Nguyen wrote:

&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I am new to Twisted. 
</I>&gt;<i> I am extending the twisted Echo server example by sending the data that the server receives from telnet into a child process that processes the data. The function outReceived in censoringProtocol is called when the child writes the result and the result is received. The process of passing data from parent to child and back to parent is done by having a while loop of stdin.readline() and stdout.write() in the child process. 
</I>&gt;<i> Specifically, I generate a deferred object each time I write to the child using the function sendData (which then calls writeToChild) and use a queue to manage the deferred objects. I add a callBack (printData) that will broadcast the result to all instances of Echo when outReceived is called. 
</I>&gt;<i> 
</I>&gt;<i> I have two questions: 
</I>&gt;<i> 1/ Is this the right approach to communicate with the child process in order to achieve what I want? Are there any gotcha's?
</I>
This sounds pretty much fine, except for the caveat you already asked about:

&gt;<i> 2/ This server will be exposed to high loads. There will be many instances of Echo sending data to the child at a high rate. Are there any limitations that I have to watch for, such as the limit on child process's pipe sizes or anything else?
</I>
You might want to investigate the producer/consumer API, as recently blogged about by our marvelously productive summer intern, ashfall: &lt;<A HREF="http://ashfall.github.com/blog/2012/05/29/twisted-producer-and-consumer-system/">http://ashfall.github.com/blog/2012/05/29/twisted-producer-and-consumer-system/</A>&gt;.  As currently written, even if your subprocess backs up, you will buffer data to it without any limits.

(The consumer you want, by the way, is censoringProtocol().transport.pipes[0], in case that isn't entirely clear; processes need to be documented a little better.)

You may have to write a little bit of tricky code to multiplex the consumer, if you want to have multiple &quot;echo&quot; client connections using the same subprocess.  If it were a 1&lt;-&gt;1 relationship you could just register the echo protocol's transport as the producer for the stdin pipe on the processing protocol, but spawning that many processes is probably wasteful.

-glyph

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058103.html">[Twisted-Python] Quan Nguyen: Twisted Python questions
</A></li>
	<LI>Next message (by thread): <A HREF="058104.html">[Twisted-Python] Detect SSL transport and get remote peer	certificate in tcp.Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58110">[ date ]</a>
              <a href="thread.html#58110">[ thread ]</a>
              <a href="subject.html#58110">[ subject ]</a>
              <a href="author.html#58110">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
