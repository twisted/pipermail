<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] lost tracebacks?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20lost%20tracebacks%3F&In-Reply-To=20081210012922.12555.1049608548.divmod.xquotient.1986%40weber.divmod.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018840.html">
   <LINK REL="Next"  HREF="018850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] lost tracebacks?</H1>
    <B>Alec Flett</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20lost%20tracebacks%3F&In-Reply-To=20081210012922.12555.1049608548.divmod.xquotient.1986%40weber.divmod.com"
       TITLE="[Twisted-Python] lost tracebacks?">alecf at metaweb.com
       </A><BR>
    <I>Wed Dec 10 15:42:06 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018840.html">[Twisted-Python] lost tracebacks?
</A></li>
        <LI>Next message: <A HREF="018850.html">[Twisted-Python] lost tracebacks?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18849">[ date ]</a>
              <a href="thread.html#18849">[ thread ]</a>
              <a href="subject.html#18849">[ subject ]</a>
              <a href="author.html#18849">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ah, I found the problem, for anyone else who runs into this...

I am collecting stacks using the logging system's addObserver() -  
trying to access the traceback from a garbage-collected deferred.  
Turns out when the deferred is garbage collected, the failure is  
pickled (to avoid leaks) and so it sets failure.tb to None.

By the time you get it in your log observer and store it for later,  
you can't re-raise the exception with the stack. but  
failure.getTraceback() gave me enough stack to at least debug.

I was hoping for a &quot;real&quot; traceback because Paste's EvalException  
middleware does a nice job debugging &quot;live&quot; stacks, but the 'verbose'  
stack is a pretty decent stand-in.

Alec

On Dec 9, 2008, at 5:29 PM, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:

&gt;<i> On 12:41 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">alecf at metaweb.com</A> wrote:
</I>&gt;&gt;<i> I traced this down to the code in Deferred._runCallbacks() which  
</I>&gt;&gt;<i> does a try: / except: with::
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    self.result = failure.Failure()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Seems like this code should say::
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    exc_type, exc_value, exc_traceback = sys.exc_info()
</I>&gt;&gt;<i>    self.result = failure.Failure(exc_value, exc_type, exc_traceback)
</I>&gt;<i>
</I>&gt;<i> Those are basically equivalent.  Observe:
</I>&gt;&gt;&gt;&gt;<i> from twisted.python.failure import Failure
</I>&gt;&gt;&gt;&gt;<i> try:
</I>&gt;<i> ...  1/0
</I>&gt;<i> ... except:
</I>&gt;<i> ...  f = Failure()
</I>&gt;<i> ...
</I>&gt;&gt;&gt;&gt;<i> f.printTraceback()
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i> --- &lt;exception caught here&gt; ---
</I>&gt;<i> File &quot;&lt;stdin&gt;&quot;, line 2, in &lt;module&gt;
</I>&gt;<i>
</I>&gt;<i> exceptions.ZeroDivisionError: integer division or modulo by zero
</I>&gt;<i>
</I>&gt;<i> Note how it remembers the line number in the traceback.  Your  
</I>&gt;<i> traceback must be getting lost for some other reason.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018840.html">[Twisted-Python] lost tracebacks?
</A></li>
	<LI>Next message: <A HREF="018850.html">[Twisted-Python] lost tracebacks?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18849">[ date ]</a>
              <a href="thread.html#18849">[ thread ]</a>
              <a href="subject.html#18849">[ subject ]</a>
              <a href="author.html#18849">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
