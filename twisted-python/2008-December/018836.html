<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] spawnProcess help needed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20spawnProcess%20help%20needed&In-Reply-To=8ACAACEC-AA5D-4BA1-B291-188D7D8F5F45%40bubblehouse.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018833.html">
   <LINK REL="Next"  HREF="018843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] spawnProcess help needed</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20spawnProcess%20help%20needed&In-Reply-To=8ACAACEC-AA5D-4BA1-B291-188D7D8F5F45%40bubblehouse.org"
       TITLE="[Twisted-Python] spawnProcess help needed">exarkun at divmod.com
       </A><BR>
    <I>Tue Dec  9 17:41:53 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="018833.html">[Twisted-Python] spawnProcess help needed
</A></li>
        <LI>Next message: <A HREF="018843.html">[Twisted-Python] spawnProcess help needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18836">[ date ]</a>
              <a href="thread.html#18836">[ thread ]</a>
              <a href="subject.html#18836">[ subject ]</a>
              <a href="author.html#18836">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 9 Dec 2008 15:43:00 -0500, Phil Christensen &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">phil at bubblehouse.org</A>&gt; wrote:
&gt;<i>Hello All-
</I>&gt;<i>
</I>&gt;<i>I'm running into an issue with a project I'm working on that involves 
</I>&gt;<i>coordinating a large number of external processes to encode audio into 
</I>&gt;<i>different formats, and do other bookkeeping.
</I>&gt;<i>
</I>&gt;<i>I seem to be having a problem when I use spawnProcess to call the  md5sum 
</I>&gt;<i>binary. The processes spawned seem to stick around forever,  until I kill 
</I>&gt;<i>the server. This doesn't appear to happen with any other  binary.
</I>&gt;<i>
</I>&gt;<i>I start with the following abstract class:
</I>&gt;<i>
</I>&gt;<i> [snip MD5Checksum ProcessProtocol]
</I>&gt;<i>
</I>&gt;<i>With the plan of executing it inside an inlineCallbacks-decorated  function, 
</I>&gt;<i>like this:
</I>&gt;<i>
</I>&gt;<i>         proto = yield process.MD5Checksum.run(filename)
</I>&gt;<i>         checksum = proto.get_checksum()
</I>&gt;<i>
</I>&gt;<i>Everything is basically working, except for the fact that the md5sum 
</I>&gt;<i>processes never go away. It does seem that processEnded is being  called, 
</I>&gt;<i>since that's what issues the callback on the deferred returned  by run(), 
</I>&gt;<i>but the process sticks around, as a non-zombie, non-defunct  process that 
</I>&gt;<i>still appears to be using small amounts of CPU time.
</I>
processEnded shouldn't be called until the child has exited and been
reaped.  This means that the md5sum process should not still exist in
any form if processEnded is being called.  So either the processes you're
seeing aren't associated with the ProcessProtocol instances you think, or
there's a pretty serious bug in Twisted. :)

A self-contained example of this behavior would be pretty handy.  You should
probably start by making sure processEnded is really being called for the
ProcessProtocol instances associated with the processes which aren't actually
exiting.

&gt;<i>
</I>&gt;<i>Also, once the checksum has been retrieved, killing the server doesn't 
</I>&gt;<i>cause any errors, unlike when a process is legitimately terminated by 
</I>&gt;<i>killing the server, which displays an error (since right now i'm not 
</I>&gt;<i>actually catching ProcessTerminated scenarios):
</I>&gt;<i>
</I>&gt;<i>     2008-12-09 15:17:48-0500 [-] Unhandled error in Deferred:
</I>&gt;<i>     2008-12-09 15:17:48-0500 [-] Unhandled Error
</I>&gt;<i>         Traceback (most recent call last):
</I>&gt;<i>         Failure: twisted.internet.error.ProcessTerminated: A process  has 
</I>&gt;<i>ended with a probable
</I>&gt;<i>     error condition: process ended by signal 2.
</I>&gt;<i>
</I>&gt;<i>Any help in this matter would be appreciated...
</I>&gt;<i>
</I>
Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018833.html">[Twisted-Python] spawnProcess help needed
</A></li>
	<LI>Next message: <A HREF="018843.html">[Twisted-Python] spawnProcess help needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18836">[ date ]</a>
              <a href="thread.html#18836">[ thread ]</a>
              <a href="subject.html#18836">[ subject ]</a>
              <a href="author.html#18836">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
