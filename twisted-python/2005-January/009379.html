<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Problem with ClientFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problem%20with%20ClientFactory&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009380.html">
   <LINK REL="Next"  HREF="009381.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Problem with ClientFactory</H1>
    <B>Michal Chruszcz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Problem%20with%20ClientFactory&In-Reply-To="
       TITLE="[Twisted-Python] Problem with ClientFactory">troll at pld-linux.org
       </A><BR>
    <I>Wed Jan 26 10:57:14 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009380.html">[Twisted-Python] subpackages not getting installed
</A></li>
        <LI>Next message: <A HREF="009381.html">[Twisted-Python] Problem with ClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9379">[ date ]</a>
              <a href="thread.html#9379">[ thread ]</a>
              <a href="subject.html#9379">[ subject ]</a>
              <a href="author.html#9379">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've been writing a small client program connecting to the server through 
SSL when occurred a strange problem. At the beginning I thought that it was 
my fault, I changed my mind after examining examples (exactly 
echoclient_ssl.py) shipped with the Twisted distribution, though. After 
many try-and-fails I think I found the problematic code. I created this 
test case to show the issue:
#v+
from OpenSSL import SSL
from twisted.internet.protocol import ClientFactory
from twisted.protocols.basic import LineOnlyReceiver

class Protocol(LineOnlyReceiver):
    def connectionMade(self):
        self.sendLine(&quot;GET / HTTP/1.0\n&quot;)

    def lineReceived(self, line):
        print line

class Factory(ClientFactory):
    protocol = Protocol
    def startedConnecting(self, connector):
        print &quot;Connecting...&quot;

    def buildProtocol(self, addr):
        print &quot;Connected.&quot;

    def clientConnectionLost(self, connector, reason):
        print &quot;Connection Lost.&quot;
        reactor.stop()

    def clientConnectionFailed(self, connector, reason):
        print &quot;Connection Failed.&quot;
        reactor.stop()

if __name__ == &quot;__main__&quot;:
    host = &quot;sf.net&quot;
    port = 443
    from twisted.internet import reactor, ssl
    reactor.connectSSL(host, port, Factory(), ssl.ClientContextFactory())
    reactor.run()
#v-

After running this code I get &quot;Connecting, Connected&quot; lines and long 
tracebacks warning about two exceptions (I could attach it, if it was 
useful).

$ rpm -q python-Twisted python-pyOpenSSL; uname -o
python-Twisted-1.3.0-7
python-pyOpenSSL-0.6-2
PLD Linux

The most interesting (funny?) thing with this problem is the simplest 
workaround - after removing startedConnecting and buildProtocol methods of 
Factory class everything works fine, I get the response from the server and 
requested page. Is that meant to (not)work that way? If so, please write it 
somewhere in the HOWTO using big letters, otherwise let somebody fix 
it. ;-)

P.S. HTTPS is just an example. I know about dedicated software for that 
purpose, but it's useless for me. ;-) I'm just wondering about the cause of 
this problem.
-- 
Michal Chruszcz -=- Seen at <A HREF="http://1lo.sanok.pl/~troll/gallery.php">http://1lo.sanok.pl/~troll/gallery.php</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009380.html">[Twisted-Python] subpackages not getting installed
</A></li>
	<LI>Next message: <A HREF="009381.html">[Twisted-Python] Problem with ClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9379">[ date ]</a>
              <a href="thread.html#9379">[ thread ]</a>
              <a href="subject.html#9379">[ subject ]</a>
              <a href="author.html#9379">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
