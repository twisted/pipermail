<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Accepting/merging patches for unsupported platforms without CI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Accepting/merging%20patches%20for%20unsupported%0A%20platforms%20without%20CI&In-Reply-To=%3C63567A30-8F36-41E3-B7A5-CD2D109ACFF1%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="064210.html">
   <LINK REL="Next"  HREF="064211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Accepting/merging patches for unsupported platforms without CI</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Accepting/merging%20patches%20for%20unsupported%0A%20platforms%20without%20CI&In-Reply-To=%3C63567A30-8F36-41E3-B7A5-CD2D109ACFF1%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Accepting/merging patches for unsupported platforms without CI">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Nov 27 21:22:39 MST 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="064210.html">[Twisted-Python] Accepting/merging patches for unsupported platforms without CI
</A></li>
        <LI>Next message (by thread): <A HREF="064211.html">[Twisted-Python] Accepting/merging patches for unsupported platforms without CI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64213">[ date ]</a>
              <a href="thread.html#64213">[ thread ]</a>
              <a href="subject.html#64213">[ subject ]</a>
              <a href="author.html#64213">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> On Nov 26, 2017, at 4:48 PM, Jean-Paul Calderone &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Sun, Nov 26, 2017 at 5:30 PM, Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Quite often—as I believe is the case for the patch you’re referring to here—patches are adjusting behaviors which would be difficult to cleanly integration-test on the platform in question anyway, and the appropriate thing to do is to make some mock match the observed behavior of the platform in question.
</I>&gt;<i> 
</I>&gt;<i> Just because there's enough misunderstanding about how to do this kind of thing and the words that describe it, I wanted to point out that this isn't really a &quot;mock&quot; - and it's certainly not something you would do with a library with &quot;mock&quot; in its name.
</I>
Martin Fowler has the authoritative glossary on this - <A HREF="https://www.martinfowler.com/bliki/TestDouble.html">https://www.martinfowler.com/bliki/TestDouble.html</A> &lt;<A HREF="https://www.martinfowler.com/bliki/TestDouble.html">https://www.martinfowler.com/bliki/TestDouble.html</A>&gt;.  I have my own entry in this genre which echoes and expands upon some of his definitions: <A HREF="https://thoughtstreams.io/glyph/test-patterns/">https://thoughtstreams.io/glyph/test-patterns/</A> &lt;<A HREF="https://thoughtstreams.io/glyph/test-patterns/">https://thoughtstreams.io/glyph/test-patterns/</A>&gt;.

However, I eventually acquiesced to the colloquial meaning of &quot;mock&quot; to mean &quot;test double&quot;; in most contexts where people are talking about &quot;mocks&quot; they're really talking about fakes, and the real actual mock-module-style mocks are increasingly universally understood to be technical debt.

&gt;<i> For those who don't know (not Glyph), a mock is an object that somehow records an exact sequence of operations (like &quot;my foo method was called with bar&quot; or &quot;my baz attribute was accessed&quot;).  These tend to result in very fragile tests because they operate at such a specific level.  Quite often entirely legitimate implementation changes invalidate the expectations of some mock and force corresponding test suite maintenance.
</I>
(As far as I know, we don't use the 'mock' module anywhere in Twisted, and we shouldn't start :).)

&gt;<i> A better approach is to make sure the platform-specific interface being tested has been reduced to its smallest possible scope and then create a verified fake which implements that interface.  The verification is performed by a test suite which can run against both implementations (the fake and the real - with the real version only being tested in the necessary environment).  All other related tests can use the verified fake instead of the real implementation and will run on all platforms.
</I>
The most important thing here is to reduce the number of duplicate fakes.

Completely verified fakes are unfortunately almost impossible to build.  If the faked API has good enough testing support that you can programmatically provoke all of its failure modes, then the only reason to build a fake is performance, which is rarely our most pressing problem :-).  So quite often even the best verified fakes will only be partially verified.  Even partial verification of things like kernel APIs can be a major challenge.  So it's often necessary to accept a fake which is not directly verified against the real API.

However, ad-hoc one-off fakes are at extremely high risk of drift.  If you are trying to verify the system under test's response to behavior X in a test, and you build a fake that implements X, Y, and Z for the sake of the test's set-up, naturally that new fake's Y and Z will be flaky and half-implemented (at best: its X may be quite half-baked as well).  Moreover, if the real X, Y or Z changes in the future, it's highly unlikely anyone will come along and update the mock for just that one test.

If that fake were shared among a large number of tests, though, or even better, distributed along with the real X, Y, and Z, there is at least a fighting chance that someone might update the fake in the future and notice that the system under test has an issue.

I believe the most important principle here is that test code is just code like any other code, and following generally good code-organization principles like well-defined interfaces, planning for maintenance over time, &quot;don't repeat yourself&quot;, clear locus of responsibility, etc etc, will prevent test suites and their attendant doubles from decaying into a sprawling and unmaintainable mess.  We have generally been making good progress on this over time, but it's important for everybody involved with Twisted to continue trying to reduce duplication in fakes, and improve the verification of the fakes we have, as we maintain our test suite.

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20171127/7208daed/attachment-0002.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="064210.html">[Twisted-Python] Accepting/merging patches for unsupported platforms without CI
</A></li>
	<LI>Next message (by thread): <A HREF="064211.html">[Twisted-Python] Accepting/merging patches for unsupported platforms without CI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64213">[ date ]</a>
              <a href="thread.html#64213">[ thread ]</a>
              <a href="subject.html#64213">[ subject ]</a>
              <a href="author.html#64213">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
