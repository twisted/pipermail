<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] conch server can't git clone
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20conch%20server%20can%27t%20git%20clone&In-Reply-To=%3C3DBAB72E-BF66-4114-B4A0-D85766D35FD5%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] conch server can't git clone</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20conch%20server%20can%27t%20git%20clone&In-Reply-To=%3C3DBAB72E-BF66-4114-B4A0-D85766D35FD5%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] conch server can't git clone">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Nov  5 21:48:59 MST 2017</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64181">[ date ]</a>
              <a href="thread.html#64181">[ thread ]</a>
              <a href="subject.html#64181">[ subject ]</a>
              <a href="author.html#64181">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I run Conch instead of OpenSSH on my personal server.

I tried to `git clone` a repository on said server, and I saw these logs on the server:

2017-11-06T04:45:49+0000 [twisted.conch.openssh_compat.factory.OpenSSHFactory] disabling non-fixed-group key exchange algorithms because we cannot find moduli file
2017-11-06T04:45:49+0000 [SSHServerTransport,817,1.2.3.4] kex alg, key alg: 'ecdh-sha2-nistp256' 'ecdsa-sha2-nistp256'
2017-11-06T04:45:49+0000 [SSHServerTransport,817,1.2.3.4] outgoing: 'aes128-ctr' 'hmac-sha2-256' 'none'
2017-11-06T04:45:49+0000 [SSHServerTransport,817,1.2.3.4] incoming: 'aes128-ctr' 'hmac-sha2-256' 'none'
2017-11-06T04:45:49+0000 [SSHServerTransport,817,1.2.3.4] NEW KEYS
2017-11-06T04:45:49+0000 [SSHServerTransport,817,1.2.3.4] starting service 'ssh-userauth'
2017-11-06T04:45:49+0000 [SSHService 'ssh-userauth' on SSHServerTransport,817,1.2.3.4] 'user' trying auth 'none'
2017-11-06T04:45:49+0000 [SSHService 'ssh-userauth' on SSHServerTransport,817,1.2.3.4] 'user' trying auth 'publickey'
2017-11-06T04:45:49+0000 [SSHService 'ssh-userauth' on SSHServerTransport,817,1.2.3.4] 'user' trying auth 'publickey'
2017-11-06T04:45:49+0000 [SSHService 'ssh-userauth' on SSHServerTransport,817,1.2.3.4] 'user' authenticated with 'publickey'
2017-11-06T04:45:49+0000 [SSHService 'ssh-userauth' on SSHServerTransport,817,1.2.3.4] starting service 'ssh-connection'
2017-11-06T04:45:49+0000 [SSHService 'ssh-connection' on SSHServerTransport,817,1.2.3.4] got channel 'session' request
2017-11-06T04:45:49+0000 [SSHChannel session (0) on SSHService 'ssh-connection' on SSHServerTransport,817,1.2.3.4] channel open
2017-11-06T04:45:49+0000 [SSHChannel session (0) on SSHService 'ssh-connection' on SSHServerTransport,817,1.2.3.4] unhandled request for env
2017-11-06T04:45:49+0000 [SSHChannel session (0) on SSHService 'ssh-connection' on SSHServerTransport,817,1.2.3.4] executing command &quot;git-upload-pack '/site'&quot;
2017-11-06T04:45:51+0000 [-] sending eof
2017-11-06T04:45:51+0000 [-] exitCode: 0
2017-11-06T04:45:51+0000 [-] sending request 'exit-status'
2017-11-06T04:45:51+0000 [SSHChannel session (0) on SSHService 'ssh-connection' on SSHServerTransport,817,1.2.3.4] sending close 0
2017-11-06T04:45:51+0000 [SSHChannel session (0) on SSHService 'ssh-connection' on SSHServerTransport,817,1.2.3.4] remote close
2017-11-06T04:45:51+0000 [SSHChannel session (0) on SSHService 'ssh-connection' on SSHServerTransport,817,1.2.3.4] shell closed
2017-11-06T04:45:51+0000 [SSHServerTransport,817,1.2.3.4] Got remote error, code 11
	reason: disconnected by user
2017-11-06T04:45:51+0000 [SSHServerTransport,817,1.2.3.4] avatar user logging out (0)
2017-11-06T04:45:51+0000 [SSHServerTransport,817,1.2.3.4] connection lost

And on the client (which is OpenSSH):

$ git clone server:/site WebSite
Cloning into 'WebSite'...
remote: Counting objects: 712, done.
remote: Compressing objects: 100% (528/528), done.
fatal: The remote end hung up unexpectedlyiB | 13.04 MiB/s
fatal: early EOF
fatal: index-pack failed

Anyone have any idea how I could debug this?  My immediate hypothesis is that Conch is treating an EOF / half-close somewhere as a full-close of a session, but I am not sure where to go looking.

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20171105/ae12ddd2/attachment-0002.html&gt;
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64181">[ date ]</a>
              <a href="thread.html#64181">[ thread ]</a>
              <a href="subject.html#64181">[ subject ]</a>
              <a href="author.html#64181">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
