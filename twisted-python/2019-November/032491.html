<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] sharing a dict between child processes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20sharing%20a%20dict%20between%20child%20processes&In-Reply-To=%3C1999449.iMQn4rLfX3%40hyperion%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="032490.html">
   <LINK REL="Next"  HREF="032492.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] sharing a dict between child processes</H1>
    <B>Maarten ter Huurne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20sharing%20a%20dict%20between%20child%20processes&In-Reply-To=%3C1999449.iMQn4rLfX3%40hyperion%3E"
       TITLE="[Twisted-Python] sharing a dict between child processes">maarten at treewalker.org
       </A><BR>
    <I>Wed Nov  6 07:21:22 MST 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="032490.html">[Twisted-Python] sharing a dict between child processes
</A></li>
        <LI>Next message (by thread): <A HREF="032492.html">[Twisted-Python] sharing a dict between child processes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32491">[ date ]</a>
              <a href="thread.html#32491">[ thread ]</a>
              <a href="subject.html#32491">[ subject ]</a>
              <a href="author.html#32491">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wednesday, 6 November 2019 07:19:56 CET Waqar Khan wrote:
&gt;<i> Hi,
</I>&gt;<i> So, I am writing a twisted server. This server spawn multiple child
</I>&gt;<i> processes using reactor spawnProcess that initializes a process
</I>&gt;<i> protocol.
</I>&gt;<i> 
</I>&gt;<i> Now, each of the childprocess receives some REST requests. Each
</I>&gt;<i> process has a dict that acts as cache.
</I>&gt;<i> Now, I want to share dict across processes.
</I>&gt;<i> In general, python has SharedMemoryManager in multiprocessing module
</I>&gt;<i> which would have helped.
</I>&gt;<i> <A HREF="https://docs.python.org/3/library/multiprocessing.shared_memory.html#m">https://docs.python.org/3/library/multiprocessing.shared_memory.html#m</A>
</I>&gt;<i> ultiprocessing.managers.SharedMemoryManager.SharedMemory But since I
</I>&gt;<i> am using twisted internal process implementation, how do I share this
</I>&gt;<i> dict across the processes so that all the processes use this common
</I>&gt;<i> cache?
</I>
Keeping a dictionary in SharedMemoryManager seems far from trivial. I 
don't think you can allocate arbitrary Python objects in the shared 
memory and even if you could, you would run into problems when one 
process mutates the dictionary while another is looking up something or 
also mutating it.

It could in theory work if you implement a custom lock-less dictionary, 
but that would be a lot of work and hard to get right. Also having 
shared memory mutations be synced between multiple CPU cores could 
degrade performance, since keeping core-local CPU caches in sync is 
expensive.

Would it be an option to have only one process accept the REST requests, 
check whether the result is in the cache and only distribute work to the 
other processes if you get a cache miss? Typically the case where an 
answer is cached is pretty fast, so perhaps you don't need multiple 
processes to handle incoming requests.

Bye,
		Maarten



</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="032490.html">[Twisted-Python] sharing a dict between child processes
</A></li>
	<LI>Next message (by thread): <A HREF="032492.html">[Twisted-Python] sharing a dict between child processes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32491">[ date ]</a>
              <a href="thread.html#32491">[ thread ]</a>
              <a href="subject.html#32491">[ subject ]</a>
              <a href="author.html#32491">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
