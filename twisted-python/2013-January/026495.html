<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Testing Twisted code without trial
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Testing%20Twisted%20code%20without%20trial&In-Reply-To=CAFycZ9fZfn7LEZWdu4-bqd6rJFUY7N6op8zoMdfYZX%3DrHkYbtQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026477.html">
   <LINK REL="Next"  HREF="026478.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Testing Twisted code without trial</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Testing%20Twisted%20code%20without%20trial&In-Reply-To=CAFycZ9fZfn7LEZWdu4-bqd6rJFUY7N6op8zoMdfYZX%3DrHkYbtQ%40mail.gmail.com"
       TITLE="[Twisted-Python] Testing Twisted code without trial">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Jan 22 15:03:29 EST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026477.html">[Twisted-Python] Testing Twisted code without trial
</A></li>
        <LI>Next message: <A HREF="026478.html">[Twisted-Python] Twisted client memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26495">[ date ]</a>
              <a href="thread.html#26495">[ thread ]</a>
              <a href="subject.html#26495">[ subject ]</a>
              <a href="author.html#26495">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09:29 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A> wrote:
&gt;<i>On 22 January 2013 02:21,  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:
</I>&gt;&gt;<i>On 20 Jan, 02:35 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">adi at roiban.ro</A> wrote:
</I>&gt;&gt;&gt;<i>Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I start my pet project using Python Nose as test runner. At the 
</I>&gt;&gt;&gt;<i>start,
</I>&gt;&gt;&gt;<i>Twisted not used at all.
</I>&gt;&gt;&gt;<i>Later I discovered Twisted and start using it... but testing Twisted
</I>&gt;&gt;&gt;<i>requires trial.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I resist migrating to Trial and ended up with a custom code for
</I>&gt;&gt;&gt;<i>running Twisted tests together with Nose:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i><A HREF="https://github.com/chevah/chevah-rhinoplasty">https://github.com/chevah/chevah-rhinoplasty</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I though I can share this code on the list, in case there is someone
</I>&gt;&gt;&gt;<i>else wrestling with deferres testing outside of Trial.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Any feedback or comments is much appreciated.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>The implementation is somewhat saddening in its use of Twisted 
</I>&gt;&gt;<i>internals
</I>&gt;&gt;<i>(which makes it fragile and subject to easy breakage by new Twisted
</I>&gt;&gt;<i>releases) and limited platform support (it won't work on Windows,
</I>&gt;&gt;<i>afaik).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>You may also find problems with direct use of `reactor.iterate`, since
</I>&gt;&gt;<i>use of this API is highly discouraged due to re-entrancy issues and 
</I>&gt;&gt;<i>its
</I>&gt;&gt;<i>implementation is not all that well tested by Twisted's own test 
</I>&gt;&gt;<i>suite.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>If it works for you, great, but I would hesitate to recommend it to 
</I>&gt;&gt;<i>new
</I>&gt;&gt;<i>projects as a testing tool.  As Itamar suggests, nose should be able 
</I>&gt;&gt;<i>to
</I>&gt;&gt;<i>run xUnit-style tests.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Jean-Paul
</I>&gt;<i>
</I>&gt;<i>Thanks for your feedback.
</I>&gt;<i>
</I>&gt;<i>----
</I>&gt;<i>
</I>&gt;<i>The new methods successResultOf and failureResultOf looks good, but I
</I>&gt;<i>think they only work with deferred that already have a result.
</I>&gt;<i>
</I>&gt;<i>----
</I>&gt;<i>
</I>&gt;<i>I am aware that the whole thing is fragile... and I am aware of the
</I>&gt;<i>consequences of using internal non-public methods.
</I>&gt;<i>
</I>&gt;<i>I checked the code from twisted.trial.unittest.TestCase but I could
</I>&gt;<i>not spot how it waits for deferreds execution.
</I>&gt;<i>
</I>&gt;<i>What part of twisted.trial.unittest.TestCase executes and waits for
</I>&gt;<i>the deferred?
</I>&gt;<i>
</I>&gt;<i>Can I use that code to implement something similar to successResultOf
</I>&gt;<i>and failureResultOf but which also executes the deferred?
</I>
Hi Adi,

trial does what it does by touching a lot of internal stuff as well. 
This is still bad, but at least it's our fault if it ever breaks instead 
of yours.  There's also a long term plan (or &quot;plan&quot; may be putting it 
too strongly, perhaps I should say &quot;hope&quot;) that this part of trial will 
change to only use public interfaces.  This will probably require 
reactors actually implementing restartability, or it will require 
changing the trial feature slightly (eg, so it starts a reactor, runs 
all tests, then stops the reactor - if it did this, I'm sure you can 
imagine how &quot;waiting&quot; for a Deferred would just be adding a callback to 
the right place, as in any other Twisted-based application).

Are you interested in helping out with making reactors restartable? :)
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>This code also works on Windows and on other Unix systems (OSX, 
</I>&gt;<i>Solaris)
</I>
Okay.  I expected otherwise when I saw `_UnixWaker` in the 
implementation, but reading more carefully I now see that the code 
doesn't ever try to instantiate or use one of these, it just needs it 
for type checking.  My mistake!

Jean-Paul

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026477.html">[Twisted-Python] Testing Twisted code without trial
</A></li>
	<LI>Next message: <A HREF="026478.html">[Twisted-Python] Twisted client memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26495">[ date ]</a>
              <a href="thread.html#26495">[ thread ]</a>
              <a href="subject.html#26495">[ subject ]</a>
              <a href="author.html#26495">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
