<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20inlineCallbacks%3A%20multiple%20yielding%20same%0A%09Defferred%20behaviour&In-Reply-To=%3C06e201cdfd3d%2441dedf50%24c59c9df0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058975.html">
   <LINK REL="Next"  HREF="058979.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour</H1>
    <B>Sergey V. Gerasimov</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20inlineCallbacks%3A%20multiple%20yielding%20same%0A%09Defferred%20behaviour&In-Reply-To=%3C06e201cdfd3d%2441dedf50%24c59c9df0%24%40gmail.com%3E"
       TITLE="[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour">sergun at gmail.com
       </A><BR>
    <I>Mon Jan 28 02:52:58 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058975.html">[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour
</A></li>
        <LI>Next message (by thread): <A HREF="058979.html">[Twisted-Python] inlineCallbacks: multiple yielding same Defferred behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58976">[ date ]</a>
              <a href="thread.html#58976">[ thread ]</a>
              <a href="subject.html#58976">[ subject ]</a>
              <a href="author.html#58976">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>My target is just to deny request duplications.

 

Reg. inlineCallbacks.. What do you think is it possible to implement
inlineCallbacks generator in the way allows multiple yields? (but do not
modify Defferred)

 

From: Laurens Van Houtven [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.cc</A>] 
Sent: Monday, January 28, 2013 1:43 PM
To: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>
Subject: Re: [Twisted-Python] inlineCallbacks: multiple yielding same
Defferred behaviour

 

The short answer is that those models don't support chaining the way
Deferreds do, IIUC.

I think a very similar thing was a bonus question at the tutorial Stephen
Thorne and I gave at EuroPython last year. Do you want to cache results as
well, or only not make duplicate requests when one is in-flight?

 

On Mon, Jan 28, 2013 at 10:36 AM, Sergey V. Gerasimov &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>&gt;
wrote:

Hi Laurens,

 

Thanks for your reply!

 

I need something like this.

A server that processes requests and handles situation when there are 2
requests with same key.

 

class Server(object):

                def __init__(self):

                                self.requestsInProgress = {} # dict: key -&gt;
Deferred with result

 

                @defer.inlineCallbacks

                def request(self, key):

                               in_progress = key in self.requests

                               if in_progress:

                                               d = self.requestsInProgress
[key]

                                               result = yield d

                               else:

                                               d = process_request(key)

                                               self.requests[key] = d

                                               result = yield d

                                               del self.requestsInProgress
[key]

                               defer.returnValue(result)

 

How can I implement the logic correctly?

 

In my opinion it's very simple and clear concept to consider Deferred just
like deferred execution of some action. In this case you should be able to
get it's result (doing yield) many times (why not?).

 

 

I have deal with Task-based programming and async functions (mechanism
similar to Deferred and inlineCallbacks decorated functions in Twisted) in
Microsoft  .NET.

MS people have implemented Task (analogue of Deferred) in the way I
described.

 

 

 

From: Laurens Van Houtven [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.cc</A>] 
Sent: Monday, January 28, 2013 12:47 PM
To: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>; Twisted general discussion
Subject: Re: [Twisted-Python] inlineCallbacks: multiple yielding same
Defferred behaviour

 

I'm not entirely sure why you feel this is unintuitive or why you should
need a workaround; in any other case, deferreds work pretty much the same
way.

When reading this code, the first question that pops up in my head is: why
are you doing this instead of just using the result that you already have
(and assigned to a name)? How did this  waiting-twice-on-one-deferred
happen?

 

On Mon, Jan 28, 2013 at 8:47 AM, Sergey V. Gerasimov &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>&gt;
wrote:

It's not intuitively clear why multiple yielding the same Defferred in
function decorated with defer.inlineCallbacks get different results:

 

@defer.inlineCallbacks

def f():

                d = defer.succeed(1)

                result = yield d

print result

                result = yield d

print result

 

Output:

1

None

 

Probably we SHOULD NOT think if &quot;d&quot; was or was not yielded before when using
inlineCallbacks..

 

Are they some workarounds?

 


_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>




-- 

cheers

lvh




-- 

cheers

lvh

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20130128/79222f01/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058975.html">[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour
</A></li>
	<LI>Next message (by thread): <A HREF="058979.html">[Twisted-Python] inlineCallbacks: multiple yielding same Defferred behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58976">[ date ]</a>
              <a href="thread.html#58976">[ thread ]</a>
              <a href="subject.html#58976">[ subject ]</a>
              <a href="author.html#58976">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
