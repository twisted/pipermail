<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Must avatarId always be a string?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Must%20avatarId%20always%20be%20a%20string%3F&In-Reply-To=1357828914.29545.140661175828693.55A45495%40webmail.messagingengine.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026420.html">
   <LINK REL="Next"  HREF="026434.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Must avatarId always be a string?</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Must%20avatarId%20always%20be%20a%20string%3F&In-Reply-To=1357828914.29545.140661175828693.55A45495%40webmail.messagingengine.com"
       TITLE="[Twisted-Python] Must avatarId always be a string?">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Jan 13 01:39:31 EST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026420.html">[Twisted-Python] Must avatarId always be a string?
</A></li>
        <LI>Next message: <A HREF="026434.html">[Twisted-Python] Must avatarId always be a string?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26433">[ date ]</a>
              <a href="thread.html#26433">[ thread ]</a>
              <a href="subject.html#26433">[ subject ]</a>
              <a href="author.html#26433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jan 10, 2013, at 6:41 AM, Peter Westlake &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">peter.westlake at pobox.com</A>&gt; wrote:

&gt;<i> On Wed, Jan 9, 2013, at 18:02, Glyph wrote
</I>&gt;&gt;<i> On Jan 9, 2013, at 9:26 AM, Peter Westlake &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">peter.westlake at pobox.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;&gt;<i> On Jan 9, Adi wrote:
</I>&gt;&gt;&gt;&gt;<i> I am not an expert in Twisted, but from my understanding, the &quot;string&quot;
</I>&gt;&gt;&gt;&gt;<i> requirement is there to provide a plugable interface. So that you can
</I>&gt;&gt;&gt;&gt;<i> have generic credentials checkers, working with generic realms.
</I>&gt;&gt;&gt;&gt;<i> Having simple &quot;strings&quot; could also help with AvatarId serialization,
</I>&gt;&gt;&gt;&gt;<i> in case you have the CredentialsChecker on one computer and the you
</I>&gt;&gt;&gt;&gt;<i> will pass them over network/socket to a remote Realm.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Those are both good points! I'll leave it this way until there's
</I>&gt;&gt;&gt;<i> a more official way of doing it.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I hope it's clear that just hard-coding your avatars and realms to work
</I>&gt;&gt;<i> only with each other is a sub-optimal solution :).
</I>&gt;<i> 
</I>&gt;<i> Indeed :-)
</I>&gt;<i> 
</I>&gt;&gt;<i> The architecture of cred is supposed to be that you can plug realms and
</I>&gt;&gt;<i> checkers together so that a change to your authentication backend doesn't
</I>&gt;&gt;<i> completely change your application.  Of course, that architecture is
</I>&gt;&gt;<i> flawed in the sense that a string is a bit too narrow of a communication
</I>&gt;&gt;<i> channel to get information about the authenticated user from one to the
</I>&gt;&gt;<i> other, especially in cases where the application needs information from a
</I>&gt;&gt;<i> directory service to function.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If you're interested in an improved, official way to deal with this
</I>&gt;&gt;<i> use-case, the best way to do that would be to get involved and actively
</I>&gt;&gt;<i> try to specify what you need.
</I>&gt;<i> 
</I>&gt;<i> Here's my use case. The CredentialsChecker takes a login name,
</I>&gt;<i> e.g. &quot;pwest&quot;, and looks it up in LDAP. It gets back an LDAP record
</I>&gt;<i> something like this:
</I>&gt;<i> 
</I>&gt;<i> {
</I>&gt;<i>   'distinguishedName': 'CN=Peter Westlake,OU=User
</I>&gt;<i>   Accounts,OU=EMEA,DC=example,DC=com',
</I>&gt;<i>   'cn': 'Peter Westlake',
</I>&gt;<i>   'name': 'Peter Westlake',
</I>&gt;<i>   'sn': 'Westlake',
</I>&gt;<i>   'mail': '<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Peter.Westlake at example.com</A>',
</I>&gt;<i>   'givenName': 'Peter',
</I>&gt;<i>   'sAMAccountName': 'pwest'
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> It passes the distinguishedName and the supplied password
</I>&gt;<i> to the LDAP password checker function for authorization.
</I>&gt;<i> 
</I>&gt;<i> At this point the correct thing to do would be to return &quot;pwest&quot;
</I>&gt;<i> as the avatarId. But I've got all that other useful information
</I>&gt;<i> available, and it seems a shame to have to get it again in
</I>&gt;<i> the Realm, so I return the whole dictionary.
</I>
One potentially interesting question here, as well, is &quot;why sAMAccountName&quot; as the avatarID?  Isn't there a UID or UUID in there somewhere?  In my application, all the user identifiers are opaque, and that makes a bit more sense, since those values don't change, although any other part of the user's record could change as information evolves over time.  For example, if someone gets married and changes their name, they might find it annoying to have to log in with a username that references their maiden name all the time.

&gt;<i> Some points to note:
</I>&gt;<i> 
</I>&gt;<i> 1. Converting the dict to a string would make
</I>&gt;<i>   the avatarId conform to the interface, but
</I>&gt;<i>   it still wouldn't be pluggable, because other
</I>&gt;<i>   checkers wouldn't return the extra information.
</I>&gt;<i> 
</I>&gt;<i>   This strikes me as a general problem. If the
</I>&gt;<i>   checker returns more than an avatarId, whether
</I>&gt;<i>   directly or through some official-sanctioned channel,
</I>&gt;<i>   it will only be interchangeable with other
</I>&gt;<i>   checkers that also return the extra information.
</I>&gt;<i> 
</I>&gt;<i> 2. The application knows about LDAP, and uses it
</I>&gt;<i>   to find things like your manager and your email
</I>&gt;<i>   address. Some of this information is in the
</I>&gt;<i>   avatarId, but some of it isn't, so some LDAP
</I>&gt;<i>   calls will have to be made. This weakens the
</I>&gt;<i>   argument against duplicating the lookup.
</I>&gt;<i> 
</I>&gt;<i> The correct thing to do in this case would undoubtedly
</I>&gt;<i> be to accept that an LDAP call isn't very expensive,
</I>&gt;<i> and repeat it in the Realm. In other words, my use
</I>&gt;<i> case isn't very compelling. You have shamed me into
</I>&gt;<i> changing it :-)   In one way this is a good result,
</I>&gt;<i> though it doesn't help with the design.
</I>&gt;<i> 
</I>&gt;<i> Having made that change, I can use a password file
</I>&gt;<i> or an in-memory database for testing, and write
</I>&gt;<i> test scripts that don't need a real password. That's
</I>&gt;<i> well worth the /completely unnoticeable/ expense
</I>&gt;<i> of an extra LDAP call!
</I>
As other posters have already said, you can also have your realm and your checker share a reference to an object that caches credentials.  This would also let you cache other calls that are made later, too.

&gt;<i> BUT:
</I>&gt;<i> This only works because it doesn't use the user's
</I>&gt;<i> password for binding to LDAP. If it did, then either
</I>&gt;<i> the password or the LDAP session would have
</I>&gt;<i> to be made available to the Realm, and we're
</I>&gt;<i> back at square 1.
</I>
It seems like the &quot;shared caching reference&quot; would solve this problem as well?

-glyph


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026420.html">[Twisted-Python] Must avatarId always be a string?
</A></li>
	<LI>Next message: <A HREF="026434.html">[Twisted-Python] Must avatarId always be a string?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26433">[ date ]</a>
              <a href="thread.html#26433">[ thread ]</a>
              <a href="subject.html#26433">[ subject ]</a>
              <a href="author.html#26433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
