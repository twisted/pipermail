<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20inlineCallbacks%3A%20multiple%20yielding%20same%0A%09Defferred%20behaviour&In-Reply-To=CAE_Hg6aMRUYyrtvL3-Ki9fWd9FTbnUidZjnT-rPA7sk7eMKR4g%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026505.html">
   <LINK REL="Next"  HREF="026507.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour</H1>
    <B>Sergey V. Gerasimov</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20inlineCallbacks%3A%20multiple%20yielding%20same%0A%09Defferred%20behaviour&In-Reply-To=CAE_Hg6aMRUYyrtvL3-Ki9fWd9FTbnUidZjnT-rPA7sk7eMKR4g%40mail.gmail.com"
       TITLE="[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour">sergun at gmail.com
       </A><BR>
    <I>Mon Jan 28 04:37:36 EST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026505.html">[Twisted-Python] inlineCallbacks: multiple yielding same Defferred behaviour
</A></li>
        <LI>Next message: <A HREF="026507.html">[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26506">[ date ]</a>
              <a href="thread.html#26506">[ thread ]</a>
              <a href="subject.html#26506">[ subject ]</a>
              <a href="author.html#26506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Laurens,

 

Thanks for your reply!

 

I need something like this.

A server that processes requests and handles situation when there are 2
requests with same key.

 

class Server(object):

                def __init__(self):

                                self.requestsInProgress = {} # dict: key -&gt;
Deferred with result

 

                @defer.inlineCallbacks

                def request(self, key):

                               in_progress = key in self.requests

                               if in_progress:

                                               d = self.requestsInProgress
[key]

                                               result = yield d

                               else:

                                               d = process_request(key)

                                               self.requests[key] = d

                                               result = yield d

                                               del self.requestsInProgress
[key]

                               defer.returnValue(result)

 

How can I implement the logic correctly?

 

In my opinion it's very simple and clear concept to consider Deferred just
like deferred execution of some action. In this case you should be able to
get it's result (doing yield) many times (why not?).

 

 

I have deal with Task-based programming and async functions (mechanism
similar to Deferred and inlineCallbacks decorated functions in Twisted) in
Microsoft  .NET.

MS people have implemented Task (analogue of Deferred) in the way I
described.

 

 

From: Laurens Van Houtven [mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.cc</A>] 
Sent: Monday, January 28, 2013 12:47 PM
To: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>; Twisted general discussion
Subject: Re: [Twisted-Python] inlineCallbacks: multiple yielding same
Defferred behaviour

 

I'm not entirely sure why you feel this is unintuitive or why you should
need a workaround; in any other case, deferreds work pretty much the same
way.

When reading this code, the first question that pops up in my head is: why
are you doing this instead of just using the result that you already have
(and assigned to a name)? How did this  waiting-twice-on-one-deferred
happen?

 

On Mon, Jan 28, 2013 at 8:47 AM, Sergey V. Gerasimov &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>&gt;
wrote:

It's not intuitively clear why multiple yielding the same Defferred in
function decorated with defer.inlineCallbacks get different results:

 

@defer.inlineCallbacks

def f():

                d = defer.succeed(1)

                result = yield d

print result

                result = yield d

print result

 

Output:

1

None

 

Probably we SHOULD NOT think if &quot;d&quot; was or was not yielded before when using
inlineCallbacks..

 

Are they some workarounds?

 


_______________________________________________
Twisted-Python mailing list
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>




-- 

cheers

lvh

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20130128/7c276bff/attachment-0001.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20130128/7c276bff/attachment-0001.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026505.html">[Twisted-Python] inlineCallbacks: multiple yielding same Defferred behaviour
</A></li>
	<LI>Next message: <A HREF="026507.html">[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26506">[ date ]</a>
              <a href="thread.html#26506">[ thread ]</a>
              <a href="subject.html#26506">[ subject ]</a>
              <a href="author.html#26506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
