<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Must avatarId always be a string?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Must%20avatarId%20always%20be%20a%20string%3F&In-Reply-To=%3C1357828914.29545.140661175828693.55A45495%40webmail.messagingengine.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058890.html">
   <LINK REL="Next"  HREF="058904.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Must avatarId always be a string?</H1>
    <B>Peter Westlake</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Must%20avatarId%20always%20be%20a%20string%3F&In-Reply-To=%3C1357828914.29545.140661175828693.55A45495%40webmail.messagingengine.com%3E"
       TITLE="[Twisted-Python] Must avatarId always be a string?">peter.westlake at pobox.com
       </A><BR>
    <I>Thu Jan 10 07:41:54 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058890.html">[Twisted-Python] Must avatarId always be a string?
</A></li>
        <LI>Next message (by thread): <A HREF="058904.html">[Twisted-Python] Must avatarId always be a string?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58891">[ date ]</a>
              <a href="thread.html#58891">[ thread ]</a>
              <a href="subject.html#58891">[ subject ]</a>
              <a href="author.html#58891">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jan 9, 2013, at 18:02, Glyph wrote
&gt;<i> On Jan 9, 2013, at 9:26 AM, Peter Westlake &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">peter.westlake at pobox.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; On Jan 9, Adi wrote:
</I>&gt;<i> &gt;&gt; I am not an expert in Twisted, but from my understanding, the &quot;string&quot;
</I>&gt;<i> &gt;&gt; requirement is there to provide a plugable interface. So that you can
</I>&gt;<i> &gt;&gt; have generic credentials checkers, working with generic realms.
</I>&gt;<i> &gt;&gt; Having simple &quot;strings&quot; could also help with AvatarId serialization,
</I>&gt;<i> &gt;&gt; in case you have the CredentialsChecker on one computer and the you
</I>&gt;<i> &gt;&gt; will pass them over network/socket to a remote Realm.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Those are both good points! I'll leave it this way until there's
</I>&gt;<i> &gt; a more official way of doing it.
</I>&gt;<i> 
</I>&gt;<i> I hope it's clear that just hard-coding your avatars and realms to work
</I>&gt;<i> only with each other is a sub-optimal solution :).
</I>
Indeed :-)

&gt;<i> The architecture of cred is supposed to be that you can plug realms and
</I>&gt;<i> checkers together so that a change to your authentication backend doesn't
</I>&gt;<i> completely change your application.  Of course, that architecture is
</I>&gt;<i> flawed in the sense that a string is a bit too narrow of a communication
</I>&gt;<i> channel to get information about the authenticated user from one to the
</I>&gt;<i> other, especially in cases where the application needs information from a
</I>&gt;<i> directory service to function.
</I>&gt;<i> 
</I>&gt;<i> If you're interested in an improved, official way to deal with this
</I>&gt;<i> use-case, the best way to do that would be to get involved and actively
</I>&gt;<i> try to specify what you need.
</I>
Here's my use case. The CredentialsChecker takes a login name,
e.g. &quot;pwest&quot;, and looks it up in LDAP. It gets back an LDAP record
something like this:

{
   'distinguishedName': 'CN=Peter Westlake,OU=User
   Accounts,OU=EMEA,DC=example,DC=com',
   'cn': 'Peter Westlake',
   'name': 'Peter Westlake',
   'sn': 'Westlake',
   'mail': '<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Peter.Westlake at example.com</A>',
   'givenName': 'Peter',
   'sAMAccountName': 'pwest'
}

It passes the distinguishedName and the supplied password
to the LDAP password checker function for authorization.

At this point the correct thing to do would be to return &quot;pwest&quot;
as the avatarId. But I've got all that other useful information
available, and it seems a shame to have to get it again in
the Realm, so I return the whole dictionary.

Some points to note:

1. Converting the dict to a string would make
   the avatarId conform to the interface, but
   it still wouldn't be pluggable, because other
   checkers wouldn't return the extra information.

   This strikes me as a general problem. If the
   checker returns more than an avatarId, whether
   directly or through some official-sanctioned channel,
   it will only be interchangeable with other
   checkers that also return the extra information.

2. The application knows about LDAP, and uses it
   to find things like your manager and your email
   address. Some of this information is in the
   avatarId, but some of it isn't, so some LDAP
   calls will have to be made. This weakens the
   argument against duplicating the lookup.

The correct thing to do in this case would undoubtedly
be to accept that an LDAP call isn't very expensive,
and repeat it in the Realm. In other words, my use
case isn't very compelling. You have shamed me into
changing it :-)   In one way this is a good result,
though it doesn't help with the design.

Having made that change, I can use a password file
or an in-memory database for testing, and write
test scripts that don't need a real password. That's
well worth the /completely unnoticeable/ expense
of an extra LDAP call!

BUT:
This only works because it doesn't use the user's
password for binding to LDAP. If it did, then either
the password or the LDAP session would have
to be made available to the Realm, and we're
back at square 1.

Peter.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058890.html">[Twisted-Python] Must avatarId always be a string?
</A></li>
	<LI>Next message (by thread): <A HREF="058904.html">[Twisted-Python] Must avatarId always be a string?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58891">[ date ]</a>
              <a href="thread.html#58891">[ thread ]</a>
              <a href="subject.html#58891">[ subject ]</a>
              <a href="author.html#58891">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
