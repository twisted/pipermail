<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] inlineCallbacks: multiple yielding same Defferred behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20inlineCallbacks%3A%20multiple%20yielding%20same%0A%20Defferred%20behaviour&In-Reply-To=06e201cdfd3d%2441dedf50%24c59c9df0%24%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026507.html">
   <LINK REL="Next"  HREF="026508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] inlineCallbacks: multiple yielding same Defferred behaviour</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20inlineCallbacks%3A%20multiple%20yielding%20same%0A%20Defferred%20behaviour&In-Reply-To=06e201cdfd3d%2441dedf50%24c59c9df0%24%40gmail.com"
       TITLE="[Twisted-Python] inlineCallbacks: multiple yielding same Defferred behaviour">exarkun at twistedmatrix.com
       </A><BR>
    <I>Mon Jan 28 10:33:06 EST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026507.html">[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour
</A></li>
        <LI>Next message: <A HREF="026508.html">[Twisted-Python] Twisted-related talks and tutorials at PyCon
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26510">[ date ]</a>
              <a href="thread.html#26510">[ thread ]</a>
              <a href="subject.html#26510">[ subject ]</a>
              <a href="author.html#26510">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09:52 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A> wrote:
&gt;<i>My target is just to deny request duplications.
</I>&gt;<i>
</I>&gt;<i>Reg. inlineCallbacks.. What do you think is it possible to implement
</I>&gt;<i>inlineCallbacks generator in the way allows multiple yields? (but do 
</I>&gt;<i>not
</I>&gt;<i>modify Defferred)
</I>
No, this isn't possible.  Single-use is a fundamental aspect of 
Deferred.

Instead, you can make a second (and third, etc) Deferred that has the 
same result as the first.

Jean-Paul
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>From: Laurens Van Houtven [mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.cc</A>]
</I>&gt;<i>Sent: Monday, January 28, 2013 1:43 PM
</I>&gt;<i>To: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>
</I>&gt;<i>Subject: Re: [Twisted-Python] inlineCallbacks: multiple yielding same
</I>&gt;<i>Defferred behaviour
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>The short answer is that those models don't support chaining the way
</I>&gt;<i>Deferreds do, IIUC.
</I>&gt;<i>
</I>&gt;<i>I think a very similar thing was a bonus question at the tutorial 
</I>&gt;<i>Stephen
</I>&gt;<i>Thorne and I gave at EuroPython last year. Do you want to cache results 
</I>&gt;<i>as
</I>&gt;<i>well, or only not make duplicate requests when one is in-flight?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>On Mon, Jan 28, 2013 at 10:36 AM, Sergey V. Gerasimov 
</I>&gt;<i>&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>&gt;
</I>&gt;<i>wrote:
</I>&gt;<i>
</I>&gt;<i>Hi Laurens,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Thanks for your reply!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I need something like this.
</I>&gt;<i>
</I>&gt;<i>A server that processes requests and handles situation when there are 2
</I>&gt;<i>requests with same key.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>class Server(object):
</I>&gt;<i>
</I>&gt;<i>                def __init__(self):
</I>&gt;<i>
</I>&gt;<i>                                self.requestsInProgress = {} # dict: key 
</I>&gt;<i>-&gt;
</I>&gt;<i>Deferred with result
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>                @defer.inlineCallbacks
</I>&gt;<i>
</I>&gt;<i>                def request(self, key):
</I>&gt;<i>
</I>&gt;<i>                               in_progress = key in self.requests
</I>&gt;<i>
</I>&gt;<i>                               if in_progress:
</I>&gt;<i>
</I>&gt;<i>                                               d = 
</I>&gt;<i>self.requestsInProgress
</I>&gt;<i>[key]
</I>&gt;<i>
</I>&gt;<i>                                               result = yield d
</I>&gt;<i>
</I>&gt;<i>                               else:
</I>&gt;<i>
</I>&gt;<i>                                               d = process_request(key)
</I>&gt;<i>
</I>&gt;<i>                                               self.requests[key] = d
</I>&gt;<i>
</I>&gt;<i>                                               result = yield d
</I>&gt;<i>
</I>&gt;<i>                                               del 
</I>&gt;<i>self.requestsInProgress
</I>&gt;<i>[key]
</I>&gt;<i>
</I>&gt;<i>                               defer.returnValue(result)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>How can I implement the logic correctly?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>In my opinion it's very simple and clear concept to consider Deferred 
</I>&gt;<i>just
</I>&gt;<i>like deferred execution of some action. In this case you should be able 
</I>&gt;<i>to
</I>&gt;<i>get it's result (doing yield) many times (why not?).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I have deal with Task-based programming and async functions (mechanism
</I>&gt;<i>similar to Deferred and inlineCallbacks decorated functions in Twisted) 
</I>&gt;<i>in
</I>&gt;<i>Microsoft  .NET.
</I>&gt;<i>
</I>&gt;<i>MS people have implemented Task (analogue of Deferred) in the way I
</I>&gt;<i>described.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>From: Laurens Van Houtven [mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">_ at lvh.cc</A>]
</I>&gt;<i>Sent: Monday, January 28, 2013 12:47 PM
</I>&gt;<i>To: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>; Twisted general discussion
</I>&gt;<i>Subject: Re: [Twisted-Python] inlineCallbacks: multiple yielding same
</I>&gt;<i>Defferred behaviour
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I'm not entirely sure why you feel this is unintuitive or why you 
</I>&gt;<i>should
</I>&gt;<i>need a workaround; in any other case, deferreds work pretty much the 
</I>&gt;<i>same
</I>&gt;<i>way.
</I>&gt;<i>
</I>&gt;<i>When reading this code, the first question that pops up in my head is: 
</I>&gt;<i>why
</I>&gt;<i>are you doing this instead of just using the result that you already 
</I>&gt;<i>have
</I>&gt;<i>(and assigned to a name)? How did this  waiting-twice-on-one-deferred
</I>&gt;<i>happen?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>On Mon, Jan 28, 2013 at 8:47 AM, Sergey V. Gerasimov &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">sergun at gmail.com</A>&gt;
</I>&gt;<i>wrote:
</I>&gt;<i>
</I>&gt;<i>It's not intuitively clear why multiple yielding the same Defferred in
</I>&gt;<i>function decorated with defer.inlineCallbacks get different results:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>@defer.inlineCallbacks
</I>&gt;<i>
</I>&gt;<i>def f():
</I>&gt;<i>
</I>&gt;<i>                d = defer.succeed(1)
</I>&gt;<i>
</I>&gt;<i>                result = yield d
</I>&gt;<i>
</I>&gt;<i>print result
</I>&gt;<i>
</I>&gt;<i>                result = yield d
</I>&gt;<i>
</I>&gt;<i>print result
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Output:
</I>&gt;<i>
</I>&gt;<i>1
</I>&gt;<i>
</I>&gt;<i>None
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Probably we SHOULD NOT think if &quot;d&quot; was or was not yielded before when 
</I>&gt;<i>using
</I>&gt;<i>inlineCallbacks..
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Are they some workarounds?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-Python mailing list
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>
</I>&gt;<i>cheers
</I>&gt;<i>
</I>&gt;<i>lvh
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>
</I>&gt;<i>cheers
</I>&gt;<i>
</I>&gt;<i>lvh
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026507.html">[Twisted-Python] inlineCallbacks: multiple yielding same	Defferred behaviour
</A></li>
	<LI>Next message: <A HREF="026508.html">[Twisted-Python] Twisted-related talks and tutorials at PyCon
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26510">[ date ]</a>
              <a href="thread.html#26510">[ thread ]</a>
              <a href="subject.html#26510">[ subject ]</a>
              <a href="author.html#26510">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
