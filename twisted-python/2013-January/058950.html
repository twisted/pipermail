<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted client memory leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20client%20memory%20leak&In-Reply-To=%3CCAA7UhcnMSUQg4wttp9%2BchTcE%3Di9BWi0Sv0-aWRtkHOEZ7kgSGQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="058949.html">
   <LINK REL="Next"  HREF="058951.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted client memory leak</H1>
    <B>Diego Woitasen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Twisted%20client%20memory%20leak&In-Reply-To=%3CCAA7UhcnMSUQg4wttp9%2BchTcE%3Di9BWi0Sv0-aWRtkHOEZ7kgSGQ%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Twisted client memory leak">diego at woitasen.com.ar
       </A><BR>
    <I>Tue Jan 22 06:54:27 MST 2013</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="058949.html">[Twisted-Python] Twisted client memory leak
</A></li>
        <LI>Next message (by thread): <A HREF="058951.html">[Twisted-Python] Twisted client memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58950">[ date ]</a>
              <a href="thread.html#58950">[ thread ]</a>
              <a href="subject.html#58950">[ subject ]</a>
              <a href="author.html#58950">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Jan 22, 2013 at 10:38 AM, Marco Giusti &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">marco.giusti at gmail.com</A>&gt; wrote:
&gt;<i> On Tue, Jan 22, 2013 at 10:18:13AM -0300, Diego Woitasen wrote:
</I>&gt;&gt;<i> Here is the server code if you want to have a test:
</I>&gt;<i> [cut]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Tue, Jan 22, 2013 at 10:06 AM, Diego Woitasen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">diego at woitasen.com.ar</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; I have an Twisted client app that makes hundreds of connections per
</I>&gt;&gt;<i> &gt; minute. I discover that I have a memory leak un my app and I'm almost
</I>&gt;&gt;<i> &gt; sure that is related to the ClientFactory() derived class that is
</I>&gt;&gt;<i> &gt; never deleted.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I reproduce the problem with a modification of Echo client example
</I>&gt;&gt;<i> &gt; from Twisted documentation:
</I>&gt;&gt;<i> &gt;
</I>&gt;<i> [cut]
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; With this code I discover that the instances of EchoClientFactory()
</I>&gt;&gt;<i> &gt; are only deleted when the program shutdowns. They are not deleted when
</I>&gt;&gt;<i> &gt; the connections finish. I haven't found in the documentation if I need
</I>&gt;&gt;<i> &gt; to do some to get factory instances deleted.
</I>&gt;<i>
</I>&gt;<i> Add the following lines and see yourself, the factories are deleted as
</I>&gt;<i> aspected:
</I>&gt;<i>
</I>&gt;<i>         import gc
</I>&gt;<i>
</I>&gt;<i>         def collect():
</I>&gt;<i>             gc.collect()
</I>&gt;<i>
</I>&gt;<i>         signal.signal(signal.SIGUSR1,
</I>&gt;<i>                 lambda s, f: reactor.callLater(0.001, collect)
</I>&gt;<i>
</I>&gt;<i> m.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>

Ok, that's work. Thanks.

My question is now, why is this done automatically for EchoProtocol()
and not for EchoFactory()? Looks like the references are dropped why
Python is taking too much time to frees the memory.

An explanation around this is welcome :)

Regards,
   Diego

--
Diego Woitasen


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="058949.html">[Twisted-Python] Twisted client memory leak
</A></li>
	<LI>Next message (by thread): <A HREF="058951.html">[Twisted-Python] Twisted client memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58950">[ date ]</a>
              <a href="thread.html#58950">[ thread ]</a>
              <a href="subject.html#58950">[ subject ]</a>
              <a href="author.html#58950">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
