<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Compressing PB communication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Compressing%20PB%20communication&In-Reply-To=%3C20060630160803.29014.1273028000.divmod.quotient.16545%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="046086.html">
   <LINK REL="Next"  HREF="046091.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Compressing PB communication</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Compressing%20PB%20communication&In-Reply-To=%3C20060630160803.29014.1273028000.divmod.quotient.16545%40ohm%3E"
       TITLE="[Twisted-Python] Compressing PB communication">glyph at divmod.com
       </A><BR>
    <I>Fri Jun 30 10:08:03 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="046086.html">[Twisted-Python] Compressing PB communication
</A></li>
        <LI>Next message (by thread): <A HREF="046091.html">[Twisted-Python] Compressing PB communication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46089">[ date ]</a>
              <a href="thread.html#46089">[ thread ]</a>
              <a href="subject.html#46089">[ subject ]</a>
              <a href="author.html#46089">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 30 Jun 2006 12:24:43 +0300, Tzahi Fadida &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tzahi.ml at gmail.com</A>&gt; wrote:
&gt;<i>On Friday 30 June 2006 03:44, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:
</I>&gt;&gt;<i> On Thu, 29 Jun 2006 22:01:22 +0300, Tzahi Fadida &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">tzahi.ml at gmail.com</A>&gt; wrote:
</I>
&gt;&gt;<i> Not really.  PB is optimized (heavily optimized) for lots of small
</I>&gt;&gt;<i> control-channel messages.  Serializing 20MB of data with Jelly would
</I>&gt;&gt;<i> probably stop your process for a good 30 seconds, and due to the way that
</I>&gt;&gt;<i> the original Jelly was designed, it cannot be processed incrementally; you
</I>&gt;&gt;<i> will end up allocating something like 100MB of memory just to get the data
</I>&gt;&gt;<i> serialized and the packet sent, if you raise the limit.
</I>&gt;<i>
</I>&gt;<i>30 seconds of doing what? serializing?
</I>
Yeah.  This is just an estimate, of course, but passing 20 megabytes of structured data through jelly is going to be really slow.  It definitely should be faster, but nobody really has the inclination; people with harder performance requirements tend to just go use other protocols rather than improve PB, as Bruce mentioned with STOMP.

&gt;<i>Let me try something else, what if i want to replace jelly with pickle for
</I>&gt;<i>a special Server and Client factory for sending messages from the Server to
</I>&gt;<i>the client only. If the client sends a message to the server, they must
</I>&gt;<i>be jellied. The idea is that you are consciously saying that the client
</I>&gt;<i>completely trust the server.
</I>&gt;<i>I think this is a good idea for some security model that also want performance
</I>&gt;<i>and resource savings.
</I>
I don't think this is particularly a good idea, but then, it's an idea that has less and less to do with PB all the time.  You're talking about implementing a new protocol that has about two dozen features that PB does not have: support for pluggable serialization mechanisms, message tagging, on the fly compression, chunked encoding of large messages.  Some of these features would require that you change the way ordering guarantees work in PB and the way concurrency interacts with its API.  Maybe you could use some small portion of PB to build this monster of a protocol, but when you're done, you would not be using PB.

I can't see why you need the protocol machinery to do all of this for you.  If I were building this application I'd certainly just use streaming producers and send PB messages (over an existing, unmodified PB) that were of a reasonable size until all the data had been transferred.

Also, designing a protocol where you &quot;completely trust&quot; the other end of the wire, even if it is the &quot;server&quot;, is a bad idea.  You should only trust the other end of the wire if every message that it sends is encrypted and signed with a verified certificate, and even that is a stretch.  Using pickle at the protocol level means that during the verification process, you are vulnerable to attacks that use the pickled signature exchange to send you an exploit.

&gt;<i>I don't understand, you are saying that twisted does not send portions, i.e.
</I>&gt;<i>it is blocking? that doesn't sound right to me, even if i send 20mb of data
</I>&gt;<i>it should be portioned and let other transfer also get the chance.
</I>&gt;<i>I was under the impression that twisted is multiplexing even on the channel
</I>&gt;<i>level. I can, of course, always open 2 channels but this is evil.
</I>
If you send 20mb of data in a single write() call, that means you have at least 20mb of data sitting in the outbound write buffer until it can all be written, not to mention that the jelly serialization process is going to copy all of your data at least twice.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="046086.html">[Twisted-Python] Compressing PB communication
</A></li>
	<LI>Next message (by thread): <A HREF="046091.html">[Twisted-Python] Compressing PB communication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46089">[ date ]</a>
              <a href="thread.html#46089">[ thread ]</a>
              <a href="subject.html#46089">[ subject ]</a>
              <a href="author.html#46089">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
