<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Returning a deferred, maybe
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Returning%20a%20deferred%2C%20maybe&In-Reply-To=%3C3663EE1D-30FF-43A1-9C38-D3C9F4BB5522%40wsanchez.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="045905.html">
   <LINK REL="Next"  HREF="045908.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Returning a deferred, maybe</H1>
    <B>Wilfredo Sánchez Vega</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Returning%20a%20deferred%2C%20maybe&In-Reply-To=%3C3663EE1D-30FF-43A1-9C38-D3C9F4BB5522%40wsanchez.net%3E"
       TITLE="[Twisted-Python] Returning a deferred, maybe">wsanchez at wsanchez.net
       </A><BR>
    <I>Thu Jun 15 20:24:20 MDT 2006</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="045905.html">[Twisted-Python] Returning a deferred, maybe
</A></li>
        <LI>Next message (by thread): <A HREF="045908.html">[Twisted-Python] Returning a deferred, maybe
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45907">[ date ]</a>
              <a href="thread.html#45907">[ thread ]</a>
              <a href="subject.html#45907">[ subject ]</a>
              <a href="author.html#45907">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>   I guess I'm not seeing any justification for returning a deferred  
some of the time other than:

	- the micro-optimization (which your saying is silly) and

	- convenience for the callee (but wrapping a result in defer.succeed 
() is hardly a burden, and you are basically just passed the  
inconvenience down to every caller, which is usually a bad allocation  
of convenience-ness-es).

   The reason I thought it a good idea to require always returning a  
deferred is that I had a lot of code which depended on locateChild()  
to return a non-deferred value, which is clearly broken.  But none of  
the unit tests caught this, because I've never traversed a resource  
which returned a deferred in locateChild().  dreid pointed this out  
to me, so I changed some routines to fix this and had them always  
return a deferred, and sure enough, I ended up having to fix a *lot*  
of code.

   The point being that callers of functions that _usually_ return  
non-deferred values will usually work, enough so that it's hard to  
catch them with unit tests unless you go out of your way to ensure  
that deferreds are tested, which is unlikely if you also wrote the  
offending code.

	-wsv


On Jun 15, 2006, at 5:14 PM, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at divmod.com</A> wrote:

&gt;<i> On Thu, 15 Jun 2006 16:40:59 -0700, Wilfredo Sánchez Vega  
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">wsanchez at wsanchez.net</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>   It seems like you can save the caller some grief by ensuring  
</I>&gt;&gt;<i> that  you always return a deferred value (eg. by wrapping a  
</I>&gt;&gt;<i> synchronous  result with defer.succeed(), as suggested in <A HREF="http://">http://</A> 
</I>&gt;&gt;<i> twistedmatrix.com/ projects/core/documentation/howto/ 
</I>&gt;&gt;<i> gendefer.html).  Should this be an encouraged practice?
</I>&gt;<i>
</I>&gt;<i> There are 2 reasons for this practice.  One is a sort of silly  
</I>&gt;<i> micro-optimization (which vanishes anyway if the caller uses  
</I>&gt;<i> maybeDeferred) and the other is an issue of convenience for the  
</I>&gt;<i> callee.  We should forget about this and just make Deferred faster.
</I>&gt;<i>
</I>&gt;<i> Newer interfaces have tended toward just saying &quot;@return a Deferred  
</I>&gt;<i> which...&quot; rather than &quot;@return a value or a Deferred&quot; unless they  
</I>&gt;<i> are highly public APIs like IResource and forgetting to wrap a 2- 
</I>&gt;<i> byte string return value is a real pain.
</I>&gt;<i>
</I>&gt;<i> In other words: document your interfaces precisely, and decide  
</I>&gt;<i> whose responsibility is to ensure that the value is a Deferred at  
</I>&gt;<i> some point, and you should probably prefer requiring it is a  
</I>&gt;<i> Deferred in most cases -- but I don't think that this is the sort  
</I>&gt;<i> of thing that should be in the coding standard.  It varies from  
</I>&gt;<i> situation to situation.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="045905.html">[Twisted-Python] Returning a deferred, maybe
</A></li>
	<LI>Next message (by thread): <A HREF="045908.html">[Twisted-Python] Returning a deferred, maybe
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45907">[ date ]</a>
              <a href="thread.html#45907">[ thread ]</a>
              <a href="subject.html#45907">[ subject ]</a>
              <a href="author.html#45907">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
