<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] AMP message length limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMP%20message%20length%20limit&In-Reply-To=%3CCAGQ70eu3wZHC7dJ-VMfMrv7VtyQng%2BkYUzKq9Ge2kS-amZWLfA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] AMP message length limit</H1>
    <B>Oon-Ee Ng</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMP%20message%20length%20limit&In-Reply-To=%3CCAGQ70eu3wZHC7dJ-VMfMrv7VtyQng%2BkYUzKq9Ge2kS-amZWLfA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] AMP message length limit">ngoonee.talk at gmail.com
       </A><BR>
    <I>Sun Nov 22 15:51:57 MST 2015</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62426">[ date ]</a>
              <a href="thread.html#62426">[ thread ]</a>
              <a href="subject.html#62426">[ subject ]</a>
              <a href="author.html#62426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've just (to my surprise) hit this. As I understand from searching
around, AMP messages are limited to ~64k due to the length prefix
being 16-bit. A change in my internal data being sent (using dicts
rather than lists) kicked one of my messages to way over that limit.

There's a bit of discussion here -
<A HREF="http://twistedmatrix.com/pipermail/twisted-python/2014-November/028947.html">http://twistedmatrix.com/pipermail/twisted-python/2014-November/028947.html</A>

Is there an internal twisted solution planned, or should I go ahead
and roll my own paging code? If the latter (as I strongly suspect),
could I get some comments on this idea:-

Original amp.Command had a single argument (amp.ListOf(amp.String())
and no response

Modified amp.Command, 4 arguments and 1 response
ID (sequentially generated by producer) - amp.Integer()
CurPage - amp.Integer()
TotalPage - amp.Integer()
ActualData - amp.ListOf(amp.String())
Response - RecievedPage - amp.Integer()

Questions:-
1. ID is so the client can be sure not to concatenate different lists
2. Do I need a response at all?
3. Should I attempt to plug as many list items as possible into each
page (requires length checking of json-encoded strings and repeated
encoding/checks) or just choose a suitable limit of list items (my
current max length is about 200 characters and average is 71) of maybe
300 list items per message? My current list is about 1k items in all,
and it's only going to get bigger.
4. I was intrigued by the mention of 'Tubes' in the link above. Found
it here - <A HREF="https://tubes.readthedocs.org/en/latest/tube.html">https://tubes.readthedocs.org/en/latest/tube.html</A> - should I
be using that instead? I'm writing a homegrown app which will only
really need (at this point) to communicate with itself and copies of
itself, and settled with AMP as being a simple way of achieving that.

Thanks for the time.


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62426">[ date ]</a>
              <a href="thread.html#62426">[ thread ]</a>
              <a href="subject.html#62426">[ subject ]</a>
              <a href="author.html#62426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
