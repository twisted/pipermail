<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] AMP message length limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMP%20message%20length%20limit&In-Reply-To=%3CCAGQ70eu_5%2Bot5i_xbx5fqXXSUzWovNpC3HAp-Jp8pHByv5RiNw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029968.html">
   <LINK REL="Next"  HREF="029975.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] AMP message length limit</H1>
    <B>Oon-Ee Ng</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20AMP%20message%20length%20limit&In-Reply-To=%3CCAGQ70eu_5%2Bot5i_xbx5fqXXSUzWovNpC3HAp-Jp8pHByv5RiNw%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] AMP message length limit">ngoonee.talk at gmail.com
       </A><BR>
    <I>Mon Nov 23 18:16:59 MST 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="029968.html">[Twisted-Python] AMP message length limit
</A></li>
        <LI>Next message: <A HREF="029975.html">[Twisted-Python] AMP message length limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29974">[ date ]</a>
              <a href="thread.html#29974">[ thread ]</a>
              <a href="subject.html#29974">[ subject ]</a>
              <a href="author.html#29974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Nov 23, 2015 at 8:54 AM, Glyph Lefkowitz
&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:
&gt;<i> I'm sorry that this was an unpleasant surprise.  I wish that we had a better
</I>&gt;<i> way of getting this across up-front :-).  However, it seems like the length
</I>&gt;<i> limit is doing its job in terms of constraining your protocol design to not
</I>&gt;<i> have individual messages &quot;hog&quot; the wire...
</I>
Yes, that it did.

&gt;<i> Definitely the latter if you have a short time frame.  How big are your
</I>&gt;<i> messages?  If your limit is still fairly small (5M, let's say) but much
</I>&gt;<i> bigger than 64k there are other options you can use.
</I>
I don't foresee it getting over an MB or so (as the data is being read
from disk, so unlikely that network I/O will be the biggest bottleneck
in this case).

&gt;&gt;<i> Questions:-
</I>&gt;&gt;<i> 1. ID is so the client can be sure not to concatenate different lists
</I>&gt;<i>
</I>&gt;<i> This... is correct, but doesn't sound like a question.  Is it meant to be?
</I>
Sorry, the real question is whether an ID is at all required. I'm not
using threads, and the concurrent AMP messages will be sent from a
single server process in a loop. Each client is guaranteed to have
only one server. In this situation, do I even need an ID?

&gt;<i> No.  You can tell AMP not to bother generating the protocol-level response
</I>&gt;<i> by setting the requiresAnswer flag on your Command to False:
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/documents/15.4.0/api/twisted.protocols.amp.Command.html#requiresAnswer">https://twistedmatrix.com/documents/15.4.0/api/twisted.protocols.amp.Command.html#requiresAnswer</A>&gt;
</I>
Thanks, right now I just have plenty of return {} everywhere. Does
requiresAnswer=False mean less bandwidth usage (no need to transmit an
empty dict)?

&gt;&gt;<i> 3. Should I attempt to plug as many list items as possible into each
</I>&gt;&gt;<i> page (requires length checking of json-encoded strings and repeated
</I>&gt;&gt;<i> encoding/checks) or just choose a suitable limit of list items (my
</I>&gt;&gt;<i> current max length is about 200 characters and average is 71) of maybe
</I>&gt;&gt;<i> 300 list items per message? My current list is about 1k items in all,
</I>&gt;&gt;<i> and it's only going to get bigger.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Why are you encoding as _both_ JSON and AMP?
</I>&gt;<i>
</I>&gt;<i> I'd say you should do the length-checking, because you still might end up
</I>&gt;<i> with list items that are larger than expected if they're variable size.
</I>
I'm sending classes over the wire by json-encoding their __dict__.
Although now that you mentioned it, I started doing that because I
believed AMP to be constrained to ASCII strings (before I found
amp.Unicode()) and my classes will almost always have unicode data.
Looks like I can skip a step then, will test that out.

I'm trying not to do length-checking simply because I'm lazy (and
because I'm abstracting out all the twisted parts into an SPClient and
SPServer which handle this data conversion transparently to the
working code). In particular the 'best' ways I can think to do
length-checking is to either:-
1. Binary search for an 'optimal' size just under a limit (50k for
sake of argument)
2. Single check which splits the length by half (300&gt;150&gt;75 etc.)
Both would clutter up the transmission code more than I would like at
this point, and could probably be added in future on transmission side
without any change in recipient side code. So it's on the backburner.

&gt;<i> I would love it if you would help me test out and develop Tubes.  If it is a
</I>&gt;<i> small homegrown app it might be a good use-case.  There are pros and cons:
</I>&gt;<i> Tubes has higher test coverage and cleaner code since it was developed much
</I>&gt;<i> more recently; but, it still has very limited functionality, badly broken
</I>&gt;<i> areas, and no compatibility guarantees, because it's still somewhat
</I>&gt;<i> experimental.
</I>&gt;<i>
</I>&gt;<i> However, Tubes is a way of implementing protocols, whereas AMP is an
</I>&gt;<i> implementation of a request/response protocol.  If you use Tubes, you'll
</I>&gt;<i> need to do an implementation of AMP (or something like it) in order to issue
</I>&gt;<i> requests and give responses.  If I were you, especially since you've already
</I>&gt;<i> figured out paging, I would probably just stick with AMP and Twisted as-is.
</I>
That's polite =). I'll keep it in mind. If there's a quick link
somewhere on 'badly broken area's I'd be interested, because without
knowing that it's hard to justify spending time there when I already
have something working with AMP. I especially like the idea of
streaming, but that'd require writing my code to accept data piecemeal
on the other end, and I can foresee that getting very messy very fast.

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029968.html">[Twisted-Python] AMP message length limit
</A></li>
	<LI>Next message: <A HREF="029975.html">[Twisted-Python] AMP message length limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29974">[ date ]</a>
              <a href="thread.html#29974">[ thread ]</a>
              <a href="subject.html#29974">[ subject ]</a>
              <a href="author.html#29974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
