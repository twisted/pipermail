<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20OT%20-%20adbapi%2C%20connection%20timeouts%2C%20mysql%20-%20OT&In-Reply-To=%3C20090827134600.7475.1532722245.divmod.xquotient.24%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052791.html">
   <LINK REL="Next"  HREF="052779.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20OT%20-%20adbapi%2C%20connection%20timeouts%2C%20mysql%20-%20OT&In-Reply-To=%3C20090827134600.7475.1532722245.divmod.xquotient.24%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Aug 27 07:46:00 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052791.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
        <LI>Next message (by thread): <A HREF="052779.html">[Twisted-Python] SFTP 2.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52799">[ date ]</a>
              <a href="thread.html#52799">[ thread ]</a>
              <a href="subject.html#52799">[ subject ]</a>
              <a href="author.html#52799">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26 Aug, 11:08 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">clay.gerrard at rackspace.com</A> wrote:
&gt;<i>The way that sqlalchemy implements pool_recycle is &quot;irrespective of 
</I>&gt;<i>idle time&quot; best I can tell from looking at it.  Keeping track of the 
</I>&gt;<i>last_used_time seems like it would have been equally reasonable, 
</I>&gt;<i>although perhaps even additional overhead.
</I>
It probably wouldn't be much more overhead.  The important question to 
consider is whether SQLAlchemy (and whoever else) had another good 
reason for doing it the way they do it.  Is monitoring idle time not 
sufficient for some systems?
&gt;<i>
</I>&gt;<i>I'm not sure I understand what you mean by &quot;parameterize the reactor&quot; - 
</I>&gt;<i>pass it as an argument when you initialize the (Re)ConnectionPool?  Can 
</I>&gt;<i>you point me to a twisted class that does this as an example?
</I>
Yep, that's what I meant.  You can find examples of this in some of the 
newer code in Twisted (as we only started to encourage it relatively 
recently).  One example is twisted.web.wsgi.WSGIResource; another is 
twisted.internet.task.deferLater.
&gt;<i>
</I>&gt;<i>I agree it would be very cool &quot;to do the reconnecting more proactively 
</I>&gt;<i>in idle threads&quot; - I'll have to think on that, do you know off-hand of 
</I>&gt;<i>any analogs?
</I>
Hm.  I can't think of any analogs, no.  I hope the implementation would 
be straightforward, though.  The connection pool can use 
reactor.callLater in the main thread to force old connections to be re- 
established, and it can take those connections out of the lineup while 
it's doing that, to make sure no queries are dispatched to them.  One 
tricky part, though, may be ensuring that a connection isn't actively 
servicing a query when time comes to recycle it.  The thread pool used 
by the connection pool may not currently have the features required for 
this (it doesn't allow messages to be directed at specific threads, for 
example).

This feature may also not be terribly important.  I don't know what the 
reconnect overhead actually is.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052791.html">[Twisted-Python] OT - adbapi, connection timeouts, mysql - OT
</A></li>
	<LI>Next message (by thread): <A HREF="052779.html">[Twisted-Python] SFTP 2.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52799">[ date ]</a>
              <a href="thread.html#52799">[ thread ]</a>
              <a href="subject.html#52799">[ subject ]</a>
              <a href="author.html#52799">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
