<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Really Basic clarification on defers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Really%20Basic%20clarification%20on%20defers&In-Reply-To=20090805151753.19518.1309660004.divmod.xquotient.21%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020162.html">
   <LINK REL="Next"  HREF="020166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Really Basic clarification on defers</H1>
    <B>John Aherne</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Really%20Basic%20clarification%20on%20defers&In-Reply-To=20090805151753.19518.1309660004.divmod.xquotient.21%40localhost.localdomain"
       TITLE="[Twisted-Python] Really Basic clarification on defers">johnaherne at rocs.co.uk
       </A><BR>
    <I>Wed Aug  5 18:04:10 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020162.html">[Twisted-Python] Really Basic clarification on defers
</A></li>
        <LI>Next message: <A HREF="020166.html">[Twisted-Python] Really Basic clarification on defers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20164">[ date ]</a>
              <a href="thread.html#20164">[ thread ]</a>
              <a href="subject.html#20164">[ subject ]</a>
              <a href="author.html#20164">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Aug 5, 2009 at 4:17 PM, &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A>&gt; wrote:

&gt;<i> On 09:33 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">johnaherne at rocs.co.uk</A> wrote:
</I>&gt;<i> &gt;On Wed, Aug 5, 2009 at 12:14 AM, Johann Borck
</I>&gt;<i> &gt;&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">johann.borck at densedata.com</A>&gt;wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;[snip]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Sendline is not blocking so as you say we can avoid the use of
</I>&gt;<i> &gt;deferreds and
</I>&gt;<i> &gt;continue to use sendline directly.
</I>&gt;<i>
</I>&gt;<i> LineReceiver.sendLine is not blocking, correct.  However, your statement
</I>&gt;<i> implies that if it were blocking, you could use Deferreds to address
</I>&gt;<i> this
</I>&gt;<i> problem.  This is incorrect.  Deferreds do not make blocking APIs into
</I>&gt;<i> non-blocking APIs.
</I>&gt;<i> &gt;[snip]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Our option 3 using defertothread does use sendline from the thread.
</I>&gt;<i> &gt;Your
</I>&gt;<i> &gt;response implies that is OK since you say defertothread is threadsafe.
</I>&gt;<i> &gt;Did
</I>&gt;<i> &gt;you really mean that.
</I>&gt;<i>
</I>&gt;<i> deferToThread is not thread-safe: you may only call it from the reactor
</I>&gt;<i> thread
</I>&gt;<i> (the thread in which you called reactor.run).
</I>&gt;<i>
</I>&gt;<i> Since deferToThread runs the function you pass to it in a non-reactor
</I>&gt;<i> thread,
</I>&gt;<i> you may not use any non-thread-safe Twisted APIs in the function you
</I>&gt;<i> pass to
</I>&gt;<i> it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Once again thanks for a very good response. That has cleared up a lot
</I>&gt;<i> &gt;of
</I>&gt;<i> &gt;confusion.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I suppose it would help if there was a paragraph at the start of the
</I>&gt;<i> &gt;twisted
</I>&gt;<i> &gt;documentation detailing what you have just said. So when they start on
</I>&gt;<i> &gt;deferreds you have some sort of context in which to interpret what is
</I>&gt;<i> &gt;being
</I>&gt;<i> &gt;said
</I>&gt;<i>
</I>&gt;<i> A significant effort is presently underway to improve the documentation
</I>&gt;<i> about
</I>&gt;<i> Deferreds.  Any specific feedback you have about it would be much
</I>&gt;<i> appreciated.
</I>&gt;<i> :)
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>
Jean-Paul

Thanks for the clarifications.

I assume what I meant by blocking was I would have to put a function into
deferToThread and add some callbacks to return the result. And not directly
calling sendline from the thread. This is what Jarrod suggested in his
reply. If I'm wrong, please say so.

I have read the thread regarding deferreds with interest, but did not feel I
knew enough to contribute.

I do feel qualified to ask some very daft questions. Unfortunately, I don't
see too many daft questions being asked in the list. I reckon if I need to
know the answer to them then some other people probably do as well but don't
put themselves forward. I see it as a way to document information that is
difficult to come by. And I really do appreciate the very good answers I get

However, after this little foray, I probably feel able to comment:--

The concept of deferreds is very simple. Everyone understands the concept -
even I do. The issue is how and why and where you should use them in
twisted.

Some Basic getting Started Points.

1. For simple network activity do not use deferreds. They are not necessary.
You can get a lot done without deferreds. And you don't know how to use them
yet. The reactor and the select will process the outgoing and incoming
buffers without blocking. Anyone familiar with networking and select will
already understand this. Anyone not familiar will not realise it and needs
to be made aware of how the select works.

2. If you have blocking code - please define blocking :), then first think
about  putting it into deferToThread with appropriate callbacks and return
the deferred. As suggested by Jarrod in his response.

3. John Goerzen in his Apress book Python Network Fundamentals has a very
simple chat server example. With a few comments for the uninitiated, this
would be a good starter. Possibly I could ask for permission to include it
in some twisted HOWTO documentation for beginners with suitable copyright
recognition.

4. With these few points as starters, maybe more people will be encouraged
to get started with twisted. And if you know you can ignore deferreds until
later you will find twisted is very simple to use and get some good results
with little effort.

5. The emphasis on how deferreds work probably ought to be counterbalanced
by some insight into how and why and where you would use them. For example,
if you have a text file of 10000 lines you need to read in and summarize,
presumably you would run this with deferToThread(+other options) and get the
result via the callback. If someone has a better example please let me know.

6. Blocking code is always put into a thread or like, and a deferred
callback or errback used to return the result or failure of the blocking
code from the thread. See jarrod's response above


You asked :)
I'm giving

I may be completely off track in what I have said above. And I would not
want anyone to fall upon this mail and think it represents the gospel truth.

Thank you for the response..

John Aherne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20090805/754a8c84/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20090805/754a8c84/attachment.htm</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020162.html">[Twisted-Python] Really Basic clarification on defers
</A></li>
	<LI>Next message: <A HREF="020166.html">[Twisted-Python] Really Basic clarification on defers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20164">[ date ]</a>
              <a href="thread.html#20164">[ thread ]</a>
              <a href="subject.html#20164">[ subject ]</a>
              <a href="author.html#20164">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
