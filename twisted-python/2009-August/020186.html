<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.positioning -- Interface,	or class with 	method stubs?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted.positioning%20--%20Interface%2C%0A%09or%20class%20with%20%09method%20stubs%3F&In-Reply-To=cedc0c090908091630j669877a4q3b2ad117a48f886e%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020185.html">
   <LINK REL="Next"  HREF="020189.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.positioning -- Interface,	or class with 	method stubs?</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted.positioning%20--%20Interface%2C%0A%09or%20class%20with%20%09method%20stubs%3F&In-Reply-To=cedc0c090908091630j669877a4q3b2ad117a48f886e%40mail.gmail.com"
       TITLE="[Twisted-Python] twisted.positioning -- Interface,	or class with 	method stubs?">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Aug  9 20:17:49 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020185.html">[Twisted-Python] twisted.positioning -- Interface,	or class with method stubs?
</A></li>
        <LI>Next message: <A HREF="020189.html">[Twisted-Python] twisted.positioning -- Interface,	or class with 	method stubs?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20186">[ date ]</a>
              <a href="thread.html#20186">[ thread ]</a>
              <a href="subject.html#20186">[ subject ]</a>
              <a href="author.html#20186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Aug 9, 2009 at 7:30 PM, Laurens Van Houtven &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">lvh at laurensvh.be</A>&gt;wrote:


&gt;<i> As you probably know, the interfaces for t.p live in t.p.ipositioning.
</I>&gt;<i> I still haven't quite understood why they are going to be awesome, but
</I>&gt;<i> anyway -- I'm running into a problem where keeping them would (I
</I>&gt;<i> think) imply a bunch of duplicated code.
</I>&gt;<i>
</I>
Have you read this?

<A HREF="http://glyph.twistedmatrix.com/2009/02/explaining-why-interfaces-are-great.html">http://glyph.twistedmatrix.com/2009/02/explaining-why-interfaces-are-great.html</A>


&gt;<i> The thing is, t.p.nmea.NMEAAdapter needs to (at least, I think so)
</I>&gt;<i> implement all of the methods of t.p.ipositioning.IPositioningProvider,
</I>&gt;<i> because people will subclass t.p.nmea.NMEAAdapter and override the
</I>&gt;<i> corresponding (stub) methods.
</I>

I don't think this is the case.  NMEAAdapter implements INMEAReceiver.  It
should take an IPositioningProvider as an *argument* somewhere, not
implement that interface itself.

A user implementing a position-aware application should be encouraged as
strongly as possible to avoid any NMEA-specific junk in their application
until it comes time to connect the app logic (IPositioningProvider) to the
actual device spitting out NMEA data.  After all, they're not going to be
able to easily make use of cell-tower positioning information if their
application class is hard-coded to subclass NMEAAdapter.

In order to get all of the stub methods implemented (otherwise people using
&gt;<i> the class need to implement *every* method, which is dumb, since a lot of
</I>&gt;<i> people won't care about things like GPS climb),
</I>

The general sentiment here is right, despite the terminology problem I
pointed out: somewhere, a user is going to implement an IPositioningProvider
and it's quite likely that they won't want to implement every method.  So
let's assume there's going to be a BasePositioningProvider which stubs out
many of these methods or unifies / simplifies them.

I would basically be copying every line of the body of the interface into
&gt;<i> the t.p.nmea.NMEAAdapter.
</I>&gt;<i>
</I>
Not quite.  For one thing, your method declaration lines will have a 'self'
in BasePositioningProvider, and in IPositioningProvider they won't.  (I
notice that this is not currently the case.  You should probably fix that:
interface method definitions should never include 'self'.)

Also, your methods' docstrings won't need to be as complete as those on the
interface, since they can just say &quot;implement L{IPositioningProvider.foo}
to...&quot;.

Finally, I hope *most* of the methods will actually have a body that has
some implementation; some default behavior that will be useful  For example,
remembering the last position / heading / speed / error so that
'positionReceived' can conveniently expect the last error received without
implementing that method itself.  One or two might be completely stubbed
out, but the interface can't contain any implementation.

This sounds like a dumb idea.
&gt;<i>
</I>
Let's assume the worst case: BasePositioningProvider has absolutely no
default behavior besides a no-op.  The level of duplication we're talking
about here is this:

    def positionReceived(self, latitude, longitude):
    def positioningErrorReceived(self, positioningError):
    def headingReceived(self, heading):
    def headingErrorReceived(self, headingError):
    def magneticHeadingReceived(self, magneticHeading):
    def altitudeReceived(self, altitude):
    def altitudeErrorReceived(self, altitudeError):
    def speedReceived(self, speed):
    def speedErrorReceived(self, speedError):
    def climbReceived(self, climb):
    def climbErrorReceived(self, climbError):

In other words, the duplicated code in question will be considerably shorter
than the body of the message you composed to fret about code duplication,
and *way* shorter than my response :-). This doesn't really seem excessive,
considering that there's no duplication of *functionality* (the interface
only specifies behavior, the base class implements it), only duplication of
text.

Subclassing the interface sounds like *entirely* the wrong thing to do,
&gt;<i> since the class is-not-an Interface.
</I>&gt;<i>
</I>
You're definitely right here.  It isn't just conceptually wrong, it's also
completely broken.  Subclassing an Interface creates another Interface (i.e.
instance of InterfaceClass) not a class or type.  In other words, you can't
instantiate it, and you can't call methods on it if you define any.  IIRC,
more recent versions of zope.interface will actually emit warnings if you
try to put methods which have definitions on an interface.

Another alternative is using getattr-with-default-value in order to
&gt;<i> call the methods, since then missing (non-implemented) methods will be
</I>&gt;<i> handled gracefully. I kinda like this one, mainly because it's very
</I>&gt;<i> little work ;-)
</I>

It's more work than you think.  If you misspell a method name, then the code
which invokes it will fail in a totally straightforward way: it won't invoke
your method, and as a result it will probably blow up.  If you use
getattr-with-default, then it silently does nothing.


&gt;<i> A third alternative would be to scrap the interface all together and
</I>&gt;<i> use a base class with method stubs (I'm deliberately not using the
</I>&gt;<i> word abstract there). This sounds like a bad idea because we'd be
</I>&gt;<i> losing the interface, but I'm not entirely sure why we want it in the
</I>&gt;<i> first place...
</I>&gt;<i>
</I>
I believe the real problem here is that you don't quite get the value of
interfaces.  Read that blog post that I linked to if you haven't already,
and if you have, let's talk about that instead.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20090809/1f475ea0/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20090809/1f475ea0/attachment.htm</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020185.html">[Twisted-Python] twisted.positioning -- Interface,	or class with method stubs?
</A></li>
	<LI>Next message: <A HREF="020189.html">[Twisted-Python] twisted.positioning -- Interface,	or class with 	method stubs?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20186">[ date ]</a>
              <a href="thread.html#20186">[ thread ]</a>
              <a href="subject.html#20186">[ subject ]</a>
              <a href="author.html#20186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
