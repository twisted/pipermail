<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] My first wxPython App with Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20My%20first%20wxPython%20App%20with%20Twisted&In-Reply-To=%3C562bcc10908041300g80f0ad5tf7c6e1233d83cfb4%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052658.html">
   <LINK REL="Next"  HREF="052670.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] My first wxPython App with Twisted</H1>
    <B>Kevin Horn</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20My%20first%20wxPython%20App%20with%20Twisted&In-Reply-To=%3C562bcc10908041300g80f0ad5tf7c6e1233d83cfb4%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] My first wxPython App with Twisted">kevin.horn at gmail.com
       </A><BR>
    <I>Tue Aug  4 14:00:55 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052658.html">[Twisted-Python] My first wxPython App with Twisted
</A></li>
        <LI>Next message (by thread): <A HREF="052670.html">[Twisted-Python] How to debug an AMP connection?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52659">[ date ]</a>
              <a href="thread.html#52659">[ thread ]</a>
              <a href="subject.html#52659">[ subject ]</a>
              <a href="author.html#52659">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Aug 4, 2009 at 2:28 PM, Thalassery Koran &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">koranthala at gmail.com</A>&gt;wrote:

&gt;<i> Hi,
</I>&gt;<i>    I am creating the first GUI app (wxPython based) using Twisted.
</I>&gt;<i>    I am facing an issue which I cannot seem to solve/understand due
</I>&gt;<i> to lack of trace or anything.
</I>&gt;<i>
</I>&gt;<i>    I had a big app written on twisted and now I am creating a login
</I>&gt;<i> screen to the app.
</I>&gt;<i>    The app used to work without any issues. I added the login screen
</I>&gt;<i> and the login screen comes up.
</I>&gt;<i>     But then everything freezes up. I have to force quit the python
</I>&gt;<i> application to get anything back. Can anyone help me solve it?
</I>&gt;<i>
</I>&gt;<i>    The code is as follows:
</I>&gt;<i>
</I>&gt;<i> import wx
</I>&gt;<i> import os
</I>&gt;<i> import logging
</I>&gt;<i>
</I>&gt;<i> from twisted.internet import wxreactor
</I>&gt;<i> wxreactor.install()
</I>&gt;<i> from twisted.internet import reactor #Called only after wxreactor.install()
</I>&gt;<i> from twisted.internet.task import LoopingCall
</I>&gt;<i>
</I>&gt;<i> import clientapp
</I>&gt;<i>
</I>&gt;<i> def opj(path):
</I>&gt;<i>    &quot;&quot;&quot; Convert paths to the platform-specific separator &quot;&quot;&quot;
</I>&gt;<i>    st = apply(os.path.join, tuple(path.split('/')))
</I>&gt;<i>    if path.startswith('/'):
</I>&gt;<i>        st = '/' + st
</I>&gt;<i>    return st
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class APPApp(wx.App):
</I>&gt;<i>    def OnInit(self):
</I>&gt;<i>        self.frame = APPFrame(None, -1, &quot; APP Login&quot;, size=(200, 150))
</I>&gt;<i>        self.panel = APPPanel(self.frame,-1)
</I>&gt;<i>        client = clientapp.setup_app()
</I>&gt;<i>        call = LoopingCall(client.run)
</I>&gt;<i>        call.start(.51)
</I>&gt;<i>        return True
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> def main():
</I>&gt;<i>    app = APPApp(0)
</I>&gt;<i>    reactor.registerWxApp(app)
</I>&gt;<i>    try:
</I>&gt;<i>        reactor.run()
</I>&gt;<i>    except StandardError:
</I>&gt;<i>        raise
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class APPPanel(wx.Panel):
</I>&gt;<i>    &quot;&quot;&quot; APP GUI PANEL
</I>&gt;<i>
</I>&gt;<i>    The panel in which the user name and password is typed.
</I>&gt;<i>    @var ID_LOGIN: Login buttons id. When this button is clicked, the data
</I>&gt;<i>        is stored for logging.
</I>&gt;<i>
</I>&gt;<i>    &quot;&quot;&quot;
</I>&gt;<i>    ID_LOGIN = wx.NewId()
</I>&gt;<i>
</I>&gt;<i>    def __init__(self, parent, id):
</I>&gt;<i>        self.parent = parent
</I>&gt;<i>        wx.Panel.__init__(self, parent, id, size=(200,150))
</I>&gt;<i>        self.quote = wx.StaticText(self, -1, &quot;APP Login&quot;,wx.Point(60, 10))
</I>&gt;<i>        wx.StaticText(self, wx.ID_ANY, &quot;User Name &quot;, wx.Point(20, 33))
</I>&gt;<i>        wx.StaticText(self, wx.ID_ANY, &quot;Password &quot;, wx.Point(20, 58))
</I>&gt;<i>        self.usernameBox = wx.TextCtrl(self, wx.ID_ANY, &quot;&quot;,
</I>&gt;<i> wx.Point(80, 31), wx.Size(100, wx.ID_ANY))
</I>&gt;<i>        self.usernameBox.SetFocus()
</I>&gt;<i>        self.passwordBox = wx.TextCtrl(self, wx.ID_ANY, &quot;&quot;,
</I>&gt;<i> wx.Point(80, 56), wx.Size(100, wx.ID_ANY), style=wx.TE_PASSWORD)
</I>&gt;<i>        self.button =wx.Button(self, self.ID_LOGIN, &quot;Login&quot;, wx.Point(60,
</I>&gt;<i> 88))
</I>&gt;<i>        wx.EVT_BUTTON(parent, self.ID_LOGIN, self.on_login)
</I>&gt;<i>
</I>&gt;<i>    def on_login(self, event):
</I>&gt;<i>        username = self.usernameBox.GetString(0, 128)
</I>&gt;<i>        password = self.passwordBox.GetString(0, 128)
</I>&gt;<i>        if username and password:
</I>&gt;<i>            self.parent.on_login_click(username, password)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class APPTaskBarIcon(wx.TaskBarIcon):
</I>&gt;<i>    ''' TaskBar Icon
</I>&gt;<i>
</I>&gt;<i>    So that the application is always alive on the taskbar.
</I>&gt;<i>    3 operations are possible, DoubleClick on the taskbar would bring up the
</I>&gt;<i>    window, right click will bring up options to restore or exit the tool.
</I>&gt;<i>
</I>&gt;<i>    '''
</I>&gt;<i>    TBMENU_RESTORE = wx.NewId()
</I>&gt;<i>    TBMENU_CLOSE   = wx.NewId()
</I>&gt;<i>
</I>&gt;<i>    def __init__(self, frame):
</I>&gt;<i>        wx.TaskBarIcon.__init__(self)
</I>&gt;<i>        self.frame = frame
</I>&gt;<i>        # Set the image
</I>&gt;<i>        icon = self.MakeIcon(self.frame.get_image())
</I>&gt;<i>        self.SetIcon(icon, &quot;APP&quot;)
</I>&gt;<i>        self.imgidx = 1
</I>&gt;<i>        # bind some events
</I>&gt;<i>        self.Bind(wx.EVT_TASKBAR_LEFT_DCLICK, self.OnTaskBarActivate)
</I>&gt;<i>        self.Bind(wx.EVT_MENU, self.OnTaskBarActivate,
</I>&gt;<i> id=self.TBMENU_RESTORE)
</I>&gt;<i>        self.Bind(wx.EVT_MENU, self.OnTaskBarClose, id=self.TBMENU_CLOSE)
</I>&gt;<i>
</I>&gt;<i>    def CreatePopupMenu(self):
</I>&gt;<i>        &quot;&quot;&quot; Right Click Popup Menu
</I>&gt;<i>
</I>&gt;<i>        This method is called by the base class when it needs to popup
</I>&gt;<i>        the menu for the default EVT_RIGHT_DOWN event.
</I>&gt;<i>
</I>&gt;<i>        &quot;&quot;&quot;
</I>&gt;<i>        menu = wx.Menu()
</I>&gt;<i>        menu.Append(self.TBMENU_RESTORE, &quot;Restore Window&quot;)
</I>&gt;<i>        menu.Append(self.TBMENU_CLOSE, &quot;Exit APP&quot;)
</I>&gt;<i>        return menu
</I>&gt;<i>
</I>&gt;<i>    def MakeIcon(self, img):
</I>&gt;<i>        &quot;&quot;&quot; Return the generated Icon.
</I>&gt;<i>
</I>&gt;<i>        This function is required because various platforms have different
</I>&gt;<i>        requirements for the icon size.
</I>&gt;<i>
</I>&gt;<i>        &quot;&quot;&quot;
</I>&gt;<i>        if &quot;wxMSW&quot; in wx.PlatformInfo:
</I>&gt;<i>            img = img.Scale(16, 16)
</I>&gt;<i>        elif &quot;wxGTK&quot; in wx.PlatformInfo:
</I>&gt;<i>            img = img.Scale(22, 22)
</I>&gt;<i>        icon = wx.IconFromBitmap(img.ConvertToBitmap() )
</I>&gt;<i>        return icon
</I>&gt;<i>
</I>&gt;<i>    def OnTaskBarActivate(self, evt):
</I>&gt;<i>        ''' Activation code - say DoubleClick etc. It raises the window '''
</I>&gt;<i>        if self.frame.IsIconized():
</I>&gt;<i>            self.frame.Iconize(False)
</I>&gt;<i>        if not self.frame.IsShown():
</I>&gt;<i>            self.frame.Show(True)
</I>&gt;<i>        self.frame.Raise()
</I>&gt;<i>
</I>&gt;<i>    def OnTaskBarClose(self, evt):
</I>&gt;<i>        ''' On right click and close, the frame itself is closed '''
</I>&gt;<i>        wx.CallAfter(self.frame.Close)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class APPFrame(wx.Frame):
</I>&gt;<i>    def __init__(self, parent, id, title, size=None):
</I>&gt;<i>        wx.Frame.__init__(self, parent, id, title,
</I>&gt;<i>                          size=size, pos=wx.Point(400, 300))
</I>&gt;<i>        icon = self.get_icon()
</I>&gt;<i>        self.SetIcon(icon)
</I>&gt;<i>        self.tbicon = APPTaskBarIcon(self)
</I>&gt;<i>        self.Show(True)
</I>&gt;<i>        self.Bind(wx.EVT_CLOSE, self.OnCloseWindow)
</I>&gt;<i>        self.Bind(wx.EVT_ICONIZE, self.OnIconify)
</I>&gt;<i>
</I>&gt;<i>    def on_login_click(self, username, password):
</I>&gt;<i>        self.Hide()
</I>&gt;<i>
</I>&gt;<i>    def OnCloseWindow(self, event):
</I>&gt;<i>        if self.tbicon is not None:
</I>&gt;<i>            self.tbicon.Destroy()
</I>&gt;<i>        event.Skip()
</I>&gt;<i>
</I>&gt;<i>    def OnIconify(self, event):
</I>&gt;<i>        self.Hide()
</I>&gt;<i>
</I>&gt;<i>    def get_image(self):
</I>&gt;<i>        img= wx.Image(opj('client.ico'), wx.BITMAP_TYPE_ICO)
</I>&gt;<i>        return img
</I>&gt;<i>
</I>&gt;<i>    def get_icon(self):
</I>&gt;<i>        img = self.get_image()
</I>&gt;<i>        icon = wx.IconFromBitmap(img.ConvertToBitmap() )
</I>&gt;<i>        return icon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> if __name__ == '__main__':
</I>&gt;<i>    main()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --------------
</I>&gt;<i> If somebody can help me out, I would be much obliged.
</I>&gt;<i>
</I>&gt;<i>
</I>Well, it's hard to say without looking at your Twisted code, but what
exactly is the LoopingCall for?  It seems like it would be run regardless of
whether the user had logged in or not.

I'm guessing, but maybe client.run() shouldn't be run until you have a
username and password?

Might be a place to start looking, anyway.  It looks like you've set things
up properly in main() an App.OnInit(), but I haven't worked with Twisted +
wx in a while (pre-wxreactor), so I'm not 100% sure...

I guess it boils down to what exactly client.run() does...

Kevin Horn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20090804/a2ba56d8/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052658.html">[Twisted-Python] My first wxPython App with Twisted
</A></li>
	<LI>Next message (by thread): <A HREF="052670.html">[Twisted-Python] How to debug an AMP connection?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52659">[ date ]</a>
              <a href="thread.html#52659">[ thread ]</a>
              <a href="subject.html#52659">[ subject ]</a>
              <a href="author.html#52659">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
