<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] what's a workaround for Ticket #3472 (sendmail has	no timeout)?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20what%27s%20a%20workaround%20for%20Ticket%20%233472%20%28sendmail%20has%0A%09no%20timeout%29%3F&In-Reply-To=%3C197801ca12d9%2471568820%240500a8c0%40yoda%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052638.html">
   <LINK REL="Next"  HREF="052639.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] what's a workaround for Ticket #3472 (sendmail has	no timeout)?</H1>
    <B>Dave Britton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20what%27s%20a%20workaround%20for%20Ticket%20%233472%20%28sendmail%20has%0A%09no%20timeout%29%3F&In-Reply-To=%3C197801ca12d9%2471568820%240500a8c0%40yoda%3E"
       TITLE="[Twisted-Python] what's a workaround for Ticket #3472 (sendmail has	no timeout)?">dave at davebritton.com
       </A><BR>
    <I>Sat Aug  1 12:54:04 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052638.html">[Twisted-Python] AssertionError: '' for &lt;module '__init__' from	'nfscraper\__init__.pyc'&gt; not in import cache
</A></li>
        <LI>Next message (by thread): <A HREF="052639.html">[Twisted-Python] what's a workaround for Ticket #3472 (sendmail	has no timeout)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52637">[ date ]</a>
              <a href="thread.html#52637">[ thread ]</a>
              <a href="subject.html#52637">[ subject ]</a>
              <a href="author.html#52637">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Trying to implement a custom mail service I have run into the problem that
this ticket describes:
====
Ticket #3472 (new defect )
Opened 10 months ago
Last modified 10 months ago
twisted.mail.smtp sendmail() should [have] parameters to be passed for the
retry and timeout logic supported by SMTPClientFactory:
The method: def sendmail() spawns SMTPSenderFactories without a default
timeout value. These cause factories to wait forever if there is no response
from the remote server. On prolonged periods of time, stale
SMTPSenderFactories accumulates and will cause file descriptors to ran out
(Couldn't bind: 24: Too many open files.)
====
What would be the best way for me to work around this?
Specifically, when I use twisted.mail.smtp sendmail() for a lengthy list, I
fairly quickly get the &quot;too many open files&quot; message.

I tried using a coiterator to send small enough batches of emails, waiting
for each batch to be done before sending the next, because the &quot;too many
files&quot; error seemed to be caused by creating too many deferreds when a too
large batch of emails was sent at once. This worked in a test simulation,
but with real emails the system never completes the batch, it just hangs
waiting for sendmail to return.

Is there a best timeout mechanism I should use to force sendmail's return?
What I can think of so far are these:
option 1: Call setTimeout() on the deferred returned by sendmail despite
this warning in the  source for Deferred.setTimeout():
&quot;warnings.warn(&quot;Deferred.setTimeout is deprecated.  Look for timeout support
specific to the API you are using instead.&quot;, DeprecationWarning,
stacklevel=2).
or option2: Patch a timeout argument into sendmail to have it passed to
SMTPSenderFactory(from_addr, to_addrs, msg, d)? Would this work? I can't
figure out how or if SMTPSenderFactory would handle a timeout argument.

Sorry for the long message. Thanks for your advice!
-Dave



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052638.html">[Twisted-Python] AssertionError: '' for &lt;module '__init__' from	'nfscraper\__init__.pyc'&gt; not in import cache
</A></li>
	<LI>Next message (by thread): <A HREF="052639.html">[Twisted-Python] what's a workaround for Ticket #3472 (sendmail	has no timeout)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52637">[ date ]</a>
              <a href="thread.html#52637">[ thread ]</a>
              <a href="subject.html#52637">[ subject ]</a>
              <a href="author.html#52637">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
