<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stop conditions and deferToThread()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20stop%20conditions%20and%20deferToThread%28%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019786.html">
   <LINK REL="Next"  HREF="019789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stop conditions and deferToThread()</H1>
    <B>Thomas Jakobsen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20stop%20conditions%20and%20deferToThread%28%29&In-Reply-To="
       TITLE="[Twisted-Python] stop conditions and deferToThread()">thomas.jakobsen at alexandra.dk
       </A><BR>
    <I>Wed Jun 10 06:04:16 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019786.html">[Twisted-Python] Application Design help - Concurrent but	not	Protocols based.
</A></li>
        <LI>Next message: <A HREF="019789.html">[Twisted-Python] stop conditions and deferToThread()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19788">[ date ]</a>
              <a href="thread.html#19788">[ thread ]</a>
              <a href="subject.html#19788">[ subject ]</a>
              <a href="author.html#19788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

As discussed in a previous thread

   <A HREF="http://twistedmatrix.com/pipermail/twisted-python/2009-May/019717.html">http://twistedmatrix.com/pipermail/twisted-python/2009-May/019717.html</A>

a task put in its own thread via deferToThread() won't stop even
though the reactor has stopped. It has to carry out its own check that
the reactor is running and stop if that is not the case.

My question is: Is it possible to use anything else than the
reactor.running as stop condition in this way? In my current twisted
application I would like to keep the reactor running but still have
some deferToThread jobs stop if e.g. an exception occurs in one of the
jobs.

In the code example below I try to use my own global field, running,
as stop condition, but it doesn't work. If I let bar() call
reactor.stop() after the time.sleep(3) and use reactor.running in
foo() it works, however.

import time
from twisted.internet import reactor
from twisted.internet.threads import deferToThread

running = True

def foo():
   while running:
       print &quot;working&quot;
       time.sleep(1)

def bar():
   time.sleep(3)
   print &quot;stopping&quot;
   running = False

d1 = deferToThread(foo)
d2 = deferToThread(bar)

reactor.run()


Best regards,
Thomas Jakobsen


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019786.html">[Twisted-Python] Application Design help - Concurrent but	not	Protocols based.
</A></li>
	<LI>Next message: <A HREF="019789.html">[Twisted-Python] stop conditions and deferToThread()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19788">[ date ]</a>
              <a href="thread.html#19788">[ thread ]</a>
              <a href="subject.html#19788">[ subject ]</a>
              <a href="author.html#19788">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
