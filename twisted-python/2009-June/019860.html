<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adbapi and multiple queries in single	transaction.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%20and%20multiple%20queries%20in%20single%0A%09transaction.&In-Reply-To=E3137F97B0A0804194F369F4E7C3B71927B92286A4%40EXCHANGE.persistent.co.in">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019858.html">
   <LINK REL="Next"  HREF="019863.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adbapi and multiple queries in single	transaction.</H1>
    <B>Phil Christensen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%20and%20multiple%20queries%20in%20single%0A%09transaction.&In-Reply-To=E3137F97B0A0804194F369F4E7C3B71927B92286A4%40EXCHANGE.persistent.co.in"
       TITLE="[Twisted-Python] adbapi and multiple queries in single	transaction.">phil at bubblehouse.org
       </A><BR>
    <I>Tue Jun 23 10:25:16 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019858.html">[Twisted-Python] adbapi and multiple queries in single transaction.
</A></li>
        <LI>Next message: <A HREF="019863.html">[Twisted-Python] adbapi and multiple queries in single
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19860">[ date ]</a>
              <a href="thread.html#19860">[ thread ]</a>
              <a href="subject.html#19860">[ subject ]</a>
              <a href="author.html#19860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jun 23, 2009, at 9:45 AM, Vishal Shetye wrote:
&gt;<i> I initially thought of putting all the queries per operation in a  
</I>&gt;<i> runInteraction. However this results in code-duplication as many  
</I>&gt;<i> queries are shared between different operations.
</I>
It seems like the easiest way to deal with this would be to make  
'private' methods for all the standard queries; these methods/ 
functions would accept a transaction object like you said, but the  
methods themselves would only be called from an interaction, which can  
supply the transaction object.

Then in each public ObjectGateway method you can just define an inner  
function to serve as the interaction, calling each private query  
method in turn, using the transaction object provided to that  
interaction.

Here's a stupidly trivial example:

class ObjectGateway(object):
     def __init__(self, pool):
         self.pool = pool

     def _getUserName(self, trans, user_id):
         result = trans.execute('SELECT username FROM user WHERE id =  
%s', user_id);
         return result[0][0]

     def _sessionUpdateQuery(self, trans, sid, username):
         trans.execute('UPDATE session SET username = %s WHERE sid =  
%s', [username, sid]);

     def handleLogin(self, sid, user_id):
         def _loginInteraction(trans):
             u = self._getUserName(trans, user_id)
             self._sessionUpdateQuery(trans, sid, username)
             return u
         return self.pool.runInteraction(_loginInteraction)

Other than being careful not to mess around with the instance state  
during those interactions (they are running in a thread, after all),  
this should be pretty straightforward.

Hope this helps,

-phil


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019858.html">[Twisted-Python] adbapi and multiple queries in single transaction.
</A></li>
	<LI>Next message: <A HREF="019863.html">[Twisted-Python] adbapi and multiple queries in single
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19860">[ date ]</a>
              <a href="thread.html#19860">[ thread ]</a>
              <a href="subject.html#19860">[ subject ]</a>
              <a href="author.html#19860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
