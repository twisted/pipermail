<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] untwisting twistd
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20untwisting%20twistd&In-Reply-To=%3C0C40B34038FD824FACDB387E7788728702C6C4E1%40seaxch08.desktop.isilon.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052362.html">
   <LINK REL="Next"  HREF="052375.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] untwisting twistd</H1>
    <B>Jared Gisin</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20untwisting%20twistd&In-Reply-To=%3C0C40B34038FD824FACDB387E7788728702C6C4E1%40seaxch08.desktop.isilon.com%3E"
       TITLE="[Twisted-Python] untwisting twistd">jared.gisin at isilon.com
       </A><BR>
    <I>Tue Jun 23 09:27:09 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052362.html">[Twisted-Python] untwisting twistd
</A></li>
        <LI>Next message (by thread): <A HREF="052375.html">[Twisted-Python] untwisting twistd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52369">[ date ]</a>
              <a href="thread.html#52369">[ thread ]</a>
              <a href="subject.html#52369">[ subject ]</a>
              <a href="author.html#52369">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the thoughts. I suppose I should have been a bit clearer on my specific use case that is not handled. Certainly, I do want to take advantage of twistd for the reasons listed below (daemonizing, handling log files, pidfile, etc); however, the problem that I have is that I have a very specific application that is going to be built into a product. There's no way that it could ever be installed or deployed elsewhere. Now, having said that I'd love to take advantage of the ApplicationRunner objects to fire up my application. The path to the application is baked in, the location for the pidfile and logfile should have sane defaults, and other various application parameters shouldn't change. In order to fire up the app with sane default, I should be able to issue one command with no arguments as the defaults for all of those should be baked into the system.

Sure, twistd provides default application values, but there's no easy way to override those values. There's no ServerOptions constructor function where I can configure the default values, or have some options removed from the list that appears if the user issues --help.

So, what I'm essentially arguing for is that although twistd is meant to solve a generic problem of generalizing server startups on various platforms for any number of applications, it's severely lacking in how I can take advantage of the ServerOptions to create one for my application. As it is now, I'm going to have to copy and paste the code and modify it as I want to create my own ServerOptions object that does have proper defaults. Right, now twisted.scripts._twistd_unis.ServerOptions inherits from app.ServerOptions, which is completely in appropriate as the UNIX ServerOptions have absolutely nothing to do with twistd itself. For example, I don't there to ever be a --file or --xml --source --report-profile --nothotshot --no_save or --savestats options. 
Really, this is a matter of presentation and locking down the application server options. I should be able to do something like this

ServerOptions( hide_items=('xml', 'file', 'source', 'report-profile'), =
		defaults={'logfile':'/var/log/foo.log', 'pidfile':'/var/run/foo.pid'}  )

To properly construct the subset of default twistd ServerOptions I need to have.

I guess in the mean time, I'll just write my own custom ServerOptions, which oddly, will mirror a bunch of code that already exists.


Thoughts?

-Jared

-----Original Message-----
From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of Alex Clemesha
Sent: Monday, June 22, 2009 2:36 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] untwisting twistd

Hi Jared,
First off, I'd like to say that I'm basically in agreement with exactly what
you are saying, and that is: &quot;I should be able to write a Python
script that acts like twistd - not *be* twistd&quot;.


Phil does have some really good points, such as:
&quot;&quot;&quot;
The critics are usually not thinking about the real requirements of deploying a
configurable demonizing application in a production environment.
&quot;&quot;&quot;


And lastly, I'm glad to see that response from Glyph, as the methodology
he describes is basically how I understand one would create a
&quot;personalized twistd&quot;.


In fact, I just got an email from a co-worker that wanted to know how to
either side-step &quot;twistd&quot; or write a custom version of it.  Here is my
response to him (I'd love some critic of my response, so I can provide
a better answer):


============= Email to co-worker: ===============


Yes, there is a better way of doing things.  This better way of doing things
is to write a &quot;twisted plugin&quot; and then, after that is working, using can
wrap calls to &quot;twistd&quot; with python's &quot;os.system&quot; calls, or shell script calls,
or whatever else you want.


I must admit, this whole procedure is pretty confusing (it was for me
at least) at first,
but let me try to explain why you might want to write a &quot;twisted plugin&quot; and
_then_ (possibly) wrap it with a shell script or a simple python script.
The main reasons are the following:

1) You _do_ want to use &quot;twistd&quot;, because it does lots of useful
things like daemonizing, handling logfiles and pidfiles, etc.
2) You also want to pass config code to the app you are starting up
(via &quot;twistd&quot;) - optimally from the command line and a settings file.

Now, once the above is in place, you then can write some wrapper code
on top of the &quot;twistd&quot; calls for convenience for users.

Here is the &quot;plugin&quot; documentation:
<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/plugin.html">http://twistedmatrix.com/projects/core/documentation/howto/plugin.html</A>

But I've found that it is easier to go from an example, so try typing this:

twistd -n web --path=&quot;.&quot;

Now open up firefox to <A HREF="http://localhost:8080">http://localhost:8080</A>
This starts up a twisted web server, serving files from the local directory.
This is a twisted web plugin in action, and it is implemented with
these 2 files:

<A HREF="http://twistedmatrix.com/trac/browser/trunk/twisted/plugins/twisted_web.py">http://twistedmatrix.com/trac/browser/trunk/twisted/plugins/twisted_web.py</A>
<A HREF="http://twistedmatrix.com/trac/browser/trunk/twisted/web/tap.py">http://twistedmatrix.com/trac/browser/trunk/twisted/web/tap.py</A>

============ end email to co-worker ==============



So basically I've found that the best thing to do is to extend
&quot;twistd&quot; via writing a plugin, and then you can write all kinds
of simple wrappers on top of it to provide a more user-friendly
and a your-app-specific command line tool.  Thoughts from Twisted gurus?


thanks,
Alex












On Mon, Jun 22, 2009 at 1:30 PM, Jared Gisin&lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jared.gisin at isilon.com</A>&gt; wrote:
&gt;<i> I am currently working on writing an application using the twisted
</I>&gt;<i> framework. The problem that I have is that I do not want to use twistd. In
</I>&gt;<i> fact, I find twistd to be inappropriate as it defaults pidfile and logfile
</I>&gt;<i> to something specific to twisted, not my application, and it seem completely
</I>&gt;<i> silly to have to pass in -pidfile and -logfile params when stating it up.
</I>&gt;<i> Those parameters should be specified as part of the Application object
</I>&gt;<i> itself, and should allow for CLI override. Further, as I want my daemon that
</I>&gt;<i> I'm writing to look and act like a daemon (UNIX), I do not want to be
</I>&gt;<i> invoking some general &quot;twistd&quot; command and passing a ton of options.
</I>&gt;<i> Ideally, I should be able to write a Pythons script that acts like twistd,
</I>&gt;<i> but can bake in default options and hide/expose other ServerOptions as I so
</I>&gt;<i> see fit.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> For example, if I run,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> my_daemon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It should fire up the daemon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> my_daemon -help
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> should dump the help
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> my_daemon -pidfile=/var/run/my_daemon.pid
</I>&gt;<i>
</I>&gt;<i> my_daemon stop
</I>&gt;<i>
</I>&gt;<i> my_daemon restart
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> should all function accordingly. I want to avoid all of this &quot;twistd -y&quot;
</I>&gt;<i> business, as the daemon, isn't &quot;twistd&quot; it's my code. I should be able to
</I>&gt;<i> use the ApplicationRunner, UnixApplicationRunner, etc &quot;runners&quot;,  however,
</I>&gt;<i> as they are currently written, they are twistd specific. For example, in
</I>&gt;<i> 8.2, the def checkPid function bakes in, &quot;            sys.exit(&quot;&quot;&quot;\
</I>&gt;<i>
</I>&gt;<i> Another twistd server is running, PID %s\n
</I>&gt;<i>
</I>&gt;<i> This could either be a previously started instance of your application or a
</I>&gt;<i>
</I>&gt;<i> different application entirely. To start a new one, either run it in some
</I>&gt;<i> other
</I>&gt;<i>
</I>&gt;<i> directory, or use the --pidfile and --logfile parameters to avoid clashes.
</I>&gt;<i>
</I>&gt;<i> &quot;&quot;&quot; %  pid)&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Which is iditic as my application may not even expose a -pidfile or a
</I>&gt;<i> -logfile and it's definatley not called twistd. The platform specific
</I>&gt;<i> application runners need to be more generalized so users can write their own
</I>&gt;<i> twistd equivalent to include only what they want.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Perhaps I'm missing some key point of twisted that already does this. If so,
</I>&gt;<i> I'd love to be guided in the right direction. If not, and I've got a valid
</I>&gt;<i> point here, I'd love to know how I can help to remedy this problem. I think
</I>&gt;<i> it's great that twistd provides application management classes, but they are
</I>&gt;<i> unnecessarily intertwined with twistd which should be completely optional.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Jared
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>


-- 
Alex Clemesha
clemesha.org

_______________________________________________
Twisted-Python mailing list
<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052362.html">[Twisted-Python] untwisting twistd
</A></li>
	<LI>Next message (by thread): <A HREF="052375.html">[Twisted-Python] untwisting twistd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52369">[ date ]</a>
              <a href="thread.html#52369">[ thread ]</a>
              <a href="subject.html#52369">[ subject ]</a>
              <a href="author.html#52369">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
