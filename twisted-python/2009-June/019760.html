<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Application Design help - Concurrent but not	Protocols based.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Application%20Design%20help%20-%20Concurrent%20but%20not%0A%09Protocols%20based.&In-Reply-To=20090603162527.GA15317%40ubuntu.ubuntu-domain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019787.html">
   <LINK REL="Next"  HREF="019762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Application Design help - Concurrent but not	Protocols based.</H1>
    <B>David Ripton</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Application%20Design%20help%20-%20Concurrent%20but%20not%0A%09Protocols%20based.&In-Reply-To=20090603162527.GA15317%40ubuntu.ubuntu-domain"
       TITLE="[Twisted-Python] Application Design help - Concurrent but not	Protocols based.">dripton at ripton.net
       </A><BR>
    <I>Wed Jun  3 16:13:04 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019787.html">[Twisted-Python] Application Design help - Concurrent but	not	Protocols based.
</A></li>
        <LI>Next message: <A HREF="019762.html">[Twisted-Python] Application Design help - Concurrent but	not	Protocols based.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19760">[ date ]</a>
              <a href="thread.html#19760">[ thread ]</a>
              <a href="subject.html#19760">[ subject ]</a>
              <a href="author.html#19760">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2009.06.03 21:55:27 +0530, Senthil Kumaran wrote:
&gt;<i> 1) I need to constantly monitor a particular directory for new files.
</I>&gt;<i> 2) Whenever a new file is dropped; I read that file and get
</I>&gt;<i> information on where to collect data from that is a) another machine b)
</I>&gt;<i> machine2-different method c) database.
</I>&gt;<i> 3) I collect data from those machines and store it.
</I>&gt;<i> 
</I>&gt;<i> The data is huge and I need the three processes a, b, c to be
</I>&gt;<i> non-blocking, and I can just do a function call like do_a(), do_b(),
</I>&gt;<i> do_c() to perform them.
</I>&gt;<i> 
</I>&gt;<i> For 1) to constantly monitor a particular directory for new files, I
</I>&gt;<i> am doing something like this:
</I>&gt;<i> My Question: Can this be designed in way that looking for new files is
</I>&gt;<i> also asynchronous activity? 
</I>
If your OS has a way to let you register your interest in particular
directories and then notify you when new files appear there, then yes.

If you're using Linux then check out the Twisted inotify wrapper that's
in dialtone's sandbox.  <A HREF="http://twistedmatrix.com/trac/changeset/25717">http://twistedmatrix.com/trac/changeset/25717</A>

If you're using something else then it probably has a similar API but
it'll be more work because AFAIK nobody's already written the Twisted
wrapper for you.

Or maybe you can get away with just periodically calling os.listdir from
a subthread, using deferToThread.  Not technically asynchronous but
probably good enough.

&gt;<i> Now, after reading the contents, I will have to do a non-blocking call
</I>&gt;<i> to fetch data, either using fun_a, fun_b or fun_b. How should I
</I>&gt;<i> associate this requirement to deferred/callback pattern?
</I>
Depends.

If it's just a simple cheap Python function that doesn't block then you
can just do:

deferred1 = reactor.callLater(0, fun_a)
deferred1.addCallback(fun_a_callback)
deferred1.addErrback(fun_a_errback)

If it's a simple function that blocks and can't be changed to not block
but doesn't use too much CPU then you can use deferToThread.

If it's a piggy enough function that you really want it in a separate
process so it can use another CPU core, then write a little Python
script that wraps it, and call it using the Twisted process APIs:
<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/process.html">http://twistedmatrix.com/projects/core/documentation/howto/process.html</A>

But just because you can do this in Twisted doesn't mean you necessarily
should.  If you need an asynchronous main loop then Twisted has really
good APIs for dealing with asynchronous main loops.  (If you're on Linux
and can use inotify then it qualifies.)  But if you end up polling the
filesystem with os.listdir in one thread, and running your fun_x in
other threads, and you're not really doing anything asynchronous, then
IMO Twisted won't really add any value.  In that case I'd just use
Python's threading and Queue modules.

-- 
David Ripton    <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">dripton at ripton.net</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019787.html">[Twisted-Python] Application Design help - Concurrent but	not	Protocols based.
</A></li>
	<LI>Next message: <A HREF="019762.html">[Twisted-Python] Application Design help - Concurrent but	not	Protocols based.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19760">[ date ]</a>
              <a href="thread.html#19760">[ thread ]</a>
              <a href="subject.html#19760">[ subject ]</a>
              <a href="author.html#19760">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
