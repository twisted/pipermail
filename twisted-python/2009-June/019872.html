<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Unhandled error in Deferred with twisted-8.2.0,	but not with twisted-2.1.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Unhandled%20error%20in%20Deferred%20with%20twisted-8.2.0%2C%0A%09but%20not%20with%20twisted-2.1.0&In-Reply-To=F06E1DE459099B4191D150491D42BC361FA10120%40gsmbnbp22es.firmwide.corp.gs.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019871.html">
   <LINK REL="Next"  HREF="019873.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Unhandled error in Deferred with twisted-8.2.0,	but not with twisted-2.1.0</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Unhandled%20error%20in%20Deferred%20with%20twisted-8.2.0%2C%0A%09but%20not%20with%20twisted-2.1.0&In-Reply-To=F06E1DE459099B4191D150491D42BC361FA10120%40gsmbnbp22es.firmwide.corp.gs.com"
       TITLE="[Twisted-Python] Unhandled error in Deferred with twisted-8.2.0,	but not with twisted-2.1.0">glyph at divmod.com
       </A><BR>
    <I>Fri Jun 26 13:48:47 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019871.html">[Twisted-Python] Unhandled error in Deferred with twisted-8.2.0,	but not with twisted-2.1.0
</A></li>
        <LI>Next message: <A HREF="019873.html">[Twisted-Python] Unhandled error in Deferred with twisted-8.2.0,	but not with twisted-2.1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19872">[ date ]</a>
              <a href="thread.html#19872">[ thread ]</a>
              <a href="subject.html#19872">[ subject ]</a>
              <a href="author.html#19872">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 04:33 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">benjamin.rutt at gs.com</A> wrote:
&gt;<i>Am currently trying to upgrade to twisted-8.2.0.  For some reason,
</I>&gt;<i>twisted-8.2.0 thinks my deferred below was gc'd with an unhandled 
</I>&gt;<i>error,
</I>&gt;<i>and tells me about it upon reactor exit.  With
</I>&gt;<i>python-2.4.2/twisted-2.1.0, no issues.  With 
</I>&gt;<i>python-2.6.1/twisted-8.2.0,
</I>&gt;<i>I see these issues.  Any ideas why?  Thanks.
</I>
A second Deferred is created during getProcessOutput to track the ending 
of the process as distinct from the end of its output.  You have to 
catch that exception as well if you don't want any exceptions logged.

Arguably, this is a bug, since it changes the behavior and complicates 
error handling; if you think so, feel free to file a ticket on the 
tracker.  I just learned about this behavior myself, in the process of 
tracking down your question :).

This behavior was changed in:

    <A HREF="http://twistedmatrix.com/trac/changeset/24810">http://twistedmatrix.com/trac/changeset/24810</A>

as part of a fix for:

    <A HREF="http://twistedmatrix.com/trac/ticket/3239">http://twistedmatrix.com/trac/ticket/3239</A>

and that took place after 8.1 but before 8.2.  In the meanwhile, you 
could upgrade to 8.2 before going to 8.2 to avoid this issue; going from 
8.1 to 8.2 should be significantly easier than going from 2.1 to 8.1 ;).

If you'd still like to upgrade all the way, here's a &quot;correct&quot; version 
of your program (with spurious imports removed), according to the 
behavior in 8.2.0:

#!/usr/bin/env python
from twisted.internet import reactor
from twisted.internet.utils import getProcessOutput

def foo():
    d = getProcessOutput('/some/non/existent/program')
    def cb(result):
        print 'cb: %s' % (result)
    def eb(failure):
        failure.trap(IOError)
        def endedException(ended):
            print 'really, caught it!'
        failure.value.processEnded.addErrback(endedException)
        print 'eb caught the failure!'
    d.addCallback(cb)
    d.addErrback(eb)

def stopit():
    print 'Stopping reactor.'
    reactor.stop()
    print 'Stopped.'

reactor.callWhenRunning(foo)
reactor.callLater(1.0, stopit)
reactor.run()


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019871.html">[Twisted-Python] Unhandled error in Deferred with twisted-8.2.0,	but not with twisted-2.1.0
</A></li>
	<LI>Next message: <A HREF="019873.html">[Twisted-Python] Unhandled error in Deferred with twisted-8.2.0,	but not with twisted-2.1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19872">[ date ]</a>
              <a href="thread.html#19872">[ thread ]</a>
              <a href="subject.html#19872">[ subject ]</a>
              <a href="author.html#19872">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
