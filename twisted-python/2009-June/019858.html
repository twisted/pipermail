<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] adbapi and multiple queries in single transaction.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%20and%20multiple%20queries%20in%20single%20transaction.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019866.html">
   <LINK REL="Next"  HREF="019860.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] adbapi and multiple queries in single transaction.</H1>
    <B>Vishal Shetye</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20adbapi%20and%20multiple%20queries%20in%20single%20transaction.&In-Reply-To="
       TITLE="[Twisted-Python] adbapi and multiple queries in single transaction.">vishal_shetye at persistent.co.in
       </A><BR>
    <I>Tue Jun 23 09:45:05 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019866.html">[Twisted-Python] Twisted Trial
</A></li>
        <LI>Next message: <A HREF="019860.html">[Twisted-Python] adbapi and multiple queries in single	transaction.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19858">[ date ]</a>
              <a href="thread.html#19858">[ thread ]</a>
              <a href="subject.html#19858">[ subject ]</a>
              <a href="author.html#19858">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I am working on an application that uses twisted and twisted.e.adbapi with sqlite in the backend.
All db queries are put in separate functions in class say tableGateway.py which uses runOperation, runQuery etc as appropriate.
A layer that uses it, lets say objectGateway.py, defines operations.
Thus, lets say an add operation may actually call 2-3 or more functions from tableGateway.py.

If my application quits or crashes in middle of an operation then it is likely that db will be inconsistent.
What I want is each objectGateway level operation should be done in a single transaction.

I initially thought of putting all the queries per operation in a runInteraction. However this results in code-duplication as many queries are shared between different operations.

What I could think of for preventing this is:
1. do a runInteraction at objectGateway and then txn that I get will be passed to appropriate functions of tableGateway.
2. An objectGateway level log based recovery.


Option 1 requires all the tableGateway functions to take txn as param. This can be avoided by instantiating tableGateway with a txn for each operation, however tableGateway instantiation is not that cheap.
Even so, if any objectGateway function calls other objectGateway function then the txn will have to be passed to that as well.

Any comments/suggestions?


Regards,
vishal

DISCLAIMER
==========
This e-mail may contain privileged and confidential information which is the property of Persistent Systems Ltd. It is intended only for the use of the individual or entity to which it is addressed. If you are not the intended recipient, you are not authorized to read, retain, copy, print, distribute or use this message. If you have received this communication in error, please notify the sender and delete all copies of this message. Persistent Systems Ltd. does not accept any liability for virus infected mails.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019866.html">[Twisted-Python] Twisted Trial
</A></li>
	<LI>Next message: <A HREF="019860.html">[Twisted-Python] adbapi and multiple queries in single	transaction.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19858">[ date ]</a>
              <a href="thread.html#19858">[ thread ]</a>
              <a href="subject.html#19858">[ subject ]</a>
              <a href="author.html#19858">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
