<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] untwisting twistd
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20untwisting%20twistd&In-Reply-To=0C40B34038FD824FACDB387E7788728702C6C3AF%40seaxch08.desktop.isilon.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019855.html">
   <LINK REL="Next"  HREF="019861.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] untwisting twistd</H1>
    <B>Alex Clemesha</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20untwisting%20twistd&In-Reply-To=0C40B34038FD824FACDB387E7788728702C6C3AF%40seaxch08.desktop.isilon.com"
       TITLE="[Twisted-Python] untwisting twistd">clemesha at gmail.com
       </A><BR>
    <I>Mon Jun 22 17:36:03 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019855.html">[Twisted-Python] untwisting twistd
</A></li>
        <LI>Next message: <A HREF="019861.html">[Twisted-Python] untwisting twistd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19854">[ date ]</a>
              <a href="thread.html#19854">[ thread ]</a>
              <a href="subject.html#19854">[ subject ]</a>
              <a href="author.html#19854">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jared,
First off, I'd like to say that I'm basically in agreement with exactly what
you are saying, and that is: &quot;I should be able to write a Python
script that acts like twistd - not *be* twistd&quot;.


Phil does have some really good points, such as:
&quot;&quot;&quot;
The critics are usually not thinking about the real requirements of deploying a
configurable demonizing application in a production environment.
&quot;&quot;&quot;


And lastly, I'm glad to see that response from Glyph, as the methodology
he describes is basically how I understand one would create a
&quot;personalized twistd&quot;.


In fact, I just got an email from a co-worker that wanted to know how to
either side-step &quot;twistd&quot; or write a custom version of it.  Here is my
response to him (I'd love some critic of my response, so I can provide
a better answer):


============= Email to co-worker: ===============


Yes, there is a better way of doing things.  This better way of doing things
is to write a &quot;twisted plugin&quot; and then, after that is working, using can
wrap calls to &quot;twistd&quot; with python's &quot;os.system&quot; calls, or shell script calls,
or whatever else you want.


I must admit, this whole procedure is pretty confusing (it was for me
at least) at first,
but let me try to explain why you might want to write a &quot;twisted plugin&quot; and
_then_ (possibly) wrap it with a shell script or a simple python script.
The main reasons are the following:

1) You _do_ want to use &quot;twistd&quot;, because it does lots of useful
things like daemonizing, handling logfiles and pidfiles, etc.
2) You also want to pass config code to the app you are starting up
(via &quot;twistd&quot;) - optimally from the command line and a settings file.

Now, once the above is in place, you then can write some wrapper code
on top of the &quot;twistd&quot; calls for convenience for users.

Here is the &quot;plugin&quot; documentation:
<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/plugin.html">http://twistedmatrix.com/projects/core/documentation/howto/plugin.html</A>

But I've found that it is easier to go from an example, so try typing this:

twistd -n web --path=&quot;.&quot;

Now open up firefox to <A HREF="http://localhost:8080">http://localhost:8080</A>
This starts up a twisted web server, serving files from the local directory.
This is a twisted web plugin in action, and it is implemented with
these 2 files:

<A HREF="http://twistedmatrix.com/trac/browser/trunk/twisted/plugins/twisted_web.py">http://twistedmatrix.com/trac/browser/trunk/twisted/plugins/twisted_web.py</A>
<A HREF="http://twistedmatrix.com/trac/browser/trunk/twisted/web/tap.py">http://twistedmatrix.com/trac/browser/trunk/twisted/web/tap.py</A>

============ end email to co-worker ==============



So basically I've found that the best thing to do is to extend
&quot;twistd&quot; via writing a plugin, and then you can write all kinds
of simple wrappers on top of it to provide a more user-friendly
and a your-app-specific command line tool.  Thoughts from Twisted gurus?


thanks,
Alex












On Mon, Jun 22, 2009 at 1:30 PM, Jared Gisin&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">jared.gisin at isilon.com</A>&gt; wrote:
&gt;<i> I am currently working on writing an application using the twisted
</I>&gt;<i> framework. The problem that I have is that I do not want to use twistd. In
</I>&gt;<i> fact, I find twistd to be inappropriate as it defaults pidfile and logfile
</I>&gt;<i> to something specific to twisted, not my application, and it seem completely
</I>&gt;<i> silly to have to pass in &#8211;pidfile and &#8211;logfile params when stating it up.
</I>&gt;<i> Those parameters should be specified as part of the Application object
</I>&gt;<i> itself, and should allow for CLI override. Further, as I want my daemon that
</I>&gt;<i> I&#8217;m writing to look and act like a daemon (UNIX), I do not want to be
</I>&gt;<i> invoking some general &#8220;twistd&#8221; command and passing a ton of options.
</I>&gt;<i> Ideally, I should be able to write a Pythons script that acts like twistd,
</I>&gt;<i> but can bake in default options and hide/expose other ServerOptions as I so
</I>&gt;<i> see fit.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> For example, if I run,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> my_daemon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It should fire up the daemon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> my_daemon &#8211;help
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> should dump the help
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> my_daemon &#8211;pidfile=/var/run/my_daemon.pid
</I>&gt;<i>
</I>&gt;<i> my_daemon stop
</I>&gt;<i>
</I>&gt;<i> my_daemon restart
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> should all function accordingly. I want to avoid all of this &#8220;twistd &#8211;y&#8221;
</I>&gt;<i> business, as the daemon, isn&#8217;t &#8220;twistd&#8221; it&#8217;s my code. I should be able to
</I>&gt;<i> use the ApplicationRunner, UnixApplicationRunner, etc &#8220;runners&#8221;,&#160; however,
</I>&gt;<i> as they are currently written, they are twistd specific. For example, in
</I>&gt;<i> 8.2, the def checkPid function bakes in, &#8220;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sys.exit(&quot;&quot;&quot;\
</I>&gt;<i>
</I>&gt;<i> Another twistd server is running, PID %s\n
</I>&gt;<i>
</I>&gt;<i> This could either be a previously started instance of your application or a
</I>&gt;<i>
</I>&gt;<i> different application entirely. To start a new one, either run it in some
</I>&gt;<i> other
</I>&gt;<i>
</I>&gt;<i> directory, or use the --pidfile and --logfile parameters to avoid clashes.
</I>&gt;<i>
</I>&gt;<i> &quot;&quot;&quot; %&#160; pid)&#8221;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Which is iditic as my application may not even expose a &#8211;pidfile or a
</I>&gt;<i> &#8211;logfile and it&#8217;s definatley not called twistd. The platform specific
</I>&gt;<i> application runners need to be more generalized so users can write their own
</I>&gt;<i> twistd equivalent to include only what they want.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Perhaps I&#8217;m missing some key point of twisted that already does this. If so,
</I>&gt;<i> I&#8217;d love to be guided in the right direction. If not, and I&#8217;ve got a valid
</I>&gt;<i> point here, I&#8217;d love to know how I can help to remedy this problem. I think
</I>&gt;<i> it&#8217;s great that twistd provides application management classes, but they are
</I>&gt;<i> unnecessarily intertwined with twistd which should be completely optional.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Jared
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>


-- 
Alex Clemesha
clemesha.org


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019855.html">[Twisted-Python] untwisting twistd
</A></li>
	<LI>Next message: <A HREF="019861.html">[Twisted-Python] untwisting twistd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19854">[ date ]</a>
              <a href="thread.html#19854">[ thread ]</a>
              <a href="subject.html#19854">[ subject ]</a>
              <a href="author.html#19854">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
