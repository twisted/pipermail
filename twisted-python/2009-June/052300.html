<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] stop conditions and deferToThread()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop%20conditions%20and%20deferToThread%28%29&In-Reply-To=%3C20090610123133.22176.1370222089.divmod.quotient.4143%40henry.divmod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052298.html">
   <LINK REL="Next"  HREF="052312.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] stop conditions and deferToThread()</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20stop%20conditions%20and%20deferToThread%28%29&In-Reply-To=%3C20090610123133.22176.1370222089.divmod.quotient.4143%40henry.divmod.com%3E"
       TITLE="[Twisted-Python] stop conditions and deferToThread()">exarkun at divmod.com
       </A><BR>
    <I>Wed Jun 10 06:31:33 MDT 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052298.html">[Twisted-Python] stop conditions and deferToThread()
</A></li>
        <LI>Next message (by thread): <A HREF="052312.html">[Twisted-Python] stop conditions and deferToThread()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52300">[ date ]</a>
              <a href="thread.html#52300">[ thread ]</a>
              <a href="subject.html#52300">[ subject ]</a>
              <a href="author.html#52300">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 10 Jun 2009 12:04:16 +0200, Thomas Jakobsen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">thomas.jakobsen at alexandra.dk</A>&gt; wrote:
&gt;<i>Hi
</I>&gt;<i>
</I>&gt;<i>As discussed in a previous thread
</I>&gt;<i>
</I>&gt;<i>   <A HREF="http://twistedmatrix.com/pipermail/twisted-python/2009-May/019717.html">http://twistedmatrix.com/pipermail/twisted-python/2009-May/019717.html</A>
</I>&gt;<i>
</I>&gt;<i>a task put in its own thread via deferToThread() won't stop even
</I>&gt;<i>though the reactor has stopped. It has to carry out its own check that
</I>&gt;<i>the reactor is running and stop if that is not the case.
</I>
deferToThread is optimized for short-running tasks.  Thread creation costs
are amortized over the lifetime of the process.  This is because the intended
use of deferToThread is to run functions which compute some result and then
return, /not/ for functions which run forever (or at least until the process
is ready to exit).

You should try to find a way to re-arrange your code so that there is no
need to check if the reactor is still running - just do one piece of work
in a thread at a time.  When your non-threaded application code gets the
result back, if no one has asked it to shut down, then it can ask for
another job to be executed.

&gt;<i>My question is: Is it possible to use anything else than the
</I>&gt;<i>reactor.running as stop condition in this way?
</I>
Also, I want to point out that while `reactor.runningÂ´ isn't private (since
it doesn't start with an underscore, as Twisted's privacy policy dictates it
would need to), it still isn't something you really want to be using.  It's
not part of any interface, which means there is no guarantee it will be
provided by all reactors.

It's also not really for you.  It's a flag that the reactor uses to track
its own internal state.  Its meaning may not actually correspond to the
meaning you'd like to assign to it.  Whenever you're trying to do something
like this (which I still don't recommend), you should create your own state
tracking and use that instead.

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052298.html">[Twisted-Python] stop conditions and deferToThread()
</A></li>
	<LI>Next message (by thread): <A HREF="052312.html">[Twisted-Python] stop conditions and deferToThread()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52300">[ date ]</a>
              <a href="thread.html#52300">[ thread ]</a>
              <a href="subject.html#52300">[ subject ]</a>
              <a href="author.html#52300">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
