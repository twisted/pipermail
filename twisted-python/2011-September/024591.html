<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Bug in Finger Tutorial?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Bug%20in%20Finger%20Tutorial%3F&In-Reply-To=CALUPC%2BEeYCt%3DZXSqxbsDQ_YK0XniSKx3zA1pvOuTdw8h37%2BqTg%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024589.html">
   <LINK REL="Next"  HREF="024592.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Bug in Finger Tutorial?</H1>
    <B>David Kao</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Bug%20in%20Finger%20Tutorial%3F&In-Reply-To=CALUPC%2BEeYCt%3DZXSqxbsDQ_YK0XniSKx3zA1pvOuTdw8h37%2BqTg%40mail.gmail.com"
       TITLE="[Twisted-Python] Bug in Finger Tutorial?">a.libran at gmail.com
       </A><BR>
    <I>Thu Sep 29 18:23:42 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024589.html">[Twisted-Python] Bug in Finger Tutorial?
</A></li>
        <LI>Next message: <A HREF="024592.html">[Twisted-Python] Bug in Finger Tutorial?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24591">[ date ]</a>
              <a href="thread.html#24591">[ thread ]</a>
              <a href="subject.html#24591">[ subject ]</a>
              <a href="author.html#24591">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Sep 30, 2011 at 6:10 AM, Dorian Raymer &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">deldotdr at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Sep 29, 2011 at 2:44 PM, David Kao &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">a.libran at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'll take care of the first question.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> From The Evolution of Finger: making a finger library,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> h = internet.TCPServer(79, IFingerFactory(f))
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> notice IFingerFactory? If you read the earlier parts of the tutorial,
</I>&gt;&gt;<i> you'll see stuff like components.registerAdapter. It's just magic to
</I>&gt;&gt;<i> create a FingerFactoryFromService, giving its constructor f, the
</I>&gt;&gt;<i> &quot;Finger Service&quot;. What happens here is that &quot;f&quot;, the Finger Service,
</I>&gt;&gt;<i> is different from the service.Service within the Twisted Framework.
</I>&gt;<i>
</I>&gt;<i> The FingerService inherits service.Service and implements the startService
</I>&gt;<i> event, so it *is* a service that can be run by the service framework; it
</I>&gt;<i> just isn't one of the twisted.application.internet services, like
</I>&gt;<i> internet.TCPServer.
</I>&gt;<i> Moreover, it needs to have startService called, somehow... and what I'm
</I>&gt;<i> saying is that in the full example (provided
</I>&gt;<i> in&#160;twisted/doc/core/howto/tutorial/listings/finger/finger/finger.py) it is
</I>&gt;<i> not called, and if you actually try using it, it doesn't work.
</I>&gt;<i>
</I>
Yes you are right. It's just the two concepts (adapter and service)
are different but are presented together. In this case, it happens
that FingerService needs initialization, and that initialization is
usually done via startService, which, I agree, isn't called. And it's
funky here because you don't want FingerService to be the service
here, because it doesn't know how to listen to TCP. bahhh ... yea the
example is not super great. It seems like you understand the examples
anyways.


&gt;&gt;<i>
</I>&gt;&gt;<i> You might as well call &quot;f&quot;, the Finger Service, &quot;Finger Shared Data&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What really happens here is
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> h is the service that has parent s, MultiService. s is then returned
</I>&gt;&gt;<i> and started by the application.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> h contains a factory that gets run.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The factory knows &quot;f&quot;, the Finger Service, which has nothing to do
</I>&gt;&gt;<i> with twisted's mechanism. It's more of a demo for the component based
</I>&gt;&gt;<i> framework. f is a way to share data and methods and states across
</I>&gt;&gt;<i> multiple factories.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am also very new to twisted, so I **hope** this understanding of
</I>&gt;&gt;<i> mine is correct ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I strongly recommend you read through the entire tutorial. They build
</I>&gt;&gt;<i> very incrementally, so most of the time the code is repeated so you
</I>&gt;&gt;<i> can just skim through it if you had started from the beginning.
</I>&gt;<i>
</I>&gt;<i> I've read it many times over the years ;) It's&#160;surprisingly complete as an
</I>&gt;<i> example...you just don't know that in the beginning.
</I>&gt;<i> The topic area of this question is something I'm trying to squeeze out of
</I>&gt;<i> this tutorial series; I'm encountering conceptual questions beyond the
</I>&gt;<i> mechanics of how the framework works (which the tutorial does a great job of
</I>&gt;<i> explaining) like:
</I>&gt;<i> should I ever make a tree of&#160;dependent&#160;services?
</I>&gt;<i> What if I do something in a startService method that I want to make sure
</I>&gt;<i> works before other services get their startService called?
</I>&gt;<i> If I create a bunch of business services (that just provide pure
</I>&gt;<i> functionality) that I then adapt for deployment in different t.a.internet
</I>&gt;<i> services, should I put the business services in their own MultiService and
</I>&gt;<i> the internet services in their own MutiService container?
</I>&gt;<i> Like I said, more showcasing of use cases would help suggest answers to
</I>&gt;<i> these kind of questions. I see a lot of possibilities, but haven't put in
</I>&gt;<i> the time in the trenches to try them all out ;)
</I>&gt;<i> Thanks,
</I>&gt;<i> -Dorian
</I>&gt;<i>
</I>
Totally agree with your suggestion.

I have the exact same problem here. In the end I just start doing
things using reactor.listenTCP and forget about services since it
isn't clear in the docs the order in which services are started. I
sort of use one big setup service as &quot;Main()&quot;, and then do my own
hooks using &quot;fake service&quot; inside each factory, and the call
reactor.listenTCP on those factories.

It might just be services are meant to be really independent and
parallel to each other. I dunno ... I'll let the veterans speak now.

&gt;&gt;<i>
</I>&gt;&gt;<i> David Kao
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Fri, Sep 30, 2011 at 5:28 AM, Dorian Raymer &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">deldotdr at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; Hello,
</I>&gt;&gt;<i> &gt; I am confused about how the FingerService gets started in the
</I>&gt;&gt;<i> &gt; finger/finger.py makeService function. It is never assigned a service
</I>&gt;&gt;<i> &gt; parent
</I>&gt;&gt;<i> &gt; and it can't service getUser requests if its startService method isn't
</I>&gt;&gt;<i> &gt; called; you get an AttributeError:&#160;&quot;no attribute 'users'&quot; the way it
</I>&gt;&gt;<i> &gt; works
</I>&gt;&gt;<i> &gt; now. Is this a bug?
</I>&gt;&gt;<i> &gt; The most sensible thing, in this case, seems to be setting the
</I>&gt;&gt;<i> &gt; FingerService
</I>&gt;&gt;<i> &gt; parent to be the MultiService container that all of the interent
</I>&gt;&gt;<i> &gt; services
</I>&gt;&gt;<i> &gt; are added to in the makeService function.&#160;Is that correct?
</I>&gt;&gt;<i> &gt; I'm wondering if their are any other&#160;strategies people use for starting
</I>&gt;&gt;<i> &gt; non-internet services.
</I>&gt;&gt;<i> &gt; For instance, if instead of reading a file to get to my user db, I might
</I>&gt;&gt;<i> &gt; want to start a redis client and read from redis to service a getUser
</I>&gt;&gt;<i> &gt; call.
</I>&gt;&gt;<i> &gt; But that means I'd want to make sure the startService&#160;call succeeded
</I>&gt;&gt;<i> &gt; (the
</I>&gt;&gt;<i> &gt; redis connection was made) before one of the internet services tries to
</I>&gt;&gt;<i> &gt; use
</I>&gt;&gt;<i> &gt; the FingerService (a timing problem that doesn't exist when just reading
</I>&gt;&gt;<i> &gt; a
</I>&gt;&gt;<i> &gt; file)...or something. Maybe I'm really just wondering how the twisted
</I>&gt;&gt;<i> &gt; application framework handles exceptions that occur for startService
</I>&gt;&gt;<i> &gt; calls.
</I>&gt;&gt;<i> &gt; Maybe I need something else to handle that kind of thing?
</I>&gt;&gt;<i> &gt; I'm also wondering if it's ever a good idea to make a extension
</I>&gt;&gt;<i> &gt; of&#160;ServerFactory&#160;(that adapts a Service)&#160;that calls&#160;Service.startService
</I>&gt;&gt;<i> &gt; when Factory.startServer is called (and Service.stopService when
</I>&gt;&gt;<i> &gt; Factory.stopFactory is called)?
</I>&gt;&gt;<i> &gt; And I'm looking for more use cases/projects (beyond the finger tutorial)
</I>&gt;&gt;<i> &gt; that really showcase the twisted application framework. Any references
</I>&gt;&gt;<i> &gt; would
</I>&gt;&gt;<i> &gt; be appreciated!
</I>&gt;&gt;<i> &gt; Thanks!
</I>&gt;&gt;<i> &gt; -Dorian
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-Python mailing list
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024589.html">[Twisted-Python] Bug in Finger Tutorial?
</A></li>
	<LI>Next message: <A HREF="024592.html">[Twisted-Python] Bug in Finger Tutorial?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24591">[ date ]</a>
              <a href="thread.html#24591">[ thread ]</a>
              <a href="subject.html#24591">[ subject ]</a>
              <a href="author.html#24591">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
