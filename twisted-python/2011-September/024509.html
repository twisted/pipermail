<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted and kerberos
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20and%20kerberos&In-Reply-To=CAMWA1_raiAEQkUEVnGGUCf8Dn8mmt7XthGh7s5BtBPGpzu_ttg%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024508.html">
   <LINK REL="Next"  HREF="024510.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted and kerberos</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20twisted%20and%20kerberos&In-Reply-To=CAMWA1_raiAEQkUEVnGGUCf8Dn8mmt7XthGh7s5BtBPGpzu_ttg%40mail.gmail.com"
       TITLE="[Twisted-Python] twisted and kerberos">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Fri Sep 16 07:24:31 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024508.html">[Twisted-Python] twisted and kerberos
</A></li>
        <LI>Next message: <A HREF="024510.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24509">[ date ]</a>
              <a href="thread.html#24509">[ thread ]</a>
              <a href="subject.html#24509">[ subject ]</a>
              <a href="author.html#24509">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/09/11 02:16, Benjamin Rutt wrote:
&gt;<i> Hello twisted experts,
</I>&gt;<i> We are trying to add kerberos authentication to our existing twisted
</I>&gt;<i> server. We haven't yet found a twisted specific library that can do
</I>&gt;<i> this; any pointers?
</I>
Over which protocol?

Do you only want authentication, or integrity/confidentiality as well?

&gt;<i> What we have found is python-krbV
</I>
I've used PyKerberos before to implement HTTP Negotiate auth for Twisted 
Web, but PyKerberos doesn't give you any integrity, and only client-side 
confidentiality IIRC:

<A HREF="http://trac.calendarserver.org/browser/PyKerberos">http://trac.calendarserver.org/browser/PyKerberos</A>

The state of python Kerberos/GSSAPI libraries is a bit poor, so I wrote 
my own in Pyrex!

&gt;<i> (<A HREF="https://fedorahosted.org/python-krbV/">https://fedorahosted.org/python-krbV/</A>), but we end up using it along
</I>&gt;<i> with code like this to take over the socket ourselves from twisted, when
</I>&gt;<i> the client connects:
</I>&gt;<i> self.transport.stopReading()
</I>&gt;<i> self.transport.stopWriting()
</I>&gt;<i> self.transport.socket.setblocking(1)
</I>&gt;<i> and then we use the self.transport.socket directly in blocking mode in
</I>&gt;<i> another thread (so it won't block the reactor). In particular, we use
</I>&gt;<i> code like this to start the authentication process:
</I>&gt;<i> ac = krbV.default_context().sendauth(self.transport.socket, ...)
</I>&gt;<i> &#8230;once the client has authenticated, we use:
</I>&gt;<i> self.transport.socket.setblocking(0)
</I>&gt;<i> self.transport.startReading()
</I>&gt;<i> self.transport.startWriting()
</I>&gt;<i> to let twisted take over the socket again for the rest of the conversation.
</I>&gt;<i> So in the event there are no ready-to-go twisted libraries for kerberos,
</I>&gt;<i> is the above approach totally insane?
</I>
So you're server-side?

I would advise using the GSSAPI stuff in PyKerberos; you drive the 
&quot;authGSSServer*&quot; functions in a loop, it gives you back the tokens and 
lets you handle the network transport yourself, so is easier to 
implement with Twisted.

Beware of course that the underlying GSS mechanism might block at any 
time; although in my experience this doesn't happen server-side, when 
using the Kerberos mech.

This will only be an option of course if you have control of the client 
and can switch to using GSSAPI there too.


Alternatively, you could modify your existing approach so that the 
entire Kerberos stuff ran in a deferToThread call, talking over a pipe 
or loopback TCP socket back to the main reactor, then use a dummy 
protocol to move the data back and forth to the &quot;real&quot; protocol. There 
may be easy/clean ways to do this using various Twisted utilities like 
twisted.protocols.policies.ProtocolWrapper, but I can't think of a 
design right now.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024508.html">[Twisted-Python] twisted and kerberos
</A></li>
	<LI>Next message: <A HREF="024510.html">[Twisted-Python] Weekly Bug Summary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24509">[ date ]</a>
              <a href="thread.html#24509">[ thread ]</a>
              <a href="subject.html#24509">[ subject ]</a>
              <a href="author.html#24509">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
