<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Bug in Finger Tutorial?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Bug%20in%20Finger%20Tutorial%3F&In-Reply-To=CAG4NAK5PpB7uagS_qheB2J6XG-ZnVHHNjTrNvUNQ186XewQGeg%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024591.html">
   <LINK REL="Next"  HREF="024593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Bug in Finger Tutorial?</H1>
    <B>Dorian Raymer</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Bug%20in%20Finger%20Tutorial%3F&In-Reply-To=CAG4NAK5PpB7uagS_qheB2J6XG-ZnVHHNjTrNvUNQ186XewQGeg%40mail.gmail.com"
       TITLE="[Twisted-Python] Bug in Finger Tutorial?">deldotdr at gmail.com
       </A><BR>
    <I>Thu Sep 29 18:41:58 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="024591.html">[Twisted-Python] Bug in Finger Tutorial?
</A></li>
        <LI>Next message: <A HREF="024593.html">[Twisted-Python] Question about &quot;starving&quot; the reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24592">[ date ]</a>
              <a href="thread.html#24592">[ thread ]</a>
              <a href="subject.html#24592">[ subject ]</a>
              <a href="author.html#24592">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Sep 29, 2011 at 3:23 PM, David Kao &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">a.libran at gmail.com</A>&gt; wrote:

&gt;<i> On Fri, Sep 30, 2011 at 6:10 AM, Dorian Raymer &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">deldotdr at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Thu, Sep 29, 2011 at 2:44 PM, David Kao &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">a.libran at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I'll take care of the first question.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; From The Evolution of Finger: making a finger library,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; h = internet.TCPServer(79, IFingerFactory(f))
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; notice IFingerFactory? If you read the earlier parts of the tutorial,
</I>&gt;<i> &gt;&gt; you'll see stuff like components.registerAdapter. It's just magic to
</I>&gt;<i> &gt;&gt; create a FingerFactoryFromService, giving its constructor f, the
</I>&gt;<i> &gt;&gt; &quot;Finger Service&quot;. What happens here is that &quot;f&quot;, the Finger Service,
</I>&gt;<i> &gt;&gt; is different from the service.Service within the Twisted Framework.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The FingerService inherits service.Service and implements the
</I>&gt;<i> startService
</I>&gt;<i> &gt; event, so it *is* a service that can be run by the service framework; it
</I>&gt;<i> &gt; just isn't one of the twisted.application.internet services, like
</I>&gt;<i> &gt; internet.TCPServer.
</I>&gt;<i> &gt; Moreover, it needs to have startService called, somehow... and what I'm
</I>&gt;<i> &gt; saying is that in the full example (provided
</I>&gt;<i> &gt; in twisted/doc/core/howto/tutorial/listings/finger/finger/finger.py) it
</I>&gt;<i> is
</I>&gt;<i> &gt; not called, and if you actually try using it, it doesn't work.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Yes you are right. It's just the two concepts (adapter and service)
</I>&gt;<i> are different but are presented together. In this case, it happens
</I>&gt;<i> that FingerService needs initialization, and that initialization is
</I>&gt;<i> usually done via startService, which, I agree, isn't called. And it's
</I>&gt;<i> funky here because you don't want FingerService to be the service
</I>&gt;<i> here, because it doesn't know how to listen to TCP. bahhh ... yea the
</I>&gt;<i> example is not super great. It seems like you understand the examples
</I>&gt;<i> anyways.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; You might as well call &quot;f&quot;, the Finger Service, &quot;Finger Shared Data&quot;.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; What really happens here is
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; h is the service that has parent s, MultiService. s is then returned
</I>&gt;<i> &gt;&gt; and started by the application.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; h contains a factory that gets run.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The factory knows &quot;f&quot;, the Finger Service, which has nothing to do
</I>&gt;<i> &gt;&gt; with twisted's mechanism. It's more of a demo for the component based
</I>&gt;<i> &gt;&gt; framework. f is a way to share data and methods and states across
</I>&gt;<i> &gt;&gt; multiple factories.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I am also very new to twisted, so I **hope** this understanding of
</I>&gt;<i> &gt;&gt; mine is correct ...
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I strongly recommend you read through the entire tutorial. They build
</I>&gt;<i> &gt;&gt; very incrementally, so most of the time the code is repeated so you
</I>&gt;<i> &gt;&gt; can just skim through it if you had started from the beginning.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've read it many times over the years ;) It's surprisingly complete as
</I>&gt;<i> an
</I>&gt;<i> &gt; example...you just don't know that in the beginning.
</I>&gt;<i> &gt; The topic area of this question is something I'm trying to squeeze out of
</I>&gt;<i> &gt; this tutorial series; I'm encountering conceptual questions beyond the
</I>&gt;<i> &gt; mechanics of how the framework works (which the tutorial does a great job
</I>&gt;<i> of
</I>&gt;<i> &gt; explaining) like:
</I>&gt;<i> &gt; should I ever make a tree of dependent services?
</I>&gt;<i> &gt; What if I do something in a startService method that I want to make sure
</I>&gt;<i> &gt; works before other services get their startService called?
</I>&gt;<i> &gt; If I create a bunch of business services (that just provide pure
</I>&gt;<i> &gt; functionality) that I then adapt for deployment in different t.a.internet
</I>&gt;<i> &gt; services, should I put the business services in their own MultiService
</I>&gt;<i> and
</I>&gt;<i> &gt; the internet services in their own MutiService container?
</I>&gt;<i> &gt; Like I said, more showcasing of use cases would help suggest answers to
</I>&gt;<i> &gt; these kind of questions. I see a lot of possibilities, but haven't put in
</I>&gt;<i> &gt; the time in the trenches to try them all out ;)
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt; -Dorian
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Totally agree with your suggestion.
</I>&gt;<i>
</I>&gt;<i> I have the exact same problem here. In the end I just start doing
</I>&gt;<i> things using reactor.listenTCP and forget about services since it
</I>&gt;<i> isn't clear in the docs the order in which services are started. I
</I>&gt;<i> sort of use one big setup service as &quot;Main()&quot;, and then do my own
</I>&gt;<i> hooks using &quot;fake service&quot; inside each factory, and the call
</I>&gt;<i> reactor.listenTCP on those factories.
</I>&gt;<i>
</I>&gt;<i> Cool, yeah I do similar things as well.
</I>

&gt;<i> It might just be services are meant to be really independent and
</I>&gt;<i> parallel to each other. I dunno ... I'll let the veterans speak now.
</I>&gt;<i>
</I>&gt;<i> Yeah, there is definitely a lot of value in keeping the
</I>transport enabling services separate from the functional services. Keeping
them independent and parallel seems like the better way to go. Maybe my
misunderstanding is what the scope of Twisted Services was intended to
be...Up to now, I've been thinking about designing applications that use
Twisted Services for both pure business functionality AND for things that
provide network transport. I briefly looked at how erlang/OTP handles
starting dependencies in apps. The rabbitmq app blocks/waits for each major
component to start (which would be like a Twisted Service.startService
returning a Deferred). I guess this is just a hard problem, or maybe I'm
missing a concept.

Thanks,
-Dorian



&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; David Kao
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Fri, Sep 30, 2011 at 5:28 AM, Dorian Raymer &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">deldotdr at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt; &gt; Hello,
</I>&gt;<i> &gt;&gt; &gt; I am confused about how the FingerService gets started in the
</I>&gt;<i> &gt;&gt; &gt; finger/finger.py makeService function. It is never assigned a service
</I>&gt;<i> &gt;&gt; &gt; parent
</I>&gt;<i> &gt;&gt; &gt; and it can't service getUser requests if its startService method isn't
</I>&gt;<i> &gt;&gt; &gt; called; you get an AttributeError: &quot;no attribute 'users'&quot; the way it
</I>&gt;<i> &gt;&gt; &gt; works
</I>&gt;<i> &gt;&gt; &gt; now. Is this a bug?
</I>&gt;<i> &gt;&gt; &gt; The most sensible thing, in this case, seems to be setting the
</I>&gt;<i> &gt;&gt; &gt; FingerService
</I>&gt;<i> &gt;&gt; &gt; parent to be the MultiService container that all of the interent
</I>&gt;<i> &gt;&gt; &gt; services
</I>&gt;<i> &gt;&gt; &gt; are added to in the makeService function. Is that correct?
</I>&gt;<i> &gt;&gt; &gt; I'm wondering if their are any other strategies people use for
</I>&gt;<i> starting
</I>&gt;<i> &gt;&gt; &gt; non-internet services.
</I>&gt;<i> &gt;&gt; &gt; For instance, if instead of reading a file to get to my user db, I
</I>&gt;<i> might
</I>&gt;<i> &gt;&gt; &gt; want to start a redis client and read from redis to service a getUser
</I>&gt;<i> &gt;&gt; &gt; call.
</I>&gt;<i> &gt;&gt; &gt; But that means I'd want to make sure the startService call succeeded
</I>&gt;<i> &gt;&gt; &gt; (the
</I>&gt;<i> &gt;&gt; &gt; redis connection was made) before one of the internet services tries
</I>&gt;<i> to
</I>&gt;<i> &gt;&gt; &gt; use
</I>&gt;<i> &gt;&gt; &gt; the FingerService (a timing problem that doesn't exist when just
</I>&gt;<i> reading
</I>&gt;<i> &gt;&gt; &gt; a
</I>&gt;<i> &gt;&gt; &gt; file)...or something. Maybe I'm really just wondering how the twisted
</I>&gt;<i> &gt;&gt; &gt; application framework handles exceptions that occur for startService
</I>&gt;<i> &gt;&gt; &gt; calls.
</I>&gt;<i> &gt;&gt; &gt; Maybe I need something else to handle that kind of thing?
</I>&gt;<i> &gt;&gt; &gt; I'm also wondering if it's ever a good idea to make a extension
</I>&gt;<i> &gt;&gt; &gt; of ServerFactory (that adapts a Service) that
</I>&gt;<i> calls Service.startService
</I>&gt;<i> &gt;&gt; &gt; when Factory.startServer is called (and Service.stopService when
</I>&gt;<i> &gt;&gt; &gt; Factory.stopFactory is called)?
</I>&gt;<i> &gt;&gt; &gt; And I'm looking for more use cases/projects (beyond the finger
</I>&gt;<i> tutorial)
</I>&gt;<i> &gt;&gt; &gt; that really showcase the twisted application framework. Any references
</I>&gt;<i> &gt;&gt; &gt; would
</I>&gt;<i> &gt;&gt; &gt; be appreciated!
</I>&gt;<i> &gt;&gt; &gt; Thanks!
</I>&gt;<i> &gt;&gt; &gt; -Dorian
</I>&gt;<i> &gt;&gt; &gt; _______________________________________________
</I>&gt;<i> &gt;&gt; &gt; Twisted-Python mailing list
</I>&gt;<i> &gt;&gt; &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt;&gt; &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Twisted-Python mailing list
</I>&gt;<i> &gt;&gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Twisted-Python mailing list
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> &gt; <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20110929/fa589ee7/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20110929/fa589ee7/attachment.htm</A> 
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024591.html">[Twisted-Python] Bug in Finger Tutorial?
</A></li>
	<LI>Next message: <A HREF="024593.html">[Twisted-Python] Question about &quot;starving&quot; the reactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24592">[ date ]</a>
              <a href="thread.html#24592">[ thread ]</a>
              <a href="subject.html#24592">[ subject ]</a>
              <a href="author.html#24592">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
