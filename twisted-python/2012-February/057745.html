<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Conch text attribute flattening quirks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Conch%20text%20attribute%20flattening%20quirks&In-Reply-To=%3C20120222152556.GO23050%40boombah.thristian.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="057744.html">
   <LINK REL="Next"  HREF="057746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Conch text attribute flattening quirks</H1>
    <B>Tim Allen</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Conch%20text%20attribute%20flattening%20quirks&In-Reply-To=%3C20120222152556.GO23050%40boombah.thristian.org%3E"
       TITLE="[Twisted-Python] Conch text attribute flattening quirks">screwtape at froup.com
       </A><BR>
    <I>Wed Feb 22 08:25:56 MST 2012</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="057744.html">[Twisted-Python] Conch text attribute flattening quirks
</A></li>
        <LI>Next message (by thread): <A HREF="057746.html">[Twisted-Python] Conch text attribute flattening quirks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57745">[ date ]</a>
              <a href="thread.html#57745">[ thread ]</a>
              <a href="subject.html#57745">[ subject ]</a>
              <a href="author.html#57745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Feb 22, 2012 at 01:47:46PM +0200, Jonathan Jacobs wrote:
&gt;<i> &gt;&gt;&gt; from twisted.conch.insults.helper import CharacterAttribute
</I>&gt;<i> &gt;&gt;&gt; from twisted.conch.insults.text import flatten, attributes as A
</I>&gt;<i> &gt;&gt;&gt; flatten(A.normal['hello', A.bold[' world '], 'quux'], CharacterAttribute())
</I>&gt;<i> 'hello\x1b[1m world quux'
</I>&gt;<i> 
</I>&gt;<i> My expectations are that only &quot; world &quot; will be marked up with bold
</I>&gt;<i> attributes, since it is the only piece of content in the &quot;bold&quot;
</I>&gt;<i> attribute, while &quot;hello&quot; and &quot;quux&quot; both appear in normal text, i.e.
</I>&gt;<i> without any additional markup. Looking at the output you can see that
</I>&gt;<i> &quot;hello&quot; appears as normal text and then &quot; world quux&quot; appears in bold.
</I>
Since it's in twisted.conch, I'm guessing that this character-attribute
stuff is designed to model the VT100 character attribute system, rather
than some generic tree-of-strings-and-attributes. For example, somebody
used to the way HTML works might want to nest bold and italics like
this:

    &lt;i&gt;hello &lt;b&gt;world&lt;/b&gt; quux&lt;/i&gt;

However, to achieve the same result on a traditional terminal (and using
the tput(1) command to produce the formatting codes), you'd have to do
something like this:

    tput sitm	    # enable italics
    echo -n &quot;hello &quot;
    tput bold	    # enable bold
    echo -n &quot;world&quot;
    tput sgr0	    # disable all special attributes
    tput sitm	    # enable italics again
    echo &quot; quux&quot;

...that is, there's no code for 'end bold' or 'end italics' (or blink, dim,
underline, invisible, any kind of colouring, etc.) just an 'end all
special attributes' code. Therefore it's reasonable for conch's helper
library to not handle nested formatting, since no terminal program will
produce such a thing, because it's impossible to represent in the
VT100/VT200 formatting language.

I guess an argument could be made that the helper function should track
which attributes are enabled at any particular point in the string, and
calculate the correct sequence of disable-everything/re-enable-the-
remaining-attributes codes, but evidently nobody's needed such a thing
before.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="057744.html">[Twisted-Python] Conch text attribute flattening quirks
</A></li>
	<LI>Next message (by thread): <A HREF="057746.html">[Twisted-Python] Conch text attribute flattening quirks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57745">[ date ]</a>
              <a href="thread.html#57745">[ thread ]</a>
              <a href="subject.html#57745">[ subject ]</a>
              <a href="author.html#57745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
