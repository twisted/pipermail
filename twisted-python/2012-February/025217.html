<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] pushing out same message on 100k TCPs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20pushing%20out%20same%20message%20on%20100k%20TCPs&In-Reply-To=634914A010D0B943A035D226786325D42D597544D3%40EXVMBX020-12.exch020.serverdata.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025216.html">
   <LINK REL="Next"  HREF="025218.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] pushing out same message on 100k TCPs</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20pushing%20out%20same%20message%20on%20100k%20TCPs&In-Reply-To=634914A010D0B943A035D226786325D42D597544D3%40EXVMBX020-12.exch020.serverdata.net"
       TITLE="[Twisted-Python] pushing out same message on 100k TCPs">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Fri Feb 10 12:49:26 EST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025216.html">[Twisted-Python] pushing out same message on 100k TCPs
</A></li>
        <LI>Next message: <A HREF="025218.html">[Twisted-Python] pushing out same message on 100k TCPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25217">[ date ]</a>
              <a href="thread.html#25217">[ thread ]</a>
              <a href="subject.html#25217">[ subject ]</a>
              <a href="author.html#25217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/02/12 16:56, Tobias Oberstein wrote:
&gt;<i> Hi there,
</I>&gt;<i>
</I>&gt;<i> what is the most efficient/performant way of doing the following?
</I>&gt;<i>
</I>&gt;<i> I have a short message prepared .. say a string of 100 octets.
</I>&gt;<i> I want to push out that _same_ string on 100k connected TCPs (on a server).
</I>&gt;<i>
</I>&gt;<i> ==
</I>&gt;<i>
</I>&gt;<i> My thinking was: ideally, the 100 bytes would be transferred to kernel/NIC space
</I>&gt;<i> just _once_, and then the kernel is only told to resend that buffer on the 100k
</I>&gt;<i> connected TCPs.
</I>&gt;<i>
</I>&gt;<i> Does that make sense, is that even possible, with Twisted, or in general?
</I>
Not really, no.

The problem is that TCP requires the sender of data to buffer so that it 
can re-send. The only way to store one copy of the data whilst doing 
this would be to store the socket buffer as a (fairly complex) linked 
list of reference-counted blocks, and use scatter-gather IO to the 
network card.

So the kernel would have to copy the data 100k times anyway, to store it 
in the per-socket buffer until it was ACKed, or maintain a large and 
complex data structure so that it could use one copy.

Therefore, by moving the work to the kernel, all you've done is consume 
valuable kernel memory, in return for saving the syscall overhead. 
Classic space/time tradeoff.

If you were using UDP, then in theory this might be possible, but there 
are no APIs that I know of, except for multicast (where you only send 
one copy of the data, and the network duplicates it).

In short; this kind of thing seems easy and desirable but actually it's 
really hard and not useful.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025216.html">[Twisted-Python] pushing out same message on 100k TCPs
</A></li>
	<LI>Next message: <A HREF="025218.html">[Twisted-Python] pushing out same message on 100k TCPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25217">[ date ]</a>
              <a href="thread.html#25217">[ thread ]</a>
              <a href="subject.html#25217">[ subject ]</a>
              <a href="author.html#25217">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
