<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] accurate periodic call
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20accurate%20periodic%20call&In-Reply-To=817B9127-B415-4E39-B39B-070AD9DF6B45%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025264.html">
   <LINK REL="Next"  HREF="025267.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] accurate periodic call</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20accurate%20periodic%20call&In-Reply-To=817B9127-B415-4E39-B39B-070AD9DF6B45%40twistedmatrix.com"
       TITLE="[Twisted-Python] accurate periodic call">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Tue Feb 21 06:05:33 EST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="025264.html">[Twisted-Python] accurate periodic call
</A></li>
        <LI>Next message: <A HREF="025267.html">[Twisted-Python] accurate periodic call
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25266">[ date ]</a>
              <a href="thread.html#25266">[ thread ]</a>
              <a href="subject.html#25266">[ subject ]</a>
              <a href="author.html#25266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/02/12 20:32, Glyph wrote:

&gt;<i> Well, it depends on how you define a &quot;bug&quot;.  LoopingCall's internal
</I>&gt;<i> state remains consistent, but if you set your clock backwards,
</I>&gt;<i> LoopingCall won't fire your callback again until the system clock
</I>&gt;<i> catches up to where it previously was.  Any new LoopingCalls that are
</I>&gt;<i> created will work fine, although they will probably report an
</I>&gt;<i> incorrect skipCount if you set the clock forward again.
</I>
Ah. This doesn't jump out from the original ticket text; the way I read 
the text, it implies the LoopingCall stops being *scheduled* if the 
clock goes backwards.

If I'm understanding it correctly, the problem is actually that the 
callLater for the next run doesn't fire when expected, because it's 
scheduled in the &quot;pre-change&quot; timeframe (now the future). As opposed to 
being anything in the LoopingCall code?

I realise this is tricky to solve, but I'll note it's not impossible for 
really REALLY big clock skews to happen. For example: recently we had a 
server kernel panic and need a cold reboot. The machine booted and read 
it's time from the CMOS clock, which was way WAY out. A minute or two 
after the machine had booted, NTP slewed the clock back by months... 
Fortunately this box doesn't run any Twisted code that a) starts on boot 
and b) makes use of LoopingCall.

[I know this is horrible, but a lot of Unix distros don't sync system to 
hardware clock periodically - usually on shutdown only - and a lot of 
distros don't block boot until NTP has set the clock]

I realise it's an edge case; but at the very least, it is probably worth 
updating the LoopingCall/IReactorTime.callLater documentation to make 
this behaviour clear, because I certainly didn't appreciate this could 
occur. It's pretty obvious in hindsight, though.

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025264.html">[Twisted-Python] accurate periodic call
</A></li>
	<LI>Next message: <A HREF="025267.html">[Twisted-Python] accurate periodic call
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25266">[ date ]</a>
              <a href="thread.html#25266">[ thread ]</a>
              <a href="subject.html#25266">[ subject ]</a>
              <a href="author.html#25266">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
