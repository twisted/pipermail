<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Multiple deferreds that depend on each other
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Multiple%20deferreds%20that%20depend%20on%20each%20other&In-Reply-To=95bb10690911170808t42ab6526na0e5a350345295ab%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021017.html">
   <LINK REL="Next"  HREF="021026.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Multiple deferreds that depend on each other</H1>
    <B>Landreville</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Multiple%20deferreds%20that%20depend%20on%20each%20other&In-Reply-To=95bb10690911170808t42ab6526na0e5a350345295ab%40mail.gmail.com"
       TITLE="[Twisted-Python] Multiple deferreds that depend on each other">landreville at deadtreepages.com
       </A><BR>
    <I>Tue Nov 17 12:15:02 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="021017.html">[Twisted-Python] Multiple deferreds that depend on each other
</A></li>
        <LI>Next message: <A HREF="021026.html">[Twisted-Python] server push data to client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21019">[ date ]</a>
              <a href="thread.html#21019">[ thread ]</a>
              <a href="subject.html#21019">[ subject ]</a>
              <a href="author.html#21019">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Oh I like the look of the inlineCallbacks. Is there a way that I can still
use inspect.getargspec to retrieve the arg names of my original method, as
opposed to the generator returned by inlineCallbacks.

I noticed it copies the __doc__ over, but is there an attribute where I can
still inspect my original method?

On Tue, Nov 17, 2009 at 11:08 AM, Reza Lotun &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rlotun at gmail.com</A>&gt; wrote:

&gt;<i> Hi Landreville,
</I>&gt;<i>
</I>&gt;<i> &gt; If I want to do a number of actions in a row that each return a deferred
</I>&gt;<i> but
</I>&gt;<i> &gt; depend on eachother, do I need to nest those callbacks?
</I>&gt;<i> &gt; Ie if i want to:
</I>&gt;<i> &gt; 1. Call database function using adbabi
</I>&gt;<i> &gt; 2. Call xmlrpc method using result from 1
</I>&gt;<i> &gt; 3. Call database using result from 2
</I>&gt;<i> &gt; Would I just put 2 inside the callback for 1 and then put 3 inside the
</I>&gt;<i> &gt; callback for 2?
</I>&gt;<i>
</I>&gt;<i> By multiple deferreds that depend on each other, you probably mean a
</I>&gt;<i> linear firing of actions based on callbacks of previous actions. The
</I>&gt;<i> only way to do that is to trigger actions in callbacks of the
</I>&gt;<i> deferreds in question, as you allude to.
</I>&gt;<i>
</I>&gt;<i> Yeah, so roughly something like this would work:
</I>&gt;<i>
</I>&gt;<i> def db_call(arg):
</I>&gt;<i>   dfr = make_db_call_in_thread(arg)
</I>&gt;<i>   return dfr
</I>&gt;<i>
</I>&gt;<i> def xmlrpc_call(arg):
</I>&gt;<i>   dfr = make_call(arg)
</I>&gt;<i>   return dfr
</I>&gt;<i>
</I>&gt;<i> dfr = db_call(some_initial_arg)
</I>&gt;<i> dfr.addCallback(xmlrpc)
</I>&gt;<i> dfr.addCallback(db_call)
</I>&gt;<i>
</I>&gt;<i> &gt; How would I do that in one function? All the examples I have seen have a
</I>&gt;<i> &gt; function calling one method returning a deferred and then placing the
</I>&gt;<i> logic
</I>&gt;<i> &gt; (doing something with the result) in the callback, but do not deal with
</I>&gt;<i> &gt; multiple deferreds that depend on each other.
</I>&gt;<i>
</I>&gt;<i> To do it in one function, you could use something like:
</I>&gt;<i>
</I>&gt;<i> def complex_call():
</I>&gt;<i>    def db_call(arg):
</I>&gt;<i>       dfr = make_db_call_in_thread(arg)
</I>&gt;<i>       return dfr
</I>&gt;<i>
</I>&gt;<i>    def xmlrpc_call(arg):
</I>&gt;<i>       dfr = make_call(arg)
</I>&gt;<i>       return dfr
</I>&gt;<i>
</I>&gt;<i>    dfr = db_call(some_initial_arg)
</I>&gt;<i>    dfr.addCallback(xmlrpc_call)
</I>&gt;<i>    dfr.addCallback(db_call)
</I>&gt;<i>    dfr.addErrback(my_errback_handler)
</I>&gt;<i>    return dfr
</I>&gt;<i>
</I>&gt;<i> Or you can make each handler a method on a class. Another way to do it
</I>&gt;<i> is to use inlineCallbacks:
</I>&gt;<i>
</I>&gt;<i> from twisted.internet import defer
</I>&gt;<i> @defer.inlineCallbacks
</I>&gt;<i> def example():
</I>&gt;<i>    res = yield db_call(some_initial_arg)
</I>&gt;<i>    rpc_res = yield xmlrpc_call(res)
</I>&gt;<i>    db_res = yield db_call(rpc_res)
</I>&gt;<i>
</I>&gt;<i> In the above example, it's all still asynchronous (if not parallel),
</I>&gt;<i> but it looks like it's synchronous, using the magic of decorators and
</I>&gt;<i> Python 2.5+'s ability to retrieve results from yield statements.
</I>&gt;<i>
</I>&gt;<i> Hope that makes sense.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Reza
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Reza Lotun
</I>&gt;<i> mobile: +44 (0)7521 310 763
</I>&gt;<i> email:  <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rlotun at gmail.com</A>
</I>&gt;<i> work:   <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">reza at tweetdeck.com</A>
</I>&gt;<i> twitter: @rlotun
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-python/attachments/20091117/6b2f4993/attachment.htm">http://twistedmatrix.com/pipermail/twisted-python/attachments/20091117/6b2f4993/attachment.htm</A> 
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021017.html">[Twisted-Python] Multiple deferreds that depend on each other
</A></li>
	<LI>Next message: <A HREF="021026.html">[Twisted-Python] server push data to client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21019">[ date ]</a>
              <a href="thread.html#21019">[ thread ]</a>
              <a href="subject.html#21019">[ subject ]</a>
              <a href="author.html#21019">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
