<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] PyObjC and Twisted command line script
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20PyObjC%20and%20Twisted%20command%20line%20script&In-Reply-To=%3Cc50d9eb70911090943r68b17008y8014081749a5c371%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053326.html">
   <LINK REL="Next"  HREF="053321.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] PyObjC and Twisted command line script</H1>
    <B>Jonathan Stoppani</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20PyObjC%20and%20Twisted%20command%20line%20script&In-Reply-To=%3Cc50d9eb70911090943r68b17008y8014081749a5c371%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] PyObjC and Twisted command line script">jonathan at garetjax.info
       </A><BR>
    <I>Mon Nov  9 10:43:15 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053326.html">[Twisted-Python] PyObjC and Twisted command line script
</A></li>
        <LI>Next message (by thread): <A HREF="053321.html">[Twisted-Python] Retrying function calls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53425">[ date ]</a>
              <a href="thread.html#53425">[ thread ]</a>
              <a href="subject.html#53425">[ subject ]</a>
              <a href="author.html#53425">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi David,
I discovered this message in my &quot;sent&quot; (???) mailbox only today, sorry for
the delay...

Anyway, thanks for the response, very clear.
The ticket I was referencing to (I forgot to paste the link) is this
one: <A HREF="http://twistedmatrix.com/trac/ticket/2812">http://twistedmatrix.com/trac/ticket/2812</A>

ATM I'm communicating with a separate Cocoa application using
notifications and looking forward to use Cocoa Distributed Objects for
greater flexibility, but I'll consider your approach for
future developments.

Thanks,
Jonathan


On Mon, Nov 2, 2009 at 2:00 AM, David Bolen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">db3l.net at gmail.com</A>&gt; wrote:
&gt;<i> Not sure which ticket is being referenced but which Twisted reactor
</I>&gt;<i> are you using?  I've had very good luck with the threadedselect
</I>&gt;<i> reactor, which shouldn't care if your main loop is a GUI or not.  You
</I>&gt;<i> interleave with AppHelper.callAfter, which I think should work fine
</I>&gt;<i> with both runConsoleEventLoopas well as the GUI runEventLoop
</I>&gt;<i>
</I>&gt;<i> For my part, any OSX console apps I've had to do could just be pure
</I>&gt;<i> Twisted, with no need to integrate with an NSRunLoop, so I'm not that
</I>&gt;<i> familiar with how you best track startup/shutdown in those cases.
</I>&gt;<i>
</I>&gt;<i> But fundamentally, you install the threadedselect reactor (do that
</I>&gt;<i> before any other code uses &quot;from twisted.internet import reactor&quot;),
</I>&gt;<i> then use &quot;reactor.interleave(AppHelper.callAfter)&quot; to tie the reactor
</I>&gt;<i> in to the normal event loop.  In the Cocoa/NSApplication scenario, I
</I>&gt;<i> use the applicationDidFinishLaunching notification to trigger this.
</I>&gt;<i>
</I>&gt;<i> During shutdown, wait for the reactor to perform its shutdown so it
</I>&gt;<i> can close things down cleanly, using a reactor trigger to finalize the
</I>&gt;<i> event loop with &quot;AppHelper.stopEventLoop&quot;.  Again, presumably you'll
</I>&gt;<i> have some way to determine when this is appropriate in your console
</I>&gt;<i> event loop - in a Cocoa/NSApplication scenario, I use the
</I>&gt;<i> applicationShouldTerminate notification.  (I've tended to install the
</I>&gt;<i> trigger right at that point too, although it could also be done
</I>&gt;<i> earlier)
</I>&gt;<i>
</I>&gt;<i> Here's a trivial example, where I kluge a startup event.  Presumably
</I>&gt;<i> the reason you are using runConsoleEventLoop is to use other native
</I>&gt;<i> event/input sources based operations, so you might have a more logical
</I>&gt;<i> place or event to identify when to start the twisted integration - all
</I>&gt;<i> that's required is that it be done after the main event loop is
</I>&gt;<i> running.  If not, while I chose a 1s startup delay in this example, it
</I>&gt;<i> was mostly to see the difference in timestamps - you can make the
</I>&gt;<i> initial callLater a timeout of 0, and it'll just run as soon as the
</I>&gt;<i> event loop gets started.
</I>&gt;<i>
</I>&gt;<i> This example also just terminates after two Twisted-based delayed
</I>&gt;<i> events, but that would also be determined by your own application:
</I>&gt;<i>
</I>&gt;<i>    &quot;&quot;&quot;Test console event loop app with Twisted threadedselect reactor&quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i>    import time
</I>&gt;<i>
</I>&gt;<i>    from PyObjCTools import AppHelper
</I>&gt;<i>
</I>&gt;<i>    from twisted.internet._threadedselect import install
</I>&gt;<i>    reactor = install()
</I>&gt;<i>
</I>&gt;<i>    class Main(object):
</I>&gt;<i>
</I>&gt;<i>        def startup(self):
</I>&gt;<i>            print time.ctime(), 'Main starting'
</I>&gt;<i>            reactor.callLater(1, self.callback)
</I>&gt;<i>            reactor.interleave(AppHelper.callAfter)
</I>&gt;<i>
</I>&gt;<i>        def terminate(self):
</I>&gt;<i>            print time.ctime(), 'Shutting down reactor'
</I>&gt;<i>            reactor.addSystemEventTrigger('after', 'shutdown',
</I>&gt;<i>                                          AppHelper.stopEventLoop)
</I>&gt;<i>            reactor.stop()
</I>&gt;<i>
</I>&gt;<i>        def callback(self):
</I>&gt;<i>            print time.ctime(), 'I was called by the reactor'
</I>&gt;<i>            reactor.callLater(1, self.terminate)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>    if __name__ == &quot;__main__&quot;:
</I>&gt;<i>
</I>&gt;<i>        main = Main()
</I>&gt;<i>        AppHelper.callLater(1, main.startup)
</I>&gt;<i>
</I>&gt;<i>        print time.ctime(), 'Starting Event Loop'
</I>&gt;<i>        AppHelper.runConsoleEventLoop()
</I>&gt;<i>        print time.ctime(), 'Terminating'
</I>&gt;<i>
</I>&gt;<i> When running, this produces:
</I>&gt;<i>
</I>&gt;<i>    Sun Nov  1 19:53:16 2009 Starting Event Loop
</I>&gt;<i>    Sun Nov  1 19:53:17 2009 Main starting
</I>&gt;<i>    Sun Nov  1 19:53:18 2009 I was called by the reactor
</I>&gt;<i>    Sun Nov  1 19:53:19 2009 Shutting down reactor
</I>&gt;<i>    Sun Nov  1 19:53:19 2009 Terminating
</I>&gt;<i>
</I>&gt;<i> -- David
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-Python mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">Twisted-Python at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python</A>
</I>&gt;<i>
</I>


-- 
Best Regards,
Jonathan Stoppani


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053326.html">[Twisted-Python] PyObjC and Twisted command line script
</A></li>
	<LI>Next message (by thread): <A HREF="053321.html">[Twisted-Python] Retrying function calls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53425">[ date ]</a>
              <a href="thread.html#53425">[ thread ]</a>
              <a href="subject.html#53425">[ subject ]</a>
              <a href="author.html#53425">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
