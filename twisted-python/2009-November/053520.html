<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Multiple deferreds that depend on each other
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20deferreds%20that%20depend%20on%20each%20other&In-Reply-To=%3C95bb10690911170808t42ab6526na0e5a350345295ab%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053518.html">
   <LINK REL="Next"  HREF="053522.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Multiple deferreds that depend on each other</H1>
    <B>Reza Lotun</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Multiple%20deferreds%20that%20depend%20on%20each%20other&In-Reply-To=%3C95bb10690911170808t42ab6526na0e5a350345295ab%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Multiple deferreds that depend on each other">rlotun at gmail.com
       </A><BR>
    <I>Tue Nov 17 09:08:22 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053518.html">[Twisted-Python] Multiple deferreds that depend on each other
</A></li>
        <LI>Next message (by thread): <A HREF="053522.html">[Twisted-Python] Multiple deferreds that depend on each other
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53520">[ date ]</a>
              <a href="thread.html#53520">[ thread ]</a>
              <a href="subject.html#53520">[ subject ]</a>
              <a href="author.html#53520">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Landreville,

&gt;<i> If I want to do a number of actions in a row that each return a deferred but
</I>&gt;<i> depend on eachother, do I need to nest those callbacks?
</I>&gt;<i> Ie if i want to:
</I>&gt;<i> 1. Call database function using adbabi
</I>&gt;<i> 2. Call xmlrpc method using result from 1
</I>&gt;<i> 3. Call database using result from 2
</I>&gt;<i> Would I just put 2 inside the callback for 1 and then put 3 inside the
</I>&gt;<i> callback for 2?
</I>
By multiple deferreds that depend on each other, you probably mean a
linear firing of actions based on callbacks of previous actions. The
only way to do that is to trigger actions in callbacks of the
deferreds in question, as you allude to.

Yeah, so roughly something like this would work:

def db_call(arg):
   dfr = make_db_call_in_thread(arg)
   return dfr

def xmlrpc_call(arg):
   dfr = make_call(arg)
   return dfr

dfr = db_call(some_initial_arg)
dfr.addCallback(xmlrpc)
dfr.addCallback(db_call)

&gt;<i> How would I do that in one function? All the examples I have seen have a
</I>&gt;<i> function calling one method returning a deferred and then placing the logic
</I>&gt;<i> (doing something with the result) in the callback, but do not deal with
</I>&gt;<i> multiple deferreds that depend onÂ each other.
</I>
To do it in one function, you could use something like:

def complex_call():
    def db_call(arg):
       dfr = make_db_call_in_thread(arg)
       return dfr

    def xmlrpc_call(arg):
       dfr = make_call(arg)
       return dfr

    dfr = db_call(some_initial_arg)
    dfr.addCallback(xmlrpc_call)
    dfr.addCallback(db_call)
    dfr.addErrback(my_errback_handler)
    return dfr

Or you can make each handler a method on a class. Another way to do it
is to use inlineCallbacks:

from twisted.internet import defer
@defer.inlineCallbacks
def example():
    res = yield db_call(some_initial_arg)
    rpc_res = yield xmlrpc_call(res)
    db_res = yield db_call(rpc_res)

In the above example, it's all still asynchronous (if not parallel),
but it looks like it's synchronous, using the magic of decorators and
Python 2.5+'s ability to retrieve results from yield statements.

Hope that makes sense.

Cheers,
Reza

-- 
Reza Lotun
mobile: +44 (0)7521 310 763
email:  <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">rlotun at gmail.com</A>
work:   <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">reza at tweetdeck.com</A>
twitter: @rlotun


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053518.html">[Twisted-Python] Multiple deferreds that depend on each other
</A></li>
	<LI>Next message (by thread): <A HREF="053522.html">[Twisted-Python] Multiple deferreds that depend on each other
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53520">[ date ]</a>
              <a href="thread.html#53520">[ thread ]</a>
              <a href="subject.html#53520">[ subject ]</a>
              <a href="author.html#53520">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
