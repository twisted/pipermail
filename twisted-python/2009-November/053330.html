<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Using a custom reactor in twisted trial for	test cases?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Using%20a%20custom%20reactor%20in%20twisted%20trial%20for%0A%09test%20cases%3F&In-Reply-To=%3CDB84F181-80F5-45AC-835E-8F9C3ECD2FE3%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053329.html">
   <LINK REL="Next"  HREF="053331.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Using a custom reactor in twisted trial for	test cases?</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Using%20a%20custom%20reactor%20in%20twisted%20trial%20for%0A%09test%20cases%3F&In-Reply-To=%3CDB84F181-80F5-45AC-835E-8F9C3ECD2FE3%40twistedmatrix.com%3E"
       TITLE="[Twisted-Python] Using a custom reactor in twisted trial for	test cases?">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Nov  1 23:12:27 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053329.html">[Twisted-Python] Using a custom reactor in twisted trial for test	cases?
</A></li>
        <LI>Next message (by thread): <A HREF="053331.html">[Twisted-Python] Using a custom reactor in twisted trial for test cases?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53330">[ date ]</a>
              <a href="thread.html#53330">[ thread ]</a>
              <a href="subject.html#53330">[ subject ]</a>
              <a href="author.html#53330">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Nov 1, 2009, at 11:17 PM, Crispin Wellington wrote:

&gt;<i> On Fri, 2009-10-30 at 14:06 +0000, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">exarkun at twistedmatrix.com</A> wrote:
</I>&gt;&gt;<i> It looks like your custom reactor is mainly in charge of making sure
</I>&gt;&gt;<i> stackless.schedule() gets called at least once every 0.1 seconds.  Is
</I>&gt;&gt;<i> that right?  If so, a much better approach would be to use
</I>&gt;&gt;<i> twisted.internet.task.LoopingCall rather than implementing a custom
</I>&gt;&gt;<i> reactor.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is there something undesirable about that (much simpler, less  
</I>&gt;&gt;<i> fragile)
</I>&gt;&gt;<i> approach?
</I>&gt;<i>
</I>&gt;<i> I tried using LoopingCall, but it does not work. It only calls the
</I>&gt;<i> scheduler once. I think this has to do with the fact that the  
</I>&gt;<i> stackless
</I>&gt;<i> scheduler needs to be interwoven with the twisted reactor pump.
</I>
LoopingCall does &quot;interweave&quot; the function that you pass to it with  
the &quot;twisted reactor pump&quot;.  If you were using it correctly, it would  
work, as the page that you link to indicates :).

What do you mean &quot;does not work&quot;?

&gt;<i> There is
</I>&gt;<i> more info about why it has to be done like this here:
</I>&gt;<i> <A HREF="http://code.google.com/p/stacklessexamples/wiki/StacklessTwisted">http://code.google.com/p/stacklessexamples/wiki/StacklessTwisted</A>
</I>
This example, linked from that page:
&lt;<A HREF="http://stacklessexamples.googlecode.com/svn/trunk/examples/twisted/TwistedTimerReactorControl.py">http://stacklessexamples.googlecode.com/svn/trunk/examples/twisted/TwistedTimerReactorControl.py</A> 
 &gt;
is roughly the same as what exarkun recommended.

These examples aren't the greatest, because they tend to assume that  
you _always_ have Stackless code that's ready to run, and you want to  
run at some number of &quot;frames per second&quot;.  For simple examples this  
makes sense, but for a system architecture this is a limiting  
approach.  If your stackless application wants to sit idle and wait  
for input, you're still going to wake up once every 1/30 second and  
checking to see if there's anything to do, burning CPU cycles and  
battery life.  Also, if you want to run *faster* than the arbitrary  
timeout you've selected (1/30 second can be a very long time,  
especially if you're doing something pseudo-realtime, like audio  
playback) you're out of luck.

Better would be to have tasklets schedule *themselves* for when they  
want to run.  If you just want to allow the rest of the reactor a time- 
slice, twisted.internet.task.cooperate() will allow you to schedule a  
potentially arbitrary number of tasks which want to run &quot;as often as  
possible&quot; without completely swamping the reactor; you can suspend  
that task by returning a Deferred which only fires when more stackless  
stuff is actually ready to run.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053329.html">[Twisted-Python] Using a custom reactor in twisted trial for test	cases?
</A></li>
	<LI>Next message (by thread): <A HREF="053331.html">[Twisted-Python] Using a custom reactor in twisted trial for test cases?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53330">[ date ]</a>
              <a href="thread.html#53330">[ thread ]</a>
              <a href="subject.html#53330">[ subject ]</a>
              <a href="author.html#53330">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
