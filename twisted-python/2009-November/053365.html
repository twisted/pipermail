<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] help needed with flow-control for push protocol
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20help%20needed%20with%20flow-control%20for%20push%20protocol&In-Reply-To=%3C20091105204212.3229.1317796294.divmod.xquotient.178%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053358.html">
   <LINK REL="Next"  HREF="053366.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] help needed with flow-control for push protocol</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20help%20needed%20with%20flow-control%20for%20push%20protocol&In-Reply-To=%3C20091105204212.3229.1317796294.divmod.xquotient.178%40localhost.localdomain%3E"
       TITLE="[Twisted-Python] help needed with flow-control for push protocol">exarkun at twistedmatrix.com
       </A><BR>
    <I>Thu Nov  5 13:42:12 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053358.html">[Twisted-Python] help needed with flow-control for push protocol
</A></li>
        <LI>Next message (by thread): <A HREF="053366.html">[Twisted-Python] R: help needed with flow-control for push protocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53365">[ date ]</a>
              <a href="thread.html#53365">[ thread ]</a>
              <a href="subject.html#53365">[ subject ]</a>
              <a href="author.html#53365">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05:52 pm, <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">piemail at tiscali.it</A> wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I need assistance figuring out how to create a push protocol that 
</I>&gt;<i>implements
</I>&gt;<i>flow control.
</I>&gt;<i>
</I>&gt;<i>To keep things simple, I'm trying to build a push-based echo server. 
</I>&gt;<i>It
</I>&gt;<i>should
</I>&gt;<i>(1) accept incoming tcp connections
</I>&gt;<i>(2) on each connection, all data rec'd should be echo'd unchanged.
</I>&gt;<i>(3) should the output transport request that transmission be &quot;paused,&quot;
</I>&gt;<i>the input transport (in this case, the same socket) should be similarly
</I>&gt;<i>blocked.
</I>&gt;<i>
</I>&gt;<i>This would seem to be a simple problem.  I think my &quot;PushEcho&quot; class
</I>&gt;<i>should implement both IConsumer and IProducer interfaces;
</I>
It doesn't need to implement IConsumer.  Protocols are hooked up to 
transports via the protocol's dataReceived method.  The protocol does 
not also need to be an IConsumer implementation with a write method.
&gt;<i>As a consumer,
</I>&gt;<i>its dataRecieved method would cause it to act like a producer and call
</I>&gt;<i>the transport's dataReceived method.
</I>
TCP transports, on the other hand, are IConsumer implementations.  So 
you meant the transport's write method (it has no dataReceived method). 
So, yes, the protocol should pass all data it receives back to the 
transport.
&gt;<i>Similarly, as a producer, it's
</I>&gt;<i>pause, and resume methods would be called, and they would (as a
</I>&gt;<i>consumer) just call the same functions in the transport.
</I>
This sounds right.
&gt;<i>However, I can't get the plumbing right.
</I>&gt;<i>
</I>&gt;<i>Can someone help by providing pointers or some sample code?
</I>
Here's some untested code:

    class SmartEcho(Protocol):
        implements(IProducer)

        def pauseProducing(self):
            self.transport.pauseProducing()

        def resumeProducing(self):
            self.transport.resumeProducing()

        def stopProducing(self):
            self.transport.stopProducing()

        def connectionMade(self):
            self.transport.registerProducer(self, True)

        def dataReceived(self, bytes):
            self.transport.write(bytes)

A careful examination of this code should also reveal the fact that it 
can be shortened to a more obscure form:

    class SmartEcho(Protocol):
        def connectionMade(self):
            self.transport.registerProducer(self.transport, True)

        def dataReceived(self, bytes):
            self.transport.write(bytes)

Hope this helps,
Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053358.html">[Twisted-Python] help needed with flow-control for push protocol
</A></li>
	<LI>Next message (by thread): <A HREF="053366.html">[Twisted-Python] R: help needed with flow-control for push protocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53365">[ date ]</a>
              <a href="thread.html#53365">[ thread ]</a>
              <a href="subject.html#53365">[ subject ]</a>
              <a href="author.html#53365">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
