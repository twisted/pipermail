<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Twisted webserver performance issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20webserver%20performance%20issues&In-Reply-To=6952A61F-1F70-4EFA-BF69-07A877318839%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020910.html">
   <LINK REL="Next"  HREF="020906.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Twisted webserver performance issues</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Twisted%20webserver%20performance%20issues&In-Reply-To=6952A61F-1F70-4EFA-BF69-07A877318839%40fuhm.net"
       TITLE="[Twisted-Python] Twisted webserver performance issues">foom at fuhm.net
       </A><BR>
    <I>Mon Nov  9 15:22:36 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020910.html">[Twisted-Python] Twisted webserver performance issues
</A></li>
        <LI>Next message: <A HREF="020906.html">[Twisted-Python] Twisted webserver performance issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20926">[ date ]</a>
              <a href="thread.html#20926">[ thread ]</a>
              <a href="subject.html#20926">[ subject ]</a>
              <a href="author.html#20926">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Nov 8, 2009, at 1:08 PM, James Y Knight wrote:

&gt;&gt;<i>
</I>&gt;&gt;<i> Can we attach gdb to the process and trigger an all-threads stack
</I>&gt;&gt;<i> dump when it happens?
</I>&gt;<i>
</I>&gt;<i> That's a good idea. Unfortunately, currently it seems to be working
</I>&gt;<i> quite smoothly. :)
</I>
The intermittent long pauses were happening again, so I got a gdb  
&quot;thread apply all bt&quot;. I discovered that there were two threads not in  
sem_wait waiting for GIL to be released. And both were waiting in  
nanosleep. One had the GIL held, the other had released it. The one  
with the GIL held was sleeping inside of sqlite3_prepare, called from  
pysqlite_statement_create.

We were using the pysqlite shipped with python 2.5. Fortunately, the  
latest version of pysqlite standalone has already corrected that  
function to release the GIL around the call to sqlite3, so I  
downloaded and installed it. Hopefully that'll fix the remaining issues.

I also added an Expires header to the static content (of 24hours),  
although I think web browsers are pretty good at not reloading  
referenced content frequently even without an explicit expires, so I  
doubt that it really matters.

James

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020910.html">[Twisted-Python] Twisted webserver performance issues
</A></li>
	<LI>Next message: <A HREF="020906.html">[Twisted-Python] Twisted webserver performance issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20926">[ date ]</a>
              <a href="thread.html#20926">[ thread ]</a>
              <a href="subject.html#20926">[ subject ]</a>
              <a href="author.html#20926">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
