<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Using a custom reactor in twisted trial for test cases?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Using%20a%20custom%20reactor%20in%20twisted%20trial%20for%0A%20test%20cases%3F&In-Reply-To=%3C1257146566.4197.16.camel%40wolfwood%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="053330.html">
   <LINK REL="Next"  HREF="053332.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Using a custom reactor in twisted trial for test cases?</H1>
    <B>Crispin Wellington</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Using%20a%20custom%20reactor%20in%20twisted%20trial%20for%0A%20test%20cases%3F&In-Reply-To=%3C1257146566.4197.16.camel%40wolfwood%3E"
       TITLE="[Twisted-Python] Using a custom reactor in twisted trial for test cases?">cwellington at ccg.murdoch.edu.au
       </A><BR>
    <I>Mon Nov  2 00:22:46 MST 2009</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="053330.html">[Twisted-Python] Using a custom reactor in twisted trial for	test cases?
</A></li>
        <LI>Next message (by thread): <A HREF="053332.html">[Twisted-Python] Using a custom reactor in twisted trial for	test cases?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53331">[ date ]</a>
              <a href="thread.html#53331">[ thread ]</a>
              <a href="subject.html#53331">[ subject ]</a>
              <a href="author.html#53331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2009-11-02 at 01:12 -0500, Glyph Lefkowitz wrote:
&gt;<i> On Nov 1, 2009, at 11:17 PM, Crispin Wellington wrote:
</I>
&gt;<i> &gt; I tried using LoopingCall, but it does not work. It only calls the
</I>&gt;<i> &gt; scheduler once. I think this has to do with the fact that the  
</I>&gt;<i> &gt; stackless
</I>&gt;<i> &gt; scheduler needs to be interwoven with the twisted reactor pump.
</I>
&gt;<i> What do you mean &quot;does not work&quot;?
</I>
OK. Having a closer look, its not that looping call doesn't work, its
that there is some unknown number of &quot;reactor pumps&quot; between starting
the test, and finishing it. What I need is a way for the reactor to be
pumping away while a particular test function of a testcase continues
working. As an example, here is a non-working test case. Notice the
comment &quot;#what to do here to pump the reactor?&quot;.

------------------
from twisted.trial import unittest, reporter, runner
import os, time
import stackless

from twisted.internet import reactor, task

def example_func(t=10.0):
    &quot;&quot;&quot;wait for t seconds then return&quot;&quot;&quot;
    exit_time = time.time()+t
    while time.time()&lt;exit_time:
        stackless.schedule()

t = task.LoopingCall(stackless.schedule)
t.start(0.1)

class StacklessTest(unittest.TestCase):
    def setUpClass(self):
        pass
        
    def test_stackless(self):
        &quot;&quot;&quot;Test that we can successfuly create a user proxy cert&quot;&quot;&quot;
        # get the time now...
        start = time.time()
        
        task = stackless.tasklet(example_func)
        task.setup(10.0)
        task.run()
            
        while task.alive:
            pass            #what to do here to pump the reactor?
            
        # end time
        end = time.time()
            
        self.assert_( endtime - starttime &gt;= 10.0 )
        
---------------------

Running this under trial, it just hangs, inside the while task.alive:
loop.

So I guess my problem is my approach. How do I test long running
&quot;tasklets&quot; that use twisted calls (unlike this contrived example that
only sleeps) within the twisted trial framework?

How would the Twisted experts write test code for a case like this? Any
help is much appreciated!

Kind Regards

Crispin Wellington



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="053330.html">[Twisted-Python] Using a custom reactor in twisted trial for	test cases?
</A></li>
	<LI>Next message (by thread): <A HREF="053332.html">[Twisted-Python] Using a custom reactor in twisted trial for	test cases?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53331">[ date ]</a>
              <a href="thread.html#53331">[ thread ]</a>
              <a href="subject.html#53331">[ subject ]</a>
              <a href="author.html#53331">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
