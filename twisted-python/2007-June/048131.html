<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] twisted.conch.telnet example?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.conch.telnet%20example%3F&In-Reply-To=%3C20070626190801.4947.677787221.divmod.quotient.4523%40ohm%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048130.html">
   <LINK REL="Next"  HREF="048133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] twisted.conch.telnet example?</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20twisted.conch.telnet%20example%3F&In-Reply-To=%3C20070626190801.4947.677787221.divmod.quotient.4523%40ohm%3E"
       TITLE="[Twisted-Python] twisted.conch.telnet example?">exarkun at divmod.com
       </A><BR>
    <I>Tue Jun 26 13:08:01 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048130.html">[Twisted-Python] twisted.conch.telnet example?
</A></li>
        <LI>Next message (by thread): <A HREF="048133.html">[Twisted-Python] twisted.conch.telnet example?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48131">[ date ]</a>
              <a href="thread.html#48131">[ thread ]</a>
              <a href="subject.html#48131">[ subject ]</a>
              <a href="author.html#48131">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 26 Jun 2007 10:03:26 -0700, Stephen Hansen &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">apt.shansen at gmail.com</A>&gt; wrote:
&gt;<i>Hello all. :)
</I>
Hey!

&gt;<i>
</I>&gt;<i>I'm trying to learn Twisted, and to replace irritating telnetlib code for a
</I>&gt;<i>simple telnet client application to do so. The problem is I'm slightly lost
</I>&gt;<i>as to where to start with the twisted.conch.telnet library, so was wondering
</I>&gt;<i>if anyone could point me to a simple example.
</I>
Cool.  :)

&gt;<i>
</I>&gt;<i>So far, I understand the whole client factory thing-- but where I start
</I>&gt;<i>getting lost is where we get to the &quot;protocol&quot; point (I know I know-- so
</I>&gt;<i>early to get confused!).
</I>&gt;<i>
</I>&gt;<i>Specifically, in the buildProtocol method of a ReconnectingClientFactory
</I>&gt;<i>instance.. what should I be returning a subclass of?
</I>
The documentation for this part of Twisted is basically completely
missing.  That'd be my fault, I really should have written some, either
when telnet was implemented or some time in the two years since. ;)

So, to start, I'll try to give a high-level overview.


Then there's t.c.telnet.

&gt;<i>
</I>&gt;<i>There's a telnet.Telnet, which /looks/ like it would be handling all of the
</I>&gt;<i>telnet negotiation nicely, but it has methods like &quot;def enableRemote&quot; that
</I>&gt;<i>call &quot;self.protocol.enableRemote&quot;.. and I'm not sure what should be put
</I>&gt;<i>there, or how that should have been handled.
</I>
Yep.  t.c.telnet.Telnet is a Protocol subclass and so implements
IProtocol: it is the class which actually implements the telnet
protocol.  It goes right on top of an ITCPTransport and its dataReceived
knows about telnet escapes and the other features of the telnet
protocol.  When it gets bytes which represent some telnet protocol
action, a Telnet instance calls either negotiate or commandReceived on
itself.  The default implementation of these methods dispatches the
event to handlers defined by negotiationMap and
enableLocal/disableLocal/enableRemote/disableRemote, respectively.  In
turn, {enable,disable}{Local,Remote} dispatch to another object,
self.protocol, as you noticed.

There's also a subclass of Telnet, TelnetTransport.  TelnetTransport
takes a protocol class and some arguments to its initializer.  When
TelnetTransport is connected to an ITCPTransport, it instantiates the
class it was given and saves the instance as self.protocol.  As a Telnet
subclass, this means that the protocol class passed to TelnetTransport's
initializer can now control how negotiations happen and how to respond
to commands.

&gt;<i>
</I>&gt;<i>My best success so far was to have it return a subclass of
</I>&gt;<i>telnet.StatefulTelnetProtocol. It does the &quot;basis&quot; of what I want: a
</I>&gt;<i>line-oriented output from the telnet protocol connection. However, it also
</I>&gt;<i>returns all the negotiation characters, so it seems like it's not actually
</I>&gt;<i>implementing the telnet negotiation part itself.
</I>&gt;<i>
</I>
StatefulTelnetProtocol is a TelnetProtocol.  TelnetProtocol is the
intended base class for anything which is passed to TelnetTransport.
TelnetProtocol is an ITelnetProtocol, so actually anywhere a
TelnetProtocol class will work, so will any other class which implements
ITelnetProtocol.

TelnetProtocol doesn't know anything about the actual telnet protocol -
its name attempts to convey that it /is/ a protocol /for/ telnet: it can
receive application level bytes (dataReceived, inherited from
IProtocol/Protocol), but it can also handle events which can only happen
when you're using telnet: those four enable/disable methods, plus some
catch-alls for negotiation about options which aren't recognized.  Since
TelnetProtocol doesn't know the telnet protocol, if you hook it directly
up to an ITCPTransport, it'll just think everything it gets is
application data, even telnet negotiation sequences.

&gt;<i>Then there's telnet.TelnetBootstrapProtocol which looks very
</I>&gt;<i>interesting but looks like its mostly handling telnet features I'm not
</I>&gt;<i>interested in (various line modes, screen size negotiation, etc)
</I>&gt;<i>yet... and a telnet.TelnetProtocol that I'm very confused by.. it's
</I>&gt;<i>inheriting from ITelnetProtocol which appears to define the basic
</I>&gt;<i>negotiation methods, but it doesn't appear to -do- anything. (And
</I>&gt;<i>telnet.Telnet, which does notinherit from that interface, does appear
</I>&gt;<i>to support -doing- the negotiation)
</I>
TelnetBootstrapProtocol is another one like StatefulTelnetProtocol - it
adds some features which may or may not be interesting, but it won't
work by itself, it needs TelnetTransport to actually parse the protocol.

&gt;<i>
</I>&gt;<i>This might all be a lot of babbling, and if so-- sorry! I'm just not sure
</I>&gt;<i>where to get started on understanding what's going on in this module to make
</I>&gt;<i>use of it. :) I tried googling around to see if I could find a simple
</I>&gt;<i>display of gluing the conch modules together to produce a line-oriented
</I>&gt;<i>telnet client connection that appeared to handle the negotiation ... just to
</I>&gt;<i>get started-- and I can't find one. Does anyone know of one? (Or, if I give
</I>&gt;<i>you $0.25, could you throw one together? :))
</I>
Hopefully the above has given you a better idea of what all the pieces
are supposed to be doing.  Here's an example of how you might hook them
up to each other, by way of a client which prints all application data
it receives:

  from twisted.internet import reactor
  from twisted.internet.protocol import ClientFactory
  from twisted.conch.telnet import TelnetTransport, TelnetProtocol

  class TelnetPrinter(TelnetProtocol):
      def dataReceived(self, bytes):
          print 'Received:', repr(bytes)

  class TelnetFactory(ClientFactory):
      def buildProtocol(self, addr):
          return TelnetTransport(TelnetPrinter)

  reactor.connectTCP(host, port, TelnetFactory())

For something line oriented, you might mix in LineReceiver (as
StatefulTelnetProtocol does) or instantiate one directly yourself in a
TelnetProtocol subclass and feed it bytes in your dataReceived
implementation.

Hope this helps,

Jean-Paul


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048130.html">[Twisted-Python] twisted.conch.telnet example?
</A></li>
	<LI>Next message (by thread): <A HREF="048133.html">[Twisted-Python] twisted.conch.telnet example?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48131">[ date ]</a>
              <a href="thread.html#48131">[ thread ]</a>
              <a href="subject.html#48131">[ subject ]</a>
              <a href="author.html#48131">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
