<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Testing with trial, adbapi questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Testing%20with%20trial%2C%20adbapi%20questions&In-Reply-To=%3Ccd8fa6f90706260727l667f3e72we349e32ac40260cf%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048122.html">
   <LINK REL="Next"  HREF="048132.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Testing with trial, adbapi questions</H1>
    <B>Christian Simms</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Testing%20with%20trial%2C%20adbapi%20questions&In-Reply-To=%3Ccd8fa6f90706260727l667f3e72we349e32ac40260cf%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Testing with trial, adbapi questions">christian.simms at gmail.com
       </A><BR>
    <I>Tue Jun 26 08:27:28 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048122.html">[Twisted-Python] Testing with trial, adbapi questions
</A></li>
        <LI>Next message (by thread): <A HREF="048132.html">[Twisted-Python] Testing with trial, adbapi questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48126">[ date ]</a>
              <a href="thread.html#48126">[ thread ]</a>
              <a href="subject.html#48126">[ subject ]</a>
              <a href="author.html#48126">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/25/07, Brendon Colby &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">brendoncolby at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On 6/25/07, Christian Simms &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">christian.simms at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> [snip]
</I>&gt;<i> &gt; I think you have a race condition because (I assume) self.p.lineReceived
</I>&gt;<i> &gt; indirectly did a database insert, and then the self.check did a database
</I>&gt;<i> &gt; select.  If that's true, you should make your test use Deferred's like
</I>&gt;<i> this:
</I>&gt;<i>
</I>&gt;<i> No - I'm just doing a series of runQuerys() when the server starts,
</I>&gt;<i> the callbacks of which populate dictionaries with objects. The test
</I>&gt;<i> sends a string identifier to the server which checks whether or not it
</I>&gt;<i> exists in one of these dictionaries. When the test runs, the dict is
</I>&gt;<i> empty. However, the load method IS running, just (seemingly) after the
</I>&gt;<i> test is run. I guess I'm not sure how to code a test for this, as in,
</I>&gt;<i> &quot;after the database connection has been made and the data loaded, THEN
</I>&gt;<i> start running tests.&quot;
</I>&gt;<i>
</I>[snip]
&gt;<i>
</I>

Looks like I mis-assumed your problem, sorry.  In the setUp method in your
tests, you should return a Deferred which fires when all your data is
loaded.  This can be a pain if you already organized your code into classes
inheriting from twisted.application.service.Service which have
startService/stopService calls. It's a pain because trial doesn't create an
application object like running inside twistd does.  So, in the case of
writing unit tests for applications, you can abstract out your
initialization code into a method, and then call that method directly in
your setUp method.

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20070626/73fa62b6/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048122.html">[Twisted-Python] Testing with trial, adbapi questions
</A></li>
	<LI>Next message (by thread): <A HREF="048132.html">[Twisted-Python] Testing with trial, adbapi questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48126">[ date ]</a>
              <a href="thread.html#48126">[ thread ]</a>
              <a href="subject.html#48126">[ subject ]</a>
              <a href="author.html#48126">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
