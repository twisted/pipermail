<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Server/Client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Server/Client&In-Reply-To=%3Ccd8fa6f90706210819m13724cc8h91b0057422ca6330%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="048094.html">
   <LINK REL="Next"  HREF="048098.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Server/Client</H1>
    <B>Christian Simms</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Server/Client&In-Reply-To=%3Ccd8fa6f90706210819m13724cc8h91b0057422ca6330%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] Server/Client">christian.simms at gmail.com
       </A><BR>
    <I>Thu Jun 21 09:19:32 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="048094.html">[Twisted-Python] Server/Client
</A></li>
        <LI>Next message (by thread): <A HREF="048098.html">[Twisted-Python] Server/Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48097">[ date ]</a>
              <a href="thread.html#48097">[ thread ]</a>
              <a href="subject.html#48097">[ subject ]</a>
              <a href="author.html#48097">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3 &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">edgardo.delgado at navy.mil</A>&gt;
wrote:
&gt;<i>
</I>&gt;<i> Here's the code:
</I>&gt;<i>
</I>&gt;<i> from twisted.internet.protocol import ServerFactory, ClientFactory,
</I>&gt;<i> Protocol, ClientCreator
</I>&gt;<i> from twisted.protocols.basic import LineReceiver
</I>&gt;<i> from twisted.application.service import Service, Application,
</I>&gt;<i> IServiceCollection
</I>&gt;<i> from twisted.application.internet import TCPServer, TCPClient
</I>&gt;<i> from twisted.internet.stdio import StandardIO
</I>&gt;<i> from twisted.internet import reactor
</I>&gt;<i> import re
</I>&gt;<i>
</I>&gt;<i> class DnLinkProtocol(LineReceiver):
</I>&gt;<i>
</I>&gt;<i>     def connectionMade(self):
</I>&gt;<i>         self.sendLine(&quot;Connected from: &quot; + &quot;host &quot; +
</I>&gt;<i>                              str(self.transport.getPeer().host) + &quot; &quot; +
</I>&gt;<i>                              &quot;port &quot; +
</I>&gt;<i>                              str(self.transport.getPeer().port) + '\n')
</I>&gt;<i>
</I>&gt;<i>     def lineReceived(self, line):
</I>&gt;<i>         self.sendLine(&quot;DnLink echo: &quot; + line + '\n')
</I>&gt;<i>
</I>&gt;<i> class DSPEProtocol(LineReceiver):
</I>&gt;<i>
</I>&gt;<i>     def connectionMade(self):
</I>&gt;<i>         self.sendLine(&quot;Connected from: &quot; + &quot;host &quot; +
</I>&gt;<i>                              str(self.transport.getPeer().host) + &quot; &quot; +
</I>&gt;<i>                              &quot;port &quot; +
</I>&gt;<i>                              str(self.transport.getPeer().port) + '\n')
</I>&gt;<i>
</I>&gt;<i>     def lineReceived(self, line):
</I>&gt;<i>         self.sendLine(&quot;DSPE echo: &quot; + line + '\n')
</I>&gt;<i>
</I>&gt;<i> class PAPSExecService(Service):
</I>&gt;<i>
</I>&gt;<i>     def getDnLinkInFactory(self):
</I>&gt;<i>         f = ServerFactory()
</I>&gt;<i>         f.protocol = DnLinkProtocol
</I>&gt;<i>         f.startService = self.startService
</I>&gt;<i>         return f
</I>&gt;<i>
</I>&gt;<i>     def getDSPEInFactory(self):
</I>&gt;<i>         f = ServerFactory()
</I>&gt;<i>         f.protocol = DSPEProtocol
</I>&gt;<i>         f.startService = self.startService
</I>&gt;<i>         return f
</I>&gt;<i>
</I>&gt;<i> application = Application('PAPSExec')
</I>&gt;<i> f = PAPSExecService()
</I>&gt;<i> serviceCollection = IServiceCollection(application)
</I>&gt;<i> TCPServer(9595,
</I>&gt;<i> f.getDnLinkInFactory()).setServiceParent(serviceCollection)
</I>&gt;<i> TCPServer(8585,
</I>&gt;<i> f.getDSPEInFactory()).setServiceParent(serviceCollection)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I would like that, for example, when data is received in port 9595 it
</I>&gt;<i> will forward the data to another server in port xxxx.
</I>&gt;<i> Where would I create a TPC Client connection?
</I>&gt;<i> Where would I send the message?
</I>&gt;<i>
</I>&gt;<i> Edgar
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>
</I>&gt;<i> [mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of Christian
</I>&gt;<i> Simms
</I>&gt;<i> Sent: Wednesday, June 20, 2007 11:01 AM
</I>&gt;<i> To: Twisted general discussion
</I>&gt;<i> Subject: Re: [Twisted-Python] Server/Client
</I>&gt;<i>
</I>&gt;<i> On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
</I>&gt;<i> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">edgardo.delgado at navy.mil</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>         I would like to build a server that when it gets a message on a
</I>&gt;<i> specific
</I>&gt;<i>         port it will &quot;forward&quot; that message to another port.
</I>&gt;<i>         I.e. &quot;Server1&quot; listens on port 10000. When it gets data on port
</I>&gt;<i> 10000 it
</I>&gt;<i>         will forward the data to &quot;Server2&quot; listening on port 15000.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Assuming you're using TCP, you could just create a server listening on a
</I>&gt;<i> port using reactor.listenTCP(port, factory) as detailed here
</I>&gt;<i> &lt;<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/servers.html">http://twistedmatrix.com/projects/core/documentation/howto/servers.html</A>
</I>&gt;<i> &gt;  and when you receive a message you would create a client using
</I>&gt;<i> reactor.connectTCP(host, port, factory) as detailed here
</I>&gt;<i> &lt;<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/clients.html">http://twistedmatrix.com/projects/core/documentation/howto/clients.html</A>
</I>&gt;<i> &gt;  to then send the message.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Christian
</I>

Assuming you want to create a new connection every time a client connects to
your port 9595, it's slightly tricky because you can't just forward the data
as soon as you get it, since the connection to the other server may not be
created yet.  A relatively complex way is explained in the Python Cookbook
in article &quot;Hex-dump port-forwarding network proxy
server&quot;&lt;<A HREF="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293">http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293</A>&gt;,
where it queues up the data until the outgoing connection is made.  A
simpler way is used in twisted.protocols.portforward.ProxyFactory/ProxyServer,
where it just pauses receiving data until the outgoing connection is made.
I found a Python mailing list
entry&lt;<A HREF="http://mail.python.org/pipermail/python-list/2003-June/212102.html">http://mail.python.org/pipermail/python-list/2003-June/212102.html</A>&gt;which
explains how to override the portforward's methods.

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20070621/78927286/attachment.html&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="048094.html">[Twisted-Python] Server/Client
</A></li>
	<LI>Next message (by thread): <A HREF="048098.html">[Twisted-Python] Server/Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48097">[ date ]</a>
              <a href="thread.html#48097">[ thread ]</a>
              <a href="subject.html#48097">[ subject ]</a>
              <a href="author.html#48097">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
