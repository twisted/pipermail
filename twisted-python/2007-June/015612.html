<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Testing with trial, adbapi questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Testing%20with%20trial%2C%20adbapi%20questions&In-Reply-To=cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015610.html">
   <LINK REL="Next"  HREF="015613.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Testing with trial, adbapi questions</H1>
    <B>Brendon Colby</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Testing%20with%20trial%2C%20adbapi%20questions&In-Reply-To=cd8fa6f90706250928n77613dfaq1b6fdbb59d23347c%40mail.gmail.com"
       TITLE="[Twisted-Python] Testing with trial, adbapi questions">brendoncolby at gmail.com
       </A><BR>
    <I>Mon Jun 25 15:57:50 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015610.html">[Twisted-Python] Testing with trial, adbapi questions
</A></li>
        <LI>Next message: <A HREF="015613.html">[Twisted-Python] Testing with trial, adbapi questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15612">[ date ]</a>
              <a href="thread.html#15612">[ thread ]</a>
              <a href="subject.html#15612">[ subject ]</a>
              <a href="author.html#15612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/25/07, Christian Simms &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">christian.simms at gmail.com</A>&gt; wrote:
&gt;<i> I think your biggest hurdle is that you need to get used to using Deferred's
</I>&gt;<i> in adbapi and any functions/methods that call adbapi indirectly.  Unless you
</I>&gt;<i> use a fast embedded database like Sqlite, you have to use Deferred's because
</I>&gt;<i> there's network traffic under the covers to the database server. I'll try to
</I>&gt;<i> include a little advice below for each item:
</I>
Yep this is precisely what I am attempting to do - get used to using
deferreds (properly).

&gt;<i> I think you have a race condition because (I assume) self.p.lineReceived
</I>&gt;<i> indirectly did a database insert, and then the self.check did a database
</I>&gt;<i> select.  If that's true, you should make your test use Deferred's like this:
</I>
No - I'm just doing a series of runQuerys() when the server starts,
the callbacks of which populate dictionaries with objects. The test
sends a string identifier to the server which checks whether or not it
exists in one of these dictionaries. When the test runs, the dict is
empty. However, the load method IS running, just (seemingly) after the
test is run. I guess I'm not sure how to code a test for this, as in,
&quot;after the database connection has been made and the data loaded, THEN
start running tests.&quot;

&gt;<i>   d = defer.succeed(None)
</I>&gt;<i>   d.addCallback(lambda out: self.p.lineReceived('{%s:&quot;PG&quot;}\0' %
</I>&gt;<i> sserverson.base10toN(104))
</I>&gt;<i>   d.addCallback(lambda out: self.check(&quot;test\0&quot;))
</I>&gt;<i>   return d
</I>&gt;<i>
</I>&gt;<i> You could also write this code using the new defer.inlineCallbacks (needs
</I>&gt;<i> python 2.5) or the older defer.deferredGenerator, but you might as well get
</I>&gt;<i> used to using callbacks/errbacks and Deferred's.
</I>
Hrm yes, I'm using Debian stock 2.4, but wouldn't be opposed to hand
installing a few things (like twisted). I've done it many times. A
quick check of deferredGenerator and inlineCallbacks...these look
_exactly_ like what I'm asking for. I might just stick with 2.4 and
deferredGenerator.

&gt;<i> You're right that you need a new paradigm, like this:
</I>&gt;<i>
</I>&gt;<i>   def cb(data):
</I>&gt;<i>        # use the data here, in the callback function
</I>&gt;<i>   return getSomethingFromDB().addCallback(cb)
</I>&gt;<i>
</I>&gt;<i> This assumes getSomethingFromDB() returns a Deferred which fires with the
</I>&gt;<i> result you wanted.
</I>
Yep, that's basically exactly what I'm doing now.

&gt;<i> You really need to run your twisted app with twistd.  That's the abstraction
</I>&gt;<i> for launching twisted programs -- i.e., you define a variable named
</I>&gt;<i> &quot;application&quot; in your .tac file and then use twistd to start your app.  Of
</I>&gt;<i> course, there's nothing stopping you from using daemontools on top of it.
</I>
Yep, that's exactly what I had considered doing. It doesn't appear to
difficult to convert to using twistd run out of daemontools.

Thanks!

Brendon


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015610.html">[Twisted-Python] Testing with trial, adbapi questions
</A></li>
	<LI>Next message: <A HREF="015613.html">[Twisted-Python] Testing with trial, adbapi questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15612">[ date ]</a>
              <a href="thread.html#15612">[ thread ]</a>
              <a href="subject.html#15612">[ subject ]</a>
              <a href="author.html#15612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
