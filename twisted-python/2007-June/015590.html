<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Server/Client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Server/Client&In-Reply-To=cd8fa6f90706210819m13724cc8h91b0057422ca6330%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015589.html">
   <LINK REL="Next"  HREF="015585.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Server/Client</H1>
    <B>Delgado, Edgardo  CIV NAVAIR 4.1.4.3</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=%5BTwisted-Python%5D%20Server/Client&In-Reply-To=cd8fa6f90706210819m13724cc8h91b0057422ca6330%40mail.gmail.com"
       TITLE="[Twisted-Python] Server/Client">edgardo.delgado at navy.mil
       </A><BR>
    <I>Thu Jun 21 12:36:50 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="015589.html">[Twisted-Python] Server/Client
</A></li>
        <LI>Next message: <A HREF="015585.html">[Twisted-Python] Server/Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15590">[ date ]</a>
              <a href="thread.html#15590">[ thread ]</a>
              <a href="subject.html#15590">[ subject ]</a>
              <a href="author.html#15590">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Christian (and everybody else) for your help,

Edgar

-----Original Message-----
From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>
[mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of Christian
Simms
Sent: Thursday, June 21, 2007 11:20 AM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Server/Client

On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">edgardo.delgado at navy.mil</A>&gt; wrote:

	Here's the code:
	
	from twisted.internet.protocol import ServerFactory,
ClientFactory, 
	Protocol, ClientCreator
	from twisted.protocols.basic import LineReceiver
	from twisted.application.service import Service, Application,
	IServiceCollection
	from twisted.application.internet import TCPServer, TCPClient 
	from twisted.internet.stdio import StandardIO
	from twisted.internet import reactor
	import re
	
	class DnLinkProtocol(LineReceiver):
	
	    def connectionMade(self):
	        self.sendLine(&quot;Connected from: &quot; + &quot;host &quot; + 
	                             str(self.transport.getPeer().host)
+ &quot; &quot; +
	                             &quot;port &quot; +
	                             str(self.transport.getPeer().port)
+ '\n')
	
	    def lineReceived(self, line):
	        self.sendLine(&quot;DnLink echo: &quot; + line + '\n')
	
	class DSPEProtocol(LineReceiver):
	
	    def connectionMade(self):
	        self.sendLine(&quot;Connected from: &quot; + &quot;host &quot; + 
	                             str(self.transport.getPeer().host)
+ &quot; &quot; +
	                             &quot;port &quot; +
	                             str(self.transport.getPeer().port)
+ '\n')
	
	    def lineReceived(self, line):
	        self.sendLine(&quot;DSPE echo: &quot; + line + '\n')
	
	class PAPSExecService(Service):
	
	    def getDnLinkInFactory(self):
	        f = ServerFactory()
	        f.protocol = DnLinkProtocol
	        f.startService = self.startService
	        return f
	
	    def getDSPEInFactory(self):
	        f = ServerFactory()
	        f.protocol = DSPEProtocol
	        f.startService = self.startService
	        return f
	
	application = Application('PAPSExec')
	f = PAPSExecService()
	serviceCollection = IServiceCollection(application)
	TCPServer(9595,
	f.getDnLinkInFactory()).setServiceParent(serviceCollection) 
	TCPServer(8585,
	f.getDSPEInFactory()).setServiceParent(serviceCollection)
	
	
	I would like that, for example, when data is received in port
9595 it
	will forward the data to another server in port xxxx.
	Where would I create a TPC Client connection?
	Where would I send the message?
	
	Edgar
	
	-----Original Message-----
	From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A> 
	[mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">twisted-python-bounces at twistedmatrix.com</A>] On Behalf Of
Christian
	Simms
	Sent: Wednesday, June 20, 2007 11:01 AM
	To: Twisted general discussion 
	Subject: Re: [Twisted-Python] Server/Client
	
	On 6/20/07, Delgado, Edgardo CIV NAVAIR 4.1.4.3
	&lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">edgardo.delgado at navy.mil</A>&gt; wrote:
	
	        I would like to build a server that when it gets a
message on a
	specific
	        port it will &quot;forward&quot; that message to another port.
	        I.e. &quot;Server1&quot; listens on port 10000. When it gets data
on port 
	10000 it
	        will forward the data to &quot;Server2&quot; listening on port
15000.
	
	
	Assuming you're using TCP, you could just create a server
listening on a
	port using reactor.listenTCP(port, factory) as detailed here 
	
&lt;<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/servers.html">http://twistedmatrix.com/projects/core/documentation/howto/servers.html</A>
	&gt;  and when you receive a message you would create a client
using 
	reactor.connectTCP(host, port, factory) as detailed here
	
&lt;<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/clients.html">http://twistedmatrix.com/projects/core/documentation/howto/clients.html</A>

	&gt;  to then send the message.
	
	Cheers,
	Christian


Assuming you want to create a new connection every time a client
connects to your port 9595, it's slightly tricky because you can't just
forward the data as soon as you get it, since the connection to the
other server may not be created yet.  A relatively complex way is
explained in the Python Cookbook in article &quot;Hex-dump port-forwarding
network proxy server&quot;
&lt;<A HREF="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293">http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/502293</A>&gt; , where
it queues up the data until the outgoing connection is made.  A simpler
way is used in twisted.protocols.portforward.ProxyFactory/ProxyServer,
where it just pauses receiving data until the outgoing connection is
made.  I found a Python mailing list entry
&lt;<A HREF="http://mail.python.org/pipermail/python-list/2003-June/212102.html">http://mail.python.org/pipermail/python-list/2003-June/212102.html</A>&gt;
which explains how to override the portforward's methods.

Cheers,
Christian





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015589.html">[Twisted-Python] Server/Client
</A></li>
	<LI>Next message: <A HREF="015585.html">[Twisted-Python] Server/Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15590">[ date ]</a>
              <a href="thread.html#15590">[ thread ]</a>
              <a href="subject.html#15590">[ subject ]</a>
              <a href="author.html#15590">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
