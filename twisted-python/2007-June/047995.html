<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Deterministic &quot;program counter&quot; for asynchronious	events
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deterministic%20%22program%20counter%22%20for%20asynchronious%0A%09events&In-Reply-To=%3C87y7iv4wuj.fsf%40hbox.dyndns.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="047994.html">
   <LINK REL="Next"  HREF="047996.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Deterministic &quot;program counter&quot; for asynchronious	events</H1>
    <B>Martin Geisler</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Deterministic%20%22program%20counter%22%20for%20asynchronious%0A%09events&In-Reply-To=%3C87y7iv4wuj.fsf%40hbox.dyndns.org%3E"
       TITLE="[Twisted-Python] Deterministic &quot;program counter&quot; for asynchronious	events">mgeisler at mgeisler.net
       </A><BR>
    <I>Thu Jun  7 09:18:12 MDT 2007</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="047994.html">[Twisted-Python] Please help me with process spawning
</A></li>
        <LI>Next message (by thread): <A HREF="047996.html">[Twisted-Python] where to getPeerCertificate()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47995">[ date ]</a>
              <a href="thread.html#47995">[ thread ]</a>
              <a href="subject.html#47995">[ subject ]</a>
              <a href="author.html#47995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I'm writing a runtime system for doing secure multiparty computation,
and here I have used deferreds with great success.

All players run the same program (but with different input) and each
player communicate with other players as needed to share intermediate
results. These results need to be associated with the right operation
and for this I use a program counter.

This minimal example shows my solution without network traffic:


import sys
From twisted.internet.defer import Deferred, DeferredList, gatherResults

pc = (0,)

def inc_pc(pc):
    pc = pc[:-1] + (pc[-1]+1,)
    return pc
 
def sub_pc(pc):
    pc = pc + (1,)
    return pc

def finish_mul(arg, pc):
    print &quot;finish_mul(%s): pc = %s&quot; % (arg, pc)
    return arg

def mul(a, b):
    global pc
    pc = inc_pc(pc)

    results = gatherResults([a,b])
    results.addCallback(finish_mul, sub_pc(pc))
    return results

x = Deferred() # Declare variables
y = Deferred()
z = Deferred()
w = Deferred()

mul(x,y) # Schedule multiplications
mul(z,w)

x.callback(2) # The value for x arrives over the network
z.callback(4)

if len(sys.argv) &gt; 1:
    y.callback(3) # y gets a value, enabling mul(x,y) to proceed.
    w.callback(5)
else:
    w.callback(5) # z and w are ready and mul(z,w) can proceed.
    y.callback(3)


Here mul() schedules calls to finish_mul(), and it is this call which
I would like to have a deterministic labelling of. I have solved it by
having a &quot;two-dimensional&quot; program counter: the calls to mul() get
labels (1,) and (2,). Their calls to the sub-operation finish_mul()
get labels (1,1) and (2,1) respectively.


This works, invoking the example with and without a command line
argument gives the same labels for finish_mul(). But it is cumbersome
to drag this program counter around all the code, and (what is worse)
it is easy to forget to increment it and to create sub program
counters at the right times.

So have anybody done something similar where you wanted to start a
bunch of operations which might start sub-operations themselves and
where everything needed to be deterministically labelled?

-- 
Martin Geisler  ---  &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">mgeisler at mgeisler.net</A>&gt;  ---  <A HREF="http://mgeisler.net">http://mgeisler.net</A>

Read, write, create Exif data in PHP with PEL:       <A HREF="http://pel.sf.net">http://pel.sf.net</A>
Take control of your webserver with PHP Shell:  <A HREF="http://phpshell.sf.net">http://phpshell.sf.net</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 188 bytes
Desc: not available
URL: &lt;/pipermail/twisted-python/attachments/20070607/a934f9a3/attachment.sig&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="047994.html">[Twisted-Python] Please help me with process spawning
</A></li>
	<LI>Next message (by thread): <A HREF="047996.html">[Twisted-Python] where to getPeerCertificate()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47995">[ date ]</a>
              <a href="thread.html#47995">[ thread ]</a>
              <a href="subject.html#47995">[ subject ]</a>
              <a href="author.html#47995">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
