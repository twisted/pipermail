<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] How to cycle through servers on Connection Fail in an IRC client?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20cycle%20through%20servers%20on%20Connection%20Fail%20in%0A%20an%20IRC%20client%3F&In-Reply-To=%3CCAPeSgWrHJ%2Bfno65aq2HDGtN8j176eiDd14sOXOOsAV8Hnm%2BZYA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065480.html">
   <LINK REL="Next"  HREF="065474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] How to cycle through servers on Connection Fail in an IRC client?</H1>
    <B>inhahe</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20How%20to%20cycle%20through%20servers%20on%20Connection%20Fail%20in%0A%20an%20IRC%20client%3F&In-Reply-To=%3CCAPeSgWrHJ%2Bfno65aq2HDGtN8j176eiDd14sOXOOsAV8Hnm%2BZYA%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] How to cycle through servers on Connection Fail in an IRC client?">inhahe at gmail.com
       </A><BR>
    <I>Fri Feb 26 00:45:05 MST 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065480.html">[Twisted-Python] Twisted 21.2.0rc1 Release Candidate Announcement
</A></li>
        <LI>Next message (by thread): <A HREF="065474.html">[Twisted-Python] Twisted 21.2.0 Release Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65467">[ date ]</a>
              <a href="thread.html#65467">[ thread ]</a>
              <a href="subject.html#65467">[ subject ]</a>
              <a href="author.html#65467">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm making an IRC client  using Twisted, and I want to connect to a
different server when connection fails, but I haven't been able to figure
out how to do that..

Here's a more or less minimal code sample reflecting what I have now:

------------------------------------------------------------------------------------------------

from twisted.words.protocols import irc
from twisted.internet import protocol
from twisted.internet import reactor

class ServerConnection(irc.IRCClient):

  def __init__(self):
    self.signedon = False
    self.nickindex = 0

  def signedOn(self):
    print(&quot;signed on&quot;)

  def nickChanged(self, newnick):
    self.nickname = newnick

class Network(object):
  def __init__(self, servers, mynick=None):
    self.servers = servers
    self.mynick = mynick
    self.serverindex = 0

class ServerFactory(protocol.ReconnectingClientFactory):
  def __init__(self, nickname=&quot;qttwirc&quot;, password=None, username=&quot;qttwirc&quot;,
realname=None, network=None):
    self.network = network
    self.network.mynick = nickname
    self.nickname = nickname
    self.username = username
    self.password = password
    self.realname = realname
    protocol.ReconnectingClientFactory.initialDelay = 10 #should i leave
this at 1?
    protocol.ReconnectingClientFactory.maxDelay = 10 #no idea what value
this should be. 3.5 wasn't slow enough, i was being throttled.

  def buildProtocol(self, addr):
    p = ServerConnection()
    self.serverconnection = p
    p.server = self
    p.nickname = self.nickname
    p.username = self.username
    self.resetDelay()
    return p

  def clientConnectionLost(self, connector, reason):
    self.serverconnection = None
    protocol.ReconnectingClientFactory.clientConnectionLost(self,
connector, reason)

  def clientConnectionFailed(self, connector, reason):
    self.serverconnection = None
    addr, port = self.network.servers[self.network.serverindex]
    self.network.serverindex = (self.network.serverindex+1) %
len(self.network.servers) #todo: make it actually use these values

    #reactor.callLater(config.reconnectdelay, reactor.connectTCP,
addr.encode(&quot;ascii&quot;), port, self)
    #reactor.connectTCP(addr, port, self) #is this feasible? i don't know a
better way to do this. connector.connect() apparently doesn't take
server/port as arguments.

    protocol.ReconnectingClientFactory.clientConnectionFailed(self,
connector, reason)

network = Network([(&quot;hitchcock.freenode.net&quot;, 6667), (&quot;verne.freenode.net&quot;,
6667)])
server = ServerFactory(nickname=&quot;test123&quot;, username=&quot;test123&quot;,
network=network)
reactor.connectTCP(*network.servers[network.serverindex], server)
reactor.run()

------------------------------------------------------------------------------------------------

If I have to completely change the structure of how I connect, that's
fine.. I don't understand Twisted very well, so I'm not aware of what some
other options are for how to make an IRC client.

(It probably doesn't matter, but in my actual program I'm using both
Twisted and PyQt5 in the same run loop using qt5reactor..)

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20210226/44ab753d/attachment.htm&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065480.html">[Twisted-Python] Twisted 21.2.0rc1 Release Candidate Announcement
</A></li>
	<LI>Next message (by thread): <A HREF="065474.html">[Twisted-Python] Twisted 21.2.0 Release Announcement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65467">[ date ]</a>
              <a href="thread.html#65467">[ thread ]</a>
              <a href="subject.html#65467">[ subject ]</a>
              <a href="author.html#65467">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
