<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] resolving release management conflict
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20resolving%20release%20management%20conflict&In-Reply-To=%3CCAG%3DrPVcyL8OEvtKJybrgn9zvZAEuj5S9mrCgUPrcFRs4Cf-zCg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="065428.html">
   <LINK REL="Next"  HREF="065431.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] resolving release management conflict</H1>
    <B>Craig Rodrigues</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20resolving%20release%20management%20conflict&In-Reply-To=%3CCAG%3DrPVcyL8OEvtKJybrgn9zvZAEuj5S9mrCgUPrcFRs4Cf-zCg%40mail.gmail.com%3E"
       TITLE="[Twisted-Python] resolving release management conflict">rodrigc at crodrigues.org
       </A><BR>
    <I>Wed Feb  3 05:32:53 MST 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="065428.html">[Twisted-Python] resolving release management conflict
</A></li>
        <LI>Next message (by thread): <A HREF="065431.html">[Twisted-Python] Developer docs should be updated on wiki when steps changed in code?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65430">[ date ]</a>
              <a href="thread.html#65430">[ thread ]</a>
              <a href="subject.html#65430">[ subject ]</a>
              <a href="author.html#65430">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 1, 2021 at 1:00 PM Glyph &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">glyph at twistedmatrix.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> I believe the proximate cause of the conflict here is that we're dealing
</I>&gt;<i> with this regression incorrectly.  When a regression is introduced, there's
</I>&gt;<i> a process for dealing with it, originally documented here:
</I>&gt;<i> <A HREF="https://twistedmatrix.com/trac/wiki/ReviewProcess#Revertingachange.">https://twistedmatrix.com/trac/wiki/ReviewProcess#Revertingachange.</A> [1]
</I>&gt;<i>  The principle we need to outline clearly is this: if we have a regression,
</I>&gt;<i> the change that introduced it should be reverted as soon as possible.  If
</I>&gt;<i> we *can't* revert it directly because of changes to trunk in the
</I>&gt;<i> meanwhile that introduce conflicts, ideally the change that we would make
</I>&gt;<i> would be the closest possible thing to reverting it, even if that
</I>&gt;<i> reintroduces a known bug that we have to reopen.
</I>&gt;<i>
</I>&gt;<i> In the case where a lot of work has happened in the interim, and it's *less
</I>&gt;<i> work* to just &quot;fix forward&quot; on top of trunk, it's fine to do a small fix
</I>&gt;<i> as an end run around this process.  The goal of this process is to minimize
</I>&gt;<i> the work required to restore trunk to a releasable state.
</I>&gt;<i>
</I>&gt;<i> Right now we have three competing fixes which have all been flagged as
</I>&gt;<i> incorrect in various ways:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>    - from Tom: <A HREF="https://github.com/twisted/twisted/pull/1499">https://github.com/twisted/twisted/pull/1499</A>
</I>&gt;<i>       - Craig rejected this one by saying it will break &quot;certain
</I>&gt;<i>       versions&quot; of Python, but I don't understand why it was closed rather than
</I>&gt;<i>       reviewed / reassigned as normal.  (Or for that matter which versions are
</I>&gt;<i>       the problems, or how it breaks them.)
</I>&gt;<i>
</I>&gt;<i>
</I>Yes, that is correct.  Over the summer, while investigating failures on
Azure CI caused by to non-ASCII characters in
a submitter's GitHub user ID.  I spent a lot of time testing in a Windows
environment on Python 3.5, 3.6, 3.7, and 3.8.
I found that there were subtle differences in the default encoding on the
console between each Python version,
and that affected the logic in _checkProcessArgs().
The fix that I did over the summer addressed the problems and fixed all the
CI issues.

There were two corner cases that were uncovered.  One by me, and one by Tom
Most.

CORNER CASE 1:    In Buildbot, they patch sys.stdout with io.StringIO in
their tests which affects their tests which call the Twisted Reactor.
                                   io.StringIO is not a 100% proper
replacement for sys.stdout which is of type _io.TextIOWrapper on Python 3+.
                                   However, Buildbot's tests have been
around for a long time, so I decided

CORNER CASE 2:    In a Windows GUI Application, sys.stdout is None.  So you
cannot get the encoding from sys.stdout.encoding


In <A HREF="https://github.com/twisted/twisted/pull/1502,">https://github.com/twisted/twisted/pull/1502,</A> I have a very small patch
which addresses those two corner cases.
I need to write a good test for it, but I think it is good enough to go
into the release.

Post-release:
(1) I would like to drop Python 3.5
(2)  Look at removing the _checkProcessArgs() function.  The complexity of
bytes/unicode logic in there was more useful
       in the Python 2 days when dealing with the differences between how
Python on Windows handled args/env vs.
       how Python on POSIX handled args/env.  I think this function can
completely go in a Python 3.6+ world, and will greatly simplify the code.
       However, this needs to be carefully tested and reviewed.



&gt;<i>
</I>&gt;<i>    - from Adi: <A HREF="https://github.com/twisted/twisted/pull/1501">https://github.com/twisted/twisted/pull/1501</A>
</I>&gt;<i>       - Craig rejected this one by saying &quot;please stop working on this&quot;
</I>&gt;<i>       but it also doesn't have any technical reason that this solution is
</I>&gt;<i>       incorrect.
</I>&gt;<i>
</I>&gt;<i> Yes, that is correct.  Sorry if that was an aggressive action on my part,
</I>but I did a fix for this, as described above.






&gt;<i>
</I>&gt;<i>    - from Craig: <A HREF="https://github.com/twisted/twisted/pull/1502">https://github.com/twisted/twisted/pull/1502</A>
</I>&gt;<i>       - This was originally given a passing review by Povilas from the
</I>&gt;<i>       Buildbot project, but twm added an additional blocking review shortly
</I>&gt;<i>       thereafter explaining that it introduced an additional regression.  It
</I>&gt;<i>       seems as though this one is now actively being worked on?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Craig: you closed two of these issues on the basis that you were &quot;already
</I>&gt;<i> working on a fix&quot;, but that's not a valid reason to *close* a PR.  Or,
</I>&gt;<i> for that matter, to give it a failing review.  In the future, please
</I>&gt;<i> comment on PRs that you don't want merged by pointing out their technical
</I>&gt;<i> insufficiency, so that we can take the opportunity to learn for the benefit
</I>&gt;<i> of future maintenance.  In this case, the underlying issue is clearly quite
</I>&gt;<i> nuanced and requires expertise that touches platform differences in
</I>&gt;<i> Python's core APIs, so having multiple people working on different fixes is
</I>&gt;<i> totally fine; this effort is not wasted if everybody learns a little bit
</I>&gt;<i> about the code in question, and it's *definitely* not wasted if we have
</I>&gt;<i> to synthesize our approaches in the end anyway because they address
</I>&gt;<i> different cases.
</I>&gt;<i>
</I>
OK, thanks for the feedback, and sorry for any process violations or hurt
feelings from my actions.



&gt;<i>
</I>&gt;<i> All of these fixes have each been outstanding for weeks, which strongly
</I>&gt;<i> suggests that this is *way* too hard to fix forward and we should have
</I>&gt;<i> stopped trying a while ago.  We should fall back to the previous one if in
</I>&gt;<i> *any* way possible, then reintroduce the changes which caused it.  If
</I>&gt;<i> we're really just about to land 1502, then feel free to complete the work
</I>&gt;<i> there, but in the future we should regard this kind of delay in reverting
</I>&gt;<i> as a process failure.
</I>&gt;<i>
</I>
No, the fixes have been outstanding for weeks mainly due to the fact
that certain personal circumstances came up in my life, such that I had to
refocus my time away from Twisted for a few months,
compared to the time I had over the summer of 2020.  I now have more time,
and am committed to getting this release out.



&gt;<i>
</I>&gt;<i> If there are too many conflicts to address in a revert, and reverting
</I>&gt;<i> means we need to revert 3 or 4 tickets which have built on top of that
</I>&gt;<i> work, then let's just do that and get those re-merged later as well.  It's
</I>&gt;<i> unfortunate to ship without features but it's better than multi-month
</I>&gt;<i> release hold-ups.
</I>&gt;<i>
</I>&gt;<i> (Note: a straight revert doesn't require a full code review.  If you can
</I>&gt;<i> revert a merge and CI is happy with it, feel free to get an administrator
</I>&gt;<i> to smash the red button to merge immediately.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>    1. Can we revert the change that introduced 10069 so that we can
</I>&gt;<i>    follow the process to re-introduce it after a release has been made, and
</I>&gt;<i>    have the conversation about which PR to accept and why post-release?
</I>&gt;<i>
</I>&gt;<i>
</I>I would rather not do this.  I would rather proceed with
<A HREF="https://github.com/twisted/twisted/pull/1502">https://github.com/twisted/twisted/pull/1502</A> , which is minimal,
and addresses the corner cases.

Going through the whole revert, resubmit, retest is going to add more delay
to the release.



&gt;<i>
</I>&gt;<i>    1. Do we need to revert the release process changes from
</I>&gt;<i>    <A HREF="https://github.com/twisted/twisted/pull/1464">https://github.com/twisted/twisted/pull/1464</A> for this release?  If so,
</I>&gt;<i>    what is the specific technical need this addresses?
</I>&gt;<i>
</I>&gt;<i>
</I>I do not agree with the changes in PR 1464.  I think a better solution
would have been to have a separate release.yml workflow,
which could be triggered.  By clicking the &quot;Create a New Release&quot; link on
GitHub.
I had a working prototype here: <A HREF="https://github.com/twisted/twisted/pull/1423">https://github.com/twisted/twisted/pull/1423</A>
, and I successfully pushed some releases to
<A HREF="https://test.pypi.org">https://test.pypi.org</A>

However, even though I disagree with the approach in PR 1464, since
multiple people have decided that this is what they want,
I'll just go with this.

--
Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-python/attachments/20210203/5d8890f1/attachment.htm&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="065428.html">[Twisted-Python] resolving release management conflict
</A></li>
	<LI>Next message (by thread): <A HREF="065431.html">[Twisted-Python] Developer docs should be updated on wiki when steps changed in code?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65430">[ date ]</a>
              <a href="thread.html#65430">[ thread ]</a>
              <a href="subject.html#65430">[ subject ]</a>
              <a href="author.html#65430">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
