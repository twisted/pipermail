<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-Python] Please help with Deferreds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Please%20help%20with%20Deferreds&In-Reply-To=%3C20020826014346.GB12158%40ritsuko.xware.cx%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="034028.html">
   <LINK REL="Next"  HREF="034046.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-Python] Please help with Deferreds</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-python%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-Python%5D%20Please%20help%20with%20Deferreds&In-Reply-To=%3C20020826014346.GB12158%40ritsuko.xware.cx%3E"
       TITLE="[Twisted-Python] Please help with Deferreds">andrew-twisted at puzzling.org
       </A><BR>
    <I>Sun Aug 25 19:43:46 MDT 2002</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="034028.html">[Twisted-Python] Please help with Deferreds
</A></li>
        <LI>Next message (by thread): <A HREF="034046.html">[Twisted-Python] Please help with Deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34040">[ date ]</a>
              <a href="thread.html#34040">[ thread ]</a>
              <a href="subject.html#34040">[ subject ]</a>
              <a href="author.html#34040">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Aug 24, 2002 at 10:05:30PM +0300, Tommi Virtanen wrote:
&gt;<i> 	Can anyone explain the behaviour of the
</I>&gt;<i> 	following?
</I>&gt;<i> 
</I>&gt;<i> #!/usr/bin/python
</I>&gt;<i> import sys
</I>&gt;<i> from twisted.internet import defer, reactor
</I>&gt;<i> d=defer.Deferred()
</I>&gt;<i> d.callback(0)
</I>&gt;<i> d2=defer.Deferred()
</I>&gt;<i> d.addCallback(lambda x,d2=d2: d2)
</I>
So you've effectively done:

d = defer.Deferred()
d2 = defer.Deferred()
d.callback(d2)

&gt;<i> # switch the comment sign on the next two and it'll
</I>&gt;<i> # print not 1 but a Deferred. Why?
</I>&gt;<i> #reactor.callLater(0, lambda d2=d2: d2.callback(1))
</I>
Which is effectively:
# reactor.callLater(0, d2.callback, 1)

&gt;<i> d2.callback(1)
</I>&gt;<i> 
</I>&gt;<i> d.addCallback(lambda x:sys.stdout.write(repr(x)+'\n'))
</I>&gt;<i> d.addBoth(lambda x:reactor.stop())
</I>
Note that these callbacks will fire immediately upon adding them.

&gt;<i> reactor.run()
</I>
And of course, you don't need to do reactor.run() unless you're using
the reactor.callLater version of this code.

So, this is easy...

Consider what happens to your first Deferred, d, with that line
uncommented:
  d = defer.Deferred()      # 1. Create it
  d.callback(d2)            # 2. call it with some value (d2)
  reactor.callLater(....)   # 3. this doesn't happen yet
  d.addCallback(....)       # 4. this fires *immediately*, and writes
                                 the value from 2., which is d2

So that's why it prints the Deferred in that case.  Now back the way the
code is originally:
  d = defer.Deferred()      # 1. Create it
  d.callback(d2)            # 2. call it with some value (d2)
  d2.callback(1)            # 3. call d2 with another value (1)
  d.addCallback(....)       # 4. this fires *immediately*, and writes 
                                 the value from 2. -- which is 1???

That does confuse me.  Somehow, if a callback has a result which is
another Deferred, it does something special to automatically call that
Deferred, which I didn't realise and seems nasty to me.  I thought that
was only meant to happen if you explicitly called chainDeferred?

I've just re-read doc/howto/defer and I see that this is in fact
explained under the heading &quot;Chain Deferreds&quot;, but I'm still curious as
to why this behaviour is necessary... &quot;explicit is better than
implicit&quot;, etc :)

Anyway, I hope you now understand why that code behaves the way it
does...

-Andrew.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="034028.html">[Twisted-Python] Please help with Deferreds
</A></li>
	<LI>Next message (by thread): <A HREF="034046.html">[Twisted-Python] Please help with Deferreds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34040">[ date ]</a>
              <a href="thread.html#34040">[ thread ]</a>
              <a href="subject.html#34040">[ subject ]</a>
              <a href="author.html#34040">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python">More information about the Twisted-Python
mailing list</a><br>
</body></html>
