<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Reality] getting started?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:reality%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000159.html">
   <LINK REL="Next"  HREF="000161.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Reality] getting started?
   </H1>
    <B>Eric Wong
    </B> 
    <A HREF="mailto:reality%40twistedmatrix.com"
       TITLE="[Reality] getting started?">reality@twistedmatrix.com
       </A><BR>
    <I>Thu, 28 Aug 2003 09:29:55 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="000159.html">[Reality] getting started?
</A></li>
        <LI> Next message: <A HREF="000161.html">[Reality] getting started?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#160">[ date ]</a>
              <a href="thread.html#160">[ thread ]</a>
              <a href="subject.html#160">[ subject ]</a>
              <a href="author.html#160">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--pWyiEgJYm5f9v55/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

On Thu, Aug 28, 2003 at 05:26:39AM -0400, Christopher Armstrong wrote:
&gt;<i> On Wed, Aug 27, 2003 at 11:45:21PM -0700, Eric Wong wrote:
</I>[cut]
&gt;<i> &gt; Should I send in patches?  For example, I subclassed wiring.TextServer
</I>&gt;<i> &gt; to deal with multiple player logins (to the prosaically named
</I>&gt;<i> &gt; 'MultiPlayerTextServer').  Or is this the sort of system-specific change
</I>&gt;<i> &gt; that doesn't need to be distributed?
</I>&gt;<i> 
</I>&gt;<i> Well, for one, this is an extremely generic piece of functionality
</I>&gt;<i> (for our target audience -- reality is all about being multiplayer :)
</I>&gt;<i> which definitely should be included anyway. For two, Reality will
</I>&gt;<i> probably have a good bit of system-specific stuff -- it *will* be just
</I>&gt;<i> a &quot;virtual world *engine*&quot;, but we learned from Python that a strong
</I>&gt;<i> standard library is an *excellent* thing to have.
</I>&gt;<i>
</I>&gt;<i> Anyway, how does your MultiPlayerTextServer do its authentication? 
</I>&gt;<i> Does it use the (new) APIs in twisted.cred?
</I>
Actually deals with the problem by ignoring it completely.
No authentication is done.  Anyone can log in with any name and more
than one user can have the same name at once (just like Life, eh?)
There's just a stub called loginUser() that anyone can override for
system-specific implementations.  It was mainly to let me log in with
multiple users so I could see how they interact with one another.

It's this way because I'm not sure what (if any) sort of object-
persistance architecture is envisioned for TR.  Some sort of file-based
database (like Cold or LPC, which I currently prefer) or a large
monolithic db (like the venerable LambdaMOO or maybe pickling the
entire world) or a relational-database-backed db (although I don't quite
understand why anyone would want to do this) or what-not-and-not.

Anyhow, my patch is attached.

Eric



--pWyiEgJYm5f9v55/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=&quot;wiring.py.patch&quot;

Index: wiring.py
===================================================================
RCS file: /cvs/NewReality/reality/wiring.py,v
retrieving revision 1.14
diff -u -r1.14 wiring.py
--- wiring.py	6 Jul 2003 02:01:46 -0000	1.14
+++ wiring.py	28 Aug 2003 16:26:19 -0000
@@ -6,6 +6,7 @@
 from reality.text.common import INoun, IThinker, express, IDescribeable
 from reality.things import EventReceiver, IEventReceiver, IMoveListener, Refusal
 from reality import errors
+from reality import things
 
 import traceback
 
@@ -98,4 +99,47 @@
     def buildProtocol(self, addr):
         p = ServerFactory.buildProtocol(self, addr)
         p.setAvatar(self.person)
+        return p
+
+
+##########################################################
+########################################################## for multi-player
+##########################################################
+
+class MultiPlayerTextServer(TextServer):
+
+    startRoom = None
+
+    def connectMessage(self):
+        return &quot;&quot;&quot;
+Twisted Reality - MultiPlayerTextServer
+
+name: &quot;&quot;&quot;
+
+    def telnet_Command(self, cmd):
+        if self.avatar:
+            TextServer.telnet_Command( self, cmd )
+        else:
+            self.loginUser( cmd )
+
+    def loginUser(self, cmd):
+        &quot;&quot;&quot;This is where the authentication stuff would go.
+           Do the auth, make the user object, set the avatar
+           to that object and move it to the start room or
+           home.&quot;&quot;&quot;
+        self.setAvatar( things.Actor( cmd ) )
+        self.avatar.moveTo( self.startRoom )
+        self.write(self.commandPrompt())
+
+class MultiPlayerTextFactory(ServerFactory):
+    protocol = MultiPlayerTextServer
+
+    startRoom = None
+
+    def __init__(self, startRoom):
+        self.startRoom = startRoom 
+
+    def buildProtocol(self, addr):
+        p = ServerFactory.buildProtocol(self, addr)
+        p.startRoom = self.startRoom
         return p

--pWyiEgJYm5f9v55/--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000159.html">[Reality] getting started?
</A></li>
	<LI> Next message: <A HREF="000161.html">[Reality] getting started?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#160">[ date ]</a>
              <a href="thread.html#160">[ thread ]</a>
              <a href="subject.html#160">[ subject ]</a>
              <a href="author.html#160">[ author ]</a>
         </LI>
       </UL>
</body></html>
