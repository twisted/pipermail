<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Reality] speaking/listening interfaces
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:reality%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   
   <LINK REL="Next"  HREF="000164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Reality] speaking/listening interfaces
   </H1>
    <B>Eric Wong
    </B> 
    <A HREF="mailto:reality%40twistedmatrix.com"
       TITLE="[Reality] speaking/listening interfaces">reality@twistedmatrix.com
       </A><BR>
    <I>Fri, 5 Sep 2003 15:09:19 -0700</I>
    <P><UL>
        
        <LI> Next message: <A HREF="000164.html">[Reality] speaking/listening interfaces
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#163">[ date ]</a>
              <a href="thread.html#163">[ thread ]</a>
              <a href="subject.html#163">[ subject ]</a>
              <a href="author.html#163">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--sm4nu43k4a2Rpi4c
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hello,

Is the mailing list back?

I'm attaching two files, speaking.py and listening.py.  Do these do the
right thing to create interfaces/adapters?  speaking.py defines a basic
interace for talking or whispering in a room, listening.py defines an
interface for listening to things said.

The latest thing that I find a little confusing is using the variable
'actor' to mean the adapter to the interface.  It probably makes perfect
sense in the component model, but it seems a little ambiguous when
talking about mud/mush/moo/virtual worlds.

How does the unit testing work?  I looked over test_reality.py and I'm
not sure how to use it (actually run the unit tests) or add new tests.

Eric


--sm4nu43k4a2Rpi4c
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=&quot;speaking.py&quot;

&quot;&quot;&quot;
This is the speaking (whisper, say, tell and shout) interface/adapter
for Twisted Reality.  Things need to have the listening interface to
actually receive the message.
&quot;&quot;&quot;

from twisted.python import components
from reality.text import english
from reality import actions, things, listening


################################################################
################################################################ speak/say
################################################################
class Speak( actions.NoTargetAction ):

    onlyBroadcastToActor = 1

    def __init__( self, adapter, text ):
        &quot;&quot;&quot;
        Note this takes two args (the interface adapter and the text
        spoken), even though normally NoTargetAction only takes one.
        &quot;&quot;&quot;
        super( Speak, self ).__init__( adapter )
        self.text = text

    def formatToActor( self ):
        return &quot;You say: &quot;, self.text

    def doAction( self ):
        &quot;&quot;&quot;
        Find the other listeners in the room, and tell them what
        was said.
        &quot;&quot;&quot;
        speaker = self.actor.original
        location = speaker.location
        for o in location.findListeners( self, listening.IListenActor ):
            if o.original is not speaker:
                listening.Listen( o, speaker, self.text ).performAction()


class Speaker( components.Adapter ):
    __implements__ = ISpeakActor

components.registerAdapter( Speaker, things.Actor, ISpeakActor )


class SayParser( english.Subparser ):
    def parse_say( self, player, text ):
        adapter = player.getComponent( ISpeakActor )
        if adapter is None:
            return []
        return [ Speak( adapter, text ) ]

english.registerSubparser( SayParser() )

################################################################
################################################################ whisper
################################################################
IWhisperTarget = listening.IListenActor
class Whisper( actions.TargetAction ):

    def __init__( self, adapter, targetName, text ):
        super( Whisper, self ).__init__( adapter, targetName )
        self.text = text
        whisperer = self.actor.original
        location = whisperer.location

    def formatToActor( self ):
        return &quot;You whisper to &quot;, self.target, &quot;: &quot;, self.text

    def formatToTarget( self ):
        return self.actor, &quot; whispers to you: &quot;, self.text
    
    def formatToOther( self ):
        return None

    def doAction( self ):
        pass

class Whisperer( components.Adapter ):
    __implements__ = IWhisperActor

components.registerAdapter( Whisperer, things.Actor, IWhisperActor )

class WhisperParser( english.Subparser ):
    def parse_whisper( self, player, text ):
        adapter = player.getComponent( IWhisperActor )
        if adapter is None or text.find( &quot; &quot; ) == -1:
            return []
        (targetName, message) = text.split( None, 1 )
        return [ Whisper( adapter, targetName, message ) ]

english.registerSubparser( WhisperParser() )


--sm4nu43k4a2Rpi4c
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename=&quot;listening.py&quot;

&quot;&quot;&quot;
The listening interface/adapter.  Something needs to have this to
'listen' what a speaker says (see speaking.py).
&quot;&quot;&quot;

from twisted.python import components
from reality import actions, things

class Listen( actions.NoTargetAction ):
    onlyBroadcastToActor = 1

    def __init__( self, adapter, speaker, text ):
        super( Listen, self ).__init__( adapter )
        self.speaker = speaker
        self.text = text

    def formatToActor( self ):
        return self.speaker, &quot; says: &quot;, str( self.text )

    def doAction( self ):
        pass

class Listener( components.Adapter ):
    __implements__ = IListenActor

components.registerAdapter( Listener, things.Actor, IListenActor )


--sm4nu43k4a2Rpi4c--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI> Next message: <A HREF="000164.html">[Reality] speaking/listening interfaces
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#163">[ date ]</a>
              <a href="thread.html#163">[ thread ]</a>
              <a href="subject.html#163">[ subject ]</a>
              <a href="author.html#163">[ author ]</a>
         </LI>
       </UL>
</body></html>
