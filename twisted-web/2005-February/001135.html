<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] html cache with timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20html%20cache%20with%20timeout&In-Reply-To=20050201160540.7026.1085493566.divmod.quotient.16656%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001134.html">
   <LINK REL="Next"  HREF="001136.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] html cache with timeout</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20html%20cache%20with%20timeout&In-Reply-To=20050201160540.7026.1085493566.divmod.quotient.16656%40ohm"
       TITLE="[Twisted-web] html cache with timeout">andrea at cpushare.com
       </A><BR>
    <I>Tue Feb  1 12:09:57 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001134.html">[Twisted-web] html cache with timeout
</A></li>
        <LI>Next message: <A HREF="001136.html">[Twisted-web] html cache with timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1135">[ date ]</a>
              <a href="thread.html#1135">[ thread ]</a>
              <a href="subject.html#1135">[ subject ]</a>
              <a href="author.html#1135">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Feb 01, 2005 at 04:05:40PM +0000, Valentino Volonghi wrote:
&gt;<i> Anyway the patch is below:
</I>
Looks a great start.

I'll give it a spin overnight to see what happens.

&gt;<i> +_CACHE = {}
</I>
Shouldn't this be stored in the respective classes?

&gt;<i> +def CachedSerializer(original, context):
</I>&gt;<i> +    cached = _CACHE.get(original.name, None)
</I>&gt;<i> +    life = now()-original.lifetime
</I>
Can we execute only one single gettimeofday? gettimeofday is one of the
biggest kernel costs of twisted in general (modulo poll). I will deploy
initially on x86 (on x86-64 with vsyscalls gettimeofday is zerocost).

Could you also keep it similar to my patch where a timeout &lt;= 0 means
&quot;cache forever&quot;?

&gt;<i> +    if cached and cached[0] &gt; life:
</I>&gt;<i> +##         print &quot;=&quot;*20
</I>&gt;<i> +##         print cached[0]
</I>&gt;<i> +##         print life
</I>&gt;<i> +##         print &quot;=&quot;*20        
</I>&gt;<i> +        yield cached[1]
</I>&gt;<i> +        return
</I>
Why yield if you return immediatly? Why not return cached[1]?

&gt;<i> +    _CACHE[original.name] = (now(), result)
</I>
what is contained in original.name? How to identify exactly which object
is being cached? (just to understand how should I use this exactly)

&gt;<i> +    yield result
</I>
here again, why not return result?


Do I understand correctly this more finegriend cache doesn't obsolete
the other cache?

The other cache is probably the fastest we can get, and it pretty much
solves my problem for the high traffic part.

However I will definitely need this finegrined cache as well in the
longer run, even if it's lower priority. One of my first objectives
would be to workaround the dogslow rendering of the annotate.Choice
renderer. But I'll get great benefit in the header fragment and in other
fragments too.

As for the session cache, that's a much lower prio to me, the real
obvious caching we can do is for _global_ stuff that is the same for the
whole site, always.

Thanks and keep up the great work! ;)

PS. Still I would like to see compy removed, since not everything will
be cached. There are parts where I will not cache anything.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001134.html">[Twisted-web] html cache with timeout
</A></li>
	<LI>Next message: <A HREF="001136.html">[Twisted-web] html cache with timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1135">[ date ]</a>
              <a href="thread.html#1135">[ thread ]</a>
              <a href="subject.html#1135">[ subject ]</a>
              <a href="author.html#1135">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
