<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] mailman with twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20mailman%20with%20twisted&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001161.html">
   <LINK REL="Next"  HREF="001156.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] mailman with twisted</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20mailman%20with%20twisted&In-Reply-To="
       TITLE="[Twisted-web] mailman with twisted">andrea at cpushare.com
       </A><BR>
    <I>Wed Feb  9 22:47:51 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001161.html">[Twisted-web] Bug found 1.3.0 twisted.web.static module
</A></li>
        <LI>Next message: <A HREF="001156.html">[Twisted-web] mailman with twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1155">[ date ]</a>
              <a href="thread.html#1155">[ thread ]</a>
              <a href="subject.html#1155">[ subject ]</a>
              <a href="author.html#1155">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to setup mailman, but I had not much luck so far.

I'm testing it like this:

import pwd
uid = pwd.getpwnam('andrea')[2]
gid = int(file('/etc/mailman/mailman.cgi-gid').read())

from twisted.application import service
application = service.Application('mailman', uid=uid, gid=gid)

from twisted.application import internet, service

s = service.MultiService()

from twisted.web import server, distrib, twcgi, static
from twisted.spread import pb

r = twcgi.CGIDirectory('/usr/lib/mailman/cgi-bin')
r.putChild('pipermail', static.File('/var/lib/mailman/archives/public'))

site = server.Site(r)

internet.UNIXServer('/var/lib/mailman/.twistd-web-pb',
		    pb.PBServerFactory(distrib.ResourcePublisher(site))).setServiceParent(s)

s.setServiceParent(service.IServiceCollection(application))


However the above isn't good, the socket is created word writeable, and
it's owned by root, the setuid is executed later on (which is a good
thing normally to bind ports &lt;1024, but not in this case). And if the file is
already present I get the below problem. Why can't simply bind the device
without recreating it? I don't recall any bind(2) limitation in the kernel that
forces to recreate the device. At least there should be an option to auto-delete it.

opteron:/home/andrea/cpushare/server/cpushare/cpushare/web # twistd -r poll -noy mailman.tac
2005/02/10 06:45 CET [-] Log opened.
2005/02/10 06:45 CET [-] twistd SVN-trunk (/home/andrea/bin/i686/python-20050207/bin/python 2.4.1) starting up
2005/02/10 06:45 CET [-] reactor class: twisted.internet.pollreactor.PollReactor
2005/02/10 06:45 CET [-] Loading mailman.tac...
2005/02/10 06:45 CET [-] /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/web/woven/interfaces.py:60: twisted.python.components.ComponentsDeprecationWarning: Please don't use __adapt__ on Interface subclasses
2005/02/10 06:45 CET [-] /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/web/woven/interfaces.py:135: twisted.python.components.ComponentsDeprecationWarning: Please don't use __adapt__ on Interface subclasses
2005/02/10 06:45 CET [-] Loaded.
2005/02/10 06:45 CET [-] twisted.spread.pb.PBServerFactory starting on &quot;'/var/lib/mailman/.twistd-web-pb'&quot;
2005/02/10 06:45 CET [-] Starting factory &lt;twisted.spread.pb.PBServerFactory instance at 0x55e36bcc&gt;
2005/02/10 06:45 CET [-] Traceback (most recent call last):
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python/bin/twistd&quot;, line 25, in ?
2005/02/10 06:45 CET [-]     run()
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/scripts/twistd.py&quot;, line 171, in run
2005/02/10 06:45 CET [-]     app.run(runApp, ServerOptions)
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/application/app.py&quot;, line 221, in run
2005/02/10 06:45 CET [-]     runApp(config)
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/scripts/twistd.py&quot;, line 162, in runApp
2005/02/10 06:45 CET [-]     startApplication(config, application)
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/scripts/twistd.py&quot;, line 146, in startApplication
2005/02/10 06:45 CET [-]     service.IService(application).privilegedStartService()
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/application/service.py&quot;, line 194, in privilegedStartService
2005/02/10 06:45 CET [-]     service.privilegedStartService()
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/application/service.py&quot;, line 194, in privilegedStartService
2005/02/10 06:45 CET [-]     service.privilegedStartService()
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/application/internet.py&quot;, line 65, in privilegedStartService
2005/02/10 06:45 CET [-]     self._port = self._getPort()
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/application/internet.py&quot;, line 82, in _getPort
2005/02/10 06:45 CET [-]     return getattr(reactor, 'listen'+self.method)(*self.args, **self.kwargs)
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/internet/posixbase.py&quot;, line 322, in listenUNIX
2005/02/10 06:45 CET [-]     p.startListening()
2005/02/10 06:45 CET [-]   File &quot;/home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/internet/unix.py&quot;, line 85, in startListening
2005/02/10 06:45 CET [-]     raise CannotListenError, (None, self.port, le)
2005/02/10 06:45 CET [-] twisted.internet.error.CannotListenError: Couldn't listen on any:/var/lib/mailman/.twistd-web-pb: (98, 'Address already in use').

Second worse problem is in pb, when I connect the nevow server to this
remote server with this:

class something(rend.Page):
[..]
	from twisted.web import server, distrib, twcgi, static
	child_mailman = distrib.ResourceSubscription('unix', '/var/lib/mailman/.twistd-web-pb')
[..]

When I try to fetch /mailman I get this:

2005/02/10 05:52 CET [Broker,client] [Failure instance: Traceback: twisted.spread.jelly.InsecureJelly, Class not allowed for instance: twisted.internet.defer.Deferred &lt;Deferred at 0x561eed6c&gt;
        /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/spread/pb.py:855:_sendMessage
        /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/spread/pb.py:809:serialize
        /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/spread/jelly.py:838:jelly
        /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/spread/jelly.py:444:jelly
        /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/spread/jelly.py:400:jelly
        /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/spread/flavors.py:304:jellyFor
        /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/spread/jelly.py:448:jelly
        /home/andrea/bin/i686/python-20050207/lib/python2.4/site-packages/twisted/spread/jelly.py:473:jelly
        ]
2005/02/10 06:08 CET [Broker,client] could not connect to distributed web service: connection dropped
2005/02/10 06:08 CET [Broker,client] Stopping factory &lt;twisted.spread.pb.PBClientFactory instance at 0x561ffa6c&gt;

The only document I found about it, is this:

<A HREF="http://twistedmatrix.com/pipermail/twisted-web/2004-July/000555.html">http://twistedmatrix.com/pipermail/twisted-web/2004-July/000555.html</A>

The absurd thing is that the test programs works fine (test_distrib.py and
silly-web.py both works).

I'm lost... ;) (last resort is always to run apache on port 8080 just
for mailman, but I'd rather avoid opening two webservers in the
firewall)

This problem must be already solved somehow since twistedmatrix.com has
it working.

I'm running SVN trunk for everything, except python that is the 2.4
branch.

Thanks in advance for any help.

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001161.html">[Twisted-web] Bug found 1.3.0 twisted.web.static module
</A></li>
	<LI>Next message: <A HREF="001156.html">[Twisted-web] mailman with twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1155">[ date ]</a>
              <a href="thread.html#1155">[ thread ]</a>
              <a href="subject.html#1155">[ subject ]</a>
              <a href="author.html#1155">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
