<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Shutting down server via web-request with nice status
	page
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Shutting%20down%20server%20via%20web-request%20with%20nice%20status%0A%09page&In-Reply-To=E1D3aGA-0003ws-03%40pyramid.twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001235.html">
   <LINK REL="Next"  HREF="001239.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Shutting down server via web-request with nice status
	page</H1>
    <B>Maciej Szumocki</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Shutting%20down%20server%20via%20web-request%20with%20nice%20status%0A%09page&In-Reply-To=E1D3aGA-0003ws-03%40pyramid.twistedmatrix.com"
       TITLE="[Twisted-web] Shutting down server via web-request with nice status
	page">mszumocki at contman.pl
       </A><BR>
    <I>Wed Feb 23 06:20:01 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001235.html">[Twisted-web] better PHP support
</A></li>
        <LI>Next message: <A HREF="001239.html">[Twisted-web] Fwd: Re: [Ossri] data collection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1236">[ date ]</a>
              <a href="thread.html#1236">[ thread ]</a>
              <a href="subject.html#1236">[ subject ]</a>
              <a href="author.html#1236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, 

 I have question about how does reactor.stop() work with Nevow.
I have a simple web server (in twisted/nevow) that does something in background, and
there's a page that's supposed to close the server gracefully. I would like the request
to be served this way:
 - client sends the request (opens the page in browser)
 - he gets half-finished page with something like &quot;Shutting down...&quot;
 - server does some possibly time-confusing stuff then sends &quot;Finished&quot; completing the page
 - server stops
I'm pretty new to both twisted and nevow, and this is what i've come up so far quickly.
Surprisingly, it works to some extent, as in server does indeed stop, but i'm looking for 
a way to make it non-blocking, so other client who connect in the same time would get
alternative page with &quot;server closing down&quot; message.

class Terminate(rend.Page):
    &quot;&quot;&quot;
    Rendering this resource will stop the import process if it's running, then save current
    state and configuration and gracefully shutdown import server
    &quot;&quot;&quot;

    NAME = 'Terminating server'

    docFactory = loaders.stan(
        html[
            head[page_title(NAME)],
            body[
                main_header(NAME, url.root),
                ul(data = directive('execute'), render=directive(&quot;sequence&quot;))[
                    li(pattern='item')[span(render=directive(&quot;string&quot;)), &quot;... &quot;],
                ],
                hr,
                h2['Server stopped'],
                ]
            ]
    )

    def data_execute(self, context, data):
        if work.running():
            yield &quot;Stopping import process&quot;
            work.stop()
        yield &quot;Saving configuration&quot;
        work.save()
        yield &quot;Shutting down&quot;
        work.terminate()
        yield &quot;Done.&quot;

work.terminate() simply calls reactor.stop() at the moment. work.stop() and work.save() are the parts
of blocking code - i intentd to rewrite them to either work in thread or by using deferreds (assuming i manage to
figure out how do deferreds work exactly ;) 
Could you please give me some ideas as to how should data_execute method look to achieve effect i want?

Maciej Szumocki


</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001235.html">[Twisted-web] better PHP support
</A></li>
	<LI>Next message: <A HREF="001239.html">[Twisted-web] Fwd: Re: [Ossri] data collection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1236">[ date ]</a>
              <a href="thread.html#1236">[ thread ]</a>
              <a href="subject.html#1236">[ subject ]</a>
              <a href="author.html#1236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
