<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] caching branch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20caching%20branch&In-Reply-To=420E36FA.1080003%40divmod.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001207.html">
   <LINK REL="Next"  HREF="001203.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] caching branch</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20caching%20branch&In-Reply-To=420E36FA.1080003%40divmod.com"
       TITLE="[Twisted-web] caching branch">andrea at cpushare.com
       </A><BR>
    <I>Thu Feb 17 21:15:57 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001207.html">[Twisted-web] pgasync (was: /freeform_post!!random causes
	exceptions)
</A></li>
        <LI>Next message: <A HREF="001203.html">[Twisted-web] caching branch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1202">[ date ]</a>
              <a href="thread.html#1202">[ thread ]</a>
              <a href="subject.html#1202">[ subject ]</a>
              <a href="author.html#1202">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The tags.cached keeps working fine in the caching branch (which btw
applied cleanly on top of trunk).

What doesn't work is the rend.Page. I'm very curious to compare the
performance of the caching branch with my previous code that is
currently online already.

Locals
rest	[&lt;listiterator object at 0x56c6fcac&gt;]
item	&lt;generator object at 0x56c6fc8c&gt;
gen	&lt;generator object at 0x56c6fc8c&gt;
/home/andrea/bin/x86_64/python/lib/python2.4/site-packages/nevow/flat/flatstan.py, line 234 in CachedSerializer
232

233

def CachedSerializer(original, context):

234

    cache = ICache(original.scope(context))

235

    cached = cache.get(original.key, original.lifetime)

Locals
original	&lt;cached instance at 1455889540&gt;
context	&lt;WovenContext instance at 1455880172&gt;
Globals
ICache	&lt;MetaInterface nevow.inevow.ICache&gt;
CachedSerializer	&lt;function CachedSerializer at 0x56c63614&gt;

I also suggest to apply this patch to the code or it doesn't even
startup.

--- Nevow/nevow/rend.py.~1~	2005-02-18 04:39:54.208615490 +0100
+++ Nevow/nevow/rend.py	2005-02-18 05:06:15.272641191 +0100
@@ -30,6 +30,7 @@ from nevow import tags
 from nevow import flat
 from nevow.util import log
 from nevow import util
+from nevow import url
 
 import formless
 from formless import iformless
@@ -416,7 +417,7 @@ class Page(Fragment, ConfigurableFactory
         if self.buffered:
             io = StringIO()
             writer = io.write
-            def finisher(result):                
+            def finisher(result):
                 request.write(io.getvalue())
                 finishRequest()
                 return result
@@ -428,7 +429,7 @@ class Page(Fragment, ConfigurableFactory
 
         doc = self.docFactory.load()
         if self.cache:
-            name = url.URL.fromContext(ctx).path
+            name = str(url.URL.fromContext(ctx))
             doc = tags.cached(name, self.lifetime)[doc]
         ctx =  WovenContext(ctx, tags.invisible[doc])
 
@@ -504,7 +505,6 @@ class Page(Fragment, ConfigurableFactory
             else:
                 ## Use the redirectAfterPost url
                 ref = str(redirectAfterPost)
-            from nevow import url
             refpath = url.URL.fromString(ref)
             magicCookie = str(now())
             refpath = refpath.replace('_nevow_carryover_', magicCookie)

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001207.html">[Twisted-web] pgasync (was: /freeform_post!!random causes
	exceptions)
</A></li>
	<LI>Next message: <A HREF="001203.html">[Twisted-web] caching branch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1202">[ date ]</a>
              <a href="thread.html#1202">[ thread ]</a>
              <a href="subject.html#1202">[ subject ]</a>
              <a href="author.html#1202">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
