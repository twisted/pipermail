<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] sendLine and connectionLost question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20sendLine%20and%20connectionLost%20question&In-Reply-To=20100527013849.1974.428959893.divmod.xquotient.9%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004485.html">
   <LINK REL="Next"  HREF="004487.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] sendLine and connectionLost question</H1>
    <B>DAVID JIMENEZ CARRASCO</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20sendLine%20and%20connectionLost%20question&In-Reply-To=20100527013849.1974.428959893.divmod.xquotient.9%40localhost.localdomain"
       TITLE="[Twisted-web] sendLine and connectionLost question">djimenez at unipost.es
       </A><BR>
    <I>Thu May 27 02:42:02 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004485.html">[Twisted-web] sendLine and connectionLost question
</A></li>
        <LI>Next message: <A HREF="004487.html">[Twisted-web] sendLine and connectionLost question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4486">[ date ]</a>
              <a href="thread.html#4486">[ thread ]</a>
              <a href="subject.html#4486">[ subject ]</a>
              <a href="author.html#4486">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Jean Paul,

A lot of thanks for your quick answer. It's really appreciated. Regarding your answer, I understand that when the remote hosts stop responding, after a timer, the connection is considered lost. But the main problem is that the remaining client (the one that have not been disconnected) should continue working without problems and the fact is that the server closes connection to that client too in a &quot;non clean fashion&quot;.

Regards and a lot of thanks for your help,

David

De: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">twisted-web-bounces at twistedmatrix.com</A> [<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">twisted-web-bounces at twistedmatrix.com</A>] En nombre de <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at twistedmatrix.com</A> [<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at twistedmatrix.com</A>]
Enviado el: jueves, 27 de mayo de 2010 3:38
Para: Twisted Web World
Asunto: Re: [Twisted-web] sendLine and connectionLost question

On 26 May, 10:46 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">djimenez at unipost.es</A> wrote:
&gt;<i>Hi all,
</I>&gt;<i>
</I>&gt;<i>I'm trying to write a typical chat server application with twisted. At
</I>&gt;<i>this moment, all is working fine except for some strange behaviour with
</I>&gt;<i>sendLine and connectionLost funcs. Let me explain the problem:
</I>&gt;<i>
</I>&gt;<i>- I have a server on the internet.
</I>&gt;<i>- I connect two PCs (2 clients) from the same LAN through a router to
</I>&gt;<i>that server
</I>&gt;<i>- All is working fine until I disconnect the LAN of one of those PC
</I>&gt;<i>(The client is disconnected but the server doesn't know about it). Just
</I>&gt;<i>to test a typical wireless disconnection without closing sockets,
</I>&gt;<i>etc...
</I>&gt;<i>- After disconnecting I try to send some messages through the remaining
</I>&gt;<i>clients to all clients through this function:
</I>&gt;<i>
</I>&gt;<i>    def sendMessageToAllClients(self, mesg,reqClient):
</I>&gt;<i>        for client in self.clientProtocols:
</I>&gt;<i>            dataLength = str(len(mesg))
</I>&gt;<i>            if (len(dataLength) &lt; 8):
</I>&gt;<i>                dif = 8 - len(dataLength)
</I>&gt;<i>                dataLength = &quot;0&quot;*dif + dataLength
</I>&gt;<i>            print &quot;Enviando a:&quot;,str(client)
</I>&gt;<i>            client.sendLine(dataLength+mesg)
</I>&gt;<i>            client.clearLineBuffer()
</I>
You shouldn't be calling `client.clearLineBuffer()` here.
&gt;<i>
</I>&gt;<i>As you can see, I send a message to all clients, including the one
</I>&gt;<i>disconnected because the server doesn't
</I>&gt;<i>know at this moment that the client is &quot;out&quot;. I'm able to send 6 or 7
</I>&gt;<i>messages to the remaining client but
</I>&gt;<i>after that, the connection get lost. I would expect to have a
</I>&gt;<i>connectionLost with the client offline but actually
</I>&gt;<i>I got a connectionLost in both clients and I don't know why. The server
</I>&gt;<i>disconnect both clients with &quot;non clean fashion&quot;.
</I>&gt;<i>
</I>&gt;<i>Any help or advice would be highly appreciated.
</I>
This is how TCP works.  If the remote host stops responding to packets,
then there's a period of time where the connection still appears to be
up anyway.  After a TCP-level timer expires, the connection is
considered lost.

Jean-Paul

_______________________________________________
Twisted-web mailing list
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
------------------------------------------------------------------------------------------------------------------------------------------------
Este mensaje es confidencial y ata&#241;e exclusivamente a las personas a las que va dirigido.
Cualquier opini&#243;n en el contenida, es exclusivo de su autor y no representa necesariamente
la opinion de UNIPOST, S.A.
Si Ud. no es el destinatario del  mensaje, considerese advertido que lo ha recibido por error
y que cualquier difusi&#243;n o copia estan terminantemente prohibidos. Si ha recibido por error, 
por favor comuniquelo a UNIPOST, S.A. al n&#250;mero +34 93 223 25 52 o correo electr&#243;nico 
a &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">support at unipost.es</A>&gt;.

This e-mail is confidential and intended solely for the use of the individual to whom it is addressed.
Any opinions presented are solely those of the author and do not necessarily represent those of 
UNIPOST, S.A.
If you are not the intended recipient, be advised that you have received this e-mail in error and that 
dissemination, forwarding or copying of this e-mail is strictly prohibited. If you have received this 
e-mail in error please notify it to UNIPOST, S.A. by telephone on number +34 93 223 25 52 or by
e-mail to &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">support at unipost.es</A>&gt;.
------------------------------------------------------------------------------------------------------------------------------------------------

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004485.html">[Twisted-web] sendLine and connectionLost question
</A></li>
	<LI>Next message: <A HREF="004487.html">[Twisted-web] sendLine and connectionLost question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4486">[ date ]</a>
              <a href="thread.html#4486">[ thread ]</a>
              <a href="subject.html#4486">[ subject ]</a>
              <a href="author.html#4486">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
