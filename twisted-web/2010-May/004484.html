<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] sendLine and connectionLost question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20sendLine%20and%20connectionLost%20question&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004483.html">
   <LINK REL="Next"  HREF="004485.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] sendLine and connectionLost question</H1>
    <B>DAVID JIMENEZ CARRASCO</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20sendLine%20and%20connectionLost%20question&In-Reply-To="
       TITLE="[Twisted-web] sendLine and connectionLost question">djimenez at unipost.es
       </A><BR>
    <I>Wed May 26 18:46:06 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004483.html">[Twisted-web] SOAPPublisher: How to work with &lt;soap:Header&gt; ?
</A></li>
        <LI>Next message: <A HREF="004485.html">[Twisted-web] sendLine and connectionLost question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4484">[ date ]</a>
              <a href="thread.html#4484">[ thread ]</a>
              <a href="subject.html#4484">[ subject ]</a>
              <a href="author.html#4484">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I'm trying to write a typical chat server application with twisted. At this moment, all is working fine except for some strange behaviour with sendLine and connectionLost funcs. Let me explain the problem:

- I have a server on the internet.
- I connect two PCs (2 clients) from the same LAN through a router to that server
- All is working fine until I disconnect the LAN of one of those PC (The client is disconnected but the server doesn't know about it). Just to test a typical wireless disconnection without closing sockets, etc...
- After disconnecting I try to send some messages through the remaining clients to all clients through this function:

    def sendMessageToAllClients(self, mesg,reqClient):
        for client in self.clientProtocols:
            dataLength = str(len(mesg))
            if (len(dataLength) &lt; 8):
                dif = 8 - len(dataLength)
                dataLength = &quot;0&quot;*dif + dataLength
            print &quot;Enviando a:&quot;,str(client)
            client.sendLine(dataLength+mesg)
            client.clearLineBuffer()

As you can see, I send a message to all clients, including the one disconnected because the server doesn't
 know at this moment that the client is &quot;out&quot;. I'm able to send 6 or 7 messages to the remaining client but
 after that, the connection get lost. I would expect to have a connectionLost with the client offline but actually
I got a connectionLost in both clients and I don't know why. The server disconnect both clients with &quot;non clean fashion&quot;.

Any help or advice would be highly appreciated.

Regards,

David


------------------------------------------------------------------------------------------------------------------------------------------------
Este mensaje es confidencial y ata&#241;e exclusivamente a las personas a las que va dirigido.
Cualquier opini&#243;n en el contenida, es exclusivo de su autor y no representa necesariamente
la opinion de UNIPOST, S.A.
Si Ud. no es el destinatario del  mensaje, considerese advertido que lo ha recibido por error
y que cualquier difusi&#243;n o copia estan terminantemente prohibidos. Si ha recibido por error, 
por favor comuniquelo a UNIPOST, S.A. al n&#250;mero +34 93 223 25 52 o correo electr&#243;nico 
a &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">support at unipost.es</A>&gt;.

This e-mail is confidential and intended solely for the use of the individual to whom it is addressed.
Any opinions presented are solely those of the author and do not necessarily represent those of 
UNIPOST, S.A.
If you are not the intended recipient, be advised that you have received this e-mail in error and that 
dissemination, forwarding or copying of this e-mail is strictly prohibited. If you have received this 
e-mail in error please notify it to UNIPOST, S.A. by telephone on number +34 93 223 25 52 or by
e-mail to &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">support at unipost.es</A>&gt;.
------------------------------------------------------------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20100527/5d747dc4/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20100527/5d747dc4/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004483.html">[Twisted-web] SOAPPublisher: How to work with &lt;soap:Header&gt; ?
</A></li>
	<LI>Next message: <A HREF="004485.html">[Twisted-web] sendLine and connectionLost question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4484">[ date ]</a>
              <a href="thread.html#4484">[ thread ]</a>
              <a href="subject.html#4484">[ subject ]</a>
              <a href="author.html#4484">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
