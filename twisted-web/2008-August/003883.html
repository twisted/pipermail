<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] newbie question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20newbie%20question&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003882.html">
   <LINK REL="Next"  HREF="003886.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] newbie question</H1>
    <B>arun chhetri</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20newbie%20question&In-Reply-To="
       TITLE="[Twisted-web] newbie question">uhcops at gmail.com
       </A><BR>
    <I>Fri Aug 15 18:24:51 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003882.html">[Twisted-web] How to specify cach-control,
	Expires headers for the static files response
</A></li>
        <LI>Next message: <A HREF="003886.html">[Twisted-web] newbie question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3883">[ date ]</a>
              <a href="thread.html#3883">[ thread ]</a>
              <a href="subject.html#3883">[ subject ]</a>
              <a href="author.html#3883">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi,
 I have developed some twisted.web application. It connects to the other
server (CalDav) and then it displays back using twisted.web.
My problem is when a user logs into my website which is made using
twisted.web there is some data fetched from CALDAV server. When another user
logs into my website, even his data is downloaded from CalDav server but
this data overwrites the data of previous server. I think I am not able to
fork the process on each request. This is my just guess.

The Code is given below

from twisted.web import resource, static, server
import vobject
import calendarWebUtilities
import Calendar
import datetime
import re,calendar
import Month
import Week
import Day
import socket


class HomePage(resource.Resource):
    def render(self,request):
        return&quot;&quot;&quot;
    &lt;html&gt;
    &lt;head&gt;
    &lt;title&gt;VCalendar&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;form action=3D/optional method=3D&quot;post&quot;&gt;
        User Name &lt;input type=3D&quot;text&quot; name=3D&quot;username&quot;&gt;&lt;br/&gt;
        Pass Word &lt;input type=3D&quot;password&quot; name=3D&quot;pswd&quot;&gt;&lt;br/&gt;
        ServerAdd &lt;input type=3D&quot;text&quot; name=3D&quot;server&quot;&gt;&lt;br/&gt;
        &lt;input type=3D&quot;submit&quot; Value=3D&quot;Submit&quot;&gt;&lt;br/&gt;
    &lt;/form&gt;
    &lt;/body&gt;
    &lt;/html&gt;&quot;&quot;&quot;


class Optional(resource.Resource):
    def __init__(self):
        resource.Resource.__init__(self)
        self.CalendarData =3D {}
        self.account =3D {}
    def render(self,request):
        user =3D request.args[&quot;username&quot;]
        pswd =3D request.args[&quot;pswd&quot;]
        server =3D request.args[&quot;server&quot;]
        if user !=3D None:
            if pswd !=3D None:
                if server !=3D None:
                    CalendarSource =3D None
                    CalendarSource =3D
Calendar.CalendarObject(user[0],pswd[0],server[0])
                    todayDate =3D datetime.datetime.now()
                    start =3D
datetime.datetime((todayDate.year-1),01,01,00,00)
                    end =3D
datetime.datetime((todayDate.year+1),12,31,23,59,59)
                    self.CalendarData['value'] =3D
CalendarSource.readCalendarComponent(start,end)
                    self.account['value'] =3D CalendarSource
                    self.index =3D 1
        request.redirect(&quot;/optional/Calendar&quot;)
        return &quot; &quot;

   def getChild(self,path,request):
        return MainCalendar(self.index,self.CalendarData,self.account)



class MainCalendar(resource.Resource):
    def __init__(self,index,CalendarData,account):
        resource.Resource.__init__(self)
        self.index =3D index
        self.CalendarData =3D CalendarData
        self.account =3D account

self.putChild('Add',AddCalendarComponent(self.CalendarData,self.account))

    def render(self,request):
        global Calendarata
        global account
        if request.path =3D=3D &quot;/optional/Calendar&quot; :
            request.redirect(&quot;/optional/Calendar/Month&quot;)
            return &quot; &quot;



    def getChild(self,path,request):
        if request.path =3D=3D &quot;/optional/Calendar/Month&quot;:
            return Month.month(self.CalendarData,self.index)
        elif request.path =3D=3D &quot;/optional/Calendar/Week&quot;:
            return Week.Week(self.CalendarData,self.index)
        elif request.path =3D=3D &quot;/optional/Calendar/Day&quot;:
            return Day.Day(self.CalendarData,self.index)


class AddCalendarComponent(resource.Resource):
    def __init__(self,CalendarData,account):
        resource.Resource.__init__(self)
        self.CalendarData =3D CalendarData
        self.account =3D account

    def render (self,request):
        #if request.args !=3D None:
        queryString =3D len(request.args)
        if queryString !=3D0:
            try :
                summary1 =3D request.args['summary']
                location1 =3D request.args['location']
                startDate1 =3D request.args['startDate']
                endDate1 =3D request.args['endDate']
                CalendarSource =3D self.account['value']
                event =3D
CalendarSource.convertToProperFormatAndAddToCalendar(summary1,location1,sta=
rtDate1,endDate1)
                (self.CalendarData['value']).append(event)
                #CalendarData =3D {}
                #print &quot;New Data Created&quot;
                #print NewCalendar
                #CalendarData['value'] =3D NewCalendar
                request.redirect(&quot;/optional/Calendar&quot;)
                return &quot; &quot;
            except KeyError:
                request.args =3D {}
                request.redirect('/optional/Calendar/Month/Add')
        else:
            return&quot;&quot;&quot;
        &lt;html&gt;
        &lt;head&gt;
        &lt;/head&gt;
        &lt;body&gt;

        &lt;form action=3D&quot;/optional/Calendar/Add&quot; method=3D&quot;post&quot;&gt;
        Summary =3D &lt;INPUT type=3D&quot;text&quot; name=3D&quot;summary&quot;&gt;&lt;/br&gt;
        Location =3D &lt;input type=3D&quot;text&quot; name=3D&quot;location&quot;&gt;&lt;/br&gt;
        Start Date =3D &lt;input type=3D&quot;text&quot; name=3D&quot;startDate&quot;&gt;Should Be in=
 format
year/MM/date/HH/MM&lt;/br&gt;
        End Date =3D &lt;input type=3D&quot;text&quot; name=3D&quot;endDate&quot;&gt;Should Be in for=
mat
year/MM/date/HH/MM&lt;/br&gt;
        &lt;input type=3D&quot;submit&quot;&gt;
        &lt;/form&gt;
        &lt;/body&gt;
        &lt;/html&gt;
        &quot;&quot;&quot;




if __name__ =3D=3D &quot;__main__&quot;:
    from twisted.internet import reactor
    root =3D resource.Resource()
    root.putChild('',HomePage())
    root.putChild('optional',Optional())
    site =3D server.Site(root)
    reactor.listenTCP(8000,site)
    reactor.run()

I can guess there should be some method by which I can fork the root for
different request,, Please help.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20080815/c2=">http://twistedmatrix.com/pipermail/twisted-web/attachments/20080815/c2=</A>
37d582/attachment.htm
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003882.html">[Twisted-web] How to specify cach-control,
	Expires headers for the static files response
</A></li>
	<LI>Next message: <A HREF="003886.html">[Twisted-web] newbie question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3883">[ date ]</a>
              <a href="thread.html#3883">[ thread ]</a>
              <a href="subject.html#3883">[ subject ]</a>
              <a href="author.html#3883">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
