<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] newbie question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20newbie%20question&In-Reply-To=560daff30808151524j70bfde1o9bdbb27b2b00f0d3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003883.html">
   <LINK REL="Next"  HREF="003887.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] newbie question</H1>
    <B>Graeme Glass</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20newbie%20question&In-Reply-To=560daff30808151524j70bfde1o9bdbb27b2b00f0d3%40mail.gmail.com"
       TITLE="[Twisted-web] newbie question">graemeglass at gmail.com
       </A><BR>
    <I>Sat Aug 16 17:46:05 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003883.html">[Twisted-web] newbie question
</A></li>
        <LI>Next message: <A HREF="003887.html">[Twisted-web] newbie question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3886">[ date ]</a>
              <a href="thread.html#3886">[ thread ]</a>
              <a href="subject.html#3886">[ subject ]</a>
              <a href="author.html#3886">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Aug 16, 2008 at 12:24 AM, arun chhetri &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">uhcops at gmail.com</A>&gt; wrote:

&gt;<i> hi,
</I>&gt;<i>  I have developed some twisted.web application. It connects to the other
</I>&gt;<i> server (CalDav) and then it displays back using twisted.web.
</I>&gt;<i> My problem is when a user logs into my website which is made using
</I>&gt;<i> twisted.web there is some data fetched from CALDAV server. When another u=
</I>ser
&gt;<i> logs into my website, even his data is downloaded from CalDav server but
</I>&gt;<i> this data overwrites the data of previous server. I think I am not able to
</I>&gt;<i> fork the process on each request. This is my just guess.
</I>&gt;<i>
</I>&gt;<i> The Code is given below
</I>&gt;<i>
</I>&gt;<i> from twisted.web import resource, static, server
</I>&gt;<i> import vobject
</I>&gt;<i> import calendarWebUtilities
</I>&gt;<i> import Calendar
</I>&gt;<i> import datetime
</I>&gt;<i> import re,calendar
</I>&gt;<i> import Month
</I>&gt;<i> import Week
</I>&gt;<i> import Day
</I>&gt;<i> import socket
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class HomePage(resource.Resource):
</I>&gt;<i>     def render(self,request):
</I>&gt;<i>         return&quot;&quot;&quot;
</I>&gt;<i>     &lt;html&gt;
</I>&gt;<i>     &lt;head&gt;
</I>&gt;<i>     &lt;title&gt;VCalendar&lt;/title&gt;
</I>&gt;<i>     &lt;/head&gt;
</I>&gt;<i>     &lt;body&gt;
</I>&gt;<i>     &lt;form action=3D/optional method=3D&quot;post&quot;&gt;
</I>&gt;<i>         User Name &lt;input type=3D&quot;text&quot; name=3D&quot;username&quot;&gt;&lt;br/&gt;
</I>&gt;<i>         Pass Word &lt;input type=3D&quot;password&quot; name=3D&quot;pswd&quot;&gt;&lt;br/&gt;
</I>&gt;<i>         ServerAdd &lt;input type=3D&quot;text&quot; name=3D&quot;server&quot;&gt;&lt;br/&gt;
</I>&gt;<i>         &lt;input type=3D&quot;submit&quot; Value=3D&quot;Submit&quot;&gt;&lt;br/&gt;
</I>&gt;<i>     &lt;/form&gt;
</I>&gt;<i>     &lt;/body&gt;
</I>&gt;<i>     &lt;/html&gt;&quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class Optional(resource.Resource):
</I>&gt;<i>     def __init__(self):
</I>&gt;<i>         resource.Resource.__init__(self)
</I>&gt;<i>         self.CalendarData =3D {}
</I>&gt;<i>         self.account =3D {}
</I>&gt;<i>     def render(self,request):
</I>&gt;<i>         user =3D request.args[&quot;username&quot;]
</I>&gt;<i>         pswd =3D request.args[&quot;pswd&quot;]
</I>&gt;<i>         server =3D request.args[&quot;server&quot;]
</I>&gt;<i>         if user !=3D None:
</I>&gt;<i>             if pswd !=3D None:
</I>&gt;<i>                 if server !=3D None:
</I>&gt;<i>                     CalendarSource =3D None
</I>&gt;<i>                     CalendarSource =3D
</I>&gt;<i> Calendar.CalendarObject(user[0],pswd[0],server[0])
</I>&gt;<i>                     todayDate =3D datetime.datetime.now()
</I>&gt;<i>                     start =3D
</I>&gt;<i> datetime.datetime((todayDate.year-1),01,01,00,00)
</I>&gt;<i>                     end =3D
</I>&gt;<i> datetime.datetime((todayDate.year+1),12,31,23,59,59)
</I>&gt;<i>                     self.CalendarData['value'] =3D
</I>&gt;<i> CalendarSource.readCalendarComponent(start,end)
</I>&gt;<i>                     self.account['value'] =3D CalendarSource
</I>&gt;<i>                     self.index =3D 1
</I>&gt;<i>         request.redirect(&quot;/optional/Calendar&quot;)
</I>&gt;<i>         return &quot; &quot;
</I>&gt;<i>
</I>&gt;<i>    def getChild(self,path,request):
</I>&gt;<i>         return MainCalendar(self.index,self.CalendarData,self.account)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class MainCalendar(resource.Resource):
</I>&gt;<i>     def __init__(self,index,CalendarData,account):
</I>&gt;<i>         resource.Resource.__init__(self)
</I>&gt;<i>         self.index =3D index
</I>&gt;<i>         self.CalendarData =3D CalendarData
</I>&gt;<i>         self.account =3D account
</I>&gt;<i>
</I>&gt;<i> self.putChild('Add',AddCalendarComponent(self.CalendarData,self.account))
</I>&gt;<i>
</I>&gt;<i>     def render(self,request):
</I>&gt;<i>         global Calendarata
</I>&gt;<i>         global account
</I>&gt;<i>         if request.path =3D=3D &quot;/optional/Calendar&quot; :
</I>&gt;<i>             request.redirect(&quot;/optional/Calendar/Month&quot;)
</I>&gt;<i>             return &quot; &quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     def getChild(self,path,request):
</I>&gt;<i>         if request.path =3D=3D &quot;/optional/Calendar/Month&quot;:
</I>&gt;<i>             return Month.month(self.CalendarData,self.index)
</I>&gt;<i>         elif request.path =3D=3D &quot;/optional/Calendar/Week&quot;:
</I>&gt;<i>             return Week.Week(self.CalendarData,self.index)
</I>&gt;<i>         elif request.path =3D=3D &quot;/optional/Calendar/Day&quot;:
</I>&gt;<i>             return Day.Day(self.CalendarData,self.index)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> class AddCalendarComponent(resource.Resource):
</I>&gt;<i>     def __init__(self,CalendarData,account):
</I>&gt;<i>         resource.Resource.__init__(self)
</I>&gt;<i>         self.CalendarData =3D CalendarData
</I>&gt;<i>         self.account =3D account
</I>&gt;<i>
</I>&gt;<i>     def render (self,request):
</I>&gt;<i>         #if request.args !=3D None:
</I>&gt;<i>         queryString =3D len(request.args)
</I>&gt;<i>         if queryString !=3D0:
</I>&gt;<i>             try :
</I>&gt;<i>                 summary1 =3D request.args['summary']
</I>&gt;<i>                 location1 =3D request.args['location']
</I>&gt;<i>                 startDate1 =3D request.args['startDate']
</I>&gt;<i>                 endDate1 =3D request.args['endDate']
</I>&gt;<i>                 CalendarSource =3D self.account['value']
</I>&gt;<i>                 event =3D
</I>&gt;<i> CalendarSource.convertToProperFormatAndAddToCalendar(summary1,location1,s=
</I>tartDate1,endDate1)
&gt;<i>                 (self.CalendarData['value']).append(event)
</I>&gt;<i>                 #CalendarData =3D {}
</I>&gt;<i>                 #print &quot;New Data Created&quot;
</I>&gt;<i>                 #print NewCalendar
</I>&gt;<i>                 #CalendarData['value'] =3D NewCalendar
</I>&gt;<i>                 request.redirect(&quot;/optional/Calendar&quot;)
</I>&gt;<i>                 return &quot; &quot;
</I>&gt;<i>             except KeyError:
</I>&gt;<i>                 request.args =3D {}
</I>&gt;<i>                 request.redirect('/optional/Calendar/Month/Add')
</I>&gt;<i>         else:
</I>&gt;<i>             return&quot;&quot;&quot;
</I>&gt;<i>         &lt;html&gt;
</I>&gt;<i>         &lt;head&gt;
</I>&gt;<i>         &lt;/head&gt;
</I>&gt;<i>         &lt;body&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;form action=3D&quot;/optional/Calendar/Add&quot; method=3D&quot;post&quot;&gt;
</I>&gt;<i>         Summary =3D &lt;INPUT type=3D&quot;text&quot; name=3D&quot;summary&quot;&gt;&lt;/br&gt;
</I>&gt;<i>         Location =3D &lt;input type=3D&quot;text&quot; name=3D&quot;location&quot;&gt;&lt;/br&gt;
</I>&gt;<i>         Start Date =3D &lt;input type=3D&quot;text&quot; name=3D&quot;startDate&quot;&gt;Should Be =
</I>in
&gt;<i> format year/MM/date/HH/MM&lt;/br&gt;
</I>&gt;<i>         End Date =3D &lt;input type=3D&quot;text&quot; name=3D&quot;endDate&quot;&gt;Should Be in f=
</I>ormat
&gt;<i> year/MM/date/HH/MM&lt;/br&gt;
</I>&gt;<i>         &lt;input type=3D&quot;submit&quot;&gt;
</I>&gt;<i>         &lt;/form&gt;
</I>&gt;<i>         &lt;/body&gt;
</I>&gt;<i>         &lt;/html&gt;
</I>&gt;<i>         &quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> if __name__ =3D=3D &quot;__main__&quot;:
</I>&gt;<i>     from twisted.internet import reactor
</I>&gt;<i>     root =3D resource.Resource()
</I>&gt;<i>     root.putChild('',HomePage())
</I>&gt;<i>     root.putChild('optional',Optional())
</I>&gt;<i>     site =3D server.Site(root)
</I>&gt;<i>     reactor.listenTCP(8000,site)
</I>&gt;<i>     reactor.run()
</I>&gt;<i>
</I>&gt;<i> I can guess there should be some method by which I can fork the root for
</I>&gt;<i> different request,, Please help.
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>&gt;<i>
</I>&gt;<i>
</I>Try using a factory for your session storage instead of storing it in the
actually resource, that way you will be able to access your session
information from the resources without overriding it on every request. Take
a look at twisted.internet.protocol.ServerFactory.

HTH

G
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20080816/67=">http://twistedmatrix.com/pipermail/twisted-web/attachments/20080816/67=</A>
275c6d/attachment.htm
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003883.html">[Twisted-web] newbie question
</A></li>
	<LI>Next message: <A HREF="003887.html">[Twisted-web] newbie question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3886">[ date ]</a>
              <a href="thread.html#3886">[ thread ]</a>
              <a href="subject.html#3886">[ subject ]</a>
              <a href="author.html#3886">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
