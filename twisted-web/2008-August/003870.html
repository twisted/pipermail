<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: Setting up a project.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Setting%20up%20a%20project.&In-Reply-To=m2iquef750.fsf%40valheru.db3l.homeip.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003867.html">
   <LINK REL="Next"  HREF="003872.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: Setting up a project.</H1>
    <B>Govind Salinas</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Setting%20up%20a%20project.&In-Reply-To=m2iquef750.fsf%40valheru.db3l.homeip.net"
       TITLE="[Twisted-web] Re: Setting up a project.">blix at sophiasuchtig.com
       </A><BR>
    <I>Wed Aug  6 17:40:49 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003867.html">[Twisted-web] Re: Setting up a project.
</A></li>
        <LI>Next message: <A HREF="003872.html">[Twisted-web] Re: Setting up a project.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3870">[ date ]</a>
              <a href="thread.html#3870">[ thread ]</a>
              <a href="subject.html#3870">[ subject ]</a>
              <a href="author.html#3870">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Aug 6, 2008 at 11:19 AM, David Bolen &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">db3l.net at gmail.com</A>&gt; wrote:
&gt;<i> &quot;Govind Salinas&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">blix at sophiasuchtig.com</A>&gt; writes:
</I>&gt;<i>
</I> -- snip
&gt;&gt;<i> Let me give you some information about the set up I have .  Basically
</I>&gt;&gt;<i> I have a python program running somewhere.  I will have a default set
</I>&gt;&gt;<i> of files that serve the content a particular way.  The default set
</I>&gt;&gt;<i> will contain mako templates[1], style sheets and perhaps some images.
</I>&gt;&gt;<i> So I need a way to kick off the mako templates based on the URL.  The
</I>&gt;&gt;<i> templates may include each other.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the layout
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> content-dir/
</I>&gt;&gt;<i>    __config__.py -- This is a file that currently just sets up the mapping
</I>&gt;&gt;<i>                             between a regex that selects a page and a path to
</I>&gt;&gt;<i>                             where that page's template is under the content-dir
</I>&gt;&gt;<i>    main.html -- The html files here are really the mako templates
</I>&gt;&gt;<i>    main.css
</I>&gt;&gt;<i>    etc...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My server class takes in a template dir, loads the config and starts a
</I>&gt;&gt;<i> server.  When it gets a request it matches it against the regexes and
</I>&gt;&gt;<i> runs the template.  There should be some initialization that sets up
</I>&gt;&gt;<i> objects that get passed to the template (in addition to values from
</I>&gt;&gt;<i> the regex parsing). This is all pretty brain-dead code.
</I>&gt;<i>
</I>&gt;<i> Are you saying &quot;brain-dead&quot; in a negative way here, or to imply that
</I>&gt;<i> it's boilerplate or something you'd prefer the framework do for you?
</I>&gt;<i> With twisted.web, you're pretty much in charge of this sort of stuff.
</I>
I was referring to the code I was writing.  I guess I would consider it
boiler plate.  I think some more complete examples in the howto
would have helped me here.  I seemed to get the gist of what
resources were supposed to do, but wasn't sure how to put
it all together.

&gt;<i> I think you've pretty much hit most of the items you need to cover.
</I>&gt;<i>
</I>&gt;<i> For URL traversal, it's not clear from your description if you are
</I>&gt;<i> using the regex mapping to also find the Resource object or just for
</I>&gt;<i> template lookups by the Resource objects.  Either approach is fine.
</I>&gt;<i> Twisted.web itself will traverse a URL by following the chain of
</I>&gt;<i> Resource objects and their children.  This can be much more dynamic
</I>&gt;<i> than a fixed URL-&gt;object mapping definition since the Resources can be
</I>&gt;<i> created on the fly when needed.  If your Resource tree is static, then
</I>&gt;<i> a fixed mapping is fine too.
</I>
I had tried using Django for what I was doing but I did not sure if it
would end up as a nice fit.  When I started using twisted, I borrowed
the regex-&gt;page mapping from them.  This is how I implemented it:

    def _parse_setup(self, path):
        self._config = {}
        execfile(path, {}, self._config)
        if 'url_map' not in self._config:
            return False
        self._mappings = []
        for exp, f in self._config['url_map']:
            f = f.split('/')
            f.insert(0, self._template_dir)
            f = os.path.join(*f)
            self._mappings.append((re.compile(exp), f))
        return True

    def render_GET(self, request):
        path = request.path[1:]
        uri = request.uri[1:]
        for mapping, f in self._mappings:
            match = mapping.match(uri)
            if match:
                vars = match.groupdict()
                print 'serving:', f
                lookup = TemplateLookup(directories=['/'])
                return Template(filename=f, lookup=lookup).render(**vars)
        path = os.path.join(self._template_dir, path)
        if os.path.isfile(path):
            f = None
            try:
                idx = path.rfind('.')
                print 'serving static:', path, path[idx + 1:]
                type = _mime_types.get(path[idx + 1:], 'text/plain')
                request.setHeader('content-type', type)
                print request.headers, type
                f = file(path, 'r')
                return f.read()
            except:
                print 'failed to serve:', path
                raise
            finally:
                if f:
                    f.close()
        else:
            print '%s does not exist' % path
        request.setResponseCode(404)
        return self._page_not_found

I was not too clear on how the resources would be used, so I chose
this.  And the files/paths are all static, even if the content is not.
One of the things I want to be able to do is allow the user to have
a choice between templates or be able to write their own.  The url
mapping seemed like a good way of soft coding that so that a
different template could organize their code differently.

&gt;<i> Generally what I've done in the past is build up the fixed portion of
</I>&gt;<i> my Resource tree during server initialization.  My Resource classes
</I>&gt;<i> have internal definitions for their template name (as a relative path
</I>&gt;<i> when using directories of templates) and are just handed the template
</I>&gt;<i> loader during construction, which they later use for rendering.  The
</I>&gt;<i> template loader is given the template root directory at
</I>&gt;<i> initialization.  The trade-off with your regex mapping is that you
</I>&gt;<i> have to keep two fairly separate bits of code in sync, where I have
</I>&gt;<i> the template information inside the object definition, but in my case
</I>&gt;<i> it can also be more work to get a global view of template assignments.
</I>&gt;<i>
</I>&gt;<i> In terms of your question on static files (css/images/js), I just
</I>&gt;<i> place those into their own sub-tree and then defined a static.File()
</I>&gt;<i> object to serve them.  This also has an advantage that if you place
</I>&gt;<i> your server behind, say, Apache, in production use, you can define
</I>&gt;<i> rules on the Apache side to let it directly serve the static files and
</I>&gt;<i> never involve your code, for some improved efficiency.
</I>
That sounds like a good idea, I will do that.

&gt;<i> Another area that you may need to implement your own support would be
</I>&gt;<i> for handling authorization (twisted.web provides support for managing
</I>&gt;<i> sessions via cookies, but you have to decide when to render an
</I>&gt;<i> authentication page and then store any needed authentication
</I>&gt;<i> information in the session).
</I>
I have no use for that yet.  However I will eventually need to do http
and/or ssh authentication (the ability to POST updates to the
repository is a planned feature).  So this will come in handy.

&gt;&gt;<i> I was hoping for some guidance on a better strategy for doing this.
</I>&gt;&gt;<i> Any help would be appreciated.  Bonus points if it is something that
</I>&gt;&gt;<i> could easily be re-used on another webserver if someone wanted to host
</I>&gt;&gt;<i> this on an existing website.
</I>&gt;<i>
</I>&gt;<i> I think you need to help defined what parts of the above you perceive
</I>&gt;<i> as needing to be &quot;better&quot;.  I've implemented several servers (many of
</I>&gt;<i> which were embedded in a larger application) using the above approach
</I>&gt;<i> and it seems just fine to me.  As to re-usability, that's pretty much
</I>&gt;<i> the same question for any code you write - e.g., if you're doing
</I>&gt;<i> authentication support, making it reusable is pretty much the same as
</I>&gt;<i> making any other piece of code reusable.
</I>&gt;<i>
</I>&gt;<i> If you're looking for a higher level framework approach (much more
</I>&gt;<i> functionality &quot;for free&quot;), then twisted.web itself may not be the
</I>&gt;<i> ideal solution for you.  In the twisted world, nevow may provide a bit
</I>&gt;<i> more of what you're looking for, and of course there are other high
</I>&gt;<i> profile high-level web frameworks like django, turbogears, pylons, etc...
</I>&gt;<i>
</I>I took a quick look at nevow and I think I like the mako templates
better.  It behaves more that a &quot;python server pages&quot; type of
template, which is conceptually similar to the little web programming
that I have done in the past.

--snip
&gt;<i> As a more concrete example, here are some snippets of one of my recent
</I>&gt;<i> web server modules (in commercial use for the past year or so).  Note
</I>&gt;<i> this is a straight cut 'n paste, so there's various logic in addition
</I>&gt;<i> to the pure web processing, and probably references to functions/objects
</I>&gt;<i> that won't fully be explained.
</I>&gt;<i>
</I>
-- snip

&gt;<i> Hope there's not too much &quot;noise&quot; in the code to prevent it from being
</I>&gt;<i> helpful.
</I>&gt;<i>
</I>
Actually that was perfect, I have a much better understanding of how things
are supposed to work now.  I appreciate the help.

Thanks,
Govind.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003867.html">[Twisted-web] Re: Setting up a project.
</A></li>
	<LI>Next message: <A HREF="003872.html">[Twisted-web] Re: Setting up a project.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3870">[ date ]</a>
              <a href="thread.html#3870">[ thread ]</a>
              <a href="subject.html#3870">[ subject ]</a>
              <a href="author.html#3870">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
