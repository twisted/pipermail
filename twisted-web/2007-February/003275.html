<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Are twisted xmlrpc calls non-blocking?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Are%20twisted%20xmlrpc%20calls%20non-blocking%3F&In-Reply-To=45CB2970.3030700%40smartology.nl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003274.html">
   <LINK REL="Next"  HREF="003278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Are twisted xmlrpc calls non-blocking?</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Are%20twisted%20xmlrpc%20calls%20non-blocking%3F&In-Reply-To=45CB2970.3030700%40smartology.nl"
       TITLE="[Twisted-web] Are twisted xmlrpc calls non-blocking?">exarkun at divmod.com
       </A><BR>
    <I>Thu Feb  8 08:58:35 CST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003274.html">[Twisted-web] Are twisted xmlrpc calls non-blocking?
</A></li>
        <LI>Next message: <A HREF="003278.html">[Twisted-web] web client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3275">[ date ]</a>
              <a href="thread.html#3275">[ thread ]</a>
              <a href="subject.html#3275">[ subject ]</a>
              <a href="author.html#3275">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 08 Feb 2007 14:45:20 +0100, Remi Cool &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">mailinglists at smartology.nl</A>&gt; wrote:
&gt;<i>Jean-Paul Calderone wrote:
</I>&gt;&gt;<i> On Thu, 08 Feb 2007 13:31:27 +0100, Remi Cool
</I>&gt;&gt;<i> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">mailinglists at smartology.nl</A>&gt; wrote:
</I>&gt;<i> [snip]
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I tend to think not, because when I call a method with a 5 sec delay
</I>&gt;&gt;&gt;<i> from a &quot;runInteraction&quot; thread, the thread returns when it handled the
</I>&gt;&gt;&gt;<i> call. This is how I prefer it in this case, but when I want to use the
</I>&gt;&gt;&gt;<i> xmlrpcCall method from a non &quot;runInteraction&quot; call, do I need to wrap it
</I>&gt;&gt;&gt;<i> up in a thread myself?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Oops!  You _can't_ do that.  Twisted APIs must be invoked from the
</I>&gt;&gt;<i> reactor
</I>&gt;&gt;<i> thread.  They don't work in any other thread.
</I>&gt;&gt;<i>
</I>&gt;<i>Let me explain:
</I>&gt;<i>
</I>&gt;<i>a user calls the xml-rpc method &quot;init&quot; on my twisted xmlrpc server like:
</I>&gt;<i>
</I>&gt;<i>xmlrpc_init(self):
</I>&gt;<i>    &quot;&quot;&quot;&quot;&quot;&quot;
</I>&gt;<i>    return self.service.connPool.runInteraction(myInit, self.service)
</I>&gt;<i>
</I>&gt;<i>The myInit function has to fetch some data from the database and from a
</I>&gt;<i>remote xml-rpc server.
</I>&gt;<i>So ... first I get the data from the database , print a log line ...
</I>&gt;<i>call the service.xmlrpcCall method ... and print another log line.
</I>&gt;<i>
</I>&gt;<i>The method on the remote xml-rpc server delays 5 secs, prints a log line
</I>&gt;<i>and then sends back a string.
</I>&gt;<i>The log lines are in the right order.  But you say the xmlrcpCall method
</I>&gt;<i>doesn't block?
</I>
It doesn't block, but it doesn't work very well, since it uses Twisted APIs
from a non-reactor thread.  The 5 seconds are probably just spent idling,
and then some unrelated event wakes up the reactor, at which point it then
notices that you asked it to do something, and does it.

&gt;<i>
</I>&gt;<i>So if I understand correctly, I can't use any twisted api's in threads,
</I>&gt;<i>even if they are created with threads.deferToThread?
</I>
Correct.  You can call back into the reactor thread, though.  See the
callFromThread method of the reactor.

Jean-Paul

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003274.html">[Twisted-web] Are twisted xmlrpc calls non-blocking?
</A></li>
	<LI>Next message: <A HREF="003278.html">[Twisted-web] web client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3275">[ date ]</a>
              <a href="thread.html#3275">[ thread ]</a>
              <a href="subject.html#3275">[ subject ]</a>
              <a href="author.html#3275">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
