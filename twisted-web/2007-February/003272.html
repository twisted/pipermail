<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Confused about XML-RPC Unicode behaviour (examples
	attached).
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Confused%20about%20XML-RPC%20Unicode%20behaviour%20%28examples%0A%09attached%29.&In-Reply-To=200702072041.41786.iacovou%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003271.html">
   <LINK REL="Next"  HREF="003276.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Confused about XML-RPC Unicode behaviour (examples
	attached).</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Confused%20about%20XML-RPC%20Unicode%20behaviour%20%28examples%0A%09attached%29.&In-Reply-To=200702072041.41786.iacovou%40gmail.com"
       TITLE="[Twisted-web] Confused about XML-RPC Unicode behaviour (examples
	attached).">exarkun at divmod.com
       </A><BR>
    <I>Wed Feb  7 12:53:50 CST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003271.html">[Twisted-web] Confused about XML-RPC Unicode behaviour (examples
	attached).
</A></li>
        <LI>Next message: <A HREF="003276.html">[Twisted-web] Confused about XML-RPC Unicode behaviour (examples
	attached).
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3272">[ date ]</a>
              <a href="thread.html#3272">[ thread ]</a>
              <a href="subject.html#3272">[ subject ]</a>
              <a href="author.html#3272">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 7 Feb 2007 20:41:41 +0200, kgi &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">iacovou at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>Hi all.
</I>&gt;<i>
</I>&gt;<i>I've got a bunch of Twisted XML-RPC servers that serve up a wide range of data
</I>&gt;<i>types include dates. Up until now I've had some hacky code to protect against
</I>&gt;<i>bad data types being returned to the serialization layer (Nones, unicodes,
</I>&gt;<i>etc). However, this code turns out to be difficult to maintain, as well as
</I>&gt;<i>being a modest performance hit.
</I>&gt;<i>
</I>&gt;<i>I thought I see if I couldn't clean up some of the code to make it simpler and
</I>&gt;<i>less hacky, and I found something rather odd: a Twisted XML-RPC server
</I>&gt;<i>seemingly can't return a xmlrpc.DateTime object it has only just received
</I>&gt;<i>from the deserialization layer.
</I>&gt;<i>
</I>&gt;<i>I've attached a test client, using Twisted, and two test servers, one using
</I>&gt;<i>Twisted, one using the standard library's SimpleXMLRPCServer.
</I>&gt;<i>
</I>&gt;<i>The standard library version succeeds in returning the received
</I>&gt;<i>xmlrpclib.DateTime unmolested; the Twisted version complains about the
</I>&gt;<i>message containing unicode:
</I>&gt;<i>
</I>&gt;<i>     File &quot;/usr/lib/python2.4/site-packages/twisted/internet/abstract.py&quot;,line
</I>&gt;<i>173, in write
</I>&gt;<i>            raise TypeError(&quot;Data must not be unicode&quot;)
</I>&gt;<i>        exceptions.TypeError: Data must not be unicode
</I>&gt;<i>
</I>&gt;<i>This seems wrong: surely, at the very least, the serialization and
</I>&gt;<i>deserialization should allow a round-trip unmodified? Put a slightly
</I>&gt;<i>different way: I don't have a fundamental problem with the restriction that
</I>&gt;<i>return types not include unicode, but surely in that case, the same system
</I>&gt;<i>that enforces this should see to it that I don't receive such a type in the
</I>&gt;<i>first place (given that the original data type I created in the client was a
</I>&gt;<i>xmlrpclib.DateTime, which is explicitly designed for serialising over
</I>&gt;<i>XML-RPC!).
</I>&gt;<i>
</I>&gt;<i>Are there technical/historical/political reasons for this of which I know
</I>&gt;<i>nothing?
</I>
Nope, it's probably just a bug.  It looks like it may be a bug in the
xmlrpclib module, though.  Consider this interaction:

<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at charm</A>:~$ python
Python 2.4.3 (#2, Oct  6 2006, 07:52:30)
[GCC 4.0.3 (Ubuntu 4.0.3-1ubuntu5)] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;<i> import xmlrpclib
</I>&gt;&gt;&gt;<i> d1 = xmlrpclib.DateTime()
</I>&gt;&gt;&gt;<i> d1
</I>&lt;DateTime '20070207T13:51:36' at -482e1234&gt;
&gt;&gt;&gt;<i> s = xmlrpclib.dumps((d1,))
</I>&gt;&gt;&gt;<i> s
</I>'&lt;params&gt;\n&lt;param&gt;\n&lt;value&gt;&lt;dateTime.iso8601&gt;20070207T13:51:36&lt;/dateTime.iso8601&gt;&lt;/value&gt;\n&lt;/param&gt;\n&lt;/params&gt;\n'
&gt;&gt;&gt;<i> d2 = xmlrpclib.loads(s)[0][0]
</I>&gt;&gt;&gt;<i> d2
</I>&lt;DateTime u'20070207T13:51:36' at -482ddab4&gt;
&gt;&gt;&gt;<i> xmlrpclib.dumps((d2,))
</I>u'&lt;params&gt;\n&lt;param&gt;\n&lt;value&gt;&lt;dateTime.iso8601&gt;20070207T13:51:36&lt;/dateTime.iso8601&gt;&lt;/value&gt;\n&lt;/param&gt;\n&lt;/params&gt;\n'
&gt;&gt;&gt;<i>                                                                                          
</I>
Twisted can probably work around the bug here, though.  It would be useful
if you could file a ticket in the tracker for this (one in Twisted's and
one in Python's).

Jean-Paul

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003271.html">[Twisted-web] Confused about XML-RPC Unicode behaviour (examples
	attached).
</A></li>
	<LI>Next message: <A HREF="003276.html">[Twisted-web] Confused about XML-RPC Unicode behaviour (examples
	attached).
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3272">[ date ]</a>
              <a href="thread.html#3272">[ thread ]</a>
              <a href="subject.html#3272">[ subject ]</a>
              <a href="author.html#3272">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
