<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Override File's DirectoryLister?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Override%20File%27s%20DirectoryLister%3F&In-Reply-To=CAF-ggVObMG_REhdiiJSYn-nH_05UK%3DVGcLY2rLj_w595AQ1%3DnQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004949.html">
   <LINK REL="Next"  HREF="004951.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Override File's DirectoryLister?</H1>
    <B>Philippe May</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Override%20File%27s%20DirectoryLister%3F&In-Reply-To=CAF-ggVObMG_REhdiiJSYn-nH_05UK%3DVGcLY2rLj_w595AQ1%3DnQ%40mail.gmail.com"
       TITLE="[Twisted-web] Override File's DirectoryLister?">phil.twisted-web at hanjinet.org
       </A><BR>
    <I>Sun Oct 28 14:46:00 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="004949.html">[Twisted-web] Override File's DirectoryLister?
</A></li>
        <LI>Next message: <A HREF="004951.html">[Twisted-web] Override File's DirectoryLister?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4950">[ date ]</a>
              <a href="thread.html#4950">[ thread ]</a>
              <a href="subject.html#4950">[ subject ]</a>
              <a href="author.html#4950">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Rich,

That's quite easy, it's just basic object oriented programing with Python, nothing directly related to Twisted:
import what you need, subclass the File and DirectoryLister, and override in those what is required to be changed.

Starting rom the code you mention, that gives the piece of code below (check the ## ** Comment ** parts).
Hope that helps you starting.

Regards,
Philippe


import os
import cgi
import urllib
import time

from twisted.web.server import Site
from twisted.web.resource import Resource
from twisted.internet import reactor
from twisted.web.static import File, DirectoryLister, getTypeAndEncoding, formatFileSize


class MyDirectoryLister(DirectoryLister):

    ## ** Comment **
    ##   Here you can change the way lines are displayed.
    ##   I just added the &quot;mtime&quot; field, see below how it is defined

    linePattern = &quot;&quot;&quot;&lt;tr class=&quot;%(class)s&quot;&gt;
    &lt;td&gt;&lt;a href=&quot;%(href)s&quot;&gt;%(text)s&lt;/a&gt;&lt;/td&gt;
    &lt;td&gt;%(size)s&lt;/td&gt;
    &lt;td&gt;%(type)s&lt;/td&gt;
    &lt;td&gt;%(encoding)s&lt;/td&gt;
    &lt;td&gt;%(mtime)s&lt;/td&gt;
&lt;/tr&gt;
&quot;&quot;&quot;

    ## ** Comment **
    ##   _getFilesAndDirectories is just a copy of the original function found in the File class,
    ##   with minor modifications

    def _getFilesAndDirectories(self, directory):
        &quot;&quot;&quot;
        Helper returning files and directories in given directory listing, with
        attributes to be used to build a table content with
        C{self.linePattern}.

        @return: tuple of (directories, files)
        @rtype: C{tuple} of C{list}
        &quot;&quot;&quot;

        files = []
        dirs = []
        for path in directory:
            ## ** Comment **
            ##   Do stuff with the file path
            ##   (eg filter 'hidden' files and get the modification time):
            if path[0] == &quot;.&quot;:
                continue
            mtime = time.asctime(time.localtime(os.path.getmtime(os.path.join(self.path, path))))

            url = urllib.quote(path, &quot;/&quot;)
            escapedPath = cgi.escape(path)
            if os.path.isdir(os.path.join(self.path, path)):
                url = url + '/'
                dirs.append({'text': escapedPath + &quot;/&quot;, 'href': url,
                             'size': '', 'type': '[Directory]',
                             'encoding': '',
                             'mtime': mtime
                             })
            else:
                mimetype, encoding = getTypeAndEncoding(path, self.contentTypes,
                                                        self.contentEncodings,
                                                        self.defaultType)
                try:
                    size = os.stat(os.path.join(self.path, path)).st_size
                except OSError:
                    continue


                ## ** Comment **
                ##   Add attributes the the &quot;elements&quot; displayed in each line

                files.append({
                    'text': escapedPath, &quot;href&quot;: url,
                    'type': '[%s]' % mimetype,
                    'encoding': (encoding and '[%s]' % encoding or ''),
                    'size': formatFileSize(size),
                    'mtime': mtime,
                    }
                )
        return dirs, files


class MyFile(File):

    ## ** Comment **
    ##   You need need of course to subclass File, and change the minimum required to use your
    ##   DirectoryLister

    def directoryListing(self):
        return MyDirectoryLister(self.path,
                               self.listNames(),
                               self.contentTypes,
                               self.contentEncodings,
                               self.defaultType)


root = Resource()
## ** Comment **
##   Of course, don't forget to use your class:
root.putChild(&quot;foo&quot;, MyFile(&quot;/tmp&quot;))
root.putChild(&quot;bar&quot;, MyFile(&quot;/lost+found&quot;))
root.putChild(&quot;baz&quot;, MyFile(&quot;/opt&quot;))

factory = Site(root)
reactor.listenTCP(8880, factory)
reactor.run()


Le 28 oct. 2012 &#224; 22:32, Rich Brown a &#233;crit :

&gt;<i> Folks,
</I>&gt;<i> 
</I>&gt;<i> I'm new to Twisted and it looks like a good way to add a web server to my existing project. I am successfully following the example at <A HREF="http://twistedmatrix.com/documents/current/web/howto/web-in-60/static-dispatch.html">http://twistedmatrix.com/documents/current/web/howto/web-in-60/static-dispatch.html</A> to display the directories with the default file listing code.
</I>&gt;<i> 
</I>&gt;<i> Now I want to modify that default behavior for directory listing to:
</I>&gt;<i> 
</I>&gt;<i> - filter out/exclude certain kinds of files (e.g., by the extension), and 
</I>&gt;<i> - add a few elements to the HTML page displayed.
</I>&gt;<i> 
</I>&gt;<i> I've read the code of static.py, and see that the the DirectoryLister class seems to govern this. I believe I need to make a subslass, but I'm not a strong Python programmer, so the minor variations I tried kept running amiss of the class hierarchy, etc.
</I>&gt;<i> 
</I>&gt;<i> Could someone give me an outline of the method declarations that are needed to get the behavior above? Many thanks.
</I>&gt;<i> 
</I>&gt;<i> Rich Brown
</I>&gt;<i> Hanover, NH USA
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20121029/a4ab67f8/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20121029/a4ab67f8/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004949.html">[Twisted-web] Override File's DirectoryLister?
</A></li>
	<LI>Next message: <A HREF="004951.html">[Twisted-web] Override File's DirectoryLister?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4950">[ date ]</a>
              <a href="thread.html#4950">[ thread ]</a>
              <a href="subject.html#4950">[ subject ]</a>
              <a href="author.html#4950">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
