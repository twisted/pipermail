<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Freeform/formless doesn't work with deferred properties?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000073.html">
   <LINK REL="Next"  HREF="000077.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Freeform/formless doesn't work with deferred properties?
   </H1>
    <B>Gavrie Philipson
    </B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com"
       TITLE="[Twisted-web] Freeform/formless doesn't work with deferred properties?">twisted-web@twistedmatrix.com
       </A><BR>
    <I>Wed, 24 Dec 2003 08:37:04 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="000073.html">[Twisted-web] Freeform/formless doesn't work with deferred properties?
</A></li>
        <LI> Next message: <A HREF="000077.html">[Twisted-web] Freeform/formless doesn't work with deferred properties?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#76">[ date ]</a>
              <a href="thread.html#76">[ thread ]</a>
              <a href="subject.html#76">[ subject ]</a>
              <a href="author.html#76">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Donovan Preston wrote:
&gt;<i> 
</I>&gt;<i> On Dec 22, 2003, at 10:38 AM, Gavrie Philipson wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm using freeform/formless to handle a form.
</I>&gt;&gt;<i> However, when the property returns a deferred value, it is not handled 
</I>&gt;&gt;<i> correctly by freeform.
</I>&gt;&gt;<i> Is this a bug?
</I>&gt;&gt;<i>
</I>...
&gt;<i> Your suspicions about the freeform problem being related to the 
</I>&gt;<i> attribute problem are correct; apparently nevow doesn't deal with 
</I>&gt;<i> deferreds in attribute values properly. Are you sure you are using CVS 
</I>&gt;<i> HEAD? I checked in some changes fairly recently which may affect the 
</I>&gt;<i> situation.
</I>&gt;<i> 
</I>&gt;<i> Anyway, it's something that should certainly be fixed. In the meantime, 
</I>&gt;<i> it's good that you have a workaround.
</I>
Donovan,

Christopher's workaround is fine, but doesn't solve the problem when 
using freeform.configure to render the form instead of my own form layout.

Anyway, I just did a 'cvs update' to get the latest HEAD, and guess 
what? Now my test script doesn't work at all!
When I run twistd -ony /tmp/formpost-defer.tac (the same script that I 
previously posted to this list), I get a traceback (see below).

Is this a bug? I did a clean install of the Quotient package and kept no 
old files around.

-- Gavrie.

2003/12/24 08:31 IST [-] Log opened.
2003/12/24 08:31 IST [-] twistd 1.1.0 (/usr/bin/python 2.3.2) starting up
2003/12/24 08:31 IST [-] reactor class: 
twisted.internet.default.SelectReactor
2003/12/24 08:31 IST [-] Loading /tmp/formpost-defer.tac...
2003/12/24 08:31 IST [-] 
/usr/lib/python2.3/site-packages/atop/store.py:36: 
exceptions.DeprecationWarning: This module is deprecated.
2003/12/24 08:31 IST [-] TODO: add IComponentized to Twisted so that we 
can do this without relying on getattr magic.
2003/12/24 08:31 IST [-] Loaded.
2003/12/24 08:31 IST [-] nevow.appserver.NevowSite starting on 8080
2003/12/24 08:31 IST [-] Starting factory &lt;nevow.appserver.NevowSite 
instance at 0xbf0def6c&gt;
2003/12/24 08:31 IST [HTTPChannel,0,127.0.0.1] Traceback (most recent 
call last):
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/internet/default.py&quot;, line 
501, in doSelect
             _logrun(selectable, _drdw, selectable, method, dict)
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/python/log.py&quot;, line 65, in 
callWithLogger
             callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/python/log.py&quot;, line 52, in 
callWithContext
             return context.call({ILogContext: newCtx}, func, *args, **kw)
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/python/context.py&quot;, line 32, 
in callWithContext
             return func(*args,**kw)
         --- &lt;exception caught here&gt; ---
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/internet/default.py&quot;, line 
510, in _doReadOrWrite
             why = getattr(selectable, method)()
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/internet/tcp.py&quot;, line 250, in 
doRead
             return self.protocol.dataReceived(data)
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/protocols/basic.py&quot;, line 223, 
in dataReceived
             why = self.lineReceived(line)
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/protocols/http.py&quot;, line 950, 
in lineReceived
             self.allContentReceived()
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/protocols/http.py&quot;, line 991, 
in allContentReceived
             req.requestReceived(command, path, version)
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/protocols/http.py&quot;, line 549, 
in requestReceived
             self.process()
           File &quot;/usr/lib/python2.3/site-packages/nevow/appserver.py&quot;, 
line 115, in process
             return self.site.getResourceFor(self).addCallback(
           File &quot;/usr/lib/python2.3/site-packages/nevow/appserver.py&quot;, 
line 202, in getResourceFor
             res = INewResource(self.resource)
           File 
&quot;/usr/lib/python2.3/site-packages/twisted/python/components.py&quot;, line 
77, in __call__
             raise CannotAdapt(&quot;%s cannot be adapted to %s.&quot; %
         twisted.python.components.CannotAdapt: &lt;FormPage object at 
0xbf0def4c&gt; cannot be adapted to &lt;class 'nevow.appserver.INewResource'&gt;.



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000073.html">[Twisted-web] Freeform/formless doesn't work with deferred properties?
</A></li>
	<LI> Next message: <A HREF="000077.html">[Twisted-web] Freeform/formless doesn't work with deferred properties?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#76">[ date ]</a>
              <a href="thread.html#76">[ thread ]</a>
              <a href="subject.html#76">[ subject ]</a>
              <a href="author.html#76">[ author ]</a>
         </LI>
       </UL>
</body></html>
