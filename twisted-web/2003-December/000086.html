<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] newclient.py cookies and POST
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000085.html">
   <LINK REL="Next"  HREF="000087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] newclient.py cookies and POST
   </H1>
    <B>Jeff Pitman
    </B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com"
       TITLE="[Twisted-web] newclient.py cookies and POST">twisted-web@twistedmatrix.com
       </A><BR>
    <I>Sun, 28 Dec 2003 00:00:52 -0800 (PST)</I>
    <P><UL>
        <LI> Previous message: <A HREF="000085.html">[Twisted-web] List manipulation in Nevow
</A></li>
        <LI> Next message: <A HREF="000087.html">[Twisted-web] Nouvelle- like nevow, but simpler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#86">[ date ]</a>
              <a href="thread.html#86">[ thread ]</a>
              <a href="subject.html#86">[ subject ]</a>
              <a href="author.html#86">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The following patch fixes cookies and POST requests for
Quotient/quotient/web/newclient.py (diff'd against latest CVS). I
gracefully stole from twisted/web/client.py because the original
attempt didn't work for more than one cookie on newclient.py.

Enjoy it,
jeff

--- Quotient/quotient/web/newclient.py  2003-12-28
15:03:35.000000000 +0800
+++ newclient.py        2003-12-28 15:18:02.000000000 +0800
@@ -103,7 +103,7 @@
 def sendHeaders(connection, req):
     if req.has_data():
         data = req.get_data()
-        connection.sendCommand('POST', requ.get_selector())
+        connection.sendCommand('POST', req.get_selector())
         if not req.headers.has_key('Content-type'):
             connection.sendHeader('Content-type',
                                  
'application/x-www-form-urlencoded')
@@ -146,8 +146,11 @@
         factory = ClientFactory(self.cookies)
         self.callMethod('connect_'+request.get_type(), request,
factory)
         d = factory.connection
-        for cookie in self.cookies:
-            request.add_header(&quot;Cookie&quot;, '='.join([cookie,
self.cookies[cookie]]))
+        if self.cookies:
+           l=[]
+           for cookie, cookval in self.cookies.items():
+               l.append('%s=%s' % (cookie, cookval))
+            request.add_header(&quot;Cookie&quot;, &quot;; &quot;.join(l))
         request.add_header('Referer', self.referrer)
         self.referrer = request.get_full_url()
         d.addCallback(sendHeaders, request)




__________________________________
Do you Yahoo!?
Protect your identity with Yahoo! Mail AddressGuard
<A HREF="http://antispam.yahoo.com/whatsnewfree">http://antispam.yahoo.com/whatsnewfree</A>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000085.html">[Twisted-web] List manipulation in Nevow
</A></li>
	<LI> Next message: <A HREF="000087.html">[Twisted-web] Nouvelle- like nevow, but simpler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#86">[ date ]</a>
              <a href="thread.html#86">[ thread ]</a>
              <a href="subject.html#86">[ subject ]</a>
              <a href="author.html#86">[ author ]</a>
         </LI>
       </UL>
</body></html>
