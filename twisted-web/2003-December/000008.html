<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Menu flattening
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000009.html">
   <LINK REL="Next"  HREF="000012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Menu flattening
   </H1>
    <B>Donovan Preston
    </B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com"
       TITLE="[Twisted-web] Menu flattening">twisted-web@twistedmatrix.com
       </A><BR>
    <I>Thu, 11 Dec 2003 11:53:38 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="000009.html">[Twisted-web] Menu flattening
</A></li>
        <LI> Next message: <A HREF="000012.html">[Twisted-web] nevow CannotAdapt error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8">[ date ]</a>
              <a href="thread.html#8">[ thread ]</a>
              <a href="subject.html#8">[ subject ]</a>
              <a href="author.html#8">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--Apple-Mail-3-512621281
Content-Transfer-Encoding: 7bit
Content-Type: text/plain;
	charset=US-ASCII;
	format=flowed


On Dec 11, 2003, at 10:35 AM, Justin Johnson wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm trying to write a method that creates a menu given the following
</I>&gt;<i> information.
</I>&gt;<i>
</I>&gt;<i> menu_items = {
</I>&gt;<i>     &quot;A&quot;: [ &quot;a&quot;, &quot;b&quot;, &quot;c&quot; ],
</I>&gt;<i>     &quot;B&quot;: [ &quot;d&quot;, &quot;e&quot;, &quot;f&quot; ],
</I>&gt;<i>     &quot;C&quot;: [ &quot;g&quot;, &quot;h&quot;, {&quot;i&quot;: [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;]} ],
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> This dict contains the hierarchy of menus.
</I>
First, let me start by saying that nevow is all about flexibility. You 
have an implementation of a function which does exactly what you want, 
except it uses string concatenation instead of stan to generate some 
HTML. If it is going to be easier for you to debug and understand this 
code, then by all means use it. I have shown an example of using your 
string-concatenation code as a nevow renderer, by calling your code and 
wrapping the output in an xml object, before returning it.

Second, stan doesn't have to be about huge python expressions. It's 
just as easy to use in a standard procedural way, creating objects and 
then appending them to lists. I have constructed an example of 
rendering your menu structure using stan with clarity and readability 
in mind.

dp


--Apple-Mail-3-512621281
Content-Transfer-Encoding: 7bit
Content-Type: application/octet-stream;
	x-unix-mode=0644;
	name=&quot;nestedmenus.tac&quot;
Content-Disposition: attachment;
	filename=nestedmenus.tac



import random

from twisted.application import service, internet
from twisted.web import server

from nevow import renderer
from nevow import tags


def flatten_menu(data):
    html_menu = &quot;&lt;ul&gt;&quot;
    for k, v in data.items():
        html_menu += &quot;&lt;li&gt;%s&lt;/li&gt;&quot; % k
        html_menu += &quot;&lt;ul&gt;&quot;
        for i in v:
            if isinstance(i, dict):
                html_menu += flatten_menu(i)
            else:
                html_menu += &quot;&lt;li&gt;%s&lt;/li&gt;&quot; % i
        html_menu += &quot;&lt;/ul&gt;&quot;
    html_menu += &quot;&lt;/ul&gt;&quot;
    return html_menu


class Menus(renderer.Renderer):
    document = tags.html[
    tags.head[tags.title[&quot;Hello&quot;]],
    tags.body[
        tags.div(style=&quot;border: 1px dotted black; margin: 1em&quot;)[
            tags.ul(renderer=tags.directive(&quot;menu&quot;))
        ],
        tags.div(style=&quot;border: 1px dotted black; margin: 1em&quot;)[
            tags.ul(renderer=tags.directive(&quot;stan_menu&quot;))
        ]
    ]
]
    def render_menu(self, context, data):
        return tags.xml(flatten_menu(data))

    def render_stan_menu(self, context, data):
        &quot;&quot;&quot;Render a dictionary of string keys and list of string/dict values.&quot;&quot;&quot;
        menu = context.tag
        for k, v in data.items():
            # Add a list item with our key as the label
            menu.children.append(tags.li[k])
            # Add an ul tag to this menu for the submenu
            submenu = tags.ul()
            menu.children.append(submenu)

            # For every element of the value list
            for i in v:
                # if it's a dict, cause render_stan_menu to be called on it, and the output placed in the submenu tag
                if isinstance(i, dict):
                    submenu.children.append(tags.ul(data=i, renderer=self.render_stan_menu))
                # if it's a string, just add a list item with the string to the menu
                else:
                    submenu.children.append(tags.li[ i ])
        return menu


menu_items = {
    &quot;A&quot;: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;],
    &quot;B&quot;: [&quot;d&quot;, &quot;e&quot;, &quot;f&quot;],
    &quot;C&quot;: [&quot;g&quot;, &quot;h&quot;, {&quot;i&quot;:
        [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;]
    }]
}


application = service.Application(&quot;nestedmenus&quot;)
internet.TCPServer(
    8080, 
    server.Site(
        Menus(
            menu_items
        )
    )
).setServiceParent(application)

--Apple-Mail-3-512621281--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000009.html">[Twisted-web] Menu flattening
</A></li>
	<LI> Next message: <A HREF="000012.html">[Twisted-web] nevow CannotAdapt error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8">[ date ]</a>
              <a href="thread.html#8">[ thread ]</a>
              <a href="subject.html#8">[ subject ]</a>
              <a href="author.html#8">[ author ]</a>
         </LI>
       </UL>
</body></html>
