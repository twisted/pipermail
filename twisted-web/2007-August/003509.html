<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Adding Athena JS handlers in render methods?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Adding%20Athena%20JS%20handlers%20in%20render%20methods%3F&In-Reply-To=20070730142543.4947.229535084.divmod.quotient.16652%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003508.html">
   <LINK REL="Next"  HREF="003510.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Adding Athena JS handlers in render methods?</H1>
    <B>kgi</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Adding%20Athena%20JS%20handlers%20in%20render%20methods%3F&In-Reply-To=20070730142543.4947.229535084.divmod.quotient.16652%40ohm"
       TITLE="[Twisted-web] Adding Athena JS handlers in render methods?">iacovou at gmail.com
       </A><BR>
    <I>Wed Aug  1 09:07:15 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003508.html">[Twisted-web] Twisted and RESTful app
</A></li>
        <LI>Next message: <A HREF="003510.html">[Twisted-web] Adding Athena JS handlers in render methods?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3509">[ date ]</a>
              <a href="thread.html#3509">[ thread ]</a>
              <a href="subject.html#3509">[ subject ]</a>
              <a href="author.html#3509">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Monday 30 July 2007 17:25:43 Jean-Paul Calderone wrote:

&gt;<i> It's unsupported.  What you can do instead is to put the event handlers
</I>&gt;<i> into the template (stan or xhtml) as patterns.  This will result in them
</I>&gt;<i> being rewritten properly.  Your render and data methods will thus be able
</I>&gt;<i> to load them, already pre-processed, from the docFactory and put them in
</I>&gt;<i> the page.
</I>
Hi Jean-Paul; thanks for your answer; that makes a lot of sense.

In the meantime I worked around the problem by inserting the &quot;expanded&quot; 
javascript (that is, Nevow.Athena.Widget.handleEvent()) into the stan in the 
special methods. It's hacky but it works - I'll implement your suggestion 
next time I visit that piece of code.

If you're not fed up with Athena-related questions, I do have another one.

At the moment I've got some active content in a LiveElement that I update 
multiple times throughout the lifetime of a page. This updating is done by JS 
DOM manipulation on parameters that get passed over an Athena call (paying 
greater client complexity and load in return for lower server load and lower 
bandwidth).

However, the content has to have *something* when the LiveElement is first 
rendered, so I'm having to implement the same logic twice: once in the stan 
to provide the initial content, and once in the JS to update the page.

I'd like to kill the stan version by arranging to call the LiveElement's 
update code after the page has rendered; however, I'm unsure where the hook 
should go. I already have code to allow the LiveElements to request a 
callback, I just need to know when the Athena link is up and running.

Digging about a bit, I can see that rend.Page's self.afterRender gets called 
after renderHTTP, if it's defined, but this is too early: it gets called when 
rendering has been done on the *server*, way before the browser even starts 
requesting the various page elements (JS files, CSS files, etc). That also 
rules out trying to hook onto LivePage's _becomeLive, because that gets 
called even before renderHTTP. LivePageFactory's addClient() runs similarly 
early.

I've even considered having a special child resource (a 1x1 transparent image, 
say), placed towards the bottom of the body, access to whose resource path 
triggers the process of updating the LiveElements, but that's really the last 
resort.

Is there an approved way to achieve this?

Thanks,

Ricky

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003508.html">[Twisted-web] Twisted and RESTful app
</A></li>
	<LI>Next message: <A HREF="003510.html">[Twisted-web] Adding Athena JS handlers in render methods?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3509">[ date ]</a>
              <a href="thread.html#3509">[ thread ]</a>
              <a href="subject.html#3509">[ subject ]</a>
              <a href="author.html#3509">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
